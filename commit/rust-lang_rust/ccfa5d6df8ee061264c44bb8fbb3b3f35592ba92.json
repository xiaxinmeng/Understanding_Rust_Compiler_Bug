{"sha": "ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjZmE1ZDZkZjhlZTA2MTI2NGM0NGJiOGZiYjNiM2YzNTU5MmJhOTI=", "commit": {"author": {"name": "csmoe", "email": "csmoe@msn.com", "date": "2019-02-09T14:11:53Z"}, "committer": {"name": "csmoe", "email": "csmoe@msnc.om", "date": "2019-02-26T11:30:57Z"}, "message": "replace &'tcx Substs with SubstsRef", "tree": {"sha": "2e04950169305b2e7531f83603e4d88b885abefc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e04950169305b2e7531f83603e4d88b885abefc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "html_url": "https://github.com/rust-lang/rust/commit/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/comments", "author": {"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ea43c3c688980edd6f09a4cb632c9eb996c4f2af", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea43c3c688980edd6f09a4cb632c9eb996c4f2af", "html_url": "https://github.com/rust-lang/rust/commit/ea43c3c688980edd6f09a4cb632c9eb996c4f2af"}], "stats": {"total": 424, "additions": 213, "deletions": 211}, "files": [{"sha": "0d8f71a50ce5234ed6270222886bd25781fed812", "filename": "src/librustc/dep_graph/dep_node.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -67,7 +67,7 @@ use crate::traits::query::{\n };\n use crate::ty::{TyCtxt, FnSig, Instance, InstanceDef,\n          ParamEnv, ParamEnvAnd, Predicate, PolyFnSig, PolyTraitRef, Ty};\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n \n // erase!() just makes tokens go away. It's used to specify which macro argument\n // is repeated (i.e., which sub-expression of the macro we are in) but don't need\n@@ -661,7 +661,7 @@ define_dep_nodes!( <'tcx>\n     [] TypeOpNormalizePolyFnSig(CanonicalTypeOpNormalizeGoal<'tcx, PolyFnSig<'tcx>>),\n     [] TypeOpNormalizeFnSig(CanonicalTypeOpNormalizeGoal<'tcx, FnSig<'tcx>>),\n \n-    [] SubstituteNormalizeAndTestPredicates { key: (DefId, &'tcx Substs<'tcx>) },\n+    [] SubstituteNormalizeAndTestPredicates { key: (DefId, SubstsRef<'tcx>) },\n     [] MethodAutoderefSteps(CanonicalTyGoal<'tcx>),\n \n     [input] TargetFeaturesWhitelist,"}, {"sha": "6ef902a47dc8d768c931156e9a8b2bf485979acf", "filename": "src/librustc/infer/combine.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fcombine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fcombine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fcombine.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -34,7 +34,7 @@ use crate::ty::{IntType, UintType};\n use crate::ty::{self, Ty, TyCtxt};\n use crate::ty::error::TypeError;\n use crate::ty::relate::{self, Relate, RelateResult, TypeRelation};\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n use crate::traits::{Obligation, PredicateObligations};\n \n use syntax::ast;\n@@ -373,9 +373,9 @@ impl<'cx, 'gcx, 'tcx> TypeRelation<'cx, 'gcx, 'tcx> for Generalizer<'cx, 'gcx, '\n \n     fn relate_item_substs(&mut self,\n                           item_def_id: DefId,\n-                          a_subst: &'tcx Substs<'tcx>,\n-                          b_subst: &'tcx Substs<'tcx>)\n-                          -> RelateResult<'tcx, &'tcx Substs<'tcx>>\n+                          a_subst: SubstsRef<'tcx>,\n+                          b_subst: SubstsRef<'tcx>)\n+                          -> RelateResult<'tcx, SubstsRef<'tcx>>\n     {\n         if self.ambient_variance == ty::Variance::Invariant {\n             // Avoid fetching the variance if we are in an invariant"}, {"sha": "31b01eecf5cb6e88231f428b7f908c0a93f41178", "filename": "src/librustc/infer/equate.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fequate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fequate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fequate.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -5,7 +5,7 @@ use crate::hir::def_id::DefId;\n \n use crate::ty::{self, Ty, TyCtxt};\n use crate::ty::TyVar;\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n use crate::ty::relate::{self, Relate, RelateResult, TypeRelation};\n \n /// Ensures `a` is made equal to `b`. Returns `a` on success.\n@@ -33,9 +33,9 @@ impl<'combine, 'infcx, 'gcx, 'tcx> TypeRelation<'infcx, 'gcx, 'tcx>\n \n     fn relate_item_substs(&mut self,\n                           _item_def_id: DefId,\n-                          a_subst: &'tcx Substs<'tcx>,\n-                          b_subst: &'tcx Substs<'tcx>)\n-                          -> RelateResult<'tcx, &'tcx Substs<'tcx>>\n+                          a_subst: SubstsRef<'tcx>,\n+                          b_subst: SubstsRef<'tcx>)\n+                          -> RelateResult<'tcx, SubstsRef<'tcx>>\n     {\n         // N.B., once we are equating types, we don't care about\n         // variance, so don't try to lookup the variance here. This"}, {"sha": "506388c268bb107e01ecade10240980af9297ab7", "filename": "src/librustc/infer/error_reporting/nice_region_error/placeholder_error.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fplaceholder_error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fplaceholder_error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fplaceholder_error.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -7,7 +7,7 @@ use crate::infer::{SubregionOrigin, TypeTrace};\n use crate::traits::{ObligationCause, ObligationCauseCode};\n use crate::ty;\n use crate::ty::error::ExpectedFound;\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n use crate::util::ppaux::RegionHighlightMode;\n \n impl NiceRegionError<'me, 'gcx, 'tcx> {\n@@ -175,8 +175,8 @@ impl NiceRegionError<'me, 'gcx, 'tcx> {\n         sub_placeholder: Option<ty::Region<'tcx>>,\n         sup_placeholder: Option<ty::Region<'tcx>>,\n         trait_def_id: DefId,\n-        expected_substs: &'tcx Substs<'tcx>,\n-        actual_substs: &'tcx Substs<'tcx>,\n+        expected_substs: SubstsRef<'tcx>,\n+        actual_substs: SubstsRef<'tcx>,\n     ) -> DiagnosticBuilder<'me> {\n         debug!(\n             \"try_report_placeholders_trait(\\"}, {"sha": "a02918a493948bae7b254d404877b470b0fe7a1a", "filename": "src/librustc/infer/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -18,7 +18,7 @@ use crate::traits::{self, ObligationCause, PredicateObligations, TraitEngine};\n use crate::ty::error::{ExpectedFound, TypeError, UnconstrainedNumeric};\n use crate::ty::fold::TypeFoldable;\n use crate::ty::relate::RelateResult;\n-use crate::ty::subst::{Kind, Substs};\n+use crate::ty::subst::{Kind, Substs, SubstsRef};\n use crate::ty::{self, GenericParamDefKind, Ty, TyCtxt, CtxtInterners};\n use crate::ty::{FloatVid, IntVid, TyVid};\n use crate::util::nodemap::FxHashMap;\n@@ -1088,7 +1088,7 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n \n     /// Given a set of generics defined on a type or impl, returns a substitution mapping each\n     /// type/region parameter to a fresh inference variable.\n-    pub fn fresh_substs_for_item(&self, span: Span, def_id: DefId) -> &'tcx Substs<'tcx> {\n+    pub fn fresh_substs_for_item(&self, span: Span, def_id: DefId) -> SubstsRef<'tcx> {\n         Substs::for_item(self.tcx, def_id, |param, _| self.var_for_def(span, param))\n     }\n "}, {"sha": "079c2a12a8475251166ad59bc130d22f87a14d88", "filename": "src/librustc/infer/opaque_types/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fopaque_types%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Finfer%2Fopaque_types%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fopaque_types%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -9,7 +9,7 @@ use crate::traits::{self, PredicateObligation};\n use crate::ty::{self, Ty, TyCtxt, GenericParamDefKind};\n use crate::ty::fold::{BottomUpFolder, TypeFoldable, TypeFolder};\n use crate::ty::outlives::Component;\n-use crate::ty::subst::{Kind, Substs, UnpackedKind};\n+use crate::ty::subst::{Kind, Substs, SubstsRef, UnpackedKind};\n use crate::util::nodemap::DefIdMap;\n \n pub type OpaqueTypeMap<'tcx> = DefIdMap<OpaqueTypeDecl<'tcx>>;\n@@ -30,7 +30,7 @@ pub struct OpaqueTypeDecl<'tcx> {\n     ///     fn foo<'a, 'b, T>() -> Foo<'a, T>\n     ///\n     /// then `substs` would be `['a, T]`.\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n \n     /// The type variable that represents the value of the abstract type\n     /// that we require. In other words, after we compile this function,\n@@ -740,7 +740,7 @@ impl<'a, 'gcx, 'tcx> Instantiator<'a, 'gcx, 'tcx> {\n         &mut self,\n         ty: Ty<'tcx>,\n         def_id: DefId,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n     ) -> Ty<'tcx> {\n         let infcx = self.infcx;\n         let tcx = infcx.tcx;"}, {"sha": "32c7216765533cf65fc925b962b74d1096752dca", "filename": "src/librustc/middle/exported_symbols.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmiddle%2Fexported_symbols.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmiddle%2Fexported_symbols.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fexported_symbols.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -5,7 +5,7 @@ use rustc_data_structures::stable_hasher::{StableHasher, HashStable,\n use std::cmp;\n use std::mem;\n use crate::ty;\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n \n /// The SymbolExportLevel of a symbols specifies from which kinds of crates\n /// the symbol will be exported. `C` symbols will be exported from any\n@@ -33,7 +33,7 @@ impl SymbolExportLevel {\n #[derive(Eq, PartialEq, Debug, Copy, Clone, RustcEncodable, RustcDecodable)]\n pub enum ExportedSymbol<'tcx> {\n     NonGeneric(DefId),\n-    Generic(DefId, &'tcx Substs<'tcx>),\n+    Generic(DefId, SubstsRef<'tcx>),\n     NoDefId(ty::SymbolName),\n }\n "}, {"sha": "bfc74979af42c8630164e7823a05881cdefbb535", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -27,7 +27,7 @@ use syntax::ast::{self, Name};\n use syntax::symbol::InternedString;\n use syntax_pos::{Span, DUMMY_SP};\n use crate::ty::fold::{TypeFoldable, TypeFolder, TypeVisitor};\n-use crate::ty::subst::{Subst, Substs};\n+use crate::ty::subst::{Subst, SubstsRef};\n use crate::ty::layout::VariantIdx;\n use crate::ty::{\n     self, AdtDef, CanonicalUserTypeAnnotations, ClosureSubsts, GeneratorSubsts, Region, Ty, TyCtxt,\n@@ -2151,7 +2151,7 @@ impl<'tcx> Operand<'tcx> {\n     pub fn function_handle<'a>(\n         tcx: TyCtxt<'a, 'tcx, 'tcx>,\n         def_id: DefId,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         span: Span,\n     ) -> Self {\n         let ty = tcx.type_of(def_id).subst(tcx, substs);\n@@ -2247,7 +2247,7 @@ pub enum AggregateKind<'tcx> {\n     Adt(\n         &'tcx AdtDef,\n         VariantIdx,\n-        &'tcx Substs<'tcx>,\n+        SubstsRef<'tcx>,\n         Option<UserTypeAnnotationIndex>,\n         Option<usize>,\n     ),"}, {"sha": "dbf911851bf2d785227ccf85d16244c19251d091", "filename": "src/librustc/mir/tcx.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmir%2Ftcx.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmir%2Ftcx.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Ftcx.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -4,7 +4,7 @@\n  */\n \n use crate::mir::*;\n-use crate::ty::subst::{Subst, Substs};\n+use crate::ty::subst::{Subst, SubstsRef};\n use crate::ty::{self, AdtDef, Ty, TyCtxt};\n use crate::ty::layout::VariantIdx;\n use crate::hir;\n@@ -17,7 +17,7 @@ pub enum PlaceTy<'tcx> {\n \n     /// Downcast to a particular variant of an enum.\n     Downcast { adt_def: &'tcx AdtDef,\n-               substs: &'tcx Substs<'tcx>,\n+               substs: SubstsRef<'tcx>,\n                variant_index: VariantIdx },\n }\n "}, {"sha": "4f31cebca088d9c3fb8afdc939bc8e5c45e95776", "filename": "src/librustc/mir/visit.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmir%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fmir%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fvisit.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -1,5 +1,5 @@\n use crate::hir::def_id::DefId;\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n use crate::ty::{CanonicalUserTypeAnnotation, ClosureSubsts, GeneratorSubsts, Region, Ty};\n use crate::mir::*;\n use syntax_pos::Span;\n@@ -238,7 +238,7 @@ macro_rules! make_mir_visitor {\n             }\n \n             fn visit_substs(&mut self,\n-                            substs: & $($mutability)? &'tcx Substs<'tcx>,\n+                            substs: & $($mutability)? SubstsRef<'tcx>,\n                             _: Location) {\n                 self.super_substs(substs);\n             }\n@@ -889,7 +889,7 @@ macro_rules! make_mir_visitor {\n             fn super_const(&mut self, _const: & $($mutability)? &'tcx ty::LazyConst<'tcx>) {\n             }\n \n-            fn super_substs(&mut self, _substs: & $($mutability)? &'tcx Substs<'tcx>) {\n+            fn super_substs(&mut self, _substs: & $($mutability)? SubstsRef<'tcx>) {\n             }\n \n             fn super_generator_substs(&mut self,"}, {"sha": "64ac874e8f1de5527e04f3c782b1f8e87d0900f1", "filename": "src/librustc/traits/mod.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -29,7 +29,7 @@ use crate::mir::interpret::ErrorHandled;\n use rustc_data_structures::sync::Lrc;\n use syntax::ast;\n use syntax_pos::{Span, DUMMY_SP};\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::{Substs, SubstsRef};\n use crate::ty::{self, AdtKind, List, Ty, TyCtxt, GenericParamDefKind, ToPredicate};\n use crate::ty::error::{ExpectedFound, TypeError};\n use crate::ty::fold::{TypeFolder, TypeFoldable, TypeVisitor};\n@@ -565,7 +565,7 @@ pub enum Vtable<'tcx, N> {\n #[derive(Clone, PartialEq, Eq, RustcEncodable, RustcDecodable)]\n pub struct VtableImplData<'tcx, N> {\n     pub impl_def_id: DefId,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n     pub nested: Vec<N>\n }\n \n@@ -622,7 +622,7 @@ pub struct VtableFnPointerData<'tcx, N> {\n #[derive(Clone, PartialEq, Eq, RustcEncodable, RustcDecodable)]\n pub struct VtableTraitAliasData<'tcx, N> {\n     pub alias_def_id: DefId,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n     pub nested: Vec<N>,\n }\n \n@@ -963,7 +963,7 @@ fn normalize_and_test_predicates<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n }\n \n fn substitute_normalize_and_test_predicates<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n-                                                      key: (DefId, &'tcx Substs<'tcx>))\n+                                                      key: (DefId, SubstsRef<'tcx>))\n                                                       -> bool\n {\n     debug!(\"substitute_normalize_and_test_predicates(key={:?})\",\n@@ -983,7 +983,7 @@ fn substitute_normalize_and_test_predicates<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx\n fn vtable_methods<'a, 'tcx>(\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     trait_ref: ty::PolyTraitRef<'tcx>)\n-    -> Lrc<Vec<Option<(DefId, &'tcx Substs<'tcx>)>>>\n+    -> Lrc<Vec<Option<(DefId, SubstsRef<'tcx>)>>>\n {\n     debug!(\"vtable_methods({:?})\", trait_ref);\n "}, {"sha": "320b591ddcf7b3a1b74ea1a70e5615b2d257e536", "filename": "src/librustc/traits/select.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Ftraits%2Fselect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Ftraits%2Fselect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fselect.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -34,7 +34,7 @@ use crate::middle::lang_items;\n use crate::mir::interpret::GlobalId;\n use crate::ty::fast_reject;\n use crate::ty::relate::TypeRelation;\n-use crate::ty::subst::{Subst, Substs};\n+use crate::ty::subst::{Subst, Substs, SubstsRef};\n use crate::ty::{self, ToPolyTraitRef, ToPredicate, Ty, TyCtxt, TypeFoldable};\n \n use crate::hir;\n@@ -2944,7 +2944,7 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n     fn vtable_impl(\n         &mut self,\n         impl_def_id: DefId,\n-        mut substs: Normalized<'tcx, &'tcx Substs<'tcx>>,\n+        mut substs: Normalized<'tcx, SubstsRef<'tcx>>,\n         cause: ObligationCause<'tcx>,\n         recursion_depth: usize,\n         param_env: ty::ParamEnv<'tcx>,\n@@ -3538,7 +3538,7 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n         impl_def_id: DefId,\n         obligation: &TraitObligation<'tcx>,\n         snapshot: &CombinedSnapshot<'_, 'tcx>,\n-    ) -> Normalized<'tcx, &'tcx Substs<'tcx>> {\n+    ) -> Normalized<'tcx, SubstsRef<'tcx>> {\n         match self.match_impl(impl_def_id, obligation, snapshot) {\n             Ok(substs) => substs,\n             Err(()) => {\n@@ -3556,7 +3556,7 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n         impl_def_id: DefId,\n         obligation: &TraitObligation<'tcx>,\n         snapshot: &CombinedSnapshot<'_, 'tcx>,\n-    ) -> Result<Normalized<'tcx, &'tcx Substs<'tcx>>, ()> {\n+    ) -> Result<Normalized<'tcx, SubstsRef<'tcx>>, ()> {\n         let impl_trait_ref = self.tcx().impl_trait_ref(impl_def_id).unwrap();\n \n         // Before we create the substitutions and everything, first"}, {"sha": "9a760065cb1fc3ca2df08ca590b5898777c0c5d3", "filename": "src/librustc/traits/specialize/mod.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Ftraits%2Fspecialize%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Ftraits%2Fspecialize%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fspecialize%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -20,7 +20,7 @@ use rustc_data_structures::sync::Lrc;\n use syntax_pos::DUMMY_SP;\n use crate::traits::select::IntercrateAmbiguityCause;\n use crate::ty::{self, TyCtxt, TypeFoldable};\n-use crate::ty::subst::{Subst, Substs};\n+use crate::ty::subst::{Subst, Substs, SubstsRef};\n \n use super::{SelectionContext, FulfillmentContext};\n use super::util::impl_trait_ref_and_oblig;\n@@ -73,9 +73,9 @@ pub struct OverlapError {\n pub fn translate_substs<'a, 'gcx, 'tcx>(infcx: &InferCtxt<'a, 'gcx, 'tcx>,\n                                         param_env: ty::ParamEnv<'tcx>,\n                                         source_impl: DefId,\n-                                        source_substs: &'tcx Substs<'tcx>,\n+                                        source_substs: SubstsRef<'tcx>,\n                                         target_node: specialization_graph::Node)\n-                                        -> &'tcx Substs<'tcx> {\n+                                        -> SubstsRef<'tcx> {\n     debug!(\"translate_substs({:?}, {:?}, {:?}, {:?})\",\n            param_env, source_impl, source_substs, target_node);\n     let source_trait_ref = infcx.tcx\n@@ -114,9 +114,9 @@ pub fn find_associated_item<'a, 'tcx>(\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     param_env: ty::ParamEnv<'tcx>,\n     item: &ty::AssociatedItem,\n-    substs: &'tcx Substs<'tcx>,\n+    substs: SubstsRef<'tcx>,\n     impl_data: &super::VtableImplData<'tcx, ()>,\n-) -> (DefId, &'tcx Substs<'tcx>) {\n+) -> (DefId, SubstsRef<'tcx>) {\n     debug!(\"find_associated_item({:?}, {:?}, {:?}, {:?})\",\n            param_env, item, substs, impl_data);\n     assert!(!substs.needs_infer());\n@@ -214,7 +214,7 @@ fn fulfill_implication<'a, 'gcx, 'tcx>(infcx: &InferCtxt<'a, 'gcx, 'tcx>,\n                                        param_env: ty::ParamEnv<'tcx>,\n                                        source_trait_ref: ty::TraitRef<'tcx>,\n                                        target_impl: DefId)\n-                                       -> Result<&'tcx Substs<'tcx>, ()> {\n+                                       -> Result<SubstsRef<'tcx>, ()> {\n     debug!(\"fulfill_implication({:?}, trait_ref={:?} |- {:?} applies)\",\n            param_env, source_trait_ref, target_impl);\n "}, {"sha": "8d449f5c44cf4b246d56d5700a9db6c8c6af8104", "filename": "src/librustc/ty/adjustment.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fadjustment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fadjustment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fadjustment.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -1,7 +1,7 @@\n use crate::hir;\n use crate::hir::def_id::DefId;\n use crate::ty::{self, Ty, TyCtxt};\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n \n \n /// Represents coercing a value to a different type of value.\n@@ -98,7 +98,7 @@ pub struct OverloadedDeref<'tcx> {\n \n impl<'a, 'gcx, 'tcx> OverloadedDeref<'tcx> {\n     pub fn method_call(&self, tcx: TyCtxt<'a, 'gcx, 'tcx>, source: Ty<'tcx>)\n-                       -> (DefId, &'tcx Substs<'tcx>) {\n+                       -> (DefId, SubstsRef<'tcx>) {\n         let trait_def_id = match self.mutbl {\n             hir::MutImmutable => tcx.lang_items().deref_trait(),\n             hir::MutMutable => tcx.lang_items().deref_mut_trait()"}, {"sha": "3ab744ebaeb17d0541961cb90bf347054428f2d0", "filename": "src/librustc/ty/codec.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fcodec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fcodec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcodec.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -13,7 +13,7 @@ use crate::rustc_serialize::{Decodable, Decoder, Encoder, Encodable, opaque};\n use std::hash::Hash;\n use std::intrinsics;\n use crate::ty::{self, Ty, TyCtxt};\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n use crate::mir::interpret::Allocation;\n \n /// The shorthand encoding uses an enum's variant index `usize`\n@@ -185,7 +185,7 @@ pub fn decode_predicates<'a, 'tcx, D>(decoder: &mut D)\n }\n \n #[inline]\n-pub fn decode_substs<'a, 'tcx, D>(decoder: &mut D) -> Result<&'tcx Substs<'tcx>, D::Error>\n+pub fn decode_substs<'a, 'tcx, D>(decoder: &mut D) -> Result<SubstsRef<'tcx>, D::Error>\n     where D: TyDecoder<'a, 'tcx>,\n           'tcx: 'a,\n {\n@@ -281,7 +281,7 @@ macro_rules! implement_ty_decoder {\n             use $crate::infer::canonical::CanonicalVarInfos;\n             use $crate::ty;\n             use $crate::ty::codec::*;\n-            use $crate::ty::subst::Substs;\n+            use $crate::ty::subst::SubstsRef;\n             use $crate::hir::def_id::{CrateNum};\n             use crate::rustc_serialize::{Decoder, SpecializedDecoder};\n             use std::borrow::Cow;\n@@ -344,9 +344,9 @@ macro_rules! implement_ty_decoder {\n                 }\n             }\n \n-            impl<$($typaram),*> SpecializedDecoder<&'tcx Substs<'tcx>>\n+            impl<$($typaram),*> SpecializedDecoder<SubstsRef<'tcx>>\n             for $DecoderName<$($typaram),*> {\n-                fn specialized_decode(&mut self) -> Result<&'tcx Substs<'tcx>, Self::Error> {\n+                fn specialized_decode(&mut self) -> Result<SubstsRef<'tcx>, Self::Error> {\n                     decode_substs(self)\n                 }\n             }"}, {"sha": "68f21ce10788bf149ceff6cce839025b5177d154", "filename": "src/librustc/ty/context.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcontext.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -22,7 +22,7 @@ use crate::middle::resolve_lifetime::{self, ObjectLifetimeDefault};\n use crate::middle::stability;\n use crate::mir::{self, Mir, interpret, ProjectionKind};\n use crate::mir::interpret::Allocation;\n-use crate::ty::subst::{Kind, Substs, Subst};\n+use crate::ty::subst::{Kind, Substs, Subst, SubstsRef};\n use crate::ty::ReprOptions;\n use crate::traits;\n use crate::traits::{Clause, Clauses, GoalKind, Goal, Goals};\n@@ -325,7 +325,7 @@ pub struct ResolvedOpaqueTy<'tcx> {\n     /// Generic parameters on the opaque type as passed by this function.\n     /// For `existential type Foo<A, B>; fn foo<T, U>() -> Foo<T, U> { .. }` this is `[T, U]`, not\n     /// `[A, B]`\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n }\n \n #[derive(RustcEncodable, RustcDecodable, Debug)]\n@@ -352,7 +352,7 @@ pub struct TypeckTables<'tcx> {\n     /// of this node. This only applies to nodes that refer to entities\n     /// parameterized by type parameters, such as generic fns, types, or\n     /// other items.\n-    node_substs: ItemLocalMap<&'tcx Substs<'tcx>>,\n+    node_substs: ItemLocalMap<SubstsRef<'tcx>>,\n \n     /// This will either store the canonicalized types provided by the user\n     /// or the substitutions that the user explicitly gave (if any) attached\n@@ -548,19 +548,19 @@ impl<'tcx> TypeckTables<'tcx> {\n         self.node_types.get(&id.local_id).cloned()\n     }\n \n-    pub fn node_substs_mut(&mut self) -> LocalTableInContextMut<'_, &'tcx Substs<'tcx>> {\n+    pub fn node_substs_mut(&mut self) -> LocalTableInContextMut<'_, SubstsRef<'tcx>> {\n         LocalTableInContextMut {\n             local_id_root: self.local_id_root,\n             data: &mut self.node_substs\n         }\n     }\n \n-    pub fn node_substs(&self, id: hir::HirId) -> &'tcx Substs<'tcx> {\n+    pub fn node_substs(&self, id: hir::HirId) -> SubstsRef<'tcx> {\n         validate_hir_id_for_typeck_tables(self.local_id_root, id, false);\n         self.node_substs.get(&id.local_id).cloned().unwrap_or_else(|| Substs::empty())\n     }\n \n-    pub fn node_substs_opt(&self, id: hir::HirId) -> Option<&'tcx Substs<'tcx>> {\n+    pub fn node_substs_opt(&self, id: hir::HirId) -> Option<SubstsRef<'tcx>> {\n         validate_hir_id_for_typeck_tables(self.local_id_root, id, false);\n         self.node_substs.get(&id.local_id).cloned()\n     }\n@@ -1733,7 +1733,7 @@ impl<'gcx> GlobalCtxt<'gcx> {\n /// A trait implemented for all X<'a> types which can be safely and\n /// efficiently converted to X<'tcx> as long as they are part of the\n /// provided TyCtxt<'tcx>.\n-/// This can be done, for example, for Ty<'tcx> or &'tcx Substs<'tcx>\n+/// This can be done, for example, for Ty<'tcx> or SubstsRef<'tcx>\n /// by looking them up in their respective interners.\n ///\n /// However, this is still not the best implementation as it does\n@@ -2507,7 +2507,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     }\n \n     #[inline]\n-    pub fn mk_adt(self, def: &'tcx AdtDef, substs: &'tcx Substs<'tcx>) -> Ty<'tcx> {\n+    pub fn mk_adt(self, def: &'tcx AdtDef, substs: SubstsRef<'tcx>) -> Ty<'tcx> {\n         // take a copy of substs so that we own the vectors inside\n         self.mk_ty(Adt(def, substs))\n     }\n@@ -2613,7 +2613,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n \n     #[inline]\n     pub fn mk_fn_def(self, def_id: DefId,\n-                     substs: &'tcx Substs<'tcx>) -> Ty<'tcx> {\n+                     substs: SubstsRef<'tcx>) -> Ty<'tcx> {\n         self.mk_ty(FnDef(def_id, substs))\n     }\n \n@@ -2634,7 +2634,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     #[inline]\n     pub fn mk_projection(self,\n                          item_def_id: DefId,\n-                         substs: &'tcx Substs<'tcx>)\n+                         substs: SubstsRef<'tcx>)\n         -> Ty<'tcx> {\n             self.mk_ty(Projection(ProjectionTy {\n                 item_def_id,\n@@ -2704,7 +2704,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     }\n \n     #[inline]\n-    pub fn mk_opaque(self, def_id: DefId, substs: &'tcx Substs<'tcx>) -> Ty<'tcx> {\n+    pub fn mk_opaque(self, def_id: DefId, substs: SubstsRef<'tcx>) -> Ty<'tcx> {\n         self.mk_ty(Opaque(def_id, substs))\n     }\n \n@@ -2817,7 +2817,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     pub fn mk_substs_trait(self,\n                      self_ty: Ty<'tcx>,\n                      rest: &[Kind<'tcx>])\n-                    -> &'tcx Substs<'tcx>\n+                    -> SubstsRef<'tcx>\n     {\n         self.mk_substs(iter::once(self_ty.into()).chain(rest.iter().cloned()))\n     }"}, {"sha": "33ec9c874f9ef1e5e4f3ecd4907bb8ff7c87a22d", "filename": "src/librustc/ty/inhabitedness/mod.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Finhabitedness%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Finhabitedness%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Finhabitedness%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -1,6 +1,6 @@\n use crate::ty::context::TyCtxt;\n use crate::ty::{AdtDef, VariantDef, FieldDef, Ty, TyS};\n-use crate::ty::{self, DefId, Substs};\n+use crate::ty::{self, DefId, SubstsRef};\n use crate::ty::{AdtKind, Visibility};\n use crate::ty::TyKind::*;\n \n@@ -108,21 +108,21 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     pub fn is_enum_variant_uninhabited_from(self,\n                                             module: DefId,\n                                             variant: &'tcx VariantDef,\n-                                            substs: &'tcx Substs<'tcx>)\n+                                            substs: SubstsRef<'tcx>)\n                                             -> bool\n     {\n         self.variant_inhabitedness_forest(variant, substs).contains(self, module)\n     }\n \n     pub fn is_variant_uninhabited_from_all_modules(self,\n                                                    variant: &'tcx VariantDef,\n-                                                   substs: &'tcx Substs<'tcx>)\n+                                                   substs: SubstsRef<'tcx>)\n                                                    -> bool\n     {\n         !self.variant_inhabitedness_forest(variant, substs).is_empty()\n     }\n \n-    fn variant_inhabitedness_forest(self, variant: &'tcx VariantDef, substs: &'tcx Substs<'tcx>)\n+    fn variant_inhabitedness_forest(self, variant: &'tcx VariantDef, substs: SubstsRef<'tcx>)\n                                     -> DefIdForest {\n         // Determine the ADT kind:\n         let adt_def_id = self.adt_def_id_of_variant(variant);\n@@ -138,7 +138,7 @@ impl<'a, 'gcx, 'tcx> AdtDef {\n     fn uninhabited_from(\n         &self,\n         tcx: TyCtxt<'a, 'gcx, 'tcx>,\n-        substs: &'tcx Substs<'tcx>) -> DefIdForest\n+        substs: SubstsRef<'tcx>) -> DefIdForest\n     {\n         DefIdForest::intersection(tcx, self.variants.iter().map(|v| {\n             v.uninhabited_from(tcx, substs, self.adt_kind())\n@@ -151,7 +151,7 @@ impl<'a, 'gcx, 'tcx> VariantDef {\n     fn uninhabited_from(\n         &self,\n         tcx: TyCtxt<'a, 'gcx, 'tcx>,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         adt_kind: AdtKind) -> DefIdForest\n     {\n         let is_enum = match adt_kind {\n@@ -172,7 +172,7 @@ impl<'a, 'gcx, 'tcx> FieldDef {\n     fn uninhabited_from(\n         &self,\n         tcx: TyCtxt<'a, 'gcx, 'tcx>,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         is_enum: bool,\n     ) -> DefIdForest {\n         let data_uninhabitedness = move || {"}, {"sha": "709dce4589f6be0a77a033553ab3140e9be91772", "filename": "src/librustc/ty/instance.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Finstance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Finstance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Finstance.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -1,6 +1,6 @@\n use crate::hir::Unsafety;\n use crate::hir::def_id::DefId;\n-use crate::ty::{self, Ty, PolyFnSig, TypeFoldable, Substs, TyCtxt};\n+use crate::ty::{self, Ty, PolyFnSig, TypeFoldable, SubstsRef, TyCtxt};\n use crate::traits;\n use rustc_target::spec::abi::Abi;\n use crate::util::ppaux;\n@@ -11,7 +11,7 @@ use std::iter;\n #[derive(Copy, Clone, PartialEq, Eq, Hash, Debug, RustcEncodable, RustcDecodable)]\n pub struct Instance<'tcx> {\n     pub def: InstanceDef<'tcx>,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n }\n \n #[derive(Copy, Clone, PartialEq, Eq, Hash, Debug, RustcEncodable, RustcDecodable)]\n@@ -203,7 +203,7 @@ impl<'tcx> fmt::Display for Instance<'tcx> {\n }\n \n impl<'a, 'b, 'tcx> Instance<'tcx> {\n-    pub fn new(def_id: DefId, substs: &'tcx Substs<'tcx>)\n+    pub fn new(def_id: DefId, substs: SubstsRef<'tcx>)\n                -> Instance<'tcx> {\n         assert!(!substs.has_escaping_bound_vars(),\n                 \"substs of instance {:?} not normalized for codegen: {:?}\",\n@@ -241,7 +241,7 @@ impl<'a, 'b, 'tcx> Instance<'tcx> {\n     pub fn resolve(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                    param_env: ty::ParamEnv<'tcx>,\n                    def_id: DefId,\n-                   substs: &'tcx Substs<'tcx>) -> Option<Instance<'tcx>> {\n+                   substs: SubstsRef<'tcx>) -> Option<Instance<'tcx>> {\n         debug!(\"resolve(def_id={:?}, substs={:?})\", def_id, substs);\n         let result = if let Some(trait_def_id) = tcx.trait_of_item(def_id) {\n             debug!(\" => associated item, attempting to find impl in param_env {:#?}\", param_env);\n@@ -293,7 +293,7 @@ impl<'a, 'b, 'tcx> Instance<'tcx> {\n     pub fn resolve_for_vtable(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                               param_env: ty::ParamEnv<'tcx>,\n                               def_id: DefId,\n-                              substs: &'tcx Substs<'tcx>) -> Option<Instance<'tcx>> {\n+                              substs: SubstsRef<'tcx>) -> Option<Instance<'tcx>> {\n         debug!(\"resolve(def_id={:?}, substs={:?})\", def_id, substs);\n         let fn_sig = tcx.fn_sig(def_id);\n         let is_vtable_shim =\n@@ -338,7 +338,7 @@ fn resolve_associated_item<'a, 'tcx>(\n     trait_item: &ty::AssociatedItem,\n     param_env: ty::ParamEnv<'tcx>,\n     trait_id: DefId,\n-    rcvr_substs: &'tcx Substs<'tcx>,\n+    rcvr_substs: SubstsRef<'tcx>,\n ) -> Option<Instance<'tcx>> {\n     let def_id = trait_item.def_id;\n     debug!(\"resolve_associated_item(trait_item={:?}, \\"}, {"sha": "e098488824f3686f53747a1f131113776b3f63e6", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -22,7 +22,7 @@ use crate::session::CrateDisambiguator;\n use crate::traits::{self, Reveal};\n use crate::ty;\n use crate::ty::layout::VariantIdx;\n-use crate::ty::subst::{Subst, Substs};\n+use crate::ty::subst::{Subst, Substs, SubstsRef};\n use crate::ty::util::{IntTypeExt, Discr};\n use crate::ty::walk::TypeWalker;\n use crate::util::captures::Captures;\n@@ -1067,7 +1067,7 @@ pub enum Predicate<'tcx> {\n     Subtype(PolySubtypePredicate<'tcx>),\n \n     /// Constant initializer must evaluate successfully.\n-    ConstEvaluatable(DefId, &'tcx Substs<'tcx>),\n+    ConstEvaluatable(DefId, SubstsRef<'tcx>),\n }\n \n /// The crate outlives map is computed during typeck and contains the"}, {"sha": "0d3e9f7914ba7ac436fc1f3f7fca725888be89a1", "filename": "src/librustc/ty/query/config.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fquery%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fquery%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fconfig.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -9,7 +9,7 @@ use crate::traits::query::{\n     CanonicalTypeOpProvePredicateGoal, CanonicalTypeOpSubtypeGoal,\n };\n use crate::ty::{self, ParamEnvAnd, Ty, TyCtxt};\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n use crate::ty::query::queries;\n use crate::ty::query::Query;\n use crate::ty::query::QueryCache;\n@@ -914,7 +914,7 @@ impl<'tcx> QueryDescription<'tcx> for queries::optimized_mir<'tcx> {\n }\n \n impl<'tcx> QueryDescription<'tcx> for queries::substitute_normalize_and_test_predicates<'tcx> {\n-    fn describe(tcx: TyCtxt<'_, '_, '_>, key: (DefId, &'tcx Substs<'tcx>)) -> Cow<'static, str> {\n+    fn describe(tcx: TyCtxt<'_, '_, '_>, key: (DefId, SubstsRef<'tcx>)) -> Cow<'static, str> {\n         format!(\"testing substituted normalized predicates:`{}`\", tcx.item_path_str(key.0)).into()\n     }\n }"}, {"sha": "d353da801778d5999f6426caa0665af8da36bb6b", "filename": "src/librustc/ty/query/keys.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fquery%2Fkeys.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fquery%2Fkeys.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fkeys.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -4,7 +4,7 @@ use crate::infer::canonical::Canonical;\n use crate::hir::def_id::{CrateNum, DefId, LOCAL_CRATE, DefIndex};\n use crate::traits;\n use crate::ty::{self, Ty, TyCtxt};\n-use crate::ty::subst::Substs;\n+use crate::ty::subst::SubstsRef;\n use crate::ty::fast_reject::SimplifiedType;\n use crate::mir;\n \n@@ -109,7 +109,7 @@ impl Key for (DefId, SimplifiedType) {\n     }\n }\n \n-impl<'tcx> Key for (DefId, &'tcx Substs<'tcx>) {\n+impl<'tcx> Key for (DefId, SubstsRef<'tcx>) {\n     fn query_crate(&self) -> CrateNum {\n         self.0.krate\n     }"}, {"sha": "ee36a1af8f400f77e311a6428ff78bb1310b7ac6", "filename": "src/librustc/ty/query/mod.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -36,8 +36,8 @@ use crate::traits::specialization_graph;\n use crate::traits::Clauses;\n use crate::ty::{self, CrateInherentImpls, ParamEnvAnd, Ty, TyCtxt, AdtSizedConstraint};\n use crate::ty::steal::Steal;\n-use crate::ty::subst::Substs;\n use crate::ty::util::NeedsDrop;\n+use crate::ty::subst::SubstsRef;\n use crate::util::nodemap::{DefIdSet, DefIdMap, ItemLocalSet};\n use crate::util::common::{ErrorReported};\n use crate::util::profiling::ProfileCategory::*;\n@@ -393,7 +393,7 @@ define_queries! { <'tcx>\n \n     Other {\n         [] fn vtable_methods: vtable_methods_node(ty::PolyTraitRef<'tcx>)\n-                            -> Lrc<Vec<Option<(DefId, &'tcx Substs<'tcx>)>>>,\n+                            -> Lrc<Vec<Option<(DefId, SubstsRef<'tcx>)>>>,\n     },\n \n     Codegen {\n@@ -493,9 +493,9 @@ define_queries! { <'tcx>\n \n     Codegen {\n         [] fn upstream_monomorphizations: UpstreamMonomorphizations(CrateNum)\n-            -> Lrc<DefIdMap<Lrc<FxHashMap<&'tcx Substs<'tcx>, CrateNum>>>>,\n+            -> Lrc<DefIdMap<Lrc<FxHashMap<SubstsRef<'tcx>, CrateNum>>>>,\n         [] fn upstream_monomorphizations_for: UpstreamMonomorphizationsFor(DefId)\n-            -> Option<Lrc<FxHashMap<&'tcx Substs<'tcx>, CrateNum>>>,\n+            -> Option<Lrc<FxHashMap<SubstsRef<'tcx>, CrateNum>>>,\n     },\n \n     Other {\n@@ -714,7 +714,7 @@ define_queries! { <'tcx>\n         >,\n \n         [] fn substitute_normalize_and_test_predicates:\n-            substitute_normalize_and_test_predicates_node((DefId, &'tcx Substs<'tcx>)) -> bool,\n+            substitute_normalize_and_test_predicates_node((DefId, SubstsRef<'tcx>)) -> bool,\n \n         [] fn method_autoderef_steps: MethodAutoderefSteps(\n             CanonicalTyGoal<'tcx>\n@@ -906,7 +906,7 @@ fn vtable_methods_node<'tcx>(trait_ref: ty::PolyTraitRef<'tcx>) -> DepConstructo\n     DepConstructor::VtableMethods{ trait_ref }\n }\n \n-fn substitute_normalize_and_test_predicates_node<'tcx>(key: (DefId, &'tcx Substs<'tcx>))\n+fn substitute_normalize_and_test_predicates_node<'tcx>(key: (DefId, SubstsRef<'tcx>))\n                                             -> DepConstructor<'tcx> {\n     DepConstructor::SubstituteNormalizeAndTestPredicates { key }\n }"}, {"sha": "b15aa8629016641cc7b68b5022953e847ea37c2f", "filename": "src/librustc/ty/relate.rs", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Frelate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Frelate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Frelate.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -5,7 +5,7 @@\n //! subtyping, type equality, etc.\n \n use crate::hir::def_id::DefId;\n-use crate::ty::subst::{Kind, UnpackedKind, Substs};\n+use crate::ty::subst::{Kind, UnpackedKind, SubstsRef};\n use crate::ty::{self, Ty, TyCtxt, TypeFoldable};\n use crate::ty::error::{ExpectedFound, TypeError};\n use crate::mir::interpret::GlobalId;\n@@ -50,9 +50,9 @@ pub trait TypeRelation<'a, 'gcx: 'a+'tcx, 'tcx: 'a> : Sized {\n     /// accordingly.\n     fn relate_item_substs(&mut self,\n                           item_def_id: DefId,\n-                          a_subst: &'tcx Substs<'tcx>,\n-                          b_subst: &'tcx Substs<'tcx>)\n-                          -> RelateResult<'tcx, &'tcx Substs<'tcx>>\n+                          a_subst: SubstsRef<'tcx>,\n+                          b_subst: SubstsRef<'tcx>)\n+                          -> RelateResult<'tcx, SubstsRef<'tcx>>\n     {\n         debug!(\"relate_item_substs(item_def_id={:?}, a_subst={:?}, b_subst={:?})\",\n                item_def_id,\n@@ -123,9 +123,9 @@ impl<'tcx> Relate<'tcx> for ty::TypeAndMut<'tcx> {\n \n pub fn relate_substs<'a, 'gcx, 'tcx, R>(relation: &mut R,\n                                         variances: Option<&Vec<ty::Variance>>,\n-                                        a_subst: &'tcx Substs<'tcx>,\n-                                        b_subst: &'tcx Substs<'tcx>)\n-                                        -> RelateResult<'tcx, &'tcx Substs<'tcx>>\n+                                        a_subst: SubstsRef<'tcx>,\n+                                        b_subst: SubstsRef<'tcx>)\n+                                        -> RelateResult<'tcx, SubstsRef<'tcx>>\n     where R: TypeRelation<'a, 'gcx, 'tcx>, 'gcx: 'a+'tcx, 'tcx: 'a\n {\n     let tcx = relation.tcx();\n@@ -624,11 +624,11 @@ impl<'tcx> Relate<'tcx> for ty::GeneratorSubsts<'tcx> {\n     }\n }\n \n-impl<'tcx> Relate<'tcx> for &'tcx Substs<'tcx> {\n+impl<'tcx> Relate<'tcx> for SubstsRef<'tcx> {\n     fn relate<'a, 'gcx, R>(relation: &mut R,\n-                           a: &&'tcx Substs<'tcx>,\n-                           b: &&'tcx Substs<'tcx>)\n-                           -> RelateResult<'tcx, &'tcx Substs<'tcx>>\n+                           a: &SubstsRef<'tcx>,\n+                           b: &SubstsRef<'tcx>)\n+                           -> RelateResult<'tcx, SubstsRef<'tcx>>\n         where R: TypeRelation<'a, 'gcx, 'tcx>, 'gcx: 'a+'tcx, 'tcx: 'a\n     {\n         relate_substs(relation, None, a, b)"}, {"sha": "31399fbab0a37fc9efdceda1ff8d5535434e314e", "filename": "src/librustc/ty/sty.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fsty.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -7,7 +7,7 @@ use crate::mir::interpret::{ConstValue, truncate};\n use crate::middle::region;\n use polonius_engine::Atom;\n use rustc_data_structures::indexed_vec::Idx;\n-use crate::ty::subst::{Substs, Subst, Kind, UnpackedKind};\n+use crate::ty::subst::{Substs, Subst, SubstsRef, Kind, UnpackedKind};\n use crate::ty::{self, AdtDef, TypeFlags, Ty, TyCtxt, TypeFoldable};\n use crate::ty::{List, TyS, ParamEnvAnd, ParamEnv};\n use crate::util::captures::Captures;\n@@ -105,7 +105,7 @@ pub enum TyKind<'tcx> {\n     /// That is, even after substitution it is possible that there are type\n     /// variables. This happens when the `Adt` corresponds to an ADT\n     /// definition and not a concrete use of it.\n-    Adt(&'tcx AdtDef, &'tcx Substs<'tcx>),\n+    Adt(&'tcx AdtDef, SubstsRef<'tcx>),\n \n     /// An unsized FFI type that is opaque to Rust. Written as `extern type T`.\n     Foreign(DefId),\n@@ -136,7 +136,7 @@ pub enum TyKind<'tcx> {\n     /// fn foo() -> i32 { 1 }\n     /// let bar = foo; // bar: fn() -> i32 {foo}\n     /// ```\n-    FnDef(DefId, &'tcx Substs<'tcx>),\n+    FnDef(DefId, SubstsRef<'tcx>),\n \n     /// A pointer to a function. Written as `fn() -> i32`.\n     ///\n@@ -184,7 +184,7 @@ pub enum TyKind<'tcx> {\n     /// * or the `existential type` declaration\n     /// The substitutions are for the generics of the function in question.\n     /// After typeck, the concrete type can be found in the `types` map.\n-    Opaque(DefId, &'tcx Substs<'tcx>),\n+    Opaque(DefId, SubstsRef<'tcx>),\n \n     /// A type parameter; for example, `T` in `fn f<T>(x: T) {}\n     Param(ParamTy),\n@@ -309,7 +309,7 @@ pub struct ClosureSubsts<'tcx> {\n     ///\n     /// These are separated out because codegen wants to pass them around\n     /// when monomorphizing.\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n }\n \n /// Struct returned by `split()`. Note that these are subslices of the\n@@ -387,7 +387,7 @@ impl<'tcx> ClosureSubsts<'tcx> {\n \n #[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord, Hash, Debug, RustcEncodable, RustcDecodable)]\n pub struct GeneratorSubsts<'tcx> {\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n }\n \n struct SplitGeneratorSubsts<'tcx> {\n@@ -672,11 +672,11 @@ impl<'tcx> Binder<&'tcx List<ExistentialPredicate<'tcx>>> {\n #[derive(Copy, Clone, PartialEq, Eq, Hash, RustcEncodable, RustcDecodable)]\n pub struct TraitRef<'tcx> {\n     pub def_id: DefId,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n }\n \n impl<'tcx> TraitRef<'tcx> {\n-    pub fn new(def_id: DefId, substs: &'tcx Substs<'tcx>) -> TraitRef<'tcx> {\n+    pub fn new(def_id: DefId, substs: SubstsRef<'tcx>) -> TraitRef<'tcx> {\n         TraitRef { def_id: def_id, substs: substs }\n     }\n \n@@ -742,7 +742,7 @@ impl<'tcx> PolyTraitRef<'tcx> {\n #[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord, Hash, RustcEncodable, RustcDecodable)]\n pub struct ExistentialTraitRef<'tcx> {\n     pub def_id: DefId,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n }\n \n impl<'a, 'gcx, 'tcx> ExistentialTraitRef<'tcx> {\n@@ -915,7 +915,7 @@ impl<T> Binder<T> {\n #[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord, Hash, Debug, RustcEncodable, RustcDecodable)]\n pub struct ProjectionTy<'tcx> {\n     /// The parameters of the associated item.\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n \n     /// The `DefId` of the `TraitItem` for the associated type `N`.\n     ///\n@@ -1297,7 +1297,7 @@ impl From<BoundVar> for BoundTy {\n #[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash, Debug, RustcEncodable, RustcDecodable)]\n pub struct ExistentialProjection<'tcx> {\n     pub item_def_id: DefId,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n     pub ty: Ty<'tcx>,\n }\n \n@@ -2060,7 +2060,7 @@ impl<'a, 'gcx, 'tcx> TyS<'tcx> {\n /// Used in the HIR by using `Unevaluated` everywhere and later normalizing to `Evaluated` if the\n /// code is monomorphic enough for that.\n pub enum LazyConst<'tcx> {\n-    Unevaluated(DefId, &'tcx Substs<'tcx>),\n+    Unevaluated(DefId, SubstsRef<'tcx>),\n     Evaluated(Const<'tcx>),\n }\n "}, {"sha": "0e033b116a2ac76e413bf2dde8e6bdd33499ee33", "filename": "src/librustc/ty/subst.rs", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fsubst.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Fsubst.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fsubst.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -159,10 +159,12 @@ impl<'tcx> Decodable for Kind<'tcx> {\n /// A substitution mapping generic parameters to new values.\n pub type Substs<'tcx> = List<Kind<'tcx>>;\n \n+pub type SubstsRef<'tcx> = &'tcx Substs<'tcx>;\n+\n impl<'a, 'gcx, 'tcx> Substs<'tcx> {\n     /// Creates a `Substs` that maps each generic parameter to itself.\n     pub fn identity_for_item(tcx: TyCtxt<'a, 'gcx, 'tcx>, def_id: DefId)\n-                             -> &'tcx Substs<'tcx> {\n+                             -> SubstsRef<'tcx> {\n         Substs::for_item(tcx, def_id, |param, _| {\n             tcx.mk_param_from_def(param)\n         })\n@@ -175,7 +177,7 @@ impl<'a, 'gcx, 'tcx> Substs<'tcx> {\n     pub fn bound_vars_for_item(\n         tcx: TyCtxt<'a, 'gcx, 'tcx>,\n         def_id: DefId\n-    ) -> &'tcx Substs<'tcx> {\n+    ) -> SubstsRef<'tcx> {\n         Substs::for_item(tcx, def_id, |param, _| {\n             match param.kind {\n                 ty::GenericParamDefKind::Type { .. } => {\n@@ -205,7 +207,7 @@ impl<'a, 'gcx, 'tcx> Substs<'tcx> {\n     pub fn for_item<F>(tcx: TyCtxt<'a, 'gcx, 'tcx>,\n                        def_id: DefId,\n                        mut mk_kind: F)\n-                       -> &'tcx Substs<'tcx>\n+                       -> SubstsRef<'tcx>\n     where F: FnMut(&ty::GenericParamDef, &[Kind<'tcx>]) -> Kind<'tcx>\n     {\n         let defs = tcx.generics_of(def_id);\n@@ -219,7 +221,7 @@ impl<'a, 'gcx, 'tcx> Substs<'tcx> {\n                         tcx: TyCtxt<'a, 'gcx, 'tcx>,\n                         def_id: DefId,\n                         mut mk_kind: F)\n-                        -> &'tcx Substs<'tcx>\n+                        -> SubstsRef<'tcx>\n     where F: FnMut(&ty::GenericParamDef, &[Kind<'tcx>]) -> Kind<'tcx>\n     {\n         Substs::for_item(tcx, def_id, |param, substs| {\n@@ -312,18 +314,18 @@ impl<'a, 'gcx, 'tcx> Substs<'tcx> {\n     pub fn rebase_onto(&self, tcx: TyCtxt<'a, 'gcx, 'tcx>,\n                        source_ancestor: DefId,\n                        target_substs: &Substs<'tcx>)\n-                       -> &'tcx Substs<'tcx> {\n+                       -> SubstsRef<'tcx> {\n         let defs = tcx.generics_of(source_ancestor);\n         tcx.mk_substs(target_substs.iter().chain(&self[defs.params.len()..]).cloned())\n     }\n \n     pub fn truncate_to(&self, tcx: TyCtxt<'a, 'gcx, 'tcx>, generics: &ty::Generics)\n-                       -> &'tcx Substs<'tcx> {\n+                       -> SubstsRef<'tcx> {\n         tcx.mk_substs(self.iter().take(generics.count()).cloned())\n     }\n }\n \n-impl<'tcx> TypeFoldable<'tcx> for &'tcx Substs<'tcx> {\n+impl<'tcx> TypeFoldable<'tcx> for SubstsRef<'tcx> {\n     fn super_fold_with<'gcx: 'tcx, F: TypeFolder<'gcx, 'tcx>>(&self, folder: &mut F) -> Self {\n         let params: SmallVec<[_; 8]> = self.iter().map(|k| k.fold_with(folder)).collect();\n \n@@ -341,7 +343,7 @@ impl<'tcx> TypeFoldable<'tcx> for &'tcx Substs<'tcx> {\n     }\n }\n \n-impl<'tcx> serialize::UseSpecializedDecodable for &'tcx Substs<'tcx> {}\n+impl<'tcx> serialize::UseSpecializedDecodable for SubstsRef<'tcx> {}\n \n ///////////////////////////////////////////////////////////////////////////\n // Public trait `Subst`\n@@ -563,7 +565,7 @@ pub type CanonicalUserSubsts<'tcx> = Canonical<'tcx, UserSubsts<'tcx>>;\n #[derive(Copy, Clone, Debug, PartialEq, Eq, Hash, RustcEncodable, RustcDecodable)]\n pub struct UserSubsts<'tcx> {\n     /// The substitutions for the item as given by the user.\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n \n     /// The self type, in the case of a `<T>::Item` path (when applied\n     /// to an inherent impl). See `UserSelfTy` below."}, {"sha": "a7b08072492526cedd5e3689008724707c532438", "filename": "src/librustc/ty/util.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc%2Fty%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Futil.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -7,7 +7,7 @@ use crate::hir::{self, Node};\n use crate::ich::NodeIdHashingMode;\n use crate::traits::{self, ObligationCause};\n use crate::ty::{self, Ty, TyCtxt, GenericParamDefKind, TypeFoldable};\n-use crate::ty::subst::{Subst, Substs, UnpackedKind};\n+use crate::ty::subst::{Subst, Substs, SubstsRef, UnpackedKind};\n use crate::ty::query::TyCtxtAt;\n use crate::ty::TyKind::*;\n use crate::ty::layout::{Integer, IntegerExt};\n@@ -588,7 +588,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n \n     /// Given the `DefId` of some item that has no type parameters, make\n     /// a suitable \"empty substs\" for it.\n-    pub fn empty_substs_for_def_id(self, item_def_id: DefId) -> &'tcx Substs<'tcx> {\n+    pub fn empty_substs_for_def_id(self, item_def_id: DefId) -> SubstsRef<'tcx> {\n         Substs::for_item(self, item_def_id, |param, _| {\n             match param.kind {\n                 GenericParamDefKind::Lifetime => self.types.re_erased.into(),\n@@ -633,7 +633,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     pub fn try_expand_impl_trait_type(\n         self,\n         def_id: DefId,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n     ) -> Result<Ty<'tcx>, Ty<'tcx>> {\n         use crate::ty::fold::TypeFolder;\n \n@@ -652,7 +652,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n             fn expand_opaque_ty(\n                 &mut self,\n                 def_id: DefId,\n-                substs: &'tcx Substs<'tcx>,\n+                substs: SubstsRef<'tcx>,\n             ) -> Option<Ty<'tcx>> {\n                 if self.found_recursion {\n                     None"}, {"sha": "4b01e264f19eda5b38951da3aae6e105e548e569", "filename": "src/librustc_codegen_ssa/back/symbol_export.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_ssa%2Fback%2Fsymbol_export.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_ssa%2Fback%2Fsymbol_export.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Fsymbol_export.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -11,7 +11,7 @@ use rustc::middle::exported_symbols::{SymbolExportLevel, ExportedSymbol, metadat\n use rustc::session::config;\n use rustc::ty::{TyCtxt, SymbolName};\n use rustc::ty::query::Providers;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::util::nodemap::{FxHashMap, DefIdMap};\n use rustc_allocator::ALLOCATOR_METHODS;\n use rustc_data_structures::indexed_vec::IndexVec;\n@@ -282,7 +282,7 @@ fn exported_symbols_provider_local<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n fn upstream_monomorphizations_provider<'a, 'tcx>(\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     cnum: CrateNum)\n-    -> Lrc<DefIdMap<Lrc<FxHashMap<&'tcx Substs<'tcx>, CrateNum>>>>\n+    -> Lrc<DefIdMap<Lrc<FxHashMap<SubstsRef<'tcx>, CrateNum>>>>\n {\n     debug_assert!(cnum == LOCAL_CRATE);\n \n@@ -334,7 +334,7 @@ fn upstream_monomorphizations_provider<'a, 'tcx>(\n fn upstream_monomorphizations_for_provider<'a, 'tcx>(\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     def_id: DefId)\n-    -> Option<Lrc<FxHashMap<&'tcx Substs<'tcx>, CrateNum>>>\n+    -> Option<Lrc<FxHashMap<SubstsRef<'tcx>, CrateNum>>>\n {\n     debug_assert!(!def_id.is_local());\n     tcx.upstream_monomorphizations(LOCAL_CRATE)"}, {"sha": "4744dd6302fb3200f1527371a04f35d19eaa598c", "filename": "src/librustc_codegen_ssa/callee.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_ssa%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_ssa%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fcallee.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -1,12 +1,12 @@\n use crate::traits::*;\n use rustc::ty;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::hir::def_id::DefId;\n \n pub fn resolve_and_get_fn<'tcx, Cx: CodegenMethods<'tcx>>(\n     cx: &Cx,\n     def_id: DefId,\n-    substs: &'tcx Substs<'tcx>,\n+    substs: SubstsRef<'tcx>,\n ) -> Cx::Value {\n     cx.get_fn(\n         ty::Instance::resolve(\n@@ -23,7 +23,7 @@ pub fn resolve_and_get_fn_for_vtable<'tcx,\n >(\n     cx: &Cx,\n     def_id: DefId,\n-    substs: &'tcx Substs<'tcx>,\n+    substs: SubstsRef<'tcx>,\n ) -> Cx::Value {\n     cx.get_fn(\n         ty::Instance::resolve_for_vtable("}, {"sha": "e1528921a596218f4adc04f68cc14648bf95f1a4", "filename": "src/librustc_codegen_ssa/mir/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -2,7 +2,7 @@ use libc::c_uint;\n use rustc::ty::{self, Ty, TypeFoldable, UpvarSubsts};\n use rustc::ty::layout::{TyLayout, HasTyCtxt};\n use rustc::mir::{self, Mir};\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::session::config::DebugInfo;\n use rustc_mir::monomorphize::Instance;\n use rustc_target::abi::call::{FnType, PassMode};\n@@ -85,7 +85,7 @@ pub struct FunctionCx<'a, 'tcx: 'a, Bx: BuilderMethods<'a, 'tcx>> {\n     scopes: IndexVec<mir::SourceScope, debuginfo::MirDebugScope<Bx::DIScope>>,\n \n     /// If this function is being monomorphized, this contains the type substitutions used.\n-    param_substs: &'tcx Substs<'tcx>,\n+    param_substs: SubstsRef<'tcx>,\n }\n \n impl<'a, 'tcx: 'a, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {"}, {"sha": "f529cf30a62ea604ada3e4d05ef21304a820f28f", "filename": "src/librustc_codegen_utils/symbol_names.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -94,7 +94,7 @@ use rustc::hir::map::definitions::DefPathData;\n use rustc::ich::NodeIdHashingMode;\n use rustc::ty::item_path::{self, ItemPathBuffer, RootMode};\n use rustc::ty::query::Providers;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::{self, Ty, TyCtxt, TypeFoldable};\n use rustc::util::common::record_time;\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n@@ -134,7 +134,7 @@ fn get_symbol_hash<'a, 'tcx>(\n \n     // values for generic type parameters,\n     // if any.\n-    substs: &'tcx Substs<'tcx>,\n+    substs: SubstsRef<'tcx>,\n ) -> u64 {\n     debug!(\n         \"get_symbol_hash(def_id={:?}, parameters={:?})\","}, {"sha": "a56c3215f9d69f4b10ff8ecad840556201b808d8", "filename": "src/librustc_lint/types.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_lint%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_lint%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Ftypes.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -1,7 +1,7 @@\n #![allow(non_snake_case)]\n \n use rustc::hir::Node;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::{self, AdtKind, ParamEnv, Ty, TyCtxt};\n use rustc::ty::layout::{self, IntegerExt, LayoutOf, VariantIdx};\n use rustc::{lint, util};\n@@ -445,7 +445,7 @@ enum FfiResult<'tcx> {\n /// FIXME: This duplicates code in codegen.\n fn is_repr_nullable_ptr<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                                   def: &'tcx ty::AdtDef,\n-                                  substs: &Substs<'tcx>)\n+                                  substs: SubstsRef<'tcx>)\n                                   -> bool {\n     if def.variants.len() == 2 {\n         let data_idx;"}, {"sha": "9eb09b514741cb2730acf0b84ba62a7c1866d868", "filename": "src/librustc_mir/borrow_check/nll/constraint_generation.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fconstraint_generation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fconstraint_generation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fconstraint_generation.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -10,8 +10,8 @@ use rustc::mir::{BasicBlock, BasicBlockData, Location, Mir, Place, Rvalue};\n use rustc::mir::{SourceInfo, Statement, Terminator};\n use rustc::mir::UserTypeProjection;\n use rustc::ty::fold::TypeFoldable;\n-use rustc::ty::subst::Substs;\n use rustc::ty::{self, ClosureSubsts, GeneratorSubsts, RegionVid};\n+use rustc::ty::subst::SubstsRef;\n \n pub(super) fn generate_constraints<'cx, 'gcx, 'tcx>(\n     infcx: &InferCtxt<'cx, 'gcx, 'tcx>,\n@@ -50,7 +50,7 @@ impl<'cg, 'cx, 'gcx, 'tcx> Visitor<'tcx> for ConstraintGeneration<'cg, 'cx, 'gcx\n \n     /// We sometimes have `substs` within an rvalue, or within a\n     /// call. Make them live at the location where they appear.\n-    fn visit_substs(&mut self, substs: &&'tcx Substs<'tcx>, location: Location) {\n+    fn visit_substs(&mut self, substs: &SubstsRef<'tcx>, location: Location) {\n         self.add_regular_live_constraint(*substs, location);\n         self.super_substs(substs);\n     }"}, {"sha": "cc01f632e075cac4210a3b0b40c7169058a55d66", "filename": "src/librustc_mir/borrow_check/nll/region_infer/error_reporting/region_name.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -6,7 +6,7 @@ use rustc::hir;\n use rustc::hir::def_id::DefId;\n use rustc::infer::InferCtxt;\n use rustc::mir::Mir;\n-use rustc::ty::subst::{Substs, UnpackedKind};\n+use rustc::ty::subst::{SubstsRef, UnpackedKind};\n use rustc::ty::{self, RegionKind, RegionVid, Ty, TyCtxt};\n use rustc::util::ppaux::RegionHighlightMode;\n use rustc_errors::DiagnosticBuilder;\n@@ -541,7 +541,7 @@ impl<'tcx> RegionInferenceContext<'tcx> {\n     /// types+hir to search through).\n     fn match_adt_and_segment<'hir>(\n         &self,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         needle_fr: RegionVid,\n         last_segment: &'hir hir::PathSegment,\n         counter: &mut usize,\n@@ -587,7 +587,7 @@ impl<'tcx> RegionInferenceContext<'tcx> {\n     /// `search_stack` the types+hir to search through.\n     fn try_match_adt_and_generic_args<'hir>(\n         &self,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         needle_fr: RegionVid,\n         args: &'hir hir::GenericArgs,\n         search_stack: &mut Vec<(Ty<'tcx>, &'hir hir::Ty)>,"}, {"sha": "eab9e0ae171ed229c8b14a4bd5f326634dcfaeea", "filename": "src/librustc_mir/borrow_check/nll/renumber.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Frenumber.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Frenumber.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Frenumber.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -1,4 +1,4 @@\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::{self, ClosureSubsts, GeneratorSubsts, Ty, TypeFoldable};\n use rustc::mir::{Location, Mir};\n use rustc::mir::visit::{MutVisitor, TyContext};\n@@ -55,7 +55,7 @@ impl<'a, 'gcx, 'tcx> MutVisitor<'tcx> for NLLVisitor<'a, 'gcx, 'tcx> {\n         debug!(\"visit_ty: ty={:?}\", ty);\n     }\n \n-    fn visit_substs(&mut self, substs: &mut &'tcx Substs<'tcx>, location: Location) {\n+    fn visit_substs(&mut self, substs: &mut SubstsRef<'tcx>, location: Location) {\n         debug!(\"visit_substs(substs={:?}, location={:?})\", substs, location);\n \n         *substs = self.renumber_regions(&{ *substs });"}, {"sha": "4202d10aa63d0cc790c1d22ad3da7a2fc0a0208b", "filename": "src/librustc_mir/borrow_check/nll/type_check/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -36,7 +36,7 @@ use rustc::traits::query::type_op::custom::CustomTypeOp;\n use rustc::traits::query::{Fallible, NoSolution};\n use rustc::traits::{ObligationCause, PredicateObligations};\n use rustc::ty::fold::TypeFoldable;\n-use rustc::ty::subst::{Subst, Substs, UnpackedKind, UserSubsts};\n+use rustc::ty::subst::{Subst, SubstsRef, UnpackedKind, UserSubsts};\n use rustc::ty::{\n     self, RegionVid, ToPolyTraitRef, Ty, TyCtxt, TyKind, UserType,\n     CanonicalUserTypeAnnotation, UserTypeAnnotationIndex,\n@@ -2261,7 +2261,7 @@ impl<'a, 'gcx, 'tcx> TypeChecker<'a, 'gcx, 'tcx> {\n         &mut self,\n         tcx: TyCtxt<'a, 'gcx, 'tcx>,\n         def_id: DefId,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         location: Location,\n     ) -> ty::InstantiatedPredicates<'tcx> {\n         if let Some(closure_region_requirements) = tcx.mir_borrowck(def_id).closure_requirements {"}, {"sha": "b418d608f080bfcdd5ebd215ffd631cc69df5477", "filename": "src/librustc_mir/borrow_check/nll/universal_regions.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Funiversal_regions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Funiversal_regions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Funiversal_regions.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -17,7 +17,7 @@ use rustc::hir::def_id::DefId;\n use rustc::hir::{self, BodyOwnerKind, HirId};\n use rustc::infer::{InferCtxt, NLLRegionVariableOrigin};\n use rustc::ty::fold::TypeFoldable;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::{Substs, SubstsRef};\n use rustc::ty::{self, ClosureSubsts, GeneratorSubsts, RegionVid, Ty, TyCtxt};\n use rustc::util::nodemap::FxHashMap;\n use rustc_data_structures::indexed_vec::{Idx, IndexVec};\n@@ -94,12 +94,12 @@ pub enum DefiningTy<'tcx> {\n \n     /// The MIR is a fn item with the given `DefId` and substs. The signature\n     /// of the function can be bound then with the `fn_sig` query.\n-    FnDef(DefId, &'tcx Substs<'tcx>),\n+    FnDef(DefId, SubstsRef<'tcx>),\n \n     /// The MIR represents some form of constant. The signature then\n     /// is that it has no inputs and a single return value, which is\n     /// the value of the constant.\n-    Const(DefId, &'tcx Substs<'tcx>),\n+    Const(DefId, SubstsRef<'tcx>),\n }\n \n impl<'tcx> DefiningTy<'tcx> {\n@@ -222,7 +222,7 @@ impl<'tcx> UniversalRegions<'tcx> {\n     /// `V[1]: V[2]`.\n     pub fn closure_mapping(\n         tcx: TyCtxt<'_, '_, 'tcx>,\n-        closure_substs: &'tcx Substs<'tcx>,\n+        closure_substs: SubstsRef<'tcx>,\n         expected_num_vars: usize,\n         closure_base_def_id: DefId,\n     ) -> IndexVec<RegionVid, ty::Region<'tcx>> {"}, {"sha": "19507c900da6442fd83935790452e04f1bd0fcf8", "filename": "src/librustc_mir/build/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -12,7 +12,7 @@ use rustc::middle::region;\n use rustc::mir::*;\n use rustc::mir::visit::{MutVisitor, TyContext};\n use rustc::ty::{self, Ty, TyCtxt};\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::util::nodemap::NodeMap;\n use rustc_target::spec::PanicStrategy;\n use rustc_data_structures::indexed_vec::{IndexVec, Idx};\n@@ -212,7 +212,7 @@ impl<'a, 'gcx: 'tcx, 'tcx> MutVisitor<'tcx> for GlobalizeMir<'a, 'gcx> {\n         }\n     }\n \n-    fn visit_substs(&mut self, substs: &mut &'tcx Substs<'tcx>, _: Location) {\n+    fn visit_substs(&mut self, substs: &mut SubstsRef<'tcx>, _: Location) {\n         if let Some(lifted) = self.tcx.lift(substs) {\n             *substs = lifted;\n         } else {"}, {"sha": "c32a4fc3820fc17f0fa463867db5946051b4789f", "filename": "src/librustc_mir/hair/cx/expr.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -9,6 +9,7 @@ use rustc::mir::interpret::{GlobalId, ErrorHandled};\n use rustc::ty::{self, AdtKind, Ty};\n use rustc::ty::adjustment::{Adjustment, Adjust, AutoBorrow, AutoBorrowMutability};\n use rustc::ty::cast::CastKind as TyCastKind;\n+use rustc::ty::subst::{Substs, SubstsRef};\n use rustc::hir;\n use rustc::hir::def_id::LocalDefId;\n use rustc::mir::BorrowKind;\n@@ -834,7 +835,7 @@ fn method_callee<'a, 'gcx, 'tcx>(\n     cx: &mut Cx<'a, 'gcx, 'tcx>,\n     expr: &hir::Expr,\n     span: Span,\n-    overloaded_callee: Option<(DefId, &'tcx Substs<'tcx>)>,\n+    overloaded_callee: Option<(DefId, SubstsRef<'tcx>)>,\n ) -> Expr<'tcx> {\n     let temp_lifetime = cx.region_scope_tree.temporary_scope(expr.hir_id.local_id);\n     let (def_id, substs, user_ty) = match overloaded_callee {\n@@ -1133,7 +1134,7 @@ fn overloaded_place<'a, 'gcx, 'tcx>(\n     cx: &mut Cx<'a, 'gcx, 'tcx>,\n     expr: &'tcx hir::Expr,\n     place_ty: Ty<'tcx>,\n-    overloaded_callee: Option<(DefId, &'tcx Substs<'tcx>)>,\n+    overloaded_callee: Option<(DefId, SubstsRef<'tcx>)>,\n     args: Vec<ExprRef<'tcx>>,\n ) -> ExprKind<'tcx> {\n     // For an overloaded *x or x[y] expression of type T, the method"}, {"sha": "2efdacd7622c91868e2851f4afcc8a712f4864d8", "filename": "src/librustc_mir/hair/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -8,7 +8,7 @@ use rustc::mir::{BinOp, BorrowKind, Field, UnOp};\n use rustc::hir::def_id::DefId;\n use rustc::infer::canonical::Canonical;\n use rustc::middle::region;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::{AdtDef, UpvarSubsts, Ty, Const, LazyConst, UserType};\n use rustc::ty::layout::VariantIdx;\n use rustc::hir;\n@@ -261,7 +261,7 @@ pub enum ExprKind<'tcx> {\n     Adt {\n         adt_def: &'tcx AdtDef,\n         variant_index: VariantIdx,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n \n         /// Optional user-given substs: for something like `let x =\n         /// Bar::<T> { ... }`."}, {"sha": "085ac67cfb74ae1d694fc48fb054402c104038e1", "filename": "src/librustc_mir/hair/pattern/check_match.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -11,7 +11,7 @@ use rustc::middle::mem_categorization::cmt_;\n use rustc::middle::region;\n use rustc::session::Session;\n use rustc::ty::{self, Ty, TyCtxt};\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::{Substs, SubstsRef};\n use rustc::lint;\n use rustc_errors::{Applicability, DiagnosticBuilder};\n use rustc::util::common::ErrorReported;\n@@ -64,7 +64,7 @@ struct MatchVisitor<'a, 'tcx: 'a> {\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     tables: &'a ty::TypeckTables<'tcx>,\n     param_env: ty::ParamEnv<'tcx>,\n-    identity_substs: &'tcx Substs<'tcx>,\n+    identity_substs: SubstsRef<'tcx>,\n     region_scope_tree: &'a region::ScopeTree,\n }\n "}, {"sha": "c234c2474ff1bfc079869ff22c0792a865ed2454", "filename": "src/librustc_mir/hair/pattern/mod.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -16,7 +16,7 @@ use rustc::mir::{UserTypeProjection};\n use rustc::mir::interpret::{Scalar, GlobalId, ConstValue, sign_extend};\n use rustc::ty::{self, Region, TyCtxt, AdtDef, Ty, Lift, UserType};\n use rustc::ty::{CanonicalUserType, CanonicalUserTypeAnnotation, CanonicalUserTypeAnnotations};\n-use rustc::ty::subst::{Substs, Kind};\n+use rustc::ty::subst::{SubstsRef, Kind};\n use rustc::ty::layout::VariantIdx;\n use rustc::hir::{self, PatKind, RangeEnd};\n use rustc::hir::def::{Def, CtorKind};\n@@ -135,7 +135,7 @@ pub enum PatternKind<'tcx> {\n     /// multiple variants.\n     Variant {\n         adt_def: &'tcx AdtDef,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         variant_index: VariantIdx,\n         subpatterns: Vec<FieldPattern<'tcx>>,\n     },\n@@ -330,13 +330,13 @@ pub struct PatternContext<'a, 'tcx: 'a> {\n     pub tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     pub param_env: ty::ParamEnv<'tcx>,\n     pub tables: &'a ty::TypeckTables<'tcx>,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n     pub errors: Vec<PatternError>,\n }\n \n impl<'a, 'tcx> Pattern<'tcx> {\n     pub fn from_hir(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n-                    param_env_and_substs: ty::ParamEnvAnd<'tcx, &'tcx Substs<'tcx>>,\n+                    param_env_and_substs: ty::ParamEnvAnd<'tcx, SubstsRef<'tcx>>,\n                     tables: &'a ty::TypeckTables<'tcx>,\n                     pat: &'tcx hir::Pat) -> Self {\n         let mut pcx = PatternContext::new(tcx, param_env_and_substs, tables);\n@@ -352,7 +352,7 @@ impl<'a, 'tcx> Pattern<'tcx> {\n \n impl<'a, 'tcx> PatternContext<'a, 'tcx> {\n     pub fn new(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n-               param_env_and_substs: ty::ParamEnvAnd<'tcx, &'tcx Substs<'tcx>>,\n+               param_env_and_substs: ty::ParamEnvAnd<'tcx, SubstsRef<'tcx>>,\n                tables: &'a ty::TypeckTables<'tcx>) -> Self {\n         PatternContext {\n             tcx,\n@@ -1093,7 +1093,7 @@ macro_rules! CloneImpls {\n CloneImpls!{ <'tcx>\n     Span, Field, Mutability, ast::Name, ast::NodeId, usize, ty::Const<'tcx>,\n     Region<'tcx>, Ty<'tcx>, BindingMode, &'tcx AdtDef,\n-    &'tcx Substs<'tcx>, &'tcx Kind<'tcx>, UserType<'tcx>,\n+    SubstsRef<'tcx>, &'tcx Kind<'tcx>, UserType<'tcx>,\n     UserTypeProjection<'tcx>, PatternTypeProjection<'tcx>\n }\n "}, {"sha": "8a32c3b636c71242eea742f4e549e5a196e5d771", "filename": "src/librustc_mir/interpret/eval_context.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Finterpret%2Feval_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Finterpret%2Feval_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Feval_context.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -9,7 +9,7 @@ use rustc::mir;\n use rustc::ty::layout::{\n     self, Size, Align, HasDataLayout, LayoutOf, TyLayout\n };\n-use rustc::ty::subst::{Subst, Substs};\n+use rustc::ty::subst::{Subst, SubstsRef};\n use rustc::ty::{self, Ty, TyCtxt, TypeFoldable};\n use rustc::ty::query::TyCtxtAt;\n use rustc_data_structures::indexed_vec::IndexVec;\n@@ -244,7 +244,7 @@ impl<'a, 'mir, 'tcx: 'mir, M: Machine<'a, 'mir, 'tcx>> EvalContext<'a, 'mir, 'tc\n     pub(super) fn resolve(\n         &self,\n         def_id: DefId,\n-        substs: &'tcx Substs<'tcx>\n+        substs: SubstsRef<'tcx>\n     ) -> EvalResult<'tcx, ty::Instance<'tcx>> {\n         trace!(\"resolve: {:?}, {:#?}\", def_id, substs);\n         trace!(\"param_env: {:#?}\", self.param_env);\n@@ -306,7 +306,7 @@ impl<'a, 'mir, 'tcx: 'mir, M: Machine<'a, 'mir, 'tcx>> EvalContext<'a, 'mir, 'tc\n     fn monomorphize_with_substs<T: TypeFoldable<'tcx> + Subst<'tcx>>(\n         &self,\n         t: T,\n-        substs: &'tcx Substs<'tcx>\n+        substs: SubstsRef<'tcx>\n     ) -> T {\n         // miri doesn't care about lifetimes, and will choke on some crazy ones\n         // let's simply get rid of them"}, {"sha": "2e4b8682437fe07f9c0371628b1530477a07b213", "filename": "src/librustc_mir/monomorphize/collector.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -180,7 +180,7 @@ use rustc::hir::itemlikevisit::ItemLikeVisitor;\n use rustc::hir::def_id::{DefId, LOCAL_CRATE};\n use rustc::mir::interpret::{AllocId, ConstValue};\n use rustc::middle::lang_items::{ExchangeMallocFnLangItem, StartFnLangItem};\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::{Substs, SubstsRef};\n use rustc::ty::{self, TypeFoldable, Ty, TyCtxt, GenericParamDefKind};\n use rustc::ty::adjustment::CustomCoerceUnsized;\n use rustc::session::config::EntryFnType;\n@@ -500,7 +500,7 @@ struct MirNeighborCollector<'a, 'tcx: 'a> {\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     mir: &'a mir::Mir<'tcx>,\n     output: &'a mut Vec<MonoItem<'tcx>>,\n-    param_substs: &'tcx Substs<'tcx>,\n+    param_substs: SubstsRef<'tcx>,\n }\n \n impl<'a, 'tcx> MirVisitor<'tcx> for MirNeighborCollector<'a, 'tcx> {\n@@ -748,7 +748,7 @@ fn should_monomorphize_locally<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, instance:\n \n     fn is_available_upstream_generic<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                                                def_id: DefId,\n-                                               substs: &'tcx Substs<'tcx>)\n+                                               substs: SubstsRef<'tcx>)\n                                                -> bool {\n         debug_assert!(!def_id.is_local());\n \n@@ -1218,7 +1218,7 @@ fn def_id_to_string<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n fn collect_lazy_const<'a, 'tcx>(\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     constant: &ty::LazyConst<'tcx>,\n-    param_substs: &'tcx Substs<'tcx>,\n+    param_substs: SubstsRef<'tcx>,\n     output: &mut Vec<MonoItem<'tcx>>,\n ) {\n     let (def_id, substs) = match *constant {"}, {"sha": "9494d4b1f6c392d831a4a8025114118876ebda5d", "filename": "src/librustc_mir/transform/erase_regions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Ftransform%2Ferase_regions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Ftransform%2Ferase_regions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Ferase_regions.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -4,7 +4,7 @@\n //! N.B., we do _not_ erase regions of statements that are relevant for\n //! \"types-as-contracts\"-validation, namely, `AcquireValid` and `ReleaseValid`.\n \n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::{self, Ty, TyCtxt};\n use rustc::mir::*;\n use rustc::mir::visit::{MutVisitor, TyContext};\n@@ -36,7 +36,7 @@ impl<'a, 'tcx> MutVisitor<'tcx> for EraseRegionsVisitor<'a, 'tcx> {\n         *constant = self.tcx.erase_regions(constant);\n     }\n \n-    fn visit_substs(&mut self, substs: &mut &'tcx Substs<'tcx>, _: Location) {\n+    fn visit_substs(&mut self, substs: &mut SubstsRef<'tcx>, _: Location) {\n         *substs = self.tcx.erase_regions(substs);\n     }\n "}, {"sha": "09142828f18af33a603099c1285061d16cdca831", "filename": "src/librustc_mir/transform/generator.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -55,7 +55,7 @@ use rustc::mir::*;\n use rustc::mir::visit::{PlaceContext, Visitor, MutVisitor};\n use rustc::ty::{self, TyCtxt, AdtDef, Ty};\n use rustc::ty::layout::VariantIdx;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc_data_structures::fx::FxHashMap;\n use rustc_data_structures::indexed_vec::Idx;\n use rustc_data_structures::bit_set::BitSet;\n@@ -154,7 +154,7 @@ struct SuspensionPoint {\n struct TransformVisitor<'a, 'tcx: 'a> {\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     state_adt_ref: &'tcx AdtDef,\n-    state_substs: &'tcx Substs<'tcx>,\n+    state_substs: SubstsRef<'tcx>,\n \n     // The index of the generator state in the generator struct\n     state_field: usize,"}, {"sha": "56e4926090eac7abc9c7fc7f1da5f72c15345452", "filename": "src/librustc_mir/transform/inline.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Ftransform%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Ftransform%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Finline.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -9,7 +9,7 @@ use rustc_data_structures::indexed_vec::{Idx, IndexVec};\n use rustc::mir::*;\n use rustc::mir::visit::*;\n use rustc::ty::{self, Instance, InstanceDef, ParamEnv, Ty, TyCtxt};\n-use rustc::ty::subst::{Subst,Substs};\n+use rustc::ty::subst::{Subst, SubstsRef};\n \n use std::collections::VecDeque;\n use std::iter;\n@@ -32,7 +32,7 @@ pub struct Inline;\n #[derive(Copy, Clone, Debug)]\n struct CallSite<'tcx> {\n     callee: DefId,\n-    substs: &'tcx Substs<'tcx>,\n+    substs: SubstsRef<'tcx>,\n     bb: BasicBlock,\n     location: SourceInfo,\n }"}, {"sha": "cf3ba1765406c47989f917780d27eb9ee4cc1173", "filename": "src/librustc_mir/util/elaborate_drops.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Futil%2Felaborate_drops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_mir%2Futil%2Felaborate_drops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Felaborate_drops.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -5,7 +5,7 @@ use rustc::middle::lang_items;\n use rustc::traits::Reveal;\n use rustc::ty::{self, Ty, TyCtxt};\n use rustc::ty::layout::VariantIdx;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::util::IntTypeExt;\n use rustc_data_structures::indexed_vec::Idx;\n use crate::util::patch::MirPatch;\n@@ -189,7 +189,7 @@ impl<'l, 'b, 'tcx, D> DropCtxt<'l, 'b, 'tcx, D>\n                              base_place: &Place<'tcx>,\n                              variant_path: D::Path,\n                              variant: &'tcx ty::VariantDef,\n-                             substs: &'tcx Substs<'tcx>)\n+                             substs: SubstsRef<'tcx>)\n                              -> Vec<(Place<'tcx>, Option<D::Path>)>\n     {\n         variant.fields.iter().enumerate().map(|(i, f)| {\n@@ -328,7 +328,7 @@ impl<'l, 'b, 'tcx, D> DropCtxt<'l, 'b, 'tcx, D>\n         self.drop_ladder(fields, succ, unwind).0\n     }\n \n-    fn open_drop_for_box<'a>(&mut self, adt: &'tcx ty::AdtDef, substs: &'tcx Substs<'tcx>)\n+    fn open_drop_for_box<'a>(&mut self, adt: &'tcx ty::AdtDef, substs: SubstsRef<'tcx>)\n                              -> BasicBlock\n     {\n         debug!(\"open_drop_for_box({:?}, {:?}, {:?})\", self, adt, substs);\n@@ -346,7 +346,7 @@ impl<'l, 'b, 'tcx, D> DropCtxt<'l, 'b, 'tcx, D>\n         self.drop_subpath(&interior, interior_path, succ, unwind_succ)\n     }\n \n-    fn open_drop_for_adt<'a>(&mut self, adt: &'tcx ty::AdtDef, substs: &'tcx Substs<'tcx>)\n+    fn open_drop_for_adt<'a>(&mut self, adt: &'tcx ty::AdtDef, substs: SubstsRef<'tcx>)\n                              -> BasicBlock {\n         debug!(\"open_drop_for_adt({:?}, {:?}, {:?})\", self, adt, substs);\n         if adt.variants.len() == 0 {\n@@ -376,7 +376,7 @@ impl<'l, 'b, 'tcx, D> DropCtxt<'l, 'b, 'tcx, D>\n     }\n \n     fn open_drop_for_adt_contents(&mut self, adt: &'tcx ty::AdtDef,\n-                                  substs: &'tcx Substs<'tcx>)\n+                                  substs: SubstsRef<'tcx>)\n                                   -> (BasicBlock, Unwind) {\n         let (succ, unwind) = self.drop_ladder_bottom();\n         if !adt.is_enum() {\n@@ -393,7 +393,7 @@ impl<'l, 'b, 'tcx, D> DropCtxt<'l, 'b, 'tcx, D>\n     }\n \n     fn open_drop_for_multivariant(&mut self, adt: &'tcx ty::AdtDef,\n-                                  substs: &'tcx Substs<'tcx>,\n+                                  substs: SubstsRef<'tcx>,\n                                   succ: BasicBlock,\n                                   unwind: Unwind)\n                                   -> (BasicBlock, Unwind) {\n@@ -867,7 +867,7 @@ impl<'l, 'b, 'tcx, D> DropCtxt<'l, 'b, 'tcx, D>\n     fn box_free_block<'a>(\n         &mut self,\n         adt: &'tcx ty::AdtDef,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         target: BasicBlock,\n         unwind: Unwind,\n     ) -> BasicBlock {\n@@ -878,7 +878,7 @@ impl<'l, 'b, 'tcx, D> DropCtxt<'l, 'b, 'tcx, D>\n     fn unelaborated_free_block<'a>(\n         &mut self,\n         adt: &'tcx ty::AdtDef,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         target: BasicBlock,\n         unwind: Unwind\n     ) -> BasicBlock {"}, {"sha": "105eb5187467530fef357a2d68830d9e2f4290cf", "filename": "src/librustc_passes/rvalue_promotion.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_passes%2Frvalue_promotion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_passes%2Frvalue_promotion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Frvalue_promotion.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -22,7 +22,7 @@ use rustc::middle::mem_categorization as mc;\n use rustc::middle::mem_categorization::Categorization;\n use rustc::ty::{self, Ty, TyCtxt};\n use rustc::ty::query::Providers;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::{Substs, SubstsRef};\n use rustc::util::nodemap::{ItemLocalSet, HirIdSet};\n use rustc::hir;\n use rustc_data_structures::sync::Lrc;\n@@ -94,7 +94,7 @@ struct CheckCrateVisitor<'a, 'tcx: 'a> {\n     in_static: bool,\n     mut_rvalue_borrows: HirIdSet,\n     param_env: ty::ParamEnv<'tcx>,\n-    identity_substs: &'tcx Substs<'tcx>,\n+    identity_substs: SubstsRef<'tcx>,\n     tables: &'a ty::TypeckTables<'tcx>,\n     result: ItemLocalSet,\n }"}, {"sha": "7e56c62c5f33ac7d382f54a46ab13d56c2f26f66", "filename": "src/librustc_typeck/astconv.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fastconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fastconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fastconv.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -14,7 +14,7 @@ use rustc::lint::builtin::AMBIGUOUS_ASSOCIATED_ITEMS;\n use rustc::traits;\n use rustc::ty::{self, Ty, TyCtxt, ToPredicate, TypeFoldable};\n use rustc::ty::{GenericParamDef, GenericParamDefKind};\n-use rustc::ty::subst::{Kind, Subst, Substs};\n+use rustc::ty::subst::{Kind, Subst, Substs, SubstsRef};\n use rustc::ty::wf::object_region_bounds;\n use rustc_data_structures::sync::Lrc;\n use rustc_target::spec::abi;\n@@ -177,7 +177,7 @@ impl<'o, 'gcx: 'tcx, 'tcx> dyn AstConv<'gcx, 'tcx> + 'o {\n         span: Span,\n         def_id: DefId,\n         item_segment: &hir::PathSegment)\n-        -> &'tcx Substs<'tcx>\n+        -> SubstsRef<'tcx>\n     {\n         let (substs, assoc_bindings, _) = item_segment.with_generic_args(|generic_args| {\n             self.create_substs_for_ast_path(\n@@ -436,7 +436,7 @@ impl<'o, 'gcx: 'tcx, 'tcx> dyn AstConv<'gcx, 'tcx> + 'o {\n         args_for_def_id: impl Fn(DefId) -> (Option<&'b GenericArgs>, bool),\n         provided_kind: impl Fn(&GenericParamDef, &GenericArg) -> Kind<'tcx>,\n         inferred_kind: impl Fn(Option<&[Kind<'tcx>]>, &GenericParamDef, bool) -> Kind<'tcx>,\n-    ) -> &'tcx Substs<'tcx> {\n+    ) -> SubstsRef<'tcx> {\n         // Collect the segments of the path; we need to substitute arguments\n         // for parameters throughout the entire path (wherever there are\n         // generic parameters).\n@@ -548,7 +548,7 @@ impl<'o, 'gcx: 'tcx, 'tcx> dyn AstConv<'gcx, 'tcx> + 'o {\n         generic_args: &hir::GenericArgs,\n         infer_types: bool,\n         self_ty: Option<Ty<'tcx>>)\n-        -> (&'tcx Substs<'tcx>, Vec<ConvertedBinding<'tcx>>, Option<Vec<Span>>)\n+        -> (SubstsRef<'tcx>, Vec<ConvertedBinding<'tcx>>, Option<Vec<Span>>)\n     {\n         // If the type is parameterized by this region, then replace this\n         // region with the current anon region binding (in other words,\n@@ -760,7 +760,7 @@ impl<'o, 'gcx: 'tcx, 'tcx> dyn AstConv<'gcx, 'tcx> + 'o {\n         trait_def_id: DefId,\n         self_ty: Ty<'tcx>,\n         trait_segment: &hir::PathSegment,\n-    ) -> (&'tcx Substs<'tcx>, Vec<ConvertedBinding<'tcx>>, Option<Vec<Span>>) {\n+    ) -> (SubstsRef<'tcx>, Vec<ConvertedBinding<'tcx>>, Option<Vec<Span>>) {\n         debug!(\"create_substs_for_ast_trait_ref(trait_segment={:?})\",\n                trait_segment);\n "}, {"sha": "87276b8c66ca4a8102963aa68ebe20577ee60521", "filename": "src/librustc_typeck/check/cast.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -37,9 +37,9 @@ use rustc::hir;\n use rustc::session::Session;\n use rustc::traits;\n use rustc::ty::{self, Ty, TypeFoldable, TypeAndMut};\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::adjustment::AllowTwoPhase;\n use rustc::ty::cast::{CastKind, CastTy};\n-use rustc::ty::subst::Substs;\n use rustc::middle::lang_items;\n use syntax::ast;\n use syntax_pos::Span;\n@@ -69,7 +69,7 @@ enum PointerKind<'tcx> {\n     /// The unsize info of this projection\n     OfProjection(&'tcx ty::ProjectionTy<'tcx>),\n     /// The unsize info of this opaque ty\n-    OfOpaque(DefId, &'tcx Substs<'tcx>),\n+    OfOpaque(DefId, SubstsRef<'tcx>),\n     /// The unsize info of this parameter\n     OfParam(&'tcx ty::ParamTy),\n }"}, {"sha": "996d6cfd5683069cbce19ebaed5c5995f2baa638", "filename": "src/librustc_typeck/check/method/confirm.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fconfirm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fconfirm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fconfirm.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -4,10 +4,9 @@ use crate::astconv::AstConv;\n use crate::check::{FnCtxt, PlaceOp, callee, Needs};\n use crate::hir::GenericArg;\n use crate::hir::def_id::DefId;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::{Subst, SubstsRef};\n use rustc::traits;\n use rustc::ty::{self, Ty, GenericParamDefKind};\n-use rustc::ty::subst::Subst;\n use rustc::ty::adjustment::{Adjustment, Adjust, OverloadedDeref};\n use rustc::ty::adjustment::{AllowTwoPhase, AutoBorrow, AutoBorrowMutability};\n use rustc::ty::fold::TypeFoldable;\n@@ -209,7 +208,7 @@ impl<'a, 'gcx, 'tcx> ConfirmContext<'a, 'gcx, 'tcx> {\n     fn fresh_receiver_substs(&mut self,\n                              self_ty: Ty<'tcx>,\n                              pick: &probe::Pick<'tcx>)\n-                             -> &'tcx Substs<'tcx> {\n+                             -> SubstsRef<'tcx> {\n         match pick.kind {\n             probe::InherentImplPick => {\n                 let impl_def_id = pick.item.container.id();\n@@ -300,8 +299,8 @@ impl<'a, 'gcx, 'tcx> ConfirmContext<'a, 'gcx, 'tcx> {\n         &mut self,\n         pick: &probe::Pick<'tcx>,\n         seg: &hir::PathSegment,\n-        parent_substs: &Substs<'tcx>,\n-    ) -> &'tcx Substs<'tcx> {\n+        parent_substs: SubstsRef<'tcx>,\n+    ) -> SubstsRef<'tcx> {\n         // Determine the values for the generic parameters of the method.\n         // If they were not explicitly supplied, just construct fresh\n         // variables.\n@@ -369,7 +368,7 @@ impl<'a, 'gcx, 'tcx> ConfirmContext<'a, 'gcx, 'tcx> {\n     // until we unify the `Self` type.\n     fn instantiate_method_sig(&mut self,\n                               pick: &probe::Pick<'tcx>,\n-                              all_substs: &'tcx Substs<'tcx>)\n+                              all_substs: SubstsRef<'tcx>)\n                               -> (ty::FnSig<'tcx>, ty::InstantiatedPredicates<'tcx>) {\n         debug!(\"instantiate_method_sig(pick={:?}, all_substs={:?})\",\n                pick,\n@@ -404,7 +403,7 @@ impl<'a, 'gcx, 'tcx> ConfirmContext<'a, 'gcx, 'tcx> {\n \n     fn add_obligations(&mut self,\n                        fty: Ty<'tcx>,\n-                       all_substs: &Substs<'tcx>,\n+                       all_substs: SubstsRef<'tcx>,\n                        method_predicates: &ty::InstantiatedPredicates<'tcx>) {\n         debug!(\"add_obligations: fty={:?} all_substs={:?} method_predicates={:?}\",\n                fty,"}, {"sha": "cb6a862f06eeedd27287738fffc8bf6ee3f52be6", "filename": "src/librustc_typeck/check/method/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -18,7 +18,7 @@ use rustc::hir;\n use rustc::hir::def::Def;\n use rustc::hir::def_id::DefId;\n use rustc::traits;\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::{Substs, SubstsRef};\n use rustc::ty::{self, Ty, ToPredicate, ToPolyTraitRef, TraitRef, TypeFoldable};\n use rustc::ty::GenericParamDefKind;\n use rustc::ty::subst::Subst;\n@@ -38,7 +38,7 @@ pub fn provide(providers: &mut ty::query::Providers<'_>) {\n pub struct MethodCallee<'tcx> {\n     /// Impl method ID, for inherent methods, or trait method ID, otherwise.\n     pub def_id: DefId,\n-    pub substs: &'tcx Substs<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n \n     /// Instantiated method signature, i.e., it has been\n     /// substituted, normalized, and has had late-bound"}, {"sha": "0db9e3ed85fd657f5cd9c8b4bd7aae9ccfa5ace3", "filename": "src/librustc_typeck/check/method/probe.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -13,7 +13,7 @@ use rustc_data_structures::sync::Lrc;\n use rustc::hir;\n use rustc::lint;\n use rustc::session::config::nightly_options;\n-use rustc::ty::subst::{Subst, Substs};\n+use rustc::ty::subst::{Subst, Substs, SubstsRef};\n use rustc::traits::{self, ObligationCause};\n use rustc::traits::query::{CanonicalTyGoal};\n use rustc::traits::query::method_autoderef::{CandidateStep, MethodAutoderefStepsResult};\n@@ -125,7 +125,7 @@ struct Candidate<'tcx> {\n \n #[derive(Debug)]\n enum CandidateKind<'tcx> {\n-    InherentImplCandidate(&'tcx Substs<'tcx>,\n+    InherentImplCandidate(SubstsRef<'tcx>,\n                           // Normalize obligations\n                           Vec<traits::PredicateObligation<'tcx>>),\n     ObjectCandidate,\n@@ -1537,11 +1537,11 @@ impl<'a, 'gcx, 'tcx> ProbeContext<'a, 'gcx, 'tcx> {\n     }\n \n     /// Gets the type of an impl and generate substitutions with placeholders.\n-    fn impl_ty_and_substs(&self, impl_def_id: DefId) -> (Ty<'tcx>, &'tcx Substs<'tcx>) {\n+    fn impl_ty_and_substs(&self, impl_def_id: DefId) -> (Ty<'tcx>, SubstsRef<'tcx>) {\n         (self.tcx.type_of(impl_def_id), self.fresh_item_substs(impl_def_id))\n     }\n \n-    fn fresh_item_substs(&self, def_id: DefId) -> &'tcx Substs<'tcx> {\n+    fn fresh_item_substs(&self, def_id: DefId) -> SubstsRef<'tcx> {\n         Substs::for_item(self.tcx, def_id, |param, _| {\n             match param.kind {\n                 GenericParamDefKind::Lifetime => self.tcx.types.re_erased.into(),"}, {"sha": "fbbc65feb7377c461e8b8f8b4cdb02bbfeb82e16", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -109,7 +109,7 @@ use rustc::ty::{\n use rustc::ty::adjustment::{Adjust, Adjustment, AllowTwoPhase, AutoBorrow, AutoBorrowMutability};\n use rustc::ty::fold::TypeFoldable;\n use rustc::ty::query::Providers;\n-use rustc::ty::subst::{UnpackedKind, Subst, Substs, UserSelfTy, UserSubsts};\n+use rustc::ty::subst::{UnpackedKind, Subst, Substs, SubstsRef, UserSelfTy, UserSubsts};\n use rustc::ty::util::{Representability, IntTypeExt, Discr};\n use rustc::ty::layout::VariantIdx;\n use syntax_pos::{self, BytePos, Span, MultiSpan};\n@@ -1318,7 +1318,7 @@ fn check_union<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n fn check_opaque<'a, 'tcx>(\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     def_id: DefId,\n-    substs: &'tcx Substs<'tcx>,\n+    substs: SubstsRef<'tcx>,\n     span: Span,\n ) {\n     if let Err(partially_expanded_type) = tcx.try_expand_impl_trait_type(def_id, substs) {\n@@ -2200,7 +2200,7 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         }\n     }\n \n-    pub fn write_substs(&self, node_id: hir::HirId, substs: &'tcx Substs<'tcx>) {\n+    pub fn write_substs(&self, node_id: hir::HirId, substs: SubstsRef<'tcx>) {\n         if !substs.is_noop() {\n             debug!(\"write_substs({:?}, {:?}) in fcx {}\",\n                    node_id,\n@@ -2222,7 +2222,7 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         &self,\n         hir_id: hir::HirId,\n         def_id: DefId,\n-        substs: &'tcx Substs<'tcx>,\n+        substs: SubstsRef<'tcx>,\n         user_self_ty: Option<UserSelfTy<'tcx>>,\n     ) {\n         debug!("}, {"sha": "419796a2014e04d8d965d40aeb986a57fd4fbfd7", "filename": "src/librustc_typeck/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92/src%2Flibrustc_typeck%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Flib.rs?ref=ccfa5d6df8ee061264c44bb8fbb3b3f35592ba92", "patch": "@@ -105,7 +105,7 @@ use rustc::session;\n use rustc::session::CompileIncomplete;\n use rustc::session::config::{EntryFnType, nightly_options};\n use rustc::traits::{ObligationCause, ObligationCauseCode, TraitEngine, TraitEngineExt};\n-use rustc::ty::subst::Substs;\n+use rustc::ty::subst::SubstsRef;\n use rustc::ty::{self, Ty, TyCtxt};\n use rustc::ty::query::Providers;\n use rustc::util;\n@@ -116,7 +116,7 @@ use util::common::time;\n use std::iter;\n \n pub struct TypeAndSubsts<'tcx> {\n-    substs: &'tcx Substs<'tcx>,\n+    substs: SubstsRef<'tcx>,\n     ty: Ty<'tcx>,\n }\n "}]}