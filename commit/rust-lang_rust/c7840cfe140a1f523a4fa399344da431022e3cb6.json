{"sha": "c7840cfe140a1f523a4fa399344da431022e3cb6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ODQwY2ZlMTQwYTFmNTIzYTRmYTM5OTM0NGRhNDMxMDIyZTNjYjY=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-04-06T21:54:40Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-05-18T14:11:35Z"}, "message": "make the filename computation take a cratenum", "tree": {"sha": "9588564f2a5a7da90b6ebc32aa323f3b34f24e87", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9588564f2a5a7da90b6ebc32aa323f3b34f24e87"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7840cfe140a1f523a4fa399344da431022e3cb6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7840cfe140a1f523a4fa399344da431022e3cb6", "html_url": "https://github.com/rust-lang/rust/commit/c7840cfe140a1f523a4fa399344da431022e3cb6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7840cfe140a1f523a4fa399344da431022e3cb6/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f89041bbe3da48d98c1512b39c819ed42cff4e78", "url": "https://api.github.com/repos/rust-lang/rust/commits/f89041bbe3da48d98c1512b39c819ed42cff4e78", "html_url": "https://github.com/rust-lang/rust/commit/f89041bbe3da48d98c1512b39c819ed42cff4e78"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "868f2ee4244aaa9540b455043e5d4168cc77ccd3", "filename": "src/librustc_incremental/persist/save.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c7840cfe140a1f523a4fa399344da431022e3cb6/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7840cfe140a1f523a4fa399344da431022e3cb6/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs?ref=c7840cfe140a1f523a4fa399344da431022e3cb6", "patch": "@@ -10,6 +10,7 @@\n \n use rbml::opaque::Encoder;\n use rustc::dep_graph::DepNode;\n+use rustc::middle::cstore::LOCAL_CRATE;\n use rustc::ty::TyCtxt;\n use rustc_serialize::{Encodable as RustcEncodable};\n use std::hash::{Hasher, SipHasher};\n@@ -25,7 +26,7 @@ pub fn save_dep_graph<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>) {\n     let _ignore = tcx.dep_graph.in_ignore();\n \n     save_in(tcx, dep_graph_path(tcx), encode_dep_graph);\n-    save_in(tcx, metadata_hash_path(tcx), encode_metadata_hashes);\n+    save_in(tcx, metadata_hash_path(tcx, LOCAL_CRATE), encode_metadata_hashes);\n }\n \n fn save_in<'a,'tcx,F>(tcx: TyCtxt<'a, 'tcx, 'tcx>, opt_path_buf: Option<PathBuf>, encode: F)"}, {"sha": "7acfdb5fffe931c74a6bbe2e5aed69592dee1c25", "filename": "src/librustc_incremental/persist/util.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c7840cfe140a1f523a4fa399344da431022e3cb6/src%2Flibrustc_incremental%2Fpersist%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7840cfe140a1f523a4fa399344da431022e3cb6/src%2Flibrustc_incremental%2Fpersist%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Futil.rs?ref=c7840cfe140a1f523a4fa399344da431022e3cb6", "patch": "@@ -16,17 +16,18 @@ use rustc::ty::TyCtxt;\n \n use std::fs;\n use std::io;\n-use std::path::{PathBuf, Path};\n+use std::path::{Path, PathBuf};\n+use syntax::ast;\n \n pub fn dep_graph_path(tcx: TyCtxt) -> Option<PathBuf> {\n-    path(tcx, \"local\")\n+    path(tcx, LOCAL_CRATE, \"local\")\n }\n \n-pub fn metadata_hash_path(tcx: TyCtxt) -> Option<PathBuf> {\n-    path(tcx, \"metadata\")\n+pub fn metadata_hash_path(tcx: TyCtxt, cnum: ast::CrateNum) -> Option<PathBuf> {\n+    path(tcx, cnum, \"metadata\")\n }\n \n-fn path(tcx: TyCtxt, suffix: &str) -> Option<PathBuf> {\n+fn path(tcx: TyCtxt, cnum: ast::CrateNum, suffix: &str) -> Option<PathBuf> {\n     // For now, just save/load dep-graph from\n     // directory/dep_graph.rbml\n     tcx.sess.opts.incremental.as_ref().and_then(|incr_dir| {\n@@ -40,8 +41,8 @@ fn path(tcx: TyCtxt, suffix: &str) -> Option<PathBuf> {\n             }\n         }\n \n-        let crate_name = tcx.crate_name(LOCAL_CRATE);\n-        let crate_disambiguator = tcx.crate_disambiguator(LOCAL_CRATE);\n+        let crate_name = tcx.crate_name(cnum);\n+        let crate_disambiguator = tcx.crate_disambiguator(cnum);\n         let file_name = format!(\"{}-{}.{}.bin\",\n                                 crate_name,\n                                 crate_disambiguator,"}]}