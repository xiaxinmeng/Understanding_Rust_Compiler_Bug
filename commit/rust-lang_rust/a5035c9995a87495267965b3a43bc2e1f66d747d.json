{"sha": "a5035c9995a87495267965b3a43bc2e1f66d747d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1MDM1Yzk5OTVhODc0OTUyNjc5NjViM2E0M2JjMmUxZjY2ZDc0N2Q=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-03-08T19:09:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-08T19:09:04Z"}, "message": "Rollup merge of #82874 - erikdesjardins:cgtests, r=nagisa\n\nAdd codegen tests for some issues closed by LLVM 12\n\nNamely #73031, #75546, and #77812", "tree": {"sha": "4a43b9cc42c39b161add0b13d1e3fb5261d7dea5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a43b9cc42c39b161add0b13d1e3fb5261d7dea5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5035c9995a87495267965b3a43bc2e1f66d747d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgRnZRCRBK7hj4Ov3rIwAAdHIIADFSvp8LCQsA/nkio1VREOqH\nMMZg9135LMBZaHjzNBOlTiYVk8zPfXdfe1gJojX38YmMOiVnQP3vxZwP1hP2BTOv\n8IWsLcwKvqCJwU+H7KSVU7n4+Kz+hmajx2ogHe4kzQffnDX1IRiX2NLZGM7G9gmb\nTOuyuWw1Ln0k1DVkbzU6eBy8TiUo6n7DNaWXspHKlGfGHmku3jMdlU+R+cjXWdck\nZA++Ii/ybfTVwgI+t8A/ipMtoX7ABCxlhdTTtatHoVIQiJXauy1O75jlA7Azcc41\nCMUYjjz/J3Nsb3UnTEzILhyogbI+9HQ1rBkk7wS1RswCD4HkuBH9zRmJzk+ZiRM=\n=QPJY\n-----END PGP SIGNATURE-----\n", "payload": "tree 4a43b9cc42c39b161add0b13d1e3fb5261d7dea5\nparent a55b192d5942efcaad6901dcd21ffe28316ca20a\nparent 938637033c093af6e85580589a7ac677ecb448cd\nauthor Mara Bos <m-ou.se@m-ou.se> 1615230544 +0100\ncommitter GitHub <noreply@github.com> 1615230544 +0100\n\nRollup merge of #82874 - erikdesjardins:cgtests, r=nagisa\n\nAdd codegen tests for some issues closed by LLVM 12\n\nNamely #73031, #75546, and #77812\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5035c9995a87495267965b3a43bc2e1f66d747d", "html_url": "https://github.com/rust-lang/rust/commit/a5035c9995a87495267965b3a43bc2e1f66d747d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5035c9995a87495267965b3a43bc2e1f66d747d/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a55b192d5942efcaad6901dcd21ffe28316ca20a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a55b192d5942efcaad6901dcd21ffe28316ca20a", "html_url": "https://github.com/rust-lang/rust/commit/a55b192d5942efcaad6901dcd21ffe28316ca20a"}, {"sha": "938637033c093af6e85580589a7ac677ecb448cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/938637033c093af6e85580589a7ac677ecb448cd", "html_url": "https://github.com/rust-lang/rust/commit/938637033c093af6e85580589a7ac677ecb448cd"}], "stats": {"total": 76, "additions": 76, "deletions": 0}, "files": [{"sha": "6ba4d707f42b14088a21591427e311862d1db77b", "filename": "src/test/codegen/issue-73031.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/a5035c9995a87495267965b3a43bc2e1f66d747d/src%2Ftest%2Fcodegen%2Fissue-73031.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5035c9995a87495267965b3a43bc2e1f66d747d/src%2Ftest%2Fcodegen%2Fissue-73031.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fissue-73031.rs?ref=a5035c9995a87495267965b3a43bc2e1f66d747d", "patch": "@@ -0,0 +1,27 @@\n+// min-llvm-version: 12.0.0\n+// compile-flags: -O\n+#![crate_type = \"lib\"]\n+\n+// Test that LLVM can eliminate the unreachable `All::None` branch.\n+\n+pub enum All {\n+    None,\n+    Foo,\n+    Bar,\n+}\n+\n+// CHECK-LABEL: @issue_73031\n+#[no_mangle]\n+pub fn issue_73031(a: &mut All, q: i32) -> i32 {\n+    *a = if q == 5 {\n+        All::Foo\n+    } else {\n+        All::Bar\n+    };\n+    match *a {\n+        // CHECK-NOT: panic\n+        All::None => panic!(),\n+        All::Foo => 1,\n+        All::Bar => 2,\n+    }\n+}"}, {"sha": "49e4d4c7ec56da3ff0761a26b55a4a0044b68101", "filename": "src/test/codegen/issue-75546.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a5035c9995a87495267965b3a43bc2e1f66d747d/src%2Ftest%2Fcodegen%2Fissue-75546.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5035c9995a87495267965b3a43bc2e1f66d747d/src%2Ftest%2Fcodegen%2Fissue-75546.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fissue-75546.rs?ref=a5035c9995a87495267965b3a43bc2e1f66d747d", "patch": "@@ -0,0 +1,16 @@\n+// min-llvm-version: 12.0.0\n+// compile-flags: -O\n+#![crate_type = \"lib\"]\n+\n+// Test that LLVM can eliminate the impossible `i == 0` check.\n+\n+// CHECK-LABEL: @issue_75546\n+#[no_mangle]\n+pub fn issue_75546() {\n+    let mut i = 1u32;\n+    while i < u32::MAX {\n+        // CHECK-NOT: panic\n+        if i == 0 { panic!(); }\n+        i += 1;\n+    }\n+}"}, {"sha": "95042579adb6b65f20c909bfc650c22d390c4f67", "filename": "src/test/codegen/issue-77812.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/a5035c9995a87495267965b3a43bc2e1f66d747d/src%2Ftest%2Fcodegen%2Fissue-77812.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5035c9995a87495267965b3a43bc2e1f66d747d/src%2Ftest%2Fcodegen%2Fissue-77812.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fissue-77812.rs?ref=a5035c9995a87495267965b3a43bc2e1f66d747d", "patch": "@@ -0,0 +1,33 @@\n+// min-llvm-version: 12.0.0\n+// compile-flags: -O\n+#![crate_type = \"lib\"]\n+\n+// Test that LLVM can eliminate the unreachable `Variant::Zero` branch.\n+\n+#[derive(Copy, Clone, Eq, PartialEq)]\n+pub enum Variant {\n+    Zero,\n+    One,\n+    Two,\n+}\n+\n+extern {\n+    fn exf1();\n+    fn exf2();\n+}\n+\n+pub static mut GLOBAL: Variant = Variant::Zero;\n+\n+// CHECK-LABEL: @issue_77812\n+#[no_mangle]\n+pub unsafe fn issue_77812() {\n+    let g = GLOBAL;\n+    if g != Variant::Zero {\n+        match g {\n+            Variant::One => exf1(),\n+            Variant::Two => exf2(),\n+            // CHECK-NOT: panic\n+            Variant::Zero => panic!(),\n+        }\n+    }\n+}"}]}