{"sha": "7e148cd06292d125f925323fda6fabbc625a42c8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlMTQ4Y2QwNjI5MmQxMjVmOTI1MzIzZmRhNmZhYmJjNjI1YTQyYzg=", "commit": {"author": {"name": "Andrew Paseltiner", "email": "apaseltiner@gmail.com", "date": "2016-08-17T00:45:07Z"}, "committer": {"name": "Andrew Paseltiner", "email": "apaseltiner@gmail.com", "date": "2016-08-17T00:45:07Z"}, "message": "Make `vec::IntoIter` covariant again\n\nCloses #35721", "tree": {"sha": "0f8b7276ad421c926225824ec6e7227eb3dc18d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f8b7276ad421c926225824ec6e7227eb3dc18d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e148cd06292d125f925323fda6fabbc625a42c8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXs7OnAAoJENpc3BX5vtsrJIsQAKQpHDuPQuVErUJUKVkfqk9F\nRCQw2cxogQoAQ9Uu61fgJuP8bcpgVQZ3jUJ1Nq7UYuW7Z7lzlE22AnXgnhSq9OLk\nP/qG/aOqmuPuoOG4TTm32k+HCln4QcCaXus9m3eIZlAqj2R/IviGf49pJ7dV0/pI\nNr/Gg9y4cccCVxFCvS6WhyG++3lz04Vt474flg3MpBP0qlwl9ZKT3Sl8aWkHdhPH\nhq6YaA6peXRrHVqTnszbytDPDtSj6Y0rfhJvcIFC+Ws41YY6qs5B7i5q5IjbHuq6\nZ1NwVaZTs5puA14zteVRGROe1NATBQh3rKkr0s9RaxAzEYwzdaebBsQmIvy0/MYd\nMoPxtba+D/uF9f+LVbCvhJimyt84Er39n57zti4mEFk8R627v1rwIWGiBOt3doO/\nWriatqi6eYhpdonDn146+k7OEjVr3LGwRULHpr2vIPgUZmaVhndx6NdzY/tTDc7k\nsm1LmxJYYI2PDlfHFbc78LRgpAFx000Yl81FKcddebiMCmRq3mE1YpcjWvPilV6D\n+ATbpt1UlYfKnjr1y86yw5Q/76GcQo6dA862zOlvJACW45fOWUDqwx0vWJ/3Jwmo\n5CNVWiWZrzaOEpaWJxnsrAGaT/cbp08UqhwTsY/40l4TllPCJh9i1D0u5p7CLRHL\ngr6eDL+HfOyyN0DUMw5Z\n=6m+l\n-----END PGP SIGNATURE-----", "payload": "tree 0f8b7276ad421c926225824ec6e7227eb3dc18d8\nparent db7300d4149256023f9ede6828afef321170c07f\nauthor Andrew Paseltiner <apaseltiner@gmail.com> 1471394707 -0400\ncommitter Andrew Paseltiner <apaseltiner@gmail.com> 1471394707 -0400\n\nMake `vec::IntoIter` covariant again\n\nCloses #35721\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e148cd06292d125f925323fda6fabbc625a42c8", "html_url": "https://github.com/rust-lang/rust/commit/7e148cd06292d125f925323fda6fabbc625a42c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e148cd06292d125f925323fda6fabbc625a42c8/comments", "author": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "committer": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db7300d4149256023f9ede6828afef321170c07f", "url": "https://api.github.com/repos/rust-lang/rust/commits/db7300d4149256023f9ede6828afef321170c07f", "html_url": "https://github.com/rust-lang/rust/commit/db7300d4149256023f9ede6828afef321170c07f"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "3aefcc7d4cfa4cc76451af203b7a0f60b40c6e4d", "filename": "src/libcollections/vec.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/7e148cd06292d125f925323fda6fabbc625a42c8/src%2Flibcollections%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e148cd06292d125f925323fda6fabbc625a42c8/src%2Flibcollections%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec.rs?ref=7e148cd06292d125f925323fda6fabbc625a42c8", "patch": "@@ -1453,10 +1453,11 @@ impl<T> IntoIterator for Vec<T> {\n             } else {\n                 begin.offset(self.len() as isize) as *const T\n             };\n-            let buf = ptr::read(&self.buf);\n+            let cap = self.buf.cap();\n             mem::forget(self);\n             IntoIter {\n-                _buf: buf,\n+                buf: Shared::new(begin),\n+                cap: cap,\n                 ptr: begin,\n                 end: end,\n             }\n@@ -1708,8 +1709,9 @@ impl<'a, T> FromIterator<T> for Cow<'a, [T]> where T: Clone {\n /// [`IntoIterator`]: ../../std/iter/trait.IntoIterator.html\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub struct IntoIter<T> {\n-    _buf: RawVec<T>,\n-    ptr: *mut T,\n+    buf: Shared<T>,\n+    cap: usize,\n+    ptr: *const T,\n     end: *const T,\n }\n \n@@ -1750,7 +1752,7 @@ impl<T> IntoIter<T> {\n     #[unstable(feature = \"vec_into_iter_as_slice\", issue = \"35601\")]\n     pub fn as_mut_slice(&self) -> &mut [T] {\n         unsafe {\n-            slice::from_raw_parts_mut(self.ptr, self.len())\n+            slice::from_raw_parts_mut(self.ptr as *mut T, self.len())\n         }\n     }\n }\n@@ -1846,9 +1848,10 @@ impl<T> Drop for IntoIter<T> {\n     #[unsafe_destructor_blind_to_params]\n     fn drop(&mut self) {\n         // destroy the remaining elements\n-        for _x in self {}\n+        for _x in self.by_ref() {}\n \n         // RawVec handles deallocation\n+        let _ = unsafe { RawVec::from_raw_parts(*self.buf, self.cap) };\n     }\n }\n "}, {"sha": "537fabf8ab69bb14391074ad9dacea5bd1fb2318", "filename": "src/libcollectionstest/vec.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7e148cd06292d125f925323fda6fabbc625a42c8/src%2Flibcollectionstest%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e148cd06292d125f925323fda6fabbc625a42c8/src%2Flibcollectionstest%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollectionstest%2Fvec.rs?ref=7e148cd06292d125f925323fda6fabbc625a42c8", "patch": "@@ -11,7 +11,7 @@\n use std::borrow::Cow;\n use std::iter::{FromIterator, repeat};\n use std::mem::size_of;\n-use std::vec::Drain;\n+use std::vec::{Drain, IntoIter};\n \n use test::Bencher;\n \n@@ -537,6 +537,7 @@ fn test_cow_from() {\n #[allow(dead_code)]\n fn assert_covariance() {\n     fn drain<'new>(d: Drain<'static, &'static str>) -> Drain<'new, &'new str> { d }\n+    fn into_iter<'new>(i: IntoIter<&'static str>) -> IntoIter<&'new str> { i }\n }\n \n #[bench]"}]}