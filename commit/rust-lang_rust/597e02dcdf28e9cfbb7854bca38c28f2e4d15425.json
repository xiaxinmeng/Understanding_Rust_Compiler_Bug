{"sha": "597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5N2UwMmRjZGYyOGU5Y2ZiYjc4NTRiY2EzOGMyOGYyZTRkMTU0MjU=", "commit": {"author": {"name": "Devin R", "email": "devin.ragotzy@gmail.com", "date": "2020-02-26T12:40:31Z"}, "committer": {"name": "Devin R", "email": "devin.ragotzy@gmail.com", "date": "2020-03-04T14:36:02Z"}, "message": "warn on macro_use attr", "tree": {"sha": "392a1f3d02eeb5b7e94d0435ff78a2daaf4cdd46", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/392a1f3d02eeb5b7e94d0435ff78a2daaf4cdd46"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "html_url": "https://github.com/rust-lang/rust/commit/597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/comments", "author": {"login": "DevinR528", "id": 29749111, "node_id": "MDQ6VXNlcjI5NzQ5MTEx", "avatar_url": "https://avatars.githubusercontent.com/u/29749111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DevinR528", "html_url": "https://github.com/DevinR528", "followers_url": "https://api.github.com/users/DevinR528/followers", "following_url": "https://api.github.com/users/DevinR528/following{/other_user}", "gists_url": "https://api.github.com/users/DevinR528/gists{/gist_id}", "starred_url": "https://api.github.com/users/DevinR528/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DevinR528/subscriptions", "organizations_url": "https://api.github.com/users/DevinR528/orgs", "repos_url": "https://api.github.com/users/DevinR528/repos", "events_url": "https://api.github.com/users/DevinR528/events{/privacy}", "received_events_url": "https://api.github.com/users/DevinR528/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DevinR528", "id": 29749111, "node_id": "MDQ6VXNlcjI5NzQ5MTEx", "avatar_url": "https://avatars.githubusercontent.com/u/29749111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DevinR528", "html_url": "https://github.com/DevinR528", "followers_url": "https://api.github.com/users/DevinR528/followers", "following_url": "https://api.github.com/users/DevinR528/following{/other_user}", "gists_url": "https://api.github.com/users/DevinR528/gists{/gist_id}", "starred_url": "https://api.github.com/users/DevinR528/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DevinR528/subscriptions", "organizations_url": "https://api.github.com/users/DevinR528/orgs", "repos_url": "https://api.github.com/users/DevinR528/repos", "events_url": "https://api.github.com/users/DevinR528/events{/privacy}", "received_events_url": "https://api.github.com/users/DevinR528/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "36b65986afbc9f41535b1a08c8fb9454ce5bf48c", "url": "https://api.github.com/repos/rust-lang/rust/commits/36b65986afbc9f41535b1a08c8fb9454ce5bf48c", "html_url": "https://github.com/rust-lang/rust/commit/36b65986afbc9f41535b1a08c8fb9454ce5bf48c"}], "stats": {"total": 90, "additions": 88, "deletions": 2}, "files": [{"sha": "9ba9fdd4b8a01ad2a66ff35aec794dc2b4ed4ab9", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "patch": "@@ -1209,6 +1209,7 @@ Released 2018-09-13\n [`linkedlist`]: https://rust-lang.github.io/rust-clippy/master/index.html#linkedlist\n [`logic_bug`]: https://rust-lang.github.io/rust-clippy/master/index.html#logic_bug\n [`lossy_float_literal`]: https://rust-lang.github.io/rust-clippy/master/index.html#lossy_float_literal\n+[`macro_use_import`]: https://rust-lang.github.io/rust-clippy/master/index.html#macro_use_import\n [`main_recursion`]: https://rust-lang.github.io/rust-clippy/master/index.html#main_recursion\n [`manual_memcpy`]: https://rust-lang.github.io/rust-clippy/master/index.html#manual_memcpy\n [`manual_saturating_arithmetic`]: https://rust-lang.github.io/rust-clippy/master/index.html#manual_saturating_arithmetic"}, {"sha": "8635b2b6d5a55411868e0aeeac52e1e45f2a9dbb", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "patch": "@@ -5,7 +5,7 @@\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are 359 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n+[There are 360 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "86ab7d83905449136f212dca7b9812d17147d23f", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "patch": "@@ -234,6 +234,7 @@ pub mod let_underscore;\n pub mod lifetimes;\n pub mod literal_representation;\n pub mod loops;\n+pub mod macro_use;\n pub mod main_recursion;\n pub mod map_clone;\n pub mod map_unit_fn;\n@@ -599,6 +600,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &loops::WHILE_IMMUTABLE_CONDITION,\n         &loops::WHILE_LET_LOOP,\n         &loops::WHILE_LET_ON_ITERATOR,\n+        &macro_use::MACRO_USE_IMPORT,\n         &main_recursion::MAIN_RECURSION,\n         &map_clone::MAP_CLONE,\n         &map_unit_fn::OPTION_MAP_UNIT_FN,\n@@ -1012,6 +1014,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_early_pass(move || box excessive_bools::ExcessiveBools::new(max_struct_bools, max_fn_params_bools));\n     store.register_early_pass(|| box option_env_unwrap::OptionEnvUnwrap);\n     store.register_late_pass(|| box wildcard_imports::WildcardImports);\n+    store.register_early_pass(|| box macro_use::MacroUseImport);\n \n     store.register_group(true, \"clippy::restriction\", Some(\"clippy_restriction\"), vec![\n         LintId::of(&arithmetic::FLOAT_ARITHMETIC),\n@@ -1079,6 +1082,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&literal_representation::LARGE_DIGIT_GROUPS),\n         LintId::of(&loops::EXPLICIT_INTO_ITER_LOOP),\n         LintId::of(&loops::EXPLICIT_ITER_LOOP),\n+        LintId::of(&macro_use::MACRO_USE_IMPORT),\n         LintId::of(&matches::SINGLE_MATCH_ELSE),\n         LintId::of(&methods::FILTER_MAP),\n         LintId::of(&methods::FILTER_MAP_NEXT),"}, {"sha": "43671d69413162ec04038efe101e6252a059fc34", "filename": "clippy_lints/src/macro_use.rs", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/clippy_lints%2Fsrc%2Fmacro_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/clippy_lints%2Fsrc%2Fmacro_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmacro_use.rs?ref=597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "patch": "@@ -0,0 +1,53 @@\n+use crate::utils::{snippet, span_lint_and_sugg};\n+use if_chain::if_chain;\n+use rustc_ast::ast;\n+use rustc_errors::Applicability;\n+use rustc_lint::{EarlyContext, EarlyLintPass};\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+use rustc_span::edition::Edition;\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Checks for `#[macro_use] use...`.\n+    ///\n+    /// **Why is this bad?** Since the Rust 2018 edition you can import\n+    /// macro's directly, this is considered idiomatic.\n+    ///\n+    /// **Known problems:** This lint does not generate an auto-applicable suggestion.\n+    ///\n+    /// **Example:**\n+    /// ```rust\n+    /// #[macro_use]\n+    /// use lazy_static;\n+    /// ```\n+    pub MACRO_USE_IMPORT,\n+    pedantic,\n+    \"#[macro_use] is no longer needed\"\n+}\n+\n+declare_lint_pass!(MacroUseImport => [MACRO_USE_IMPORT]);\n+\n+impl EarlyLintPass for MacroUseImport {\n+    fn check_item(&mut self, ecx: &EarlyContext<'_>, item: &ast::Item) {\n+        if_chain! {\n+            if ecx.sess.opts.edition == Edition::Edition2018;\n+            if let ast::ItemKind::Use(use_tree) = &item.kind;\n+            if let Some(mac_attr) = item\n+                .attrs\n+                .iter()\n+                .find(|attr| attr.ident().map(|s| s.to_string()) == Some(\"macro_use\".to_string()));\n+            then {\n+                let msg = \"`macro_use` attributes are no longer needed in the Rust 2018 edition\";\n+                let help = format!(\"use {}::<macro name>\", snippet(ecx, use_tree.span, \"_\"));\n+                span_lint_and_sugg(\n+                    ecx,\n+                    MACRO_USE_IMPORT,\n+                    mac_attr.span,\n+                    msg,\n+                    \"remove the attribute and import the macro directly, try\",\n+                    help,\n+                    Applicability::HasPlaceholders,\n+                );\n+            }\n+        }\n+    }\n+}"}, {"sha": "1635ff7babd7dd3e4f5ac87aa2ecfd1480bf2ead", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "patch": "@@ -6,7 +6,7 @@ pub use lint::Lint;\n pub use lint::LINT_LEVELS;\n \n // begin lint list, do not remove this comment, it\u2019s used in `update_lints`\n-pub const ALL_LINTS: [Lint; 359] = [\n+pub const ALL_LINTS: [Lint; 360] = [\n     Lint {\n         name: \"absurd_extreme_comparisons\",\n         group: \"correctness\",\n@@ -1015,6 +1015,13 @@ pub const ALL_LINTS: [Lint; 359] = [\n         deprecation: None,\n         module: \"float_literal\",\n     },\n+    Lint {\n+        name: \"macro_use_import\",\n+        group: \"pedantic\",\n+        desc: \"#[macro_use] is no longer needed\",\n+        deprecation: None,\n+        module: \"macro_use\",\n+    },\n     Lint {\n         name: \"main_recursion\",\n         group: \"style\","}, {"sha": "33ce2b524ef7f321f444c5a806d831a62fd7f7f2", "filename": "tests/ui/macro_use_import.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/tests%2Fui%2Fmacro_use_import.rs", "raw_url": "https://github.com/rust-lang/rust/raw/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/tests%2Fui%2Fmacro_use_import.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmacro_use_import.rs?ref=597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "patch": "@@ -0,0 +1,11 @@\n+// compile-flags: --edition 2018\n+#![warn(clippy::macro_use_import)]\n+\n+use std::collections::HashMap;\n+#[macro_use]\n+use std::prelude;\n+\n+fn main() {\n+    let _ = HashMap::<u8, u8>::new();\n+    println!();\n+}"}, {"sha": "1d86ba584411f85d189a980298aa93cbd472a852", "filename": "tests/ui/macro_use_import.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/tests%2Fui%2Fmacro_use_import.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/597e02dcdf28e9cfbb7854bca38c28f2e4d15425/tests%2Fui%2Fmacro_use_import.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmacro_use_import.stderr?ref=597e02dcdf28e9cfbb7854bca38c28f2e4d15425", "patch": "@@ -0,0 +1,10 @@\n+error: `macro_use` attributes are no longer needed in the Rust 2018 edition\n+  --> $DIR/macro_use_import.rs:5:1\n+   |\n+LL | #[macro_use]\n+   | ^^^^^^^^^^^^ help: remove the attribute and import the macro directly, try: `use std::prelude::<macro name>`\n+   |\n+   = note: `-D clippy::macro-use-import` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}