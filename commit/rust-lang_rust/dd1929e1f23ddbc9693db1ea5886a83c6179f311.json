{"sha": "dd1929e1f23ddbc9693db1ea5886a83c6179f311", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRkMTkyOWUxZjIzZGRiYzk2OTNkYjFlYTU4ODZhODNjNjE3OWYzMTE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-04T12:45:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-04T12:45:51Z"}, "message": "Auto merge of #6544 - matthiaskrgr:else_if, r=flip1995\n\ncollapsible_if: split collapsible_else_if into its own lint so we can enable/disable it particularly\n\nThis splits up clippy::collapsible_if into collapsible_if for\nif x {\n  if y { }\n}\n=>\nif x && y { }\n\nand collapsible_else_if for\n\nif x {\n} else {\n if y { }\n}\n\n=>\nif x {\n\n} else if y {\n\n}\n\nso that we can lint for only the latter but not the first if we desire.\n\nchangelog: collapsible_if: split up linting for if x {} else { if y {} } into collapsible_else_if lint", "tree": {"sha": "04e564d863cd453f5494541cfd3125621c7a1293", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04e564d863cd453f5494541cfd3125621c7a1293"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd1929e1f23ddbc9693db1ea5886a83c6179f311", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd1929e1f23ddbc9693db1ea5886a83c6179f311", "html_url": "https://github.com/rust-lang/rust/commit/dd1929e1f23ddbc9693db1ea5886a83c6179f311", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd1929e1f23ddbc9693db1ea5886a83c6179f311/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "895191628d6eda2be70f304a69ddb728a912f696", "url": "https://api.github.com/repos/rust-lang/rust/commits/895191628d6eda2be70f304a69ddb728a912f696", "html_url": "https://github.com/rust-lang/rust/commit/895191628d6eda2be70f304a69ddb728a912f696"}, {"sha": "6dcec6ae863930b7056a68744759d2bfb3481f92", "url": "https://api.github.com/repos/rust-lang/rust/commits/6dcec6ae863930b7056a68744759d2bfb3481f92", "html_url": "https://github.com/rust-lang/rust/commit/6dcec6ae863930b7056a68744759d2bfb3481f92"}], "stats": {"total": 93, "additions": 59, "deletions": 34}, "files": [{"sha": "b643627c2e9a96936f73a3cae6e6eaf43a7c269a", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -1896,6 +1896,7 @@ Released 2018-09-13\n [`cmp_null`]: https://rust-lang.github.io/rust-clippy/master/index.html#cmp_null\n [`cmp_owned`]: https://rust-lang.github.io/rust-clippy/master/index.html#cmp_owned\n [`cognitive_complexity`]: https://rust-lang.github.io/rust-clippy/master/index.html#cognitive_complexity\n+[`collapsible_else_if`]: https://rust-lang.github.io/rust-clippy/master/index.html#collapsible_else_if\n [`collapsible_if`]: https://rust-lang.github.io/rust-clippy/master/index.html#collapsible_if\n [`collapsible_match`]: https://rust-lang.github.io/rust-clippy/master/index.html#collapsible_match\n [`comparison_chain`]: https://rust-lang.github.io/rust-clippy/master/index.html#comparison_chain"}, {"sha": "93ccc76d0c9cdf829ed63b09cae07f21ad6c073d", "filename": "clippy_lints/src/collapsible_if.rs", "status": "modified", "additions": 30, "deletions": 14, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/clippy_lints%2Fsrc%2Fcollapsible_if.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/clippy_lints%2Fsrc%2Fcollapsible_if.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcollapsible_if.rs?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -23,9 +23,7 @@ use rustc_errors::Applicability;\n \n declare_clippy_lint! {\n     /// **What it does:** Checks for nested `if` statements which can be collapsed\n-    /// by `&&`-combining their conditions and for `else { if ... }` expressions\n-    /// that\n-    /// can be collapsed to `else if ...`.\n+    /// by `&&`-combining their conditions.\n     ///\n     /// **Why is this bad?** Each `if`-statement adds one level of nesting, which\n     /// makes code look more complex than it really is.\n@@ -40,7 +38,31 @@ declare_clippy_lint! {\n     ///     }\n     /// }\n     ///\n-    /// // or\n+    /// ```\n+    ///\n+    /// Should be written:\n+    ///\n+    /// ```rust.ignore\n+    /// if x && y {\n+    ///     \u2026\n+    /// }\n+    /// ```\n+    pub COLLAPSIBLE_IF,\n+    style,\n+    \"nested `if`s that can be collapsed (e.g., `if x { if y { ... } }`\"\n+}\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Checks for collapsible `else { if ... }` expressions\n+    /// that can be collapsed to `else if ...`.\n+    ///\n+    /// **Why is this bad?** Each `if`-statement adds one level of nesting, which\n+    /// makes code look more complex than it really is.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    /// ```rust,ignore\n     ///\n     /// if x {\n     ///     \u2026\n@@ -54,24 +76,18 @@ declare_clippy_lint! {\n     /// Should be written:\n     ///\n     /// ```rust.ignore\n-    /// if x && y {\n-    ///     \u2026\n-    /// }\n-    ///\n-    /// // or\n-    ///\n     /// if x {\n     ///     \u2026\n     /// } else if y {\n     ///     \u2026\n     /// }\n     /// ```\n-    pub COLLAPSIBLE_IF,\n+    pub COLLAPSIBLE_ELSE_IF,\n     style,\n-    \"`if`s that can be collapsed (e.g., `if x { if y { ... } }` and `else { if x { ... } }`)\"\n+    \"nested `else`-`if` expressions that can be collapsed (e.g., `else { if x { ... } }`)\"\n }\n \n-declare_lint_pass!(CollapsibleIf => [COLLAPSIBLE_IF]);\n+declare_lint_pass!(CollapsibleIf => [COLLAPSIBLE_IF, COLLAPSIBLE_ELSE_IF]);\n \n impl EarlyLintPass for CollapsibleIf {\n     fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &ast::Expr) {\n@@ -112,7 +128,7 @@ fn check_collapsible_maybe_if_let(cx: &EarlyContext<'_>, else_: &ast::Expr) {\n             let mut applicability = Applicability::MachineApplicable;\n             span_lint_and_sugg(\n                 cx,\n-                COLLAPSIBLE_IF,\n+                COLLAPSIBLE_ELSE_IF,\n                 block.span,\n                 \"this `else { if .. }` block can be collapsed\",\n                 \"collapse nested if block\","}, {"sha": "4f41b6c77e27977a311da6a5175ab61460584cf4", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -556,6 +556,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &cargo_common_metadata::CARGO_COMMON_METADATA,\n         &checked_conversions::CHECKED_CONVERSIONS,\n         &cognitive_complexity::COGNITIVE_COMPLEXITY,\n+        &collapsible_if::COLLAPSIBLE_ELSE_IF,\n         &collapsible_if::COLLAPSIBLE_IF,\n         &collapsible_match::COLLAPSIBLE_MATCH,\n         &comparison_chain::COMPARISON_CHAIN,\n@@ -1384,6 +1385,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&booleans::LOGIC_BUG),\n         LintId::of(&booleans::NONMINIMAL_BOOL),\n         LintId::of(&bytecount::NAIVE_BYTECOUNT),\n+        LintId::of(&collapsible_if::COLLAPSIBLE_ELSE_IF),\n         LintId::of(&collapsible_if::COLLAPSIBLE_IF),\n         LintId::of(&collapsible_match::COLLAPSIBLE_MATCH),\n         LintId::of(&comparison_chain::COMPARISON_CHAIN),\n@@ -1653,6 +1655,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&attrs::UNKNOWN_CLIPPY_LINTS),\n         LintId::of(&blacklisted_name::BLACKLISTED_NAME),\n         LintId::of(&blocks_in_if_conditions::BLOCKS_IN_IF_CONDITIONS),\n+        LintId::of(&collapsible_if::COLLAPSIBLE_ELSE_IF),\n         LintId::of(&collapsible_if::COLLAPSIBLE_IF),\n         LintId::of(&collapsible_match::COLLAPSIBLE_MATCH),\n         LintId::of(&comparison_chain::COMPARISON_CHAIN),"}, {"sha": "fa4bc30e933a2a0ba4252edafe3b7ef9e9e5cbf7", "filename": "tests/ui/collapsible_else_if.fixed", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fcollapsible_else_if.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fcollapsible_else_if.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcollapsible_else_if.fixed?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -3,6 +3,8 @@\n \n #[rustfmt::skip]\n #[warn(clippy::collapsible_if)]\n+#[warn(clippy::collapsible_else_if)]\n+\n fn main() {\n     let x = \"hello\";\n     let y = \"world\";"}, {"sha": "bf6c1d1f894d7807a5c03a00b5e08f02f6ffa30c", "filename": "tests/ui/collapsible_else_if.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fcollapsible_else_if.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fcollapsible_else_if.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcollapsible_else_if.rs?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -3,6 +3,8 @@\n \n #[rustfmt::skip]\n #[warn(clippy::collapsible_if)]\n+#[warn(clippy::collapsible_else_if)]\n+\n fn main() {\n     let x = \"hello\";\n     let y = \"world\";"}, {"sha": "ee3e11ae565d405435cafdbae0e27cf845698ee6", "filename": "tests/ui/collapsible_else_if.stderr", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fcollapsible_else_if.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fcollapsible_else_if.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcollapsible_else_if.stderr?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -1,5 +1,5 @@\n error: this `else { if .. }` block can be collapsed\n-  --> $DIR/collapsible_else_if.rs:12:12\n+  --> $DIR/collapsible_else_if.rs:14:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -9,7 +9,7 @@ LL | |         }\n LL | |     }\n    | |_____^\n    |\n-   = note: `-D clippy::collapsible-if` implied by `-D warnings`\n+   = note: `-D clippy::collapsible-else-if` implied by `-D warnings`\n help: collapse nested if block\n    |\n LL |     } else if y == \"world\" {\n@@ -18,7 +18,7 @@ LL |     }\n    |\n \n error: this `else { if .. }` block can be collapsed\n-  --> $DIR/collapsible_else_if.rs:20:12\n+  --> $DIR/collapsible_else_if.rs:22:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -36,7 +36,7 @@ LL |     }\n    |\n \n error: this `else { if .. }` block can be collapsed\n-  --> $DIR/collapsible_else_if.rs:28:12\n+  --> $DIR/collapsible_else_if.rs:30:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -59,7 +59,7 @@ LL |     }\n    |\n \n error: this `else { if .. }` block can be collapsed\n-  --> $DIR/collapsible_else_if.rs:39:12\n+  --> $DIR/collapsible_else_if.rs:41:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -82,7 +82,7 @@ LL |     }\n    |\n \n error: this `else { if .. }` block can be collapsed\n-  --> $DIR/collapsible_else_if.rs:50:12\n+  --> $DIR/collapsible_else_if.rs:52:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -105,7 +105,7 @@ LL |     }\n    |\n \n error: this `else { if .. }` block can be collapsed\n-  --> $DIR/collapsible_else_if.rs:61:12\n+  --> $DIR/collapsible_else_if.rs:63:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -128,7 +128,7 @@ LL |     }\n    |\n \n error: this `else { if .. }` block can be collapsed\n-  --> $DIR/collapsible_else_if.rs:72:12\n+  --> $DIR/collapsible_else_if.rs:74:12\n    |\n LL |       } else {\n    |  ____________^"}, {"sha": "e83ce47e563080b5a25e0bad69d0d57fc3c581be", "filename": "tests/ui/if_same_then_else2.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fif_same_then_else2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fif_same_then_else2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fif_same_then_else2.rs?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -1,6 +1,7 @@\n #![warn(clippy::if_same_then_else)]\n #![allow(\n     clippy::blacklisted_name,\n+    clippy::collapsible_else_if,\n     clippy::collapsible_if,\n     clippy::ifs_same_cond,\n     clippy::needless_return,"}, {"sha": "f98e30fa376fea22a8198cb4faffd5218ba94dad", "filename": "tests/ui/if_same_then_else2.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fif_same_then_else2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dd1929e1f23ddbc9693db1ea5886a83c6179f311/tests%2Fui%2Fif_same_then_else2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fif_same_then_else2.stderr?ref=dd1929e1f23ddbc9693db1ea5886a83c6179f311", "patch": "@@ -1,5 +1,5 @@\n error: this `if` has identical blocks\n-  --> $DIR/if_same_then_else2.rs:20:12\n+  --> $DIR/if_same_then_else2.rs:21:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -13,7 +13,7 @@ LL | |     }\n    |\n    = note: `-D clippy::if-same-then-else` implied by `-D warnings`\n note: same as this\n-  --> $DIR/if_same_then_else2.rs:11:13\n+  --> $DIR/if_same_then_else2.rs:12:13\n    |\n LL |       if true {\n    |  _____________^\n@@ -26,7 +26,7 @@ LL | |     } else {\n    | |_____^\n \n error: this `if` has identical blocks\n-  --> $DIR/if_same_then_else2.rs:34:12\n+  --> $DIR/if_same_then_else2.rs:35:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -36,7 +36,7 @@ LL | |     }\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/if_same_then_else2.rs:32:13\n+  --> $DIR/if_same_then_else2.rs:33:13\n    |\n LL |       if true {\n    |  _____________^\n@@ -45,7 +45,7 @@ LL | |     } else {\n    | |_____^\n \n error: this `if` has identical blocks\n-  --> $DIR/if_same_then_else2.rs:41:12\n+  --> $DIR/if_same_then_else2.rs:42:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -55,7 +55,7 @@ LL | |     }\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/if_same_then_else2.rs:39:13\n+  --> $DIR/if_same_then_else2.rs:40:13\n    |\n LL |       if true {\n    |  _____________^\n@@ -64,7 +64,7 @@ LL | |     } else {\n    | |_____^\n \n error: this `if` has identical blocks\n-  --> $DIR/if_same_then_else2.rs:91:12\n+  --> $DIR/if_same_then_else2.rs:92:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -74,7 +74,7 @@ LL | |     };\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/if_same_then_else2.rs:89:21\n+  --> $DIR/if_same_then_else2.rs:90:21\n    |\n LL |       let _ = if true {\n    |  _____________________^\n@@ -83,7 +83,7 @@ LL | |     } else {\n    | |_____^\n \n error: this `if` has identical blocks\n-  --> $DIR/if_same_then_else2.rs:98:12\n+  --> $DIR/if_same_then_else2.rs:99:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -93,7 +93,7 @@ LL | |     }\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/if_same_then_else2.rs:96:13\n+  --> $DIR/if_same_then_else2.rs:97:13\n    |\n LL |       if true {\n    |  _____________^\n@@ -102,7 +102,7 @@ LL | |     } else {\n    | |_____^\n \n error: this `if` has identical blocks\n-  --> $DIR/if_same_then_else2.rs:123:12\n+  --> $DIR/if_same_then_else2.rs:124:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -112,7 +112,7 @@ LL | |     }\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/if_same_then_else2.rs:120:20\n+  --> $DIR/if_same_then_else2.rs:121:20\n    |\n LL |       } else if true {\n    |  ____________________^"}]}