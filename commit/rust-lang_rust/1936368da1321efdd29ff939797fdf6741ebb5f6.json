{"sha": "1936368da1321efdd29ff939797fdf6741ebb5f6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5MzYzNjhkYTEzMjFlZmRkMjlmZjkzOTc5N2ZkZjY3NDFlYmI1ZjY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-17T01:50:58Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-17T01:50:58Z"}, "message": "Auto merge of #3976 - phansch:deref_addrof_rustfix, r=flip1995\n\nAdd run-rustfix for deref_addrof lint\n\n* renames `tests/ui/reference.{rs,stderr}` to\n  `tests/ui/deref_addrof.{rs,stderr}\n* Moves small part of the testfile to a separate file as the lint\n  triggered again on the fixed code (as intended)\n* Adds `// run-rustfix` to `tests/ui/deref_addrof.rs`\n\ncc #3630", "tree": {"sha": "afc01a084454d7050f0b948e84208d176eb01759", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/afc01a084454d7050f0b948e84208d176eb01759"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1936368da1321efdd29ff939797fdf6741ebb5f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1936368da1321efdd29ff939797fdf6741ebb5f6", "html_url": "https://github.com/rust-lang/rust/commit/1936368da1321efdd29ff939797fdf6741ebb5f6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1936368da1321efdd29ff939797fdf6741ebb5f6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1132caabff794484c02f0d967b8f9a698e4597ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/1132caabff794484c02f0d967b8f9a698e4597ba", "html_url": "https://github.com/rust-lang/rust/commit/1132caabff794484c02f0d967b8f9a698e4597ba"}, {"sha": "d1e84c615c31be8fa6ca40fddaabc5ed30910efa", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1e84c615c31be8fa6ca40fddaabc5ed30910efa", "html_url": "https://github.com/rust-lang/rust/commit/d1e84c615c31be8fa6ca40fddaabc5ed30910efa"}], "stats": {"total": 138, "additions": 94, "deletions": 44}, "files": [{"sha": "9e5b51d6d5e6d5da7344e0bdc33bacb163882010", "filename": "tests/ui/deref_addrof.fixed", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderef_addrof.fixed?ref=1936368da1321efdd29ff939797fdf6741ebb5f6", "patch": "@@ -0,0 +1,39 @@\n+// run-rustfix\n+\n+fn get_number() -> usize {\n+    10\n+}\n+\n+fn get_reference(n: &usize) -> &usize {\n+    n\n+}\n+\n+#[allow(clippy::many_single_char_names, clippy::double_parens)]\n+#[allow(unused_variables, unused_parens)]\n+#[warn(clippy::deref_addrof)]\n+fn main() {\n+    let a = 10;\n+    let aref = &a;\n+\n+    let b = a;\n+\n+    let b = get_number();\n+\n+    let b = *get_reference(&a);\n+\n+    let bytes: Vec<usize> = vec![1, 2, 3, 4];\n+    let b = bytes[1..2][0];\n+\n+    //This produces a suggestion of 'let b = (a);' which\n+    //will trigger the 'unused_parens' lint\n+    let b = (a);\n+\n+    let b = a;\n+\n+    #[rustfmt::skip]\n+    let b = a;\n+\n+    let b = &a;\n+\n+    let b = *aref;\n+}"}, {"sha": "5641a73cbc1cb1b73e766dbbfb8de1d515a12e6d", "filename": "tests/ui/deref_addrof.rs", "status": "renamed", "additions": 3, "deletions": 17, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderef_addrof.rs?ref=1936368da1321efdd29ff939797fdf6741ebb5f6", "patch": "@@ -1,3 +1,5 @@\n+// run-rustfix\n+\n fn get_number() -> usize {\n     10\n }\n@@ -7,7 +9,7 @@ fn get_reference(n: &usize) -> &usize {\n }\n \n #[allow(clippy::many_single_char_names, clippy::double_parens)]\n-#[allow(unused_variables)]\n+#[allow(unused_variables, unused_parens)]\n #[warn(clippy::deref_addrof)]\n fn main() {\n     let a = 10;\n@@ -34,20 +36,4 @@ fn main() {\n     let b = *&&a;\n \n     let b = **&aref;\n-\n-    //This produces a suggestion of 'let b = *&a;' which\n-    //will trigger the 'clippy::deref_addrof' lint again\n-    let b = **&&a;\n-\n-    {\n-        let mut x = 10;\n-        let y = *&mut x;\n-    }\n-\n-    {\n-        //This produces a suggestion of 'let y = *&mut x' which\n-        //will trigger the 'clippy::deref_addrof' lint again\n-        let mut x = 10;\n-        let y = **&mut &mut x;\n-    }\n }", "previous_filename": "tests/ui/reference.rs"}, {"sha": "bc51719e8a7a0e6bb9dfd4a4c4137208b59e8891", "filename": "tests/ui/deref_addrof.stderr", "status": "renamed", "additions": 9, "deletions": 27, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderef_addrof.stderr?ref=1936368da1321efdd29ff939797fdf6741ebb5f6", "patch": "@@ -1,70 +1,52 @@\n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:16:13\n+  --> $DIR/deref_addrof.rs:18:13\n    |\n LL |     let b = *&a;\n    |             ^^^ help: try this: `a`\n    |\n    = note: `-D clippy::deref-addrof` implied by `-D warnings`\n \n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:18:13\n+  --> $DIR/deref_addrof.rs:20:13\n    |\n LL |     let b = *&get_number();\n    |             ^^^^^^^^^^^^^^ help: try this: `get_number()`\n \n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:23:13\n+  --> $DIR/deref_addrof.rs:25:13\n    |\n LL |     let b = *&bytes[1..2][0];\n    |             ^^^^^^^^^^^^^^^^ help: try this: `bytes[1..2][0]`\n \n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:27:13\n+  --> $DIR/deref_addrof.rs:29:13\n    |\n LL |     let b = *&(a);\n    |             ^^^^^ help: try this: `(a)`\n \n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:29:13\n+  --> $DIR/deref_addrof.rs:31:13\n    |\n LL |     let b = *(&a);\n    |             ^^^^^ help: try this: `a`\n \n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:32:13\n+  --> $DIR/deref_addrof.rs:34:13\n    |\n LL |     let b = *((&a));\n    |             ^^^^^^^ help: try this: `a`\n \n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:34:13\n+  --> $DIR/deref_addrof.rs:36:13\n    |\n LL |     let b = *&&a;\n    |             ^^^^ help: try this: `&a`\n \n error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:36:14\n+  --> $DIR/deref_addrof.rs:38:14\n    |\n LL |     let b = **&aref;\n    |              ^^^^^^ help: try this: `aref`\n \n-error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:40:14\n-   |\n-LL |     let b = **&&a;\n-   |              ^^^^ help: try this: `&a`\n-\n-error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:44:17\n-   |\n-LL |         let y = *&mut x;\n-   |                 ^^^^^^^ help: try this: `x`\n-\n-error: immediately dereferencing a reference\n-  --> $DIR/reference.rs:51:18\n-   |\n-LL |         let y = **&mut &mut x;\n-   |                  ^^^^^^^^^^^^ help: try this: `&mut x`\n-\n-error: aborting due to 11 previous errors\n+error: aborting due to 8 previous errors\n ", "previous_filename": "tests/ui/reference.stderr"}, {"sha": "e19af5b9087faabb1d3753dabfafca40959bcbaf", "filename": "tests/ui/deref_addrof_double_trigger.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof_double_trigger.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof_double_trigger.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderef_addrof_double_trigger.rs?ref=1936368da1321efdd29ff939797fdf6741ebb5f6", "patch": "@@ -0,0 +1,21 @@\n+#[warn(clippy::deref_addrof)]\n+#[allow(unused_variables)]\n+fn main() {\n+    let a = 10;\n+\n+    //This produces a suggestion of 'let b = *&a;' which\n+    //will trigger the 'clippy::deref_addrof' lint again\n+    let b = **&&a;\n+\n+    {\n+        let mut x = 10;\n+        let y = *&mut x;\n+    }\n+\n+    {\n+        //This produces a suggestion of 'let y = *&mut x' which\n+        //will trigger the 'clippy::deref_addrof' lint again\n+        let mut x = 10;\n+        let y = **&mut &mut x;\n+    }\n+}"}, {"sha": "89284e1a8ed68847c2adc9c5f71cfad13b4c7772", "filename": "tests/ui/deref_addrof_double_trigger.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof_double_trigger.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1936368da1321efdd29ff939797fdf6741ebb5f6/tests%2Fui%2Fderef_addrof_double_trigger.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderef_addrof_double_trigger.stderr?ref=1936368da1321efdd29ff939797fdf6741ebb5f6", "patch": "@@ -0,0 +1,22 @@\n+error: immediately dereferencing a reference\n+  --> $DIR/deref_addrof_double_trigger.rs:8:14\n+   |\n+LL |     let b = **&&a;\n+   |              ^^^^ help: try this: `&a`\n+   |\n+   = note: `-D clippy::deref-addrof` implied by `-D warnings`\n+\n+error: immediately dereferencing a reference\n+  --> $DIR/deref_addrof_double_trigger.rs:12:17\n+   |\n+LL |         let y = *&mut x;\n+   |                 ^^^^^^^ help: try this: `x`\n+\n+error: immediately dereferencing a reference\n+  --> $DIR/deref_addrof_double_trigger.rs:19:18\n+   |\n+LL |         let y = **&mut &mut x;\n+   |                  ^^^^^^^^^^^^ help: try this: `&mut x`\n+\n+error: aborting due to 3 previous errors\n+"}]}