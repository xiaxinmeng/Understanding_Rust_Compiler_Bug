{"sha": "3f144e119ec958b2a6ac3db3568b1bd2b3ba488a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmMTQ0ZTExOWVjOTU4YjJhNmFjM2RiMzU2OGIxYmQyYjNiYTQ4OGE=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-13T12:41:27Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-13T23:44:44Z"}, "message": "Move Toc printing from fmt::Display", "tree": {"sha": "c428b5461f338782ba6ba751d69a5b9186737180", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c428b5461f338782ba6ba751d69a5b9186737180"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a", "html_url": "https://github.com/rust-lang/rust/commit/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a9dab3a203ef26c6f8477bd388f2394747d598e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a9dab3a203ef26c6f8477bd388f2394747d598e", "html_url": "https://github.com/rust-lang/rust/commit/8a9dab3a203ef26c6f8477bd388f2394747d598e"}], "stats": {"total": 39, "additions": 17, "deletions": 22}, "files": [{"sha": "9ff1e1d31197d28d8538369a788da11130d16ad9", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=3f144e119ec958b2a6ac3db3568b1bd2b3ba488a", "patch": "@@ -752,7 +752,7 @@ impl MarkdownWithToc<'_> {\n             html::push_html(&mut s, p);\n         }\n \n-        format!(\"<nav id=\\\"TOC\\\">{}</nav>{}\", toc.into_toc(), s)\n+        format!(\"<nav id=\\\"TOC\\\">{}</nav>{}\", toc.into_toc().print(), s)\n     }\n }\n "}, {"sha": "0fb2f8dd7962ab09774069176b92b7cec5bc500d", "filename": "src/librustdoc/html/toc.rs", "status": "modified", "additions": 16, "deletions": 21, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a/src%2Flibrustdoc%2Fhtml%2Ftoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f144e119ec958b2a6ac3db3568b1bd2b3ba488a/src%2Flibrustdoc%2Fhtml%2Ftoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftoc.rs?ref=3f144e119ec958b2a6ac3db3568b1bd2b3ba488a", "patch": "@@ -1,10 +1,7 @@\n //! Table-of-contents creation.\n \n-use std::fmt;\n-use std::string::String;\n-\n /// A (recursive) table of contents\n-#[derive(PartialEq)]\n+#[derive(Debug, PartialEq)]\n pub struct Toc {\n     /// The levels are strictly decreasing, i.e.\n     ///\n@@ -28,7 +25,7 @@ impl Toc {\n     }\n }\n \n-#[derive(PartialEq)]\n+#[derive(Debug, PartialEq)]\n pub struct TocEntry {\n     level: u32,\n     sec_number: String,\n@@ -165,25 +162,23 @@ impl TocBuilder {\n     }\n }\n \n-impl fmt::Debug for Toc {\n-    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n-        fmt::Display::fmt(self, f)\n-    }\n-}\n-\n-impl fmt::Display for Toc {\n-    fn fmt(&self, fmt: &mut fmt::Formatter<'_>) -> fmt::Result {\n-        write!(fmt, \"<ul>\")?;\n+impl Toc {\n+    fn print_inner(&self, v: &mut String) {\n+        v.push_str(\"<ul>\");\n         for entry in &self.entries {\n-            // recursively format this table of contents (the\n-            // `{children}` is the key).\n-            write!(fmt,\n-                   \"\\n<li><a href=\\\"#{id}\\\">{num} {name}</a>{children}</li>\",\n+            // recursively format this table of contents\n+            v.push_str(&format!(\"\\n<li><a href=\\\"#{id}\\\">{num} {name}</a>\",\n                    id = entry.id,\n-                   num = entry.sec_number, name = entry.name,\n-                   children = entry.children)?\n+                   num = entry.sec_number, name = entry.name));\n+            entry.children.print_inner(&mut *v);\n+            v.push_str(\"</li>\");\n         }\n-        write!(fmt, \"</ul>\")\n+        v.push_str(\"</ul>\");\n+    }\n+    crate fn print(&self) -> String {\n+        let mut v = String::new();\n+        self.print_inner(&mut v);\n+        v\n     }\n }\n "}]}