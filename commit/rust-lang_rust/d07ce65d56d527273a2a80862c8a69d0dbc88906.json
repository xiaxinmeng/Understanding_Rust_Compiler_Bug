{"sha": "d07ce65d56d527273a2a80862c8a69d0dbc88906", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQwN2NlNjVkNTZkNTI3MjczYTJhODA4NjJjOGE2OWQwZGJjODg5MDY=", "commit": {"author": {"name": "D\u00e1niel Buga", "email": "bugadani@gmail.com", "date": "2020-10-20T08:37:56Z"}, "committer": {"name": "D\u00e1niel Buga", "email": "bugadani@gmail.com", "date": "2020-10-20T08:37:56Z"}, "message": "Resolve: Use dropless arena for types that don't need drop", "tree": {"sha": "be89e606cd2fee771d650c25dc0da740aae98b5c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be89e606cd2fee771d650c25dc0da740aae98b5c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d07ce65d56d527273a2a80862c8a69d0dbc88906", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d07ce65d56d527273a2a80862c8a69d0dbc88906", "html_url": "https://github.com/rust-lang/rust/commit/d07ce65d56d527273a2a80862c8a69d0dbc88906", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d07ce65d56d527273a2a80862c8a69d0dbc88906/comments", "author": {"login": "bugadani", "id": 977627, "node_id": "MDQ6VXNlcjk3NzYyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/977627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bugadani", "html_url": "https://github.com/bugadani", "followers_url": "https://api.github.com/users/bugadani/followers", "following_url": "https://api.github.com/users/bugadani/following{/other_user}", "gists_url": "https://api.github.com/users/bugadani/gists{/gist_id}", "starred_url": "https://api.github.com/users/bugadani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bugadani/subscriptions", "organizations_url": "https://api.github.com/users/bugadani/orgs", "repos_url": "https://api.github.com/users/bugadani/repos", "events_url": "https://api.github.com/users/bugadani/events{/privacy}", "received_events_url": "https://api.github.com/users/bugadani/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bugadani", "id": 977627, "node_id": "MDQ6VXNlcjk3NzYyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/977627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bugadani", "html_url": "https://github.com/bugadani", "followers_url": "https://api.github.com/users/bugadani/followers", "following_url": "https://api.github.com/users/bugadani/following{/other_user}", "gists_url": "https://api.github.com/users/bugadani/gists{/gist_id}", "starred_url": "https://api.github.com/users/bugadani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bugadani/subscriptions", "organizations_url": "https://api.github.com/users/bugadani/orgs", "repos_url": "https://api.github.com/users/bugadani/repos", "events_url": "https://api.github.com/users/bugadani/events{/privacy}", "received_events_url": "https://api.github.com/users/bugadani/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a85e94927622665a9e9022de0d33a890a2e32d43", "url": "https://api.github.com/repos/rust-lang/rust/commits/a85e94927622665a9e9022de0d33a890a2e32d43", "html_url": "https://github.com/rust-lang/rust/commit/a85e94927622665a9e9022de0d33a890a2e32d43"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "170fece32f10b4843bbe6b42fbfffed47ef5948a", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d07ce65d56d527273a2a80862c8a69d0dbc88906/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d07ce65d56d527273a2a80862c8a69d0dbc88906/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=d07ce65d56d527273a2a80862c8a69d0dbc88906", "patch": "@@ -19,7 +19,7 @@ pub use rustc_hir::def::{Namespace, PerNS};\n \n use Determinacy::*;\n \n-use rustc_arena::TypedArena;\n+use rustc_arena::{DroplessArena, TypedArena};\n use rustc_ast::node_id::NodeMap;\n use rustc_ast::unwrap_or;\n use rustc_ast::visit::{self, Visitor};\n@@ -1035,12 +1035,10 @@ pub struct Resolver<'a> {\n pub struct ResolverArenas<'a> {\n     modules: TypedArena<ModuleData<'a>>,\n     local_modules: RefCell<Vec<Module<'a>>>,\n-    name_bindings: TypedArena<NameBinding<'a>>,\n     imports: TypedArena<Import<'a>>,\n     name_resolutions: TypedArena<RefCell<NameResolution<'a>>>,\n-    macro_rules_bindings: TypedArena<MacroRulesBinding<'a>>,\n     ast_paths: TypedArena<ast::Path>,\n-    pattern_spans: TypedArena<Span>,\n+    dropless: DroplessArena,\n }\n \n impl<'a> ResolverArenas<'a> {\n@@ -1055,7 +1053,7 @@ impl<'a> ResolverArenas<'a> {\n         self.local_modules.borrow()\n     }\n     fn alloc_name_binding(&'a self, name_binding: NameBinding<'a>) -> &'a NameBinding<'a> {\n-        self.name_bindings.alloc(name_binding)\n+        self.dropless.alloc(name_binding)\n     }\n     fn alloc_import(&'a self, import: Import<'a>) -> &'a Import<'_> {\n         self.imports.alloc(import)\n@@ -1067,13 +1065,13 @@ impl<'a> ResolverArenas<'a> {\n         &'a self,\n         binding: MacroRulesBinding<'a>,\n     ) -> &'a MacroRulesBinding<'a> {\n-        self.macro_rules_bindings.alloc(binding)\n+        self.dropless.alloc(binding)\n     }\n     fn alloc_ast_paths(&'a self, paths: &[ast::Path]) -> &'a [ast::Path] {\n         self.ast_paths.alloc_from_iter(paths.iter().cloned())\n     }\n     fn alloc_pattern_spans(&'a self, spans: impl Iterator<Item = Span>) -> &'a [Span] {\n-        self.pattern_spans.alloc_from_iter(spans)\n+        self.dropless.alloc_from_iter(spans)\n     }\n }\n "}]}