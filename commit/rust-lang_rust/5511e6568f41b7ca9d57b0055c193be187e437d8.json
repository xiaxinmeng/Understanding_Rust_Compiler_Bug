{"sha": "5511e6568f41b7ca9d57b0055c193be187e437d8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1MTFlNjU2OGY0MWI3Y2E5ZDU3YjAwNTVjMTkzYmUxODdlNDM3ZDg=", "commit": {"author": {"name": "Ms2ger", "email": "Ms2ger@gmail.com", "date": "2016-05-10T13:43:51Z"}, "committer": {"name": "Ms2ger", "email": "Ms2ger@gmail.com", "date": "2016-05-11T07:32:05Z"}, "message": "Hand ownership of the Definitions to map_crate.", "tree": {"sha": "9fc9ebd5de11331e2d58e909f1d207f75ec60ab1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9fc9ebd5de11331e2d58e909f1d207f75ec60ab1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5511e6568f41b7ca9d57b0055c193be187e437d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5511e6568f41b7ca9d57b0055c193be187e437d8", "html_url": "https://github.com/rust-lang/rust/commit/5511e6568f41b7ca9d57b0055c193be187e437d8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5511e6568f41b7ca9d57b0055c193be187e437d8/comments", "author": {"login": "Ms2ger", "id": 111161, "node_id": "MDQ6VXNlcjExMTE2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/111161?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ms2ger", "html_url": "https://github.com/Ms2ger", "followers_url": "https://api.github.com/users/Ms2ger/followers", "following_url": "https://api.github.com/users/Ms2ger/following{/other_user}", "gists_url": "https://api.github.com/users/Ms2ger/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ms2ger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ms2ger/subscriptions", "organizations_url": "https://api.github.com/users/Ms2ger/orgs", "repos_url": "https://api.github.com/users/Ms2ger/repos", "events_url": "https://api.github.com/users/Ms2ger/events{/privacy}", "received_events_url": "https://api.github.com/users/Ms2ger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Ms2ger", "id": 111161, "node_id": "MDQ6VXNlcjExMTE2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/111161?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ms2ger", "html_url": "https://github.com/Ms2ger", "followers_url": "https://api.github.com/users/Ms2ger/followers", "following_url": "https://api.github.com/users/Ms2ger/following{/other_user}", "gists_url": "https://api.github.com/users/Ms2ger/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ms2ger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ms2ger/subscriptions", "organizations_url": "https://api.github.com/users/Ms2ger/orgs", "repos_url": "https://api.github.com/users/Ms2ger/repos", "events_url": "https://api.github.com/users/Ms2ger/events{/privacy}", "received_events_url": "https://api.github.com/users/Ms2ger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e919f251800b792e15b3c72cdfb19e539cd74971", "url": "https://api.github.com/repos/rust-lang/rust/commits/e919f251800b792e15b3c72cdfb19e539cd74971", "html_url": "https://github.com/rust-lang/rust/commit/e919f251800b792e15b3c72cdfb19e539cd74971"}], "stats": {"total": 14, "additions": 4, "deletions": 10}, "files": [{"sha": "f0eb580cfd57e70c494ba0e25776eab2069d0e8c", "filename": "src/librustc/hir/map/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs?ref=5511e6568f41b7ca9d57b0055c193be187e437d8", "patch": "@@ -196,7 +196,7 @@ pub struct Map<'ast> {\n     /// plain old integers.\n     map: RefCell<Vec<MapEntry<'ast>>>,\n \n-    definitions: &'ast RefCell<Definitions>,\n+    definitions: RefCell<Definitions>,\n }\n \n impl<'ast> Map<'ast> {\n@@ -790,7 +790,7 @@ pub fn collect_definitions<'ast>(krate: &'ast ast::Crate) -> Definitions {\n }\n \n pub fn map_crate<'ast>(forest: &'ast mut Forest,\n-                       definitions: &'ast RefCell<Definitions>)\n+                       definitions: Definitions)\n                        -> Map<'ast> {\n     let mut collector = NodeCollector::root(&forest.krate);\n     intravisit::walk_crate(&mut collector, &forest.krate);\n@@ -816,7 +816,7 @@ pub fn map_crate<'ast>(forest: &'ast mut Forest,\n         forest: forest,\n         dep_graph: forest.dep_graph.clone(),\n         map: RefCell::new(map),\n-        definitions: definitions,\n+        definitions: RefCell::new(definitions),\n     }\n }\n "}, {"sha": "a979410ca94de1ecaa30d8ae03ce54a791f4817d", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=5511e6568f41b7ca9d57b0055c193be187e437d8", "patch": "@@ -165,7 +165,6 @@ pub fn compile_input(sess: &Session,\n             syntax::ext::mtwt::clear_tables();\n         }\n \n-        let defs = &RefCell::new(defs);\n         let arenas = ty::CtxtArenas::new();\n \n         // Construct the HIR map"}, {"sha": "270376bda766e3104e9d80401007cae8ae2cffc6", "filename": "src/librustc_driver/test.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustc_driver%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustc_driver%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Ftest.rs?ref=5511e6568f41b7ca9d57b0055c193be187e437d8", "patch": "@@ -29,7 +29,6 @@ use rustc_metadata::cstore::CStore;\n use rustc_metadata::creader::LocalCrateReader;\n use rustc::hir::map as hir_map;\n use rustc::session::{self, config};\n-use std::cell::RefCell;\n use std::rc::Rc;\n use syntax::ast;\n use syntax::abi::Abi;\n@@ -129,7 +128,6 @@ fn test_env<F>(source_string: &str,\n                                   MakeGlobMap::No)\n     };\n \n-    let defs = &RefCell::new(defs);\n     let arenas = ty::CtxtArenas::new();\n     let ast_map = hir_map::map_crate(&mut hir_forest, defs);\n "}, {"sha": "e5919a4b35ff6dc1aae7dd33cee7f787f3072f86", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=5511e6568f41b7ca9d57b0055c193be187e437d8", "patch": "@@ -162,7 +162,6 @@ pub fn run_core(search_paths: SearchPaths,\n                                   resolve::MakeGlobMap::No)\n     };\n \n-    let defs = &RefCell::new(defs);\n     let arenas = ty::CtxtArenas::new();\n     let hir_map = hir_map::map_crate(&mut hir_forest, defs);\n "}, {"sha": "c57452b6e2fc38bbe18b22912b32e351fd6d40a9", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=5511e6568f41b7ca9d57b0055c193be187e437d8", "patch": "@@ -95,7 +95,7 @@ pub fn run(input: &str,\n         .expect(\"phase_2_configure_and_expand aborted in rustdoc!\");\n     let krate = driver::assign_node_ids(&sess, krate);\n     let dep_graph = DepGraph::new(false);\n-    let defs = &RefCell::new(hir_map::collect_definitions(&krate));\n+    let defs = hir_map::collect_definitions(&krate);\n \n     let mut dummy_resolver = DummyResolver;\n     let lcx = LoweringContext::new(&sess, Some(&krate), &mut dummy_resolver);"}, {"sha": "a2893fa2f0dc0bdd8ac7078400fc945b10c159fd", "filename": "src/test/run-make/execution-engine/test.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Ftest%2Frun-make%2Fexecution-engine%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5511e6568f41b7ca9d57b0055c193be187e437d8/src%2Ftest%2Frun-make%2Fexecution-engine%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fexecution-engine%2Ftest.rs?ref=5511e6568f41b7ca9d57b0055c193be187e437d8", "patch": "@@ -20,7 +20,6 @@ extern crate rustc_metadata;\n extern crate rustc_resolve;\n #[macro_use] extern crate syntax;\n \n-use std::cell::RefCell;\n use std::ffi::{CStr, CString};\n use std::mem::transmute;\n use std::path::PathBuf;\n@@ -246,7 +245,6 @@ fn compile_program(input: &str, sysroot: PathBuf)\n             driver::lower_and_resolve(&sess, &id, &mut defs, &krate, dep_graph, MakeGlobMap::No)\n         };\n \n-        let defs = &RefCell::new(defs);\n         let arenas = ty::CtxtArenas::new();\n         let ast_map = ast_map::map_crate(&mut hir_forest, defs);\n "}]}