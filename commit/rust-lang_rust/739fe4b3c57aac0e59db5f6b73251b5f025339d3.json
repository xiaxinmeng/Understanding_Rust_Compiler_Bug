{"sha": "739fe4b3c57aac0e59db5f6b73251b5f025339d3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczOWZlNGIzYzU3YWFjMGU1OWRiNWY2YjczMjUxYjVmMDI1MzM5ZDM=", "commit": {"author": {"name": "Brad Campbell", "email": "bradjc5@gmail.com", "date": "2018-06-23T09:49:02Z"}, "committer": {"name": "Brad Campbell", "email": "bradjc5@gmail.com", "date": "2018-06-23T09:57:32Z"}, "message": "build: add llvm-tools to manifest\n\nThis commit expands on a previous commit to build llvm-tools as a rustup\ncomponent. It causes the llvm-tools component to be built if the\nextended step is active. It also adds llvm-tools to the build manifest\nso rustup can find it.", "tree": {"sha": "a0875df3a55bd9f9971bdf9ec2cca9fb8b211ac0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0875df3a55bd9f9971bdf9ec2cca9fb8b211ac0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/739fe4b3c57aac0e59db5f6b73251b5f025339d3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEnxqH+pQGiDPBs9tsGTuB0y9xMloFAlsuGY4ACgkQGTuB0y9x\nMlp4Yg//cNnLVPXCNiH/9vnSZ2JBSmxwenlPUBpl8ut+WFB+aT8OSCsxR/sXXwMF\nwmJ9LN719X9zhukEoSYf8BIgnbZloZdVtPJaVoE0isM3eiM1JvVQUE+6Vwhy1fNh\n6O0llNaiVI3O+/1vSQn10xqEJoqOL4zhyG3GdEjIvm72kftSOmaF058vjPuMYHod\n0hOwjcQejMHyqOiPSwOdygkxHzuSep6aFaDZ2NKsnsLmHPOudnL5bmQJDPf9LnBk\nrqK18S6ifYIw4przsIynDgzh3auuiiIc5SRixeVdoKXzSE5Z/nZAuhRw7Upra3gY\nCiKQZjWG8MUqOVzf/qZUIhTCz3WW5DKithRd05NDexQGwYQ498JhAN00IhK5r/WP\nV3v+wAZbgKeawrQOzwXZblT9+dAupaqDnp+D8OJRnQ3560/tUIkjcGVhgKdlKn6G\nrTLkI/Lvha2LvUE9mncZbWRHAV1VWhpB9gbTFdTy7Q+9BiqzRbZjg8njpHMtb5oC\ntEM2uDLg3sU7UgS48alixWAv97/6iKuRuQrLpdKuNeuMmsGWTylI63lQ8bLl9tIR\n2Eo4Rzs5VqCMeIGb1QxqZtqZ1RI/2MV25ePc/9c/Is+3JjXZpHV9yn3ZqSSzMTZI\nf59915REP/VhP2KOrAwu1EhbqfHHkIWWbFIcL7/VbnrrHUd+wfE=\n=1BPG\n-----END PGP SIGNATURE-----", "payload": "tree a0875df3a55bd9f9971bdf9ec2cca9fb8b211ac0\nparent f9686334ac0c71e1f2137d44f7e471292c1251da\nauthor Brad Campbell <bradjc5@gmail.com> 1529747342 -0400\ncommitter Brad Campbell <bradjc5@gmail.com> 1529747852 -0400\n\nbuild: add llvm-tools to manifest\n\nThis commit expands on a previous commit to build llvm-tools as a rustup\ncomponent. It causes the llvm-tools component to be built if the\nextended step is active. It also adds llvm-tools to the build manifest\nso rustup can find it.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/739fe4b3c57aac0e59db5f6b73251b5f025339d3", "html_url": "https://github.com/rust-lang/rust/commit/739fe4b3c57aac0e59db5f6b73251b5f025339d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/739fe4b3c57aac0e59db5f6b73251b5f025339d3/comments", "author": {"login": "bradjc", "id": 1467890, "node_id": "MDQ6VXNlcjE0Njc4OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1467890?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bradjc", "html_url": "https://github.com/bradjc", "followers_url": "https://api.github.com/users/bradjc/followers", "following_url": "https://api.github.com/users/bradjc/following{/other_user}", "gists_url": "https://api.github.com/users/bradjc/gists{/gist_id}", "starred_url": "https://api.github.com/users/bradjc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bradjc/subscriptions", "organizations_url": "https://api.github.com/users/bradjc/orgs", "repos_url": "https://api.github.com/users/bradjc/repos", "events_url": "https://api.github.com/users/bradjc/events{/privacy}", "received_events_url": "https://api.github.com/users/bradjc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bradjc", "id": 1467890, "node_id": "MDQ6VXNlcjE0Njc4OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1467890?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bradjc", "html_url": "https://github.com/bradjc", "followers_url": "https://api.github.com/users/bradjc/followers", "following_url": "https://api.github.com/users/bradjc/following{/other_user}", "gists_url": "https://api.github.com/users/bradjc/gists{/gist_id}", "starred_url": "https://api.github.com/users/bradjc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bradjc/subscriptions", "organizations_url": "https://api.github.com/users/bradjc/orgs", "repos_url": "https://api.github.com/users/bradjc/repos", "events_url": "https://api.github.com/users/bradjc/events{/privacy}", "received_events_url": "https://api.github.com/users/bradjc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9686334ac0c71e1f2137d44f7e471292c1251da", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9686334ac0c71e1f2137d44f7e471292c1251da", "html_url": "https://github.com/rust-lang/rust/commit/f9686334ac0c71e1f2137d44f7e471292c1251da"}], "stats": {"total": 52, "additions": 32, "deletions": 20}, "files": [{"sha": "bb82f5157f01338c8246d0dc1e99cc2bb7a26334", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/739fe4b3c57aac0e59db5f6b73251b5f025339d3/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/739fe4b3c57aac0e59db5f6b73251b5f025339d3/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=739fe4b3c57aac0e59db5f6b73251b5f025339d3", "patch": "@@ -44,7 +44,7 @@ pub fn pkgname(builder: &Builder, component: &str) -> String {\n     } else if component == \"rustfmt\" {\n         format!(\"{}-{}\", component, builder.rustfmt_package_vers())\n     } else if component == \"llvm-tools\" {\n-        format!(\"{}-{}\", component, builder.llvm_tools_vers())\n+        format!(\"{}-{}\", component, builder.llvm_tools_package_vers())\n     } else {\n         assert!(component.starts_with(\"rust\"));\n         format!(\"{}-{}\", component, builder.rust_package_vers())\n@@ -1303,6 +1303,7 @@ impl Step for Extended {\n         let cargo_installer = builder.ensure(Cargo { stage, target });\n         let rustfmt_installer = builder.ensure(Rustfmt { stage, target });\n         let rls_installer = builder.ensure(Rls { stage, target });\n+        let llvm_tools_installer = builder.ensure(LlvmTools { stage, target, compiler: builder.compiler(stage, target) });\n         let mingw_installer = builder.ensure(Mingw { host: target });\n         let analysis_installer = builder.ensure(Analysis {\n             compiler: builder.compiler(stage, self.host),\n@@ -1340,6 +1341,7 @@ impl Step for Extended {\n         tarballs.push(cargo_installer);\n         tarballs.extend(rls_installer.clone());\n         tarballs.extend(rustfmt_installer.clone());\n+        tarballs.extend(llvm_tools_installer.clone());\n         tarballs.push(analysis_installer);\n         tarballs.push(std_installer);\n         if builder.config.docs {\n@@ -1740,7 +1742,7 @@ impl Step for HashSign {\n         cmd.arg(builder.package_vers(&builder.release_num(\"cargo\")));\n         cmd.arg(builder.package_vers(&builder.release_num(\"rls\")));\n         cmd.arg(builder.package_vers(&builder.release_num(\"rustfmt\")));\n-        cmd.arg(builder.llvm_tools_vers());\n+        cmd.arg(builder.llvm_tools_package_vers());\n         cmd.arg(addr);\n \n         builder.create_dir(&distdir(builder));\n@@ -1806,6 +1808,7 @@ impl Step for LlvmTools {\n         builder.create_dir(&overlay);\n         builder.install(&src.join(\"README.txt\"), &overlay, 0o644);\n         builder.install(&src.join(\"LICENSE.TXT\"), &overlay, 0o644);\n+        builder.create(&overlay.join(\"version\"), &builder.llvm_tools_vers());\n \n         // Generate the installer tarball\n         let mut cmd = rust_installer(builder);"}, {"sha": "b5d450b88392d0d8bd1c575f72bd4fe0cbc5f5bd", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 4, "deletions": 17, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/739fe4b3c57aac0e59db5f6b73251b5f025339d3/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/739fe4b3c57aac0e59db5f6b73251b5f025339d3/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=739fe4b3c57aac0e59db5f6b73251b5f025339d3", "patch": "@@ -973,24 +973,11 @@ impl Build {\n         self.package_vers(&self.release_num(\"rustfmt\"))\n     }\n \n-    fn llvm_tools_vers(&self) -> String {\n-        // japaric: should we use LLVM version here?\n-        // let stdout = build_helper::output(\n-        //     Command::new(self.llvm_out(self.config.build).join(\"build/bin/llvm-size\"))\n-        //         .arg(\"--version\"),\n-        // );\n-\n-        // for line in stdout.lines() {\n-        //     if line.contains(\"LLVM version\") {\n-        //         if let Some(vers) = line.split_whitespace().nth(2) {\n-        //             return vers.to_string();\n-        //         }\n-        //     }\n-        // }\n-\n-        // panic!(\"The output of $LLVM_TOOL has changed; \\\n-        //         please fix `bootstrap::Build.llvm_tools_vers`\");\n+    fn llvm_tools_package_vers(&self) -> String {\n+        self.package_vers(&self.rust_version())\n+    }\n \n+    fn llvm_tools_vers(&self) -> String {\n         self.rust_version()\n     }\n "}, {"sha": "a1686db999597f308ca0b8550a2440888d13b1fb", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/739fe4b3c57aac0e59db5f6b73251b5f025339d3/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/739fe4b3c57aac0e59db5f6b73251b5f025339d3/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=739fe4b3c57aac0e59db5f6b73251b5f025339d3", "patch": "@@ -184,6 +184,7 @@ struct Builder {\n     cargo_release: String,\n     rls_release: String,\n     rustfmt_release: String,\n+    llvm_tools_release: String,\n \n     input: PathBuf,\n     output: PathBuf,\n@@ -196,11 +197,13 @@ struct Builder {\n     cargo_version: Option<String>,\n     rls_version: Option<String>,\n     rustfmt_version: Option<String>,\n+    llvm_tools_version: Option<String>,\n \n     rust_git_commit_hash: Option<String>,\n     cargo_git_commit_hash: Option<String>,\n     rls_git_commit_hash: Option<String>,\n     rustfmt_git_commit_hash: Option<String>,\n+    llvm_tools_git_commit_hash: Option<String>,\n }\n \n fn main() {\n@@ -212,7 +215,7 @@ fn main() {\n     let cargo_release = args.next().unwrap();\n     let rls_release = args.next().unwrap();\n     let rustfmt_release = args.next().unwrap();\n-    let _llvm_tools_vers = args.next().unwrap(); // FIXME do something with it?\n+    let llvm_tools_release = args.next().unwrap();\n     let s3_address = args.next().unwrap();\n     let mut passphrase = String::new();\n     t!(io::stdin().read_to_string(&mut passphrase));\n@@ -222,6 +225,7 @@ fn main() {\n         cargo_release,\n         rls_release,\n         rustfmt_release,\n+        llvm_tools_release,\n \n         input,\n         output,\n@@ -234,11 +238,13 @@ fn main() {\n         cargo_version: None,\n         rls_version: None,\n         rustfmt_version: None,\n+        llvm_tools_version: None,\n \n         rust_git_commit_hash: None,\n         cargo_git_commit_hash: None,\n         rls_git_commit_hash: None,\n         rustfmt_git_commit_hash: None,\n+        llvm_tools_git_commit_hash: None,\n     }.build();\n }\n \n@@ -248,11 +254,13 @@ impl Builder {\n         self.cargo_version = self.version(\"cargo\", \"x86_64-unknown-linux-gnu\");\n         self.rls_version = self.version(\"rls\", \"x86_64-unknown-linux-gnu\");\n         self.rustfmt_version = self.version(\"rustfmt\", \"x86_64-unknown-linux-gnu\");\n+        self.llvm_tools_version = self.version(\"llvm-tools\", \"x86_64-unknown-linux-gnu\");\n \n         self.rust_git_commit_hash = self.git_commit_hash(\"rust\", \"x86_64-unknown-linux-gnu\");\n         self.cargo_git_commit_hash = self.git_commit_hash(\"cargo\", \"x86_64-unknown-linux-gnu\");\n         self.rls_git_commit_hash = self.git_commit_hash(\"rls\", \"x86_64-unknown-linux-gnu\");\n         self.rustfmt_git_commit_hash = self.git_commit_hash(\"rustfmt\", \"x86_64-unknown-linux-gnu\");\n+        self.llvm_tools_git_commit_hash = self.git_commit_hash(\"llvm-tools\", \"x86_64-unknown-linux-gnu\");\n \n         self.digest_and_sign();\n         let manifest = self.build_manifest();\n@@ -289,9 +297,11 @@ impl Builder {\n         self.package(\"rls-preview\", &mut manifest.pkg, HOSTS);\n         self.package(\"rustfmt-preview\", &mut manifest.pkg, HOSTS);\n         self.package(\"rust-analysis\", &mut manifest.pkg, TARGETS);\n+        self.package(\"llvm-tools\", &mut manifest.pkg, TARGETS);\n \n         let rls_present = manifest.pkg.contains_key(\"rls-preview\");\n         let rustfmt_present = manifest.pkg.contains_key(\"rustfmt-preview\");\n+        let llvm_tools_present = manifest.pkg.contains_key(\"llvm-tools\");\n \n         if rls_present {\n             manifest.renames.insert(\"rls\".to_owned(), Rename { to: \"rls-preview\".to_owned() });\n@@ -346,6 +356,12 @@ impl Builder {\n                     target: host.to_string(),\n                 });\n             }\n+            if llvm_tools_present {\n+                extensions.push(Component {\n+                    pkg: \"llvm-tools\".to_string(),\n+                    target: host.to_string(),\n+                });\n+            }\n             extensions.push(Component {\n                 pkg: \"rust-analysis\".to_string(),\n                 target: host.to_string(),\n@@ -455,6 +471,8 @@ impl Builder {\n             format!(\"rls-{}-{}.tar.gz\", self.rls_release, target)\n         } else if component == \"rustfmt\" || component == \"rustfmt-preview\" {\n             format!(\"rustfmt-{}-{}.tar.gz\", self.rustfmt_release, target)\n+        } else if component == \"llvm_tools\" {\n+            format!(\"llvm-tools-{}-{}.tar.gz\", self.llvm_tools_release, target)\n         } else {\n             format!(\"{}-{}-{}.tar.gz\", component, self.rust_release, target)\n         }\n@@ -467,6 +485,8 @@ impl Builder {\n             &self.rls_version\n         } else if component == \"rustfmt\" || component == \"rustfmt-preview\" {\n             &self.rustfmt_version\n+        } else if component == \"llvm-tools\" {\n+            &self.llvm_tools_version\n         } else {\n             &self.rust_version\n         }\n@@ -479,6 +499,8 @@ impl Builder {\n             &self.rls_git_commit_hash\n         } else if component == \"rustfmt\" || component == \"rustfmt-preview\" {\n             &self.rustfmt_git_commit_hash\n+        } else if component == \"llvm-tools\" {\n+            &self.llvm_tools_git_commit_hash\n         } else {\n             &self.rust_git_commit_hash\n         }"}]}