{"sha": "7e1a25f1499b2987cd98f8bd61ee00652deb09c2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlMWEyNWYxNDk5YjI5ODdjZDk4ZjhiZDYxZWUwMDY1MmRlYjA5YzI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-01-11T20:48:30Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-01-11T20:50:32Z"}, "message": "Tweak release workflow", "tree": {"sha": "f56cd4106ada45ee1c174024340801244f0577fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f56cd4106ada45ee1c174024340801244f0577fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e1a25f1499b2987cd98f8bd61ee00652deb09c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e1a25f1499b2987cd98f8bd61ee00652deb09c2", "html_url": "https://github.com/rust-lang/rust/commit/7e1a25f1499b2987cd98f8bd61ee00652deb09c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e1a25f1499b2987cd98f8bd61ee00652deb09c2/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d4a62275d969a134a1f9c80d489f45eddd0b2ae", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d4a62275d969a134a1f9c80d489f45eddd0b2ae", "html_url": "https://github.com/rust-lang/rust/commit/7d4a62275d969a134a1f9c80d489f45eddd0b2ae"}], "stats": {"total": 54, "additions": 13, "deletions": 41}, "files": [{"sha": "49d3ee0e9d59f50f1158fb520633082a3dbcff01", "filename": ".github/workflows/release.yaml", "status": "modified", "additions": 13, "deletions": 41, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/7e1a25f1499b2987cd98f8bd61ee00652deb09c2/.github%2Fworkflows%2Frelease.yaml", "raw_url": "https://github.com/rust-lang/rust/raw/7e1a25f1499b2987cd98f8bd61ee00652deb09c2/.github%2Fworkflows%2Frelease.yaml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Frelease.yaml?ref=7e1a25f1499b2987cd98f8bd61ee00652deb09c2", "patch": "@@ -1,9 +1,8 @@\n name: CI-Release\n on:\n-  pull_request:\n   push:\n     branches:\n-      - master\n+      - release\n \n jobs:\n   rust:\n@@ -15,7 +14,6 @@ jobs:\n     env:\n       RUSTFLAGS: -D warnings\n       CARGO_INCREMENTAL: 0\n-      RUN_SLOW_TESTS: 1\n       RUSTUP_MAX_RETRIES: 10\n       CARGO_NET_RETRY: 10\n     steps:\n@@ -39,47 +37,26 @@ jobs:\n           override: true\n           components: rustfmt, rust-src\n \n-      - name: Cache cargo registry\n-        uses: actions/cache@v1\n-        with:\n-          path: ~/.cargo/registry\n-          key: ${{ runner.os }}-cargo-registry-${{ hashFiles('**/Cargo.lock') }}\n-\n-      - name: Cache cargo index\n-        uses: actions/cache@v1\n-        with:\n-          path: ~/.cargo/git\n-          key: ${{ runner.os }}-cargo-index-${{ hashFiles('**/Cargo.lock') }}\n-\n-      - name: Cache cargo target dir\n-        uses: actions/cache@v1\n-        with:\n-          path: target\n-          key: ${{ runner.os }}-cargo-build-target-${{ hashFiles('**/Cargo.lock') }}\n-\n-      - name: Compile and Test\n+      - name: Build\n         uses: actions-rs/cargo@v1\n         with:\n-          command: test\n-          args: --release --all-targets\n+          command: build\n+          args: --release --package ra_lsp_server --bin ra_lsp_server\n \n-      - name: Prepare cache\n-        run: cargo xtask pre-cache\n+      - name: Strip symbols\n+        if: matrix.os == 'ubuntu-latest'\n+        run: strip ./target/release/ra_lsp_server\n \n-      - name: Prepare cache 2\n-        if: matrix.os == 'windows-latest'\n-        run: Remove-Item ./target/release/xtask.exe\n-\n-      - name: Creat distribution dir\n+      - name: Create distribution dir\n         run: mkdir ./dist\n \n-      - name: Copy binaries (non-win)\n+      - name: Copy binaries (unix)\n         if: matrix.os != 'windows-latest'\n         run: cp ./target/release/ra_lsp_server ./dist\n \n       - name: Copy binaries (win)\n         if: matrix.os == 'windows-latest'\n-        run: copy ./target/release/ra_lsp_server.* ./dist\n+        run: copy ./target/release/ra_lsp_server.exe ./dist\n \n       - name: Upload artifacts\n         uses: actions/upload-artifact@v1\n@@ -90,9 +67,6 @@ jobs:\n   type-script:\n     name: TypeScript\n     runs-on: ubuntu-latest\n-    env:\n-      CXX: g++-4.9\n-      CC: gcc-4.9\n     steps:\n       - name: Checkout repository\n         uses: actions/checkout@v1\n@@ -104,20 +78,18 @@ jobs:\n \n       - run: npm ci\n         working-directory: ./editors/code\n+\n       - run: npm run package --scripts-prepend-node-path\n         working-directory: ./editors/code\n \n-      - name: Create distribution directory\n-        run: mkdir ./dist\n-\n       - name: Copy vscode extension\n-        run: mkdir ./dist/code && cp ./editors/code/*.vsix ./dist/code/\n+        run: mkdir -p ./dist/code && cp ./editors/code/*.vsix ./dist/code/\n \n       - name: Copy emacs mode\n         run: cp -R ./editors/emacs ./dist/\n \n       - name: Upload artifacts\n         uses: actions/upload-artifact@v1\n         with:\n-          name: editors\n+          name: editor-plugins\n           path: ./dist"}]}