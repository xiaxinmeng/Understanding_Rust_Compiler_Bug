{"sha": "60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYwZjk3YWE5Y2M3M2VlNGUwYjU3YWJjMDdkYzU0M2M4ZmE4MjNlZTI=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-02-22T01:42:23Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-02-22T01:42:23Z"}, "message": "Find main functions buried within modules. Un-XFAIL import.rs.", "tree": {"sha": "a177daef976b93c4e0c0c54a08c5f1310ccada71", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a177daef976b93c4e0c0c54a08c5f1310ccada71"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2", "html_url": "https://github.com/rust-lang/rust/commit/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cbe8d222a82c14485cf416c4b85fd5e58363c0e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/cbe8d222a82c14485cf416c4b85fd5e58363c0e0", "html_url": "https://github.com/rust-lang/rust/commit/cbe8d222a82c14485cf416c4b85fd5e58363c0e0"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "872ced9896d99db4a66a431ac498183f2c236307", "filename": "src/Makefile", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2/src%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2/src%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FMakefile?ref=60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2", "patch": "@@ -492,6 +492,7 @@ TEST_XFAILS_RUSTC := $(filter-out \\\n                         int.rs \\\n                         i32-sub.rs \\\n                         i8-incr.rs \\\n+                        import.rs \\\n                         import2.rs \\\n                         import3.rs \\\n                         import4.rs \\"}, {"sha": "35fefc104be21f424db8e94644279434d1a66f9a", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 25, "deletions": 2, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=60f97aa9cc73ee4e0b57abc07dc543c8fa823ee2", "patch": "@@ -4602,6 +4602,30 @@ fn create_crate_constant(@crate_ctxt cx) {\n     llvm.LLVMSetInitializer(cx.crate_ptr, crate_val);\n }\n \n+fn find_main_fn(@crate_ctxt cx) -> ValueRef {\n+    auto e = sep() + \"main\";\n+    let ValueRef v = C_nil();\n+    let uint n = 0u;\n+    for each (tup(str,ValueRef) i in cx.item_names.items()) {\n+        if (_str.ends_with(i._0, e)) {\n+            n += 1u;\n+            v = i._1;\n+        }\n+    }\n+    alt (n) {\n+        case (0u) {\n+            cx.sess.err(\"main fn not found\");\n+        }\n+        case (1u) {\n+            ret v;\n+        }\n+        case (_) {\n+            cx.sess.err(\"multiple main fns found\");\n+        }\n+    }\n+    fail;\n+}\n+\n fn trans_main_fn(@crate_ctxt cx, ValueRef llcrate) {\n     auto T_main_args = vec(T_int(), T_int());\n     auto T_rust_start_args = vec(T_int(), T_int(), T_int(), T_int());\n@@ -4621,8 +4645,7 @@ fn trans_main_fn(@crate_ctxt cx, ValueRef llcrate) {\n \n     auto llargc = llvm.LLVMGetParam(llmain, 0u);\n     auto llargv = llvm.LLVMGetParam(llmain, 1u);\n-    check (cx.item_names.contains_key(\"_rust\" + sep() + \"main\"));\n-    auto llrust_main = cx.item_names.get(\"_rust\"  + sep() + \"main\");\n+    auto llrust_main = find_main_fn(cx);\n \n     //\n     // Emit the moral equivalent of:"}]}