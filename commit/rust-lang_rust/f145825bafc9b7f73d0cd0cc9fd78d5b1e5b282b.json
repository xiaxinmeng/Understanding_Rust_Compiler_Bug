{"sha": "f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "node_id": "C_kwDOAAsO6NoAKGYxNDU4MjViYWZjOWI3ZjczZDBjZDBjYzlmZDc4ZDViMWU1YjI4MmI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-11T08:51:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-11T08:51:58Z"}, "message": "Rollup merge of #105546 - JohnTitor:issue-44454, r=compiler-errors\n\nAdd some regression tests for #44454\n\nCloses #44454\nr? ``@compiler-errors``\n\nSigned-off-by: Yuki Okushi <jtitor@2k36.org>", "tree": {"sha": "6f09fd0f1bedadfc2b4a969c1a355fa55d548811", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f09fd0f1bedadfc2b4a969c1a355fa55d548811"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjlZouCRBK7hj4Ov3rIwAAsVEIAAguxPP6ZZJPbFWERqNxt8Io\nhFE5+iMZ3PsadOzsDXFr2BmiwK/Z6BA2OjgLGXZYvoZSJu5p2il1PvFejh/DWt2E\nD0Bzfq6hMyM7jQWHNMLAQKMDA6+2N+9jihMd1fURl94hVRD9vxRBgeaviE3uU9PK\nh/AylfGZPbxGRG6DU1ZaBqLzVH6KfEvmqxE7Sb0UTCp0XxoyAL23tBygFvQEuw16\n9kS6EZZQwAhBvkg3Ga37Z97TBQhK3EOAzoaXWd3V8/PPDreUkb3LYLuQzI+RzIjj\n1a2VxCVK5/iDDCJNn5Z7vKyPBLTTNaAyngiCq9AvptWIF0HKMkKuXEiIyb2fftU=\n=V1g4\n-----END PGP SIGNATURE-----\n", "payload": "tree 6f09fd0f1bedadfc2b4a969c1a355fa55d548811\nparent dd00582bc878c0e48f13ef46e115af3a8668aa4e\nparent 0f5f163a949717eb0361b2ad4d31c731171d100e\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1670748718 +0100\ncommitter GitHub <noreply@github.com> 1670748718 +0100\n\nRollup merge of #105546 - JohnTitor:issue-44454, r=compiler-errors\n\nAdd some regression tests for #44454\n\nCloses #44454\nr? ``@compiler-errors``\n\nSigned-off-by: Yuki Okushi <jtitor@2k36.org>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "html_url": "https://github.com/rust-lang/rust/commit/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd00582bc878c0e48f13ef46e115af3a8668aa4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd00582bc878c0e48f13ef46e115af3a8668aa4e", "html_url": "https://github.com/rust-lang/rust/commit/dd00582bc878c0e48f13ef46e115af3a8668aa4e"}, {"sha": "0f5f163a949717eb0361b2ad4d31c731171d100e", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f5f163a949717eb0361b2ad4d31c731171d100e", "html_url": "https://github.com/rust-lang/rust/commit/0f5f163a949717eb0361b2ad4d31c731171d100e"}], "stats": {"total": 115, "additions": 115, "deletions": 0}, "files": [{"sha": "bbaf3188a8963bd4735aa1c7ae115df660675a1e", "filename": "src/test/ui/traits/object/issue-44454-1.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.rs?ref=f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "patch": "@@ -0,0 +1,22 @@\n+// Taken from https://github.com/rust-lang/rust/issues/44454#issue-256435333\n+\n+trait Animal<X>: 'static {}\n+\n+fn foo<Y, X>()\n+where\n+    Y: Animal<X> + ?Sized,\n+{\n+    // `Y` implements `Animal<X>` so `Y` is 'static.\n+    baz::<Y>()\n+}\n+\n+fn bar<'a>(_arg: &'a i32) {\n+    foo::<dyn Animal<&'a i32>, &'a i32>() //~ ERROR: lifetime may not live long enough\n+}\n+\n+fn baz<T: 'static + ?Sized>() {}\n+\n+fn main() {\n+    let a = 5;\n+    bar(&a);\n+}"}, {"sha": "859487f50ac1ec6373edecfe9a10738332f55c8b", "filename": "src/test/ui/traits/object/issue-44454-1.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.stderr?ref=f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "patch": "@@ -0,0 +1,10 @@\n+error: lifetime may not live long enough\n+  --> $DIR/issue-44454-1.rs:14:5\n+   |\n+LL | fn bar<'a>(_arg: &'a i32) {\n+   |        -- lifetime `'a` defined here\n+LL |     foo::<dyn Animal<&'a i32>, &'a i32>()\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ requires that `'a` must outlive `'static`\n+\n+error: aborting due to previous error\n+"}, {"sha": "f5178bcdbe224011b134946f9120d52ce40dbcad", "filename": "src/test/ui/traits/object/issue-44454-2.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.rs?ref=f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "patch": "@@ -0,0 +1,22 @@\n+// Taken from https://github.com/rust-lang/rust/issues/44454#issuecomment-1175925928\n+\n+trait Trait<ARG: 'static>: 'static {\n+    type Assoc: AsRef<str>;\n+}\n+\n+fn hr<T: ?Sized, ARG>(x: T::Assoc) -> Box<dyn AsRef<str> + 'static>\n+where\n+    T: Trait<ARG>\n+{\n+    Box::new(x)\n+}\n+\n+fn extend_lt<'a>(x: &'a str) -> Box<dyn AsRef<str> + 'static> {\n+    type DynTrait = dyn for<'a> Trait<&'a str, Assoc = &'a str>;\n+    hr::<DynTrait, _>(x) //~ ERROR: borrowed data escapes outside of function\n+}\n+\n+fn main() {\n+    let extended = extend_lt(&String::from(\"hello\"));\n+    println!(\"{}\", extended.as_ref().as_ref());\n+}"}, {"sha": "7f574769b7f60ed39aa0f4779f09a94c0aba12f3", "filename": "src/test/ui/traits/object/issue-44454-2.stderr", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.stderr?ref=f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "patch": "@@ -0,0 +1,17 @@\n+error[E0521]: borrowed data escapes outside of function\n+  --> $DIR/issue-44454-2.rs:16:5\n+   |\n+LL | fn extend_lt<'a>(x: &'a str) -> Box<dyn AsRef<str> + 'static> {\n+   |              --  - `x` is a reference that is only valid in the function body\n+   |              |\n+   |              lifetime `'a` defined here\n+LL |     type DynTrait = dyn for<'a> Trait<&'a str, Assoc = &'a str>;\n+LL |     hr::<DynTrait, _>(x)\n+   |     ^^^^^^^^^^^^^^^^^^^^\n+   |     |\n+   |     `x` escapes the function body here\n+   |     argument requires that `'a` must outlive `'static`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0521`."}, {"sha": "bff727035346405c006b9365637a671359b7b3e0", "filename": "src/test/ui/traits/object/issue-44454-3.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.rs?ref=f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "patch": "@@ -0,0 +1,33 @@\n+// Taken from https://github.com/rust-lang/rust/issues/44454#issuecomment-1332781290\n+\n+use std::any::Any;\n+\n+trait Animal<X>: 'static {}\n+\n+trait Projector {\n+    type Foo;\n+}\n+\n+impl<X> Projector for dyn Animal<X> {\n+    type Foo = X;\n+}\n+\n+fn make_static<'a, T>(t: &'a T) -> &'static T {\n+    let x: <dyn Animal<&'a T> as Projector>::Foo = t;\n+    let any = generic::<dyn Animal<&'a T>, &'a T>(x);\n+    //~^ ERROR: lifetime may not live long enough\n+    any.downcast_ref::<&'static T>().unwrap()\n+}\n+\n+fn generic<T: Projector + Animal<U> + ?Sized, U>(x: <T as Projector>::Foo) -> Box<dyn Any> {\n+    make_static_any(x)\n+}\n+\n+fn make_static_any<U: 'static>(u: U) -> Box<dyn Any> {\n+    Box::new(u)\n+}\n+\n+fn main() {\n+    let a = make_static(&\"salut\".to_string());\n+    println!(\"{}\", *a);\n+}"}, {"sha": "294684d26bdfc8defe8e4a565d6fe414eb2e58d5", "filename": "src/test/ui/traits/object/issue-44454-3.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.stderr?ref=f145825bafc9b7f73d0cd0cc9fd78d5b1e5b282b", "patch": "@@ -0,0 +1,11 @@\n+error: lifetime may not live long enough\n+  --> $DIR/issue-44454-3.rs:17:15\n+   |\n+LL | fn make_static<'a, T>(t: &'a T) -> &'static T {\n+   |                -- lifetime `'a` defined here\n+LL |     let x: <dyn Animal<&'a T> as Projector>::Foo = t;\n+LL |     let any = generic::<dyn Animal<&'a T>, &'a T>(x);\n+   |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ requires that `'a` must outlive `'static`\n+\n+error: aborting due to previous error\n+"}]}