{"sha": "593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5M2QxZWVkODIxNmM0YWIzMzUwMGIzMjNmYmQxYjNkZTRlY2IzNGQ=", "commit": {"author": {"name": "Chris Simpkins", "email": "git.simpkins@gmail.com", "date": "2020-05-27T18:09:54Z"}, "committer": {"name": "Chris Simpkins", "email": "git.simpkins@gmail.com", "date": "2020-05-27T18:10:41Z"}, "message": "improve diagnostics suggestion for missing `@` in  slice id binding to rest pattern\n\nadd issue 72373 tests\n\n\nfmt test\n\n\nfix suggestion format\n\nReplacement, not insertion of suggested string\n\nimplement review changes\n\nrefactor to span_suggestion_verbose, improve suggestion message,  change id @ pattern space formatting\n\nfmt\n\n\nfix diagnostics spacing between ident and @\n\n\nrefactor reference", "tree": {"sha": "a94f52110b0575b30aa85e77351d1b11ec194c38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a94f52110b0575b30aa85e77351d1b11ec194c38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE/wEuS8EQZ2kAreNcDQIYpxyd6wkFAl7OrSEACgkQDQIYpxyd\n6wlRqA//cAU858y9Z3yqvWxibYtdsn7mJK6sQ130cGdjxsrFqpTQl5zp2M8BBIWx\n+E+BHdqVkJClCNQkGje5kni1CzhGvhnvLKiR2fO+4fKliQuswxl3rG8WP07QBQTu\n1ZSujX6DV5el0yzW1WGe80Ke1upQS5DTc4LcGuX8flfAjHug6hPel5IzYr9z/pgM\nsUMyeUpVJCNGd4/zgeLN9Fxu6XntwSSILFi2KgK/uSBzNcPPMizupBOx0CkpGV51\nlw/VfK/7f1/n2MbYMLq08+PaNQ3IateWRDAiGAAzZWei85UquuGc7V90DQxOuMe6\nW6zpNtq8dfHl+dNGys4oN6vdZtxHtsBNJoUlTRg0GUd9Pj/dShdjI2FKfL7MBqN6\nnBrcbdkUCskeJJ62FEbs+USDoRNy+01ainN6nGZSfZPG4mRw7mZUTTSIwfj/3ZDd\nQVNGWxKMf3DL3qWOFTSQF5K3Kw7gGf1pFeCyPLKin8nLh4FUw028vy3kDkpEAS6o\nOiC7tyafXO/C5I5JWW/FF+4c/gzxAGW8catUoW+/6VL0YfnZVB74IpH7RFMwdn8b\nBY0O0EU+SfmCr4JAVP4vEO+ZhFeWcg2VXv2+g8dwSs7mDGJZqoC5xk2+0/zzXjkY\n05Mdw3eBbVUF/vBYrAATISsWIwbMY4wflXiQLrF5aHJfx5mo7TI=\n=X6Up\n-----END PGP SIGNATURE-----", "payload": "tree a94f52110b0575b30aa85e77351d1b11ec194c38\nparent acfc5584018de3a9a431a17f0cc34e0bfaf4cdeb\nauthor Chris Simpkins <git.simpkins@gmail.com> 1590602994 -0400\ncommitter Chris Simpkins <git.simpkins@gmail.com> 1590603041 -0400\n\nimprove diagnostics suggestion for missing `@` in  slice id binding to rest pattern\n\nadd issue 72373 tests\n\n\nfmt test\n\n\nfix suggestion format\n\nReplacement, not insertion of suggested string\n\nimplement review changes\n\nrefactor to span_suggestion_verbose, improve suggestion message,  change id @ pattern space formatting\n\nfmt\n\n\nfix diagnostics spacing between ident and @\n\n\nrefactor reference\n\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "html_url": "https://github.com/rust-lang/rust/commit/593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/593d1eed8216c4ab33500b323fbd1b3de4ecb34d/comments", "author": {"login": "chrissimpkins", "id": 4249591, "node_id": "MDQ6VXNlcjQyNDk1OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/4249591?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrissimpkins", "html_url": "https://github.com/chrissimpkins", "followers_url": "https://api.github.com/users/chrissimpkins/followers", "following_url": "https://api.github.com/users/chrissimpkins/following{/other_user}", "gists_url": "https://api.github.com/users/chrissimpkins/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrissimpkins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrissimpkins/subscriptions", "organizations_url": "https://api.github.com/users/chrissimpkins/orgs", "repos_url": "https://api.github.com/users/chrissimpkins/repos", "events_url": "https://api.github.com/users/chrissimpkins/events{/privacy}", "received_events_url": "https://api.github.com/users/chrissimpkins/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chrissimpkins", "id": 4249591, "node_id": "MDQ6VXNlcjQyNDk1OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/4249591?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrissimpkins", "html_url": "https://github.com/chrissimpkins", "followers_url": "https://api.github.com/users/chrissimpkins/followers", "following_url": "https://api.github.com/users/chrissimpkins/following{/other_user}", "gists_url": "https://api.github.com/users/chrissimpkins/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrissimpkins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrissimpkins/subscriptions", "organizations_url": "https://api.github.com/users/chrissimpkins/orgs", "repos_url": "https://api.github.com/users/chrissimpkins/repos", "events_url": "https://api.github.com/users/chrissimpkins/events{/privacy}", "received_events_url": "https://api.github.com/users/chrissimpkins/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acfc5584018de3a9a431a17f0cc34e0bfaf4cdeb", "url": "https://api.github.com/repos/rust-lang/rust/commits/acfc5584018de3a9a431a17f0cc34e0bfaf4cdeb", "html_url": "https://github.com/rust-lang/rust/commit/acfc5584018de3a9a431a17f0cc34e0bfaf4cdeb"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "c00b60848293346a3cd31cc48b09eb10c3385da7", "filename": "src/librustc_parse/parser/mod.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/593d1eed8216c4ab33500b323fbd1b3de4ecb34d/src%2Flibrustc_parse%2Fparser%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/593d1eed8216c4ab33500b323fbd1b3de4ecb34d/src%2Flibrustc_parse%2Fparser%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Fparser%2Fmod.rs?ref=593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "patch": "@@ -672,6 +672,26 @@ impl<'a> Parser<'a> {\n                                 }\n                             }\n \n+                            // If this was a missing `@` in a binding pattern\n+                            // bail with a suggestion\n+                            // https://github.com/rust-lang/rust/issues/72373\n+                            if self.prev_token.is_ident() && &self.token.kind == &token::DotDot {\n+                                let msg = format!(\n+                                    \"if you meant to bind the contents of \\\n+                                    the rest of the array pattern into `{}`, use `@`\",\n+                                    pprust::token_to_string(&self.prev_token)\n+                                );\n+                                expect_err\n+                                    .span_suggestion_verbose(\n+                                        self.prev_token.span.shrink_to_hi().until(self.token.span),\n+                                        &msg,\n+                                        \" @ \".to_string(),\n+                                        Applicability::MaybeIncorrect,\n+                                    )\n+                                    .emit();\n+                                break;\n+                            }\n+\n                             // Attempt to keep parsing if it was an omitted separator.\n                             match f(self) {\n                                 Ok(t) => {"}, {"sha": "4da6061c27fe840a82da12e0cb340dece6a4745e", "filename": "src/test/ui/issues/issue-72373.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/593d1eed8216c4ab33500b323fbd1b3de4ecb34d/src%2Ftest%2Fui%2Fissues%2Fissue-72373.rs", "raw_url": "https://github.com/rust-lang/rust/raw/593d1eed8216c4ab33500b323fbd1b3de4ecb34d/src%2Ftest%2Fui%2Fissues%2Fissue-72373.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-72373.rs?ref=593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "patch": "@@ -0,0 +1,9 @@\n+fn foo(c: &[u32], n: u32) -> u32 {\n+    match *c {\n+        [h, ..] if h > n => 0,\n+        [h, ..] if h == n => 1,\n+        [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n+        //~^ ERROR expected one of `,`, `@`, `]`, or `|`, found `..`\n+        [] => 0,\n+    }\n+}"}, {"sha": "dfde8624814f8e154303dbefedf3ce963d031e21", "filename": "src/test/ui/issues/issue-72373.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/593d1eed8216c4ab33500b323fbd1b3de4ecb34d/src%2Ftest%2Fui%2Fissues%2Fissue-72373.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/593d1eed8216c4ab33500b323fbd1b3de4ecb34d/src%2Ftest%2Fui%2Fissues%2Fissue-72373.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-72373.stderr?ref=593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "patch": "@@ -0,0 +1,13 @@\n+error: expected one of `,`, `@`, `]`, or `|`, found `..`\n+  --> $DIR/issue-72373.rs:5:19\n+   |\n+LL |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n+   |                   ^^ expected one of `,`, `@`, `]`, or `|`\n+   |\n+help: if you meant to bind the contents of the rest of the array pattern into `ts`, use `@`\n+   |\n+LL |         [h, ref ts @ ..] => foo(c, n - h) + foo(ts, n),\n+   |                    ^\n+\n+error: aborting due to previous error\n+"}]}