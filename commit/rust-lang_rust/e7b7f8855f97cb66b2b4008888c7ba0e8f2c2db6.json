{"sha": "e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "node_id": "C_kwDOAAsO6NoAKGU3YjdmODg1NWY5N2NiNjZiMmI0MDA4ODg4YzdiYTBlOGYyYzJkYjY", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-08-26T00:41:25Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-08-26T03:30:23Z"}, "message": "rustdoc: omit start/end tags for empty item description blocks\n\nRelated to #100952\n\nThis is definitely not a complete solution, but it does shrink\nkeysyms/index.html on smithay from 620K to 516K.", "tree": {"sha": "da42b3d63df6289337aaa1c8dd36cf4c009ad32b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da42b3d63df6289337aaa1c8dd36cf4c009ad32b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "html_url": "https://github.com/rust-lang/rust/commit/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cfb5ae26a4496b7d35180f15e47ada0f3897c7e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfb5ae26a4496b7d35180f15e47ada0f3897c7e8", "html_url": "https://github.com/rust-lang/rust/commit/cfb5ae26a4496b7d35180f15e47ada0f3897c7e8"}], "stats": {"total": 24, "additions": 16, "deletions": 8}, "files": [{"sha": "07a8e8f48dc312b6d570c1f5f718aa04f11f684b", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "patch": "@@ -371,16 +371,21 @@ fn item_module(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Item, items:\n                     }\n                     clean::ImportKind::Glob => String::new(),\n                 };\n+                let stab_tags = stab_tags.unwrap_or_default();\n+                let (stab_tags_before, stab_tags_after) = if stab_tags.is_empty() {\n+                    (\"\", \"\")\n+                } else {\n+                    (\"<div class=\\\"item-right docblock-short\\\">\", \"</div>\")\n+                };\n                 write!(\n                     w,\n                     \"<div class=\\\"item-left {stab}{add}import-item\\\"{id}>\\\n                          <code>{vis}{imp}</code>\\\n                      </div>\\\n-                     <div class=\\\"item-right docblock-short\\\">{stab_tags}</div>\",\n+                     {stab_tags_before}{stab_tags}{stab_tags_after}\",\n                     stab = stab.unwrap_or_default(),\n                     vis = myitem.visibility.print_with_space(myitem.item_id, cx),\n                     imp = import.print(cx),\n-                    stab_tags = stab_tags.unwrap_or_default(),\n                 );\n                 w.write_str(ITEM_TABLE_ROW_CLOSE);\n             }\n@@ -412,6 +417,12 @@ fn item_module(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Item, items:\n \n                 let doc_value = myitem.doc_value().unwrap_or_default();\n                 w.write_str(ITEM_TABLE_ROW_OPEN);\n+                let docs = MarkdownSummaryLine(&doc_value, &myitem.links(cx)).into_string();\n+                let (docs_before, docs_after) = if docs.is_empty() {\n+                    (\"\", \"\")\n+                } else {\n+                    (\"<div class=\\\"item-right docblock-short\\\">\", \"</div>\")\n+                };\n                 write!(\n                     w,\n                     \"<div class=\\\"item-left {stab}{add}module-item\\\">\\\n@@ -420,11 +431,10 @@ fn item_module(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Item, items:\n                         {unsafety_flag}\\\n                         {stab_tags}\\\n                      </div>\\\n-                     <div class=\\\"item-right docblock-short\\\">{docs}</div>\",\n+                     {docs_before}{docs}{docs_after}\",\n                     name = myitem.name.unwrap(),\n                     visibility_emoji = visibility_emoji,\n                     stab_tags = extra_info_tags(myitem, item, cx.tcx()),\n-                    docs = MarkdownSummaryLine(&doc_value, &myitem.links(cx)).into_string(),\n                     class = myitem.type_(),\n                     add = add,\n                     stab = stab.unwrap_or_default(),"}, {"sha": "4bff32b3d5db137b2a86c9a4340275ac5418c334", "filename": "src/test/rustdoc-gui/item-summary-table.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6/src%2Ftest%2Frustdoc-gui%2Fitem-summary-table.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6/src%2Ftest%2Frustdoc-gui%2Fitem-summary-table.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fitem-summary-table.goml?ref=e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "patch": "@@ -3,4 +3,4 @@ goto: file://|DOC_PATH|/lib2/summary_table/index.html\n // We check that we picked the right item first.\n assert-text: (\".item-table .item-left\", \"Foo\")\n // Then we check that its summary is empty.\n-assert-text: (\".item-table .item-right\", \"\")\n+assert-false: \".item-table .item-right\""}, {"sha": "3c5fa7b36adbf9465b8117d8e398250a3dd98b7b", "filename": "src/test/rustdoc/short-docblock-codeblock.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6/src%2Ftest%2Frustdoc%2Fshort-docblock-codeblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6/src%2Ftest%2Frustdoc%2Fshort-docblock-codeblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fshort-docblock-codeblock.rs?ref=e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "patch": "@@ -1,8 +1,6 @@\n #![crate_name = \"foo\"]\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]' \"\"\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]' \"Some text.\"\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]' \"let x = 12;\"\n+// @count foo/index.html '//*[@class=\"item-right docblock-short\"]' 0\n \n /// ```\n /// let x = 12;"}]}