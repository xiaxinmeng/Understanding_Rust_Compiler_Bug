{"sha": "f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0OTI5ZmE5Y2NkMGVkYTY1YzJiNzdmZWYxNjNjMzFlMzNiZmI4OWE=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-12-18T02:30:51Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-18T02:30:51Z"}, "message": "Merge #6901\n\n6901: Temp fixes panic caused by no ast for proc-macro r=maklad a=edwin0cheng\n\nThere are some panic when hover/goto definition for proc-macro. It is because in current design, we don't have `ast-node` for proc-macro and then it trigger [this](https://github.com/rust-analyzer/rust-analyzer/blob/479d1f7eec22c3564867223e2093f14774092528/crates/hir/src/has_source.rs#L116) line to panic.\r\n\r\nThis PR is a temp fix for all of these similar to https://github.com/rust-analyzer/rust-analyzer/blob/bd4c352831662762ee7a66da77ec9adf623b0a0a/crates/completion/src/render/macro_.rs#L42\n\nCo-authored-by: Edwin Cheng <edwin0cheng@gmail.com>", "tree": {"sha": "9c0a7983908c81e13dbc4526f910e89360bb1ce8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c0a7983908c81e13dbc4526f910e89360bb1ce8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf3BRbCRBK7hj4Ov3rIwAAdHIIAGkWuLI3QZFov5olbX82mhQv\n8GsLdHjApMeow/EXi3K2zS+ONEesxIFZNSx4p0/0K4IItebfaXKWJlvy9hdWIH4n\ncRk6yQFfMENJIN7OtFZKLUyMbDlcRsM5uV2bFV5R5RTk1cf5wt5A3i8j4JabUVhw\naBrDgKlCOhDR1+Ukcv3RGPxFJzAQA9efDpZ94tJXqfOh8/MHH0P7BZkofsuQF294\nwC/iI8G5r1YeIQOwdkgbtJR6r2zXspNOLWS6NL0IH18AIEm7sJuCnYdfc8xO63io\nm6LV7ub6KFrywdvmgAi0a0sda8VUGju7QQ2S3pWwI5szgHNkoV1sfHvwZfIKY3A=\n=Rkug\n-----END PGP SIGNATURE-----\n", "payload": "tree 9c0a7983908c81e13dbc4526f910e89360bb1ce8\nparent 37e5f19373d6e4d639d0ee1125741f7b5c5c5b1a\nparent 60a3785ac27d7361617977bd53e11f2859e97c7c\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1608258651 +0000\ncommitter GitHub <noreply@github.com> 1608258651 +0000\n\nMerge #6901\n\n6901: Temp fixes panic caused by no ast for proc-macro r=maklad a=edwin0cheng\n\nThere are some panic when hover/goto definition for proc-macro. It is because in current design, we don't have `ast-node` for proc-macro and then it trigger [this](https://github.com/rust-analyzer/rust-analyzer/blob/479d1f7eec22c3564867223e2093f14774092528/crates/hir/src/has_source.rs#L116) line to panic.\r\n\r\nThis PR is a temp fix for all of these similar to https://github.com/rust-analyzer/rust-analyzer/blob/bd4c352831662762ee7a66da77ec9adf623b0a0a/crates/completion/src/render/macro_.rs#L42\n\nCo-authored-by: Edwin Cheng <edwin0cheng@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "html_url": "https://github.com/rust-lang/rust/commit/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37e5f19373d6e4d639d0ee1125741f7b5c5c5b1a", "url": "https://api.github.com/repos/rust-lang/rust/commits/37e5f19373d6e4d639d0ee1125741f7b5c5c5b1a", "html_url": "https://github.com/rust-lang/rust/commit/37e5f19373d6e4d639d0ee1125741f7b5c5c5b1a"}, {"sha": "60a3785ac27d7361617977bd53e11f2859e97c7c", "url": "https://api.github.com/repos/rust-lang/rust/commits/60a3785ac27d7361617977bd53e11f2859e97c7c", "html_url": "https://github.com/rust-lang/rust/commit/60a3785ac27d7361617977bd53e11f2859e97c7c"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "dac79592f7f22ad24f1ef805fa69ed33cc049bb2", "filename": "crates/completion/src/render/macro_.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fcompletion%2Fsrc%2Frender%2Fmacro_.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fcompletion%2Fsrc%2Frender%2Fmacro_.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcompletion%2Fsrc%2Frender%2Fmacro_.rs?ref=f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "patch": "@@ -41,6 +41,7 @@ impl<'a> MacroRender<'a> {\n     fn render(&self, import_to_add: Option<ImportEdit>) -> Option<CompletionItem> {\n         // FIXME: Currently proc-macro do not have ast-node,\n         // such that it does not have source\n+        // more discussion: https://github.com/rust-analyzer/rust-analyzer/issues/6913\n         if self.macro_.is_proc_macro() {\n             return None;\n         }"}, {"sha": "3248f6d201a10326d13498b2b8459b5b63f0f38b", "filename": "crates/hir/src/code_model.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fhir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fhir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fcode_model.rs?ref=f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "patch": "@@ -983,6 +983,12 @@ impl MacroDef {\n \n     /// XXX: this parses the file\n     pub fn name(self, db: &dyn HirDatabase) -> Option<Name> {\n+        // FIXME: Currently proc-macro do not have ast-node,\n+        // such that it does not have source\n+        // more discussion: https://github.com/rust-analyzer/rust-analyzer/issues/6913\n+        if self.is_proc_macro() {\n+            return None;\n+        }\n         self.source(db).value.name().map(|it| it.as_name())\n     }\n "}, {"sha": "48acb8c9345b2dd51999380a6ecdbb973165c0a4", "filename": "crates/ide/src/display/navigation_target.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fide%2Fsrc%2Fdisplay%2Fnavigation_target.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fide%2Fsrc%2Fdisplay%2Fnavigation_target.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdisplay%2Fnavigation_target.rs?ref=f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "patch": "@@ -155,7 +155,15 @@ impl ToNav for FileSymbol {\n impl TryToNav for Definition {\n     fn try_to_nav(&self, db: &RootDatabase) -> Option<NavigationTarget> {\n         match self {\n-            Definition::Macro(it) => Some(it.to_nav(db)),\n+            Definition::Macro(it) => {\n+                // FIXME: Currently proc-macro do not have ast-node,\n+                // such that it does not have source\n+                // more discussion: https://github.com/rust-analyzer/rust-analyzer/issues/6913\n+                if it.is_proc_macro() {\n+                    return None;\n+                }\n+                Some(it.to_nav(db))\n+            }\n             Definition::Field(it) => Some(it.to_nav(db)),\n             Definition::ModuleDef(it) => it.try_to_nav(db),\n             Definition::SelfType(it) => Some(it.to_nav(db)),"}, {"sha": "da6bb726aba5f52505030b64196fff2675933f93", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "patch": "@@ -324,6 +324,12 @@ fn hover_for_definition(db: &RootDatabase, def: Definition) -> Option<Markup> {\n     let mod_path = definition_mod_path(db, &def);\n     return match def {\n         Definition::Macro(it) => {\n+            // FIXME: Currently proc-macro do not have ast-node,\n+            // such that it does not have source\n+            // more discussion: https://github.com/rust-analyzer/rust-analyzer/issues/6913\n+            if it.is_proc_macro() {\n+                return None;\n+            }\n             let label = macro_label(&it.source(db).value);\n             from_def_source_labeled(db, it, Some(label), mod_path)\n         }"}]}