{"sha": "79d53096041c05db5f54a0fdf0b0dae4fe48ccec", "node_id": "C_kwDOAAsO6NoAKDc5ZDUzMDk2MDQxYzA1ZGI1ZjU0YTBmZGYwYjBkYWU0ZmU0OGNjZWM", "commit": {"author": {"name": "Nikita Popov", "email": "npopov@redhat.com", "date": "2021-12-17T10:26:39Z"}, "committer": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-12-18T17:44:03Z"}, "message": "Explicitly set no ELF flags for .rustc section\n\nFor a data section, the object crate will set the SHF_ALLOC by\ndefault, which is exactly what we don't want. Explicitly set\nsh_flags to zero to avoid this.", "tree": {"sha": "c38a090371cf3c3d23a67c5fd7114277d396b6d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c38a090371cf3c3d23a67c5fd7114277d396b6d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79d53096041c05db5f54a0fdf0b0dae4fe48ccec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79d53096041c05db5f54a0fdf0b0dae4fe48ccec", "html_url": "https://github.com/rust-lang/rust/commit/79d53096041c05db5f54a0fdf0b0dae4fe48ccec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79d53096041c05db5f54a0fdf0b0dae4fe48ccec/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "16d8a91d511b0e90391bcb20b8c67036071d9392", "url": "https://api.github.com/repos/rust-lang/rust/commits/16d8a91d511b0e90391bcb20b8c67036071d9392", "html_url": "https://github.com/rust-lang/rust/commit/16d8a91d511b0e90391bcb20b8c67036071d9392"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "7c97143e80780d97e37fdeef45dce86486f55f66", "filename": "compiler/rustc_codegen_ssa/src/back/metadata.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/79d53096041c05db5f54a0fdf0b0dae4fe48ccec/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79d53096041c05db5f54a0fdf0b0dae4fe48ccec/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs?ref=79d53096041c05db5f54a0fdf0b0dae4fe48ccec", "patch": "@@ -259,8 +259,15 @@ pub fn create_compressed_metadata_file(\n     let section = file.add_section(\n         file.segment_name(StandardSegment::Data).to_vec(),\n         b\".rustc\".to_vec(),\n-        SectionKind::Data,\n+        SectionKind::ReadOnlyData,\n     );\n+    match file.format() {\n+        BinaryFormat::Elf => {\n+            // Explicitly set no flags to avoid SHF_ALLOC default for data section.\n+            file.section_mut(section).flags = SectionFlags::Elf { sh_flags: 0 };\n+        }\n+        _ => {}\n+    };\n     let offset = file.append_section_data(section, &compressed, 1);\n \n     // For MachO and probably PE this is necessary to prevent the linker from throwing away the"}]}