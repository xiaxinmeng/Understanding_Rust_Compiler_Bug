{"sha": "fab96c4b1201977f8875388611be5481079f5cf2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhYjk2YzRiMTIwMTk3N2Y4ODc1Mzg4NjExYmU1NDgxMDc5ZjVjZjI=", "commit": {"author": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2017-10-11T00:22:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-10-11T00:22:24Z"}, "message": "Rollup merge of #45071 - tromey:use-gdb-lazy-string, r=michaelwoerister\n\nImplement display_hint in gdb pretty printers\n\nA few pretty-printers were returning a quoted string from their\nto_string method.  It's preferable in gdb to return a lazy string and to\nlet gdb handle the display by having a \"display_hint\" method that\nreturns \"string\" -- it lets gdb settings (like \"set print ...\") work, it\nhandles corrupted strings a bit better, and it passes the information\nalong to IDEs.", "tree": {"sha": "b57a50f0647269132155206253135d72fc02bb79", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b57a50f0647269132155206253135d72fc02bb79"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fab96c4b1201977f8875388611be5481079f5cf2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fab96c4b1201977f8875388611be5481079f5cf2", "html_url": "https://github.com/rust-lang/rust/commit/fab96c4b1201977f8875388611be5481079f5cf2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fab96c4b1201977f8875388611be5481079f5cf2/comments", "author": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d6d711dd8f7ad5885294b8e1f0009a23dc1f8b1f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6d711dd8f7ad5885294b8e1f0009a23dc1f8b1f", "html_url": "https://github.com/rust-lang/rust/commit/d6d711dd8f7ad5885294b8e1f0009a23dc1f8b1f"}, {"sha": "c3c1df582094b10f803d875f43f6e8b7e3107c5d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3c1df582094b10f803d875f43f6e8b7e3107c5d", "html_url": "https://github.com/rust-lang/rust/commit/c3c1df582094b10f803d875f43f6e8b7e3107c5d"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "0612873e28153b445964ccaffb52021098ddf915", "filename": "src/etc/gdb_rust_pretty_printing.py", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/fab96c4b1201977f8875388611be5481079f5cf2/src%2Fetc%2Fgdb_rust_pretty_printing.py", "raw_url": "https://github.com/rust-lang/rust/raw/fab96c4b1201977f8875388611be5481079f5cf2/src%2Fetc%2Fgdb_rust_pretty_printing.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_rust_pretty_printing.py?ref=fab96c4b1201977f8875388611be5481079f5cf2", "patch": "@@ -248,7 +248,10 @@ def __init__(self, val):\n     def to_string(self):\n         (length, data_ptr) = rustpp.extract_length_and_ptr_from_slice(self.__val)\n         raw_ptr = data_ptr.get_wrapped_value()\n-        return '\"%s\"' % raw_ptr.string(encoding=\"utf-8\", length=length)\n+        return raw_ptr.lazy_string(encoding=\"utf-8\", length=length)\n+\n+    def display_hint(self):\n+        return \"string\"\n \n \n class RustStdVecPrinter(object):\n@@ -278,9 +281,11 @@ def __init__(self, val):\n     def to_string(self):\n         vec = self.__val.get_child_at_index(0)\n         (length, data_ptr, cap) = rustpp.extract_length_ptr_and_cap_from_std_vec(vec)\n-        return '\"%s\"' % data_ptr.get_wrapped_value().string(encoding=\"utf-8\",\n-                                                            length=length)\n+        return data_ptr.get_wrapped_value().lazy_string(encoding=\"utf-8\",\n+                                                        length=length)\n \n+    def display_hint(self):\n+        return \"string\"\n \n class RustOsStringPrinter(object):\n     def __init__(self, val):\n@@ -294,8 +299,10 @@ def to_string(self):\n \n         (length, data_ptr, cap) = rustpp.extract_length_ptr_and_cap_from_std_vec(\n             vec)\n-        return '\"%s\"' % data_ptr.get_wrapped_value().string(length=length)\n+        return data_ptr.get_wrapped_value().lazy_string(length=length)\n \n+    def display_hint(self):\n+        return \"string\"\n \n class RustCStyleVariantPrinter(object):\n     def __init__(self, val):"}, {"sha": "2a28c895b797e2c1eab38159b0133d45c5cce8b7", "filename": "src/test/debuginfo/pretty-std.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fab96c4b1201977f8875388611be5481079f5cf2/src%2Ftest%2Fdebuginfo%2Fpretty-std.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fab96c4b1201977f8875388611be5481079f5cf2/src%2Ftest%2Fdebuginfo%2Fpretty-std.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fpretty-std.rs?ref=fab96c4b1201977f8875388611be5481079f5cf2", "patch": "@@ -44,6 +44,10 @@\n // gdb-command: print some_string\n // gdb-check:$8 = Some = {\"IAMA optional string!\"}\n \n+// gdb-command: set print length 5\n+// gdb-command: print some_string\n+// gdb-check:$8 = Some = {\"IAMA \"...}\n+\n \n // === LLDB TESTS ==================================================================================\n "}]}