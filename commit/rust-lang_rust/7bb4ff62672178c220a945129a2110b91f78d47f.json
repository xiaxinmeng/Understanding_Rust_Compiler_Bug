{"sha": "7bb4ff62672178c220a945129a2110b91f78d47f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiYjRmZjYyNjcyMTc4YzIyMGE5NDUxMjlhMjExMGI5MWY3OGQ0N2Y=", "commit": {"author": {"name": "Andrew Paseltiner", "email": "apaseltiner@gmail.com", "date": "2013-07-05T17:00:11Z"}, "committer": {"name": "Andrew Paseltiner", "email": "apaseltiner@gmail.com", "date": "2013-07-07T23:29:37Z"}, "message": "iterator: Add `IteratorUtil::peek_` method", "tree": {"sha": "324ef73d9c45ce9e7b6e3176d8c68c2e954c853a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/324ef73d9c45ce9e7b6e3176d8c68c2e954c853a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7bb4ff62672178c220a945129a2110b91f78d47f", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7bb4ff62672178c220a945129a2110b91f78d47f", "html_url": "https://github.com/rust-lang/rust/commit/7bb4ff62672178c220a945129a2110b91f78d47f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7bb4ff62672178c220a945129a2110b91f78d47f/comments", "author": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "committer": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "28643d4135b453888be3f383c3f5f751f13bb647", "url": "https://api.github.com/repos/rust-lang/rust/commits/28643d4135b453888be3f383c3f5f751f13bb647", "html_url": "https://github.com/rust-lang/rust/commit/28643d4135b453888be3f383c3f5f751f13bb647"}], "stats": {"total": 65, "additions": 65, "deletions": 0}, "files": [{"sha": "08ccf4fc2553ba56af2c5133b194b8c5dacf2f1e", "filename": "src/libstd/iterator.rs", "status": "modified", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/7bb4ff62672178c220a945129a2110b91f78d47f/src%2Flibstd%2Fiterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7bb4ff62672178c220a945129a2110b91f78d47f/src%2Flibstd%2Fiterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fiterator.rs?ref=7bb4ff62672178c220a945129a2110b91f78d47f", "patch": "@@ -245,6 +245,25 @@ pub trait IteratorUtil<A> {\n     fn flat_map_<'r, B, U: Iterator<B>>(self, f: &'r fn(A) -> U)\n         -> FlatMapIterator<'r, A, B, Self, U>;\n \n+    /// Creates an iterator that calls a function with a reference to each\n+    /// element before yielding it. This is often useful for debugging an\n+    /// iterator pipeline.\n+    ///\n+    /// # Example\n+    ///\n+    /// ~~~ {.rust}\n+    ///let xs = [1u, 4, 2, 3, 8, 9, 6];\n+    ///let sum = xs.iter()\n+    ///            .transform(|&x| x)\n+    ///            .peek_(|&x| debug!(\"filtering %u\", x))\n+    ///            .filter(|&x| x % 2 == 0)\n+    ///            .peek_(|&x| debug!(\"%u made it through\", x))\n+    ///            .sum();\n+    ///println(sum.to_str());\n+    /// ~~~\n+    // FIXME: #5898: should be called `peek`\n+    fn peek_<'r>(self, f: &'r fn(&A)) -> PeekIterator<'r, A, Self>;\n+\n     /// An adaptation of an external iterator to the for-loop protocol of rust.\n     ///\n     /// # Example\n@@ -442,6 +461,12 @@ impl<A, T: Iterator<A>> IteratorUtil<A> for T {\n         FlatMapIterator{iter: self, f: f, subiter: None }\n     }\n \n+    // FIXME: #5898: should be called `peek`\n+    #[inline]\n+    fn peek_<'r>(self, f: &'r fn(&A)) -> PeekIterator<'r, A, T> {\n+        PeekIterator{iter: self, f: f}\n+    }\n+\n     /// A shim implementing the `for` loop iteration protocol for iterator objects\n     #[inline]\n     fn advance(&mut self, f: &fn(A) -> bool) -> bool {\n@@ -1041,6 +1066,32 @@ impl<'self, A, T: Iterator<A>, B, U: Iterator<B>> Iterator<B> for\n     }\n }\n \n+/// An iterator that calls a function with a reference to each\n+/// element before yielding it.\n+pub struct PeekIterator<'self, A, T> {\n+    priv iter: T,\n+    priv f: &'self fn(&A)\n+}\n+\n+impl<'self, A, T: Iterator<A>> Iterator<A> for PeekIterator<'self, A, T> {\n+    #[inline]\n+    fn next(&mut self) -> Option<A> {\n+        let next = self.iter.next();\n+\n+        match next {\n+            Some(ref a) => (self.f)(a),\n+            None => ()\n+        }\n+\n+        next\n+    }\n+\n+    #[inline]\n+    fn size_hint(&self) -> (uint, Option<uint>) {\n+        self.iter.size_hint()\n+    }\n+}\n+\n /// An iterator which just modifies the contained state throughout iteration.\n pub struct UnfoldrIterator<'self, A, St> {\n     priv f: &'self fn(&mut St) -> Option<A>,\n@@ -1236,6 +1287,20 @@ mod tests {\n         assert_eq!(i, ys.len());\n     }\n \n+    #[test]\n+    fn test_peek() {\n+        let xs = [1u, 2, 3, 4];\n+        let mut n = 0;\n+\n+        let ys = xs.iter()\n+                   .transform(|&x| x)\n+                   .peek_(|_| n += 1)\n+                   .collect::<~[uint]>();\n+\n+        assert_eq!(n, xs.len());\n+        assert_eq!(xs, ys.as_slice());\n+    }\n+\n     #[test]\n     fn test_unfoldr() {\n         fn count(st: &mut uint) -> Option<uint> {"}]}