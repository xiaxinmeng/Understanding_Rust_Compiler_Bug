{"sha": "c951ed7fb6daa7dff6dfb3e648576488f74ccaee", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5NTFlZDdmYjZkYWE3ZGZmNmRmYjNlNjQ4NTc2NDg4Zjc0Y2NhZWU=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-02-11T15:36:31Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-02-11T15:36:31Z"}, "message": "Add tested item in the rustdoc --test output", "tree": {"sha": "57d607fe9f3d7eaea3e875ef23da177111dae11d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57d607fe9f3d7eaea3e875ef23da177111dae11d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c951ed7fb6daa7dff6dfb3e648576488f74ccaee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c951ed7fb6daa7dff6dfb3e648576488f74ccaee", "html_url": "https://github.com/rust-lang/rust/commit/c951ed7fb6daa7dff6dfb3e648576488f74ccaee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c951ed7fb6daa7dff6dfb3e648576488f74ccaee/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bae454edc5e18e81b831baf4a7647bf2dda620a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/bae454edc5e18e81b831baf4a7647bf2dda620a8", "html_url": "https://github.com/rust-lang/rust/commit/bae454edc5e18e81b831baf4a7647bf2dda620a8"}], "stats": {"total": 26, "additions": 17, "deletions": 9}, "files": [{"sha": "349bddc87405cbeb2331a714bd8b738f4b0caa67", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c951ed7fb6daa7dff6dfb3e648576488f74ccaee/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c951ed7fb6daa7dff6dfb3e648576488f74ccaee/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=c951ed7fb6daa7dff6dfb3e648576488f74ccaee", "patch": "@@ -418,8 +418,12 @@ impl Collector {\n                     should_panic: bool, no_run: bool, should_ignore: bool,\n                     as_test_harness: bool, compile_fail: bool, error_codes: Vec<String>,\n                     line: usize, filename: String) {\n-        let name = format!(\"{} - line {}\", filename, line);\n-        self.cnt += 1;\n+        let name = if self.use_headers {\n+            let s = self.current_header.as_ref().map(|s| &**s).unwrap_or(\"\");\n+            format!(\"{} - {} (line {})\", filename, s, line)\n+        } else {\n+            format!(\"{} - {} (line {})\", filename, self.names.join(\"::\"), line)\n+        };\n         let cfgs = self.cfgs.clone();\n         let libs = self.libs.clone();\n         let externs = self.externs.clone();"}, {"sha": "64af91b487b322f82e913337175eca6a3091de75", "filename": "src/test/run-make/issue-22131/Makefile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c951ed7fb6daa7dff6dfb3e648576488f74ccaee/src%2Ftest%2Frun-make%2Fissue-22131%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/c951ed7fb6daa7dff6dfb3e648576488f74ccaee/src%2Ftest%2Frun-make%2Fissue-22131%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fissue-22131%2FMakefile?ref=c951ed7fb6daa7dff6dfb3e648576488f74ccaee", "patch": "@@ -4,4 +4,4 @@ all: foo.rs\n \t$(RUSTC) --cfg 'feature=\"bar\"' --crate-type lib foo.rs\n \t$(HOST_RPATH_ENV) '$(RUSTDOC)' --test --cfg 'feature=\"bar\"' \\\n \t\t-L $(TMPDIR) foo.rs |\\\n-\t\tgrep -q 'foo.rs - line 11 ... ok'\n+\t\tgrep -q 'foo.rs - foo (line 11) ... ok'"}, {"sha": "d0aba8a0b0a7eb0d427dcae5b254113c70894d85", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c951ed7fb6daa7dff6dfb3e648576488f74ccaee/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c951ed7fb6daa7dff6dfb3e648576488f74ccaee/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=c951ed7fb6daa7dff6dfb3e648576488f74ccaee", "patch": "@@ -1998,16 +1998,20 @@ actual:\\n\\\n         for _ in res.stdout.split(\"\\n\")\n                            .filter(|s| s.starts_with(\"test \"))\n                            .inspect(|s| {\n-                               let tmp: Vec<&str> = s.split(\" - line \").collect();\n+                               let tmp: Vec<&str> = s.split(\" - \").collect();\n                                if tmp.len() == 2 {\n                                    let path = tmp[0].rsplit(\"test \").next().unwrap();\n                                    if let Some(ref mut v) = files.get_mut(path) {\n                                        tested += 1;\n-                                       let line = tmp[1].split(\" ...\")\n-                                                        .next()\n-                                                        .unwrap_or(\"0\")\n-                                                        .parse()\n-                                                        .unwrap_or(0);\n+                                       let mut iter = tmp[1].split(\"(line \");\n+                                       iter.next();\n+                                       let line = iter.next()\n+                                                      .unwrap_or(\")\")\n+                                                      .split(\")\")\n+                                                      .next()\n+                                                      .unwrap_or(\"0\")\n+                                                      .parse()\n+                                                      .unwrap_or(0);\n                                        if let Ok(pos) = v.binary_search(&line) {\n                                            v.remove(pos);\n                                        } else {"}]}