{"sha": "7db73875ac0d9280ae93b14232249d9c1496583a", "node_id": "C_kwDOAAsO6NoAKDdkYjczODc1YWMwZDkyODBhZTkzYjE0MjMyMjQ5ZDljMTQ5NjU4M2E", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-13T09:58:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-13T09:58:04Z"}, "message": "Auto merge of #12519 - Veykril:hover-assoc, r=Veykril\n\nfeat: On assoc item name hover, render trait decl docs", "tree": {"sha": "f63b06e8411164b8516be201086ff97802789fd2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f63b06e8411164b8516be201086ff97802789fd2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7db73875ac0d9280ae93b14232249d9c1496583a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7db73875ac0d9280ae93b14232249d9c1496583a", "html_url": "https://github.com/rust-lang/rust/commit/7db73875ac0d9280ae93b14232249d9c1496583a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7db73875ac0d9280ae93b14232249d9c1496583a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "366bd7242ed00c65f293497a26eb81c7510ac682", "url": "https://api.github.com/repos/rust-lang/rust/commits/366bd7242ed00c65f293497a26eb81c7510ac682", "html_url": "https://github.com/rust-lang/rust/commit/366bd7242ed00c65f293497a26eb81c7510ac682"}, {"sha": "9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "html_url": "https://github.com/rust-lang/rust/commit/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "1cb67c6657a83400d2a59fc2c725224af69292f5", "filename": "crates/ide/src/hover/render.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/7db73875ac0d9280ae93b14232249d9c1496583a/crates%2Fide%2Fsrc%2Fhover%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7db73875ac0d9280ae93b14232249d9c1496583a/crates%2Fide%2Fsrc%2Fhover%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover%2Frender.rs?ref=7db73875ac0d9280ae93b14232249d9c1496583a", "patch": "@@ -372,7 +372,20 @@ pub(super) fn definition(\n         Definition::ToolModule(it) => return Some(Markup::fenced_block(&it.name(db))),\n     };\n \n-    markup(docs.filter(|_| config.documentation.is_some()).map(Into::into), label, mod_path)\n+    let docs = match config.documentation {\n+        Some(_) => docs.or_else(|| {\n+            // docs are missing, for assoc items of trait impls try to fall back to the docs of the\n+            // original item of the trait\n+            let assoc = def.as_assoc_item(db)?;\n+            let trait_ = assoc.containing_trait_impl(db)?;\n+            let name = Some(assoc.name(db)?);\n+            let item = trait_.items(db).into_iter().find(|it| it.name(db) == name)?;\n+            item.docs(db)\n+        }),\n+        None => None,\n+    };\n+    let docs = docs.filter(|_| config.documentation.is_some()).map(Into::into);\n+    markup(docs, label, mod_path)\n }\n \n fn render_builtin_attr(db: &RootDatabase, attr: hir::BuiltinAttr) -> Option<Markup> {"}, {"sha": "8eb16aab29392b390aa56dca50306fd626edf49e", "filename": "crates/ide/src/hover/tests.rs", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/7db73875ac0d9280ae93b14232249d9c1496583a/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7db73875ac0d9280ae93b14232249d9c1496583a/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs?ref=7db73875ac0d9280ae93b14232249d9c1496583a", "patch": "@@ -4888,3 +4888,33 @@ enum Enum {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn hover_trait_impl_assoc_item_def_doc_forwarding() {\n+    check(\n+        r#\"\n+trait T {\n+    /// Trait docs\n+    fn func() {}\n+}\n+impl T for () {\n+    fn func$0() {}\n+}\n+\"#,\n+        expect![[r#\"\n+            *func*\n+\n+            ```rust\n+            test\n+            ```\n+\n+            ```rust\n+            fn func()\n+            ```\n+\n+            ---\n+\n+            Trait docs\n+        \"#]],\n+    );\n+}"}]}