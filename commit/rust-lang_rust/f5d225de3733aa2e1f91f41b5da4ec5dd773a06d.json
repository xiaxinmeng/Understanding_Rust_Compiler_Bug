{"sha": "f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "node_id": "C_kwDOAAsO6NoAKGY1ZDIyNWRlMzczM2FhMmUxZjkxZjQxYjVkYTRlYzVkZDc3M2EwNmQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-27T13:01:33Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-27T13:01:33Z"}, "message": "Auto merge of #9722 - ebobrow:question-mark, r=Manishearth\n\n`question_mark` don't lint on `if let Err` with `else`\n\ncc #9518\n\nAFAICT the only time this would be a valid suggestion is the rather esoteric\n\n```rust\nlet _ = if let Err(e) = x {\n    return Err(e);\n} else {\n    // no side effects\n    x.unwrap()\n}\n```\n\nwhich doesn't seem worth checking to me. Please correct me if I'm missing something.\n\nchangelog: [`question_mark`] don't lint on `if let Err` with `else`", "tree": {"sha": "dc3f2b6981df8b5e4f86e4bb033666c4bfb5f404", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dc3f2b6981df8b5e4f86e4bb033666c4bfb5f404"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "html_url": "https://github.com/rust-lang/rust/commit/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "710999d941cf1ed911331673f4fbde6279922bb4", "url": "https://api.github.com/repos/rust-lang/rust/commits/710999d941cf1ed911331673f4fbde6279922bb4", "html_url": "https://github.com/rust-lang/rust/commit/710999d941cf1ed911331673f4fbde6279922bb4"}, {"sha": "98250af4a3835dd3e24595ab40b37ee79d72203a", "url": "https://api.github.com/repos/rust-lang/rust/commits/98250af4a3835dd3e24595ab40b37ee79d72203a", "html_url": "https://github.com/rust-lang/rust/commit/98250af4a3835dd3e24595ab40b37ee79d72203a"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "5644c2f72db0d808255bc2ce07a8821ba895f941", "filename": "clippy_lints/src/question_mark.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/clippy_lints%2Fsrc%2Fquestion_mark.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/clippy_lints%2Fsrc%2Fquestion_mark.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fquestion_mark.rs?ref=f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "patch": "@@ -189,6 +189,7 @@ fn is_early_return(smbl: Symbol, cx: &LateContext<'_>, if_block: &IfBlockType<'_\n                             && expr_return_none_or_err(smbl, cx, if_else.unwrap(), let_expr, Some(let_pat_sym)))\n                             || is_res_lang_ctor(cx, res, ResultErr)\n                                 && expr_return_none_or_err(smbl, cx, if_then, let_expr, Some(let_pat_sym))\n+                                && if_else.is_none()\n                     },\n                     _ => false,\n                 }"}, {"sha": "5c49d46da7260853a690c4becc093ae6e4998a37", "filename": "tests/ui/question_mark.fixed", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/tests%2Fui%2Fquestion_mark.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/tests%2Fui%2Fquestion_mark.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fquestion_mark.fixed?ref=f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "patch": "@@ -134,6 +134,9 @@ fn result_func(x: Result<i32, i32>) -> Result<i32, i32> {\n         return func_returning_result();\n     }\n \n+    // no warning\n+    let _ = if let Err(e) = x { Err(e) } else { Ok(0) };\n+\n     Ok(y)\n }\n "}, {"sha": "d057df6a9b35de793d2954b89dfedd0be6878c45", "filename": "tests/ui/question_mark.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/tests%2Fui%2Fquestion_mark.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/tests%2Fui%2Fquestion_mark.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fquestion_mark.rs?ref=f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "patch": "@@ -166,6 +166,9 @@ fn result_func(x: Result<i32, i32>) -> Result<i32, i32> {\n         return func_returning_result();\n     }\n \n+    // no warning\n+    let _ = if let Err(e) = x { Err(e) } else { Ok(0) };\n+\n     Ok(y)\n }\n "}, {"sha": "23172d7e535dd484e165d8ab896c271f70116127", "filename": "tests/ui/question_mark.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/tests%2Fui%2Fquestion_mark.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f5d225de3733aa2e1f91f41b5da4ec5dd773a06d/tests%2Fui%2Fquestion_mark.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fquestion_mark.stderr?ref=f5d225de3733aa2e1f91f41b5da4ec5dd773a06d", "patch": "@@ -115,15 +115,15 @@ LL | |     }\n    | |_____^ help: replace it with: `x?;`\n \n error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:193:5\n+  --> $DIR/question_mark.rs:196:5\n    |\n LL | /     if let Err(err) = func_returning_result() {\n LL | |         return Err(err);\n LL | |     }\n    | |_____^ help: replace it with: `func_returning_result()?;`\n \n error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:200:5\n+  --> $DIR/question_mark.rs:203:5\n    |\n LL | /     if let Err(err) = func_returning_result() {\n LL | |         return Err(err);"}]}