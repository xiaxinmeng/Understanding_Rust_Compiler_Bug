{"sha": "b970d675f5072e638ea4c2166e82ca5a580f6c50", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5NzBkNjc1ZjUwNzJlNjM4ZWE0YzIxNjZlODJjYTVhNTgwZjZjNTA=", "commit": {"author": {"name": "Yusuke Tanaka", "email": "yusuktan@maguro.dev", "date": "2020-08-08T10:18:56Z"}, "committer": {"name": "Yusuke Tanaka", "email": "yusuktan@maguro.dev", "date": "2020-08-08T11:48:45Z"}, "message": "Reverse document symbols for each scope (#5655)", "tree": {"sha": "7a3cf3f8f9d0caa9f74db9d39ae33d076d6dc325", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a3cf3f8f9d0caa9f74db9d39ae33d076d6dc325"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b970d675f5072e638ea4c2166e82ca5a580f6c50", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJIBAABCAAyFiEEgbkHgdnD1idvtMJ0QJ1+7h56cWoFAl8ukR0UHHl1c3VrdGFu\nQG1hZ3Vyby5kZXYACgkQQJ1+7h56cWq2ng/+NHGCqkPCV1zMuUyP63lOxM/qmcse\nKDAeNmJo3q+XvFhIjrig1iKuE+M/mrD1v0WZ29agWZNctgsoxAN+JfrGKevfJEN7\ntZYj2J+OFeHnRRwdmAtYHm8t94hRwInS56gKX8RPWJK6yVZAfCEB0Tn9WRLSo0QG\n6vAgzAFaGCEmrqr3dLQYb0FdeadLZwbTVXFiT+GZk/A5Zdiy3M9qp2QSpoQZzZ0F\nPTGdjltmKYbBVa8rgD67f6Ss1pWA6lL0iwcv8JFCkhWYHMXyHq/gwtbyT+YalsIT\npSLHCpDvzRNLwaAXgtUH1vK1yZUXmwqj/nfn/qfcVxlLT5VKtECqdxLavPaoGGbR\nLDOkUukuNpBROWB4Sukmpi7Jz5RhGlStoQBhp6nlesY4nfBfpuQoc8bX0AGXQy8X\nvj/vwOi+NS9fjCJ6/6h6hWGpIBPnHTzSFkvIaT1LGM0zILXwOexEluCmqFXYJbxp\n44J+LkOW4jpoeXgfJiRyIjzt5QIGbQY8fD55tm8uAn6nAGqDbqeTZhLBkmUY+GpK\nFfc9ljhGF/nuTQ9syvMuc+YFSnQ7WkYY1M06DUGlch0/T9ReOXRR/35wX74WspWO\nE90MMMJT4p3yDS1nlB+mc51zZcTz/Puyvgx/+Rz02H9oV2V5gCHRJZJkakFB3Ccd\n4FEZqs5D/2YMKgA=\n=gtMl\n-----END PGP SIGNATURE-----", "payload": "tree 7a3cf3f8f9d0caa9f74db9d39ae33d076d6dc325\nparent 7a02cc8845ba4e9e3ec414283c60333143831733\nauthor Yusuke Tanaka <yusuktan@maguro.dev> 1596881936 +0900\ncommitter Yusuke Tanaka <yusuktan@maguro.dev> 1596887325 +0900\n\nReverse document symbols for each scope (#5655)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b970d675f5072e638ea4c2166e82ca5a580f6c50", "html_url": "https://github.com/rust-lang/rust/commit/b970d675f5072e638ea4c2166e82ca5a580f6c50", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b970d675f5072e638ea4c2166e82ca5a580f6c50/comments", "author": {"login": "magurotuna", "id": 23649474, "node_id": "MDQ6VXNlcjIzNjQ5NDc0", "avatar_url": "https://avatars.githubusercontent.com/u/23649474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/magurotuna", "html_url": "https://github.com/magurotuna", "followers_url": "https://api.github.com/users/magurotuna/followers", "following_url": "https://api.github.com/users/magurotuna/following{/other_user}", "gists_url": "https://api.github.com/users/magurotuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/magurotuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/magurotuna/subscriptions", "organizations_url": "https://api.github.com/users/magurotuna/orgs", "repos_url": "https://api.github.com/users/magurotuna/repos", "events_url": "https://api.github.com/users/magurotuna/events{/privacy}", "received_events_url": "https://api.github.com/users/magurotuna/received_events", "type": "User", "site_admin": false}, "committer": {"login": "magurotuna", "id": 23649474, "node_id": "MDQ6VXNlcjIzNjQ5NDc0", "avatar_url": "https://avatars.githubusercontent.com/u/23649474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/magurotuna", "html_url": "https://github.com/magurotuna", "followers_url": "https://api.github.com/users/magurotuna/followers", "following_url": "https://api.github.com/users/magurotuna/following{/other_user}", "gists_url": "https://api.github.com/users/magurotuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/magurotuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/magurotuna/subscriptions", "organizations_url": "https://api.github.com/users/magurotuna/orgs", "repos_url": "https://api.github.com/users/magurotuna/repos", "events_url": "https://api.github.com/users/magurotuna/events{/privacy}", "received_events_url": "https://api.github.com/users/magurotuna/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a02cc8845ba4e9e3ec414283c60333143831733", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a02cc8845ba4e9e3ec414283c60333143831733", "html_url": "https://github.com/rust-lang/rust/commit/7a02cc8845ba4e9e3ec414283c60333143831733"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "9944757adb508d44c8c69a723e5a6eeb039931e3", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b970d675f5072e638ea4c2166e82ca5a580f6c50/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b970d675f5072e638ea4c2166e82ca5a580f6c50/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=b970d675f5072e638ea4c2166e82ca5a580f6c50", "patch": "@@ -273,19 +273,24 @@ pub(crate) fn handle_document_symbol(\n         parents.push((doc_symbol, symbol.parent));\n     }\n     let mut document_symbols = Vec::new();\n+    // Constructs `document_symbols` from `parents`, in order from the end.\n     while let Some((node, parent)) = parents.pop() {\n         match parent {\n             None => document_symbols.push(node),\n             Some(i) => {\n-                let children = &mut parents[i].0.children;\n-                if children.is_none() {\n-                    *children = Some(Vec::new());\n-                }\n-                children.as_mut().unwrap().push(node);\n+                parents[i].0.children.get_or_insert_with(Vec::new).push(node);\n             }\n         }\n     }\n \n+    fn reverse(symbols: &mut Vec<DocumentSymbol>) {\n+        for sym in symbols.iter_mut() {\n+            sym.children.as_mut().map(|c| reverse(c));\n+        }\n+        symbols.reverse();\n+    }\n+    reverse(&mut document_symbols);\n+\n     let res = if snap.config.client_caps.hierarchical_symbols {\n         document_symbols.into()\n     } else {"}]}