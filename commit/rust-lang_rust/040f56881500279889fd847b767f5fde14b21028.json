{"sha": "040f56881500279889fd847b767f5fde14b21028", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0MGY1Njg4MTUwMDI3OTg4OWZkODQ3Yjc2N2Y1ZmRlMTRiMjEwMjg=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-10-25T19:13:27Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-10-25T19:13:27Z"}, "message": "Rely on regular \"expected\"/\"found\" parser error for `fn`", "tree": {"sha": "2be89807edcd06ad45c36166f2125cf57fed548e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2be89807edcd06ad45c36166f2125cf57fed548e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/040f56881500279889fd847b767f5fde14b21028", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/040f56881500279889fd847b767f5fde14b21028", "html_url": "https://github.com/rust-lang/rust/commit/040f56881500279889fd847b767f5fde14b21028", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/040f56881500279889fd847b767f5fde14b21028/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "07a63e6d1fabf3560e8e1e17c1d56b10a06152d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/07a63e6d1fabf3560e8e1e17c1d56b10a06152d9", "html_url": "https://github.com/rust-lang/rust/commit/07a63e6d1fabf3560e8e1e17c1d56b10a06152d9"}], "stats": {"total": 67, "additions": 36, "deletions": 31}, "files": [{"sha": "6e4ae960b64ac0fffbe630b21e5eeaab074f3f89", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1550,14 +1550,6 @@ impl<'a> Parser<'a> {\n         }\n     }\n \n-    pub(super) fn expected_semi_or_open_brace<T>(&mut self) -> PResult<'a, T> {\n-        let token_str = super::token_descr(&self.token);\n-        let msg = &format!(\"expected `;` or `{{`, found {}\", token_str);\n-        let mut err = self.struct_span_err(self.token.span, msg);\n-        err.span_label(self.token.span, \"expected `;` or `{`\");\n-        Err(err)\n-    }\n-\n     pub(super) fn eat_incorrect_doc_comment_for_param_type(&mut self) {\n         if let token::DocComment(..) = self.token.kind {\n             self.struct_span_err("}, {"sha": "2b143cd7696ca5ab2bebf2234805855d904dfc8b", "filename": "compiler/rustc_parse/src/parser/item.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1551,10 +1551,9 @@ impl<'a> Parser<'a> {\n         attrs: &mut Vec<Attribute>,\n         sig_hi: &mut Span,\n     ) -> PResult<'a, Option<P<Block>>> {\n-        let (inner_attrs, body) = if self.check(&token::Semi) {\n+        let (inner_attrs, body) = if self.eat(&token::Semi) {\n             // Include the trailing semicolon in the span of the signature\n-            *sig_hi = self.token.span;\n-            self.bump(); // `;`\n+            *sig_hi = self.prev_token.span;\n             (Vec::new(), None)\n         } else if self.check(&token::OpenDelim(token::Brace)) || self.token.is_whole_block() {\n             self.parse_inner_attrs_and_block().map(|(attrs, body)| (attrs, Some(body)))?\n@@ -1574,7 +1573,9 @@ impl<'a> Parser<'a> {\n                 .emit();\n             (Vec::new(), Some(self.mk_block_err(span)))\n         } else {\n-            return self.expected_semi_or_open_brace();\n+            return self\n+                .expected_one_of_not_found(&[], &[token::Semi, token::OpenDelim(token::Brace)])\n+                .map(|_| None);\n         };\n         attrs.extend(inner_attrs);\n         Ok(body)"}, {"sha": "9aebb4e2f4854087b10514959373bb96eb0d162f", "filename": "src/test/ui/issues/issue-39616.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-39616.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-39616.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-39616.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1,4 +1,4 @@\n fn foo(a: [0; 1]) {} //~ ERROR expected type, found `0`\n-//~| ERROR expected `;` or `{`, found `]`\n+//~| ERROR expected one of `)`, `,`, `->`, `;`, `where`, or `{`, found `]`\n \n fn main() {}"}, {"sha": "fa8ef50a073f24b5f218649ccb6faa21a7ad654e", "filename": "src/test/ui/issues/issue-39616.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-39616.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-39616.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-39616.stderr?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -4,11 +4,11 @@ error: expected type, found `0`\n LL | fn foo(a: [0; 1]) {}\n    |            ^ expected type\n \n-error: expected `;` or `{`, found `]`\n+error: expected one of `)`, `,`, `->`, `;`, `where`, or `{`, found `]`\n   --> $DIR/issue-39616.rs:1:16\n    |\n LL | fn foo(a: [0; 1]) {}\n-   |                ^ expected `;` or `{`\n+   |                ^ expected one of `)`, `,`, `->`, `;`, `where`, or `{`\n \n error: aborting due to 2 previous errors\n "}, {"sha": "332a3014416b57569985af36858c5b3b54f185a0", "filename": "src/test/ui/issues/issue-58856-1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-58856-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-58856-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-58856-1.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -2,7 +2,7 @@ impl A {\n     //~^ ERROR cannot find type `A` in this scope\n     fn b(self>\n     //~^ ERROR expected one of `)`, `,`, or `:`, found `>`\n-    //~| ERROR expected `;` or `{`, found `>`\n+    //~| ERROR expected one of `->`, `;`, `where`, or `{`, found `>`\n }\n \n fn main() {}"}, {"sha": "f1abb40ed7a739a4dde60dfa33edb4f330f0879d", "filename": "src/test/ui/issues/issue-58856-1.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-58856-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fissues%2Fissue-58856-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-58856-1.stderr?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -6,14 +6,14 @@ LL |     fn b(self>\n    |         |\n    |         unclosed delimiter\n \n-error: expected `;` or `{`, found `>`\n+error: expected one of `->`, `;`, `where`, or `{`, found `>`\n   --> $DIR/issue-58856-1.rs:3:14\n    |\n LL | impl A {\n    |        - while parsing this item list starting here\n LL |\n LL |     fn b(self>\n-   |              ^ expected `;` or `{`\n+   |              ^ expected one of `->`, `;`, `where`, or `{`\n ...\n LL | }\n    | - the item list ends here"}, {"sha": "c791fb3ae674970948a888bdc260d629a8bad221", "filename": "src/test/ui/parser/fn-colon-return-type.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Ffn-colon-return-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Ffn-colon-return-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ffn-colon-return-type.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -0,0 +1,5 @@\n+fn foo(x: i32): i32 { //~ ERROR expected one of `->`, `;`, `where`, or `{`, found `:`\n+    x\n+}\n+\n+fn main() {}"}, {"sha": "92df9bc60bd3c1162d8f3d51c8a5e8af1fdcce5a", "filename": "src/test/ui/parser/fn-colon-return-type.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Ffn-colon-return-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Ffn-colon-return-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ffn-colon-return-type.stderr?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -0,0 +1,8 @@\n+error: expected one of `->`, `;`, `where`, or `{`, found `:`\n+  --> $DIR/fn-colon-return-type.rs:1:15\n+   |\n+LL | fn foo(x: i32): i32 {\n+   |               ^ expected one of `->`, `;`, `where`, or `{`\n+\n+error: aborting due to previous error\n+"}, {"sha": "568a6c5f05c850698e821405decb4098a06e3da0", "filename": "src/test/ui/parser/issue-24780.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-24780.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-24780.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-24780.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -3,6 +3,6 @@\n // expected one of ..., `>`, ... found `>`\n \n fn foo() -> Vec<usize>> {\n-    //~^ ERROR expected `;` or `{`, found `>`\n+    //~^ ERROR expected one of `!`, `+`, `::`, `;`, `where`, or `{`, found `>`\n     Vec::new()\n }"}, {"sha": "bdd089bb7a13934ee379928e7f7c646fd955e028", "filename": "src/test/ui/parser/issue-24780.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-24780.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-24780.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-24780.stderr?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1,8 +1,8 @@\n-error: expected `;` or `{`, found `>`\n+error: expected one of `!`, `+`, `::`, `;`, `where`, or `{`, found `>`\n   --> $DIR/issue-24780.rs:5:23\n    |\n LL | fn foo() -> Vec<usize>> {\n-   |                       ^ expected `;` or `{`\n+   |                       ^ expected one of `!`, `+`, `::`, `;`, `where`, or `{`\n \n error: aborting due to previous error\n "}, {"sha": "9ed5a61220bde543f6d8043d43c2df2c4745117b", "filename": "src/test/ui/parser/issue-6610.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-6610.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-6610.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-6610.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1,3 +1,3 @@\n-trait Foo { fn a() } //~ ERROR expected `;` or `{`, found `}`\n+trait Foo { fn a() } //~ ERROR expected one of `->`, `;`, `where`, or `{`, found `}`\n \n fn main() {}"}, {"sha": "acbecfded4ba56d3da5b5208c171edc3cc800722", "filename": "src/test/ui/parser/issue-6610.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-6610.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fissue-6610.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-6610.stderr?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1,10 +1,10 @@\n-error: expected `;` or `{`, found `}`\n+error: expected one of `->`, `;`, `where`, or `{`, found `}`\n   --> $DIR/issue-6610.rs:1:20\n    |\n LL | trait Foo { fn a() }\n    |           -        ^\n    |           |        |\n-   |           |        expected `;` or `{`\n+   |           |        expected one of `->`, `;`, `where`, or `{`\n    |           |        the item list ends here\n    |           while parsing this item list starting here\n "}, {"sha": "22e1c2f97e76936c4a95f046afc3d45b0dd5cb87", "filename": "src/test/ui/parser/missing_right_paren.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fmissing_right_paren.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fmissing_right_paren.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fmissing_right_paren.stderr?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -22,11 +22,11 @@ error: expected one of `:` or `|`, found `)`\n LL | fn main((\u063c\n    |           ^ expected one of `:` or `|`\n \n-error: expected `;` or `{`, found `<eof>`\n+error: expected one of `->`, `;`, `where`, or `{`, found `<eof>`\n   --> $DIR/missing_right_paren.rs:3:11\n    |\n LL | fn main((\u063c\n-   |           ^ expected `;` or `{`\n+   |           ^ expected one of `->`, `;`, `where`, or `{`\n \n error: aborting due to 4 previous errors\n "}, {"sha": "1b3d9bf66bb6072643767443a68dd6b82a1df0f8", "filename": "src/test/ui/parser/not-a-pred.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fnot-a-pred.rs", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fnot-a-pred.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fnot-a-pred.rs?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1,6 +1,5 @@\n-// error-pattern: lt\n-\n fn f(a: isize, b: isize) : lt(a, b) { }\n+//~^ ERROR expected one of `->`, `;`, `where`, or `{`, found `:`\n \n fn lt(a: isize, b: isize) { }\n "}, {"sha": "ec413c5594c44429e497920a88298429f64a5ef3", "filename": "src/test/ui/parser/not-a-pred.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fnot-a-pred.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/040f56881500279889fd847b767f5fde14b21028/src%2Ftest%2Fui%2Fparser%2Fnot-a-pred.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fnot-a-pred.stderr?ref=040f56881500279889fd847b767f5fde14b21028", "patch": "@@ -1,8 +1,8 @@\n-error: expected `;` or `{`, found `:`\n-  --> $DIR/not-a-pred.rs:3:26\n+error: expected one of `->`, `;`, `where`, or `{`, found `:`\n+  --> $DIR/not-a-pred.rs:1:26\n    |\n LL | fn f(a: isize, b: isize) : lt(a, b) { }\n-   |                          ^ expected `;` or `{`\n+   |                          ^ expected one of `->`, `;`, `where`, or `{`\n \n error: aborting due to previous error\n "}]}