{"sha": "0fba2d02559e16c7b243aff60bb5c2cbeacf0e58", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmYmEyZDAyNTU5ZTE2YzdiMjQzYWZmNjBiYjVjMmNiZWFjZjBlNTg=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-01-10T22:34:53Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-01-10T22:34:53Z"}, "message": "Fix 'make distcheck', close #1445.", "tree": {"sha": "36e371a233931c4a5586b293408699bd1bf1d5f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36e371a233931c4a5586b293408699bd1bf1d5f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58", "html_url": "https://github.com/rust-lang/rust/commit/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1592de0fafcf74483ea0778a15015f87be426d3b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1592de0fafcf74483ea0778a15015f87be426d3b", "html_url": "https://github.com/rust-lang/rust/commit/1592de0fafcf74483ea0778a15015f87be426d3b"}], "stats": {"total": 74, "additions": 30, "deletions": 44}, "files": [{"sha": "34d5f59fdc6b3d7d64a6b0e8708caef9ca56f208", "filename": "Makefile.in", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=0fba2d02559e16c7b243aff60bb5c2cbeacf0e58", "patch": "@@ -209,9 +209,9 @@ STDLIB_INPUTS := $(wildcard $(addprefix $(S)src/libstd/,          \\\n ######################################################################\n \n COMPILER_CRATE := $(S)src/comp/rustc.rc\n-COMPILER_INPUTS := $(filter-out $(S)src/comp/driver/rustc.rs,         \\\n-\t\t\t\t$(wildcard $(addprefix $(S)src/comp/, \\\n-                                rustc.rc *.rs */*.rs */*/*.rs)))\n+COMPILER_INPUTS := $(filter-out $(S)src/comp/driver/rustc.rs,     \\\n+                       $(wildcard $(addprefix $(S)src/comp/,      \\\n+                           rustc.rc *.rs */*.rs */*/*.rs)))\n \n RUSTC_INPUTS := $(S)src/comp/driver/rustc.rs\n "}, {"sha": "fecdede796bd0b4be0b75157f783b5982ee09b01", "filename": "mk/dist.mk", "status": "modified", "additions": 27, "deletions": 41, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/0fba2d02559e16c7b243aff60bb5c2cbeacf0e58/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=0fba2d02559e16c7b243aff60bb5c2cbeacf0e58", "patch": "@@ -13,51 +13,37 @@ PKG_NSI = $(S)src/etc/pkg/rust.nsi\n PKG_EXE = $(PKG_DIR)-install.exe\n endif\n \n-PKG_3RDPARTY := rt/vg/valgrind.h rt/vg/memcheck.h \\\n-                rt/isaac/rand.h rt/isaac/standard.h \\\n-                rt/uthash/uthash.h rt/uthash/utlist.h \\\n-                rt/bigint/bigint.h rt/bigint/bigint_int.cpp \\\n-                rt/bigint/bigint_ext.cpp rt/bigint/low_primes.h\n+PKG_OMIT_LLVM_DIRS := examples bindings/ocaml projects\n+PKG_OMIT_LLVM_PATS := $(foreach d,$(PKG_OMIT_LLVM_DIRS), %$(d))\n+PKG_LLVM_SKEL := $(foreach d,$(PKG_OMIT_LLVM_DIRS), \\\n+                     $(wildcard $(S)src/llvm/$(d)/*.in \\\n+                                $(S)src/llvm/$(d)/Makefile*))\n \n-PKG_UV := \\\n-                $(wildcard $(S)src/libuv/*) \\\n-                $(wildcard $(S)src/libuv/include/*) \\\n-                $(wildcard $(S)src/libuv/include/*/*) \\\n-                $(wildcard $(S)src/libuv/src/*) \\\n-                $(wildcard $(S)src/libuv/src/*/*) \\\n-                $(wildcard $(S)src/libuv/src/*/*/*)\n-\n-PKG_PP_EXAMPLES = $(wildcard $(S)src/test/pretty/*.pp)\n+PKG_GITMODULES := \\\n+    $(filter-out %test, $(wildcard $(S)src/libuv/*)) \\\n+    $(filter-out $(PKG_OMIT_LLVM_PATS), \\\n+                 $(wildcard $(S)src/llvm/*)) \\\n+    $(PKG_LLVM_SKEL)\n \n PKG_FILES = \\\n-    $(wildcard $(S)src/etc/*.*)                \\\n     $(S)LICENSE.txt $(S)README                 \\\n     $(S)configure $(S)Makefile.in              \\\n-    $(S)src/snapshots.txt                      \\\n+    $(S)/doc                                   \\\n     $(addprefix $(S)src/,                      \\\n-      README comp/README                       \\\n-      $(RUNTIME_CS) $(RUNTIME_HDR)             \\\n-      $(RUNTIME_S)                             \\\n-      rt/rustrt.def.in                         \\\n-      rt/intrinsics/intrinsics.i386.ll.in      \\\n-      rt/intrinsics/intrinsics.x86_64.ll.in    \\\n-      rt/intrinsics/intrinsics.cpp             \\\n-      $(RUSTLLVM_LIB_CS) $(RUSTLLVM_OBJS_CS)   \\\n-      $(RUSTLLVM_HDR)                          \\\n-      rustllvm/rustllvm.def.in                 \\\n-      $(PKG_3RDPARTY))                         \\\n-    $(PKG_UV)                                  \\\n-    $(COMPILER_INPUTS)                         \\\n-    $(CORELIB_INPUTS)                          \\\n-    $(STDLIB_INPUTS)                           \\\n-    $(ALL_TEST_INPUTS)                         \\\n-    $(FUZZER_CRATE)                            \\\n-    $(FUZZER_INPUTS)                           \\\n-    $(COMPILETEST_CRATE)                       \\\n-    $(COMPILETEST_INPUTS)                      \\\n-    $(CARGO_CRATE)                             \\\n-    $(CARGO_INPUTS)                            \\\n-    $(PKG_PP_EXAMPLES)                         \\\n+      README                                   \\\n+      cargo                                    \\\n+      comp                                     \\\n+      compiletest                              \\\n+      etc                                      \\\n+      fuzzer                                   \\\n+      libcore                                  \\\n+      libstd                                   \\\n+      rt                                       \\\n+      rustdoc                                  \\\n+      rustllvm                                 \\\n+      snapshots.txt                            \\\n+      test)                                    \\\n+    $(PKG_GITMODULES)                          \\\n     $(MKFILE_DEPS)\n \n dist: $(PKG_TAR) $(PKG_EXE)\n@@ -90,9 +76,9 @@ distcheck: $(PKG_TAR)\n \t$(Q)mkdir -p dist/$(PKG_DIR)-build\n \t$(Q)cd dist/$(PKG_DIR)-build && ../$(PKG_DIR)/configure\n \t@$(call E, making 'check' in dist/$(PKG_DIR)-build)\n-\t$(Q)make -C dist/$(PKG_DIR)-build check\n+\t$(Q)+make -C dist/$(PKG_DIR)-build check\n \t@$(call E, making 'clean' in dist/$(PKG_DIR)-build)\n-\t$(Q)make -C dist/$(PKG_DIR)-build clean\n+\t$(Q)+make -C dist/$(PKG_DIR)-build clean\n \t$(Q)rm -Rf dist\n \t@echo\n \t@echo -----------------------------------------------"}]}