{"sha": "f894adce8cd93a9edf3ce0908920e514d837e0dd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4OTRhZGNlOGNkOTNhOWVkZjNjZTA5MDg5MjBlNTE0ZDgzN2UwZGQ=", "commit": {"author": {"name": "rhysd", "email": "lin90162@yahoo.co.jp", "date": "2019-01-30T17:39:38Z"}, "committer": {"name": "rhysd", "email": "lin90162@yahoo.co.jp", "date": "2019-01-30T17:39:38Z"}, "message": "implement dbg_macro rule (fixes #3721)", "tree": {"sha": "d25afce5439ef40c176d5fb24604a8a68851a85e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d25afce5439ef40c176d5fb24604a8a68851a85e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f894adce8cd93a9edf3ce0908920e514d837e0dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f894adce8cd93a9edf3ce0908920e514d837e0dd", "html_url": "https://github.com/rust-lang/rust/commit/f894adce8cd93a9edf3ce0908920e514d837e0dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f894adce8cd93a9edf3ce0908920e514d837e0dd/comments", "author": {"login": "rhysd", "id": 823277, "node_id": "MDQ6VXNlcjgyMzI3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/823277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rhysd", "html_url": "https://github.com/rhysd", "followers_url": "https://api.github.com/users/rhysd/followers", "following_url": "https://api.github.com/users/rhysd/following{/other_user}", "gists_url": "https://api.github.com/users/rhysd/gists{/gist_id}", "starred_url": "https://api.github.com/users/rhysd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rhysd/subscriptions", "organizations_url": "https://api.github.com/users/rhysd/orgs", "repos_url": "https://api.github.com/users/rhysd/repos", "events_url": "https://api.github.com/users/rhysd/events{/privacy}", "received_events_url": "https://api.github.com/users/rhysd/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rhysd", "id": 823277, "node_id": "MDQ6VXNlcjgyMzI3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/823277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rhysd", "html_url": "https://github.com/rhysd", "followers_url": "https://api.github.com/users/rhysd/followers", "following_url": "https://api.github.com/users/rhysd/following{/other_user}", "gists_url": "https://api.github.com/users/rhysd/gists{/gist_id}", "starred_url": "https://api.github.com/users/rhysd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rhysd/subscriptions", "organizations_url": "https://api.github.com/users/rhysd/orgs", "repos_url": "https://api.github.com/users/rhysd/repos", "events_url": "https://api.github.com/users/rhysd/events{/privacy}", "received_events_url": "https://api.github.com/users/rhysd/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ce78d1257ac6fd77f245730fcfbadd536a173eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ce78d1257ac6fd77f245730fcfbadd536a173eb", "html_url": "https://github.com/rust-lang/rust/commit/6ce78d1257ac6fd77f245730fcfbadd536a173eb"}], "stats": {"total": 68, "additions": 68, "deletions": 0}, "files": [{"sha": "fad012bf7a2562e0e0f2f50174e4bc5b7594b493", "filename": "clippy_lints/src/dbg_macro.rs", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/f894adce8cd93a9edf3ce0908920e514d837e0dd/clippy_lints%2Fsrc%2Fdbg_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f894adce8cd93a9edf3ce0908920e514d837e0dd/clippy_lints%2Fsrc%2Fdbg_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdbg_macro.rs?ref=f894adce8cd93a9edf3ce0908920e514d837e0dd", "patch": "@@ -0,0 +1,51 @@\n+use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n+use rustc::{declare_tool_lint, lint_array};\n+use crate::utils::span_lint;\n+use syntax::ast;\n+\n+/// **What it does:** Checks for usage of dbg!() macro not to have it in\n+/// version control.\n+///\n+/// **Why is this bad?** `dbg!` macro is intended as a debugging tool.\n+///\n+/// **Known problems:** None.\n+///\n+/// **Example:**\n+/// ```rust,ignore\n+/// // Bad\n+/// dbg!(true)\n+///\n+/// // Good\n+/// true\n+/// ```\n+declare_clippy_lint! {\n+    pub DBG_MACRO,\n+    style,\n+    \"`dbg!` macro is intended as a debugging tool\"\n+}\n+\n+#[derive(Copy, Clone, Debug)]\n+pub struct Pass;\n+\n+impl LintPass for Pass {\n+    fn get_lints(&self) -> LintArray {\n+        lint_array!(DBG_MACRO)\n+    }\n+\n+    fn name(&self) -> &'static str {\n+        \"DbgMacro\"\n+    }\n+}\n+\n+impl EarlyLintPass for Pass {\n+    fn check_mac(&mut self, cx: &EarlyContext<'_>, mac: &ast::Mac) {\n+        if mac.node.path == \"dbg\" {\n+            span_lint(\n+                cx,\n+                DBG_MACRO,\n+                mac.span,\n+                \"`dbg!` macro is intended as a debugging tool. ensure to avoid having uses of it in version control\",\n+            );\n+        }\n+    }\n+}"}, {"sha": "9681e58914d0a22eadb6c3110a0f237cbbf56440", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f894adce8cd93a9edf3ce0908920e514d837e0dd/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f894adce8cd93a9edf3ce0908920e514d837e0dd/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=f894adce8cd93a9edf3ce0908920e514d837e0dd", "patch": "@@ -94,6 +94,7 @@ pub mod const_static_lifetime;\n pub mod copies;\n pub mod copy_iterator;\n pub mod cyclomatic_complexity;\n+pub mod dbg_macro;\n pub mod default_trait_access;\n pub mod derive;\n pub mod doc;\n@@ -231,6 +232,7 @@ pub fn register_pre_expansion_lints(\n         },\n     );\n     store.register_pre_expansion_pass(Some(session), true, false, box attrs::CfgAttrPass);\n+    store.register_pre_expansion_pass(Some(session), true, false, box dbg_macro::Pass);\n }\n \n pub fn read_conf(reg: &rustc_plugin::Registry<'_>) -> Conf {\n@@ -589,6 +591,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n         copies::IFS_SAME_COND,\n         copies::IF_SAME_THEN_ELSE,\n         cyclomatic_complexity::CYCLOMATIC_COMPLEXITY,\n+        dbg_macro::DBG_MACRO,\n         derive::DERIVE_HASH_XOR_EQ,\n         double_comparison::DOUBLE_COMPARISONS,\n         double_parens::DOUBLE_PARENS,\n@@ -800,6 +803,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n         block_in_if_condition::BLOCK_IN_IF_CONDITION_STMT,\n         collapsible_if::COLLAPSIBLE_IF,\n         const_static_lifetime::CONST_STATIC_LIFETIME,\n+        dbg_macro::DBG_MACRO,\n         enum_variants::ENUM_VARIANT_NAMES,\n         enum_variants::MODULE_INCEPTION,\n         eq_op::OP_REF,"}, {"sha": "cf113050c2671cc832318bd5e9fa90a6e33ad248", "filename": "tests/ui/dbg_macro.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f894adce8cd93a9edf3ce0908920e514d837e0dd/tests%2Fui%2Fdbg_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f894adce8cd93a9edf3ce0908920e514d837e0dd/tests%2Fui%2Fdbg_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdbg_macro.rs?ref=f894adce8cd93a9edf3ce0908920e514d837e0dd", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    dbg!(42);\n+}"}, {"sha": "cb5389c6e765c13f174b05bb373446e300a943b7", "filename": "tests/ui/dbg_macro.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f894adce8cd93a9edf3ce0908920e514d837e0dd/tests%2Fui%2Fdbg_macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f894adce8cd93a9edf3ce0908920e514d837e0dd/tests%2Fui%2Fdbg_macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdbg_macro.stderr?ref=f894adce8cd93a9edf3ce0908920e514d837e0dd", "patch": "@@ -0,0 +1,10 @@\n+error: `dbg!` macro is intended as a debugging tool. ensure to avoid having uses of it in version control\n+  --> $DIR/dbg_macro.rs:2:5\n+   |\n+LL |     dbg!(42);\n+   |     ^^^^^^^^\n+   |\n+   = note: `-D clippy::dbg-macro` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}