{"sha": "4d773829c53e4efd7ab26e19393a9dd2651345cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkNzczODI5YzUzZTRlZmQ3YWIyNmUxOTM5M2E5ZGQyNjUxMzQ1Y2M=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2019-12-26T16:57:50Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2019-12-30T10:29:30Z"}, "message": "Avoid a few allocations.", "tree": {"sha": "88be151b9c61e9fa99f67a721555988dfa1fa930", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88be151b9c61e9fa99f67a721555988dfa1fa930"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4d773829c53e4efd7ab26e19393a9dd2651345cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4d773829c53e4efd7ab26e19393a9dd2651345cc", "html_url": "https://github.com/rust-lang/rust/commit/4d773829c53e4efd7ab26e19393a9dd2651345cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4d773829c53e4efd7ab26e19393a9dd2651345cc/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d74e9ba1351dd58f333328558ef1246211d818d", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d74e9ba1351dd58f333328558ef1246211d818d", "html_url": "https://github.com/rust-lang/rust/commit/2d74e9ba1351dd58f333328558ef1246211d818d"}], "stats": {"total": 26, "additions": 14, "deletions": 12}, "files": [{"sha": "8f9de3f4277e3a3224e18c1f027ec66178e81023", "filename": "src/librustc/hir/lowering.rs", "status": "modified", "additions": 13, "deletions": 11, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/4d773829c53e4efd7ab26e19393a9dd2651345cc/src%2Flibrustc%2Fhir%2Flowering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4d773829c53e4efd7ab26e19393a9dd2651345cc/src%2Flibrustc%2Fhir%2Flowering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering.rs?ref=4d773829c53e4efd7ab26e19393a9dd2651345cc", "patch": "@@ -1890,7 +1890,6 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         if !generic_args.parenthesized && !has_lifetimes {\n             generic_args.args = self\n                 .elided_path_lifetimes(path_span, expected_lifetimes)\n-                .into_iter()\n                 .map(|lt| GenericArg::Lifetime(lt))\n                 .chain(generic_args.args.into_iter())\n                 .collect();\n@@ -2460,16 +2459,15 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         hir::Lifetime { hir_id: self.lower_node_id(id), span, name }\n     }\n \n-    fn lower_generic_params_mut(\n-        &mut self,\n-        params: &[GenericParam],\n-        add_bounds: &NodeMap<Vec<GenericBound>>,\n-        mut itctx: ImplTraitContext<'_, 'hir>,\n-    ) -> Vec<hir::GenericParam<'hir>> {\n+    fn lower_generic_params_mut<'s>(\n+        &'s mut self,\n+        params: &'s [GenericParam],\n+        add_bounds: &'s NodeMap<Vec<GenericBound>>,\n+        mut itctx: ImplTraitContext<'s, 'hir>,\n+    ) -> impl Iterator<Item = hir::GenericParam<'hir>> + Captures<'a> + Captures<'s> {\n         params\n             .iter()\n-            .map(|param| self.lower_generic_param(param, add_bounds, itctx.reborrow()))\n-            .collect()\n+            .map(move |param| self.lower_generic_param(param, add_bounds, itctx.reborrow()))\n     }\n \n     fn lower_generic_params(\n@@ -3200,8 +3198,12 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     /// `std::cell::Ref<T>`; note that implicit lifetimes in these\n     /// sorts of cases are deprecated. This may therefore report a warning or an\n     /// error, depending on the mode.\n-    fn elided_path_lifetimes(&mut self, span: Span, count: usize) -> Vec<hir::Lifetime> {\n-        (0..count).map(|_| self.elided_path_lifetime(span)).collect()\n+    fn elided_path_lifetimes<'s>(\n+        &'s mut self,\n+        span: Span,\n+        count: usize,\n+    ) -> impl Iterator<Item = hir::Lifetime> + Captures<'a> + Captures<'s> + Captures<'hir> {\n+        (0..count).map(move |_| self.elided_path_lifetime(span))\n     }\n \n     fn elided_path_lifetime(&mut self, span: Span) -> hir::Lifetime {"}, {"sha": "48c93547603bd2a120e799132b59f9344133ad27", "filename": "src/librustc/hir/lowering/item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4d773829c53e4efd7ab26e19393a9dd2651345cc/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4d773829c53e4efd7ab26e19393a9dd2651345cc/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs?ref=4d773829c53e4efd7ab26e19393a9dd2651345cc", "patch": "@@ -1345,7 +1345,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         }\n \n         GenericsCtor {\n-            params: self.lower_generic_params_mut(&generics.params, &add_bounds, itctx),\n+            params: self.lower_generic_params_mut(&generics.params, &add_bounds, itctx).collect(),\n             where_clause: self.lower_where_clause(&generics.where_clause),\n             span: generics.span,\n         }"}]}