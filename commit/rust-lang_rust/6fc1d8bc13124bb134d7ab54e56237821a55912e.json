{"sha": "6fc1d8bc13124bb134d7ab54e56237821a55912e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmYzFkOGJjMTMxMjRiYjEzNGQ3YWI1NGU1NjIzNzgyMWE1NTkxMmU=", "commit": {"author": {"name": "Erik Desjardins", "email": "erikdesjardins@users.noreply.github.com", "date": "2020-08-17T02:02:18Z"}, "committer": {"name": "Erik Desjardins", "email": "erikdesjardins@users.noreply.github.com", "date": "2020-08-30T18:58:03Z"}, "message": "add codegen test", "tree": {"sha": "5e632f4a0f08c36d5bcc43d0c25e448cba6a5f8c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e632f4a0f08c36d5bcc43d0c25e448cba6a5f8c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6fc1d8bc13124bb134d7ab54e56237821a55912e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6fc1d8bc13124bb134d7ab54e56237821a55912e", "html_url": "https://github.com/rust-lang/rust/commit/6fc1d8bc13124bb134d7ab54e56237821a55912e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6fc1d8bc13124bb134d7ab54e56237821a55912e/comments", "author": {"login": "erikdesjardins", "id": 7673145, "node_id": "MDQ6VXNlcjc2NzMxNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7673145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erikdesjardins", "html_url": "https://github.com/erikdesjardins", "followers_url": "https://api.github.com/users/erikdesjardins/followers", "following_url": "https://api.github.com/users/erikdesjardins/following{/other_user}", "gists_url": "https://api.github.com/users/erikdesjardins/gists{/gist_id}", "starred_url": "https://api.github.com/users/erikdesjardins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erikdesjardins/subscriptions", "organizations_url": "https://api.github.com/users/erikdesjardins/orgs", "repos_url": "https://api.github.com/users/erikdesjardins/repos", "events_url": "https://api.github.com/users/erikdesjardins/events{/privacy}", "received_events_url": "https://api.github.com/users/erikdesjardins/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erikdesjardins", "id": 7673145, "node_id": "MDQ6VXNlcjc2NzMxNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7673145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erikdesjardins", "html_url": "https://github.com/erikdesjardins", "followers_url": "https://api.github.com/users/erikdesjardins/followers", "following_url": "https://api.github.com/users/erikdesjardins/following{/other_user}", "gists_url": "https://api.github.com/users/erikdesjardins/gists{/gist_id}", "starred_url": "https://api.github.com/users/erikdesjardins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erikdesjardins/subscriptions", "organizations_url": "https://api.github.com/users/erikdesjardins/orgs", "repos_url": "https://api.github.com/users/erikdesjardins/repos", "events_url": "https://api.github.com/users/erikdesjardins/events{/privacy}", "received_events_url": "https://api.github.com/users/erikdesjardins/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68217c9e0f1269d29b4c1c72d08fb1b95bf441cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/68217c9e0f1269d29b4c1c72d08fb1b95bf441cd", "html_url": "https://github.com/rust-lang/rust/commit/68217c9e0f1269d29b4c1c72d08fb1b95bf441cd"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "3c63cddccad64ab537f4475024de0a2fde814829", "filename": "src/test/codegen/zst-offset.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/6fc1d8bc13124bb134d7ab54e56237821a55912e/src%2Ftest%2Fcodegen%2Fzst-offset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6fc1d8bc13124bb134d7ab54e56237821a55912e/src%2Ftest%2Fcodegen%2Fzst-offset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fzst-offset.rs?ref=6fc1d8bc13124bb134d7ab54e56237821a55912e", "patch": "@@ -0,0 +1,29 @@\n+// compile-flags: -C no-prepopulate-passes\n+\n+#![crate_type = \"lib\"]\n+\n+// Hack to get the correct size for the length part in slices\n+// CHECK: @helper([[USIZE:i[0-9]+]] %_1)\n+#[no_mangle]\n+pub fn helper(_: usize) {\n+}\n+\n+// Check that we correctly generate a GEP for a ZST that is not included in Scalar layout\n+// CHECK-LABEL: @scalar_layout\n+#[no_mangle]\n+pub fn scalar_layout(s: &(u64, ())) {\n+// CHECK: [[X0:%[0-9]+]] = bitcast i64* %s to i8*\n+// CHECK-NEXT: [[X1:%[0-9]+]] = getelementptr i8, i8* [[X0]], [[USIZE]] 8\n+    let x = &s.1;\n+    &x; // keep variable in an alloca\n+}\n+\n+// Check that we correctly generate a GEP for a ZST that is not included in ScalarPair layout\n+// CHECK-LABEL: @scalarpair_layout\n+#[no_mangle]\n+pub fn scalarpair_layout(s: &(u64, u32, ())) {\n+// CHECK: [[X0:%[0-9]+]] = bitcast { i64, i32 }* %s to i8*\n+// CHECK-NEXT: [[X1:%[0-9]+]] = getelementptr i8, i8* [[X0]], [[USIZE]] 12\n+    let x = &s.2;\n+    &x; // keep variable in an alloca\n+}"}]}