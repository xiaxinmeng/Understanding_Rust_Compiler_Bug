{"sha": "b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyYjk1NTVmOTU4NTFjZDI0YmNkYTY4MDFhNDFhZDlhMWRmYTRhZTc=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-08T23:12:51Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-17T00:47:57Z"}, "message": "Recover from incorrect `pub` kw in \"reasonable\" places", "tree": {"sha": "c24316ea8b3e92e8848dde80db0c659bd57dbccd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c24316ea8b3e92e8848dde80db0c659bd57dbccd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "html_url": "https://github.com/rust-lang/rust/commit/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "532dd4475b553212a65a52df6ff511e4822b149a", "url": "https://api.github.com/repos/rust-lang/rust/commits/532dd4475b553212a65a52df6ff511e4822b149a", "html_url": "https://github.com/rust-lang/rust/commit/532dd4475b553212a65a52df6ff511e4822b149a"}], "stats": {"total": 66, "additions": 26, "deletions": 40}, "files": [{"sha": "ce643545e71185cbda7ef536a471474d468190da", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1524,7 +1524,7 @@ impl<'a> Parser<'a> {\n                          at_end: &mut bool,\n                          mut attrs: Vec<Attribute>) -> PResult<'a, TraitItem> {\n         let lo = self.span;\n-\n+        self.eat_bad_pub();\n         let (name, node, generics) = if self.eat_keyword(keywords::Type) {\n             self.parse_trait_item_assoc_ty()?\n         } else if self.is_const_item() {\n@@ -7680,6 +7680,7 @@ impl<'a> Parser<'a> {\n \n             let struct_def;\n             let mut disr_expr = None;\n+            self.eat_bad_pub();\n             let ident = self.parse_ident()?;\n             if self.check(&token::OpenDelim(token::Brace)) {\n                 // Parse a struct variant.\n@@ -8618,6 +8619,17 @@ impl<'a> Parser<'a> {\n             Applicability::MaybeIncorrect,\n         ).emit();\n     }\n+\n+    /// Recover from `pub` keyword in places where it seems _reasonable_ but isn't valid.\n+    fn eat_bad_pub(&mut self) {\n+        if self.token.is_keyword(keywords::Pub) {\n+            self.bump();\n+            let mut err = self.diagnostic()\n+                .struct_span_err(self.prev_span, \"unnecessary visibility qualifier\");\n+            err.span_label(self.prev_span, \"`pub` not permitted here\");\n+            err.emit();\n+        }\n+    }\n }\n \n pub fn emit_unclosed_delims(unclosed_delims: &mut Vec<UnmatchedBrace>, handler: &errors::Handler) {"}, {"sha": "229b334a596cdfb37bcf94f26694b27b2673d3ac", "filename": "src/test/ui/issues/issue-28433.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fissues%2Fissue-28433.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fissues%2Fissue-28433.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-28433.rs?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -2,9 +2,7 @@\n \n enum Bird {\n     pub Duck,\n-    //~^ ERROR expected identifier, found keyword `pub`\n-    //~| ERROR missing comma\n-    //~| WARN variant `pub` should have an upper camel case name\n+    //~^ ERROR unnecessary visibility qualifier\n     Goose\n }\n "}, {"sha": "51be15a3e316afbe280bca6932540287de0b3fdf", "filename": "src/test/ui/issues/issue-28433.stderr", "status": "modified", "additions": 3, "deletions": 21, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fissues%2Fissue-28433.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fissues%2Fissue-28433.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-28433.stderr?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1,26 +1,8 @@\n-error: expected identifier, found keyword `pub`\n+error: unnecessary visibility qualifier\n   --> $DIR/issue-28433.rs:4:5\n    |\n LL |     pub Duck,\n-   |     ^^^ expected identifier, found keyword\n-help: you can escape reserved keywords to use them as identifiers\n-   |\n-LL |     r#pub Duck,\n-   |     ^^^^^\n-\n-error: missing comma\n-  --> $DIR/issue-28433.rs:4:8\n-   |\n-LL |     pub Duck,\n-   |        ^ help: missing comma\n-\n-warning: variant `pub` should have an upper camel case name\n-  --> $DIR/issue-28433.rs:4:5\n-   |\n-LL |     pub Duck,\n-   |     ^^^ help: convert the identifier to upper camel case: `Pub`\n-   |\n-   = note: #[warn(non_camel_case_types)] on by default\n+   |     ^^^ `pub` not permitted here\n \n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n "}, {"sha": "219ffa309c25401f434a93cb6f1660ccc58c20a9", "filename": "src/test/ui/parser/trait-pub-assoc-const.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-const.rs?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1,6 +1,6 @@\n trait Foo {\n     pub const Foo: u32;\n-    //~^ ERROR expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found\n+    //~^ ERROR unnecessary visibility qualifier\n }\n \n fn main() {}"}, {"sha": "817692cc82c861893ab3e40e012b4fdaa35dba29", "filename": "src/test/ui/parser/trait-pub-assoc-const.stderr", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-const.stderr?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1,10 +1,8 @@\n-error: expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found `pub`\n+error: unnecessary visibility qualifier\n   --> $DIR/trait-pub-assoc-const.rs:2:5\n    |\n-LL | trait Foo {\n-   |            - expected one of 7 possible tokens here\n LL |     pub const Foo: u32;\n-   |     ^^^ unexpected token\n+   |     ^^^ `pub` not permitted here\n \n error: aborting due to previous error\n "}, {"sha": "a78dfbdcddaadde7c918c0592420885a7c975a08", "filename": "src/test/ui/parser/trait-pub-assoc-ty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-ty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-ty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-ty.rs?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1,6 +1,6 @@\n trait Foo {\n     pub type Foo;\n-    //~^ ERROR expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found\n+    //~^ ERROR unnecessary visibility qualifier\n }\n \n fn main() {}"}, {"sha": "400be6af22a82cdb7072a49fc1dda9121280ae8e", "filename": "src/test/ui/parser/trait-pub-assoc-ty.stderr", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-ty.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-ty.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-assoc-ty.stderr?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1,10 +1,8 @@\n-error: expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found `pub`\n+error: unnecessary visibility qualifier\n   --> $DIR/trait-pub-assoc-ty.rs:2:5\n    |\n-LL | trait Foo {\n-   |            - expected one of 7 possible tokens here\n LL |     pub type Foo;\n-   |     ^^^ unexpected token\n+   |     ^^^ `pub` not permitted here\n \n error: aborting due to previous error\n "}, {"sha": "1f6ee028a174bb8729b5bc05ca508072a5b60ba5", "filename": "src/test/ui/parser/trait-pub-method.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-method.rs?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1,6 +1,6 @@\n trait Foo {\n     pub fn foo();\n-    //~^ ERROR expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found\n+    //~^ ERROR unnecessary visibility qualifier\n }\n \n fn main() {}"}, {"sha": "b3617a4aa9b0143daafcf1cb9105c1fe18977670", "filename": "src/test/ui/parser/trait-pub-method.stderr", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-method.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-method.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftrait-pub-method.stderr?ref=b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "patch": "@@ -1,10 +1,8 @@\n-error: expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found `pub`\n+error: unnecessary visibility qualifier\n   --> $DIR/trait-pub-method.rs:2:5\n    |\n-LL | trait Foo {\n-   |            - expected one of 7 possible tokens here\n LL |     pub fn foo();\n-   |     ^^^ unexpected token\n+   |     ^^^ `pub` not permitted here\n \n error: aborting due to previous error\n "}]}