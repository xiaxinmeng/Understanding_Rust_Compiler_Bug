{"sha": "9169905eb2d0e5df5c554396495df49283812abc", "node_id": "C_kwDOAAsO6NoAKDkxNjk5MDVlYjJkMGU1ZGY1YzU1NDM5NjQ5NWRmNDkyODM4MTJhYmM", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-06-25T00:55:40Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-06-25T01:03:09Z"}, "message": "x.py: Support systems with only `python3` not `python`", "tree": {"sha": "1637f700f8fcb44b0134b617058a3782f86f0415", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1637f700f8fcb44b0134b617058a3782f86f0415"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9169905eb2d0e5df5c554396495df49283812abc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmK2Xs0ACgkQ+boUO5X/\nbYJ4+RAAn7YA337z5jfgpFwG5JLoEMR3ie7wfWjcnxky28mTphj2FPbfmtmXenCk\nqNIYBvgMJi1Yo7rWMqJRq6paKPPoWxFtDYLKf7Zq6NdEb3aMNYweAX7TM8WsLf1a\nO33J5/AC7MQTSM/WYegaq7T9rLofKK+thdUSmrvdnM6UmFh/GEO1dcpnwy1DOMty\nc+nomHFbtZW9C4a6wner467OY/C087uspQEhOAH1VWVqNSlLaGzrzc4JI9zCwJ1R\no2H/w41m1AmFu/ffEt9/L+ra4ClxXAZERoVcRb0m5hH3TGhJzocv1uL6/7zPfJ7R\nQ0vtJwv/Nz1kZxPcF/+wS7SsOVyokVxpoqnzeTnBE20h/lKNZpnj2NAI7893omJq\nQDBMbE6u1tKfrELpcsVOVy1MrCyuwfciLinXM2TkrYLcFfDyNhDm6XReBL1sOAjE\nTlauyLWX8rXYkadKOHFnL4RIVXlmemE/rm/RpGXXmTbOrggDwvRHOWcPILxadTCw\npufci9kFqsgEQyT+AV25iP4yhfIseyODR6p3Wr3EhNNk7IYnHthtfclj7gryoBG9\nDlWwk9eg9V5bssaC3EDnNWyicHxCttEXZSi/lvmayHFxMpN8lzBS2rq9KQDWpRbb\nfWHgOgX5/ps8LhErFMkr7Q/Jlv2J1hjF7+H4xhAnlERy3DiJVdE=\n=ql7V\n-----END PGP SIGNATURE-----", "payload": "tree 1637f700f8fcb44b0134b617058a3782f86f0415\nparent fdca237d5194bf8a1c9b437ebd2114d1c2ba6195\nauthor David Tolnay <dtolnay@gmail.com> 1656118540 -0700\ncommitter David Tolnay <dtolnay@gmail.com> 1656118989 -0700\n\nx.py: Support systems with only `python3` not `python`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9169905eb2d0e5df5c554396495df49283812abc", "html_url": "https://github.com/rust-lang/rust/commit/9169905eb2d0e5df5c554396495df49283812abc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9169905eb2d0e5df5c554396495df49283812abc/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fdca237d5194bf8a1c9b437ebd2114d1c2ba6195", "url": "https://api.github.com/repos/rust-lang/rust/commits/fdca237d5194bf8a1c9b437ebd2114d1c2ba6195", "html_url": "https://github.com/rust-lang/rust/commit/fdca237d5194bf8a1c9b437ebd2114d1c2ba6195"}], "stats": {"total": 29, "additions": 25, "deletions": 4}, "files": [{"sha": "0289056fdcb163889cd3d59b24e6e20afbbd2e30", "filename": "x.py", "status": "modified", "additions": 25, "deletions": 4, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/9169905eb2d0e5df5c554396495df49283812abc/x.py", "raw_url": "https://github.com/rust-lang/rust/raw/9169905eb2d0e5df5c554396495df49283812abc/x.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/x.py?ref=9169905eb2d0e5df5c554396495df49283812abc", "patch": "@@ -1,17 +1,38 @@\n-#!/usr/bin/env python\n+#!/usr/bin/env bash\n \n+# Modern Linux and macOS systems commonly only have a thing called `python3` and\n+# not `python`, while Windows commonly does not have `python3`, so we cannot\n+# directly use python in the shebang and have it consistently work. Instead we\n+# embed some bash to look for a python to run the rest of the script.\n+#\n+# On Windows, `py -3` sometimes works. We need to try it first because `python3`\n+# sometimes tries to launch the app store on Windows.\n+'''':\n+for PYTHON in \"py -3\" python3 python python2; do\n+    if command -v $PYTHON >/dev/null; then\n+        exec $PYTHON \"$0\" \"$@\"\n+        break\n+    fi\n+done\n+echo \"$0: error: did not find python installed\" >&2\n+exit 1\n+'''\n+\n+# The rest of this file is Python.\n+#\n # This file is only a \"symlink\" to bootstrap.py, all logic should go there.\n \n import os\n import sys\n \n # If this is python2, check if python3 is available and re-execute with that\n # interpreter.\n+#\n+# `./x.py` would not normally benefit from this because the bash above tries\n+# python3 before 2, but this matters if someone ran `python x.py` and their\n+# system's `python` is python2.\n if sys.version_info.major < 3:\n     try:\n-        # On Windows, `py -3` sometimes works.\n-        # Try this first, because 'python3' sometimes tries to launch the app\n-        # store on Windows\n         os.execvp(\"py\", [\"py\", \"-3\"] + sys.argv)\n     except OSError:\n         try:"}]}