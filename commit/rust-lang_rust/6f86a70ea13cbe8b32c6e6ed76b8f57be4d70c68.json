{"sha": "6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmODZhNzBlYTEzY2JlOGIzMmM2ZTZlZDc2YjhmNTdiZTRkNzBjNjg=", "commit": {"author": {"name": "Denys Zariaiev", "email": "denys.zariaiev@gmail.com", "date": "2019-01-28T22:56:37Z"}, "committer": {"name": "Denys Zariaiev", "email": "denys.zariaiev@gmail.com", "date": "2019-01-28T22:56:37Z"}, "message": "Adjust PTXLinker LTO logic and CLI", "tree": {"sha": "81c6e22bb57b45e5466c54e5c192eaecb791ab3e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/81c6e22bb57b45e5466c54e5c192eaecb791ab3e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68", "html_url": "https://github.com/rust-lang/rust/commit/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68/comments", "author": {"login": "denzp", "id": 747869, "node_id": "MDQ6VXNlcjc0Nzg2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/747869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/denzp", "html_url": "https://github.com/denzp", "followers_url": "https://api.github.com/users/denzp/followers", "following_url": "https://api.github.com/users/denzp/following{/other_user}", "gists_url": "https://api.github.com/users/denzp/gists{/gist_id}", "starred_url": "https://api.github.com/users/denzp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/denzp/subscriptions", "organizations_url": "https://api.github.com/users/denzp/orgs", "repos_url": "https://api.github.com/users/denzp/repos", "events_url": "https://api.github.com/users/denzp/events{/privacy}", "received_events_url": "https://api.github.com/users/denzp/received_events", "type": "User", "site_admin": false}, "committer": {"login": "denzp", "id": 747869, "node_id": "MDQ6VXNlcjc0Nzg2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/747869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/denzp", "html_url": "https://github.com/denzp", "followers_url": "https://api.github.com/users/denzp/followers", "following_url": "https://api.github.com/users/denzp/following{/other_user}", "gists_url": "https://api.github.com/users/denzp/gists{/gist_id}", "starred_url": "https://api.github.com/users/denzp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/denzp/subscriptions", "organizations_url": "https://api.github.com/users/denzp/orgs", "repos_url": "https://api.github.com/users/denzp/repos", "events_url": "https://api.github.com/users/denzp/events{/privacy}", "received_events_url": "https://api.github.com/users/denzp/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d53c9247c23e36219102be68f887b0a39085a32", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d53c9247c23e36219102be68f887b0a39085a32", "html_url": "https://github.com/rust-lang/rust/commit/8d53c9247c23e36219102be68f887b0a39085a32"}], "stats": {"total": 19, "additions": 9, "deletions": 10}, "files": [{"sha": "c7c3ca6bc5417cb89a3816652011827e095dd8f7", "filename": "src/ci/docker/nvptx-cuda/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68/src%2Fci%2Fdocker%2Fnvptx-cuda%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68/src%2Fci%2Fdocker%2Fnvptx-cuda%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fnvptx-cuda%2FDockerfile?ref=6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68", "patch": "@@ -6,7 +6,7 @@ RUN apt-get install -y --no-install-recommends \\\n     cmake sudo gdb\n \n # FIXME: setup `ptx-linker` CI for automatic binary releases.\n-RUN curl -sL https://github.com/denzp/rust-ptx-linker/releases/download/v0.9.0-alpha/rust-ptx-linker.linux64.tar.gz | \\\n+RUN curl -sL https://github.com/denzp/rust-ptx-linker/releases/download/v0.9.0-alpha.1/rust-ptx-linker.linux64.tar.gz | \\\n     tar -xzvC /usr/bin\n \n COPY scripts/sccache.sh /scripts/"}, {"sha": "55b02ebe6c4d55155a16459192f3315dea644f9a", "filename": "src/librustc_codegen_ssa/back/linker.rs", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs?ref=6f86a70ea13cbe8b32c6e6ed76b8f57be4d70c68", "patch": "@@ -13,7 +13,7 @@ use rustc::hir::def_id::{LOCAL_CRATE, CrateNum};\n use rustc::middle::dependency_format::Linkage;\n use rustc::session::Session;\n use rustc::session::config::{self, CrateType, OptLevel, DebugInfo,\n-                             CrossLangLto};\n+                             CrossLangLto, Lto};\n use rustc::ty::TyCtxt;\n use rustc_target::spec::{LinkerFlavor, LldFlavor};\n use serialize::{json, Encoder};\n@@ -1118,14 +1118,13 @@ impl<'a> Linker for PtxLinker<'a> {\n     }\n \n     fn optimize(&mut self) {\n-        self.cmd.arg(match self.sess.opts.optimize {\n-            OptLevel::No => \"-O0\",\n-            OptLevel::Less => \"-O1\",\n-            OptLevel::Default => \"-O2\",\n-            OptLevel::Aggressive => \"-O3\",\n-            OptLevel::Size => \"-Os\",\n-            OptLevel::SizeMin => \"-Os\"\n-        });\n+        match self.sess.lto() {\n+            Lto::Thin | Lto::Fat | Lto::ThinLocal => {\n+                self.cmd.arg(\"-Olto\");\n+            },\n+\n+            Lto::No => { },\n+        };\n     }\n \n     fn output_filename(&mut self, path: &Path) {"}]}