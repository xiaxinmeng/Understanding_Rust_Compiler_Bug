{"sha": "6986361776ea2734886f161496281c692c283450", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5ODYzNjE3NzZlYTI3MzQ4ODZmMTYxNDk2MjgxYzY5MmMyODM0NTA=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-08-13T11:04:47Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-08-15T02:10:21Z"}, "message": "Port entry.rs from oldvisit to <V:Visitor> trait API.", "tree": {"sha": "c30ac404be4f3733c1b0d8c9827337d94595eab3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c30ac404be4f3733c1b0d8c9827337d94595eab3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6986361776ea2734886f161496281c692c283450", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6986361776ea2734886f161496281c692c283450", "html_url": "https://github.com/rust-lang/rust/commit/6986361776ea2734886f161496281c692c283450", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6986361776ea2734886f161496281c692c283450/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "78dd07b729375119d1fa020427fc064c045524ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/78dd07b729375119d1fa020427fc064c045524ed", "html_url": "https://github.com/rust-lang/rust/commit/78dd07b729375119d1fa020427fc064c045524ed"}], "stats": {"total": 23, "additions": 14, "deletions": 9}, "files": [{"sha": "e6830a1f64e7c2ad40eb522802c0c29f3b50c2b5", "filename": "src/librustc/middle/entry.rs", "status": "modified", "additions": 14, "deletions": 9, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/6986361776ea2734886f161496281c692c283450/src%2Flibrustc%2Fmiddle%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6986361776ea2734886f161496281c692c283450/src%2Flibrustc%2Fmiddle%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fentry.rs?ref=6986361776ea2734886f161496281c692c283450", "patch": "@@ -15,9 +15,9 @@ use syntax::ast::{Crate, NodeId, item, item_fn};\n use syntax::ast_map;\n use syntax::attr;\n use syntax::codemap::span;\n-use syntax::oldvisit::{default_visitor, mk_vt, vt, Visitor, visit_crate};\n-use syntax::oldvisit::{visit_item};\n use syntax::parse::token::special_idents;\n+use syntax::visit;\n+use syntax::visit::Visitor;\n use std::util;\n \n struct EntryContext {\n@@ -39,7 +39,13 @@ struct EntryContext {\n     non_main_fns: ~[(NodeId, span)],\n }\n \n-type EntryVisitor = vt<@mut EntryContext>;\n+struct EntryVisitor;\n+\n+impl Visitor<@mut EntryContext> for EntryVisitor {\n+    fn visit_item(&mut self, item:@item, ctxt:@mut EntryContext) {\n+        find_item(item, ctxt, self);\n+    }\n+}\n \n pub fn find_entry_point(session: Session, crate: &Crate, ast_map: ast_map::map) {\n \n@@ -65,15 +71,14 @@ pub fn find_entry_point(session: Session, crate: &Crate, ast_map: ast_map::map)\n         non_main_fns: ~[],\n     };\n \n-    visit_crate(crate, (ctxt, mk_vt(@Visitor {\n-        visit_item: |item, (ctxt, visitor)| find_item(item, ctxt, visitor),\n-        .. *default_visitor()\n-    })));\n+    let mut v = EntryVisitor;\n+\n+    visit::walk_crate(&mut v, crate, ctxt);\n \n     configure_main(ctxt);\n }\n \n-fn find_item(item: @item, ctxt: @mut EntryContext, visitor: EntryVisitor) {\n+fn find_item(item: @item, ctxt: @mut EntryContext, visitor: &mut EntryVisitor) {\n     match item.node {\n         item_fn(*) => {\n             if item.ident == special_idents::main {\n@@ -120,7 +125,7 @@ fn find_item(item: @item, ctxt: @mut EntryContext, visitor: EntryVisitor) {\n         _ => ()\n     }\n \n-    visit_item(item, (ctxt, visitor));\n+    visit::walk_item(visitor, item, ctxt);\n }\n \n fn configure_main(ctxt: @mut EntryContext) {"}]}