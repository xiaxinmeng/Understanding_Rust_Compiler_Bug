{"sha": "3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhOGJiMjAyMzBjNGJiOGY0MGFlY2ExZDZjYTNkZWEwNDhiOWUyZTM=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-03-20T23:27:09Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-03-23T22:15:51Z"}, "message": "Remove assert_ignored and with_ignore_deps.", "tree": {"sha": "057e4ef97d00a4c1eee0bb8443a433d6907b70ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/057e4ef97d00a4c1eee0bb8443a433d6907b70ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3", "html_url": "https://github.com/rust-lang/rust/commit/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2326ae39b262169fa853c510aa1bc795a166dc26", "url": "https://api.github.com/repos/rust-lang/rust/commits/2326ae39b262169fa853c510aa1bc795a166dc26", "html_url": "https://github.com/rust-lang/rust/commit/2326ae39b262169fa853c510aa1bc795a166dc26"}], "stats": {"total": 32, "additions": 4, "deletions": 28}, "files": [{"sha": "5ccc0d281db0a1f01ea7feb0bdd7c6f9675e5619", "filename": "src/librustc/dep_graph/mod.rs", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3/src%2Flibrustc%2Fdep_graph%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3/src%2Flibrustc%2Fdep_graph%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fmod.rs?ref=3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3", "patch": "@@ -62,24 +62,6 @@ impl rustc_query_system::dep_graph::DepKind for DepKind {\n         write!(f, \")\")\n     }\n \n-    fn assert_ignored() {\n-        ty::tls::with_context_opt(|icx| {\n-            let icx = if let Some(icx) = icx { icx } else { return };\n-            assert!(icx.task_deps.is_none(), \"expected no task dependency tracking\");\n-        })\n-    }\n-\n-    fn with_ignore_deps<OP, R>(op: OP) -> R\n-    where\n-        OP: FnOnce() -> R,\n-    {\n-        ty::tls::with_context(|icx| {\n-            let icx = ty::tls::ImplicitCtxt { task_deps: None, ..icx.clone() };\n-\n-            ty::tls::enter_context(&icx, |_| op())\n-        })\n-    }\n-\n     fn with_deps<OP, R>(task_deps: Option<&Lock<TaskDeps>>, op: OP) -> R\n     where\n         OP: FnOnce() -> R,"}, {"sha": "c012dc687d7820110cd92f3697266a4524e01647", "filename": "src/librustc_query_system/dep_graph/graph.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3/src%2Flibrustc_query_system%2Fdep_graph%2Fgraph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3/src%2Flibrustc_query_system%2Fdep_graph%2Fgraph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2Fdep_graph%2Fgraph.rs?ref=3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3", "patch": "@@ -151,15 +151,17 @@ impl<K: DepKind> DepGraph<K> {\n \n     pub fn assert_ignored(&self) {\n         if let Some(..) = self.data {\n-            K::assert_ignored();\n+            K::read_deps(|task_deps| {\n+                assert!(task_deps.is_none(), \"expected no task dependency tracking\");\n+            })\n         }\n     }\n \n     pub fn with_ignore<OP, R>(&self, op: OP) -> R\n     where\n         OP: FnOnce() -> R,\n     {\n-        K::with_ignore_deps(op)\n+        K::with_deps(None, op)\n     }\n \n     /// Starts a new dep-graph task. Dep-graph tasks are specified"}, {"sha": "e6a927c11dde08db126f626c1ca2556d24d55c8e", "filename": "src/librustc_query_system/dep_graph/mod.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3/src%2Flibrustc_query_system%2Fdep_graph%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3/src%2Flibrustc_query_system%2Fdep_graph%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2Fdep_graph%2Fmod.rs?ref=3a8bb20230c4bb8f40aeca1d6ca3dea048b9e2e3", "patch": "@@ -76,14 +76,6 @@ pub trait DepKind: Copy + fmt::Debug + Eq + Ord + Hash {\n     /// Implementation of `std::fmt::Debug` for `DepNode`.\n     fn debug_node(node: &DepNode<Self>, f: &mut fmt::Formatter<'_>) -> fmt::Result;\n \n-    /// Assert the current implicit context does not track any dependency.\n-    fn assert_ignored();\n-\n-    /// Execute the operation ignoring the dependencies.\n-    fn with_ignore_deps<OP, R>(op: OP) -> R\n-    where\n-        OP: FnOnce() -> R;\n-\n     /// Execute the operation with provided dependencies.\n     fn with_deps<OP, R>(deps: Option<&Lock<TaskDeps<Self>>>, op: OP) -> R\n     where"}]}