{"sha": "bb907adbbd1727938245a67db1c92be7e4dec3e6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiOTA3YWRiYmQxNzI3OTM4MjQ1YTY3ZGIxYzkyYmU3ZTRkZWMzZTY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-06-02T22:19:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-06-02T22:19:08Z"}, "message": "Auto merge of #42381 - Mark-Simulacrum:rollup, r=Mark-Simulacrum\n\nRollup of 10 pull requests\n\n- Successful merges: #41981, #42225, #42310, #42319, #42335, #42343, #42355, #42360, #42370, #42372\n- Failed merges:", "tree": {"sha": "a6229fb68940fbe7bd2c7fae09b92fa10500c81d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6229fb68940fbe7bd2c7fae09b92fa10500c81d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb907adbbd1727938245a67db1c92be7e4dec3e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb907adbbd1727938245a67db1c92be7e4dec3e6", "html_url": "https://github.com/rust-lang/rust/commit/bb907adbbd1727938245a67db1c92be7e4dec3e6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb907adbbd1727938245a67db1c92be7e4dec3e6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "107bd67ef7fb3e8027d7234d687cdd27c3efaa0d", "url": "https://api.github.com/repos/rust-lang/rust/commits/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d", "html_url": "https://github.com/rust-lang/rust/commit/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d"}, {"sha": "e05f1c12901e26f75a92f441f636942a8a3bf7c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/e05f1c12901e26f75a92f441f636942a8a3bf7c1", "html_url": "https://github.com/rust-lang/rust/commit/e05f1c12901e26f75a92f441f636942a8a3bf7c1"}], "stats": {"total": 798, "additions": 184, "deletions": 614}, "files": [{"sha": "cc2da1a02dc9fe66c4be7eba1b6b90c5573ff454", "filename": "src/Cargo.lock", "status": "modified", "additions": 23, "deletions": 22, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -44,7 +44,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n  \"core 0.0.0\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.0.0\",\n ]\n \n@@ -84,7 +84,7 @@ name = \"backtrace-sys\"\n version = \"0.1.10\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -110,7 +110,7 @@ dependencies = [\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getopts 0.2.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num_cpus 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -178,7 +178,7 @@ dependencies = [\n  \"serde_ignored 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde_json 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"shell-escape 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"tar 0.4.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"tar 0.4.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"tempdir 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"term 0.4.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"toml 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -202,7 +202,7 @@ dependencies = [\n  \"rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde 1.0.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde_json 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"tar 0.4.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"tar 0.4.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"tempdir 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"term 0.4.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"url 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -239,7 +239,7 @@ name = \"cmake\"\n version = \"0.1.23\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -257,7 +257,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n  \"core 0.0.0\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -308,7 +308,7 @@ name = \"curl-sys\"\n version = \"0.3.11\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libz-sys 1.0.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"openssl-sys 0.9.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -411,7 +411,7 @@ name = \"flate\"\n version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -444,7 +444,7 @@ dependencies = [\n \n [[package]]\n name = \"gcc\"\n-version = \"0.3.46\"\n+version = \"0.3.50\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n@@ -540,7 +540,7 @@ dependencies = [\n  \"flate2 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"kernel32-sys 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"tar 0.4.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"tar 0.4.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"walkdir 1.0.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"xz2 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -605,7 +605,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"cmake 0.1.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"curl-sys 0.3.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libssh2-sys 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libz-sys 1.0.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -630,7 +630,7 @@ name = \"libz-sys\"\n version = \"1.0.13\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"pkg-config 0.3.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -650,7 +650,7 @@ version = \"0.1.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"filetime 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -697,7 +697,7 @@ name = \"miniz-sys\"\n version = \"0.1.9\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -830,7 +830,7 @@ name = \"openssl-sys\"\n version = \"0.9.12\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"gdi32-sys 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"pkg-config 0.3.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1248,7 +1248,7 @@ name = \"rustc_llvm\"\n version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_bitflags 0.0.0\",\n ]\n \n@@ -1375,6 +1375,7 @@ name = \"rustc_trans\"\n version = \"0.0.0\"\n dependencies = [\n  \"flate 0.0.0\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"owning_ref 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n@@ -1425,7 +1426,7 @@ dependencies = [\n  \"arena 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"env_logger 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"pulldown-cmark 0.0.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n@@ -1577,7 +1578,7 @@ dependencies = [\n  \"collections 0.0.0\",\n  \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n- \"gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.0.0\",\n  \"panic_abort 0.0.0\",\n  \"panic_unwind 0.0.0\",\n@@ -1744,7 +1745,7 @@ dependencies = [\n \n [[package]]\n name = \"tar\"\n-version = \"0.4.12\"\n+version = \"0.4.13\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"filetime 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -2042,7 +2043,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum flate2 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\" = \"36df0166e856739905cd3d7e0b210fe818592211a008862599845e012d8d304c\"\n \"checksum foreign-types 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3e4056b9bd47f8ac5ba12be771f77a0dae796d1bbaaf5fd0b9c2d38b69b8a29d\"\n \"checksum fs2 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"34edaee07555859dc13ca387e6ae05686bb4d0364c95d649b6dab959511f4baf\"\n-\"checksum gcc 0.3.46 (registry+https://github.com/rust-lang/crates.io-index)\" = \"181e3cebba1d663bd92eb90e2da787e10597e027eb00de8d742b260a7850948f\"\n+\"checksum gcc 0.3.50 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5f837c392f2ea61cb1576eac188653df828c861b7137d74ea4a5caa89621f9e6\"\n \"checksum gdi32-sys 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0912515a8ff24ba900422ecda800b52f4016a56251922d397c576bf92c690518\"\n \"checksum getopts 0.2.14 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d9047cfbd08a437050b363d35ef160452c5fe8ea5187ae0a624708c91581d685\"\n \"checksum git2 0.6.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9de9df4358c17e448a778d90cd0272e1dab5eae30244502333fa2001c4e24357\"\n@@ -2128,7 +2129,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum syntex_pos 0.58.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"13ad4762fe52abc9f4008e85c4fb1b1fe3aa91ccb99ff4826a439c7c598e1047\"\n \"checksum syntex_syntax 0.52.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"76a302e717e348aa372ff577791c3832395650073b8d8432f8b3cb170b34afde\"\n \"checksum syntex_syntax 0.58.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6e0e4dbae163dd98989464c23dd503161b338790640e11537686f2ef0f25c791\"\n-\"checksum tar 0.4.12 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ab0ef9ead2fe0aa9e18475a96a207bfd5143f4124779ef7429503a8665416ce8\"\n+\"checksum tar 0.4.13 (registry+https://github.com/rust-lang/crates.io-index)\" = \"281285b717926caa919ad905ef89c63d75805c7d89437fb873100925a53f2b1b\"\n \"checksum tempdir 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"87974a6f5c1dfb344d733055601650059a3363de2a6104819293baff662132d6\"\n \"checksum term 0.4.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d168af3930b369cfe245132550579d47dfd873d69470755a19c2c6568dbbd989\"\n \"checksum term_size 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"07b6c1ac5b3fffd75073276bca1ceed01f67a28537097a2a9539e116e50fb21a\""}, {"sha": "8842dce0257dd064f53544446176d4f1cf54e1e8", "filename": "src/bootstrap/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Fbootstrap%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Fbootstrap%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -36,5 +36,5 @@ num_cpus = \"1.0\"\n toml = \"0.1\"\n getopts = \"0.2\"\n rustc-serialize = \"0.3\"\n-gcc = \"0.3.46\"\n+gcc = \"0.3.50\"\n libc = \"0.2\""}, {"sha": "49e5baad74dda4322d93ee395ba63a3999fa3f00", "filename": "src/liballoc_jemalloc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Fliballoc_jemalloc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Fliballoc_jemalloc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_jemalloc%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -17,7 +17,7 @@ libc = { path = \"../rustc/libc_shim\" }\n \n [build-dependencies]\n build_helper = { path = \"../build_helper\" }\n-gcc = \"0.3.27\"\n+gcc = \"0.3.50\"\n \n [features]\n debug = []"}, {"sha": "97d6687c79b5749aaa3d69e5d0d64a373cb0f133", "filename": "src/libcollections/slice.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcollections%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcollections%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fslice.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -1515,6 +1515,7 @@ pub trait SliceConcatExt<T: ?Sized> {\n     ///\n     /// ```\n     /// assert_eq!([\"hello\", \"world\"].concat(), \"helloworld\");\n+    /// assert_eq!([[1, 2], [3, 4]].concat(), [1, 2, 3, 4]);\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn concat(&self) -> Self::Output;\n@@ -1526,6 +1527,7 @@ pub trait SliceConcatExt<T: ?Sized> {\n     ///\n     /// ```\n     /// assert_eq!([\"hello\", \"world\"].join(\" \"), \"hello world\");\n+    /// assert_eq!([[1, 2], [3, 4]].join(&0), [1, 2, 0, 3, 4]);\n     /// ```\n     #[stable(feature = \"rename_connect_to_join\", since = \"1.3.0\")]\n     fn join(&self, sep: &T) -> Self::Output;"}, {"sha": "8af8786994e407ba321a207805b7182d5debaddf", "filename": "src/libcollections/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcollections%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcollections%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Ftests%2Flib.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -16,12 +16,12 @@\n #![feature(collections)]\n #![feature(const_fn)]\n #![feature(exact_size_is_empty)]\n+#![feature(iterator_step_by)]\n #![feature(pattern)]\n #![feature(placement_in_syntax)]\n #![feature(rand)]\n #![feature(slice_rotate)]\n #![feature(splice)]\n-#![feature(step_by)]\n #![feature(str_escape)]\n #![feature(test)]\n #![feature(unboxed_closures)]"}, {"sha": "a992351653d7b996e2f2100c57f5c8c1c4ee82a1", "filename": "src/libcollections/tests/vec_deque.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcollections%2Ftests%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcollections%2Ftests%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Ftests%2Fvec_deque.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -510,7 +510,8 @@ fn test_from_iter() {\n     let u: Vec<_> = deq.iter().cloned().collect();\n     assert_eq!(u, v);\n \n-    let seq = (0..).step_by(2).take(256);\n+    // FIXME #27741: Remove `.skip(0)` when Range::step_by is fully removed\n+    let seq = (0..).skip(0).step_by(2).take(256);\n     let deq: VecDeque<_> = seq.collect();\n     for (i, &x) in deq.iter().enumerate() {\n         assert_eq!(2 * i, x);"}, {"sha": "2c9cee5e7a0937cf3644a712095f375b212fa8dd", "filename": "src/libcompiler_builtins/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcompiler_builtins%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcompiler_builtins%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcompiler_builtins%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -16,4 +16,4 @@ core = { path = \"../libcore\" }\n \n [build-dependencies]\n build_helper = { path = \"../build_helper\" }\n-gcc = \"0.3.27\"\n+gcc = \"0.3.50\""}, {"sha": "34563c88d0ad13b0b6685c01c736371a728644e1", "filename": "src/libcore/iter/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcore%2Fiter%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcore%2Fiter%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fiter%2Fmod.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -313,6 +313,9 @@ pub use self::iterator::Iterator;\n pub use self::range::Step;\n #[unstable(feature = \"step_by\", reason = \"recent addition\",\n            issue = \"27741\")]\n+#[rustc_deprecated(since = \"1.19.0\",\n+                   reason = \"replaced by `iter::StepBy`\")]\n+#[allow(deprecated)]\n pub use self::range::StepBy as DeprecatedStepBy;\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]"}, {"sha": "9aea4477fb7fc604027231739c7045074b1aebeb", "filename": "src/libcore/iter/range.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcore%2Fiter%2Frange.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcore%2Fiter%2Frange.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fiter%2Frange.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -252,6 +252,9 @@ step_impl_no_between!(u128 i128);\n #[derive(Clone, Debug)]\n #[unstable(feature = \"step_by\", reason = \"recent addition\",\n            issue = \"27741\")]\n+#[rustc_deprecated(since = \"1.19.0\",\n+                   reason = \"replaced by `iter::StepBy`\")]\n+#[allow(deprecated)]\n pub struct StepBy<A, R> {\n     step_by: A,\n     range: R,\n@@ -272,6 +275,9 @@ impl<A: Step> ops::RangeFrom<A> {\n     /// ```\n     #[unstable(feature = \"step_by\", reason = \"recent addition\",\n                issue = \"27741\")]\n+    #[rustc_deprecated(since = \"1.19.0\",\n+                       reason = \"replaced by `Iterator::step_by`\")]\n+    #[allow(deprecated)]\n     pub fn step_by(self, by: A) -> StepBy<A, Self> {\n         StepBy {\n             step_by: by,\n@@ -297,6 +303,9 @@ impl<A: Step> ops::Range<A> {\n     /// ```\n     #[unstable(feature = \"step_by\", reason = \"recent addition\",\n                issue = \"27741\")]\n+    #[rustc_deprecated(since = \"1.19.0\",\n+                       reason = \"replaced by `Iterator::step_by`\")]\n+    #[allow(deprecated)]\n     pub fn step_by(self, by: A) -> StepBy<A, Self> {\n         StepBy {\n             step_by: by,\n@@ -321,6 +330,9 @@ impl<A: Step> ops::RangeInclusive<A> {\n     /// ```\n     #[unstable(feature = \"step_by\", reason = \"recent addition\",\n                issue = \"27741\")]\n+    #[rustc_deprecated(since = \"1.19.0\",\n+                       reason = \"replaced by `Iterator::step_by`\")]\n+    #[allow(deprecated)]\n     pub fn step_by(self, by: A) -> StepBy<A, Self> {\n         StepBy {\n             step_by: by,\n@@ -331,6 +343,7 @@ impl<A: Step> ops::RangeInclusive<A> {\n \n #[unstable(feature = \"step_by\", reason = \"recent addition\",\n            issue = \"27741\")]\n+#[allow(deprecated)]\n impl<A> Iterator for StepBy<A, ops::RangeFrom<A>> where\n     A: Clone,\n     for<'a> &'a A: Add<&'a A, Output = A>\n@@ -351,11 +364,13 @@ impl<A> Iterator for StepBy<A, ops::RangeFrom<A>> where\n }\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n+#[allow(deprecated)]\n impl<A> FusedIterator for StepBy<A, ops::RangeFrom<A>>\n     where A: Clone, for<'a> &'a A: Add<&'a A, Output = A> {}\n \n #[unstable(feature = \"step_by\", reason = \"recent addition\",\n            issue = \"27741\")]\n+#[allow(deprecated)]\n impl<A: Step + Clone> Iterator for StepBy<A, ops::Range<A>> {\n     type Item = A;\n \n@@ -393,11 +408,13 @@ impl<A: Step + Clone> Iterator for StepBy<A, ops::Range<A>> {\n }\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n+#[allow(deprecated)]\n impl<A: Step + Clone> FusedIterator for StepBy<A, ops::Range<A>> {}\n \n #[unstable(feature = \"inclusive_range\",\n            reason = \"recently added, follows RFC\",\n            issue = \"28237\")]\n+#[allow(deprecated)]\n impl<A: Step + Clone> Iterator for StepBy<A, ops::RangeInclusive<A>> {\n     type Item = A;\n \n@@ -437,6 +454,7 @@ impl<A: Step + Clone> Iterator for StepBy<A, ops::RangeInclusive<A>> {\n }\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n+#[allow(deprecated)]\n impl<A: Step + Clone> FusedIterator for StepBy<A, ops::RangeInclusive<A>> {}\n \n macro_rules! range_exact_iter_impl {"}, {"sha": "4f9951cd1539931c06dfad7d0e0fb64fb9f51a53", "filename": "src/libcore/tests/iter.rs", "status": "modified", "additions": 21, "deletions": 13, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcore%2Ftests%2Fiter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibcore%2Ftests%2Fiter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fiter.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -12,6 +12,15 @@ use core::iter::*;\n use core::{i8, i16, isize};\n use core::usize;\n \n+// FIXME #27741: This is here to simplify calling Iterator::step_by. Remove\n+// once Range::step_by is completely gone (not just deprecated).\n+trait IterEx: Sized {\n+    fn iter_step_by(self, n: usize) -> StepBy<Self>;\n+}\n+impl<I:Iterator> IterEx for I {\n+    fn iter_step_by(self, n: usize) -> StepBy<Self> { self.step_by(n) }\n+}\n+\n #[test]\n fn test_lt() {\n     let empty: [isize; 0] = [];\n@@ -67,7 +76,7 @@ fn test_multi_iter() {\n \n #[test]\n fn test_counter_from_iter() {\n-    let it = (0..).step_by(5).take(10);\n+    let it = (0..).iter_step_by(5).take(10);\n     let xs: Vec<isize> = FromIterator::from_iter(it);\n     assert_eq!(xs, [0, 5, 10, 15, 20, 25, 30, 35, 40, 45]);\n }\n@@ -85,7 +94,7 @@ fn test_iterator_chain() {\n     }\n     assert_eq!(i, expected.len());\n \n-    let ys = (30..).step_by(10).take(4);\n+    let ys = (30..).iter_step_by(10).take(4);\n     let it = xs.iter().cloned().chain(ys);\n     let mut i = 0;\n     for x in it {\n@@ -147,15 +156,13 @@ fn test_iterator_chain_find() {\n #[test]\n fn test_iterator_step_by() {\n     // Identity\n-    // Replace with (0..).step_by(1) after Range::step_by gets removed\n-    let mut it = Iterator::step_by((0..), 1).take(3);\n+    let mut it = (0..).iter_step_by(1).take(3);\n     assert_eq!(it.next(), Some(0));\n     assert_eq!(it.next(), Some(1));\n     assert_eq!(it.next(), Some(2));\n     assert_eq!(it.next(), None);\n \n-    // Replace with (0..).step_by(3) after Range::step_by gets removed\n-    let mut it = Iterator::step_by((0..), 3).take(4);\n+    let mut it = (0..).iter_step_by(3).take(4);\n     assert_eq!(it.next(), Some(0));\n     assert_eq!(it.next(), Some(3));\n     assert_eq!(it.next(), Some(6));\n@@ -166,8 +173,7 @@ fn test_iterator_step_by() {\n #[test]\n #[should_panic]\n fn test_iterator_step_by_zero() {\n-    // Replace with (0..).step_by(0) after Range::step_by gets removed\n-    let mut it = Iterator::step_by((0..), 0);\n+    let mut it = (0..).iter_step_by(0);\n     it.next();\n }\n \n@@ -246,7 +252,7 @@ fn test_iterator_step_by_size_hint() {\n \n #[test]\n fn test_filter_map() {\n-    let it = (0..).step_by(1).take(10)\n+    let it = (0..).iter_step_by(1).take(10)\n         .filter_map(|x| if x % 2 == 0 { Some(x*x) } else { None });\n     assert_eq!(it.collect::<Vec<usize>>(), [0*0, 2*2, 4*4, 6*6, 8*8]);\n }\n@@ -648,7 +654,7 @@ fn test_iterator_scan() {\n fn test_iterator_flat_map() {\n     let xs = [0, 3, 6];\n     let ys = [0, 1, 2, 3, 4, 5, 6, 7, 8];\n-    let it = xs.iter().flat_map(|&x| (x..).step_by(1).take(3));\n+    let it = xs.iter().flat_map(|&x| (x..).iter_step_by(1).take(3));\n     let mut i = 0;\n     for x in it {\n         assert_eq!(x, ys[i]);\n@@ -674,13 +680,13 @@ fn test_inspect() {\n #[test]\n fn test_cycle() {\n     let cycle_len = 3;\n-    let it = (0..).step_by(1).take(cycle_len).cycle();\n+    let it = (0..).iter_step_by(1).take(cycle_len).cycle();\n     assert_eq!(it.size_hint(), (usize::MAX, None));\n     for (i, x) in it.take(100).enumerate() {\n         assert_eq!(i % cycle_len, x);\n     }\n \n-    let mut it = (0..).step_by(1).take(0).cycle();\n+    let mut it = (0..).iter_step_by(1).take(0).cycle();\n     assert_eq!(it.size_hint(), (0, Some(0)));\n     assert_eq!(it.next(), None);\n }\n@@ -759,7 +765,7 @@ fn test_iterator_min() {\n \n #[test]\n fn test_iterator_size_hint() {\n-    let c = (0..).step_by(1);\n+    let c = (0..).iter_step_by(1);\n     let v: &[_] = &[0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\n     let v2 = &[10, 11, 12];\n     let vi = v.iter();\n@@ -1081,6 +1087,8 @@ fn test_range() {\n \n #[test]\n fn test_range_step() {\n+    #![allow(deprecated)]\n+\n     assert_eq!((0..20).step_by(5).collect::<Vec<isize>>(), [0, 5, 10, 15]);\n     assert_eq!((20..0).step_by(-5).collect::<Vec<isize>>(), [20, 15, 10, 5]);\n     assert_eq!((20..0).step_by(-6).collect::<Vec<isize>>(), [20, 14, 8, 2]);"}, {"sha": "e5c611460f73897ee3986277a60f9f8dd43974e5", "filename": "src/libflate/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibflate%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibflate%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibflate%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -11,4 +11,4 @@ crate-type = [\"dylib\"]\n \n [build-dependencies]\n build_helper = { path = \"../build_helper\" }\n-gcc = \"0.3.27\"\n+gcc = \"0.3.50\""}, {"sha": "72715cf6bc74d6e65a49ee5812f5bbcc760e9c5f", "filename": "src/librustc/dep_graph/README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc%2Fdep_graph%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc%2Fdep_graph%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2FREADME.md?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -254,7 +254,7 @@ and `...` are whatever edges the `/* compute value */` closure creates.\n In particular, using the memoize helper is much better than writing\n the obvious code yourself:\n \n-```\n+```rust\n if let Some(result) = map.get(key) {\n     return result;\n }"}, {"sha": "8308c756c0532f1ecaddea56bc018e671a857ff2", "filename": "src/librustc/ich/fingerprint.rs", "status": "modified", "additions": 1, "deletions": 19, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc%2Fich%2Ffingerprint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc%2Fich%2Ffingerprint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fich%2Ffingerprint.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -8,12 +8,11 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use rustc_serialize::{Encodable, Decodable, Encoder, Decoder};\n use rustc_data_structures::stable_hasher;\n use std::mem;\n use std::slice;\n \n-#[derive(Eq, PartialEq, Ord, PartialOrd, Hash, Debug, Clone, Copy)]\n+#[derive(Eq, PartialEq, Ord, PartialOrd, Hash, Debug, Clone, Copy, RustcEncodable, RustcDecodable)]\n pub struct Fingerprint(u64, u64);\n \n impl Fingerprint {\n@@ -37,23 +36,6 @@ impl Fingerprint {\n     }\n }\n \n-impl Encodable for Fingerprint {\n-    #[inline]\n-    fn encode<S: Encoder>(&self, s: &mut S) -> Result<(), S::Error> {\n-        s.emit_u64(self.0.to_le())?;\n-        s.emit_u64(self.1.to_le())\n-    }\n-}\n-\n-impl Decodable for Fingerprint {\n-    #[inline]\n-    fn decode<D: Decoder>(d: &mut D) -> Result<Fingerprint, D::Error> {\n-        let _0 = u64::from_le(d.read_u64()?);\n-        let _1 = u64::from_le(d.read_u64()?);\n-        Ok(Fingerprint(_0, _1))\n-    }\n-}\n-\n impl ::std::fmt::Display for Fingerprint {\n     fn fmt(&self, formatter: &mut ::std::fmt::Formatter) -> Result<(), ::std::fmt::Error> {\n         write!(formatter, \"{:x}-{:x}\", self.0, self.1)"}, {"sha": "f2eea014dd3020244ec026004bd96dc780ff69b1", "filename": "src/librustc_llvm/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_llvm%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_llvm%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -17,4 +17,4 @@ rustc_bitflags = { path = \"../librustc_bitflags\" }\n \n [build-dependencies]\n build_helper = { path = \"../build_helper\" }\n-gcc = \"0.3.27\"\n+gcc = \"0.3.50\""}, {"sha": "7355b399360a30485c08670cb4b88d0b3edb3352", "filename": "src/librustc_trans/Cargo.toml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_trans%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_trans%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -25,3 +25,6 @@ rustc_platform_intrinsics = { path = \"../librustc_platform_intrinsics\" }\n serialize = { path = \"../libserialize\" }\n syntax = { path = \"../libsyntax\" }\n syntax_pos = { path = \"../libsyntax_pos\" }\n+\n+[target.\"cfg(windows)\".dependencies]\n+gcc = \"0.3.50\""}, {"sha": "ee92a4b4a2dfeaf170998eabe3dd56fb523de8b1", "filename": "src/librustc_trans/back/link.rs", "status": "modified", "additions": 31, "deletions": 10, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_trans%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_trans%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flink.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -12,7 +12,6 @@ use super::archive::{ArchiveBuilder, ArchiveConfig};\n use super::linker::Linker;\n use super::rpath::RPathConfig;\n use super::rpath;\n-use super::msvc;\n use metadata::METADATA_FILENAME;\n use rustc::session::config::{self, NoDebugInfo, OutputFilenames, Input, OutputType};\n use rustc::session::filesearch;\n@@ -142,20 +141,41 @@ pub fn build_link_meta(incremental_hashes_map: &IncrementalHashesMap) -> LinkMet\n     return r;\n }\n \n-// The third parameter is for an extra path to add to PATH for MSVC\n-// cross linkers for host toolchain DLL dependencies\n-pub fn get_linker(sess: &Session) -> (String, Command, Option<PathBuf>) {\n+// The third parameter is for an env vars, used to set up the path for MSVC\n+// to find its DLLs\n+pub fn get_linker(sess: &Session) -> (String, Command, Vec<(OsString, OsString)>) {\n     if let Some(ref linker) = sess.opts.cg.linker {\n-        (linker.clone(), Command::new(linker), None)\n+        (linker.clone(), Command::new(linker), vec![])\n     } else if sess.target.target.options.is_like_msvc {\n-        let (cmd, host) = msvc::link_exe_cmd(sess);\n-        (\"link.exe\".to_string(), cmd, host)\n+        let (cmd, envs) = msvc_link_exe_cmd(sess);\n+        (\"link.exe\".to_string(), cmd, envs)\n     } else {\n         (sess.target.target.options.linker.clone(),\n-         Command::new(&sess.target.target.options.linker), None)\n+         Command::new(&sess.target.target.options.linker), vec![])\n     }\n }\n \n+#[cfg(windows)]\n+pub fn msvc_link_exe_cmd(sess: &Session) -> (Command, Vec<(OsString, OsString)>) {\n+    use gcc::windows_registry;\n+\n+    let target = &sess.opts.target_triple;\n+    let tool = windows_registry::find_tool(target, \"link.exe\");\n+\n+    if let Some(tool) = tool {\n+        let envs = tool.env().to_vec();\n+        (tool.to_command(), envs)\n+    } else {\n+        debug!(\"Failed to locate linker.\");\n+        (Command::new(\"link.exe\"), vec![])\n+    }\n+}\n+\n+#[cfg(not(windows))]\n+pub fn msvc_link_exe_cmd(_sess: &Session) -> (Command, Vec<(OsString, OsString)>) {\n+    (Command::new(\"link.exe\"), vec![])\n+}\n+\n pub fn get_ar_prog(sess: &Session) -> String {\n     sess.opts.cg.ar.clone().unwrap_or_else(|| {\n         sess.target.target.options.ar.clone()\n@@ -706,8 +726,9 @@ fn link_natively(sess: &Session,\n     let flavor = sess.linker_flavor();\n \n     // The invocations of cc share some flags across platforms\n-    let (pname, mut cmd, extra) = get_linker(sess);\n-    cmd.env(\"PATH\", command_path(sess, extra));\n+    let (pname, mut cmd, envs) = get_linker(sess);\n+    // This will set PATH on MSVC\n+    cmd.envs(envs);\n \n     let root = sess.target_filesearch(PathKind::Native).get_lib_path();\n     if let Some(args) = sess.target.target.options.pre_link_args.get(&flavor) {"}, {"sha": "c10312a8e17103f1d147367224e4c6e07db49df4", "filename": "src/librustc_trans/back/msvc/arch.rs", "status": "removed", "additions": 0, "deletions": 56, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d/src%2Flibrustc_trans%2Fback%2Fmsvc%2Farch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d/src%2Flibrustc_trans%2Fback%2Fmsvc%2Farch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fmsvc%2Farch.rs?ref=107bd67ef7fb3e8027d7234d687cdd27c3efaa0d", "patch": "@@ -1,56 +0,0 @@\n-// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-#![allow(non_camel_case_types, non_snake_case)]\n-\n-use libc::c_void;\n-use std::mem;\n-\n-type DWORD = u32;\n-type WORD = u16;\n-type LPVOID = *mut c_void;\n-type DWORD_PTR = usize;\n-\n-const PROCESSOR_ARCHITECTURE_INTEL: WORD = 0;\n-const PROCESSOR_ARCHITECTURE_AMD64: WORD = 9;\n-\n-#[repr(C)]\n-struct SYSTEM_INFO {\n-    wProcessorArchitecture: WORD,\n-    _wReserved: WORD,\n-    _dwPageSize: DWORD,\n-    _lpMinimumApplicationAddress: LPVOID,\n-    _lpMaximumApplicationAddress: LPVOID,\n-    _dwActiveProcessorMask: DWORD_PTR,\n-    _dwNumberOfProcessors: DWORD,\n-    _dwProcessorType: DWORD,\n-    _dwAllocationGranularity: DWORD,\n-    _wProcessorLevel: WORD,\n-    _wProcessorRevision: WORD,\n-}\n-\n-extern \"system\" {\n-    fn GetNativeSystemInfo(lpSystemInfo: *mut SYSTEM_INFO);\n-}\n-\n-pub enum Arch {\n-    X86,\n-    Amd64,\n-}\n-\n-pub fn host_arch() -> Option<Arch> {\n-    let mut info = unsafe { mem::zeroed() };\n-    unsafe { GetNativeSystemInfo(&mut info) };\n-    match info.wProcessorArchitecture {\n-        PROCESSOR_ARCHITECTURE_INTEL => Some(Arch::X86),\n-        PROCESSOR_ARCHITECTURE_AMD64 => Some(Arch::Amd64),\n-        _ => None,\n-    }\n-}"}, {"sha": "97648888fa9b95bebc3362964c64c3598a2fac42", "filename": "src/librustc_trans/back/msvc/mod.rs", "status": "removed", "additions": 0, "deletions": 305, "changes": 305, "blob_url": "https://github.com/rust-lang/rust/blob/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d/src%2Flibrustc_trans%2Fback%2Fmsvc%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d/src%2Flibrustc_trans%2Fback%2Fmsvc%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fmsvc%2Fmod.rs?ref=107bd67ef7fb3e8027d7234d687cdd27c3efaa0d", "patch": "@@ -1,305 +0,0 @@\n-// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-//! MSVC-specific logic for linkers and such.\n-//!\n-//! This module contains a cross-platform interface but has a blank unix\n-//! implementation. The Windows implementation builds on top of Windows native\n-//! libraries (reading registry keys), so it otherwise wouldn't link on unix.\n-//!\n-//! Note that we don't have much special logic for finding the system linker on\n-//! any other platforms, so it may seem a little odd to single out MSVC to have\n-//! a good deal of code just to find the linker. Unlike Unix systems, however,\n-//! the MSVC linker is not in the system PATH by default. It also additionally\n-//! needs a few environment variables or command line flags to be able to link\n-//! against system libraries.\n-//!\n-//! In order to have a nice smooth experience on Windows, the logic in this file\n-//! is here to find the MSVC linker and set it up in the default configuration\n-//! one would need to set up anyway. This means that the Rust compiler can be\n-//! run not only in the developer shells of MSVC but also the standard cmd.exe\n-//! shell or MSYS shells.\n-//!\n-//! As a high-level note, all logic in this module for looking up various\n-//! paths/files is based on Microsoft's logic in their vcvars bat files, but\n-//! comments can also be found below leading through the various code paths.\n-\n-// A simple macro to make this option mess easier to read\n-#[cfg(windows)]\n-macro_rules! otry {\n-    ($expr:expr) => (match $expr {\n-        Some(val) => val,\n-        None => return None,\n-    })\n-}\n-\n-#[cfg(windows)]\n-mod registry;\n-#[cfg(windows)]\n-mod arch;\n-\n-#[cfg(windows)]\n-mod platform {\n-    use std::env;\n-    use std::ffi::OsString;\n-    use std::fs;\n-    use std::path::{Path, PathBuf};\n-    use std::process::Command;\n-    use rustc::session::Session;\n-    use super::arch::{host_arch, Arch};\n-    use super::registry::LOCAL_MACHINE;\n-\n-    // First we need to figure out whether the environment is already correctly\n-    // configured by vcvars. We do this by looking at the environment variable\n-    // `VCINSTALLDIR` which is always set by vcvars, and unlikely to be set\n-    // otherwise. If it is defined, then we find `link.exe` in `PATH and trust\n-    // that everything else is configured correctly.\n-    //\n-    // If `VCINSTALLDIR` wasn't defined (or we couldn't find the linker where\n-    // it claimed it should be), then we resort to finding everything\n-    // ourselves. First we find where the latest version of MSVC is installed\n-    // and what version it is. Then based on the version we find the\n-    // appropriate SDKs.\n-    //\n-    // If despite our best efforts we are still unable to find MSVC then we\n-    // just blindly call `link.exe` and hope for the best.\n-    //\n-    // This code only supports VC 11 through 15. For versions older than that\n-    // the user will need to manually execute the appropriate vcvars bat file\n-    // and it should hopefully work.\n-    //\n-    // The second member of the tuple we return is the directory for the host\n-    // linker toolchain, which is necessary when using the cross linkers.\n-    pub fn link_exe_cmd(sess: &Session) -> (Command, Option<PathBuf>) {\n-        let arch = &sess.target.target.arch;\n-        env::var_os(\"VCINSTALLDIR\").and_then(|_| {\n-            debug!(\"Detected that vcvars was already run.\");\n-            let path = otry!(env::var_os(\"PATH\"));\n-            // Mingw has its own link which is not the link we want so we\n-            // look for `cl.exe` too as a precaution.\n-            env::split_paths(&path).find(|path| {\n-                path.join(\"cl.exe\").is_file()\n-                    && path.join(\"link.exe\").is_file()\n-            }).map(|path| {\n-                (Command::new(path.join(\"link.exe\")), None)\n-            })\n-        }).or_else(|| {\n-            None.or_else(|| {\n-                find_msvc_latest(arch, \"15.0\")\n-            }).or_else(|| {\n-                find_msvc_latest(arch, \"14.0\")\n-            }).or_else(|| {\n-                find_msvc_12(arch)\n-            }).or_else(|| {\n-                find_msvc_11(arch)\n-            }).map(|(cmd, path)| (cmd, Some(path)))\n-        }).unwrap_or_else(|| {\n-            debug!(\"Failed to locate linker.\");\n-            (Command::new(\"link.exe\"), None)\n-        })\n-    }\n-\n-    // For MSVC 14 or newer we need to find the Universal CRT as well as either\n-    // the Windows 10 SDK or Windows 8.1 SDK.\n-    fn find_msvc_latest(arch: &str, ver: &str) -> Option<(Command, PathBuf)> {\n-        let vcdir = otry!(get_vc_dir(ver));\n-        let (mut cmd, host) = otry!(get_linker(&vcdir, arch));\n-        let sub = otry!(lib_subdir(arch));\n-        let ucrt = otry!(get_ucrt_dir());\n-        debug!(\"Found Universal CRT {:?}\", ucrt);\n-        add_lib(&mut cmd, &ucrt.join(\"ucrt\").join(sub));\n-        if let Some(dir) = get_sdk10_dir() {\n-            debug!(\"Found Win10 SDK {:?}\", dir);\n-            add_lib(&mut cmd, &dir.join(\"um\").join(sub));\n-        } else if let Some(dir) = get_sdk81_dir() {\n-            debug!(\"Found Win8.1 SDK {:?}\", dir);\n-            add_lib(&mut cmd, &dir.join(\"um\").join(sub));\n-        } else {\n-            return None\n-        }\n-        Some((cmd, host))\n-    }\n-\n-    // For MSVC 12 we need to find the Windows 8.1 SDK.\n-    fn find_msvc_12(arch: &str) -> Option<(Command, PathBuf)> {\n-        let vcdir = otry!(get_vc_dir(\"12.0\"));\n-        let (mut cmd, host) = otry!(get_linker(&vcdir, arch));\n-        let sub = otry!(lib_subdir(arch));\n-        let sdk81 = otry!(get_sdk81_dir());\n-        debug!(\"Found Win8.1 SDK {:?}\", sdk81);\n-        add_lib(&mut cmd, &sdk81.join(\"um\").join(sub));\n-        Some((cmd, host))\n-    }\n-\n-    // For MSVC 11 we need to find the Windows 8 SDK.\n-    fn find_msvc_11(arch: &str) -> Option<(Command, PathBuf)> {\n-        let vcdir = otry!(get_vc_dir(\"11.0\"));\n-        let (mut cmd, host) = otry!(get_linker(&vcdir, arch));\n-        let sub = otry!(lib_subdir(arch));\n-        let sdk8 = otry!(get_sdk8_dir());\n-        debug!(\"Found Win8 SDK {:?}\", sdk8);\n-        add_lib(&mut cmd, &sdk8.join(\"um\").join(sub));\n-        Some((cmd, host))\n-    }\n-\n-    // A convenience function to append library paths.\n-    fn add_lib(cmd: &mut Command, lib: &Path) {\n-        let mut arg: OsString = \"/LIBPATH:\".into();\n-        arg.push(lib);\n-        cmd.arg(arg);\n-    }\n-\n-    // Given a possible MSVC installation directory, we look for the linker and\n-    // then add the MSVC library path.\n-    fn get_linker(path: &Path, arch: &str) -> Option<(Command, PathBuf)> {\n-        debug!(\"Looking for linker in {:?}\", path);\n-        bin_subdir(arch).into_iter().map(|(sub, host)| {\n-            (path.join(\"bin\").join(sub).join(\"link.exe\"),\n-             path.join(\"bin\").join(host))\n-        }).filter(|&(ref path, _)| {\n-            path.is_file()\n-        }).map(|(path, host)| {\n-            (Command::new(path), host)\n-        }).filter_map(|(mut cmd, host)| {\n-            let sub = otry!(vc_lib_subdir(arch));\n-            add_lib(&mut cmd, &path.join(\"lib\").join(sub));\n-            Some((cmd, host))\n-        }).next()\n-    }\n-\n-    // To find MSVC we look in a specific registry key for the version we are\n-    // trying to find.\n-    fn get_vc_dir(ver: &str) -> Option<PathBuf> {\n-        let key = otry!(LOCAL_MACHINE\n-            .open(r\"SOFTWARE\\Microsoft\\VisualStudio\\SxS\\VC7\".as_ref()).ok());\n-        let path = otry!(key.query_str(ver).ok());\n-        Some(path.into())\n-    }\n-\n-    // To find the Universal CRT we look in a specific registry key for where\n-    // all the Universal CRTs are located and then sort them asciibetically to\n-    // find the newest version. While this sort of sorting isn't ideal,  it is\n-    // what vcvars does so that's good enough for us.\n-    fn get_ucrt_dir() -> Option<PathBuf> {\n-        let key = otry!(LOCAL_MACHINE\n-            .open(r\"SOFTWARE\\Microsoft\\Windows Kits\\Installed Roots\".as_ref()).ok());\n-        let root = otry!(key.query_str(\"KitsRoot10\").ok());\n-        let readdir = otry!(fs::read_dir(Path::new(&root).join(\"lib\")).ok());\n-        readdir.filter_map(|dir| {\n-            dir.ok()\n-        }).map(|dir| {\n-            dir.path()\n-        }).filter(|dir| {\n-            dir.components().last().and_then(|c| {\n-                c.as_os_str().to_str()\n-            }).map(|c| {\n-                c.starts_with(\"10.\") && dir.join(\"ucrt\").is_dir()\n-            }).unwrap_or(false)\n-        }).max()\n-    }\n-\n-    // Vcvars finds the correct version of the Windows 10 SDK by looking\n-    // for the include `um\\Windows.h` because sometimes a given version will\n-    // only have UCRT bits without the rest of the SDK. Since we only care about\n-    // libraries and not includes, we instead look for `um\\x64\\kernel32.lib`.\n-    // Since the 32-bit and 64-bit libraries are always installed together we\n-    // only need to bother checking x64, making this code a tiny bit simpler.\n-    // Like we do for the Universal CRT, we sort the possibilities\n-    // asciibetically to find the newest one as that is what vcvars does.\n-    fn get_sdk10_dir() -> Option<PathBuf> {\n-        let key = otry!(LOCAL_MACHINE\n-            .open(r\"SOFTWARE\\Microsoft\\Microsoft SDKs\\Windows\\v10.0\".as_ref()).ok());\n-        let root = otry!(key.query_str(\"InstallationFolder\").ok());\n-        let readdir = otry!(fs::read_dir(Path::new(&root).join(\"lib\")).ok());\n-        let mut dirs: Vec<_> = readdir.filter_map(|dir| dir.ok())\n-            .map(|dir| dir.path()).collect();\n-        dirs.sort();\n-        dirs.into_iter().rev().filter(|dir| {\n-            dir.join(\"um\").join(\"x64\").join(\"kernel32.lib\").is_file()\n-        }).next()\n-    }\n-\n-    // Interestingly there are several subdirectories, `win7` `win8` and\n-    // `winv6.3`. Vcvars seems to only care about `winv6.3` though, so the same\n-    // applies to us. Note that if we were targetting kernel mode drivers\n-    // instead of user mode applications, we would care.\n-    fn get_sdk81_dir() -> Option<PathBuf> {\n-        let key = otry!(LOCAL_MACHINE\n-            .open(r\"SOFTWARE\\Microsoft\\Microsoft SDKs\\Windows\\v8.1\".as_ref()).ok());\n-        let root = otry!(key.query_str(\"InstallationFolder\").ok());\n-        Some(Path::new(&root).join(\"lib\").join(\"winv6.3\"))\n-    }\n-\n-    fn get_sdk8_dir() -> Option<PathBuf> {\n-        let key = otry!(LOCAL_MACHINE\n-            .open(r\"SOFTWARE\\Microsoft\\Microsoft SDKs\\Windows\\v8.0\".as_ref()).ok());\n-        let root = otry!(key.query_str(\"InstallationFolder\").ok());\n-        Some(Path::new(&root).join(\"lib\").join(\"win8\"))\n-    }\n-\n-    // When choosing the linker toolchain to use, we have to choose the one\n-    // which matches the host architecture. Otherwise we end up in situations\n-    // where someone on 32-bit Windows is trying to cross compile to 64-bit and\n-    // it tries to invoke the native 64-bit linker which won't work.\n-    //\n-    // For the return value of this function, the first member of the tuple is\n-    // the folder of the linker we will be invoking, while the second member\n-    // is the folder of the host toolchain for that linker which is essential\n-    // when using a cross linker. We return a Vec since on x64 there are often\n-    // two linkers that can target the architecture we desire. The 64-bit host\n-    // linker is preferred, and hence first, due to 64-bit allowing it more\n-    // address space to work with and potentially being faster.\n-    //\n-    // FIXME - Figure out what happens when the host architecture is arm.\n-    fn bin_subdir(arch: &str) -> Vec<(&'static str, &'static str)> {\n-        match (arch, host_arch()) {\n-            (\"x86\", Some(Arch::X86)) => vec![(\"\", \"\")],\n-            (\"x86\", Some(Arch::Amd64)) => vec![(\"amd64_x86\", \"amd64\"), (\"\", \"\")],\n-            (\"x86_64\", Some(Arch::X86)) => vec![(\"x86_amd64\", \"\")],\n-            (\"x86_64\", Some(Arch::Amd64)) => vec![(\"amd64\", \"amd64\"), (\"x86_amd64\", \"\")],\n-            (\"arm\", Some(Arch::X86)) => vec![(\"x86_arm\", \"\")],\n-            (\"arm\", Some(Arch::Amd64)) => vec![(\"amd64_arm\", \"amd64\"), (\"x86_arm\", \"\")],\n-            _ => vec![],\n-        }\n-    }\n-\n-    fn lib_subdir(arch: &str) -> Option<&'static str> {\n-        match arch {\n-            \"x86\" => Some(\"x86\"),\n-            \"x86_64\" => Some(\"x64\"),\n-            \"arm\" => Some(\"arm\"),\n-            _ => None,\n-        }\n-    }\n-\n-    // MSVC's x86 libraries are not in a subfolder\n-    fn vc_lib_subdir(arch: &str) -> Option<&'static str> {\n-        match arch {\n-            \"x86\" => Some(\"\"),\n-            \"x86_64\" => Some(\"amd64\"),\n-            \"arm\" => Some(\"arm\"),\n-            _ => None,\n-        }\n-    }\n-}\n-\n-// If we're not on Windows, then there's no registry to search through and MSVC\n-// wouldn't be able to run, so we just call `link.exe` and hope for the best.\n-#[cfg(not(windows))]\n-mod platform {\n-    use std::path::PathBuf;\n-    use std::process::Command;\n-    use rustc::session::Session;\n-    pub fn link_exe_cmd(_sess: &Session) -> (Command, Option<PathBuf>) {\n-        (Command::new(\"link.exe\"), None)\n-    }\n-}\n-\n-pub use self::platform::*;"}, {"sha": "8242f53896afc6c762a3ff2ef84edf62295456de", "filename": "src/librustc_trans/back/msvc/registry.rs", "status": "removed", "additions": 0, "deletions": 136, "changes": 136, "blob_url": "https://github.com/rust-lang/rust/blob/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d/src%2Flibrustc_trans%2Fback%2Fmsvc%2Fregistry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/107bd67ef7fb3e8027d7234d687cdd27c3efaa0d/src%2Flibrustc_trans%2Fback%2Fmsvc%2Fregistry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fmsvc%2Fregistry.rs?ref=107bd67ef7fb3e8027d7234d687cdd27c3efaa0d", "patch": "@@ -1,136 +0,0 @@\n-// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-use std::io;\n-use std::ffi::{OsString, OsStr};\n-use std::os::windows::prelude::*;\n-use std::ptr;\n-use libc::c_long;\n-\n-pub type DWORD = u32;\n-type LPCWSTR = *const u16;\n-type LONG = c_long;\n-type LPDWORD = *mut DWORD;\n-type LPBYTE = *mut u8;\n-\n-\n-const HKEY_LOCAL_MACHINE: HKEY = 0x80000002 as HKEY;\n-const KEY_WOW64_32KEY: REGSAM = 0x0200;\n-const KEY_READ: REGSAM = (STANDARD_RIGTS_READ | KEY_QUERY_VALUE |\n-                          KEY_ENUMERATE_SUB_KEYS | KEY_NOTIFY) & !SYNCHRONIZE;\n-const STANDARD_RIGTS_READ: REGSAM = READ_CONTROL;\n-const READ_CONTROL: REGSAM = 0x00020000;\n-const KEY_QUERY_VALUE: REGSAM = 0x0001;\n-const KEY_ENUMERATE_SUB_KEYS: REGSAM = 0x0008;\n-const KEY_NOTIFY: REGSAM = 0x0010;\n-const SYNCHRONIZE: REGSAM = 0x00100000;\n-const REG_SZ: DWORD = 1;\n-const ERROR_SUCCESS: i32 = 0;\n-\n-pub enum __HKEY__ {}\n-pub type HKEY = *mut __HKEY__;\n-pub type PHKEY = *mut HKEY;\n-pub type REGSAM = DWORD;\n-\n-#[link(name = \"advapi32\")]\n-extern \"system\" {\n-    fn RegOpenKeyExW(hKey: HKEY,\n-                     lpSubKey: LPCWSTR,\n-                     ulOptions: DWORD,\n-                     samDesired: REGSAM,\n-                     phkResult: PHKEY) -> LONG;\n-    fn RegQueryValueExW(hKey: HKEY,\n-                        lpValueName: LPCWSTR,\n-                        lpReserved: LPDWORD,\n-                        lpType: LPDWORD,\n-                        lpData: LPBYTE,\n-                        lpcbData: LPDWORD) -> LONG;\n-    fn RegCloseKey(hKey: HKEY) -> LONG;\n-}\n-\n-pub struct RegistryKey(Repr);\n-\n-struct OwnedKey(HKEY);\n-\n-enum Repr {\n-    Const(HKEY),\n-    Owned(OwnedKey),\n-}\n-\n-unsafe impl Sync for RegistryKey {}\n-unsafe impl Send for RegistryKey {}\n-\n-pub static LOCAL_MACHINE: RegistryKey = RegistryKey(Repr::Const(HKEY_LOCAL_MACHINE));\n-\n-impl RegistryKey {\n-    fn raw(&self) -> HKEY {\n-        match self.0 {\n-            Repr::Const(val) => val,\n-            Repr::Owned(ref val) => val.0,\n-        }\n-    }\n-\n-    pub fn open(&self, key: &OsStr) -> io::Result<RegistryKey> {\n-        let key = key.encode_wide().chain(Some(0)).collect::<Vec<_>>();\n-        let mut ret = ptr::null_mut();\n-        let err = unsafe {\n-            RegOpenKeyExW(self.raw(), key.as_ptr(), 0,\n-                          KEY_READ | KEY_WOW64_32KEY, &mut ret)\n-        };\n-        if err == ERROR_SUCCESS {\n-            Ok(RegistryKey(Repr::Owned(OwnedKey(ret))))\n-        } else {\n-            Err(io::Error::from_raw_os_error(err as i32))\n-        }\n-    }\n-\n-    pub fn query_str(&self, name: &str) -> io::Result<OsString> {\n-        let name: &OsStr = name.as_ref();\n-        let name = name.encode_wide().chain(Some(0)).collect::<Vec<_>>();\n-        let mut len = 0;\n-        let mut kind = 0;\n-        unsafe {\n-            let err = RegQueryValueExW(self.raw(), name.as_ptr(), ptr::null_mut(),\n-                                       &mut kind, ptr::null_mut(), &mut len);\n-            if err != ERROR_SUCCESS {\n-                return Err(io::Error::from_raw_os_error(err as i32))\n-            }\n-            if kind != REG_SZ {\n-                return Err(io::Error::new(io::ErrorKind::Other,\n-                                          \"registry key wasn't a string\"))\n-            }\n-\n-            // The length here is the length in bytes, but we're using wide\n-            // characters so we need to be sure to halve it for the capacity\n-            // passed in.\n-            let mut v = Vec::with_capacity(len as usize / 2);\n-            let err = RegQueryValueExW(self.raw(), name.as_ptr(), ptr::null_mut(),\n-                                       ptr::null_mut(), v.as_mut_ptr() as *mut _,\n-                                       &mut len);\n-            if err != ERROR_SUCCESS {\n-                return Err(io::Error::from_raw_os_error(err as i32))\n-            }\n-            v.set_len(len as usize / 2);\n-\n-            // Some registry keys may have a terminating nul character, but\n-            // we're not interested in that, so chop it off if it's there.\n-            if v[v.len() - 1] == 0 {\n-                v.pop();\n-            }\n-            Ok(OsString::from_wide(&v))\n-        }\n-    }\n-}\n-\n-impl Drop for OwnedKey {\n-    fn drop(&mut self) {\n-        unsafe { RegCloseKey(self.0); }\n-    }\n-}"}, {"sha": "71fb2e5fb202a232302192bd475e4d68096a6b7b", "filename": "src/librustc_trans/lib.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_trans%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustc_trans%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Flib.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -35,6 +35,7 @@\n #![feature(slice_patterns)]\n #![feature(unicode)]\n #![feature(conservative_impl_trait)]\n+#![feature(command_envs)]\n \n #![cfg_attr(stage0, unstable(feature = \"rustc_private\", issue = \"27812\"))]\n #![cfg_attr(stage0, feature(rustc_private))]\n@@ -62,6 +63,8 @@ extern crate rustc_bitflags;\n extern crate syntax_pos;\n extern crate rustc_errors as errors;\n extern crate serialize;\n+#[cfg(windows)]\n+extern crate gcc; // Used to locate MSVC, not gcc :)\n \n pub use base::trans_crate;\n pub use back::symbol_names::provide;\n@@ -77,8 +80,7 @@ pub mod back {\n     pub(crate) mod symbol_export;\n     pub(crate) mod symbol_names;\n     pub mod write;\n-    mod msvc;\n-    mod rpath;\n+    pub mod rpath;\n }\n \n mod diagnostics;"}, {"sha": "68f03d32e83cf267237be23ea61b8ad83f5077dd", "filename": "src/librustdoc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustdoc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustdoc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -30,4 +30,4 @@ pulldown-cmark = { version = \"0.0.14\", default-features = false }\n \n [build-dependencies]\n build_helper = { path = \"../build_helper\" }\n-gcc = \"0.3.27\"\n+gcc = \"0.3.50\""}, {"sha": "25e55ff36e7c63ed4697c6f532f445aa5652b022", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -1506,8 +1506,8 @@ pub enum Type {\n     /// extern \"ABI\" fn\n     BareFunction(Box<BareFunctionDecl>),\n     Tuple(Vec<Type>),\n-    Vector(Box<Type>),\n-    FixedVector(Box<Type>, String),\n+    Slice(Box<Type>),\n+    Array(Box<Type>, usize),\n     Never,\n     Unique(Box<Type>),\n     RawPointer(Mutability, Box<Type>),\n@@ -1573,10 +1573,8 @@ impl Type {\n     pub fn primitive_type(&self) -> Option<PrimitiveType> {\n         match *self {\n             Primitive(p) | BorrowedRef { type_: box Primitive(p), ..} => Some(p),\n-            Vector(..) | BorrowedRef{ type_: box Vector(..), ..  } => Some(PrimitiveType::Slice),\n-            FixedVector(..) | BorrowedRef { type_: box FixedVector(..), .. } => {\n-                Some(PrimitiveType::Array)\n-            }\n+            Slice(..) | BorrowedRef { type_: box Slice(..), .. } => Some(PrimitiveType::Slice),\n+            Array(..) | BorrowedRef { type_: box Array(..), .. } => Some(PrimitiveType::Array),\n             Tuple(..) => Some(PrimitiveType::Tuple),\n             RawPointer(..) => Some(PrimitiveType::RawPointer),\n             _ => None,\n@@ -1717,11 +1715,11 @@ impl Clean<Type> for hir::Ty {\n                 BorrowedRef {lifetime: lifetime, mutability: m.mutbl.clean(cx),\n                              type_: box m.ty.clean(cx)}\n             }\n-            TySlice(ref ty) => Vector(box ty.clean(cx)),\n+            TySlice(ref ty) => Slice(box ty.clean(cx)),\n             TyArray(ref ty, length) => {\n                 use rustc::middle::const_val::eval_length;\n                 let n = eval_length(cx.tcx, length, \"array length\").unwrap();\n-                FixedVector(box ty.clean(cx), n.to_string())\n+                Array(box ty.clean(cx), n)\n             },\n             TyTup(ref tys) => Tuple(tys.clean(cx)),\n             TyPath(hir::QPath::Resolved(None, ref path)) => {\n@@ -1832,9 +1830,8 @@ impl<'tcx> Clean<Type> for ty::Ty<'tcx> {\n             ty::TyUint(uint_ty) => Primitive(uint_ty.into()),\n             ty::TyFloat(float_ty) => Primitive(float_ty.into()),\n             ty::TyStr => Primitive(PrimitiveType::Str),\n-            ty::TySlice(ty) => Vector(box ty.clean(cx)),\n-            ty::TyArray(ty, i) => FixedVector(box ty.clean(cx),\n-                                              format!(\"{}\", i)),\n+            ty::TySlice(ty) => Slice(box ty.clean(cx)),\n+            ty::TyArray(ty, n) => Array(box ty.clean(cx), n),\n             ty::TyRawPtr(mt) => RawPointer(mt.mutbl.clean(cx), box mt.ty.clean(cx)),\n             ty::TyRef(r, mt) => BorrowedRef {\n                 lifetime: r.clean(cx),"}, {"sha": "86660c28f80ad848aea2e827034790259ed3d104", "filename": "src/librustdoc/html/format.rs", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fformat.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -25,7 +25,6 @@ use rustc::hir;\n use clean::{self, PrimitiveType};\n use core::DocAccessLevels;\n use html::item_type::ItemType;\n-use html::escape::Escape;\n use html::render;\n use html::render::{cache, CURRENT_LOCATION_KEY};\n \n@@ -643,21 +642,15 @@ fn fmt_type(t: &clean::Type, f: &mut fmt::Formatter, use_absolute: bool) -> fmt:\n                 }\n             }\n         }\n-        clean::Vector(ref t) => {\n+        clean::Slice(ref t) => {\n             primitive_link(f, PrimitiveType::Slice, \"[\")?;\n             fmt::Display::fmt(t, f)?;\n             primitive_link(f, PrimitiveType::Slice, \"]\")\n         }\n-        clean::FixedVector(ref t, ref s) => {\n+        clean::Array(ref t, n) => {\n             primitive_link(f, PrimitiveType::Array, \"[\")?;\n             fmt::Display::fmt(t, f)?;\n-            if f.alternate() {\n-                primitive_link(f, PrimitiveType::Array,\n-                               &format!(\"; {}]\", s))\n-            } else {\n-                primitive_link(f, PrimitiveType::Array,\n-                               &format!(\"; {}]\", Escape(s)))\n-            }\n+            primitive_link(f, PrimitiveType::Array, &format!(\"; {}]\", n))\n         }\n         clean::Never => f.write_str(\"!\"),\n         clean::RawPointer(m, ref t) => {\n@@ -685,7 +678,7 @@ fn fmt_type(t: &clean::Type, f: &mut fmt::Formatter, use_absolute: bool) -> fmt:\n             };\n             let m = MutableSpace(mutability);\n             match **ty {\n-                clean::Vector(ref bt) => { // BorrowedRef{ ... Vector(T) } is &[T]\n+                clean::Slice(ref bt) => { // BorrowedRef{ ... Slice(T) } is &[T]\n                     match **bt {\n                         clean::Generic(_) => {\n                             if f.alternate() {"}, {"sha": "e17918506fe5aa62868b1028a28fe4e648facb3c", "filename": "src/libstd/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibstd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibstd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2FCargo.toml?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -35,7 +35,7 @@ rustc_tsan = { path = \"../librustc_tsan\" }\n \n [build-dependencies]\n build_helper = { path = \"../build_helper\" }\n-gcc = \"0.3.27\"\n+gcc = \"0.3.50\"\n \n [features]\n backtrace = []"}, {"sha": "7d5e1929cd2a162683d96884a70085d9c16f6536", "filename": "src/libstd/sync/mpsc/mod.rs", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibstd%2Fsync%2Fmpsc%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibstd%2Fsync%2Fmpsc%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fmpsc%2Fmod.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -1370,14 +1370,16 @@ impl<T> Receiver<T> {\n     /// let (send, recv) = channel();\n     ///\n     /// thread::spawn(move || {\n-    ///     send.send(1u8).unwrap();\n-    ///     send.send(2u8).unwrap();\n-    ///     send.send(3u8).unwrap();\n+    ///     send.send(1).unwrap();\n+    ///     send.send(2).unwrap();\n+    ///     send.send(3).unwrap();\n     /// });\n     ///\n-    /// for x in recv.iter() {\n-    ///     println!(\"Got: {}\", x);\n-    /// }\n+    /// let mut iter = recv.iter();\n+    /// assert_eq!(iter.next(), Some(1));\n+    /// assert_eq!(iter.next(), Some(2));\n+    /// assert_eq!(iter.next(), Some(3));\n+    /// assert_eq!(iter.next(), None);\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     pub fn iter(&self) -> Iter<T> {\n@@ -1393,29 +1395,34 @@ impl<T> Receiver<T> {\n     ///\n     /// # Examples\n     ///\n-    /// ```rust\n+    /// ```no_run\n     /// use std::sync::mpsc::channel;\n     /// use std::thread;\n     /// use std::time::Duration;\n     ///\n     /// let (sender, receiver) = channel();\n     ///\n-    /// // Nothing is in the buffer yet\n+    /// // nothing is in the buffer yet\n     /// assert!(receiver.try_iter().next().is_none());\n-    /// println!(\"Nothing in the buffer...\");\n     ///\n     /// thread::spawn(move || {\n+    ///     thread::sleep(Duration::from_secs(1));\n     ///     sender.send(1).unwrap();\n     ///     sender.send(2).unwrap();\n     ///     sender.send(3).unwrap();\n     /// });\n     ///\n-    /// println!(\"Going to sleep...\");\n-    /// thread::sleep(Duration::from_secs(2)); // block for two seconds\n+    /// // nothing is in the buffer yet\n+    /// assert!(receiver.try_iter().next().is_none());\n+    ///\n+    /// // block for two seconds\n+    /// thread::sleep(Duration::from_secs(2));\n     ///\n-    /// for x in receiver.try_iter() {\n-    ///     println!(\"Got: {}\", x);\n-    /// }\n+    /// let mut iter = receiver.try_iter();\n+    /// assert_eq!(iter.next(), Some(1));\n+    /// assert_eq!(iter.next(), Some(2));\n+    /// assert_eq!(iter.next(), Some(3));\n+    /// assert_eq!(iter.next(), None);\n     /// ```\n     #[stable(feature = \"receiver_try_iter\", since = \"1.15.0\")]\n     pub fn try_iter(&self) -> TryIter<T> {"}, {"sha": "64c31c2a681cf2a259006caf7a14822f4a342c9b", "filename": "src/libstd/thread/mod.rs", "status": "modified", "additions": 28, "deletions": 3, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibstd%2Fthread%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibstd%2Fthread%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fthread%2Fmod.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -1094,11 +1094,12 @@ impl<T> JoinInner<T> {\n \n /// An owned permission to join on a thread (block on its termination).\n ///\n-/// A `JoinHandle` *detaches* the child thread when it is dropped.\n+/// A `JoinHandle` *detaches* the associated thread when it is dropped, which\n+/// means that there is no longer any handle to thread and no way to `join`\n+/// on it.\n ///\n /// Due to platform restrictions, it is not possible to [`Clone`] this\n-/// handle: the ability to join a child thread is a uniquely-owned\n-/// permission.\n+/// handle: the ability to join a thread is a uniquely-owned permission.\n ///\n /// This `struct` is created by the [`thread::spawn`] function and the\n /// [`thread::Builder::spawn`] method.\n@@ -1127,6 +1128,30 @@ impl<T> JoinInner<T> {\n /// }).unwrap();\n /// ```\n ///\n+/// Child being detached and outliving its parent:\n+///\n+/// ```no_run\n+/// use std::thread;\n+/// use std::time::Duration;\n+///\n+/// let original_thread = thread::spawn(|| {\n+///     let _detached_thread = thread::spawn(|| {\n+///         // Here we sleep to make sure that the first thread returns before.\n+///         thread::sleep(Duration::from_millis(10));\n+///         // This will be called, even though the JoinHandle is dropped.\n+///         println!(\"\u266b Still alive \u266b\");\n+///     });\n+/// });\n+///\n+/// let _ = original_thread.join();\n+/// println!(\"Original thread is joined.\");\n+///\n+/// // We make sure that the new thread has time to run, before the main\n+/// // thread returns.\n+///\n+/// thread::sleep(Duration::from_millis(1000));\n+/// ```\n+///\n /// [`Clone`]: ../../std/clone/trait.Clone.html\n /// [`thread::spawn`]: fn.spawn.html\n /// [`thread::Builder::spawn`]: struct.Builder.html#method.spawn"}, {"sha": "d9cb2b4ab7db072bcdb45252758adbd280a665d5", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -5985,6 +5985,10 @@ impl<'a> Parser<'a> {\n             return Ok(Some(self.parse_item_foreign_fn(visibility, lo, attrs)?));\n         }\n \n+        if self.check_keyword(keywords::Const) {\n+            return Err(self.span_fatal(self.span, \"extern items cannot be `const`\"));\n+        }\n+\n         // FIXME #5668: this will occur for a macro invocation:\n         match self.parse_macro_use_or_failure(attrs, true, false, lo, visibility)? {\n             Some(item) => {"}, {"sha": "27688867de378b471fcf12a633ee3d08580c862f", "filename": "src/test/parse-fail/removed-syntax-extern-const.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Ftest%2Fparse-fail%2Fremoved-syntax-extern-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb907adbbd1727938245a67db1c92be7e4dec3e6/src%2Ftest%2Fparse-fail%2Fremoved-syntax-extern-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fparse-fail%2Fremoved-syntax-extern-const.rs?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -12,5 +12,5 @@\n \n extern {\n     const i: isize;\n-    //~^ ERROR expected one of `fn`, `pub`, `static`, or `}`, found `const`\n+    //~^ ERROR extern items cannot be `const`\n }"}, {"sha": "b4ff403041f17957f735ad750c3241a3a428b9b7", "filename": "src/tools/rust-installer", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frust-installer?ref=bb907adbbd1727938245a67db1c92be7e4dec3e6", "patch": "@@ -1 +1 @@\n-Subproject commit 8707ceaf040f6d87b67a002de16a8d2bc4db7a41\n+Subproject commit b4ff403041f17957f735ad750c3241a3a428b9b7"}]}