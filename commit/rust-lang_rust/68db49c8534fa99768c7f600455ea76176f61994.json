{"sha": "68db49c8534fa99768c7f600455ea76176f61994", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4ZGI0OWM4NTM0ZmE5OTc2OGM3ZjYwMDQ1NWVhNzYxNzZmNjE5OTQ=", "commit": {"author": {"name": "Hrvoje Ban", "email": "hban@users.noreply.github.com", "date": "2020-05-18T06:07:31Z"}, "committer": {"name": "Hrvoje Ban", "email": "hban@users.noreply.github.com", "date": "2020-05-18T06:07:31Z"}, "message": "Add more tests for Fn traits", "tree": {"sha": "8cd857a49cdeafce7d1ecb2827eadafa490e4700", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8cd857a49cdeafce7d1ecb2827eadafa490e4700"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68db49c8534fa99768c7f600455ea76176f61994", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68db49c8534fa99768c7f600455ea76176f61994", "html_url": "https://github.com/rust-lang/rust/commit/68db49c8534fa99768c7f600455ea76176f61994", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68db49c8534fa99768c7f600455ea76176f61994/comments", "author": {"login": "hban", "id": 2943382, "node_id": "MDQ6VXNlcjI5NDMzODI=", "avatar_url": "https://avatars.githubusercontent.com/u/2943382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hban", "html_url": "https://github.com/hban", "followers_url": "https://api.github.com/users/hban/followers", "following_url": "https://api.github.com/users/hban/following{/other_user}", "gists_url": "https://api.github.com/users/hban/gists{/gist_id}", "starred_url": "https://api.github.com/users/hban/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hban/subscriptions", "organizations_url": "https://api.github.com/users/hban/orgs", "repos_url": "https://api.github.com/users/hban/repos", "events_url": "https://api.github.com/users/hban/events{/privacy}", "received_events_url": "https://api.github.com/users/hban/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hban", "id": 2943382, "node_id": "MDQ6VXNlcjI5NDMzODI=", "avatar_url": "https://avatars.githubusercontent.com/u/2943382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hban", "html_url": "https://github.com/hban", "followers_url": "https://api.github.com/users/hban/followers", "following_url": "https://api.github.com/users/hban/following{/other_user}", "gists_url": "https://api.github.com/users/hban/gists{/gist_id}", "starred_url": "https://api.github.com/users/hban/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hban/subscriptions", "organizations_url": "https://api.github.com/users/hban/orgs", "repos_url": "https://api.github.com/users/hban/repos", "events_url": "https://api.github.com/users/hban/events{/privacy}", "received_events_url": "https://api.github.com/users/hban/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1afdc579297f68dadbe8ee580040ec6ca95cc58b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1afdc579297f68dadbe8ee580040ec6ca95cc58b", "html_url": "https://github.com/rust-lang/rust/commit/1afdc579297f68dadbe8ee580040ec6ca95cc58b"}], "stats": {"total": 132, "additions": 132, "deletions": 0}, "files": [{"sha": "c49aacf98d444a65f96a563dcbe64d4889d64c80", "filename": "crates/ra_hir_ty/src/tests/traits.rs", "status": "modified", "additions": 132, "deletions": 0, "changes": 132, "blob_url": "https://github.com/rust-lang/rust/blob/68db49c8534fa99768c7f600455ea76176f61994/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68db49c8534fa99768c7f600455ea76176f61994/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=68db49c8534fa99768c7f600455ea76176f61994", "patch": "@@ -1616,6 +1616,138 @@ fn test<F: FnOnce(u32, u64) -> u128>(f: F) {\n     );\n }\n \n+#[test]\n+fn fn_ptr_and_item() {\n+    assert_snapshot!(\n+        infer(r#\"\n+#[lang=\"fn_once\"]\n+trait FnOnce<Args> {\n+    type Output;\n+\n+    fn call_once(self, args: Args) -> Self::Output;\n+}\n+\n+trait Foo<T> {\n+    fn foo(&self) -> T;\n+}\n+\n+struct Bar<T>(T);\n+\n+impl<A1, R, F: FnOnce(A1) -> R> Foo<(A1, R)> for Bar<F> {\n+    fn foo(&self) -> (A1, R) {}\n+}\n+\n+enum Opt<T> { None, Some(T) }\n+impl<T> Opt<T> {\n+    fn map<U, F: FnOnce(T) -> U>(self, f: F) -> Opt<U> {}\n+}\n+\n+fn test() {\n+    let bar: Bar<fn(u8) -> u32>;\n+    bar.foo();\n+\n+    let opt: Opt<u8>;\n+    let f: fn(u8) -> u32;\n+    opt.map(f);\n+}\n+\"#),\n+        @r###\"\n+75..79 'self': Self\n+81..85 'args': Args\n+140..144 'self': &Self\n+244..248 'self': &Bar<F>\n+261..263 '{}': ()\n+347..351 'self': Opt<T>\n+353..354 'f': F\n+369..371 '{}': ()\n+385..501 '{     ...(f); }': ()\n+395..398 'bar': Bar<fn(u8) -> u32>\n+424..427 'bar': Bar<fn(u8) -> u32>\n+424..433 'bar.foo()': {unknown}\n+444..447 'opt': Opt<u8>\n+466..467 'f': fn(u8) -> u32\n+488..491 'opt': Opt<u8>\n+488..498 'opt.map(f)': Opt<FnOnce::Output<fn(u8) -> u32, (u8,)>>\n+496..497 'f': fn(u8) -> u32\n+\"###\n+    );\n+}\n+\n+#[test]\n+fn fn_trait_deref_with_ty_default() {\n+    assert_snapshot!(\n+        infer(r#\"\n+#[lang = \"deref\"]\n+trait Deref {\n+    type Target;\n+\n+    fn deref(&self) -> &Self::Target;\n+}\n+\n+#[lang=\"fn_once\"]\n+trait FnOnce<Args> {\n+    type Output;\n+\n+    fn call_once(self, args: Args) -> Self::Output;\n+}\n+\n+struct Foo;\n+\n+impl Foo {\n+    fn foo(&self) -> usize {}\n+}\n+\n+struct Lazy<T, F = fn() -> T>(F);\n+\n+impl<T, F> Lazy<T, F> {\n+    pub fn new(f: F) -> Lazy<T, F> {}\n+}\n+\n+impl<T, F: FnOnce() -> T> Deref for Lazy<T, F> {\n+    type Target = T;\n+}\n+\n+fn test() {\n+    let lazy1: Lazy<Foo, _> = Lazy::new(|| Foo);\n+    let r1 = lazy1.foo();\n+\n+    fn make_foo_fn() -> Foo {}\n+    let make_foo_fn_ptr: fn() -> Foo = make_foo_fn;\n+    let lazy2: Lazy<Foo, _> = Lazy::new(make_foo_fn_ptr);\n+    let r2 = lazy2.foo();\n+}\n+\"#),\n+        @r###\"\n+65..69 'self': &Self\n+166..170 'self': Self\n+172..176 'args': Args\n+240..244 'self': &Foo\n+255..257 '{}': ()\n+335..336 'f': F\n+355..357 '{}': ()\n+444..690 '{     ...o(); }': ()\n+454..459 'lazy1': Lazy<Foo, fn() -> T>\n+476..485 'Lazy::new': fn new<Foo, fn() -> T>(fn() -> T) -> Lazy<Foo, fn() -> T>\n+476..493 'Lazy::...| Foo)': Lazy<Foo, fn() -> T>\n+486..492 '|| Foo': || -> T\n+489..492 'Foo': Foo\n+503..505 'r1': {unknown}\n+508..513 'lazy1': Lazy<Foo, fn() -> T>\n+508..519 'lazy1.foo()': {unknown}\n+561..576 'make_foo_fn_ptr': fn() -> Foo\n+592..603 'make_foo_fn': fn make_foo_fn() -> Foo\n+613..618 'lazy2': Lazy<Foo, fn() -> T>\n+635..644 'Lazy::new': fn new<Foo, fn() -> T>(fn() -> T) -> Lazy<Foo, fn() -> T>\n+635..661 'Lazy::...n_ptr)': Lazy<Foo, fn() -> T>\n+645..660 'make_foo_fn_ptr': fn() -> Foo\n+671..673 'r2': {unknown}\n+676..681 'lazy2': Lazy<Foo, fn() -> T>\n+676..687 'lazy2.foo()': {unknown}\n+550..552 '{}': ()\n+\"###\n+    );\n+}\n+\n #[test]\n fn closure_1() {\n     assert_snapshot!("}]}