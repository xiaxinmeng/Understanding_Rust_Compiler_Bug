{"sha": "eb74711b5444a10a7a10570a3c206ccee656850e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViNzQ3MTFiNTQ0NGExMGE3YTEwNTcwYTNjMjA2Y2NlZTY1Njg1MGU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-26T10:25:05Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-26T15:06:30Z"}, "message": "Rollup merge of #55298 - estebank:macro-def, r=pnkfelix\n\nPoint at macro definition when no rules expect token\n\nFix #35150.", "tree": {"sha": "4e474a592c81e2a80eebe5d2a5e15b78106530cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4e474a592c81e2a80eebe5d2a5e15b78106530cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb74711b5444a10a7a10570a3c206ccee656850e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlvTLXcACgkQ/vbIBR0O\nATwg7xAAkaLXT6djDgp+U9M2DgsAHz1ElSlMia2SOsE/h6sD5qpzmO3xXDw7U5Ma\nS6npl4Q7bJ1Di5JgrDa1GkADo5UaD9dgfstTjRvv9hn5xkgFgRt2K1qSjTWjkM1J\nLZkca8SWyiHVcQsyMyna1DGpWzB2+1pZd/fxLcO6vp/bVMW4zeDCG7mJ0cCD+g8C\nynE2MC11rdgN2bLgRU0oHfXxMjBVLIFO8QNPO1+iYazIF1QWNmBN7wcJ0IfmHP4i\nTa3lkuVRCuqCtDjnjmda5O5vKjZdPZOpSzBCGPPJ0TAbaYrVFuQTm5GvvZi/38pj\nN0nEj5XMqHR+ni7/wVUj6JgxQ7S3qJkKFaksU8z4Pyl//poF0ixMwvxUyzvBI7xk\nqZrfOE0i31mcqQqLo5Vq9NYcYyoLayE8jMjtOdIEZSdhSp/yfpVQlH4WmF+709jq\nGGZEncZOUrqnURBoeyyas4iruEsXhXsRCBb0tv35WC2tslo7/sqvawvgHzmZKAyX\n2CKuekYYmtzh4V32d5wFVzrU906HqfbYG2YzxiW3f0O1Oc72yc1vnmd6SrQvPYIE\nrt1UV+ydTduGUhgRVsmzL8s4z3QQQdeF6PpwxftVXBlLotRKw9Kxf9l4HwzhLoEU\nx3zxCJ4Q5IoWYAUoiukD0z0Bnmmk/jcFcRr11bxgy7JMKNNyABc=\n=6lRK\n-----END PGP SIGNATURE-----", "payload": "tree 4e474a592c81e2a80eebe5d2a5e15b78106530cf\nparent c6cd57dd860efbe0cb7506dfad93462bcb520d74\nparent 1ab45ec7e366f6f16a6a3d0a58cacb0ee48ef406\nauthor kennytm <kennytm@gmail.com> 1540549505 +0800\ncommitter kennytm <kennytm@gmail.com> 1540566390 +0800\n\nRollup merge of #55298 - estebank:macro-def, r=pnkfelix\n\nPoint at macro definition when no rules expect token\n\nFix #35150.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb74711b5444a10a7a10570a3c206ccee656850e", "html_url": "https://github.com/rust-lang/rust/commit/eb74711b5444a10a7a10570a3c206ccee656850e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb74711b5444a10a7a10570a3c206ccee656850e/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6cd57dd860efbe0cb7506dfad93462bcb520d74", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6cd57dd860efbe0cb7506dfad93462bcb520d74", "html_url": "https://github.com/rust-lang/rust/commit/c6cd57dd860efbe0cb7506dfad93462bcb520d74"}, {"sha": "1ab45ec7e366f6f16a6a3d0a58cacb0ee48ef406", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ab45ec7e366f6f16a6a3d0a58cacb0ee48ef406", "html_url": "https://github.com/rust-lang/rust/commit/1ab45ec7e366f6f16a6a3d0a58cacb0ee48ef406"}], "stats": {"total": 202, "additions": 152, "deletions": 50}, "files": [{"sha": "1701c8da2c5bdc6283b491a97c45d3b516ca046f", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -247,8 +247,13 @@ impl<F> AttrProcMacro for F\n \n /// Represents a thing that maps token trees to Macro Results\n pub trait TTMacroExpander {\n-    fn expand<'cx>(&self, ecx: &'cx mut ExtCtxt, span: Span, input: TokenStream)\n-                   -> Box<dyn MacResult+'cx>;\n+    fn expand<'cx>(\n+        &self,\n+        ecx: &'cx mut ExtCtxt,\n+        span: Span,\n+        input: TokenStream,\n+        def_span: Option<Span>,\n+    ) -> Box<dyn MacResult+'cx>;\n }\n \n pub type MacroExpanderFn =\n@@ -259,8 +264,13 @@ impl<F> TTMacroExpander for F\n     where F: for<'cx> Fn(&'cx mut ExtCtxt, Span, &[tokenstream::TokenTree])\n     -> Box<dyn MacResult+'cx>\n {\n-    fn expand<'cx>(&self, ecx: &'cx mut ExtCtxt, span: Span, input: TokenStream)\n-                   -> Box<dyn MacResult+'cx> {\n+    fn expand<'cx>(\n+        &self,\n+        ecx: &'cx mut ExtCtxt,\n+        span: Span,\n+        input: TokenStream,\n+        _def_span: Option<Span>,\n+    ) -> Box<dyn MacResult+'cx> {\n         struct AvoidInterpolatedIdents;\n \n         impl Folder for AvoidInterpolatedIdents {"}, {"sha": "33b651e1b385403b42f504d7b0ca65c4f255a493", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -764,7 +764,7 @@ impl<'a, 'b> MacroExpander<'a, 'b> {\n                                                                     edition) {\n                     dummy_span\n                 } else {\n-                    kind.make_from(expander.expand(self.cx, span, mac.node.stream()))\n+                    kind.make_from(expander.expand(self.cx, span, mac.node.stream(), None))\n                 }\n             }\n \n@@ -785,7 +785,12 @@ impl<'a, 'b> MacroExpander<'a, 'b> {\n                                                                     edition) {\n                     dummy_span\n                 } else {\n-                    kind.make_from(expander.expand(self.cx, span, mac.node.stream()))\n+                    kind.make_from(expander.expand(\n+                        self.cx,\n+                        span,\n+                        mac.node.stream(),\n+                        def_info.map(|(_, s)| s),\n+                    ))\n                 }\n             }\n "}, {"sha": "543dc478d7b2858289070cf5042d6a2bd52fbe28", "filename": "src/libsyntax/ext/tt/macro_rules.rs", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -79,16 +79,19 @@ struct MacroRulesMacroExpander {\n }\n \n impl TTMacroExpander for MacroRulesMacroExpander {\n-    fn expand<'cx>(&self,\n-                   cx: &'cx mut ExtCtxt,\n-                   sp: Span,\n-                   input: TokenStream)\n-                   -> Box<dyn MacResult+'cx> {\n+    fn expand<'cx>(\n+        &self,\n+        cx: &'cx mut ExtCtxt,\n+        sp: Span,\n+        input: TokenStream,\n+        def_span: Option<Span>,\n+    ) -> Box<dyn MacResult+'cx> {\n         if !self.valid {\n             return DummyResult::any(sp);\n         }\n         generic_extension(cx,\n                           sp,\n+                          def_span,\n                           self.name,\n                           input,\n                           &self.lhses,\n@@ -104,6 +107,7 @@ fn trace_macros_note(cx: &mut ExtCtxt, sp: Span, message: String) {\n /// Given `lhses` and `rhses`, this is the new macro we create\n fn generic_extension<'cx>(cx: &'cx mut ExtCtxt,\n                           sp: Span,\n+                          def_span: Option<Span>,\n                           name: ast::Ident,\n                           arg: TokenStream,\n                           lhses: &[quoted::TokenTree],\n@@ -183,7 +187,14 @@ fn generic_extension<'cx>(cx: &'cx mut ExtCtxt,\n     }\n \n     let best_fail_msg = parse_failure_msg(best_fail_tok.expect(\"ran no matchers\"));\n-    let mut err = cx.struct_span_err(best_fail_spot.substitute_dummy(sp), &best_fail_msg);\n+    let span = best_fail_spot.substitute_dummy(sp);\n+    let mut err = cx.struct_span_err(span, &best_fail_msg);\n+    err.span_label(span, best_fail_msg);\n+    if let Some(sp) = def_span {\n+        if cx.source_map().span_to_filename(sp).is_real() && !sp.is_dummy() {\n+            err.span_label(cx.source_map().def_span(sp), \"when calling this macro\");\n+        }\n+    }\n \n     // Check whether there's a missing comma in this macro call, like `println!(\"{}\" a);`\n     if let Some((arg, comma_span)) = arg.add_comma() {\n@@ -194,7 +205,7 @@ fn generic_extension<'cx>(cx: &'cx mut ExtCtxt,\n             };\n             match TokenTree::parse(cx, lhs_tt, arg.clone()) {\n                 Success(_) => {\n-                    if comma_span == DUMMY_SP {\n+                    if comma_span.is_dummy() {\n                         err.note(\"you might be missing a comma\");\n                     } else {\n                         err.span_suggestion_short_with_applicability("}, {"sha": "27169299c8a69e4e4b883de9c98fc6f7552087f1", "filename": "src/test/run-pass-fulldeps/auxiliary/plugin_args.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -38,7 +38,8 @@ impl TTMacroExpander for Expander {\n     fn expand<'cx>(&self,\n                    ecx: &'cx mut ExtCtxt,\n                    sp: Span,\n-                   _: TokenStream) -> Box<MacResult+'cx> {\n+                   _: TokenStream,\n+                   _: Option<Span>) -> Box<MacResult+'cx> {\n         let args = self.args.iter().map(|i| pprust::meta_list_item_to_string(i))\n             .collect::<Vec<_>>().join(\", \");\n         MacEager::expr(ecx.expr_str(sp, Symbol::intern(&args)))"}, {"sha": "e8f05cbb0ef70a069f26c96db3d6b665c4251368", "filename": "src/test/ui/editions/edition-keywords-2015-2015-parsing.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2015-2015-parsing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2015-2015-parsing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2015-2015-parsing.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -2,13 +2,13 @@ error: no rules expected the token `r#async`\n   --> $DIR/edition-keywords-2015-2015-parsing.rs:22:31\n    |\n LL |     r#async = consumes_async!(r#async); //~ ERROR no rules expected the token `r#async`\n-   |                               ^^^^^^^\n+   |                               ^^^^^^^ no rules expected the token `r#async`\n \n error: no rules expected the token `async`\n   --> $DIR/edition-keywords-2015-2015-parsing.rs:23:35\n    |\n LL |     r#async = consumes_async_raw!(async); //~ ERROR no rules expected the token `async`\n-   |                                   ^^^^^\n+   |                                   ^^^^^ no rules expected the token `async`\n \n error: aborting due to 2 previous errors\n "}, {"sha": "3f5e1137383dda5f8350b7c04fe200ddee4b9a41", "filename": "src/test/ui/editions/edition-keywords-2015-2018-parsing.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2015-2018-parsing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2015-2018-parsing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2015-2018-parsing.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -2,13 +2,13 @@ error: no rules expected the token `r#async`\n   --> $DIR/edition-keywords-2015-2018-parsing.rs:22:31\n    |\n LL |     r#async = consumes_async!(r#async); //~ ERROR no rules expected the token `r#async`\n-   |                               ^^^^^^^\n+   |                               ^^^^^^^ no rules expected the token `r#async`\n \n error: no rules expected the token `async`\n   --> $DIR/edition-keywords-2015-2018-parsing.rs:23:35\n    |\n LL |     r#async = consumes_async_raw!(async); //~ ERROR no rules expected the token `async`\n-   |                                   ^^^^^\n+   |                                   ^^^^^ no rules expected the token `async`\n \n error: aborting due to 2 previous errors\n "}, {"sha": "b6ff60f1492ea99b62eb78a3ec342fcff3a45dc6", "filename": "src/test/ui/editions/edition-keywords-2018-2015-parsing.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2018-2015-parsing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2018-2015-parsing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2018-2015-parsing.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -14,13 +14,13 @@ error: no rules expected the token `r#async`\n   --> $DIR/edition-keywords-2018-2015-parsing.rs:22:31\n    |\n LL |     r#async = consumes_async!(r#async); //~ ERROR no rules expected the token `r#async`\n-   |                               ^^^^^^^\n+   |                               ^^^^^^^ no rules expected the token `r#async`\n \n error: no rules expected the token `async`\n   --> $DIR/edition-keywords-2018-2015-parsing.rs:23:35\n    |\n LL |     r#async = consumes_async_raw!(async); //~ ERROR no rules expected the token `async`\n-   |                                   ^^^^^\n+   |                                   ^^^^^ no rules expected the token `async`\n \n error: expected one of `move`, `|`, or `||`, found `<eof>`\n   --> <::edition_kw_macro_2015::passes_ident macros>:1:22"}, {"sha": "ffe666a7e6442875ba5f491426a13ed0ea1dca3e", "filename": "src/test/ui/editions/edition-keywords-2018-2018-parsing.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2018-2018-parsing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2018-2018-parsing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Feditions%2Fedition-keywords-2018-2018-parsing.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -14,13 +14,13 @@ error: no rules expected the token `r#async`\n   --> $DIR/edition-keywords-2018-2018-parsing.rs:22:31\n    |\n LL |     r#async = consumes_async!(r#async); //~ ERROR no rules expected the token `r#async`\n-   |                               ^^^^^^^\n+   |                               ^^^^^^^ no rules expected the token `r#async`\n \n error: no rules expected the token `async`\n   --> $DIR/edition-keywords-2018-2018-parsing.rs:23:35\n    |\n LL |     r#async = consumes_async_raw!(async); //~ ERROR no rules expected the token `async`\n-   |                                   ^^^^^\n+   |                                   ^^^^^ no rules expected the token `async`\n \n error: expected one of `move`, `|`, or `||`, found `<eof>`\n   --> <::edition_kw_macro_2018::passes_ident macros>:1:22"}, {"sha": "de826102081e77ef10fd0fcc3b3a18669a6f5fa7", "filename": "src/test/ui/empty/empty-comment.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fempty%2Fempty-comment.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fempty%2Fempty-comment.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fempty%2Fempty-comment.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -1,8 +1,11 @@\n error: unexpected end of macro invocation\n   --> $DIR/empty-comment.rs:20:5\n    |\n+LL | macro_rules! one_arg_macro {\n+   | -------------------------- when calling this macro\n+...\n LL |     one_arg_macro!(/**/); //~ ERROR unexpected end\n-   |     ^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^ unexpected end of macro invocation\n \n error: aborting due to previous error\n "}, {"sha": "4a4aec5b6ac570e24c1d6c7a2f93f5caed26dbbc", "filename": "src/test/ui/fail-simple.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Ffail-simple.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Ffail-simple.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffail-simple.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -2,7 +2,7 @@ error: no rules expected the token `@`\n   --> $DIR/fail-simple.rs:12:12\n    |\n LL |     panic!(@); //~ ERROR no rules expected the token `@`\n-   |            ^\n+   |            ^ no rules expected the token `@`\n \n error: aborting due to previous error\n "}, {"sha": "96fb374b58c6c7a4e2b918e66a3097c279845b0f", "filename": "src/test/ui/issues/issue-7970a.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fissues%2Fissue-7970a.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fissues%2Fissue-7970a.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-7970a.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -1,8 +1,11 @@\n error: unexpected end of macro invocation\n   --> $DIR/issue-7970a.rs:16:5\n    |\n+LL | macro_rules! one_arg_macro {\n+   | -------------------------- when calling this macro\n+...\n LL |     one_arg_macro!();\n-   |     ^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^ unexpected end of macro invocation\n \n error: aborting due to previous error\n "}, {"sha": "7705ba3b11ed58f9adc0905224f3018f11ed7d6a", "filename": "src/test/ui/macros/macro-at-most-once-rep-2018-feature-gate.stderr", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018-feature-gate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018-feature-gate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018-feature-gate.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -51,20 +51,29 @@ LL |     ($(a)?*) => {}\n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018-feature-gate.rs:41:11\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a?); //~ ERROR no rules expected the token `?`\n-   |           ^\n+   |           ^ no rules expected the token `?`\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018-feature-gate.rs:42:11\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a?a); //~ ERROR no rules expected the token `?`\n-   |           ^\n+   |           ^ no rules expected the token `?`\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018-feature-gate.rs:43:11\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a?a?a); //~ ERROR no rules expected the token `?`\n-   |           ^\n+   |           ^ no rules expected the token `?`\n \n error: aborting due to 10 previous errors\n "}, {"sha": "25dd66b81f567f0e86494d08d459e730bcadbf29", "filename": "src/test/ui/macros/macro-at-most-once-rep-2018.stderr", "status": "modified", "additions": 44, "deletions": 11, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -7,68 +7,101 @@ LL |     ($(a),?) => {} //~ERROR the `?` macro repetition operator\n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018.rs:36:11\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a?); //~ ERROR no rules expected the token `?`\n-   |           ^\n+   |           ^ no rules expected the token `?`\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018.rs:37:11\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a?a); //~ ERROR no rules expected the token `?`\n-   |           ^\n+   |           ^ no rules expected the token `?`\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018.rs:38:11\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a?a?a); //~ ERROR no rules expected the token `?`\n-   |           ^\n+   |           ^ no rules expected the token `?`\n \n error: unexpected end of macro invocation\n   --> $DIR/macro-at-most-once-rep-2018.rs:40:5\n    |\n+LL | macro_rules! barplus {\n+   | -------------------- when calling this macro\n+...\n LL |     barplus!(); //~ERROR unexpected end of macro invocation\n-   |     ^^^^^^^^^^^\n+   |     ^^^^^^^^^^^ unexpected end of macro invocation\n \n error: unexpected end of macro invocation\n   --> $DIR/macro-at-most-once-rep-2018.rs:41:14\n    |\n+LL | macro_rules! barplus {\n+   | -------------------- when calling this macro\n+...\n LL |     barplus!(a); //~ERROR unexpected end of macro invocation\n-   |              ^\n+   |              ^ unexpected end of macro invocation\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018.rs:42:15\n    |\n+LL | macro_rules! barplus {\n+   | -------------------- when calling this macro\n+...\n LL |     barplus!(a?); //~ ERROR no rules expected the token `?`\n-   |               ^\n+   |               ^ no rules expected the token `?`\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018.rs:43:15\n    |\n+LL | macro_rules! barplus {\n+   | -------------------- when calling this macro\n+...\n LL |     barplus!(a?a); //~ ERROR no rules expected the token `?`\n-   |               ^\n+   |               ^ no rules expected the token `?`\n \n error: unexpected end of macro invocation\n   --> $DIR/macro-at-most-once-rep-2018.rs:47:5\n    |\n+LL | macro_rules! barstar {\n+   | -------------------- when calling this macro\n+...\n LL |     barstar!(); //~ERROR unexpected end of macro invocation\n-   |     ^^^^^^^^^^^\n+   |     ^^^^^^^^^^^ unexpected end of macro invocation\n \n error: unexpected end of macro invocation\n   --> $DIR/macro-at-most-once-rep-2018.rs:48:14\n    |\n+LL | macro_rules! barstar {\n+   | -------------------- when calling this macro\n+...\n LL |     barstar!(a); //~ERROR unexpected end of macro invocation\n-   |              ^\n+   |              ^ unexpected end of macro invocation\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018.rs:49:15\n    |\n+LL | macro_rules! barstar {\n+   | -------------------- when calling this macro\n+...\n LL |     barstar!(a?); //~ ERROR no rules expected the token `?`\n-   |               ^\n+   |               ^ no rules expected the token `?`\n \n error: no rules expected the token `?`\n   --> $DIR/macro-at-most-once-rep-2018.rs:50:15\n    |\n+LL | macro_rules! barstar {\n+   | -------------------- when calling this macro\n+...\n LL |     barstar!(a?a); //~ ERROR no rules expected the token `?`\n-   |               ^\n+   |               ^ no rules expected the token `?`\n \n error: aborting due to 12 previous errors\n "}, {"sha": "d526023d441b101cba73aa38247059532a8bc673", "filename": "src/test/ui/macros/macro-non-lifetime.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmacro-non-lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmacro-non-lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-non-lifetime.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -1,8 +1,11 @@\n error: no rules expected the token `a`\n   --> $DIR/macro-non-lifetime.rs:18:8\n    |\n+LL | macro_rules! m { ($x:lifetime) => { } }\n+   | -------------- when calling this macro\n+...\n LL |     m!(a);\n-   |        ^\n+   |        ^ no rules expected the token `a`\n \n error: aborting due to previous error\n "}, {"sha": "1d6af44bd08a5237bda698064c91c29173b41121", "filename": "src/test/ui/macros/missing-comma.stderr", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmissing-comma.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fmissing-comma.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmissing-comma.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -7,32 +7,44 @@ LL |     println!(\"{}\" a);\n error: no rules expected the token `b`\n   --> $DIR/missing-comma.rs:22:12\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a b);\n-   |           -^\n+   |           -^ no rules expected the token `b`\n    |           |\n    |           help: missing comma here\n \n error: no rules expected the token `e`\n   --> $DIR/missing-comma.rs:24:21\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a, b, c, d e);\n-   |                    -^\n+   |                    -^ no rules expected the token `e`\n    |                    |\n    |                    help: missing comma here\n \n error: no rules expected the token `d`\n   --> $DIR/missing-comma.rs:26:18\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a, b, c d, e);\n-   |                 -^\n+   |                 -^ no rules expected the token `d`\n    |                 |\n    |                 help: missing comma here\n \n error: no rules expected the token `d`\n   --> $DIR/missing-comma.rs:28:18\n    |\n+LL | macro_rules! foo {\n+   | ---------------- when calling this macro\n+...\n LL |     foo!(a, b, c d e);\n-   |                  ^\n+   |                  ^ no rules expected the token `d`\n \n error: aborting due to 5 previous errors\n "}, {"sha": "23853978d371bcfe83083e267768aa30fe5efeff", "filename": "src/test/ui/macros/nonterminal-matching.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fnonterminal-matching.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Fnonterminal-matching.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fnonterminal-matching.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -2,7 +2,7 @@ error: no rules expected the token `enum E { }`\n   --> $DIR/nonterminal-matching.rs:29:10\n    |\n LL |     n!(a $nt_item b); //~ ERROR no rules expected the token `enum E { }`\n-   |          ^^^^^^^^\n+   |          ^^^^^^^^ no rules expected the token `enum E { }`\n ...\n LL | complex_nonterminal!(enum E {});\n    | -------------------------------- in this macro invocation"}, {"sha": "853eb5847c0cdfe543a68ea29bca50e7803fa598", "filename": "src/test/ui/macros/trace_faulty_macros.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Ftrace_faulty_macros.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fmacros%2Ftrace_faulty_macros.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Ftrace_faulty_macros.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -1,8 +1,11 @@\n error: no rules expected the token `bcd`\n   --> $DIR/trace_faulty_macros.rs:17:26\n    |\n+LL | macro_rules! my_faulty_macro {\n+   | ---------------------------- when calling this macro\n+LL |     () => {\n LL |         my_faulty_macro!(bcd); //~ ERROR no rules\n-   |                          ^^^\n+   |                          ^^^ no rules expected the token `bcd`\n ...\n LL |     my_faulty_macro!();\n    |     ------------------- in this macro invocation"}, {"sha": "1e765dcde4f68b52a27572bf30ad992ef30dba65", "filename": "src/test/ui/parser/macro/macro-doc-comments-1.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fmacro-doc-comments-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fmacro-doc-comments-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fmacro-doc-comments-1.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -1,8 +1,11 @@\n error: no rules expected the token `!`\n   --> $DIR/macro-doc-comments-1.rs:16:5\n    |\n+LL | macro_rules! outer {\n+   | ------------------ when calling this macro\n+...\n LL |     //! Inner\n-   |     ^^^^^^^^^\n+   |     ^^^^^^^^^ no rules expected the token `!`\n \n error: aborting due to previous error\n "}, {"sha": "0ab8a3cafb55f63e1caeb07b80b6eae065fa87a4", "filename": "src/test/ui/parser/macro/macro-doc-comments-2.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fmacro-doc-comments-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fmacro-doc-comments-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fmacro-doc-comments-2.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -1,8 +1,11 @@\n error: no rules expected the token `[`\n   --> $DIR/macro-doc-comments-2.rs:16:5\n    |\n+LL | macro_rules! inner {\n+   | ------------------ when calling this macro\n+...\n LL |     /// Outer\n-   |     ^\n+   |     ^ no rules expected the token `[`\n \n error: aborting due to previous error\n "}, {"sha": "e148c48ed13142ce234ab5b8bce47fb142163d45", "filename": "src/test/ui/underscore-ident-matcher.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Funderscore-ident-matcher.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Funderscore-ident-matcher.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funderscore-ident-matcher.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -1,8 +1,11 @@\n error: no rules expected the token `_`\n   --> $DIR/underscore-ident-matcher.rs:18:19\n    |\n+LL | macro_rules! identity {\n+   | --------------------- when calling this macro\n+...\n LL |     let identity!(_) = 10; //~ ERROR no rules expected the token `_`\n-   |                   ^\n+   |                   ^ no rules expected the token `_`\n \n error: aborting due to previous error\n "}, {"sha": "856d85ef5cdaac6deb269675d2c86b45fa88f46d", "filename": "src/test/ui/vec/vec-macro-with-comma-only.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fvec%2Fvec-macro-with-comma-only.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb74711b5444a10a7a10570a3c206ccee656850e/src%2Ftest%2Fui%2Fvec%2Fvec-macro-with-comma-only.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fvec%2Fvec-macro-with-comma-only.stderr?ref=eb74711b5444a10a7a10570a3c206ccee656850e", "patch": "@@ -2,7 +2,7 @@ error: no rules expected the token `,`\n   --> $DIR/vec-macro-with-comma-only.rs:12:10\n    |\n LL |     vec![,]; //~ ERROR no rules expected the token `,`\n-   |          ^\n+   |          ^ no rules expected the token `,`\n \n error: aborting due to previous error\n "}]}