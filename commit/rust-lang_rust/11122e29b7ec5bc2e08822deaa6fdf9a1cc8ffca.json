{"sha": "11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExMTIyZTI5YjdlYzViYzJlMDg4MjJkZWFhNmZkZjlhMWNjOGZmY2E=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-28T18:06:08Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-28T18:07:47Z"}, "message": "completion for enum variants", "tree": {"sha": "741ad2441092616b8bd4e30a865eae9e1ea6d5c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/741ad2441092616b8bd4e30a865eae9e1ea6d5c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "html_url": "https://github.com/rust-lang/rust/commit/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a860dba38225a4d3e122eaf49c926479826becf", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a860dba38225a4d3e122eaf49c926479826becf", "html_url": "https://github.com/rust-lang/rust/commit/1a860dba38225a4d3e122eaf49c926479826becf"}], "stats": {"total": 45, "additions": 36, "deletions": 9}, "files": [{"sha": "c73a083a43cef20e573298297a58ddaa07e66b02", "filename": "crates/ra_analysis/src/completion/complete_path.rs", "status": "modified", "additions": 30, "deletions": 9, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_path.rs?ref=11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "patch": "@@ -1,6 +1,6 @@\n use crate::{\n     Cancelable,\n-    completion::{CompletionItem, Completions, CompletionKind, CompletionContext},\n+    completion::{CompletionItem, CompletionItemKind, Completions, CompletionKind, CompletionContext},\n };\n \n pub(super) fn complete_path(acc: &mut Completions, ctx: &CompletionContext) -> Cancelable<()> {\n@@ -12,16 +12,25 @@ pub(super) fn complete_path(acc: &mut Completions, ctx: &CompletionContext) -> C\n         Some(it) => it,\n         None => return Ok(()),\n     };\n-    let target_module = match def_id.resolve(ctx.db)? {\n-        hir::Def::Module(it) => it,\n+    match def_id.resolve(ctx.db)? {\n+        hir::Def::Module(module) => {\n+            let module_scope = module.scope(ctx.db)?;\n+            module_scope.entries().for_each(|(name, res)| {\n+                CompletionItem::new(CompletionKind::Reference, name.to_string())\n+                    .from_resolution(ctx.db, res)\n+                    .add_to(acc)\n+            });\n+        }\n+        hir::Def::Enum(e) => e\n+            .variants(ctx.db)?\n+            .into_iter()\n+            .for_each(|(name, _variant)| {\n+                CompletionItem::new(CompletionKind::Reference, name.to_string())\n+                    .kind(CompletionItemKind::EnumVariant)\n+                    .add_to(acc)\n+            }),\n         _ => return Ok(()),\n     };\n-    let module_scope = target_module.scope(ctx.db)?;\n-    module_scope.entries().for_each(|(name, res)| {\n-        CompletionItem::new(CompletionKind::Reference, name.to_string())\n-            .from_resolution(ctx.db, res)\n-            .add_to(acc)\n-    });\n     Ok(())\n }\n \n@@ -92,4 +101,16 @@ mod tests {\n             \"Spam\",\n         );\n     }\n+\n+    #[test]\n+    fn completes_enum_variant() {\n+        check_reference_completion(\n+            \"\n+            //- /lib.rs\n+            enum E { Foo, Bar(i32) }\n+            fn foo() { let _ = E::<|> }\n+            \",\n+            \"Foo;Bar\",\n+        );\n+    }\n }"}, {"sha": "1d294c553aa5f2ea36bf0b51c12050590f1b13b3", "filename": "crates/ra_analysis/src/completion/completion_item.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcompletion_item.rs?ref=11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "patch": "@@ -29,6 +29,7 @@ pub enum CompletionItemKind {\n     Function,\n     Struct,\n     Enum,\n+    EnumVariant,\n     Binding,\n     Field,\n }"}, {"sha": "6cdaa1888ca7d5b5ac6adc0ef0f34ba391151b44", "filename": "crates/ra_hir/src/adt.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_hir%2Fsrc%2Fadt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_hir%2Fsrc%2Fadt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fadt.rs?ref=11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "patch": "@@ -73,6 +73,10 @@ impl Enum {\n     pub fn name(&self, db: &impl HirDatabase) -> Cancelable<Option<SmolStr>> {\n         Ok(db.enum_data(self.def_id)?.name.clone())\n     }\n+\n+    pub fn variants(&self, db: &impl HirDatabase) -> Cancelable<Vec<(SmolStr, Arc<VariantData>)>> {\n+        Ok(db.enum_data(self.def_id)?.variants.clone())\n+    }\n }\n \n #[derive(Debug, Clone, PartialEq, Eq)]"}, {"sha": "0d6e6272732fedecf104d1e377db2974eedf085d", "filename": "crates/ra_lsp_server/src/conv.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs?ref=11122e29b7ec5bc2e08822deaa6fdf9a1cc8ffca", "patch": "@@ -57,6 +57,7 @@ impl Conv for CompletionItemKind {\n             CompletionItemKind::Function => Function,\n             CompletionItemKind::Struct => Struct,\n             CompletionItemKind::Enum => Enum,\n+            CompletionItemKind::EnumVariant => EnumMember,\n             CompletionItemKind::Binding => Variable,\n             CompletionItemKind::Field => Field,\n         }"}]}