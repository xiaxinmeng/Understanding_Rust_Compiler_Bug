{"sha": "3296d5ca7b41154359eaec76d9f77310816c9913", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyOTZkNWNhN2I0MTE1NDM1OWVhZWM3NmQ5Zjc3MzEwODE2Yzk5MTM=", "commit": {"author": {"name": "Arlo Siemsen", "email": "arsiem@microsoft.com", "date": "2020-10-13T15:41:06Z"}, "committer": {"name": "Arlo Siemsen", "email": "arsiem@microsoft.com", "date": "2020-10-14T22:09:51Z"}, "message": "Add support for SHA256 source file hashing for LLVM 11+.", "tree": {"sha": "705c0b0854d1a9526e74b5c6c3bf566be3719677", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/705c0b0854d1a9526e74b5c6c3bf566be3719677"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3296d5ca7b41154359eaec76d9f77310816c9913", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3296d5ca7b41154359eaec76d9f77310816c9913", "html_url": "https://github.com/rust-lang/rust/commit/3296d5ca7b41154359eaec76d9f77310816c9913", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3296d5ca7b41154359eaec76d9f77310816c9913/comments", "author": {"login": "arlosi", "id": 704597, "node_id": "MDQ6VXNlcjcwNDU5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/704597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arlosi", "html_url": "https://github.com/arlosi", "followers_url": "https://api.github.com/users/arlosi/followers", "following_url": "https://api.github.com/users/arlosi/following{/other_user}", "gists_url": "https://api.github.com/users/arlosi/gists{/gist_id}", "starred_url": "https://api.github.com/users/arlosi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arlosi/subscriptions", "organizations_url": "https://api.github.com/users/arlosi/orgs", "repos_url": "https://api.github.com/users/arlosi/repos", "events_url": "https://api.github.com/users/arlosi/events{/privacy}", "received_events_url": "https://api.github.com/users/arlosi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arlosi", "id": 704597, "node_id": "MDQ6VXNlcjcwNDU5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/704597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arlosi", "html_url": "https://github.com/arlosi", "followers_url": "https://api.github.com/users/arlosi/followers", "following_url": "https://api.github.com/users/arlosi/following{/other_user}", "gists_url": "https://api.github.com/users/arlosi/gists{/gist_id}", "starred_url": "https://api.github.com/users/arlosi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arlosi/subscriptions", "organizations_url": "https://api.github.com/users/arlosi/orgs", "repos_url": "https://api.github.com/users/arlosi/repos", "events_url": "https://api.github.com/users/arlosi/events{/privacy}", "received_events_url": "https://api.github.com/users/arlosi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5565241f65cf402c3dbcb55dd492f172c473d4ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/5565241f65cf402c3dbcb55dd492f172c473d4ce", "html_url": "https://github.com/rust-lang/rust/commit/5565241f65cf402c3dbcb55dd492f172c473d4ce"}], "stats": {"total": 69, "additions": 59, "deletions": 10}, "files": [{"sha": "faf3c2bca7999b06d326de7ab5fd2d9c0a11b822", "filename": "Cargo.lock", "status": "modified", "additions": 30, "deletions": 5, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -1883,6 +1883,17 @@ dependencies = [\n  \"opaque-debug 0.2.3\",\n ]\n \n+[[package]]\n+name = \"md-5\"\n+version = \"0.9.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"7b5a279bb9607f9f53c22d496eade00d138d1bdcccd07d74650387cf94942a15\"\n+dependencies = [\n+ \"block-buffer 0.9.0\",\n+ \"digest 0.9.0\",\n+ \"opaque-debug 0.3.0\",\n+]\n+\n [[package]]\n name = \"mdbook\"\n version = \"0.4.3\"\n@@ -2411,7 +2422,7 @@ checksum = \"54be6e404f5317079812fc8f9f5279de376d8856929e21c184ecf6bbd692a11d\"\n dependencies = [\n  \"maplit\",\n  \"pest\",\n- \"sha-1\",\n+ \"sha-1 0.8.2\",\n ]\n \n [[package]]\n@@ -3225,14 +3236,14 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"1c267f15c3cfc82a8a441d2bf86bcccf299d1eb625822468e3d8ee6f7c5a1c89\"\n dependencies = [\n  \"cfg-if 0.1.10\",\n- \"md-5\",\n+ \"md-5 0.8.0\",\n  \"rustc-ap-rustc_arena\",\n  \"rustc-ap-rustc_data_structures\",\n  \"rustc-ap-rustc_index\",\n  \"rustc-ap-rustc_macros\",\n  \"rustc-ap-rustc_serialize\",\n  \"scoped-tls\",\n- \"sha-1\",\n+ \"sha-1 0.8.2\",\n  \"tracing\",\n  \"unicode-width\",\n ]\n@@ -4069,14 +4080,15 @@ name = \"rustc_span\"\n version = \"0.0.0\"\n dependencies = [\n  \"cfg-if 0.1.10\",\n- \"md-5\",\n+ \"md-5 0.9.1\",\n  \"rustc_arena\",\n  \"rustc_data_structures\",\n  \"rustc_index\",\n  \"rustc_macros\",\n  \"rustc_serialize\",\n  \"scoped-tls\",\n- \"sha-1\",\n+ \"sha-1 0.9.1\",\n+ \"sha2\",\n  \"tracing\",\n  \"unicode-width\",\n ]\n@@ -4422,6 +4434,19 @@ dependencies = [\n  \"opaque-debug 0.2.3\",\n ]\n \n+[[package]]\n+name = \"sha-1\"\n+version = \"0.9.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"170a36ea86c864a3f16dd2687712dd6646f7019f301e57537c7f4dc9f5916770\"\n+dependencies = [\n+ \"block-buffer 0.9.0\",\n+ \"cfg-if 0.1.10\",\n+ \"cpuid-bool\",\n+ \"digest 0.9.0\",\n+ \"opaque-debug 0.3.0\",\n+]\n+\n [[package]]\n name = \"sha2\"\n version = \"0.9.1\""}, {"sha": "caf941f8c45e57312560ff3cfbc1e4111a097b3d", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -805,6 +805,7 @@ fn file_metadata_raw(\n                     let kind = match hash.kind {\n                         rustc_span::SourceFileHashAlgorithm::Md5 => llvm::ChecksumKind::MD5,\n                         rustc_span::SourceFileHashAlgorithm::Sha1 => llvm::ChecksumKind::SHA1,\n+                        rustc_span::SourceFileHashAlgorithm::Sha256 => llvm::ChecksumKind::SHA256,\n                     };\n                     (kind, hex_encode(hash.hash_bytes()))\n                 }"}, {"sha": "d3663ced24bef57ee7ce508e312e2fb9cd60093d", "filename": "compiler/rustc_codegen_llvm/src/llvm/ffi.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -557,6 +557,7 @@ pub enum ChecksumKind {\n     None,\n     MD5,\n     SHA1,\n+    SHA256,\n }\n \n extern \"C\" {"}, {"sha": "267ff5fa4ccab1c56355fb8f951b64f100364dbd", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -648,6 +648,7 @@ enum class LLVMRustChecksumKind {\n   None,\n   MD5,\n   SHA1,\n+  SHA256,\n };\n \n static Optional<DIFile::ChecksumKind> fromRust(LLVMRustChecksumKind Kind) {\n@@ -658,6 +659,10 @@ static Optional<DIFile::ChecksumKind> fromRust(LLVMRustChecksumKind Kind) {\n     return DIFile::ChecksumKind::CSK_MD5;\n   case LLVMRustChecksumKind::SHA1:\n     return DIFile::ChecksumKind::CSK_SHA1;\n+#if (LLVM_VERSION_MAJOR >= 11)\n+  case LLVMRustChecksumKind::SHA256:\n+    return DIFile::ChecksumKind::CSK_SHA256;\n+#endif\n   default:\n     report_fatal_error(\"bad ChecksumKind.\");\n   }"}, {"sha": "cd75c3672e3944988b11268dc2badb9766502109", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -1068,7 +1068,7 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n     span_free_formats: bool = (false, parse_bool, [UNTRACKED],\n         \"exclude spans when debug-printing compiler state (default: no)\"),\n     src_hash_algorithm: Option<SourceFileHashAlgorithm> = (None, parse_src_file_hash, [TRACKED],\n-        \"hash algorithm of source files in debug info (`md5`, or `sha1`)\"),\n+        \"hash algorithm of source files in debug info (`md5`, `sha1`, or `sha256`)\"),\n     strip: Strip = (Strip::None, parse_strip, [UNTRACKED],\n         \"tell the linker which information to strip (`none` (default), `debuginfo` or `symbols`)\"),\n     symbol_mangling_version: SymbolManglingVersion = (SymbolManglingVersion::Legacy,"}, {"sha": "08645990c4870dec32420bc50a17ce56905104d8", "filename": "compiler/rustc_span/Cargo.toml", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_span%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_span%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2FCargo.toml?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -17,5 +17,6 @@ scoped-tls = \"1.0\"\n unicode-width = \"0.1.4\"\n cfg-if = \"0.1.2\"\n tracing = \"0.1\"\n-sha-1 = \"0.8\"\n-md-5 = \"0.8\"\n+sha-1 = \"0.9\"\n+sha2 = \"0.9\"\n+md-5 = \"0.9\""}, {"sha": "ffa3d77ecb61fc0366845882b73018697283e49e", "filename": "compiler/rustc_span/src/lib.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_span%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/compiler%2Frustc_span%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Flib.rs?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -59,6 +59,7 @@ use std::str::FromStr;\n use md5::Md5;\n use sha1::Digest;\n use sha1::Sha1;\n+use sha2::Sha256;\n \n use tracing::debug;\n \n@@ -1040,6 +1041,7 @@ pub struct OffsetOverflowError;\n pub enum SourceFileHashAlgorithm {\n     Md5,\n     Sha1,\n+    Sha256,\n }\n \n impl FromStr for SourceFileHashAlgorithm {\n@@ -1049,6 +1051,7 @@ impl FromStr for SourceFileHashAlgorithm {\n         match s {\n             \"md5\" => Ok(SourceFileHashAlgorithm::Md5),\n             \"sha1\" => Ok(SourceFileHashAlgorithm::Sha1),\n+            \"sha256\" => Ok(SourceFileHashAlgorithm::Sha256),\n             _ => Err(()),\n         }\n     }\n@@ -1061,7 +1064,7 @@ rustc_data_structures::impl_stable_hash_via_hash!(SourceFileHashAlgorithm);\n #[derive(HashStable_Generic, Encodable, Decodable)]\n pub struct SourceFileHash {\n     pub kind: SourceFileHashAlgorithm,\n-    value: [u8; 20],\n+    value: [u8; 32],\n }\n \n impl SourceFileHash {\n@@ -1077,6 +1080,9 @@ impl SourceFileHash {\n             SourceFileHashAlgorithm::Sha1 => {\n                 value.copy_from_slice(&Sha1::digest(data));\n             }\n+            SourceFileHashAlgorithm::Sha256 => {\n+                value.copy_from_slice(&Sha256::digest(data));\n+            }\n         }\n         hash\n     }\n@@ -1096,6 +1102,7 @@ impl SourceFileHash {\n         match self.kind {\n             SourceFileHashAlgorithm::Md5 => 16,\n             SourceFileHashAlgorithm::Sha1 => 20,\n+            SourceFileHashAlgorithm::Sha256 => 32,\n         }\n     }\n }"}, {"sha": "ff776741b2122a32d016ba0d93569f488330766d", "filename": "src/doc/unstable-book/src/compiler-flags/src-hash-algorithm.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -6,6 +6,6 @@ The tracking issue for this feature is: [#70401](https://github.com/rust-lang/ru\n \n The `-Z src-hash-algorithm` compiler flag controls which algorithm is used when hashing each source file. The hash is stored in the debug info and can be used by a debugger to verify the source code matches the executable.\n \n-Supported hash algorithms are: `md5`, and `sha1`. Note that not all hash algorithms are supported by all debug info formats.\n+Supported hash algorithms are: `md5`, `sha1`, and `sha256`. Note that not all hash algorithms are supported by all debug info formats.\n \n By default, the compiler chooses the hash algorithm based on the target specification."}, {"sha": "eaa9eafa1e87226c982959e649857ecc9a2a0c07", "filename": "src/test/codegen/src-hash-algorithm/src-hash-algorithm-sha256.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha256.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha256.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha256.rs?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -0,0 +1,7 @@\n+// compile-flags: -g -Z src-hash-algorithm=sha256\n+// min-llvm-version: 11.0\n+\n+#![crate_type = \"lib\"]\n+\n+pub fn test() {}\n+// CHECK: checksumkind: CSK_SHA256"}, {"sha": "057b0884e287adb6bfc64360acc0a51314209dc8", "filename": "src/tools/tidy/src/deps.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3296d5ca7b41154359eaec76d9f77310816c9913/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3296d5ca7b41154359eaec76d9f77310816c9913/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs?ref=3296d5ca7b41154359eaec76d9f77310816c9913", "patch": "@@ -80,6 +80,7 @@ const PERMITTED_DEPENDENCIES: &[&str] = &[\n     \"cloudabi\",\n     \"cmake\",\n     \"compiler_builtins\",\n+    \"cpuid-bool\",\n     \"crc32fast\",\n     \"crossbeam-deque\",\n     \"crossbeam-epoch\",\n@@ -160,6 +161,7 @@ const PERMITTED_DEPENDENCIES: &[&str] = &[\n     \"serde\",\n     \"serde_derive\",\n     \"sha-1\",\n+    \"sha2\",\n     \"smallvec\",\n     \"snap\",\n     \"stable_deref_trait\","}]}