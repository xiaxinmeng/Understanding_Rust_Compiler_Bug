{"sha": "2205c48ee4949521d1a1a416afdb7ad7777b4a65", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyMDVjNDhlZTQ5NDk1MjFkMWExYTQxNmFmZGI3YWQ3Nzc3YjRhNjU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-28T21:57:08Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-28T22:50:34Z"}, "message": "install: Explicitly delete the manifest during uninstall. Misc cleanup", "tree": {"sha": "44d5b46c5c308805ef168e20d6877cc9510a894f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/44d5b46c5c308805ef168e20d6877cc9510a894f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2205c48ee4949521d1a1a416afdb7ad7777b4a65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2205c48ee4949521d1a1a416afdb7ad7777b4a65", "html_url": "https://github.com/rust-lang/rust/commit/2205c48ee4949521d1a1a416afdb7ad7777b4a65", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2205c48ee4949521d1a1a416afdb7ad7777b4a65/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "01d823b4de9ecf7bf37e0e6433615592ac9b5565", "url": "https://api.github.com/repos/rust-lang/rust/commits/01d823b4de9ecf7bf37e0e6433615592ac9b5565", "html_url": "https://github.com/rust-lang/rust/commit/01d823b4de9ecf7bf37e0e6433615592ac9b5565"}], "stats": {"total": 36, "additions": 20, "deletions": 16}, "files": [{"sha": "852347d3d18b002542e1b1ba313a1dd6f386ba64", "filename": "src/etc/install.sh", "status": "modified", "additions": 20, "deletions": 16, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/2205c48ee4949521d1a1a416afdb7ad7777b4a65/src%2Fetc%2Finstall.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2205c48ee4949521d1a1a416afdb7ad7777b4a65/src%2Fetc%2Finstall.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Finstall.sh?ref=2205c48ee4949521d1a1a416afdb7ad7777b4a65", "patch": "@@ -234,16 +234,16 @@ validate_opt\n # Sanity check: can we run the binaries?\n if [ -z \"${CFG_DISABLE_VERIFY}\" ]\n then\n-\t# Don't do this if uninstalling. Failure here won't help in any way.\n-\tif [ -z \"${CFG_UNINSTALL}\" ]\n-\tthen\n-\t\tmsg \"verifying platform can run binaries\"\n-\t\t\"${CFG_SRC_DIR}/bin/rustc\" --version > /dev/null\n-\t\tif [ $? -ne 0 ]\n-\t\tthen\n-\t\t\terr \"can't execute rustc binary on this platform\"\n-\t\tfi\n-\tfi\n+    # Don't do this if uninstalling. Failure here won't help in any way.\n+    if [ -z \"${CFG_UNINSTALL}\" ]\n+    then\n+        msg \"verifying platform can run binaries\"\n+        \"${CFG_SRC_DIR}/bin/rustc\" --version > /dev/null\n+        if [ $? -ne 0 ]\n+        then\n+            err \"can't execute rustc binary on this platform\"\n+        fi\n+    fi\n fi\n \n # Sanity check: can we can write to the destination?\n@@ -255,7 +255,7 @@ if [ $? -ne 0 ]\n then\n     err \"can't write to destination. consider \\`sudo\\`.\"\n fi\n-rm \"${CFG_LIBDIR}/rust-install-probe\"\n+rm -f \"${CFG_LIBDIR}/rust-install-probe\"\n need_ok \"failed to remove install probe\"\n \n # Sanity check: don't install to the directory containing the installer.\n@@ -281,7 +281,7 @@ then\n         msg \"removing $p\"\n         if [ -f \"$p\" ]\n         then\n-            rm \"$p\"\n+            rm -f \"$p\"\n             if [ $? -ne 0 ]\n             then\n                 warn \"failed to remove $p\"\n@@ -291,12 +291,16 @@ then\n         fi\n     done < \"${INSTALLED_MANIFEST}\"\n \n-\t# TODO: Remove the manifest.\n-\t# If we fail to remove rustlib below, then the installed manifest will\n-\t# still be full; the installed manifest needs to be empty before install.\n+    # If we fail to remove rustlib below, then the installed manifest will\n+    # still be full; the installed manifest needs to be empty before install.\n+    msg \"removing ${CFG_LIBDIR}/rustlib/manifest\"\n+    rm -f \"${CFG_LIBDIR}/rustlib/manifest\"\n+    # For the above reason, this is a hard error\n+    need_ok \"failed to remove installed manifest\"\n \n     # Remove 'rustlib' directory\n-    rm -r \"${CFG_LIBDIR}/rustlib\"\n+    msg \"removing ${CFG_LIBDIR}/rustlib\"\n+    rm -Rf \"${CFG_LIBDIR}/rustlib\"\n     if [ $? -ne 0 ]\n     then\n         warn \"failed to remove rustlib\""}]}