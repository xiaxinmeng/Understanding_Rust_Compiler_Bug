{"sha": "fa12ed2b8f3466af88644e59127cd169549f8899", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhMTJlZDJiOGYzNDY2YWY4ODY0NGU1OTEyN2NkMTY5NTQ5Zjg4OTk=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-04-21T09:13:48Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-04-21T09:13:48Z"}, "message": "switch to official extend selection API", "tree": {"sha": "8837e4192d6121115a5a9b94044d33bd683184b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8837e4192d6121115a5a9b94044d33bd683184b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fa12ed2b8f3466af88644e59127cd169549f8899", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fa12ed2b8f3466af88644e59127cd169549f8899", "html_url": "https://github.com/rust-lang/rust/commit/fa12ed2b8f3466af88644e59127cd169549f8899", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fa12ed2b8f3466af88644e59127cd169549f8899/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31b7697cf6f4ebb4ebc35b055e6b4ad9a28e28e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/31b7697cf6f4ebb4ebc35b055e6b4ad9a28e28e9", "html_url": "https://github.com/rust-lang/rust/commit/31b7697cf6f4ebb4ebc35b055e6b4ad9a28e28e9"}], "stats": {"total": 152, "additions": 89, "deletions": 63}, "files": [{"sha": "723c1ac5f7e6634c5efa4872a19ccf5186b0ac68", "filename": "Cargo.lock", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -270,7 +270,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -343,7 +343,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"synstructure 0.10.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -430,7 +430,7 @@ dependencies = [\n  \"crossbeam-channel 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"failure 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"lsp-types 0.56.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"lsp-types 0.57.0 (git+https://github.com/matklad/lsp-types?branch=selection-range)\",\n  \"serde 1.0.90 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde_json 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -634,8 +634,8 @@ dependencies = [\n \n [[package]]\n name = \"lsp-types\"\n-version = \"0.56.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+version = \"0.57.0\"\n+source = \"git+https://github.com/matklad/lsp-types?branch=selection-range#6e37d45bcf411c18c22ab29ec155946ff001339e\"\n dependencies = [\n  \"bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num-derive 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -747,7 +747,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -844,7 +844,7 @@ dependencies = [\n  \"pest_meta 2.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1027,7 +1027,7 @@ dependencies = [\n  \"flexi_logger 0.11.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"gen_lsp_server 0.1.0\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"lsp-types 0.56.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"lsp-types 0.57.0 (git+https://github.com/matklad/lsp-types?branch=selection-range)\",\n  \"parking_lot 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ra_arena 0.1.0\",\n  \"ra_ide_api 0.1.0\",\n@@ -1378,7 +1378,7 @@ dependencies = [\n  \"heck 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1423,7 +1423,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1501,7 +1501,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"syn\"\n-version = \"0.15.31\"\n+version = \"0.15.32\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1516,7 +1516,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -1937,7 +1937,7 @@ dependencies = [\n \"checksum linked-hash-map 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ae91b68aebc4ddb91978b11a1b02ddd8602a05ec19002801c5666000e05e0f83\"\n \"checksum lock_api 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"62ebf1391f6acad60e5c8b43706dde4582df75c06698ab44511d15016bc2442c\"\n \"checksum log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c84ec4b527950aa83a329754b01dbe3f58361d1c5efacd1f6d68c494d08a17c6\"\n-\"checksum lsp-types 0.56.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"31954f2cf354421e6f99a48fdcfd5c3113c675a0db311960ffdac0b8d45cf09c\"\n+\"checksum lsp-types 0.57.0 (git+https://github.com/matklad/lsp-types?branch=selection-range)\" = \"<none>\"\n \"checksum maplit 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"08cbb6b4fef96b6d77bfc40ec491b1690c779e77b05cd9f07f787ed376fd4c43\"\n \"checksum matches 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7ffc5c5338469d4d3ea17d269fa8ea3512ad247247c30bd2df69e68309ed0a08\"\n \"checksum memchr 2.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2efc7bc57c883d4a4d6e3246905283d8dae951bb3bd32f49d6ef297f546e1c39\"\n@@ -2010,7 +2010,7 @@ dependencies = [\n \"checksum stable_deref_trait 1.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dba1a27d3efae4351c8051072d619e3ade2820635c3958d826bfea39d59b54c8\"\n \"checksum strsim 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8ea5119cdb4c55b55d432abb513a0429384878c15dde60cc77b1c99de1a95a6a\"\n \"checksum superslice 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ab16ced94dbd8a46c82fd81e3ed9a8727dac2977ea869d217bcc4ea1f122e81f\"\n-\"checksum syn 0.15.31 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d2b4cfac95805274c6afdb12d8f770fa2d27c045953e7b630a81801953699a9a\"\n+\"checksum syn 0.15.32 (registry+https://github.com/rust-lang/crates.io-index)\" = \"846620ec526c1599c070eff393bfeeeb88a93afa2513fc3b49f1fea84cf7b0ed\"\n \"checksum synstructure 0.10.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"73687139bf99285483c96ac0add482c3776528beac1d97d444f6e91f203a2015\"\n \"checksum tempfile 3.0.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b86c784c88d98c801132806dadd3819ed29d8600836c4088e855cdf3e178ed8a\"\n \"checksum tera 0.11.20 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4b505279e19d8f7d24b1a9dc58327c9c36174b1a2c7ebdeac70792d017cb64f3\""}, {"sha": "0e474a184f3ffb29ebc833413e91bd8952c0626f", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -6,3 +6,4 @@ incremental = true\n debug = true\n \n [patch.'crates-io']\n+lsp-types = { git = \"https://github.com/matklad/lsp-types\", branch = \"selection-range\" }"}, {"sha": "34343e2f250a3468cf2f39106650b1f235851dee", "filename": "crates/gen_lsp_server/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fgen_lsp_server%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fgen_lsp_server%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fgen_lsp_server%2FCargo.toml?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -8,7 +8,7 @@ license = \"MIT OR Apache-2.0\"\n description = \"Generic LSP server scaffold.\"\n \n [dependencies]\n-lsp-types = \"0.56.0\"\n+lsp-types = \"0.57.0\"\n log = \"0.4.3\"\n failure = \"0.1.4\"\n serde_json = \"1.0.34\""}, {"sha": "c855d6f680866260cccd55413c0fb730547f2293", "filename": "crates/ra_lsp_server/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2FCargo.toml?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -15,7 +15,7 @@ crossbeam-channel = \"0.3.5\"\n flexi_logger = \"0.11.0\"\n log = \"0.4.3\"\n url_serde = \"0.2.0\"\n-lsp-types = \"0.56.0\"\n+lsp-types = \"0.57.0\"\n rustc-hash = \"1.0\"\n parking_lot = \"0.7.0\"\n "}, {"sha": "f6d2b75e76a09bc64d2b84f6bc7fcee01ed7fd70", "filename": "crates/ra_lsp_server/src/caps.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -2,7 +2,7 @@ use lsp_types::{\n     CodeActionProviderCapability, CodeLensOptions, CompletionOptions, DocumentOnTypeFormattingOptions,\n     ExecuteCommandOptions, FoldingRangeProviderCapability, RenameOptions, RenameProviderCapability,\n     ServerCapabilities, SignatureHelpOptions, TextDocumentSyncCapability, TextDocumentSyncKind,\n-    TextDocumentSyncOptions, ImplementationProviderCapability,\n+    TextDocumentSyncOptions, ImplementationProviderCapability, GenericCapability,\n };\n \n pub fn server_capabilities() -> ServerCapabilities {\n@@ -37,6 +37,7 @@ pub fn server_capabilities() -> ServerCapabilities {\n             first_trigger_character: \"=\".to_string(),\n             more_trigger_character: Some(vec![\".\".to_string()]),\n         }),\n+        selection_range_provider: Some(GenericCapability::default()),\n         folding_range_provider: Some(FoldingRangeProviderCapability::Simple(true)),\n         rename_provider: Some(RenameProviderCapability::Options(RenameOptions {\n             prepare_provider: Some(true),"}, {"sha": "dc1f8f3f7a65f0dbf04b065c9a0499f5950b4e1a", "filename": "crates/ra_lsp_server/src/main_loop.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -297,6 +297,7 @@ fn on_request(\n         .on::<req::AnalyzerStatus>(handlers::handle_analyzer_status)?\n         .on::<req::SyntaxTree>(handlers::handle_syntax_tree)?\n         .on::<req::ExtendSelection>(handlers::handle_extend_selection)?\n+        .on::<req::SelectionRangeRequest>(handlers::handle_selection_range)?\n         .on::<req::FindMatchingBrace>(handlers::handle_find_matching_brace)?\n         .on::<req::JoinLines>(handlers::handle_join_lines)?\n         .on::<req::OnEnter>(handlers::handle_on_enter)?"}, {"sha": "530081494c827947da0364efcd59ee3de8ba908d", "filename": "crates/ra_lsp_server/src/main_loop/handlers.rs", "status": "modified", "additions": 46, "deletions": 1, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -11,7 +11,7 @@ use ra_ide_api::{\n     FileId, FilePosition, FileRange, FoldKind, Query, RangeInfo, RunnableKind, Severity, Cancelable,\n     AssistId,\n };\n-use ra_syntax::{AstNode, SyntaxKind, TextUnit};\n+use ra_syntax::{AstNode, SyntaxKind, TextUnit, TextRange};\n use ra_prof::profile;\n use rustc_hash::FxHashMap;\n use serde::{Serialize, Deserialize};\n@@ -39,10 +39,15 @@ pub fn handle_syntax_tree(world: ServerWorld, params: req::SyntaxTreeParams) ->\n     Ok(res)\n }\n \n+// FIXME: drop this API\n pub fn handle_extend_selection(\n     world: ServerWorld,\n     params: req::ExtendSelectionParams,\n ) -> Result<req::ExtendSelectionResult> {\n+    log::error!(\n+        \"extend selection is deprecated and will be removed soon,\n+         use the new selection range API in LSP\",\n+    );\n     let file_id = params.text_document.try_conv_with(&world)?;\n     let line_index = world.analysis().file_line_index(file_id);\n     let selections = params\n@@ -55,6 +60,46 @@ pub fn handle_extend_selection(\n     Ok(req::ExtendSelectionResult { selections })\n }\n \n+pub fn handle_selection_range(\n+    world: ServerWorld,\n+    params: req::SelectionRangeParams,\n+) -> Result<Vec<req::SelectionRange>> {\n+    let file_id = params.text_document.try_conv_with(&world)?;\n+    let line_index = world.analysis().file_line_index(file_id);\n+    params\n+        .positions\n+        .into_iter()\n+        .map_conv_with(&line_index)\n+        .map(|position| {\n+            let mut ranges = Vec::new();\n+            {\n+                let mut range = TextRange::from_to(position, position);\n+                loop {\n+                    ranges.push(range);\n+                    let frange = FileRange { file_id, range };\n+                    let next = world.analysis().extend_selection(frange)?;\n+                    if next == range {\n+                        break;\n+                    } else {\n+                        range = next\n+                    }\n+                }\n+            }\n+            let mut range = req::SelectionRange {\n+                range: ranges.last().unwrap().conv_with(&line_index),\n+                parent: None,\n+            };\n+            for r in ranges.iter().rev().skip(1) {\n+                range = req::SelectionRange {\n+                    range: r.conv_with(&line_index),\n+                    parent: Some(Box::new(range)),\n+                }\n+            }\n+            Ok(range)\n+        })\n+        .collect()\n+}\n+\n pub fn handle_find_matching_brace(\n     world: ServerWorld,\n     params: req::FindMatchingBraceParams,"}, {"sha": "6090eb7b929bddfa7439c7679e4575d37c999f28", "filename": "crates/ra_lsp_server/src/req.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Freq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/crates%2Fra_lsp_server%2Fsrc%2Freq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Freq.rs?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -64,6 +64,28 @@ pub struct ExtendSelectionResult {\n     pub selections: Vec<Range>,\n }\n \n+pub enum SelectionRangeRequest {}\n+\n+impl Request for SelectionRangeRequest {\n+    type Params = SelectionRangeParams;\n+    type Result = Vec<SelectionRange>;\n+    const METHOD: &'static str = \"textDocument/selectionRange\";\n+}\n+\n+#[derive(Deserialize, Debug)]\n+#[serde(rename_all = \"camelCase\")]\n+pub struct SelectionRangeParams {\n+    pub text_document: TextDocumentIdentifier,\n+    pub positions: Vec<Position>,\n+}\n+\n+#[derive(Serialize, Debug)]\n+#[serde(rename_all = \"camelCase\")]\n+pub struct SelectionRange {\n+    pub range: Range,\n+    pub parent: Option<Box<SelectionRange>>,\n+}\n+\n pub enum FindMatchingBrace {}\n \n impl Request for FindMatchingBrace {"}, {"sha": "015b912b3caf9c74f75fcdff535994d34ae5e040", "filename": "editors/code/package.json", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -80,11 +80,6 @@\n                 \"title\": \"Show Syntax Tree\",\n                 \"category\": \"Rust Analyzer\"\n             },\n-            {\n-                \"command\": \"rust-analyzer.extendSelection\",\n-                \"title\": \"Extend selection\",\n-                \"category\": \"Rust Analyzer\"\n-            },\n             {\n                 \"command\": \"rust-analyzer.matchingBrace\",\n                 \"title\": \"Find matching brace\","}, {"sha": "6f4187d15c3868e9a8a516e234a756eceddfb3e6", "filename": "editors/code/src/commands/extend_selection.ts", "status": "removed", "additions": 0, "deletions": 34, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/31b7697cf6f4ebb4ebc35b055e6b4ad9a28e28e9/editors%2Fcode%2Fsrc%2Fcommands%2Fextend_selection.ts", "raw_url": "https://github.com/rust-lang/rust/raw/31b7697cf6f4ebb4ebc35b055e6b4ad9a28e28e9/editors%2Fcode%2Fsrc%2Fcommands%2Fextend_selection.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fcommands%2Fextend_selection.ts?ref=31b7697cf6f4ebb4ebc35b055e6b4ad9a28e28e9", "patch": "@@ -1,34 +0,0 @@\n-import * as vscode from 'vscode';\n-\n-import { Range, TextDocumentIdentifier } from 'vscode-languageclient';\n-import { Server } from '../server';\n-\n-interface ExtendSelectionParams {\n-    textDocument: TextDocumentIdentifier;\n-    selections: Range[];\n-}\n-\n-interface ExtendSelectionResult {\n-    selections: Range[];\n-}\n-\n-export async function handle() {\n-    const editor = vscode.window.activeTextEditor;\n-    if (editor == null || editor.document.languageId !== 'rust') {\n-        return;\n-    }\n-    const request: ExtendSelectionParams = {\n-        selections: editor.selections.map(s =>\n-            Server.client.code2ProtocolConverter.asRange(s)\n-        ),\n-        textDocument: { uri: editor.document.uri.toString() }\n-    };\n-    const response = await Server.client.sendRequest<ExtendSelectionResult>(\n-        'rust-analyzer/extendSelection',\n-        request\n-    );\n-    editor.selections = response.selections.map((range: Range) => {\n-        const r = Server.client.protocol2CodeConverter.asRange(range);\n-        return new vscode.Selection(r.start, r.end);\n-    });\n-}"}, {"sha": "19465849762fa9d073f18d8325061dc06d27a34c", "filename": "editors/code/src/commands/index.ts", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fsrc%2Fcommands%2Findex.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fsrc%2Fcommands%2Findex.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fcommands%2Findex.ts?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -1,6 +1,5 @@\n import * as analyzerStatus from './analyzer_status';\n import * as applySourceChange from './apply_source_change';\n-import * as extendSelection from './extend_selection';\n import * as joinLines from './join_lines';\n import * as matchingBrace from './matching_brace';\n import * as onEnter from './on_enter';\n@@ -11,7 +10,6 @@ import * as syntaxTree from './syntaxTree';\n export {\n     analyzerStatus,\n     applySourceChange,\n-    extendSelection,\n     joinLines,\n     matchingBrace,\n     parentModule,"}, {"sha": "c8c3004a7f637debe966e9062944c71188f689bd", "filename": "editors/code/src/extension.ts", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fsrc%2Fextension.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fsrc%2Fextension.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fextension.ts?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -57,10 +57,6 @@ export function activate(context: vscode.ExtensionContext) {\n     registerCommand('rust-analyzer.collectGarbage', () =>\n         Server.client.sendRequest<null>('rust-analyzer/collectGarbage', null)\n     );\n-    registerCommand(\n-        'rust-analyzer.extendSelection',\n-        commands.extendSelection.handle\n-    );\n     registerCommand(\n         'rust-analyzer.matchingBrace',\n         commands.matchingBrace.handle"}, {"sha": "81c2b3fff20a622d04379d99495943999d730c43", "filename": "editors/code/src/server.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fsrc%2Fserver.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fa12ed2b8f3466af88644e59127cd169549f8899/editors%2Fcode%2Fsrc%2Fserver.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fserver.ts?ref=fa12ed2b8f3466af88644e59127cd169549f8899", "patch": "@@ -74,6 +74,7 @@ export class Server {\n                 }\n             }\n         };\n+        Server.client.registerProposedFeatures();\n         Server.client.onReady().then(() => {\n             for (const [type, handler] of notificationHandlers) {\n                 Server.client.onNotification(type, handler);"}]}