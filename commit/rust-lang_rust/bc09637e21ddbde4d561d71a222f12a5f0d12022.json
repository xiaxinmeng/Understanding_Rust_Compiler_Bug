{"sha": "bc09637e21ddbde4d561d71a222f12a5f0d12022", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjMDk2MzdlMjFkZGJkZTRkNTYxZDcxYTIyMmYxMmE1ZjBkMTIwMjI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-27T17:16:59Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-27T17:16:59Z"}, "message": "Auto merge of #56852 - kennytm:test-publish-toolstate-in-ci, r=Mark-Simulacrum\n\nAdded a job to dry-run the publish_toolstate.py once\n\nCloses #56848.\n\nRequires #56847 to be merged first.", "tree": {"sha": "52ffc732b5d9a4e7a6553fd5ad351c27647a4bf3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/52ffc732b5d9a4e7a6553fd5ad351c27647a4bf3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bc09637e21ddbde4d561d71a222f12a5f0d12022", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bc09637e21ddbde4d561d71a222f12a5f0d12022", "html_url": "https://github.com/rust-lang/rust/commit/bc09637e21ddbde4d561d71a222f12a5f0d12022", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bc09637e21ddbde4d561d71a222f12a5f0d12022/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2b92174e3c25e54156efcbdc105a48d50afb6be", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2b92174e3c25e54156efcbdc105a48d50afb6be", "html_url": "https://github.com/rust-lang/rust/commit/f2b92174e3c25e54156efcbdc105a48d50afb6be"}, {"sha": "854abd319e1a7ed080100c66556b8583eb0624a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/854abd319e1a7ed080100c66556b8583eb0624a7", "html_url": "https://github.com/rust-lang/rust/commit/854abd319e1a7ed080100c66556b8583eb0624a7"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "7f99678499acef31680429e2f6997a4ea6d43293", "filename": ".travis.yml", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/bc09637e21ddbde4d561d71a222f12a5f0d12022/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/bc09637e21ddbde4d561d71a222f12a5f0d12022/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=bc09637e21ddbde4d561d71a222f12a5f0d12022", "patch": "@@ -248,6 +248,15 @@ before_script:\n           # Enable core dump on Linux.\n           sudo sh -c 'echo \"/checkout/obj/cores/core.%p.%E\" > /proc/sys/kernel/core_pattern';\n       fi\n+  - >\n+      if [ \"$IMAGE\" = mingw-check ]; then\n+        # verify the publish_toolstate script works.\n+        git clone --depth=1 https://github.com/rust-lang-nursery/rust-toolstate.git;\n+        cd rust-toolstate;\n+        python2.7 \"$TRAVIS_BUILD_DIR/src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \"$(git log --format=%s -n1 HEAD)\" \"\" \"\";\n+        cd ..;\n+        rm -rf rust-toolstate;\n+      fi\n \n # Log time information from this machine and an external machine for insight into possible\n # clock drift. Timezones don't matter since relative deltas give all the necessary info."}, {"sha": "323f81181682f45a9bb41bf36bf92d3ca7daec9f", "filename": "src/tools/publish_toolstate.py", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bc09637e21ddbde4d561d71a222f12a5f0d12022/src%2Ftools%2Fpublish_toolstate.py", "raw_url": "https://github.com/rust-lang/rust/raw/bc09637e21ddbde4d561d71a222f12a5f0d12022/src%2Ftools%2Fpublish_toolstate.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fpublish_toolstate.py?ref=bc09637e21ddbde4d561d71a222f12a5f0d12022", "patch": "@@ -120,6 +120,11 @@ def update_latest(\n         sys.exit(0)\n \n     print(message)\n+\n+    if not github_token:\n+        print('Dry run only, not committing anything')\n+        sys.exit(0)\n+\n     with open(save_message_to_path, 'w') as f:\n         f.write(message)\n "}]}