{"sha": "1db878fd38eb00daf794d87ab04cb50c7fa6e4fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkYjg3OGZkMzhlYjAwZGFmNzk0ZDg3YWIwNGNiNTBjN2ZhNmU0ZmM=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2016-07-16T21:15:15Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2016-09-03T10:37:25Z"}, "message": "Add unions to AST", "tree": {"sha": "7e5e32abf460625f4a3f64ec17aeb9a3d825d8e5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e5e32abf460625f4a3f64ec17aeb9a3d825d8e5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc", "html_url": "https://github.com/rust-lang/rust/commit/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a029ea343fe5c9b7cf550902b5a507cd8c22a833", "url": "https://api.github.com/repos/rust-lang/rust/commits/a029ea343fe5c9b7cf550902b5a507cd8c22a833", "html_url": "https://github.com/rust-lang/rust/commit/a029ea343fe5c9b7cf550902b5a507cd8c22a833"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "b8284f5dcf10d0758aaf53f822acade94d03f5ae", "filename": "src/librustc_passes/ast_validation.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc/src%2Flibrustc_passes%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc/src%2Flibrustc_passes%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Fast_validation.rs?ref=1db878fd38eb00daf794d87ab04cb50c7fa6e4fc", "patch": "@@ -196,6 +196,16 @@ impl<'a> Visitor for AstValidator<'a> {\n                 // Ensure that `path` attributes on modules are recorded as used (c.f. #35584).\n                 attr::first_attr_value_str_by_name(&item.attrs, \"path\");\n             }\n+            ItemKind::Union(ref vdata, _) => {\n+                if !vdata.is_struct() {\n+                    self.err_handler().span_err(item.span,\n+                                                \"tuple and unit unions are not permitted\");\n+                }\n+                if vdata.fields().len() == 0 {\n+                    self.err_handler().span_err(item.span,\n+                                                \"unions cannot have zero fields\");\n+                }\n+            }\n             _ => {}\n         }\n "}, {"sha": "4394fb0e1431263d64e2e04134fdfaa45263d811", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=1db878fd38eb00daf794d87ab04cb50c7fa6e4fc", "patch": "@@ -1886,7 +1886,7 @@ pub enum ItemKind {\n     /// A union definition (`union` or `pub union`).\n     ///\n     /// E.g. `union Foo<A, B> { x: A, y: B }`\n-    Union(VariantData, Generics), // FIXME: not yet implemented\n+    Union(VariantData, Generics),\n     /// A Trait declaration (`trait` or `pub trait`).\n     ///\n     /// E.g. `trait Foo { .. }` or `trait Foo<T> { .. }`"}, {"sha": "e2a7ec0a33de1be6ce5a6f97e04d6b9098e86dab", "filename": "src/libsyntax/diagnostics/macros.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc/src%2Flibsyntax%2Fdiagnostics%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1db878fd38eb00daf794d87ab04cb50c7fa6e4fc/src%2Flibsyntax%2Fdiagnostics%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostics%2Fmacros.rs?ref=1db878fd38eb00daf794d87ab04cb50c7fa6e4fc", "patch": "@@ -107,6 +107,13 @@ macro_rules! help {\n     })\n }\n \n+#[macro_export]\n+macro_rules! unimplemented_unions {\n+    () => ({\n+        panic!(\"unions are not fully implemented\");\n+    })\n+}\n+\n #[macro_export]\n macro_rules! register_diagnostics {\n     ($($code:tt),*) => ("}]}