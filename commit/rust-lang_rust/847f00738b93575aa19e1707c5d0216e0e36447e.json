{"sha": "847f00738b93575aa19e1707c5d0216e0e36447e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0N2YwMDczOGI5MzU3NWFhMTllMTcwN2M1ZDAyMTZlMGUzNjQ0N2U=", "commit": {"author": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-02-18T13:18:46Z"}, "committer": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-03-09T14:45:29Z"}, "message": "typeck: Introduce reification for fn ptr casts.", "tree": {"sha": "c0995e57e6074be85dce352f4e4cb0368947823b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0995e57e6074be85dce352f4e4cb0368947823b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/847f00738b93575aa19e1707c5d0216e0e36447e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/847f00738b93575aa19e1707c5d0216e0e36447e", "html_url": "https://github.com/rust-lang/rust/commit/847f00738b93575aa19e1707c5d0216e0e36447e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/847f00738b93575aa19e1707c5d0216e0e36447e/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f07f8a4fad3e59358356100c5cbd9a39e6d68bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f07f8a4fad3e59358356100c5cbd9a39e6d68bd", "html_url": "https://github.com/rust-lang/rust/commit/8f07f8a4fad3e59358356100c5cbd9a39e6d68bd"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "b25d6e0476d9847c4151121baba40ee2b68d9d57", "filename": "src/librustc/middle/ty/cast.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/847f00738b93575aa19e1707c5d0216e0e36447e/src%2Flibrustc%2Fmiddle%2Fty%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/847f00738b93575aa19e1707c5d0216e0e36447e/src%2Flibrustc%2Fmiddle%2Fty%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty%2Fcast.rs?ref=847f00738b93575aa19e1707c5d0216e0e36447e", "patch": "@@ -69,9 +69,7 @@ impl<'tcx> CastTy<'tcx> {\n                 Some(CastTy::Int(IntTy::CEnum)),\n             ty::TyRawPtr(ref mt) => Some(CastTy::Ptr(mt)),\n             ty::TyRef(_, ref mt) => Some(CastTy::RPtr(mt)),\n-            // FIXME: Treating TyFnDef as a pointer here is a bit dubious;\n-            // we should be coercing the operand to an actual pointer.\n-            ty::TyFnDef(..) | ty::TyFnPtr(..) => Some(CastTy::FnPtr),\n+            ty::TyFnPtr(..) => Some(CastTy::FnPtr),\n             _ => None,\n         }\n     }"}, {"sha": "7168873c1b8a8239ecd9e0589adabb7df776416d", "filename": "src/librustc_typeck/check/cast.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/847f00738b93575aa19e1707c5d0216e0e36447e/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/847f00738b93575aa19e1707c5d0216e0e36447e/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs?ref=847f00738b93575aa19e1707c5d0216e0e36447e", "patch": "@@ -235,6 +235,20 @@ impl<'tcx> CastCheck<'tcx> {\n         let (t_from, t_cast) = match (CastTy::from_ty(self.expr_ty),\n                                       CastTy::from_ty(self.cast_ty)) {\n             (Some(t_from), Some(t_cast)) => (t_from, t_cast),\n+            // Function item types may need to be reified before casts.\n+            (None, Some(t_cast)) => {\n+                if let ty::TyFnDef(_, _, f) = self.expr_ty.sty {\n+                    // Attempt a coercion to a fn pointer type.\n+                    let res = coercion::mk_assignty(fcx, &self.expr,\n+                        self.expr_ty, fcx.tcx().mk_ty(ty::TyFnPtr(f)));\n+                    if !res.is_ok() {\n+                        return Err(CastError::NonScalar);\n+                    }\n+                    (FnPtr, t_cast)\n+                } else {\n+                    return Err(CastError::NonScalar);\n+                }\n+            }\n             _ => {\n                 return Err(CastError::NonScalar)\n             }"}]}