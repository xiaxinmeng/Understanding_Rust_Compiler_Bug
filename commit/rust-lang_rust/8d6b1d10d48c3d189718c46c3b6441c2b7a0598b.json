{"sha": "8d6b1d10d48c3d189718c46c3b6441c2b7a0598b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkNmIxZDEwZDQ4YzNkMTg5NzE4YzQ2YzNiNjQ0MWMyYjdhMDU5OGI=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2019-04-16T08:45:01Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2019-07-01T12:53:58Z"}, "message": "Clean up inherent_impls", "tree": {"sha": "82c64f1407b1aa547f66dbbf1dffc8e44a452a83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82c64f1407b1aa547f66dbbf1dffc8e44a452a83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8d6b1d10d48c3d189718c46c3b6441c2b7a0598b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8d6b1d10d48c3d189718c46c3b6441c2b7a0598b", "html_url": "https://github.com/rust-lang/rust/commit/8d6b1d10d48c3d189718c46c3b6441c2b7a0598b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8d6b1d10d48c3d189718c46c3b6441c2b7a0598b/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "765eebf064ae17347f3532791760fc5c2150b5ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/765eebf064ae17347f3532791760fc5c2150b5ea", "html_url": "https://github.com/rust-lang/rust/commit/765eebf064ae17347f3532791760fc5c2150b5ea"}], "stats": {"total": 33, "additions": 4, "deletions": 29}, "files": [{"sha": "0b04160522047b0a072b6a9b2c73ae7731a6e442", "filename": "src/librustc_typeck/coherence/inherent_impls.rs", "status": "modified", "additions": 4, "deletions": 29, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/8d6b1d10d48c3d189718c46c3b6441c2b7a0598b/src%2Flibrustc_typeck%2Fcoherence%2Finherent_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d6b1d10d48c3d189718c46c3b6441c2b7a0598b/src%2Flibrustc_typeck%2Fcoherence%2Finherent_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcoherence%2Finherent_impls.rs?ref=8d6b1d10d48c3d189718c46c3b6441c2b7a0598b", "patch": "@@ -7,7 +7,6 @@\n //! `tcx.inherent_impls(def_id)`). That value, however,\n //! is computed by selecting an idea from this table.\n \n-use rustc::dep_graph::DepKind;\n use rustc::hir::def_id::{CrateNum, DefId, LOCAL_CRATE};\n use rustc::hir;\n use rustc::hir::itemlikevisit::ItemLikeVisitor;\n@@ -36,35 +35,11 @@ pub fn crate_inherent_impls<'tcx>(\n pub fn inherent_impls<'tcx>(tcx: TyCtxt<'tcx>, ty_def_id: DefId) -> &'tcx [DefId] {\n     assert!(ty_def_id.is_local());\n \n-    // NB. Until we adopt the red-green dep-tracking algorithm (see\n-    // [the plan] for details on that), we do some hackery here to get\n-    // the dependencies correct.  Basically, we use a `with_ignore` to\n-    // read the result we want. If we didn't have the `with_ignore`,\n-    // we would wind up with a dependency on the entire crate, which\n-    // we don't want. Then we go and add dependencies on all the impls\n-    // in the result (which is what we wanted).\n-    //\n-    // The result is a graph with an edge from `Hir(I)` for every impl\n-    // `I` defined on some type `T` to `CoherentInherentImpls(T)`,\n-    // thus ensuring that if any of those impls change, the set of\n-    // inherent impls is considered dirty.\n-    //\n-    // [the plan]: https://github.com/rust-lang/rust-roadmap/issues/4\n-\n-    let result = tcx.dep_graph.with_ignore(|| {\n-        let crate_map = tcx.crate_inherent_impls(ty_def_id.krate);\n-        match crate_map.inherent_impls.get(&ty_def_id) {\n-            Some(v) => &v[..],\n-            None => &[],\n-        }\n-    });\n-\n-    for &impl_def_id in &result[..] {\n-        let def_path_hash = tcx.def_path_hash(impl_def_id);\n-        tcx.dep_graph.read(def_path_hash.to_dep_node(DepKind::Hir));\n+    let crate_map = tcx.crate_inherent_impls(ty_def_id.krate);\n+    match crate_map.inherent_impls.get(&ty_def_id) {\n+        Some(v) => &v[..],\n+        None => &[],\n     }\n-\n-    result\n }\n \n struct InherentCollect<'tcx> {"}]}