{"sha": "de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa", "node_id": "C_kwDOAAsO6NoAKGRlMDVkM2VjMzFmMjJiMWYzYWZhZjhiNWNlZGRmMjI0NDkyYzRhYWE", "commit": {"author": {"name": "5225225", "email": "5225225@mailbox.org", "date": "2021-11-13T11:14:17Z"}, "committer": {"name": "5225225", "email": "5225225@mailbox.org", "date": "2021-11-16T08:06:30Z"}, "message": "Print full char literal on error if any are non-printing", "tree": {"sha": "00820f35879413e641462e8340e7617d5fd1fadd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00820f35879413e641462e8340e7617d5fd1fadd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa", "html_url": "https://github.com/rust-lang/rust/commit/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa/comments", "author": {"login": "5225225", "id": 8584210, "node_id": "MDQ6VXNlcjg1ODQyMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/8584210?v=4", "gravatar_id": "", "url": "https://api.github.com/users/5225225", "html_url": "https://github.com/5225225", "followers_url": "https://api.github.com/users/5225225/followers", "following_url": "https://api.github.com/users/5225225/following{/other_user}", "gists_url": "https://api.github.com/users/5225225/gists{/gist_id}", "starred_url": "https://api.github.com/users/5225225/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/5225225/subscriptions", "organizations_url": "https://api.github.com/users/5225225/orgs", "repos_url": "https://api.github.com/users/5225225/repos", "events_url": "https://api.github.com/users/5225225/events{/privacy}", "received_events_url": "https://api.github.com/users/5225225/received_events", "type": "User", "site_admin": false}, "committer": {"login": "5225225", "id": 8584210, "node_id": "MDQ6VXNlcjg1ODQyMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/8584210?v=4", "gravatar_id": "", "url": "https://api.github.com/users/5225225", "html_url": "https://github.com/5225225", "followers_url": "https://api.github.com/users/5225225/followers", "following_url": "https://api.github.com/users/5225225/following{/other_user}", "gists_url": "https://api.github.com/users/5225225/gists{/gist_id}", "starred_url": "https://api.github.com/users/5225225/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/5225225/subscriptions", "organizations_url": "https://api.github.com/users/5225225/orgs", "repos_url": "https://api.github.com/users/5225225/repos", "events_url": "https://api.github.com/users/5225225/events{/privacy}", "received_events_url": "https://api.github.com/users/5225225/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02063124f96aac10f8c5c70653242b0704d397e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/02063124f96aac10f8c5c70653242b0704d397e0", "html_url": "https://github.com/rust-lang/rust/commit/02063124f96aac10f8c5c70653242b0704d397e0"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "0f6594a2a7f32294d40ac0ed0e9f8970715424b1", "filename": "compiler/rustc_parse/src/lexer/unescape_error_reporting.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa/compiler%2Frustc_parse%2Fsrc%2Flexer%2Funescape_error_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa/compiler%2Frustc_parse%2Fsrc%2Flexer%2Funescape_error_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Flexer%2Funescape_error_reporting.rs?ref=de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa", "patch": "@@ -82,6 +82,16 @@ pub(crate) fn emit_unescape_error(\n                         Applicability::MachineApplicable,\n                     );\n                 }\n+            } else {\n+                if lit.chars().filter(|x| x.is_whitespace() || x.is_control()).count() >= 1 {\n+                    handler.span_note(\n+                        span,\n+                        &format!(\n+                            \"there are non-printing characters, the full sequence is `{}`\",\n+                            lit.escape_default(),\n+                        ),\n+                    );\n+                }\n             }\n \n             if !has_help {"}, {"sha": "ecb5c3cf49eda2f5cf5b1d79b17e84e4ed5e1a89", "filename": "src/test/ui/parser/char/whitespace-character-literal.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa/src%2Ftest%2Fui%2Fparser%2Fchar%2Fwhitespace-character-literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa/src%2Ftest%2Fui%2Fparser%2Fchar%2Fwhitespace-character-literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fchar%2Fwhitespace-character-literal.rs?ref=de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa", "patch": "@@ -0,0 +1,9 @@\n+// This tests that the error generated when a character literal has multiple\n+// characters in it contains a note about non-printing characters.\n+\n+fn main() {\n+    // <hair space>x<zero width space>\n+    let _hair_space_around = '\u200ax\u200b';\n+    //~^ ERROR: character literal may only contain one codepoint\n+    //~| NOTE: there are non-printing characters, the full sequence is `\\u{200a}x\\u{200b}`\n+}"}, {"sha": "a12088ce77d116680af5c82f3e2f364e15c337b8", "filename": "src/test/ui/parser/char/whitespace-character-literal.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa/src%2Ftest%2Fui%2Fparser%2Fchar%2Fwhitespace-character-literal.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa/src%2Ftest%2Fui%2Fparser%2Fchar%2Fwhitespace-character-literal.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fchar%2Fwhitespace-character-literal.stderr?ref=de05d3ec31f22b1f3afaf8b5ceddf224492c4aaa", "patch": "@@ -0,0 +1,18 @@\n+error: character literal may only contain one codepoint\n+  --> $DIR/whitespace-character-literal.rs:6:30\n+   |\n+LL |     let _hair_space_around = '\u200ax\u200b';\n+   |                              ^^^^\n+   |\n+note: there are non-printing characters, the full sequence is `\\u{200a}x\\u{200b}`\n+  --> $DIR/whitespace-character-literal.rs:6:31\n+   |\n+LL |     let _hair_space_around = '\u200ax\u200b';\n+   |                               ^^\n+help: if you meant to write a `str` literal, use double quotes\n+   |\n+LL |     let _hair_space_around = \"\u200ax\u200b\";\n+   |                              ~~~~\n+\n+error: aborting due to previous error\n+"}]}