{"sha": "50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwYzRlM2U4ZDAxMDIwYzgzMjU1YzQ4ZDJmZGJjNThlYTVhYjM0Yzk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-03-21T23:11:56Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-03-21T23:11:56Z"}, "message": "Auto merge of #40664 - jseyfried:fix_derive_bug, r=nrc\n\nmacros: fix bug in legacy custom derive processing\n\nFixes #40663.\nr? @nrc", "tree": {"sha": "a128716ac5d487f29bf192cd96b82e9ffb39a75e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a128716ac5d487f29bf192cd96b82e9ffb39a75e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9", "html_url": "https://github.com/rust-lang/rust/commit/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cab4bff3de1a61472f3c2e7752ef54b87344d1c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/cab4bff3de1a61472f3c2e7752ef54b87344d1c9", "html_url": "https://github.com/rust-lang/rust/commit/cab4bff3de1a61472f3c2e7752ef54b87344d1c9"}, {"sha": "bd862d29d337ff4a082bef9d4adcad4b6a86b7a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd862d29d337ff4a082bef9d4adcad4b6a86b7a5", "html_url": "https://github.com/rust-lang/rust/commit/bd862d29d337ff4a082bef9d4adcad4b6a86b7a5"}], "stats": {"total": 33, "additions": 29, "deletions": 4}, "files": [{"sha": "f83413095934d9b19e87604d65b02bf66644834a", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9", "patch": "@@ -230,12 +230,12 @@ impl<'a> base::Resolver for Resolver<'a> {\n                         attrs.remove(i);\n                     } else {\n                         let mut tokens = Vec::new();\n-                        for (i, path) in traits.iter().enumerate() {\n-                            if i > 0 {\n+                        for (j, path) in traits.iter().enumerate() {\n+                            if j > 0 {\n                                 tokens.push(TokenTree::Token(attrs[i].span, Token::Comma).into());\n                             }\n-                            for (j, segment) in path.segments.iter().enumerate() {\n-                                if j > 0 {\n+                            for (k, segment) in path.segments.iter().enumerate() {\n+                                if k > 0 {\n                                     tokens.push(TokenTree::Token(path.span, Token::ModSep).into());\n                                 }\n                                 let tok = Token::Ident(segment.identifier);"}, {"sha": "16856d304174999c74afe55adc2b371104fe5940", "filename": "src/test/run-pass-fulldeps/auxiliary/custom_derive_plugin.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fcustom_derive_plugin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fcustom_derive_plugin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fcustom_derive_plugin.rs?ref=50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9", "patch": "@@ -34,8 +34,14 @@ pub fn plugin_registrar(reg: &mut Registry) {\n     reg.register_custom_derive(\n         Symbol::intern(\"derive_TotalSum\"),\n         MultiDecorator(box expand));\n+\n+    reg.register_custom_derive(\n+        Symbol::intern(\"derive_Nothing\"),\n+        MultiDecorator(box noop));\n }\n \n+fn noop(_: &mut ExtCtxt, _: Span, _: &ast::MetaItem, _: &Annotatable, _: &mut FnMut(Annotatable)) {}\n+\n fn expand(cx: &mut ExtCtxt,\n           span: Span,\n           mitem: &ast::MetaItem,"}, {"sha": "d030eab64e564026301e6996e34b55d8e6775681", "filename": "src/test/run-pass-fulldeps/issue-40663.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9/src%2Ftest%2Frun-pass-fulldeps%2Fissue-40663.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9/src%2Ftest%2Frun-pass-fulldeps%2Fissue-40663.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fissue-40663.rs?ref=50c4e3e8d01020c83255c48d2fdbc58ea5ab34c9", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:custom_derive_plugin.rs\n+\n+#![feature(plugin, custom_derive)]\n+#![plugin(custom_derive_plugin)]\n+\n+#[derive(Nothing, Nothing, Nothing)]\n+struct S;\n+\n+fn main() {}"}]}