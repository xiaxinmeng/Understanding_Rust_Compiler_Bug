{"sha": "c23dca392597e917ae03379ef51ac94fcf72cf89", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyM2RjYTM5MjU5N2U5MTdhZTAzMzc5ZWY1MWFjOTRmY2Y3MmNmODk=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-10-12T23:11:05Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-10-12T23:11:05Z"}, "message": "Merge pull request #449 from marcusklaas/array-block-indent\n\nUse visual block indentation for array literals", "tree": {"sha": "ae11a0d431e530cc1e572f35977f1b07708b631c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ae11a0d431e530cc1e572f35977f1b07708b631c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c23dca392597e917ae03379ef51ac94fcf72cf89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c23dca392597e917ae03379ef51ac94fcf72cf89", "html_url": "https://github.com/rust-lang/rust/commit/c23dca392597e917ae03379ef51ac94fcf72cf89", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c23dca392597e917ae03379ef51ac94fcf72cf89/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4bc43f6f35a7ae46c38e7395783c0d8c49e2c6f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bc43f6f35a7ae46c38e7395783c0d8c49e2c6f0", "html_url": "https://github.com/rust-lang/rust/commit/4bc43f6f35a7ae46c38e7395783c0d8c49e2c6f0"}, {"sha": "e6af5d2c835ea1a4d84517218336fa718f297107", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6af5d2c835ea1a4d84517218336fa718f297107", "html_url": "https://github.com/rust-lang/rust/commit/e6af5d2c835ea1a4d84517218336fa718f297107"}], "stats": {"total": 49, "additions": 47, "deletions": 2}, "files": [{"sha": "4a2b318c6ad55a462ce6e750a1afb494f30f92f0", "filename": "src/expr.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c23dca392597e917ae03379ef51ac94fcf72cf89/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c23dca392597e917ae03379ef51ac94fcf72cf89/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=c23dca392597e917ae03379ef51ac94fcf72cf89", "patch": "@@ -256,14 +256,16 @@ pub fn rewrite_array<'a, I>(expr_iter: I,\n     where I: Iterator<Item = &'a ast::Expr>\n {\n     // 2 for brackets;\n+    let offset = offset + 1;\n+    let inner_context = &RewriteContext { block_indent: offset, ..*context };\n     let max_item_width = try_opt!(width.checked_sub(2));\n     let items = itemize_list(context.codemap,\n                              expr_iter,\n                              \"]\",\n                              |item| item.span.lo,\n                              |item| item.span.hi,\n                              // 1 = [\n-                             |item| item.rewrite(context, max_item_width, offset + 1),\n+                             |item| item.rewrite(&inner_context, max_item_width, offset),\n                              span_after(span, \"[\", context.codemap),\n                              span.hi)\n                     .collect::<Vec<_>>();\n@@ -283,7 +285,7 @@ pub fn rewrite_array<'a, I>(expr_iter: I,\n         tactic: tactic,\n         separator: \",\",\n         trailing_separator: SeparatorTactic::Never,\n-        indent: offset + 1,\n+        indent: offset,\n         width: max_item_width,\n         ends_with_newline: false,\n         config: context.config,"}, {"sha": "c8bd6e5c859f03876da457c0147acd3bac3ffd6c", "filename": "tests/source/expr.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c23dca392597e917ae03379ef51ac94fcf72cf89/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c23dca392597e917ae03379ef51ac94fcf72cf89/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=c23dca392597e917ae03379ef51ac94fcf72cf89", "patch": "@@ -169,6 +169,25 @@ fn arrays() {\n \n     let y = [/* comment */ 1, 2 /* post comment */, 3];\n \n+    let xy =    [ strukt  { test123: value_one_two_three_four, turbo: coolio(), } , /* comment  */   1 ];\n+\n+        let a =WeightedChoice::new(&mut [Weighted {\n+            weight: x,\n+            item: 0,\n+        },\n+                                  Weighted {\n+            weight: 1,\n+            item: 1,\n+        },\n+                                  Weighted {\n+            weight: x,\n+            item: 2,\n+        },\n+                                  Weighted {\n+            weight: 1,\n+            item: 3,\n+        }]);\n+\n     let z = [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx, yyyyyyyyyyyyyyyyyyyyyyyyyyy, zzzzzzzzzzzzzzzzzz, q];\n \n     [ 1 +   3, 4 ,  5, 6, 7, 7, fncall::<Vec<_>>(3-1)]"}, {"sha": "991663effaabc69dfee8ab996fee6ecd4c929f3c", "filename": "tests/target/expr.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c23dca392597e917ae03379ef51ac94fcf72cf89/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c23dca392597e917ae03379ef51ac94fcf72cf89/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=c23dca392597e917ae03379ef51ac94fcf72cf89", "patch": "@@ -176,6 +176,30 @@ fn arrays() {\n              2, // post comment\n              3];\n \n+    let xy = [strukt {\n+                  test123: value_one_two_three_four,\n+                  turbo: coolio(),\n+              },\n+              // comment\n+              1];\n+\n+    let a = WeightedChoice::new(&mut [Weighted {\n+                                          weight: x,\n+                                          item: 0,\n+                                      },\n+                                      Weighted {\n+                                          weight: 1,\n+                                          item: 1,\n+                                      },\n+                                      Weighted {\n+                                          weight: x,\n+                                          item: 2,\n+                                      },\n+                                      Weighted {\n+                                          weight: 1,\n+                                          item: 3,\n+                                      }]);\n+\n     let z = [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx,\n              yyyyyyyyyyyyyyyyyyyyyyyyyyy,\n              zzzzzzzzzzzzzzzzzz,"}]}