{"sha": "0c6e01baffa5eeaa6658f065daffddf9916d0e87", "node_id": "C_kwDOAAsO6NoAKDBjNmUwMWJhZmZhNWVlYWE2NjU4ZjA2NWRhZmZkZGY5OTE2ZDBlODc", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-07-16T20:30:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-16T20:30:55Z"}, "message": "Rollup merge of #99323 - GuillaumeGomez:fix-gui-flaky, r=Dylan-DPC\n\nFix flakyness of GUI tests\n\nFixes #98163.\n\nAll flaky tests seemed to be linked to the search. Since the search JS is loaded when we focus the search input, I think it's possible that we enter faster than the JS is actually loaded. The solution for that would be to do it in two steps: first we write into the search input (`browser-ui-test` adds a small sleep time after such commands) and then we press enter to be sure that it wasn't missed.\n\ncc `@JohnTitor`\nr? `@Dylan-DPC`", "tree": {"sha": "b1f398d36dba7f487e8ded492dc79fdad2218146", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1f398d36dba7f487e8ded492dc79fdad2218146"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0c6e01baffa5eeaa6658f065daffddf9916d0e87", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi0yAACRBK7hj4Ov3rIwAA/DYIABnplnEwvvKMzBaNond97WBD\nKo1d8CSXS29Mqo7Oc/Rk6wX4DD5eQruYZGliFMOhLmIcPgdcgNiskya6moFWTVyH\nleRYqenMsdF4L1+HoUMga6y3vg6B48l/hWylWv+XVTPQQCFQjTAvC1x6cNwkx7nX\nhUNwObwP4mU1bOGSeMUoQWlpR15hn5+3I0049akf1eVHfAItx1vXsokX0UZrlcdw\ngS1SpWZDdZ3l8sgtaHxt3yyO1L+fdqTklXlvtsySjS7vd6KnPEPy4ZmkeUyiSHZK\nbENASyapI16GyN7JpmYOJmt7btviYqo9woW09kiB1nXYJCPMISQUli6CS19a9l0=\n=JgU7\n-----END PGP SIGNATURE-----\n", "payload": "tree b1f398d36dba7f487e8ded492dc79fdad2218146\nparent ddc32d1633b796a3fdbe09724407fa814fa8ed56\nparent b393e979dc8edf1807b19e0619c617eb786012c6\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1658003455 +0200\ncommitter GitHub <noreply@github.com> 1658003455 +0200\n\nRollup merge of #99323 - GuillaumeGomez:fix-gui-flaky, r=Dylan-DPC\n\nFix flakyness of GUI tests\n\nFixes #98163.\n\nAll flaky tests seemed to be linked to the search. Since the search JS is loaded when we focus the search input, I think it's possible that we enter faster than the JS is actually loaded. The solution for that would be to do it in two steps: first we write into the search input (`browser-ui-test` adds a small sleep time after such commands) and then we press enter to be sure that it wasn't missed.\n\ncc `@JohnTitor`\nr? `@Dylan-DPC`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0c6e01baffa5eeaa6658f065daffddf9916d0e87", "html_url": "https://github.com/rust-lang/rust/commit/0c6e01baffa5eeaa6658f065daffddf9916d0e87", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0c6e01baffa5eeaa6658f065daffddf9916d0e87/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ddc32d1633b796a3fdbe09724407fa814fa8ed56", "url": "https://api.github.com/repos/rust-lang/rust/commits/ddc32d1633b796a3fdbe09724407fa814fa8ed56", "html_url": "https://github.com/rust-lang/rust/commit/ddc32d1633b796a3fdbe09724407fa814fa8ed56"}, {"sha": "b393e979dc8edf1807b19e0619c617eb786012c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/b393e979dc8edf1807b19e0619c617eb786012c6", "html_url": "https://github.com/rust-lang/rust/commit/b393e979dc8edf1807b19e0619c617eb786012c6"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "a5afb037d0fd5987879350827cf35aa698fe59b2", "filename": "src/test/rustdoc-gui/escape-key.goml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -3,6 +3,8 @@\n goto: file://|DOC_PATH|/test_docs/index.html\n // First, we check that the search results are hidden when the Escape key is pressed.\n write: (\".search-input\", \"test\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n wait-for: \"#search h1\" // The search element is empty before the first search \n // Check that the currently displayed element is search.\n wait-for: \"#alternative-display #search\""}, {"sha": "d645e2370616144c4acc4f5680e1b08be3f3575d", "filename": "src/test/rustdoc-gui/search-filter.goml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -2,6 +2,8 @@\n goto: file://|DOC_PATH|/test_docs/index.html\n show-text: true\n write: (\".search-input\", \"test\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n assert-text: (\"#results .externcrate\", \"test_docs\")"}, {"sha": "5ef890d472b90804fbc8bf507d235b764670f60d", "filename": "src/test/rustdoc-gui/search-reexport.goml", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-reexport.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-reexport.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-reexport.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -7,6 +7,8 @@ reload:\n assert-text: (\"//*[@id='reexport.TheStdReexport']\", \"pub use ::std as TheStdReexport;\")\n assert-css: (\"//*[@id='reexport.TheStdReexport']\", {\"background-color\": \"rgba(0, 0, 0, 0)\"})\n write: (\".search-input\", \"TheStdReexport\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n wait-for: \"//a[@class='result-import']\"\n assert-attribute: (\n     \"//a[@class='result-import']\",\n@@ -18,6 +20,8 @@ click: \"//a[@class='result-import']\"\n wait-for-css: (\"//*[@id='reexport.TheStdReexport']\", {\"background-color\": \"rgb(73, 74, 61)\"})\n \n // We now check that the alias is working as well on the reexport.\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n write: (\".search-input\", \"AliasForTheStdReexport\")\n wait-for: \"//a[@class='result-import']\"\n assert-text: ("}, {"sha": "9a49ae2c6b853661f83c5007943dabda13d9ccb4", "filename": "src/test/rustdoc-gui/search-result-color.goml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-result-color.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-result-color.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-color.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -89,6 +89,8 @@ show-text: true\n // We reload the page so the local storage settings are being used.\n reload:\n write: (\".search-input\", \"thisisanalias\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n // Checking that the colors for the alias element are the ones expected."}, {"sha": "6295d7fae89070aaaef59aed1681bedd86f1c755", "filename": "src/test/rustdoc-gui/search-result-display.goml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-result-display.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-result-display.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-display.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -2,6 +2,8 @@\n goto: file://|DOC_PATH|/test_docs/index.html\n size: (900, 1000)\n write: (\".search-input\", \"test\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n wait-for: \"#search-settings\"\n // The width is returned by \"getComputedStyle\" which returns the exact number instead of the\n // CSS rule which is \"50%\"..."}, {"sha": "16ae10431acf2dbf86d433f7ff5e29a851be43e2", "filename": "src/test/rustdoc-gui/search-result-keyword.goml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-result-keyword.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-result-keyword.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-keyword.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -1,6 +1,8 @@\n // Checks that the \"keyword\" results have the expected text alongside them.\n goto: file://|DOC_PATH|/test_docs/index.html\n write: (\".search-input\", \"CookieMonster\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n // Note: The two next assert commands could be merged as one but readability would be"}, {"sha": "9d506c1519e6b5c2f5ac875045003649102b11c9", "filename": "src/test/rustdoc-gui/search-tab-change-title-fn-sig.goml", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-tab-change-title-fn-sig.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsearch-tab-change-title-fn-sig.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-tab-change-title-fn-sig.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -2,6 +2,8 @@\n // First, try a search-by-name\n goto: file://|DOC_PATH|/test_docs/index.html\n write: (\".search-input\", \"Foo\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n assert-attribute: (\"#titles > button:nth-of-type(1)\", {\"class\": \"selected\"})\n@@ -22,6 +24,8 @@ wait-for-attribute: (\"#titles > button:nth-of-type(3)\", {\"class\": \"selected\"})\n // Now try search-by-return\n goto: file://|DOC_PATH|/test_docs/index.html\n write: (\".search-input\", \"-> String\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n assert-attribute: (\"#titles > button:nth-of-type(1)\", {\"class\": \"selected\"})\n@@ -42,6 +46,8 @@ wait-for-attribute: (\"#titles > button:nth-of-type(1)\", {\"class\": \"selected\"})\n // Try with a search-by-return with no results\n goto: file://|DOC_PATH|/test_docs/index.html\n write: (\".search-input\", \"-> Something\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n assert-attribute: (\"#titles > button:nth-of-type(1)\", {\"class\": \"selected\"})\n@@ -50,6 +56,8 @@ assert-text: (\"#titles > button:nth-of-type(1)\", \"In Function Return Types\", STA\n // Try with a search-by-parameter\n goto: file://|DOC_PATH|/test_docs/index.html\n write: (\".search-input\", \"usize pattern\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n assert-attribute: (\"#titles > button:nth-of-type(1)\", {\"class\": \"selected\"})\n@@ -58,6 +66,8 @@ assert-text: (\"#titles > button:nth-of-type(1)\", \"In Function Parameters\", START\n // Try with a search-by-parameter-and-return\n goto: file://|DOC_PATH|/test_docs/index.html\n write: (\".search-input\", \"pattern -> str\")\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n assert-attribute: (\"#titles > button:nth-of-type(1)\", {\"class\": \"selected\"})"}, {"sha": "8a3365d3cc25e2c90becdb28d450c275e343ebd1", "filename": "src/test/rustdoc-gui/settings.goml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsettings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0c6e01baffa5eeaa6658f065daffddf9916d0e87/src%2Ftest%2Frustdoc-gui%2Fsettings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsettings.goml?ref=0c6e01baffa5eeaa6658f065daffddf9916d0e87", "patch": "@@ -20,6 +20,8 @@ wait-for-css: (\"#settings\", {\"display\": \"none\"})\n // Let's click on it when the search results are displayed.\n focus: \".search-input\"\n write: \"test\"\n+// To be SURE that the search will be run.\n+press-key: 'Enter'\n wait-for: \"#alternative-display #search\"\n click: \"#settings-menu\"\n wait-for-css: (\"#settings\", {\"display\": \"block\"})"}]}