{"sha": "3747df71fa280557f85d847dcb460c0cbe0d16ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3NDdkZjcxZmEyODA1NTdmODVkODQ3ZGNiNDYwYzBjYmUwZDE2Y2U=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-11-12T14:49:45Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-11-12T14:49:45Z"}, "message": "Avoid installing external LLVM dylibs\n\nIf the LLVM was externally provided, then we don't currently copy artifacts into\nthe sysroot. This is not necessarily the right choice (in particular, it will\nrequire the LLVM dylib to be in the linker's load path at runtime), but the\ncommon use case for external LLVMs is distribution provided LLVMs, and in that\ncase they're usually in the standard search path (e.g., /usr/lib) and copying\nthem here is going to cause problems as we may end up with the wrong files and\nisn't what distributions want.\n\nThis behavior may be revisited in the future though.", "tree": {"sha": "b59502b9cda478895552509a723a4be3863808b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b59502b9cda478895552509a723a4be3863808b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3747df71fa280557f85d847dcb460c0cbe0d16ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3747df71fa280557f85d847dcb460c0cbe0d16ce", "html_url": "https://github.com/rust-lang/rust/commit/3747df71fa280557f85d847dcb460c0cbe0d16ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3747df71fa280557f85d847dcb460c0cbe0d16ce/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cf9cf7c923eb01146971429044f216a3ca905e06", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf9cf7c923eb01146971429044f216a3ca905e06", "html_url": "https://github.com/rust-lang/rust/commit/cf9cf7c923eb01146971429044f216a3ca905e06"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "9506a8294082dcb639502ce48ffc77893240693e", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3747df71fa280557f85d847dcb460c0cbe0d16ce/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3747df71fa280557f85d847dcb460c0cbe0d16ce/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=3747df71fa280557f85d847dcb460c0cbe0d16ce", "patch": "@@ -2335,6 +2335,22 @@ fn maybe_install_llvm(builder: &Builder<'_>, target: TargetSelection, dst_libdir\n         return;\n     }\n \n+    if let Some(config) = builder.config.target_config.get(&target) {\n+        if config.llvm_config.is_some() {\n+            // If the LLVM was externally provided, then we don't currently copy\n+            // artifacts into the sysroot. This is not necessarily the right\n+            // choice (in particular, it will require the LLVM dylib to be in\n+            // the linker's load path at runtime), but the common use case for\n+            // external LLVMs is distribution provided LLVMs, and in that case\n+            // they're usually in the standard search path (e.g., /usr/lib) and\n+            // copying them here is going to cause problems as we may end up\n+            // with the wrong files and isn't what distributions want.\n+            //\n+            // This behavior may be revisited in the future though.\n+            return;\n+        }\n+    }\n+\n     // On macOS, rustc (and LLVM tools) link to an unversioned libLLVM.dylib\n     // instead of libLLVM-11-rust-....dylib, as on linux. It's not entirely\n     // clear why this is the case, though. llvm-config will emit the versioned"}]}