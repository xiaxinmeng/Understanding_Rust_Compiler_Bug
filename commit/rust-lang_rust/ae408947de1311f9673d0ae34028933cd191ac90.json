{"sha": "ae408947de1311f9673d0ae34028933cd191ac90", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlNDA4OTQ3ZGUxMzExZjk2NzNkMGFlMzQwMjg5MzNjZDE5MWFjOTA=", "commit": {"author": {"name": "Josef Reinhard Brandl", "email": "mail@josefbrandl.de", "date": "2018-07-02T17:07:59Z"}, "committer": {"name": "Josef Reinhard Brandl", "email": "mail@josefbrandl.de", "date": "2018-07-02T17:07:59Z"}, "message": "Implement `UnsafeFutureObj` for `&mut Future`", "tree": {"sha": "7c154be8dce7c95cb96d68d79040e96c5d1f4317", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7c154be8dce7c95cb96d68d79040e96c5d1f4317"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ae408947de1311f9673d0ae34028933cd191ac90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ae408947de1311f9673d0ae34028933cd191ac90", "html_url": "https://github.com/rust-lang/rust/commit/ae408947de1311f9673d0ae34028933cd191ac90", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ae408947de1311f9673d0ae34028933cd191ac90/comments", "author": {"login": "MajorBreakfast", "id": 340142, "node_id": "MDQ6VXNlcjM0MDE0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/340142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MajorBreakfast", "html_url": "https://github.com/MajorBreakfast", "followers_url": "https://api.github.com/users/MajorBreakfast/followers", "following_url": "https://api.github.com/users/MajorBreakfast/following{/other_user}", "gists_url": "https://api.github.com/users/MajorBreakfast/gists{/gist_id}", "starred_url": "https://api.github.com/users/MajorBreakfast/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MajorBreakfast/subscriptions", "organizations_url": "https://api.github.com/users/MajorBreakfast/orgs", "repos_url": "https://api.github.com/users/MajorBreakfast/repos", "events_url": "https://api.github.com/users/MajorBreakfast/events{/privacy}", "received_events_url": "https://api.github.com/users/MajorBreakfast/received_events", "type": "User", "site_admin": false}, "committer": {"login": "MajorBreakfast", "id": 340142, "node_id": "MDQ6VXNlcjM0MDE0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/340142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MajorBreakfast", "html_url": "https://github.com/MajorBreakfast", "followers_url": "https://api.github.com/users/MajorBreakfast/followers", "following_url": "https://api.github.com/users/MajorBreakfast/following{/other_user}", "gists_url": "https://api.github.com/users/MajorBreakfast/gists{/gist_id}", "starred_url": "https://api.github.com/users/MajorBreakfast/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MajorBreakfast/subscriptions", "organizations_url": "https://api.github.com/users/MajorBreakfast/orgs", "repos_url": "https://api.github.com/users/MajorBreakfast/repos", "events_url": "https://api.github.com/users/MajorBreakfast/events{/privacy}", "received_events_url": "https://api.github.com/users/MajorBreakfast/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fde8b92372f02deaf5c7fb638447a60112f9015", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fde8b92372f02deaf5c7fb638447a60112f9015", "html_url": "https://github.com/rust-lang/rust/commit/5fde8b92372f02deaf5c7fb638447a60112f9015"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "fabeaa1c144bfbe79552cf0fbcd0fdbcf8c27fbb", "filename": "src/liballoc/boxed.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ae408947de1311f9673d0ae34028933cd191ac90/src%2Fliballoc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae408947de1311f9673d0ae34028933cd191ac90/src%2Fliballoc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fboxed.rs?ref=ae408947de1311f9673d0ae34028933cd191ac90", "patch": "@@ -933,7 +933,9 @@ impl<F: ?Sized + Future> Future for PinBox<F> {\n }\n \n #[unstable(feature = \"futures_api\", issue = \"50547\")]\n-unsafe impl<'a, T, F: Future<Output = T> + 'a> UnsafeFutureObj<'a, T> for PinBox<F> {\n+unsafe impl<'a, T, F> UnsafeFutureObj<'a, T> for PinBox<F>\n+    where F: Future<Output = T> + 'a\n+{\n     fn into_raw(self) -> *mut () {\n         PinBox::into_raw(self) as *mut ()\n     }"}, {"sha": "98c504a3f7bef380a6ca28cb044bc3c1c0bbf546", "filename": "src/libcore/future/future_obj.rs", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ae408947de1311f9673d0ae34028933cd191ac90/src%2Flibcore%2Ffuture%2Ffuture_obj.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae408947de1311f9673d0ae34028933cd191ac90/src%2Flibcore%2Ffuture%2Ffuture_obj.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ffuture%2Ffuture_obj.rs?ref=ae408947de1311f9673d0ae34028933cd191ac90", "patch": "@@ -14,7 +14,7 @@\n \n use fmt;\n use future::Future;\n-use marker::PhantomData;\n+use marker::{PhantomData, Unpin};\n use mem::PinMut;\n use task::{Context, Poll};\n \n@@ -163,3 +163,17 @@ pub unsafe trait UnsafeFutureObj<'a, T>: 'a {\n     /// other calls to `drop` or `poll`.\n     unsafe fn drop(ptr: *mut ());\n }\n+\n+unsafe impl<'a, T, F> UnsafeFutureObj<'a, T> for &'a mut F\n+    where F: Future<Output = T> + Unpin + 'a\n+{\n+    fn into_raw(self) -> *mut () {\n+        self as *mut F as *mut ()\n+    }\n+\n+    unsafe fn poll(ptr: *mut (), cx: &mut Context) -> Poll<T> {\n+        PinMut::new_unchecked(&mut *(ptr as *mut F)).poll(cx)\n+    }\n+\n+    unsafe fn drop(_ptr: *mut ()) {}\n+}"}, {"sha": "84173654655ebbe28f496e5ebbe11b040fec1835", "filename": "src/libcore/mem.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ae408947de1311f9673d0ae34028933cd191ac90/src%2Flibcore%2Fmem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae408947de1311f9673d0ae34028933cd191ac90/src%2Flibcore%2Fmem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmem.rs?ref=ae408947de1311f9673d0ae34028933cd191ac90", "patch": "@@ -1231,7 +1231,9 @@ impl<'a, T: ?Sized + Unsize<U>, U: ?Sized> CoerceUnsized<PinMut<'a, U>> for PinM\n impl<'a, T: ?Sized> Unpin for PinMut<'a, T> {}\n \n #[unstable(feature = \"futures_api\", issue = \"50547\")]\n-unsafe impl<'a, T, F: Future<Output = T> + 'a> UnsafeFutureObj<'a, T> for PinMut<'a, F> {\n+unsafe impl<'a, T, F> UnsafeFutureObj<'a, T> for PinMut<'a, F>\n+    where F: Future<Output = T> + 'a\n+{\n     fn into_raw(self) -> *mut () {\n         unsafe { PinMut::get_mut_unchecked(self) as *mut F as *mut () }\n     }"}]}