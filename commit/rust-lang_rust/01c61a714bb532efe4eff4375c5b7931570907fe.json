{"sha": "01c61a714bb532efe4eff4375c5b7931570907fe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxYzYxYTcxNGJiNTMyZWZlNGVmZjQzNzVjNWI3OTMxNTcwOTA3ZmU=", "commit": {"author": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-07-19T19:25:46Z"}, "committer": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-07-19T19:26:16Z"}, "message": "Setup automatic push of gh-pages", "tree": {"sha": "46426c075b425e6b9e63094eea7eef041cdd19b5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46426c075b425e6b9e63094eea7eef041cdd19b5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/01c61a714bb532efe4eff4375c5b7931570907fe", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJXjn7ZAAoJEF5CfHlMukXoAGcP/Rm0Px+26oigGhUAuAxJFkr3\nXt+W8AbGYpIJ6oenxxWgpnxDiBZyQ9+LXaUtitZECjIVTuT3HPPhnyAvZwwjn4ej\nF6bqeCFHY67ztsTzRJXu4jRndlOy80kvb7hwEf88UwDDzdjnfvvhTjyFYRKLFJyl\nxvfSbN+jMswlJMzvshLheyK8dfqxShyPWVQx8YOd93avmu9aQFryWo0yI13G17el\nbLtYPid5mqvBz4zdk2BDGAt9sakPDiEUl9suLJdZpIp9kHYXRThFIQw8AAJBKvin\n3NBtgwOZfXgDuegZQxCagqkGmmzXmu1+2oA9FjQLyN+D7+16t381biwK/Gzjc4a4\nRj2/Ds4wPHJyBu2pFyyD94aG08xido8WhuDXV+XlChkhrhNtuLtgQU/Y08Fa6UZI\nVeKtci8SOdZv9c4gJrTKwPSjkBQfvmbKAIi0VpZ4dEe9eLVt0rQCmptC7Rl7G2x8\nF9KjVGHkB+2N/H2XvhhbwPZHjgWoTNIEVpuYGdaVEnOKxjeZ9Db3N9LKDNBL7Lud\n14Yw/Nu6dAbmZSEqm4/g7H9bAHDBNXzWVSdcFP3gsZTr5DNLLtkbYKoiVz1gCT+0\n2p3K0FbzbUaf90JU2SB4S3VW+ZPOn3J0S3EHWrswYOZCHXMRPKit3hes+DhmorQ8\n0a5kvMxmIwYFMO0ecBoO\n=gcc+\n-----END PGP SIGNATURE-----", "payload": "tree 46426c075b425e6b9e63094eea7eef041cdd19b5\nparent c638e5b67911165b451625c4155f01d1a883a47a\nauthor mcarton <cartonmartin+git@gmail.com> 1468956346 +0200\ncommitter mcarton <cartonmartin+git@gmail.com> 1468956376 +0200\n\nSetup automatic push of gh-pages\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/01c61a714bb532efe4eff4375c5b7931570907fe", "html_url": "https://github.com/rust-lang/rust/commit/01c61a714bb532efe4eff4375c5b7931570907fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/01c61a714bb532efe4eff4375c5b7931570907fe/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c638e5b67911165b451625c4155f01d1a883a47a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c638e5b67911165b451625c4155f01d1a883a47a", "html_url": "https://github.com/rust-lang/rust/commit/c638e5b67911165b451625c4155f01d1a883a47a"}], "stats": {"total": 97, "additions": 92, "deletions": 5}, "files": [{"sha": "7b40371e01b1fccdcc9a931b1de42c99e310a46e", "filename": ".github/deploy.sh", "status": "added", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/01c61a714bb532efe4eff4375c5b7931570907fe/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/01c61a714bb532efe4eff4375c5b7931570907fe/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=01c61a714bb532efe4eff4375c5b7931570907fe", "patch": "@@ -0,0 +1,66 @@\n+#!/bin/bash\n+# Automatically deploy on gh-pages\n+\n+set -e\n+\n+SOURCE_BRANCH=\"master\"\n+TARGET_BRANCH=\"gh-pages\"\n+\n+# Save some useful information\n+REPO=$(git config remote.origin.url)\n+SSH_REPO=${REPO/https:\\/\\/github.com\\//git@github.com:}\n+SHA=$(git rev-parse --verify HEAD)\n+\n+# Clone the existing gh-pages for this repo into out/\n+(\n+    git clone \"$REPO\" out\n+    cd out\n+    git checkout $TARGET_BRANCH\n+)\n+\n+# Remove the current doc for master\n+rm -rf out/master/ || exit 0\n+\n+# Make the doc for master\n+mkdir out/master/\n+cp util/gh-pages/index.html out/master\n+./util/export.py out/master/lints.json\n+\n+# Save the doc for the current tag and point current/ to it\n+if [ -n \"$TRAVIS_TAG\" ]; then\n+    cp -r out/master \"out/$TRAVIS_TAG\"\n+    rm -f out/current\n+    ln -s \"$TRAVIS_TAG\" out/current\n+fi\n+\n+# Pull requests and commits to other branches shouldn't try to deploy, just build to verify\n+if [ \"$TRAVIS_PULL_REQUEST\" != \"false\" ] || [ \"$TRAVIS_BRANCH\" != \"$SOURCE_BRANCH\" ]; then\n+    echo \"Generated, won't push\"\n+    exit 0\n+fi\n+\n+# Now let's go have some fun with the cloned repo\n+cd out\n+git config user.name \"Travis CI\"\n+git config user.email \"travis@ci.invalid\"\n+\n+if [ -z \"$(git diff --exit-code)\" ]; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+fi\n+\n+git add .\n+git commit -m \"Automatic deploy to GitHub Pages: ${SHA}\"\n+\n+# Get the deploy key by using Travis's stored variables to decrypt deploy_key.enc\n+ENCRYPTED_KEY_VAR=\"encrypted_${ENCRYPTION_LABEL}_key\"\n+ENCRYPTED_IV_VAR=\"encrypted_${ENCRYPTION_LABEL}_iv\"\n+ENCRYPTED_KEY=${!ENCRYPTED_KEY_VAR}\n+ENCRYPTED_IV=${!ENCRYPTED_IV_VAR}\n+openssl aes-256-cbc -K \"$ENCRYPTED_KEY\" -iv \"$ENCRYPTED_IV\" -in deploy_key.enc -out deploy_key -d\n+chmod 600 deploy_key\n+eval $(ssh-agent -s)\n+ssh-add deploy_key\n+\n+# Now that we're all set up, we can push.\n+git push \"$SSH_REPO\" \"$TARGET_BRANCH\""}, {"sha": "48cb3f5a1276dfdacef1d54cecd1ded0911738a8", "filename": ".github/deploy_key.enc", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/01c61a714bb532efe4eff4375c5b7931570907fe/.github%2Fdeploy_key.enc", "raw_url": "https://github.com/rust-lang/rust/raw/01c61a714bb532efe4eff4375c5b7931570907fe/.github%2Fdeploy_key.enc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy_key.enc?ref=01c61a714bb532efe4eff4375c5b7931570907fe"}, {"sha": "0206d9dc963652a97305f3d6f0d572e9d8817f67", "filename": ".gitignore", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/01c61a714bb532efe4eff4375c5b7931570907fe/.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/01c61a714bb532efe4eff4375c5b7931570907fe/.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.gitignore?ref=01c61a714bb532efe4eff4375c5b7931570907fe", "patch": "@@ -1,3 +1,7 @@\n+# Used by Travis to be able to push:\n+/.github/deploy_key\n+out\n+\n # Compiled files\n *.o\n *.so"}, {"sha": "558209eee4d3f02d9bcf22bb46563e3cd5efd858", "filename": "util/export.py", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/01c61a714bb532efe4eff4375c5b7931570907fe/util%2Fexport.py", "raw_url": "https://github.com/rust-lang/rust/raw/01c61a714bb532efe4eff4375c5b7931570907fe/util%2Fexport.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fexport.py?ref=01c61a714bb532efe4eff4375c5b7931570907fe", "patch": "@@ -1,8 +1,11 @@\n #!/usr/bin/env python\n+# Build the gh-pages\n \n+import json\n import os\n import re\n-import json\n+import sys\n+\n \n level_re = re.compile(r'''(Forbid|Deny|Warn|Allow)''')\n conf_re = re.compile(r'''define_Conf! {\\n([^}]*)\\n}''', re.MULTILINE)\n@@ -15,10 +18,19 @@\n * `%s: %s`: %s (defaults to `%s`).\n \"\"\"\n \n+\n # TODO: actual logging\n-def warn(*args): print(args)\n-def debug(*args): print(args)\n-def info(*args): print(args)\n+def warn(*args):\n+    print(*args)\n+\n+\n+def debug(*args):\n+    print(*args)\n+\n+\n+def info(*args):\n+    print(*args)\n+\n \n def parse_path(p=\"clippy_lints/src\"):\n     lints = []\n@@ -52,6 +64,7 @@ def parse_conf(p):\n \n     return c\n \n+\n def parseLintDef(level, comment, name):\n     lint = {}\n     lint['id'] = name\n@@ -80,6 +93,7 @@ def parseLintDef(level, comment, name):\n \n     return lint\n \n+\n def parse_file(d, f):\n     last_comment = []\n     comment = True\n@@ -134,10 +148,13 @@ def parse_file(d, f):\n                     warn(\"Warning: Missing Lint-Name in\", f)\n                     comment = True\n \n+\n def main():\n     lints = parse_path()\n     info(\"got %s lints\" % len(lints))\n-    with open(\"util/gh-pages/lints.json\", \"w\") as file:\n+\n+    outdir = sys.argv[1] if len(sys.argv) > 1 else \"util/gh-pages/lints.json\"\n+    with open(outdir, \"w\") as file:\n         json.dump(lints, file, indent=2)\n         info(\"wrote JSON for great justice\")\n "}]}