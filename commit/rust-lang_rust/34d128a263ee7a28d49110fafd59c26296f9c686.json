{"sha": "34d128a263ee7a28d49110fafd59c26296f9c686", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0ZDEyOGEyNjNlZTdhMjhkNDkxMTBmYWZkNTljMjYyOTZmOWM2ODY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-01-08T21:54:35Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-01-09T13:59:37Z"}, "message": "Replace under-used ImplPolarity enum with a boolean", "tree": {"sha": "ba9009ee3d100055ea7b473282da32d59c1d2c4a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba9009ee3d100055ea7b473282da32d59c1d2c4a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34d128a263ee7a28d49110fafd59c26296f9c686", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34d128a263ee7a28d49110fafd59c26296f9c686", "html_url": "https://github.com/rust-lang/rust/commit/34d128a263ee7a28d49110fafd59c26296f9c686", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34d128a263ee7a28d49110fafd59c26296f9c686/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3338bdb23d631a13fbdebffcb0aca54dfa8cca51", "url": "https://api.github.com/repos/rust-lang/rust/commits/3338bdb23d631a13fbdebffcb0aca54dfa8cca51", "html_url": "https://github.com/rust-lang/rust/commit/3338bdb23d631a13fbdebffcb0aca54dfa8cca51"}], "stats": {"total": 59, "additions": 27, "deletions": 32}, "files": [{"sha": "43fb53ba18fdae738b8a515d00d583153b631dc2", "filename": "src/librustdoc/clean/auto_trait.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Fauto_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Fauto_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fauto_trait.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -84,14 +84,14 @@ impl<'a, 'tcx> AutoTraitFinder<'a, 'tcx> {\n                         new_generics\n                     });\n \n-                let polarity;\n+                let negative_polarity;\n                 let new_generics = match result {\n                     AutoTraitResult::PositiveImpl(new_generics) => {\n-                        polarity = None;\n+                        negative_polarity = false;\n                         new_generics\n                     }\n                     AutoTraitResult::NegativeImpl => {\n-                        polarity = Some(ImplPolarity::Negative);\n+                        negative_polarity = true;\n \n                         // For negative impls, we use the generic params, but *not* the predicates,\n                         // from the original type. Otherwise, the displayed impl appears to be a\n@@ -130,7 +130,7 @@ impl<'a, 'tcx> AutoTraitFinder<'a, 'tcx> {\n                         trait_: Some(trait_ref.clean(self.cx).get_trait_type().unwrap()),\n                         for_: ty.clean(self.cx),\n                         items: Vec::new(),\n-                        polarity,\n+                        negative_polarity,\n                         synthetic: true,\n                         blanket_impl: None,\n                     }),"}, {"sha": "f1c26feea46ec4376675ea9036e9dc4733fcdafe", "filename": "src/librustdoc/clean/blanket_impl.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Fblanket_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Fblanket_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fblanket_impl.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -131,7 +131,7 @@ impl<'a, 'tcx> BlanketImplFinder<'a, 'tcx> {\n                             .in_definition_order()\n                             .collect::<Vec<_>>()\n                             .clean(self.cx),\n-                        polarity: None,\n+                        negative_polarity: false,\n                         synthetic: false,\n                         blanket_impl: Some(trait_ref.self_ty().clean(self.cx)),\n                     }),"}, {"sha": "34629211ee441311a056d18b7283615f385877fe", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -428,7 +428,7 @@ crate fn build_impl(\n             trait_,\n             for_,\n             items: trait_items,\n-            polarity: Some(polarity.clean(cx)),\n+            negative_polarity: polarity.clean(cx),\n             synthetic: false,\n             blanket_impl: None,\n         }),"}, {"sha": "14564e7f64aa5acc71311609a7014cbf8b8d890b", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -2069,13 +2069,14 @@ impl Clean<Item> for hir::Variant<'_> {\n     }\n }\n \n-impl Clean<ImplPolarity> for ty::ImplPolarity {\n-    fn clean(&self, _: &DocContext<'_>) -> ImplPolarity {\n+impl Clean<bool> for ty::ImplPolarity {\n+    /// Returns whether the impl has negative polarity.\n+    fn clean(&self, _: &DocContext<'_>) -> bool {\n         match self {\n             &ty::ImplPolarity::Positive |\n             // FIXME: do we want to do something else here?\n-            &ty::ImplPolarity::Reservation => ImplPolarity::Positive,\n-            &ty::ImplPolarity::Negative => ImplPolarity::Negative,\n+            &ty::ImplPolarity::Reservation => false,\n+            &ty::ImplPolarity::Negative => true,\n         }\n     }\n }\n@@ -2116,7 +2117,7 @@ fn clean_impl(impl_: &hir::Item<'_>, cx: &DocContext<'_>) -> Vec<Item> {\n             trait_,\n             for_,\n             items,\n-            polarity: Some(cx.tcx.impl_polarity(def_id).clean(cx)),\n+            negative_polarity: cx.tcx.impl_polarity(def_id).clean(cx),\n             synthetic: false,\n             blanket_impl: None,\n         });"}, {"sha": "7e567bedc7875a8ce52665569d80e95dfa7cf494", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -175,9 +175,11 @@ impl Item {\n     }\n \n     crate fn is_crate(&self) -> bool {\n-        matches!(*self.kind,\n+        matches!(\n+            *self.kind,\n             StrippedItem(box ModuleItem(Module { is_crate: true, .. }))\n-            | ModuleItem(Module { is_crate: true, .. }))\n+                | ModuleItem(Module { is_crate: true, .. })\n+        )\n     }\n     crate fn is_mod(&self) -> bool {\n         self.type_() == ItemType::Module\n@@ -1858,12 +1860,6 @@ crate struct Constant {\n     crate is_literal: bool,\n }\n \n-#[derive(Clone, PartialEq, Debug)]\n-crate enum ImplPolarity {\n-    Positive,\n-    Negative,\n-}\n-\n #[derive(Clone, Debug)]\n crate struct Impl {\n     crate unsafety: hir::Unsafety,\n@@ -1872,7 +1868,7 @@ crate struct Impl {\n     crate trait_: Option<Type>,\n     crate for_: Type,\n     crate items: Vec<Item>,\n-    crate polarity: Option<ImplPolarity>,\n+    crate negative_polarity: bool,\n     crate synthetic: bool,\n     crate blanket_impl: Option<Type>,\n }"}, {"sha": "5c2adca3126f71da5bb188dcc7df18d476b577b3", "filename": "src/librustdoc/html/format.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fformat.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -870,7 +870,7 @@ impl clean::Impl {\n             }\n \n             if let Some(ref ty) = self.trait_ {\n-                if self.polarity == Some(clean::ImplPolarity::Negative) {\n+                if self.negative_polarity {\n                     write!(f, \"!\")?;\n                 }\n "}, {"sha": "6a32be609911adb590160926c9dbc5d06c042977", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -4327,16 +4327,15 @@ fn sidebar_assoc_items(cx: &Context<'_>, it: &clean::Item) -> String {\n \n                 let mut ret = impls\n                     .iter()\n-                    .filter_map(|i| {\n-                        let is_negative_impl = is_negative_impl(i.inner_impl());\n-                        if let Some(ref i) = i.inner_impl().trait_ {\n+                    .filter_map(|it| {\n+                        if let Some(ref i) = it.inner_impl().trait_ {\n                             let i_display = format!(\"{:#}\", i.print());\n                             let out = Escape(&i_display);\n                             let encoded = small_url_encode(&format!(\"{:#}\", i.print()));\n                             let generated = format!(\n                                 \"<a href=\\\"#impl-{}\\\">{}{}</a>\",\n                                 encoded,\n-                                if is_negative_impl { \"!\" } else { \"\" },\n+                                if it.inner_impl().negative_polarity { \"!\" } else { \"\" },\n                                 out\n                             );\n                             if links.insert(generated.clone()) { Some(generated) } else { None }\n@@ -4503,10 +4502,6 @@ fn extract_for_impl_name(item: &clean::Item) -> Option<(String, String)> {\n     }\n }\n \n-fn is_negative_impl(i: &clean::Impl) -> bool {\n-    i.polarity == Some(clean::ImplPolarity::Negative)\n-}\n-\n fn sidebar_trait(cx: &Context<'_>, buf: &mut Buffer, it: &clean::Item, t: &clean::Trait) {\n     let mut sidebar = String::new();\n "}, {"sha": "5dea64ef145871a72b7ab42eb03f59fd7682433e", "filename": "src/librustdoc/json/conversions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fjson%2Fconversions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Fjson%2Fconversions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fjson%2Fconversions.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -422,7 +422,7 @@ impl From<clean::Impl> for Impl {\n             trait_,\n             for_,\n             items,\n-            polarity,\n+            negative_polarity,\n             synthetic,\n             blanket_impl,\n         } = impl_;\n@@ -436,7 +436,7 @@ impl From<clean::Impl> for Impl {\n             trait_: trait_.map(Into::into),\n             for_: for_.into(),\n             items: ids(items),\n-            negative: polarity == Some(clean::ImplPolarity::Negative),\n+            negative: negative_polarity,\n             synthetic,\n             blanket_impl: blanket_impl.map(Into::into),\n         }"}, {"sha": "24d5770541273da00532a6e290c8e71d41b6dec8", "filename": "src/librustdoc/theme.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Ftheme.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d128a263ee7a28d49110fafd59c26296f9c686/src%2Flibrustdoc%2Ftheme.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftheme.rs?ref=34d128a263ee7a28d49110fafd59c26296f9c686", "patch": "@@ -70,7 +70,10 @@ impl Events {\n     }\n \n     fn is_comment(&self) -> bool {\n-        matches!(self, Events::StartLineComment(_) | Events::StartComment(_) | Events::EndComment(_))\n+        matches!(\n+            self,\n+            Events::StartLineComment(_) | Events::StartComment(_) | Events::EndComment(_)\n+        )\n     }\n }\n "}]}