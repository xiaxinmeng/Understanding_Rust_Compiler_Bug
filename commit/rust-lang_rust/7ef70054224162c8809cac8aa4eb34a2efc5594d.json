{"sha": "7ef70054224162c8809cac8aa4eb34a2efc5594d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlZjcwMDU0MjI0MTYyYzg4MDljYWM4YWE0ZWIzNGEyZWZjNTU5NGQ=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2019-11-26T23:56:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-11-26T23:56:11Z"}, "message": "Rollup merge of #66713 - hermitcore:hermit, r=alexcrichton\n\nintroduce a target to build the kernel of the unikernel HermitCore\n\nWe are developing the unikernel HermitCore, where the kernel is written in Rust and is already supported by the Rust Standard Library. To compile the kernel with the new build flag \"-Z build-std\", we introduce a new target, which avoids the usage of SSE & AVX within the kernel.", "tree": {"sha": "21c7e591395dfd372f103322c10cabd493678856", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/21c7e591395dfd372f103322c10cabd493678856"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7ef70054224162c8809cac8aa4eb34a2efc5594d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd3bucCRBK7hj4Ov3rIwAAdHIIABB8Av3a/kfyHx5Rk6dg2ATJ\neD6/4jLeMOKp1I++u8YCMDeitCnm7L4tLwv9er6jz/9QeEsvGXOS0jBAdbGQGaz0\nq3dlmHW8fQHnFH4N2EpyURxkX/fp7mKnmUDwS/7dmIopeFj7ctFs7j6pQZ5zMqUi\nw9wC2APM2A8WhlHmdnopENzLP+akuuL9DRL7lWzQcI2+NmyAHI2NEWBt/qrN5l36\nFgFjRLkEc2lw+idGEs5YBxqNwhhY+LeCNVsFFaaVTt7yQfq0YTFpMpR/Zav+++V5\nI7xkFjzW80Av9d2AaSF7GgMmi2z2m3KzmOOlK+yXREMeJ1P0r/zFr+jKN+W8+jE=\n=yKfv\n-----END PGP SIGNATURE-----\n", "payload": "tree 21c7e591395dfd372f103322c10cabd493678856\nparent 9e2802b57bbf83d28afd114321daa609f023b33c\nparent 55ce5c09ff501d14ef2cce4498267372450a60d1\nauthor Tyler Mandry <tmandry@gmail.com> 1574812571 -0600\ncommitter GitHub <noreply@github.com> 1574812571 -0600\n\nRollup merge of #66713 - hermitcore:hermit, r=alexcrichton\n\nintroduce a target to build the kernel of the unikernel HermitCore\n\nWe are developing the unikernel HermitCore, where the kernel is written in Rust and is already supported by the Rust Standard Library. To compile the kernel with the new build flag \"-Z build-std\", we introduce a new target, which avoids the usage of SSE & AVX within the kernel.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7ef70054224162c8809cac8aa4eb34a2efc5594d", "html_url": "https://github.com/rust-lang/rust/commit/7ef70054224162c8809cac8aa4eb34a2efc5594d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7ef70054224162c8809cac8aa4eb34a2efc5594d/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e2802b57bbf83d28afd114321daa609f023b33c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e2802b57bbf83d28afd114321daa609f023b33c", "html_url": "https://github.com/rust-lang/rust/commit/9e2802b57bbf83d28afd114321daa609f023b33c"}, {"sha": "55ce5c09ff501d14ef2cce4498267372450a60d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/55ce5c09ff501d14ef2cce4498267372450a60d1", "html_url": "https://github.com/rust-lang/rust/commit/55ce5c09ff501d14ef2cce4498267372450a60d1"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "ad1027c7bc775ecf2f246a788318704c0239aa84", "filename": "src/librustc_target/spec/hermit_kernel_base.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/7ef70054224162c8809cac8aa4eb34a2efc5594d/src%2Flibrustc_target%2Fspec%2Fhermit_kernel_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ef70054224162c8809cac8aa4eb34a2efc5594d/src%2Flibrustc_target%2Fspec%2Fhermit_kernel_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fhermit_kernel_base.rs?ref=7ef70054224162c8809cac8aa4eb34a2efc5594d", "patch": "@@ -0,0 +1,27 @@\n+use crate::spec::{LldFlavor, LinkArgs, LinkerFlavor, PanicStrategy, TargetOptions};\n+use std::default::Default;\n+\n+pub fn opts() -> TargetOptions {\n+    let mut pre_link_args = LinkArgs::new();\n+    pre_link_args.insert(LinkerFlavor::Lld(LldFlavor::Ld), vec![\n+        \"--build-id\".to_string(),\n+        \"--hash-style=gnu\".to_string(),\n+        \"--Bstatic\".to_string(),\n+    ]);\n+\n+    TargetOptions {\n+        disable_redzone: true,\n+        linker: Some(\"rust-lld\".to_owned()),\n+        executables: true,\n+        has_elf_tls: true,\n+        linker_is_gnu: true,\n+        pre_link_args,\n+        no_default_libraries: true,\n+        panic_strategy: PanicStrategy::Abort,\n+        position_independent_executables: true,\n+        relocation_model: \"static\".to_string(),\n+        target_family: None,\n+        tls_model: \"initial-exec\".to_string(),\n+        .. Default::default()\n+    }\n+}"}, {"sha": "29076254584c0cac200db10112c25deabbe0d712", "filename": "src/librustc_target/spec/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ef70054224162c8809cac8aa4eb34a2efc5594d/src%2Flibrustc_target%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ef70054224162c8809cac8aa4eb34a2efc5594d/src%2Flibrustc_target%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fmod.rs?ref=7ef70054224162c8809cac8aa4eb34a2efc5594d", "patch": "@@ -54,6 +54,7 @@ mod dragonfly_base;\n mod freebsd_base;\n mod haiku_base;\n mod hermit_base;\n+mod hermit_kernel_base;\n mod linux_base;\n mod linux_kernel_base;\n mod linux_musl_base;\n@@ -481,6 +482,7 @@ supported_targets! {\n \n     (\"aarch64-unknown-hermit\", aarch64_unknown_hermit),\n     (\"x86_64-unknown-hermit\", x86_64_unknown_hermit),\n+    (\"x86_64-unknown-hermit-kernel\", x86_64_unknown_hermit_kernel),\n \n     (\"riscv32i-unknown-none-elf\", riscv32i_unknown_none_elf),\n     (\"riscv32imc-unknown-none-elf\", riscv32imc_unknown_none_elf),"}, {"sha": "ebaada8f4f8eb86dffbd567ce3a7f28bb7bfd16f", "filename": "src/librustc_target/spec/x86_64_unknown_hermit_kernel.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/7ef70054224162c8809cac8aa4eb34a2efc5594d/src%2Flibrustc_target%2Fspec%2Fx86_64_unknown_hermit_kernel.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ef70054224162c8809cac8aa4eb34a2efc5594d/src%2Flibrustc_target%2Fspec%2Fx86_64_unknown_hermit_kernel.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fx86_64_unknown_hermit_kernel.rs?ref=7ef70054224162c8809cac8aa4eb34a2efc5594d", "patch": "@@ -0,0 +1,25 @@\n+use crate::spec::{LldFlavor, LinkerFlavor, Target, TargetResult};\n+\n+pub fn target() -> TargetResult {\n+    let mut base = super::hermit_kernel_base::opts();\n+    base.cpu = \"x86-64\".to_string();\n+    base.max_atomic_width = Some(64);\n+    base.features =\n+        \"-mmx,-sse,-sse2,-sse3,-ssse3,-sse4.1,-sse4.2,-3dnow,-3dnowa,-avx,-avx2,+soft-float\"\n+        .to_string();\n+    base.stack_probes = true;\n+\n+    Ok(Target {\n+        llvm_target: \"x86_64-unknown-hermit\".to_string(),\n+        target_endian: \"little\".to_string(),\n+        target_pointer_width: \"64\".to_string(),\n+        target_c_int_width: \"32\".to_string(),\n+        data_layout: \"e-m:e-i64:64-f80:128-n8:16:32:64-S128\".to_string(),\n+        arch: \"x86_64\".to_string(),\n+        target_os: \"hermit\".to_string(),\n+        target_env: String::new(),\n+        target_vendor: \"unknown\".to_string(),\n+        linker_flavor: LinkerFlavor::Lld(LldFlavor::Ld),\n+        options: base,\n+    })\n+}"}]}