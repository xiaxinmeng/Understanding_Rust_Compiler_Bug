{"sha": "c847a01a3b1f620c4fdb98c75805033e768975d1", "node_id": "C_kwDOAAsO6NoAKGM4NDdhMDFhM2IxZjYyMGM0ZmRiOThjNzU4MDUwMzNlNzY4OTc1ZDE", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-01-17T01:50:45Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-01-17T01:58:37Z"}, "message": "Emit fewer errors on patterns with possible type ascription", "tree": {"sha": "85d60ad025831d5a45300a39d385614e1b645ddf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/85d60ad025831d5a45300a39d385614e1b645ddf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c847a01a3b1f620c4fdb98c75805033e768975d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c847a01a3b1f620c4fdb98c75805033e768975d1", "html_url": "https://github.com/rust-lang/rust/commit/c847a01a3b1f620c4fdb98c75805033e768975d1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c847a01a3b1f620c4fdb98c75805033e768975d1/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d824206655bfb26cb5eed43490ee396542b153e", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d824206655bfb26cb5eed43490ee396542b153e", "html_url": "https://github.com/rust-lang/rust/commit/2d824206655bfb26cb5eed43490ee396542b153e"}], "stats": {"total": 37, "additions": 8, "deletions": 29}, "files": [{"sha": "eda7046c748e5f52121854349a3fa6f903e502d2", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c847a01a3b1f620c4fdb98c75805033e768975d1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c847a01a3b1f620c4fdb98c75805033e768975d1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=c847a01a3b1f620c4fdb98c75805033e768975d1", "patch": "@@ -2500,6 +2500,8 @@ impl<'a> Parser<'a> {\n                     Ok(ty) => {\n                         err.span_label(ty.span, \"specifying the type of a pattern isn't supported\");\n                         self.restore_snapshot(snapshot_type);\n+                        let new_span = first_pat.span.to(ty.span);\n+                        first_pat = self.mk_pat(new_span, PatKind::Wild);\n                     }\n                 }\n                 err.emit();"}, {"sha": "56b8a3d43bedf674eb4a879fea8252e8f2f9273e", "filename": "tests/ui/parser/anon-enums.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fanon-enums.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fanon-enums.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fanon-enums.rs?ref=c847a01a3b1f620c4fdb98c75805033e768975d1", "patch": "@@ -3,7 +3,6 @@ fn foo(x: bool | i32) -> i32 | f64 {\n //~| ERROR anonymous enums are not supported\n     match x {\n         x: i32 => x, //~ ERROR expected\n-        //~^ ERROR failed to resolve\n         true => 42.,\n         false => 0.333,\n     }\n@@ -14,6 +13,5 @@ fn main() {\n         42: i32 => (), //~ ERROR expected\n         _: f64 => (), //~ ERROR expected\n         x: i32 => (), //~ ERROR expected\n-        //~^ ERROR failed to resolve\n     }\n }"}, {"sha": "841582256609121d41403607a0fe2d2a1b43c65c", "filename": "tests/ui/parser/anon-enums.stderr", "status": "modified", "additions": 4, "deletions": 17, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fanon-enums.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fanon-enums.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fanon-enums.stderr?ref=c847a01a3b1f620c4fdb98c75805033e768975d1", "patch": "@@ -36,23 +36,23 @@ LL |         x::i32 => x,\n    |          ~~\n \n error: expected one of `...`, `..=`, `..`, or `|`, found `:`\n-  --> $DIR/anon-enums.rs:14:11\n+  --> $DIR/anon-enums.rs:13:11\n    |\n LL |         42: i32 => (),\n    |           ^ --- specifying the type of a pattern isn't supported\n    |           |\n    |           expected one of `...`, `..=`, `..`, or `|`\n \n error: expected `|`, found `:`\n-  --> $DIR/anon-enums.rs:15:10\n+  --> $DIR/anon-enums.rs:14:10\n    |\n LL |         _: f64 => (),\n    |          ^ --- specifying the type of a pattern isn't supported\n    |          |\n    |          expected `|`\n \n error: expected one of `@` or `|`, found `:`\n-  --> $DIR/anon-enums.rs:16:10\n+  --> $DIR/anon-enums.rs:15:10\n    |\n LL |         x: i32 => (),\n    |          ^ --- specifying the type of a pattern isn't supported\n@@ -64,18 +64,5 @@ help: maybe write a path separator here\n LL |         x::i32 => (),\n    |          ~~\n \n-error[E0433]: failed to resolve: use of undeclared crate or module `x`\n-  --> $DIR/anon-enums.rs:5:9\n-   |\n-LL |         x: i32 => x,\n-   |         ^ use of undeclared crate or module `x`\n-\n-error[E0433]: failed to resolve: use of undeclared crate or module `x`\n-  --> $DIR/anon-enums.rs:16:9\n-   |\n-LL |         x: i32 => (),\n-   |         ^ use of undeclared crate or module `x`\n-\n-error: aborting due to 8 previous errors\n+error: aborting due to 6 previous errors\n \n-For more information about this error, try `rustc --explain E0433`."}, {"sha": "e1ea38f2795df698983f335bbf6b77f13d29dad1", "filename": "tests/ui/parser/issues/issue-87086-colon-path-sep.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.rs?ref=c847a01a3b1f620c4fdb98c75805033e768975d1", "patch": "@@ -68,7 +68,6 @@ fn main() {\n         Foo:Bar::Baz => {}\n         //~^ ERROR: expected one of\n         //~| HELP: maybe write a path separator here\n-        //~| ERROR: failed to resolve: `Bar` is a variant, not a module\n     }\n     match myfoo {\n         Foo::Bar => {}"}, {"sha": "63b072ac4cdc68c6c4f9ec8734f49945c45de38e", "filename": "tests/ui/parser/issues/issue-87086-colon-path-sep.stderr", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c847a01a3b1f620c4fdb98c75805033e768975d1/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.stderr?ref=c847a01a3b1f620c4fdb98c75805033e768975d1", "patch": "@@ -103,7 +103,7 @@ LL |         Foo::Bar::Baz => {}\n    |            ~~\n \n error: expected one of `@` or `|`, found `:`\n-  --> $DIR/issue-87086-colon-path-sep.rs:75:12\n+  --> $DIR/issue-87086-colon-path-sep.rs:74:12\n    |\n LL |         Foo:Bar => {}\n    |            ^--- specifying the type of a pattern isn't supported\n@@ -115,12 +115,5 @@ help: maybe write a path separator here\n LL |         Foo::Bar => {}\n    |            ~~\n \n-error[E0433]: failed to resolve: `Bar` is a variant, not a module\n-  --> $DIR/issue-87086-colon-path-sep.rs:68:13\n-   |\n-LL |         Foo:Bar::Baz => {}\n-   |             ^^^ `Bar` is a variant, not a module\n-\n-error: aborting due to 10 previous errors\n+error: aborting due to 9 previous errors\n \n-For more information about this error, try `rustc --explain E0433`."}]}