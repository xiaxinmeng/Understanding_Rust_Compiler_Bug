{"sha": "722bc0c8ee92b391ddf6bd77f43fae1432d9234f", "node_id": "C_kwDOAAsO6NoAKDcyMmJjMGM4ZWU5MmIzOTFkZGY2YmQ3N2Y0M2ZhZTE0MzJkOTIzNGY", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-01-02T23:39:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-02T23:39:16Z"}, "message": "Rollup merge of #95985 - jihiggins:issue-66481, r=dtolnay\n\nAdd PhantomData marker to Context to make Context !Send and !Sync\n\nAdds `PhantomData<*mut ()>` to `Context` in order to allow for future `!Send` or `!Sync` additions to `Context`'s fields. This would allow for things like future single threaded async executor optimizations, or (re)adding `LocalWaker`, etc.\n\nCloses #66481.\n\nPer https://github.com/rust-lang/rust/issues/66481#issuecomment-561289725, this is a breaking change that needs a Crater run as the next step.\n\n(So far have tested the change locally with `cargotest` on WSL)", "tree": {"sha": "77a4027bd7c35a6a61acba1232d495f6198b5140", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77a4027bd7c35a6a61acba1232d495f6198b5140"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/722bc0c8ee92b391ddf6bd77f43fae1432d9234f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjs2skCRBK7hj4Ov3rIwAAy1EIAAm4k9aCNEtk+ei4R/iWruf6\nIiXUfU66gWo8SeMUKKvHWM8vqWyGG4VvNPnMCsUZW1ah/LX4kJ2cvLf0EkqU6Jfw\nk/YQLXLyFOMTrGbKFaViNZqYA5FZ33cskNj2aoCqS9owcDHmM6fmDiKFthg78cVb\nPl9dg0KvxL07eVpqmya+hjhPXGBNg4mBAR1EtoQv7DJJkA+0sjqYFcVUK8wN+0gU\ng5q3VR0UTbAdNJCYUeT0QgmF2EG3liKeIJ4rrXDSkZsvB+kgHO995VKvsFScqWS8\nqnQS4uBScNPtifW4M7ygtPAfdAcUfAc/V2hnJFU7n1orc3MnPkpDOlEkaNBr9sY=\n=djrd\n-----END PGP SIGNATURE-----\n", "payload": "tree 77a4027bd7c35a6a61acba1232d495f6198b5140\nparent d6f99e535a301a421dfee52a7c25bb4bdf420344\nparent 257e766c0c17c1a3561a509c931cf89bce27dcf5\nauthor Michael Goulet <michael@errs.io> 1672702756 -0800\ncommitter GitHub <noreply@github.com> 1672702756 -0800\n\nRollup merge of #95985 - jihiggins:issue-66481, r=dtolnay\n\nAdd PhantomData marker to Context to make Context !Send and !Sync\n\nAdds `PhantomData<*mut ()>` to `Context` in order to allow for future `!Send` or `!Sync` additions to `Context`'s fields. This would allow for things like future single threaded async executor optimizations, or (re)adding `LocalWaker`, etc.\n\nCloses #66481.\n\nPer https://github.com/rust-lang/rust/issues/66481#issuecomment-561289725, this is a breaking change that needs a Crater run as the next step.\n\n(So far have tested the change locally with `cargotest` on WSL)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/722bc0c8ee92b391ddf6bd77f43fae1432d9234f", "html_url": "https://github.com/rust-lang/rust/commit/722bc0c8ee92b391ddf6bd77f43fae1432d9234f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/722bc0c8ee92b391ddf6bd77f43fae1432d9234f/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d6f99e535a301a421dfee52a7c25bb4bdf420344", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6f99e535a301a421dfee52a7c25bb4bdf420344", "html_url": "https://github.com/rust-lang/rust/commit/d6f99e535a301a421dfee52a7c25bb4bdf420344"}, {"sha": "257e766c0c17c1a3561a509c931cf89bce27dcf5", "url": "https://api.github.com/repos/rust-lang/rust/commits/257e766c0c17c1a3561a509c931cf89bce27dcf5", "html_url": "https://github.com/rust-lang/rust/commit/257e766c0c17c1a3561a509c931cf89bce27dcf5"}], "stats": {"total": 13, "additions": 6, "deletions": 7}, "files": [{"sha": "a4425fd234a4e22ad79ee3dfd4418464d80723ae", "filename": "library/core/src/task/wake.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/722bc0c8ee92b391ddf6bd77f43fae1432d9234f/library%2Fcore%2Fsrc%2Ftask%2Fwake.rs", "raw_url": "https://github.com/rust-lang/rust/raw/722bc0c8ee92b391ddf6bd77f43fae1432d9234f/library%2Fcore%2Fsrc%2Ftask%2Fwake.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Ftask%2Fwake.rs?ref=722bc0c8ee92b391ddf6bd77f43fae1432d9234f", "patch": "@@ -181,6 +181,9 @@ pub struct Context<'a> {\n     // are contravariant while return-position lifetimes are\n     // covariant).\n     _marker: PhantomData<fn(&'a ()) -> &'a ()>,\n+    // Ensure `Context` is `!Send` and `!Sync` in order to allow\n+    // for future `!Send` and / or `!Sync` fields.\n+    _marker2: PhantomData<*mut ()>,\n }\n \n impl<'a> Context<'a> {\n@@ -190,7 +193,7 @@ impl<'a> Context<'a> {\n     #[must_use]\n     #[inline]\n     pub const fn from_waker(waker: &'a Waker) -> Self {\n-        Context { waker, _marker: PhantomData }\n+        Context { waker, _marker: PhantomData, _marker2: PhantomData }\n     }\n \n     /// Returns a reference to the [`Waker`] for the current task."}, {"sha": "163b34c9648529463304ec451c8cbff083d2159c", "filename": "library/core/tests/task.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/722bc0c8ee92b391ddf6bd77f43fae1432d9234f/library%2Fcore%2Ftests%2Ftask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/722bc0c8ee92b391ddf6bd77f43fae1432d9234f/library%2Fcore%2Ftests%2Ftask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Ftask.rs?ref=722bc0c8ee92b391ddf6bd77f43fae1432d9234f", "patch": "@@ -1,4 +1,4 @@\n-use core::task::{Context, Poll, RawWaker, RawWakerVTable, Waker};\n+use core::task::{Poll, RawWaker, RawWakerVTable, Waker};\n \n #[test]\n fn poll_const() {\n@@ -21,9 +21,5 @@ fn waker_const() {\n \n     static WAKER: Waker = unsafe { Waker::from_raw(VOID_WAKER) };\n \n-    static CONTEXT: Context<'static> = Context::from_waker(&WAKER);\n-\n-    static WAKER_REF: &'static Waker = CONTEXT.waker();\n-\n-    WAKER_REF.wake_by_ref();\n+    WAKER.wake_by_ref();\n }"}]}