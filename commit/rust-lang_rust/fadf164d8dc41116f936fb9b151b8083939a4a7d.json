{"sha": "fadf164d8dc41116f936fb9b151b8083939a4a7d", "node_id": "C_kwDOAAsO6NoAKGZhZGYxNjRkOGRjNDExMTZmOTM2ZmI5YjE1MWI4MDgzOTM5YTRhN2Q", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-31T23:15:52Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-31T23:15:52Z"}, "message": "Auto merge of #109165 - aliemjay:fix-ice-annotation, r=davidtwco\n\nallow ReError in CanonicalUserTypeAnnotation\n\nWhy not? we already allow `TyKind::Error`.\n\nFixes #109072.", "tree": {"sha": "2ce16df93b98a42d50073a86431df55c7ba25d9f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2ce16df93b98a42d50073a86431df55c7ba25d9f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fadf164d8dc41116f936fb9b151b8083939a4a7d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fadf164d8dc41116f936fb9b151b8083939a4a7d", "html_url": "https://github.com/rust-lang/rust/commit/fadf164d8dc41116f936fb9b151b8083939a4a7d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fadf164d8dc41116f936fb9b151b8083939a4a7d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e1d3299a290026b85787bc9c7e72bcc53ac283f", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e1d3299a290026b85787bc9c7e72bcc53ac283f", "html_url": "https://github.com/rust-lang/rust/commit/5e1d3299a290026b85787bc9c7e72bcc53ac283f"}, {"sha": "a42cbdb16575d5c955e9bd3b434026758de789bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/a42cbdb16575d5c955e9bd3b434026758de789bf", "html_url": "https://github.com/rust-lang/rust/commit/a42cbdb16575d5c955e9bd3b434026758de789bf"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "3bbd01f82736381331b6efd1ef87032b3de62f38", "filename": "compiler/rustc_infer/src/infer/canonical/canonicalizer.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fadf164d8dc41116f936fb9b151b8083939a4a7d/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fcanonicalizer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fadf164d8dc41116f936fb9b151b8083939a4a7d/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fcanonicalizer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fcanonicalizer.rs?ref=fadf164d8dc41116f936fb9b151b8083939a4a7d", "patch": "@@ -230,9 +230,9 @@ impl CanonicalizeMode for CanonicalizeUserTypeAnnotation {\n         r: ty::Region<'tcx>,\n     ) -> ty::Region<'tcx> {\n         match *r {\n-            ty::ReEarlyBound(_) | ty::ReFree(_) | ty::ReErased | ty::ReStatic => r,\n+            ty::ReEarlyBound(_) | ty::ReFree(_) | ty::ReErased | ty::ReStatic | ty::ReError(_) => r,\n             ty::ReVar(_) => canonicalizer.canonical_var_for_region_in_root_universe(r),\n-            _ => {\n+            ty::RePlaceholder(..) | ty::ReLateBound(..) => {\n                 // We only expect region names that the user can type.\n                 bug!(\"unexpected region in query response: `{:?}`\", r)\n             }"}, {"sha": "3f2ad3ccbf582d575d3f22b69c74aa7d2dc589ed", "filename": "tests/ui/nll/user-annotations/region-error-ice-109072.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/fadf164d8dc41116f936fb9b151b8083939a4a7d/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fadf164d8dc41116f936fb9b151b8083939a4a7d/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.rs?ref=fadf164d8dc41116f936fb9b151b8083939a4a7d", "patch": "@@ -0,0 +1,14 @@\n+// Regression test for #109072.\n+// Check that we don't ICE when canonicalizing user annotation.\n+\n+trait Lt<'a> {\n+    type T;\n+}\n+\n+impl Lt<'missing> for () { //~ ERROR undeclared lifetime\n+    type T = &'missing (); //~ ERROR undeclared lifetime\n+}\n+\n+fn main() {\n+    let _: <() as Lt<'_>>::T = &();\n+}"}, {"sha": "d90971bed25ba31c4f095b50f475968adbcf293e", "filename": "tests/ui/nll/user-annotations/region-error-ice-109072.stderr", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/fadf164d8dc41116f936fb9b151b8083939a4a7d/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fadf164d8dc41116f936fb9b151b8083939a4a7d/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.stderr?ref=fadf164d8dc41116f936fb9b151b8083939a4a7d", "patch": "@@ -0,0 +1,26 @@\n+error[E0261]: use of undeclared lifetime name `'missing`\n+  --> $DIR/region-error-ice-109072.rs:8:9\n+   |\n+LL | impl Lt<'missing> for () {\n+   |     -   ^^^^^^^^ undeclared lifetime\n+   |     |\n+   |     help: consider introducing lifetime `'missing` here: `<'missing>`\n+\n+error[E0261]: use of undeclared lifetime name `'missing`\n+  --> $DIR/region-error-ice-109072.rs:9:15\n+   |\n+LL |     type T = &'missing ();\n+   |               ^^^^^^^^ undeclared lifetime\n+   |\n+help: consider introducing lifetime `'missing` here\n+   |\n+LL |     type T<'missing> = &'missing ();\n+   |           ++++++++++\n+help: consider introducing lifetime `'missing` here\n+   |\n+LL | impl<'missing> Lt<'missing> for () {\n+   |     ++++++++++\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0261`."}]}