{"sha": "5b9a882edc20810641cb774240e5089e87dab82e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViOWE4ODJlZGMyMDgxMDY0MWNiNzc0MjQwZTUwODllODdkYWI4MmU=", "commit": {"author": {"name": "Veetaha", "email": "veetaha2@gmail.com", "date": "2020-08-25T23:37:58Z"}, "committer": {"name": "Veetaha", "email": "veetaha2@gmail.com", "date": "2020-08-25T23:53:42Z"}, "message": "Make inlay hints colors more configurable", "tree": {"sha": "da25eebf9bd10e8161fcb6667b11f115cfee47e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da25eebf9bd10e8161fcb6667b11f115cfee47e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5b9a882edc20810641cb774240e5089e87dab82e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5b9a882edc20810641cb774240e5089e87dab82e", "html_url": "https://github.com/rust-lang/rust/commit/5b9a882edc20810641cb774240e5089e87dab82e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5b9a882edc20810641cb774240e5089e87dab82e/comments", "author": {"login": "Veetaha", "id": 36276403, "node_id": "MDQ6VXNlcjM2Mjc2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/36276403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veetaha", "html_url": "https://github.com/Veetaha", "followers_url": "https://api.github.com/users/Veetaha/followers", "following_url": "https://api.github.com/users/Veetaha/following{/other_user}", "gists_url": "https://api.github.com/users/Veetaha/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veetaha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veetaha/subscriptions", "organizations_url": "https://api.github.com/users/Veetaha/orgs", "repos_url": "https://api.github.com/users/Veetaha/repos", "events_url": "https://api.github.com/users/Veetaha/events{/privacy}", "received_events_url": "https://api.github.com/users/Veetaha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veetaha", "id": 36276403, "node_id": "MDQ6VXNlcjM2Mjc2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/36276403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veetaha", "html_url": "https://github.com/Veetaha", "followers_url": "https://api.github.com/users/Veetaha/followers", "following_url": "https://api.github.com/users/Veetaha/following{/other_user}", "gists_url": "https://api.github.com/users/Veetaha/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veetaha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veetaha/subscriptions", "organizations_url": "https://api.github.com/users/Veetaha/orgs", "repos_url": "https://api.github.com/users/Veetaha/repos", "events_url": "https://api.github.com/users/Veetaha/events{/privacy}", "received_events_url": "https://api.github.com/users/Veetaha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f647edcb080f50e01762a31eebd9ca94c982c768", "url": "https://api.github.com/repos/rust-lang/rust/commits/f647edcb080f50e01762a31eebd9ca94c982c768", "html_url": "https://github.com/rust-lang/rust/commit/f647edcb080f50e01762a31eebd9ca94c982c768"}], "stats": {"total": 166, "additions": 117, "deletions": 49}, "files": [{"sha": "367bba546607c22ea60275d3c8120bd21ce05abe", "filename": "docs/user/manual.adoc", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/5b9a882edc20810641cb774240e5089e87dab82e/docs%2Fuser%2Fmanual.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/5b9a882edc20810641cb774240e5089e87dab82e/docs%2Fuser%2Fmanual.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fmanual.adoc?ref=5b9a882edc20810641cb774240e5089e87dab82e", "patch": "@@ -367,6 +367,30 @@ include::./generated_assists.adoc[]\n \n == Editor Features\n === VS Code\n+\n+==== Color configurations\n+\n+It is possible to change the foreground/background color of inlay hints. Just add this to your\n+`settings.json`:\n+\n+[source,jsonc]\n+----\n+{\n+  \"workbench.colorCustomizations\": {\n+    // Name of the theme you are currently using\n+    \"[Default Dark+]\": {\n+      \"rust_analyzer.inlayHints.foreground\": \"#868686f0\",\n+      \"rust_analyzer.inlayHints.background\": \"#3d3d3d48\",\n+\n+      // Overrides for specific kinds of inlay hints\n+      \"rust_analyzer.inlayHints.foreground.typeHints\": \"#fdb6fdf0\",\n+      \"rust_analyzer.inlayHints.foreground.paramHints\": \"#fdb6fdf0\",\n+      \"rust_analyzer.inlayHints.background.chainingHints\": \"#6b0c0c81\"\n+    }\n+  }\n+}\n+----\n+\n ==== Special `when` clause context for keybindings.\n You may use `inRustProject` context to configure keybindings for rust projects only. For example:\n [source,json]"}, {"sha": "93d94ed129c5bcb899a3505fc4f0c2fd6b3ba50a", "filename": "editors/code/package.json", "status": "modified", "additions": 65, "deletions": 2, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/5b9a882edc20810641cb774240e5089e87dab82e/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/5b9a882edc20810641cb774240e5089e87dab82e/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=5b9a882edc20810641cb774240e5089e87dab82e", "patch": "@@ -712,14 +712,77 @@\n         ],\n         \"colors\": [\n             {\n-                \"id\": \"rust_analyzer.inlayHint\",\n-                \"description\": \"Color for inlay hints\",\n+                \"id\": \"rust_analyzer.inlayHints.foreground\",\n+                \"description\": \"Foreground color of inlay hints (is overriden by more specific rust_analyzer.inlayHints.foreground.* configurations)\",\n                 \"defaults\": {\n                     \"dark\": \"#A0A0A0F0\",\n                     \"light\": \"#747474\",\n                     \"highContrast\": \"#BEBEBE\"\n                 }\n             },\n+            {\n+                \"id\": \"rust_analyzer.inlayHints.background\",\n+                \"description\": \"Background color of inlay hints (is overriden by more specific rust_analyzer.inlayHints.background.* configurations)\",\n+                \"defaults\": {\n+                    \"dark\": \"#11223300\",\n+                    \"light\": \"#11223300\",\n+                    \"highContrast\": \"#11223300\"\n+                }\n+            },\n+            {\n+                \"id\": \"rust_analyzer.inlayHints.foreground.typeHints\",\n+                \"description\": \"Foreground color of inlay type hints for variables (overrides rust_analyzer.inlayHints.foreground)\",\n+                \"defaults\": {\n+                    \"dark\": \"rust_analyzer.inlayHints.foreground\",\n+                    \"light\": \"rust_analyzer.inlayHints.foreground\",\n+                    \"highContrast\": \"rust_analyzer.inlayHints.foreground\"\n+                }\n+            },\n+            {\n+                \"id\": \"rust_analyzer.inlayHints.foreground.chainingHints\",\n+                \"description\": \"Foreground color of inlay type hints for method chains (overrides rust_analyzer.inlayHints.foreground)\",\n+                \"defaults\": {\n+                    \"dark\": \"rust_analyzer.inlayHints.foreground\",\n+                    \"light\": \"rust_analyzer.inlayHints.foreground\",\n+                    \"highContrast\": \"rust_analyzer.inlayHints.foreground\"\n+                }\n+            },\n+            {\n+                \"id\": \"rust_analyzer.inlayHints.foreground.parameterHints\",\n+                \"description\": \"Foreground color of function parameter name inlay hints at the call site (overrides rust_analyzer.inlayHints.foreground)\",\n+                \"defaults\": {\n+                    \"dark\": \"rust_analyzer.inlayHints.foreground\",\n+                    \"light\": \"rust_analyzer.inlayHints.foreground\",\n+                    \"highContrast\": \"rust_analyzer.inlayHints.foreground\"\n+                }\n+            },\n+            {\n+                \"id\": \"rust_analyzer.inlayHints.background.typeHints\",\n+                \"description\": \"Background color of inlay type hints for variables (overrides rust_analyzer.inlayHints.background)\",\n+                \"defaults\": {\n+                    \"dark\": \"rust_analyzer.inlayHints.background\",\n+                    \"light\": \"rust_analyzer.inlayHints.background\",\n+                    \"highContrast\": \"rust_analyzer.inlayHints.background\"\n+                }\n+            },\n+            {\n+                \"id\": \"rust_analyzer.inlayHints.background.chainingHints\",\n+                \"description\": \"Background color of inlay type hints for method chains (overrides rust_analyzer.inlayHints.background)\",\n+                \"defaults\": {\n+                    \"dark\": \"rust_analyzer.inlayHints.background\",\n+                    \"light\": \"rust_analyzer.inlayHints.background\",\n+                    \"highContrast\": \"rust_analyzer.inlayHints.background\"\n+                }\n+            },\n+            {\n+                \"id\": \"rust_analyzer.inlayHints.background.parameterHints\",\n+                \"description\": \"Background color of function parameter name inlay hints at the call site (overrides rust_analyzer.inlayHints.background)\",\n+                \"defaults\": {\n+                    \"dark\": \"rust_analyzer.inlayHints.background\",\n+                    \"light\": \"rust_analyzer.inlayHints.background\",\n+                    \"highContrast\": \"rust_analyzer.inlayHints.background\"\n+                }\n+            },\n             {\n                 \"id\": \"rust_analyzer.syntaxTreeBorder\",\n                 \"description\": \"Color of the border displayed in the Rust source code for the selected syntax node (see \\\"Show Syntax Tree\\\" command)\","}, {"sha": "7b481fc72f66caba86eace3d1995224728852907", "filename": "editors/code/src/inlay_hints.ts", "status": "modified", "additions": 28, "deletions": 47, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/5b9a882edc20810641cb774240e5089e87dab82e/editors%2Fcode%2Fsrc%2Finlay_hints.ts", "raw_url": "https://github.com/rust-lang/rust/raw/5b9a882edc20810641cb774240e5089e87dab82e/editors%2Fcode%2Fsrc%2Finlay_hints.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finlay_hints.ts?ref=5b9a882edc20810641cb774240e5089e87dab82e", "patch": "@@ -39,54 +39,35 @@ export function activateInlayHints(ctx: Ctx) {\n     maybeUpdater.onConfigChange();\n }\n \n-\n-const typeHints = {\n-    decorationType: vscode.window.createTextEditorDecorationType({\n-        after: {\n-            color: new vscode.ThemeColor('rust_analyzer.inlayHint'),\n-            fontStyle: \"normal\",\n-        }\n-    }),\n-\n-    toDecoration(hint: ra.InlayHint.TypeHint, conv: lc.Protocol2CodeConverter): vscode.DecorationOptions {\n-        return {\n-            range: conv.asRange(hint.range),\n-            renderOptions: { after: { contentText: `: ${hint.label}` } }\n-        };\n-    }\n-};\n-\n-const paramHints = {\n-    decorationType: vscode.window.createTextEditorDecorationType({\n-        before: {\n-            color: new vscode.ThemeColor('rust_analyzer.inlayHint'),\n-            fontStyle: \"normal\",\n-        }\n-    }),\n-\n-    toDecoration(hint: ra.InlayHint.ParamHint, conv: lc.Protocol2CodeConverter): vscode.DecorationOptions {\n-        return {\n-            range: conv.asRange(hint.range),\n-            renderOptions: { before: { contentText: `${hint.label}: ` } }\n-        };\n-    }\n-};\n-\n-const chainingHints = {\n-    decorationType: vscode.window.createTextEditorDecorationType({\n-        after: {\n-            color: new vscode.ThemeColor('rust_analyzer.inlayHint'),\n-            fontStyle: \"normal\",\n+const typeHints = createHintStyle(\"type\");\n+const paramHints = createHintStyle(\"parameter\");\n+const chainingHints = createHintStyle(\"chaining\");\n+\n+function createHintStyle(hintKind: \"type\" | \"parameter\" | \"chaining\") {\n+    const [pos, render] = ({\n+        type: [\"after\", (label: string) => `: ${label}`],\n+        parameter: [\"before\", (label: string) => `${label}: `],\n+        chaining: [\"after\", (label: string) => `: ${label}`],\n+    } as const)[hintKind];\n+\n+    const fg = new vscode.ThemeColor(`rust_analyzer.inlayHints.foreground.${hintKind}Hints`);\n+    const bg = new vscode.ThemeColor(`rust_analyzer.inlayHints.background.${hintKind}Hints`);\n+    return {\n+        decorationType: vscode.window.createTextEditorDecorationType({\n+            [pos]: {\n+                color: fg,\n+                backgroundColor: bg,\n+                fontStyle: \"normal\",\n+            },\n+        }),\n+        toDecoration(hint: ra.InlayHint, conv: lc.Protocol2CodeConverter): vscode.DecorationOptions {\n+            return {\n+                range: conv.asRange(hint.range),\n+                renderOptions: { [pos]: { contentText: render(hint.label) } }\n+            };\n         }\n-    }),\n-\n-    toDecoration(hint: ra.InlayHint.ChainingHint, conv: lc.Protocol2CodeConverter): vscode.DecorationOptions {\n-        return {\n-            range: conv.asRange(hint.range),\n-            renderOptions: { after: { contentText: ` ${hint.label}` } }\n-        };\n-    }\n-};\n+    };\n+}\n \n class HintsUpdater implements Disposable {\n     private sourceFiles = new Map<string, RustSourceFile>(); // map Uri -> RustSourceFile"}]}