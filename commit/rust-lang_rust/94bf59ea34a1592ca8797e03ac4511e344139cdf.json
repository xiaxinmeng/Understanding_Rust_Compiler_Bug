{"sha": "94bf59ea34a1592ca8797e03ac4511e344139cdf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0YmY1OWVhMzRhMTU5MmNhODc5N2UwM2FjNDUxMWUzNDQxMzljZGY=", "commit": {"author": {"name": "Gus Caplan", "email": "me@gus.host", "date": "2020-12-13T04:31:35Z"}, "committer": {"name": "Gus Caplan", "email": "me@gus.host", "date": "2021-01-11T20:22:38Z"}, "message": "Use correct ABI for wasm32 by default\n\nIntroduces `RUSTC_USE_WASM32_BINDGEN_COMPAT_ABI` env var to use the\ncompat ABI if need.", "tree": {"sha": "edd0578f0ad2e5f576051366986c169b61dde6ec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/edd0578f0ad2e5f576051366986c169b61dde6ec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94bf59ea34a1592ca8797e03ac4511e344139cdf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEXSkNpnBNseeWrjXy8AvRGIDoLw4FAl/8s44ACgkQ8AvRGIDo\nLw7M5Qf9FKgOjvQqb7RfOvMOGuzbfwoYeKGrPuZHktnMaZl5iiJcCBmQot9+clQk\nxJKhJL8RgZcYSyP2Gzja3EZlQUlAYXO0cHE+wKbb+57Y634MKFK3srVyfI3dkET9\nf3hEh5ulGXHVfWxAWMSAjlWbiqBsVFm8+8NGTBSbLFYMphmfHggOEqWsmr9IvlGE\nqm4Rl7lbbBCcaTYym9Fpiu6THhvSJIVaCEekmCltu7EetMmgiFUbvAaegOVTPngk\nkAajfd9iYolwXylvfxZ+hNegZCLxg7m7asdSZmEY3Mq45qy4+klZgw0PLlAgyL/y\n0OA6kqCXC4YWbV8WmJsMGLOurUMHxw==\n=p7/r\n-----END PGP SIGNATURE-----", "payload": "tree edd0578f0ad2e5f576051366986c169b61dde6ec\nparent 6526e5c772f2da07db745c94ca6bb0a591a39ba4\nauthor Gus Caplan <me@gus.host> 1607833895 -0600\ncommitter Gus Caplan <me@gus.host> 1610396558 -0600\n\nUse correct ABI for wasm32 by default\n\nIntroduces `RUSTC_USE_WASM32_BINDGEN_COMPAT_ABI` env var to use the\ncompat ABI if need.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94bf59ea34a1592ca8797e03ac4511e344139cdf", "html_url": "https://github.com/rust-lang/rust/commit/94bf59ea34a1592ca8797e03ac4511e344139cdf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94bf59ea34a1592ca8797e03ac4511e344139cdf/comments", "author": {"login": "devsnek", "id": 5952481, "node_id": "MDQ6VXNlcjU5NTI0ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/5952481?v=4", "gravatar_id": "", "url": "https://api.github.com/users/devsnek", "html_url": "https://github.com/devsnek", "followers_url": "https://api.github.com/users/devsnek/followers", "following_url": "https://api.github.com/users/devsnek/following{/other_user}", "gists_url": "https://api.github.com/users/devsnek/gists{/gist_id}", "starred_url": "https://api.github.com/users/devsnek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/devsnek/subscriptions", "organizations_url": "https://api.github.com/users/devsnek/orgs", "repos_url": "https://api.github.com/users/devsnek/repos", "events_url": "https://api.github.com/users/devsnek/events{/privacy}", "received_events_url": "https://api.github.com/users/devsnek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "devsnek", "id": 5952481, "node_id": "MDQ6VXNlcjU5NTI0ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/5952481?v=4", "gravatar_id": "", "url": "https://api.github.com/users/devsnek", "html_url": "https://github.com/devsnek", "followers_url": "https://api.github.com/users/devsnek/followers", "following_url": "https://api.github.com/users/devsnek/following{/other_user}", "gists_url": "https://api.github.com/users/devsnek/gists{/gist_id}", "starred_url": "https://api.github.com/users/devsnek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/devsnek/subscriptions", "organizations_url": "https://api.github.com/users/devsnek/orgs", "repos_url": "https://api.github.com/users/devsnek/repos", "events_url": "https://api.github.com/users/devsnek/events{/privacy}", "received_events_url": "https://api.github.com/users/devsnek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6526e5c772f2da07db745c94ca6bb0a591a39ba4", "url": "https://api.github.com/repos/rust-lang/rust/commits/6526e5c772f2da07db745c94ca6bb0a591a39ba4", "html_url": "https://github.com/rust-lang/rust/commit/6526e5c772f2da07db745c94ca6bb0a591a39ba4"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "73c1296a68643b502bca643b4eae804be50ef2c8", "filename": "compiler/rustc_target/src/abi/call/mod.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/94bf59ea34a1592ca8797e03ac4511e344139cdf/compiler%2Frustc_target%2Fsrc%2Fabi%2Fcall%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94bf59ea34a1592ca8797e03ac4511e344139cdf/compiler%2Frustc_target%2Fsrc%2Fabi%2Fcall%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fabi%2Fcall%2Fmod.rs?ref=94bf59ea34a1592ca8797e03ac4511e344139cdf", "patch": "@@ -605,7 +605,12 @@ impl<'a, Ty> FnAbi<'a, Ty> {\n             \"nvptx64\" => nvptx64::compute_abi_info(self),\n             \"hexagon\" => hexagon::compute_abi_info(self),\n             \"riscv32\" | \"riscv64\" => riscv::compute_abi_info(cx, self),\n-            \"wasm32\" if cx.target_spec().os != \"emscripten\" => {\n+            \"wasm32\"\n+                if cx.target_spec().os != \"emscripten\"\n+                    && std::env::var(\"RUSTC_USE_WASM32_BINDGEN_COMPAT_ABI\")\n+                        .map(|x| &x != \"0\")\n+                        .unwrap_or(false) =>\n+            {\n                 wasm32_bindgen_compat::compute_abi_info(self)\n             }\n             \"wasm32\" | \"asmjs\" => wasm32::compute_abi_info(cx, self),"}]}