{"sha": "8006dab817e6bfa0a71a593d46c5569e8a98a6b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwMDZkYWI4MTdlNmJmYTBhNzFhNTkzZDQ2YzU1NjllOGE5OGE2Yjc=", "commit": {"author": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2021-03-06T06:29:02Z"}, "committer": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2021-03-11T10:40:00Z"}, "message": "move single_char_insert_string to its own module", "tree": {"sha": "d112077b34b3728125472ba24d5d7089d937fa8e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d112077b34b3728125472ba24d5d7089d937fa8e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8006dab817e6bfa0a71a593d46c5569e8a98a6b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8006dab817e6bfa0a71a593d46c5569e8a98a6b7", "html_url": "https://github.com/rust-lang/rust/commit/8006dab817e6bfa0a71a593d46c5569e8a98a6b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8006dab817e6bfa0a71a593d46c5569e8a98a6b7/comments", "author": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ade32ddf2ec13a6ec2e03c14e7393ce784d4d18", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ade32ddf2ec13a6ec2e03c14e7393ce784d4d18", "html_url": "https://github.com/rust-lang/rust/commit/2ade32ddf2ec13a6ec2e03c14e7393ce784d4d18"}], "stats": {"total": 50, "additions": 29, "deletions": 21}, "files": [{"sha": "ef671e41cb59bffc2c825f017f8761b0a24b1d72", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 2, "deletions": 21, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/8006dab817e6bfa0a71a593d46c5569e8a98a6b7/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8006dab817e6bfa0a71a593d46c5569e8a98a6b7/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=8006dab817e6bfa0a71a593d46c5569e8a98a6b7", "patch": "@@ -20,6 +20,7 @@ mod map_collect_result_unit;\n mod ok_expect;\n mod option_as_ref_deref;\n mod option_map_unwrap_or;\n+mod single_char_insert_string;\n mod skip_while_next;\n mod string_extend_chars;\n mod suspicious_map;\n@@ -1779,7 +1780,7 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n                     if match_def_path(cx, fn_def_id, &paths::PUSH_STR) {\n                         lint_single_char_push_string(cx, expr, args);\n                     } else if match_def_path(cx, fn_def_id, &paths::INSERT_STR) {\n-                        lint_single_char_insert_string(cx, expr, args);\n+                        single_char_insert_string::check(cx, expr, args);\n                     }\n                 }\n \n@@ -3235,26 +3236,6 @@ fn lint_single_char_push_string(cx: &LateContext<'_>, expr: &hir::Expr<'_>, args\n     }\n }\n \n-/// lint for length-1 `str`s as argument for `insert_str`\n-fn lint_single_char_insert_string(cx: &LateContext<'_>, expr: &hir::Expr<'_>, args: &[hir::Expr<'_>]) {\n-    let mut applicability = Applicability::MachineApplicable;\n-    if let Some(extension_string) = get_hint_if_single_char_arg(cx, &args[2], &mut applicability) {\n-        let base_string_snippet =\n-            snippet_with_applicability(cx, args[0].span.source_callsite(), \"_\", &mut applicability);\n-        let pos_arg = snippet_with_applicability(cx, args[1].span, \"..\", &mut applicability);\n-        let sugg = format!(\"{}.insert({}, {})\", base_string_snippet, pos_arg, extension_string);\n-        span_lint_and_sugg(\n-            cx,\n-            SINGLE_CHAR_ADD_STR,\n-            expr.span,\n-            \"calling `insert_str()` using a single-character string literal\",\n-            \"consider using `insert` with a character literal\",\n-            sugg,\n-            applicability,\n-        );\n-    }\n-}\n-\n /// Checks for the `USELESS_ASREF` lint.\n fn lint_asref(cx: &LateContext<'_>, expr: &hir::Expr<'_>, call_name: &str, as_ref_args: &[hir::Expr<'_>]) {\n     // when we get here, we've already checked that the call name is \"as_ref\" or \"as_mut\""}, {"sha": "0ce8b66978dc12cdd4e307a8612ab2dce2d860cf", "filename": "clippy_lints/src/methods/single_char_insert_string.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/8006dab817e6bfa0a71a593d46c5569e8a98a6b7/clippy_lints%2Fsrc%2Fmethods%2Fsingle_char_insert_string.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8006dab817e6bfa0a71a593d46c5569e8a98a6b7/clippy_lints%2Fsrc%2Fmethods%2Fsingle_char_insert_string.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fsingle_char_insert_string.rs?ref=8006dab817e6bfa0a71a593d46c5569e8a98a6b7", "patch": "@@ -0,0 +1,27 @@\n+use crate::methods::get_hint_if_single_char_arg;\n+use crate::utils::{snippet_with_applicability, span_lint_and_sugg};\n+use rustc_errors::Applicability;\n+use rustc_hir as hir;\n+use rustc_lint::LateContext;\n+\n+use super::SINGLE_CHAR_ADD_STR;\n+\n+/// lint for length-1 `str`s as argument for `insert_str`\n+pub(super) fn check(cx: &LateContext<'_>, expr: &hir::Expr<'_>, args: &[hir::Expr<'_>]) {\n+    let mut applicability = Applicability::MachineApplicable;\n+    if let Some(extension_string) = get_hint_if_single_char_arg(cx, &args[2], &mut applicability) {\n+        let base_string_snippet =\n+            snippet_with_applicability(cx, args[0].span.source_callsite(), \"_\", &mut applicability);\n+        let pos_arg = snippet_with_applicability(cx, args[1].span, \"..\", &mut applicability);\n+        let sugg = format!(\"{}.insert({}, {})\", base_string_snippet, pos_arg, extension_string);\n+        span_lint_and_sugg(\n+            cx,\n+            SINGLE_CHAR_ADD_STR,\n+            expr.span,\n+            \"calling `insert_str()` using a single-character string literal\",\n+            \"consider using `insert` with a character literal\",\n+            sugg,\n+            applicability,\n+        );\n+    }\n+}"}]}