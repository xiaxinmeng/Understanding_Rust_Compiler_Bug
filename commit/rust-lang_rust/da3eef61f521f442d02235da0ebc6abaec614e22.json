{"sha": "da3eef61f521f442d02235da0ebc6abaec614e22", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhM2VlZjYxZjUyMWY0NDJkMDIyMzVkYTBlYmM2YWJhZWM2MTRlMjI=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-01-02T13:11:19Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-01-03T12:53:11Z"}, "message": "Detect invalid rustdoc test commands", "tree": {"sha": "67d4ead000a8b102d36a04fe77f463c11dcca8a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/67d4ead000a8b102d36a04fe77f463c11dcca8a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da3eef61f521f442d02235da0ebc6abaec614e22", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da3eef61f521f442d02235da0ebc6abaec614e22", "html_url": "https://github.com/rust-lang/rust/commit/da3eef61f521f442d02235da0ebc6abaec614e22", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da3eef61f521f442d02235da0ebc6abaec614e22/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "90ccf4f5adfb2562fc95c996b97faac7775a34bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/90ccf4f5adfb2562fc95c996b97faac7775a34bb", "html_url": "https://github.com/rust-lang/rust/commit/90ccf4f5adfb2562fc95c996b97faac7775a34bb"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "2f7233685db52b05c4dc9ba10a064cac719b8cdf", "filename": "src/etc/htmldocck.py", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/da3eef61f521f442d02235da0ebc6abaec614e22/src%2Fetc%2Fhtmldocck.py", "raw_url": "https://github.com/rust-lang/rust/raw/da3eef61f521f442d02235da0ebc6abaec614e22/src%2Fetc%2Fhtmldocck.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fhtmldocck.py?ref=da3eef61f521f442d02235da0ebc6abaec614e22", "patch": "@@ -218,7 +218,7 @@ def concat_multi_lines(f):\n \n \n LINE_PATTERN = re.compile(r'''\n-    (?<=(?<!\\S)@)(?P<negated>!?)\n+    (?<=(?<!\\S))(?P<invalid>!?)@(?P<negated>!?)\n     (?P<cmd>[A-Za-z]+(?:-[A-Za-z]+)*)\n     (?P<args>.*)$\n ''', re.X | re.UNICODE)\n@@ -233,6 +233,16 @@ def get_commands(template):\n \n             negated = (m.group('negated') == '!')\n             cmd = m.group('cmd')\n+            if m.group('invalid') == '!':\n+                print_err(\n+                    lineno,\n+                    line,\n+                    'Invalid command: `!@{0}{1}`, (help: try with `@!{1}`)'.format(\n+                        '!' if negated else '',\n+                        cmd,\n+                    ),\n+                )\n+                continue\n             args = m.group('args')\n             if args and not args[:1].isspace():\n                 print_err(lineno, line, 'Invalid template syntax')"}]}