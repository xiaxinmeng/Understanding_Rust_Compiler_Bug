{"sha": "137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEzN2RlZDhhYjFlZGY1MTEyYzQ1ZTBiNjg1NDI3MmFlMmU5ZDNhNmQ=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-21T21:54:05Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-10-23T22:32:03Z"}, "message": "pre-expansion gate label_break_value", "tree": {"sha": "5f5cb3e04541879784b6635e4cb459e6ab9f5f1c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f5cb3e04541879784b6635e4cb459e6ab9f5f1c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "html_url": "https://github.com/rust-lang/rust/commit/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66995a6a71e2f5e194797cb846ce5866c4305f93", "url": "https://api.github.com/repos/rust-lang/rust/commits/66995a6a71e2f5e194797cb846ce5866c4305f93", "html_url": "https://github.com/rust-lang/rust/commit/66995a6a71e2f5e194797cb846ce5866c4305f93"}], "stats": {"total": 20, "additions": 12, "deletions": 8}, "files": [{"sha": "4e273fc9374fca4a40d729256ba7e0f56abf5e52", "filename": "src/libsyntax/feature_gate/check.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Flibsyntax%2Ffeature_gate%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Flibsyntax%2Ffeature_gate%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate%2Fcheck.rs?ref=137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "patch": "@@ -514,12 +514,6 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n                                        \"type ascription is experimental\");\n                 }\n             }\n-            ast::ExprKind::Block(_, opt_label) => {\n-                if let Some(label) = opt_label {\n-                    gate_feature_post!(&self, label_break_value, label.ident.span,\n-                                    \"labels on blocks are unstable\");\n-                }\n-            }\n             _ => {}\n         }\n         visit::walk_expr(self, e)\n@@ -814,6 +808,7 @@ pub fn check_crate(krate: &ast::Crate,\n     gate_all!(box_patterns, \"box pattern syntax is experimental\");\n     gate_all!(exclusive_range_pattern, \"exclusive range pattern syntax is experimental\");\n     gate_all!(try_blocks, \"`try` blocks are unstable\");\n+    gate_all!(label_break_value, \"labels on blocks are unstable\");\n \n     visit::walk_crate(&mut visitor, krate);\n }"}, {"sha": "395f3a3a4dfe1e323c2521fcf52c236c86fdce71", "filename": "src/libsyntax/parse/parser/expr.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Flibsyntax%2Fparse%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Flibsyntax%2Fparse%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser%2Fexpr.rs?ref=137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "patch": "@@ -1260,6 +1260,10 @@ impl<'a> Parser<'a> {\n         blk_mode: BlockCheckMode,\n         outer_attrs: ThinVec<Attribute>,\n     ) -> PResult<'a, P<Expr>> {\n+        if let Some(label) = opt_label {\n+            self.sess.gated_spans.label_break_value.borrow_mut().push(label.ident.span);\n+        }\n+\n         self.expect(&token::OpenDelim(token::Brace))?;\n \n         let mut attrs = outer_attrs;"}, {"sha": "ac6be3036ce6493cceaa3812b0b873f46622c197", "filename": "src/libsyntax/sess.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Flibsyntax%2Fsess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Flibsyntax%2Fsess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fsess.rs?ref=137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "patch": "@@ -46,6 +46,8 @@ crate struct GatedSpans {\n     pub exclusive_range_pattern: Lock<Vec<Span>>,\n     /// Spans collected for gating `try_blocks`, e.g. `try { a? + b? }`.\n     pub try_blocks: Lock<Vec<Span>>,\n+    /// Spans collected for gating `label_break_value`, e.g. `'label: { ... }`.\n+    pub label_break_value: Lock<Vec<Span>>,\n }\n \n /// Info about a parsing session."}, {"sha": "8d7ecd27b450fd0e035304515b54674ee8a683b5", "filename": "src/test/ui/feature-gates/feature-gate-label_break_value.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-label_break_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-label_break_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-label_break_value.rs?ref=137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "patch": "@@ -1,5 +1,8 @@\n-pub fn main() {\n+#[cfg(FALSE)]\n+pub fn foo() {\n     'a: { //~ ERROR labels on blocks are unstable\n         break 'a;\n     }\n }\n+\n+fn main() {}"}, {"sha": "6a861d3e04f92be31a72b983ecdf1564e65dc1f9", "filename": "src/test/ui/feature-gates/feature-gate-label_break_value.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-label_break_value.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/137ded8ab1edf5112c45e0b6854272ae2e9d3a6d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-label_break_value.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-label_break_value.stderr?ref=137ded8ab1edf5112c45e0b6854272ae2e9d3a6d", "patch": "@@ -1,5 +1,5 @@\n error[E0658]: labels on blocks are unstable\n-  --> $DIR/feature-gate-label_break_value.rs:2:5\n+  --> $DIR/feature-gate-label_break_value.rs:3:5\n    |\n LL |     'a: {\n    |     ^^"}]}