{"sha": "ae7330eea4100566f9f3826221cb3d694cfde5cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlNzMzMGVlYTQxMDA1NjZmOWYzODI2MjIxY2IzZDY5NGNmZGU1Y2M=", "commit": {"author": {"name": "rchaser53", "email": "tayoshizawa29@gmail.com", "date": "2019-02-24T06:18:46Z"}, "committer": {"name": "rchaser53", "email": "tayoshizawa29@gmail.com", "date": "2019-02-24T13:05:08Z"}, "message": "leave pre comment for self", "tree": {"sha": "3269afc4a911ec48e271a97b97084890caee334a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3269afc4a911ec48e271a97b97084890caee334a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ae7330eea4100566f9f3826221cb3d694cfde5cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ae7330eea4100566f9f3826221cb3d694cfde5cc", "html_url": "https://github.com/rust-lang/rust/commit/ae7330eea4100566f9f3826221cb3d694cfde5cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ae7330eea4100566f9f3826221cb3d694cfde5cc/comments", "author": {"login": "rchaser53", "id": 9676954, "node_id": "MDQ6VXNlcjk2NzY5NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9676954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rchaser53", "html_url": "https://github.com/rchaser53", "followers_url": "https://api.github.com/users/rchaser53/followers", "following_url": "https://api.github.com/users/rchaser53/following{/other_user}", "gists_url": "https://api.github.com/users/rchaser53/gists{/gist_id}", "starred_url": "https://api.github.com/users/rchaser53/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rchaser53/subscriptions", "organizations_url": "https://api.github.com/users/rchaser53/orgs", "repos_url": "https://api.github.com/users/rchaser53/repos", "events_url": "https://api.github.com/users/rchaser53/events{/privacy}", "received_events_url": "https://api.github.com/users/rchaser53/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rchaser53", "id": 9676954, "node_id": "MDQ6VXNlcjk2NzY5NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9676954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rchaser53", "html_url": "https://github.com/rchaser53", "followers_url": "https://api.github.com/users/rchaser53/followers", "following_url": "https://api.github.com/users/rchaser53/following{/other_user}", "gists_url": "https://api.github.com/users/rchaser53/gists{/gist_id}", "starred_url": "https://api.github.com/users/rchaser53/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rchaser53/subscriptions", "organizations_url": "https://api.github.com/users/rchaser53/orgs", "repos_url": "https://api.github.com/users/rchaser53/repos", "events_url": "https://api.github.com/users/rchaser53/events{/privacy}", "received_events_url": "https://api.github.com/users/rchaser53/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a75feedacfc0a561a5847de58369ca9af5cf4ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a75feedacfc0a561a5847de58369ca9af5cf4ad", "html_url": "https://github.com/rust-lang/rust/commit/6a75feedacfc0a561a5847de58369ca9af5cf4ad"}], "stats": {"total": 75, "additions": 73, "deletions": 2}, "files": [{"sha": "d0b29b03ff34b31b726fb1bb339b769ae74bb6ef", "filename": "src/items.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ae7330eea4100566f9f3826221cb3d694cfde5cc/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae7330eea4100566f9f3826221cb3d694cfde5cc/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=ae7330eea4100566f9f3826221cb3d694cfde5cc", "patch": "@@ -20,7 +20,8 @@ use crate::expr::{\n     ExprType, RhsTactics,\n };\n use crate::lists::{\n-    definitive_tactic, itemize_list, write_list, ListFormatting, ListItem, Separator,\n+    definitive_tactic, extract_pre_comment, itemize_list, write_list, ListFormatting, ListItem,\n+    Separator,\n };\n use crate::macros::{rewrite_macro, MacroPosition};\n use crate::overflow;\n@@ -2291,9 +2292,15 @@ fn rewrite_args(\n     // Account for sugary self.\n     // FIXME: the comment for the self argument is dropped. This is blocked\n     // on rust issue #27522.\n+    let mut comment_str = \"\";\n     let min_args = explicit_self\n         .and_then(|explicit_self| rewrite_explicit_self(explicit_self, args, context))\n         .map_or(1, |self_str| {\n+            let comment_span = mk_sp(span.lo(), args[0].pat.span.lo());\n+            comment_str = context\n+                .snippet_provider\n+                .span_to_snippet(comment_span)\n+                .unwrap();\n             arg_item_strs[0] = self_str;\n             2\n         });\n@@ -2368,7 +2375,12 @@ fn rewrite_args(\n         && (arg_items.is_empty()\n             || arg_items.len() == 1 && arg_item_strs[0].len() <= one_line_budget);\n \n-    for (item, arg) in arg_items.iter_mut().zip(arg_item_strs) {\n+    for (index, (item, arg)) in arg_items.iter_mut().zip(arg_item_strs).enumerate() {\n+        if index == 0 && explicit_self.is_some() {\n+            let (pre_comment, pre_comment_style) = extract_pre_comment(comment_str);\n+            item.pre_comment = pre_comment;\n+            item.pre_comment_style = pre_comment_style;\n+        }\n         item.item = Some(arg);\n     }\n "}, {"sha": "517533ae562580b285ee082a405f0b59a2ecffa4", "filename": "tests/source/issue-3198.rs", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/ae7330eea4100566f9f3826221cb3d694cfde5cc/tests%2Fsource%2Fissue-3198.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae7330eea4100566f9f3826221cb3d694cfde5cc/tests%2Fsource%2Fissue-3198.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3198.rs?ref=ae7330eea4100566f9f3826221cb3d694cfde5cc", "patch": "@@ -0,0 +1,40 @@\n+impl TestTrait {\n+    fn foo_one(/* Important comment1 */\n+    self) {\n+    }\n+\n+    fn foo(\n+        /* Important comment1 */\n+        self,\n+        /* Important comment2 */\n+        a: i32,\n+    ) {\n+    }\n+\n+    fn bar(\n+            /* Important comment1 */\n+    &mut self,\n+        /* Important comment2 */\n+            a: i32,\n+    ) {\n+    }\n+\n+    fn baz(\n+    /* Important comment1 */\n+            self: X< 'a ,  'b >,\n+            /* Important comment2 */\n+    a: i32,\n+    ) {\n+    }\n+\n+    fn baz_tree(\n+    /* Important comment1 */\n+\n+            self: X< 'a ,  'b >,\n+        /* Important comment2 */\n+        a: i32,\n+        /* Important comment3 */\n+        b: i32,\n+    ) {\n+    }\n+}"}, {"sha": "de307fed6b16bdca36532720ec3f32640b1342bd", "filename": "tests/target/issue-3198.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ae7330eea4100566f9f3826221cb3d694cfde5cc/tests%2Ftarget%2Fissue-3198.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae7330eea4100566f9f3826221cb3d694cfde5cc/tests%2Ftarget%2Fissue-3198.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3198.rs?ref=ae7330eea4100566f9f3826221cb3d694cfde5cc", "patch": "@@ -0,0 +1,19 @@\n+impl TestTrait {\n+    fn foo_one(/* Important comment1 */ self) {}\n+\n+    fn foo(/* Important comment1 */ self, /* Important comment2 */ a: i32) {}\n+\n+    fn bar(/* Important comment1 */ &mut self, /* Important comment2 */ a: i32) {}\n+\n+    fn baz(/* Important comment1 */ self: X<'a, 'b>, /* Important comment2 */ a: i32) {}\n+\n+    fn baz_tree(\n+        /* Important comment1 */\n+        self: X<'a, 'b>,\n+        /* Important comment2 */\n+        a: i32,\n+        /* Important comment3 */\n+        b: i32,\n+    ) {\n+    }\n+}"}]}