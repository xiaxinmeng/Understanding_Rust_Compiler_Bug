{"sha": "61e280863fb68c26bb1f976acfa4a45a26d70545", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxZTI4MDg2M2ZiNjhjMjZiYjFmOTc2YWNmYTRhNDVhMjZkNzA1NDU=", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-07-13T21:27:19Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-07-14T19:37:17Z"}, "message": "Fixed `branches_sharing_code` FP with block expressions in else\n\nAnd added `branches_sharing_code` PF note to lint doc for `rust-clippy#7452`", "tree": {"sha": "e730e05c9e955dddd4b69ca6132b1718b4967b07", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e730e05c9e955dddd4b69ca6132b1718b4967b07"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61e280863fb68c26bb1f976acfa4a45a26d70545", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61e280863fb68c26bb1f976acfa4a45a26d70545", "html_url": "https://github.com/rust-lang/rust/commit/61e280863fb68c26bb1f976acfa4a45a26d70545", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61e280863fb68c26bb1f976acfa4a45a26d70545/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8131445e536869b4b73b07d1be1b2e03f7493898", "url": "https://api.github.com/repos/rust-lang/rust/commits/8131445e536869b4b73b07d1be1b2e03f7493898", "html_url": "https://github.com/rust-lang/rust/commit/8131445e536869b4b73b07d1be1b2e03f7493898"}], "stats": {"total": 36, "additions": 33, "deletions": 3}, "files": [{"sha": "9cbcde597686e8c212c45ce95d4e28ad954624cf", "filename": "clippy_lints/src/copies.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/61e280863fb68c26bb1f976acfa4a45a26d70545/clippy_lints%2Fsrc%2Fcopies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61e280863fb68c26bb1f976acfa4a45a26d70545/clippy_lints%2Fsrc%2Fcopies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcopies.rs?ref=61e280863fb68c26bb1f976acfa4a45a26d70545", "patch": "@@ -120,7 +120,10 @@ declare_clippy_lint! {\n     ///\n     /// **Why is this bad?** Duplicate code is less maintainable.\n     ///\n-    /// **Known problems:** Hopefully none.\n+    /// **Known problems:**\n+    /// * The lint doesn't check if the moved expressions modify values that are beeing used in\n+    ///   the if condition. The suggestion can in that case modify the behavior of the program.\n+    ///   See [rust-clippy#7452](https://github.com/rust-lang/rust-clippy/issues/7452)\n     ///\n     /// **Example:**\n     /// ```ignore\n@@ -358,8 +361,7 @@ fn scan_block_for_eq(cx: &LateContext<'tcx>, blocks: &[&Block<'tcx>]) -> Option<\n         expr_eq &= block_expr_eq;\n     }\n \n-    let has_expr = blocks[0].expr.is_some();\n-    if has_expr && !expr_eq {\n+    if !expr_eq {\n         end_eq = 0;\n     }\n "}, {"sha": "7f42df463411d53f8371c6b29cd431ba1580f4cd", "filename": "tests/ui/branches_sharing_code/false_positives.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/61e280863fb68c26bb1f976acfa4a45a26d70545/tests%2Fui%2Fbranches_sharing_code%2Ffalse_positives.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61e280863fb68c26bb1f976acfa4a45a26d70545/tests%2Fui%2Fbranches_sharing_code%2Ffalse_positives.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbranches_sharing_code%2Ffalse_positives.rs?ref=61e280863fb68c26bb1f976acfa4a45a26d70545", "patch": "@@ -0,0 +1,28 @@\n+#![allow(dead_code)]\n+#![deny(clippy::if_same_then_else, clippy::branches_sharing_code)]\n+\n+// ##################################\n+// # Issue clippy#7369\n+// ##################################\n+#[derive(Debug)]\n+pub struct FooBar {\n+    foo: Vec<u32>,\n+}\n+\n+impl FooBar {\n+    pub fn bar(&mut self) {\n+        if true {\n+            self.foo.pop();\n+        } else {\n+            self.baz();\n+\n+            self.foo.pop();\n+\n+            self.baz()\n+        }\n+    }\n+\n+    fn baz(&mut self) {}\n+}\n+\n+fn main() {}"}]}