{"sha": "408bf9de3459ffbf3b5f8844895d4f0147faad9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwOGJmOWRlMzQ1OWZmYmYzYjVmODg0NDg5NWQ0ZjAxNDdmYWFkOWE=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-02-04T07:03:31Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-05-31T15:24:53Z"}, "message": "rustc_codegen_utils: don't ignore `Ctor` path components in symbols.", "tree": {"sha": "459ad8af6c682b404ef32b24b11503d1b6714f02", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/459ad8af6c682b404ef32b24b11503d1b6714f02"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/408bf9de3459ffbf3b5f8844895d4f0147faad9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/408bf9de3459ffbf3b5f8844895d4f0147faad9a", "html_url": "https://github.com/rust-lang/rust/commit/408bf9de3459ffbf3b5f8844895d4f0147faad9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/408bf9de3459ffbf3b5f8844895d4f0147faad9a/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2092963a1851efca5222bd816557055988ce8f90", "url": "https://api.github.com/repos/rust-lang/rust/commits/2092963a1851efca5222bd816557055988ce8f90", "html_url": "https://github.com/rust-lang/rust/commit/2092963a1851efca5222bd816557055988ce8f90"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "dc985c8126c54a6d382ca12d64c988758ef54452", "filename": "src/librustc_codegen_utils/symbol_names/v0.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/408bf9de3459ffbf3b5f8844895d4f0147faad9a/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Fv0.rs", "raw_url": "https://github.com/rust-lang/rust/raw/408bf9de3459ffbf3b5f8844895d4f0147faad9a/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Fv0.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Fv0.rs?ref=408bf9de3459ffbf3b5f8844895d4f0147faad9a", "patch": "@@ -586,13 +586,11 @@ impl Printer<'tcx, 'tcx> for SymbolMangler<'_, 'tcx> {\n         disambiguated_data: &DisambiguatedDefPathData,\n     ) -> Result<Self::Path, Self::Error> {\n         let ns = match disambiguated_data.data {\n-            // Avoid putting the burden on demanglers to ignore this.\n-            DefPathData::Ctor => return print_prefix(self),\n-\n             // Uppercase categories are more stable than lowercase ones.\n             DefPathData::TypeNs(_) => 't',\n             DefPathData::ValueNs(_) => 'v',\n             DefPathData::ClosureExpr => 'C',\n+            DefPathData::Ctor => 'c',\n             DefPathData::AnonConst => 'k',\n             DefPathData::ImplTrait => 'i',\n "}, {"sha": "5f5ee7cfe4410b8709353440f67dac1af550e316", "filename": "src/test/run-pass/struct-ctor-mangling.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/408bf9de3459ffbf3b5f8844895d4f0147faad9a/src%2Ftest%2Frun-pass%2Fstruct-ctor-mangling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/408bf9de3459ffbf3b5f8844895d4f0147faad9a/src%2Ftest%2Frun-pass%2Fstruct-ctor-mangling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fstruct-ctor-mangling.rs?ref=408bf9de3459ffbf3b5f8844895d4f0147faad9a", "patch": "@@ -0,0 +1,12 @@\n+fn size_of_val<T>(_: &T) -> usize {\n+    std::mem::size_of::<T>()\n+}\n+\n+struct Foo(i64);\n+\n+// Test that the (symbol) mangling of `Foo` (the `struct` type) and that of\n+// `typeof Foo` (the function type of the `struct` constructor) don't collide.\n+fn main() {\n+    size_of_val(&Foo(0));\n+    size_of_val(&Foo);\n+}"}]}