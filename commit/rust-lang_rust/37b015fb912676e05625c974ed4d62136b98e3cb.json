{"sha": "37b015fb912676e05625c974ed4d62136b98e3cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3YjAxNWZiOTEyNjc2ZTA1NjI1Yzk3NGVkNGQ2MjEzNmI5OGUzY2I=", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2017-10-31T17:45:19Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2017-11-03T00:28:50Z"}, "message": "Fix error message for invalid code/reloc models", "tree": {"sha": "442a45f602dfb9107c993c3726bf727689ff232c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/442a45f602dfb9107c993c3726bf727689ff232c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37b015fb912676e05625c974ed4d62136b98e3cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37b015fb912676e05625c974ed4d62136b98e3cb", "html_url": "https://github.com/rust-lang/rust/commit/37b015fb912676e05625c974ed4d62136b98e3cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37b015fb912676e05625c974ed4d62136b98e3cb/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b22e70b2de5152db3b0c53cfa16eb96b0b9e40e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b22e70b2de5152db3b0c53cfa16eb96b0b9e40e", "html_url": "https://github.com/rust-lang/rust/commit/8b22e70b2de5152db3b0c53cfa16eb96b0b9e40e"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "8fd4aad89c643d4cec7a775794a33c00f816a845", "filename": "src/librustc_back/target/mod.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/37b015fb912676e05625c974ed4d62136b98e3cb/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37b015fb912676e05625c974ed4d62136b98e3cb/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fmod.rs?ref=37b015fb912676e05625c974ed4d62136b98e3cb", "patch": "@@ -311,6 +311,9 @@ pub struct TargetOptions {\n     pub relocation_model: String,\n     /// Code model to use. Corresponds to `llc -code-model=$code_model`. Defaults to \"default\".\n     pub code_model: String,\n+    /// TLS model to use. Options are \"global-dynamic\" (default), \"local-dynamic\", \"initial-exec\"\n+    /// and \"local-exec\". This is similar to the -ftls-model option in GCC/Clang.\n+    pub tls_model: String,\n     /// Do not emit code that uses the \"red zone\", if the ABI has one. Defaults to false.\n     pub disable_redzone: bool,\n     /// Eliminate frame pointers from stack frames if possible. Defaults to true.\n@@ -450,6 +453,7 @@ impl Default for TargetOptions {\n             executables: false,\n             relocation_model: \"pic\".to_string(),\n             code_model: \"default\".to_string(),\n+            tls_model: \"global-dynamic\".to_string(),\n             disable_redzone: false,\n             eliminate_frame_pointer: true,\n             function_sections: true,\n@@ -696,6 +700,7 @@ impl Target {\n         key!(executables, bool);\n         key!(relocation_model);\n         key!(code_model);\n+        key!(tls_model);\n         key!(disable_redzone, bool);\n         key!(eliminate_frame_pointer, bool);\n         key!(function_sections, bool);\n@@ -888,6 +893,7 @@ impl ToJson for Target {\n         target_option_val!(executables);\n         target_option_val!(relocation_model);\n         target_option_val!(code_model);\n+        target_option_val!(tls_model);\n         target_option_val!(disable_redzone);\n         target_option_val!(eliminate_frame_pointer);\n         target_option_val!(function_sections);"}, {"sha": "6153d3dcdbba2da2d514671a2ca110623093eb6a", "filename": "src/librustc_trans/back/write.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/37b015fb912676e05625c974ed4d62136b98e3cb/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37b015fb912676e05625c974ed4d62136b98e3cb/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fwrite.rs?ref=37b015fb912676e05625c974ed4d62136b98e3cb", "patch": "@@ -173,9 +173,7 @@ pub fn target_machine_factory(sess: &Session)\n         Some(x) => x.1,\n         _ => {\n             sess.err(&format!(\"{:?} is not a valid code model\",\n-                             sess.opts\n-                                 .cg\n-                                 .code_model));\n+                              code_model_arg));\n             sess.abort_if_errors();\n             bug!();\n         }"}, {"sha": "cd9cb8c0df531aed9c99f7abb4c123887ee9f7bf", "filename": "src/librustc_trans/context.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/37b015fb912676e05625c974ed4d62136b98e3cb/src%2Flibrustc_trans%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37b015fb912676e05625c974ed4d62136b98e3cb/src%2Flibrustc_trans%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fcontext.rs?ref=37b015fb912676e05625c974ed4d62136b98e3cb", "patch": "@@ -159,9 +159,7 @@ pub fn get_reloc_model(sess: &Session) -> llvm::RelocMode {\n         Some(x) => x.1,\n         _ => {\n             sess.err(&format!(\"{:?} is not a valid relocation mode\",\n-                             sess.opts\n-                                 .cg\n-                                 .code_model));\n+                              reloc_model_arg));\n             sess.abort_if_errors();\n             bug!();\n         }"}]}