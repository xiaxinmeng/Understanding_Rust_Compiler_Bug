{"sha": "44e6883d1462ed4072b1d6a3ce6702bc14065045", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0ZTY4ODNkMTQ2MmVkNDA3MmIxZDZhM2NlNjcwMmJjMTQwNjUwNDU=", "commit": {"author": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2014-02-13T08:35:43Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-02-13T20:54:01Z"}, "message": "mk: make NO_REBUILD more forceful and more general.\n\nPreviously crates like `green` and `native` would still depend on their\nparents when running `make check-stage2-green NO_REBUILD=1`, this\nensures that they only depend on their source files.\n\nAlso, apply NO_REBUILD to the crate doc tests, so, for example,\n`check-stage2-doc-std` will use an already compiled `rustdoc` directly.", "tree": {"sha": "07ce59cd29bc51c375d5d216e76a67aa8591c925", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/07ce59cd29bc51c375d5d216e76a67aa8591c925"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44e6883d1462ed4072b1d6a3ce6702bc14065045", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44e6883d1462ed4072b1d6a3ce6702bc14065045", "html_url": "https://github.com/rust-lang/rust/commit/44e6883d1462ed4072b1d6a3ce6702bc14065045", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44e6883d1462ed4072b1d6a3ce6702bc14065045/comments", "author": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "065e121fc2675631e27b761d2ad5df3ee0c95976", "url": "https://api.github.com/repos/rust-lang/rust/commits/065e121fc2675631e27b761d2ad5df3ee0c95976", "html_url": "https://github.com/rust-lang/rust/commit/065e121fc2675631e27b761d2ad5df3ee0c95976"}], "stats": {"total": 34, "additions": 22, "deletions": 12}, "files": [{"sha": "a8ad51409d9161036e0cfad26633ece020daa8f2", "filename": "mk/tests.mk", "status": "modified", "additions": 22, "deletions": 12, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/44e6883d1462ed4072b1d6a3ce6702bc14065045/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/44e6883d1462ed4072b1d6a3ce6702bc14065045/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=44e6883d1462ed4072b1d6a3ce6702bc14065045", "patch": "@@ -333,21 +333,22 @@ $(foreach host,$(CFG_HOST), \\\n \n define TEST_RUNNER\n \n-# If NO_REBUILD is set then break the dependencies on extra so we can\n-# test crates without rebuilding std and extra first\n+# If NO_REBUILD is set then break the dependencies on everything but\n+# the source files so we can test crates without rebuilding any of the\n+# parent crates.\n ifeq ($(NO_REBUILD),)\n-STDTESTDEP_$(1)_$(2)_$(3)_$(4) = $$(SREQ$(1)_T_$(2)_H_$(3)) \\\n+TESTDEP_$(1)_$(2)_$(3)_$(4) = $$(SREQ$(1)_T_$(2)_H_$(3)) \\\n \t\t\t    $$(foreach crate,$$(TARGET_CRATES),\\\n-\t\t\t\t$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate))\n+\t\t\t\t$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate)) \\\n+\t\t\t\t$$(CRATE_FULLDEPS_$(1)_T_$(2)_H_$(3)_$(4))\n else\n-STDTESTDEP_$(1)_$(2)_$(3)_$(4) =\n+TESTDEP_$(1)_$(2)_$(3)_$(4) = $$(RSINPUTS_$(4))\n endif\n \n $(3)/stage$(1)/test/$(4)test-$(2)$$(X_$(2)): CFG_COMPILER = $(2)\n $(3)/stage$(1)/test/$(4)test-$(2)$$(X_$(2)):\t\t\t\t\\\n-\t\t$$(CRATEFILE_$(4))\t\t\t\t\t\\\n-\t\t$$(CRATE_FULLDEPS_$(1)_T_$(2)_H_$(3)_$(4))\t\t\\\n-\t\t$$(STDTESTDEP_$(1)_$(2)_$(3)_$(4))\n+\t\t$$(CRATEFILE_$(4)) \\\n+\t\t$$(TESTDEP_$(1)_$(2)_$(3)_$(4))\n \t@$$(call E, oxidize: $$@)\n \t$$(STAGE$(1)_T_$(2)_H_$(3)) -o $$@ $$< --test\t\\\n \t\t-L \"$$(RT_OUTPUT_DIR_$(2))\"\t\t\\\n@@ -684,13 +685,22 @@ $(foreach host,$(CFG_HOST), \\\n \n define DEF_CRATE_DOC_TEST\n \n+# If NO_REBUILD is set then break the dependencies on everything but\n+# the source files so we can test crate documentation without\n+# rebuilding any of the parent crates.\n+ifeq ($(NO_REBUILD),)\n+DOCTESTDEP_$(1)_$(2)_$(3)_$(4) = \\\n+\t$$(TEST_SREQ$(1)_T_$(2)_H_$(3))\t\t\t\t\\\n+\t$$(CRATE_FULLDEPS_$(1)_T_$(2)_H_$(3)_$(4))\t\t\\\n+\t$$(HBIN$(1)_H_$(3))/rustdoc$$(X_$(3))\n+else\n+DOCTESTDEP_$(1)_$(2)_$(3)_$(4) = $$(RSINPUTS_$(4))\n+endif\n+\n check-stage$(1)-T-$(2)-H-$(3)-doc-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),doc-$(4))\n \n ifeq ($(2),$$(CFG_BUILD))\n-$$(call TEST_OK_FILE,$(1),$(2),$(3),doc-$(4)):\t\t\t\t\\\n-\t        $$(TEST_SREQ$(1)_T_$(2)_H_$(3))\t\t\t\t\\\n-\t\t$$(CRATE_FULLDEPS_$(1)_T_$(2)_H_$(3)_$(4))\t\t\\\n-\t\t$$(HBIN$(1)_H_$(3))/rustdoc$$(X_$(3))\n+$$(call TEST_OK_FILE,$(1),$(2),$(3),doc-$(4)): $$(DOCTESTDEP_$(1)_$(2)_$(3)_$(4))\n \t@$$(call E, run doc-$(4) [$(2)])\n \t$$(Q)$$(HBIN$(1)_H_$(3))/rustdoc$$(X_$(3)) --test \\\n \t    $$(CRATEFILE_$(4)) --test-args \"$$(TESTARGS)\" && touch $$@"}]}