{"sha": "1b747a030f2dc1eba63f50f2c5f43938538e0c6a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiNzQ3YTAzMGYyZGMxZWJhNjNmNTBmMmM1ZjQzOTM4NTM4ZTBjNmE=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-07-02T15:20:59Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-07-02T15:20:59Z"}, "message": "mir: mark mir construction temporaries as internal\n\nThis commit marks temporaries from MIR construction as internal such\nthat they are skipped in `sanitize_witness` (where each MIR local is\nchecked to have been contained within the generator interior computed\nduring typeck). This resolves an ICE whereby the construction of checked\naddition introduced a `(u64, bool)` temporary which was not in the HIR\nand thus not in the generator interior.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "ba213b7f10641e9c5a8109d017271a93fb36c242", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba213b7f10641e9c5a8109d017271a93fb36c242"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b747a030f2dc1eba63f50f2c5f43938538e0c6a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl79+8kACgkQJZLnbIc4\nH9nVQw/9FeQZInfmaTd2m/+tEJy9+jcVJfFeYMROKI+PA1UqSOr/Sf04THpar0BI\nlGt2UJVheyh2TjbhncbtnOwKpZlAfKvWlE94omdco3iU/tiZRQfYsKykMbUlIUeI\ndL4PbLXLfvhf5bqg+6y1XGbQlcWQ0df7zktxB9CejLqme+9BUzBO6KCYUyTYaUMH\n63QusbYOfOxMcVAn70dsVhKCcJPDBbrtk19qt/itbDyFrusxr6vOY8gn3P99ySny\nvDbFvkbXI0ihsQHopQqYFKuvmHISQpCqnlfC4MNsr3yRGWF9lb5lIk971TT162M4\nJKLMv04bBUXUHd3SS8V5KPP3ULqWY1hdqC1kly0/eAOOpu2z3ENF7HIyozvtbLPC\nYBjJNr14Tj1ewrRVQyudnv+24I09WRvnG1YLvX+ZQjtSBDyEIC3iy6xwi5PQlBeU\nyzAiN5GfV9D+K9X8T5KNtnfdBFCMZhYOkQ6Z5KIgGyxhfsNBJ5JXsl08gCD/4NAB\ntKFpOyItzUudIJUoFgRheXS2lONsgvBjf9YmEnVEEhKfD37kT6zrCChSU4lUc5VG\nbgFNGOUw/TMism6alnVxWgNaFLvrwI4CkBaobzO3aLr+JB31Yc4xz3nBN8fT3Gaa\nzRcmSZyBZPn2D3EUki5Kgka8Da+Y1q0C9zqEGZ3sZIGM3WA0VXo=\n=8dRI\n-----END PGP SIGNATURE-----", "payload": "tree ba213b7f10641e9c5a8109d017271a93fb36c242\nparent 9491f18c5de3ff1c4bf9c3fdacf52d9859e26f7c\nauthor David Wood <david@davidtw.co> 1593703259 +0100\ncommitter David Wood <david@davidtw.co> 1593703259 +0100\n\nmir: mark mir construction temporaries as internal\n\nThis commit marks temporaries from MIR construction as internal such\nthat they are skipped in `sanitize_witness` (where each MIR local is\nchecked to have been contained within the generator interior computed\nduring typeck). This resolves an ICE whereby the construction of checked\naddition introduced a `(u64, bool)` temporary which was not in the HIR\nand thus not in the generator interior.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b747a030f2dc1eba63f50f2c5f43938538e0c6a", "html_url": "https://github.com/rust-lang/rust/commit/1b747a030f2dc1eba63f50f2c5f43938538e0c6a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b747a030f2dc1eba63f50f2c5f43938538e0c6a/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9491f18c5de3ff1c4bf9c3fdacf52d9859e26f7c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9491f18c5de3ff1c4bf9c3fdacf52d9859e26f7c", "html_url": "https://github.com/rust-lang/rust/commit/9491f18c5de3ff1c4bf9c3fdacf52d9859e26f7c"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "29651d9bc663a8380f436e8483a9555a8c6ac2bf", "filename": "src/librustc_mir_build/build/misc.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1b747a030f2dc1eba63f50f2c5f43938538e0c6a/src%2Flibrustc_mir_build%2Fbuild%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b747a030f2dc1eba63f50f2c5f43938538e0c6a/src%2Flibrustc_mir_build%2Fbuild%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir_build%2Fbuild%2Fmisc.rs?ref=1b747a030f2dc1eba63f50f2c5f43938538e0c6a", "patch": "@@ -15,7 +15,9 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n     /// N.B., **No cleanup is scheduled for this temporary.** You should\n     /// call `schedule_drop` once the temporary is initialized.\n     crate fn temp(&mut self, ty: Ty<'tcx>, span: Span) -> Place<'tcx> {\n-        let temp = self.local_decls.push(LocalDecl::new(ty, span));\n+        // Mark this local as internal to avoid temporaries with types not present in the\n+        // user's code resulting in ICEs from the generator transform.\n+        let temp = self.local_decls.push(LocalDecl::new(ty, span).internal());\n         let place = Place::from(temp);\n         debug!(\"temp: created temp {:?} with type {:?}\", place, self.local_decls[temp].ty);\n         place"}, {"sha": "1e99faaded4efce4187a4262b4da2b1fe91506fe", "filename": "src/test/ui/issue-73914.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/1b747a030f2dc1eba63f50f2c5f43938538e0c6a/src%2Ftest%2Fui%2Fissue-73914.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b747a030f2dc1eba63f50f2c5f43938538e0c6a/src%2Ftest%2Fui%2Fissue-73914.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-73914.rs?ref=1b747a030f2dc1eba63f50f2c5f43938538e0c6a", "patch": "@@ -0,0 +1,30 @@\n+// build-pass\n+// compile-flags:-Copt-level=0\n+// edition:2018\n+\n+struct S<T>(std::marker::PhantomData<T>);\n+\n+impl<T> std::ops::Deref for S<T> {\n+    type Target = T;\n+\n+    fn deref(&self) -> &Self::Target {\n+        todo!()\n+    }\n+}\n+impl<T> std::ops::DerefMut for S<T> {\n+    fn deref_mut(&mut self) -> &mut Self::Target {\n+        todo!()\n+    }\n+}\n+\n+async fn new() -> S<u64> {\n+    todo!()\n+}\n+\n+async fn crash() {\n+    *new().await = 1 + 1;\n+}\n+\n+fn main() {\n+    let _ = crash();\n+}"}]}