{"sha": "355b99f954b743a89ab3d2fa22e7a09e82ebfe72", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1NWI5OWY5NTRiNzQzYTg5YWIzZDJmYTIyZTdhMDllODJlYmZlNzI=", "commit": {"author": {"name": "Hideki Sekine", "email": "sekineh@me.com", "date": "2018-07-17T16:42:53Z"}, "committer": {"name": "Hideki Sekine", "email": "sekineh@me.com", "date": "2018-07-17T16:42:53Z"}, "message": "Cleanup Dockerfile.", "tree": {"sha": "6a62ed8932a8ee8c92c68fb94ad5bc7dbccfbbd4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a62ed8932a8ee8c92c68fb94ad5bc7dbccfbbd4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/355b99f954b743a89ab3d2fa22e7a09e82ebfe72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/355b99f954b743a89ab3d2fa22e7a09e82ebfe72", "html_url": "https://github.com/rust-lang/rust/commit/355b99f954b743a89ab3d2fa22e7a09e82ebfe72", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/355b99f954b743a89ab3d2fa22e7a09e82ebfe72/comments", "author": {"login": "sekineh", "id": 3956266, "node_id": "MDQ6VXNlcjM5NTYyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3956266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekineh", "html_url": "https://github.com/sekineh", "followers_url": "https://api.github.com/users/sekineh/followers", "following_url": "https://api.github.com/users/sekineh/following{/other_user}", "gists_url": "https://api.github.com/users/sekineh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekineh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekineh/subscriptions", "organizations_url": "https://api.github.com/users/sekineh/orgs", "repos_url": "https://api.github.com/users/sekineh/repos", "events_url": "https://api.github.com/users/sekineh/events{/privacy}", "received_events_url": "https://api.github.com/users/sekineh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sekineh", "id": 3956266, "node_id": "MDQ6VXNlcjM5NTYyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3956266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekineh", "html_url": "https://github.com/sekineh", "followers_url": "https://api.github.com/users/sekineh/followers", "following_url": "https://api.github.com/users/sekineh/following{/other_user}", "gists_url": "https://api.github.com/users/sekineh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekineh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekineh/subscriptions", "organizations_url": "https://api.github.com/users/sekineh/orgs", "repos_url": "https://api.github.com/users/sekineh/repos", "events_url": "https://api.github.com/users/sekineh/events{/privacy}", "received_events_url": "https://api.github.com/users/sekineh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d8e64e1540998de71020a01434859ccf4702581b", "url": "https://api.github.com/repos/rust-lang/rust/commits/d8e64e1540998de71020a01434859ccf4702581b", "html_url": "https://github.com/rust-lang/rust/commit/d8e64e1540998de71020a01434859ccf4702581b"}], "stats": {"total": 79, "additions": 0, "deletions": 79}, "files": [{"sha": "354c022305e9b00af5b7f738e9c5b814f41cf4d4", "filename": "src/ci/docker/thumb-none/Dockerfile", "status": "modified", "additions": 0, "deletions": 79, "changes": 79, "blob_url": "https://github.com/rust-lang/rust/blob/355b99f954b743a89ab3d2fa22e7a09e82ebfe72/src%2Fci%2Fdocker%2Fthumb-none%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/355b99f954b743a89ab3d2fa22e7a09e82ebfe72/src%2Fci%2Fdocker%2Fthumb-none%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fthumb-none%2FDockerfile?ref=355b99f954b743a89ab3d2fa22e7a09e82ebfe72", "patch": "@@ -12,98 +12,19 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   xz-utils \\\n   zlib1g-dev \\\n-  g++-arm-linux-gnueabi \\\n-  g++-arm-linux-gnueabihf \\\n-  g++-aarch64-linux-gnu \\\n-  gcc-sparc64-linux-gnu \\\n-  libc6-dev-sparc64-cross \\\n   bzip2 \\\n   patch \\\n   libssl-dev \\\n   pkg-config \\\n   gcc-arm-none-eabi \\\n   libnewlib-arm-none-eabi\n \n-WORKDIR /build\n-\n-COPY dist-various-1/build-rumprun.sh /build\n-RUN ./build-rumprun.sh\n-\n-COPY dist-various-1/install-x86_64-redox.sh /build\n-RUN ./install-x86_64-redox.sh\n-\n-COPY dist-various-1/install-mips-musl.sh /build\n-RUN ./install-mips-musl.sh\n-\n-COPY dist-various-1/install-mipsel-musl.sh /build\n-RUN ./install-mipsel-musl.sh\n-\n-# Suppress some warnings in the openwrt toolchains we downloaded\n-ENV STAGING_DIR=/tmp\n-\n-COPY scripts/musl.sh /build\n-RUN env \\\n-    CC=arm-linux-gnueabi-gcc CFLAGS=\"-march=armv5te -marm -mfloat-abi=soft\" \\\n-    CXX=arm-linux-gnueabi-g++ CXXFLAGS=\"-march=armv5te -marm -mfloat-abi=soft\" \\\n-    bash musl.sh armv5te && \\\n-    env \\\n-    CC=arm-linux-gnueabi-gcc CFLAGS=\"-march=armv6 -marm\" \\\n-    CXX=arm-linux-gnueabi-g++ CXXFLAGS=\"-march=armv6 -marm\" \\\n-    bash musl.sh arm && \\\n-    env \\\n-    CC=arm-linux-gnueabihf-gcc CFLAGS=\"-march=armv6 -marm\" \\\n-    CXX=arm-linux-gnueabihf-g++ CXXFLAGS=\"-march=armv6 -marm\" \\\n-    bash musl.sh armhf && \\\n-    env \\\n-    CC=arm-linux-gnueabihf-gcc CFLAGS=\"-march=armv7-a\" \\\n-    CXX=arm-linux-gnueabihf-g++ CXXFLAGS=\"-march=armv7-a\" \\\n-    bash musl.sh armv7 && \\\n-    env \\\n-    CC=aarch64-linux-gnu-gcc \\\n-    CXX=aarch64-linux-gnu-g++ \\\n-    bash musl.sh aarch64 && \\\n-    env \\\n-    CC=mips-openwrt-linux-gcc \\\n-    CXX=mips-openwrt-linux-g++ \\\n-    bash musl.sh mips && \\\n-    env \\\n-    CC=mipsel-openwrt-linux-gcc \\\n-    CXX=mipsel-openwrt-linux-g++ \\\n-    bash musl.sh mipsel && \\\n-    rm -rf /build/*\n-\n-# FIXME(mozilla/sccache#235) this shouldn't be necessary but is currently\n-# necessary to disambiguate the mips compiler with the mipsel compiler. We want\n-# to give these two wrapper scripts (currently identical ones) different hashes\n-# to ensure that sccache understands that they're different compilers.\n-RUN \\\n-  echo \"# a\" >> /usr/local/mips-linux-musl/bin/mips-openwrt-linux-musl-wrapper.sh && \\\n-  echo \"# b\" >> /usr/local/mipsel-linux-musl/bin/mipsel-openwrt-linux-musl-wrapper.sh\n-\n # ENV TARGETS=thumbv6m-none-eabi\n ENV TARGETS=thumbv7m-none-eabi\n ENV TARGETS=$TARGETS,thumbv7em-none-eabi\n ENV TARGETS=$TARGETS,thumbv7em-none-eabihf\n \n-# FIXME: remove armv5te vars after https://github.com/alexcrichton/cc-rs/issues/271\n-#        get fixed and cc update\n-ENV CC_mipsel_unknown_linux_musl=mipsel-openwrt-linux-gcc \\\n-    CC_mips_unknown_linux_musl=mips-openwrt-linux-gcc \\\n-    CC_sparc64_unknown_linux_gnu=sparc64-linux-gnu-gcc \\\n-    CC_x86_64_unknown_redox=x86_64-unknown-redox-gcc \\\n-    CC_armv5te_unknown_linux_gnueabi=arm-linux-gnueabi-gcc \\\n-    CFLAGS_armv5te_unknown_linux_gnueabi=\"-march=armv5te -marm -mfloat-abi=soft\" \\\n-    CC_armv5te_unknown_linux_musleabi=arm-linux-gnueabi-gcc \\\n-    CFLAGS_armv5te_unknown_linux_musleabi=\"-march=armv5te -marm -mfloat-abi=soft\"\n-\n ENV RUST_CONFIGURE_ARGS \\\n-      --musl-root-armv5te=/musl-armv5te \\\n-      --musl-root-arm=/musl-arm \\\n-      --musl-root-armhf=/musl-armhf \\\n-      --musl-root-armv7=/musl-armv7 \\\n-      --musl-root-aarch64=/musl-aarch64 \\\n-      --musl-root-mips=/musl-mips \\\n-      --musl-root-mipsel=/musl-mipsel \\\n       --disable-docs\n \n ENV SCRIPT python2.7 ../x.py test --target $TARGETS src/test/run-make"}]}