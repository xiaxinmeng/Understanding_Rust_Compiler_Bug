{"sha": "00bce71144643c7b6c46f9feb6be69de6a61ceed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwYmNlNzExNDQ2NDNjN2I2YzQ2ZjlmZWI2YmU2OWRlNmE2MWNlZWQ=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2018-02-11T23:27:33Z"}, "committer": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2018-02-11T23:27:33Z"}, "message": "Delete executables if the test ran successfully.\n\nThis isn't a perfect heuristic, but since the amount of run-fail tests\nis far lower than run-pass tests for now, it should be sufficient to\nensure that we don't run into CI limits. This makes it possible to run\nthe test binary manually (e.g., under gdb/lldb) if it failed to attempt\nto find out why.", "tree": {"sha": "efceaef964fd6f304e0d1d4333fa9e696cbf0c98", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/efceaef964fd6f304e0d1d4333fa9e696cbf0c98"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00bce71144643c7b6c46f9feb6be69de6a61ceed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00bce71144643c7b6c46f9feb6be69de6a61ceed", "html_url": "https://github.com/rust-lang/rust/commit/00bce71144643c7b6c46f9feb6be69de6a61ceed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00bce71144643c7b6c46f9feb6be69de6a61ceed/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66ee33a43730d99409a586a1fd437b320d14f903", "url": "https://api.github.com/repos/rust-lang/rust/commits/66ee33a43730d99409a586a1fd437b320d14f903", "html_url": "https://github.com/rust-lang/rust/commit/66ee33a43730d99409a586a1fd437b320d14f903"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "a87809dd7bcfd673dd058fa5d3feb66667925990", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/00bce71144643c7b6c46f9feb6be69de6a61ceed/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00bce71144643c7b6c46f9feb6be69de6a61ceed/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=00bce71144643c7b6c46f9feb6be69de6a61ceed", "patch": "@@ -1400,9 +1400,11 @@ impl<'test> TestCx<'test> {\n             }\n         };\n \n-        // delete the executable after running it to save space.\n-        // it is ok if the deletion failed.\n-        let _ = fs::remove_file(self.make_exe_name());\n+        if proc_res.status.success() {\n+            // delete the executable after running it to save space.\n+            // it is ok if the deletion failed.\n+            let _ = fs::remove_file(self.make_exe_name());\n+        }\n \n         proc_res\n     }"}]}