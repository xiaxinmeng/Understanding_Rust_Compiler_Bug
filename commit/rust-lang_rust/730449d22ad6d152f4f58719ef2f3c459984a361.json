{"sha": "730449d22ad6d152f4f58719ef2f3c459984a361", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczMDQ0OWQyMmFkNmQxNTJmNGY1ODcxOWVmMmYzYzQ1OTk4NGEzNjE=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-08-26T23:14:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-08-26T23:14:04Z"}, "message": "Rollup merge of #75758 - bpangWR:master, r=Mark-Simulacrum\n\nFixes for VxWorks\n\nr? @alexcrichton", "tree": {"sha": "166c38414805a5dda438395793da122f4261936b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/166c38414805a5dda438395793da122f4261936b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/730449d22ad6d152f4f58719ef2f3c459984a361", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfRuy9CRBK7hj4Ov3rIwAAdHIIADKJeanWQ1/zk7h2jWVMzpaX\nH5je935Yke9CJoAeAxpsqwLWEdf9fSfkBc/pwfRsz2MuWxagSwRiIeW9OihRIdUr\nSO9q1ctICwfoQQ7TA9vyCz2TsXiFjSijq5qpDTA/wih0rEZWALL2HiLiHymc/QP3\nWRyQCg/sB7esjLoEEXxPfpQgC1kXshsdQjN2K9QbaFb/lJ7WBETeRfNhcOrh2XQ/\nPTA9CGjlsEKthRY3Ih0v7yaCQodQugPEk6gVAcrRnv2U5v9kEDa1/3LgZ5MkPsA6\nS5cvckq97N3oumr3zWmvTosv/jdQVIe0+HkAK2iNwFqJk7/CmrKGAxE04RfTofM=\n=Vg16\n-----END PGP SIGNATURE-----\n", "payload": "tree 166c38414805a5dda438395793da122f4261936b\nparent 2eec2ecbdec1cae9b749e079a376540d9cc5e304\nparent 079baafdf1fc90805373ff2ef7d57eea3a7f15ce\nauthor Dylan DPC <dylan.dpc@gmail.com> 1598483644 +0200\ncommitter GitHub <noreply@github.com> 1598483644 +0200\n\nRollup merge of #75758 - bpangWR:master, r=Mark-Simulacrum\n\nFixes for VxWorks\n\nr? @alexcrichton\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/730449d22ad6d152f4f58719ef2f3c459984a361", "html_url": "https://github.com/rust-lang/rust/commit/730449d22ad6d152f4f58719ef2f3c459984a361", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/730449d22ad6d152f4f58719ef2f3c459984a361/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2eec2ecbdec1cae9b749e079a376540d9cc5e304", "url": "https://api.github.com/repos/rust-lang/rust/commits/2eec2ecbdec1cae9b749e079a376540d9cc5e304", "html_url": "https://github.com/rust-lang/rust/commit/2eec2ecbdec1cae9b749e079a376540d9cc5e304"}, {"sha": "079baafdf1fc90805373ff2ef7d57eea3a7f15ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/079baafdf1fc90805373ff2ef7d57eea3a7f15ce", "html_url": "https://github.com/rust-lang/rust/commit/079baafdf1fc90805373ff2ef7d57eea3a7f15ce"}], "stats": {"total": 26, "additions": 11, "deletions": 15}, "files": [{"sha": "d58468ad539ff92ca0a9d4d96fd260c01d7329b2", "filename": "library/std/src/sys/vxworks/fd.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/730449d22ad6d152f4f58719ef2f3c459984a361/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Ffd.rs", "raw_url": "https://github.com/rust-lang/rust/raw/730449d22ad6d152f4f58719ef2f3c459984a361/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Ffd.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Ffd.rs?ref=730449d22ad6d152f4f58719ef2f3c459984a361", "patch": "@@ -53,7 +53,7 @@ impl FileDesc {\n     }\n \n     #[inline]\n-    fn is_read_vectored(&self) -> bool {\n+    pub fn is_read_vectored(&self) -> bool {\n         true\n     }\n "}, {"sha": "6473a0c3cec41aa764d824f02a81f1765773b781", "filename": "library/std/src/sys/vxworks/process/process_common.rs", "status": "modified", "additions": 3, "deletions": 12, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/730449d22ad6d152f4f58719ef2f3c459984a361/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Fprocess%2Fprocess_common.rs", "raw_url": "https://github.com/rust-lang/rust/raw/730449d22ad6d152f4f58719ef2f3c459984a361/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Fprocess%2Fprocess_common.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Fprocess%2Fprocess_common.rs?ref=730449d22ad6d152f4f58719ef2f3c459984a361", "patch": "@@ -351,28 +351,19 @@ impl ExitStatus {\n     }\n \n     fn exited(&self) -> bool {\n-        /*unsafe*/\n-        { libc::WIFEXITED(self.0) }\n+        libc::WIFEXITED(self.0)\n     }\n \n     pub fn success(&self) -> bool {\n         self.code() == Some(0)\n     }\n \n     pub fn code(&self) -> Option<i32> {\n-        if self.exited() {\n-            Some(/*unsafe*/ { libc::WEXITSTATUS(self.0) })\n-        } else {\n-            None\n-        }\n+        if self.exited() { Some(libc::WEXITSTATUS(self.0)) } else { None }\n     }\n \n     pub fn signal(&self) -> Option<i32> {\n-        if !self.exited() {\n-            Some(/*unsafe*/ { libc::WTERMSIG(self.0) })\n-        } else {\n-            None\n-        }\n+        if !self.exited() { Some(libc::WTERMSIG(self.0)) } else { None }\n     }\n }\n "}, {"sha": "5391ed83ebc36267e5932ba1723411bdc3e722a6", "filename": "library/std/src/sys/vxworks/thread_local_dtor.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/730449d22ad6d152f4f58719ef2f3c459984a361/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Fthread_local_dtor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/730449d22ad6d152f4f58719ef2f3c459984a361/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Fthread_local_dtor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fvxworks%2Fthread_local_dtor.rs?ref=730449d22ad6d152f4f58719ef2f3c459984a361", "patch": "@@ -2,6 +2,6 @@\n #![unstable(feature = \"thread_local_internals\", issue = \"none\")]\n \n pub unsafe fn register_dtor(t: *mut u8, dtor: unsafe extern \"C\" fn(*mut u8)) {\n-    use crate::sys_common::thread_local::register_dtor_fallback;\n+    use crate::sys_common::thread_local_dtor::register_dtor_fallback;\n     register_dtor_fallback(t, dtor);\n }"}, {"sha": "d50e4cf52697a30bd96338ba12c11e01a852f8cf", "filename": "src/bootstrap/cc_detect.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/730449d22ad6d152f4f58719ef2f3c459984a361/src%2Fbootstrap%2Fcc_detect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/730449d22ad6d152f4f58719ef2f3c459984a361/src%2Fbootstrap%2Fcc_detect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcc_detect.rs?ref=730449d22ad6d152f4f58719ef2f3c459984a361", "patch": "@@ -132,7 +132,8 @@ pub fn find(build: &mut Build) {\n             false\n         };\n \n-        if cxx_configured {\n+        // for VxWorks, record CXX compiler which will be used in lib.rs:linker()\n+        if cxx_configured || target.contains(\"vxworks\") {\n             let compiler = cfg.get_compiler();\n             build.cxx.insert(target, compiler);\n         }"}, {"sha": "191cc5b0b64ca85db834c46305059b9de884ab44", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/730449d22ad6d152f4f58719ef2f3c459984a361/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/730449d22ad6d152f4f58719ef2f3c459984a361/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=730449d22ad6d152f4f58719ef2f3c459984a361", "patch": "@@ -854,6 +854,10 @@ impl Build {\n         if let Some(linker) = self.config.target_config.get(&target).and_then(|c| c.linker.as_ref())\n         {\n             Some(linker)\n+        } else if target.contains(\"vxworks\") {\n+            // need to use CXX compiler as linker to resolve the exception functions\n+            // that are only existed in CXX libraries\n+            Some(self.cxx[&target].path())\n         } else if target != self.config.build\n             && util::use_host_linker(target)\n             && !target.contains(\"msvc\")"}]}