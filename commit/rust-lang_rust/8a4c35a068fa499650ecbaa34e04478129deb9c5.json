{"sha": "8a4c35a068fa499650ecbaa34e04478129deb9c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhhNGMzNWEwNjhmYTQ5OTY1MGVjYmFhMzRlMDQ0NzgxMjlkZWI5YzU=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-09-07T15:26:21Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-09-07T15:26:21Z"}, "message": "Treat path dependencies like workspace members", "tree": {"sha": "96c838357cd4413a2f25e840c8f7e612c0ef4414", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/96c838357cd4413a2f25e840c8f7e612c0ef4414"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8a4c35a068fa499650ecbaa34e04478129deb9c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8a4c35a068fa499650ecbaa34e04478129deb9c5", "html_url": "https://github.com/rust-lang/rust/commit/8a4c35a068fa499650ecbaa34e04478129deb9c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8a4c35a068fa499650ecbaa34e04478129deb9c5/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3dae94bf2b3e496adb049da589c7efef272a39b8", "url": "https://api.github.com/repos/rust-lang/rust/commits/3dae94bf2b3e496adb049da589c7efef272a39b8", "html_url": "https://github.com/rust-lang/rust/commit/3dae94bf2b3e496adb049da589c7efef272a39b8"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "b15c53a1303a5ee1585d68c8f6623cb63a0dd326", "filename": "crates/project_model/src/cargo_workspace.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8a4c35a068fa499650ecbaa34e04478129deb9c5/crates%2Fproject_model%2Fsrc%2Fcargo_workspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a4c35a068fa499650ecbaa34e04478129deb9c5/crates%2Fproject_model%2Fsrc%2Fcargo_workspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproject_model%2Fsrc%2Fcargo_workspace.rs?ref=8a4c35a068fa499650ecbaa34e04478129deb9c5", "patch": "@@ -296,19 +296,19 @@ impl CargoWorkspace {\n         let mut packages = Arena::default();\n         let mut targets = Arena::default();\n \n-        let ws_members = &meta.workspace_members;\n-\n         meta.packages.sort_by(|a, b| a.id.cmp(&b.id));\n         for meta_pkg in &meta.packages {\n             let cargo_metadata::Package {\n                 id, edition, name, manifest_path, version, metadata, ..\n             } = meta_pkg;\n             let meta = from_value::<PackageMetadata>(metadata.clone()).unwrap_or_default();\n-            let is_member = ws_members.contains(id);\n             let edition = edition.parse::<Edition>().unwrap_or_else(|err| {\n                 tracing::error!(\"Failed to parse edition {}\", err);\n                 Edition::CURRENT\n             });\n+            // We treat packages without source as \"local\" packages. That includes all members of\n+            // the current workspace, as well as any path dependency outside the workspace.\n+            let is_member = meta_pkg.source.is_none();\n \n             let pkg = packages.alloc(PackageData {\n                 id: id.repr.clone(),"}]}