{"sha": "a93fdfedf36dcb909d90cbf963b087c5873bec1d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5M2ZkZmVkZjM2ZGNiOTA5ZDkwY2JmOTYzYjA4N2M1ODczYmVjMWQ=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-07-16T18:06:17Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-07-24T09:27:58Z"}, "message": "Merge `rustc_allocator` into `libsyntax_ext`", "tree": {"sha": "a6cd8127f5490298317446aa618a640316992016", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6cd8127f5490298317446aa618a640316992016"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a93fdfedf36dcb909d90cbf963b087c5873bec1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a93fdfedf36dcb909d90cbf963b087c5873bec1d", "html_url": "https://github.com/rust-lang/rust/commit/a93fdfedf36dcb909d90cbf963b087c5873bec1d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a93fdfedf36dcb909d90cbf963b087c5873bec1d/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a7f28678bbf4e16893bb6a718e427504167a9494", "url": "https://api.github.com/repos/rust-lang/rust/commits/a7f28678bbf4e16893bb6a718e427504167a9494", "html_url": "https://github.com/rust-lang/rust/commit/a7f28678bbf4e16893bb6a718e427504167a9494"}], "stats": {"total": 133, "additions": 41, "deletions": 92}, "files": [{"sha": "8993254627863540e842d6ebb48e3f91b2319cea", "filename": "Cargo.lock", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -2751,20 +2751,6 @@ dependencies = [\n  \"winapi 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n-[[package]]\n-name = \"rustc_allocator\"\n-version = \"0.0.0\"\n-dependencies = [\n- \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rustc 0.0.0\",\n- \"rustc_data_structures 0.0.0\",\n- \"rustc_errors 0.0.0\",\n- \"rustc_target 0.0.0\",\n- \"smallvec 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syntax 0.0.0\",\n- \"syntax_pos 0.0.0\",\n-]\n-\n [[package]]\n name = \"rustc_apfloat\"\n version = \"0.0.0\"\n@@ -2822,7 +2808,6 @@ dependencies = [\n  \"num_cpus 1.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"parking_lot 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n- \"rustc_allocator 0.0.0\",\n  \"rustc_apfloat 0.0.0\",\n  \"rustc_codegen_utils 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n@@ -2883,7 +2868,6 @@ dependencies = [\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n  \"rustc-rayon 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rustc_allocator 0.0.0\",\n  \"rustc_ast_borrowck 0.0.0\",\n  \"rustc_codegen_utils 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n@@ -2904,7 +2888,6 @@ dependencies = [\n  \"serialize 0.0.0\",\n  \"smallvec 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"syntax 0.0.0\",\n- \"syntax_ext 0.0.0\",\n  \"syntax_pos 0.0.0\",\n ]\n \n@@ -2948,7 +2931,6 @@ dependencies = [\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n  \"rustc-rayon 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rustc_allocator 0.0.0\",\n  \"rustc_ast_borrowck 0.0.0\",\n  \"rustc_codegen_ssa 0.0.0\",\n  \"rustc_codegen_utils 0.0.0\","}, {"sha": "45c6aa63c5581e42e2f148e7e181e038ef78d1e3", "filename": "src/librustc/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flib.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -112,7 +112,6 @@ pub mod infer;\n pub mod lint;\n \n pub mod middle {\n-    pub mod allocator;\n     pub mod borrowck;\n     pub mod expr_use_visitor;\n     pub mod cstore;"}, {"sha": "bb2e3b4ec19715c7f2bc830dce78b164a56addb3", "filename": "src/librustc/middle/allocator.rs", "status": "removed", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a7f28678bbf4e16893bb6a718e427504167a9494/src%2Flibrustc%2Fmiddle%2Fallocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7f28678bbf4e16893bb6a718e427504167a9494/src%2Flibrustc%2Fmiddle%2Fallocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fallocator.rs?ref=a7f28678bbf4e16893bb6a718e427504167a9494", "patch": "@@ -1,16 +0,0 @@\n-#[derive(Clone, Copy)]\n-pub enum AllocatorKind {\n-    Global,\n-    DefaultLib,\n-    DefaultExe,\n-}\n-\n-impl AllocatorKind {\n-    pub fn fn_name(&self, base: &str) -> String {\n-        match *self {\n-            AllocatorKind::Global => format!(\"__rg_{}\", base),\n-            AllocatorKind::DefaultLib => format!(\"__rdl_{}\", base),\n-            AllocatorKind::DefaultExe => format!(\"__rde_{}\", base),\n-        }\n-    }\n-}"}, {"sha": "d7620817f04484af21a5a2850b2ae38a5845c240", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -7,7 +7,6 @@ use rustc_data_structures::fingerprint::Fingerprint;\n \n use crate::lint;\n use crate::lint::builtin::BuiltinLintDiagnostics;\n-use crate::middle::allocator::AllocatorKind;\n use crate::middle::dependency_format;\n use crate::session::config::{OutputType, PrintRequest, SwitchWithOptPath};\n use crate::session::search_paths::{PathKind, SearchPath};\n@@ -27,6 +26,7 @@ use errors::emitter::HumanReadableErrorType;\n use errors::annotate_snippet_emitter_writer::{AnnotateSnippetEmitterWriter};\n use syntax::ast::{self, NodeId};\n use syntax::edition::Edition;\n+use syntax::ext::allocator::AllocatorKind;\n use syntax::feature_gate::{self, AttributeType};\n use syntax::json::JsonEmitter;\n use syntax::source_map;"}, {"sha": "a964f323c9e7d06214eb8831b2fbbc81a13bee58", "filename": "src/librustc_allocator/Cargo.toml", "status": "removed", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/a7f28678bbf4e16893bb6a718e427504167a9494/src%2Flibrustc_allocator%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a7f28678bbf4e16893bb6a718e427504167a9494/src%2Flibrustc_allocator%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_allocator%2FCargo.toml?ref=a7f28678bbf4e16893bb6a718e427504167a9494", "patch": "@@ -1,19 +0,0 @@\n-[package]\n-authors = [\"The Rust Project Developers\"]\n-name = \"rustc_allocator\"\n-version = \"0.0.0\"\n-edition = \"2018\"\n-\n-[lib]\n-path = \"lib.rs\"\n-test = false\n-\n-[dependencies]\n-rustc = { path = \"../librustc\" }\n-rustc_data_structures = { path = \"../librustc_data_structures\" }\n-rustc_errors = { path = \"../librustc_errors\" }\n-rustc_target = { path = \"../librustc_target\" }\n-syntax = { path = \"../libsyntax\" }\n-syntax_pos = { path = \"../libsyntax_pos\" }\n-log = \"0.4\"\n-smallvec = { version = \"0.6.7\", features = [\"union\", \"may_dangle\"] }"}, {"sha": "5d43bf6ae28bf662c208365f483ac7732bf4790d", "filename": "src/librustc_codegen_llvm/allocator.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_llvm%2Fallocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_llvm%2Fallocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fallocator.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -2,9 +2,8 @@ use std::ffi::CString;\n \n use crate::attributes;\n use libc::c_uint;\n-use rustc::middle::allocator::AllocatorKind;\n use rustc::ty::TyCtxt;\n-use rustc_allocator::{ALLOCATOR_METHODS, AllocatorTy};\n+use syntax::ext::allocator::{AllocatorKind, AllocatorTy, ALLOCATOR_METHODS};\n \n use crate::ModuleLlvm;\n use crate::llvm::{self, False, True};"}, {"sha": "8dd241bd81a0a1490cb0da0b6af4e42d8225c8e5", "filename": "src/librustc_codegen_llvm/lib.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_llvm%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_llvm%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Flib.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -32,7 +32,6 @@ extern crate flate2;\n #[macro_use] extern crate bitflags;\n extern crate libc;\n #[macro_use] extern crate rustc;\n-extern crate rustc_allocator;\n extern crate rustc_target;\n #[macro_use] extern crate rustc_data_structures;\n extern crate rustc_incremental;\n@@ -52,13 +51,13 @@ use rustc_codegen_ssa::back::lto::{SerializedModule, LtoModuleCodegen, ThinModul\n use rustc_codegen_ssa::CompiledModule;\n use errors::{FatalError, Handler};\n use rustc::dep_graph::WorkProduct;\n+use syntax::ext::allocator::AllocatorKind;\n use syntax_pos::symbol::InternedString;\n pub use llvm_util::target_features;\n use std::any::Any;\n use std::sync::{mpsc, Arc};\n \n use rustc::dep_graph::DepGraph;\n-use rustc::middle::allocator::AllocatorKind;\n use rustc::middle::cstore::{EncodedMetadata, MetadataLoader};\n use rustc::session::Session;\n use rustc::session::config::{OutputFilenames, OutputType, PrintRequest, OptLevel};"}, {"sha": "3c51c777f53e172c0549a76abc272056174f076f", "filename": "src/librustc_codegen_ssa/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_ssa%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_ssa%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2FCargo.toml?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -24,7 +24,6 @@ serialize = { path = \"../libserialize\" }\n syntax = { path = \"../libsyntax\" }\n syntax_pos = { path = \"../libsyntax_pos\" }\n rustc = { path = \"../librustc\" }\n-rustc_allocator = { path = \"../librustc_allocator\" }\n rustc_apfloat = { path = \"../librustc_apfloat\" }\n rustc_codegen_utils = { path = \"../librustc_codegen_utils\" }\n rustc_data_structures = { path = \"../librustc_data_structures\"}"}, {"sha": "2d9220f897cff63f43c9c42dfdd0f9a466ee8b5f", "filename": "src/librustc_codegen_ssa/back/symbol_export.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_ssa%2Fback%2Fsymbol_export.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_ssa%2Fback%2Fsymbol_export.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Fsymbol_export.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -1,3 +1,4 @@\n+use std::collections::hash_map::Entry::*;\n use std::sync::Arc;\n \n use rustc::ty::Instance;\n@@ -12,9 +13,8 @@ use rustc::ty::{TyCtxt, SymbolName};\n use rustc::ty::query::Providers;\n use rustc::ty::subst::SubstsRef;\n use rustc::util::nodemap::{FxHashMap, DefIdMap};\n-use rustc_allocator::ALLOCATOR_METHODS;\n use rustc_data_structures::indexed_vec::IndexVec;\n-use std::collections::hash_map::Entry::*;\n+use syntax::ext::allocator::ALLOCATOR_METHODS;\n \n pub type ExportedSymbols = FxHashMap<\n     CrateNum,"}, {"sha": "9fbb44dcc9959dfc627f5b441c744d5e9b7c526f", "filename": "src/librustc_codegen_ssa/traits/backend.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_ssa%2Ftraits%2Fbackend.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_codegen_ssa%2Ftraits%2Fbackend.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Ftraits%2Fbackend.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -3,12 +3,12 @@ use rustc::ty::Ty;\n \n use super::write::WriteBackendMethods;\n use super::CodegenObject;\n-use rustc::middle::allocator::AllocatorKind;\n use rustc::middle::cstore::EncodedMetadata;\n use rustc::session::{Session, config};\n use rustc::ty::TyCtxt;\n use rustc_codegen_utils::codegen_backend::CodegenBackend;\n use std::sync::Arc;\n+use syntax::ext::allocator::AllocatorKind;\n use syntax_pos::symbol::InternedString;\n \n pub trait BackendTypes {"}, {"sha": "aafc78cf94effc5f250af65116e8d4562bed409f", "filename": "src/librustc_driver/Cargo.toml", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_driver%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_driver%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2FCargo.toml?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -16,7 +16,6 @@ log = \"0.4\"\n env_logger = { version = \"0.5\", default-features = false }\n rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n rustc = { path = \"../librustc\" }\n-rustc_allocator = { path = \"../librustc_allocator\" }\n rustc_target = { path = \"../librustc_target\" }\n rustc_ast_borrowck = { path = \"../librustc_ast_borrowck\" }\n rustc_data_structures = { path = \"../librustc_data_structures\" }\n@@ -37,5 +36,4 @@ rustc_interface = { path = \"../librustc_interface\" }\n serialize = { path = \"../libserialize\" }\n syntax = { path = \"../libsyntax\" }\n smallvec = { version = \"0.6.7\", features = [\"union\", \"may_dangle\"] }\n-syntax_ext = { path = \"../libsyntax_ext\" }\n syntax_pos = { path = \"../libsyntax_pos\" }"}, {"sha": "44fe3ff2c9df8d87a4a23aa8e31932af1ecc4510", "filename": "src/librustc_interface/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_interface%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_interface%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2FCargo.toml?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -18,7 +18,6 @@ syntax_ext = { path = \"../libsyntax_ext\" }\n syntax_pos = { path = \"../libsyntax_pos\" }\n serialize = { path = \"../libserialize\" }\n rustc = { path = \"../librustc\" }\n-rustc_allocator = { path = \"../librustc_allocator\" }\n rustc_ast_borrowck = { path = \"../librustc_ast_borrowck\" }\n rustc_incremental = { path = \"../librustc_incremental\" }\n rustc_traits = { path = \"../librustc_traits\" }"}, {"sha": "d4a922ddd49e34640ba0376627c9f3dd0a5c4397", "filename": "src/librustc_interface/passes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_interface%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_interface%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Fpasses.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -497,7 +497,7 @@ fn configure_and_expand_inner<'a>(\n     if has_global_allocator {\n         // Expand global allocators, which are treated as an in-tree proc macro\n         time(sess, \"creating allocators\", || {\n-            allocator::expand::modify(\n+            syntax_ext::global_allocator::modify(\n                 &sess.parse_sess,\n                 &mut resolver,\n                 &mut krate,"}, {"sha": "31f70155b4e379e2c861b50e9b6844878f740271", "filename": "src/librustc_metadata/creader.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_metadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibrustc_metadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcreader.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -8,7 +8,6 @@ use rustc_data_structures::sync::{Lrc, RwLock, Lock};\n \n use rustc::hir::def_id::CrateNum;\n use rustc_data_structures::svh::Svh;\n-use rustc::middle::allocator::AllocatorKind;\n use rustc::middle::cstore::DepKind;\n use rustc::mir::interpret::AllocDecodingState;\n use rustc::session::{Session, CrateDisambiguator};\n@@ -26,6 +25,7 @@ use std::{cmp, fs};\n \n use syntax::ast;\n use syntax::attr;\n+use syntax::ext::allocator::AllocatorKind;\n use syntax::ext::base::{SyntaxExtension, SyntaxExtensionKind};\n use syntax::symbol::{Symbol, sym};\n use syntax::visit;"}, {"sha": "f2c6bf27cee0c413878ede93676f90c4f9fa9204", "filename": "src/libsyntax/ext/allocator.rs", "status": "renamed", "additions": 28, "deletions": 19, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax%2Fext%2Fallocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax%2Fext%2Fallocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fallocator.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -1,10 +1,33 @@\n-#![feature(nll)]\n-#![feature(rustc_private)]\n+#[derive(Clone, Copy)]\n+pub enum AllocatorKind {\n+    Global,\n+    DefaultLib,\n+    DefaultExe,\n+}\n \n-#![deny(rust_2018_idioms)]\n-#![deny(unused_lifetimes)]\n+impl AllocatorKind {\n+    pub fn fn_name(&self, base: &str) -> String {\n+        match *self {\n+            AllocatorKind::Global => format!(\"__rg_{}\", base),\n+            AllocatorKind::DefaultLib => format!(\"__rdl_{}\", base),\n+            AllocatorKind::DefaultExe => format!(\"__rde_{}\", base),\n+        }\n+    }\n+}\n \n-pub mod expand;\n+pub enum AllocatorTy {\n+    Layout,\n+    Ptr,\n+    ResultPtr,\n+    Unit,\n+    Usize,\n+}\n+\n+pub struct AllocatorMethod {\n+    pub name: &'static str,\n+    pub inputs: &'static [AllocatorTy],\n+    pub output: AllocatorTy,\n+}\n \n pub static ALLOCATOR_METHODS: &[AllocatorMethod] = &[\n     AllocatorMethod {\n@@ -28,17 +51,3 @@ pub static ALLOCATOR_METHODS: &[AllocatorMethod] = &[\n         output: AllocatorTy::ResultPtr,\n     },\n ];\n-\n-pub struct AllocatorMethod {\n-    pub name: &'static str,\n-    pub inputs: &'static [AllocatorTy],\n-    pub output: AllocatorTy,\n-}\n-\n-pub enum AllocatorTy {\n-    Layout,\n-    Ptr,\n-    ResultPtr,\n-    Unit,\n-    Usize,\n-}", "previous_filename": "src/librustc_allocator/lib.rs"}, {"sha": "e3bc72335aba0d65e10c47fda69bf69ff46cd785", "filename": "src/libsyntax/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Flib.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -165,6 +165,7 @@ pub mod print {\n \n pub mod ext {\n     pub use syntax_pos::hygiene;\n+    pub mod allocator;\n     pub mod base;\n     pub mod build;\n     pub mod derive;"}, {"sha": "e8f94bff1447034822810ea1949614b4d3f07f6d", "filename": "src/libsyntax_ext/global_allocator.rs", "status": "renamed", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax_ext%2Fglobal_allocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax_ext%2Fglobal_allocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fglobal_allocator.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -1,5 +1,4 @@\n use log::debug;\n-use rustc::middle::allocator::AllocatorKind;\n use smallvec::{smallvec, SmallVec};\n use syntax::{\n     ast::{\n@@ -11,6 +10,7 @@ use syntax::{\n         respan, ExpnInfo, ExpnKind,\n     },\n     ext::{\n+        allocator::{AllocatorKind, AllocatorMethod, AllocatorTy, ALLOCATOR_METHODS},\n         base::{ExtCtxt, MacroKind, Resolver},\n         build::AstBuilder,\n         expand::ExpansionConfig,\n@@ -23,14 +23,12 @@ use syntax::{\n };\n use syntax_pos::Span;\n \n-use crate::{AllocatorMethod, AllocatorTy, ALLOCATOR_METHODS};\n-\n pub fn modify(\n     sess: &ParseSess,\n     resolver: &mut dyn Resolver,\n     krate: &mut Crate,\n     crate_name: String,\n-    handler: &rustc_errors::Handler,\n+    handler: &errors::Handler,\n ) {\n     ExpandAllocatorDirectives {\n         handler,\n@@ -44,7 +42,7 @@ pub fn modify(\n \n struct ExpandAllocatorDirectives<'a> {\n     found: bool,\n-    handler: &'a rustc_errors::Handler,\n+    handler: &'a errors::Handler,\n     sess: &'a ParseSess,\n     resolver: &'a mut dyn Resolver,\n     crate_name: Option<String>,", "previous_filename": "src/librustc_allocator/expand.rs"}, {"sha": "cd7ac5fe2c66c064b8d239b7635735757c96efe8", "filename": "src/libsyntax_ext/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax_ext%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a93fdfedf36dcb909d90cbf963b087c5873bec1d/src%2Flibsyntax_ext%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Flib.rs?ref=a93fdfedf36dcb909d90cbf963b087c5873bec1d", "patch": "@@ -37,6 +37,7 @@ mod test_case;\n mod trace_macros;\n \n pub mod deriving;\n+pub mod global_allocator;\n pub mod proc_macro_decls;\n pub mod proc_macro_impl;\n "}]}