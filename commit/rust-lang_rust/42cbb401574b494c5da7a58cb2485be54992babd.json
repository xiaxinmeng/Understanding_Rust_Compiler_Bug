{"sha": "42cbb401574b494c5da7a58cb2485be54992babd", "node_id": "C_kwDOAAsO6NoAKDQyY2JiNDAxNTc0YjQ5NGM1ZGE3YTU4Y2IyNDg1YmU1NDk5MmJhYmQ", "commit": {"author": {"name": "Nicholas Bishop", "email": "nbishop@nbishop.net", "date": "2022-11-06T22:29:46Z"}, "committer": {"name": "Nicholas Bishop", "email": "nbishop@nbishop.net", "date": "2022-11-06T23:05:24Z"}, "message": "Use aapcs for efiapi calling convention on arm\n\nOn arm, llvm treats the C calling convention as `aapcs` on soft-float\ntargets and `aapcs-vfp` on hard-float targets [1]. UEFI specifies in the\narm calling convention that floating point extensions aren't used [2],\nso always translate `efiapi` to `aapcs` on arm.\n\n[1]: https://github.com/rust-lang/compiler-builtins/issues/116#issuecomment-261057422\n[2]: https://uefi.org/specs/UEFI/2.10/02_Overview.html#detailed-calling-convention\n\nhttps://github.com/rust-lang/rust/issues/65815", "tree": {"sha": "e70a231523d49fd421723474e13459cafa0a6245", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e70a231523d49fd421723474e13459cafa0a6245"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/42cbb401574b494c5da7a58cb2485be54992babd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/42cbb401574b494c5da7a58cb2485be54992babd", "html_url": "https://github.com/rust-lang/rust/commit/42cbb401574b494c5da7a58cb2485be54992babd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/42cbb401574b494c5da7a58cb2485be54992babd/comments", "author": {"login": "nicholasbishop", "id": 1023208, "node_id": "MDQ6VXNlcjEwMjMyMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1023208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicholasbishop", "html_url": "https://github.com/nicholasbishop", "followers_url": "https://api.github.com/users/nicholasbishop/followers", "following_url": "https://api.github.com/users/nicholasbishop/following{/other_user}", "gists_url": "https://api.github.com/users/nicholasbishop/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicholasbishop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicholasbishop/subscriptions", "organizations_url": "https://api.github.com/users/nicholasbishop/orgs", "repos_url": "https://api.github.com/users/nicholasbishop/repos", "events_url": "https://api.github.com/users/nicholasbishop/events{/privacy}", "received_events_url": "https://api.github.com/users/nicholasbishop/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nicholasbishop", "id": 1023208, "node_id": "MDQ6VXNlcjEwMjMyMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1023208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicholasbishop", "html_url": "https://github.com/nicholasbishop", "followers_url": "https://api.github.com/users/nicholasbishop/followers", "following_url": "https://api.github.com/users/nicholasbishop/following{/other_user}", "gists_url": "https://api.github.com/users/nicholasbishop/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicholasbishop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicholasbishop/subscriptions", "organizations_url": "https://api.github.com/users/nicholasbishop/orgs", "repos_url": "https://api.github.com/users/nicholasbishop/repos", "events_url": "https://api.github.com/users/nicholasbishop/events{/privacy}", "received_events_url": "https://api.github.com/users/nicholasbishop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7eef946fc0e0eff40e588eab77b09b287accbec3", "url": "https://api.github.com/repos/rust-lang/rust/commits/7eef946fc0e0eff40e588eab77b09b287accbec3", "html_url": "https://github.com/rust-lang/rust/commit/7eef946fc0e0eff40e588eab77b09b287accbec3"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "b44ed8f3fa9a3cbd5b1584ae82b93e4ce37ad38e", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/42cbb401574b494c5da7a58cb2485be54992babd/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42cbb401574b494c5da7a58cb2485be54992babd/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=42cbb401574b494c5da7a58cb2485be54992babd", "patch": "@@ -1915,6 +1915,7 @@ impl Target {\n                 Abi::Stdcall { unwind }\n             }\n             Abi::System { unwind } => Abi::C { unwind },\n+            Abi::EfiApi if self.arch == \"arm\" => Abi::Aapcs { unwind: false },\n             Abi::EfiApi if self.arch == \"x86_64\" => Abi::Win64 { unwind: false },\n             Abi::EfiApi => Abi::C { unwind: false },\n "}, {"sha": "9061d7432a3fa862018919df76baa71f36febb2e", "filename": "src/test/codegen/abi-efiapi.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/42cbb401574b494c5da7a58cb2485be54992babd/src%2Ftest%2Fcodegen%2Fabi-efiapi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42cbb401574b494c5da7a58cb2485be54992babd/src%2Ftest%2Fcodegen%2Fabi-efiapi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fabi-efiapi.rs?ref=42cbb401574b494c5da7a58cb2485be54992babd", "patch": "@@ -27,7 +27,7 @@ trait Copy { }\n //x86_64: define win64cc void @has_efiapi\n //i686: define void @has_efiapi\n //aarch64: define dso_local void @has_efiapi\n-//arm: define dso_local void @has_efiapi\n+//arm: define dso_local arm_aapcscc void @has_efiapi\n //riscv: define dso_local void @has_efiapi\n #[no_mangle]\n pub extern \"efiapi\" fn has_efiapi() {}"}]}