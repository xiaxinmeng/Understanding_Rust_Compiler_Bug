{"sha": "6f092c83dd8b94e28793db4fc68133151698c737", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmMDkyYzgzZGQ4Yjk0ZTI4NzkzZGI0ZmM2ODEzMzE1MTY5OGM3Mzc=", "commit": {"author": {"name": "Keith Yeung", "email": "kungfukeith11@gmail.com", "date": "2016-02-13T11:44:40Z"}, "committer": {"name": "Keith Yeung", "email": "kungfukeith11@gmail.com", "date": "2016-02-15T06:09:42Z"}, "message": "Add lint to check that all crates have #![unstable]", "tree": {"sha": "0444e470bdbb41ed06607d26f9a5fa6bd9e1138d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0444e470bdbb41ed06607d26f9a5fa6bd9e1138d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f092c83dd8b94e28793db4fc68133151698c737", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f092c83dd8b94e28793db4fc68133151698c737", "html_url": "https://github.com/rust-lang/rust/commit/6f092c83dd8b94e28793db4fc68133151698c737", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f092c83dd8b94e28793db4fc68133151698c737/comments", "author": {"login": "KiChjang", "id": 3248587, "node_id": "MDQ6VXNlcjMyNDg1ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3248587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KiChjang", "html_url": "https://github.com/KiChjang", "followers_url": "https://api.github.com/users/KiChjang/followers", "following_url": "https://api.github.com/users/KiChjang/following{/other_user}", "gists_url": "https://api.github.com/users/KiChjang/gists{/gist_id}", "starred_url": "https://api.github.com/users/KiChjang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KiChjang/subscriptions", "organizations_url": "https://api.github.com/users/KiChjang/orgs", "repos_url": "https://api.github.com/users/KiChjang/repos", "events_url": "https://api.github.com/users/KiChjang/events{/privacy}", "received_events_url": "https://api.github.com/users/KiChjang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "KiChjang", "id": 3248587, "node_id": "MDQ6VXNlcjMyNDg1ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3248587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KiChjang", "html_url": "https://github.com/KiChjang", "followers_url": "https://api.github.com/users/KiChjang/followers", "following_url": "https://api.github.com/users/KiChjang/following{/other_user}", "gists_url": "https://api.github.com/users/KiChjang/gists{/gist_id}", "starred_url": "https://api.github.com/users/KiChjang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KiChjang/subscriptions", "organizations_url": "https://api.github.com/users/KiChjang/orgs", "repos_url": "https://api.github.com/users/KiChjang/repos", "events_url": "https://api.github.com/users/KiChjang/events{/privacy}", "received_events_url": "https://api.github.com/users/KiChjang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5801991b5d54676410b7a65a664e8e83cc89136d", "url": "https://api.github.com/repos/rust-lang/rust/commits/5801991b5d54676410b7a65a664e8e83cc89136d", "html_url": "https://github.com/rust-lang/rust/commit/5801991b5d54676410b7a65a664e8e83cc89136d"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "ea34a803ccb4054a18c133ca8436cbb3cd920f08", "filename": "src/etc/tidy.py", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/6f092c83dd8b94e28793db4fc68133151698c737/src%2Fetc%2Ftidy.py", "raw_url": "https://github.com/rust-lang/rust/raw/6f092c83dd8b94e28793db4fc68133151698c737/src%2Fetc%2Ftidy.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Ftidy.py?ref=6f092c83dd8b94e28793db4fc68133151698c737", "patch": "@@ -24,6 +24,15 @@\n \n interesting_files = ['.rs', '.py', '.js', '.sh', '.c', '.h']\n uninteresting_files = ['miniz.c', 'jquery', 'rust_android_dummy']\n+stable_whitelist = {\n+    'src/bootstrap',\n+    'src/build_helper',\n+    'src/libcollectionstest',\n+    'src/libcore',\n+    'src/libstd',\n+    'src/rustc/std_shim',\n+    'src/test'\n+}\n \n \n def report_error_name_no(name, no, s):\n@@ -93,6 +102,7 @@ def interesting_file(f):\n file_counts = {ext: 0 for ext in interesting_files}\n \n all_paths = set()\n+needs_unstable_attr = set()\n \n try:\n     for (dirpath, dirnames, filenames) in os.walk(src_dir):\n@@ -149,6 +159,9 @@ def interesting_file(f):\n                 else:\n                     if \"SNAP \" in line:\n                         report_warn(\"unmatched SNAP line: \" + line)\n+                search = re.search(r'^#!\\[unstable', line)\n+                if search:\n+                    needs_unstable_attr.discard(filename)\n \n             if cr_flag in line:\n                 check_cr = False\n@@ -181,6 +194,9 @@ def interesting_file(f):\n                 check_cr = True\n                 check_tab = True\n                 check_linelength = True\n+                if all(f not in filename for f in stable_whitelist) and \\\n+                   re.search(r'src/.*/lib\\.rs', filename):\n+                    needs_unstable_attr.add(filename)\n \n             # Put a reasonable limit on the amount of header data we use for\n             # the licenseck\n@@ -195,6 +211,8 @@ def interesting_file(f):\n         update_counts(current_name)\n         assert len(current_contents) > 0\n         do_license_check(current_name, current_contents)\n+    for f in needs_unstable_attr:\n+        report_error_name_no(f, 1, \"requires unstable attribute\")\n \n except UnicodeDecodeError as e:\n     report_err(\"UTF-8 decoding error \" + str(e))"}]}