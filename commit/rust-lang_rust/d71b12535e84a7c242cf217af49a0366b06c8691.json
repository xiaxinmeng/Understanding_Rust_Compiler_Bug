{"sha": "d71b12535e84a7c242cf217af49a0366b06c8691", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3MWIxMjUzNWU4NGE3YzI0MmNmMjE3YWY0OWEwMzY2YjA2Yzg2OTE=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-06-16T16:28:34Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-06-19T11:58:32Z"}, "message": "Merge the crate_patches dir into the patches dir", "tree": {"sha": "df0fc3276edbb0288e7a44ae2d27b099dbe5d526", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/df0fc3276edbb0288e7a44ae2d27b099dbe5d526"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d71b12535e84a7c242cf217af49a0366b06c8691", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d71b12535e84a7c242cf217af49a0366b06c8691", "html_url": "https://github.com/rust-lang/rust/commit/d71b12535e84a7c242cf217af49a0366b06c8691", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d71b12535e84a7c242cf217af49a0366b06c8691/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "066d5f952cfb0c5d22d4ee31d6ac716b2d16668d", "url": "https://api.github.com/repos/rust-lang/rust/commits/066d5f952cfb0c5d22d4ee31d6ac716b2d16668d", "html_url": "https://github.com/rust-lang/rust/commit/066d5f952cfb0c5d22d4ee31d6ac716b2d16668d"}], "stats": {"total": 21, "additions": 8, "deletions": 13}, "files": [{"sha": "b5011ceb15972d9a2ca3e5c1c5ab989fee4534c9", "filename": "build_system/prepare.rs", "status": "modified", "additions": 8, "deletions": 13, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/d71b12535e84a7c242cf217af49a0366b06c8691/build_system%2Fprepare.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d71b12535e84a7c242cf217af49a0366b06c8691/build_system%2Fprepare.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fprepare.rs?ref=d71b12535e84a7c242cf217af49a0366b06c8691", "patch": "@@ -20,7 +20,7 @@ pub(crate) fn prepare() {\n         \"https://github.com/rust-random/rand.git\",\n         \"0f933f9c7176e53b2a3c7952ded484e1783f0bf1\",\n     );\n-    apply_patches(\"crate_patches\", \"rand\", Path::new(\"rand\"));\n+    apply_patches(\"rand\", Path::new(\"rand\"));\n \n     clone_repo(\n         \"regex\",\n@@ -73,19 +73,14 @@ fn prepare_sysroot() {\n         .current_dir(&sysroot_src);\n     spawn_and_wait(git_commit_cmd);\n \n-    apply_patches(\"patches\", \"sysroot\", &sysroot_src);\n+    apply_patches(\"sysroot\", &sysroot_src);\n \n     clone_repo(\n         \"build_sysroot/compiler-builtins\",\n         \"https://github.com/rust-lang/compiler-builtins.git\",\n         \"0.1.45\",\n     );\n-\n-    apply_patches(\n-        \"crate_patches\",\n-        \"compiler-builtins\",\n-        Path::new(\"build_sysroot/compiler-builtins\"),\n-    );\n+    apply_patches(\"compiler-builtins\", Path::new(\"build_sysroot/compiler-builtins\"));\n }\n \n fn clone_repo(target_dir: &str, repo: &str, rev: &str) {\n@@ -102,8 +97,8 @@ fn clone_repo(target_dir: &str, repo: &str, rev: &str) {\n     spawn_and_wait(checkout_cmd);\n }\n \n-fn get_patches(patch_dir: &str, crate_name: &str) -> Vec<OsString> {\n-    let mut patches: Vec<_> = fs::read_dir(patch_dir)\n+fn get_patches(crate_name: &str) -> Vec<OsString> {\n+    let mut patches: Vec<_> = fs::read_dir(\"patches\")\n         .unwrap()\n         .map(|entry| entry.unwrap().path())\n         .filter(|path| path.extension() == Some(OsStr::new(\"patch\")))\n@@ -116,10 +111,10 @@ fn get_patches(patch_dir: &str, crate_name: &str) -> Vec<OsString> {\n     patches\n }\n \n-fn apply_patches(patch_dir: &str, crate_name: &str, target_dir: &Path) {\n-    for patch in get_patches(patch_dir, crate_name) {\n+fn apply_patches(crate_name: &str, target_dir: &Path) {\n+    for patch in get_patches(crate_name) {\n         eprintln!(\"[PATCH] {:?} <- {:?}\", target_dir.file_name().unwrap(), patch);\n-        let patch_arg = Path::new(patch_dir).join(patch).canonicalize().unwrap();\n+        let patch_arg = Path::new(\"patches\").join(patch).canonicalize().unwrap();\n         let mut apply_patch_cmd = Command::new(\"git\");\n         apply_patch_cmd.arg(\"am\").arg(patch_arg).arg(\"-q\").current_dir(target_dir);\n         spawn_and_wait(apply_patch_cmd);"}, {"sha": "7daea99f5794d2103588c152a0ac02ca1b5b14b1", "filename": "patches/0001-compiler-builtins-Disable-128bit-atomic-operations.patch", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d71b12535e84a7c242cf217af49a0366b06c8691/patches%2F0001-compiler-builtins-Disable-128bit-atomic-operations.patch", "raw_url": "https://github.com/rust-lang/rust/raw/d71b12535e84a7c242cf217af49a0366b06c8691/patches%2F0001-compiler-builtins-Disable-128bit-atomic-operations.patch", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/patches%2F0001-compiler-builtins-Disable-128bit-atomic-operations.patch?ref=d71b12535e84a7c242cf217af49a0366b06c8691", "previous_filename": "crate_patches/0001-compiler-builtins-Disable-128bit-atomic-operations.patch"}, {"sha": "01dc0fcc5376138bccca396b78e729a5942bf94c", "filename": "patches/0001-rand-Enable-c2-chacha-simd-feature.patch", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d71b12535e84a7c242cf217af49a0366b06c8691/patches%2F0001-rand-Enable-c2-chacha-simd-feature.patch", "raw_url": "https://github.com/rust-lang/rust/raw/d71b12535e84a7c242cf217af49a0366b06c8691/patches%2F0001-rand-Enable-c2-chacha-simd-feature.patch", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/patches%2F0001-rand-Enable-c2-chacha-simd-feature.patch?ref=d71b12535e84a7c242cf217af49a0366b06c8691", "previous_filename": "crate_patches/0001-rand-Enable-c2-chacha-simd-feature.patch"}, {"sha": "19fd20d7269017cfa1dd21a9db67999d61d4b619", "filename": "patches/0002-rand-Disable-failing-test.patch", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d71b12535e84a7c242cf217af49a0366b06c8691/patches%2F0002-rand-Disable-failing-test.patch", "raw_url": "https://github.com/rust-lang/rust/raw/d71b12535e84a7c242cf217af49a0366b06c8691/patches%2F0002-rand-Disable-failing-test.patch", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/patches%2F0002-rand-Disable-failing-test.patch?ref=d71b12535e84a7c242cf217af49a0366b06c8691", "previous_filename": "crate_patches/0002-rand-Disable-failing-test.patch"}]}