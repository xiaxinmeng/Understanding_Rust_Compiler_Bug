{"sha": "4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmZDdhZDkwOGI2ZTdjZWUwZWU3ODUzZmNmMjlmYjVhMzhhMTlhYTI=", "commit": {"author": {"name": "Phil Ellison", "email": "phil.j.ellison@gmail.com", "date": "2019-07-28T19:47:44Z"}, "committer": {"name": "Phil Ellison", "email": "phil.j.ellison@gmail.com", "date": "2019-07-28T19:47:44Z"}, "message": "Add special case for f32 and f43 suffices on Literal.kind", "tree": {"sha": "30574ad27b93b2eecbda661547ee952e6b32d0fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/30574ad27b93b2eecbda661547ee952e6b32d0fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2", "html_url": "https://github.com/rust-lang/rust/commit/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2/comments", "author": {"login": "theotherphil", "id": 1974256, "node_id": "MDQ6VXNlcjE5NzQyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1974256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theotherphil", "html_url": "https://github.com/theotherphil", "followers_url": "https://api.github.com/users/theotherphil/followers", "following_url": "https://api.github.com/users/theotherphil/following{/other_user}", "gists_url": "https://api.github.com/users/theotherphil/gists{/gist_id}", "starred_url": "https://api.github.com/users/theotherphil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theotherphil/subscriptions", "organizations_url": "https://api.github.com/users/theotherphil/orgs", "repos_url": "https://api.github.com/users/theotherphil/repos", "events_url": "https://api.github.com/users/theotherphil/events{/privacy}", "received_events_url": "https://api.github.com/users/theotherphil/received_events", "type": "User", "site_admin": false}, "committer": {"login": "theotherphil", "id": 1974256, "node_id": "MDQ6VXNlcjE5NzQyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1974256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theotherphil", "html_url": "https://github.com/theotherphil", "followers_url": "https://api.github.com/users/theotherphil/followers", "following_url": "https://api.github.com/users/theotherphil/following{/other_user}", "gists_url": "https://api.github.com/users/theotherphil/gists{/gist_id}", "starred_url": "https://api.github.com/users/theotherphil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theotherphil/subscriptions", "organizations_url": "https://api.github.com/users/theotherphil/orgs", "repos_url": "https://api.github.com/users/theotherphil/repos", "events_url": "https://api.github.com/users/theotherphil/events{/privacy}", "received_events_url": "https://api.github.com/users/theotherphil/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "578bc05ca41e095c61c64bdef255760c26736a11", "url": "https://api.github.com/repos/rust-lang/rust/commits/578bc05ca41e095c61c64bdef255760c26736a11", "html_url": "https://github.com/rust-lang/rust/commit/578bc05ca41e095c61c64bdef255760c26736a11"}], "stats": {"total": 43, "additions": 26, "deletions": 17}, "files": [{"sha": "2ed03e5e9ff4b9e5ac151ae0c1d2afa725ad84da", "filename": "crates/ra_assists/src/add_explicit_type.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2/crates%2Fra_assists%2Fsrc%2Fadd_explicit_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2/crates%2Fra_assists%2Fsrc%2Fadd_explicit_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fadd_explicit_type.rs?ref=4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2", "patch": "@@ -77,6 +77,11 @@ mod tests {\n             \"fn f() { let a<|> = 42f64; }\",\n             \"fn f() { let a<|>: f64 = 42f64; }\",\n         );\n+        check_assist(\n+            add_explicit_type,\n+            \"fn f() { let a<|> = 42f32; }\",\n+            \"fn f() { let a<|>: f32 = 42f32; }\",\n+        );\n     }\n \n     #[test]"}, {"sha": "745dece9833e0109d184a899a977c853400b7730", "filename": "crates/ra_syntax/src/ast/expr_extensions.rs", "status": "modified", "additions": 21, "deletions": 3, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2/crates%2Fra_syntax%2Fsrc%2Fast%2Fexpr_extensions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2/crates%2Fra_syntax%2Fsrc%2Fast%2Fexpr_extensions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fast%2Fexpr_extensions.rs?ref=4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2", "patch": "@@ -239,16 +239,34 @@ impl ast::Literal {\n     pub fn kind(&self) -> LiteralKind {\n         match self.token().kind() {\n             INT_NUMBER => {\n-                let allowed_suffix_list = [\n+                let int_suffix_list = [\n                     \"isize\", \"i128\", \"i64\", \"i32\", \"i16\", \"i8\", \"usize\", \"u128\", \"u64\", \"u32\",\n                     \"u16\", \"u8\",\n                 ];\n+\n+                // The lexer treats e.g. `1f64` as an integer literal. See\n+                // https://github.com/rust-analyzer/rust-analyzer/issues/1592\n+                // and the comments on the linked PR.\n+                let float_suffix_list = [\n+                    \"f32\", \"f64\"\n+                ];\n+\n                 let text = self.token().text().to_string();\n-                let suffix = allowed_suffix_list\n+\n+                let float_suffix = float_suffix_list\n                     .iter()\n                     .find(|&s| text.ends_with(s))\n                     .map(|&suf| SmolStr::new(suf));\n-                LiteralKind::IntNumber { suffix }\n+\n+                if float_suffix.is_some() {\n+                    LiteralKind::FloatNumber { suffix: float_suffix }\n+                } else {\n+                    let suffix = int_suffix_list\n+                        .iter()\n+                        .find(|&s| text.ends_with(s))\n+                        .map(|&suf| SmolStr::new(suf));\n+                    LiteralKind::IntNumber { suffix }\n+                }\n             }\n             FLOAT_NUMBER => {\n                 let allowed_suffix_list = [\"f64\", \"f32\"];"}, {"sha": "2a4343b0a6599881123f3798de9e38590a28fd4d", "filename": "crates/ra_syntax/src/parsing/lexer.rs", "status": "modified", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2/crates%2Fra_syntax%2Fsrc%2Fparsing%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2/crates%2Fra_syntax%2Fsrc%2Fparsing%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fparsing%2Flexer.rs?ref=4fd7ad908b6e7cee0ee7853fcf29fb5a38a19aa2", "patch": "@@ -145,17 +145,3 @@ pub fn classify_literal(text: &str) -> Option<Token> {\n     };\n     Some(Token { kind, len: TextUnit::from_usize(t.len) })\n }\n-\n-#[cfg(test)]\n-mod tests {\n-    use super::*;\n-\n-    // https://github.com/rust-analyzer/rust-analyzer/issues/1592\n-    #[test]\n-    fn lex_float_literal() {\n-        assert_eq!(\n-            tokenize(\"42f64\")[0],\n-            Token { kind: FLOAT_NUMBER, len: TextUnit::from_usize(5)}\n-        );\n-    }\n-}"}]}