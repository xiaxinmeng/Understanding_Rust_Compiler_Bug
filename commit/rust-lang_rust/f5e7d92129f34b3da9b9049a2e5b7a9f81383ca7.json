{"sha": "f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY1ZTdkOTIxMjlmMzRiM2RhOWI5MDQ5YTJlNWI3YTlmODEzODNjYTc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-19T17:45:42Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-20T01:16:13Z"}, "message": "rustbuild: Update Cargo download location\n\nI updated the beta compiler used to bootstrap the master branch in #38438 with\nthe intention of fixing Travis OSX linkage issues but I mistakenly forgot that\nthe PR only updated rustc, not Cargo itself. Cargo has a new release process\nwith downloads in a different location, so this commit updates rustbuild to\ndownload from this new location by tracking revisions instead of Cargo nightly\ndates.", "tree": {"sha": "cd3aa1693ab89146572d33b378da3a3b1a85c3b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd3aa1693ab89146572d33b378da3a3b1a85c3b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7", "html_url": "https://github.com/rust-lang/rust/commit/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94ae2a2e6791e0c4ab6fba836b2b09a07f2d3c8a", "url": "https://api.github.com/repos/rust-lang/rust/commits/94ae2a2e6791e0c4ab6fba836b2b09a07f2d3c8a", "html_url": "https://github.com/rust-lang/rust/commit/94ae2a2e6791e0c4ab6fba836b2b09a07f2d3c8a"}], "stats": {"total": 24, "additions": 10, "deletions": 14}, "files": [{"sha": "89d297760e2864c8345b876d87112be2fb5c2998", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 9, "deletions": 13, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7", "patch": "@@ -81,7 +81,7 @@ def verify(path, sha_path, verbose):\n     with open(path, \"rb\") as f:\n         found = hashlib.sha256(f.read()).hexdigest()\n     with open(sha_path, \"r\") as f:\n-        expected, _ = f.readline().split()\n+        expected = f.readline().split()[0]\n     verified = found == expected\n     if not verified:\n         print(\"invalid checksum:\\n\"\n@@ -146,7 +146,7 @@ class RustBuild(object):\n     def download_stage0(self):\n         cache_dst = os.path.join(self.build_dir, \"cache\")\n         rustc_cache = os.path.join(cache_dst, self.stage0_rustc_date())\n-        cargo_cache = os.path.join(cache_dst, self.stage0_cargo_date())\n+        cargo_cache = os.path.join(cache_dst, self.stage0_cargo_rev())\n         if not os.path.exists(rustc_cache):\n             os.makedirs(rustc_cache)\n         if not os.path.exists(cargo_cache):\n@@ -179,21 +179,17 @@ def download_stage0(self):\n         if self.cargo().startswith(self.bin_root()) and \\\n                 (not os.path.exists(self.cargo()) or self.cargo_out_of_date()):\n             self.print_what_it_means_to_bootstrap()\n-            channel = self.stage0_cargo_channel()\n-            filename = \"cargo-{}-{}.tar.gz\".format(channel, self.build)\n-            url = \"https://static.rust-lang.org/cargo-dist/\" + self.stage0_cargo_date()\n+            filename = \"cargo-nightly-{}.tar.gz\".format(self.build)\n+            url = \"https://s3.amazonaws.com/rust-lang-ci/cargo-builds/\" + self.stage0_cargo_rev()\n             tarball = os.path.join(cargo_cache, filename)\n             if not os.path.exists(tarball):\n                 get(\"{}/{}\".format(url, filename), tarball, verbose=self.verbose)\n             unpack(tarball, self.bin_root(), match=\"cargo\", verbose=self.verbose)\n             with open(self.cargo_stamp(), 'w') as f:\n-                f.write(self.stage0_cargo_date())\n+                f.write(self.stage0_cargo_rev())\n \n-    def stage0_cargo_date(self):\n-        return self._cargo_date\n-\n-    def stage0_cargo_channel(self):\n-        return self._cargo_channel\n+    def stage0_cargo_rev(self):\n+        return self._cargo_rev\n \n     def stage0_rustc_date(self):\n         return self._rustc_date\n@@ -217,7 +213,7 @@ def cargo_out_of_date(self):\n         if not os.path.exists(self.cargo_stamp()) or self.clean:\n             return True\n         with open(self.cargo_stamp(), 'r') as f:\n-            return self.stage0_cargo_date() != f.read()\n+            return self.stage0_cargo_rev() != f.read()\n \n     def bin_root(self):\n         return os.path.join(self.build_dir, self.build, \"stage0\")\n@@ -469,7 +465,7 @@ def main():\n \n     data = stage0_data(rb.rust_root)\n     rb._rustc_channel, rb._rustc_date = data['rustc'].split('-', 1)\n-    rb._cargo_channel, rb._cargo_date = data['cargo'].split('-', 1)\n+    rb._cargo_rev = data['cargo']\n \n     start_time = time()\n "}, {"sha": "187c56d7889ea52a27eb3d424a872f37e0e6558c", "filename": "src/stage0.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7/src%2Fstage0.txt", "raw_url": "https://github.com/rust-lang/rust/raw/f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7/src%2Fstage0.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fstage0.txt?ref=f5e7d92129f34b3da9b9049a2e5b7a9f81383ca7", "patch": "@@ -13,4 +13,4 @@\n # released on `$date`\n \n rustc: beta-2016-12-16\n-cargo: nightly-2016-11-16\n+cargo: fbeea902d2c9a5be6d99cc35681565d8f7832592"}]}