{"sha": "8b3c67690c4747b9fadfef407e6261524fb03f8a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiM2M2NzY5MGM0NzQ3YjlmYWRmZWY0MDdlNjI2MTUyNGZiMDNmOGE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-12-29T19:15:40Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-12-30T01:26:05Z"}, "message": "Install copyright information and package docs\n\nThis distributes docs in a separate package called rust-docs. The rust-packaging\nproject will combine it with Rust and Cargo into a single installer in a variety of formats.", "tree": {"sha": "41e5562f3046b34985b15c2f5600bb3d8650516a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/41e5562f3046b34985b15c2f5600bb3d8650516a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8b3c67690c4747b9fadfef407e6261524fb03f8a", "comment_count": 2, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8b3c67690c4747b9fadfef407e6261524fb03f8a", "html_url": "https://github.com/rust-lang/rust/commit/8b3c67690c4747b9fadfef407e6261524fb03f8a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8b3c67690c4747b9fadfef407e6261524fb03f8a/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f2ab2bf4663034fcd0395afd274a9b3a4681776", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f2ab2bf4663034fcd0395afd274a9b3a4681776", "html_url": "https://github.com/rust-lang/rust/commit/4f2ab2bf4663034fcd0395afd274a9b3a4681776"}], "stats": {"total": 38, "additions": 37, "deletions": 1}, "files": [{"sha": "fbad09d280f40f16e825e503a63f3e75de838a56", "filename": "mk/dist.mk", "status": "modified", "additions": 31, "deletions": 1, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/8b3c67690c4747b9fadfef407e6261524fb03f8a/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/8b3c67690c4747b9fadfef407e6261524fb03f8a/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=8b3c67690c4747b9fadfef407e6261524fb03f8a", "patch": "@@ -23,6 +23,7 @@\n # * dist-docs - Stage docs for upload\n \n PKG_NAME := $(CFG_PACKAGE_NAME)\n+DOC_PKG_NAME := rust-docs-$(CFG_PACKAGE_VERS)\n \n # License suitable for displaying in a popup\n LICENSE.txt: $(S)COPYRIGHT $(S)LICENSE-APACHE $(S)LICENSE-MIT\n@@ -229,7 +230,11 @@ dist-install-dir-$(1): prepare-base-dir-$(1) docs compiler-docs\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)LICENSE-APACHE $$(PREPARE_DEST_DIR)\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)LICENSE-MIT $$(PREPARE_DEST_DIR)\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)README.md $$(PREPARE_DEST_DIR)\n-\t$$(Q)[ ! -d doc ] || cp -r doc $$(PREPARE_DEST_DIR)\n+\t$$(Q)mkdir -p $$(PREPARE_DEST_DIR)/share/doc/rust\n+\t$$(Q)$$(PREPARE_MAN_CMD) $$(S)COPYRIGHT $$(PREPARE_DEST_DIR)/share/doc/rust\n+\t$$(Q)$$(PREPARE_MAN_CMD) $$(S)LICENSE-APACHE $$(PREPARE_DEST_DIR)/share/doc/rust\n+\t$$(Q)$$(PREPARE_MAN_CMD) $$(S)LICENSE-MIT $$(PREPARE_DEST_DIR)/share/doc/rust\n+\t$$(Q)$$(PREPARE_MAN_CMD) $$(S)README.md $$(PREPARE_DEST_DIR)/share/doc/rust\n \n dist/$$(PKG_NAME)-$(1).tar.gz: dist-install-dir-$(1)\n \t@$(call E, build: $$@)\n@@ -247,6 +252,26 @@ dist/$$(PKG_NAME)-$(1).tar.gz: dist-install-dir-$(1)\n \t\t--legacy-manifest-dirs=rustlib,cargo\n \t$$(Q)rm -R tmp/dist/$$(PKG_NAME)-$(1)-image\n \n+dist-doc-install-dir-$(1): docs compiler-docs\n+\t$$(Q)mkdir -p tmp/dist/$$(DOC_PKG_NAME)-$(1)-image/share/doc/rust\n+\t$$(Q)cp -r doc tmp/dist/$$(DOC_PKG_NAME)-$(1)-image/share/doc/rust/html\n+\n+dist/$$(DOC_PKG_NAME)-$(1).tar.gz: dist-doc-install-dir-$(1)\n+\t@$(call E, build: $$@)\n+\t$$(Q)$$(S)src/rust-installer/gen-installer.sh \\\n+\t\t--product-name=Rust-Documentation \\\n+\t\t--rel-manifest-dir=rustlib \\\n+\t\t--success-message=Rust-documentation-is-installed. \\\n+\t\t--image-dir=tmp/dist/$$(DOC_PKG_NAME)-$(1)-image \\\n+\t\t--work-dir=tmp/dist \\\n+\t\t--output-dir=dist \\\n+\t\t--package-name=$$(DOC_PKG_NAME)-$(1) \\\n+\t\t--component-name=rust-docs \\\n+\t\t--legacy-manifest-dirs=rustlib,cargo \\\n+\t\t--bulk-dirs=share/doc/rust/html\n+\t$$(Q)rm -R tmp/dist/$$(DOC_PKG_NAME)-$(1)-image\n+\n+\n endef\n \n ifneq ($(CFG_ENABLE_DIST_HOST_ONLY),)\n@@ -259,7 +284,12 @@ endif\n \n dist-install-dirs: $(foreach host,$(CFG_HOST),dist-install-dir-$(host))\n \n+ifneq ($(CFG_DISABLE_DOCS),)\n dist-tar-bins: $(foreach host,$(CFG_HOST),dist/$(PKG_NAME)-$(host).tar.gz)\n+else\n+dist-tar-bins: $(foreach host,$(CFG_HOST),dist/$(PKG_NAME)-$(host).tar.gz) \\\n+               $(foreach host,$(CFG_HOST),dist/$(DOC_PKG_NAME)-$(host).tar.gz)\n+endif\n \n # Just try to run the compiler for the build host\n distcheck-tar-bins: dist-tar-bins"}, {"sha": "f36ca4db7ca7ef13eddcbaa26cc46c5fc2e81af1", "filename": "mk/install.mk", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8b3c67690c4747b9fadfef407e6261524fb03f8a/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/8b3c67690c4747b9fadfef407e6261524fb03f8a/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=8b3c67690c4747b9fadfef407e6261524fb03f8a", "patch": "@@ -20,6 +20,9 @@ ifeq (root user, $(USER) $(patsubst %,user,$(SUDO_USER)))\n \t$(Q)sudo -u \"$$SUDO_USER\" $(MAKE) prepare_install\n else\n \t$(Q)$(MAKE) prepare_install\n+endif\n+ifeq ($(CFG_DISABLE_DOCS),)\n+\t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(DOC_PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\" \"$(MAYBE_DISABLE_VERIFY)\"\n endif\n \t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\" \"$(MAYBE_DISABLE_VERIFY)\"\n # Remove tmp files because it's a decent amount of disk space\n@@ -33,6 +36,9 @@ ifeq (root user, $(USER) $(patsubst %,user,$(SUDO_USER)))\n \t$(Q)sudo -u \"$$SUDO_USER\" $(MAKE) prepare_uninstall\n else\n \t$(Q)$(MAKE) prepare_uninstall\n+endif\n+ifeq ($(CFG_DISABLE_DOCS),)\n+\t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(DOC_PKG_NAME)-$(CFG_BUILD)/install.sh --uninstall --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\"\n endif\n \t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --uninstall --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\"\n # Remove tmp files because it's a decent amount of disk space"}]}