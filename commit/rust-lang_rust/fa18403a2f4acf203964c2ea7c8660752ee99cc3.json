{"sha": "fa18403a2f4acf203964c2ea7c8660752ee99cc3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhMTg0MDNhMmY0YWNmMjAzOTY0YzJlYTdjODY2MDc1MmVlOTljYzM=", "commit": {"author": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-03-13T09:59:16Z"}, "committer": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-03-13T10:45:08Z"}, "message": "Refactor out methods `NameResolution::increment_outstanding_references` and\n`NameResolution::decrement_outstanding_references`.", "tree": {"sha": "c029334bc42d9ea22cd04aee753d7d27bcb42531", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c029334bc42d9ea22cd04aee753d7d27bcb42531"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fa18403a2f4acf203964c2ea7c8660752ee99cc3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fa18403a2f4acf203964c2ea7c8660752ee99cc3", "html_url": "https://github.com/rust-lang/rust/commit/fa18403a2f4acf203964c2ea7c8660752ee99cc3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fa18403a2f4acf203964c2ea7c8660752ee99cc3/comments", "author": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3e05371c13f851a5af57a96a5e13c99537787314", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e05371c13f851a5af57a96a5e13c99537787314", "html_url": "https://github.com/rust-lang/rust/commit/3e05371c13f851a5af57a96a5e13c99537787314"}], "stats": {"total": 37, "additions": 22, "deletions": 15}, "files": [{"sha": "89586db32bcee9cb8191660070610a59aa79f744", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 22, "deletions": 15, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/fa18403a2f4acf203964c2ea7c8660752ee99cc3/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa18403a2f4acf203964c2ea7c8660752ee99cc3/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=fa18403a2f4acf203964c2ea7c8660752ee99cc3", "patch": "@@ -176,6 +176,25 @@ impl<'a> NameResolution<'a> {\n         }\n     }\n \n+    fn increment_outstanding_references(&mut self, is_public: bool) {\n+        self.outstanding_references += 1;\n+        if is_public {\n+            self.pub_outstanding_references += 1;\n+        }\n+    }\n+\n+    fn decrement_outstanding_references(&mut self, is_public: bool) {\n+        let decrement_references = |count: &mut _| {\n+            assert!(*count > 0);\n+            *count -= 1;\n+        };\n+\n+        decrement_references(&mut self.outstanding_references);\n+        if is_public {\n+            decrement_references(&mut self.pub_outstanding_references);\n+        }\n+    }\n+\n     fn report_conflicts<F: FnMut(&NameBinding, &NameBinding)>(&self, mut report: F) {\n         let binding = match self.binding {\n             Some(binding) => binding,\n@@ -253,25 +272,13 @@ impl<'a> ::ModuleS<'a> {\n     }\n \n     pub fn increment_outstanding_references_for(&self, name: Name, ns: Namespace, is_public: bool) {\n-        let mut resolutions = self.resolutions.borrow_mut();\n-        let resolution = resolutions.entry((name, ns)).or_insert_with(Default::default);\n-        resolution.outstanding_references += 1;\n-        if is_public {\n-            resolution.pub_outstanding_references += 1;\n-        }\n+        self.resolutions.borrow_mut().entry((name, ns)).or_insert_with(Default::default)\n+            .increment_outstanding_references(is_public);\n     }\n \n     fn decrement_outstanding_references_for(&self, name: Name, ns: Namespace, is_public: bool) {\n-        let decrement_references = |count: &mut _| {\n-            assert!(*count > 0);\n-            *count -= 1;\n-        };\n-\n         self.update_resolution(name, ns, |resolution| {\n-            decrement_references(&mut resolution.outstanding_references);\n-            if is_public {\n-                decrement_references(&mut resolution.pub_outstanding_references);\n-            }\n+            resolution.decrement_outstanding_references(is_public);\n         })\n     }\n "}]}