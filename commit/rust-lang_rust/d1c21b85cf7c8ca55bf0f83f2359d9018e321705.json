{"sha": "d1c21b85cf7c8ca55bf0f83f2359d9018e321705", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxYzIxYjg1Y2Y3YzhjYTU1YmYwZjgzZjIzNTlkOTAxOGUzMjE3MDU=", "commit": {"author": {"name": "Unreal Hoang", "email": "unrealhoang@gmail.com", "date": "2019-05-01T15:57:16Z"}, "committer": {"name": "Unreal Hoang", "email": "unrealhoang@gmail.com", "date": "2019-05-01T16:41:02Z"}, "message": "add complex match case and documentation", "tree": {"sha": "1b0dcbd9424ff205c0a472ecb1788d14c6c62836", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1b0dcbd9424ff205c0a472ecb1788d14c6c62836"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d1c21b85cf7c8ca55bf0f83f2359d9018e321705", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE5FNMeJ7UuhhqQiT99mIXvcbzfPoFAlzJzCMACgkQ9mIXvcbz\nfPrVRhAAldZWTauxiWbFfdh1JiFwfH+NjKi19x0MGoJ7uEVJIRj37u9Qjs5ZZ0DE\nLK2hX7CzTKBZdtYbDauAQqmcgH4yjHbg+YnMrGky3bh/3P4Ml+f7XqqMqrhu6Vuw\ni7L2f6WKOG5wR8EnsnBWrKE4BC2RUZ65Hv2JPBpnZW5rfprmeP06m1uRHAZbZdJ1\noHN/JnEBG78t3t/UGb1q0qcHiiZ6QXmEaLKmtWpI4bgT7cQ4b7zd2qcpNy5wbNtB\nrN6IGy/uh2n3nk2v83ayB6vf09V7MZQDsBGMDbzfjBQq4W0ijHosV+5Y2vEHYhRd\nyzeXUGywlPMoDY4CgxdPK34nSLRd1c4Wy6dvjB+q0ByHlcxcufb0e/jf9hwK+gpI\nta/QcdP7dnAO+a3JkjRh0SjZMKeiwADqj64VZFa4o1WP0lKmMRGlPbDfih+vN2OQ\ncQkB4f3tIIfLpK28MPfVrKYn0Z9XyKwjJRnK5dufXVrCkCVakeJMSDlfrIMbGBR1\nHkkwxxsTDdoTI/mjq1CJA+dNh6svRqsT0lZWWXeKnFqtQ3iKeBAYRJadq3yXCnbF\n2xcxDJ6NTidwphOphh2VTpDK5ySPkWpZOi6bl5rRu7FktALB+do6Spfh27dCZGx8\nSTOLWumXhnnrqMN2U9TRq+uayYIMbXnqSZQbFMs5tde/SrGhAi4=\n=VspU\n-----END PGP SIGNATURE-----", "payload": "tree 1b0dcbd9424ff205c0a472ecb1788d14c6c62836\nparent f83e452b1e69e8a6cc0d36715651418e3ce50afb\nauthor Unreal Hoang <unrealhoang@gmail.com> 1556726236 +0900\ncommitter Unreal Hoang <unrealhoang@gmail.com> 1556728862 +0900\n\nadd complex match case and documentation\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d1c21b85cf7c8ca55bf0f83f2359d9018e321705", "html_url": "https://github.com/rust-lang/rust/commit/d1c21b85cf7c8ca55bf0f83f2359d9018e321705", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d1c21b85cf7c8ca55bf0f83f2359d9018e321705/comments", "author": {"login": "unrealhoang", "id": 1218094, "node_id": "MDQ6VXNlcjEyMTgwOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1218094?v=4", "gravatar_id": "", "url": "https://api.github.com/users/unrealhoang", "html_url": "https://github.com/unrealhoang", "followers_url": "https://api.github.com/users/unrealhoang/followers", "following_url": "https://api.github.com/users/unrealhoang/following{/other_user}", "gists_url": "https://api.github.com/users/unrealhoang/gists{/gist_id}", "starred_url": "https://api.github.com/users/unrealhoang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/unrealhoang/subscriptions", "organizations_url": "https://api.github.com/users/unrealhoang/orgs", "repos_url": "https://api.github.com/users/unrealhoang/repos", "events_url": "https://api.github.com/users/unrealhoang/events{/privacy}", "received_events_url": "https://api.github.com/users/unrealhoang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "unrealhoang", "id": 1218094, "node_id": "MDQ6VXNlcjEyMTgwOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1218094?v=4", "gravatar_id": "", "url": "https://api.github.com/users/unrealhoang", "html_url": "https://github.com/unrealhoang", "followers_url": "https://api.github.com/users/unrealhoang/followers", "following_url": "https://api.github.com/users/unrealhoang/following{/other_user}", "gists_url": "https://api.github.com/users/unrealhoang/gists{/gist_id}", "starred_url": "https://api.github.com/users/unrealhoang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/unrealhoang/subscriptions", "organizations_url": "https://api.github.com/users/unrealhoang/orgs", "repos_url": "https://api.github.com/users/unrealhoang/repos", "events_url": "https://api.github.com/users/unrealhoang/events{/privacy}", "received_events_url": "https://api.github.com/users/unrealhoang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f83e452b1e69e8a6cc0d36715651418e3ce50afb", "url": "https://api.github.com/repos/rust-lang/rust/commits/f83e452b1e69e8a6cc0d36715651418e3ce50afb", "html_url": "https://github.com/rust-lang/rust/commit/f83e452b1e69e8a6cc0d36715651418e3ce50afb"}], "stats": {"total": 60, "additions": 47, "deletions": 13}, "files": [{"sha": "a8ca19f5ddf7f343eef41ee959e45eaa67f0eaf0", "filename": "crates/ra_assists/src/move_guard_to_arm_body.rs", "status": "modified", "additions": 29, "deletions": 13, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/d1c21b85cf7c8ca55bf0f83f2359d9018e321705/crates%2Fra_assists%2Fsrc%2Fmove_guard_to_arm_body.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d1c21b85cf7c8ca55bf0f83f2359d9018e321705/crates%2Fra_assists%2Fsrc%2Fmove_guard_to_arm_body.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fmove_guard_to_arm_body.rs?ref=d1c21b85cf7c8ca55bf0f83f2359d9018e321705", "patch": "@@ -1,6 +1,4 @@\n-use hir::{\n-    db::HirDatabase,\n-};\n+use hir::db::HirDatabase;\n use ra_syntax::{\n     TextUnit,\n     SyntaxElement,\n@@ -17,9 +15,7 @@ pub(crate) fn move_guard_to_arm_body(mut ctx: AssistCtx<impl HirDatabase>) -> Op\n \n     let guard_conditions = guard.expr()?;\n     let arm_expr = match_arm.expr()?;\n-    let buf = format!(\"if {} {{ {} }}\",\n-                          guard_conditions.syntax().text(),\n-                          arm_expr.syntax().text());\n+    let buf = format!(\"if {} {{ {} }}\", guard_conditions.syntax().text(), arm_expr.syntax().text());\n \n     ctx.add_action(AssistId(\"move_guard_to_arm_body\"), \"move guard to arm body\", |edit| {\n         edit.target(guard.syntax().range());\n@@ -32,16 +28,13 @@ pub(crate) fn move_guard_to_arm_body(mut ctx: AssistCtx<impl HirDatabase>) -> Op\n                 } else {\n                     TextUnit::from(0)\n                 }\n-            },\n-            _ => TextUnit::from(0)\n+            }\n+            _ => TextUnit::from(0),\n         };\n \n         edit.delete(guard.syntax().range());\n         edit.replace_node_and_indent(arm_expr.syntax(), buf);\n-        edit.set_cursor(\n-            arm_expr.syntax().range().start() +\n-            TextUnit::from(3) -\n-            offseting_amount);\n+        edit.set_cursor(arm_expr.syntax().range().start() + TextUnit::from(3) - offseting_amount);\n     });\n     ctx.build()\n }\n@@ -93,7 +86,30 @@ mod tests {\n                     _ => true\n                 }\n             }\n-            \"#\n+            \"#,\n+        );\n+    }\n+\n+    #[test]\n+    fn move_guard_to_arm_body_works_complex_match() {\n+        check_assist(\n+            move_guard_to_arm_body,\n+            r#\"\n+            fn f() {\n+                match x {\n+                    <|>y @ 4 | y @ 5    if y > 5 => true,\n+                    _ => false\n+                }\n+            }\n+            \"#,\n+            r#\"\n+            fn f() {\n+                match x {\n+                    y @ 4 | y @ 5 => if y > 5 { <|>true },\n+                    _ => false\n+                }\n+            }\n+            \"#,\n         );\n     }\n }"}, {"sha": "a714574fbac8c1f6771c1ee1c82a19372dd6a1b4", "filename": "docs/user/features.md", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d1c21b85cf7c8ca55bf0f83f2359d9018e321705/docs%2Fuser%2Ffeatures.md", "raw_url": "https://github.com/rust-lang/rust/raw/d1c21b85cf7c8ca55bf0f83f2359d9018e321705/docs%2Fuser%2Ffeatures.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Ffeatures.md?ref=d1c21b85cf7c8ca55bf0f83f2359d9018e321705", "patch": "@@ -388,6 +388,24 @@ fn foo() {\n }\n ```\n \n+- Move guard expression to match arm body\n+```rust\n+//before:\n+fn f() {\n+    match x {\n+        <|>y @ 4 | y @ 5    if y > 5 => true,\n+        _ => false\n+    }\n+}\n+//after:\n+fn f() {\n+    match x {\n+        y @ 4 | y @ 5 => if y > 5 { <|>true },\n+        _ => false\n+    }\n+}\n+```\n+\n ### Magic Completions\n \n In addition to usual reference completion, rust-analyzer provides some \u2728magic\u2728"}]}