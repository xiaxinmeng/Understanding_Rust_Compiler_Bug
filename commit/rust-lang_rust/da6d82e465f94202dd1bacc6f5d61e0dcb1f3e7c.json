{"sha": "da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhNmQ4MmU0NjVmOTQyMDJkZDFiYWNjNmY1ZDYxZTBkY2IxZjNlN2M=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-07-10T19:09:51Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-07-12T17:03:59Z"}, "message": "Simplify build system for rustdoc-gui test crates", "tree": {"sha": "a8963e0418ba0103fd10dfb4fe3ee5a167610f37", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a8963e0418ba0103fd10dfb4fe3ee5a167610f37"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "html_url": "https://github.com/rust-lang/rust/commit/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ccee61d38b94f868da9ae11ad5efd69d7a04072", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ccee61d38b94f868da9ae11ad5efd69d7a04072", "html_url": "https://github.com/rust-lang/rust/commit/8ccee61d38b94f868da9ae11ad5efd69d7a04072"}], "stats": {"total": 79, "additions": 65, "deletions": 14}, "files": [{"sha": "b7e8e8fa15752d6761bfe49fcd9ad287c6830b78", "filename": ".gitignore", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.gitignore?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -72,4 +72,7 @@ __pycache__/\n **node_modules\n **package-lock.json\n \n+## Rustdoc GUI tests\n+src/test/rustdoc-gui/src/**.lock\n+\n # Before adding new lines, see the comment at the top."}, {"sha": "61ffae47e2ad02a24bc1d2d8afade03f34e1509c", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 12, "deletions": 14, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -907,27 +907,25 @@ impl Step for RustdocGUI {\n         // We remove existing folder to be sure there won't be artifacts remaining.\n         let _ = fs::remove_dir_all(&out_dir);\n \n-        let mut nb_generated = 0;\n+        let src_path = \"src/test/rustdoc-gui/src\";\n         // We generate docs for the libraries present in the rustdoc-gui's src folder.\n-        let libs_dir = builder.build.src.join(\"src/test/rustdoc-gui/src\");\n-        for entry in libs_dir.read_dir().expect(\"read_dir call failed\") {\n-            let entry = entry.expect(\"invalid entry\");\n-            let path = entry.path();\n-            if path.extension().map(|e| e == \"rs\").unwrap_or(false) {\n-                let mut command = builder.rustdoc_cmd(self.compiler);\n-                command.arg(path).arg(\"-o\").arg(&out_dir);\n-                builder.run(&mut command);\n-                nb_generated += 1;\n-            }\n-        }\n-        assert!(nb_generated > 0, \"no documentation was generated...\");\n+        let mut cargo = Command::new(&builder.initial_cargo);\n+        cargo\n+            .arg(\"doc\")\n+            .arg(\"--workspace\")\n+            .arg(\"--target-dir\")\n+            .arg(&out_dir)\n+            .env(\"RUSTDOC\", builder.rustdoc(self.compiler))\n+            .env(\"RUSTC\", builder.rustc(self.compiler))\n+            .current_dir(&builder.build.src.join(src_path));\n+        builder.run(&mut cargo);\n \n         // We now run GUI tests.\n         let mut command = Command::new(&nodejs);\n         command\n             .arg(builder.build.src.join(\"src/tools/rustdoc-gui/tester.js\"))\n             .arg(\"--doc-folder\")\n-            .arg(out_dir)\n+            .arg(out_dir.join(\"doc\"))\n             .arg(\"--tests-folder\")\n             .arg(builder.build.src.join(\"src/test/rustdoc-gui\"));\n         for path in &builder.paths {"}, {"sha": "a72ccffc6ddf9ba7009535ee3e37d7f3c135a374", "filename": "src/test/rustdoc-gui/src/Cargo.lock", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2FCargo.lock?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -0,0 +1,18 @@\n+# This file is automatically @generated by Cargo.\n+# It is not intended for manual editing.\n+version = 3\n+\n+[[package]]\n+name = \"implementors\"\n+version = \"0.1.0\"\n+\n+[[package]]\n+name = \"lib2\"\n+version = \"0.1.0\"\n+dependencies = [\n+ \"implementors\",\n+]\n+\n+[[package]]\n+name = \"test_docs\"\n+version = \"0.1.0\""}, {"sha": "9c8c0c636f07fac38c91cf153cae9939dd75cfed", "filename": "src/test/rustdoc-gui/src/Cargo.toml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2FCargo.toml?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -0,0 +1,6 @@\n+[workspace]\n+members = [\n+    \"test_docs\",\n+    \"lib2\",\n+    \"implementors\",\n+]"}, {"sha": "6041a793f08dae9f952d45d2593edd69eb86563b", "filename": "src/test/rustdoc-gui/src/lib2/Cargo.toml", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2FCargo.toml?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -0,0 +1,10 @@\n+[package]\n+name = \"lib2\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+\n+[lib]\n+path = \"lib.rs\"\n+\n+[dependencies]\n+implementors = { path = \"../implementors\" }"}, {"sha": "72ef3cbd2026d7230862b5b99fa7d68edf9dd023", "filename": "src/test/rustdoc-gui/src/lib2/lib.rs", "status": "renamed", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -31,3 +31,5 @@ impl Trait for Foo {\n     type X = u32;\n     const Y: u32 = 0;\n }\n+\n+impl implementors::Whatever for Foo {}", "previous_filename": "src/test/rustdoc-gui/src/lib2.rs"}, {"sha": "31e1bb209f98ec5fc6b7cbea4c4766a555c87247", "filename": "src/test/rustdoc-gui/src/lib2/src/lib.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fsrc%2Flib.rs?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -0,0 +1,7 @@\n+#[cfg(test)]\n+mod tests {\n+    #[test]\n+    fn it_works() {\n+        assert_eq!(2 + 2, 4);\n+    }\n+}"}, {"sha": "7f3c65746fcf800215abd36fb9f6c158c7b1b876", "filename": "src/test/rustdoc-gui/src/test_docs/Cargo.toml", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2FCargo.toml?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "patch": "@@ -0,0 +1,7 @@\n+[package]\n+name = \"test_docs\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+\n+[lib]\n+path = \"lib.rs\""}, {"sha": "3e753cb4de8b19937b255f74ae9b783c56b86d45", "filename": "src/test/rustdoc-gui/src/test_docs/lib.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2Flib.rs?ref=da6d82e465f94202dd1bacc6f5d61e0dcb1f3e7c", "previous_filename": "src/test/rustdoc-gui/src/lib.rs"}]}