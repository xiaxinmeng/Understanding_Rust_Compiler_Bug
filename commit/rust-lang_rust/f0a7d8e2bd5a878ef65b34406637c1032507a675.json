{"sha": "f0a7d8e2bd5a878ef65b34406637c1032507a675", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwYTdkOGUyYmQ1YTg3OGVmNjViMzQ0MDY2MzdjMTAzMjUwN2E2NzU=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-01-16T18:31:15Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-01-16T18:31:15Z"}, "message": "Add incremental-fulldeps test suite and regression test for #47290.", "tree": {"sha": "4ce1a76dd3e494b114623851b46ea0f91ded41a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ce1a76dd3e494b114623851b46ea0f91ded41a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f0a7d8e2bd5a878ef65b34406637c1032507a675", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f0a7d8e2bd5a878ef65b34406637c1032507a675", "html_url": "https://github.com/rust-lang/rust/commit/f0a7d8e2bd5a878ef65b34406637c1032507a675", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f0a7d8e2bd5a878ef65b34406637c1032507a675/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8756ef6385ef8a1c77d46f44b54e4580cfcadc6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/8756ef6385ef8a1c77d46f44b54e4580cfcadc6d", "html_url": "https://github.com/rust-lang/rust/commit/8756ef6385ef8a1c77d46f44b54e4580cfcadc6d"}], "stats": {"total": 63, "additions": 63, "deletions": 0}, "files": [{"sha": "ecaf4d0c08c5a2c8f1369042927b4f284e4c04a7", "filename": "src/bootstrap/check.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f0a7d8e2bd5a878ef65b34406637c1032507a675/src%2Fbootstrap%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0a7d8e2bd5a878ef65b34406637c1032507a675/src%2Fbootstrap%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcheck.rs?ref=f0a7d8e2bd5a878ef65b34406637c1032507a675", "patch": "@@ -568,6 +568,11 @@ static HOST_COMPILETESTS: &[Test] = &[\n         mode: \"compile-fail\",\n         suite: \"compile-fail-fulldeps\",\n     },\n+    Test {\n+        path: \"src/test/incremental-fulldeps\",\n+        mode: \"incremental\",\n+        suite: \"incremental-fulldeps\",\n+    },\n     Test { path: \"src/test/run-make\", mode: \"run-make\", suite: \"run-make\" },\n     Test { path: \"src/test/rustdoc\", mode: \"rustdoc\", suite: \"rustdoc\" },\n "}, {"sha": "e9f9ba86f23dcafcfbdeea1ed1fafb884f44875b", "filename": "src/test/incremental-fulldeps/auxiliary/incremental_proc_macro_aux.rs", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/f0a7d8e2bd5a878ef65b34406637c1032507a675/src%2Ftest%2Fincremental-fulldeps%2Fauxiliary%2Fincremental_proc_macro_aux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0a7d8e2bd5a878ef65b34406637c1032507a675/src%2Ftest%2Fincremental-fulldeps%2Fauxiliary%2Fincremental_proc_macro_aux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental-fulldeps%2Fauxiliary%2Fincremental_proc_macro_aux.rs?ref=f0a7d8e2bd5a878ef65b34406637c1032507a675", "patch": "@@ -0,0 +1,31 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::TokenStream;\n+\n+// Add a function to shift DefIndex of registrar function\n+#[cfg(cfail2)]\n+fn foo() {}\n+\n+#[proc_macro_derive(IncrementalMacro)]\n+pub fn derive(input: TokenStream) -> TokenStream {\n+    #[cfg(cfail2)]\n+    {\n+        foo();\n+    }\n+\n+    \"\".parse().unwrap()\n+}"}, {"sha": "e434507085332e2f0ff32d91282d44ad34b1e500", "filename": "src/test/incremental-fulldeps/incremental_proc_macro.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/f0a7d8e2bd5a878ef65b34406637c1032507a675/src%2Ftest%2Fincremental-fulldeps%2Fincremental_proc_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0a7d8e2bd5a878ef65b34406637c1032507a675/src%2Ftest%2Fincremental-fulldeps%2Fincremental_proc_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental-fulldeps%2Fincremental_proc_macro.rs?ref=f0a7d8e2bd5a878ef65b34406637c1032507a675", "patch": "@@ -0,0 +1,27 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:incremental_proc_macro_aux.rs\n+// ignore-stage1\n+// revisions: cfail1 cfail2\n+// must-compile-successfully\n+\n+// This test makes sure that we still find the proc-macro registrar function\n+// when we compile proc-macros incrementally (see #47292).\n+\n+#![crate_type = \"rlib\"]\n+\n+#[macro_use]\n+extern crate incremental_proc_macro_aux;\n+\n+#[derive(IncrementalMacro)]\n+pub struct Foo {\n+    x: u32\n+}"}]}