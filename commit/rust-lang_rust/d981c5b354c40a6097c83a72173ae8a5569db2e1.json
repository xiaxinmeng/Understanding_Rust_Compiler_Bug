{"sha": "d981c5b354c40a6097c83a72173ae8a5569db2e1", "node_id": "C_kwDOAAsO6NoAKGQ5ODFjNWIzNTRjNDBhNjA5N2M4M2E3MjE3M2FlOGE1NTY5ZGIyZTE", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-01-20T02:35:02Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-01-20T03:02:25Z"}, "message": "Eliminate a token clone from advance_left", "tree": {"sha": "9c56b841d9c274bd5e0a71ae0324ffe8451a61cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c56b841d9c274bd5e0a71ae0324ffe8451a61cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d981c5b354c40a6097c83a72173ae8a5569db2e1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmHo0MEACgkQ+boUO5X/\nbYIwvg//a3uksHJQBtwhT/ahRiQNAUsEqB2DDPwBRNOJXki54XZsKnzLoIZwHcJA\nVxA6sxt+RdezghyGRFioEVeR8He9jnhG2Yn4H3ucRtbbyiM0iOSZQ5+bDmrSUCTT\nmiXLz83hCgkD4nsDEU98bRkdqDu8OZF/gqijFnKy8yi7hchhen/G7gQD89gvSjnF\nxR5jtmcyjSfiCY2O1aGeZFX0rGKmF1WAzgjT+VO0oD+3CwTbIJTjXHkLRjU5TuBu\np9gQrR+4sPXMRu5zC6ian1genJtKOLb96tB2kW1qzCRdEFiG2KlY+elxF+yG2iDf\nwWqTuxiuntPrhUHZLxkbu1FehCALEG0Th0XdS92NlUKvVP3pvE3rR3kz2VTdij4+\nm7RQeuGE0Tt+uUvydKqldmHHrord9H/7//SXGgxwqN3hT5LM+GunqPKmdj0Zx7Pg\ngc2zfiQN/PHHYDqtVOTIKQaQlhMAmIafKb0G+VBJNoKd+f0YSAK8kDvQviOAPW06\nTzt8c6W5LGN5Y3h8rNikeI4YfrwcQJzmu5fBp1KrfU6+JQfz6ENxzKRKjxhlTAvh\nS9O/+h7zkA1Fv7OYvmv/NFCTitvQUfmpqYP5TU9X123WQQ8w8dSNCw58S3/MPrfO\n5vtWhTRyrCxrrDIq1wLImMSILRhRo8sGPC40QEeNxO3TBERq4vQ=\n=wNHI\n-----END PGP SIGNATURE-----", "payload": "tree 9c56b841d9c274bd5e0a71ae0324ffe8451a61cc\nparent d81740ed2a63d377a725b0fbf935c391f5c7eb5e\nauthor David Tolnay <dtolnay@gmail.com> 1642646102 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1642647745 -0800\n\nEliminate a token clone from advance_left\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d981c5b354c40a6097c83a72173ae8a5569db2e1", "html_url": "https://github.com/rust-lang/rust/commit/d981c5b354c40a6097c83a72173ae8a5569db2e1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d981c5b354c40a6097c83a72173ae8a5569db2e1/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d81740ed2a63d377a725b0fbf935c391f5c7eb5e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d81740ed2a63d377a725b0fbf935c391f5c7eb5e", "html_url": "https://github.com/rust-lang/rust/commit/d81740ed2a63d377a725b0fbf935c391f5c7eb5e"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "b93463e99fd5c55ec16c2152266bd73e0b398836", "filename": "compiler/rustc_ast_pretty/src/pp.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d981c5b354c40a6097c83a72173ae8a5569db2e1/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d981c5b354c40a6097c83a72173ae8a5569db2e1/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs?ref=d981c5b354c40a6097c83a72173ae8a5569db2e1", "patch": "@@ -319,7 +319,7 @@ impl Printer {\n         let mut left_size = self.buf.first().unwrap().size;\n \n         while left_size >= 0 {\n-            let left = self.buf.first().unwrap().token.clone();\n+            let left = self.buf.pop_first().unwrap().token;\n \n             let len = match left {\n                 Token::Break(b) => b.blank_space,\n@@ -335,7 +335,6 @@ impl Printer {\n \n             self.left_total += len;\n \n-            self.buf.advance_left();\n             if self.buf.is_empty() {\n                 break;\n             }"}, {"sha": "8187394fe30e004ebabfc17ba75208d53d668bd1", "filename": "compiler/rustc_ast_pretty/src/pp/ring.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d981c5b354c40a6097c83a72173ae8a5569db2e1/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp%2Fring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d981c5b354c40a6097c83a72173ae8a5569db2e1/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp%2Fring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp%2Fring.rs?ref=d981c5b354c40a6097c83a72173ae8a5569db2e1", "patch": "@@ -32,11 +32,6 @@ impl<T> RingBuffer<T> {\n         index\n     }\n \n-    pub fn advance_left(&mut self) {\n-        self.data.pop_front().unwrap();\n-        self.offset += 1;\n-    }\n-\n     pub fn clear(&mut self) {\n         self.data.clear();\n     }\n@@ -53,6 +48,12 @@ impl<T> RingBuffer<T> {\n         self.data.front_mut()\n     }\n \n+    pub fn pop_first(&mut self) -> Option<T> {\n+        let first = self.data.pop_front()?;\n+        self.offset += 1;\n+        Some(first)\n+    }\n+\n     pub fn last(&self) -> Option<&T> {\n         self.data.back()\n     }"}]}