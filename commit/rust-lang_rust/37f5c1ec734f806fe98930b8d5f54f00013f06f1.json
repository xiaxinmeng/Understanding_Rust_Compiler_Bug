{"sha": "37f5c1ec734f806fe98930b8d5f54f00013f06f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3ZjVjMWVjNzM0ZjgwNmZlOTg5MzBiOGQ1ZjU0ZjAwMDEzZjA2ZjE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-09T07:13:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-09T07:13:08Z"}, "message": "Auto merge of #3925 - phansch:3741, r=flip1995\n\nFix ICE in suspicious_else_formatting\n\nFixes #3741", "tree": {"sha": "d9f803df2fcc6c06c5c67ba37e6eef381c050686", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d9f803df2fcc6c06c5c67ba37e6eef381c050686"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37f5c1ec734f806fe98930b8d5f54f00013f06f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37f5c1ec734f806fe98930b8d5f54f00013f06f1", "html_url": "https://github.com/rust-lang/rust/commit/37f5c1ec734f806fe98930b8d5f54f00013f06f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37f5c1ec734f806fe98930b8d5f54f00013f06f1/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "949f58440b19e470a8ed370166f9d72cd09bd7e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/949f58440b19e470a8ed370166f9d72cd09bd7e3", "html_url": "https://github.com/rust-lang/rust/commit/949f58440b19e470a8ed370166f9d72cd09bd7e3"}, {"sha": "3ab803845028b02e8c0174020c7ae2c6eb736f8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ab803845028b02e8c0174020c7ae2c6eb736f8f", "html_url": "https://github.com/rust-lang/rust/commit/3ab803845028b02e8c0174020c7ae2c6eb736f8f"}], "stats": {"total": 52, "additions": 51, "deletions": 1}, "files": [{"sha": "08376bc49d22488283c62e08db6358cdea6ae47a", "filename": "clippy_lints/src/formatting.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/37f5c1ec734f806fe98930b8d5f54f00013f06f1/clippy_lints%2Fsrc%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37f5c1ec734f806fe98930b8d5f54f00013f06f1/clippy_lints%2Fsrc%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fformatting.rs?ref=37f5c1ec734f806fe98930b8d5f54f00013f06f1", "patch": "@@ -1,5 +1,5 @@\n use crate::utils::{differing_macro_contexts, in_macro, snippet_opt, span_note_and_lint};\n-use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n+use rustc::lint::{in_external_macro, EarlyContext, EarlyLintPass, LintArray, LintPass};\n use rustc::{declare_tool_lint, lint_array};\n use syntax::ast;\n use syntax::ptr::P;\n@@ -150,6 +150,7 @@ fn check_else(cx: &EarlyContext<'_>, expr: &ast::Expr) {\n         if (is_block(else_) || unsugar_if(else_).is_some())\n             && !differing_macro_contexts(then.span, else_.span)\n             && !in_macro(then.span)\n+            && !in_external_macro(cx.sess, expr.span)\n         {\n             // workaround for rust-lang/rust#43081\n             if expr.span.lo().0 == 0 && expr.span.hi().0 == 0 {"}, {"sha": "71b10ed4db4d4a6bdc794261df1fc84b4ea5ffcf", "filename": "tests/ui/crashes/auxiliary/proc_macro_crash.rs", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/37f5c1ec734f806fe98930b8d5f54f00013f06f1/tests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37f5c1ec734f806fe98930b8d5f54f00013f06f1/tests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs?ref=37f5c1ec734f806fe98930b8d5f54f00013f06f1", "patch": "@@ -0,0 +1,37 @@\n+// no-prefer-dynamic\n+// ^ compiletest by default builds all aux files as dylibs, but we don't want that for proc-macro\n+// crates. If we don't set this, compiletest will override the `crate_type` attribute below and\n+// compile this as dylib. Removing this then causes the test to fail because a `dylib` crate can't\n+// contain a proc-macro.\n+\n+#![feature(repr128)]\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::{Delimiter, Group, Ident, Span, TokenStream, TokenTree};\n+use std::iter::FromIterator;\n+\n+#[proc_macro]\n+pub fn macro_test(input_stream: TokenStream) -> TokenStream {\n+    let first_token = input_stream.into_iter().next().unwrap();\n+    let span = first_token.span();\n+\n+    TokenStream::from_iter(vec![\n+        TokenTree::Ident(Ident::new(\"fn\", Span::call_site())),\n+        TokenTree::Ident(Ident::new(\"code\", Span::call_site())),\n+        TokenTree::Group(Group::new(Delimiter::Parenthesis, TokenStream::new())),\n+        TokenTree::Group(Group::new(Delimiter::Brace, {\n+            let mut clause = Group::new(Delimiter::Brace, TokenStream::new());\n+            clause.set_span(span);\n+\n+            TokenStream::from_iter(vec![\n+                TokenTree::Ident(Ident::new(\"if\", Span::call_site())),\n+                TokenTree::Ident(Ident::new(\"true\", Span::call_site())),\n+                TokenTree::Group(clause.clone()),\n+                TokenTree::Ident(Ident::new(\"else\", Span::call_site())),\n+                TokenTree::Group(clause.clone()),\n+            ])\n+        })),\n+    ])\n+}"}, {"sha": "74b9c9c86c81cc5372520db1952b9e4449af2015", "filename": "tests/ui/crashes/ice-3741.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/37f5c1ec734f806fe98930b8d5f54f00013f06f1/tests%2Fui%2Fcrashes%2Fice-3741.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37f5c1ec734f806fe98930b8d5f54f00013f06f1/tests%2Fui%2Fcrashes%2Fice-3741.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-3741.rs?ref=37f5c1ec734f806fe98930b8d5f54f00013f06f1", "patch": "@@ -0,0 +1,12 @@\n+// aux-build:proc_macro_crash.rs\n+// run-pass\n+\n+#![feature(proc_macro_hygiene)]\n+#![warn(clippy::suspicious_else_formatting)]\n+\n+extern crate proc_macro_crash;\n+use proc_macro_crash::macro_test;\n+\n+fn main() {\n+    macro_test!(2);\n+}"}]}