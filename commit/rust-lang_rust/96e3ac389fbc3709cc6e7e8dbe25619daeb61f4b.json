{"sha": "96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2ZTNhYzM4OWZiYzM3MDljYzZlN2U4ZGJlMjU2MTlkYWViNjFmNGI=", "commit": {"author": {"name": "Ville Penttinen", "email": "villem.penttinen@gmail.com", "date": "2019-02-17T17:48:08Z"}, "committer": {"name": "Ville Penttinen", "email": "villem.penttinen@gmail.com", "date": "2019-02-17T17:48:08Z"}, "message": "Parse only outer_attributes for match arms for now", "tree": {"sha": "f92e14c1d9c09b8d1bc00d9135f43d3a6af4d7c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f92e14c1d9c09b8d1bc00d9135f43d3a6af4d7c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b", "html_url": "https://github.com/rust-lang/rust/commit/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b/comments", "author": {"login": "vipentti", "id": 4726680, "node_id": "MDQ6VXNlcjQ3MjY2ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/4726680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vipentti", "html_url": "https://github.com/vipentti", "followers_url": "https://api.github.com/users/vipentti/followers", "following_url": "https://api.github.com/users/vipentti/following{/other_user}", "gists_url": "https://api.github.com/users/vipentti/gists{/gist_id}", "starred_url": "https://api.github.com/users/vipentti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vipentti/subscriptions", "organizations_url": "https://api.github.com/users/vipentti/orgs", "repos_url": "https://api.github.com/users/vipentti/repos", "events_url": "https://api.github.com/users/vipentti/events{/privacy}", "received_events_url": "https://api.github.com/users/vipentti/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vipentti", "id": 4726680, "node_id": "MDQ6VXNlcjQ3MjY2ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/4726680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vipentti", "html_url": "https://github.com/vipentti", "followers_url": "https://api.github.com/users/vipentti/followers", "following_url": "https://api.github.com/users/vipentti/following{/other_user}", "gists_url": "https://api.github.com/users/vipentti/gists{/gist_id}", "starred_url": "https://api.github.com/users/vipentti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vipentti/subscriptions", "organizations_url": "https://api.github.com/users/vipentti/orgs", "repos_url": "https://api.github.com/users/vipentti/repos", "events_url": "https://api.github.com/users/vipentti/events{/privacy}", "received_events_url": "https://api.github.com/users/vipentti/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c97c1ac11459d45f7bfc57dc72428d2b294520c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c97c1ac11459d45f7bfc57dc72428d2b294520c", "html_url": "https://github.com/rust-lang/rust/commit/1c97c1ac11459d45f7bfc57dc72428d2b294520c"}], "stats": {"total": 107, "additions": 60, "deletions": 47}, "files": [{"sha": "cd30e8a450c6192c9a9ef5ba3fec3a211db84646", "filename": "crates/ra_syntax/src/grammar/attributes.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Fattributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Fattributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Fattributes.rs?ref=96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b", "patch": "@@ -1,15 +1,5 @@\n use super::*;\n \n-/// Parses both inner & outer attributes.\n-///\n-/// Allowing to run validation for reporting errors\n-/// regarding attributes\n-pub(super) fn all_attributes(p: &mut Parser) {\n-    while p.at(POUND) {\n-        attribute(p, p.nth(1) == EXCL)\n-    }\n-}\n-\n pub(super) fn inner_attributes(p: &mut Parser) {\n     while p.current() == POUND && p.nth(1) == EXCL {\n         attribute(p, true)"}, {"sha": "e74305b6a94c222dd0c6e47ef816f295b04f33e4", "filename": "crates/ra_syntax/src/grammar/expressions/atom.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b", "patch": "@@ -331,11 +331,6 @@ pub(crate) fn match_arm_list(p: &mut Parser) {\n             continue;\n         }\n \n-        // This may result in invalid attributes\n-        // if there are inner attributes mixed in together\n-        // with the outer attributes, but we allow parsing\n-        // those so we can run validation and report better errors\n-\n         // test match_arms_outer_attributes\n         // fn foo() {\n         //     match () {\n@@ -349,7 +344,7 @@ pub(crate) fn match_arm_list(p: &mut Parser) {\n         //         _ => (),\n         //     }\n         // }\n-        attributes::all_attributes(p);\n+        attributes::outer_attributes(p);\n \n         // test match_arms_commas\n         // fn foo() {"}, {"sha": "b7543abc95e85a096dafc90a7693dbcdbdaf00c1", "filename": "crates/ra_syntax/tests/data/parser/err/0032_match_arms_inner_attrs.txt", "status": "modified", "additions": 59, "deletions": 31, "changes": 90, "blob_url": "https://github.com/rust-lang/rust/blob/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0032_match_arms_inner_attrs.txt", "raw_url": "https://github.com/rust-lang/rust/raw/96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0032_match_arms_inner_attrs.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0032_match_arms_inner_attrs.txt?ref=96e3ac389fbc3709cc6e7e8dbe25619daeb61f4b", "patch": "@@ -33,18 +33,29 @@ SOURCE_FILE@[0; 293)\n                 R_PAREN@[40; 41)\n             COMMA@[41; 42)\n             WHITESPACE@[42; 51)\n-            err: `Inner attributes are only allowed directly after the opening brace of the match expression`\n-            ATTR@[51; 78)\n+            ATTR@[51; 52)\n               POUND@[51; 52)\n-              EXCL@[52; 53)\n-              TOKEN_TREE@[53; 78)\n+              err: `expected `[``\n+              err: `expected pattern`\n+            MATCH_ARM@[52; 78)\n+              ERROR@[52; 53)\n+                EXCL@[52; 53)\n+                err: `expected FAT_ARROW`\n+              ARRAY_EXPR@[53; 78)\n                 L_BRACK@[53; 54)\n-                IDENT@[54; 57) \"doc\"\n-                TOKEN_TREE@[57; 77)\n-                  L_PAREN@[57; 58)\n-                  STRING@[58; 76)\n-                  R_PAREN@[76; 77)\n+                CALL_EXPR@[54; 77)\n+                  PATH_EXPR@[54; 57)\n+                    PATH@[54; 57)\n+                      PATH_SEGMENT@[54; 57)\n+                        NAME_REF@[54; 57)\n+                          IDENT@[54; 57) \"doc\"\n+                  ARG_LIST@[57; 77)\n+                    L_PAREN@[57; 58)\n+                    LITERAL@[58; 76)\n+                      STRING@[58; 76)\n+                    R_PAREN@[76; 77)\n                 R_BRACK@[77; 78)\n+                err: `expected COMMA`\n             WHITESPACE@[78; 87)\n             MATCH_ARM@[87; 94)\n               PLACEHOLDER_PAT@[87; 88)\n@@ -92,23 +103,29 @@ SOURCE_FILE@[0; 293)\n                 R_PAREN@[149; 150)\n             COMMA@[150; 151)\n             WHITESPACE@[151; 160)\n-            err: `Inner attributes are only allowed directly after the opening brace of the match expression`\n-            ATTR@[160; 179)\n+            ATTR@[160; 161)\n               POUND@[160; 161)\n-              EXCL@[161; 162)\n-              TOKEN_TREE@[162; 179)\n+              err: `expected `[``\n+              err: `expected pattern`\n+            MATCH_ARM@[161; 179)\n+              ERROR@[161; 162)\n+                EXCL@[161; 162)\n+                err: `expected FAT_ARROW`\n+              ARRAY_EXPR@[162; 179)\n                 L_BRACK@[162; 163)\n-                IDENT@[163; 166) \"doc\"\n-                TOKEN_TREE@[166; 178)\n-                  L_PAREN@[166; 167)\n-                  STRING@[167; 177)\n-                  R_PAREN@[177; 178)\n+                CALL_EXPR@[163; 178)\n+                  PATH_EXPR@[163; 166)\n+                    PATH@[163; 166)\n+                      PATH_SEGMENT@[163; 166)\n+                        NAME_REF@[163; 166)\n+                          IDENT@[163; 166) \"doc\"\n+                  ARG_LIST@[166; 178)\n+                    L_PAREN@[166; 167)\n+                    LITERAL@[167; 177)\n+                      STRING@[167; 177)\n+                    R_PAREN@[177; 178)\n                 R_BRACK@[178; 179)\n             WHITESPACE@[179; 184)\n-            err: `expected pattern`\n-            err: `expected FAT_ARROW`\n-            err: `expected expression`\n-            MATCH_ARM@[184; 184)\n             R_CURLY@[184; 185)\n       WHITESPACE@[185; 191)\n       MATCH_EXPR@[191; 290)\n@@ -132,18 +149,29 @@ SOURCE_FILE@[0; 293)\n                 R_PAREN@[220; 221)\n               R_BRACK@[221; 222)\n           WHITESPACE@[222; 231)\n-          err: `Inner attributes are only allowed directly after the opening brace of the match expression`\n-          ATTR@[231; 250)\n+          ATTR@[231; 232)\n             POUND@[231; 232)\n-            EXCL@[232; 233)\n-            TOKEN_TREE@[233; 250)\n+            err: `expected `[``\n+            err: `expected pattern`\n+          MATCH_ARM@[232; 250)\n+            ERROR@[232; 233)\n+              EXCL@[232; 233)\n+              err: `expected FAT_ARROW`\n+            ARRAY_EXPR@[233; 250)\n               L_BRACK@[233; 234)\n-              IDENT@[234; 237) \"doc\"\n-              TOKEN_TREE@[237; 249)\n-                L_PAREN@[237; 238)\n-                STRING@[238; 248)\n-                R_PAREN@[248; 249)\n+              CALL_EXPR@[234; 249)\n+                PATH_EXPR@[234; 237)\n+                  PATH@[234; 237)\n+                    PATH_SEGMENT@[234; 237)\n+                      NAME_REF@[234; 237)\n+                        IDENT@[234; 237) \"doc\"\n+                ARG_LIST@[237; 249)\n+                  L_PAREN@[237; 238)\n+                  LITERAL@[238; 248)\n+                    STRING@[238; 248)\n+                  R_PAREN@[248; 249)\n               R_BRACK@[249; 250)\n+              err: `expected COMMA`\n           WHITESPACE@[250; 259)\n           MATCH_ARM@[259; 266)\n             PLACEHOLDER_PAT@[259; 260)"}]}