{"sha": "ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "node_id": "C_kwDOAAsO6NoAKGJhNTE4ZmZkZDNkYjBiOGYyMTFlNDEwZDRmNWNkNzg5MWYxODkxYmE", "commit": {"author": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2021-11-05T18:47:52Z"}, "committer": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2021-11-11T23:15:57Z"}, "message": "Use `associated_item_def_ids` more", "tree": {"sha": "aadf309165278cfdd991a47a6fb76d3080b730b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aadf309165278cfdd991a47a6fb76d3080b730b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "html_url": "https://github.com/rust-lang/rust/commit/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/comments", "author": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ea84e879a40725cc4f73fe36d44ce9e5aa1a5d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ea84e879a40725cc4f73fe36d44ce9e5aa1a5d9", "html_url": "https://github.com/rust-lang/rust/commit/3ea84e879a40725cc4f73fe36d44ce9e5aa1a5d9"}], "stats": {"total": 50, "additions": 16, "deletions": 34}, "files": [{"sha": "7a0db820c9c99cf3fab4751592cdf8ba34b24e41", "filename": "compiler/rustc_infer/src/infer/error_reporting/mod.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "patch": "@@ -1704,13 +1704,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n         if let ty::Opaque(def_id, substs) = ty.kind() {\n             let future_trait = self.tcx.require_lang_item(LangItem::Future, None);\n             // Future::Output\n-            let item_def_id = self\n-                .tcx\n-                .associated_items(future_trait)\n-                .in_definition_order()\n-                .next()\n-                .unwrap()\n-                .def_id;\n+            let item_def_id = self.tcx.associated_item_def_ids(future_trait)[0];\n \n             let bounds = self.tcx.explicit_item_bounds(*def_id);\n "}, {"sha": "5e807b2f55cdafd528871c277b9bdf6934b79b17", "filename": "compiler/rustc_middle/src/ty/sty.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs?ref=ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "patch": "@@ -2086,10 +2086,10 @@ impl<'tcx> TyS<'tcx> {\n             ty::Generator(_, substs, _) => substs.as_generator().discr_ty(tcx),\n \n             ty::Param(_) | ty::Projection(_) | ty::Opaque(..) | ty::Infer(ty::TyVar(_)) => {\n-                let assoc_items =\n-                    tcx.associated_items(tcx.lang_items().discriminant_kind_trait().unwrap());\n-                let discriminant_def_id = assoc_items.in_definition_order().next().unwrap().def_id;\n-                tcx.mk_projection(discriminant_def_id, tcx.mk_substs([self.into()].iter()))\n+                let assoc_items = tcx.associated_item_def_ids(\n+                    tcx.require_lang_item(hir::LangItem::DiscriminantKind, None),\n+                );\n+                tcx.mk_projection(assoc_items[0], tcx.intern_substs(&[self.into()]))\n             }\n \n             ty::Bool"}, {"sha": "6e7acb244d1597a14fe80673f764381419335e5e", "filename": "compiler/rustc_middle/src/ty/util.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs?ref=ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "patch": "@@ -325,9 +325,9 @@ impl<'tcx> TyCtxt<'tcx> {\n \n         let ty = self.type_of(adt_did);\n         let (did, constness) = self.find_map_relevant_impl(drop_trait, ty, |impl_did| {\n-            if let Some(item) = self.associated_items(impl_did).in_definition_order().next() {\n+            if let Some(item_id) = self.associated_item_def_ids(impl_did).first() {\n                 if validate(self, impl_did).is_ok() {\n-                    return Some((item.def_id, self.impl_constness(impl_did)));\n+                    return Some((*item_id, self.impl_constness(impl_did)));\n                 }\n             }\n             None"}, {"sha": "11856f6e047e5c65a2db43954048045af31e7d88", "filename": "compiler/rustc_mir_dataflow/src/elaborate_drops.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_mir_dataflow%2Fsrc%2Felaborate_drops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_mir_dataflow%2Fsrc%2Felaborate_drops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Felaborate_drops.rs?ref=ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "patch": "@@ -604,7 +604,7 @@ where\n         debug!(\"destructor_call_block({:?}, {:?})\", self, succ);\n         let tcx = self.tcx();\n         let drop_trait = tcx.require_lang_item(LangItem::Drop, None);\n-        let drop_fn = tcx.associated_items(drop_trait).in_definition_order().next().unwrap();\n+        let drop_fn = tcx.associated_item_def_ids(drop_trait)[0];\n         let ty = self.place_ty(self.place);\n         let substs = tcx.mk_substs_trait(ty, &[]);\n \n@@ -624,12 +624,7 @@ where\n             )],\n             terminator: Some(Terminator {\n                 kind: TerminatorKind::Call {\n-                    func: Operand::function_handle(\n-                        tcx,\n-                        drop_fn.def_id,\n-                        substs,\n-                        self.source_info.span,\n-                    ),\n+                    func: Operand::function_handle(tcx, drop_fn, substs, self.source_info.span),\n                     args: vec![Operand::Move(Place::from(ref_place))],\n                     destination: Some((unit_temp, succ)),\n                     cleanup: unwind.into_option(),"}, {"sha": "bdec7163cd989485caaa7e43550fcacff97345b9", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "patch": "@@ -2471,13 +2471,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                     obligation.param_env,\n                 );\n \n-                let item_def_id = self\n-                    .tcx\n-                    .associated_items(future_trait)\n-                    .in_definition_order()\n-                    .next()\n-                    .unwrap()\n-                    .def_id;\n+                let item_def_id = self.tcx.associated_item_def_ids(future_trait)[0];\n                 // `<T as Future>::Output`\n                 let projection_ty = ty::ProjectionTy {\n                     // `T`"}, {"sha": "4a41552a5fbef4c83a1ccfd89f56a1bd4a8bb450", "filename": "compiler/rustc_typeck/src/check/closure.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fclosure.rs?ref=ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "patch": "@@ -257,8 +257,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         if is_gen {\n             // Check that we deduce the signature from the `<_ as std::ops::Generator>::Return`\n             // associated item and not yield.\n-            let return_assoc_item =\n-                self.tcx.associated_items(gen_trait).in_definition_order().nth(1).unwrap().def_id;\n+            let return_assoc_item = self.tcx.associated_item_def_ids(gen_trait)[1];\n             if return_assoc_item != projection.projection_def_id() {\n                 debug!(\"deduce_sig_from_projection: not return assoc item of generator\");\n                 return None;\n@@ -694,8 +693,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         // The `Future` trait has only one associted item, `Output`,\n         // so check that this is what we see.\n-        let output_assoc_item =\n-            self.tcx.associated_items(future_trait).in_definition_order().next().unwrap().def_id;\n+        let output_assoc_item = self.tcx.associated_item_def_ids(future_trait)[0];\n         if output_assoc_item != predicate.projection_ty.item_def_id {\n             span_bug!(\n                 cause_span,"}, {"sha": "6314f2aba4efe2b4c166fa6595b7fe6be015eed0", "filename": "compiler/rustc_typeck/src/check/intrinsic.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba518ffdd3db0b8f211e410d4f5cd7891f1891ba/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fintrinsic.rs?ref=ba518ffdd3db0b8f211e410d4f5cd7891f1891ba", "patch": "@@ -324,9 +324,10 @@ pub fn check_intrinsic_type(tcx: TyCtxt<'_>, it: &hir::ForeignItem<'_>) {\n             sym::unlikely => (0, vec![tcx.types.bool], tcx.types.bool),\n \n             sym::discriminant_value => {\n-                let assoc_items =\n-                    tcx.associated_items(tcx.lang_items().discriminant_kind_trait().unwrap());\n-                let discriminant_def_id = assoc_items.in_definition_order().next().unwrap().def_id;\n+                let assoc_items = tcx.associated_item_def_ids(\n+                    tcx.require_lang_item(hir::LangItem::DiscriminantKind, None),\n+                );\n+                let discriminant_def_id = assoc_items[0];\n \n                 let br = ty::BoundRegion { var: ty::BoundVar::from_u32(0), kind: ty::BrAnon(0) };\n                 ("}]}