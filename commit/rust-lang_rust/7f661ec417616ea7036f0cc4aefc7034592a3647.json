{"sha": "7f661ec417616ea7036f0cc4aefc7034592a3647", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmNjYxZWM0MTc2MTZlYTcwMzZmMGNjNGFlZmM3MDM0NTkyYTM2NDc=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-03-11T18:36:55Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-03-25T10:45:43Z"}, "message": "new tests for RFC #1445", "tree": {"sha": "e9d8c5a802e51f5cce66174f24ea110bc9db025e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9d8c5a802e51f5cce66174f24ea110bc9db025e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f661ec417616ea7036f0cc4aefc7034592a3647", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f661ec417616ea7036f0cc4aefc7034592a3647", "html_url": "https://github.com/rust-lang/rust/commit/7f661ec417616ea7036f0cc4aefc7034592a3647", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f661ec417616ea7036f0cc4aefc7034592a3647/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "56ebf2b046fd4f0b9d05a90ff1e8a38b62be0325", "url": "https://api.github.com/repos/rust-lang/rust/commits/56ebf2b046fd4f0b9d05a90ff1e8a38b62be0325", "html_url": "https://github.com/rust-lang/rust/commit/56ebf2b046fd4f0b9d05a90ff1e8a38b62be0325"}], "stats": {"total": 137, "additions": 133, "deletions": 4}, "files": [{"sha": "f6b7e13c4f5e9328593e8bab6c99e8b233d8ffac", "filename": "src/test/compile-fail/issue-6804.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Fcompile-fail%2Fissue-6804.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Fcompile-fail%2Fissue-6804.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-6804.rs?ref=7f661ec417616ea7036f0cc4aefc7034592a3647", "patch": "@@ -26,15 +26,11 @@ fn main() { //~ ERROR compilation successful\n     //~^^^ WARNING unmatchable NaN in pattern, use the is_nan method in a guard instead\n     //~| WARNING floating point constants cannot be used\n     //~| WARNING this was previously accepted\n-    //~| WARNING floating point constants cannot be used\n-    //~| WARNING this was previously accepted\n     match [x, 1.0] {\n         [NAN, _] => {},\n         _ => {},\n     };\n     //~^^^ WARNING unmatchable NaN in pattern, use the is_nan method in a guard instead\n     //~| WARNING floating point constants cannot be used\n     //~| WARNING this was previously accepted\n-    //~| WARNING floating point constants cannot be used\n-    //~| WARNING this was previously accepted\n }"}, {"sha": "1f2d7819e26d8abc91c4d85af257cf930f12da9e", "filename": "src/test/compile-fail/rfc1445/feature-gate.rs", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Fcompile-fail%2Frfc1445%2Ffeature-gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Fcompile-fail%2Frfc1445%2Ffeature-gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Frfc1445%2Ffeature-gate.rs?ref=7f661ec417616ea7036f0cc4aefc7034592a3647", "patch": "@@ -0,0 +1,36 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that structural match is only permitted with a feature gate,\n+// and that if a feature gate is supplied, it permits the type to be\n+// used in a match.\n+\n+// revisions: with_gate no_gate\n+\n+#![allow(dead_code)]\n+#![deny(future_incompatible)]\n+#![feature(rustc_attrs)]\n+#![cfg_attr(with_gate, feature(structural_match))]\n+\n+#[structural_match] //[no_gate]~ ERROR semantics of constant patterns is not yet settled\n+struct Foo {\n+    x: u32\n+}\n+\n+const FOO: Foo = Foo { x: 0 };\n+\n+#[rustc_error]\n+fn main() { //[with_gate]~ ERROR compilation successful\n+    let y = Foo { x: 1 };\n+    match y {\n+        FOO => { }\n+        _ => { }\n+    }\n+}"}, {"sha": "b3e465688fdd4fb552d2aea3c1dc6fa98d754423", "filename": "src/test/compile-fail/rfc1445/match-forbidden-without-eq.rs", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Fcompile-fail%2Frfc1445%2Fmatch-forbidden-without-eq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Fcompile-fail%2Frfc1445%2Fmatch-forbidden-without-eq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Frfc1445%2Fmatch-forbidden-without-eq.rs?ref=7f661ec417616ea7036f0cc4aefc7034592a3647", "patch": "@@ -0,0 +1,39 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![allow(dead_code)]\n+#![deny(future_incompatible)]\n+\n+use std::f32;\n+\n+#[derive(PartialEq)]\n+struct Foo {\n+    x: u32\n+}\n+\n+const FOO: Foo = Foo { x: 0 };\n+\n+fn main() {\n+    let y = Foo { x: 1 };\n+    match y {\n+        FOO => { }\n+        //~^ ERROR must be annotated with `#[derive(Eq)]`\n+        //~| WARNING will become a hard error\n+        _ => { }\n+    }\n+\n+    let x = 0.0;\n+    match x {\n+        f32::INFINITY => { }\n+        //~^ ERROR floating point constants cannot be used in patterns\n+        //~| WARNING will become a hard error\n+        _ => { }\n+    }\n+}"}, {"sha": "241fe6c6ab1e9a3c05bd86d58945ec9978145fde", "filename": "src/test/run-pass/rfc1445/eq-allows-match-on-ty-in-macro.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Frun-pass%2Frfc1445%2Feq-allows-match-on-ty-in-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Frun-pass%2Frfc1445%2Feq-allows-match-on-ty-in-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc1445%2Feq-allows-match-on-ty-in-macro.rs?ref=7f661ec417616ea7036f0cc4aefc7034592a3647", "patch": "@@ -0,0 +1,32 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![allow(dead_code)]\n+\n+macro_rules! foo {\n+    (#[$attr:meta] $x:ident) => {\n+        #[$attr]\n+        struct $x {\n+            x: u32\n+        }\n+    }\n+}\n+\n+foo! { #[derive(PartialEq, Eq)] Foo }\n+\n+const FOO: Foo = Foo { x: 0 };\n+\n+fn main() {\n+    let y = Foo { x: 1 };\n+    match y {\n+        FOO => { }\n+        _ => { }\n+    }\n+}"}, {"sha": "f02a45625c9f6e5b10b655e9f7e6c9b92494bbcf", "filename": "src/test/run-pass/rfc1445/eq-allows-match.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Frun-pass%2Frfc1445%2Feq-allows-match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f661ec417616ea7036f0cc4aefc7034592a3647/src%2Ftest%2Frun-pass%2Frfc1445%2Feq-allows-match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc1445%2Feq-allows-match.rs?ref=7f661ec417616ea7036f0cc4aefc7034592a3647", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![allow(dead_code)]\n+\n+#[derive(PartialEq, Eq)]\n+struct Foo {\n+    x: u32\n+}\n+\n+const FOO: Foo = Foo { x: 0 };\n+\n+fn main() {\n+    let y = Foo { x: 1 };\n+    match y {\n+        FOO => { }\n+        _ => { }\n+    }\n+}"}]}