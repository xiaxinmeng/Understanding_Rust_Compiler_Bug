{"sha": "c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "node_id": "C_kwDOAAsO6NoAKGMzNTViMmU1Y2Q3NGE2YzliODBlNmQzMWUzOWM1ZWE0MDQ5NzQ5OGY", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-11-14T15:35:31Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-10-03T14:08:53Z"}, "message": "Move ICH to rustc_query_system.", "tree": {"sha": "c20a072026ccb291b5c9ddf95423ce5c97502bf1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c20a072026ccb291b5c9ddf95423ce5c97502bf1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "html_url": "https://github.com/rust-lang/rust/commit/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d38c53767dd9a4e74b347f663eb7f41dea9232c", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d38c53767dd9a4e74b347f663eb7f41dea9232c", "html_url": "https://github.com/rust-lang/rust/commit/2d38c53767dd9a4e74b347f663eb7f41dea9232c"}], "stats": {"total": 69, "additions": 30, "deletions": 39}, "files": [{"sha": "eadac99787f7f47e965d5d516bcccfeee51ba302", "filename": "Cargo.lock", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -4308,13 +4308,17 @@ dependencies = [\n  \"parking_lot\",\n  \"rustc-rayon-core\",\n  \"rustc_arena\",\n+ \"rustc_ast\",\n  \"rustc_data_structures\",\n  \"rustc_errors\",\n+ \"rustc_feature\",\n+ \"rustc_hir\",\n  \"rustc_index\",\n  \"rustc_macros\",\n  \"rustc_serialize\",\n  \"rustc_session\",\n  \"rustc_span\",\n+ \"rustc_target\",\n  \"smallvec\",\n  \"tracing\",\n ]"}, {"sha": "f0b869558bcf571b274e6044a03447a87849a8f9", "filename": "compiler/rustc_middle/src/ich.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_middle%2Fsrc%2Fich.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_middle%2Fsrc%2Fich.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fich.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -0,0 +1,5 @@\n+//! ICH - Incremental Compilation Hash\n+\n+pub use rustc_query_system::ich::{NodeIdHashingMode, StableHashingContext};\n+\n+mod impls_ty;"}, {"sha": "97106b58e0a6e38561aa50f9e720f6600e882b59", "filename": "compiler/rustc_middle/src/ich/impls_ty.rs", "status": "modified", "additions": 1, "deletions": 35, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_middle%2Fsrc%2Fich%2Fimpls_ty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_middle%2Fsrc%2Fich%2Fimpls_ty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fich%2Fimpls_ty.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -1,7 +1,7 @@\n //! This module contains `HashStable` implementations for various data types\n //! from `rustc_middle::ty` in no particular order.\n \n-use crate::ich::{NodeIdHashingMode, StableHashingContext};\n+use crate::ich::StableHashingContext;\n use crate::middle::region;\n use crate::mir;\n use crate::ty;\n@@ -163,37 +163,3 @@ impl<'a> ToStableHashKey<StableHashingContext<'a>> for region::Scope {\n         *self\n     }\n }\n-\n-impl<'a> HashStable<StableHashingContext<'a>> for ty::TyVid {\n-    fn hash_stable(&self, _hcx: &mut StableHashingContext<'a>, _hasher: &mut StableHasher) {\n-        // `TyVid` values are confined to an inference context and hence\n-        // should not be hashed.\n-        bug!(\"ty::TyKind::hash_stable() - can't hash a TyVid {:?}.\", *self)\n-    }\n-}\n-\n-impl<'a> HashStable<StableHashingContext<'a>> for ty::IntVid {\n-    fn hash_stable(&self, _hcx: &mut StableHashingContext<'a>, _hasher: &mut StableHasher) {\n-        // `IntVid` values are confined to an inference context and hence\n-        // should not be hashed.\n-        bug!(\"ty::TyKind::hash_stable() - can't hash an IntVid {:?}.\", *self)\n-    }\n-}\n-\n-impl<'a> HashStable<StableHashingContext<'a>> for ty::FloatVid {\n-    fn hash_stable(&self, _hcx: &mut StableHashingContext<'a>, _hasher: &mut StableHasher) {\n-        // `FloatVid` values are confined to an inference context and hence\n-        // should not be hashed.\n-        bug!(\"ty::TyKind::hash_stable() - can't hash a FloatVid {:?}.\", *self)\n-    }\n-}\n-\n-impl<'a> HashStable<StableHashingContext<'a>> for crate::middle::privacy::AccessLevels {\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        hcx.with_node_id_hashing_mode(NodeIdHashingMode::HashDefPath, |hcx| {\n-            let crate::middle::privacy::AccessLevels { ref map } = *self;\n-\n-            map.hash_stable(hcx, hasher);\n-        });\n-    }\n-}"}, {"sha": "f33bd3438b96836f54d20b224937592a3f85022f", "filename": "compiler/rustc_middle/src/middle/privacy.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fprivacy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fprivacy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fprivacy.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -3,7 +3,9 @@\n //! which are available for use externally when compiled as a library.\n \n use rustc_data_structures::fx::FxHashMap;\n+use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n use rustc_macros::HashStable;\n+use rustc_query_system::ich::{NodeIdHashingMode, StableHashingContext};\n use rustc_span::def_id::LocalDefId;\n use std::hash::Hash;\n \n@@ -53,3 +55,12 @@ impl<Id> Default for AccessLevels<Id> {\n         AccessLevels { map: Default::default() }\n     }\n }\n+\n+impl<'a> HashStable<StableHashingContext<'a>> for AccessLevels {\n+    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n+        hcx.with_node_id_hashing_mode(NodeIdHashingMode::HashDefPath, |hcx| {\n+            let AccessLevels { ref map } = *self;\n+            map.hash_stable(hcx, hasher);\n+        });\n+    }\n+}"}, {"sha": "898a8caa3ca351018ed4b9b3bb589f9c2896a31b", "filename": "compiler/rustc_query_system/Cargo.toml", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2FCargo.toml?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -10,12 +10,16 @@ doctest = false\n rustc_arena = { path = \"../rustc_arena\" }\n tracing = \"0.1\"\n rustc-rayon-core = \"0.3.1\"\n+rustc_ast = { path = \"../rustc_ast\" }\n rustc_data_structures = { path = \"../rustc_data_structures\" }\n rustc_errors = { path = \"../rustc_errors\" }\n-rustc_macros = { path = \"../rustc_macros\" }\n+rustc_feature = { path = \"../rustc_feature\" }\n+rustc_hir = { path = \"../rustc_hir\" }\n rustc_index = { path = \"../rustc_index\" }\n+rustc_macros = { path = \"../rustc_macros\" }\n rustc_serialize = { path = \"../rustc_serialize\" }\n rustc_session = { path = \"../rustc_session\" }\n rustc_span = { path = \"../rustc_span\" }\n+rustc_target = { path = \"../rustc_target\" }\n parking_lot = \"0.11\"\n smallvec = { version = \"1.6.1\", features = [\"union\", \"may_dangle\"] }"}, {"sha": "d3e5189ce768a786056050295a0fab4a41afbfb2", "filename": "compiler/rustc_query_system/src/ich/hcx.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fhcx.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fhcx.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fhcx.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -206,4 +206,4 @@ impl<'a> rustc_span::HashStableContext for StableHashingContext<'a> {\n     }\n }\n \n-impl rustc_session::HashStableContext for StableHashingContext<'a> {}\n+impl<'a> rustc_session::HashStableContext for StableHashingContext<'a> {}", "previous_filename": "compiler/rustc_middle/src/ich/hcx.rs"}, {"sha": "3c3e7e0d173e0ca9f6fb230d7e387626b1ad3536", "filename": "compiler/rustc_query_system/src/ich/impls_hir.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fimpls_hir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fimpls_hir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fimpls_hir.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "previous_filename": "compiler/rustc_middle/src/ich/impls_hir.rs"}, {"sha": "acf2990b6434883ba92509cb4bacc68e1f86a557", "filename": "compiler/rustc_query_system/src/ich/impls_syntax.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fimpls_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fimpls_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fimpls_syntax.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "previous_filename": "compiler/rustc_middle/src/ich/impls_syntax.rs"}, {"sha": "54416902e5fb63e0104d73fb8167b96efa399ed9", "filename": "compiler/rustc_query_system/src/ich/mod.rs", "status": "renamed", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fich%2Fmod.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -4,10 +4,8 @@ pub use self::hcx::{NodeIdHashingMode, StableHashingContext};\n use rustc_span::symbol::{sym, Symbol};\n \n mod hcx;\n-\n mod impls_hir;\n mod impls_syntax;\n-mod impls_ty;\n \n pub const IGNORED_ATTRIBUTES: &[Symbol] = &[\n     sym::cfg,", "previous_filename": "compiler/rustc_middle/src/ich/mod.rs"}, {"sha": "bc23de069b0d9fdbccf830ce8736ed644b0b84ed", "filename": "compiler/rustc_query_system/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_query_system%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Flib.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -1,3 +1,4 @@\n+#![feature(assert_matches)]\n #![feature(bool_to_option)]\n #![feature(core_intrinsics)]\n #![feature(hash_raw_entry)]\n@@ -14,4 +15,5 @@ extern crate rustc_macros;\n \n pub mod cache;\n pub mod dep_graph;\n+pub mod ich;\n pub mod query;"}, {"sha": "6c86f86ecd9bb210a4d71b1d7eca891bd44a52ec", "filename": "compiler/rustc_session/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_session%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c355b2e5cd74a6c9b80e6d31e39c5ea40497498f/compiler%2Frustc_session%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Flib.rs?ref=c355b2e5cd74a6c9b80e6d31e39c5ea40497498f", "patch": "@@ -1,4 +1,5 @@\n #![feature(crate_visibility_modifier)]\n+#![feature(min_specialization)]\n #![feature(once_cell)]\n #![recursion_limit = \"256\"]\n "}]}