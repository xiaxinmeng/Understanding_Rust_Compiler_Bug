{"sha": "c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1ZTZkYjE2YjFkZWY1ZDQ4MTM1ODQ4OWEzYzZkOWE2ZmQ1Y2JkZjQ=", "commit": {"author": {"name": "Erlend Tobiassen", "email": "erlend.tobiassen@gmail.com", "date": "2019-01-26T12:12:55Z"}, "committer": {"name": "Erlend Tobiassen", "email": "erlend.tobiassen@gmail.com", "date": "2019-01-27T14:19:38Z"}, "message": "fix #668", "tree": {"sha": "2786fbe5e8973985e980ed718034547cd5bf1b43", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2786fbe5e8973985e980ed718034547cd5bf1b43"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJPBAABCgA5FiEEve4ZOr7ty1/KyouLtIuFNqj1hbIFAlxNvfobHGVybGVuZC50\nb2JpYXNzZW5AZ21haWwuY29tAAoJELSLhTao9YWyiscP/RB9wI3ARujG478JYsCq\nxr0MHPgPdBpX7Li4ATzch6SwuGnmAwel2MPFOJZdSQmpQM1wW/SW0XyS/pJMaIYy\nA+X9gKQ9u7EhCPcTfKGeKj9wrYApvErJqIMkjfKRU/N6IoMFsl4Mc838hkFWoILx\n5U++IdJYneajeq9V9GZQKlbeufgTzpu+uxtnsuZFYSyrjnLWWZq7ksX1vKuqjtmP\neNk+sRHZX2VfaXuhPG3nGmGjaSqrBexrVBp+5RgGz5ziiL122atuzGfPR9bM0Ccl\n7Mh+JvjSwkodC15xp+kcByygo0lvru/xd3Pw6gNYm+dieIJWT1UqUjebI9xMeRPX\nIEambQiA9mUzZE/H4nezVBpbeGgA1w9XuwYmUC+mmuqwWlmgQ6x6aueYwmNYVTl6\nzElNJbA+ZHsZ5WmuhWxXP9NNQQhAAVmkS0VfAf6JKxwNV5lgPhvO7WQ91gX9EMax\nlKH8ksNbj+aRvPsQn9u8dP9V5qBeYXJOW2j8wsqhn8JV2p5fw/M45xWaLHgRx3vk\n37hM4O5owTFenSOhN+KJbrzTx1Vot2Fgf82REd0KEG1jbI5RYoqGZBloCHjqlZrr\nDPPiDHxGb2YtJXez8pBPGvVWKG4edl8rMpN1bGhP9wkKo4Hc/z9yPHo2bwmieyl+\njsG6d8M9cfozTUSEmwetB/mZ\n=jN5U\n-----END PGP SIGNATURE-----", "payload": "tree 2786fbe5e8973985e980ed718034547cd5bf1b43\nparent 683e5e64f42b6c74596015c5d19e2eab186fe68d\nauthor Erlend Tobiassen <erlend.tobiassen@gmail.com> 1548504775 +0100\ncommitter Erlend Tobiassen <erlend.tobiassen@gmail.com> 1548598778 +0100\n\nfix #668\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4", "html_url": "https://github.com/rust-lang/rust/commit/c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4/comments", "author": {"login": "regiontog", "id": 9137819, "node_id": "MDQ6VXNlcjkxMzc4MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/9137819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/regiontog", "html_url": "https://github.com/regiontog", "followers_url": "https://api.github.com/users/regiontog/followers", "following_url": "https://api.github.com/users/regiontog/following{/other_user}", "gists_url": "https://api.github.com/users/regiontog/gists{/gist_id}", "starred_url": "https://api.github.com/users/regiontog/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/regiontog/subscriptions", "organizations_url": "https://api.github.com/users/regiontog/orgs", "repos_url": "https://api.github.com/users/regiontog/repos", "events_url": "https://api.github.com/users/regiontog/events{/privacy}", "received_events_url": "https://api.github.com/users/regiontog/received_events", "type": "User", "site_admin": false}, "committer": {"login": "regiontog", "id": 9137819, "node_id": "MDQ6VXNlcjkxMzc4MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/9137819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/regiontog", "html_url": "https://github.com/regiontog", "followers_url": "https://api.github.com/users/regiontog/followers", "following_url": "https://api.github.com/users/regiontog/following{/other_user}", "gists_url": "https://api.github.com/users/regiontog/gists{/gist_id}", "starred_url": "https://api.github.com/users/regiontog/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/regiontog/subscriptions", "organizations_url": "https://api.github.com/users/regiontog/orgs", "repos_url": "https://api.github.com/users/regiontog/repos", "events_url": "https://api.github.com/users/regiontog/events{/privacy}", "received_events_url": "https://api.github.com/users/regiontog/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "683e5e64f42b6c74596015c5d19e2eab186fe68d", "url": "https://api.github.com/repos/rust-lang/rust/commits/683e5e64f42b6c74596015c5d19e2eab186fe68d", "html_url": "https://github.com/rust-lang/rust/commit/683e5e64f42b6c74596015c5d19e2eab186fe68d"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "7caebab0dfd2e77ca3dfc895a9c434fe4c729dba", "filename": "crates/ra_hir/src/module_tree.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4/crates%2Fra_hir%2Fsrc%2Fmodule_tree.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4/crates%2Fra_hir%2Fsrc%2Fmodule_tree.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fmodule_tree.rs?ref=c5e6db16b1def5d481358489a3c6d9a6fd5cbdf4", "patch": "@@ -172,6 +172,7 @@ impl ModuleTree {\n         file_id: HirFileId,\n         decl_id: Option<SourceFileItemId>,\n     ) -> ModuleId {\n+        let is_root = parent.is_none();\n         let id = self.alloc_mod(ModuleData {\n             file_id,\n             decl_id,\n@@ -295,6 +296,7 @@ fn resolve_submodule(\n     db: &impl HirDatabase,\n     file_id: HirFileId,\n     name: &Name,\n+    is_root: bool,\n ) -> (Vec<FileId>, Option<Problem>) {\n     // FIXME: handle submodules of inline modules properly\n     let file_id = file_id.original_file(db);\n@@ -303,7 +305,7 @@ fn resolve_submodule(\n     let root = RelativePathBuf::default();\n     let dir_path = path.parent().unwrap_or(&root);\n     let mod_name = path.file_stem().unwrap_or(\"unknown\");\n-    let is_dir_owner = mod_name == \"mod\" || mod_name == \"lib\" || mod_name == \"main\";\n+    let is_dir_owner = is_root || mod_name == \"mod\";\n \n     let file_mod = dir_path.join(format!(\"{}.rs\", name));\n     let dir_mod = dir_path.join(format!(\"{}/mod.rs\", name));"}]}