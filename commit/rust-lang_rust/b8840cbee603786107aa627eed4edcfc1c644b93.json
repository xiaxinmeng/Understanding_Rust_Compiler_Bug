{"sha": "b8840cbee603786107aa627eed4edcfc1c644b93", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI4ODQwY2JlZTYwMzc4NjEwN2FhNjI3ZWVkNGVkY2ZjMWM2NDRiOTM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-17T06:50:00Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-17T06:50:00Z"}, "message": "rustdoc: Add a pass to prune undocumented items", "tree": {"sha": "034ab7f6d1597cc94553bca02bb7d820322daeb8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/034ab7f6d1597cc94553bca02bb7d820322daeb8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b8840cbee603786107aa627eed4edcfc1c644b93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b8840cbee603786107aa627eed4edcfc1c644b93", "html_url": "https://github.com/rust-lang/rust/commit/b8840cbee603786107aa627eed4edcfc1c644b93", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b8840cbee603786107aa627eed4edcfc1c644b93/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba41342279a7949d746f9de0d7211efc5070929a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba41342279a7949d746f9de0d7211efc5070929a", "html_url": "https://github.com/rust-lang/rust/commit/ba41342279a7949d746f9de0d7211efc5070929a"}], "stats": {"total": 71, "additions": 71, "deletions": 0}, "files": [{"sha": "085d24c9b2976d2e5c2e883ea330a6a90a42323e", "filename": "src/rustdoc/fold.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Ffold.rs?ref=b8840cbee603786107aa627eed4edcfc1c644b93", "patch": "@@ -2,6 +2,7 @@ export fold;\n export fold_crate, fold_mod, fold_fn, fold_modlist, fold_fnlist;\n export default_seq_fold;\n export default_seq_fold_fn;\n+export default_seq_fold_fnlist;\n \n tag fold<T> = t<T>;\n "}, {"sha": "1c1809effec5d3afe6463026720b30c7696a3fb8", "filename": "src/rustdoc/prune_undoc_pass.rs", "status": "added", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Fprune_undoc_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Fprune_undoc_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fprune_undoc_pass.rs?ref=b8840cbee603786107aa627eed4edcfc1c644b93", "patch": "@@ -0,0 +1,67 @@\n+export run;\n+\n+type ctxt = {\n+    mutable have_docs: bool\n+};\n+\n+fn run(\n+    _srv: astsrv::seq_srv,\n+    doc: doc::cratedoc\n+) -> doc::cratedoc {\n+    let ctxt = {\n+        mutable have_docs: true\n+    };\n+    let fold = fold::fold({\n+        fold_fn: fn~(\n+            f: fold::fold<ctxt>,\n+            d: doc::fndoc\n+        ) -> doc::fndoc {\n+            fold_fn(f, d)\n+        },\n+        fold_fnlist: fn~(\n+            f: fold::fold<ctxt>,\n+            l: doc::fnlist\n+        ) -> doc::fnlist {\n+            fold_fnlist(f, l)\n+        }\n+        with *fold::default_seq_fold(ctxt)\n+    });\n+    fold.fold_crate(fold, doc)\n+}\n+\n+fn fold_fn(\n+    fold: fold::fold<ctxt>,\n+    doc: doc::fndoc\n+) -> doc::fndoc {\n+    fold.ctxt.have_docs =\n+        doc.brief != none\n+        || doc.desc != none\n+        || doc.return != none;\n+    ret doc;\n+}\n+\n+fn fold_fnlist(\n+    fold: fold::fold<ctxt>,\n+    list: doc::fnlist\n+) -> doc::fnlist {\n+    doc::fnlist(vec::filter_map(*list) {|doc|\n+        let doc = fold_fn(fold, doc);\n+        if fold.ctxt.have_docs {\n+            some(doc)\n+        } else {\n+            none\n+        }\n+    })\n+}\n+\n+#[cfg(test)]\n+mod tests {\n+    #[test]\n+    fn should_elide_undocumented_fns() {\n+        let source = \"fn a() { }\";\n+        let srv = astsrv::mk_seq_srv_from_str(source);\n+        let doc = extract::from_srv(srv, \"\");\n+        let doc = run(srv, doc);\n+        assert vec::is_empty(*doc.topmod.fns);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "7d6694e11316c27c26fcddfa283053243fcd9711", "filename": "src/rustdoc/rustdoc.rc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Frustdoc.rc", "raw_url": "https://github.com/rust-lang/rust/raw/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Frustdoc.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Frustdoc.rc?ref=b8840cbee603786107aa627eed4edcfc1c644b93", "patch": "@@ -15,5 +15,6 @@ mod gen;\n mod fold;\n mod attr_pass;\n mod tystr_pass;\n+mod prune_undoc_pass;\n mod astsrv;\n mod util;\n\\ No newline at end of file"}, {"sha": "cb951069e9a83d306eddeda642db232efc10c044", "filename": "src/rustdoc/rustdoc.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Frustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8840cbee603786107aa627eed4edcfc1c644b93/src%2Frustdoc%2Frustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Frustdoc.rs?ref=b8840cbee603786107aa627eed4edcfc1c644b93", "patch": "@@ -77,6 +77,8 @@ fn run(source_file: str) {\n     let doc = extract::from_srv(srv, default_name);\n     let doc = run_passes(srv, doc, [\n         attr_pass::run,\n+        // FIXME: This pass should be optional\n+        prune_undoc_pass::run,\n         tystr_pass::run\n     ]);\n     gen::write_markdown(doc, std::io::stdout());"}]}