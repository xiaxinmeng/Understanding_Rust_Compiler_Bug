{"sha": "d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzZTI0YmQ0NTdkZjJjNzA3ZjBhYzhlMTk0M2VhMzg3MmIxYThiNzM=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-04-22T21:19:20Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-22T21:19:20Z"}, "message": "Rollup merge of #71350 - GuillaumeGomez:error-code-explanation-extra-check, r=oli-obk\n\nError code explanation extra check\n\nr? @Mark-Simulacrum", "tree": {"sha": "b47c60a729093d4a26013f4be7f4135bc8312185", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b47c60a729093d4a26013f4be7f4135bc8312185"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeoLTZCRBK7hj4Ov3rIwAAdHIIABpDdLuQtYMapf4Iue1nGvsX\n1tvVSx4+vN6/SwBfFw0wB3Hj8NVnC/TYa8Ity9dGUvTv1YXEY5ZK5ZmA5n2wVWSX\nY/yL/pgGsFGPHGpnfAQk0au31hnUH0RtGX9mrvIooBXPx/3wuntGSIylxyDZ+1PA\n6UyRX5JiWI3zrQJ5drNtoJPPaOC9n0Nb8d4kbv599ihC5mdKh7xRyIy6l12BQQLF\nbIFE19fufbAWzu44hlhlsClTRC87m8MXT0ifR2w8M42tx3vACzqI+Vc+Mu6kN8Ec\nGBJs04LiNOdK6slNwcxVlQvX6BM7Vi8kbajkZLeymBph1SGb4EIkgPlmQdqGSHA=\n=3xLI\n-----END PGP SIGNATURE-----\n", "payload": "tree b47c60a729093d4a26013f4be7f4135bc8312185\nparent 10e47f5b7b58e1413ddc7cbb3164138c15e9684e\nparent 5cdea2d605f7a43a95935a6bce17176d32fdb51a\nauthor Dylan DPC <dylan.dpc@gmail.com> 1587590360 +0200\ncommitter GitHub <noreply@github.com> 1587590360 +0200\n\nRollup merge of #71350 - GuillaumeGomez:error-code-explanation-extra-check, r=oli-obk\n\nError code explanation extra check\n\nr? @Mark-Simulacrum\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "html_url": "https://github.com/rust-lang/rust/commit/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "10e47f5b7b58e1413ddc7cbb3164138c15e9684e", "url": "https://api.github.com/repos/rust-lang/rust/commits/10e47f5b7b58e1413ddc7cbb3164138c15e9684e", "html_url": "https://github.com/rust-lang/rust/commit/10e47f5b7b58e1413ddc7cbb3164138c15e9684e"}, {"sha": "5cdea2d605f7a43a95935a6bce17176d32fdb51a", "url": "https://api.github.com/repos/rust-lang/rust/commits/5cdea2d605f7a43a95935a6bce17176d32fdb51a", "html_url": "https://github.com/rust-lang/rust/commit/5cdea2d605f7a43a95935a6bce17176d32fdb51a"}], "stats": {"total": 315, "additions": 231, "deletions": 84}, "files": [{"sha": "e6906d72367d8faa346ff943faa9ff69e5f2c18b", "filename": "src/librustc_error_codes/error_codes/E0060.md", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0060.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0060.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0060.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -2,12 +2,14 @@ External C functions are allowed to be variadic. However, a variadic function\n takes a minimum number of arguments. For example, consider C's variadic `printf`\n function:\n \n-```\n+```compile_fail,E0060\n use std::os::raw::{c_char, c_int};\n \n extern \"C\" {\n     fn printf(_: *const c_char, ...) -> c_int;\n }\n+\n+unsafe { printf(); } // error!\n ```\n \n Using this declaration, it must be called with at least one argument, so"}, {"sha": "a270feaf58c17cb44cbfd9f0f08b1036ffb1b2df", "filename": "src/librustc_error_codes/error_codes/E0130.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0130.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0130.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0130.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -2,7 +2,7 @@ A pattern was declared as an argument in a foreign function declaration.\n \n Erroneous code example:\n \n-```compile_fail\n+```compile_fail,E0130\n extern {\n     fn foo((a, b): (u32, u32)); // error: patterns aren't allowed in foreign\n                                 //        function declarations"}, {"sha": "90f1e54287496fb7f32d90af946fd1673811c4db", "filename": "src/librustc_error_codes/error_codes/E0198.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0198.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0198.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0198.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -2,7 +2,7 @@ A negative implementation was marked as unsafe.\n \n Erroneous code example:\n \n-```compile_fail\n+```compile_fail,E0198\n struct Foo;\n \n unsafe impl !Clone for Foo { } // error!"}, {"sha": "afc61ec2e48ff87fc80b0c9733a3c8360f624ccc", "filename": "src/librustc_error_codes/error_codes/E0202.md", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0202.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0202.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0202.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -1,5 +1,15 @@\n Inherent associated types were part of [RFC 195] but are not yet implemented.\n See [the tracking issue][iss8995] for the status of this implementation.\n \n+Erroneous code example:\n+\n+```compile_fail,E0202\n+struct Foo;\n+\n+impl Foo {\n+    type Bar = isize; // error!\n+}\n+```\n+\n [RFC 195]: https://github.com/rust-lang/rfcs/blob/master/text/0195-associated-items.md\n [iss8995]: https://github.com/rust-lang/rust/issues/8995"}, {"sha": "cfb72e74319c1400816441e91bd69c7b66e703e7", "filename": "src/librustc_error_codes/error_codes/E0230.md", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0230.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0230.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0230.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,15 +3,11 @@ message for when a particular trait isn't implemented on a type placed in a\n position that needs that trait. For example, when the following code is\n compiled:\n \n-```compile_fail\n+```compile_fail,E0230\n #![feature(rustc_attrs)]\n \n-fn foo<T: Index<u8>>(x: T){}\n-\n-#[rustc_on_unimplemented = \"the type `{Self}` cannot be indexed by `{Idx}`\"]\n-trait Index<Idx> { /* ... */ }\n-\n-foo(true); // `bool` does not implement `Index<u8>`\n+#[rustc_on_unimplemented = \"error on `{Self}` with params `<{A},{B}>`\"] // error\n+trait BadAnnotation<A> {}\n ```\n \n There will be an error about `bool` not implementing `Index<u8>`, followed by a"}, {"sha": "23a0a88ecdd9baf599d8fd58a05fd3f4544071ff", "filename": "src/librustc_error_codes/error_codes/E0231.md", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0231.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0231.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0231.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,15 +3,11 @@ message for when a particular trait isn't implemented on a type placed in a\n position that needs that trait. For example, when the following code is\n compiled:\n \n-```compile_fail\n+```compile_fail,E0231\n #![feature(rustc_attrs)]\n \n-fn foo<T: Index<u8>>(x: T){}\n-\n-#[rustc_on_unimplemented = \"the type `{Self}` cannot be indexed by `{Idx}`\"]\n-trait Index<Idx> { /* ... */ }\n-\n-foo(true); // `bool` does not implement `Index<u8>`\n+#[rustc_on_unimplemented = \"error on `{Self}` with params `<{A},{}>`\"] // error!\n+trait BadAnnotation<A> {}\n ```\n \n there will be an error about `bool` not implementing `Index<u8>`, followed by a"}, {"sha": "b310caefa6e31165b4a3843a6c046868bd443c65", "filename": "src/librustc_error_codes/error_codes/E0232.md", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0232.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0232.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0232.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,15 +3,11 @@ message for when a particular trait isn't implemented on a type placed in a\n position that needs that trait. For example, when the following code is\n compiled:\n \n-```compile_fail\n+```compile_fail,E0232\n #![feature(rustc_attrs)]\n \n-fn foo<T: Index<u8>>(x: T){}\n-\n-#[rustc_on_unimplemented = \"the type `{Self}` cannot be indexed by `{Idx}`\"]\n-trait Index<Idx> { /* ... */ }\n-\n-foo(true); // `bool` does not implement `Index<u8>`\n+#[rustc_on_unimplemented(lorem=\"\")] // error!\n+trait BadAnnotation {}\n ```\n \n there will be an error about `bool` not implementing `Index<u8>`, followed by a"}, {"sha": "1d7904b67ddb4b75f3142e4943f477903587ae69", "filename": "src/librustc_error_codes/error_codes/E0281.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0281.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0281.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0281.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -4,7 +4,7 @@ You tried to supply a type which doesn't implement some trait in a location\n which expected that trait. This error typically occurs when working with\n `Fn`-based types. Erroneous code example:\n \n-```compile-fail\n+```compile_fail\n fn foo<F: Fn(usize)>(x: F) { }\n \n fn main() {"}, {"sha": "d01fb0c9c4229427a140311d2165c54415435487", "filename": "src/librustc_error_codes/error_codes/E0364.md", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0364.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0364.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0364.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,27 +3,27 @@ attempted to `pub use` a type or value that was not itself public.\n \n Erroneous code example:\n \n-```compile_fail\n-mod foo {\n-    const X: u32 = 1;\n-}\n-\n-pub use foo::X;\n+```compile_fail,E0364\n+mod a {\n+    fn foo() {}\n \n-fn main() {}\n+    mod a {\n+        pub use super::foo; // error!\n+    }\n+}\n ```\n \n The solution to this problem is to ensure that the items that you are\n re-exporting are themselves marked with `pub`:\n \n ```\n-mod foo {\n-    pub const X: u32 = 1;\n-}\n-\n-pub use foo::X;\n+mod a {\n+    pub fn foo() {} // ok!\n \n-fn main() {}\n+    mod a {\n+        pub use super::foo;\n+    }\n+}\n ```\n \n See the [Use Declarations][use-declarations] section of the reference for"}, {"sha": "c6fe997f3dcfc8443d4b551b77f31229bd16a890", "filename": "src/librustc_error_codes/error_codes/E0378.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0378.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0378.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0378.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,7 +3,7 @@ or a newtype wrapper around a pointer.\n \n Erroneous code example:\n \n-```compile-fail,E0378\n+```compile_fail,E0378\n #![feature(dispatch_from_dyn)]\n use std::ops::DispatchFromDyn;\n "}, {"sha": "df7aa4f0a1e8dd3c3ff35d203701ba401dfc07e6", "filename": "src/librustc_error_codes/error_codes/E0590.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0590.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0590.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0590.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,7 +3,7 @@\n \n Example of erroneous code:\n \n-```compile_fail\n+```compile_fail,E0590\n while break {}\n ```\n "}, {"sha": "4646e37fb752632e69aa9e02e6479acee83b5a8e", "filename": "src/librustc_error_codes/error_codes/E0639.md", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0639.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0639.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0639.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,5 +3,17 @@ instantiated from outside of the defining crate as it has been marked\n as `non_exhaustive` and as such more fields/variants may be added in\n future that could cause adverse side effects for this code.\n \n+Erroneous code example:\n+\n+```ignore (it only works cross-crate)\n+#[non_exhaustive]\n+pub struct NormalStruct {\n+    pub first_field: u16,\n+    pub second_field: u16,\n+}\n+\n+let ns = NormalStruct { first_field: 640, second_field: 480 }; // error!\n+```\n+\n It is recommended that you look for a `new` function or equivalent in the\n crate's documentation."}, {"sha": "277643dfb1ab7d7ddffa4c2d861f590454c87976", "filename": "src/librustc_error_codes/error_codes/E0644.md", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0644.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0644.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0644.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -2,17 +2,17 @@ A closure or generator was constructed that references its own type.\n \n Erroneous example:\n \n-```compile-fail,E0644\n+```compile_fail,E0644\n fn fix<F>(f: &F)\n   where F: Fn(&F)\n {\n-  f(&f);\n+    f(&f);\n }\n \n fn main() {\n-  fix(&|y| {\n-    // Here, when `x` is called, the parameter `y` is equal to `x`.\n-  });\n+    fix(&|y| {\n+        // Here, when `x` is called, the parameter `y` is equal to `x`.\n+    });\n }\n ```\n "}, {"sha": "d821b9027f1363a6f9f86f14ec6c799e30db2c13", "filename": "src/librustc_error_codes/error_codes/E0658.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0658.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0658.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0658.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -2,7 +2,7 @@ An unstable feature was used.\n \n Erroneous code example:\n \n-```compile_fail,E658\n+```compile_fail,E0658\n #[repr(u128)] // error: use of unstable library feature 'repr128'\n enum Foo {\n     Bar(u64),"}, {"sha": "f078c441b342190c61b9dd4ab042a746718a8029", "filename": "src/librustc_error_codes/error_codes/E0669.md", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0669.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0669.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0669.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -1,5 +1,17 @@\n Cannot convert inline assembly operand to a single LLVM value.\n \n+Erroneous code example:\n+\n+```compile_fail,E0669\n+#![feature(llvm_asm)]\n+\n+fn main() {\n+    unsafe {\n+        llvm_asm!(\"\" :: \"r\"(\"\")); // error!\n+    }\n+}\n+```\n+\n This error usually happens when trying to pass in a value to an input inline\n assembly operand that is actually a pair of values. In particular, this can\n happen when trying to pass in a slice, for instance a `&str`. In Rust, these"}, {"sha": "3ba992a8476eda588872ef0ca9557a68afdc1754", "filename": "src/librustc_error_codes/error_codes/E0698.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0698.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0698.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0698.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,7 +3,7 @@ generator can be constructed.\n \n Erroneous code example:\n \n-```edition2018,compile-fail,E0698\n+```edition2018,compile_fail,E0698\n async fn bar<T>() -> () {}\n \n async fn foo() {"}, {"sha": "b1eb8b66ad682cf165a86d7323061340499669d9", "filename": "src/librustc_error_codes/error_codes/E0700.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0700.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0700.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0700.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,7 +3,7 @@ appear within the `impl Trait` itself.\n \n Erroneous code example:\n \n-```compile-fail,E0700\n+```compile_fail,E0700\n use std::cell::Cell;\n \n trait Trait<'a> { }"}, {"sha": "9287fc803d1de792ae03a81c932af0ad217933a1", "filename": "src/librustc_error_codes/error_codes/E0708.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0708.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0708.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0708.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -2,7 +2,7 @@\n \n Erroneous code example:\n \n-```compile_fail,edition2018\n+```compile_fail,edition2018,E0708\n #![feature(async_closure)]\n \n fn main() {"}, {"sha": "45d1cafa690624a0e49bf753cabfe4695d86e94d", "filename": "src/librustc_error_codes/error_codes/E0714.md", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0714.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0714.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0714.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -1,5 +1,19 @@\n A `#[marker]` trait contained an associated item.\n \n+Erroneous code example:\n+\n+```compile_fail,E0714\n+#![feature(marker_trait_attr)]\n+#![feature(associated_type_defaults)]\n+\n+#[marker]\n+trait MarkerConst {\n+    const N: usize; // error!\n+}\n+\n+fn main() {}\n+```\n+\n The items of marker traits cannot be overridden, so there's no need to have them\n when they cannot be changed per-type anyway.  If you wanted them for ergonomic\n reasons, consider making an extension trait instead."}, {"sha": "8f0022d9425471de4ef3357962e6f5620bdd9865", "filename": "src/librustc_error_codes/error_codes/E0715.md", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0715.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0715.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0715.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -1,5 +1,24 @@\n An `impl` for a `#[marker]` trait tried to override an associated item.\n \n+Erroneous code example:\n+\n+```compile_fail,E0715\n+#![feature(marker_trait_attr)]\n+\n+#[marker]\n+trait Marker {\n+    const N: usize = 0;\n+    fn do_something() {}\n+}\n+\n+struct OverrideConst;\n+impl Marker for OverrideConst { // error!\n+    const N: usize = 1;\n+}\n+\n+fn main() {}\n+```\n+\n Because marker traits are allowed to have multiple implementations for the same\n type, it's not allowed to override anything in those implementations, as it\n would be ambiguous which override should actually be used."}, {"sha": "be1b68e645d012ca3223c1627a8b5f3fe01d40ae", "filename": "src/librustc_error_codes/error_codes/E0727.md", "status": "modified", "additions": 14, "deletions": 10, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0727.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0727.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0727.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -2,25 +2,29 @@ A `yield` clause was used in an `async` context.\n \n Example of erroneous code:\n \n-```compile_fail\n+```compile_fail,E0727,edition2018\n #![feature(generators)]\n \n-let generator = || {\n-    async {\n-        yield;\n-    }\n-};\n+fn main() {\n+    let generator = || {\n+        async {\n+            yield;\n+        }\n+    };\n+}\n ```\n \n Here, the `yield` keyword is used in an `async` block,\n which is not yet supported.\n \n To fix this error, you have to move `yield` out of the `async` block:\n \n-```\n+```edition2018\n #![feature(generators)]\n \n-let generator = || {\n-    yield;\n-};\n+fn main() {\n+    let generator = || {\n+        yield;\n+    };\n+}\n ```"}, {"sha": "7347e6654c5b3acd99a55085d01791edebdd22b7", "filename": "src/librustc_error_codes/error_codes/E0732.md", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0732.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0732.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0732.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -1,5 +1,18 @@\n An `enum` with a discriminant must specify a `#[repr(inttype)]`.\n \n+Erroneous code example:\n+\n+```compile_fail,E0732\n+#![feature(arbitrary_enum_discriminant)]\n+\n+enum Enum { // error!\n+    Unit = 1,\n+    Tuple() = 2,\n+    Struct{} = 3,\n+}\n+# fn main() {}\n+```\n+\n A `#[repr(inttype)]` must be provided on an `enum` if it has a non-unit\n variant with a discriminant, or where there are both unit variants with\n discriminants and non-unit variants. This restriction ensures that there\n@@ -23,7 +36,9 @@ fn discriminant(v : &Enum) -> u8 {\n     unsafe { *(v as *const Enum as *const u8) }\n }\n \n-assert_eq!(3, discriminant(&Enum::Unit));\n-assert_eq!(2, discriminant(&Enum::Tuple(5)));\n-assert_eq!(1, discriminant(&Enum::Struct{a: 7, b: 11}));\n+fn main() {\n+    assert_eq!(3, discriminant(&Enum::Unit));\n+    assert_eq!(2, discriminant(&Enum::Tuple(5)));\n+    assert_eq!(1, discriminant(&Enum::Struct{a: 7, b: 11}));\n+}\n ```"}, {"sha": "37776785189643880ea89fd18f6f6af256ad22e6", "filename": "src/librustc_error_codes/error_codes/E0740.md", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0740.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0740.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0740.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -1 +1,16 @@\n A `union` cannot have fields with destructors.\n+\n+Erroneous code example:\n+\n+```compile_fail,E0740\n+union Test {\n+    a: A, // error!\n+}\n+\n+#[derive(Debug)]\n+struct A(i32);\n+\n+impl Drop for A {\n+    fn drop(&mut self) { println!(\"A\"); }\n+}\n+```"}, {"sha": "56b947a8282edb585ee2416f4e96426e5478d7af", "filename": "src/librustc_error_codes/error_codes/E0744.md", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0744.md", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Flibrustc_error_codes%2Ferror_codes%2FE0744.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0744.md?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -3,16 +3,13 @@ Control-flow expressions are not allowed inside a const context.\n At the moment, `if` and `match`, as well as the looping constructs `for`,\n `while`, and `loop`, are forbidden inside a `const`, `static`, or `const fn`.\n \n-```compile_fail,E0658\n+```compile_fail,E0744\n const _: i32 = {\n     let mut x = 0;\n-    loop {\n-        x += 1;\n-        if x == 4 {\n-            break;\n-        }\n+\n+    for i in 0..4 { // error!\n+        x += i;\n     }\n-    x\n };\n ```\n "}, {"sha": "243d41598f86c739dba3941f668a42e75e47f9f1", "filename": "src/tools/tidy/src/error_codes_check.rs", "status": "modified", "additions": 74, "deletions": 15, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Ftools%2Ftidy%2Fsrc%2Ferror_codes_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3e24bd457df2c707f0ac8e1943ea3872b1a8b73/src%2Ftools%2Ftidy%2Fsrc%2Ferror_codes_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ferror_codes_check.rs?ref=d3e24bd457df2c707f0ac8e1943ea3872b1a8b73", "patch": "@@ -15,21 +15,57 @@ const WHITELIST: &[&str] = &[\n     \"E0727\", \"E0729\",\n ];\n \n+// Some error codes don't have any tests apparently...\n+const IGNORE_EXPLANATION_CHECK: &[&str] =\n+    &[\"E0570\", \"E0601\", \"E0602\", \"E0639\", \"E0729\", \"E0749\", \"E0750\", \"E0751\"];\n+\n fn check_error_code_explanation(\n     f: &str,\n     error_codes: &mut HashMap<String, bool>,\n     err_code: String,\n-) {\n+) -> bool {\n+    let mut invalid_compile_fail_format = false;\n+    let mut found_error_code = false;\n+\n     for line in f.lines() {\n         let s = line.trim();\n-        if s.starts_with(\"```\") && s.contains(\"compile_fail\") && s.contains('E') {\n-            error_codes.insert(err_code, true);\n-            return;\n+        if s.starts_with(\"```\") {\n+            if s.contains(\"compile_fail\") && s.contains('E') {\n+                if !found_error_code {\n+                    error_codes.insert(err_code.clone(), true);\n+                    found_error_code = true;\n+                }\n+            } else if s.contains(\"compile-fail\") {\n+                invalid_compile_fail_format = true;\n+            }\n         } else if s.starts_with(\"#### Note: this error code is no longer emitted by the compiler\") {\n-            error_codes.get_mut(&err_code).map(|x| *x = true);\n-            return;\n+            if !found_error_code {\n+                error_codes.get_mut(&err_code).map(|x| *x = true);\n+                found_error_code = true;\n+            }\n         }\n     }\n+    invalid_compile_fail_format\n+}\n+\n+fn check_if_error_code_is_test_in_explanation(f: &str, err_code: &String) -> bool {\n+    let mut can_be_ignored = false;\n+\n+    for line in f.lines() {\n+        let s = line.trim();\n+        if s.starts_with(\"#### Note: this error code is no longer emitted by the compiler\") {\n+            return true;\n+        }\n+        if s.starts_with(\"```\") {\n+            if s.contains(\"compile_fail\") && s.contains(err_code) {\n+                return true;\n+            } else if s.contains(\"(\") {\n+                // It's very likely that we can't actually make it fail compilation...\n+                can_be_ignored = true;\n+            }\n+        }\n+    }\n+    can_be_ignored\n }\n \n macro_rules! some_or_continue {\n@@ -41,7 +77,12 @@ macro_rules! some_or_continue {\n     };\n }\n \n-fn extract_error_codes(f: &str, error_codes: &mut HashMap<String, bool>, path: &Path) {\n+fn extract_error_codes(\n+    f: &str,\n+    error_codes: &mut HashMap<String, bool>,\n+    path: &Path,\n+    errors: &mut Vec<String>,\n+) {\n     let mut reached_no_explanation = false;\n \n     for line in f.lines() {\n@@ -55,10 +96,26 @@ fn extract_error_codes(f: &str, error_codes: &mut HashMap<String, bool>, path: &\n                 // Now we extract the tests from the markdown file!\n                 let md = some_or_continue!(s.splitn(2, \"include_str!(\\\"\").nth(1));\n                 let md_file_name = some_or_continue!(md.splitn(2, \"\\\")\").next());\n-                let path = some_or_continue!(path.parent()).join(md_file_name);\n+                let path = some_or_continue!(path.parent())\n+                    .join(md_file_name)\n+                    .canonicalize()\n+                    .expect(\"failed to canonicalize error explanation file path\");\n                 match read_to_string(&path) {\n                     Ok(content) => {\n-                        check_error_code_explanation(&content, error_codes, err_code);\n+                        if !IGNORE_EXPLANATION_CHECK.contains(&err_code.as_str())\n+                            && !check_if_error_code_is_test_in_explanation(&content, &err_code)\n+                        {\n+                            errors.push(format!(\n+                                \"`{}` doesn't use its own error code in compile_fail example\",\n+                                path.display(),\n+                            ));\n+                        }\n+                        if check_error_code_explanation(&content, error_codes, err_code) {\n+                            errors.push(format!(\n+                                \"`{}` uses invalid tag `compile-fail` instead of `compile_fail`\",\n+                                path.display(),\n+                            ));\n+                        }\n                     }\n                     Err(e) => {\n                         eprintln!(\"Couldn't read `{}`: {}\", path.display(), e);\n@@ -94,22 +151,24 @@ fn extract_error_codes_from_tests(f: &str, error_codes: &mut HashMap<String, boo\n }\n \n pub fn check(path: &Path, bad: &mut bool) {\n+    let mut errors = Vec::new();\n     println!(\"Checking which error codes lack tests...\");\n     let mut error_codes: HashMap<String, bool> = HashMap::new();\n     super::walk(path, &mut |path| super::filter_dirs(path), &mut |entry, contents| {\n         let file_name = entry.file_name();\n         if file_name == \"error_codes.rs\" {\n-            extract_error_codes(contents, &mut error_codes, entry.path());\n+            extract_error_codes(contents, &mut error_codes, entry.path(), &mut errors);\n         } else if entry.path().extension() == Some(OsStr::new(\"stderr\")) {\n             extract_error_codes_from_tests(contents, &mut error_codes);\n         }\n     });\n-    println!(\"Found {} error codes\", error_codes.len());\n+    if errors.is_empty() {\n+        println!(\"Found {} error codes\", error_codes.len());\n \n-    let mut errors = Vec::new();\n-    for (err_code, nb) in &error_codes {\n-        if !*nb && !WHITELIST.contains(&err_code.as_str()) {\n-            errors.push(format!(\"Error code {} needs to have at least one UI test!\", err_code));\n+        for (err_code, nb) in &error_codes {\n+            if !*nb && !WHITELIST.contains(&err_code.as_str()) {\n+                errors.push(format!(\"Error code {} needs to have at least one UI test!\", err_code));\n+            }\n         }\n     }\n     errors.sort();"}]}