{"sha": "3431312418ea255e98d3f94536344d396b9b07d6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0MzEzMTI0MThlYTI1NWU5OGQzZjk0NTM2MzQ0ZDM5NmI5YjA3ZDY=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-04-05T15:23:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-05T15:23:10Z"}, "message": "Merge #3857\n\n3857: Fix inference of function pointer return types r=flodiebold a=lnicola\n\nFixes #3852.\r\n\r\nr? @flodiebold\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "9c27eb88a68fceade7480ac83b1ba271c8e1f6f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c27eb88a68fceade7480ac83b1ba271c8e1f6f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3431312418ea255e98d3f94536344d396b9b07d6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeiffeCRBK7hj4Ov3rIwAAdHIIAGak9KwNrEsZEh4gWluKi3Se\ntSBPoJmGNTPtwwzLKlB8khteYgRzXD6Sev/b5y2oDmjebCxEvNGdr92Zjsq42Gvh\nFWgo8HVC3g8JdjxywgoH3sSs4uk0X3G9QKjXq69YfsSSLsszEgyyoVsWKu1AQ0oK\n8+ivenCNZ5RJCeuGteYh9E+Y3mcgQHrLGLd60pdbbZKAyX5RiqeUH28TosikEiWv\nt5GigdOxwyx0R7Znkk/SXCuBpU/3aa8xlIcFQYee1fpK5dE2+w5TfJbm9rV4EO/y\niMFuqfLr6EoOCD8l7/dYKeYK6TdLv0OUGDcJJkm2mdx2B21yp1t+9iVQ7YNMnYk=\n=e0kE\n-----END PGP SIGNATURE-----\n", "payload": "tree 9c27eb88a68fceade7480ac83b1ba271c8e1f6f0\nparent e300e1e8d8f4de273d52fa62762ed14e8a7f96bb\nparent b58a7f41f14f56375c602911be768d40cf46de04\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1586100190 +0000\ncommitter GitHub <noreply@github.com> 1586100190 +0000\n\nMerge #3857\n\n3857: Fix inference of function pointer return types r=flodiebold a=lnicola\n\nFixes #3852.\r\n\r\nr? @flodiebold\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3431312418ea255e98d3f94536344d396b9b07d6", "html_url": "https://github.com/rust-lang/rust/commit/3431312418ea255e98d3f94536344d396b9b07d6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3431312418ea255e98d3f94536344d396b9b07d6/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e300e1e8d8f4de273d52fa62762ed14e8a7f96bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/e300e1e8d8f4de273d52fa62762ed14e8a7f96bb", "html_url": "https://github.com/rust-lang/rust/commit/e300e1e8d8f4de273d52fa62762ed14e8a7f96bb"}, {"sha": "b58a7f41f14f56375c602911be768d40cf46de04", "url": "https://api.github.com/repos/rust-lang/rust/commits/b58a7f41f14f56375c602911be768d40cf46de04", "html_url": "https://github.com/rust-lang/rust/commit/b58a7f41f14f56375c602911be768d40cf46de04"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "01cc392db02709ad5d445f42e1da374e5a32feda", "filename": "crates/ra_hir_def/src/type_ref.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3431312418ea255e98d3f94536344d396b9b07d6/crates%2Fra_hir_def%2Fsrc%2Ftype_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3431312418ea255e98d3f94536344d396b9b07d6/crates%2Fra_hir_def%2Fsrc%2Ftype_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Ftype_ref.rs?ref=3431312418ea255e98d3f94536344d396b9b07d6", "patch": "@@ -93,7 +93,11 @@ impl TypeRef {\n             }\n             ast::TypeRef::PlaceholderType(_inner) => TypeRef::Placeholder,\n             ast::TypeRef::FnPointerType(inner) => {\n-                let ret_ty = TypeRef::from_ast_opt(inner.ret_type().and_then(|rt| rt.type_ref()));\n+                let ret_ty = inner\n+                    .ret_type()\n+                    .and_then(|rt| rt.type_ref())\n+                    .map(TypeRef::from_ast)\n+                    .unwrap_or_else(|| TypeRef::Tuple(Vec::new()));\n                 let mut params = if let Some(pl) = inner.param_list() {\n                     pl.params().map(|p| p.ascribed_type()).map(TypeRef::from_ast_opt).collect()\n                 } else {"}, {"sha": "141f0245aa0868952dd613c4f453e598c9636e25", "filename": "crates/ra_hir_ty/src/tests/simple.rs", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3431312418ea255e98d3f94536344d396b9b07d6/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3431312418ea255e98d3f94536344d396b9b07d6/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs?ref=3431312418ea255e98d3f94536344d396b9b07d6", "patch": "@@ -1729,3 +1729,29 @@ fn foo() -> u32 {\n     \"###\n     );\n }\n+\n+#[test]\n+fn fn_pointer_return() {\n+    assert_snapshot!(\n+        infer(r#\"\n+struct Vtable {\n+    method: fn(),\n+}\n+\n+fn main() {\n+    let vtable = Vtable { method: || {} };\n+    let m = vtable.method;\n+}\n+\"#),\n+        @r###\"\n+    [48; 121) '{     ...hod; }': ()\n+    [58; 64) 'vtable': Vtable\n+    [67; 91) 'Vtable...| {} }': Vtable\n+    [84; 89) '|| {}': || -> ()\n+    [87; 89) '{}': ()\n+    [101; 102) 'm': fn() -> ()\n+    [105; 111) 'vtable': Vtable\n+    [105; 118) 'vtable.method': fn() -> ()\n+    \"###\n+    );\n+}"}]}