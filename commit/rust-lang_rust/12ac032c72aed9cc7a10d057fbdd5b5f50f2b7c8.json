{"sha": "12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyYWMwMzJjNzJhZWQ5Y2M3YTEwZDA1N2ZiZGQ1YjVmNTBmMmI3Yzg=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-03-10T21:18:05Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-03-14T09:32:53Z"}, "message": "Implement import renaming with `_` (RFC 2166)", "tree": {"sha": "4f6dbe5e034b39893c39b1dbb233f1181312695c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f6dbe5e034b39893c39b1dbb233f1181312695c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "html_url": "https://github.com/rust-lang/rust/commit/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fab632f9759af4f3d96c6ec69e24e5428060dba4", "url": "https://api.github.com/repos/rust-lang/rust/commits/fab632f9759af4f3d96c6ec69e24e5428060dba4", "html_url": "https://github.com/rust-lang/rust/commit/fab632f9759af4f3d96c6ec69e24e5428060dba4"}], "stats": {"total": 154, "additions": 153, "deletions": 1}, "files": [{"sha": "61fa78b1d5751f826282e7c3aada68a701ae82ba", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "patch": "@@ -455,6 +455,9 @@ declare_features! (\n \n     // Parentheses in patterns\n     (active, pattern_parentheses, \"1.26.0\", None, None),\n+\n+    // `use path as _;` and `extern crate c as _;`\n+    (active, underscore_imports, \"1.26.0\", Some(48216), None),\n );\n \n declare_features! (\n@@ -1436,9 +1439,24 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n         }\n     }\n \n+    fn visit_use_tree(&mut self, use_tree: &'a ast::UseTree, id: NodeId, _nested: bool) {\n+        if let ast::UseTreeKind::Simple(ident) = use_tree.kind {\n+            if ident.name == \"_\" {\n+                gate_feature_post!(&self, underscore_imports, use_tree.span,\n+                                   \"renaming imports with `_` is unstable\");\n+            }\n+        }\n+\n+        visit::walk_use_tree(self, use_tree, id);\n+    }\n+\n     fn visit_item(&mut self, i: &'a ast::Item) {\n         match i.node {\n             ast::ItemKind::ExternCrate(_) => {\n+                if i.ident.name == \"_\" {\n+                    gate_feature_post!(&self, underscore_imports, i.span,\n+                                       \"renaming extern crates with `_` is unstable\");\n+                }\n                 if let Some(attr) = attr::find_by_name(&i.attrs[..], \"macro_reexport\") {\n                     gate_feature_post!(&self, macro_reexport, attr.span,\n                                        \"macros re-exports are experimental \\"}, {"sha": "2506a7f72d22b4c38b12595fca96f91253e2770f", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "patch": "@@ -7040,7 +7040,11 @@ impl<'a> Parser<'a> {\n \n     fn parse_rename(&mut self) -> PResult<'a, Option<Ident>> {\n         if self.eat_keyword(keywords::As) {\n-            self.parse_ident().map(Some)\n+            if self.eat(&token::Underscore) {\n+                Ok(Some(Ident::with_empty_ctxt(Symbol::gensym(\"_\"))))\n+            } else {\n+                self.parse_ident().map(Some)\n+            }\n         } else {\n             Ok(None)\n         }"}, {"sha": "ceb8afe124a8cbdddf53256c42325163073fc73b", "filename": "src/test/ui/feature-gate-underscore-imports.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Ffeature-gate-underscore-imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Ffeature-gate-underscore-imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate-underscore-imports.rs?ref=12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+extern crate std as _; //~ ERROR renaming extern crates with `_` is unstable\n+use std::vec as _; //~ ERROR renaming imports with `_` is unstable\n+\n+fn main() {}"}, {"sha": "2eea95260d5e590de18b18a0f95238c3231febe6", "filename": "src/test/ui/feature-gate-underscore-imports.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Ffeature-gate-underscore-imports.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Ffeature-gate-underscore-imports.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate-underscore-imports.stderr?ref=12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "patch": "@@ -0,0 +1,19 @@\n+error[E0658]: renaming extern crates with `_` is unstable (see issue #48216)\n+  --> $DIR/feature-gate-underscore-imports.rs:11:1\n+   |\n+LL | extern crate std as _; //~ ERROR renaming extern crates with `_` is unstable\n+   | ^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: add #![feature(underscore_imports)] to the crate attributes to enable\n+\n+error[E0658]: renaming imports with `_` is unstable (see issue #48216)\n+  --> $DIR/feature-gate-underscore-imports.rs:12:5\n+   |\n+LL | use std::vec as _; //~ ERROR renaming imports with `_` is unstable\n+   |     ^^^^^^^^^^^^^\n+   |\n+   = help: add #![feature(underscore_imports)] to the crate attributes to enable\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0658`."}, {"sha": "06651a71d0c00bb16ddfb9f880616736e91641d3", "filename": "src/test/ui/rfc-2166-underscore-imports/basic.rs", "status": "added", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.rs?ref=12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "patch": "@@ -0,0 +1,67 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// must-compile-successfully\n+\n+#![feature(underscore_imports)]\n+#![warn(unused_imports, unused_extern_crates)]\n+\n+struct S;\n+\n+mod m {\n+    pub trait Tr1 {\n+        fn tr1_is_in_scope(&self) {}\n+    }\n+    pub trait Tr2 {\n+        fn tr2_is_in_scope(&self) {}\n+    }\n+\n+    impl Tr1 for ::S {}\n+    impl Tr2 for ::S {}\n+}\n+\n+mod unused {\n+    use m::Tr1 as _; //~ WARN unused import\n+    use S as _; //~ WARN unused import\n+    extern crate core as _; //~ WARN unused extern crate\n+}\n+\n+mod outer {\n+    mod middle {\n+        pub use m::Tr1 as _;\n+        pub use m::Tr2 as _; // OK, no name conflict\n+        struct Tr1; // OK, no name conflict\n+        fn check() {\n+            // Both traits are in scope\n+            ::S.tr1_is_in_scope();\n+            ::S.tr2_is_in_scope();\n+        }\n+\n+        mod inner {\n+            // `_` imports are fetched by glob imports\n+            use super::*;\n+            fn check() {\n+                // Both traits are in scope\n+                ::S.tr1_is_in_scope();\n+                ::S.tr2_is_in_scope();\n+            }\n+        }\n+    }\n+\n+    // `_` imports are fetched by glob imports\n+    use self::middle::*;\n+    fn check() {\n+        // Both traits are in scope\n+        ::S.tr1_is_in_scope();\n+        ::S.tr2_is_in_scope();\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "4530d0fa604aa8721604ece3e254b69fd0794f48", "filename": "src/test/ui/rfc-2166-underscore-imports/basic.stderr", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.stderr?ref=12ac032c72aed9cc7a10d057fbdd5b5f50f2b7c8", "patch": "@@ -0,0 +1,30 @@\n+warning: unused import: `m::Tr1 as _`\n+  --> $DIR/basic.rs:31:9\n+   |\n+LL |     use m::Tr1 as _; //~ WARN unused import\n+   |         ^^^^^^^^^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/basic.rs:14:9\n+   |\n+LL | #![warn(unused_imports, unused_extern_crates)]\n+   |         ^^^^^^^^^^^^^^\n+\n+warning: unused import: `S as _`\n+  --> $DIR/basic.rs:32:9\n+   |\n+LL |     use S as _; //~ WARN unused import\n+   |         ^^^^^^\n+\n+warning: unused extern crate\n+  --> $DIR/basic.rs:33:5\n+   |\n+LL |     extern crate core as _; //~ WARN unused extern crate\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/basic.rs:14:25\n+   |\n+LL | #![warn(unused_imports, unused_extern_crates)]\n+   |                         ^^^^^^^^^^^^^^^^^^^^\n+"}]}