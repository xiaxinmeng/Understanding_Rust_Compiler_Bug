{"sha": "e2dcc28d3c64a3f8f4797132420685e2b26fe05b", "node_id": "C_kwDOAAsO6NoAKGUyZGNjMjhkM2M2NGEzZjhmNDc5NzEzMjQyMDY4NWUyYjI2ZmUwNWI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-19T14:35:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-19T14:35:22Z"}, "message": "Rollup merge of #104577 - GuillaumeGomez:remove-focus-on-blur, r=notriddle\n\nDon't focus on notable trait parent when hiding it\n\nI clicked on a notable trait icon so the popup remained and then clicked on the settings menu. When the settings menu was blurred, it scrolled back to when the notable trait was, which isn't great.\n\nr? `@notriddle`", "tree": {"sha": "688d5e7345e68b65df9c6a3a331253ad016084ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/688d5e7345e68b65df9c6a3a331253ad016084ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e2dcc28d3c64a3f8f4797132420685e2b26fe05b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjeOmqCRBK7hj4Ov3rIwAAwFUIABSrU1KYP6VI5qeV3lyzGSEB\nCLy/8BLt+0YSr6wtz19ofRd9cRwJUzCVdK4NioKtQOg8ZTZKllYUcULK5yECYqU2\ncVmDUKbqQYMpv1Vj3hGIjmbZI+ElVnhMFjy/EEz2xQPVBSTa2tK662/M9XGleil9\nr211BSBFhQ4t0o7CcrGNzH9Dd6GNyPvpUAR4iRhUWiCSF3jZYDCHVcWHn3qq2wpL\nw+0E+wMlklp9+SvojIzGSKWkd2H9c4+4amxWzuEdQVpyoWJ5dDn3yuXMnx9gW1Z/\nJvElSwq0eDdAy3hZCxQjQURGmmdXN1RMtvEUyc9E55EZ/mPkbPNAlnT/tPRHOwU=\n=rxP/\n-----END PGP SIGNATURE-----\n", "payload": "tree 688d5e7345e68b65df9c6a3a331253ad016084ea\nparent e86f1845ff6ca556621e2d366a6ad0c2d5aa408f\nparent 5ed8dca7212c25a5557dc249037ec0c8b271c7b6\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1668868522 +0100\ncommitter GitHub <noreply@github.com> 1668868522 +0100\n\nRollup merge of #104577 - GuillaumeGomez:remove-focus-on-blur, r=notriddle\n\nDon't focus on notable trait parent when hiding it\n\nI clicked on a notable trait icon so the popup remained and then clicked on the settings menu. When the settings menu was blurred, it scrolled back to when the notable trait was, which isn't great.\n\nr? `@notriddle`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e2dcc28d3c64a3f8f4797132420685e2b26fe05b", "html_url": "https://github.com/rust-lang/rust/commit/e2dcc28d3c64a3f8f4797132420685e2b26fe05b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e2dcc28d3c64a3f8f4797132420685e2b26fe05b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e86f1845ff6ca556621e2d366a6ad0c2d5aa408f", "url": "https://api.github.com/repos/rust-lang/rust/commits/e86f1845ff6ca556621e2d366a6ad0c2d5aa408f", "html_url": "https://github.com/rust-lang/rust/commit/e86f1845ff6ca556621e2d366a6ad0c2d5aa408f"}, {"sha": "5ed8dca7212c25a5557dc249037ec0c8b271c7b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ed8dca7212c25a5557dc249037ec0c8b271c7b6", "html_url": "https://github.com/rust-lang/rust/commit/5ed8dca7212c25a5557dc249037ec0c8b271c7b6"}], "stats": {"total": 52, "additions": 42, "deletions": 10}, "files": [{"sha": "3f8dcd03d2db1e396fd994bd43521c76473f02bd", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-tools/browser-ui-test.version", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e2dcc28d3c64a3f8f4797132420685e2b26fe05b/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2Fbrowser-ui-test.version", "raw_url": "https://github.com/rust-lang/rust/raw/e2dcc28d3c64a3f8f4797132420685e2b26fe05b/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2Fbrowser-ui-test.version", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2Fbrowser-ui-test.version?ref=e2dcc28d3c64a3f8f4797132420685e2b26fe05b", "patch": "@@ -1 +1 @@\n-0.13.1\n\\ No newline at end of file\n+0.13.2\n\\ No newline at end of file"}, {"sha": "75b3dce2eda86bd4a133e259a89ffa0fd1f49401", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e2dcc28d3c64a3f8f4797132420685e2b26fe05b/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/e2dcc28d3c64a3f8f4797132420685e2b26fe05b/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=e2dcc28d3c64a3f8f4797132420685e2b26fe05b", "patch": "@@ -795,7 +795,7 @@ function loadCss(cssUrl) {\n             // This means when the window is resized, we need to redo the layout.\n             const base = window.CURRENT_NOTABLE_ELEMENT.NOTABLE_BASE;\n             const force_visible = base.NOTABLE_FORCE_VISIBLE;\n-            hideNotable();\n+            hideNotable(false);\n             if (force_visible) {\n                 showNotable(base);\n                 base.NOTABLE_FORCE_VISIBLE = true;\n@@ -846,7 +846,7 @@ function loadCss(cssUrl) {\n             // Make this function idempotent.\n             return;\n         }\n-        hideNotable();\n+        hideNotable(false);\n         const ty = e.getAttribute(\"data-ty\");\n         const wrapper = document.createElement(\"div\");\n         wrapper.innerHTML = \"<div class=\\\"docblock\\\">\" + window.NOTABLE_TRAITS[ty] + \"</div>\";\n@@ -883,7 +883,7 @@ function loadCss(cssUrl) {\n                 return;\n             }\n             if (!e.NOTABLE_FORCE_VISIBLE && !elemIsInParent(event.relatedTarget, e)) {\n-                hideNotable();\n+                hideNotable(true);\n             }\n         };\n     }\n@@ -903,14 +903,16 @@ function loadCss(cssUrl) {\n             // To work around this, make sure the click finishes being dispatched before\n             // hiding the popover. Since `hideNotable()` is idempotent, this makes Safari behave\n             // consistently with the other two.\n-            setTimeout(hideNotable, 0);\n+            setTimeout(() => hideNotable(false), 0);\n         }\n     }\n \n-    function hideNotable() {\n+    function hideNotable(focus) {\n         if (window.CURRENT_NOTABLE_ELEMENT) {\n             if (window.CURRENT_NOTABLE_ELEMENT.NOTABLE_BASE.NOTABLE_FORCE_VISIBLE) {\n-                window.CURRENT_NOTABLE_ELEMENT.NOTABLE_BASE.focus();\n+                if (focus) {\n+                    window.CURRENT_NOTABLE_ELEMENT.NOTABLE_BASE.focus();\n+                }\n                 window.CURRENT_NOTABLE_ELEMENT.NOTABLE_BASE.NOTABLE_FORCE_VISIBLE = false;\n             }\n             const body = document.getElementsByTagName(\"body\")[0];\n@@ -923,7 +925,7 @@ function loadCss(cssUrl) {\n         e.onclick = function() {\n             this.NOTABLE_FORCE_VISIBLE = this.NOTABLE_FORCE_VISIBLE ? false : true;\n             if (window.CURRENT_NOTABLE_ELEMENT && !this.NOTABLE_FORCE_VISIBLE) {\n-                hideNotable();\n+                hideNotable(true);\n             } else {\n                 showNotable(this);\n                 window.CURRENT_NOTABLE_ELEMENT.setAttribute(\"tabindex\", \"0\");\n@@ -946,7 +948,7 @@ function loadCss(cssUrl) {\n             }\n             if (!this.NOTABLE_FORCE_VISIBLE &&\n                 !elemIsInParent(event.relatedTarget, window.CURRENT_NOTABLE_ELEMENT)) {\n-                hideNotable();\n+                hideNotable(true);\n             }\n         };\n     });\n@@ -1057,7 +1059,7 @@ function loadCss(cssUrl) {\n         onEachLazy(document.querySelectorAll(\".search-form .popover\"), elem => {\n             elem.style.display = \"none\";\n         });\n-        hideNotable();\n+        hideNotable(false);\n     };\n \n     /**"}, {"sha": "aab3b11433e93d2d15ab96fade3614403da6c27c", "filename": "src/test/rustdoc-gui/notable-trait.goml", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/e2dcc28d3c64a3f8f4797132420685e2b26fe05b/src%2Ftest%2Frustdoc-gui%2Fnotable-trait.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e2dcc28d3c64a3f8f4797132420685e2b26fe05b/src%2Ftest%2Frustdoc-gui%2Fnotable-trait.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fnotable-trait.goml?ref=e2dcc28d3c64a3f8f4797132420685e2b26fe05b", "patch": "@@ -219,3 +219,33 @@ press-key: \"Tab\"\n press-key: \"Tab\"\n press-key: \"Tab\"\n assert-count: (\"//*[@class='notable popover']\", 0)\n+assert: \"#method\\.create_an_iterator_from_read .notable-traits:focus\"\n+\n+// Now we check that the focus isn't given back to the wrong item when opening\n+// another popover.\n+store-window-property: (scroll, \"scrollY\")\n+click: \"#method\\.create_an_iterator_from_read .fnname\"\n+// We ensure that the scroll position changed.\n+assert-window-property-false: {\"scrollY\": |scroll|}\n+// Store the new position.\n+store-window-property: (scroll, \"scrollY\")\n+click: \"//*[@id='method.create_an_iterator_from_read']//*[@class='notable-traits']\"\n+wait-for: \"//*[@class='notable popover']\"\n+click: \"#settings-menu a\"\n+click: \".search-input\"\n+// We ensure we didn't come back to the previous focused item.\n+assert-window-property-false: {\"scrollY\": |scroll|}\n+\n+// Same but with Escape handling.\n+store-window-property: (scroll, \"scrollY\")\n+click: \"#method\\.create_an_iterator_from_read .fnname\"\n+// We ensure that the scroll position changed.\n+assert-window-property-false: {\"scrollY\": |scroll|}\n+// Store the new position.\n+store-window-property: (scroll, \"scrollY\")\n+click: \"//*[@id='method.create_an_iterator_from_read']//*[@class='notable-traits']\"\n+wait-for: \"//*[@class='notable popover']\"\n+click: \"#settings-menu a\"\n+press-key: \"Escape\"\n+// We ensure we didn't come back to the previous focused item.\n+assert-window-property-false: {\"scrollY\": |scroll|}"}]}