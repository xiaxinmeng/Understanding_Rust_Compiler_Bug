{"sha": "be6cb63fcc13fc52457b5fa2199711740ea08716", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlNmNiNjNmY2MxM2ZjNTI0NTdiNWZhMjE5OTcxMTc0MGVhMDg3MTY=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2019-12-30T22:09:35Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2019-12-30T22:09:35Z"}, "message": "Reduce allocations.", "tree": {"sha": "71dc8bf3091f8901a40729413aed9bc3ada07d12", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71dc8bf3091f8901a40729413aed9bc3ada07d12"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be6cb63fcc13fc52457b5fa2199711740ea08716", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be6cb63fcc13fc52457b5fa2199711740ea08716", "html_url": "https://github.com/rust-lang/rust/commit/be6cb63fcc13fc52457b5fa2199711740ea08716", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be6cb63fcc13fc52457b5fa2199711740ea08716/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f05d12c6778b524e9209a6a32cbfe617f92428c", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f05d12c6778b524e9209a6a32cbfe617f92428c", "html_url": "https://github.com/rust-lang/rust/commit/8f05d12c6778b524e9209a6a32cbfe617f92428c"}], "stats": {"total": 17, "additions": 8, "deletions": 9}, "files": [{"sha": "1aade029585242e117a6fc250fab3d558d89dbc2", "filename": "src/librustc/hir/lowering.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/be6cb63fcc13fc52457b5fa2199711740ea08716/src%2Flibrustc%2Fhir%2Flowering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be6cb63fcc13fc52457b5fa2199711740ea08716/src%2Flibrustc%2Fhir%2Flowering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering.rs?ref=be6cb63fcc13fc52457b5fa2199711740ea08716", "patch": "@@ -73,12 +73,10 @@ use syntax_pos::Span;\n use rustc_error_codes::*;\n \n macro_rules! arena_vec {\n-    () => (\n-        &[]\n-    );\n-    ($this:expr; $($x:expr),*) => (\n-        $this.arena.alloc_from_iter(vec![$($x),*])\n-    );\n+    ($this:expr; $($x:expr),*) => ({\n+        let a = [$($x),*];\n+        $this.arena.alloc_from_iter(std::array::IntoIter::new(a))\n+    });\n }\n \n mod expr;\n@@ -2018,7 +2016,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n                 FunctionRetTy::Ty(ty) => this.lower_ty(&ty, ImplTraitContext::disallowed()),\n                 FunctionRetTy::Default(_) => this.arena.alloc(this.ty_tup(span, &[])),\n             };\n-            let args = vec![GenericArg::Type(this.ty_tup(span, inputs))];\n+            let args = smallvec![GenericArg::Type(this.ty_tup(span, inputs))];\n             let binding = hir::TypeBinding {\n                 hir_id: this.next_id(),\n                 ident: Ident::with_dummy_span(FN_OUTPUT_NAME),\n@@ -3300,7 +3298,7 @@ fn body_ids(bodies: &BTreeMap<hir::BodyId, hir::Body<'hir>>) -> Vec<hir::BodyId>\n \n /// Helper struct for delayed construction of GenericArgs.\n struct GenericArgsCtor<'hir> {\n-    args: Vec<hir::GenericArg<'hir>>,\n+    args: SmallVec<[hir::GenericArg<'hir>; 1]>,\n     bindings: &'hir [hir::TypeBinding<'hir>],\n     parenthesized: bool,\n }"}, {"sha": "8c34aed5d5f535aed0ed01c6e84d00fcf041e0df", "filename": "src/librustc/hir/lowering/item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/be6cb63fcc13fc52457b5fa2199711740ea08716/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be6cb63fcc13fc52457b5fa2199711740ea08716/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs?ref=be6cb63fcc13fc52457b5fa2199711740ea08716", "patch": "@@ -1424,7 +1424,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n \n /// Helper struct for delayed construction of Generics.\n pub(super) struct GenericsCtor<'hir> {\n-    pub(super) params: Vec<hir::GenericParam<'hir>>,\n+    pub(super) params: SmallVec<[hir::GenericParam<'hir>; 1]>,\n     where_clause: hir::WhereClause<'hir>,\n     span: Span,\n }"}, {"sha": "4e7913b8dfc0e286aa472d08f7dc6408b78e62d1", "filename": "src/librustc/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/be6cb63fcc13fc52457b5fa2199711740ea08716/src%2Flibrustc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be6cb63fcc13fc52457b5fa2199711740ea08716/src%2Flibrustc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flib.rs?ref=be6cb63fcc13fc52457b5fa2199711740ea08716", "patch": "@@ -28,6 +28,7 @@\n \n #![doc(html_root_url = \"https://doc.rust-lang.org/nightly/\")]\n #![feature(arbitrary_self_types)]\n+#![feature(array_value_iter)]\n #![feature(bool_to_option)]\n #![feature(box_patterns)]\n #![feature(box_syntax)]"}]}