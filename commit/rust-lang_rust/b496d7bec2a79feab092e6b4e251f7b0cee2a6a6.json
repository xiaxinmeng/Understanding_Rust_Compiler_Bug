{"sha": "b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI0OTZkN2JlYzJhNzlmZWFiMDkyZTZiNGUyNTFmN2IwY2VlMmE2YTY=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2014-01-16T01:15:39Z"}, "committer": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2014-02-01T14:44:48Z"}, "message": "libsyntax: Make float literals not use `@str`", "tree": {"sha": "30bc26c3763372bb231dc24f7e34d666aaa9a6fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/30bc26c3763372bb231dc24f7e34d666aaa9a6fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "html_url": "https://github.com/rust-lang/rust/commit/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d6ef2e1b198461fde48565c7efdf92a83a33abd", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d6ef2e1b198461fde48565c7efdf92a83a33abd", "html_url": "https://github.com/rust-lang/rust/commit/8d6ef2e1b198461fde48565c7efdf92a83a33abd"}], "stats": {"total": 44, "additions": 24, "deletions": 20}, "files": [{"sha": "51410068378a4555b7c0a0d4b1f80906ee19f9b2", "filename": "src/librustc/middle/const_eval.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs?ref=b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "patch": "@@ -515,9 +515,9 @@ pub fn lit_to_const(lit: &Lit) -> const_val {\n         LitInt(n, _) => const_int(n),\n         LitUint(n, _) => const_uint(n),\n         LitIntUnsuffixed(n) => const_int(n),\n-        LitFloat(n, _) => const_float(from_str::<f64>(n).unwrap() as f64),\n-        LitFloatUnsuffixed(n) =>\n-            const_float(from_str::<f64>(n).unwrap() as f64),\n+        LitFloat(ref n, _) | LitFloatUnsuffixed(ref n) => {\n+            const_float(from_str::<f64>(n.get()).unwrap() as f64)\n+        }\n         LitNil => const_int(0i64),\n         LitBool(b) => const_bool(b)\n     }"}, {"sha": "8f69b3cc2f2da8de4dd54e617364de6235eb24e5", "filename": "src/librustc/middle/trans/consts.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs?ref=b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "patch": "@@ -57,12 +57,14 @@ pub fn const_lit(cx: &CrateContext, e: &ast::Expr, lit: ast::Lit)\n                                 ty_to_str(cx.tcx, lit_int_ty)))\n             }\n         }\n-        ast::LitFloat(fs, t) => C_floating(fs, Type::float_from_ty(t)),\n-        ast::LitFloatUnsuffixed(fs) => {\n+        ast::LitFloat(ref fs, t) => {\n+            C_floating(fs.get(), Type::float_from_ty(t))\n+        }\n+        ast::LitFloatUnsuffixed(ref fs) => {\n             let lit_float_ty = ty::node_id_to_type(cx.tcx, e.id);\n             match ty::get(lit_float_ty).sty {\n                 ty::ty_float(t) => {\n-                    C_floating(fs, Type::float_from_ty(t))\n+                    C_floating(fs.get(), Type::float_from_ty(t))\n                 }\n                 _ => {\n                     cx.sess.span_bug(lit.span,"}, {"sha": "09c30ae096c391279e31c801bcade066beaf3a6b", "filename": "src/librustdoc/clean.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibrustdoc%2Fclean.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibrustdoc%2Fclean.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean.rs?ref=b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "patch": "@@ -1152,8 +1152,8 @@ fn lit_to_str(lit: &ast::Lit) -> ~str {\n         ast::LitInt(i, _t) => i.to_str(),\n         ast::LitUint(u, _t) => u.to_str(),\n         ast::LitIntUnsuffixed(i) => i.to_str(),\n-        ast::LitFloat(f, _t) => f.to_str(),\n-        ast::LitFloatUnsuffixed(f) => f.to_str(),\n+        ast::LitFloat(ref f, _t) => f.get().to_str(),\n+        ast::LitFloatUnsuffixed(ref f) => f.get().to_str(),\n         ast::LitBool(b) => b.to_str(),\n         ast::LitNil => ~\"\",\n     }"}, {"sha": "380641a868968b68856b241079288ba0e3585cc9", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "patch": "@@ -728,8 +728,8 @@ pub enum Lit_ {\n     LitInt(i64, IntTy),\n     LitUint(u64, UintTy),\n     LitIntUnsuffixed(i64),\n-    LitFloat(@str, FloatTy),\n-    LitFloatUnsuffixed(@str),\n+    LitFloat(InternedString, FloatTy),\n+    LitFloatUnsuffixed(InternedString),\n     LitNil,\n     LitBool(bool),\n }"}, {"sha": "c13f9bf92af022257248a152aa18b7ee090b5216", "filename": "src/libsyntax/ext/concat.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fext%2Fconcat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fext%2Fconcat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fconcat.rs?ref=b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "patch": "@@ -29,12 +29,11 @@ pub fn expand_syntax_ext(cx: &mut base::ExtCtxt,\n         match e.node {\n             ast::ExprLit(lit) => {\n                 match lit.node {\n-                    ast::LitStr(ref s, _) => {\n+                    ast::LitStr(ref s, _) |\n+                    ast::LitFloat(ref s, _) |\n+                    ast::LitFloatUnsuffixed(ref s) => {\n                         accumulator.push_str(s.get());\n                     }\n-                    ast::LitFloat(s, _) | ast::LitFloatUnsuffixed(s) => {\n-                        accumulator.push_str(s);\n-                    }\n                     ast::LitChar(c) => {\n                         accumulator.push_char(char::from_u32(c).unwrap());\n                     }"}, {"sha": "e86873d64187744b8be7db4c2f4f1fd7ad9a3cf6", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "patch": "@@ -1405,9 +1405,12 @@ impl Parser {\n             token::LIT_INT(i, it) => LitInt(i, it),\n             token::LIT_UINT(u, ut) => LitUint(u, ut),\n             token::LIT_INT_UNSUFFIXED(i) => LitIntUnsuffixed(i),\n-            token::LIT_FLOAT(s, ft) => LitFloat(self.id_to_str(s), ft),\n-            token::LIT_FLOAT_UNSUFFIXED(s) =>\n-                LitFloatUnsuffixed(self.id_to_str(s)),\n+            token::LIT_FLOAT(s, ft) => {\n+                LitFloat(self.id_to_interned_str(s), ft)\n+            }\n+            token::LIT_FLOAT_UNSUFFIXED(s) => {\n+                LitFloatUnsuffixed(self.id_to_interned_str(s))\n+            }\n             token::LIT_STR(s) => {\n                 LitStr(self.id_to_interned_str(s), ast::CookedStr)\n             }"}, {"sha": "d2a388cc14d9b0a27d7bc81dcfda057d7fc1ceb6", "filename": "src/libsyntax/print/pprust.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b496d7bec2a79feab092e6b4e251f7b0cee2a6a6/src%2Flibsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fprint%2Fpprust.rs?ref=b496d7bec2a79feab092e6b4e251f7b0cee2a6a6", "patch": "@@ -2202,10 +2202,10 @@ pub fn print_literal(s: &mut State, lit: &ast::Lit) {\n             word(&mut s.s, (i as u64).to_str_radix(10u));\n         }\n       }\n-      ast::LitFloat(f, t) => {\n-        word(&mut s.s, f.to_owned() + ast_util::float_ty_to_str(t));\n+      ast::LitFloat(ref f, t) => {\n+        word(&mut s.s, f.get() + ast_util::float_ty_to_str(t));\n       }\n-      ast::LitFloatUnsuffixed(f) => word(&mut s.s, f),\n+      ast::LitFloatUnsuffixed(ref f) => word(&mut s.s, f.get()),\n       ast::LitNil => word(&mut s.s, \"()\"),\n       ast::LitBool(val) => {\n         if val { word(&mut s.s, \"true\"); } else { word(&mut s.s, \"false\"); }"}]}