{"sha": "6c506d4c71f957fa5ca50d364c7f56daa0872064", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZjNTA2ZDRjNzFmOTU3ZmE1Y2E1MGQzNjRjN2Y1NmRhYTA4NzIwNjQ=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-02T06:10:04Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-02T06:10:13Z"}, "message": "Address review comments: make label shorter", "tree": {"sha": "231249dfc71c5304f46e0a770405647acf6835bb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/231249dfc71c5304f46e0a770405647acf6835bb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6c506d4c71f957fa5ca50d364c7f56daa0872064", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6c506d4c71f957fa5ca50d364c7f56daa0872064", "html_url": "https://github.com/rust-lang/rust/commit/6c506d4c71f957fa5ca50d364c7f56daa0872064", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6c506d4c71f957fa5ca50d364c7f56daa0872064/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be6734a7e719f8744c4618fe109475a626fe118e", "url": "https://api.github.com/repos/rust-lang/rust/commits/be6734a7e719f8744c4618fe109475a626fe118e", "html_url": "https://github.com/rust-lang/rust/commit/be6734a7e719f8744c4618fe109475a626fe118e"}], "stats": {"total": 25, "additions": 16, "deletions": 9}, "files": [{"sha": "b33cd19b7a9f1b6d38fdc967dc7a579d16b643b2", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/6c506d4c71f957fa5ca50d364c7f56daa0872064/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c506d4c71f957fa5ca50d364c7f56daa0872064/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=6c506d4c71f957fa5ca50d364c7f56daa0872064", "patch": "@@ -705,12 +705,6 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                 }, \" (into closure)\"),\n         };\n \n-        let extra_move_label = if need_note {\n-            format!(\" because it has type `{}`, which does not implement the `Copy` trait\",\n-                    moved_lp.ty)\n-        } else {\n-            String::new()\n-        };\n         // Annotate the use and the move in the span. Watch out for\n         // the case where the use and the move are the same. This\n         // means the use is in a loop.\n@@ -720,10 +714,22 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                 format!(\"value moved{} here in previous iteration of loop{}\",\n                          move_note,\n                          extra_move_label));\n+\n+            if need_note {\n+                err.note(&format!(\"value moved because it has type `{}`, \\\n+                                   which does not implement the `Copy` trait\",\n+                                  moved_lp.ty)\n+            }\n             err\n         } else {\n-            err.span_label(use_span, format!(\"value {} here after move\", verb_participle))\n-               .span_label(move_span, format!(\"value moved{} here{}\", move_note, extra_move_label));\n+            err.span_label(use_span, format!(\"value {} here after move\", verb_participle));\n+            let extra_move_label = if need_note {\n+               &format!(\" because it has type `{}`, which does not implement the `Copy` trait\",\n+                        moved_lp.ty)\n+            } else {\n+                \"\"\n+            };\n+            err.span_label(move_span,format!(\"value moved{} here{}\", move_note, extra_move_label));\n             err\n         };\n "}, {"sha": "caa67835ee573ab06e7bb248be9d49e4f90ebaae", "filename": "src/test/ui/borrowck/issue-41962.stderr", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6c506d4c71f957fa5ca50d364c7f56daa0872064/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6c506d4c71f957fa5ca50d364c7f56daa0872064/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr?ref=6c506d4c71f957fa5ca50d364c7f56daa0872064", "patch": "@@ -10,7 +10,8 @@ error[E0382]: use of moved value: `(maybe as std::prelude::v1::Some).0`\n   --> $DIR/issue-41962.rs:15:21\n    |\n 15 |         if let Some(thing) = maybe {\n-   |                     ^^^^^ value moved here in previous iteration of loop because it has type `std::vec::Vec<bool>`, which does not implement the `Copy` trait\n+   |                     ^^^^^ value moved here in previous iteration of loop\n+   = note: value moved because it has type `std::vec::Vec<bool>`, which does not implement the `Copy` trait\n \n error: aborting due to 2 previous errors\n "}]}