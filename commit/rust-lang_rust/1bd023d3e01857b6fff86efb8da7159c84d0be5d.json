{"sha": "1bd023d3e01857b6fff86efb8da7159c84d0be5d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiZDAyM2QzZTAxODU3YjZmZmY4NmVmYjhkYTcxNTljODRkMGJlNWQ=", "commit": {"author": {"name": "Florian Gilcher", "email": "florian.gilcher@asquera.de", "date": "2015-10-15T09:13:01Z"}, "committer": {"name": "Florian Gilcher", "email": "florian.gilcher@asquera.de", "date": "2015-10-15T19:33:47Z"}, "message": "New lint for needless use of nightly features", "tree": {"sha": "4bcd83496a6aa6b715f9acc0fc6ec604b430a471", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bcd83496a6aa6b715f9acc0fc6ec604b430a471"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1bd023d3e01857b6fff86efb8da7159c84d0be5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1bd023d3e01857b6fff86efb8da7159c84d0be5d", "html_url": "https://github.com/rust-lang/rust/commit/1bd023d3e01857b6fff86efb8da7159c84d0be5d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1bd023d3e01857b6fff86efb8da7159c84d0be5d/comments", "author": {"login": "skade", "id": 47542, "node_id": "MDQ6VXNlcjQ3NTQy", "avatar_url": "https://avatars.githubusercontent.com/u/47542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skade", "html_url": "https://github.com/skade", "followers_url": "https://api.github.com/users/skade/followers", "following_url": "https://api.github.com/users/skade/following{/other_user}", "gists_url": "https://api.github.com/users/skade/gists{/gist_id}", "starred_url": "https://api.github.com/users/skade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skade/subscriptions", "organizations_url": "https://api.github.com/users/skade/orgs", "repos_url": "https://api.github.com/users/skade/repos", "events_url": "https://api.github.com/users/skade/events{/privacy}", "received_events_url": "https://api.github.com/users/skade/received_events", "type": "User", "site_admin": false}, "committer": {"login": "skade", "id": 47542, "node_id": "MDQ6VXNlcjQ3NTQy", "avatar_url": "https://avatars.githubusercontent.com/u/47542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skade", "html_url": "https://github.com/skade", "followers_url": "https://api.github.com/users/skade/followers", "following_url": "https://api.github.com/users/skade/following{/other_user}", "gists_url": "https://api.github.com/users/skade/gists{/gist_id}", "starred_url": "https://api.github.com/users/skade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skade/subscriptions", "organizations_url": "https://api.github.com/users/skade/orgs", "repos_url": "https://api.github.com/users/skade/repos", "events_url": "https://api.github.com/users/skade/events{/privacy}", "received_events_url": "https://api.github.com/users/skade/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e24d4698497b2e86f9a1a1b5d4d72c9ebd2ad659", "url": "https://api.github.com/repos/rust-lang/rust/commits/e24d4698497b2e86f9a1a1b5d4d72c9ebd2ad659", "html_url": "https://github.com/rust-lang/rust/commit/e24d4698497b2e86f9a1a1b5d4d72c9ebd2ad659"}], "stats": {"total": 70, "additions": 70, "deletions": 0}, "files": [{"sha": "31ce6738fd19e562bff24f5952eece820014d40d", "filename": "src/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1bd023d3e01857b6fff86efb8da7159c84d0be5d/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bd023d3e01857b6fff86efb8da7159c84d0be5d/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=1bd023d3e01857b6fff86efb8da7159c84d0be5d", "patch": "@@ -50,6 +50,7 @@ pub mod precedence;\n pub mod mutex_atomic;\n pub mod zero_div_zero;\n pub mod open_options;\n+pub mod needless_features;\n \n mod reexport {\n     pub use syntax::ast::{Name, Ident, NodeId};\n@@ -94,6 +95,7 @@ pub fn plugin_registrar(reg: &mut Registry) {\n     reg.register_late_lint_pass(box open_options::NonSensicalOpenOptions);\n     reg.register_late_lint_pass(box zero_div_zero::ZeroDivZeroPass);\n     reg.register_late_lint_pass(box mutex_atomic::MutexAtomic);\n+    reg.register_late_lint_pass(box needless_features::NeedlessFeaturesPass);\n \n     reg.register_lint_group(\"clippy_pedantic\", vec![\n         methods::OPTION_UNWRAP_USED,\n@@ -150,6 +152,8 @@ pub fn plugin_registrar(reg: &mut Registry) {\n         mut_reference::UNNECESSARY_MUT_PASSED,\n         mutex_atomic::MUTEX_ATOMIC,\n         needless_bool::NEEDLESS_BOOL,\n+        needless_features::AS_SLICE,\n+        needless_features::AS_MUT_SLICE,\n         open_options::NONSENSICAL_OPEN_OPTIONS,\n         precedence::PRECEDENCE,\n         ptr_arg::PTR_ARG,"}, {"sha": "950057da26c3763c10b5b0db539b83cefdf9d736", "filename": "src/needless_features.rs", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/1bd023d3e01857b6fff86efb8da7159c84d0be5d/src%2Fneedless_features.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bd023d3e01857b6fff86efb8da7159c84d0be5d/src%2Fneedless_features.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fneedless_features.rs?ref=1bd023d3e01857b6fff86efb8da7159c84d0be5d", "patch": "@@ -0,0 +1,49 @@\n+//! Checks for usage of nightly features that have simple stable equivalents\n+//!\n+//! This lint is **warn** by default\n+\n+use rustc::lint::*;\n+use rustc_front::hir::*;\n+\n+use utils::{span_lint};\n+\n+declare_lint! {\n+    pub AS_SLICE,\n+    Warn,\n+    \"as_slice is not stable and can be replaced by & v[..]\\\n+see https://github.com/rust-lang/rust/issues/27729\"\n+}\n+\n+declare_lint! {\n+    pub AS_MUT_SLICE,\n+    Warn,\n+    \"as_mut_slice is not stable and can be replaced by &mut v[..]\\\n+see https://github.com/rust-lang/rust/issues/27729\"\n+}\n+\n+\n+#[derive(Copy,Clone)]\n+pub struct NeedlessFeaturesPass;\n+\n+impl LintPass for NeedlessFeaturesPass {\n+    fn get_lints(&self) -> LintArray {\n+        lint_array!(AS_SLICE,AS_MUT_SLICE)\n+    }\n+}\n+\n+impl LateLintPass for NeedlessFeaturesPass {\n+    fn check_expr(&mut self, cx: &LateContext, expr: &Expr) {\n+        if let ExprMethodCall(ref name, _, _) = expr.node {\n+            if name.node.as_str() == \"as_slice\" {\n+                span_lint(cx, AS_SLICE, expr.span,\n+                          \"used as_slice() from the 'convert' nightly feature. Use &[..] \\\n+                           instead\");\n+            }\n+            if name.node.as_str() == \"as_mut_slice\" {\n+                span_lint(cx, AS_MUT_SLICE, expr.span,\n+                          \"used as_mut_slice() from the 'convert' nightly feature. Use &mut [..] \\\n+                           instead\");\n+            }\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "02639aea66f095311a2c373b60b931f432a83494", "filename": "tests/compile-fail/needless_features.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/1bd023d3e01857b6fff86efb8da7159c84d0be5d/tests%2Fcompile-fail%2Fneedless_features.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bd023d3e01857b6fff86efb8da7159c84d0be5d/tests%2Fcompile-fail%2Fneedless_features.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fneedless_features.rs?ref=1bd023d3e01857b6fff86efb8da7159c84d0be5d", "patch": "@@ -0,0 +1,17 @@\n+#![feature(plugin)]\n+#![feature(convert)]\n+#![plugin(clippy)]\n+\n+#![deny(clippy)]\n+\n+fn test_as_slice() {\n+    let v = vec![1];\n+    v.as_slice(); //~ERROR used as_slice() from the 'convert' nightly feature. Use &[..]\n+\n+    let mut v2 = vec![1];\n+    v2.as_mut_slice(); //~ERROR used as_mut_slice() from the 'convert' nightly feature. Use &mut [..]\n+}\n+\n+fn main() {\n+    test_as_slice();\n+}"}]}