{"sha": "ea2ffda44e0c38854dbe63c786a194dd35559545", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhMmZmZGE0NGUwYzM4ODU0ZGJlNjNjNzg2YTE5NGRkMzU1NTk1NDU=", "commit": {"author": {"name": "Alberto Piai", "email": "apiai@sensational.ch", "date": "2020-02-14T13:27:22Z"}, "committer": {"name": "Alberto Piai", "email": "apiai@sensational.ch", "date": "2020-02-14T13:38:31Z"}, "message": "add regression test for issue #68794\n\nThis is a minimal regression test for the issue #68794: \"TEXTREL in\ni686\", which was fixed with e86019c4a0968a1e393cdd0731649168624a88b8.\n\nThe test links a minimal rust static library into a shared library, and\nchecks that the linker didn't have to add the TEXTREL flag.", "tree": {"sha": "9ac63dc9845a0ded5a2d2a1d852c58922ae55e11", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9ac63dc9845a0ded5a2d2a1d852c58922ae55e11"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea2ffda44e0c38854dbe63c786a194dd35559545", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQIzBAABCgAdFiEEjvNmHhYKkAX6pI6XL7T063SVtygFAl5GotcACgkQL7T063SV\ntyibzBAApUGRMsxWVC7y7u5zoDw17i77+l4h0hJbm6tqdNIuVlAKQYJejrycIQU4\nxwrlmHXLTNb2+89mhfKspgZKhqu0w6Aq1HP9/Le/Z84C/FIxMIgYVhwKJAGB0pvf\nCqSorRxIjblkZS70GuiaNsz3bKrbB7VC1an744VuEYDguTdcHmo/uFhiPgiBPaEN\nePfT634ejW8n2mr35nU+zT5MVnon32YLbqY094mAl6PFJvdjG53ZxPLQn4cdLcQr\nCPDZ5O+c12ZixGbilrJT4B1Xv7oU4qInMhiVdtPtwJz4MJksPRTZSI7weehokYCZ\nmeQxGSvmzuLxIMyBNKlP9kpC/rhdt9BH+Yd8MCL+5Myiu+c80XhnM7rd2DnEB51z\n2huk1Fc8e6MlgzeiHFJB6G0lQXLX5cMpfqZPFE4vFwPOa8sajggqjUPQCXdyNQUZ\nJ7cuYb/sR5gbul7bQ4hlQKiXcVUqx7wMAtzbGwx+pfXWJQE0fnshFLz1yK71xGWt\ndhqFnEkiXrozi0480GFZVRX43S+fdV3IcHR8wVknAA6FPBstWLjaCfWfgfKvK5Ir\ncK1GhK+Iy5IubAVtIS/SigMPCEFWm320yJ9TW1fxEdpOsJJ3usg41/kNAXKfh8M5\nQ0csHpXanE9aTRKBjN3xt3r+6SF9p/DUK1+Xq2LCa4JUsVcmc7E=\n=X1LU\n-----END PGP SIGNATURE-----", "payload": "tree 9ac63dc9845a0ded5a2d2a1d852c58922ae55e11\nparent 21ed50522ddb998f5367229984a4510af578899f\nauthor Alberto Piai <apiai@sensational.ch> 1581686842 +0100\ncommitter Alberto Piai <apiai@sensational.ch> 1581687511 +0100\n\nadd regression test for issue #68794\n\nThis is a minimal regression test for the issue #68794: \"TEXTREL in\ni686\", which was fixed with e86019c4a0968a1e393cdd0731649168624a88b8.\n\nThe test links a minimal rust static library into a shared library, and\nchecks that the linker didn't have to add the TEXTREL flag.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea2ffda44e0c38854dbe63c786a194dd35559545", "html_url": "https://github.com/rust-lang/rust/commit/ea2ffda44e0c38854dbe63c786a194dd35559545", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea2ffda44e0c38854dbe63c786a194dd35559545/comments", "author": {"login": "brainlock", "id": 97501, "node_id": "MDQ6VXNlcjk3NTAx", "avatar_url": "https://avatars.githubusercontent.com/u/97501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brainlock", "html_url": "https://github.com/brainlock", "followers_url": "https://api.github.com/users/brainlock/followers", "following_url": "https://api.github.com/users/brainlock/following{/other_user}", "gists_url": "https://api.github.com/users/brainlock/gists{/gist_id}", "starred_url": "https://api.github.com/users/brainlock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brainlock/subscriptions", "organizations_url": "https://api.github.com/users/brainlock/orgs", "repos_url": "https://api.github.com/users/brainlock/repos", "events_url": "https://api.github.com/users/brainlock/events{/privacy}", "received_events_url": "https://api.github.com/users/brainlock/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brainlock", "id": 97501, "node_id": "MDQ6VXNlcjk3NTAx", "avatar_url": "https://avatars.githubusercontent.com/u/97501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brainlock", "html_url": "https://github.com/brainlock", "followers_url": "https://api.github.com/users/brainlock/followers", "following_url": "https://api.github.com/users/brainlock/following{/other_user}", "gists_url": "https://api.github.com/users/brainlock/gists{/gist_id}", "starred_url": "https://api.github.com/users/brainlock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brainlock/subscriptions", "organizations_url": "https://api.github.com/users/brainlock/orgs", "repos_url": "https://api.github.com/users/brainlock/repos", "events_url": "https://api.github.com/users/brainlock/events{/privacy}", "received_events_url": "https://api.github.com/users/brainlock/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "21ed50522ddb998f5367229984a4510af578899f", "url": "https://api.github.com/repos/rust-lang/rust/commits/21ed50522ddb998f5367229984a4510af578899f", "html_url": "https://github.com/rust-lang/rust/commit/21ed50522ddb998f5367229984a4510af578899f"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "2f16ad3285994be2b55c6134069d893f04227f07", "filename": "src/test/run-make-fulldeps/issue-68794-textrel-on-minimal-lib/Makefile", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ea2ffda44e0c38854dbe63c786a194dd35559545/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/ea2ffda44e0c38854dbe63c786a194dd35559545/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2FMakefile?ref=ea2ffda44e0c38854dbe63c786a194dd35559545", "patch": "@@ -0,0 +1,17 @@\n+# Regression test for issue #68794\n+#\n+# Verify that no text relocations are accidentally introduced by linking a\n+# minimal rust staticlib.\n+#\n+# The test links a rust static library into a shared library, and checks that\n+# the linker doesn't have to flag the resulting file as containing TEXTRELs.\n+\n+-include ../tools.mk\n+\n+# only-linux\n+\n+all:\n+\t$(RUSTC) foo.rs\n+\t$(CC) bar.c $(call STATICLIB,foo) -fPIC -shared -o $(call DYLIB,bar) \\\n+\t\t$(EXTRACFLAGS) $(EXTRACXXFLAGS)\n+\treadelf -d $(call DYLIB,bar) | grep TEXTREL; test $$? -eq 1"}, {"sha": "bb4036b06e13b79a32ec78ae04db97590f54b2cc", "filename": "src/test/run-make-fulldeps/issue-68794-textrel-on-minimal-lib/bar.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ea2ffda44e0c38854dbe63c786a194dd35559545/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Fbar.c", "raw_url": "https://github.com/rust-lang/rust/raw/ea2ffda44e0c38854dbe63c786a194dd35559545/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Fbar.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Fbar.c?ref=ea2ffda44e0c38854dbe63c786a194dd35559545", "patch": "@@ -0,0 +1,6 @@\n+void foo();\n+\n+int main() {\n+    foo();\n+    return 0;\n+}"}, {"sha": "a3e865b638ed44fa2f7a17f1d540ef029e6cc2c3", "filename": "src/test/run-make-fulldeps/issue-68794-textrel-on-minimal-lib/foo.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ea2ffda44e0c38854dbe63c786a194dd35559545/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea2ffda44e0c38854dbe63c786a194dd35559545/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Ffoo.rs?ref=ea2ffda44e0c38854dbe63c786a194dd35559545", "patch": "@@ -0,0 +1,8 @@\n+#![crate_type = \"staticlib\"]\n+\n+#[no_mangle]\n+pub extern \"C\" fn foo(x: u32) {\n+    // using the println! makes it so that enough code from the standard\n+    // library is included (see issue #68794)\n+    println!(\"foo: {}\", x);\n+}"}]}