{"sha": "e3d84b2809c630c8f3b9f776174dd9d72ba62e54", "node_id": "C_kwDOAAsO6NoAKGUzZDg0YjI4MDljNjMwYzhmM2I5Zjc3NjE3NGRkOWQ3MmJhNjJlNTQ", "commit": {"author": {"name": "Milo", "email": "50248166+Milo123459@users.noreply.github.com", "date": "2022-07-11T07:42:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-11T07:42:10Z"}, "message": "clippy argument support", "tree": {"sha": "cbb616c1a29a2321fa011d12e41bcdf10cbccb7f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cbb616c1a29a2321fa011d12e41bcdf10cbccb7f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3d84b2809c630c8f3b9f776174dd9d72ba62e54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3d84b2809c630c8f3b9f776174dd9d72ba62e54", "html_url": "https://github.com/rust-lang/rust/commit/e3d84b2809c630c8f3b9f776174dd9d72ba62e54", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3d84b2809c630c8f3b9f776174dd9d72ba62e54/comments", "author": {"login": "Milo123459", "id": 50248166, "node_id": "MDQ6VXNlcjUwMjQ4MTY2", "avatar_url": "https://avatars.githubusercontent.com/u/50248166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Milo123459", "html_url": "https://github.com/Milo123459", "followers_url": "https://api.github.com/users/Milo123459/followers", "following_url": "https://api.github.com/users/Milo123459/following{/other_user}", "gists_url": "https://api.github.com/users/Milo123459/gists{/gist_id}", "starred_url": "https://api.github.com/users/Milo123459/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Milo123459/subscriptions", "organizations_url": "https://api.github.com/users/Milo123459/orgs", "repos_url": "https://api.github.com/users/Milo123459/repos", "events_url": "https://api.github.com/users/Milo123459/events{/privacy}", "received_events_url": "https://api.github.com/users/Milo123459/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd73afadae5b0163f9285f1b5edbbd1c84fde410", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd73afadae5b0163f9285f1b5edbbd1c84fde410", "html_url": "https://github.com/rust-lang/rust/commit/cd73afadae5b0163f9285f1b5edbbd1c84fde410"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "bfcb1c0c15dc26c149843ef9fd4ebf0f2cb5dd3c", "filename": "src/bootstrap/check.rs", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e3d84b2809c630c8f3b9f776174dd9d72ba62e54/src%2Fbootstrap%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3d84b2809c630c8f3b9f776174dd9d72ba62e54/src%2Fbootstrap%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcheck.rs?ref=e3d84b2809c630c8f3b9f776174dd9d72ba62e54", "patch": "@@ -20,7 +20,15 @@ fn args(builder: &Builder<'_>) -> Vec<String> {\n         arr.iter().copied().map(String::from)\n     }\n \n-    if let Subcommand::Clippy { fix, .. } = builder.config.cmd {\n+    if let Subcommand::Clippy {\n+        fix,\n+        clippy_lint_allow,\n+        clippy_lint_deny,\n+        clippy_lint_warn,\n+        clippy_lint_forbid,\n+        ..\n+    } = &builder.config.cmd\n+    {\n         // disable the most spammy clippy lints\n         let ignored_lints = vec![\n             \"many_single_char_names\", // there are a lot in stdarch\n@@ -32,7 +40,7 @@ fn args(builder: &Builder<'_>) -> Vec<String> {\n             \"wrong_self_convention\",\n         ];\n         let mut args = vec![];\n-        if fix {\n+        if *fix {\n             #[rustfmt::skip]\n             args.extend(strings(&[\n                 \"--fix\", \"-Zunstable-options\",\n@@ -44,6 +52,12 @@ fn args(builder: &Builder<'_>) -> Vec<String> {\n         }\n         args.extend(strings(&[\"--\", \"--cap-lints\", \"warn\"]));\n         args.extend(ignored_lints.iter().map(|lint| format!(\"-Aclippy::{}\", lint)));\n+        let mut clippy_lint_levels: Vec<String> = Vec::new();\n+        clippy_lint_allow.iter().for_each(|v| clippy_lint_levels.push(format!(\"-A{}\", v)));\n+        clippy_lint_deny.iter().for_each(|v| clippy_lint_levels.push(format!(\"-D{}\", v)));\n+        clippy_lint_warn.iter().for_each(|v| clippy_lint_levels.push(format!(\"-W{}\", v)));\n+        clippy_lint_forbid.iter().for_each(|v| clippy_lint_levels.push(format!(\"-F{}\", v)));\n+        args.extend(clippy_lint_levels);\n         args\n     } else {\n         vec![]"}, {"sha": "3fd834716c11ae5e71512852c134bfc80a6f8f41", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/e3d84b2809c630c8f3b9f776174dd9d72ba62e54/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3d84b2809c630c8f3b9f776174dd9d72ba62e54/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=e3d84b2809c630c8f3b9f776174dd9d72ba62e54", "patch": "@@ -91,6 +91,10 @@ pub enum Subcommand {\n     Clippy {\n         fix: bool,\n         paths: Vec<PathBuf>,\n+        clippy_lint_allow: Vec<String>,\n+        clippy_lint_deny: Vec<String>,\n+        clippy_lint_warn: Vec<String>,\n+        clippy_lint_forbid: Vec<String>,\n     },\n     Fix {\n         paths: Vec<PathBuf>,\n@@ -240,6 +244,10 @@ To learn more about a subcommand, run `./x.py <subcommand> -h`\",\n         opts.optopt(\"\", \"rust-profile-use\", \"use PGO profile for rustc build\", \"PROFILE\");\n         opts.optflag(\"\", \"llvm-profile-generate\", \"generate PGO profile with llvm built for rustc\");\n         opts.optopt(\"\", \"llvm-profile-use\", \"use PGO profile for llvm build\", \"PROFILE\");\n+        opts.optmulti(\"A\", \"\", \"allow certain clippy lints\", \"OPT\");\n+        opts.optmulti(\"D\", \"\", \"deny certain clippy lints\", \"OPT\");\n+        opts.optmulti(\"W\", \"\", \"warn about certain clippy lints\", \"OPT\");\n+        opts.optmulti(\"F\", \"\", \"forbid certain clippy lints\", \"OPT\");\n \n         // We can't use getopt to parse the options until we have completed specifying which\n         // options are valid, but under the current implementation, some options are conditional on\n@@ -538,7 +546,14 @@ Arguments:\n                 }\n                 Subcommand::Check { paths }\n             }\n-            Kind::Clippy => Subcommand::Clippy { paths, fix: matches.opt_present(\"fix\") },\n+            Kind::Clippy => Subcommand::Clippy {\n+                paths,\n+                fix: matches.opt_present(\"fix\"),\n+                clippy_lint_allow: matches.opt_strs(\"A\"),\n+                clippy_lint_warn: matches.opt_strs(\"W\"),\n+                clippy_lint_deny: matches.opt_strs(\"D\"),\n+                clippy_lint_forbid: matches.opt_strs(\"F\"),\n+            },\n             Kind::Fix => Subcommand::Fix { paths },\n             Kind::Test => Subcommand::Test {\n                 paths,"}]}