{"sha": "b6138965cdfc2d6b9b32fe0cc5cef9482975dc94", "node_id": "C_kwDOAAsO6NoAKGI2MTM4OTY1Y2RmYzJkNmI5YjMyZmUwY2M1Y2VmOTQ4Mjk3NWRjOTQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-31T08:15:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-31T08:15:31Z"}, "message": "Auto merge of #13149 - lowr:fix/unescape-raw-ident-module-path, r=Veykril\n\nfix: unescape all occurrences of module name in module resolution\n\nFixes #13141", "tree": {"sha": "dfb3e69e7d121d25996d4a89a75ab944fc8c49fe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dfb3e69e7d121d25996d4a89a75ab944fc8c49fe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94", "html_url": "https://github.com/rust-lang/rust/commit/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef27641f56d8783226e8f9283c4cc533dc5534f8", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef27641f56d8783226e8f9283c4cc533dc5534f8", "html_url": "https://github.com/rust-lang/rust/commit/ef27641f56d8783226e8f9283c4cc533dc5534f8"}, {"sha": "662ab0cd8eb6784e764903325da30418a2095307", "url": "https://api.github.com/repos/rust-lang/rust/commits/662ab0cd8eb6784e764903325da30418a2095307", "html_url": "https://github.com/rust-lang/rust/commit/662ab0cd8eb6784e764903325da30418a2095307"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "ca7bcc814e8f8e41e4ced5c765e48f22af51a505", "filename": "crates/hir-def/src/nameres/mod_resolution.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94/crates%2Fhir-def%2Fsrc%2Fnameres%2Fmod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94/crates%2Fhir-def%2Fsrc%2Fnameres%2Fmod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fnameres%2Fmod_resolution.rs?ref=b6138965cdfc2d6b9b32fe0cc5cef9482975dc94", "patch": "@@ -65,6 +65,7 @@ impl ModDir {\n         name: &Name,\n         attr_path: Option<&SmolStr>,\n     ) -> Result<(FileId, bool, ModDir), Box<[String]>> {\n+        let name = name.unescaped();\n         let orig_file_id = file_id.original_file(db.upcast());\n \n         let mut candidate_files = ArrayVec::<_, 2>::new();\n@@ -73,12 +74,10 @@ impl ModDir {\n                 candidate_files.push(self.dir_path.join_attr(attr_path, self.root_non_dir_owner))\n             }\n             None if file_id.is_include_macro(db.upcast()) => {\n-                let name = name.unescaped();\n                 candidate_files.push(format!(\"{}.rs\", name));\n                 candidate_files.push(format!(\"{}/mod.rs\", name));\n             }\n             None => {\n-                let name = name.unescaped();\n                 candidate_files.push(format!(\"{}{}.rs\", self.dir_path.0, name));\n                 candidate_files.push(format!(\"{}{}/mod.rs\", self.dir_path.0, name));\n             }"}, {"sha": "ba3bf8b5a5cfa54075da94a07765c26f98fb2a7b", "filename": "crates/hir-def/src/nameres/tests/mod_resolution.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94/crates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6138965cdfc2d6b9b32fe0cc5cef9482975dc94/crates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs?ref=b6138965cdfc2d6b9b32fe0cc5cef9482975dc94", "patch": "@@ -127,7 +127,15 @@ mod r#async;\n use self::r#async::Bar;\n \n //- /async.rs\n+mod foo;\n+mod r#async;\n pub struct Bar;\n+\n+//- /async/foo.rs\n+pub struct Foo;\n+\n+//- /async/async.rs\n+pub struct Baz;\n \"#,\n         expect![[r#\"\n             crate\n@@ -136,6 +144,14 @@ pub struct Bar;\n \n             crate::r#async\n             Bar: t v\n+            foo: t\n+            r#async: t\n+\n+            crate::r#async::foo\n+            Foo: t v\n+\n+            crate::r#async::r#async\n+            Baz: t v\n         \"#]],\n     );\n }"}]}