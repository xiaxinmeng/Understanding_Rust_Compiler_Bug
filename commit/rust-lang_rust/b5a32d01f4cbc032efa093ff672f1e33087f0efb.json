{"sha": "b5a32d01f4cbc032efa093ff672f1e33087f0efb", "node_id": "C_kwDOAAsO6NoAKGI1YTMyZDAxZjRjYmMwMzJlZmEwOTNmZjY3MmYxZTMzMDg3ZjBlZmI", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-17T20:17:25Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-20T21:12:06Z"}, "message": "we seem to monomorphize fewer vtables by default now, so adjust some tests", "tree": {"sha": "a608f3aad1a15c8f8ff43455ff11dfa2b39e1fef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a608f3aad1a15c8f8ff43455ff11dfa2b39e1fef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b5a32d01f4cbc032efa093ff672f1e33087f0efb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b5a32d01f4cbc032efa093ff672f1e33087f0efb", "html_url": "https://github.com/rust-lang/rust/commit/b5a32d01f4cbc032efa093ff672f1e33087f0efb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b5a32d01f4cbc032efa093ff672f1e33087f0efb/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe00573324854e5681546b660bbbaf4e1ec38eb2", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe00573324854e5681546b660bbbaf4e1ec38eb2", "html_url": "https://github.com/rust-lang/rust/commit/fe00573324854e5681546b660bbbaf4e1ec38eb2"}], "stats": {"total": 83, "additions": 68, "deletions": 15}, "files": [{"sha": "dc3c17ac3144b5910525546e202766542fd4e174", "filename": "src/test/ui/traits/vtable/vtable-diamond.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-diamond.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-diamond.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-diamond.rs?ref=b5a32d01f4cbc032efa093ff672f1e33087f0efb", "patch": "@@ -34,6 +34,11 @@ fn foo(d: &dyn D) {\n     d.foo_d();\n }\n \n+fn bar(d: &dyn C) {\n+    d.foo_c();\n+}\n+\n fn main() {\n     foo(&S);\n+    bar(&S);\n }"}, {"sha": "ebd55bcf39b176b66911d5d494a4087e2a33c785", "filename": "src/test/ui/traits/vtable/vtable-multi-level.rs", "status": "modified", "additions": 23, "deletions": 2, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multi-level.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multi-level.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multi-level.rs?ref=b5a32d01f4cbc032efa093ff672f1e33087f0efb", "patch": "@@ -12,6 +12,7 @@\n \n #[rustc_dump_vtable]\n trait A {\n+    //~^ error vtable\n     fn foo_a(&self) {}\n }\n \n@@ -23,6 +24,7 @@ trait B {\n \n #[rustc_dump_vtable]\n trait C: A + B {\n+    //~^ error vtable\n     fn foo_c(&self) {}\n }\n \n@@ -115,8 +117,27 @@ impl M for S {}\n impl N for S {}\n impl O for S {}\n \n-fn foo(_: &dyn O) {}\n+macro_rules! monomorphize_vtable {\n+    ($trait:ident) => {{\n+        fn foo(_ : &dyn $trait) {}\n+        foo(&S);\n+    }}\n+}\n \n fn main() {\n-    foo(&S);\n+    monomorphize_vtable!(O);\n+\n+    monomorphize_vtable!(A);\n+    monomorphize_vtable!(B);\n+    monomorphize_vtable!(C);\n+    monomorphize_vtable!(D);\n+    monomorphize_vtable!(E);\n+    monomorphize_vtable!(F);\n+    monomorphize_vtable!(H);\n+    monomorphize_vtable!(I);\n+    monomorphize_vtable!(J);\n+    monomorphize_vtable!(K);\n+    monomorphize_vtable!(L);\n+    monomorphize_vtable!(M);\n+    monomorphize_vtable!(N);\n }"}, {"sha": "c4389e23fc10fbc51fa60423cd76878e648a257a", "filename": "src/test/ui/traits/vtable/vtable-multi-level.stderr", "status": "modified", "additions": 38, "deletions": 13, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multi-level.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multi-level.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multi-level.stderr?ref=b5a32d01f4cbc032efa093ff672f1e33087f0efb", "patch": "@@ -29,29 +29,54 @@ error: vtable entries for `<S as O>`: [\n            TraitVPtr(<S as N>),\n            Method(<S as O>::foo_o),\n        ]\n-  --> $DIR/vtable-multi-level.rs:95:1\n+  --> $DIR/vtable-multi-level.rs:97:1\n    |\n LL | trait O: G + N {\n    | ^^^^^^^^^^^^^^\n \n+error: vtable entries for `<S as A>`: [\n+           MetadataDropInPlace,\n+           MetadataSize,\n+           MetadataAlign,\n+           Method(<S as A>::foo_a),\n+       ]\n+  --> $DIR/vtable-multi-level.rs:14:1\n+   |\n+LL | trait A {\n+   | ^^^^^^^\n+\n error: vtable entries for `<S as B>`: [\n            MetadataDropInPlace,\n            MetadataSize,\n            MetadataAlign,\n            Method(<S as B>::foo_b),\n        ]\n-  --> $DIR/vtable-multi-level.rs:19:1\n+  --> $DIR/vtable-multi-level.rs:20:1\n    |\n LL | trait B {\n    | ^^^^^^^\n \n+error: vtable entries for `<S as C>`: [\n+           MetadataDropInPlace,\n+           MetadataSize,\n+           MetadataAlign,\n+           Method(<S as A>::foo_a),\n+           Method(<S as B>::foo_b),\n+           TraitVPtr(<S as B>),\n+           Method(<S as C>::foo_c),\n+       ]\n+  --> $DIR/vtable-multi-level.rs:26:1\n+   |\n+LL | trait C: A + B {\n+   | ^^^^^^^^^^^^^^\n+\n error: vtable entries for `<S as D>`: [\n            MetadataDropInPlace,\n            MetadataSize,\n            MetadataAlign,\n            Method(<S as D>::foo_d),\n        ]\n-  --> $DIR/vtable-multi-level.rs:30:1\n+  --> $DIR/vtable-multi-level.rs:32:1\n    |\n LL | trait D {\n    | ^^^^^^^\n@@ -62,7 +87,7 @@ error: vtable entries for `<S as E>`: [\n            MetadataAlign,\n            Method(<S as E>::foo_e),\n        ]\n-  --> $DIR/vtable-multi-level.rs:36:1\n+  --> $DIR/vtable-multi-level.rs:38:1\n    |\n LL | trait E {\n    | ^^^^^^^\n@@ -76,7 +101,7 @@ error: vtable entries for `<S as F>`: [\n            TraitVPtr(<S as E>),\n            Method(<S as F>::foo_f),\n        ]\n-  --> $DIR/vtable-multi-level.rs:42:1\n+  --> $DIR/vtable-multi-level.rs:44:1\n    |\n LL | trait F: D + E {\n    | ^^^^^^^^^^^^^^\n@@ -87,7 +112,7 @@ error: vtable entries for `<S as H>`: [\n            MetadataAlign,\n            Method(<S as H>::foo_h),\n        ]\n-  --> $DIR/vtable-multi-level.rs:53:1\n+  --> $DIR/vtable-multi-level.rs:55:1\n    |\n LL | trait H {\n    | ^^^^^^^\n@@ -98,7 +123,7 @@ error: vtable entries for `<S as I>`: [\n            MetadataAlign,\n            Method(<S as I>::foo_i),\n        ]\n-  --> $DIR/vtable-multi-level.rs:59:1\n+  --> $DIR/vtable-multi-level.rs:61:1\n    |\n LL | trait I {\n    | ^^^^^^^\n@@ -112,7 +137,7 @@ error: vtable entries for `<S as J>`: [\n            TraitVPtr(<S as I>),\n            Method(<S as J>::foo_j),\n        ]\n-  --> $DIR/vtable-multi-level.rs:65:1\n+  --> $DIR/vtable-multi-level.rs:67:1\n    |\n LL | trait J: H + I {\n    | ^^^^^^^^^^^^^^\n@@ -123,7 +148,7 @@ error: vtable entries for `<S as K>`: [\n            MetadataAlign,\n            Method(<S as K>::foo_k),\n        ]\n-  --> $DIR/vtable-multi-level.rs:71:1\n+  --> $DIR/vtable-multi-level.rs:73:1\n    |\n LL | trait K {\n    | ^^^^^^^\n@@ -134,7 +159,7 @@ error: vtable entries for `<S as L>`: [\n            MetadataAlign,\n            Method(<S as L>::foo_l),\n        ]\n-  --> $DIR/vtable-multi-level.rs:77:1\n+  --> $DIR/vtable-multi-level.rs:79:1\n    |\n LL | trait L {\n    | ^^^^^^^\n@@ -148,7 +173,7 @@ error: vtable entries for `<S as M>`: [\n            TraitVPtr(<S as L>),\n            Method(<S as M>::foo_m),\n        ]\n-  --> $DIR/vtable-multi-level.rs:83:1\n+  --> $DIR/vtable-multi-level.rs:85:1\n    |\n LL | trait M: K + L {\n    | ^^^^^^^^^^^^^^\n@@ -169,10 +194,10 @@ error: vtable entries for `<S as N>`: [\n            TraitVPtr(<S as M>),\n            Method(<S as N>::foo_n),\n        ]\n-  --> $DIR/vtable-multi-level.rs:89:1\n+  --> $DIR/vtable-multi-level.rs:91:1\n    |\n LL | trait N: J + M {\n    | ^^^^^^^^^^^^^^\n \n-error: aborting due to 12 previous errors\n+error: aborting due to 14 previous errors\n "}, {"sha": "7a0111c5ef2515c88215d1957a8456a91a45aa0e", "filename": "src/test/ui/traits/vtable/vtable-multiple.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multiple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a32d01f4cbc032efa093ff672f1e33087f0efb/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multiple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fvtable%2Fvtable-multiple.rs?ref=b5a32d01f4cbc032efa093ff672f1e33087f0efb", "patch": "@@ -25,7 +25,9 @@ impl B for S {}\n impl C for S {}\n \n fn foo(c: &dyn C) {}\n+fn bar(c: &dyn B) {}\n \n fn main() {\n     foo(&S);\n+    bar(&S);\n }"}]}