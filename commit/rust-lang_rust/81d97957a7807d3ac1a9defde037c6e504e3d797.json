{"sha": "81d97957a7807d3ac1a9defde037c6e504e3d797", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxZDk3OTU3YTc4MDdkM2FjMWE5ZGVmZGUwMzdjNmU1MDRlM2Q3OTc=", "commit": {"author": {"name": "Josh Stone", "email": "cuviper@gmail.com", "date": "2016-10-19T15:21:00Z"}, "committer": {"name": "Josh Stone", "email": "cuviper@gmail.com", "date": "2016-10-19T15:21:00Z"}, "message": "Detect local-rebuild by just the MAJOR.MINOR version\n\nA new point-release shouldn't change any language semantics, so a local\nstage0 that matches MAJOR.MINOR version should still be considered a\nlocal-rebuild as far as `--cfg stageN` features go.\n\ne.g. `1.14.0` should be considered a local-rebuild for any `1.14.X`.\n\n(Bootstrap keys used to be an issue too, until #37265.)", "tree": {"sha": "5ed3df2f4c9935b66467eb95642035fd43b1d2ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ed3df2f4c9935b66467eb95642035fd43b1d2ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/81d97957a7807d3ac1a9defde037c6e504e3d797", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/81d97957a7807d3ac1a9defde037c6e504e3d797", "html_url": "https://github.com/rust-lang/rust/commit/81d97957a7807d3ac1a9defde037c6e504e3d797", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/81d97957a7807d3ac1a9defde037c6e504e3d797/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a41505f4f4a93bf94f4f7439d41afd826ab20b94", "url": "https://api.github.com/repos/rust-lang/rust/commits/a41505f4f4a93bf94f4f7439d41afd826ab20b94", "html_url": "https://github.com/rust-lang/rust/commit/a41505f4f4a93bf94f4f7439d41afd826ab20b94"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "f56e02e2584376b27d9dcabb517b1286e27024f4", "filename": "mk/main.mk", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/81d97957a7807d3ac1a9defde037c6e504e3d797/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/81d97957a7807d3ac1a9defde037c6e504e3d797/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=81d97957a7807d3ac1a9defde037c6e504e3d797", "patch": "@@ -53,11 +53,12 @@ endif\n # versions in the same place\n CFG_FILENAME_EXTRA=$(shell printf '%s' $(CFG_RELEASE)$(CFG_EXTRA_FILENAME) | $(CFG_HASH_COMMAND))\n \n-# If local-rust is the same as the current version, then force a local-rebuild\n+# If local-rust is the same major.minor as the current version, then force a local-rebuild\n ifdef CFG_ENABLE_LOCAL_RUST\n-ifeq ($(CFG_RELEASE),\\\n-      $(shell $(S)src/etc/local_stage0.sh --print-rustc-release $(CFG_LOCAL_RUST_ROOT)))\n-    CFG_INFO := $(info cfg: auto-detected local-rebuild $(CFG_RELEASE))\n+SEMVER_PREFIX=$(shell echo $(CFG_RELEASE_NUM) | grep -E -o '^[[:digit:]]+\\.[[:digit:]]+')\n+LOCAL_RELEASE=$(shell $(S)src/etc/local_stage0.sh --print-rustc-release $(CFG_LOCAL_RUST_ROOT))\n+ifneq (,$(filter $(SEMVER_PREFIX).%,$(LOCAL_RELEASE)))\n+    CFG_INFO := $(info cfg: auto-detected local-rebuild using $(LOCAL_RELEASE))\n     CFG_ENABLE_LOCAL_REBUILD = 1\n endif\n endif"}, {"sha": "60dca2998463049d51945e674d7014c9cf54eab5", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/81d97957a7807d3ac1a9defde037c6e504e3d797/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/81d97957a7807d3ac1a9defde037c6e504e3d797/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=81d97957a7807d3ac1a9defde037c6e504e3d797", "patch": "@@ -220,14 +220,14 @@ impl Build {\n         sanity::check(self);\n         self.verbose(\"collecting channel variables\");\n         channel::collect(self);\n-        // If local-rust is the same as the current version, then force a local-rebuild\n+        // If local-rust is the same major.minor as the current version, then force a local-rebuild\n         let local_version_verbose = output(\n             Command::new(&self.rustc).arg(\"--version\").arg(\"--verbose\"));\n         let local_release = local_version_verbose\n             .lines().filter(|x| x.starts_with(\"release:\"))\n             .next().unwrap().trim_left_matches(\"release:\").trim();\n-        if local_release == self.release {\n-            self.verbose(&format!(\"auto-detected local-rebuild {}\", self.release));\n+        if local_release.split('.').take(2).eq(self.release.split('.').take(2)) {\n+            self.verbose(&format!(\"auto-detected local-rebuild {}\", local_release));\n             self.local_rebuild = true;\n         }\n         self.verbose(\"updating submodules\");"}]}