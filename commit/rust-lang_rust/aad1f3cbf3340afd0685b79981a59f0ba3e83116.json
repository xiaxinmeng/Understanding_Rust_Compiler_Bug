{"sha": "aad1f3cbf3340afd0685b79981a59f0ba3e83116", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhZDFmM2NiZjMzNDBhZmQwNjg1Yjc5OTgxYTU5ZjBiYTNlODMxMTY=", "commit": {"author": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-08-18T20:33:24Z"}, "committer": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-09-01T22:30:24Z"}, "message": "item_like_imports: Allow glob imports to be shadowed by items and single imports.", "tree": {"sha": "5ad0df65c529ca576c3f64aed5aed89cdae13894", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ad0df65c529ca576c3f64aed5aed89cdae13894"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aad1f3cbf3340afd0685b79981a59f0ba3e83116", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aad1f3cbf3340afd0685b79981a59f0ba3e83116", "html_url": "https://github.com/rust-lang/rust/commit/aad1f3cbf3340afd0685b79981a59f0ba3e83116", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aad1f3cbf3340afd0685b79981a59f0ba3e83116/comments", "author": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efc0bea687a6c412b7d11acab12ada8e33050089", "url": "https://api.github.com/repos/rust-lang/rust/commits/efc0bea687a6c412b7d11acab12ada8e33050089", "html_url": "https://github.com/rust-lang/rust/commit/efc0bea687a6c412b7d11acab12ada8e33050089"}], "stats": {"total": 62, "additions": 55, "deletions": 7}, "files": [{"sha": "c7cb3a351784dff8b6288314cfe656e13e6e2375", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/aad1f3cbf3340afd0685b79981a59f0ba3e83116/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aad1f3cbf3340afd0685b79981a59f0ba3e83116/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=aad1f3cbf3340afd0685b79981a59f0ba3e83116", "patch": "@@ -690,15 +690,21 @@ impl<'a, 'b:'a> ImportResolver<'a, 'b> {\n             };\n \n             // Report conflicts\n-            for duplicate_glob in resolution.duplicate_globs.iter() {\n-                // FIXME #31337: We currently allow items to shadow glob-imported re-exports.\n-                if !binding.is_import() {\n-                    if let NameBindingKind::Import { binding, .. } = duplicate_glob.kind {\n-                        if binding.is_import() { continue }\n+            if !self.new_import_semantics {\n+                for duplicate_glob in resolution.duplicate_globs.iter() {\n+                    // FIXME #31337: We currently allow items to shadow glob-imported re-exports.\n+                    if !binding.is_import() {\n+                        if let NameBindingKind::Import { binding, .. } = duplicate_glob.kind {\n+                            if binding.is_import() { continue }\n+                        }\n                     }\n-                }\n \n-                self.report_conflict(module, name, ns, duplicate_glob, binding);\n+                    self.report_conflict(module, name, ns, duplicate_glob, binding);\n+                }\n+            } else if binding.is_glob_import() {\n+                for duplicate_glob in resolution.duplicate_globs.iter() {\n+                    self.report_conflict(module, name, ns, duplicate_glob, binding);\n+                }\n             }\n \n             if binding.vis == ty::Visibility::Public &&"}, {"sha": "df4961c074ae1279eb1be6d6196c9e790b608562", "filename": "src/test/run-pass/imports.rs", "status": "modified", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/aad1f3cbf3340afd0685b79981a59f0ba3e83116/src%2Ftest%2Frun-pass%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aad1f3cbf3340afd0685b79981a59f0ba3e83116/src%2Ftest%2Frun-pass%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fimports.rs?ref=aad1f3cbf3340afd0685b79981a59f0ba3e83116", "patch": "@@ -21,4 +21,46 @@ mod a {\n     }\n }\n \n+mod foo { pub fn f() {} }\n+mod bar { pub fn f() {} }\n+\n+pub fn f() -> bool { true }\n+\n+// Items and explicit imports shadow globs.\n+fn g() {\n+    use foo::*;\n+    use bar::*;\n+    fn f() -> bool { true }\n+    let _: bool = f();\n+}\n+\n+fn h() {\n+    use foo::*;\n+    use bar::*;\n+    use f;\n+    let _: bool = f();\n+}\n+\n+// Here, there appears to be shadowing but isn't because of namespaces.\n+mod b {\n+    use foo::*; // This imports `f` in the value namespace.\n+    use super::b as f; // This imports `f` only in the type namespace,\n+    fn test() { self::f(); } // so the glob isn't shadowed.\n+}\n+\n+// Here, there is shadowing in one namespace, but not the other.\n+mod c {\n+    mod test {\n+        pub fn f() {}\n+        pub mod f {}\n+    }\n+    use self::test::*; // This glob-imports `f` in both namespaces.\n+    mod f { pub fn f() {} } // This shadows the glob only in the value namespace.\n+\n+    fn test() {\n+        self::f(); // Check that the glob-imported value isn't shadowed.\n+        self::f::f(); // Check that the glob-imported module is shadowed.\n+    }\n+}\n+\n fn main() {}"}]}