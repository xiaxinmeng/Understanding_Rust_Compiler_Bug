{"sha": "1f48465a0147769cfe6487212862a66518663fed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFmNDg0NjVhMDE0Nzc2OWNmZTY0ODcyMTI4NjJhNjY1MTg2NjNmZWQ=", "commit": {"author": {"name": "Christian Poveda", "email": "git@christianpoveda.xyz", "date": "2020-06-15T17:05:24Z"}, "committer": {"name": "Christian Poveda", "email": "git@christianpoveda.xyz", "date": "2020-06-19T16:48:46Z"}, "message": "update diagnostics for &mut in constants", "tree": {"sha": "608e581f7c1a2d0112dcc000824a52407dc00e3f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/608e581f7c1a2d0112dcc000824a52407dc00e3f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1f48465a0147769cfe6487212862a66518663fed", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYIAB0WIQRsB8A/3NrzTlMMjT0nUl7150IKUAUCXuzsbgAKCRAnUl7150IK\nUHk7AP9vJ05wOFtdMBaXUQiH6pSckY1D931TJub8jbko8sy+5wEA0ECxXIEKkVN7\naSyWZNsXGIQFKTxW5vjkVLpoQIzn5gQ=\n=5Lun\n-----END PGP SIGNATURE-----", "payload": "tree 608e581f7c1a2d0112dcc000824a52407dc00e3f\nparent 014e60587070dea266ae9133b879a9ef3409208b\nauthor Christian Poveda <git@christianpoveda.xyz> 1592240724 -0500\ncommitter Christian Poveda <git@christianpoveda.xyz> 1592585326 -0500\n\nupdate diagnostics for &mut in constants\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1f48465a0147769cfe6487212862a66518663fed", "html_url": "https://github.com/rust-lang/rust/commit/1f48465a0147769cfe6487212862a66518663fed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1f48465a0147769cfe6487212862a66518663fed/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "014e60587070dea266ae9133b879a9ef3409208b", "url": "https://api.github.com/repos/rust-lang/rust/commits/014e60587070dea266ae9133b879a9ef3409208b", "html_url": "https://github.com/rust-lang/rust/commit/014e60587070dea266ae9133b879a9ef3409208b"}], "stats": {"total": 291, "additions": 111, "deletions": 180}, "files": [{"sha": "5e3bd2c1d3de8f8e93a7a94a1b86821c9515131d", "filename": "src/librustc_mir/transform/check_consts/ops.rs", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -216,17 +216,23 @@ impl NonConstOp for MutBorrow {\n     }\n \n     fn emit_error(&self, ccx: &ConstCx<'_, '_>, span: Span) {\n-        let mut err = feature_err(\n-            &ccx.tcx.sess.parse_sess,\n-            sym::const_mut_refs,\n-            span,\n-            &format!(\n-                \"references in {}s may only refer \\\n-                      to immutable values\",\n-                ccx.const_kind()\n-            ),\n-        );\n-        err.span_label(span, format!(\"{}s require immutable values\", ccx.const_kind()));\n+        let mut err = if ccx.const_kind() == hir::ConstContext::ConstFn {\n+            feature_err(\n+                &ccx.tcx.sess.parse_sess,\n+                sym::const_mut_refs,\n+                span,\n+                &format!(\"mutable references are not allowed in {}s\", ccx.const_kind()),\n+            )\n+        } else {\n+            struct_span_err!(\n+                ccx.tcx.sess,\n+                span,\n+                E0019,\n+                \"mutable references are not allowed in {}s\",\n+                ccx.const_kind(),\n+            )\n+        };\n+        err.span_label(span, \"`&mut` is only allowed in `const fn`\".to_string());\n         if ccx.tcx.sess.teach(&err.get_code().unwrap()) {\n             err.note(\n                 \"References in statics and constants may only refer \\"}, {"sha": "00aca1d14baa7ec4e3e3454f549c2ba90dc7dec8", "filename": "src/test/compile-fail/issue-52443.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fcompile-fail%2Fissue-52443.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fcompile-fail%2Fissue-52443.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-52443.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -9,7 +9,7 @@ fn main() {\n     [(); { for _ in 0usize.. {}; 0}];\n     //~^ ERROR `for` is not allowed in a `const`\n     //~| ERROR calls in constants are limited to constant functions\n-    //~| ERROR references in constants may only refer to immutable values\n+    //~| ERROR mutable references are not allowed in constants\n     //~| ERROR calls in constants are limited to constant functions\n     //~| ERROR evaluation of constant value failed\n }"}, {"sha": "3be02f6a0f674cedc3fcca37b8a18647ec439230", "filename": "src/test/ui/check-static-immutable-mut-slices.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fcheck-static-immutable-mut-slices.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fcheck-static-immutable-mut-slices.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-static-immutable-mut-slices.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,6 +1,6 @@\n // Checks that immutable static items can't have mutable slices\n \n static TEST: &'static mut [isize] = &mut [];\n-//~^ ERROR references in statics may only refer to immutable values\n+//~^ ERROR mutable references are not allowed in statics\n \n pub fn main() { }"}, {"sha": "855f6dda18293822c006545eff4539aec14ce30e", "filename": "src/test/ui/check-static-immutable-mut-slices.stderr", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fcheck-static-immutable-mut-slices.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fcheck-static-immutable-mut-slices.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-static-immutable-mut-slices.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,12 +1,9 @@\n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/check-static-immutable-mut-slices.rs:3:37\n    |\n LL | static TEST: &'static mut [isize] = &mut [];\n-   |                                     ^^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                     ^^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0658`.\n+For more information about this error, try `rustc --explain E0019`."}, {"sha": "2518e4ed40b30bf161644840f9e77736f8a6d857", "filename": "src/test/ui/consts/const-eval/issue-65394.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -5,7 +5,7 @@\n \n const _: Vec<i32> = {\n     let mut x = Vec::<i32>::new(); //~ ERROR destructors cannot be evaluated at compile-time\n-    let r = &mut x; //~ ERROR references in constants may only refer to immutable values\n+    let r = &mut x; //~ ERROR mutable references are not allowed in constants\n     let y = x;\n     y\n };"}, {"sha": "827af6d832df820ae69ab601f20e3347121eddaf", "filename": "src/test/ui/consts/const-eval/issue-65394.stderr", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/issue-65394.rs:8:13\n    |\n LL |     let r = &mut x;\n-   |             ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |             ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0493]: destructors cannot be evaluated at compile-time\n   --> $DIR/issue-65394.rs:7:9\n@@ -15,5 +12,5 @@ LL |     let mut x = Vec::<i32>::new();\n \n error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0493, E0658.\n-For more information about an error, try `rustc --explain E0493`.\n+Some errors have detailed explanations: E0019, E0493.\n+For more information about an error, try `rustc --explain E0019`."}, {"sha": "18645efc8871505c7292ec1b4ad8ecab8dd1ac9a", "filename": "src/test/ui/consts/const-multi-ref.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -3,7 +3,7 @@\n \n const _: i32 = {\n     let mut a = 5;\n-    let p = &mut a; //~ ERROR references in constants may only refer to immutable values\n+    let p = &mut a; //~ ERROR mutable references are not allowed in constants\n \n     let reborrow = {p};\n     let pp = &reborrow;"}, {"sha": "84ff5457eef198fd2e1eaf67d1cd9a0599760efd", "filename": "src/test/ui/consts/const-multi-ref.stderr", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const-multi-ref.rs:6:13\n    |\n LL |     let p = &mut a;\n-   |             ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |             ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0492]: cannot borrow a constant which may contain interior mutability, create a static instead\n   --> $DIR/const-multi-ref.rs:16:13\n@@ -15,5 +12,5 @@ LL |     let p = &a;\n \n error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0492, E0658.\n-For more information about an error, try `rustc --explain E0492`.\n+Some errors have detailed explanations: E0019, E0492.\n+For more information about an error, try `rustc --explain E0019`."}, {"sha": "5819daa817af04cce4c45d3f3991fb868072031d", "filename": "src/test/ui/consts/const-mut-refs/const_mut_address_of.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_address_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_address_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_address_of.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -22,9 +22,9 @@ const fn baz(foo: &mut Foo)-> *mut usize {\n \n const _: () = {\n     foo().bar();\n-    //~^ ERROR references in constants may only refer to immutable values\n+    //~^ ERROR mutable references are not allowed in constants\n     baz(&mut foo());\n-    //~^ ERROR references in constants may only refer to immutable values\n+    //~^ ERROR mutable references are not allowed in constants\n };\n \n fn main() {}"}, {"sha": "3940ce236a3ed3ebac683b281113eb3150822c2c", "filename": "src/test/ui/consts/const-mut-refs/const_mut_address_of.stderr", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_address_of.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_address_of.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_address_of.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,21 +1,15 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const_mut_address_of.rs:24:5\n    |\n LL |     foo().bar();\n-   |     ^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |     ^^^^^ `&mut` is only allowed in `const fn`\n \n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const_mut_address_of.rs:26:9\n    |\n LL |     baz(&mut foo());\n-   |         ^^^^^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |         ^^^^^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0658`.\n+For more information about this error, try `rustc --explain E0019`."}, {"sha": "9099d5a1b8ea642367d3f713984c5013268ed8ab", "filename": "src/test/ui/consts/const-mut-refs/const_mut_refs.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_refs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_refs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_refs.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -29,9 +29,9 @@ const fn bazz(foo: &mut Foo) -> usize {\n \n fn main() {\n     let _: [(); foo().bar()] = [(); 1];\n-    //~^ ERROR references in constants may only refer to immutable values\n+    //~^ ERROR mutable references are not allowed in constants\n     let _: [(); baz(&mut foo())] = [(); 2];\n-    //~^ ERROR references in constants may only refer to immutable values\n+    //~^ ERROR mutable references are not allowed in constants\n     let _: [(); bazz(&mut foo())] = [(); 3];\n-    //~^ ERROR references in constants may only refer to immutable values\n+    //~^ ERROR mutable references are not allowed in constants\n }"}, {"sha": "39d0a391bab1898598bae829d0a759bfaf3b8649", "filename": "src/test/ui/consts/const-mut-refs/const_mut_refs.stderr", "status": "modified", "additions": 7, "deletions": 16, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_refs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_refs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-mut-refs%2Fconst_mut_refs.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,30 +1,21 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const_mut_refs.rs:31:17\n    |\n LL |     let _: [(); foo().bar()] = [(); 1];\n-   |                 ^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                 ^^^^^ `&mut` is only allowed in `const fn`\n \n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const_mut_refs.rs:33:21\n    |\n LL |     let _: [(); baz(&mut foo())] = [(); 2];\n-   |                     ^^^^^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                     ^^^^^^^^^^ `&mut` is only allowed in `const fn`\n \n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const_mut_refs.rs:35:22\n    |\n LL |     let _: [(); bazz(&mut foo())] = [(); 3];\n-   |                      ^^^^^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                      ^^^^^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to 3 previous errors\n \n-For more information about this error, try `rustc --explain E0658`.\n+For more information about this error, try `rustc --explain E0019`."}, {"sha": "f993a427b4899dbf591ac718ace8bd7553f3ae79", "filename": "src/test/ui/consts/const_let_assign3.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -13,14 +13,14 @@ impl S {\n \n const FOO: S = {\n     let mut s = S { state: 42 };\n-    s.foo(3); //~ ERROR references in constants may only refer to immutable values\n+    s.foo(3); //~ ERROR mutable references are not allowed in constants\n     s\n };\n \n type Array = [u32; {\n     let mut x = 2;\n     let y = &mut x;\n-//~^ ERROR references in constants may only refer to immutable values\n+//~^ ERROR mutable references are not allowed in constants\n     *y = 42;\n //~^ ERROR constant contains unimplemented expression type\n     *y"}, {"sha": "a5810e60a09d2f697af0f20811ce05d081e2b3a9", "filename": "src/test/ui/consts/const_let_assign3.stderr", "status": "modified", "additions": 5, "deletions": 12, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -6,23 +6,17 @@ LL |         self.state = x;\n    |\n    = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const_let_assign3.rs:16:5\n    |\n LL |     s.foo(3);\n-   |     ^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |     ^ `&mut` is only allowed in `const fn`\n \n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/const_let_assign3.rs:22:13\n    |\n LL |     let y = &mut x;\n-   |             ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |             ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0019]: constant contains unimplemented expression type\n   --> $DIR/const_let_assign3.rs:24:5\n@@ -34,5 +28,4 @@ LL |     *y = 42;\n \n error: aborting due to 4 previous errors\n \n-Some errors have detailed explanations: E0019, E0658.\n-For more information about an error, try `rustc --explain E0019`.\n+For more information about this error, try `rustc --explain E0019`."}, {"sha": "e84c86f5a78be42b48a4ed0831513210e1e86cc0", "filename": "src/test/ui/consts/projection_qualif.mut_refs.stderr", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.mut_refs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.mut_refs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.mut_refs.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/projection_qualif.rs:10:27\n    |\n LL |         let b: *mut u32 = &mut a;\n-   |                           ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                           ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0658]: dereferencing raw pointers in constants is unstable\n   --> $DIR/projection_qualif.rs:11:18\n@@ -18,4 +15,5 @@ LL |         unsafe { *b = 5; }\n \n error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0658`.\n+Some errors have detailed explanations: E0019, E0658.\n+For more information about an error, try `rustc --explain E0019`."}, {"sha": "7db970cf1379f4aebc0e9ea9e6cd43fc27feb05d", "filename": "src/test/ui/consts/projection_qualif.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -7,7 +7,7 @@ use std::cell::Cell;\n const FOO: &u32 = {\n     let mut a = 42;\n     {\n-        let b: *mut u32 = &mut a; //~ ERROR may only refer to immutable values\n+        let b: *mut u32 = &mut a; //~ ERROR mutable references are not allowed in constants\n         unsafe { *b = 5; } //~ ERROR dereferencing raw pointers in constants\n         //[stock]~^ contains unimplemented expression\n     }"}, {"sha": "01e12e186fe59f01cfc5cb0e778e6dc85340e4d6", "filename": "src/test/ui/consts/projection_qualif.stock.stderr", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.stock.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.stock.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.stock.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/projection_qualif.rs:10:27\n    |\n LL |         let b: *mut u32 = &mut a;\n-   |                           ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                           ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0658]: dereferencing raw pointers in constants is unstable\n   --> $DIR/projection_qualif.rs:11:18"}, {"sha": "5faa983ab09f71cc0e9ebabcea6f6d0df7daf80f", "filename": "src/test/ui/consts/read_from_static_mut_ref.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fread_from_static_mut_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fread_from_static_mut_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fread_from_static_mut_ref.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,8 +1,9 @@\n+// We are keeping this test in case we decide to allow mutable references in statics again\n #![feature(const_mut_refs)]\n #![allow(const_err)]\n \n static OH_NO: &mut i32 = &mut 42;\n-//~^ ERROR references in statics may only refer to immutable values\n+//~^ ERROR mutable references are not allowed in statics\n fn main() {\n     assert_eq!(*OH_NO, 42);\n }"}, {"sha": "c51ddae23d8d12aa291b36fc5b7017d3a41a84e6", "filename": "src/test/ui/consts/read_from_static_mut_ref.stderr", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fread_from_static_mut_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fread_from_static_mut_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fread_from_static_mut_ref.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,12 +1,9 @@\n-error[E0658]: references in statics may only refer to immutable values\n-  --> $DIR/read_from_static_mut_ref.rs:4:26\n+error[E0019]: mutable references are not allowed in statics\n+  --> $DIR/read_from_static_mut_ref.rs:5:26\n    |\n LL | static OH_NO: &mut i32 = &mut 42;\n-   |                          ^^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                          ^^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0658`.\n+For more information about this error, try `rustc --explain E0019`."}, {"sha": "2c6abb3a4ed62d5c18bd26dd6c8a8c985a7b00d5", "filename": "src/test/ui/consts/static_mut_containing_mut_ref2.mut_refs.stderr", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.mut_refs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.mut_refs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.mut_refs.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,12 +1,9 @@\n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/static_mut_containing_mut_ref2.rs:7:46\n    |\n LL | pub static mut STDERR_BUFFER: () = unsafe { *(&mut STDERR_BUFFER_SPACE) = 42; };\n-   |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0658`.\n+For more information about this error, try `rustc --explain E0019`."}, {"sha": "a6bbe8d6ec24c1b15c1312f30a51f433aedd2b6d", "filename": "src/test/ui/consts/static_mut_containing_mut_ref2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -5,7 +5,7 @@\n static mut STDERR_BUFFER_SPACE: u8 = 0;\n \n pub static mut STDERR_BUFFER: () = unsafe { *(&mut STDERR_BUFFER_SPACE) = 42; };\n-//~^ ERROR references in statics may only refer to immutable values\n+//~^ ERROR  mutable references are not allowed in statics\n //[stock]~| ERROR static contains unimplemented expression type\n \n fn main() {}"}, {"sha": "47c9401704ce564b33d006c5a2475f01eb5e0f64", "filename": "src/test/ui/consts/static_mut_containing_mut_ref2.stock.stderr", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.stock.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.stock.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.stock.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/static_mut_containing_mut_ref2.rs:7:46\n    |\n LL | pub static mut STDERR_BUFFER: () = unsafe { *(&mut STDERR_BUFFER_SPACE) = 42; };\n-   |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0019]: static contains unimplemented expression type\n   --> $DIR/static_mut_containing_mut_ref2.rs:7:45\n@@ -17,5 +14,4 @@ LL | pub static mut STDERR_BUFFER: () = unsafe { *(&mut STDERR_BUFFER_SPACE) = 4\n \n error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0019, E0658.\n-For more information about an error, try `rustc --explain E0019`.\n+For more information about this error, try `rustc --explain E0019`."}, {"sha": "8e6de93f440000c7f4755df9f2af16401efc6c79", "filename": "src/test/ui/error-codes/E0017.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0017.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0017.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0017.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -2,10 +2,10 @@ static X: i32 = 1;\n const C: i32 = 2;\n static mut M: i32 = 3;\n \n-const CR: &'static mut i32 = &mut C; //~ ERROR E0658\n-static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0658\n+const CR: &'static mut i32 = &mut C; //~ ERROR E0019\n+static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0019\n                                               //~| ERROR E0019\n                                               //~| ERROR cannot borrow\n-static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0658\n-static STATIC_MUT_REF: &'static mut i32 = unsafe { &mut M }; //~ ERROR E0658\n+static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0019\n+static STATIC_MUT_REF: &'static mut i32 = unsafe { &mut M }; //~ ERROR E0019\n fn main() {}"}, {"sha": "d952afa2521a514a1531829377dbed9f306d04b3", "filename": "src/test/ui/error-codes/E0017.stderr", "status": "modified", "additions": 9, "deletions": 21, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0017.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0017.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0017.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/E0017.rs:5:30\n    |\n LL | const CR: &'static mut i32 = &mut C;\n-   |                              ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                              ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0019]: static contains unimplemented expression type\n   --> $DIR/E0017.rs:6:39\n@@ -15,40 +12,31 @@ LL | static STATIC_REF: &'static mut i32 = &mut X;\n    |\n    = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/E0017.rs:6:39\n    |\n LL | static STATIC_REF: &'static mut i32 = &mut X;\n-   |                                       ^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                       ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0596]: cannot borrow immutable static item `X` as mutable\n   --> $DIR/E0017.rs:6:39\n    |\n LL | static STATIC_REF: &'static mut i32 = &mut X;\n    |                                       ^^^^^^ cannot borrow as mutable\n \n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/E0017.rs:9:38\n    |\n LL | static CONST_REF: &'static mut i32 = &mut C;\n-   |                                      ^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                      ^^^^^^ `&mut` is only allowed in `const fn`\n \n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/E0017.rs:10:52\n    |\n LL | static STATIC_MUT_REF: &'static mut i32 = unsafe { &mut M };\n-   |                                                    ^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                                    ^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to 6 previous errors\n \n-Some errors have detailed explanations: E0019, E0596, E0658.\n+Some errors have detailed explanations: E0019, E0596.\n For more information about an error, try `rustc --explain E0019`."}, {"sha": "90ea8649b8b63f12ed9775913c5dda3b549387c1", "filename": "src/test/ui/error-codes/E0388.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0388.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0388.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0388.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,10 +1,10 @@\n static X: i32 = 1;\n const C: i32 = 2;\n \n-const CR: &'static mut i32 = &mut C; //~ ERROR E0658\n-static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0658\n+const CR: &'static mut i32 = &mut C; //~ ERROR E0019\n+static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0019\n                                               //~| ERROR cannot borrow\n                                               //~| ERROR E0019\n-static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0658\n+static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0019\n \n fn main() {}"}, {"sha": "04b3d9542509c1725228b0e0b42288f2306db641", "filename": "src/test/ui/error-codes/E0388.stderr", "status": "modified", "additions": 7, "deletions": 16, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0388.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Ferror-codes%2FE0388.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0388.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/E0388.rs:4:30\n    |\n LL | const CR: &'static mut i32 = &mut C;\n-   |                              ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                              ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0019]: static contains unimplemented expression type\n   --> $DIR/E0388.rs:5:39\n@@ -15,31 +12,25 @@ LL | static STATIC_REF: &'static mut i32 = &mut X;\n    |\n    = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/E0388.rs:5:39\n    |\n LL | static STATIC_REF: &'static mut i32 = &mut X;\n-   |                                       ^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                       ^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0596]: cannot borrow immutable static item `X` as mutable\n   --> $DIR/E0388.rs:5:39\n    |\n LL | static STATIC_REF: &'static mut i32 = &mut X;\n    |                                       ^^^^^^ cannot borrow as mutable\n \n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/E0388.rs:8:38\n    |\n LL | static CONST_REF: &'static mut i32 = &mut C;\n-   |                                      ^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                      ^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to 5 previous errors\n \n-Some errors have detailed explanations: E0019, E0596, E0658.\n+Some errors have detailed explanations: E0019, E0596.\n For more information about an error, try `rustc --explain E0019`."}, {"sha": "49023f18ddbfbfb35c1f75e90228604001b2c219", "filename": "src/test/ui/issues/issue-17718-const-bad-values.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,10 +1,10 @@\n const C1: &'static mut [usize] = &mut [];\n-//~^ ERROR: references in constants may only refer to immutable values\n+//~^ ERROR: mutable references are not allowed in constants\n \n static mut S: usize = 3;\n const C2: &'static mut usize = unsafe { &mut S };\n //~^ ERROR: constants cannot refer to statics\n //~| ERROR: constants cannot refer to statics\n-//~| ERROR: references in constants may only refer to immutable values\n+//~| ERROR: mutable references are not allowed in constants\n \n fn main() {}"}, {"sha": "b62adbd849396cd2c50e2810e4c352e38213a701", "filename": "src/test/ui/issues/issue-17718-const-bad-values.stderr", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/issue-17718-const-bad-values.rs:1:34\n    |\n LL | const C1: &'static mut [usize] = &mut [];\n-   |                                  ^^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                  ^^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-17718-const-bad-values.rs:5:46\n@@ -23,16 +20,13 @@ LL | const C2: &'static mut usize = unsafe { &mut S };\n    |\n    = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n-error[E0658]: references in constants may only refer to immutable values\n+error[E0019]: mutable references are not allowed in constants\n   --> $DIR/issue-17718-const-bad-values.rs:5:41\n    |\n LL | const C2: &'static mut usize = unsafe { &mut S };\n-   |                                         ^^^^^^ constants require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                                         ^^^^^^ `&mut` is only allowed in `const fn`\n \n error: aborting due to 4 previous errors\n \n-Some errors have detailed explanations: E0013, E0658.\n+Some errors have detailed explanations: E0013, E0019.\n For more information about an error, try `rustc --explain E0013`."}, {"sha": "3eba1bb20bd9ae454848a1113509e2d2d2ca15e1", "filename": "src/test/ui/issues/issue-46604.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-46604.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-46604.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-46604.rs?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,4 +1,4 @@\n-static buf: &mut [u8] = &mut [1u8,2,3,4,5,7];   //~ ERROR E0658\n+static buf: &mut [u8] = &mut [1u8,2,3,4,5,7];   //~ ERROR E0019\n fn write<T: AsRef<[u8]>>(buffer: T) { }\n \n fn main() {"}, {"sha": "b0acf9936c5c811dffcb4eedcf8e2561d635a5a5", "filename": "src/test/ui/issues/issue-46604.stderr", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-46604.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f48465a0147769cfe6487212862a66518663fed/src%2Ftest%2Fui%2Fissues%2Fissue-46604.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-46604.stderr?ref=1f48465a0147769cfe6487212862a66518663fed", "patch": "@@ -1,11 +1,8 @@\n-error[E0658]: references in statics may only refer to immutable values\n+error[E0019]: mutable references are not allowed in statics\n   --> $DIR/issue-46604.rs:1:25\n    |\n LL | static buf: &mut [u8] = &mut [1u8,2,3,4,5,7];\n-   |                         ^^^^^^^^^^^^^^^^^^^^ statics require immutable values\n-   |\n-   = note: see issue #57349 <https://github.com/rust-lang/rust/issues/57349> for more information\n-   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n+   |                         ^^^^^^^^^^^^^^^^^^^^ `&mut` is only allowed in `const fn`\n \n error[E0594]: cannot assign to `buf[_]`, as `buf` is an immutable static item\n   --> $DIR/issue-46604.rs:6:5\n@@ -15,5 +12,5 @@ LL |     buf[0]=2;\n \n error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0594, E0658.\n-For more information about an error, try `rustc --explain E0594`.\n+Some errors have detailed explanations: E0019, E0594.\n+For more information about an error, try `rustc --explain E0019`."}]}