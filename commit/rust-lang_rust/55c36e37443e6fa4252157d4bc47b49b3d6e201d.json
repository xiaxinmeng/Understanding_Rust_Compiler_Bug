{"sha": "55c36e37443e6fa4252157d4bc47b49b3d6e201d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1YzM2ZTM3NDQzZTZmYTQyNTIxNTdkNGJjNDdiNDliM2Q2ZTIwMWQ=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2018-02-11T01:18:41Z"}, "committer": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2018-02-11T01:18:41Z"}, "message": "Remove DontDistWithMiri struct and instead just directly check it in builder", "tree": {"sha": "5b1679332343d7b59c3eb21ffaad7d0ed167081f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5b1679332343d7b59c3eb21ffaad7d0ed167081f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/55c36e37443e6fa4252157d4bc47b49b3d6e201d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/55c36e37443e6fa4252157d4bc47b49b3d6e201d", "html_url": "https://github.com/rust-lang/rust/commit/55c36e37443e6fa4252157d4bc47b49b3d6e201d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/55c36e37443e6fa4252157d4bc47b49b3d6e201d/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11580b7be3a830ccea569b64545ec77008c452ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/11580b7be3a830ccea569b64545ec77008c452ac", "html_url": "https://github.com/rust-lang/rust/commit/11580b7be3a830ccea569b64545ec77008c452ac"}], "stats": {"total": 34, "additions": 7, "deletions": 27}, "files": [{"sha": "32cc1d7223dbe78ac7cafa4216f27bd2f08e44d5", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/55c36e37443e6fa4252157d4bc47b49b3d6e201d/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55c36e37443e6fa4252157d4bc47b49b3d6e201d/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=55c36e37443e6fa4252157d4bc47b49b3d6e201d", "patch": "@@ -286,8 +286,7 @@ impl<'a> Builder<'a> {\n                 doc::Reference, doc::Rustdoc, doc::RustByExample, doc::CargoBook),\n             Kind::Dist => describe!(dist::Docs, dist::Mingw, dist::Rustc, dist::DebuggerScripts,\n                 dist::Std, dist::Analysis, dist::Src, dist::PlainSourceTarball, dist::Cargo,\n-                dist::Rls, dist::Rustfmt, dist::Extended, dist::HashSign,\n-                dist::DontDistWithMiriEnabled),\n+                dist::Rls, dist::Rustfmt, dist::Extended, dist::HashSign),\n             Kind::Install => describe!(install::Docs, install::Std, install::Cargo, install::Rls,\n                 install::Rustfmt, install::Analysis, install::Src, install::Rustc),\n         }\n@@ -344,6 +343,12 @@ impl<'a> Builder<'a> {\n             stack: RefCell::new(Vec::new()),\n         };\n \n+        if kind == Kind::Dist {\n+            assert!(!build.config.test_miri, \"Do not distribute with miri enabled.\\n\\\n+                The distributed libraries would include all MIR (increasing binary size).\n+                The distributed MIR would include validation statements.\");\n+        }\n+\n         StepDescription::run(&Builder::get_step_descriptions(builder.kind), &builder, paths);\n     }\n "}, {"sha": "e7aed7eb4fead3de97f477fc3339542e0a9f7d59", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/55c36e37443e6fa4252157d4bc47b49b3d6e201d/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55c36e37443e6fa4252157d4bc47b49b3d6e201d/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=55c36e37443e6fa4252157d4bc47b49b3d6e201d", "patch": "@@ -1233,31 +1233,6 @@ impl Step for Rustfmt {\n     }\n }\n \n-\n-#[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]\n-pub struct DontDistWithMiriEnabled;\n-\n-impl Step for DontDistWithMiriEnabled {\n-    type Output = PathBuf;\n-    const DEFAULT: bool = true;\n-\n-    fn should_run(run: ShouldRun) -> ShouldRun {\n-        let build_miri = run.builder.build.config.test_miri;\n-        run.default_condition(build_miri)\n-    }\n-\n-    fn make_run(run: RunConfig) {\n-        run.builder.ensure(DontDistWithMiriEnabled);\n-    }\n-\n-    fn run(self, _: &Builder) -> PathBuf {\n-        panic!(\"Do not distribute with miri enabled.\\n\\\n-                The distributed libraries would include all MIR (increasing binary size).\n-                The distributed MIR would include validation statements.\");\n-    }\n-}\n-\n-\n #[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]\n pub struct Extended {\n     stage: u32,"}]}