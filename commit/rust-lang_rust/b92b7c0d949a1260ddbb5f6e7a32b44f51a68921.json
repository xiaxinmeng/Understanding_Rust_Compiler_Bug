{"sha": "b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "node_id": "C_kwDOAAsO6NoAKGI5MmI3YzBkOTQ5YTEyNjBkZGJiNWY2ZTdhMzJiNDRmNTFhNjg5MjE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-17T18:43:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-17T18:43:47Z"}, "message": "Auto merge of #14598 - lowr:fix/release-channel-from-str, r=lnicola\n\nFix release channel detection\n\nWe detect toolchain's release channel by looking at pre-release identifier of cargo/rustc's version string. It's empty for stable, \"beta\" or \"beta.x\" for beta, and \"nightly\" for nightly.\n\nSee rust-lang/rust's [bootstrap code] for how the version string is determined.\n\n[bootstrap code]: https://github.com/rust-lang/rust/blob/e49122fb1ca87a6c3e3c22abb315fc75cfe8daed/src/bootstrap/lib.rs#L1244", "tree": {"sha": "9e5ebabe1794718755cd84109f1e587d04d4c393", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9e5ebabe1794718755cd84109f1e587d04d4c393"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "html_url": "https://github.com/rust-lang/rust/commit/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f926410934fdaa964093afe9b215a7b05508f5b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f926410934fdaa964093afe9b215a7b05508f5b", "html_url": "https://github.com/rust-lang/rust/commit/1f926410934fdaa964093afe9b215a7b05508f5b"}, {"sha": "4db87f9346d5bcda4fe0d6bded9a3862b186b37e", "url": "https://api.github.com/repos/rust-lang/rust/commits/4db87f9346d5bcda4fe0d6bded9a3862b186b37e", "html_url": "https://github.com/rust-lang/rust/commit/4db87f9346d5bcda4fe0d6bded9a3862b186b37e"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "a38ab4f62863aca56928b2323626d629ac4ef76e", "filename": "crates/base-db/src/input.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Fbase-db%2Fsrc%2Finput.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Fbase-db%2Fsrc%2Finput.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fbase-db%2Fsrc%2Finput.rs?ref=b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "patch": "@@ -284,9 +284,9 @@ impl ReleaseChannel {\n \n     pub fn from_str(str: &str) -> Option<Self> {\n         Some(match str {\n-            \"stable\" => ReleaseChannel::Stable,\n-            \"beta\" => ReleaseChannel::Beta,\n+            \"\" => ReleaseChannel::Stable,\n             \"nightly\" => ReleaseChannel::Nightly,\n+            _ if str.starts_with(\"beta\") => ReleaseChannel::Beta,\n             _ => return None,\n         })\n     }"}, {"sha": "4c74dba526b6f3a371fa73cf926c93e77a3374bf", "filename": "crates/ide-completion/src/tests/use_tree.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Fide-completion%2Fsrc%2Ftests%2Fuse_tree.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Fide-completion%2Fsrc%2Ftests%2Fuse_tree.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Fuse_tree.rs?ref=b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "patch": "@@ -387,7 +387,6 @@ use self::foo::impl$0\n fn use_tree_no_unstable_items_on_stable() {\n     check(\n         r#\"\n-//- toolchain:stable\n //- /lib.rs crate:main deps:std\n use std::$0\n //- /std.rs crate:std"}, {"sha": "9439d94f031c986e759bd137eeaf004b1fc04bef", "filename": "crates/project-model/src/workspace.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Fproject-model%2Fsrc%2Fworkspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Fproject-model%2Fsrc%2Fworkspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproject-model%2Fsrc%2Fworkspace.rs?ref=b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "patch": "@@ -779,7 +779,7 @@ fn project_json_to_crate_graph(\n                         CrateOrigin::Local { repo: None, name: None }\n                     },\n                     target_layout.clone(),\n-                    None,\n+                    channel,\n                 );\n                 if *is_proc_macro {\n                     if let Some(path) = proc_macro_dylib_path.clone() {"}, {"sha": "29ab21ac1db482f815c65c0a7b74f810c7a4395b", "filename": "crates/test-utils/src/fixture.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Ftest-utils%2Fsrc%2Ffixture.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b92b7c0d949a1260ddbb5f6e7a32b44f51a68921/crates%2Ftest-utils%2Fsrc%2Ffixture.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Ftest-utils%2Fsrc%2Ffixture.rs?ref=b92b7c0d949a1260ddbb5f6e7a32b44f51a68921", "patch": "@@ -111,8 +111,9 @@ impl FixtureWithProjectMeta {\n     /// //- minicore: sized\n     /// ```\n     ///\n-    /// That will include predefined proc macros and a subset of `libcore` into the fixture, see\n-    /// `minicore.rs` for what's available.\n+    /// That will set toolchain to nightly and include predefined proc macros and a subset of\n+    /// `libcore` into the fixture, see `minicore.rs` for what's available. Note that toolchain\n+    /// defaults to stable.\n     pub fn parse(ra_fixture: &str) -> Self {\n         let fixture = trim_indent(ra_fixture);\n         let mut fixture = fixture.as_str();"}]}