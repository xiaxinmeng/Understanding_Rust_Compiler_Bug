{"sha": "fd39bd169c594c02494527dfa09c3a7f7237180c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkMzliZDE2OWM1OTRjMDI0OTQ1MjdkZmEwOWMzYTdmNzIzNzE4MGM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-09-13T08:00:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-09-13T08:00:50Z"}, "message": "auto merge of #9148 : jakub-/rust/rustpkg-install-mkdir-p, r=catamorphism\n\nTesting this is a little tricky as an intermediate temporary directory is only used for remote git repositories and therefore that path cannot be reliably exercised in the tests.", "tree": {"sha": "917500208c219b0a2249c44e089de4de83dbfaa0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/917500208c219b0a2249c44e089de4de83dbfaa0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fd39bd169c594c02494527dfa09c3a7f7237180c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fd39bd169c594c02494527dfa09c3a7f7237180c", "html_url": "https://github.com/rust-lang/rust/commit/fd39bd169c594c02494527dfa09c3a7f7237180c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fd39bd169c594c02494527dfa09c3a7f7237180c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "323e8f07ff4d5b8e2e38fe94a13c55070ce66384", "url": "https://api.github.com/repos/rust-lang/rust/commits/323e8f07ff4d5b8e2e38fe94a13c55070ce66384", "html_url": "https://github.com/rust-lang/rust/commit/323e8f07ff4d5b8e2e38fe94a13c55070ce66384"}, {"sha": "3d14e82be752959fb010a786ef4c9ef417bd64db", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d14e82be752959fb010a786ef4c9ef417bd64db", "html_url": "https://github.com/rust-lang/rust/commit/3d14e82be752959fb010a786ef4c9ef417bd64db"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "b5ded6f3fafab0d209c3fc6ec9bad6c914e53478", "filename": "src/librustpkg/package_source.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/fd39bd169c594c02494527dfa09c3a7f7237180c/src%2Flibrustpkg%2Fpackage_source.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd39bd169c594c02494527dfa09c3a7f7237180c/src%2Flibrustpkg%2Fpackage_source.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fpackage_source.rs?ref=fd39bd169c594c02494527dfa09c3a7f7237180c", "patch": "@@ -18,7 +18,7 @@ use context::*;\n use crate::Crate;\n use messages::*;\n use source_control::{git_clone, git_clone_general};\n-use path_util::{find_dir_using_rust_path_hack, default_workspace};\n+use path_util::{find_dir_using_rust_path_hack, default_workspace, make_dir_rwx_recursive};\n use util::compile_crate;\n use workspace::is_workspace;\n use workcache_support;\n@@ -197,12 +197,14 @@ impl PkgSrc {\n                   url, clone_target.to_str(), pkgid.version.to_str());\n \n         if git_clone_general(url, &clone_target, &pkgid.version) {\n-            // since the operation succeeded, move clone_target to local\n-            if !os::rename_file(&clone_target, local) {\n-                 None\n+            // Since the operation succeeded, move clone_target to local.\n+            // First, create all ancestor directories.\n+            if make_dir_rwx_recursive(&local.pop())\n+                && os::rename_file(&clone_target, local) {\n+                 Some(local.clone())\n             }\n             else {\n-                 Some(local.clone())\n+                 None\n             }\n         }\n         else {"}, {"sha": "f8ac7ca11a59b8b207792f563106af82a02c6059", "filename": "src/librustpkg/path_util.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fd39bd169c594c02494527dfa09c3a7f7237180c/src%2Flibrustpkg%2Fpath_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd39bd169c594c02494527dfa09c3a7f7237180c/src%2Flibrustpkg%2Fpath_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fpath_util.rs?ref=fd39bd169c594c02494527dfa09c3a7f7237180c", "patch": "@@ -43,6 +43,8 @@ pub static U_RWX: i32 = (S_IRUSR | S_IWUSR | S_IXUSR) as i32;\n /// succeeded.\n pub fn make_dir_rwx(p: &Path) -> bool { os::make_dir(p, U_RWX) }\n \n+pub fn make_dir_rwx_recursive(p: &Path) -> bool { os::mkdir_recursive(p, U_RWX) }\n+\n // n.b. The next three functions ignore the package version right\n // now. Should fix that.\n "}]}