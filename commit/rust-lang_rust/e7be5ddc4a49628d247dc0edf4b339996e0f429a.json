{"sha": "e7be5ddc4a49628d247dc0edf4b339996e0f429a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3YmU1ZGRjNGE0OTYyOGQyNDdkYzBlZGY0YjMzOTk5NmUwZjQyOWE=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-04-27T17:08:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-27T17:08:46Z"}, "message": "Rollup merge of #84521 - CDirkx:hermit-dedup, r=Mark-Simulacrum\n\nReuse modules on `hermit`\n\nReuse the following modules on `hermit`:\n- `unix::path` (contents identical)\n- `unsupported::io` (contents identical)\n- `unsupported::thread_local_key` (contents functionally identical, only changes are the panic error messages)\n\n`@rustbot` label: +T-libs-impl", "tree": {"sha": "cb411ad0715232607233506851a52a69713494d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb411ad0715232607233506851a52a69713494d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7be5ddc4a49628d247dc0edf4b339996e0f429a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgiEUfCRBK7hj4Ov3rIwAACJwIAEvc+yyNcqkeIUxBv3Ot1k41\nw243GY6MxFFyby+C2bY+jzuuxTF1lLU/fvPZb11fhUbN5sXLPsrkbUJqYf3eQo/h\nIPiLd5lAzrUD3/mmntPhJKhKYm3PLNOgD7WV9KOQLOEUqEMfrnG6NPPrvGTQoss/\n0IsCZVxH7yOW6U7cx+UCr9Ute5Z+Rquz1vuLpm25TkZjzXp/L21YaLBaeWbBbC4A\n5Ulhdno32jknrW138AbelBC68cpQKQJQDGSubo9YF5sRnHEqEzQhOIH97OJOI0ag\nJ5qTVuIBudhXko2JIhiVYSEN3KkzF5+Q/I1BR1jMuoKVYLARLkwhCWbHPIQ8j6g=\n=nAnd\n-----END PGP SIGNATURE-----\n", "payload": "tree cb411ad0715232607233506851a52a69713494d9\nparent 78e0f2f52db304187677e89089d59bf6531d6c4f\nparent 36e93824497c18d9b18596f96521a4bf830f83e3\nauthor Dylan DPC <dylan.dpc@gmail.com> 1619543326 +0200\ncommitter GitHub <noreply@github.com> 1619543326 +0200\n\nRollup merge of #84521 - CDirkx:hermit-dedup, r=Mark-Simulacrum\n\nReuse modules on `hermit`\n\nReuse the following modules on `hermit`:\n- `unix::path` (contents identical)\n- `unsupported::io` (contents identical)\n- `unsupported::thread_local_key` (contents functionally identical, only changes are the panic error messages)\n\n`@rustbot` label: +T-libs-impl\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7be5ddc4a49628d247dc0edf4b339996e0f429a", "html_url": "https://github.com/rust-lang/rust/commit/e7be5ddc4a49628d247dc0edf4b339996e0f429a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7be5ddc4a49628d247dc0edf4b339996e0f429a/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "78e0f2f52db304187677e89089d59bf6531d6c4f", "url": "https://api.github.com/repos/rust-lang/rust/commits/78e0f2f52db304187677e89089d59bf6531d6c4f", "html_url": "https://github.com/rust-lang/rust/commit/78e0f2f52db304187677e89089d59bf6531d6c4f"}, {"sha": "36e93824497c18d9b18596f96521a4bf830f83e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/36e93824497c18d9b18596f96521a4bf830f83e3", "html_url": "https://github.com/rust-lang/rust/commit/36e93824497c18d9b18596f96521a4bf830f83e3"}], "stats": {"total": 95, "additions": 3, "deletions": 92}, "files": [{"sha": "d5f475b4310fde64b7f0f50154c14d345ce3788f", "filename": "library/std/src/sys/hermit/io.rs", "status": "removed", "additions": 0, "deletions": 47, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/78e0f2f52db304187677e89089d59bf6531d6c4f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78e0f2f52db304187677e89089d59bf6531d6c4f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fio.rs?ref=78e0f2f52db304187677e89089d59bf6531d6c4f", "patch": "@@ -1,47 +0,0 @@\n-use crate::mem;\n-\n-#[derive(Copy, Clone)]\n-pub struct IoSlice<'a>(&'a [u8]);\n-\n-impl<'a> IoSlice<'a> {\n-    #[inline]\n-    pub fn new(buf: &'a [u8]) -> IoSlice<'a> {\n-        IoSlice(buf)\n-    }\n-\n-    #[inline]\n-    pub fn advance(&mut self, n: usize) {\n-        self.0 = &self.0[n..]\n-    }\n-\n-    #[inline]\n-    pub fn as_slice(&self) -> &[u8] {\n-        self.0\n-    }\n-}\n-\n-pub struct IoSliceMut<'a>(&'a mut [u8]);\n-\n-impl<'a> IoSliceMut<'a> {\n-    #[inline]\n-    pub fn new(buf: &'a mut [u8]) -> IoSliceMut<'a> {\n-        IoSliceMut(buf)\n-    }\n-\n-    #[inline]\n-    pub fn advance(&mut self, n: usize) {\n-        let slice = mem::replace(&mut self.0, &mut []);\n-        let (_, remaining) = slice.split_at_mut(n);\n-        self.0 = remaining;\n-    }\n-\n-    #[inline]\n-    pub fn as_slice(&self) -> &[u8] {\n-        self.0\n-    }\n-\n-    #[inline]\n-    pub fn as_mut_slice(&mut self) -> &mut [u8] {\n-        self.0\n-    }\n-}"}, {"sha": "3364d215776693a133c05eed8d9c6005852c378e", "filename": "library/std/src/sys/hermit/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e7be5ddc4a49628d247dc0edf4b339996e0f429a/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7be5ddc4a49628d247dc0edf4b339996e0f429a/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs?ref=e7be5ddc4a49628d247dc0edf4b339996e0f429a", "patch": "@@ -26,11 +26,13 @@ pub mod env;\n pub mod ext;\n pub mod fd;\n pub mod fs;\n+#[path = \"../unsupported/io.rs\"]\n pub mod io;\n pub mod memchr;\n pub mod mutex;\n pub mod net;\n pub mod os;\n+#[path = \"../unix/path.rs\"]\n pub mod path;\n #[path = \"../unsupported/pipe.rs\"]\n pub mod pipe;\n@@ -40,6 +42,7 @@ pub mod rwlock;\n pub mod stdio;\n pub mod thread;\n pub mod thread_local_dtor;\n+#[path = \"../unsupported/thread_local_key.rs\"]\n pub mod thread_local_key;\n pub mod time;\n "}, {"sha": "840a7ae04262508abc1bd81fd78a7f8fd4231363", "filename": "library/std/src/sys/hermit/path.rs", "status": "removed", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/78e0f2f52db304187677e89089d59bf6531d6c4f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78e0f2f52db304187677e89089d59bf6531d6c4f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fpath.rs?ref=78e0f2f52db304187677e89089d59bf6531d6c4f", "patch": "@@ -1,19 +0,0 @@\n-use crate::ffi::OsStr;\n-use crate::path::Prefix;\n-\n-#[inline]\n-pub fn is_sep_byte(b: u8) -> bool {\n-    b == b'/'\n-}\n-\n-#[inline]\n-pub fn is_verbatim_sep(b: u8) -> bool {\n-    b == b'/'\n-}\n-\n-pub fn parse_prefix(_: &OsStr) -> Option<Prefix<'_>> {\n-    None\n-}\n-\n-pub const MAIN_SEP_STR: &str = \"/\";\n-pub const MAIN_SEP: char = '/';"}, {"sha": "bf1b49eb83b7e14ce8c046eb9c50aea20891a0c6", "filename": "library/std/src/sys/hermit/thread_local_key.rs", "status": "removed", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/78e0f2f52db304187677e89089d59bf6531d6c4f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fthread_local_key.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78e0f2f52db304187677e89089d59bf6531d6c4f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fthread_local_key.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fthread_local_key.rs?ref=78e0f2f52db304187677e89089d59bf6531d6c4f", "patch": "@@ -1,26 +0,0 @@\n-pub type Key = usize;\n-\n-#[inline]\n-pub unsafe fn create(_dtor: Option<unsafe extern \"C\" fn(*mut u8)>) -> Key {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub unsafe fn set(_key: Key, _value: *mut u8) {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub unsafe fn get(_key: Key) -> *mut u8 {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub unsafe fn destroy(_key: Key) {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub fn requires_synchronized_create() -> bool {\n-    panic!(\"should not be used on the hermit target\");\n-}"}]}