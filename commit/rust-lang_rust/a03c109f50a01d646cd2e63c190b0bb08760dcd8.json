{"sha": "a03c109f50a01d646cd2e63c190b0bb08760dcd8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwM2MxMDlmNTBhMDFkNjQ2Y2QyZTYzYzE5MGIwYmIwODc2MGRjZDg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-24T22:41:36Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-24T22:41:36Z"}, "message": "Kill DefId", "tree": {"sha": "3ad27bf06b5a1cee19b643a3317d340eae6859f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ad27bf06b5a1cee19b643a3317d340eae6859f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a03c109f50a01d646cd2e63c190b0bb08760dcd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a03c109f50a01d646cd2e63c190b0bb08760dcd8", "html_url": "https://github.com/rust-lang/rust/commit/a03c109f50a01d646cd2e63c190b0bb08760dcd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a03c109f50a01d646cd2e63c190b0bb08760dcd8/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ccf73c836d8a70d6f04b621bd6461f133669131", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ccf73c836d8a70d6f04b621bd6461f133669131", "html_url": "https://github.com/rust-lang/rust/commit/1ccf73c836d8a70d6f04b621bd6461f133669131"}], "stats": {"total": 42, "additions": 11, "deletions": 31}, "files": [{"sha": "b125a151840aaf50bd32c62f3dae32f654528887", "filename": "crates/ra_hir/src/ids.rs", "status": "modified", "additions": 10, "deletions": 30, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/a03c109f50a01d646cd2e63c190b0bb08760dcd8/crates%2Fra_hir%2Fsrc%2Fids.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03c109f50a01d646cd2e63c190b0bb08760dcd8/crates%2Fra_hir%2Fsrc%2Fids.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fids.rs?ref=a03c109f50a01d646cd2e63c190b0bb08760dcd8", "patch": "@@ -8,13 +8,12 @@ use ra_syntax::{TreeArc, SyntaxNode, SourceFile, AstNode, ast};\n use ra_arena::{Arena, RawId, ArenaId, impl_arena_id};\n \n use crate::{\n-    HirDatabase, Def,\n+    HirDatabase,\n     Module,\n };\n \n #[derive(Debug, Default)]\n pub struct HirInterner {\n-    defs: LocationIntener<DefLoc, DefId>,\n     macros: LocationIntener<MacroCallLoc, MacroCallId>,\n     fns: LocationIntener<ItemLoc<ast::FnDef>, FunctionId>,\n     structs: LocationIntener<ItemLoc<ast::StructDef>, StructId>,\n@@ -28,7 +27,15 @@ pub struct HirInterner {\n \n impl HirInterner {\n     pub fn len(&self) -> usize {\n-        self.defs.len() + self.macros.len()\n+        self.macros.len()\n+            + self.fns.len()\n+            + self.structs.len()\n+            + self.enums.len()\n+            + self.enum_variants.len()\n+            + self.consts.len()\n+            + self.statics.len()\n+            + self.traits.len()\n+            + self.types.len()\n     }\n }\n \n@@ -299,33 +306,6 @@ impl AstItemDef<ast::TypeDef> for TypeId {\n     }\n }\n \n-/// Def's are a core concept of hir. A `Def` is an Item (function, module, etc)\n-/// in a specific module.\n-#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n-pub struct DefId(RawId);\n-impl_arena_id!(DefId);\n-\n-#[derive(Clone, Debug, PartialEq, Eq, Hash)]\n-pub struct DefLoc {\n-    pub(crate) kind: DefKind,\n-    pub(crate) module: Module,\n-    pub(crate) source_item_id: SourceItemId,\n-}\n-\n-#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash)]\n-pub(crate) enum DefKind {}\n-\n-impl DefId {\n-    pub(crate) fn loc(self, db: &impl AsRef<HirInterner>) -> DefLoc {\n-        db.as_ref().defs.id2loc(self)\n-    }\n-\n-    pub fn resolve(self, db: &impl HirDatabase) -> Def {\n-        let loc = self.loc(db);\n-        match loc.kind {}\n-    }\n-}\n-\n /// Identifier of item within a specific file. This is stable over reparses, so\n /// it's OK to use it as a salsa key/value.\n #[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]"}, {"sha": "644affd44592411ea8730765547aa9949779e340", "filename": "crates/ra_hir/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a03c109f50a01d646cd2e63c190b0bb08760dcd8/crates%2Fra_hir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03c109f50a01d646cd2e63c190b0bb08760dcd8/crates%2Fra_hir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Flib.rs?ref=a03c109f50a01d646cd2e63c190b0bb08760dcd8", "patch": "@@ -52,7 +52,7 @@ use crate::{\n pub use self::{\n     path::{Path, PathKind},\n     name::Name,\n-    ids::{HirFileId, DefId, DefLoc, MacroCallId, MacroCallLoc, HirInterner},\n+    ids::{HirFileId, MacroCallId, MacroCallLoc, HirInterner},\n     macros::{MacroDef, MacroInput, MacroExpansion},\n     nameres::{ItemMap, PerNs, Namespace, Resolution},\n     ty::{Ty, AdtDef},"}]}