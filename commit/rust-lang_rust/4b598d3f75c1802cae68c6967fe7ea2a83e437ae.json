{"sha": "4b598d3f75c1802cae68c6967fe7ea2a83e437ae", "node_id": "C_kwDOAAsO6NoAKDRiNTk4ZDNmNzVjMTgwMmNhZTY4YzY5NjdmZTdlYTJhODNlNDM3YWU", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-07-31T20:50:43Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-03-31T11:46:06Z"}, "message": "Stop emitting lints during lowering.", "tree": {"sha": "0f996911bad3b4bfb07a7d18e607a29df54ce70f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f996911bad3b4bfb07a7d18e607a29df54ce70f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4b598d3f75c1802cae68c6967fe7ea2a83e437ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4b598d3f75c1802cae68c6967fe7ea2a83e437ae", "html_url": "https://github.com/rust-lang/rust/commit/4b598d3f75c1802cae68c6967fe7ea2a83e437ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4b598d3f75c1802cae68c6967fe7ea2a83e437ae/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c10a1cebe785e2e47ae30228416e57f9db751e17", "url": "https://api.github.com/repos/rust-lang/rust/commits/c10a1cebe785e2e47ae30228416e57f9db751e17", "html_url": "https://github.com/rust-lang/rust/commit/c10a1cebe785e2e47ae30228416e57f9db751e17"}], "stats": {"total": 39, "additions": 15, "deletions": 24}, "files": [{"sha": "71999eeac4ee486e3c024849a8122bbbbcea7ea9", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4b598d3f75c1802cae68c6967fe7ea2a83e437ae/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4b598d3f75c1802cae68c6967fe7ea2a83e437ae/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=4b598d3f75c1802cae68c6967fe7ea2a83e437ae", "patch": "@@ -57,7 +57,6 @@ use rustc_hir::intravisit;\n use rustc_hir::{ConstArg, GenericArg, ItemLocalId, ParamName, TraitCandidate};\n use rustc_index::vec::{Idx, IndexVec};\n use rustc_query_system::ich::StableHashingContext;\n-use rustc_session::lint::LintBuffer;\n use rustc_session::parse::feature_err;\n use rustc_session::utils::{FlattenNonterminals, NtToTokenstream};\n use rustc_session::Session;\n@@ -180,8 +179,6 @@ pub trait ResolverAstLowering {\n \n     fn definitions(&self) -> &Definitions;\n \n-    fn lint_buffer(&mut self) -> &mut LintBuffer;\n-\n     fn next_node_id(&mut self) -> NodeId;\n \n     fn take_trait_map(&mut self, node: NodeId) -> Option<Vec<hir::TraitCandidate>>;"}, {"sha": "f2164bccc3e9b1855ac6a3eb24120f75755ad893", "filename": "compiler/rustc_interface/src/passes.rs", "status": "modified", "additions": 15, "deletions": 17, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/4b598d3f75c1802cae68c6967fe7ea2a83e437ae/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4b598d3f75c1802cae68c6967fe7ea2a83e437ae/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs?ref=4b598d3f75c1802cae68c6967fe7ea2a83e437ae", "patch": "@@ -487,12 +487,24 @@ pub fn configure_and_expand(\n         }\n     });\n \n+    sess.time(\"early_lint_checks\", || {\n+        let lint_buffer = Some(std::mem::take(resolver.lint_buffer()));\n+        rustc_lint::check_ast_node(\n+            sess,\n+            false,\n+            lint_store,\n+            resolver.registered_tools(),\n+            lint_buffer,\n+            rustc_lint::BuiltinCombinedEarlyLintPass::new(),\n+            &krate,\n+        )\n+    });\n+\n     Ok(krate)\n }\n \n pub fn lower_to_hir<'res, 'tcx>(\n     sess: &'tcx Session,\n-    lint_store: &LintStore,\n     resolver: &'res mut Resolver<'_>,\n     krate: Rc<ast::Crate>,\n     arena: &'tcx rustc_ast_lowering::Arena<'tcx>,\n@@ -506,19 +518,6 @@ pub fn lower_to_hir<'res, 'tcx>(\n         arena,\n     );\n \n-    sess.time(\"early_lint_checks\", || {\n-        let lint_buffer = Some(std::mem::take(resolver.lint_buffer()));\n-        rustc_lint::check_ast_node(\n-            sess,\n-            false,\n-            lint_store,\n-            resolver.registered_tools(),\n-            lint_buffer,\n-            rustc_lint::BuiltinCombinedEarlyLintPass::new(),\n-            &*krate,\n-        )\n-    });\n-\n     // Drop AST to free memory\n     sess.time(\"drop_ast\", || std::mem::drop(krate));\n \n@@ -852,9 +851,8 @@ pub fn create_global_ctxt<'tcx>(\n     dep_graph.assert_ignored();\n \n     let sess = &compiler.session();\n-    let krate = resolver\n-        .borrow_mut()\n-        .access(|resolver| lower_to_hir(sess, &lint_store, resolver, krate, hir_arena));\n+    let krate =\n+        resolver.borrow_mut().access(|resolver| lower_to_hir(sess, resolver, krate, hir_arena));\n     let resolver_outputs = BoxedResolver::to_resolver_outputs(resolver);\n \n     let query_result_on_disk_cache = rustc_incremental::load_query_result_cache(sess);"}, {"sha": "1f0a6e5ce9716263b3b7e67d9256b8a0b89030fd", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4b598d3f75c1802cae68c6967fe7ea2a83e437ae/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4b598d3f75c1802cae68c6967fe7ea2a83e437ae/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=4b598d3f75c1802cae68c6967fe7ea2a83e437ae", "patch": "@@ -1204,10 +1204,6 @@ impl ResolverAstLowering for Resolver<'_> {\n         &self.definitions\n     }\n \n-    fn lint_buffer(&mut self) -> &mut LintBuffer {\n-        &mut self.lint_buffer\n-    }\n-\n     fn next_node_id(&mut self) -> NodeId {\n         self.next_node_id()\n     }"}]}