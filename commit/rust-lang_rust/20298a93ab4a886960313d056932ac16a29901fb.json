{"sha": "20298a93ab4a886960313d056932ac16a29901fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMjk4YTkzYWI0YTg4Njk2MDMxM2QwNTY5MzJhYzE2YTI5OTAxZmI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-22T16:26:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-05-22T16:26:06Z"}, "message": "Rollup merge of #50846 - GuillaumeGomez:add-e0665, r=frewsxcv\n\nAdd E0665", "tree": {"sha": "6e56f7682386bff8442f025aeaf9d1a7666d87ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e56f7682386bff8442f025aeaf9d1a7666d87ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20298a93ab4a886960313d056932ac16a29901fb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbBESeCRBK7hj4Ov3rIwAAdHIIAFmQ8zplpXT5ItlQpwm3CkmT\nWtC1tLNIJp3BW6jPosgM4kirUDiaDAlDN987kEq0hSVXKraSbsHsEsj/FAxOzhR/\n1+oybwQH2ft15SwomrM3mazDv5ZBRmcz4p2868QQk38IFl8QIwfTE++/99f4+SAq\nio/r9e7o0AERuKyl6/0BGEPs/7j7hUyR9J9Od+0AwuKNi0vrwiCjCF6EUmOhvxK1\nvwrwn4Rsu3PK4LeE4F+/LVhNk79TMVg/vAnBoc3IxsMmmO5fxitWvfwY8f5iappt\n1wb+lF4ytoPiKFL8bg8m1c/MjdlYA1RnCLS4NCM8Sl0YsbTWaSsYaZGIXiyp6iU=\n=MDZy\n-----END PGP SIGNATURE-----\n", "payload": "tree 6e56f7682386bff8442f025aeaf9d1a7666d87ea\nparent 9f80ea32811db0bdbd05b1bef59f5db26b3e24a9\nparent 8c004b830838473651b306d15a2d74e1cae19785\nauthor kennytm <kennytm@gmail.com> 1527006366 +0800\ncommitter GitHub <noreply@github.com> 1527006366 +0800\n\nRollup merge of #50846 - GuillaumeGomez:add-e0665, r=frewsxcv\n\nAdd E0665\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20298a93ab4a886960313d056932ac16a29901fb", "html_url": "https://github.com/rust-lang/rust/commit/20298a93ab4a886960313d056932ac16a29901fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20298a93ab4a886960313d056932ac16a29901fb/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f80ea32811db0bdbd05b1bef59f5db26b3e24a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f80ea32811db0bdbd05b1bef59f5db26b3e24a9", "html_url": "https://github.com/rust-lang/rust/commit/9f80ea32811db0bdbd05b1bef59f5db26b3e24a9"}, {"sha": "8c004b830838473651b306d15a2d74e1cae19785", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c004b830838473651b306d15a2d74e1cae19785", "html_url": "https://github.com/rust-lang/rust/commit/8c004b830838473651b306d15a2d74e1cae19785"}], "stats": {"total": 88, "additions": 82, "deletions": 6}, "files": [{"sha": "cbd6a257b77e8ae2ae23951d0915495547c09624", "filename": "src/libsyntax_ext/deriving/default.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Fderiving%2Fdefault.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Fderiving%2Fdefault.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fderiving%2Fdefault.rs?ref=20298a93ab4a886960313d056932ac16a29901fb", "patch": "@@ -76,8 +76,8 @@ fn default_substructure(cx: &mut ExtCtxt, trait_span: Span, substr: &Substructur\n             }\n         }\n         StaticEnum(..) => {\n-            cx.span_err(trait_span,\n-                        \"`Default` cannot be derived for enums, only structs\");\n+            span_err_if_not_stage0!(cx, trait_span, E0665,\n+                                    \"`Default` cannot be derived for enums, only structs\");\n             // let compilation continue\n             cx.expr_usize(trait_span, 0)\n         }"}, {"sha": "0dd55f8d77738a4d53fa6d74844822a9bfeedd93", "filename": "src/libsyntax_ext/deriving/mod.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Fderiving%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Fderiving%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fderiving%2Fmod.rs?ref=20298a93ab4a886960313d056932ac16a29901fb", "patch": "@@ -19,6 +19,17 @@ use syntax::ptr::P;\n use syntax::symbol::Symbol;\n use syntax_pos::Span;\n \n+macro_rules! span_err_if_not_stage0 {\n+    ($cx:expr, $sp:expr, $code:ident, $text:tt) => {\n+        #[cfg(not(stage0))] {\n+            span_err!($cx, $sp, $code, $text)\n+        }\n+        #[cfg(stage0)] {\n+            $cx.span_err($sp, $text)\n+        }\n+    }\n+}\n+\n macro path_local($x:ident) {\n     generic::ty::Path::new_local(stringify!($x))\n }"}, {"sha": "f99a6c3c2166de717d5c6993c4d660fa8d0bfe48", "filename": "src/libsyntax_ext/diagnostics.rs", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fdiagnostics.rs?ref=20298a93ab4a886960313d056932ac16a29901fb", "patch": "@@ -82,7 +82,7 @@ A clobber was surrounded by braces in the `asm` macro.\n \n Erroneous code example:\n \n-```compile_fail,E0663\n+```compile_fail,E0664\n asm!(\"mov $$0x200, %eax\"\n      :\n      :\n@@ -94,4 +94,38 @@ Considering that this would be a long explanation, we instead recommend you to\n take a look at the unstable book:\n https://doc.rust-lang.org/unstable-book/language-features/asm.html\n \"##,\n+\n+E0665: r##\"\n+The `Default` trait was derived on an enum.\n+\n+Erroneous code example:\n+\n+```compile_fail,E0665\n+#[derive(Default)]\n+enum Food {\n+    Sweet,\n+    Salty,\n+}\n+```\n+\n+The `Default` cannot be derived on an enum for the simple reason that the\n+compiler doesn't know which value to pick by default whereas it can for a\n+struct as long as all its fields implement the `Default` trait as well.\n+\n+If you still want to implement `Default` on your enum, you'll have to do it \"by\n+hand\":\n+\n+```\n+enum Food {\n+    Sweet,\n+    Salty,\n+}\n+\n+impl Default for Food {\n+    fn default() -> Food {\n+        Food::Sweet\n+    }\n+}\n+```\n+\"##,\n }"}, {"sha": "af3ef181c59dc9a7808e97cf198b6f769b258d84", "filename": "src/libsyntax_ext/lib.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20298a93ab4a886960313d056932ac16a29901fb/src%2Flibsyntax_ext%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Flib.rs?ref=20298a93ab4a886960313d056932ac16a29901fb", "patch": "@@ -31,8 +31,12 @@ extern crate rustc_target;\n \n mod diagnostics;\n \n-mod assert;\n+#[macro_use]\n+// for custom_derive\n+pub mod deriving;\n+\n mod asm;\n+mod assert;\n mod cfg;\n mod compile_error;\n mod concat;\n@@ -46,8 +50,6 @@ mod trace_macros;\n \n pub mod proc_macro_registrar;\n \n-// for custom_derive\n-pub mod deriving;\n \n pub mod proc_macro_impl;\n "}, {"sha": "8888bedf01687840cd1bc71ad251ad813c454773", "filename": "src/test/ui/E0665.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/20298a93ab4a886960313d056932ac16a29901fb/src%2Ftest%2Fui%2FE0665.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20298a93ab4a886960313d056932ac16a29901fb/src%2Ftest%2Fui%2FE0665.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2FE0665.rs?ref=20298a93ab4a886960313d056932ac16a29901fb", "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// ignore-stage1\n+\n+#[derive(Default)] //~ ERROR E0665\n+enum Food {\n+    Sweet,\n+    Salty,\n+}\n+\n+fn main() {\n+}"}, {"sha": "c97e9e5ea89d080b25e57e0d1ab0741f438b56f2", "filename": "src/test/ui/E0665.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/20298a93ab4a886960313d056932ac16a29901fb/src%2Ftest%2Fui%2FE0665.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/20298a93ab4a886960313d056932ac16a29901fb/src%2Ftest%2Fui%2FE0665.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2FE0665.stderr?ref=20298a93ab4a886960313d056932ac16a29901fb", "patch": "@@ -0,0 +1,9 @@\n+error[E0665]: `Default` cannot be derived for enums, only structs\n+  --> $DIR/E0665.rs:13:10\n+   |\n+LL | #[derive(Default)] //~ ERROR E0665\n+   |          ^^^^^^^\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0665`."}]}