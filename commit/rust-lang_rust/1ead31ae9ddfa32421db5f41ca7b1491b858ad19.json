{"sha": "1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlYWQzMWFlOWRkZmEzMjQyMWRiNWY0MWNhN2IxNDkxYjg1OGFkMTk=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-06-19T22:35:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-06-19T22:35:16Z"}, "message": "Merge pull request #2795 from jechase/issue-2794\n\nAdd test and fix for #2794", "tree": {"sha": "77ddf538cf9a756a4cafd21d4713aa5c1c89fa71", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77ddf538cf9a756a4cafd21d4713aa5c1c89fa71"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbKYUkCRBK7hj4Ov3rIwAAdHIIADuLhbIzdTII7CYwBTyJ/t2c\nxy86ANDp6YWApg65P58IR8XzIiqVTTIQgIIpC8Xfq3AzA5pRgHuf9sS+CDUShVB9\nrae9OjE3cNBLWVl72LlcG7bZuXftd2lKgXcFesJU0HyNuO1GBF2G2okNzHL+ULhk\nv61vN485++yqCg6D1GLnW0EbtKrVrWydUThtkoZpjpe0sUEeg4Z07N9QhL6iTyyM\n8SyL22BQr6udv3XHahSE1nVvh/WP0rZ0zVYwlKUHdBFX23kpRfP11KlksmCfrABa\nvdQ9uztNuZtH5nme6gX+6ziJdziqJ7udeuRLlu6x47PTMOCAMIR7X4V7YmbbLtU=\n=Dnu7\n-----END PGP SIGNATURE-----\n", "payload": "tree 77ddf538cf9a756a4cafd21d4713aa5c1c89fa71\nparent fb5513564e957578dd544000174b80801e210237\nparent ee5ff2d9e8f2fcf7ef8ceefc5de78e5439ed7a21\nauthor Nick Cameron <nrc@ncameron.org> 1529447716 +1200\ncommitter GitHub <noreply@github.com> 1529447716 +1200\n\nMerge pull request #2795 from jechase/issue-2794\n\nAdd test and fix for #2794"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "html_url": "https://github.com/rust-lang/rust/commit/1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb5513564e957578dd544000174b80801e210237", "url": "https://api.github.com/repos/rust-lang/rust/commits/fb5513564e957578dd544000174b80801e210237", "html_url": "https://github.com/rust-lang/rust/commit/fb5513564e957578dd544000174b80801e210237"}, {"sha": "ee5ff2d9e8f2fcf7ef8ceefc5de78e5439ed7a21", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee5ff2d9e8f2fcf7ef8ceefc5de78e5439ed7a21", "html_url": "https://github.com/rust-lang/rust/commit/ee5ff2d9e8f2fcf7ef8ceefc5de78e5439ed7a21"}], "stats": {"total": 59, "additions": 45, "deletions": 14}, "files": [{"sha": "efbd4872aae5cbe029f245d875a2e9eb587c284a", "filename": "src/attr.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fattr.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -247,6 +247,7 @@ impl Rewrite for ast::MetaItem {\n                     shape: item_shape,\n                     ends_with_newline: false,\n                     preserve_newline: false,\n+                    nested: false,\n                     config: context.config,\n                 };\n                 let item_str = write_list(&item_vec, &fmt)?;"}, {"sha": "257b8729f453d5e0a46c167ccb6dd9c0d201ed5c", "filename": "src/closures.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fclosures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fclosures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fclosures.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -260,6 +260,7 @@ fn rewrite_closure_fn_decl(\n         shape: arg_shape,\n         ends_with_newline: false,\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n     let list_str = write_list(&item_vec, &fmt)?;"}, {"sha": "04406e8d5669636ea40955ed0b654297a3a8e8ab", "filename": "src/config/lists.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fconfig%2Flists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fconfig%2Flists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig%2Flists.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -19,8 +19,6 @@ pub enum DefinitiveListTactic {\n     Vertical,\n     Horizontal,\n     Mixed,\n-    /// Tactic for nested import.\n-    NestedImport,\n     /// Special case tactic for `format!()`, `write!()` style macros.\n     SpecialMacro(usize),\n }"}, {"sha": "0c2716a2dba72f2a8d55835592107627b19ab6fc", "filename": "src/expr.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -1338,6 +1338,7 @@ pub fn rewrite_multiple_patterns(\n         shape,\n         ends_with_newline: false,\n         preserve_newline: false,\n+        nested: false,\n         config: context.config,\n     };\n     write_list(&items, &fmt)\n@@ -1902,6 +1903,7 @@ where\n         shape,\n         ends_with_newline: false,\n         preserve_newline: false,\n+        nested: false,\n         config: context.config,\n     };\n     let list_str = write_list(&item_vec, &fmt)?;"}, {"sha": "7e45bb55f0d51d03de4b9af5b99f9147f93bd248", "filename": "src/imports.rs", "status": "modified", "additions": 7, "deletions": 10, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fimports.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -706,16 +706,12 @@ fn rewrite_nested_use_tree(\n         shape.width.saturating_sub(2)\n     };\n \n-    let tactic = if has_nested_list {\n-        DefinitiveListTactic::NestedImport\n-    } else {\n-        definitive_tactic(\n-            &list_items,\n-            context.config.imports_layout(),\n-            Separator::Comma,\n-            remaining_width,\n-        )\n-    };\n+    let tactic = definitive_tactic(\n+        &list_items,\n+        context.config.imports_layout(),\n+        Separator::Comma,\n+        remaining_width,\n+    );\n \n     let ends_with_newline = context.config.imports_indent() == IndentStyle::Block\n         && tactic != DefinitiveListTactic::Horizontal;\n@@ -731,6 +727,7 @@ fn rewrite_nested_use_tree(\n         shape: nested_shape,\n         ends_with_newline,\n         preserve_newline: true,\n+        nested: has_nested_list,\n         config: context.config,\n     };\n "}, {"sha": "843d5839de93d32b28b6688bed20f10d29fdee8a", "filename": "src/items.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -533,6 +533,7 @@ impl<'a> FmtVisitor<'a> {\n             shape,\n             ends_with_newline: true,\n             preserve_newline: true,\n+            nested: false,\n             config: self.config,\n         };\n \n@@ -2307,6 +2308,7 @@ fn rewrite_args(\n         shape: Shape::legacy(budget, indent),\n         ends_with_newline: tactic.ends_with_newline(context.config.indent_style()),\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n \n@@ -2494,6 +2496,7 @@ fn rewrite_where_clause_rfc_style(\n         shape: clause_shape,\n         ends_with_newline: true,\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n     let preds_str = write_list(&items.collect::<Vec<_>>(), &fmt)?;\n@@ -2607,6 +2610,7 @@ fn rewrite_where_clause(\n         shape: Shape::legacy(budget, offset),\n         ends_with_newline: tactic.ends_with_newline(context.config.indent_style()),\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n     let preds_str = write_list(&item_vec, &fmt)?;"}, {"sha": "97dd093b4f9db75dcd996a00905ffbe435bec4c5", "filename": "src/lists.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Flists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Flists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flists.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -34,6 +34,8 @@ pub struct ListFormatting<'a> {\n     pub ends_with_newline: bool,\n     // Remove newlines between list elements for expressions.\n     pub preserve_newline: bool,\n+    // Nested import lists get some special handling for the \"Mixed\" list type\n+    pub nested: bool,\n     pub config: &'a Config,\n }\n \n@@ -282,13 +284,13 @@ where\n                 result.push('\\n');\n                 result.push_str(indent_str);\n             }\n-            DefinitiveListTactic::Mixed | DefinitiveListTactic::NestedImport => {\n+            DefinitiveListTactic::Mixed => {\n                 let total_width = total_item_width(item) + item_sep_len;\n \n                 // 1 is space between separator and item.\n                 if (line_len > 0 && line_len + 1 + total_width > formatting.shape.width)\n                     || prev_item_had_post_comment\n-                    || (tactic == DefinitiveListTactic::NestedImport\n+                    || (formatting.nested\n                         && (prev_item_is_nested_import || (!first && inner_item.contains(\"::\"))))\n                 {\n                     result.push('\\n');\n@@ -825,6 +827,7 @@ pub fn struct_lit_formatting<'a>(\n         shape,\n         ends_with_newline,\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     }\n }"}, {"sha": "801e04baad0f809f7979684cc852f3fa4e85a2cb", "filename": "src/macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -399,6 +399,7 @@ pub fn rewrite_macro_def(\n         shape: arm_shape,\n         ends_with_newline: true,\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n "}, {"sha": "c179efc3963e7a42796a623d77ebf7d8539207cf", "filename": "src/matches.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmatches.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -224,6 +224,7 @@ fn rewrite_match_arms(\n         shape: arm_shape,\n         ends_with_newline: true,\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n "}, {"sha": "f91ef38e2ee03f06f3b71b2610911ab2b93dd142", "filename": "src/overflow.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Foverflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Foverflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Foverflow.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -388,6 +388,7 @@ impl<'a, T: 'a + Rewrite + ToExpr + Spanned> Context<'a, T> {\n                 _ => false,\n             },\n             preserve_newline: false,\n+            nested: false,\n             config: self.context.config,\n         };\n "}, {"sha": "ecad2c25652af2a9928c593190ec14a65aa3ba50", "filename": "src/reorder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Freorder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Freorder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Freorder.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -77,6 +77,7 @@ fn wrap_reorderable_items(\n         shape,\n         ends_with_newline: true,\n         preserve_newline: false,\n+        nested: false,\n         config: context.config,\n     };\n "}, {"sha": "44fdbee6efdd37c572d29e5b436acf2c2cd08120", "filename": "src/types.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -366,6 +366,7 @@ where\n         shape: list_shape,\n         ends_with_newline: tactic.ends_with_newline(context.config.indent_style()),\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n "}, {"sha": "a8a8ee6cec3c364deeb410c2ed08ff73642fb285", "filename": "src/vertical.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fvertical.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/src%2Fvertical.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvertical.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -252,6 +252,7 @@ fn rewrite_aligned_items_inner<T: AlignedItem>(\n         shape: item_shape,\n         ends_with_newline: true,\n         preserve_newline: true,\n+        nested: false,\n         config: context.config,\n     };\n     write_list(&items, &fmt)"}, {"sha": "c3f9c0412a46d9f3be57d71525927a01eaa9ca6b", "filename": "tests/source/issue-2794.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/tests%2Fsource%2Fissue-2794.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/tests%2Fsource%2Fissue-2794.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-2794.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -0,0 +1,7 @@\n+// rustfmt-indent_style: Block\n+// rustfmt-imports_indent: Block\n+// rustfmt-imports_layout: Vertical\n+\n+use std::{\n+    env, fs, io::{Read, Write},\n+};"}, {"sha": "951c0af206d8c2c8691695b9f39ac458173a6207", "filename": "tests/target/issue-2794.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/tests%2Ftarget%2Fissue-2794.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ead31ae9ddfa32421db5f41ca7b1491b858ad19/tests%2Ftarget%2Fissue-2794.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2794.rs?ref=1ead31ae9ddfa32421db5f41ca7b1491b858ad19", "patch": "@@ -0,0 +1,12 @@\n+// rustfmt-indent_style: Block\n+// rustfmt-imports_indent: Block\n+// rustfmt-imports_layout: Vertical\n+\n+use std::{\n+    env,\n+    fs,\n+    io::{\n+        Read,\n+        Write,\n+    },\n+};"}]}