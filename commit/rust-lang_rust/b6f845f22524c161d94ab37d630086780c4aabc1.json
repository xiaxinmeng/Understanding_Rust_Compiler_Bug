{"sha": "b6f845f22524c161d94ab37d630086780c4aabc1", "node_id": "C_kwDOAAsO6NoAKGI2Zjg0NWYyMjUyNGMxNjFkOTRhYjM3ZDYzMDA4Njc4MGM0YWFiYzE", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-03-03T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-03-04T15:57:34Z"}, "message": "Use SmallStr when building target-features LLVM attribute", "tree": {"sha": "0b8768f0ac1ef0ee26fb25d10b14495f082d058b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b8768f0ac1ef0ee26fb25d10b14495f082d058b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6f845f22524c161d94ab37d630086780c4aabc1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6f845f22524c161d94ab37d630086780c4aabc1", "html_url": "https://github.com/rust-lang/rust/commit/b6f845f22524c161d94ab37d630086780c4aabc1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6f845f22524c161d94ab37d630086780c4aabc1/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "725c11ef3c6a40e7d9a7c9a8ea65f72b9448d1e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/725c11ef3c6a40e7d9a7c9a8ea65f72b9448d1e0", "html_url": "https://github.com/rust-lang/rust/commit/725c11ef3c6a40e7d9a7c9a8ea65f72b9448d1e0"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "31117e1c11fcc7611dd5ee2483a5ed1d28fbeb9d", "filename": "compiler/rustc_codegen_llvm/src/attributes.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b6f845f22524c161d94ab37d630086780c4aabc1/compiler%2Frustc_codegen_llvm%2Fsrc%2Fattributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6f845f22524c161d94ab37d630086780c4aabc1/compiler%2Frustc_codegen_llvm%2Fsrc%2Fattributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fattributes.rs?ref=b6f845f22524c161d94ab37d630086780c4aabc1", "patch": "@@ -1,6 +1,7 @@\n //! Set and unset common attributes on LLVM values.\n \n use rustc_codegen_ssa::traits::*;\n+use rustc_data_structures::small_str::SmallStr;\n use rustc_hir::def_id::DefId;\n use rustc_middle::middle::codegen_fn_attrs::CodegenFnAttrFlags;\n use rustc_middle::ty::{self, TyCtxt};\n@@ -382,7 +383,7 @@ pub fn from_fn_attrs<'ll, 'tcx>(\n         let val = global_features\n             .chain(function_features.iter().map(|s| &s[..]))\n             .intersperse(\",\")\n-            .collect::<String>();\n+            .collect::<SmallStr<1024>>();\n         to_add.push(llvm::CreateAttrStringValue(cx.llcx, \"target-features\", &val));\n     }\n "}]}