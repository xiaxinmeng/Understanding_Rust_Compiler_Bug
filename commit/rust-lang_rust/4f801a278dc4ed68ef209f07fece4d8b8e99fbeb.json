{"sha": "4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmODAxYTI3OGRjNGVkNjhlZjIwOWYwN2ZlY2U0ZDhiOGU5OWZiZWI=", "commit": {"author": {"name": "Grzegorz", "email": "grzegorz.bartoszek@thaumatec.com", "date": "2019-04-20T20:20:14Z"}, "committer": {"name": "Grzegorz", "email": "grzegorz.bartoszek@thaumatec.com", "date": "2019-04-20T20:20:14Z"}, "message": "redundant closure triggers for fnptrs and closures", "tree": {"sha": "366586e9787d37871bcd9463026cb9748a30b732", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/366586e9787d37871bcd9463026cb9748a30b732"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "html_url": "https://github.com/rust-lang/rust/commit/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/comments", "author": null, "committer": null, "parents": [{"sha": "aa9cf07d56fac7044e6890d66759ab9903d352ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa9cf07d56fac7044e6890d66759ab9903d352ef", "html_url": "https://github.com/rust-lang/rust/commit/aa9cf07d56fac7044e6890d66759ab9903d352ef"}], "stats": {"total": 39, "additions": 37, "deletions": 2}, "files": [{"sha": "60e2ab8b9b9fddf6fae3e45e1d3992f0928c7935", "filename": "clippy_lints/src/eta_reduction.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/clippy_lints%2Fsrc%2Feta_reduction.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/clippy_lints%2Fsrc%2Feta_reduction.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Feta_reduction.rs?ref=4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "patch": "@@ -1,4 +1,5 @@\n use if_chain::if_chain;\n+use matches::matches;\n use rustc::hir::*;\n use rustc::lint::{in_external_macro, LateContext, LateLintPass, LintArray, LintContext, LintPass};\n use rustc::ty::{self, Ty};\n@@ -66,7 +67,7 @@ fn check_closure(cx: &LateContext<'_, '_>, expr: &Expr) {\n \n             let fn_ty = cx.tables.expr_ty(caller);\n \n-            if let ty::FnDef(_, _) = fn_ty.sty;\n+            if matches!(fn_ty.sty, ty::FnDef(_, _) | ty::FnPtr(_) | ty::Closure(_, _));\n \n             if !type_is_unsafe_function(cx, fn_ty);\n "}, {"sha": "bae9b09c6977666bbf8ae3af8c8f82125f4e25bd", "filename": "tests/ui/eta.fixed", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/tests%2Fui%2Feta.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/tests%2Fui%2Feta.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Feta.fixed?ref=4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "patch": "@@ -138,3 +138,14 @@ fn passes_fn_mut(mut x: Box<dyn FnMut()>) {\n     requires_fn_once(|| x());\n }\n fn requires_fn_once<T: FnOnce()>(_: T) {}\n+\n+fn test_redundant_closure_with_function_pointer() {\n+    type FnPtrType = fn(u8);\n+    let foo_ptr: FnPtrType = foo;\n+    let a = Some(1u8).map(foo_ptr);\n+}\n+\n+fn test_redundant_closure_with_another_closure() {\n+    let closure = |a| println!(\"{}\", a);\n+    let a = Some(1u8).map(closure);\n+}"}, {"sha": "a23da73bde7520954824ea05ea06f1bc2c70c548", "filename": "tests/ui/eta.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/tests%2Fui%2Feta.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/tests%2Fui%2Feta.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Feta.rs?ref=4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "patch": "@@ -138,3 +138,14 @@ fn passes_fn_mut(mut x: Box<dyn FnMut()>) {\n     requires_fn_once(|| x());\n }\n fn requires_fn_once<T: FnOnce()>(_: T) {}\n+\n+fn test_redundant_closure_with_function_pointer() {\n+    type FnPtrType = fn(u8);\n+    let foo_ptr: FnPtrType = foo;\n+    let a = Some(1u8).map(|a| foo_ptr(a));\n+}\n+\n+fn test_redundant_closure_with_another_closure() {\n+    let closure = |a| println!(\"{}\", a);\n+    let a = Some(1u8).map(|a| closure(a));\n+}"}, {"sha": "eb55a251bcc9635beee597a52ccba00cabbe1513", "filename": "tests/ui/eta.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/tests%2Fui%2Feta.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4f801a278dc4ed68ef209f07fece4d8b8e99fbeb/tests%2Fui%2Feta.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Feta.stderr?ref=4f801a278dc4ed68ef209f07fece4d8b8e99fbeb", "patch": "@@ -68,5 +68,17 @@ error: redundant closure found\n LL |     let e: std::vec::Vec<char> = vec!['a', 'b', 'c'].iter().map(|c| c.to_ascii_uppercase()).collect();\n    |                                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: remove closure as shown: `char::to_ascii_uppercase`\n \n-error: aborting due to 11 previous errors\n+error: redundant closure found\n+  --> $DIR/eta.rs:145:27\n+   |\n+LL |     let a = Some(1u8).map(|a| foo_ptr(a));\n+   |                           ^^^^^^^^^^^^^^ help: remove closure as shown: `foo_ptr`\n+\n+error: redundant closure found\n+  --> $DIR/eta.rs:150:27\n+   |\n+LL |     let a = Some(1u8).map(|a| closure(a));\n+   |                           ^^^^^^^^^^^^^^ help: remove closure as shown: `closure`\n+\n+error: aborting due to 13 previous errors\n "}]}