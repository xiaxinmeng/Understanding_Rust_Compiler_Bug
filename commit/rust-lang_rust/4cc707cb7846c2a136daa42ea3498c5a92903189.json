{"sha": "4cc707cb7846c2a136daa42ea3498c5a92903189", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjYzcwN2NiNzg0NmMyYTEzNmRhYTQyZWEzNDk4YzVhOTI5MDMxODk=", "commit": {"author": {"name": "Denis Lisov", "email": "dennis.lissov@gmail.com", "date": "2019-10-06T21:29:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-06T21:29:47Z"}, "message": "use precalculated dominators in explain_borrow\n\nThis looks like the only place calculating dominators from the MIR body every time instead of using the ones stored on the `MirBorrowckCtxt`. For example, in rust-lang/rust#65131 a big generated function with a number of borrowck errors takes a few hours(!) recalculating the dominators while explaining the errors.\r\n\r\nI don't know enough about this part of rustc codebase to know for sure that this change is correct, but no tests seem to fail as a result of this change in local testing.", "tree": {"sha": "33f23ff19fbb8e0dc553463657a0feee744bed78", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33f23ff19fbb8e0dc553463657a0feee744bed78"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4cc707cb7846c2a136daa42ea3498c5a92903189", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdmlzLCRBK7hj4Ov3rIwAAdHIIAClTkFm5XIvtOXw7KjV6jfwi\n0CKmpufJCz1DebYoIi2eIZzUnRzQBUoD6vt0yzV1BoGrtal6+dNPp461soKQ7J8N\nkFmat05J2kU8riJj+R+nmm69tAf9a+wyaqK5J8fX2jKpvVckUrdCb3XAL8iuL9C1\nz/14hI9i6cfJJImer7SrLq2KXA8zY3k63RixsnAFZ/DkcLLaq2JAfW07BViFw01t\n86Ctki7Jhqt4IAEXSbfeXy4yrlHD8zYkTr/pQ+Meh5XcoApkNkeWSB1aT1h7Yc45\nzaYZI1zOzG3YdoGqr/hM/K+H35m27gOiEDx/j0o+hi0LxdCFrIpkBrj/I6NV4kM=\n=6TOg\n-----END PGP SIGNATURE-----\n", "payload": "tree 33f23ff19fbb8e0dc553463657a0feee744bed78\nparent 421bd77f42c2fe8a2596dbcc1580ec97fb89009f\nauthor Denis Lisov <dennis.lissov@gmail.com> 1570397387 +0300\ncommitter GitHub <noreply@github.com> 1570397387 +0300\n\nuse precalculated dominators in explain_borrow\n\nThis looks like the only place calculating dominators from the MIR body every time instead of using the ones stored on the `MirBorrowckCtxt`. For example, in rust-lang/rust#65131 a big generated function with a number of borrowck errors takes a few hours(!) recalculating the dominators while explaining the errors.\r\n\r\nI don't know enough about this part of rustc codebase to know for sure that this change is correct, but no tests seem to fail as a result of this change in local testing."}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4cc707cb7846c2a136daa42ea3498c5a92903189", "html_url": "https://github.com/rust-lang/rust/commit/4cc707cb7846c2a136daa42ea3498c5a92903189", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4cc707cb7846c2a136daa42ea3498c5a92903189/comments", "author": {"login": "tanriol", "id": 1027034, "node_id": "MDQ6VXNlcjEwMjcwMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1027034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tanriol", "html_url": "https://github.com/tanriol", "followers_url": "https://api.github.com/users/tanriol/followers", "following_url": "https://api.github.com/users/tanriol/following{/other_user}", "gists_url": "https://api.github.com/users/tanriol/gists{/gist_id}", "starred_url": "https://api.github.com/users/tanriol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tanriol/subscriptions", "organizations_url": "https://api.github.com/users/tanriol/orgs", "repos_url": "https://api.github.com/users/tanriol/repos", "events_url": "https://api.github.com/users/tanriol/events{/privacy}", "received_events_url": "https://api.github.com/users/tanriol/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "421bd77f42c2fe8a2596dbcc1580ec97fb89009f", "url": "https://api.github.com/repos/rust-lang/rust/commits/421bd77f42c2fe8a2596dbcc1580ec97fb89009f", "html_url": "https://github.com/rust-lang/rust/commit/421bd77f42c2fe8a2596dbcc1580ec97fb89009f"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "e6a33f8e6adf2cc19bc3e033dbe35d40adceefdf", "filename": "src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4cc707cb7846c2a136daa42ea3498c5a92903189/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fexplain_borrow%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cc707cb7846c2a136daa42ea3498c5a92903189/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fexplain_borrow%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fexplain_borrow%2Fmod.rs?ref=4cc707cb7846c2a136daa42ea3498c5a92903189", "patch": "@@ -457,7 +457,7 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n     /// True if an edge `source -> target` is a backedge -- in other words, if the target\n     /// dominates the source.\n     fn is_back_edge(&self, source: Location, target: Location) -> bool {\n-        target.dominates(source, &self.body.dominators())\n+        target.dominates(source, &self.dominators)\n     }\n \n     /// Determine how the borrow was later used."}]}