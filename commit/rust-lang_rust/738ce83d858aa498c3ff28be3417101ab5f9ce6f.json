{"sha": "738ce83d858aa498c3ff28be3417101ab5f9ce6f", "node_id": "C_kwDOAAsO6NoAKDczOGNlODNkODU4YWE0OThjM2ZmMjhiZTM0MTcxMDFhYjVmOWNlNmY", "commit": {"author": {"name": "Ian Chamberlain", "email": "ichamberlain@juniper.net", "date": "2023-01-03T15:49:47Z"}, "committer": {"name": "Ian Chamberlain", "email": "ichamberlain@juniper.net", "date": "2023-01-09T16:49:59Z"}, "message": "Strip colors before matching preview diagnostics", "tree": {"sha": "c62c1a5fa924a30d3e86db69c9e5052bb565302b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c62c1a5fa924a30d3e86db69c9e5052bb565302b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/738ce83d858aa498c3ff28be3417101ab5f9ce6f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEUeJtpptES4xNVu97vXsl1YFw4SQFAmO8RbcACgkQvXsl1YFw\n4SSMXQv9G+ktZSzrIo6k+MjLw5wgxB8QtkiSiUJUK93eDlFeTL4F5jHlgTlS5rka\nt6tWs0LhIvhaZrKTJRNugxvvcBHmrROhCfCDl77ERJ+hFpQvwuTiSSxIMO3Vt90V\npM7yJA7TzHWfaWA5RZtFwZ14ia993KJfweHvVgENZ0G8vzGHyrubeKWFnP4czE+A\nWeh1XZVyN7+j9GOcEqb6DjgBGngwf23jtm4bXW+5H2tlNqGbU30sVOxLhgaQAaLb\nueZei7gpb4oj5e+UHoICMkql3tE/vXPdVSWIpGmxAD9OnGQ2NzRLFBWgMaEsXg8E\ntDecjvWdkSR7p6BJCjGcWK4cwPEBUrLXGIraxTrznCRN5jd2UX9xgnzV5wum09jP\nuxKTUMnBxapwR6l0xaNA0Vug7j2A1lwncaMB/BoecqZ1ZI9hkQK+givOz+ntymxJ\neuD700IY9hU1ahOl1UTJVXIY3e0gnBGnuUWfdJucYiKaDYOrBMOgF8UhMivjohL7\nfc2yjNPw\n=xpZl\n-----END PGP SIGNATURE-----", "payload": "tree c62c1a5fa924a30d3e86db69c9e5052bb565302b\nparent c3e4bc313611d571123d4e4257af58784e42f47d\nauthor Ian Chamberlain <ichamberlain@juniper.net> 1672760987 -0500\ncommitter Ian Chamberlain <ichamberlain@juniper.net> 1673282999 -0500\n\nStrip colors before matching preview diagnostics\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/738ce83d858aa498c3ff28be3417101ab5f9ce6f", "html_url": "https://github.com/rust-lang/rust/commit/738ce83d858aa498c3ff28be3417101ab5f9ce6f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/738ce83d858aa498c3ff28be3417101ab5f9ce6f/comments", "author": {"login": "ian-h-chamberlain", "id": 11131775, "node_id": "MDQ6VXNlcjExMTMxNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/11131775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ian-h-chamberlain", "html_url": "https://github.com/ian-h-chamberlain", "followers_url": "https://api.github.com/users/ian-h-chamberlain/followers", "following_url": "https://api.github.com/users/ian-h-chamberlain/following{/other_user}", "gists_url": "https://api.github.com/users/ian-h-chamberlain/gists{/gist_id}", "starred_url": "https://api.github.com/users/ian-h-chamberlain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ian-h-chamberlain/subscriptions", "organizations_url": "https://api.github.com/users/ian-h-chamberlain/orgs", "repos_url": "https://api.github.com/users/ian-h-chamberlain/repos", "events_url": "https://api.github.com/users/ian-h-chamberlain/events{/privacy}", "received_events_url": "https://api.github.com/users/ian-h-chamberlain/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ian-h-chamberlain", "id": 11131775, "node_id": "MDQ6VXNlcjExMTMxNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/11131775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ian-h-chamberlain", "html_url": "https://github.com/ian-h-chamberlain", "followers_url": "https://api.github.com/users/ian-h-chamberlain/followers", "following_url": "https://api.github.com/users/ian-h-chamberlain/following{/other_user}", "gists_url": "https://api.github.com/users/ian-h-chamberlain/gists{/gist_id}", "starred_url": "https://api.github.com/users/ian-h-chamberlain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ian-h-chamberlain/subscriptions", "organizations_url": "https://api.github.com/users/ian-h-chamberlain/orgs", "repos_url": "https://api.github.com/users/ian-h-chamberlain/repos", "events_url": "https://api.github.com/users/ian-h-chamberlain/events{/privacy}", "received_events_url": "https://api.github.com/users/ian-h-chamberlain/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3e4bc313611d571123d4e4257af58784e42f47d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3e4bc313611d571123d4e4257af58784e42f47d", "html_url": "https://github.com/rust-lang/rust/commit/c3e4bc313611d571123d4e4257af58784e42f47d"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "c6d64ebc1ed9e64afc367586e1ea61f3def07a02", "filename": "editors/code/src/client.ts", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/738ce83d858aa498c3ff28be3417101ab5f9ce6f/editors%2Fcode%2Fsrc%2Fclient.ts", "raw_url": "https://github.com/rust-lang/rust/raw/738ce83d858aa498c3ff28be3417101ab5f9ce6f/editors%2Fcode%2Fsrc%2Fclient.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fclient.ts?ref=738ce83d858aa498c3ff28be3417101ab5f9ce6f", "patch": "@@ -1,3 +1,4 @@\n+import * as anser from \"anser\";\n import * as lc from \"vscode-languageclient/node\";\n import * as vscode from \"vscode\";\n import * as ra from \"../src/lsp_ext\";\n@@ -139,9 +140,10 @@ export async function createClient(\n                         ?.rendered;\n                     if (rendered) {\n                         if (preview) {\n+                            const decolorized = anser.ansiToText(rendered);\n                             const index =\n-                                rendered.match(/^(note|help):/m)?.index || rendered.length;\n-                            diag.message = rendered\n+                                decolorized.match(/^(note|help):/m)?.index || rendered.length;\n+                            diag.message = decolorized\n                                 .substring(0, index)\n                                 .replace(/^ -->[^\\n]+\\n/m, \"\");\n                         }"}]}