{"sha": "c78cc52afd99ec0b3dd7f83cd257f0be767a508a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3OGNjNTJhZmQ5OWVjMGIzZGQ3ZjgzY2QyNTdmMGJlNzY3YTUwOGE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-11-25T06:22:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-11-25T06:22:49Z"}, "message": "Auto merge of #37979 - nnethercote:Ty-super_fold_with, r=eddyb\n\nAvoid more unnecessary mk_ty calls in Ty::super_fold_with.\n\nThis speeds up several rustc-benchmarks by 1--5%.\n\nThis PR is the lovechild of #37108 and #37705.\n```\nfutures-rs-test  4.059s vs  4.011s --> 1.012x faster (variance: 1.016x, 1.026x)\nhelloworld       0.236s vs  0.239s --> 0.986x faster (variance: 1.051x, 1.014x)\nhtml5ever-2016-  3.831s vs  3.824s --> 1.002x faster (variance: 1.020x, 1.019x)\nhyper.0.5.0      4.928s vs  4.936s --> 0.998x faster (variance: 1.003x, 1.012x)\ninflate-0.1.0    4.135s vs  4.104s --> 1.007x faster (variance: 1.026x, 1.028x)\nissue-32062-equ  0.309s vs  0.303s --> 1.017x faster (variance: 1.019x, 1.084x)\nissue-32278-big  1.818s vs  1.797s --> 1.011x faster (variance: 1.011x, 1.008x)\njld-day15-parse  1.304s vs  1.271s --> 1.026x faster (variance: 1.018x, 1.012x)\npiston-image-0. 10.938s vs 10.921s --> 1.002x faster (variance: 1.025x, 1.016x)\nreddit-stress    2.327s vs  2.208s --> 1.054x faster (variance: 1.016x, 1.006x)\nregex-0.1.80     8.796s vs  8.727s --> 1.008x faster (variance: 1.012x, 1.019x)\nregex.0.1.30     2.294s vs  2.249s --> 1.020x faster (variance: 1.013x, 1.026x)\nrust-encoding-0  1.914s vs  1.886s --> 1.015x faster (variance: 1.027x, 1.026x)\n```", "tree": {"sha": "a8a5a0112b89908a2ad0c298265ed8362ae0e20f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a8a5a0112b89908a2ad0c298265ed8362ae0e20f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c78cc52afd99ec0b3dd7f83cd257f0be767a508a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c78cc52afd99ec0b3dd7f83cd257f0be767a508a", "html_url": "https://github.com/rust-lang/rust/commit/c78cc52afd99ec0b3dd7f83cd257f0be767a508a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c78cc52afd99ec0b3dd7f83cd257f0be767a508a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e7176f98bf64c3644408cec40c4b2541d96148e", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e7176f98bf64c3644408cec40c4b2541d96148e", "html_url": "https://github.com/rust-lang/rust/commit/2e7176f98bf64c3644408cec40c4b2541d96148e"}, {"sha": "4d0618ee3014b96287bb6914296b78bd474b0290", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d0618ee3014b96287bb6914296b78bd474b0290", "html_url": "https://github.com/rust-lang/rust/commit/4d0618ee3014b96287bb6914296b78bd474b0290"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "877da7ee3b51255167ab2f13db97edc2b85a8cd4", "filename": "src/librustc/ty/structural_impls.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c78cc52afd99ec0b3dd7f83cd257f0be767a508a/src%2Flibrustc%2Fty%2Fstructural_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78cc52afd99ec0b3dd7f83cd257f0be767a508a/src%2Flibrustc%2Fty%2Fstructural_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fstructural_impls.rs?ref=c78cc52afd99ec0b3dd7f83cd257f0be767a508a", "patch": "@@ -481,7 +481,12 @@ impl<'tcx> TypeFoldable<'tcx> for Ty<'tcx> {\n             ty::TyUint(_) | ty::TyFloat(_) | ty::TyError | ty::TyInfer(_) |\n             ty::TyParam(..) | ty::TyNever => return self\n         };\n-        folder.tcx().mk_ty(sty)\n+\n+        if self.sty == sty {\n+            self\n+        } else {\n+            folder.tcx().mk_ty(sty)\n+        }\n     }\n \n     fn fold_with<'gcx: 'tcx, F: TypeFolder<'gcx, 'tcx>>(&self, folder: &mut F) -> Self {"}]}