{"sha": "302f5d05f57b4debbe2890f7ebabbedb2059737f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwMmY1ZDA1ZjU3YjRkZWJiZTI4OTBmN2ViYWJiZWRiMjA1OTczN2Y=", "commit": {"author": {"name": "Phil Turnbull", "email": "philip.turnbull@gmail.com", "date": "2017-01-22T17:45:45Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-04-15T11:01:09Z"}, "message": "Lint `Option.map(f)` where f never returns", "tree": {"sha": "e534a957c83b3df98e600cb7877d46673f516a3b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e534a957c83b3df98e600cb7877d46673f516a3b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/302f5d05f57b4debbe2890f7ebabbedb2059737f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABCAAGBQJa0zD1AAoJELb6Bqbg4mZbYAIQAKIQrcgEZlCtYzuPiqvRu0CR\nZPz7WokVqQ4gR8TQ8mHw1mcHzxiTPpUcL3w7pi/kxWt7hYFTIOSJgOp/F1qpjnB0\nBjwJUBS5gpgPPdQTDH9sUSrTjtF2eDZz3V7/hUbXsAml7lvGnnTCzsr+Yp7doce4\ncGRRW+acciuzGGswmfSPpzukfcMuhoag7AljercOUOroCdEV9xIJZUqE53b8c+D7\nY5XbLUgI6o+6CmiSt8IyjntssykV4LjOcfOUB7PEx3XE7ZdJA8uPrr3JGSOD2o8p\n0oTY5hcZJ5LTfEY3SLYkHQe8KW0r1pt49zNBq88psCuhgdEZDZimx0mdbleulwiD\nLAVw+3qbxTjzGzPhtpD5wztltLtCmQ6iEgiLSHkUf12b5XXNAJwld3Pj0RF684s/\nudCswrtVqPtIGFOfWN/LCAk7eCF+3CXeQjU8Pr/bMzWHEC/yXqHsoihLp43Dzpts\nuBCnnaFiAWafPKbx0Aay5WaiXuxKsnW7NTjfF0PqHGIOM6/DIMpS+ojCqGWnAuSl\nPweMD2X68Ur0eNXQeR6qNKZm5gPpcSq2mwt+mY1GApvZxb4lr5AARlF5+kcxldLP\no9xVYsMDeHg5yrogEsxG5d2Jr9a3tdmo9YVXxgYAbEctWHwjzDGHwasshMMgrpDT\nOCtDQ3j7gFTMUfVSNi7S\n=A0fa\n-----END PGP SIGNATURE-----", "payload": "tree e534a957c83b3df98e600cb7877d46673f516a3b\nparent e5ecbb55ee68370c629215e077ced565c0925d22\nauthor Phil Turnbull <philip.turnbull@gmail.com> 1485107145 -0500\ncommitter Philipp Hansch <dev@phansch.net> 1523790069 +0200\n\nLint `Option.map(f)` where f never returns\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/302f5d05f57b4debbe2890f7ebabbedb2059737f", "html_url": "https://github.com/rust-lang/rust/commit/302f5d05f57b4debbe2890f7ebabbedb2059737f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/302f5d05f57b4debbe2890f7ebabbedb2059737f/comments", "author": {"login": "philipturnbull", "id": 45588, "node_id": "MDQ6VXNlcjQ1NTg4", "avatar_url": "https://avatars.githubusercontent.com/u/45588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philipturnbull", "html_url": "https://github.com/philipturnbull", "followers_url": "https://api.github.com/users/philipturnbull/followers", "following_url": "https://api.github.com/users/philipturnbull/following{/other_user}", "gists_url": "https://api.github.com/users/philipturnbull/gists{/gist_id}", "starred_url": "https://api.github.com/users/philipturnbull/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philipturnbull/subscriptions", "organizations_url": "https://api.github.com/users/philipturnbull/orgs", "repos_url": "https://api.github.com/users/philipturnbull/repos", "events_url": "https://api.github.com/users/philipturnbull/events{/privacy}", "received_events_url": "https://api.github.com/users/philipturnbull/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e5ecbb55ee68370c629215e077ced565c0925d22", "url": "https://api.github.com/repos/rust-lang/rust/commits/e5ecbb55ee68370c629215e077ced565c0925d22", "html_url": "https://github.com/rust-lang/rust/commit/e5ecbb55ee68370c629215e077ced565c0925d22"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "9502c5d056327c6525832bac56ff81b4a6571c4b", "filename": "clippy_lints/src/map_nil_fn.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/302f5d05f57b4debbe2890f7ebabbedb2059737f/clippy_lints%2Fsrc%2Fmap_nil_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/302f5d05f57b4debbe2890f7ebabbedb2059737f/clippy_lints%2Fsrc%2Fmap_nil_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_nil_fn.rs?ref=302f5d05f57b4debbe2890f7ebabbedb2059737f", "patch": "@@ -45,7 +45,7 @@ fn is_nil_function(cx: &LateContext, expr: &hir::Expr) -> bool {\n \n     if let ty::TyFnDef(_, _, bare) = ty.sty {\n         if let Some(fn_type) = cx.tcx.no_late_bound_regions(&bare.sig) {\n-            return fn_type.output().is_nil();\n+            return fn_type.output().is_nil() || fn_type.output().is_never();\n         }\n     }\n     false"}, {"sha": "03f77c5003483c24d6d018172f2d3cd2e5d5eeed", "filename": "tests/compile-fail/map_nil_fn.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/302f5d05f57b4debbe2890f7ebabbedb2059737f/tests%2Fcompile-fail%2Fmap_nil_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/302f5d05f57b4debbe2890f7ebabbedb2059737f/tests%2Fcompile-fail%2Fmap_nil_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fmap_nil_fn.rs?ref=302f5d05f57b4debbe2890f7ebabbedb2059737f", "patch": "@@ -7,6 +7,10 @@\n \n fn do_nothing<T>(_: T) {}\n \n+fn diverge<T>(_: T) -> ! {\n+    panic!()\n+}\n+\n fn plus_one(value: usize) -> usize {\n     value + 1\n }\n@@ -39,4 +43,9 @@ fn main() {\n     //~^ ERROR called `map(f)` on an Option value where `f` is a nil function\n     //~| HELP try this\n     //~| SUGGESTION if let Some(...) = x.field { do_nothing(...) }\n+\n+    x.field.map(diverge);\n+    //~^ ERROR called `map(f)` on an Option value where `f` is a nil function\n+    //~| HELP try this\n+    //~| SUGGESTION if let Some(...) = x.field { diverge(...) }\n }"}]}