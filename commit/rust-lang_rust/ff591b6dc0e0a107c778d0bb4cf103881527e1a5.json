{"sha": "ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZmNTkxYjZkYzBlMGExMDdjNzc4ZDBiYjRjZjEwMzg4MTUyN2UxYTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-15T23:49:24Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-15T23:49:24Z"}, "message": "Auto merge of #39042 - alexcrichton:upload-more, r=brson\n\ntravis: Expand dist builder coverage\n\nThis commit adds six new travis matrix entires for doing cross-compiled\ndistribution builds of the compiler. The support added in #38731 allows us to\nquickly compile a complete suite of distribution artifacts for cross-compiled\nplatforms, and currently each matrix entry (when fully cached) clocks in around\nan hour to finish. Note that a full test run typically takes about two hours\nright now.\n\nWith further optimizations coming down the pike in #39026 this commit also\nstarts doubling up cross-compiled distribution builders on each matrix entry. We\ninitially planned to do one build per entry, but it's looking like we may be\nable to get by with more than one in each entry. Depending on how long these\nbuilds take we may even be able to up it to three, but we'll start with two\nfirst.\n\nThis commit then completes the suite of cross-compiled compilers that we're\ngoing to compile, adding it for a whole litany of platforms detailed in the\nchanges to the docker files here. The existing `cross` image is also trimmed\ndown quite a bit to avoid duplicate work, and we'll eventually provision it for\nfar more cross compilation as well.\n\nNote that the gcc toolchains installed to compile most of these compilers are\ninappropriate for actualy distribution. The glibc they pull in is much newer\nthan we'd like, so before we turn nightlies off we'll need to tweak these docker\nfiles to custom build toolchains like the current `linux-cross` docker image\ndoes.", "tree": {"sha": "7de747d6c430717979a83d7c1f236eafba0be4c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7de747d6c430717979a83d7c1f236eafba0be4c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "html_url": "https://github.com/rust-lang/rust/commit/ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0ef85a6b1c06839197c26a895cb6d8ce36915800", "url": "https://api.github.com/repos/rust-lang/rust/commits/0ef85a6b1c06839197c26a895cb6d8ce36915800", "html_url": "https://github.com/rust-lang/rust/commit/0ef85a6b1c06839197c26a895cb6d8ce36915800"}, {"sha": "a6d88b023a941511ac824a8eee44540e8db04ac1", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6d88b023a941511ac824a8eee44540e8db04ac1", "html_url": "https://github.com/rust-lang/rust/commit/a6d88b023a941511ac824a8eee44540e8db04ac1"}], "stats": {"total": 449, "additions": 394, "deletions": 55}, "files": [{"sha": "abd0a8fe346f02a070b863f47fccfbfd93b29aee", "filename": ".travis.yml", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -15,8 +15,14 @@ matrix:\n     # Linux builders, all docker images\n     - env: IMAGE=arm-android DEPLOY=1\n     - env: IMAGE=cross DEPLOY=1\n-    - env: IMAGE=dist-arm-unknown-linux-gnueabi DEPLOY=1\n-    - env: IMAGE=dist-x86_64-unknown-freebsd DEPLOY=1\n+    - env: IMAGE=dist-arm-linux DEPLOY=1\n+    - env: IMAGE=dist-armv7-aarch64-linux DEPLOY=1\n+    - env: IMAGE=dist-freebsd DEPLOY=1\n+    - env: IMAGE=dist-mips-linux DEPLOY=1\n+    - env: IMAGE=dist-mips64-linux DEPLOY=1\n+    - env: IMAGE=dist-powerpc-linux DEPLOY=1\n+    - env: IMAGE=dist-powerpc64-linux DEPLOY=1\n+    - env: IMAGE=dist-s390x-linux-netbsd DEPLOY=1\n     - env: IMAGE=i686-gnu DEPLOY=1\n     - env: IMAGE=i686-gnu-nopt\n     - env: IMAGE=x86_64-gnu DEPLOY=1"}, {"sha": "d81666e84262ff5249df688b31219b2e9a12d30a", "filename": "src/ci/docker/arm-android/Dockerfile", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -53,4 +53,8 @@ ENV RUST_CONFIGURE_ARGS \\\n # to all the targets above eventually.\n ENV SCRIPT \\\n   python2.7 ../x.py test --target arm-linux-androideabi && \\\n-  python2.7 ../x.py dist --target arm-linux-androideabi\n+  python2.7 ../x.py dist \\\n+      --target arm-linux-androideabi \\\n+      --target armv7-linux-androideabi \\\n+      --target i686-linux-android \\\n+      --target aarch64-linux-android"}, {"sha": "7872397645136f240d4177e51c0e60bb5976239e", "filename": "src/ci/docker/cross/Dockerfile", "status": "modified", "additions": 1, "deletions": 36, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fcross%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -10,17 +10,6 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   git \\\n   cmake \\\n   sudo \\\n-  gcc-aarch64-linux-gnu libc6-dev-arm64-cross \\\n-  gcc-arm-linux-gnueabi libc6-dev-armel-cross \\\n-  gcc-arm-linux-gnueabihf libc6-dev-armhf-cross \\\n-  gcc-mips-linux-gnu libc6-dev-mips-cross \\\n-  gcc-mipsel-linux-gnu libc6-dev-mipsel-cross \\\n-  gcc-mips64-linux-gnuabi64 libc6-dev-mips64-cross \\\n-  gcc-mips64el-linux-gnuabi64 libc6-dev-mips64el-cross \\\n-  gcc-powerpc-linux-gnu libc6-dev-powerpc-cross \\\n-  gcc-powerpc64-linux-gnu libc6-dev-ppc64-cross \\\n-  gcc-powerpc64le-linux-gnu libc6-dev-ppc64el-cross \\\n-  gcc-s390x-linux-gnu libc6-dev-s390x-cross \\\n   xz-utils\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n@@ -32,19 +21,7 @@ RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-ini\n     rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-ENV TARGETS=aarch64-unknown-linux-gnu\n-ENV TARGETS=$TARGETS,arm-unknown-linux-gnueabi\n-ENV TARGETS=$TARGETS,arm-unknown-linux-gnueabihf\n-ENV TARGETS=$TARGETS,armv7-unknown-linux-gnueabihf\n-ENV TARGETS=$TARGETS,asmjs-unknown-emscripten\n-ENV TARGETS=$TARGETS,mips-unknown-linux-gnu\n-ENV TARGETS=$TARGETS,mips64-unknown-linux-gnuabi64\n-ENV TARGETS=$TARGETS,mips64el-unknown-linux-gnuabi64\n-ENV TARGETS=$TARGETS,mipsel-unknown-linux-gnu\n-ENV TARGETS=$TARGETS,powerpc-unknown-linux-gnu\n-ENV TARGETS=$TARGETS,powerpc64-unknown-linux-gnu\n-ENV TARGETS=$TARGETS,powerpc64le-unknown-linux-gnu\n-ENV TARGETS=$TARGETS,s390x-unknown-linux-gnu\n+ENV TARGETS=asmjs-unknown-emscripten\n ENV TARGETS=$TARGETS,wasm32-unknown-emscripten\n \n #ENV TARGETS=$TARGETS,mips-unknown-linux-musl\n@@ -62,15 +39,3 @@ ENV RUST_CONFIGURE_ARGS \\\n ENV SCRIPT \\\n   python2.7 ../x.py build && \\\n   python2.7 ../x.py dist --target wasm32-unknown-emscripten\n-\n-ENV AR_s390x_unknown_linux_gnu=s390x-linux-gnu-ar \\\n-    CC_s390x_unknown_linux_gnu=s390x-linux-gnu-gcc \\\n-    AR_mips64_unknown_linux_gnuabi64=mips64-linux-gnuabi64-ar \\\n-    CC_mips64_unknown_linux_gnuabi64=mips64-linux-gnuabi64-gcc \\\n-    AR_mips64el_unknown_linux_gnuabi64=mips64el-linux-gnuabi64-ar \\\n-    CC_mips64el_unknown_linux_gnuabi64=mips64el-linux-gnuabi64-gcc \\\n-    AR_powerpc64_unknown_linux_gnu=powerpc64-linux-gnu-ar \\\n-    CC_powerpc64_unknown_linux_gnu=powerpc64-linux-gnu-gcc\n-\n-# FIXME(rust-lang/rust#36150): powerpc unfortunately aborts right now\n-ENV NO_LLVM_ASSERTIONS=1"}, {"sha": "1aafc669d1023d8c9912e46db0bb05b0ba4f6345", "filename": "src/ci/docker/dist-arm-linux/Dockerfile", "status": "renamed", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -12,7 +12,8 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   gdb \\\n   xz-utils \\\n-  g++-arm-linux-gnueabi\n+  g++-arm-linux-gnueabi \\\n+  g++-arm-linux-gnueabihf\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n@@ -23,8 +24,11 @@ RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-ini\n     rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-ENV RUST_CONFIGURE_ARGS --host=arm-unknown-linux-gnueabi\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=arm-unknown-linux-gnueabi,arm-unknown-linux-gnueabihf\n ENV SCRIPT \\\n       python2.7 ../x.py dist \\\n         --host arm-unknown-linux-gnueabi \\\n-        --target arm-unknown-linux-gnueabi\n+        --target arm-unknown-linux-gnueabi \\\n+        --host arm-unknown-linux-gnueabihf \\\n+        --target arm-unknown-linux-gnueabihf", "previous_filename": "src/ci/docker/dist-arm-unknown-linux-gnueabi/Dockerfile"}, {"sha": "134e2b062ef0b0851b6042da807a03092243e71f", "filename": "src/ci/docker/dist-armv7-aarch64-linux/Dockerfile", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-armv7-aarch64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-armv7-aarch64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-armv7-aarch64-linux%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -0,0 +1,34 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  gdb \\\n+  xz-utils \\\n+  g++-arm-linux-gnueabihf \\\n+  g++-aarch64-linux-gnu\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=armv7-unknown-linux-gnueabihf,aarch64-unknown-linux-gnu\n+ENV SCRIPT \\\n+      python2.7 ../x.py dist \\\n+        --host armv7-unknown-linux-gnueabihf \\\n+        --target armv7-unknown-linux-gnueabihf \\\n+        --host aarch64-unknown-linux-gnu \\\n+        --target aarch64-unknown-linux-gnu"}, {"sha": "b49396c935c007275d5eeafa93ea0a49e636ce81", "filename": "src/ci/docker/dist-freebsd/Dockerfile", "status": "renamed", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-freebsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-freebsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-freebsd%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -15,7 +15,8 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   wget\n \n COPY build-toolchain.sh /tmp/\n-RUN sh /tmp/build-toolchain.sh\n+RUN /tmp/build-toolchain.sh x86_64\n+RUN /tmp/build-toolchain.sh i686\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\\n@@ -29,10 +30,16 @@ RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST |\n ENV \\\n     AR_x86_64_unknown_freebsd=x86_64-unknown-freebsd10-ar \\\n     CC_x86_64_unknown_freebsd=x86_64-unknown-freebsd10-gcc \\\n-    CXX_x86_64_unknown_freebsd=x86_64-unknown-freebsd10-g++\n+    CXX_x86_64_unknown_freebsd=x86_64-unknown-freebsd10-g++ \\\n+    AR_i686_unknown_freebsd=i686-unknown-freebsd10-ar \\\n+    CC_i686_unknown_freebsd=i686-unknown-freebsd10-gcc \\\n+    CXX_i686_unknown_freebsd=i686-unknown-freebsd10-g++\n \n-ENV RUST_CONFIGURE_ARGS --host=x86_64-unknown-freebsd\n+ENV RUST_CONFIGURE_ARGS \\\n+        --host=x86_64-unknown-freebsd,i686-unknown-freebsd\n ENV SCRIPT \\\n       python2.7 ../x.py dist \\\n         --host x86_64-unknown-freebsd \\\n-        --target x86_64-unknown-freebsd\n+        --target x86_64-unknown-freebsd \\\n+        --host i686-unknown-freebsd \\\n+        --target i686-unknown-freebsd", "previous_filename": "src/ci/docker/dist-x86_64-unknown-freebsd/Dockerfile"}, {"sha": "5642e6fc937f9736e14bc23aed1fca4b045bc88a", "filename": "src/ci/docker/dist-freebsd/build-toolchain.sh", "status": "renamed", "additions": 23, "deletions": 7, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-freebsd%2Fbuild-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-freebsd%2Fbuild-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-freebsd%2Fbuild-toolchain.sh?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -11,21 +11,37 @@\n \n set -ex\n \n-ARCH=x86_64\n+ARCH=$1\n BINUTILS=2.25.1\n GCC=5.3.0\n \n+hide_output() {\n+  set +x\n+  on_err=\"\n+echo ERROR: An error was encountered with the build.\n+cat /tmp/build.log\n+exit 1\n+\"\n+  trap \"$on_err\" ERR\n+  bash -c \"while true; do sleep 30; echo \\$(date) - building ...; done\" &\n+  PING_LOOP_PID=$!\n+  $@ &> /tmp/build.log\n+  trap - ERR\n+  kill $PING_LOOP_PID\n+  set -x\n+}\n+\n mkdir binutils\n cd binutils\n \n # First up, build binutils\n curl https://ftp.gnu.org/gnu/binutils/binutils-$BINUTILS.tar.bz2 | tar xjf -\n mkdir binutils-build\n cd binutils-build\n-../binutils-$BINUTILS/configure \\\n+hide_output ../binutils-$BINUTILS/configure \\\n   --target=$ARCH-unknown-freebsd10\n-make -j10\n-make install\n+hide_output make -j10\n+hide_output make install\n cd ../..\n rm -rf binutils\n \n@@ -76,7 +92,7 @@ cd gcc-$GCC\n \n mkdir ../gcc-build\n cd ../gcc-build\n-../gcc-$GCC/configure                            \\\n+hide_output ../gcc-$GCC/configure                \\\n   --enable-languages=c,c++                       \\\n   --target=$ARCH-unknown-freebsd10               \\\n   --disable-multilib                             \\\n@@ -90,7 +106,7 @@ cd ../gcc-build\n   --disable-libsanitizer                         \\\n   --disable-libquadmath-support                  \\\n   --disable-lto\n-make -j10\n-make install\n+hide_output make -j10\n+hide_output make install\n cd ../..\n rm -rf gcc", "previous_filename": "src/ci/docker/dist-x86_64-unknown-freebsd/build-toolchain.sh"}, {"sha": "a495cf57dc51ce4651e81ab079059575f4c26279", "filename": "src/ci/docker/dist-mips-linux/Dockerfile", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -0,0 +1,34 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  gdb \\\n+  xz-utils \\\n+  g++-mips-linux-gnu \\\n+  g++-mipsel-linux-gnu\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=mips-unknown-linux-gnu,mipsel-unknown-linux-gnu\n+ENV SCRIPT \\\n+      python2.7 ../x.py dist \\\n+        --host mips-unknown-linux-gnu \\\n+        --target mips-unknown-linux-gnu \\\n+        --host mipsel-unknown-linux-gnu \\\n+        --target mipsel-unknown-linux-gnu"}, {"sha": "bdb634f530392d86051035f1e38468be76b76f4e", "filename": "src/ci/docker/dist-mips64-linux/Dockerfile", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -0,0 +1,34 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  gdb \\\n+  xz-utils \\\n+  g++-mips64-linux-gnuabi64 \\\n+  g++-mips64el-linux-gnuabi64\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=mips64-unknown-linux-gnuabi64,mips64el-unknown-linux-gnuabi64\n+ENV SCRIPT \\\n+      python2.7 ../x.py dist \\\n+        --host mips64-unknown-linux-gnuabi64 \\\n+        --target mips64-unknown-linux-gnuabi64 \\\n+        --host mips64el-unknown-linux-gnuabi64 \\\n+        --target mips64el-unknown-linux-gnuabi64"}, {"sha": "579824dfdb41a147ca2898475ea9b93ddaa08d22", "filename": "src/ci/docker/dist-powerpc-linux/Dockerfile", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -0,0 +1,35 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  gdb \\\n+  xz-utils \\\n+  g++-powerpc-linux-gnu\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=powerpc-unknown-linux-gnu\n+ENV SCRIPT \\\n+      python2.7 ../x.py dist \\\n+        --host powerpc-unknown-linux-gnu \\\n+        --target powerpc-unknown-linux-gnu\n+\n+# FIXME(#36150) this will fail the bootstrap. Probably means something bad is\n+#               happening!\n+ENV NO_LLVM_ASSERTIONS 1"}, {"sha": "33877d4b3e9f144a2185503c758818b77ec5efb2", "filename": "src/ci/docker/dist-powerpc64-linux/Dockerfile", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -0,0 +1,39 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  gdb \\\n+  xz-utils \\\n+  g++-powerpc64-linux-gnu \\\n+  g++-powerpc64le-linux-gnu\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+ENV \\\n+    AR_powerpc64_unknown_linux_gnu=powerpc64-linux-gnu-ar \\\n+    CC_powerpc64_unknown_linux_gnu=powerpc64-linux-gnu-gcc \\\n+    CXX_powerpc64_unknown_linux_gnu=powerpc64-linux-gnu-g++\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=powerpc64-unknown-linux-gnu,powerpc64le-unknown-linux-gnu\n+ENV SCRIPT \\\n+      python2.7 ../x.py dist \\\n+        --host powerpc64-unknown-linux-gnu \\\n+        --target powerpc64-unknown-linux-gnu \\\n+        --host powerpc64le-unknown-linux-gnu \\\n+        --target powerpc64le-unknown-linux-gnu"}, {"sha": "a59bc7012cacd81b1c8332bf497e2d7a86ba8053", "filename": "src/ci/docker/dist-s390x-linux-netbsd/Dockerfile", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2FDockerfile?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -0,0 +1,43 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  bzip2 \\\n+  xz-utils \\\n+  wget \\\n+  patch \\\n+  g++-s390x-linux-gnu\n+\n+COPY build-toolchain.sh /tmp/\n+RUN sh /tmp/build-toolchain.sh\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n+ENV \\\n+    AR_x86_64_unknown_netbsd=x86_64-unknown-netbsd-ar \\\n+    CC_x86_64_unknown_netbsd=x86_64-unknown-netbsd-gcc \\\n+    CXX_x86_64_unknown_netbsd=x86_64-unknown-netbsd-g++\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+        --host=x86_64-unknown-netbsd,s390x-unknown-linux-gnu\n+ENV SCRIPT \\\n+      python2.7 ../x.py dist \\\n+        --host x86_64-unknown-netbsd \\\n+        --target x86_64-unknown-netbsd \\\n+        --host s390x-unknown-linux-gnu \\\n+        --target s390x-unknown-linux-gnu"}, {"sha": "6b76636ee48c1f2486183a6b69162df91583f2a2", "filename": "src/ci/docker/dist-s390x-linux-netbsd/build-toolchain.sh", "status": "added", "additions": 116, "deletions": 0, "changes": 116, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2Fbuild-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2Fbuild-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2Fbuild-toolchain.sh?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -0,0 +1,116 @@\n+#!/bin/bash\n+# Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+# ignore-tidy-linelength\n+\n+set -ex\n+\n+BINUTILS=2.25.1\n+GCC=5.3.0\n+\n+# First up, build binutils\n+mkdir binutils\n+cd binutils\n+curl https://ftp.gnu.org/gnu/binutils/binutils-$BINUTILS.tar.bz2 | tar xjf -\n+mkdir binutils-build\n+cd binutils-build\n+../binutils-$BINUTILS/configure \\\n+  --target=x86_64-unknown-netbsd\n+make -j10\n+make install\n+cd ../..\n+rm -rf binutils\n+\n+# Next, download the NetBSD libc and relevant header files\n+mkdir netbsd\n+curl https://ftp.netbsd.org/pub/NetBSD/NetBSD-7.0/amd64/binary/sets/base.tgz | \\\n+  tar xzf - -C netbsd ./usr/include ./usr/lib ./lib\n+curl https://ftp.netbsd.org/pub/NetBSD/NetBSD-7.0/amd64/binary/sets/comp.tgz | \\\n+  tar xzf - -C netbsd ./usr/include ./usr/lib\n+\n+dst=/usr/local/x86_64-unknown-netbsd\n+cp -r netbsd/usr/include $dst\n+cp netbsd/usr/lib/crt0.o $dst/lib\n+cp netbsd/usr/lib/crti.o $dst/lib\n+cp netbsd/usr/lib/crtn.o $dst/lib\n+cp netbsd/usr/lib/crtbeginS.o $dst/lib\n+cp netbsd/usr/lib/crtendS.o $dst/lib\n+cp netbsd/usr/lib/crtbegin.o $dst/lib\n+cp netbsd/usr/lib/crtend.o $dst/lib\n+cp netbsd/usr/lib/gcrt0.o $dst/lib\n+cp netbsd/usr/lib/libc.a $dst/lib\n+cp netbsd/usr/lib/libc_p.a $dst/lib\n+cp netbsd/usr/lib/libc_pic.a $dst/lib\n+cp netbsd/lib/libc.so.12.193.1 $dst/lib\n+cp netbsd/lib/libutil.so.7.21 $dst/lib\n+cp netbsd/usr/lib/libm.a $dst/lib\n+cp netbsd/usr/lib/libm_p.a $dst/lib\n+cp netbsd/usr/lib/libm_pic.a $dst/lib\n+cp netbsd/lib/libm.so.0.11 $dst/lib\n+cp netbsd/usr/lib/librt.so.1.1 $dst/lib\n+cp netbsd/usr/lib/libpthread.a $dst/lib\n+cp netbsd/usr/lib/libpthread_p.a $dst/lib\n+cp netbsd/usr/lib/libpthread_pic.a $dst/lib\n+cp netbsd/usr/lib/libpthread.so.1.2 $dst/lib\n+\n+ln -s libc.so.12.193.1 $dst/lib/libc.so\n+ln -s libc.so.12.193.1 $dst/lib/libc.so.12\n+ln -s libm.so.0.11 $dst/lib/libm.so\n+ln -s libm.so.0.11 $dst/lib/libm.so.0\n+ln -s libutil.so.7.21 $dst/lib/libutil.so\n+ln -s libutil.so.7.21 $dst/lib/libutil.so.7\n+ln -s libpthread.so.1.2 $dst/lib/libpthread.so\n+ln -s libpthread.so.1.2 $dst/lib/libpthread.so.1\n+ln -s librt.so.1.1 $dst/lib/librt.so\n+\n+rm -rf netbsd\n+\n+# Finally, download and build gcc to target NetBSD\n+mkdir gcc\n+cd gcc\n+curl https://ftp.gnu.org/gnu/gcc/gcc-$GCC/gcc-$GCC.tar.bz2 | tar xjf -\n+cd gcc-$GCC\n+./contrib/download_prerequisites\n+\n+# Originally from\n+# ftp://ftp.netbsd.org/pub/pkgsrc/pkgsrc-2016Q4/pkgsrc/lang/gcc5/patches/patch-libstdc%2B%2B-v3_config_os_bsd_netbsd_ctype__base.h\n+PATCHES=\"https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-01-13-netbsd-patch1.patch\"\n+\n+# Originally from\n+# ftp://ftp.netbsd.org/pub/pkgsrc/pkgsrc-2016Q4/pkgsrc/lang/gcc5/patches/patch-libstdc%2B%2B-v3_config_os_bsd_netbsd_ctype__configure__char.cc\n+PATCHES=\"$PATCHES https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-01-13-netbsd-patch2.patch\"\n+\n+for patch in $PATCHES; do\n+  curl $patch | patch -Np0\n+done\n+\n+mkdir ../gcc-build\n+cd ../gcc-build\n+../gcc-$GCC/configure                            \\\n+  --enable-languages=c,c++                       \\\n+  --target=x86_64-unknown-netbsd                 \\\n+  --disable-libcilkrts                           \\\n+  --disable-multilib                             \\\n+  --disable-nls                                  \\\n+  --disable-libgomp                              \\\n+  --disable-libquadmath                          \\\n+  --disable-libssp                               \\\n+  --disable-libvtv                               \\\n+  --disable-libcilkrt                            \\\n+  --disable-libada                               \\\n+  --disable-libsanitizer                         \\\n+  --disable-libquadmath-support                  \\\n+  --disable-lto\n+make -j10\n+make install\n+\n+cd ../..\n+rm -rf gcc"}, {"sha": "0b83c292f0077613c1adc96fa58590fab8a69c7a", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ff591b6dc0e0a107c778d0bb4cf103881527e1a5/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=ff591b6dc0e0a107c778d0bb4cf103881527e1a5", "patch": "@@ -25,8 +25,10 @@ docker \\\n   -t rust-ci \\\n   \"`dirname \"$script\"`/$image\"\n \n+objdir=$root_dir/obj\n+\n mkdir -p $HOME/.cargo\n-mkdir -p $root_dir/obj\n+mkdir -p $objdir\n \n args=\n if [ \"$SCCACHE_BUCKET\" != \"\" ]; then\n@@ -41,7 +43,7 @@ fi\n exec docker \\\n   run \\\n   --volume \"$root_dir:/checkout:ro\" \\\n-  --volume \"$root_dir/obj:/checkout/obj\" \\\n+  --volume \"$objdir:/checkout/obj\" \\\n   --workdir /checkout/obj \\\n   --env SRC=/checkout \\\n   $args \\"}]}