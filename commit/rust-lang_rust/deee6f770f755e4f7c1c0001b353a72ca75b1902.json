{"sha": "deee6f770f755e4f7c1c0001b353a72ca75b1902", "node_id": "C_kwDOAAsO6NoAKGRlZWU2Zjc3MGY3NTVlNGY3YzFjMDAwMWIzNTNhNzJjYTc1YjE5MDI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-01-18T03:42:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-18T03:42:02Z"}, "message": "Rollup merge of #92830 - jsha:style-cleanups, r=GuillaumeGomez\n\nRustdoc style cleanups\n\n - Make \"since\" version numbers grey again (regressed in #92602).\n - Remove unneeded selectors for when crate filter dropdown is a\n   sibling of search-input.\n - Crate filter dropdown doesn't need to be 100% width on mobile.\n - Only build crate filter dropdown when there is more than one crate.\n - Remove unused addCrateDropdown\n\n Demo: https://rustdoc.crud.net/jsha/style-cleanups/std/string/struct.String.html\n\n r? `@GuillaumeGomez`", "tree": {"sha": "99dfc8b0e5e7cb2ddbd24cae2b07194961ae6ff4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/99dfc8b0e5e7cb2ddbd24cae2b07194961ae6ff4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/deee6f770f755e4f7c1c0001b353a72ca75b1902", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh5jcKCRBK7hj4Ov3rIwAAj18IAKQifwYddVp4EkCwqXA6eiYH\nQU4yTJY7Fr8ZEt9XdczEMAMTjVwHYkPbL1VtoOXyU2SQpqzH/Rn40rSfmaSId9Qc\nEI2XJde4b6xUAyIm76AqRsYg5fIsQWeOw9KMJkF+HxMvKCSuxEKbN9wf2Uvmip5p\nvag9egoKWJe+m10hIa3dmKb3+60V+lvdhPM1ttTI8zM0rIZAs/ZMzIHP30RFB1Gk\n2Mtb/i0o1boUJpQrPJ2kVQTi9LzbXv5Lr0tULNHqSLSn4f94kh1fW0veo4hcBFoF\nR/BWAJzp8nYqdTzt44U+3Uo2itKK7xHeWg1yde+giZGQqMZr6SK2o+iviDIO03A=\n=aB2X\n-----END PGP SIGNATURE-----\n", "payload": "tree 99dfc8b0e5e7cb2ddbd24cae2b07194961ae6ff4\nparent cc2339ce83b6874b213b2385fd7eb7cb6c674aa1\nparent ae99e23c111a811e7edd886c74b5dc6417dd02d6\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1642477322 +0100\ncommitter GitHub <noreply@github.com> 1642477322 +0100\n\nRollup merge of #92830 - jsha:style-cleanups, r=GuillaumeGomez\n\nRustdoc style cleanups\n\n - Make \"since\" version numbers grey again (regressed in #92602).\n - Remove unneeded selectors for when crate filter dropdown is a\n   sibling of search-input.\n - Crate filter dropdown doesn't need to be 100% width on mobile.\n - Only build crate filter dropdown when there is more than one crate.\n - Remove unused addCrateDropdown\n\n Demo: https://rustdoc.crud.net/jsha/style-cleanups/std/string/struct.String.html\n\n r? `@GuillaumeGomez`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/deee6f770f755e4f7c1c0001b353a72ca75b1902", "html_url": "https://github.com/rust-lang/rust/commit/deee6f770f755e4f7c1c0001b353a72ca75b1902", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/deee6f770f755e4f7c1c0001b353a72ca75b1902/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc2339ce83b6874b213b2385fd7eb7cb6c674aa1", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc2339ce83b6874b213b2385fd7eb7cb6c674aa1", "html_url": "https://github.com/rust-lang/rust/commit/cc2339ce83b6874b213b2385fd7eb7cb6c674aa1"}, {"sha": "ae99e23c111a811e7edd886c74b5dc6417dd02d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae99e23c111a811e7edd886c74b5dc6417dd02d6", "html_url": "https://github.com/rust-lang/rust/commit/ae99e23c111a811e7edd886c74b5dc6417dd02d6"}], "stats": {"total": 103, "additions": 62, "deletions": 41}, "files": [{"sha": "bfdce74de67da6e6413312e8260eb9f7b1625ae0", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -944,11 +944,6 @@ h2.small-section-header > .anchor {\n \twidth: 100%;\n }\n \n-#crate-search + .search-input {\n-\tborder-radius: 0 1px 1px 0;\n-\twidth: calc(100% - 32px);\n-}\n-\n .search-input:focus {\n \tborder-radius: 2px;\n \tborder: 0;\n@@ -2081,7 +2076,6 @@ details.rustdoc-toggle[open] > summary.hideme::after {\n \t}\n \n \t#crate-search {\n-\t\twidth: 100%;\n \t\tborder-radius: 4px;\n \t\tborder: 0;\n \t}"}, {"sha": "885fe7c09a9732dbda3f3872c54e722101a45b75", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -299,7 +299,8 @@ details.undocumented > summary::before {\n \tborder-color: #5c6773;\n }\n \n-.since {\n+.rightside,\n+.out-of-band {\n \tcolor: grey;\n }\n "}, {"sha": "71af77978328f0a99ab0d3c6b737776e6c499390", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -256,7 +256,8 @@ details.undocumented > summary::before {\n \tbackground: rgba(0,0,0,0);\n }\n \n-.since {\n+.rightside,\n+.out-of-band {\n \tcolor: grey;\n }\n "}, {"sha": "e462fd16237f2b2d6388a94dbe0d28220dd2b8a2", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -243,6 +243,11 @@ details.undocumented > summary::before {\n \tborder-color: #bfbfbf;\n }\n \n+.rightside,\n+.out-of-band {\n+\tcolor: grey;\n+}\n+\n .result-name .primitive > i, .result-name .keyword > i {\n \tcolor: black;\n }"}, {"sha": "e7d1eedd35871a5763b3c539b908b76574079fa3", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 0, "deletions": 27, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -288,9 +288,6 @@ function hideThemeButtonState() {\n                 loadSearch();\n             }\n \n-            // `crates{version}.js` should always be loaded before this script, so we can use it\n-            // safely.\n-            searchState.addCrateDropdown(window.ALL_CRATES);\n             var params = searchState.getQueryStringParams();\n             if (params.search !== undefined) {\n                 var search = searchState.outputElement();\n@@ -300,30 +297,6 @@ function hideThemeButtonState() {\n                 loadSearch();\n             }\n         },\n-        addCrateDropdown: function(crates) {\n-            var elem = document.getElementById(\"crate-search\");\n-\n-            if (!elem) {\n-                return;\n-            }\n-            var savedCrate = getSettingValue(\"saved-filter-crate\");\n-            for (var i = 0, len = crates.length; i < len; ++i) {\n-                var option = document.createElement(\"option\");\n-                option.value = crates[i];\n-                option.innerText = crates[i];\n-                elem.appendChild(option);\n-                // Set the crate filter from saved storage, if the current page has the saved crate\n-                // filter.\n-                //\n-                // If not, ignore the crate filter -- we want to support filtering for crates on\n-                // sites like doc.rust-lang.org where the crates may differ from page to page while\n-                // on the\n-                // same domain.\n-                if (crates[i] === savedCrate) {\n-                    elem.value = savedCrate;\n-                }\n-            }\n-        },\n     };\n \n     function getPageId() {"}, {"sha": "104464b3881147a476802deb439b6bcf6ac5e274", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -1126,15 +1126,18 @@ window.initSearch = function(rawSearchIndex) {\n             }\n         }\n \n-        let crates = `<select id=\"crate-search\"><option value=\"All crates\">All crates</option>`;\n-        for (let c of window.ALL_CRATES) {\n-            crates += `<option value=\"${c}\" ${c == filterCrates && \"selected\"}>${c}</option>`;\n+        let crates = \"\";\n+        if (window.ALL_CRATES.length > 1) {\n+            crates = ` in <select id=\"crate-search\"><option value=\"All crates\">All crates</option>`;\n+            for (let c of window.ALL_CRATES) {\n+                crates += `<option value=\"${c}\" ${c == filterCrates && \"selected\"}>${c}</option>`;\n+            }\n+            crates += `</select>`;\n         }\n-        crates += `</select>`;\n         var output = `<div id=\"search-settings\">\n             <h1 class=\"search-results-title\">Results for ${escape(query.query)} ` +\n             (query.type ? \" (type: \" + escape(query.type) + \")\" : \"\") + \"</h1>\" +\n-            ` in ${crates} ` +\n+            crates +\n             `</div><div id=\"titles\">` +\n             makeTabHeader(0, \"In Names\", ret_others[1]) +\n             makeTabHeader(1, \"In Parameters\", ret_in_args[1]) +\n@@ -1148,7 +1151,10 @@ window.initSearch = function(rawSearchIndex) {\n         resultsElem.appendChild(ret_returned[0]);\n \n         search.innerHTML = output;\n-        document.getElementById(\"crate-search\").addEventListener(\"input\", updateCrate);\n+        let crateSearch = document.getElementById(\"crate-search\");\n+        if (crateSearch) {\n+            crateSearch.addEventListener(\"input\", updateCrate);\n+        }\n         search.appendChild(resultsElem);\n         // Reset focused elements.\n         searchState.focusedByTab = [null, null, null];"}, {"sha": "34fadd84ae834d3e70d74617e09e2d407da169ff", "filename": "src/test/rustdoc-gui/headings.goml", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fheadings.goml?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -154,3 +154,16 @@ assert-css: (\"h2#top-doc-prose-title\", {\"font-size\": \"20.8px\"})\n assert-css: (\"h2#top-doc-prose-title\", {\"border-bottom-width\": \"1px\"})\n assert-css: (\"h3#top-doc-prose-sub-heading\", {\"font-size\": \"18.4px\"})\n assert-css: (\"h3#top-doc-prose-sub-heading\", {\"border-bottom-width\": \"1px\"})\n+\n+goto: file://|DOC_PATH|/staged_api/struct.Foo.html\n+show-text: true\n+local-storage: {\"rustdoc-theme\": \"light\", \"rustdoc-use-system-theme\": \"false\"}\n+assert-css: (\".since\", {\"color\": \"rgb(128, 128, 128)\"})\n+\n+local-storage: {\"rustdoc-theme\": \"dark\", \"rustdoc-use-system-theme\": \"false\"}\n+reload:\n+assert-css: (\".since\", {\"color\": \"rgb(128, 128, 128)\"})\n+\n+local-storage: {\"rustdoc-theme\": \"ayu\", \"rustdoc-use-system-theme\": \"false\"}\n+reload:\n+assert-css: (\".since\", {\"color\": \"rgb(128, 128, 128)\"})"}, {"sha": "6e8eba56c1eaae0ea880b74b80d446f92478c4d5", "filename": "src/test/rustdoc-gui/src/staged_api/Cargo.lock", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2FCargo.lock?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -0,0 +1,7 @@\n+# This file is automatically @generated by Cargo.\n+# It is not intended for manual editing.\n+version = 3\n+\n+[[package]]\n+name = \"staged_api\"\n+version = \"0.1.0\""}, {"sha": "117c4134e34199a9942da1a3ede039768a99fecf", "filename": "src/test/rustdoc-gui/src/staged_api/Cargo.toml", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2FCargo.toml?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -0,0 +1,11 @@\n+[package]\n+name = \"staged_api\"\n+version = \"0.1.0\"\n+edition = \"2021\"\n+\n+[lib]\n+path = \"lib.rs\"\n+\n+[features]\n+default = [\"some_feature\"]\n+some_feature = []"}, {"sha": "0cb460f03f701b25bd4463adbea5f10cde333ff2", "filename": "src/test/rustdoc-gui/src/staged_api/lib.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/deee6f770f755e4f7c1c0001b353a72ca75b1902/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fstaged_api%2Flib.rs?ref=deee6f770f755e4f7c1c0001b353a72ca75b1902", "patch": "@@ -0,0 +1,10 @@\n+#![feature(staged_api)]\n+#![stable(feature = \"some_feature\", since = \"1.3.5\")]\n+\n+#[stable(feature = \"some_feature\", since = \"1.3.5\")]\n+pub struct Foo {}\n+\n+impl Foo {\n+    #[stable(feature = \"some_feature\", since = \"1.3.5\")]\n+    pub fn bar() {}\n+}"}]}