{"sha": "46d74eac236c7b58c848a471d81f9d5c59362513", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2ZDc0ZWFjMjM2YzdiNThjODQ4YTQ3MWQ4MWY5ZDVjNTkzNjI1MTM=", "commit": {"author": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-19T07:30:14Z"}, "committer": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-20T13:43:58Z"}, "message": "rustbuild: only plan from build triple for dist\n\nWe only want to package each host/target once for `dist`. The obvious\nsolution takes the form of step dependency, which is implemented at\nleast for the `dist-rustc` step. Unfortunately since the steps are\ncreated from `hosts x targets` during planning and *not* de-duplicated\nafterwards, the problem still persists.\n\nWe therefore move the check inside `plan()` instead, to avoid creating\nthe duplicate steps in the first place.", "tree": {"sha": "733f91491d3c58a7434aae6d597b002bbe80d624", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/733f91491d3c58a7434aae6d597b002bbe80d624"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/46d74eac236c7b58c848a471d81f9d5c59362513", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJYWTWeAAoJEDhUS04t5/q5gJEP/iOGlgqsbUBBWh4S6A6RJy+T\nhP7AlpHfD1V73w2ewjOO0DMZrkVqGpu9U2Mz183y7iAa96ETVDQQAwtwf6+CyEU0\nFP7Enu/9MJmRIY4AyoskJGR1ArZSIfV1krbq6dX90Kr6WQbNCvHuGLfdgN8uflTK\nV8r5GKpQhHca2kpYXFD+Zae9u9chf+WFVgmt86ahResYidPzRY6i9uaqPAczXaXZ\nhdg606EfLg5aB4/wKPATcx+8H5FmwJwefmOxY9XrgtigbPf+MDZqJMuwTetSDqKk\nhEufaXzxIoapA+6IQ+9rIimTI1PEBam3xECwEl2smpabgZmpHzHgIFxQLG2ZVZ07\nKV6opM4/Ui2/HR2S0EvNlxceJtYsAyq2wUPimGzPQFS8vpWf/5JIN2GO/oRtWryW\nkvMyZX3cHqoARjgdhpAhaqMjbfF2Ngmmcolc+lW61MBKUH6HQ1CowhpwFHCyFopA\nL+CIAq2+9Z24nBvgoOefoje2O2A2eLMxTfnWtzre8fIvxN6Z0WNXfYGy9Roo10Yg\nQkbumZAbrKM8fcwZj+jb+zGVRTjoXDSkxPqQfQzo4n7fM9+CyimuxHuSAod5ZzKb\nboEjTqokF7bcW4GTi6S/42tSBsi/EMkWi+iXKo1HgRmCBwR5JtgHtf0GPU2De4Qp\namY+KEd4f6+Tfyp5PE3Q\n=jBR8\n-----END PGP SIGNATURE-----", "payload": "tree 733f91491d3c58a7434aae6d597b002bbe80d624\nparent 0102127963098b7656f0213206908d6597018d5f\nauthor Wang Xuerui <git@xen0n.name> 1482132614 +0800\ncommitter Wang Xuerui <git@xen0n.name> 1482241438 +0800\n\nrustbuild: only plan from build triple for dist\n\nWe only want to package each host/target once for `dist`. The obvious\nsolution takes the form of step dependency, which is implemented at\nleast for the `dist-rustc` step. Unfortunately since the steps are\ncreated from `hosts x targets` during planning and *not* de-duplicated\nafterwards, the problem still persists.\n\nWe therefore move the check inside `plan()` instead, to avoid creating\nthe duplicate steps in the first place.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/46d74eac236c7b58c848a471d81f9d5c59362513", "html_url": "https://github.com/rust-lang/rust/commit/46d74eac236c7b58c848a471d81f9d5c59362513", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/46d74eac236c7b58c848a471d81f9d5c59362513/comments", "author": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0102127963098b7656f0213206908d6597018d5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0102127963098b7656f0213206908d6597018d5f", "html_url": "https://github.com/rust-lang/rust/commit/0102127963098b7656f0213206908d6597018d5f"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "def06ee698353ebba3101ff1cdf1e608b0b1fe71", "filename": "src/bootstrap/step.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/46d74eac236c7b58c848a471d81f9d5c59362513/src%2Fbootstrap%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d74eac236c7b58c848a471d81f9d5c59362513/src%2Fbootstrap%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fstep.rs?ref=46d74eac236c7b58c848a471d81f9d5c59362513", "patch": "@@ -822,7 +822,16 @@ invalid rule dependency graph detected, was a rule added and maybe typo'd?\n             let hosts = if self.build.flags.host.len() > 0 {\n                 &self.build.flags.host\n             } else {\n-                &self.build.config.host\n+                if kind == Kind::Dist {\n+                    // For 'dist' steps we only distribute artifacts built from\n+                    // the build platform, so only consider that in the hosts\n+                    // array.\n+                    // NOTE: This relies on the fact that the build triple is\n+                    // always placed first, as done in `config.rs`.\n+                    &self.build.config.host[..1]\n+                } else {\n+                    &self.build.config.host\n+                }\n             };\n             let targets = if self.build.flags.target.len() > 0 {\n                 &self.build.flags.target"}]}