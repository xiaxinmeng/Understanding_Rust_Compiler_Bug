{"sha": "60d682b57759a4fd3b6f666963e40ba457c2e4fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYwZDY4MmI1Nzc1OWE0ZmQzYjZmNjY2OTYzZTQwYmE0NTdjMmU0ZmM=", "commit": {"author": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-07-25T22:01:48Z"}, "committer": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-07-25T22:03:00Z"}, "message": "Fix asserts & short-read bug in isaac_seed (#2870)", "tree": {"sha": "63c0d14cb2462b0763bba1da7bc90531f81c6f1d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/63c0d14cb2462b0763bba1da7bc90531f81c6f1d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/60d682b57759a4fd3b6f666963e40ba457c2e4fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/60d682b57759a4fd3b6f666963e40ba457c2e4fc", "html_url": "https://github.com/rust-lang/rust/commit/60d682b57759a4fd3b6f666963e40ba457c2e4fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/60d682b57759a4fd3b6f666963e40ba457c2e4fc/comments", "author": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4378e7ead19b48bc13cb196e3926a8cda3432ec8", "url": "https://api.github.com/repos/rust-lang/rust/commits/4378e7ead19b48bc13cb196e3926a8cda3432ec8", "html_url": "https://github.com/rust-lang/rust/commit/4378e7ead19b48bc13cb196e3926a8cda3432ec8"}], "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "f9c95db1d04b28665903cb02dbaa46988715294a", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/60d682b57759a4fd3b6f666963e40ba457c2e4fc/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/60d682b57759a4fd3b6f666963e40ba457c2e4fc/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=60d682b57759a4fd3b6f666963e40ba457c2e4fc", "patch": "@@ -182,7 +182,7 @@ rand_seed() {\n     rust_vec *v = (rust_vec *) task->kernel->malloc(vec_size<uint8_t>(size),\n                                             \"rand_seed\");\n     v->fill = v->alloc = size;\n-    isaac_seed(task->kernel, (uint8_t*) &v->data);\n+    isaac_seed(task->kernel, (uint8_t*) &v->data, size);\n     return v;\n }\n "}, {"sha": "018be4248eb981094c8cef716ed7c95e85204640", "filename": "src/rt/rust_util.h", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/60d682b57759a4fd3b6f666963e40ba457c2e4fc/src%2Frt%2Frust_util.h", "raw_url": "https://github.com/rust-lang/rust/raw/60d682b57759a4fd3b6f666963e40ba457c2e4fc/src%2Frt%2Frust_util.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_util.h?ref=60d682b57759a4fd3b6f666963e40ba457c2e4fc", "patch": "@@ -128,9 +128,8 @@ inline size_t get_box_size(size_t body_size, size_t body_align) {\n \n // Initialization helpers for ISAAC RNG\n \n-inline void isaac_seed(rust_kernel* kernel, uint8_t* dest)\n+inline void isaac_seed(rust_kernel* kernel, uint8_t* dest, size_t size)\n {\n-    size_t size = sizeof(ub4) * RANDSIZ;\n #ifdef __WIN32__\n     HCRYPTPROV hProv;\n     kernel->win32_require\n@@ -144,8 +143,14 @@ inline void isaac_seed(rust_kernel* kernel, uint8_t* dest)\n #else\n     int fd = open(\"/dev/urandom\", O_RDONLY);\n     assert(fd > 0);\n-    assert(read(fd, dest, size) == (int) size);\n-    assert(close(fd) == 0);\n+    size_t amount = 0;\n+    do {\n+        ssize_t ret = read(fd, dest+amount, size-amount);\n+        assert(ret >= 0);\n+        amount += (size_t)ret;\n+    } while (amount < size);\n+    int ret = close(fd);\n+    assert(ret == 0);\n #endif\n }\n \n@@ -167,7 +172,7 @@ isaac_init(rust_kernel *kernel, randctx *rctx, rust_vec_box* user_seed)\n             seed = (seed + 0x7ed55d16) + (seed << 12);\n         }\n     } else {\n-        isaac_seed(kernel, (uint8_t*) &rctx->randrsl);\n+        isaac_seed(kernel, (uint8_t*) &rctx->randrsl, sizeof(rctx->randrsl));\n     }\n \n     randinit(rctx, 1);"}]}