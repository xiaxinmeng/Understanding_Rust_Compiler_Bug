{"sha": "3abf329040b5b63beba8f8e15b9b1aa1ec3790bc", "node_id": "C_kwDOAAsO6NoAKDNhYmYzMjkwNDBiNWI2M2JlYmE4ZjhlMTViOWIxYWExZWMzNzkwYmM", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2022-11-08T19:40:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-08T19:40:49Z"}, "message": "Rollup merge of #104027 - ted-tanner:issue-103697-fix, r=jyn514\n\nPlace config.toml in current working directory if config not found\n\nFixes an issue where bootsrapping a Rust build would place `config.toml` in `{src_root}` rather than the current working directory\n\n#103697", "tree": {"sha": "5dac65041ffb5e1626de0598b340b0f618b42aff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5dac65041ffb5e1626de0598b340b0f618b42aff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjarDBCRBK7hj4Ov3rIwAAwJwIAKD3eSJGfYYq6WX3cgGhACka\nt9TUxUFyPTK/2LEanFr4AITsiXsxflf+2cgtXd5c/cBYJIRC7ZeAQr9SsGqTaYft\nJdNpoQP7LEl2SfRUKIzHRqz/dMrnv4niaEMEE+ueyu6g0r2uSc+HC75Cl62lRYFq\nQ15UzlK6CuuF5Qt+5QIOXgvI7rspaMIrpEFZ6GS7ANE2I3dQlDCJqDezh75Kh5vY\nOt/2LfcXO4GsFnJ6GE2TYpQW4dGYdBkoKQErSWppBBY066ukkBdXwpbxTvuz9dm4\nkZ2yo6igQC+7+TQlHGFe4EEXUzJx3qvUceTWlXwqfT578Cjc86fjbde0cuKOrtE=\n=GDOF\n-----END PGP SIGNATURE-----\n", "payload": "tree 5dac65041ffb5e1626de0598b340b0f618b42aff\nparent 3a78320f5c04e9a806647a45e29f0702788135d4\nparent 66e8a296403e80ea50b2217d40e7a31fbd2f2158\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1667936449 +0100\ncommitter GitHub <noreply@github.com> 1667936449 +0100\n\nRollup merge of #104027 - ted-tanner:issue-103697-fix, r=jyn514\n\nPlace config.toml in current working directory if config not found\n\nFixes an issue where bootsrapping a Rust build would place `config.toml` in `{src_root}` rather than the current working directory\n\n#103697\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc", "html_url": "https://github.com/rust-lang/rust/commit/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a78320f5c04e9a806647a45e29f0702788135d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a78320f5c04e9a806647a45e29f0702788135d4", "html_url": "https://github.com/rust-lang/rust/commit/3a78320f5c04e9a806647a45e29f0702788135d4"}, {"sha": "66e8a296403e80ea50b2217d40e7a31fbd2f2158", "url": "https://api.github.com/repos/rust-lang/rust/commits/66e8a296403e80ea50b2217d40e7a31fbd2f2158", "html_url": "https://github.com/rust-lang/rust/commit/66e8a296403e80ea50b2217d40e7a31fbd2f2158"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "be69f819c6428f8e88332ab7889656ec7482a88a", "filename": "src/bootstrap/bin/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc/src%2Fbootstrap%2Fbin%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc/src%2Fbootstrap%2Fbin%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Fmain.rs?ref=3abf329040b5b63beba8f8e15b9b1aa1ec3790bc", "patch": "@@ -35,7 +35,7 @@ fn main() {\n \n     // NOTE: Since `./configure` generates a `config.toml`, distro maintainers will see the\n     // changelog warning, not the `x.py setup` message.\n-    let suggest_setup = !config.config.exists() && !matches!(config.cmd, Subcommand::Setup { .. });\n+    let suggest_setup = config.config.is_none() && !matches!(config.cmd, Subcommand::Setup { .. });\n     if suggest_setup {\n         println!(\"warning: you have not made a `config.toml`\");\n         println!("}, {"sha": "ba50ce9ec2426e99c362a666afdd5f2524995058", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=3abf329040b5b63beba8f8e15b9b1aa1ec3790bc", "patch": "@@ -80,7 +80,7 @@ pub struct Config {\n     pub keep_stage_std: Vec<u32>,\n     pub src: PathBuf,\n     /// defaults to `config.toml`\n-    pub config: PathBuf,\n+    pub config: Option<PathBuf>,\n     pub jobs: Option<u32>,\n     pub cmd: Subcommand,\n     pub incremental: bool,\n@@ -926,8 +926,10 @@ impl Config {\n         // Give a hard error if `--config` or `RUST_BOOTSTRAP_CONFIG` are set to a missing path,\n         // but not if `config.toml` hasn't been created.\n         let mut toml = if !using_default_path || toml_path.exists() {\n+            config.config = Some(toml_path.clone());\n             get_toml(&toml_path)\n         } else {\n+            config.config = None;\n             TomlConfig::default()\n         };\n \n@@ -942,7 +944,6 @@ impl Config {\n         }\n \n         config.changelog_seen = toml.changelog_seen;\n-        config.config = toml_path;\n \n         let build = toml.build.unwrap_or_default();\n "}, {"sha": "04480277fe0474cb8b3dd97993d8f4bdaf1162e0", "filename": "src/bootstrap/setup.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc/src%2Fbootstrap%2Fsetup.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3abf329040b5b63beba8f8e15b9b1aa1ec3790bc/src%2Fbootstrap%2Fsetup.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsetup.rs?ref=3abf329040b5b63beba8f8e15b9b1aa1ec3790bc", "patch": "@@ -82,7 +82,7 @@ impl fmt::Display for Profile {\n }\n \n pub fn setup(config: &Config, profile: Profile) {\n-    let path = &config.config;\n+    let path = &config.config.clone().unwrap_or(PathBuf::from(\"config.toml\"));\n \n     if path.exists() {\n         eprintln!("}]}