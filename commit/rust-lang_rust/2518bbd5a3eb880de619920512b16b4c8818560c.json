{"sha": "2518bbd5a3eb880de619920512b16b4c8818560c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1MThiYmQ1YTNlYjg4MGRlNjE5OTIwNTEyYjE2YjRjODgxODU2MGM=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-10-20T18:10:54Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-20T18:10:54Z"}, "message": "Rollup merge of #65460 - sinkuu:contains_insert, r=varkor\n\nClean up `contains()` `insert()` chains on HashSet\n\nThey can be merged to a single `insert()` call, which may avoid double-hashing/lookup of the value.", "tree": {"sha": "9d371102ce5f7923b394b5e333b6a2632b700133", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9d371102ce5f7923b394b5e333b6a2632b700133"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2518bbd5a3eb880de619920512b16b4c8818560c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdrKMuCRBK7hj4Ov3rIwAAdHIIAAUVtQCvPHW3uBCjHRmo5TTN\no3CbwceE+0jbYLWZGwKQKLjCPTf7nT1FbODueOUSvFttWsNtC5Tk33VW4+aRb0zh\n/l0aJUxvT74EZplILGN0zUps0CCvlJXYcEc+MuQXKyUtHCntflhkQplO8nULoSPI\nZYU2+V/bi+J4/jDMUHj7h8PS1yffAkPsDDPoL1ogCOk2BXaajS3z0hSsNot26LEY\nN+cyqmX5z85DwHUwrAbv34G3AzPbKxdZvEdLdtq3gNgG1lo3DhlGHqQDnhdHP3Vt\nVxgfl78EEwT6NNobH1OGDBklzvELENdQ2Oz+zfVTAuySH2z6iFUkj0Hzbr0wIKo=\n=Q44Y\n-----END PGP SIGNATURE-----\n", "payload": "tree 9d371102ce5f7923b394b5e333b6a2632b700133\nparent 89e645ace853d86e8c0002247482eac9073c90fd\nparent ac2f906a592135953ede70429efadd876e21cd09\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1571595054 +0900\ncommitter GitHub <noreply@github.com> 1571595054 +0900\n\nRollup merge of #65460 - sinkuu:contains_insert, r=varkor\n\nClean up `contains()` `insert()` chains on HashSet\n\nThey can be merged to a single `insert()` call, which may avoid double-hashing/lookup of the value.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2518bbd5a3eb880de619920512b16b4c8818560c", "html_url": "https://github.com/rust-lang/rust/commit/2518bbd5a3eb880de619920512b16b4c8818560c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2518bbd5a3eb880de619920512b16b4c8818560c/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89e645ace853d86e8c0002247482eac9073c90fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/89e645ace853d86e8c0002247482eac9073c90fd", "html_url": "https://github.com/rust-lang/rust/commit/89e645ace853d86e8c0002247482eac9073c90fd"}, {"sha": "ac2f906a592135953ede70429efadd876e21cd09", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac2f906a592135953ede70429efadd876e21cd09", "html_url": "https://github.com/rust-lang/rust/commit/ac2f906a592135953ede70429efadd876e21cd09"}], "stats": {"total": 28, "additions": 8, "deletions": 20}, "files": [{"sha": "b8d1a549ecda3b786b333370eaa4043378d4d76b", "filename": "src/librustc/middle/stability.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fstability.rs?ref=2518bbd5a3eb880de619920512b16b4c8818560c", "patch": "@@ -905,11 +905,10 @@ pub fn check_unused_or_stable_features(tcx: TyCtxt<'_>) {\n             // Warn if the user has enabled an already-stable lang feature.\n             unnecessary_stable_feature_lint(tcx, span, feature, since);\n         }\n-        if lang_features.contains(&feature) {\n+        if !lang_features.insert(feature) {\n             // Warn if the user enables a lang feature multiple times.\n             duplicate_feature_err(tcx.sess, span, feature);\n         }\n-        lang_features.insert(feature);\n     }\n \n     let declared_lib_features = &tcx.features().declared_lib_features;"}, {"sha": "7bd82ced3c386f7f777bc4897bbb5fe660320698", "filename": "src/librustc_codegen_llvm/debuginfo/metadata.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs?ref=2518bbd5a3eb880de619920512b16b4c8818560c", "patch": "@@ -2069,11 +2069,9 @@ fn set_members_of_composite_type(cx: &CodegenCx<'ll, 'tcx>,\n     {\n         let mut composite_types_completed =\n             debug_context(cx).composite_types_completed.borrow_mut();\n-        if composite_types_completed.contains(&composite_type_metadata) {\n+        if !composite_types_completed.insert(&composite_type_metadata) {\n             bug!(\"debuginfo::set_members_of_composite_type() - \\\n                   Already completed forward declaration re-encountered.\");\n-        } else {\n-            composite_types_completed.insert(composite_type_metadata);\n         }\n     }\n "}, {"sha": "a58db6a903bb99f1622fce33cfeb7d42a0d981db", "filename": "src/librustc_metadata/native_libs.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_metadata%2Fnative_libs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_metadata%2Fnative_libs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fnative_libs.rs?ref=2518bbd5a3eb880de619920512b16b4c8818560c", "patch": "@@ -198,12 +198,10 @@ impl Collector<'tcx> {\n                     self.tcx.sess.err(&format!(\"renaming of the library `{}` was specified, \\\n                                                 however this crate contains no `#[link(...)]` \\\n                                                 attributes referencing this library.\", name));\n-                } else if renames.contains(name) {\n+                } else if !renames.insert(name) {\n                     self.tcx.sess.err(&format!(\"multiple renamings were \\\n                                                 specified for library `{}` .\",\n                                                name));\n-                } else {\n-                    renames.insert(name);\n                 }\n             }\n         }"}, {"sha": "4c469a82ac3d6b9dc1bce871165c0d47a824707a", "filename": "src/librustc_mir/borrow_check/conflict_errors.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs?ref=2518bbd5a3eb880de619920512b16b4c8818560c", "patch": "@@ -78,16 +78,14 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                 .last()\n                 .unwrap();\n \n-            if self.uninitialized_error_reported.contains(&root_place) {\n+            if !self.uninitialized_error_reported.insert(root_place) {\n                 debug!(\n                     \"report_use_of_moved_or_uninitialized place: error about {:?} suppressed\",\n                     root_place\n                 );\n                 return;\n             }\n \n-            self.uninitialized_error_reported.insert(root_place);\n-\n             let item_msg = match self.describe_place_with_options(used_place,\n                                                                   IncludingDowncast(true)) {\n                 Some(name) => format!(\"`{}`\", name),"}, {"sha": "58480912929b305466170164296a405b8e0e29c0", "filename": "src/librustc_mir/hair/pattern/mod.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs?ref=2518bbd5a3eb880de619920512b16b4c8818560c", "patch": "@@ -1214,7 +1214,7 @@ fn search_for_adt_without_structural_match<'tcx>(tcx: TyCtxt<'tcx>,\n \n         // tracks ADT's previously encountered during search, so that\n         // we will not recur on them again.\n-        seen: FxHashSet<&'tcx AdtDef>,\n+        seen: FxHashSet<hir::def_id::DefId>,\n     }\n \n     impl<'tcx> TypeVisitor<'tcx> for Search<'tcx> {\n@@ -1254,14 +1254,12 @@ fn search_for_adt_without_structural_match<'tcx>(tcx: TyCtxt<'tcx>,\n                 return true // Halt visiting!\n             }\n \n-            if self.seen.contains(adt_def) {\n+            if !self.seen.insert(adt_def.did) {\n                 debug!(\"Search already seen adt_def: {:?}\", adt_def);\n                 // let caller continue its search\n                 return false;\n             }\n \n-            self.seen.insert(adt_def);\n-\n             // `#[structural_match]` does not care about the\n             // instantiation of the generics in an ADT (it\n             // instead looks directly at its fields outside"}, {"sha": "158b730b9bd43735e0ce5f1ae22981e75d6bb7d8", "filename": "src/librustc_mir/lints.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_mir%2Flints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_mir%2Flints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Flints.rs?ref=2518bbd5a3eb880de619920512b16b4c8818560c", "patch": "@@ -72,13 +72,11 @@ fn check_fn_for_unconditional_recursion(\n     let caller_substs = &InternalSubsts::identity_for_item(tcx, def_id)[..trait_substs_count];\n \n     while let Some(bb) = reachable_without_self_call_queue.pop() {\n-        if visited.contains(bb) {\n+        if !visited.insert(bb) {\n             //already done\n             continue;\n         }\n \n-        visited.insert(bb);\n-\n         let block = &basic_blocks[bb];\n \n         if let Some(ref terminator) = block.terminator {"}, {"sha": "34edd5eaf4fc727b7a86c62fffe51deae201da32", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2518bbd5a3eb880de619920512b16b4c8818560c/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=2518bbd5a3eb880de619920512b16b4c8818560c", "patch": "@@ -673,13 +673,12 @@ impl<'a, 'b> ImportResolver<'a, 'b> {\n                     self.throw_unresolved_import_error(errors, None);\n                     errors = vec![];\n                 }\n-                if !seen_spans.contains(&err.span) {\n+                if seen_spans.insert(err.span) {\n                     let path = import_path_to_string(\n                         &import.module_path.iter().map(|seg| seg.ident).collect::<Vec<_>>(),\n                         &import.subclass,\n                         err.span,\n                     );\n-                    seen_spans.insert(err.span);\n                     errors.push((path, err));\n                     prev_root_id = import.root_id;\n                 }"}]}