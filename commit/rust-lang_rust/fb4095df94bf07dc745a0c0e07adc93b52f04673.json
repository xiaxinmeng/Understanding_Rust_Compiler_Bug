{"sha": "fb4095df94bf07dc745a0c0e07adc93b52f04673", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiNDA5NWRmOTRiZjA3ZGM3NDVhMGMwZTA3YWRjOTNiNTJmMDQ2NzM=", "commit": {"author": {"name": "Michael Hewson", "email": "michael@michaelhewson.ca", "date": "2019-10-26T20:44:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-26T20:44:06Z"}, "message": "Update comments re type parameter hack in object safety\n\nTo check if a method's receiver type is object safe, we create a new receiver type by substituting in a bogus type parameter (let's call it `U`) for `Self`, and checking that the unmodified receiver type implements `DispatchFromDyn<receiver type with Self = U>`. It would be better to use `dyn Trait` directly, and the only reason we don't is because it triggers another check that `Trait` is object safe, resulting in a query cycle. Once the feature `object_safe_for_dispatch` (tracking issue https://github.com/rust-lang/rust/issues/43561) is stabilized, this will no longer be the case, and we'll be able to use `dyn Trait` as the unsized `Self` type. I've updated the comments in object_safety.rs accordingly.", "tree": {"sha": "0facd9d8c5905e3a13ae8d82e5fe3d2c61cac983", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0facd9d8c5905e3a13ae8d82e5fe3d2c61cac983"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb4095df94bf07dc745a0c0e07adc93b52f04673", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdtLAWCRBK7hj4Ov3rIwAAdHIIAJcR+habqsQQ7K/8VmaW2ob7\n/O2pvkQQMM1RZlgNJWOiedcxX3YGaaRbxKzKGBx8yUdBLuVK7rjQ9tWsq7sKNQVj\nZhZEJlkF/TadYDvk4gJ52G8gkKikC3EsxyvD3YSuaq7QEv31x3M3OiIj36enb15q\n9N+zR211HEI87t/gBfH6ahk0d27p7C+9PWieFH5GU3jTlBUGRbG30JWVK76CCqdZ\nRAdvUDGFgxGPhKP4GA5Dc0JTK6liJr92taqGvuVaZirsDppUx4dtkoOcVVC1hHCS\nF4rt+mnaxTIjAC0SpEhwhwCVOLUjNwW6SiJX3Qh22X2Z0g//ctwie8prB51R4AQ=\n=5V0e\n-----END PGP SIGNATURE-----\n", "payload": "tree 0facd9d8c5905e3a13ae8d82e5fe3d2c61cac983\nparent 46e6c533d08a2c6d22083a2756a0b569e001c3c4\nauthor Michael Hewson <michael@michaelhewson.ca> 1572122646 -0400\ncommitter GitHub <noreply@github.com> 1572122646 -0400\n\nUpdate comments re type parameter hack in object safety\n\nTo check if a method's receiver type is object safe, we create a new receiver type by substituting in a bogus type parameter (let's call it `U`) for `Self`, and checking that the unmodified receiver type implements `DispatchFromDyn<receiver type with Self = U>`. It would be better to use `dyn Trait` directly, and the only reason we don't is because it triggers another check that `Trait` is object safe, resulting in a query cycle. Once the feature `object_safe_for_dispatch` (tracking issue https://github.com/rust-lang/rust/issues/43561) is stabilized, this will no longer be the case, and we'll be able to use `dyn Trait` as the unsized `Self` type. I've updated the comments in object_safety.rs accordingly."}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb4095df94bf07dc745a0c0e07adc93b52f04673", "html_url": "https://github.com/rust-lang/rust/commit/fb4095df94bf07dc745a0c0e07adc93b52f04673", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb4095df94bf07dc745a0c0e07adc93b52f04673/comments", "author": {"login": "mikeyhew", "id": 6751033, "node_id": "MDQ6VXNlcjY3NTEwMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/6751033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikeyhew", "html_url": "https://github.com/mikeyhew", "followers_url": "https://api.github.com/users/mikeyhew/followers", "following_url": "https://api.github.com/users/mikeyhew/following{/other_user}", "gists_url": "https://api.github.com/users/mikeyhew/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikeyhew/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikeyhew/subscriptions", "organizations_url": "https://api.github.com/users/mikeyhew/orgs", "repos_url": "https://api.github.com/users/mikeyhew/repos", "events_url": "https://api.github.com/users/mikeyhew/events{/privacy}", "received_events_url": "https://api.github.com/users/mikeyhew/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46e6c533d08a2c6d22083a2756a0b569e001c3c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/46e6c533d08a2c6d22083a2756a0b569e001c3c4", "html_url": "https://github.com/rust-lang/rust/commit/46e6c533d08a2c6d22083a2756a0b569e001c3c4"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "8ded1417ee570985e8d32d1cb62c9e70a735dd45", "filename": "src/librustc/traits/object_safety.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/fb4095df94bf07dc745a0c0e07adc93b52f04673/src%2Flibrustc%2Ftraits%2Fobject_safety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb4095df94bf07dc745a0c0e07adc93b52f04673/src%2Flibrustc%2Ftraits%2Fobject_safety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fobject_safety.rs?ref=fb4095df94bf07dc745a0c0e07adc93b52f04673", "patch": "@@ -520,9 +520,11 @@ impl<'tcx> TyCtxt<'tcx> {\n     /// a pointer.\n     ///\n     /// In practice, we cannot use `dyn Trait` explicitly in the obligation because it would result\n-    /// in a new check that `Trait` is object safe, creating a cycle. So instead, we fudge a little\n-    /// by introducing a new type parameter `U` such that `Self: Unsize<U>` and `U: Trait + ?Sized`,\n-    /// and use `U` in place of `dyn Trait`. Written as a chalk-style query:\n+    /// in a new check that `Trait` is object safe, creating a cycle (until object_safe_for_dispatch\n+    /// is stabilized, see tracking issue https://github.com/rust-lang/rust/issues/43561).\n+    /// Instead, we fudge a little by introducing a new type parameter `U` such that\n+    /// `Self: Unsize<U>` and `U: Trait + ?Sized`, and use `U` in place of `dyn Trait`.\n+    /// Written as a chalk-style query:\n     ///\n     ///     forall (U: Trait + ?Sized) {\n     ///         if (Self: Unsize<U>) {\n@@ -556,8 +558,8 @@ impl<'tcx> TyCtxt<'tcx> {\n \n         // the type `U` in the query\n         // use a bogus type parameter to mimick a forall(U) query using u32::MAX for now.\n-        // FIXME(mikeyhew) this is a total hack, and we should replace it when real forall queries\n-        // are implemented\n+        // FIXME(mikeyhew) this is a total hack. Once object_safe_for_dispatch is stabilized, we can\n+        // replace this with `dyn Trait`\n         let unsized_self_ty: Ty<'tcx> = self.mk_ty_param(\n             ::std::u32::MAX,\n             Symbol::intern(\"RustaceansAreAwesome\"),"}]}