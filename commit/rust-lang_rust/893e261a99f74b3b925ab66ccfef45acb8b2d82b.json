{"sha": "893e261a99f74b3b925ab66ccfef45acb8b2d82b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5M2UyNjFhOTlmNzRiM2I5MjVhYjY2Y2NmZWY0NWFjYjhiMmQ4MmI=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-01-22T20:00:31Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-12T08:34:26Z"}, "message": "Add deployment to GHA", "tree": {"sha": "a89b281d1b5b23fe2a933750d7d4eabf95ebc730", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a89b281d1b5b23fe2a933750d7d4eabf95ebc730"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/893e261a99f74b3b925ab66ccfef45acb8b2d82b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl5DuJIACgkQaTCGhp1Q\nZjcxrw//TryLOzEC3Xm4+Dgmgpkm1TfnSvyvPRH1ZLsBe1XYCe/zZk3j90HUpfEE\nkbumfyCpqmy+asfbN9NvR4pXM1jH9bYP2wZrH22We63N7+HGfUJSKfrHEo2r4hd/\nd8H7jNBCver1/EUJ+slMSXweGHN13IdqE+BJxLY+xgSEVfUTtuXyG/NThZfCNGfJ\ns1Et3w2nlqCwp8XxNGGZkYjEL7jMLSEXcMZwhBpeMbJPLZoRvwc6G2MPA/j3Cr4Z\n3irhh1CWwe941t2f8nIuU1fbLU7b+sY5T3RfaLrEiaYIhVPKzmP8ecwJ8USP3jd7\negRT3GtsUTPRtNq8b5O6M81peHXyM0KviZiwA9FTxF32q3gLbrPxf2XLqUo85SlH\nV4iNpOjGkDnijGm5q5lH6iCro/H124OaKlIODYtgs5EahFproR4G0+cK4Pe49rpG\n8jwiRRqJSaXQG9xIr9xCXWBYAnU0MOUNNT/pdTQd5DgF2X07yXe3mdIXOM7NJtcG\ndaosUV1MNOkeZN206Hf6Avi0gdyZvkEu/KyAfrCi0RWAm6y/Sl5O9eU+KZX7X9z3\nm1m9CUkzVig11z4GNNHUD/PENgSMruZ3U+LLjTWzqYocMrb6iLyqxW6uk1RvEE4M\nn0L9+Qh9EfMwbLFpwdfZEw/iS1ZGwFXjPAoIMVWPrf8tVfk/5f8=\n=7/2O\n-----END PGP SIGNATURE-----", "payload": "tree a89b281d1b5b23fe2a933750d7d4eabf95ebc730\nparent 92811675ce14d717d04d5d9e8dd89172cbcb0b57\nauthor flip1995 <hello@philkrones.com> 1579723231 +0100\ncommitter flip1995 <hello@philkrones.com> 1581496466 +0100\n\nAdd deployment to GHA\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/893e261a99f74b3b925ab66ccfef45acb8b2d82b", "html_url": "https://github.com/rust-lang/rust/commit/893e261a99f74b3b925ab66ccfef45acb8b2d82b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/893e261a99f74b3b925ab66ccfef45acb8b2d82b/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "92811675ce14d717d04d5d9e8dd89172cbcb0b57", "url": "https://api.github.com/repos/rust-lang/rust/commits/92811675ce14d717d04d5d9e8dd89172cbcb0b57", "html_url": "https://github.com/rust-lang/rust/commit/92811675ce14d717d04d5d9e8dd89172cbcb0b57"}], "stats": {"total": 72, "additions": 72, "deletions": 0}, "files": [{"sha": "100adbadd5abd40910d5be2ade7cef684613334f", "filename": ".github/workflows/deploy.yml", "status": "added", "additions": 72, "deletions": 0, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/893e261a99f74b3b925ab66ccfef45acb8b2d82b/.github%2Fworkflows%2Fdeploy.yml", "raw_url": "https://github.com/rust-lang/rust/raw/893e261a99f74b3b925ab66ccfef45acb8b2d82b/.github%2Fworkflows%2Fdeploy.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fdeploy.yml?ref=893e261a99f74b3b925ab66ccfef45acb8b2d82b", "patch": "@@ -0,0 +1,72 @@\n+name: Deploy\n+\n+on:\n+  push:\n+    branches: master\n+  release:\n+    types: [created]\n+\n+env:\n+  TARGET_BRANCH: 'gh-pages'\n+  SHA: '${{ github.sha }}'\n+  SSH_REPO: 'git@github.com:${{ github.repository }}.git'\n+  TAG_NAME: '${{ github.event.release.GITHUB_REF }}'\n+\n+jobs:\n+  deploy:\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+    - name: Checkout\n+      uses: actions/checkout@v2.0.0\n+    - name: Checkout\n+      uses: actions/checkout@v2.0.0\n+      with:\n+        ref: ${{ env.TARGET_BRANCH }}\n+        path: 'out'\n+    - name: Deploy\n+      run: |\n+        set -ex\n+\n+        echo \"Removing the current docs for master\"\n+        rm -rf out/master/ || exit 0\n+\n+        echo \"Making the docs for master\"\n+        mkdir out/master/\n+        cp util/gh-pages/index.html out/master\n+        python ./util/export.py out/master/lints.json\n+\n+        if [[ -n $TAG_NAME ]]; then\n+          echo \"Save the doc for the current tag ($TAG_NAME) and point current/ to it\"\n+          cp -r out/master \"out/$TAG_NAME\"\n+          rm -f out/current\n+          ln -s \"$TAG_NAME\" out/current\n+        fi\n+\n+        # Generate version index that is shown as root index page\n+        cp util/gh-pages/versions.html out/index.html\n+\n+        cd out\n+        cat <<-EOF | python - > versions.json\n+        import os, json\n+        print json.dumps([\n+            dir for dir in os.listdir(\".\") if not dir.startswith(\".\") and os.path.isdir(dir)\n+        ])\n+        EOF\n+\n+        # Now let's go have some fun with the cloned repo\n+        git config user.name \"GHA CI\"\n+        git config user.email \"gha@ci.invalid\"\n+\n+        if git diff --exit-code --quiet; then\n+            echo \"No changes to the output on this push; exiting.\"\n+            exit 0\n+        fi\n+\n+        git add .\n+        git commit -m \"Automatic deploy to GitHub Pages: ${SHA}\"\n+\n+        eval \"$(ssh-agent -s)\"\n+        ssh-add - <<< \"${{ secrets.DEPLOY_KEY }}\"\n+\n+        git push \"$SSH_REPO\" \"$TARGET_BRANCH\""}]}