{"sha": "fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlMTNiYmQwNjQ4YzRmN2FkOGY3Y2RmZTU0MGNhMTNiYzkzYWRlNjA=", "commit": {"author": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2019-07-03T09:56:59Z"}, "committer": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2019-10-11T08:43:54Z"}, "message": "Remove unions_with_drop_fields lint\n\nCases where it would trigger are now hard errors.", "tree": {"sha": "4c701e18d56f7fa7e161185b40a44ce075b8e6ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c701e18d56f7fa7e161185b40a44ce075b8e6ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60", "html_url": "https://github.com/rust-lang/rust/commit/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60/comments", "author": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2f0c821be9ba9cdf52a45c327b7d3f2831626225", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f0c821be9ba9cdf52a45c327b7d3f2831626225", "html_url": "https://github.com/rust-lang/rust/commit/2f0c821be9ba9cdf52a45c327b7d3f2831626225"}], "stats": {"total": 57, "additions": 0, "deletions": 57}, "files": [{"sha": "813d7c4bafef8cfdaf779be20dacf71cfc46de35", "filename": "src/doc/rustc/src/lints/listing/warn-by-default.md", "status": "modified", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flisting%2Fwarn-by-default.md", "raw_url": "https://github.com/rust-lang/rust/raw/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flisting%2Fwarn-by-default.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flisting%2Fwarn-by-default.md?ref=fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60", "patch": "@@ -596,30 +596,6 @@ warning: function cannot return without recursing\n   |\n ```\n \n-## unions-with-drop-fields\n-\n-This lint detects use of unions that contain fields with possibly non-trivial drop code. Some\n-example code that triggers this lint:\n-\n-```rust\n-#![feature(untagged_unions)]\n-\n-union U {\n-    s: String,\n-}\n-```\n-\n-This will produce:\n-\n-```text\n-warning: union contains a field with possibly non-trivial drop code, drop code of union fields is ignored when dropping the union\n- --> src/main.rs:4:5\n-  |\n-4 |     s: String,\n-  |     ^^^^^^^^^\n-  |\n-```\n-\n ## unknown-lints\n \n This lint detects unrecognized lint attribute. Some"}, {"sha": "f00bcd41b601e92cd2b58fcb089c055474f0ea0f", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 0, "deletions": 30, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60", "patch": "@@ -979,35 +979,6 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for UnstableFeatures {\n     }\n }\n \n-declare_lint! {\n-    UNIONS_WITH_DROP_FIELDS,\n-    Warn,\n-    \"use of unions that contain fields with possibly non-trivial drop code\"\n-}\n-\n-declare_lint_pass!(\n-    /// Lint for unions that contain fields with possibly non-trivial destructors.\n-    UnionsWithDropFields => [UNIONS_WITH_DROP_FIELDS]\n-);\n-\n-impl<'a, 'tcx> LateLintPass<'a, 'tcx> for UnionsWithDropFields {\n-    fn check_item(&mut self, ctx: &LateContext<'_, '_>, item: &hir::Item) {\n-        if let hir::ItemKind::Union(ref vdata, _) = item.kind {\n-            for field in vdata.fields() {\n-                let field_ty = ctx.tcx.type_of(\n-                    ctx.tcx.hir().local_def_id(field.hir_id));\n-                if field_ty.needs_drop(ctx.tcx, ctx.param_env) {\n-                    ctx.span_lint(UNIONS_WITH_DROP_FIELDS,\n-                                  field.span,\n-                                  \"union contains a field with possibly non-trivial drop code, \\\n-                                   drop code of union fields is ignored when dropping the union\");\n-                    return;\n-                }\n-            }\n-        }\n-    }\n-}\n-\n declare_lint! {\n     pub UNREACHABLE_PUB,\n     Allow,\n@@ -1287,7 +1258,6 @@ declare_lint_pass!(\n         NO_MANGLE_GENERIC_ITEMS,\n         MUTABLE_TRANSMUTES,\n         UNSTABLE_FEATURES,\n-        UNIONS_WITH_DROP_FIELDS,\n         UNREACHABLE_PUB,\n         TYPE_ALIAS_BOUNDS,\n         TRIVIAL_BOUNDS"}, {"sha": "a898e1a3dcfa1b4030a61dfa9ee2946b93c89bd4", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=fe13bbd0648c4f7ad8f7cdfe540ca13bc93ade60", "patch": "@@ -164,9 +164,6 @@ macro_rules! late_lint_mod_passes {\n             // Depends on referenced function signatures in expressions\n             MutableTransmutes: MutableTransmutes,\n \n-            // Depends on types of fields, checks if they implement Drop\n-            UnionsWithDropFields: UnionsWithDropFields,\n-\n             TypeAliasBounds: TypeAliasBounds,\n \n             TrivialConstraints: TrivialConstraints,"}]}