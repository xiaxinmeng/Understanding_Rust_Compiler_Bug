{"sha": "17369f324c79bd4aa1bc5735b337df6bdc83341c", "node_id": "C_kwDOAAsO6NoAKDE3MzY5ZjMyNGM3OWJkNGFhMWJjNTczNWIzMzdkZjZiZGM4MzM0MWM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-29T04:11:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-29T04:11:27Z"}, "message": "Auto merge of #106227 - bryangarza:ctfe-limit, r=oli-obk\n\nUse stable metric for const eval limit instead of current terminator-based logic\n\nThis patch adds a `MirPass` that inserts a new MIR instruction `ConstEvalCounter` to any loops and function calls in the CFG. This instruction is used during Const Eval to count against the `const_eval_limit`, and emit the `StepLimitReached` error, replacing the current logic which uses Terminators only.\n\nThe new method of counting loops and function calls should be more stable across compiler versions (i.e., not cause crates that compiled successfully before, to no longer compile when changes to the MIR generation/optimization are made).\n\nAlso see: #103877", "tree": {"sha": "de2f7e750fff90cac42bd2f0469c02d3e86246f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/de2f7e750fff90cac42bd2f0469c02d3e86246f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/17369f324c79bd4aa1bc5735b337df6bdc83341c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/17369f324c79bd4aa1bc5735b337df6bdc83341c", "html_url": "https://github.com/rust-lang/rust/commit/17369f324c79bd4aa1bc5735b337df6bdc83341c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/17369f324c79bd4aa1bc5735b337df6bdc83341c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79475f56ec305f88049c35346d3a2f5082aec2c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/79475f56ec305f88049c35346d3a2f5082aec2c2", "html_url": "https://github.com/rust-lang/rust/commit/79475f56ec305f88049c35346d3a2f5082aec2c2"}, {"sha": "520814b71395105f83f5c6444589cf3c2b311e2a", "url": "https://api.github.com/repos/rust-lang/rust/commits/520814b71395105f83f5c6444589cf3c2b311e2a", "html_url": "https://github.com/rust-lang/rust/commit/520814b71395105f83f5c6444589cf3c2b311e2a"}], "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "727058780752e226ce6c06381e30570a5e228325", "filename": "clippy_utils/src/qualify_min_const_fn.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/17369f324c79bd4aa1bc5735b337df6bdc83341c/clippy_utils%2Fsrc%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17369f324c79bd4aa1bc5735b337df6bdc83341c/clippy_utils%2Fsrc%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fqualify_min_const_fn.rs?ref=17369f324c79bd4aa1bc5735b337df6bdc83341c", "patch": "@@ -240,6 +240,7 @@ fn check_statement<'tcx>(\n         | StatementKind::Retag { .. }\n         | StatementKind::AscribeUserType(..)\n         | StatementKind::Coverage(..)\n+        | StatementKind::ConstEvalCounter\n         | StatementKind::Nop => Ok(()),\n     }\n }"}]}