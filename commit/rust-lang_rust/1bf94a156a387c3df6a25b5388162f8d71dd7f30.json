{"sha": "1bf94a156a387c3df6a25b5388162f8d71dd7f30", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiZjk0YTE1NmEzODdjM2RmNmEyNWI1Mzg4MTYyZjhkNzFkZDdmMzA=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-09-15T21:56:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-09-15T21:56:59Z"}, "message": "Rollup merge of #88841 - notriddle:notriddle/method-parens, r=estebank\n\nfeat(rustc_typeck): suggest removing bad parens in `(recv.method)()`\n\nFixes #88803", "tree": {"sha": "ce2d6ee6ac887b0baf1dd1cc175ba4ede3082cfd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce2d6ee6ac887b0baf1dd1cc175ba4ede3082cfd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1bf94a156a387c3df6a25b5388162f8d71dd7f30", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhQmwsCRBK7hj4Ov3rIwAA/KYIAIWBqUA1NT8YQ2a/ZG7fTdwI\nECY9qZI9tU5wdb5JP8QIKQgu1HSaHiDFFFEO1wViNMETjCnYi2+y/tuaQeEGaDAI\nM8eK9cNOYB326TNLH0fBtfWfpGfS8FAzhJUWRdbbAur2KCD6yPGAnkh6oIjYE9Uz\nCK0hKDGxfMu3kw4j31mwuRQrBchZ0LBnR/H4TZob0hQDVYRLIce6HJaR2DvmWWYD\nEV/ZQfvxxF3Husos0l0z6+tmve0Z/y2A+uHLSCDUarcktaXFJx3h100txVDwpwFZ\n+Km5uL5ps5H19XLt/JOm9vax8B6hkr8JcJD6WqRyysfa8H5O1uU4TKUpWtMuaTI=\n=lyOb\n-----END PGP SIGNATURE-----\n", "payload": "tree ce2d6ee6ac887b0baf1dd1cc175ba4ede3082cfd\nparent fb2d7dff806af96a127cd5338dd8a3a95cc7cbe8\nparent 8be729cdd6473859f4fb54aaf74dce56f0775ef1\nauthor Manish Goregaokar <manishsmail@gmail.com> 1631743019 -0700\ncommitter GitHub <noreply@github.com> 1631743019 -0700\n\nRollup merge of #88841 - notriddle:notriddle/method-parens, r=estebank\n\nfeat(rustc_typeck): suggest removing bad parens in `(recv.method)()`\n\nFixes #88803\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1bf94a156a387c3df6a25b5388162f8d71dd7f30", "html_url": "https://github.com/rust-lang/rust/commit/1bf94a156a387c3df6a25b5388162f8d71dd7f30", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1bf94a156a387c3df6a25b5388162f8d71dd7f30/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb2d7dff806af96a127cd5338dd8a3a95cc7cbe8", "url": "https://api.github.com/repos/rust-lang/rust/commits/fb2d7dff806af96a127cd5338dd8a3a95cc7cbe8", "html_url": "https://github.com/rust-lang/rust/commit/fb2d7dff806af96a127cd5338dd8a3a95cc7cbe8"}, {"sha": "8be729cdd6473859f4fb54aaf74dce56f0775ef1", "url": "https://api.github.com/repos/rust-lang/rust/commits/8be729cdd6473859f4fb54aaf74dce56f0775ef1", "html_url": "https://github.com/rust-lang/rust/commit/8be729cdd6473859f4fb54aaf74dce56f0775ef1"}], "stats": {"total": 56, "additions": 55, "deletions": 1}, "files": [{"sha": "f4e3c8e0d9f7fca10ed0f3706ec031f34b98fff5", "filename": "compiler/rustc_typeck/src/check/expr.rs", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/1bf94a156a387c3df6a25b5388162f8d71dd7f30/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bf94a156a387c3df6a25b5388162f8d71dd7f30/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs?ref=1bf94a156a387c3df6a25b5388162f8d71dd7f30", "patch": "@@ -1842,7 +1842,28 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             expr_t\n         );\n         err.span_label(field.span, \"method, not a field\");\n-        if !self.expr_in_place(expr.hir_id) {\n+        let expr_is_call =\n+            if let hir::Node::Expr(hir::Expr { kind: ExprKind::Call(callee, _args), .. }) =\n+                self.tcx.hir().get(self.tcx.hir().get_parent_node(expr.hir_id))\n+            {\n+                expr.hir_id == callee.hir_id\n+            } else {\n+                false\n+            };\n+        let expr_snippet =\n+            self.tcx.sess.source_map().span_to_snippet(expr.span).unwrap_or(String::new());\n+        if expr_is_call && expr_snippet.starts_with(\"(\") && expr_snippet.ends_with(\")\") {\n+            let after_open = expr.span.lo() + rustc_span::BytePos(1);\n+            let before_close = expr.span.hi() - rustc_span::BytePos(1);\n+            err.multipart_suggestion(\n+                \"remove wrapping parentheses to call the method\",\n+                vec![\n+                    (expr.span.with_hi(after_open), String::new()),\n+                    (expr.span.with_lo(before_close), String::new()),\n+                ],\n+                Applicability::MachineApplicable,\n+            );\n+        } else if !self.expr_in_place(expr.hir_id) {\n             self.suggest_method_call(\n                 &mut err,\n                 \"use parentheses to call the method\","}, {"sha": "19b96ecf3fc3adc5d937164fb2d7514072fa9ac9", "filename": "src/test/ui/typeck/issue-88803-call-expr-method.fixed", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1bf94a156a387c3df6a25b5388162f8d71dd7f30/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/1bf94a156a387c3df6a25b5388162f8d71dd7f30/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.fixed?ref=1bf94a156a387c3df6a25b5388162f8d71dd7f30", "patch": "@@ -0,0 +1,9 @@\n+// run-rustfix\n+\n+fn main() {\n+    let a = Some(42);\n+    println!(\n+        \"The value is {}.\",\n+        a.unwrap() //~ERROR [E0615]\n+    );\n+}"}, {"sha": "a06199466374974719a9ad454f6118c702826665", "filename": "src/test/ui/typeck/issue-88803-call-expr-method.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1bf94a156a387c3df6a25b5388162f8d71dd7f30/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bf94a156a387c3df6a25b5388162f8d71dd7f30/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.rs?ref=1bf94a156a387c3df6a25b5388162f8d71dd7f30", "patch": "@@ -0,0 +1,9 @@\n+// run-rustfix\n+\n+fn main() {\n+    let a = Some(42);\n+    println!(\n+        \"The value is {}.\",\n+        (a.unwrap)() //~ERROR [E0615]\n+    );\n+}"}, {"sha": "dd717ed9416d3bf78f10b312ac47452c57f2a006", "filename": "src/test/ui/typeck/issue-88803-call-expr-method.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/1bf94a156a387c3df6a25b5388162f8d71dd7f30/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1bf94a156a387c3df6a25b5388162f8d71dd7f30/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.stderr?ref=1bf94a156a387c3df6a25b5388162f8d71dd7f30", "patch": "@@ -0,0 +1,15 @@\n+error[E0615]: attempted to take value of method `unwrap` on type `Option<{integer}>`\n+  --> $DIR/issue-88803-call-expr-method.rs:7:12\n+   |\n+LL |         (a.unwrap)()\n+   |            ^^^^^^ method, not a field\n+   |\n+help: remove wrapping parentheses to call the method\n+   |\n+LL -         (a.unwrap)()\n+LL +         a.unwrap()\n+   | \n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0615`."}]}