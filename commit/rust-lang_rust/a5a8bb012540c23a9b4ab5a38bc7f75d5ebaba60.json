{"sha": "a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60", "node_id": "C_kwDOAAsO6NoAKGE1YThiYjAxMjU0MGMyM2E5YjRhYjVhMzhiYzdmNzVkNWViYWJhNjA", "commit": {"author": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2021-10-27T11:03:55Z"}, "committer": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2021-10-27T15:00:49Z"}, "message": "replace `|` with `||` in string validation\n\nUsing short-circuiting operators makes it easier to perform some kinds\nof source code analysis, like MC/DC code coverage (a requirement in\nsafety-critical environments). The optimized x86_64 assembly is\nequivalent between the old and new versions.\n\nOld assembly of that condition:\n\n```\nmov  rax, qword ptr [rdi + rdx + 8]\nor   rax, qword ptr [rdi + rdx]\ntest rax, r9\nje   .LBB0_7\n```\n\nNew assembly of that condition:\n\n```\nmov  rax, qword ptr [rdi + rdx]\nor   rax, qword ptr [rdi + rdx + 8]\ntest rax, r8\nje   .LBB0_7\n```", "tree": {"sha": "db73a31a4a7af8edd49bf0592f85c6180ef8c87f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db73a31a4a7af8edd49bf0592f85c6180ef8c87f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEMycKYjxLY0eb13b7zXazX3c0dp4FAmF5aaYACgkQzXazX3c0\ndp5feA/9H95Stle5Vkxndbrd9arAt47D7Dxqfhg73xBpuvSJ0pXZFLf3VD19a2Mn\nyvDbUU9E8arHdXNWRn/fyJ9jqqF0DbWJ4OMiyY1HNq8OYwElngasrNxmS4fFUHLx\nBBGWbbMD8RzZvZpr4RvPDhpUSi+G0jOaStDBOANeOGWKin9oJF9Tch0cVPdUuZps\npz1ZhEh0ROC9hZgtzUWFwk1YUjm3ClF7xtFWgJ8F4dv9owBYTFDgpbNz7nqI++WA\nwpqqf8Scwf6j+lGd5dbJBK4gUJxjMM3i/sfqCG0cQJYF5gtIEetElY0JXdQ0Lv/R\nPl5Rwpz2EEDwOlY6wyegLVdIyFoqry+lDYh5C2Rg8MTCvbHoVGSMh7z8/DgjIXjO\nw+/D3ldrbCxvM7aoaRWAHiRgNprjeI2q7H3+m4DIz2cJ5t4MZMcpbG5O8v0OxUHZ\nOwx8WVekrqrF8cmsCIVwoUyJng6cFlcT0eBf6Ewezg+9EWDove7UhZKdrcM0IHVG\ny5CZVP3F5E+369cQiybJWwVSwQNi1n8VMo1MYhhxeg/ySOoyjUQR6YmoqBjDDsIF\nIE0p0/YCEE7Rh3Bxe6BzHmQ+lZBe1wbr3siad8vqbKe5EqrQb5bZP2qzStJFyp0D\n5L5owSPnWIW/JRb2RHRHFYu2FYf1DoNbBGBjr5SsYz6Ne6+Sp2k=\n=BPSq\n-----END PGP SIGNATURE-----", "payload": "tree db73a31a4a7af8edd49bf0592f85c6180ef8c87f\nparent 9fb66969e38f1ce4b269f9506faf7ebc161ececa\nauthor Pietro Albini <pietro.albini@ferrous-systems.com> 1635332635 +0200\ncommitter Pietro Albini <pietro.albini@ferrous-systems.com> 1635346849 +0200\n\nreplace `|` with `||` in string validation\n\nUsing short-circuiting operators makes it easier to perform some kinds\nof source code analysis, like MC/DC code coverage (a requirement in\nsafety-critical environments). The optimized x86_64 assembly is\nequivalent between the old and new versions.\n\nOld assembly of that condition:\n\n```\nmov  rax, qword ptr [rdi + rdx + 8]\nor   rax, qword ptr [rdi + rdx]\ntest rax, r9\nje   .LBB0_7\n```\n\nNew assembly of that condition:\n\n```\nmov  rax, qword ptr [rdi + rdx]\nor   rax, qword ptr [rdi + rdx + 8]\ntest rax, r8\nje   .LBB0_7\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60", "html_url": "https://github.com/rust-lang/rust/commit/a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fb66969e38f1ce4b269f9506faf7ebc161ececa", "url": "https://api.github.com/repos/rust-lang/rust/commits/9fb66969e38f1ce4b269f9506faf7ebc161ececa", "html_url": "https://github.com/rust-lang/rust/commit/9fb66969e38f1ce4b269f9506faf7ebc161ececa"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "f2d1c7378088090da22c9d8f17b5becf1a640b68", "filename": "library/core/src/str/validations.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60/library%2Fcore%2Fsrc%2Fstr%2Fvalidations.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60/library%2Fcore%2Fsrc%2Fstr%2Fvalidations.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fstr%2Fvalidations.rs?ref=a5a8bb012540c23a9b4ab5a38bc7f75d5ebaba60", "patch": "@@ -210,7 +210,7 @@ pub(super) fn run_utf8_validation(v: &[u8]) -> Result<(), Utf8Error> {\n                         // break if there is a nonascii byte\n                         let zu = contains_nonascii(*block);\n                         let zv = contains_nonascii(*block.offset(1));\n-                        if zu | zv {\n+                        if zu || zv {\n                             break;\n                         }\n                     }"}]}