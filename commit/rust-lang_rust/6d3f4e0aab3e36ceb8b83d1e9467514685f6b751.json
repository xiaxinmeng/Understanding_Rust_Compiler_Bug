{"sha": "6d3f4e0aab3e36ceb8b83d1e9467514685f6b751", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZkM2Y0ZTBhYWIzZTM2Y2ViOGI4M2QxZTk0Njc1MTQ2ODVmNmI3NTE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-01-25T19:55:26Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-01-25T19:55:26Z"}, "message": "Auto merge of #68530 - estebank:abolish-ice, r=petrochenkov\n\nDo not ICE on multipart suggestions touching multiple files\n\nWhen encountering a multipart suggestion with spans belonging to\ndifferent contexts, skip that suggestion.\n\nFix #68449. Similar to #68256.", "tree": {"sha": "7ee386697608fd6368ac1cc4c8b68273dcca8125", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ee386697608fd6368ac1cc4c8b68273dcca8125"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751", "html_url": "https://github.com/rust-lang/rust/commit/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ad83afe5bcfa983a24b6f720c9ef389350f414b", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ad83afe5bcfa983a24b6f720c9ef389350f414b", "html_url": "https://github.com/rust-lang/rust/commit/8ad83afe5bcfa983a24b6f720c9ef389350f414b"}, {"sha": "b626202087dff72216c14e08e11d936136dc2126", "url": "https://api.github.com/repos/rust-lang/rust/commits/b626202087dff72216c14e08e11d936136dc2126", "html_url": "https://github.com/rust-lang/rust/commit/b626202087dff72216c14e08e11d936136dc2126"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "17b293401f89ef1e60813c7f1fff74dc457f93e0", "filename": "src/librustc_errors/lib.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751/src%2Flibrustc_errors%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751/src%2Flibrustc_errors%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Flib.rs?ref=6d3f4e0aab3e36ceb8b83d1e9467514685f6b751", "patch": "@@ -185,16 +185,17 @@ impl CodeSuggestion {\n                 !invalid\n             })\n             .cloned()\n-            .map(|mut substitution| {\n+            .filter_map(|mut substitution| {\n                 // Assumption: all spans are in the same file, and all spans\n                 // are disjoint. Sort in ascending order.\n                 substitution.parts.sort_by_key(|part| part.span.lo());\n \n                 // Find the bounding span.\n-                let lo = substitution.parts.iter().map(|part| part.span.lo()).min().unwrap();\n-                let hi = substitution.parts.iter().map(|part| part.span.hi()).max().unwrap();\n+                let lo = substitution.parts.iter().map(|part| part.span.lo()).min()?;\n+                let hi = substitution.parts.iter().map(|part| part.span.hi()).max()?;\n                 let bounding_span = Span::with_root_ctxt(lo, hi);\n-                let lines = cm.span_to_lines(bounding_span).unwrap();\n+                // The different spans might belong to different contexts, if so ignore suggestion.\n+                let lines = cm.span_to_lines(bounding_span).ok()?;\n                 assert!(!lines.lines.is_empty());\n \n                 // To build up the result, we do this for each span:\n@@ -244,7 +245,7 @@ impl CodeSuggestion {\n                 while buf.ends_with('\\n') {\n                     buf.pop();\n                 }\n-                (buf, substitution.parts, only_capitalization)\n+                Some((buf, substitution.parts, only_capitalization))\n             })\n             .collect()\n     }"}, {"sha": "a316d8f1698ac4d151e4f5904412ac0077270435", "filename": "src/test/ui/consts/miri_unleashed/mutable_const2.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6d3f4e0aab3e36ceb8b83d1e9467514685f6b751/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const2.stderr?ref=6d3f4e0aab3e36ceb8b83d1e9467514685f6b751", "patch": "@@ -10,7 +10,7 @@ error: internal compiler error: mutable allocation in constant\n LL | const MUTABLE_BEHIND_RAW: *mut i32 = &UnsafeCell::new(42) as *const _ as *mut _;\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-thread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src/librustc_errors/lib.rs:356:17\n+thread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src/librustc_errors/lib.rs:357:17\n note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n \n error: internal compiler error: unexpected panic"}]}