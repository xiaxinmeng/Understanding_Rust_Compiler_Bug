{"sha": "fe6508bd78944b66b6a4e911b55faea17ddab23d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlNjUwOGJkNzg5NDRiNjZiNmE0ZTkxMWI1NWZhZWExN2RkYWIyM2Q=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-06-02T12:13:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-02T12:13:02Z"}, "message": "Merge #4658\n\n4658: Fix problem with format string tokenization r=matklad a=ruabmbua\n\nFixed by just not handling closing curlybrace escaping.\r\n\r\nCloses https://github.com/rust-analyzer/rust-analyzer/issues/4637\n\nCo-authored-by: Roland Ruckerbauer <roland.rucky@gmail.com>", "tree": {"sha": "ea1ea16f9370de39f229e8a5c9a8b4742db4eff3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea1ea16f9370de39f229e8a5c9a8b4742db4eff3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe6508bd78944b66b6a4e911b55faea17ddab23d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe1kJOCRBK7hj4Ov3rIwAAdHIIAI2ptwAzmzjIpC19F1E0OBgY\nkSK0uwKePAZWMXTTU7x42TN6lLHFy78falAVS36rKahmAkCBMZ/MLF8UcNx7tNBT\n3nnHmvIprlVFsUg9/vQm0d0kudPCGJn3JthKJFEFZwNdiDVAe5Eb83AaUxacHOog\nyUjNngn1t2AWFXTCH+poOD01olMefYp4y3ekxGEWg4JJH6N3AbnjmlgdCddugHMP\n3qM4wxw+35J2Om3p0G932otHB+9yA8ZW36MSLsxzNLsSX7A0ASRaMNtw8mQcoZj5\ngbNiSNBdAufUTt7KwS4wQHt7qfqs5HdSLBtirfpq10tKh+bkyGSe7lxZ4p62NMM=\n=1p4T\n-----END PGP SIGNATURE-----\n", "payload": "tree ea1ea16f9370de39f229e8a5c9a8b4742db4eff3\nparent 131ccd95403e10131d6b8dfcad60ebc49c257c53\nparent 780c89959a2f7362eb51508d83863eeff9a49e4c\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1591099982 +0000\ncommitter GitHub <noreply@github.com> 1591099982 +0000\n\nMerge #4658\n\n4658: Fix problem with format string tokenization r=matklad a=ruabmbua\n\nFixed by just not handling closing curlybrace escaping.\r\n\r\nCloses https://github.com/rust-analyzer/rust-analyzer/issues/4637\n\nCo-authored-by: Roland Ruckerbauer <roland.rucky@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe6508bd78944b66b6a4e911b55faea17ddab23d", "html_url": "https://github.com/rust-lang/rust/commit/fe6508bd78944b66b6a4e911b55faea17ddab23d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe6508bd78944b66b6a4e911b55faea17ddab23d/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "131ccd95403e10131d6b8dfcad60ebc49c257c53", "url": "https://api.github.com/repos/rust-lang/rust/commits/131ccd95403e10131d6b8dfcad60ebc49c257c53", "html_url": "https://github.com/rust-lang/rust/commit/131ccd95403e10131d6b8dfcad60ebc49c257c53"}, {"sha": "780c89959a2f7362eb51508d83863eeff9a49e4c", "url": "https://api.github.com/repos/rust-lang/rust/commits/780c89959a2f7362eb51508d83863eeff9a49e4c", "html_url": "https://github.com/rust-lang/rust/commit/780c89959a2f7362eb51508d83863eeff9a49e4c"}], "stats": {"total": 7, "additions": 2, "deletions": 5}, "files": [{"sha": "41cddd0ff261d173f9cd56e9765d6365661b07e4", "filename": "crates/ra_ide/src/snapshots/highlight_strings.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fe6508bd78944b66b6a4e911b55faea17ddab23d/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlight_strings.html", "raw_url": "https://github.com/rust-lang/rust/raw/fe6508bd78944b66b6a4e911b55faea17ddab23d/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlight_strings.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlight_strings.html?ref=fe6508bd78944b66b6a4e911b55faea17ddab23d", "patch": "@@ -52,6 +52,7 @@\n     <span class=\"macro\">println!</span>(<span class=\"string_literal\">\"</span><span class=\"format_specifier\">{</span><span class=\"variable\">argument</span><span class=\"format_specifier\">}</span><span class=\"string_literal\">\"</span>, argument = <span class=\"string_literal\">\"test\"</span>);   <span class=\"comment\">// =&gt; \"test\"</span>\n     <span class=\"macro\">println!</span>(<span class=\"string_literal\">\"</span><span class=\"format_specifier\">{</span><span class=\"variable\">name</span><span class=\"format_specifier\">}</span><span class=\"string_literal\"> </span><span class=\"format_specifier\">{</span><span class=\"format_specifier\">}</span><span class=\"string_literal\">\"</span>, <span class=\"numeric_literal\">1</span>, name = <span class=\"numeric_literal\">2</span>);          <span class=\"comment\">// =&gt; \"2 1\"</span>\n     <span class=\"macro\">println!</span>(<span class=\"string_literal\">\"</span><span class=\"format_specifier\">{</span><span class=\"variable\">a</span><span class=\"format_specifier\">}</span><span class=\"string_literal\"> </span><span class=\"format_specifier\">{</span><span class=\"variable\">c</span><span class=\"format_specifier\">}</span><span class=\"string_literal\"> </span><span class=\"format_specifier\">{</span><span class=\"variable\">b</span><span class=\"format_specifier\">}</span><span class=\"string_literal\">\"</span>, a=<span class=\"string_literal\">\"a\"</span>, b=<span class=\"char_literal\">'b'</span>, c=<span class=\"numeric_literal\">3</span>);  <span class=\"comment\">// =&gt; \"a 3 b\"</span>\n+    <span class=\"macro\">println!</span>(<span class=\"string_literal\">\"{{</span><span class=\"format_specifier\">{</span><span class=\"format_specifier\">}</span><span class=\"string_literal\">}}\"</span>, <span class=\"numeric_literal\">2</span>);                       <span class=\"comment\">// =&gt; \"{2}\"</span>\n     <span class=\"macro\">println!</span>(<span class=\"string_literal\">\"Hello </span><span class=\"format_specifier\">{</span><span class=\"format_specifier\">:</span><span class=\"numeric_literal\">5</span><span class=\"format_specifier\">}</span><span class=\"string_literal\">!\"</span>, <span class=\"string_literal\">\"x\"</span>);\n     <span class=\"macro\">println!</span>(<span class=\"string_literal\">\"Hello </span><span class=\"format_specifier\">{</span><span class=\"format_specifier\">:</span><span class=\"numeric_literal\">1</span><span class=\"format_specifier\">$</span><span class=\"format_specifier\">}</span><span class=\"string_literal\">!\"</span>, <span class=\"string_literal\">\"x\"</span>, <span class=\"numeric_literal\">5</span>);\n     <span class=\"macro\">println!</span>(<span class=\"string_literal\">\"Hello </span><span class=\"format_specifier\">{</span><span class=\"numeric_literal\">1</span><span class=\"format_specifier\">:</span><span class=\"numeric_literal\">0</span><span class=\"format_specifier\">$</span><span class=\"format_specifier\">}</span><span class=\"string_literal\">!\"</span>, <span class=\"numeric_literal\">5</span>, <span class=\"string_literal\">\"x\"</span>);"}, {"sha": "7dc229cab73d7846d097765703e55e1d19566349", "filename": "crates/ra_ide/src/syntax_highlighting/tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fe6508bd78944b66b6a4e911b55faea17ddab23d/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe6508bd78944b66b6a4e911b55faea17ddab23d/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs?ref=fe6508bd78944b66b6a4e911b55faea17ddab23d", "patch": "@@ -218,6 +218,7 @@ fn main() {\n     println!(\"{argument}\", argument = \"test\");   // => \"test\"\n     println!(\"{name} {}\", 1, name = 2);          // => \"2 1\"\n     println!(\"{a} {c} {b}\", a=\"a\", b='b', c=3);  // => \"a 3 b\"\n+    println!(\"{{{}}}\", 2);                       // => \"{2}\"\n     println!(\"Hello {:5}!\", \"x\");\n     println!(\"Hello {:1$}!\", \"x\", 5);\n     println!(\"Hello {1:0$}!\", 5, \"x\");"}, {"sha": "04b0a4480375a2af3e3a1b59015fa50ef9a3a343", "filename": "crates/ra_syntax/src/ast/tokens.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fe6508bd78944b66b6a4e911b55faea17ddab23d/crates%2Fra_syntax%2Fsrc%2Fast%2Ftokens.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe6508bd78944b66b6a4e911b55faea17ddab23d/crates%2Fra_syntax%2Fsrc%2Fast%2Ftokens.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fast%2Ftokens.rs?ref=fe6508bd78944b66b6a4e911b55faea17ddab23d", "patch": "@@ -418,14 +418,9 @@ pub trait HasFormatSpecifier: AstToken {\n \n                     let mut cloned = chars.clone().take(2);\n                     let first = cloned.next().and_then(|next| next.1.as_ref().ok()).copied();\n-                    let second = cloned.next().and_then(|next| next.1.as_ref().ok()).copied();\n                     if first != Some('}') {\n                         continue;\n                     }\n-                    if second == Some('}') {\n-                        // Escaped format end specifier, `}}`\n-                        continue;\n-                    }\n                     skip_char_and_emit(&mut chars, FormatSpecifier::Close, &mut callback);\n                 }\n                 _ => {"}]}