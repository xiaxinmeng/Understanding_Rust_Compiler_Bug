{"sha": "a026e8a972729c7f97e40b78e0904a2cf321f227", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwMjZlOGE5NzI3MjljN2Y5N2U0MGI3OGUwOTA0YTJjZjMyMWYyMjc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-06T19:23:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-02-06T19:23:24Z"}, "message": "Rollup merge of #47986 - Gilnaa:libtest_relaxed, r=Mark-Simulacrum\n\nlibtest: Replace panics with error messages\n\nThis replaces explicit panics on failures in libtest with prints to stderr.\nWhere \"failures\" == CLI argument parsing and such\n\nBefore:\n```\n$ ./foo-stable --not-an-option\nthread 'main' panicked at '\"Unrecognized option: \\'not-an-option\\'\"', libtest/lib.rs:251:27\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n```\n\nAfter:\n```\n$ ./foo-nightly --not-an-option\nerror: Unrecognized option: 'not-an-option'\n```", "tree": {"sha": "2a78cc862151ac66a610ca069d9452666ff26cc1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2a78cc862151ac66a610ca069d9452666ff26cc1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a026e8a972729c7f97e40b78e0904a2cf321f227", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaegCsCRBK7hj4Ov3rIwAAdHIIACpudk+SZAcV3vLHomdBuqls\ngQ7T/axtKSUt7w3n0H3uqCDs05n35wnnzn8uim2Py2Qygt18bnKUn58b+UmEYsr3\nYxpKqGAFoA9js2dmIkaJfJ8/vmhbmIWoe3L+pffgIVwf9WPeQdT6y0N4eOH197xL\n4mbnHghPGkYlegvByXef8cu1EB6Rs/loTAKPUISuas6AYkl2MXOHBx76Sqw86UmP\n6ZaakUJBHg5AORd+zOEo1/V2QRJknK90Hs2dDp5g/xOB353OmG3xWpgRul4/a5Om\nORrXNH8YxCjMertpaQXLfvtBCjmalDAqx8G+Xd9WwhMYXN9729dR+3W8JOuEg9A=\n=/o0w\n-----END PGP SIGNATURE-----\n", "payload": "tree 2a78cc862151ac66a610ca069d9452666ff26cc1\nparent 0a3e07dd72f98630b0f1282810a15240d3425170\nparent 61ff3ba5364ae7bbf93be5b892fa7c122d3cfab2\nauthor kennytm <kennytm@gmail.com> 1517945004 +0800\ncommitter GitHub <noreply@github.com> 1517945004 +0800\n\nRollup merge of #47986 - Gilnaa:libtest_relaxed, r=Mark-Simulacrum\n\nlibtest: Replace panics with error messages\n\nThis replaces explicit panics on failures in libtest with prints to stderr.\nWhere \"failures\" == CLI argument parsing and such\n\nBefore:\n```\n$ ./foo-stable --not-an-option\nthread 'main' panicked at '\"Unrecognized option: \\'not-an-option\\'\"', libtest/lib.rs:251:27\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n```\n\nAfter:\n```\n$ ./foo-nightly --not-an-option\nerror: Unrecognized option: 'not-an-option'\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a026e8a972729c7f97e40b78e0904a2cf321f227", "html_url": "https://github.com/rust-lang/rust/commit/a026e8a972729c7f97e40b78e0904a2cf321f227", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a026e8a972729c7f97e40b78e0904a2cf321f227/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a3e07dd72f98630b0f1282810a15240d3425170", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a3e07dd72f98630b0f1282810a15240d3425170", "html_url": "https://github.com/rust-lang/rust/commit/0a3e07dd72f98630b0f1282810a15240d3425170"}, {"sha": "61ff3ba5364ae7bbf93be5b892fa7c122d3cfab2", "url": "https://api.github.com/repos/rust-lang/rust/commits/61ff3ba5364ae7bbf93be5b892fa7c122d3cfab2", "html_url": "https://github.com/rust-lang/rust/commit/61ff3ba5364ae7bbf93be5b892fa7c122d3cfab2"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "9ea5f39b71feecca2ae04b27164c8c1bc2cbb6b3", "filename": "src/libtest/lib.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a026e8a972729c7f97e40b78e0904a2cf321f227/src%2Flibtest%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a026e8a972729c7f97e40b78e0904a2cf321f227/src%2Flibtest%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2Flib.rs?ref=a026e8a972729c7f97e40b78e0904a2cf321f227", "patch": "@@ -72,6 +72,7 @@ use std::sync::{Arc, Mutex};\n use std::thread;\n use std::time::{Instant, Duration};\n use std::borrow::Cow;\n+use std::process;\n \n const TEST_WARN_TIMEOUT_S: u64 = 60;\n const QUIET_MODE_MAX_COLUMN: usize = 100; // insert a '\\n' after 100 tests in quiet mode\n@@ -266,19 +267,27 @@ impl Options {\n pub fn test_main(args: &[String], tests: Vec<TestDescAndFn>, options: Options) {\n     let mut opts = match parse_opts(args) {\n         Some(Ok(o)) => o,\n-        Some(Err(msg)) => panic!(\"{:?}\", msg),\n+        Some(Err(msg)) => {\n+            eprintln!(\"error: {}\", msg);\n+            process::exit(101);\n+        },\n         None => return,\n     };\n+\n     opts.options = options;\n     if opts.list {\n         if let Err(e) = list_tests_console(&opts, tests) {\n-            panic!(\"io error when listing tests: {:?}\", e);\n+            eprintln!(\"error: io error when listing tests: {:?}\", e);\n+            process::exit(101);\n         }\n     } else {\n         match run_tests_console(&opts, tests) {\n             Ok(true) => {}\n-            Ok(false) => std::process::exit(101),\n-            Err(e) => panic!(\"io error when running tests: {:?}\", e),\n+            Ok(false) => process::exit(101),\n+            Err(e) => {\n+                eprintln!(\"error: io error when listing tests: {:?}\", e);\n+                process::exit(101);\n+            },\n         }\n     }\n }"}]}