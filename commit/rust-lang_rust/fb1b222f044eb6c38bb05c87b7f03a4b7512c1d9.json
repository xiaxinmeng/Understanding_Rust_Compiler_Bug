{"sha": "fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiMWIyMjJmMDQ0ZWI2YzM4YmIwNWM4N2I3ZjAzYTRiNzUxMmMxZDk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-18T03:06:17Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-18T03:06:17Z"}, "message": "Auto merge of #60051 - estebank:fn-sugg, r=davidtwco\n\nDo not mention missing `PartialOrd` impl when involving uncalled fns", "tree": {"sha": "d8fb0dcfa65c6cc64c16030e85f1bbb510ed6b00", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8fb0dcfa65c6cc64c16030e85f1bbb510ed6b00"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "html_url": "https://github.com/rust-lang/rust/commit/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9387927ae2c0d2a283f6c48b705f25d38bb6e692", "url": "https://api.github.com/repos/rust-lang/rust/commits/9387927ae2c0d2a283f6c48b705f25d38bb6e692", "html_url": "https://github.com/rust-lang/rust/commit/9387927ae2c0d2a283f6c48b705f25d38bb6e692"}, {"sha": "84af684b48d0380759f0722207bb6132a56ed61c", "url": "https://api.github.com/repos/rust-lang/rust/commits/84af684b48d0380759f0722207bb6132a56ed61c", "html_url": "https://github.com/rust-lang/rust/commit/84af684b48d0380759f0722207bb6132a56ed61c"}], "stats": {"total": 35, "additions": 16, "deletions": 19}, "files": [{"sha": "b93ed2426b7038de8234774d12203962d54984dd", "filename": "src/librustc_typeck/check/op.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Flibrustc_typeck%2Fcheck%2Fop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Flibrustc_typeck%2Fcheck%2Fop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fop.rs?ref=fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "patch": "@@ -332,16 +332,17 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                                 op.node.as_str(),\n                                 lhs_ty);\n \n+                            let mut involves_fn = false;\n                             if !lhs_expr.span.eq(&rhs_expr.span) {\n-                                self.add_type_neq_err_label(\n+                                involves_fn |= self.add_type_neq_err_label(\n                                     &mut err,\n                                     lhs_expr.span,\n                                     lhs_ty,\n                                     rhs_ty,\n                                     op,\n                                     is_assign\n                                 );\n-                                self.add_type_neq_err_label(\n+                                involves_fn |= self.add_type_neq_err_label(\n                                     &mut err,\n                                     rhs_expr.span,\n                                     rhs_ty,\n@@ -410,7 +411,7 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                                         \"`{}` might need a bound for `{}`\",\n                                         lhs_ty, missing_trait\n                                     ));\n-                                } else if !suggested_deref {\n+                                } else if !suggested_deref && !involves_fn {\n                                     err.note(&format!(\n                                         \"an implementation of `{}` might \\\n                                          be missing for `{}`\",\n@@ -429,6 +430,8 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         (lhs_ty, rhs_ty, return_ty)\n     }\n \n+    /// If one of the types is an uncalled function and calling it would yield the other type,\n+    /// suggest calling the function. Returns wether a suggestion was given.\n     fn add_type_neq_err_label(\n         &self,\n         err: &mut errors::DiagnosticBuilder<'_>,\n@@ -437,7 +440,7 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         other_ty: Ty<'tcx>,\n         op: hir::BinOp,\n         is_assign: IsAssign,\n-    ) {\n+    ) -> bool /* did we suggest to call a function because of missing parenthesis? */ {\n         err.span_label(span, ty.to_string());\n         if let FnDef(def_id, _) = ty.sty {\n             let source_map = self.tcx.sess.source_map();\n@@ -481,8 +484,10 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                     variable_snippet,\n                     applicability,\n                 );\n+                return true;\n             }\n         }\n+        false\n     }\n \n     fn check_str_addition("}, {"sha": "c64070a2022d9d0dd13b9c123b9a87fdbbc5a1c0", "filename": "src/test/ui/fn/fn-compare-mismatch.stderr", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Ftest%2Fui%2Ffn%2Ffn-compare-mismatch.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Ftest%2Fui%2Ffn%2Ffn-compare-mismatch.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffn%2Ffn-compare-mismatch.stderr?ref=fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "patch": "@@ -5,8 +5,6 @@ LL |     let x = f == g;\n    |             - ^^ - fn() {main::g}\n    |             |\n    |             fn() {main::f}\n-   |\n-   = note: an implementation of `std::cmp::PartialEq` might be missing for `fn() {main::f}`\n help: you might have forgotten to call this function\n    |\n LL |     let x = f() == g;"}, {"sha": "d5fab0a6f9b267aeeb6e107524c5b7dc7cc556d8", "filename": "src/test/ui/issues/issue-59488.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Ftest%2Fui%2Fissues%2Fissue-59488.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Ftest%2Fui%2Fissues%2Fissue-59488.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-59488.rs?ref=fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "patch": "@@ -10,17 +10,17 @@ fn bar(a: i64) -> i64 {\n \n fn main() {\n     foo > 12;\n-    //~^ ERROR 12:9: 12:10: binary operation `>` cannot be applied to type `fn() -> i32 {foo}` [E0369]\n-    //~| ERROR 12:11: 12:13: mismatched types [E0308]\n+    //~^ ERROR binary operation `>` cannot be applied to type `fn() -> i32 {foo}` [E0369]\n+    //~| ERROR mismatched types [E0308]\n \n     bar > 13;\n-    //~^ ERROR 16:9: 16:10: binary operation `>` cannot be applied to type `fn(i64) -> i64 {bar}` [E0369]\n-    //~| ERROR 16:11: 16:13: mismatched types [E0308]\n+    //~^ ERROR binary operation `>` cannot be applied to type `fn(i64) -> i64 {bar}` [E0369]\n+    //~| ERROR mismatched types [E0308]\n \n     foo > foo;\n-    //~^ ERROR 20:9: 20:10: binary operation `>` cannot be applied to type `fn() -> i32 {foo}` [E0369]\n+    //~^ ERROR binary operation `>` cannot be applied to type `fn() -> i32 {foo}` [E0369]\n \n     foo > bar;\n-    //~^ ERROR 23:9: 23:10: binary operation `>` cannot be applied to type `fn() -> i32 {foo}` [E0369]\n-    //~| ERROR 23:11: 23:14: mismatched types [E0308]\n+    //~^ ERROR binary operation `>` cannot be applied to type `fn() -> i32 {foo}` [E0369]\n+    //~| ERROR mismatched types [E0308]\n }"}, {"sha": "615adb36d330cebe5fa436802a54a4e2812be26e", "filename": "src/test/ui/issues/issue-59488.stderr", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Ftest%2Fui%2Fissues%2Fissue-59488.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9/src%2Ftest%2Fui%2Fissues%2Fissue-59488.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-59488.stderr?ref=fb1b222f044eb6c38bb05c87b7f03a4b7512c1d9", "patch": "@@ -6,8 +6,6 @@ LL |     foo > 12;\n    |     |\n    |     fn() -> i32 {foo}\n    |     help: you might have forgotten to call this function: `foo()`\n-   |\n-   = note: an implementation of `std::cmp::PartialOrd` might be missing for `fn() -> i32 {foo}`\n \n error[E0308]: mismatched types\n   --> $DIR/issue-59488.rs:12:11\n@@ -26,8 +24,6 @@ LL |     bar > 13;\n    |     |\n    |     fn(i64) -> i64 {bar}\n    |     help: you might have forgotten to call this function: `bar( /* arguments */ )`\n-   |\n-   = note: an implementation of `std::cmp::PartialOrd` might be missing for `fn(i64) -> i64 {bar}`\n \n error[E0308]: mismatched types\n   --> $DIR/issue-59488.rs:16:11\n@@ -45,8 +41,6 @@ LL |     foo > foo;\n    |     --- ^ --- fn() -> i32 {foo}\n    |     |\n    |     fn() -> i32 {foo}\n-   |\n-   = note: an implementation of `std::cmp::PartialOrd` might be missing for `fn() -> i32 {foo}`\n help: you might have forgotten to call this function\n    |\n LL |     foo() > foo;"}]}