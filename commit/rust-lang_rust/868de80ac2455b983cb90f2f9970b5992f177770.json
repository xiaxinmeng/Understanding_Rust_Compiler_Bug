{"sha": "868de80ac2455b983cb90f2f9970b5992f177770", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2OGRlODBhYzI0NTViOTgzY2I5MGYyZjk5NzBiNTk5MmYxNzc3NzA=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-04-20T09:08:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-20T09:08:30Z"}, "message": "Rollup merge of #84347 - Swatinem:simplify-document-fns, r=jyn514\n\nrustdoc: Simplify some document functions\n\n* Remove `prefix` param of `document_short/full`, `render_markdown`, as its always an empty string.\n* Remove `Option` wrapping of `document_short` `parent`, as its always `Some`.", "tree": {"sha": "297f3262300cc90d52fca5e2a2e4570a84382f05", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/297f3262300cc90d52fca5e2a2e4570a84382f05"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/868de80ac2455b983cb90f2f9970b5992f177770", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgfpoPCRBK7hj4Ov3rIwAAiX0IABxj0pNJGi/ldVpm9noioB6B\nNVaQZC8hhaYn+c6vCMxg3kqQ3vDydzlL2w2QxBGxDUVQ4NeBgF8ccVaWWXh7l16s\n18iGEMsOyuwKPb2catphDyvb/NdfCIqk3Pg9FH7IPLMXFOadNitjonOV2czfPwf2\nGj0uZ7c126iWFbWB7CE38s96IdtxvAvbiXAJXLrSDGAYLKcrScvVwF1SCGt/78VJ\nooxdEDjQBDwXNUKz7/NnZi3GmfzEQJcvZ8oC8JnCnhID8g+7z6FRMq24c8IF1fyB\nDbjsTLWo/ReP4NguxaFKI+Ieny/SHBCD31hgSy2ExlD3+o8pIzQCJRiL0qkVsU4=\n=R+hc\n-----END PGP SIGNATURE-----\n", "payload": "tree 297f3262300cc90d52fca5e2a2e4570a84382f05\nparent 61f6cfb79b461cde1978ad0cfdac53a21d121846\nparent d93d77b713065bee9a5a44fbb663f6fbfaf00ada\nauthor Dylan DPC <dylan.dpc@gmail.com> 1618909710 +0200\ncommitter GitHub <noreply@github.com> 1618909710 +0200\n\nRollup merge of #84347 - Swatinem:simplify-document-fns, r=jyn514\n\nrustdoc: Simplify some document functions\n\n* Remove `prefix` param of `document_short/full`, `render_markdown`, as its always an empty string.\n* Remove `Option` wrapping of `document_short` `parent`, as its always `Some`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/868de80ac2455b983cb90f2f9970b5992f177770", "html_url": "https://github.com/rust-lang/rust/commit/868de80ac2455b983cb90f2f9970b5992f177770", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/868de80ac2455b983cb90f2f9970b5992f177770/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61f6cfb79b461cde1978ad0cfdac53a21d121846", "url": "https://api.github.com/repos/rust-lang/rust/commits/61f6cfb79b461cde1978ad0cfdac53a21d121846", "html_url": "https://github.com/rust-lang/rust/commit/61f6cfb79b461cde1978ad0cfdac53a21d121846"}, {"sha": "d93d77b713065bee9a5a44fbb663f6fbfaf00ada", "url": "https://api.github.com/repos/rust-lang/rust/commits/d93d77b713065bee9a5a44fbb663f6fbfaf00ada", "html_url": "https://github.com/rust-lang/rust/commit/d93d77b713065bee9a5a44fbb663f6fbfaf00ada"}], "stats": {"total": 56, "additions": 11, "deletions": 45}, "files": [{"sha": "d773f37ad90a3b6af995773effc68ea32d020db9", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 11, "deletions": 45, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/868de80ac2455b983cb90f2f9970b5992f177770/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/868de80ac2455b983cb90f2f9970b5992f177770/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=868de80ac2455b983cb90f2f9970b5992f177770", "patch": "@@ -509,7 +509,7 @@ fn document(w: &mut Buffer, cx: &Context<'_>, item: &clean::Item, parent: Option\n         info!(\"Documenting {}\", name);\n     }\n     document_item_info(w, cx, item, false, parent);\n-    document_full(w, item, cx, \"\", false);\n+    document_full(w, item, cx, false);\n }\n \n /// Render md_text as markdown.\n@@ -518,15 +518,13 @@ fn render_markdown(\n     cx: &Context<'_>,\n     md_text: &str,\n     links: Vec<RenderedLink>,\n-    prefix: &str,\n     is_hidden: bool,\n ) {\n     let mut ids = cx.id_map.borrow_mut();\n     write!(\n         w,\n-        \"<div class=\\\"docblock{}\\\">{}{}</div>\",\n+        \"<div class=\\\"docblock{}\\\">{}</div>\",\n         if is_hidden { \" hidden\" } else { \"\" },\n-        prefix,\n         Markdown(\n             md_text,\n             &links,\n@@ -546,12 +544,11 @@ fn document_short(\n     item: &clean::Item,\n     cx: &Context<'_>,\n     link: AssocItemLink<'_>,\n-    prefix: &str,\n     is_hidden: bool,\n-    parent: Option<&clean::Item>,\n+    parent: &clean::Item,\n     show_def_docs: bool,\n ) {\n-    document_item_info(w, cx, item, is_hidden, parent);\n+    document_item_info(w, cx, item, is_hidden, Some(parent));\n     if !show_def_docs {\n         return;\n     }\n@@ -570,39 +567,17 @@ fn document_short(\n \n         write!(\n             w,\n-            \"<div class='docblock{}'>{}{}</div>\",\n+            \"<div class='docblock{}'>{}</div>\",\n             if is_hidden { \" hidden\" } else { \"\" },\n-            prefix,\n             summary_html,\n         );\n-    } else if !prefix.is_empty() {\n-        write!(\n-            w,\n-            \"<div class=\\\"docblock{}\\\">{}</div>\",\n-            if is_hidden { \" hidden\" } else { \"\" },\n-            prefix\n-        );\n     }\n }\n \n-fn document_full(\n-    w: &mut Buffer,\n-    item: &clean::Item,\n-    cx: &Context<'_>,\n-    prefix: &str,\n-    is_hidden: bool,\n-) {\n+fn document_full(w: &mut Buffer, item: &clean::Item, cx: &Context<'_>, is_hidden: bool) {\n     if let Some(s) = cx.shared.maybe_collapsed_doc_value(item) {\n         debug!(\"Doc block: =====\\n{}\\n=====\", s);\n-        render_markdown(w, cx, &*s, item.links(cx), prefix, is_hidden);\n-    } else if !prefix.is_empty() {\n-        if is_hidden {\n-            w.write_str(\"<div class=\\\"docblock hidden\\\">\");\n-        } else {\n-            w.write_str(\"<div class=\\\"docblock\\\">\");\n-        }\n-        w.write_str(prefix);\n-        w.write_str(\"</div>\");\n+        render_markdown(w, cx, &s, item.links(cx), is_hidden);\n     }\n }\n \n@@ -1547,30 +1522,21 @@ fn render_impl(\n                         // because impls can't have a stability.\n                         if item.doc_value().is_some() {\n                             document_item_info(w, cx, it, is_hidden, Some(parent));\n-                            document_full(w, item, cx, \"\", is_hidden);\n+                            document_full(w, item, cx, is_hidden);\n                         } else {\n                             // In case the item isn't documented,\n                             // provide short documentation from the trait.\n-                            document_short(\n-                                w,\n-                                it,\n-                                cx,\n-                                link,\n-                                \"\",\n-                                is_hidden,\n-                                Some(parent),\n-                                show_def_docs,\n-                            );\n+                            document_short(w, it, cx, link, is_hidden, parent, show_def_docs);\n                         }\n                     }\n                 } else {\n                     document_item_info(w, cx, item, is_hidden, Some(parent));\n                     if show_def_docs {\n-                        document_full(w, item, cx, \"\", is_hidden);\n+                        document_full(w, item, cx, is_hidden);\n                     }\n                 }\n             } else {\n-                document_short(w, item, cx, link, \"\", is_hidden, Some(parent), show_def_docs);\n+                document_short(w, item, cx, link, is_hidden, parent, show_def_docs);\n             }\n         }\n     }"}]}