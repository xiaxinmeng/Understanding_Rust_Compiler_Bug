{"sha": "0f6284c88d521904bb0ada34325a0372a1ea26f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmNjI4NGM4OGQ1MjE5MDRiYjBhZGEzNDMyNWEwMzcyYTFlYTI2ZjE=", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2020-09-27T01:42:19Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2020-10-01T04:57:37Z"}, "message": "Add test of const item mutation with Drop impl", "tree": {"sha": "548ffb5670b7984dd1b75706e3025aefafba9856", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/548ffb5670b7984dd1b75706e3025aefafba9856"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f6284c88d521904bb0ada34325a0372a1ea26f1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAl91YcEACgkQ+boUO5X/\nbYJ6iBAAwHAlwOzNlEHzIBsYPfh3vq0fMYUUOl/5NJGzuR+Fqh9hWS9OmLLhxsJ6\n+QOLtWzOpgbnFa9mqfv5XOXRnUY1RDXgBovMxMRg5tWjI2HGy0QF58w/EAWPFReA\nN2yLiLeamsX/bdyXwKfKnaOBuU2q7jWn42oOnUYruWdAoMiW6UdRxpglmv9MLcvu\n5UEDCFYY795nSJXRnF22l7SblBv+o5ZkKmOwrCAd41UKazV63hXRRGzWGjM9hF2t\noIzwyoFdRPstyLViUjMPgQVyMU/8cYu3vt+VWw67EFz5OBC8Ba9HMJKZBVJc0b1u\nPPDYLL2HmwqOKazUPVXQJM30pppKNWH6UOhV/niFg8vMJYNec1FUi3hFCNZC4JaX\nT85N3FKn6kK3R5rVr68rk/nDH2dpz5tqhIPGrAgZGOT4SQAGS2k++DDYmqMhTgsa\nf9/CJk9tPM23PZmLvEzijTlL8VZQUVLFeZUv/CadUD0KUz26qJTMOr4eJufihzw/\nfAMvJLX1e6NivFb24sByv4ebR4Oi1ao+56zDdLKlRdkON+w0QM3ri/ATWoHsXNt2\nB/8rO42SaUMD6c7JHyrUMCDyz+E+FMFLwV6jgYIPP8Ktf2BiJe0LmJQHVMRg9baw\n98ZIUkY3tzjooRVr2ax/l3LEljLlENEkeIVd6AP9LpWKte0oL9A=\n=jGXd\n-----END PGP SIGNATURE-----", "payload": "tree 548ffb5670b7984dd1b75706e3025aefafba9856\nparent bb760b53bf7f9593c09a03e5dea28ef5f31065d7\nauthor David Tolnay <dtolnay@gmail.com> 1601170939 -0700\ncommitter David Tolnay <dtolnay@gmail.com> 1601528257 -0700\n\nAdd test of const item mutation with Drop impl\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f6284c88d521904bb0ada34325a0372a1ea26f1", "html_url": "https://github.com/rust-lang/rust/commit/0f6284c88d521904bb0ada34325a0372a1ea26f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f6284c88d521904bb0ada34325a0372a1ea26f1/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb760b53bf7f9593c09a03e5dea28ef5f31065d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb760b53bf7f9593c09a03e5dea28ef5f31065d7", "html_url": "https://github.com/rust-lang/rust/commit/bb760b53bf7f9593c09a03e5dea28ef5f31065d7"}], "stats": {"total": 36, "additions": 24, "deletions": 12}, "files": [{"sha": "0fb97367737d68fef6620b3734cbd00baf274395", "filename": "src/test/ui/lint/lint-const-item-mutation.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0f6284c88d521904bb0ada34325a0372a1ea26f1/src%2Ftest%2Fui%2Flint%2Flint-const-item-mutation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f6284c88d521904bb0ada34325a0372a1ea26f1/src%2Ftest%2Fui%2Flint%2Flint-const-item-mutation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-const-item-mutation.rs?ref=0f6284c88d521904bb0ada34325a0372a1ea26f1", "patch": "@@ -9,9 +9,19 @@ impl MyStruct {\n     fn use_mut(&mut self) {}\n }\n \n+struct Mutable {\n+    msg: &'static str,\n+}\n+impl Drop for Mutable {\n+    fn drop(&mut self) {\n+        println!(\"{}\", self.msg);\n+    }\n+}\n+\n const ARRAY: [u8; 1] = [25];\n const MY_STRUCT: MyStruct = MyStruct { field: true, inner_array: ['a'], raw_ptr: 2 as *mut u8 };\n const RAW_PTR: *mut u8 = 1 as *mut u8;\n+const MUTABLE: Mutable = Mutable { msg: \"\" };\n \n fn main() {\n     ARRAY[0] = 5; //~ WARN attempting to modify\n@@ -29,4 +39,6 @@ fn main() {\n         *RAW_PTR = 0;\n         *MY_STRUCT.raw_ptr = 0;\n     }\n+\n+    MUTABLE.msg = \"wow\"; // no warning, because Drop observes the mutation\n }"}, {"sha": "6ede7b31666c8a5c92b5ade522a9814ac2548887", "filename": "src/test/ui/lint/lint-const-item-mutation.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/0f6284c88d521904bb0ada34325a0372a1ea26f1/src%2Ftest%2Fui%2Flint%2Flint-const-item-mutation.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0f6284c88d521904bb0ada34325a0372a1ea26f1/src%2Ftest%2Fui%2Flint%2Flint-const-item-mutation.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-const-item-mutation.stderr?ref=0f6284c88d521904bb0ada34325a0372a1ea26f1", "patch": "@@ -1,45 +1,45 @@\n warning: attempting to modify a `const` item\n-  --> $DIR/lint-const-item-mutation.rs:17:5\n+  --> $DIR/lint-const-item-mutation.rs:27:5\n    |\n LL |     ARRAY[0] = 5;\n    |     ^^^^^^^^^^^^\n    |\n    = note: `#[warn(const_item_mutation)]` on by default\n    = note: each usage of a `const` item creates a new temporary - the original `const` item will not be modified\n note: `const` item defined here\n-  --> $DIR/lint-const-item-mutation.rs:12:1\n+  --> $DIR/lint-const-item-mutation.rs:21:1\n    |\n LL | const ARRAY: [u8; 1] = [25];\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n warning: attempting to modify a `const` item\n-  --> $DIR/lint-const-item-mutation.rs:18:5\n+  --> $DIR/lint-const-item-mutation.rs:28:5\n    |\n LL |     MY_STRUCT.field = false;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: each usage of a `const` item creates a new temporary - the original `const` item will not be modified\n note: `const` item defined here\n-  --> $DIR/lint-const-item-mutation.rs:13:1\n+  --> $DIR/lint-const-item-mutation.rs:22:1\n    |\n LL | const MY_STRUCT: MyStruct = MyStruct { field: true, inner_array: ['a'], raw_ptr: 2 as *mut u8 };\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n warning: attempting to modify a `const` item\n-  --> $DIR/lint-const-item-mutation.rs:19:5\n+  --> $DIR/lint-const-item-mutation.rs:29:5\n    |\n LL |     MY_STRUCT.inner_array[0] = 'b';\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: each usage of a `const` item creates a new temporary - the original `const` item will not be modified\n note: `const` item defined here\n-  --> $DIR/lint-const-item-mutation.rs:13:1\n+  --> $DIR/lint-const-item-mutation.rs:22:1\n    |\n LL | const MY_STRUCT: MyStruct = MyStruct { field: true, inner_array: ['a'], raw_ptr: 2 as *mut u8 };\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n warning: taking a mutable reference to a `const` item\n-  --> $DIR/lint-const-item-mutation.rs:20:5\n+  --> $DIR/lint-const-item-mutation.rs:30:5\n    |\n LL |     MY_STRUCT.use_mut();\n    |     ^^^^^^^^^^^^^^^^^^^\n@@ -52,35 +52,35 @@ note: mutable reference created due to call to this method\n LL |     fn use_mut(&mut self) {}\n    |     ^^^^^^^^^^^^^^^^^^^^^\n note: `const` item defined here\n-  --> $DIR/lint-const-item-mutation.rs:13:1\n+  --> $DIR/lint-const-item-mutation.rs:22:1\n    |\n LL | const MY_STRUCT: MyStruct = MyStruct { field: true, inner_array: ['a'], raw_ptr: 2 as *mut u8 };\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n warning: taking a mutable reference to a `const` item\n-  --> $DIR/lint-const-item-mutation.rs:21:5\n+  --> $DIR/lint-const-item-mutation.rs:31:5\n    |\n LL |     &mut MY_STRUCT;\n    |     ^^^^^^^^^^^^^^\n    |\n    = note: each usage of a `const` item creates a new temporary\n    = note: the mutable reference will refer to this temporary, not the original `const` item\n note: `const` item defined here\n-  --> $DIR/lint-const-item-mutation.rs:13:1\n+  --> $DIR/lint-const-item-mutation.rs:22:1\n    |\n LL | const MY_STRUCT: MyStruct = MyStruct { field: true, inner_array: ['a'], raw_ptr: 2 as *mut u8 };\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n warning: taking a mutable reference to a `const` item\n-  --> $DIR/lint-const-item-mutation.rs:22:5\n+  --> $DIR/lint-const-item-mutation.rs:32:5\n    |\n LL |     (&mut MY_STRUCT).use_mut();\n    |     ^^^^^^^^^^^^^^^^\n    |\n    = note: each usage of a `const` item creates a new temporary\n    = note: the mutable reference will refer to this temporary, not the original `const` item\n note: `const` item defined here\n-  --> $DIR/lint-const-item-mutation.rs:13:1\n+  --> $DIR/lint-const-item-mutation.rs:22:1\n    |\n LL | const MY_STRUCT: MyStruct = MyStruct { field: true, inner_array: ['a'], raw_ptr: 2 as *mut u8 };\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"}]}