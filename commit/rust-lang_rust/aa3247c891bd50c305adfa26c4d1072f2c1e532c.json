{"sha": "aa3247c891bd50c305adfa26c4d1072f2c1e532c", "node_id": "C_kwDOAAsO6NoAKGFhMzI0N2M4OTFiZDUwYzMwNWFkZmEyNmM0ZDEwNzJmMmMxZTUzMmM", "commit": {"author": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2023-06-02T08:17:55Z"}, "committer": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2023-06-02T08:17:55Z"}, "message": "Merge remote-tracking branch 'upstream/master' into rustup", "tree": {"sha": "b41f6134507edc50cb95e9162f2e0cd02df146f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b41f6134507edc50cb95e9162f2e0cd02df146f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa3247c891bd50c305adfa26c4d1072f2c1e532c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmR5pbUACgkQHKDfKvWd\naKULkQ/9FzxAehV34/M/6V4I38lS9Y3IIpLpZ6xacKFPkrK2M+m8skNPTF/8DND/\nCJk9AO293jVkh7jzD5G/X4MlgoY9+L0A3zV1pWZrnv896/bEzULoCgQiOdTd1/02\nUrzLtjZ2QqT3SWWOCKcrsL2H52P2Ev+mYHI2AyE+cPBbnLIKlzf/aX9axePLa1Nr\nCV9UoOX1oOzoYEWz3k5j1gmPpdok1MOfbH86ZPNWh9ChDKjYLdFDVUAnMPfT5dJ3\nme6/TyELta+yI+xqpKV38kRkkIZgBMCzrCkX1CdZVB5UTvebwK1KJX+rqxDOnJxW\n4G9gMXWu3dfmgicZvEWYsGhzHtGLJoBqtBwT0DDU9rYufwUNLqfdloT18NdzQSVN\naDRHb6mH3JVnCBWGNjDErJgkYZ1ZMkkfJw1CWvPf36g8rWlapPyBhGnV3TbDW8jU\nEbRkrSiT0XJwcUQ0PtMUp8HmH831N+Gt2HcZjRZAJW2HOOby4xRTKhLUwt57TiJe\nC0SJz9HQHYaO4eX1202Mcm7MuJU/phC9ujo1jMe0wUl3TarykYG1L8diuGXRjqZw\nlTI5u6jNWJiwA0IPTLDm2BBx+M9mqxwNVsmHqNtVX3HDia2GEYeHe//QGJ1Q7KQg\noy+Up5zxQg26NfWasz8ILgf3c0MwL2VucWGL3ypqxJl6hhIW8Pc=\n=mU8I\n-----END PGP SIGNATURE-----", "payload": "tree b41f6134507edc50cb95e9162f2e0cd02df146f0\nparent 1a5db18b1172de35b7f491d28dd2ed1542c4b0ad\nparent 9524cff2b40a7e67f84b88c2d95b3729c94bf26e\nauthor Philipp Krones <hello@philkrones.com> 1685693875 +0200\ncommitter Philipp Krones <hello@philkrones.com> 1685693875 +0200\n\nMerge remote-tracking branch 'upstream/master' into rustup\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa3247c891bd50c305adfa26c4d1072f2c1e532c", "html_url": "https://github.com/rust-lang/rust/commit/aa3247c891bd50c305adfa26c4d1072f2c1e532c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa3247c891bd50c305adfa26c4d1072f2c1e532c/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a5db18b1172de35b7f491d28dd2ed1542c4b0ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a5db18b1172de35b7f491d28dd2ed1542c4b0ad", "html_url": "https://github.com/rust-lang/rust/commit/1a5db18b1172de35b7f491d28dd2ed1542c4b0ad"}, {"sha": "9524cff2b40a7e67f84b88c2d95b3729c94bf26e", "url": "https://api.github.com/repos/rust-lang/rust/commits/9524cff2b40a7e67f84b88c2d95b3729c94bf26e", "html_url": "https://github.com/rust-lang/rust/commit/9524cff2b40a7e67f84b88c2d95b3729c94bf26e"}], "stats": {"total": 3268, "additions": 2719, "deletions": 549}, "files": [{"sha": "b49493edce1ba0435e8d5e285ccb940efa7daaa4", "filename": ".github/ISSUE_TEMPLATE/new_lint.yml", "status": "modified", "additions": 0, "deletions": 23, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/.github%2FISSUE_TEMPLATE%2Fnew_lint.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/.github%2FISSUE_TEMPLATE%2Fnew_lint.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2FISSUE_TEMPLATE%2Fnew_lint.yml?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -12,29 +12,6 @@ body:\n       description: What does this lint do?\n     validations:\n       required: true\n-  - type: input\n-    id: lint-name\n-    attributes:\n-      label: Lint Name\n-      description: Please provide the lint name.\n-  - type: dropdown\n-    id: category\n-    attributes:\n-      label: Category\n-      description: >\n-        What category should this lint go into? If you're unsure you can select\n-        multiple categories. You can find a category description in the\n-        `README`.\n-      multiple: true\n-      options:\n-        - correctness\n-        - suspicious\n-        - style\n-        - complexity\n-        - perf\n-        - pedantic\n-        - restriction\n-        - cargo\n   - type: textarea\n     id: advantage\n     attributes:"}, {"sha": "8b609b47d8192424898cdd006a6b138a7e11081b", "filename": "CHANGELOG.md", "status": "modified", "additions": 129, "deletions": 1, "changes": 130, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -6,7 +6,132 @@ document.\n \n ## Unreleased / Beta / In Rust Nightly\n \n-[149392b0...master](https://github.com/rust-lang/rust-clippy/compare/149392b0...master)\n+[83e42a23...master](https://github.com/rust-lang/rust-clippy/compare/83e42a23...master)\n+\n+## Rust 1.70\n+\n+Current beta, released 2023-06-01\n+\n+[149392b0...83e42a23](https://github.com/rust-lang/rust-clippy/compare/149392b0...83e42a23)\n+\n+### New Lints\n+\n+* [`large_futures`]\n+  [#10414](https://github.com/rust-lang/rust-clippy/pull/10414)\n+* [`missing_assert_message`]\n+  [#10362](https://github.com/rust-lang/rust-clippy/pull/10362)\n+* [`clear_with_drain`]\n+  [#10528](https://github.com/rust-lang/rust-clippy/pull/10528)\n+* [`redundant_async_block`]\n+  [#10448](https://github.com/rust-lang/rust-clippy/pull/10448)\n+* [`collection_is_never_read`]\n+  [#10415](https://github.com/rust-lang/rust-clippy/pull/10415)\n+* [`let_with_type_underscore`]\n+  [#10467](https://github.com/rust-lang/rust-clippy/pull/10467)\n+* [`tests_outside_test_module`]\n+  [#10543](https://github.com/rust-lang/rust-clippy/pull/10543)\n+* [`allow_attributes`]\n+  [#10481](https://github.com/rust-lang/rust-clippy/pull/10481)\n+* [`suspicious_doc_comments`]\n+  [#10497](https://github.com/rust-lang/rust-clippy/pull/10497)\n+* [`unnecessary_box_returns`]\n+  [#9102](https://github.com/rust-lang/rust-clippy/pull/9102)\n+* [`manual_main_separator_str`]\n+  [#10483](https://github.com/rust-lang/rust-clippy/pull/10483)\n+* [`unnecessary_struct_initialization`]\n+  [#10489](https://github.com/rust-lang/rust-clippy/pull/10489)\n+* [`manual_slice_size_calculation`]\n+  [#10601](https://github.com/rust-lang/rust-clippy/pull/10601)\n+* [`lines_filter_map_ok`]\n+  [#10534](https://github.com/rust-lang/rust-clippy/pull/10534)\n+\n+### Moves and Deprecations\n+\n+* Moved [`let_underscore_untyped`] to `restriction`\n+  [#10442](https://github.com/rust-lang/rust-clippy/pull/10442)\n+\n+### Enhancements\n+\n+* [`extra_unused_type_parameters`]: No longer lints on public items if `avoid-breaking-exported-api` is set\n+  [#10536](https://github.com/rust-lang/rust-clippy/pull/10536)\n+* [`len_without_is_empty`]: Now also detects `async` functions\n+  [#10359](https://github.com/rust-lang/rust-clippy/pull/10359)\n+* [`arithmetic_side_effects`]: Now correctly handles divisions and modulo expressions if the right-hand-side\n+  is unknown\n+  [#10585](https://github.com/rust-lang/rust-clippy/pull/10585)\n+* [`nonminimal_bool`]: No longer ignores `#[allow]` attributes\n+  [#10588](https://github.com/rust-lang/rust-clippy/pull/10588)\n+* [`uninit_vec`], [`uninit_assumed_init`]: Now uses a better heuristic\n+  [#10520](https://github.com/rust-lang/rust-clippy/pull/10520)\n+* [`ifs_same_cond`]: Now also detects immutable method calls.\n+  [#10350](https://github.com/rust-lang/rust-clippy/pull/10350)\n+* [`arithmetic_side_effects`]: No longer lints on right or left shifts with constant integers, as the\n+  compiler warns about them\n+  [#10309](https://github.com/rust-lang/rust-clippy/pull/10309)\n+* [`items_after_statements`]: `#[allow(items_after_statements)]` now works on items\n+  [#10542](https://github.com/rust-lang/rust-clippy/pull/10542)\n+* [`significant_drop_tightening`]: Was optimized\n+  [#10533](https://github.com/rust-lang/rust-clippy/pull/10533)\n+\n+### False Positive Fixes\n+\n+* [`single_component_path_imports`]: No longer lints if the import is used relative to `self`\n+  [#10566](https://github.com/rust-lang/rust-clippy/pull/10566)\n+* [`derivable_impls`]: No longer suggests deriving `Default` on generics with implicit arguments\n+  [#10399](https://github.com/rust-lang/rust-clippy/pull/10399)\n+* [`let_unit_value`]: No longer lints if the expression contains an `await`\n+  [#10439](https://github.com/rust-lang/rust-clippy/pull/10439)\n+* [`double_must_use`]: Now ignores `async` functions\n+  [#10589](https://github.com/rust-lang/rust-clippy/pull/10589)\n+* [`manual_clamp`]: No longer lints in constant context\n+  [#10479](https://github.com/rust-lang/rust-clippy/pull/10479)\n+* [`almost_swapped`]: Now ignores external macros\n+  [#10502](https://github.com/rust-lang/rust-clippy/pull/10502)\n+* [`nonminimal_bool`]: Now ignores macros\n+  [#10527](https://github.com/rust-lang/rust-clippy/pull/10527)\n+* [`needless_return`]: No longer lints match statements with incompatible branches\n+  [#10593](https://github.com/rust-lang/rust-clippy/pull/10593)\n+* [`use_self`]: Do not suggest using `Self` in const generic parameters\n+  [#10375](https://github.com/rust-lang/rust-clippy/pull/10375)\n+* [`mem_replace_option_with_none`]: No longer lints on field expressions\n+  [#10594](https://github.com/rust-lang/rust-clippy/pull/10594)\n+* [`items_after_statements`]: No longer lints on times from macros\n+  [#10542](https://github.com/rust-lang/rust-clippy/pull/10542)\n+* [`print_literal`], [`write_literal`]: No longer lint strings coming from the `file!()` macro\n+  [#10573](https://github.com/rust-lang/rust-clippy/pull/10573)\n+* [`uninit_vec`], [`uninit_assumed_init`]: Now check the types inside arrays and tuples\n+  [#10553](https://github.com/rust-lang/rust-clippy/pull/10553)\n+* [`almost_swapped`]: No longer lints if a variable is assigned to itself\n+  [#10499](https://github.com/rust-lang/rust-clippy/pull/10499)\n+* [`missing_docs_in_private_items`]: No longer lints on public items\n+  [#10324](https://github.com/rust-lang/rust-clippy/pull/10324)\n+\n+### Suggestion Fixes/Improvements\n+\n+* [`extra_unused_type_parameters`]: The suggestion is now machine applicable\n+  [#10536](https://github.com/rust-lang/rust-clippy/pull/10536)\n+* [`match_single_binding`]: Now adds a semicolon after the suggestion\n+  [#10470](https://github.com/rust-lang/rust-clippy/pull/10470)\n+* [`missing_const_for_fn`]: Now includes a note if the change could break compatibility\n+  [#10618](https://github.com/rust-lang/rust-clippy/pull/10618)\n+* [`cast_possible_truncation`]: Corrected suggestion for float and wildcard casts\n+  [#10496](https://github.com/rust-lang/rust-clippy/pull/10496)\n+* [`transmutes_expressible_as_ptr_casts`]: The suggestion now includes parentheses when they are required\n+  [#10454](https://github.com/rust-lang/rust-clippy/pull/10454)\n+\n+### ICE Fixes\n+\n+* [`needless_borrow`]: No longer panics on ambiguous projections\n+  [#10403](https://github.com/rust-lang/rust-clippy/pull/10403)\n+* [`multiple_unsafe_ops_per_block`]: Fix ICE when calling a function-like object in an unsafe block\n+  [#10405](https://github.com/rust-lang/rust-clippy/pull/10405)\n+\n+### Others\n+\n+* `clippy-driver` now searches parent directories for `clippy.toml` files\n+  [#10592](https://github.com/rust-lang/rust-clippy/pull/10592)\n+* Fixed a deserialization error for the `array-size-threshold` config value\n+  [#10423](https://github.com/rust-lang/rust-clippy/pull/10423)\n \n ## Rust 1.69\n \n@@ -4838,6 +4963,7 @@ Released 2018-09-13\n [`missing_docs_in_private_items`]: https://rust-lang.github.io/rust-clippy/master/index.html#missing_docs_in_private_items\n [`missing_enforced_import_renames`]: https://rust-lang.github.io/rust-clippy/master/index.html#missing_enforced_import_renames\n [`missing_errors_doc`]: https://rust-lang.github.io/rust-clippy/master/index.html#missing_errors_doc\n+[`missing_fields_in_debug`]: https://rust-lang.github.io/rust-clippy/master/index.html#missing_fields_in_debug\n [`missing_inline_in_public_items`]: https://rust-lang.github.io/rust-clippy/master/index.html#missing_inline_in_public_items\n [`missing_panics_doc`]: https://rust-lang.github.io/rust-clippy/master/index.html#missing_panics_doc\n [`missing_safety_doc`]: https://rust-lang.github.io/rust-clippy/master/index.html#missing_safety_doc\n@@ -4874,6 +5000,7 @@ Released 2018-09-13\n [`needless_collect`]: https://rust-lang.github.io/rust-clippy/master/index.html#needless_collect\n [`needless_continue`]: https://rust-lang.github.io/rust-clippy/master/index.html#needless_continue\n [`needless_doctest_main`]: https://rust-lang.github.io/rust-clippy/master/index.html#needless_doctest_main\n+[`needless_else`]: https://rust-lang.github.io/rust-clippy/master/index.html#needless_else\n [`needless_for_each`]: https://rust-lang.github.io/rust-clippy/master/index.html#needless_for_each\n [`needless_late_init`]: https://rust-lang.github.io/rust-clippy/master/index.html#needless_late_init\n [`needless_lifetimes`]: https://rust-lang.github.io/rust-clippy/master/index.html#needless_lifetimes\n@@ -4949,6 +5076,7 @@ Released 2018-09-13\n [`println_empty_string`]: https://rust-lang.github.io/rust-clippy/master/index.html#println_empty_string\n [`ptr_arg`]: https://rust-lang.github.io/rust-clippy/master/index.html#ptr_arg\n [`ptr_as_ptr`]: https://rust-lang.github.io/rust-clippy/master/index.html#ptr_as_ptr\n+[`ptr_cast_constness`]: https://rust-lang.github.io/rust-clippy/master/index.html#ptr_cast_constness\n [`ptr_eq`]: https://rust-lang.github.io/rust-clippy/master/index.html#ptr_eq\n [`ptr_offset_with_cast`]: https://rust-lang.github.io/rust-clippy/master/index.html#ptr_offset_with_cast\n [`pub_enum_variant_names`]: https://rust-lang.github.io/rust-clippy/master/index.html#pub_enum_variant_names"}, {"sha": "257d067dcd84a3f41ac811aae2ebc15d2726bf56", "filename": "Cargo.toml", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -35,11 +35,6 @@ walkdir = \"2.3\"\n # This is used by the `collect-metadata` alias.\n filetime = \"0.2\"\n \n-# A noop dependency that changes in the Rust repository, it's a bit of a hack.\n-# See the `src/tools/rustc-workspace-hack/README.md` file in `rust-lang/rust`\n-# for more information.\n-rustc-workspace-hack = \"1.0\"\n-\n # UI test dependencies\n clap = { version = \"4.1.4\", features = [\"derive\"] }\n clippy_utils = { path = \"clippy_utils\" }"}, {"sha": "e8274bc4575d04bd86716a10bcf9ee2450e48ad1", "filename": "book/src/configuration.md", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/book%2Fsrc%2Fconfiguration.md", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/book%2Fsrc%2Fconfiguration.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/book%2Fsrc%2Fconfiguration.md?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -2,8 +2,14 @@\n \n > **Note:** The configuration file is unstable and may be deprecated in the future.\n \n-Some lints can be configured in a TOML file named `clippy.toml` or `.clippy.toml`. It contains a\n-basic `variable = value` mapping e.g.\n+Some lints can be configured in a TOML file named `clippy.toml` or `.clippy.toml`, which is searched for in:\n+\n+1. The directory specified by the `CLIPPY_CONF_DIR` environment variable, or\n+2. The directory specified by the\n+[CARGO_MANIFEST_DIR](https://doc.rust-lang.org/cargo/reference/environment-variables.html) environment variable, or\n+3. The current directory.\n+\n+It contains a basic `variable = value` mapping e.g.\n \n ```toml\n avoid-breaking-exported-api = false"}, {"sha": "c26aa883ebae24726db239505640e85d2e686401", "filename": "book/src/development/adding_lints.md", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/book%2Fsrc%2Fdevelopment%2Fadding_lints.md", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/book%2Fsrc%2Fdevelopment%2Fadding_lints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/book%2Fsrc%2Fdevelopment%2Fadding_lints.md?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -630,8 +630,14 @@ Before submitting your PR make sure you followed all the basic requirements:\n \n ## Adding configuration to a lint\n \n-Clippy supports the configuration of lints values using a `clippy.toml` file in\n-the workspace directory. Adding a configuration to a lint can be useful for\n+Clippy supports the configuration of lints values using a `clippy.toml` file which is searched for in:\n+\n+1. The directory specified by the `CLIPPY_CONF_DIR` environment variable, or\n+2. The directory specified by the\n+[CARGO_MANIFEST_DIR](https://doc.rust-lang.org/cargo/reference/environment-variables.html) environment variable, or\n+3. The current directory.\n+\n+Adding a configuration to a lint can be useful for\n thresholds or to constrain some behavior that can be seen as a false positive\n for some users. Adding a configuration is done in the following steps:\n "}, {"sha": "c03fbe9d275f3dcb763668e40cdea8e0c8a0302a", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -5,6 +5,7 @@\n use clap::{Arg, ArgAction, ArgMatches, Command};\n use clippy_dev::{bless, dogfood, fmt, lint, new_lint, serve, setup, update_lints};\n use indoc::indoc;\n+use std::convert::Infallible;\n \n fn main() {\n     let matches = get_clap_config();\n@@ -180,7 +181,8 @@ fn get_clap_config() -> ArgMatches {\n                         .short('n')\n                         .long(\"name\")\n                         .help(\"Name of the new lint in snake case, ex: fn_too_long\")\n-                        .required(true),\n+                        .required(true)\n+                        .value_parser(|name: &str| Ok::<_, Infallible>(name.replace('-', \"_\"))),\n                     Arg::new(\"category\")\n                         .short('c')\n                         .long(\"category\")"}, {"sha": "01cefc32a4d875376c784f7c69b9c0d781624fef", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -20,15 +20,13 @@ quine-mc_cluskey = \"0.2\"\n regex-syntax = \"0.7\"\n serde = { version = \"1.0\", features = [\"derive\"] }\n serde_json = { version = \"1.0\", optional = true }\n-tempfile = { version = \"3.2\", optional = true }\n+tempfile = { version = \"3.3.0\", optional = true }\n toml = \"0.5\"\n unicode-normalization = \"0.1\"\n unicode-script = { version = \"0.5\", default-features = false }\n semver = \"1.0\"\n rustc-semver = \"1.1\"\n-# NOTE: cargo requires serde feat in its url dep\n-# see <https://github.com/rust-lang/rust/pull/63587#issuecomment-522343864>\n-url = { version = \"2.2\", features = [\"serde\"] }\n+url = \"2.2\"\n \n [features]\n deny-warnings = [\"clippy_utils/deny-warnings\"]"}, {"sha": "554efdc58e1cb094e2e0bae0e587ffc3b0ebf912", "filename": "clippy_lints/src/allow_attributes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fallow_attributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fallow_attributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fallow_attributes.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -40,7 +40,7 @@ declare_clippy_lint! {\n     ///     a.len()\n     /// }\n     /// ```\n-    #[clippy::version = \"1.69.0\"]\n+    #[clippy::version = \"1.70.0\"]\n     pub ALLOW_ATTRIBUTES,\n     restriction,\n     \"`#[allow]` will not trigger if a warning isn't found. `#[expect]` triggers if there are no warnings.\""}, {"sha": "569bf27c3e716e13e3802e7e4cd6fe8bab627135", "filename": "clippy_lints/src/blocks_in_if_conditions.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -85,8 +85,7 @@ impl<'tcx> LateLintPass<'tcx> for BlocksInIfConditions {\n                             );\n                         }\n                     } else {\n-                        let span =\n-                            block.expr.as_ref().map_or_else(|| block.stmts[0].span, |e| e.span);\n+                        let span = block.expr.as_ref().map_or_else(|| block.stmts[0].span, |e| e.span);\n                         if span.from_expansion() || expr.span.from_expansion() {\n                             return;\n                         }"}, {"sha": "ff0102255a0a9831bd9d24022300ddd0ad46e017", "filename": "clippy_lints/src/booleans.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fbooleans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fbooleans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fbooleans.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -88,7 +88,6 @@ impl<'tcx> LateLintPass<'tcx> for NonminimalBool {\n         NonminimalBoolVisitor { cx }.visit_body(body);\n     }\n }\n-\n struct NonminimalBoolVisitor<'a, 'tcx> {\n     cx: &'a LateContext<'tcx>,\n }\n@@ -473,6 +472,10 @@ impl<'a, 'tcx> Visitor<'tcx> for NonminimalBoolVisitor<'a, 'tcx> {\n                     self.bool_expr(e);\n                 },\n                 ExprKind::Unary(UnOp::Not, inner) => {\n+                    if let ExprKind::Unary(UnOp::Not, ex) = inner.kind &&\n+                    !self.cx.typeck_results().node_types()[ex.hir_id].is_bool() {\n+                        return;\n+                    }\n                     if self.cx.typeck_results().node_types()[inner.hir_id].is_bool() {\n                         self.bool_expr(e);\n                     }"}, {"sha": "b90dab07a274afa41bbd667a6ae7ae8245a704c6", "filename": "clippy_lints/src/casts/mod.rs", "status": "modified", "additions": 32, "deletions": 1, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fcasts%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fcasts%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcasts%2Fmod.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -17,6 +17,7 @@ mod fn_to_numeric_cast;\n mod fn_to_numeric_cast_any;\n mod fn_to_numeric_cast_with_truncation;\n mod ptr_as_ptr;\n+mod ptr_cast_constness;\n mod unnecessary_cast;\n mod utils;\n \n@@ -363,7 +364,7 @@ declare_clippy_lint! {\n     /// namely `*const T` to `*const U` and `*mut T` to `*mut U`.\n     ///\n     /// ### Why is this bad?\n-    /// Though `as` casts between raw pointers is not terrible, `pointer::cast` is safer because\n+    /// Though `as` casts between raw pointers are not terrible, `pointer::cast` is safer because\n     /// it cannot accidentally change the pointer's mutability nor cast the pointer to other types like `usize`.\n     ///\n     /// ### Example\n@@ -386,6 +387,34 @@ declare_clippy_lint! {\n     \"casting using `as` from and to raw pointers that doesn't change its mutability, where `pointer::cast` could take the place of `as`\"\n }\n \n+declare_clippy_lint! {\n+    /// ### What it does\n+    /// Checks for `as` casts between raw pointers which change its constness, namely `*const T` to\n+    /// `*mut T` and `*mut T` to `*const T`.\n+    ///\n+    /// ### Why is this bad?\n+    /// Though `as` casts between raw pointers are not terrible, `pointer::cast_mut` and\n+    /// `pointer::cast_const` are safer because they cannot accidentally cast the pointer to another\n+    /// type.\n+    ///\n+    /// ### Example\n+    /// ```rust\n+    /// let ptr: *const u32 = &42_u32;\n+    /// let mut_ptr = ptr as *mut u32;\n+    /// let ptr = mut_ptr as *const u32;\n+    /// ```\n+    /// Use instead:\n+    /// ```rust\n+    /// let ptr: *const u32 = &42_u32;\n+    /// let mut_ptr = ptr.cast_mut();\n+    /// let ptr = mut_ptr.cast_const();\n+    /// ```\n+    #[clippy::version = \"1.71.0\"]\n+    pub PTR_CAST_CONSTNESS,\n+    pedantic,\n+    \"casting using `as` from and to raw pointers to change constness when specialized methods apply\"\n+}\n+\n declare_clippy_lint! {\n     /// ### What it does\n     /// Checks for casts from an enum type to an integral type which will definitely truncate the\n@@ -652,6 +681,7 @@ impl_lint_pass!(Casts => [\n     FN_TO_NUMERIC_CAST_WITH_TRUNCATION,\n     CHAR_LIT_AS_U8,\n     PTR_AS_PTR,\n+    PTR_CAST_CONSTNESS,\n     CAST_ENUM_TRUNCATION,\n     CAST_ENUM_CONSTRUCTOR,\n     CAST_ABS_TO_UNSIGNED,\n@@ -685,6 +715,7 @@ impl<'tcx> LateLintPass<'tcx> for Casts {\n                 return;\n             }\n             cast_slice_from_raw_parts::check(cx, expr, cast_expr, cast_to, &self.msrv);\n+            ptr_cast_constness::check(cx, expr, cast_expr, cast_from, cast_to, &self.msrv);\n             as_ptr_cast_mut::check(cx, expr, cast_expr, cast_to);\n             fn_to_numeric_cast_any::check(cx, expr, cast_expr, cast_from, cast_to);\n             fn_to_numeric_cast::check(cx, expr, cast_expr, cast_from, cast_to);"}, {"sha": "ab015f8822e1b13b79b0b0f7cd7de9b7b4a42f25", "filename": "clippy_lints/src/casts/ptr_cast_constness.rs", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fcasts%2Fptr_cast_constness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fcasts%2Fptr_cast_constness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcasts%2Fptr_cast_constness.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,44 @@\n+use clippy_utils::msrvs::POINTER_CAST_CONSTNESS;\n+use clippy_utils::sugg::Sugg;\n+use clippy_utils::{diagnostics::span_lint_and_sugg, msrvs::Msrv};\n+use if_chain::if_chain;\n+use rustc_errors::Applicability;\n+use rustc_hir::{Expr, Mutability};\n+use rustc_lint::LateContext;\n+use rustc_middle::ty::{self, Ty, TypeAndMut};\n+\n+use super::PTR_CAST_CONSTNESS;\n+\n+pub(super) fn check(\n+    cx: &LateContext<'_>,\n+    expr: &Expr<'_>,\n+    cast_expr: &Expr<'_>,\n+    cast_from: Ty<'_>,\n+    cast_to: Ty<'_>,\n+    msrv: &Msrv,\n+) {\n+    if_chain! {\n+        if msrv.meets(POINTER_CAST_CONSTNESS);\n+        if let ty::RawPtr(TypeAndMut { mutbl: from_mutbl, .. }) = cast_from.kind();\n+        if let ty::RawPtr(TypeAndMut { mutbl: to_mutbl, .. }) = cast_to.kind();\n+        if matches!((from_mutbl, to_mutbl),\n+            (Mutability::Not, Mutability::Mut) | (Mutability::Mut, Mutability::Not));\n+        then {\n+            let sugg = Sugg::hir(cx, cast_expr, \"_\");\n+            let constness = match *to_mutbl {\n+                Mutability::Not => \"const\",\n+                Mutability::Mut => \"mut\",\n+            };\n+\n+            span_lint_and_sugg(\n+                cx,\n+                PTR_CAST_CONSTNESS,\n+                expr.span,\n+                \"`as` casting between raw pointers while changing its constness\",\n+                &format!(\"try `pointer::cast_{constness}`, a safer alternative\"),\n+                format!(\"{}.cast_{constness}()\", sugg.maybe_par()),\n+                Applicability::MachineApplicable,\n+            );\n+        }\n+    }\n+}"}, {"sha": "ac5ac542cf944e3a433f006240ca4d4a087d077b", "filename": "clippy_lints/src/collection_is_never_read.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fcollection_is_never_read.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fcollection_is_never_read.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcollection_is_never_read.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -37,7 +37,7 @@ declare_clippy_lint! {\n     ///     println!(\"{sample}\");\n     /// }\n     /// ```\n-    #[clippy::version = \"1.69.0\"]\n+    #[clippy::version = \"1.70.0\"]\n     pub COLLECTION_IS_NEVER_READ,\n     nursery,\n     \"a collection is never queried\""}, {"sha": "15ff8be0fd942e597aabede1723573b1e107fcee", "filename": "clippy_lints/src/declared_lints.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fdeclared_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fdeclared_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdeclared_lints.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -89,6 +89,7 @@ pub(crate) static LINTS: &[&crate::LintInfo] = &[\n     crate::casts::FN_TO_NUMERIC_CAST_ANY_INFO,\n     crate::casts::FN_TO_NUMERIC_CAST_WITH_TRUNCATION_INFO,\n     crate::casts::PTR_AS_PTR_INFO,\n+    crate::casts::PTR_CAST_CONSTNESS_INFO,\n     crate::casts::UNNECESSARY_CAST_INFO,\n     crate::checked_conversions::CHECKED_CONVERSIONS_INFO,\n     crate::cognitive_complexity::COGNITIVE_COMPLEXITY_INFO,\n@@ -427,6 +428,7 @@ pub(crate) static LINTS: &[&crate::LintInfo] = &[\n     crate::missing_const_for_fn::MISSING_CONST_FOR_FN_INFO,\n     crate::missing_doc::MISSING_DOCS_IN_PRIVATE_ITEMS_INFO,\n     crate::missing_enforced_import_rename::MISSING_ENFORCED_IMPORT_RENAMES_INFO,\n+    crate::missing_fields_in_debug::MISSING_FIELDS_IN_DEBUG_INFO,\n     crate::missing_inline::MISSING_INLINE_IN_PUBLIC_ITEMS_INFO,\n     crate::missing_trait_methods::MISSING_TRAIT_METHODS_INFO,\n     crate::mixed_read_write_in_expression::DIVERGING_SUB_EXPRESSION_INFO,\n@@ -447,6 +449,7 @@ pub(crate) static LINTS: &[&crate::LintInfo] = &[\n     crate::needless_bool::NEEDLESS_BOOL_ASSIGN_INFO,\n     crate::needless_borrowed_ref::NEEDLESS_BORROWED_REFERENCE_INFO,\n     crate::needless_continue::NEEDLESS_CONTINUE_INFO,\n+    crate::needless_else::NEEDLESS_ELSE_INFO,\n     crate::needless_for_each::NEEDLESS_FOR_EACH_INFO,\n     crate::needless_late_init::NEEDLESS_LATE_INIT_INFO,\n     crate::needless_parens_on_range_literals::NEEDLESS_PARENS_ON_RANGE_LITERALS_INFO,"}, {"sha": "fb037bbcbf3eb95c1194512d6e8f87af8c00f807", "filename": "clippy_lints/src/default_constructed_unit_structs.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fdefault_constructed_unit_structs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fdefault_constructed_unit_structs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdefault_constructed_unit_structs.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,4 +1,4 @@\n-use clippy_utils::{diagnostics::span_lint_and_sugg, match_def_path, paths};\n+use clippy_utils::{diagnostics::span_lint_and_sugg, is_ty_alias, match_def_path, paths};\n use hir::{def::Res, ExprKind};\n use rustc_errors::Applicability;\n use rustc_hir as hir;\n@@ -43,12 +43,23 @@ declare_clippy_lint! {\n }\n declare_lint_pass!(DefaultConstructedUnitStructs => [DEFAULT_CONSTRUCTED_UNIT_STRUCTS]);\n \n+fn is_alias(ty: hir::Ty<'_>) -> bool {\n+    if let hir::TyKind::Path(ref qpath) = ty.kind {\n+        is_ty_alias(qpath)\n+    } else {\n+        false\n+    }\n+}\n+\n impl LateLintPass<'_> for DefaultConstructedUnitStructs {\n     fn check_expr<'tcx>(&mut self, cx: &LateContext<'tcx>, expr: &'tcx hir::Expr<'tcx>) {\n         if_chain!(\n             // make sure we have a call to `Default::default`\n             if let hir::ExprKind::Call(fn_expr, &[]) = expr.kind;\n-            if let ExprKind::Path(ref qpath@ hir::QPath::TypeRelative(_,_)) = fn_expr.kind;\n+            if let ExprKind::Path(ref qpath @ hir::QPath::TypeRelative(base, _)) = fn_expr.kind;\n+            // make sure this isn't a type alias:\n+            // `<Foo as Bar>::Assoc` cannot be used as a constructor\n+            if !is_alias(*base);\n             if let Res::Def(_, def_id) = cx.qpath_res(qpath, fn_expr.hir_id);\n             if match_def_path(cx, def_id, &paths::DEFAULT_TRAIT_METHOD);\n             // make sure we have a struct with no fields (unit struct)"}, {"sha": "087c4a65250a9b50692169e45fd4efd652b2d943", "filename": "clippy_lints/src/large_futures.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flarge_futures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flarge_futures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flarge_futures.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -38,7 +38,7 @@ declare_clippy_lint! {\n     ///     wait(fut).await;\n     /// }\n     /// ```\n-    #[clippy::version = \"1.68.0\"]\n+    #[clippy::version = \"1.70.0\"]\n     pub LARGE_FUTURES,\n     pedantic,\n     \"large future may lead to unexpected stack overflows\""}, {"sha": "0a5901bce046e2fd1376ce5587a79aa7603ad4f9", "filename": "clippy_lints/src/large_stack_arrays.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flarge_stack_arrays.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flarge_stack_arrays.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flarge_stack_arrays.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -38,7 +38,7 @@ impl_lint_pass!(LargeStackArrays => [LARGE_STACK_ARRAYS]);\n \n impl<'tcx> LateLintPass<'tcx> for LargeStackArrays {\n     fn check_expr(&mut self, cx: &LateContext<'_>, expr: &Expr<'_>) {\n-        if let ExprKind::Repeat(_, _) = expr.kind\n+        if let ExprKind::Repeat(_, _) | ExprKind::Array(_) = expr.kind\n           && let ty::Array(element_type, cst) = cx.typeck_results().expr_ty(expr).kind()\n           && let ConstKind::Value(ty::ValTree::Leaf(element_count)) = cst.kind()\n           && let Ok(element_count) = element_count.try_to_target_usize(cx.tcx)"}, {"sha": "2f10e3d258133640c9ca872e3c90116e5222c63b", "filename": "clippy_lints/src/let_with_type_underscore.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flet_with_type_underscore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flet_with_type_underscore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flet_with_type_underscore.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -17,7 +17,7 @@ declare_clippy_lint! {\n     /// ```rust,ignore\n     /// let my_number = 1;\n     /// ```\n-    #[clippy::version = \"1.69.0\"]\n+    #[clippy::version = \"1.70.0\"]\n     pub LET_WITH_TYPE_UNDERSCORE,\n     complexity,\n     \"unneeded underscore type (`_`) in a variable declaration\""}, {"sha": "53795a3855ecad8cb2ea010794beeea7e2d969d0", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -202,6 +202,7 @@ mod missing_assert_message;\n mod missing_const_for_fn;\n mod missing_doc;\n mod missing_enforced_import_rename;\n+mod missing_fields_in_debug;\n mod missing_inline;\n mod missing_trait_methods;\n mod mixed_read_write_in_expression;\n@@ -217,6 +218,7 @@ mod needless_arbitrary_self_type;\n mod needless_bool;\n mod needless_borrowed_ref;\n mod needless_continue;\n+mod needless_else;\n mod needless_for_each;\n mod needless_late_init;\n mod needless_parens_on_range_literals;\n@@ -990,6 +992,8 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(|_| Box::new(items_after_test_module::ItemsAfterTestModule));\n     store.register_early_pass(|| Box::new(ref_patterns::RefPatterns));\n     store.register_late_pass(|_| Box::new(default_constructed_unit_structs::DefaultConstructedUnitStructs));\n+    store.register_early_pass(|| Box::new(needless_else::NeedlessElse));\n+    store.register_late_pass(|_| Box::new(missing_fields_in_debug::MissingFieldsInDebug));\n     // add lints here, do not remove this comment, it's used in `new_lint`\n }\n "}, {"sha": "26ae4b409c79570d116147e24477ee335bda9c3f", "filename": "clippy_lints/src/macro_use.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmacro_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmacro_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmacro_use.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -35,7 +35,8 @@ struct PathAndSpan {\n     span: Span,\n }\n \n-/// `MacroRefData` includes the name of the macro.\n+/// `MacroRefData` includes the name of the macro\n+/// and the path from `SourceMap::span_to_filename`.\n #[derive(Debug, Clone)]\n pub struct MacroRefData {\n     name: String,"}, {"sha": "389b0a4a62dc55b70a2df1acd7da510a6e34995b", "filename": "clippy_lints/src/manual_let_else.rs", "status": "modified", "additions": 99, "deletions": 65, "changes": 164, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmanual_let_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmanual_let_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmanual_let_else.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -77,53 +77,54 @@ impl<'tcx> LateLintPass<'tcx> for ManualLetElse {\n             local.els.is_none() &&\n             local.ty.is_none() &&\n             init.span.ctxt() == stmt.span.ctxt() &&\n-            let Some(if_let_or_match) = IfLetOrMatch::parse(cx, init) {\n-        match if_let_or_match {\n-            IfLetOrMatch::IfLet(if_let_expr, let_pat, if_then, if_else) => if_chain! {\n-                if expr_is_simple_identity(let_pat, if_then);\n-                if let Some(if_else) = if_else;\n-                if expr_diverges(cx, if_else);\n-                then {\n-                    emit_manual_let_else(cx, stmt.span, if_let_expr, local.pat, let_pat, if_else);\n-                }\n-            },\n-            IfLetOrMatch::Match(match_expr, arms, source) => {\n-                if self.matches_behaviour == MatchLintBehaviour::Never {\n-                    return;\n-                }\n-                if source != MatchSource::Normal {\n-                    return;\n-                }\n-                // Any other number than two arms doesn't (necessarily)\n-                // have a trivial mapping to let else.\n-                if arms.len() != 2 {\n-                    return;\n-                }\n-                // Guards don't give us an easy mapping either\n-                if arms.iter().any(|arm| arm.guard.is_some()) {\n-                    return;\n-                }\n-                let check_types = self.matches_behaviour == MatchLintBehaviour::WellKnownTypes;\n-                let diverging_arm_opt = arms\n-                    .iter()\n-                    .enumerate()\n-                    .find(|(_, arm)| expr_diverges(cx, arm.body) && pat_allowed_for_else(cx, arm.pat, check_types));\n-                let Some((idx, diverging_arm)) = diverging_arm_opt else { return; };\n-                // If the non-diverging arm is the first one, its pattern can be reused in a let/else statement.\n-                // However, if it arrives in second position, its pattern may cover some cases already covered\n-                // by the diverging one.\n-                // TODO: accept the non-diverging arm as a second position if patterns are disjointed.\n-                if idx == 0 {\n-                    return;\n-                }\n-                let pat_arm = &arms[1 - idx];\n-                if !expr_is_simple_identity(pat_arm.pat, pat_arm.body) {\n-                    return;\n-                }\n+            let Some(if_let_or_match) = IfLetOrMatch::parse(cx, init)\n+        {\n+            match if_let_or_match {\n+                IfLetOrMatch::IfLet(if_let_expr, let_pat, if_then, if_else) => if_chain! {\n+                    if expr_is_simple_identity(let_pat, if_then);\n+                    if let Some(if_else) = if_else;\n+                    if expr_diverges(cx, if_else);\n+                    then {\n+                        emit_manual_let_else(cx, stmt.span, if_let_expr, local.pat, let_pat, if_else);\n+                    }\n+                },\n+                IfLetOrMatch::Match(match_expr, arms, source) => {\n+                    if self.matches_behaviour == MatchLintBehaviour::Never {\n+                        return;\n+                    }\n+                    if source != MatchSource::Normal {\n+                        return;\n+                    }\n+                    // Any other number than two arms doesn't (necessarily)\n+                    // have a trivial mapping to let else.\n+                    if arms.len() != 2 {\n+                        return;\n+                    }\n+                    // Guards don't give us an easy mapping either\n+                    if arms.iter().any(|arm| arm.guard.is_some()) {\n+                        return;\n+                    }\n+                    let check_types = self.matches_behaviour == MatchLintBehaviour::WellKnownTypes;\n+                    let diverging_arm_opt = arms\n+                        .iter()\n+                        .enumerate()\n+                        .find(|(_, arm)| expr_diverges(cx, arm.body) && pat_allowed_for_else(cx, arm.pat, check_types));\n+                    let Some((idx, diverging_arm)) = diverging_arm_opt else { return; };\n+                    // If the non-diverging arm is the first one, its pattern can be reused in a let/else statement.\n+                    // However, if it arrives in second position, its pattern may cover some cases already covered\n+                    // by the diverging one.\n+                    // TODO: accept the non-diverging arm as a second position if patterns are disjointed.\n+                    if idx == 0 {\n+                        return;\n+                    }\n+                    let pat_arm = &arms[1 - idx];\n+                    if !expr_is_simple_identity(pat_arm.pat, pat_arm.body) {\n+                        return;\n+                    }\n \n-                emit_manual_let_else(cx, stmt.span, match_expr, local.pat, pat_arm.pat, diverging_arm.body);\n-            },\n-        }\n+                    emit_manual_let_else(cx, stmt.span, match_expr, local.pat, pat_arm.pat, diverging_arm.body);\n+                },\n+            }\n         };\n     }\n \n@@ -145,10 +146,9 @@ fn emit_manual_let_else(\n         \"this could be rewritten as `let...else`\",\n         |diag| {\n             // This is far from perfect, for example there needs to be:\n-            // * mut additions for the bindings\n-            // * renamings of the bindings for `PatKind::Or`\n+            // * tracking for multi-binding cases: let (foo, bar) = if let (Some(foo), Ok(bar)) = ...\n+            // * renamings of the bindings for many `PatKind`s like structs, slices, etc.\n             // * unused binding collision detection with existing ones\n-            // * putting patterns with at the top level | inside ()\n             // for this to be machine applicable.\n             let mut app = Applicability::HasPlaceholders;\n             let (sn_expr, _) = snippet_with_context(cx, expr.span, span.ctxt(), \"\", &mut app);\n@@ -159,28 +159,62 @@ fn emit_manual_let_else(\n             } else {\n                 format!(\"{{ {sn_else} }}\")\n             };\n-            let sn_bl = match pat.kind {\n-                PatKind::Or(..) => {\n-                    let (sn_pat, _) = snippet_with_context(cx, pat.span, span.ctxt(), \"\", &mut app);\n-                    format!(\"({sn_pat})\")\n-                },\n-                // Replace the variable name iff `TupleStruct` has one argument like `Variant(v)`.\n-                PatKind::TupleStruct(ref w, args, ..) if args.len() == 1 => {\n-                    let sn_wrapper = cx.sess().source_map().span_to_snippet(w.span()).unwrap_or_default();\n-                    let (sn_inner, _) = snippet_with_context(cx, local.span, span.ctxt(), \"\", &mut app);\n-                    format!(\"{sn_wrapper}({sn_inner})\")\n-                },\n-                _ => {\n-                    let (sn_pat, _) = snippet_with_context(cx, pat.span, span.ctxt(), \"\", &mut app);\n-                    sn_pat.into_owned()\n-                },\n-            };\n+            let sn_bl = replace_in_pattern(cx, span, local, pat, &mut app);\n             let sugg = format!(\"let {sn_bl} = {sn_expr} else {else_bl};\");\n             diag.span_suggestion(span, \"consider writing\", sugg, app);\n         },\n     );\n }\n \n+// replaces the locals in the pattern\n+fn replace_in_pattern(\n+    cx: &LateContext<'_>,\n+    span: Span,\n+    local: &Pat<'_>,\n+    pat: &Pat<'_>,\n+    app: &mut Applicability,\n+) -> String {\n+    let mut bindings_count = 0;\n+    pat.each_binding_or_first(&mut |_, _, _, _| bindings_count += 1);\n+    // If the pattern creates multiple bindings, exit early,\n+    // as otherwise we might paste the pattern to the positions of multiple bindings.\n+    if bindings_count > 1 {\n+        let (sn_pat, _) = snippet_with_context(cx, pat.span, span.ctxt(), \"\", app);\n+        return sn_pat.into_owned();\n+    }\n+\n+    match pat.kind {\n+        PatKind::Binding(..) => {\n+            let (sn_bdg, _) = snippet_with_context(cx, local.span, span.ctxt(), \"\", app);\n+            return sn_bdg.to_string();\n+        },\n+        PatKind::Or(pats) => {\n+            let patterns = pats\n+                .iter()\n+                .map(|pat| replace_in_pattern(cx, span, local, pat, app))\n+                .collect::<Vec<_>>();\n+            let or_pat = patterns.join(\" | \");\n+            return format!(\"({or_pat})\");\n+        },\n+        // Replace the variable name iff `TupleStruct` has one argument like `Variant(v)`.\n+        PatKind::TupleStruct(ref w, args, dot_dot_pos) => {\n+            let mut args = args\n+                .iter()\n+                .map(|pat| replace_in_pattern(cx, span, local, pat, app))\n+                .collect::<Vec<_>>();\n+            if let Some(pos) = dot_dot_pos.as_opt_usize() {\n+                args.insert(pos, \"..\".to_owned());\n+            }\n+            let args = args.join(\", \");\n+            let sn_wrapper = cx.sess().source_map().span_to_snippet(w.span()).unwrap_or_default();\n+            return format!(\"{sn_wrapper}({args})\");\n+        },\n+        _ => {},\n+    }\n+    let (sn_pat, _) = snippet_with_context(cx, pat.span, span.ctxt(), \"\", app);\n+    sn_pat.into_owned()\n+}\n+\n /// Check whether an expression is divergent. May give false negatives.\n fn expr_diverges(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n     struct V<'cx, 'tcx> {"}, {"sha": "6424ac31d9f68d69e38fbe20d57af4861c00ed38", "filename": "clippy_lints/src/matches/match_wild_err_arm.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmatches%2Fmatch_wild_err_arm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmatches%2Fmatch_wild_err_arm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches%2Fmatch_wild_err_arm.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -2,14 +2,19 @@ use clippy_utils::diagnostics::span_lint_and_note;\n use clippy_utils::macros::{is_panic, root_macro_call};\n use clippy_utils::ty::is_type_diagnostic_item;\n use clippy_utils::visitors::is_local_used;\n-use clippy_utils::{is_wild, peel_blocks_with_stmt};\n+use clippy_utils::{in_constant, is_wild, peel_blocks_with_stmt};\n use rustc_hir::{Arm, Expr, PatKind};\n use rustc_lint::LateContext;\n use rustc_span::symbol::{kw, sym};\n \n use super::MATCH_WILD_ERR_ARM;\n \n pub(crate) fn check<'tcx>(cx: &LateContext<'tcx>, ex: &Expr<'tcx>, arms: &[Arm<'tcx>]) {\n+    // `unwrap`/`expect` is not (yet) const, so we want to allow this in const contexts for now\n+    if in_constant(cx, ex.hir_id) {\n+        return;\n+    }\n+\n     let ex_ty = cx.typeck_results().expr_ty(ex).peel_refs();\n     if is_type_diagnostic_item(cx, ex_ty, sym::Result) {\n         for arm in arms {"}, {"sha": "0d91051632a185244a0ec66829abe6f0d6fc931f", "filename": "clippy_lints/src/matches/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmatches%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmatches%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches%2Fmod.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -25,7 +25,7 @@ mod wild_in_or_pats;\n \n use clippy_utils::msrvs::{self, Msrv};\n use clippy_utils::source::{snippet_opt, walk_span_to_context};\n-use clippy_utils::{higher, in_constant, is_span_match, tokenize_with_text};\n+use clippy_utils::{higher, in_constant, is_direct_expn_of, is_span_match, tokenize_with_text};\n use rustc_hir::{Arm, Expr, ExprKind, Local, MatchSource, Pat};\n use rustc_lexer::TokenKind;\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n@@ -974,12 +974,16 @@ impl_lint_pass!(Matches => [\n \n impl<'tcx> LateLintPass<'tcx> for Matches {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n-        if in_external_macro(cx.sess(), expr.span) {\n+        if is_direct_expn_of(expr.span, \"matches\").is_none() && in_external_macro(cx.sess(), expr.span) {\n             return;\n         }\n         let from_expansion = expr.span.from_expansion();\n \n         if let ExprKind::Match(ex, arms, source) = expr.kind {\n+            if is_direct_expn_of(expr.span, \"matches\").is_some() {\n+                redundant_pattern_match::check_match(cx, expr, ex, arms);\n+            }\n+\n             if source == MatchSource::Normal && !is_span_match(cx, expr.span) {\n                 return;\n             }"}, {"sha": "479cfd835126c0459a8919bf1827a1643c4e6545", "filename": "clippy_lints/src/matches/redundant_pattern_match.rs", "status": "modified", "additions": 8, "deletions": 13, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmatches%2Fredundant_pattern_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmatches%2Fredundant_pattern_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches%2Fredundant_pattern_match.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,10 +1,10 @@\n use super::REDUNDANT_PATTERN_MATCHING;\n-use clippy_utils::diagnostics::span_lint_and_then;\n+use clippy_utils::diagnostics::{span_lint_and_sugg, span_lint_and_then};\n use clippy_utils::source::{snippet, walk_span_to_context};\n use clippy_utils::sugg::Sugg;\n use clippy_utils::ty::{is_type_diagnostic_item, needs_ordered_drop};\n use clippy_utils::visitors::any_temporaries_need_ordered_drop;\n-use clippy_utils::{higher, is_trait_method};\n+use clippy_utils::{higher, is_expn_of, is_trait_method};\n use if_chain::if_chain;\n use rustc_ast::ast::LitKind;\n use rustc_errors::Applicability;\n@@ -190,24 +190,19 @@ pub(super) fn check_match<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, op\n         let node_pair = (&arms[0].pat.kind, &arms[1].pat.kind);\n \n         if let Some(good_method) = found_good_method(cx, arms, node_pair) {\n-            let span = expr.span.to(op.span);\n+            let span = is_expn_of(expr.span, \"matches\").unwrap_or(expr.span.to(op.span));\n             let result_expr = match &op.kind {\n                 ExprKind::AddrOf(_, _, borrowed) => borrowed,\n                 _ => op,\n             };\n-            span_lint_and_then(\n+            span_lint_and_sugg(\n                 cx,\n                 REDUNDANT_PATTERN_MATCHING,\n-                expr.span,\n+                span,\n                 &format!(\"redundant pattern matching, consider using `{good_method}`\"),\n-                |diag| {\n-                    diag.span_suggestion(\n-                        span,\n-                        \"try this\",\n-                        format!(\"{}.{good_method}\", snippet(cx, result_expr.span, \"_\")),\n-                        Applicability::MaybeIncorrect, // snippet\n-                    );\n-                },\n+                \"try this\",\n+                format!(\"{}.{good_method}\", snippet(cx, result_expr.span, \"_\")),\n+                Applicability::MachineApplicable,\n             );\n         }\n     }"}, {"sha": "122088f4857cd5925b37b8c744fecaf34b3578ed", "filename": "clippy_lints/src/methods/inefficient_to_string.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmethods%2Finefficient_to_string.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmethods%2Finefficient_to_string.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Finefficient_to_string.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -7,7 +7,7 @@ use rustc_errors::Applicability;\n use rustc_hir as hir;\n use rustc_lint::LateContext;\n use rustc_middle::ty::{self, Ty};\n-use rustc_span::symbol::{Symbol, sym};\n+use rustc_span::symbol::{sym, Symbol};\n \n use super::INEFFICIENT_TO_STRING;\n "}, {"sha": "88cbefbb5d3d5e5541c5aaf3117cddf1aa3f3eb3", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -3191,7 +3191,7 @@ declare_clippy_lint! {\n     /// let mut v = vec![1, 2, 3];\n     /// v.clear();\n     /// ```\n-    #[clippy::version = \"1.69.0\"]\n+    #[clippy::version = \"1.70.0\"]\n     pub CLEAR_WITH_DRAIN,\n     nursery,\n     \"calling `drain` in order to `clear` a container\""}, {"sha": "4dbb79334caf3e859d1f8ac1b9728fa86c79b1be", "filename": "clippy_lints/src/missing_assert_message.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmissing_assert_message.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmissing_assert_message.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_assert_message.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -36,7 +36,7 @@ declare_clippy_lint! {\n     ///     assert!(service.ready, \"`service.poll_ready()` must be called first to ensure that service is ready to receive requests\");\n     /// }\n     /// ```\n-    #[clippy::version = \"1.69.0\"]\n+    #[clippy::version = \"1.70.0\"]\n     pub MISSING_ASSERT_MESSAGE,\n     restriction,\n     \"checks assertions without a custom panic message\""}, {"sha": "b6f0de7e504f0cab616335347c60f4e84bb64ed7", "filename": "clippy_lints/src/missing_fields_in_debug.rs", "status": "added", "additions": 234, "deletions": 0, "changes": 234, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmissing_fields_in_debug.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmissing_fields_in_debug.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_fields_in_debug.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,234 @@\n+use std::ops::ControlFlow;\n+\n+use clippy_utils::{\n+    diagnostics::span_lint_and_then,\n+    is_path_lang_item, paths,\n+    ty::match_type,\n+    visitors::{for_each_expr, Visitable},\n+};\n+use rustc_ast::LitKind;\n+use rustc_data_structures::fx::FxHashSet;\n+use rustc_hir::Block;\n+use rustc_hir::{\n+    def::{DefKind, Res},\n+    Expr, ImplItemKind, LangItem, Node,\n+};\n+use rustc_hir::{ExprKind, Impl, ItemKind, QPath, TyKind};\n+use rustc_hir::{ImplItem, Item, VariantData};\n+use rustc_lint::{LateContext, LateLintPass};\n+use rustc_middle::ty::Ty;\n+use rustc_middle::ty::TypeckResults;\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+use rustc_span::{sym, Span, Symbol};\n+\n+declare_clippy_lint! {\n+    /// ### What it does\n+    /// Checks for manual [`core::fmt::Debug`](https://doc.rust-lang.org/core/fmt/trait.Debug.html) implementations that do not use all fields.\n+    ///\n+    /// ### Why is this bad?\n+    /// A common mistake is to forget to update manual `Debug` implementations when adding a new field\n+    /// to a struct or a new variant to an enum.\n+    ///\n+    /// At the same time, it also acts as a style lint to suggest using [`core::fmt::DebugStruct::finish_non_exhaustive`](https://doc.rust-lang.org/core/fmt/struct.DebugStruct.html#method.finish_non_exhaustive)\n+    /// for the times when the user intentionally wants to leave out certain fields (e.g. to hide implementation details).\n+    ///\n+    /// ### Known problems\n+    /// This lint works based on the `DebugStruct` helper types provided by the `Formatter`,\n+    /// so this won't detect `Debug` impls that use the `write!` macro.\n+    /// Oftentimes there is more logic to a `Debug` impl if it uses `write!` macro, so it tries\n+    /// to be on the conservative side and not lint in those cases in an attempt to prevent false positives.\n+    ///\n+    /// This lint also does not look through function calls, so calling a function does not consider fields\n+    /// used inside of that function as used by the `Debug` impl.\n+    ///\n+    /// Lastly, it also ignores tuple structs as their `DebugTuple` formatter does not have a `finish_non_exhaustive`\n+    /// method, as well as enums because their exhaustiveness is already checked by the compiler when matching on the enum,\n+    /// making it much less likely to accidentally forget to update the `Debug` impl when adding a new variant.\n+    ///\n+    /// ### Example\n+    /// ```rust\n+    /// use std::fmt;\n+    /// struct Foo {\n+    ///     data: String,\n+    ///     // implementation detail\n+    ///     hidden_data: i32\n+    /// }\n+    /// impl fmt::Debug for Foo {\n+    ///     fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+    ///         formatter\n+    ///             .debug_struct(\"Foo\")\n+    ///             .field(\"data\", &self.data)\n+    ///             .finish()\n+    ///     }\n+    /// }\n+    /// ```\n+    /// Use instead:\n+    /// ```rust\n+    /// use std::fmt;\n+    /// struct Foo {\n+    ///     data: String,\n+    ///     // implementation detail\n+    ///     hidden_data: i32\n+    /// }\n+    /// impl fmt::Debug for Foo {\n+    ///     fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+    ///         formatter\n+    ///             .debug_struct(\"Foo\")\n+    ///             .field(\"data\", &self.data)\n+    ///             .finish_non_exhaustive()\n+    ///     }\n+    /// }\n+    /// ```\n+    #[clippy::version = \"1.70.0\"]\n+    pub MISSING_FIELDS_IN_DEBUG,\n+    pedantic,\n+    \"missing fields in manual `Debug` implementation\"\n+}\n+declare_lint_pass!(MissingFieldsInDebug => [MISSING_FIELDS_IN_DEBUG]);\n+\n+fn report_lints(cx: &LateContext<'_>, span: Span, span_notes: Vec<(Span, &'static str)>) {\n+    span_lint_and_then(\n+        cx,\n+        MISSING_FIELDS_IN_DEBUG,\n+        span,\n+        \"manual `Debug` impl does not include all fields\",\n+        |diag| {\n+            for (span, note) in span_notes {\n+                diag.span_note(span, note);\n+            }\n+            diag.help(\"consider including all fields in this `Debug` impl\")\n+                .help(\"consider calling `.finish_non_exhaustive()` if you intend to ignore fields\");\n+        },\n+    );\n+}\n+\n+/// Checks if we should lint in a block of code\n+///\n+/// The way we check for this condition is by checking if there is\n+/// a call to `Formatter::debug_struct` but no call to `.finish_non_exhaustive()`.\n+fn should_lint<'tcx>(\n+    cx: &LateContext<'tcx>,\n+    typeck_results: &TypeckResults<'tcx>,\n+    block: impl Visitable<'tcx>,\n+) -> bool {\n+    // Is there a call to `DebugStruct::finish_non_exhaustive`? Don't lint if there is.\n+    let mut has_finish_non_exhaustive = false;\n+    // Is there a call to `DebugStruct::debug_struct`? Do lint if there is.\n+    let mut has_debug_struct = false;\n+\n+    for_each_expr(block, |expr| {\n+        if let ExprKind::MethodCall(path, recv, ..) = &expr.kind {\n+            let recv_ty = typeck_results.expr_ty(recv).peel_refs();\n+\n+            if path.ident.name == sym::debug_struct && match_type(cx, recv_ty, &paths::FORMATTER) {\n+                has_debug_struct = true;\n+            } else if path.ident.name == sym!(finish_non_exhaustive) && match_type(cx, recv_ty, &paths::DEBUG_STRUCT) {\n+                has_finish_non_exhaustive = true;\n+            }\n+        }\n+        ControlFlow::<!, _>::Continue(())\n+    });\n+\n+    !has_finish_non_exhaustive && has_debug_struct\n+}\n+\n+/// Checks if the given expression is a call to `DebugStruct::field`\n+/// and the first argument to it is a string literal and if so, returns it\n+///\n+/// Example: `.field(\"foo\", ....)` returns `Some(\"foo\")`\n+fn as_field_call<'tcx>(\n+    cx: &LateContext<'tcx>,\n+    typeck_results: &TypeckResults<'tcx>,\n+    expr: &Expr<'_>,\n+) -> Option<Symbol> {\n+    if let ExprKind::MethodCall(path, recv, [debug_field, _], _) = &expr.kind\n+        && let recv_ty = typeck_results.expr_ty(recv).peel_refs()\n+        && match_type(cx, recv_ty, &paths::DEBUG_STRUCT)\n+        && path.ident.name == sym::field\n+        && let ExprKind::Lit(lit) = &debug_field.kind\n+        && let LitKind::Str(sym, ..) = lit.node\n+    {\n+        Some(sym)\n+    } else {\n+        None\n+    }\n+}\n+\n+/// Attempts to find unused fields assuming that the item is a struct\n+fn check_struct<'tcx>(\n+    cx: &LateContext<'tcx>,\n+    typeck_results: &TypeckResults<'tcx>,\n+    block: &'tcx Block<'tcx>,\n+    self_ty: Ty<'tcx>,\n+    item: &'tcx Item<'tcx>,\n+    data: &VariantData<'_>,\n+) {\n+    // Is there a \"direct\" field access anywhere (i.e. self.foo)?\n+    // We don't want to lint if there is not, because the user might have\n+    // a newtype struct and use fields from the wrapped type only.\n+    let mut has_direct_field_access = false;\n+    let mut field_accesses = FxHashSet::default();\n+\n+    for_each_expr(block, |expr| {\n+        if let ExprKind::Field(target, ident) = expr.kind\n+            && let target_ty = typeck_results.expr_ty_adjusted(target).peel_refs()\n+            && target_ty == self_ty\n+        {\n+            field_accesses.insert(ident.name);\n+            has_direct_field_access = true;\n+        } else if let Some(sym) = as_field_call(cx, typeck_results, expr) {\n+            field_accesses.insert(sym);\n+        }\n+        ControlFlow::<!, _>::Continue(())\n+    });\n+\n+    let span_notes = data\n+        .fields()\n+        .iter()\n+        .filter_map(|field| {\n+            if field_accesses.contains(&field.ident.name) || is_path_lang_item(cx, field.ty, LangItem::PhantomData) {\n+                None\n+            } else {\n+                Some((field.span, \"this field is unused\"))\n+            }\n+        })\n+        .collect::<Vec<_>>();\n+\n+    // only lint if there's also at least one direct field access to allow patterns\n+    // where one might have a newtype struct and uses fields from the wrapped type\n+    if !span_notes.is_empty() && has_direct_field_access {\n+        report_lints(cx, item.span, span_notes);\n+    }\n+}\n+\n+impl<'tcx> LateLintPass<'tcx> for MissingFieldsInDebug {\n+    fn check_item(&mut self, cx: &LateContext<'tcx>, item: &'tcx rustc_hir::Item<'tcx>) {\n+        // is this an `impl Debug for X` block?\n+        if let ItemKind::Impl(Impl { of_trait: Some(trait_ref), self_ty, items, .. }) = item.kind\n+            && let Res::Def(DefKind::Trait, trait_def_id) = trait_ref.path.res\n+            && let TyKind::Path(QPath::Resolved(_, self_path)) = &self_ty.kind\n+            && cx.match_def_path(trait_def_id, &[sym::core, sym::fmt, sym::Debug])\n+            // don't trigger if this impl was derived\n+            && !cx.tcx.has_attr(item.owner_id, sym::automatically_derived)\n+            && !item.span.from_expansion()\n+            // find `Debug::fmt` function\n+            && let Some(fmt_item) = items.iter().find(|i| i.ident.name == sym::fmt)\n+            && let ImplItem { kind: ImplItemKind::Fn(_, body_id), .. } = cx.tcx.hir().impl_item(fmt_item.id)\n+            && let body = cx.tcx.hir().body(*body_id)\n+            && let ExprKind::Block(block, _) = body.value.kind\n+            // inspect `self`\n+            && let self_ty = cx.tcx.type_of(self_path.res.def_id()).skip_binder().peel_refs()\n+            && let Some(self_adt) = self_ty.ty_adt_def()\n+            && let Some(self_def_id) = self_adt.did().as_local()\n+            && let Some(Node::Item(self_item)) = cx.tcx.hir().find_by_def_id(self_def_id)\n+            // NB: can't call cx.typeck_results() as we are not in a body\n+            && let typeck_results = cx.tcx.typeck_body(*body_id)\n+            && should_lint(cx, typeck_results, block)\n+        {\n+            // we intentionally only lint structs, see lint description\n+            if let ItemKind::Struct(data, _) = &self_item.kind {\n+                check_struct(cx, typeck_results, block, self_ty, item, data);\n+            }\n+        }\n+    }\n+}"}, {"sha": "3ef0c6634598474189ba0b5415d733304b2d2671", "filename": "clippy_lints/src/mutable_debug_assertion.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmutable_debug_assertion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fmutable_debug_assertion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmutable_debug_assertion.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -92,10 +92,6 @@ impl<'a, 'tcx> Visitor<'tcx> for MutArgVisitor<'a, 'tcx> {\n                 self.found = true;\n                 return;\n             },\n-            ExprKind::If(..) => {\n-                self.found = true;\n-                return;\n-            },\n             ExprKind::Path(_) => {\n                 if let Some(adj) = self.cx.typeck_results().adjustments().get(expr.hir_id) {\n                     if adj"}, {"sha": "4ff1bf7ffc0deb404b27b650fb0290e1d854c6bc", "filename": "clippy_lints/src/needless_else.rs", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fneedless_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fneedless_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_else.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,61 @@\n+use clippy_utils::source::snippet_opt;\n+use clippy_utils::{diagnostics::span_lint_and_sugg, source::trim_span};\n+use rustc_ast::ast::{Expr, ExprKind};\n+use rustc_errors::Applicability;\n+use rustc_lint::{EarlyContext, EarlyLintPass, LintContext};\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+\n+declare_clippy_lint! {\n+    /// ### What it does\n+    /// Checks for empty `else` branches.\n+    ///\n+    /// ### Why is this bad?\n+    /// An empty else branch does nothing and can be removed.\n+    ///\n+    /// ### Example\n+    /// ```rust\n+    ///# fn check() -> bool { true }\n+    /// if check() {\n+    ///     println!(\"Check successful!\");\n+    /// } else {\n+    /// }\n+    /// ```\n+    /// Use instead:\n+    /// ```rust\n+    ///# fn check() -> bool { true }\n+    /// if check() {\n+    ///     println!(\"Check successful!\");\n+    /// }\n+    /// ```\n+    #[clippy::version = \"1.71.0\"]\n+    pub NEEDLESS_ELSE,\n+    style,\n+    \"empty else branch\"\n+}\n+declare_lint_pass!(NeedlessElse => [NEEDLESS_ELSE]);\n+\n+impl EarlyLintPass for NeedlessElse {\n+    fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &Expr) {\n+        if let ExprKind::If(_, then_block, Some(else_clause)) = &expr.kind\n+            && let ExprKind::Block(block, _) = &else_clause.kind\n+            && !expr.span.from_expansion()\n+            && !else_clause.span.from_expansion()\n+            && block.stmts.is_empty()\n+            && let Some(trimmed) = expr.span.trim_start(then_block.span)\n+            && let span = trim_span(cx.sess().source_map(), trimmed)\n+            && let Some(else_snippet) = snippet_opt(cx, span)\n+            // Ignore else blocks that contain comments or #[cfg]s\n+            && !else_snippet.contains(['/', '#'])\n+        {\n+            span_lint_and_sugg(\n+                cx,\n+                NEEDLESS_ELSE,\n+                span,\n+                \"this else branch is empty\",\n+                \"you can remove it\",\n+                String::new(),\n+                Applicability::MachineApplicable,\n+            );\n+        }\n+    }\n+}"}, {"sha": "05e52e6b38b1294a16c8cb1032d72f4148149b30", "filename": "clippy_lints/src/redundant_async_block.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fredundant_async_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fredundant_async_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fredundant_async_block.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -35,7 +35,7 @@ declare_clippy_lint! {\n     /// };\n     /// let fut = f;\n     /// ```\n-    #[clippy::version = \"1.69.0\"]\n+    #[clippy::version = \"1.70.0\"]\n     pub REDUNDANT_ASYNC_BLOCK,\n     complexity,\n     \"`async { future.await }` can be replaced by `future`\""}, {"sha": "674f8bf4c0f303d13b0e1912ed3d27e890c59c67", "filename": "clippy_lints/src/regex.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fregex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fregex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fregex.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -177,7 +177,7 @@ fn check_set<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, utf8: bool) {\n }\n \n fn check_regex<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, utf8: bool) {\n-    let mut parser = regex_syntax::ParserBuilder::new().unicode(true).utf8(!utf8).build();\n+    let mut parser = regex_syntax::ParserBuilder::new().unicode(true).utf8(utf8).build();\n \n     if let ExprKind::Lit(lit) = expr.kind {\n         if let LitKind::Str(ref r, style) = lit.node {"}, {"sha": "631ecf1428d6a0de26b98da75201f46175e88df7", "filename": "clippy_lints/src/returns.rs", "status": "modified", "additions": 13, "deletions": 15, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Freturns.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -70,7 +70,7 @@ declare_clippy_lint! {\n     \"using a return statement like `return expr;` where an expression would suffice\"\n }\n \n-#[derive(PartialEq, Eq, Clone)]\n+#[derive(PartialEq, Eq)]\n enum RetReplacement<'tcx> {\n     Empty,\n     Block,\n@@ -80,18 +80,19 @@ enum RetReplacement<'tcx> {\n }\n \n impl<'tcx> RetReplacement<'tcx> {\n-    fn sugg_help(self) -> &'static str {\n+    fn sugg_help(&self) -> &'static str {\n         match self {\n             Self::Empty | Self::Expr(..) => \"remove `return`\",\n             Self::Block => \"replace `return` with an empty block\",\n             Self::Unit => \"replace `return` with a unit value\",\n             Self::IfSequence(..) => \"remove `return` and wrap the sequence with parentheses\",\n         }\n     }\n-    fn applicability(&self) -> Option<Applicability> {\n+\n+    fn applicability(&self) -> Applicability {\n         match self {\n-            Self::Expr(_, ap) | Self::IfSequence(_, ap) => Some(*ap),\n-            _ => None,\n+            Self::Expr(_, ap) | Self::IfSequence(_, ap) => *ap,\n+            _ => Applicability::MachineApplicable,\n         }\n     }\n }\n@@ -271,7 +272,7 @@ fn check_final_expr<'tcx>(\n                 return;\n             }\n \n-            emit_return_lint(cx, ret_span, semi_spans, replacement);\n+            emit_return_lint(cx, ret_span, semi_spans, &replacement);\n         },\n         ExprKind::If(_, then, else_clause_opt) => {\n             check_block_return(cx, &then.kind, peeled_drop_expr.span, semi_spans.clone());\n@@ -306,20 +307,17 @@ fn expr_contains_conjunctive_ifs<'tcx>(expr: &'tcx Expr<'tcx>) -> bool {\n     contains_if(expr, false)\n }\n \n-fn emit_return_lint(cx: &LateContext<'_>, ret_span: Span, semi_spans: Vec<Span>, replacement: RetReplacement<'_>) {\n+fn emit_return_lint(cx: &LateContext<'_>, ret_span: Span, semi_spans: Vec<Span>, replacement: &RetReplacement<'_>) {\n     if ret_span.from_expansion() {\n         return;\n     }\n \n-    let applicability = replacement.applicability().unwrap_or(Applicability::MachineApplicable);\n-    let return_replacement = replacement.to_string();\n-    let sugg_help = replacement.sugg_help();\n     span_lint_and_then(cx, NEEDLESS_RETURN, ret_span, \"unneeded `return` statement\", |diag| {\n-        diag.span_suggestion_hidden(ret_span, sugg_help, return_replacement, applicability);\n-        // for each parent statement, we need to remove the semicolon\n-        for semi_stmt_span in semi_spans {\n-            diag.tool_only_span_suggestion(semi_stmt_span, \"remove this semicolon\", \"\", applicability);\n-        }\n+        let suggestions = std::iter::once((ret_span, replacement.to_string()))\n+            .chain(semi_spans.into_iter().map(|span| (span, String::new())))\n+            .collect();\n+\n+        diag.multipart_suggestion_verbose(replacement.sugg_help(), suggestions, replacement.applicability());\n     });\n }\n "}, {"sha": "45433b2adf0657177b95ef7b17646e93c661b035", "filename": "clippy_lints/src/same_name_method.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fsame_name_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fsame_name_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fsame_name_method.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -55,11 +55,11 @@ impl<'tcx> LateLintPass<'tcx> for SameNameMethod {\n             if matches!(cx.tcx.def_kind(id.owner_id), DefKind::Impl { .. })\n                 && let item = cx.tcx.hir().item(id)\n                 && let ItemKind::Impl(Impl {\n-                  items,\n-                  of_trait,\n-                  self_ty,\n-                  ..\n-                                      }) = &item.kind\n+                    items,\n+                    of_trait,\n+                    self_ty,\n+                    ..\n+                }) = &item.kind\n                 && let TyKind::Path(QPath::Resolved(_, Path { res, .. })) = self_ty.kind\n             {\n                 if !map.contains_key(res) {"}, {"sha": "8658009eba43fb7a6746c3ffae166dd5c1653018", "filename": "clippy_lints/src/strings.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fstrings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fstrings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fstrings.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -2,7 +2,7 @@ use clippy_utils::diagnostics::{span_lint, span_lint_and_help, span_lint_and_sug\n use clippy_utils::source::{snippet, snippet_with_applicability};\n use clippy_utils::ty::is_type_lang_item;\n use clippy_utils::{get_expr_use_or_unification_node, peel_blocks, SpanlessEq};\n-use clippy_utils::{get_parent_expr, is_lint_allowed, match_function_call, method_calls, paths};\n+use clippy_utils::{get_parent_expr, is_lint_allowed, is_path_diagnostic_item, method_calls};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_hir::def_id::DefId;\n@@ -255,7 +255,8 @@ impl<'tcx> LateLintPass<'tcx> for StringLitAsBytes {\n \n         if_chain! {\n             // Find std::str::converts::from_utf8\n-            if let Some(args) = match_function_call(cx, e, &paths::STR_FROM_UTF8);\n+            if let ExprKind::Call(fun, args) = e.kind;\n+            if is_path_diagnostic_item(cx, fun, sym::str_from_utf8);\n \n             // Find string::as_bytes\n             if let ExprKind::AddrOf(BorrowKind::Ref, _, args) = args[0].kind;"}, {"sha": "117dda092223ebefb86fa2087aa0e64b28853183", "filename": "clippy_lints/src/unused_async.rs", "status": "modified", "additions": 43, "deletions": 7, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Funused_async.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Funused_async.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funused_async.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,5 +1,5 @@\n-use clippy_utils::diagnostics::span_lint_and_help;\n-use rustc_hir::intravisit::{walk_expr, walk_fn, FnKind, Visitor};\n+use clippy_utils::diagnostics::span_lint_and_then;\n+use rustc_hir::intravisit::{walk_body, walk_expr, walk_fn, FnKind, Visitor};\n use rustc_hir::{Body, Expr, ExprKind, FnDecl, YieldSource};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_middle::hir::nested_filter;\n@@ -42,21 +42,43 @@ declare_lint_pass!(UnusedAsync => [UNUSED_ASYNC]);\n struct AsyncFnVisitor<'a, 'tcx> {\n     cx: &'a LateContext<'tcx>,\n     found_await: bool,\n+    /// Also keep track of `await`s in nested async blocks so we can mention\n+    /// it in a note\n+    await_in_async_block: Option<Span>,\n+    async_depth: usize,\n }\n \n impl<'a, 'tcx> Visitor<'tcx> for AsyncFnVisitor<'a, 'tcx> {\n     type NestedFilter = nested_filter::OnlyBodies;\n \n     fn visit_expr(&mut self, ex: &'tcx Expr<'tcx>) {\n         if let ExprKind::Yield(_, YieldSource::Await { .. }) = ex.kind {\n-            self.found_await = true;\n+            if self.async_depth == 1 {\n+                self.found_await = true;\n+            } else if self.await_in_async_block.is_none() {\n+                self.await_in_async_block = Some(ex.span);\n+            }\n         }\n         walk_expr(self, ex);\n     }\n \n     fn nested_visit_map(&mut self) -> Self::Map {\n         self.cx.tcx.hir()\n     }\n+\n+    fn visit_body(&mut self, b: &'tcx Body<'tcx>) {\n+        let is_async_block = matches!(b.generator_kind, Some(rustc_hir::GeneratorKind::Async(_)));\n+\n+        if is_async_block {\n+            self.async_depth += 1;\n+        }\n+\n+        walk_body(self, b);\n+\n+        if is_async_block {\n+            self.async_depth -= 1;\n+        }\n+    }\n }\n \n impl<'tcx> LateLintPass<'tcx> for UnusedAsync {\n@@ -70,16 +92,30 @@ impl<'tcx> LateLintPass<'tcx> for UnusedAsync {\n         def_id: LocalDefId,\n     ) {\n         if !span.from_expansion() && fn_kind.asyncness().is_async() {\n-            let mut visitor = AsyncFnVisitor { cx, found_await: false };\n+            let mut visitor = AsyncFnVisitor {\n+                cx,\n+                found_await: false,\n+                async_depth: 0,\n+                await_in_async_block: None,\n+            };\n             walk_fn(&mut visitor, fn_kind, fn_decl, body.id(), def_id);\n             if !visitor.found_await {\n-                span_lint_and_help(\n+                span_lint_and_then(\n                     cx,\n                     UNUSED_ASYNC,\n                     span,\n                     \"unused `async` for function with no await statements\",\n-                    None,\n-                    \"consider removing the `async` from this function\",\n+                    |diag| {\n+                        diag.help(\"consider removing the `async` from this function\");\n+\n+                        if let Some(span) = visitor.await_in_async_block {\n+                            diag.span_note(\n+                                span,\n+                                \"`await` used in an async block, which does not require \\\n+                                the enclosing function to be `async`\",\n+                            );\n+                        }\n+                    },\n                 );\n             }\n         }"}, {"sha": "4acff7fd322870a583f3290c8d826d8162d43f84", "filename": "clippy_lints/src/utils/conf.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Futils%2Fconf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Futils%2Fconf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fconf.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -486,7 +486,7 @@ pub fn lookup_conf_file() -> io::Result<(Option<PathBuf>, Vec<String>)> {\n     const CONFIG_FILE_NAMES: [&str; 2] = [\".clippy.toml\", \"clippy.toml\"];\n \n     // Start looking for a config file in CLIPPY_CONF_DIR, or failing that, CARGO_MANIFEST_DIR.\n-    // If neither of those exist, use \".\".\n+    // If neither of those exist, use \".\". (Update documentation if this priority changes)\n     let mut current = env::var_os(\"CLIPPY_CONF_DIR\")\n         .or_else(|| env::var_os(\"CARGO_MANIFEST_DIR\"))\n         .map_or_else(|| PathBuf::from(\".\"), PathBuf::from)"}, {"sha": "b6e4cd22789f9e918944713e08041ed5fd0449d1", "filename": "clippy_lints/src/wildcard_imports.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fwildcard_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_lints%2Fsrc%2Fwildcard_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fwildcard_imports.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -65,8 +65,9 @@ declare_clippy_lint! {\n     /// This can lead to confusing error messages at best and to unexpected behavior at worst.\n     ///\n     /// ### Exceptions\n-    /// Wildcard imports are allowed from modules named `prelude`. Many crates (including the standard library)\n-    /// provide modules named \"prelude\" specifically designed for wildcard import.\n+    /// Wildcard imports are allowed from modules that their name contains `prelude`. Many crates\n+    /// (including the standard library) provide modules named \"prelude\" specifically designed\n+    /// for wildcard import.\n     ///\n     /// `use super::*` is allowed in test modules. This is defined as any module with \"test\" in the name.\n     ///\n@@ -212,7 +213,9 @@ impl WildcardImports {\n // Allow \"...prelude::..::*\" imports.\n // Many crates have a prelude, and it is imported as a glob by design.\n fn is_prelude_import(segments: &[PathSegment<'_>]) -> bool {\n-    segments.iter().any(|ps| ps.ident.name == sym::prelude)\n+    segments\n+        .iter()\n+        .any(|ps| ps.ident.name.as_str().contains(sym::prelude.as_str()))\n }\n \n // Allow \"super::*\" imports in tests."}, {"sha": "210957a916f2974831f355381242820ffd0f2a89", "filename": "clippy_utils/src/diagnostics.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fdiagnostics.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -83,9 +83,9 @@ pub fn span_lint_and_help<T: LintContext>(\n     cx.struct_span_lint(lint, span, msg.to_string(), |diag| {\n         let help = help.to_string();\n         if let Some(help_span) = help_span {\n-            diag.span_help(help_span, help.to_string());\n+            diag.span_help(help_span, help);\n         } else {\n-            diag.help(help.to_string());\n+            diag.help(help);\n         }\n         docs_link(diag, lint);\n         diag"}, {"sha": "8c883445a798469cee598af28e8bc5ce024df4c0", "filename": "clippy_utils/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Flib.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -287,7 +287,7 @@ pub fn is_wild(pat: &Pat<'_>) -> bool {\n /// Checks if the given `QPath` belongs to a type alias.\n pub fn is_ty_alias(qpath: &QPath<'_>) -> bool {\n     match *qpath {\n-        QPath::Resolved(_, path) => matches!(path.res, Res::Def(DefKind::TyAlias, ..)),\n+        QPath::Resolved(_, path) => matches!(path.res, Res::Def(DefKind::TyAlias | DefKind::AssocTy, ..)),\n         QPath::TypeRelative(ty, _) if let TyKind::Path(qpath) = ty.kind => { is_ty_alias(&qpath) },\n         _ => false,\n     }"}, {"sha": "6f102308f0bf6d38196fbf9f2a2e9ee99f2d8fe0", "filename": "clippy_utils/src/msrvs.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fmsrvs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fmsrvs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fmsrvs.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -20,7 +20,7 @@ macro_rules! msrv_aliases {\n // names may refer to stabilized feature flags or library items\n msrv_aliases! {\n     1,68,0 { PATH_MAIN_SEPARATOR_STR }\n-    1,65,0 { LET_ELSE }\n+    1,65,0 { LET_ELSE, POINTER_CAST_CONSTNESS }\n     1,62,0 { BOOL_THEN_SOME, DEFAULT_ENUM_ATTRIBUTE }\n     1,58,0 { FORMAT_ARGS_CAPTURE, PATTERN_TRAIT_CHAR_ARRAY }\n     1,55,0 { SEEK_REWIND }"}, {"sha": "38ee84fb76c7a642d85533ac1fdd3eb4710de7f2", "filename": "clippy_utils/src/paths.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fpaths.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -125,8 +125,6 @@ pub const STRING_NEW: [&str; 4] = [\"alloc\", \"string\", \"String\", \"new\"];\n pub const STR_BYTES: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"bytes\"];\n pub const STR_CHARS: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"chars\"];\n pub const STR_ENDS_WITH: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"ends_with\"];\n-pub const STR_FROM_UTF8: [&str; 4] = [\"core\", \"str\", \"converts\", \"from_utf8\"];\n-pub const STR_FROM_UTF8_UNCHECKED: [&str; 4] = [\"core\", \"str\", \"converts\", \"from_utf8_unchecked\"];\n pub const STR_LEN: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"len\"];\n pub const STR_STARTS_WITH: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"starts_with\"];\n #[cfg(feature = \"internal\")]\n@@ -163,3 +161,5 @@ pub const VEC_IS_EMPTY: [&str; 4] = [\"alloc\", \"vec\", \"Vec\", \"is_empty\"];\n pub const VEC_POP: [&str; 4] = [\"alloc\", \"vec\", \"Vec\", \"pop\"];\n pub const OPTION_UNWRAP: [&str; 4] = [\"core\", \"option\", \"Option\", \"unwrap\"];\n pub const OPTION_EXPECT: [&str; 4] = [\"core\", \"option\", \"Option\", \"expect\"];\n+pub const FORMATTER: [&str; 3] = [\"core\", \"fmt\", \"Formatter\"];\n+pub const DEBUG_STRUCT: [&str; 4] = [\"core\", \"fmt\", \"builders\", \"DebugStruct\"];"}, {"sha": "582337b47e813ed6e5cedab6f54df7ee1b2a2ef7", "filename": "clippy_utils/src/source.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fsource.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/clippy_utils%2Fsrc%2Fsource.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fsource.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -4,7 +4,7 @@\n \n use rustc_data_structures::sync::Lrc;\n use rustc_errors::Applicability;\n-use rustc_hir::{Expr, ExprKind};\n+use rustc_hir::{BlockCheckMode, Expr, ExprKind, UnsafeSource};\n use rustc_lint::{LateContext, LintContext};\n use rustc_session::Session;\n use rustc_span::source_map::{original_sp, SourceMap};\n@@ -71,11 +71,16 @@ pub fn expr_block<T: LintContext>(\n     app: &mut Applicability,\n ) -> String {\n     let (code, from_macro) = snippet_block_with_context(cx, expr.span, outer, default, indent_relative_to, app);\n-    if from_macro {\n-        format!(\"{{ {code} }}\")\n-    } else if let ExprKind::Block(_, _) = expr.kind {\n+    if !from_macro &&\n+        let ExprKind::Block(block, _) = expr.kind &&\n+        block.rules != BlockCheckMode::UnsafeBlock(UnsafeSource::UserProvided)\n+    {\n         format!(\"{code}\")\n     } else {\n+        // FIXME: add extra indent for the unsafe blocks:\n+        //     original code:   unsafe { ... }\n+        //     result code:     { unsafe { ... } }\n+        //     desired code:    {\\n  unsafe { ... }\\n}\n         format!(\"{{ {code} }}\")\n     }\n }"}, {"sha": "e4de82ad3b83e563abf46cbf4c24d2a5c7f7ea70", "filename": "tests/ui-cargo/multiple_crate_versions/fail/Cargo.lock", "status": "modified", "additions": 3, "deletions": 64, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-cargo%2Fmultiple_crate_versions%2Ffail%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-cargo%2Fmultiple_crate_versions%2Ffail%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fmultiple_crate_versions%2Ffail%2FCargo.lock?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,5 +1,7 @@\n # This file is automatically @generated by Cargo.\n # It is not intended for manual editing.\n+version = 3\n+\n [[package]]\n name = \"ansi_term\"\n version = \"0.11.0\"\n@@ -9,71 +11,14 @@ dependencies = [\n  \"winapi 0.3.9\",\n ]\n \n-[[package]]\n-name = \"bitflags\"\n-version = \"0.9.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4efd02e230a02e18f92fc2735f44597385ed02ad8f831e7c1c1156ee5e1ab3a5\"\n-\n-[[package]]\n-name = \"cfg-if\"\n-version = \"0.1.10\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4785bdd1c96b2a846b2bd7cc02e86b6b3dbf14e7e53446c4f54c92a361040822\"\n-\n-[[package]]\n-name = \"ctrlc\"\n-version = \"3.1.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"653abc99aa905f693d89df4797fadc08085baee379db92be9f2496cefe8a6f2c\"\n-dependencies = [\n- \"kernel32-sys\",\n- \"nix\",\n- \"winapi 0.2.8\",\n-]\n-\n-[[package]]\n-name = \"kernel32-sys\"\n-version = \"0.2.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7507624b29483431c0ba2d82aece8ca6cdba9382bff4ddd0f7490560c056098d\"\n-dependencies = [\n- \"winapi 0.2.8\",\n- \"winapi-build\",\n-]\n-\n-[[package]]\n-name = \"libc\"\n-version = \"0.2.71\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9457b06509d27052635f90d6466700c65095fdf75409b3fbdd903e988b886f49\"\n-\n [[package]]\n name = \"multiple_crate_versions\"\n version = \"0.1.0\"\n dependencies = [\n  \"ansi_term\",\n- \"ctrlc\",\n-]\n-\n-[[package]]\n-name = \"nix\"\n-version = \"0.9.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a2c5afeb0198ec7be8569d666644b574345aad2e95a53baf3a532da3e0f3fb32\"\n-dependencies = [\n- \"bitflags\",\n- \"cfg-if\",\n- \"libc\",\n- \"void\",\n+ \"winapi 0.2.8\",\n ]\n \n-[[package]]\n-name = \"void\"\n-version = \"1.0.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"6a02e4885ed3bc0f2de90ea6dd45ebcbb66dacffe03547fadbb0eeae2770887d\"\n-\n [[package]]\n name = \"winapi\"\n version = \"0.2.8\"\n@@ -90,12 +35,6 @@ dependencies = [\n  \"winapi-x86_64-pc-windows-gnu\",\n ]\n \n-[[package]]\n-name = \"winapi-build\"\n-version = \"0.1.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2d315eee3b34aca4797b2da6b13ed88266e6d612562a0c46390af8299fc699bc\"\n-\n [[package]]\n name = \"winapi-i686-pc-windows-gnu\"\n version = \"0.4.0\""}, {"sha": "79317659ac072c2e59d765105d4b6b4c73413d69", "filename": "tests/ui-cargo/multiple_crate_versions/fail/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-cargo%2Fmultiple_crate_versions%2Ffail%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-cargo%2Fmultiple_crate_versions%2Ffail%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fmultiple_crate_versions%2Ffail%2FCargo.toml?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -6,5 +6,5 @@ publish = false\n [workspace]\n \n [dependencies]\n-ctrlc = \"=3.1.0\"\n+winapi = \"0.2\"\n ansi_term = \"=0.11.0\""}, {"sha": "9b0db660c9975927b76d2359cbfb765ed22434e0", "filename": "tests/ui-internal/custom_ice_message.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-internal%2Fcustom_ice_message.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-internal%2Fcustom_ice_message.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fcustom_ice_message.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -3,7 +3,7 @@\n //@normalize-stderr-test: \"produce_ice.rs:\\d*:\\d*\" -> \"produce_ice.rs\"\n //@normalize-stderr-test: \"', .*clippy_lints\" -> \"', clippy_lints\"\n //@normalize-stderr-test: \"'rustc'\" -> \"'<unnamed>'\"\n-//@normalize-stderr-test: \"running on .*\" -> \"running on <target>\"\n+//@normalize-stderr-test: \"rustc 1\\.\\d+.* running on .*\" -> \"rustc <version> running on <target>\"\n //@normalize-stderr-test: \"(?ms)query stack during panic:\\n.*end of query stack\\n\" -> \"\"\n \n #![deny(clippy::internal)]"}, {"sha": "b9ea5a64de75e680df11bdcf92d6ff6f5a1a911e", "filename": "tests/ui-internal/custom_ice_message.stderr", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-internal%2Fcustom_ice_message.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-internal%2Fcustom_ice_message.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fcustom_ice_message.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -5,10 +5,9 @@ error: the compiler unexpectedly panicked. this is a bug.\n \n note: we would appreciate a bug report: https://github.com/rust-lang/rust-clippy/issues/new\n \n-note: rustc 1.71.0-nightly (521f4dae1 2023-05-19) running on <target>\n+note: rustc <version> running on <target>\n \n note: compiler flags: -C prefer-dynamic -Z ui-testing\n \n-note: Clippy version: foo\n-\n-thread panicked while panicking. aborting.\n+query stack during panic:\n+thread panicked while processing panic. aborting."}, {"sha": "4882416c414ac976dd975a9d4e688f92b6a0bf17", "filename": "tests/ui-toml/ifs_same_cond/ifs_same_cond.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-toml%2Fifs_same_cond%2Fifs_same_cond.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui-toml%2Fifs_same_cond%2Fifs_same_cond.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-toml%2Fifs_same_cond%2Fifs_same_cond.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,5 +1,5 @@\n #![warn(clippy::ifs_same_cond)]\n-#![allow(clippy::if_same_then_else, clippy::comparison_chain)]\n+#![allow(clippy::if_same_then_else, clippy::comparison_chain, clippy::needless_else)]\n \n fn main() {}\n "}, {"sha": "44f49c080cdd6fdcb901c8b4948782a9f10b367c", "filename": "tests/ui/auxiliary/wildcard_imports_helper.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fauxiliary%2Fwildcard_imports_helper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fauxiliary%2Fwildcard_imports_helper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauxiliary%2Fwildcard_imports_helper.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -25,3 +25,9 @@ pub mod prelude {\n         pub struct PreludeModAnywhere;\n     }\n }\n+\n+pub mod extern_prelude {\n+    pub mod v1 {\n+        pub struct ExternPreludeModAnywhere;\n+    }\n+}"}, {"sha": "5780ea0893777fefee8a2d3aeeb6d9e1722639d3", "filename": "tests/ui/branches_sharing_code/valid_if_blocks.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fbranches_sharing_code%2Fvalid_if_blocks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fbranches_sharing_code%2Fvalid_if_blocks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbranches_sharing_code%2Fvalid_if_blocks.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,6 +1,10 @@\n #![deny(clippy::branches_sharing_code, clippy::if_same_then_else)]\n #![allow(dead_code)]\n-#![allow(clippy::mixed_read_write_in_expression, clippy::uninlined_format_args)]\n+#![allow(\n+    clippy::mixed_read_write_in_expression,\n+    clippy::uninlined_format_args,\n+    clippy::needless_else\n+)]\n \n // This tests valid if blocks that shouldn't trigger the lint\n "}, {"sha": "a7e72b780affcc95030b1cf27299f97764280d2a", "filename": "tests/ui/branches_sharing_code/valid_if_blocks.stderr", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fbranches_sharing_code%2Fvalid_if_blocks.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fbranches_sharing_code%2Fvalid_if_blocks.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbranches_sharing_code%2Fvalid_if_blocks.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,13 +1,13 @@\n error: this `if` has identical blocks\n-  --> $DIR/valid_if_blocks.rs:105:14\n+  --> $DIR/valid_if_blocks.rs:109:14\n    |\n LL |       if false {\n    |  ______________^\n LL | |     } else {\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/valid_if_blocks.rs:106:12\n+  --> $DIR/valid_if_blocks.rs:110:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -20,7 +20,7 @@ LL | #![deny(clippy::branches_sharing_code, clippy::if_same_then_else)]\n    |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: this `if` has identical blocks\n-  --> $DIR/valid_if_blocks.rs:116:15\n+  --> $DIR/valid_if_blocks.rs:120:15\n    |\n LL |       if x == 0 {\n    |  _______________^\n@@ -31,7 +31,7 @@ LL | |     } else {\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/valid_if_blocks.rs:120:12\n+  --> $DIR/valid_if_blocks.rs:124:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -42,19 +42,19 @@ LL | |     }\n    | |_____^\n \n error: this `if` has identical blocks\n-  --> $DIR/valid_if_blocks.rs:127:23\n+  --> $DIR/valid_if_blocks.rs:131:23\n    |\n LL |     let _ = if x == 6 { 7 } else { 7 };\n    |                       ^^^^^\n    |\n note: same as this\n-  --> $DIR/valid_if_blocks.rs:127:34\n+  --> $DIR/valid_if_blocks.rs:131:34\n    |\n LL |     let _ = if x == 6 { 7 } else { 7 };\n    |                                  ^^^^^\n \n error: this `if` has identical blocks\n-  --> $DIR/valid_if_blocks.rs:133:23\n+  --> $DIR/valid_if_blocks.rs:137:23\n    |\n LL |       } else if x == 68 {\n    |  _______________________^\n@@ -66,7 +66,7 @@ LL | |     } else {\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/valid_if_blocks.rs:138:12\n+  --> $DIR/valid_if_blocks.rs:142:12\n    |\n LL |       } else {\n    |  ____________^\n@@ -78,7 +78,7 @@ LL | |     };\n    | |_____^\n \n error: this `if` has identical blocks\n-  --> $DIR/valid_if_blocks.rs:147:23\n+  --> $DIR/valid_if_blocks.rs:151:23\n    |\n LL |       } else if x == 68 {\n    |  _______________________^\n@@ -88,7 +88,7 @@ LL | |     } else {\n    | |_____^\n    |\n note: same as this\n-  --> $DIR/valid_if_blocks.rs:150:12\n+  --> $DIR/valid_if_blocks.rs:154:12\n    |\n LL |       } else {\n    |  ____________^"}, {"sha": "a5373cdcae1208edeea4776659419446a45f2d30", "filename": "tests/ui/crashes/ice-7410.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fcrashes%2Fice-7410.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fcrashes%2Fice-7410.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-7410.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -6,6 +6,7 @@\n #![no_std]\n #![allow(clippy::if_same_then_else)]\n #![allow(clippy::redundant_pattern_matching)]\n+#![allow(clippy::needless_else)]\n \n use core::panic::PanicInfo;\n "}, {"sha": "ac5fe38ff4439068254b93e79a290d28aad982a5", "filename": "tests/ui/default_constructed_unit_structs.fixed", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fdefault_constructed_unit_structs.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fdefault_constructed_unit_structs.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_constructed_unit_structs.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -101,6 +101,28 @@ struct EmptyStruct {}\n #[non_exhaustive]\n struct NonExhaustiveStruct;\n \n+mod issue_10755 {\n+    struct Sqlite {}\n+\n+    trait HasArguments<'q> {\n+        type Arguments;\n+    }\n+\n+    impl<'q> HasArguments<'q> for Sqlite {\n+        type Arguments = std::marker::PhantomData<&'q ()>;\n+    }\n+\n+    type SqliteArguments<'q> = <Sqlite as HasArguments<'q>>::Arguments;\n+\n+    fn foo() {\n+        // should not lint\n+        // type alias cannot be used as a constructor\n+        let _ = <Sqlite as HasArguments>::Arguments::default();\n+\n+        let _ = SqliteArguments::default();\n+    }\n+}\n+\n fn main() {\n     // should lint\n     let _ = PhantomData::<usize>;"}, {"sha": "de7f14ffbd95c393a8ebca68b3ab020adb9b511e", "filename": "tests/ui/default_constructed_unit_structs.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fdefault_constructed_unit_structs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fdefault_constructed_unit_structs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_constructed_unit_structs.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -101,6 +101,28 @@ struct EmptyStruct {}\n #[non_exhaustive]\n struct NonExhaustiveStruct;\n \n+mod issue_10755 {\n+    struct Sqlite {}\n+\n+    trait HasArguments<'q> {\n+        type Arguments;\n+    }\n+\n+    impl<'q> HasArguments<'q> for Sqlite {\n+        type Arguments = std::marker::PhantomData<&'q ()>;\n+    }\n+\n+    type SqliteArguments<'q> = <Sqlite as HasArguments<'q>>::Arguments;\n+\n+    fn foo() {\n+        // should not lint\n+        // type alias cannot be used as a constructor\n+        let _ = <Sqlite as HasArguments>::Arguments::default();\n+\n+        let _ = SqliteArguments::default();\n+    }\n+}\n+\n fn main() {\n     // should lint\n     let _ = PhantomData::<usize>::default();"}, {"sha": "13abb9149da246b853a6466181b9223fa78891c2", "filename": "tests/ui/default_constructed_unit_structs.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fdefault_constructed_unit_structs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fdefault_constructed_unit_structs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_constructed_unit_structs.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -13,25 +13,25 @@ LL |             inner: PhantomData::default(),\n    |                               ^^^^^^^^^^^ help: remove this call to `default`\n \n error: use of `default` to create a unit struct\n-  --> $DIR/default_constructed_unit_structs.rs:106:33\n+  --> $DIR/default_constructed_unit_structs.rs:128:33\n    |\n LL |     let _ = PhantomData::<usize>::default();\n    |                                 ^^^^^^^^^^^ help: remove this call to `default`\n \n error: use of `default` to create a unit struct\n-  --> $DIR/default_constructed_unit_structs.rs:107:42\n+  --> $DIR/default_constructed_unit_structs.rs:129:42\n    |\n LL |     let _: PhantomData<i32> = PhantomData::default();\n    |                                          ^^^^^^^^^^^ help: remove this call to `default`\n \n error: use of `default` to create a unit struct\n-  --> $DIR/default_constructed_unit_structs.rs:108:55\n+  --> $DIR/default_constructed_unit_structs.rs:130:55\n    |\n LL |     let _: PhantomData<i32> = std::marker::PhantomData::default();\n    |                                                       ^^^^^^^^^^^ help: remove this call to `default`\n \n error: use of `default` to create a unit struct\n-  --> $DIR/default_constructed_unit_structs.rs:109:23\n+  --> $DIR/default_constructed_unit_structs.rs:131:23\n    |\n LL |     let _ = UnitStruct::default();\n    |                       ^^^^^^^^^^^ help: remove this call to `default`"}, {"sha": "843e1df8bc6bbf77d73c70f67e0f8ca45948ad6e", "filename": "tests/ui/derive.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fderive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fderive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderive.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,7 +1,6 @@\n #![allow(dead_code)]\n #![warn(clippy::expl_impl_clone_on_copy)]\n \n-\n #[derive(Copy)]\n struct Qux;\n "}, {"sha": "d37f7fa73319679e97a2c61f67cfae6cd3eee762", "filename": "tests/ui/derive.stderr", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fderive.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fderive.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderive.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,5 +1,5 @@\n error: you are implementing `Clone` explicitly on a `Copy` type\n-  --> $DIR/derive.rs:8:1\n+  --> $DIR/derive.rs:7:1\n    |\n LL | / impl Clone for Qux {\n LL | |     fn clone(&self) -> Self {\n@@ -9,7 +9,7 @@ LL | | }\n    | |_^\n    |\n note: consider deriving `Clone` or removing `Copy`\n-  --> $DIR/derive.rs:8:1\n+  --> $DIR/derive.rs:7:1\n    |\n LL | / impl Clone for Qux {\n LL | |     fn clone(&self) -> Self {\n@@ -20,7 +20,7 @@ LL | | }\n    = note: `-D clippy::expl-impl-clone-on-copy` implied by `-D warnings`\n \n error: you are implementing `Clone` explicitly on a `Copy` type\n-  --> $DIR/derive.rs:32:1\n+  --> $DIR/derive.rs:31:1\n    |\n LL | / impl<'a> Clone for Lt<'a> {\n LL | |     fn clone(&self) -> Self {\n@@ -30,7 +30,7 @@ LL | | }\n    | |_^\n    |\n note: consider deriving `Clone` or removing `Copy`\n-  --> $DIR/derive.rs:32:1\n+  --> $DIR/derive.rs:31:1\n    |\n LL | / impl<'a> Clone for Lt<'a> {\n LL | |     fn clone(&self) -> Self {\n@@ -40,7 +40,7 @@ LL | | }\n    | |_^\n \n error: you are implementing `Clone` explicitly on a `Copy` type\n-  --> $DIR/derive.rs:43:1\n+  --> $DIR/derive.rs:42:1\n    |\n LL | / impl Clone for BigArray {\n LL | |     fn clone(&self) -> Self {\n@@ -50,7 +50,7 @@ LL | | }\n    | |_^\n    |\n note: consider deriving `Clone` or removing `Copy`\n-  --> $DIR/derive.rs:43:1\n+  --> $DIR/derive.rs:42:1\n    |\n LL | / impl Clone for BigArray {\n LL | |     fn clone(&self) -> Self {\n@@ -60,7 +60,7 @@ LL | | }\n    | |_^\n \n error: you are implementing `Clone` explicitly on a `Copy` type\n-  --> $DIR/derive.rs:54:1\n+  --> $DIR/derive.rs:53:1\n    |\n LL | / impl Clone for FnPtr {\n LL | |     fn clone(&self) -> Self {\n@@ -70,7 +70,7 @@ LL | | }\n    | |_^\n    |\n note: consider deriving `Clone` or removing `Copy`\n-  --> $DIR/derive.rs:54:1\n+  --> $DIR/derive.rs:53:1\n    |\n LL | / impl Clone for FnPtr {\n LL | |     fn clone(&self) -> Self {\n@@ -80,7 +80,7 @@ LL | | }\n    | |_^\n \n error: you are implementing `Clone` explicitly on a `Copy` type\n-  --> $DIR/derive.rs:74:1\n+  --> $DIR/derive.rs:73:1\n    |\n LL | / impl<T: Clone> Clone for Generic2<T> {\n LL | |     fn clone(&self) -> Self {\n@@ -90,7 +90,7 @@ LL | | }\n    | |_^\n    |\n note: consider deriving `Clone` or removing `Copy`\n-  --> $DIR/derive.rs:74:1\n+  --> $DIR/derive.rs:73:1\n    |\n LL | / impl<T: Clone> Clone for Generic2<T> {\n LL | |     fn clone(&self) -> Self {"}, {"sha": "018f875d60bfa24ec5fd1a625b84d7cb9c457e66", "filename": "tests/ui/expect_tool_lint_rfc_2383.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fexpect_tool_lint_rfc_2383.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fexpect_tool_lint_rfc_2383.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexpect_tool_lint_rfc_2383.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -22,9 +22,9 @@ mod rustc_ok {\n \n         #[expect(illegal_floating_point_literal_pattern)]\n         match x {\n-            5.0 => {}\n-            6.0 => {}\n-            _ => {}\n+            5.0 => {},\n+            6.0 => {},\n+            _ => {},\n         }\n     }\n }\n@@ -38,9 +38,9 @@ mod rustc_warn {\n \n         #[expect(illegal_floating_point_literal_pattern)]\n         match x {\n-            5 => {}\n-            6 => {}\n-            _ => {}\n+            5 => {},\n+            6 => {},\n+            _ => {},\n         }\n     }\n }"}, {"sha": "f62da157d1b94b11a37fc7467969be40601348ce", "filename": "tests/ui/ifs_same_cond.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fifs_same_cond.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fifs_same_cond.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fifs_same_cond.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,5 +1,5 @@\n #![warn(clippy::ifs_same_cond)]\n-#![allow(clippy::if_same_then_else, clippy::comparison_chain)] // all empty blocks\n+#![allow(clippy::if_same_then_else, clippy::comparison_chain, clippy::needless_else)] // all empty blocks\n \n fn ifs_same_cond() {\n     let a = 0;"}, {"sha": "3e9d5e6a4ca320f00ab1fe26bdf07a2554a6031c", "filename": "tests/ui/large_stack_arrays.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Flarge_stack_arrays.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Flarge_stack_arrays.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flarge_stack_arrays.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -18,6 +18,19 @@ pub static DOESNOTLINT2: [u8; 512_001] = {\n     [x; 512_001]\n };\n \n+fn issue_10741() {\n+    #[derive(Copy, Clone)]\n+    struct Large([u32; 100_000]);\n+\n+    fn build() -> Large {\n+        Large([0; 100_000])\n+    }\n+\n+    let _x = [build(); 3];\n+\n+    let _y = [build(), build(), build()];\n+}\n+\n fn main() {\n     let bad = (\n         [0u32; 20_000_000],"}, {"sha": "118d39566abee36e56fe7589847a2163e801e140", "filename": "tests/ui/large_stack_arrays.stderr", "status": "modified", "additions": 23, "deletions": 7, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Flarge_stack_arrays.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Flarge_stack_arrays.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flarge_stack_arrays.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,43 +1,59 @@\n error: allocating a local array larger than 512000 bytes\n-  --> $DIR/large_stack_arrays.rs:23:9\n+  --> $DIR/large_stack_arrays.rs:29:14\n+   |\n+LL |     let _x = [build(); 3];\n+   |              ^^^^^^^^^^^^\n+   |\n+   = help: consider allocating on the heap with `vec![build(); 3].into_boxed_slice()`\n+   = note: `-D clippy::large-stack-arrays` implied by `-D warnings`\n+\n+error: allocating a local array larger than 512000 bytes\n+  --> $DIR/large_stack_arrays.rs:31:14\n+   |\n+LL |     let _y = [build(), build(), build()];\n+   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider allocating on the heap with `vec![build(), build(), build()].into_boxed_slice()`\n+\n+error: allocating a local array larger than 512000 bytes\n+  --> $DIR/large_stack_arrays.rs:36:9\n    |\n LL |         [0u32; 20_000_000],\n    |         ^^^^^^^^^^^^^^^^^^\n    |\n    = help: consider allocating on the heap with `vec![0u32; 20_000_000].into_boxed_slice()`\n-   = note: `-D clippy::large-stack-arrays` implied by `-D warnings`\n \n error: allocating a local array larger than 512000 bytes\n-  --> $DIR/large_stack_arrays.rs:24:9\n+  --> $DIR/large_stack_arrays.rs:37:9\n    |\n LL |         [S { data: [0; 32] }; 5000],\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: consider allocating on the heap with `vec![S { data: [0; 32] }; 5000].into_boxed_slice()`\n \n error: allocating a local array larger than 512000 bytes\n-  --> $DIR/large_stack_arrays.rs:25:9\n+  --> $DIR/large_stack_arrays.rs:38:9\n    |\n LL |         [Some(\"\"); 20_000_000],\n    |         ^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: consider allocating on the heap with `vec![Some(\"\"); 20_000_000].into_boxed_slice()`\n \n error: allocating a local array larger than 512000 bytes\n-  --> $DIR/large_stack_arrays.rs:26:9\n+  --> $DIR/large_stack_arrays.rs:39:9\n    |\n LL |         [E::T(0); 5000],\n    |         ^^^^^^^^^^^^^^^\n    |\n    = help: consider allocating on the heap with `vec![E::T(0); 5000].into_boxed_slice()`\n \n error: allocating a local array larger than 512000 bytes\n-  --> $DIR/large_stack_arrays.rs:27:9\n+  --> $DIR/large_stack_arrays.rs:40:9\n    |\n LL |         [0u8; usize::MAX],\n    |         ^^^^^^^^^^^^^^^^^\n    |\n    = help: consider allocating on the heap with `vec![0u8; usize::MAX].into_boxed_slice()`\n \n-error: aborting due to 5 previous errors\n+error: aborting due to 7 previous errors\n "}, {"sha": "351ea0e4f509ea9919fc00ab392816d694d4c820", "filename": "tests/ui/manual_let_else.rs", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_let_else.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -146,10 +146,20 @@ fn fire() {\n         Variant::A(0, 0)\n     }\n \n-    // Should not be renamed\n     let v = if let Variant::A(a, 0) = e() { a } else { return };\n-    // Should be renamed\n-    let v = if let Variant::B(b) = e() { b } else { return };\n+\n+    // `mut v` is inserted into the pattern\n+    let mut v = if let Variant::B(b) = e() { b } else { return };\n+\n+    // Nesting works\n+    let nested = Ok(Some(e()));\n+    let v = if let Ok(Some(Variant::B(b))) | Err(Some(Variant::A(b, _))) = nested {\n+        b\n+    } else {\n+        return;\n+    };\n+    // dot dot works\n+    let v = if let Variant::A(.., a) = e() { a } else { return };\n }\n \n fn not_fire() {"}, {"sha": "0e876797134746dc3bafb84959730d6e6b017eae", "filename": "tests/ui/manual_let_else.stderr", "status": "modified", "additions": 29, "deletions": 6, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_let_else.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -260,25 +260,48 @@ LL |     create_binding_if_some!(w, g());\n    = note: this error originates in the macro `create_binding_if_some` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: this could be rewritten as `let...else`\n-  --> $DIR/manual_let_else.rs:150:5\n+  --> $DIR/manual_let_else.rs:149:5\n    |\n LL |     let v = if let Variant::A(a, 0) = e() { a } else { return };\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider writing: `let Variant::A(a, 0) = e() else { return };`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider writing: `let Variant::A(v, 0) = e() else { return };`\n \n error: this could be rewritten as `let...else`\n   --> $DIR/manual_let_else.rs:152:5\n    |\n-LL |     let v = if let Variant::B(b) = e() { b } else { return };\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider writing: `let Variant::B(v) = e() else { return };`\n+LL |     let mut v = if let Variant::B(b) = e() { b } else { return };\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider writing: `let Variant::B(mut v) = e() else { return };`\n \n error: this could be rewritten as `let...else`\n-  --> $DIR/manual_let_else.rs:262:5\n+  --> $DIR/manual_let_else.rs:156:5\n+   |\n+LL | /     let v = if let Ok(Some(Variant::B(b))) | Err(Some(Variant::A(b, _))) = nested {\n+LL | |         b\n+LL | |     } else {\n+LL | |         return;\n+LL | |     };\n+   | |______^\n+   |\n+help: consider writing\n+   |\n+LL ~     let (Ok(Some(Variant::B(v))) | Err(Some(Variant::A(v, _)))) = nested else {\n+LL +         return;\n+LL +     };\n+   |\n+\n+error: this could be rewritten as `let...else`\n+  --> $DIR/manual_let_else.rs:162:5\n+   |\n+LL |     let v = if let Variant::A(.., a) = e() { a } else { return };\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider writing: `let Variant::A(.., v) = e() else { return };`\n+\n+error: this could be rewritten as `let...else`\n+  --> $DIR/manual_let_else.rs:272:5\n    |\n LL | /     let _ = match ff {\n LL | |         Some(value) => value,\n LL | |         _ => macro_call!(),\n LL | |     };\n    | |______^ help: consider writing: `let Some(_) = ff else { macro_call!() };`\n \n-error: aborting due to 20 previous errors\n+error: aborting due to 22 previous errors\n "}, {"sha": "dfca3b023cd58259d7e7d683c40266d82a56bc60", "filename": "tests/ui/manual_let_else_match.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_let_else_match.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -68,7 +68,7 @@ fn fire() {\n     let f = Variant::Bar(1);\n \n     let _value = match f {\n-        Variant::Bar(_) | Variant::Baz(_) => (),\n+        Variant::Bar(v) | Variant::Baz(v) => v,\n         _ => return,\n     };\n "}, {"sha": "13ed35bc1d5dbdb8896ae018ce754ac756afc85e", "filename": "tests/ui/manual_let_else_match.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else_match.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmanual_let_else_match.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_let_else_match.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -58,10 +58,10 @@ error: this could be rewritten as `let...else`\n   --> $DIR/manual_let_else_match.rs:70:5\n    |\n LL | /     let _value = match f {\n-LL | |         Variant::Bar(_) | Variant::Baz(_) => (),\n+LL | |         Variant::Bar(v) | Variant::Baz(v) => v,\n LL | |         _ => return,\n LL | |     };\n-   | |______^ help: consider writing: `let (Variant::Bar(_) | Variant::Baz(_)) = f else { return };`\n+   | |______^ help: consider writing: `let (Variant::Bar(_value) | Variant::Baz(_value)) = f else { return };`\n \n error: this could be rewritten as `let...else`\n   --> $DIR/manual_let_else_match.rs:76:5"}, {"sha": "5a552e4ae51a5419904f9ee76fbd9621278bb548", "filename": "tests/ui/match_wild_err_arm.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmatch_wild_err_arm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmatch_wild_err_arm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_wild_err_arm.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,7 +1,20 @@\n #![feature(exclusive_range_pattern)]\n-#![allow(clippy::match_same_arms)]\n+#![allow(clippy::match_same_arms, dead_code)]\n #![warn(clippy::match_wild_err_arm)]\n \n+fn issue_10635() {\n+    enum Error {\n+        A,\n+        B,\n+    }\n+\n+    // Don't trigger in const contexts. Const unwrap is not yet stable\n+    const X: () = match Ok::<_, Error>(()) {\n+        Ok(x) => x,\n+        Err(_) => panic!(),\n+    };\n+}\n+\n fn match_wild_err_arm() {\n     let x: Result<i32, &str> = Ok(3);\n "}, {"sha": "a9f54feacdb5872bc8a2b396b401facbc95b207d", "filename": "tests/ui/match_wild_err_arm.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmatch_wild_err_arm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmatch_wild_err_arm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_wild_err_arm.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,5 +1,5 @@\n error: `Err(_)` matches all errors\n-  --> $DIR/match_wild_err_arm.rs:11:9\n+  --> $DIR/match_wild_err_arm.rs:24:9\n    |\n LL |         Err(_) => panic!(\"err\"),\n    |         ^^^^^^\n@@ -8,23 +8,23 @@ LL |         Err(_) => panic!(\"err\"),\n    = note: `-D clippy::match-wild-err-arm` implied by `-D warnings`\n \n error: `Err(_)` matches all errors\n-  --> $DIR/match_wild_err_arm.rs:17:9\n+  --> $DIR/match_wild_err_arm.rs:30:9\n    |\n LL |         Err(_) => panic!(),\n    |         ^^^^^^\n    |\n    = note: match each error separately or use the error output, or use `.expect(msg)` if the error case is unreachable\n \n error: `Err(_)` matches all errors\n-  --> $DIR/match_wild_err_arm.rs:23:9\n+  --> $DIR/match_wild_err_arm.rs:36:9\n    |\n LL |         Err(_) => {\n    |         ^^^^^^\n    |\n    = note: match each error separately or use the error output, or use `.expect(msg)` if the error case is unreachable\n \n error: `Err(_e)` matches all errors\n-  --> $DIR/match_wild_err_arm.rs:31:9\n+  --> $DIR/match_wild_err_arm.rs:44:9\n    |\n LL |         Err(_e) => panic!(),\n    |         ^^^^^^^"}, {"sha": "c156d394eceaaf8c045fe9a551f1b698d4b22b60", "filename": "tests/ui/missing_fields_in_debug.rs", "status": "added", "additions": 191, "deletions": 0, "changes": 191, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmissing_fields_in_debug.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmissing_fields_in_debug.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing_fields_in_debug.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,191 @@\n+#![allow(unused)]\n+#![warn(clippy::missing_fields_in_debug)]\n+\n+use std::fmt;\n+use std::marker::PhantomData;\n+use std::ops::Deref;\n+\n+struct NamedStruct1Ignored {\n+    data: u8,\n+    hidden: u32,\n+}\n+\n+impl fmt::Debug for NamedStruct1Ignored {\n+    // unused field: hidden\n+    fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        formatter\n+            .debug_struct(\"NamedStruct1Ignored\")\n+            .field(\"data\", &self.data)\n+            .finish()\n+    }\n+}\n+\n+struct NamedStructMultipleIgnored {\n+    data: u8,\n+    hidden: u32,\n+    hidden2: String,\n+    hidden3: Vec<Vec<i32>>,\n+    hidden4: ((((u8), u16), u32), u64),\n+}\n+\n+impl fmt::Debug for NamedStructMultipleIgnored {\n+    // unused fields: hidden, hidden2, hidden4\n+    fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        formatter\n+            .debug_struct(\"NamedStructMultipleIgnored\")\n+            .field(\"data\", &self.data)\n+            .field(\"hidden3\", &self.hidden3)\n+            .finish()\n+    }\n+}\n+\n+struct Unit;\n+\n+// ok\n+impl fmt::Debug for Unit {\n+    fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        formatter.debug_struct(\"Unit\").finish()\n+    }\n+}\n+\n+struct UnnamedStruct1Ignored(String);\n+\n+impl fmt::Debug for UnnamedStruct1Ignored {\n+    fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        formatter.debug_tuple(\"UnnamedStruct1Ignored\").finish()\n+    }\n+}\n+\n+struct UnnamedStructMultipleIgnored(String, Vec<u8>, i32);\n+\n+// tuple structs are not linted\n+impl fmt::Debug for UnnamedStructMultipleIgnored {\n+    fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        formatter\n+            .debug_tuple(\"UnnamedStructMultipleIgnored\")\n+            .field(&self.1)\n+            .finish()\n+    }\n+}\n+\n+struct NamedStructNonExhaustive {\n+    a: u8,\n+    b: String,\n+}\n+\n+// ok\n+impl fmt::Debug for NamedStructNonExhaustive {\n+    fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        formatter\n+            .debug_struct(\"NamedStructNonExhaustive\")\n+            .field(\"a\", &self.a)\n+            .finish_non_exhaustive() // should not warn here\n+    }\n+}\n+\n+struct MultiExprDebugImpl {\n+    a: u8,\n+    b: String,\n+}\n+\n+// ok\n+impl fmt::Debug for MultiExprDebugImpl {\n+    fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        let mut f = formatter.debug_struct(\"MultiExprDebugImpl\");\n+        f.field(\"a\", &self.a);\n+        f.finish()\n+    }\n+}\n+\n+#[derive(Debug)]\n+struct DerivedStruct {\n+    a: u8,\n+    b: i32,\n+}\n+\n+// https://github.com/rust-lang/rust-clippy/pull/10616#discussion_r1166846953\n+\n+struct Inner {\n+    a: usize,\n+    b: usize,\n+}\n+\n+struct HasInner {\n+    inner: Inner,\n+}\n+\n+impl HasInner {\n+    fn get(&self) -> &Inner {\n+        &self.inner\n+    }\n+}\n+\n+impl fmt::Debug for HasInner {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        let inner = self.get();\n+\n+        f.debug_struct(\"HasInner\")\n+            .field(\"a\", &inner.a)\n+            .field(\"b\", &inner.b)\n+            .finish()\n+    }\n+}\n+\n+// https://github.com/rust-lang/rust-clippy/pull/10616#discussion_r1170306053\n+struct Foo {\n+    a: u8,\n+    b: u8,\n+}\n+\n+impl fmt::Debug for Foo {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        f.debug_struct(\"Foo\").field(\"a\", &self.a).field(\"b\", &()).finish()\n+    }\n+}\n+\n+// https://github.com/rust-lang/rust-clippy/pull/10616#discussion_r1175473620\n+mod comment1175473620 {\n+    use super::*;\n+\n+    struct Inner {\n+        a: usize,\n+        b: usize,\n+    }\n+    struct Wrapper(Inner);\n+\n+    impl Deref for Wrapper {\n+        type Target = Inner;\n+\n+        fn deref(&self) -> &Self::Target {\n+            &self.0\n+        }\n+    }\n+\n+    impl fmt::Debug for Wrapper {\n+        fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+            f.debug_struct(\"Wrapper\")\n+                .field(\"a\", &self.a)\n+                .field(\"b\", &self.b)\n+                .finish()\n+        }\n+    }\n+}\n+\n+// https://github.com/rust-lang/rust-clippy/pull/10616#discussion_r1175488757\n+// PhantomData is an exception and does not need to be included\n+struct WithPD {\n+    a: u8,\n+    b: u8,\n+    c: PhantomData<String>,\n+}\n+\n+impl fmt::Debug for WithPD {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        f.debug_struct(\"WithPD\")\n+            .field(\"a\", &self.a)\n+            .field(\"b\", &self.b)\n+            .finish()\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "ef9d02abab7dbf1ff2bee7120560bc5dadf030b3", "filename": "tests/ui/missing_fields_in_debug.stderr", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmissing_fields_in_debug.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fmissing_fields_in_debug.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing_fields_in_debug.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,73 @@\n+error: manual `Debug` impl does not include all fields\n+  --> $DIR/missing_fields_in_debug.rs:13:1\n+   |\n+LL | / impl fmt::Debug for NamedStruct1Ignored {\n+LL | |     // unused field: hidden\n+LL | |     fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+LL | |         formatter\n+...  |\n+LL | |     }\n+LL | | }\n+   | |_^\n+   |\n+note: this field is unused\n+  --> $DIR/missing_fields_in_debug.rs:10:5\n+   |\n+LL |     hidden: u32,\n+   |     ^^^^^^^^^^^\n+   = help: consider including all fields in this `Debug` impl\n+   = help: consider calling `.finish_non_exhaustive()` if you intend to ignore fields\n+   = note: `-D clippy::missing-fields-in-debug` implied by `-D warnings`\n+\n+error: manual `Debug` impl does not include all fields\n+  --> $DIR/missing_fields_in_debug.rs:31:1\n+   |\n+LL | / impl fmt::Debug for NamedStructMultipleIgnored {\n+LL | |     // unused fields: hidden, hidden2, hidden4\n+LL | |     fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+LL | |         formatter\n+...  |\n+LL | |     }\n+LL | | }\n+   | |_^\n+   |\n+note: this field is unused\n+  --> $DIR/missing_fields_in_debug.rs:25:5\n+   |\n+LL |     hidden: u32,\n+   |     ^^^^^^^^^^^\n+note: this field is unused\n+  --> $DIR/missing_fields_in_debug.rs:26:5\n+   |\n+LL |     hidden2: String,\n+   |     ^^^^^^^^^^^^^^^\n+note: this field is unused\n+  --> $DIR/missing_fields_in_debug.rs:28:5\n+   |\n+LL |     hidden4: ((((u8), u16), u32), u64),\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   = help: consider including all fields in this `Debug` impl\n+   = help: consider calling `.finish_non_exhaustive()` if you intend to ignore fields\n+\n+error: manual `Debug` impl does not include all fields\n+  --> $DIR/missing_fields_in_debug.rs:92:1\n+   |\n+LL | / impl fmt::Debug for MultiExprDebugImpl {\n+LL | |     fn fmt(&self, formatter: &mut fmt::Formatter<'_>) -> fmt::Result {\n+LL | |         let mut f = formatter.debug_struct(\"MultiExprDebugImpl\");\n+LL | |         f.field(\"a\", &self.a);\n+LL | |         f.finish()\n+LL | |     }\n+LL | | }\n+   | |_^\n+   |\n+note: this field is unused\n+  --> $DIR/missing_fields_in_debug.rs:88:5\n+   |\n+LL |     b: String,\n+   |     ^^^^^^^^^\n+   = help: consider including all fields in this `Debug` impl\n+   = help: consider calling `.finish_non_exhaustive()` if you intend to ignore fields\n+\n+error: aborting due to 3 previous errors\n+"}, {"sha": "06a16162790cc63faf41d39e8bdf45cbb77ef610", "filename": "tests/ui/needless_else.fixed", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_else.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_else.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_else.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,57 @@\n+//@run-rustfix\n+#![allow(unused)]\n+#![warn(clippy::needless_else)]\n+#![allow(clippy::suspicious_else_formatting)]\n+\n+macro_rules! mac {\n+    ($test:expr) => {\n+        if $test {\n+            println!(\"Test successful!\");\n+        } else {\n+        }\n+    };\n+}\n+\n+macro_rules! empty_expansion {\n+    () => {};\n+}\n+\n+fn main() {\n+    let b = std::hint::black_box(true);\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } \n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else {\n+        // Do not lint because this comment might be important\n+    }\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else\n+    /* Do not lint because this comment might be important */\n+    {\n+    }\n+\n+    // Do not lint because of the expression\n+    let _ = if b { 1 } else { 2 };\n+\n+    // Do not lint because inside a macro\n+    mac!(b);\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else {\n+        #[cfg(foo)]\n+        \"Do not lint cfg'd out code\"\n+    }\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else {\n+        empty_expansion!();\n+    }\n+}"}, {"sha": "728032c47a66b23b68e63afb4f92b9ca77c126d2", "filename": "tests/ui/needless_else.rs", "status": "added", "additions": 58, "deletions": 0, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_else.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,58 @@\n+//@run-rustfix\n+#![allow(unused)]\n+#![warn(clippy::needless_else)]\n+#![allow(clippy::suspicious_else_formatting)]\n+\n+macro_rules! mac {\n+    ($test:expr) => {\n+        if $test {\n+            println!(\"Test successful!\");\n+        } else {\n+        }\n+    };\n+}\n+\n+macro_rules! empty_expansion {\n+    () => {};\n+}\n+\n+fn main() {\n+    let b = std::hint::black_box(true);\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else {\n+    }\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else {\n+        // Do not lint because this comment might be important\n+    }\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else\n+    /* Do not lint because this comment might be important */\n+    {\n+    }\n+\n+    // Do not lint because of the expression\n+    let _ = if b { 1 } else { 2 };\n+\n+    // Do not lint because inside a macro\n+    mac!(b);\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else {\n+        #[cfg(foo)]\n+        \"Do not lint cfg'd out code\"\n+    }\n+\n+    if b {\n+        println!(\"Foobar\");\n+    } else {\n+        empty_expansion!();\n+    }\n+}"}, {"sha": "ea693085164499db07d5dfcbc2ac62d0231740f8", "filename": "tests/ui/needless_else.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_else.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_else.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_else.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,12 @@\n+error: this else branch is empty\n+  --> $DIR/needless_else.rs:24:7\n+   |\n+LL |       } else {\n+   |  _______^\n+LL | |     }\n+   | |_____^ help: you can remove it\n+   |\n+   = note: `-D clippy::needless-else` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}, {"sha": "4dabf313963dee1e3b3fbd8da683792bdd2b4958", "filename": "tests/ui/needless_return.fixed", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_return.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_return.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_return.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -7,7 +7,8 @@\n     clippy::if_same_then_else,\n     clippy::single_match,\n     clippy::needless_bool,\n-    clippy::equatable_if_let\n+    clippy::equatable_if_let,\n+    clippy::needless_else\n )]\n #![warn(clippy::needless_return)]\n "}, {"sha": "542f562b314969aeb1cb0108e9f23cf7772b3c50", "filename": "tests/ui/needless_return.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_return.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -7,7 +7,8 @@\n     clippy::if_same_then_else,\n     clippy::single_match,\n     clippy::needless_bool,\n-    clippy::equatable_if_let\n+    clippy::equatable_if_let,\n+    clippy::needless_else\n )]\n #![warn(clippy::needless_return)]\n "}, {"sha": "1d9d23d30083ca31e155cb29d9805a3e2176e56a", "filename": "tests/ui/needless_return.stderr", "status": "modified", "additions": 322, "deletions": 104, "changes": 426, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_return.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fneedless_return.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_return.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,438 +1,656 @@\n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:27:5\n+  --> $DIR/needless_return.rs:28:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n    |\n    = note: `-D clippy::needless-return` implied by `-D warnings`\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return true;\n+LL +     true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:31:5\n+  --> $DIR/needless_return.rs:32:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return true;\n+LL +     true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:36:5\n+  --> $DIR/needless_return.rs:37:5\n    |\n LL |     return true;;;\n    |     ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return true;;;\n+LL +     true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:41:5\n+  --> $DIR/needless_return.rs:42:5\n    |\n LL |     return true;; ; ;\n    |     ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return true;; ; ;\n+LL +     true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:46:9\n+  --> $DIR/needless_return.rs:47:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return true;\n+LL +         true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:48:9\n+  --> $DIR/needless_return.rs:49:9\n    |\n LL |         return false;\n    |         ^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return false;\n+LL +         false\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:54:17\n+  --> $DIR/needless_return.rs:55:17\n    |\n LL |         true => return false,\n    |                 ^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL |         true => false,\n+   |                 ~~~~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:56:13\n+  --> $DIR/needless_return.rs:57:13\n    |\n LL |             return true;\n    |             ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -             return true;\n+LL +             true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:63:9\n+  --> $DIR/needless_return.rs:64:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return true;\n+LL +         true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:65:16\n+  --> $DIR/needless_return.rs:66:16\n    |\n LL |     let _ = || return true;\n    |                ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL |     let _ = || true;\n+   |                ~~~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:69:5\n+  --> $DIR/needless_return.rs:70:5\n    |\n LL |     return the_answer!();\n    |     ^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return the_answer!();\n+LL +     the_answer!()\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:72:21\n+  --> $DIR/needless_return.rs:73:21\n    |\n LL |   fn test_void_fun() {\n    |  _____________________^\n LL | |     return;\n    | |__________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL - fn test_void_fun() {\n+LL -     return;\n+LL + fn test_void_fun() {\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:77:11\n+  --> $DIR/needless_return.rs:78:11\n    |\n LL |       if b {\n    |  ___________^\n LL | |         return;\n    | |______________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     if b {\n+LL -         return;\n+LL +     if b {\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:79:13\n+  --> $DIR/needless_return.rs:80:13\n    |\n LL |       } else {\n    |  _____________^\n LL | |         return;\n    | |______________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     } else {\n+LL -         return;\n+LL +     } else {\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:87:14\n+  --> $DIR/needless_return.rs:88:14\n    |\n LL |         _ => return,\n    |              ^^^^^^\n    |\n-   = help: replace `return` with a unit value\n+help: replace `return` with a unit value\n+   |\n+LL |         _ => (),\n+   |              ~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:95:24\n+  --> $DIR/needless_return.rs:96:24\n    |\n LL |               let _ = 42;\n    |  ________________________^\n LL | |             return;\n    | |__________________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -             let _ = 42;\n+LL -             return;\n+LL +             let _ = 42;\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:98:14\n+  --> $DIR/needless_return.rs:99:14\n    |\n LL |         _ => return,\n    |              ^^^^^^\n    |\n-   = help: replace `return` with a unit value\n+help: replace `return` with a unit value\n+   |\n+LL |         _ => (),\n+   |              ~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:111:9\n+  --> $DIR/needless_return.rs:112:9\n    |\n LL |         return String::from(\"test\");\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return String::from(\"test\");\n+LL +         String::from(\"test\")\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:113:9\n+  --> $DIR/needless_return.rs:114:9\n    |\n LL |         return String::new();\n    |         ^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return String::new();\n+LL +         String::new()\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:135:32\n+  --> $DIR/needless_return.rs:136:32\n    |\n LL |         bar.unwrap_or_else(|_| return)\n    |                                ^^^^^^\n    |\n-   = help: replace `return` with an empty block\n+help: replace `return` with an empty block\n+   |\n+LL |         bar.unwrap_or_else(|_| {})\n+   |                                ~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:139:21\n+  --> $DIR/needless_return.rs:140:21\n    |\n LL |           let _ = || {\n    |  _____________________^\n LL | |             return;\n    | |__________________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         let _ = || {\n+LL -             return;\n+LL +         let _ = || {\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:142:20\n+  --> $DIR/needless_return.rs:143:20\n    |\n LL |         let _ = || return;\n    |                    ^^^^^^\n    |\n-   = help: replace `return` with an empty block\n+help: replace `return` with an empty block\n+   |\n+LL |         let _ = || {};\n+   |                    ~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:148:32\n+  --> $DIR/needless_return.rs:149:32\n    |\n LL |         res.unwrap_or_else(|_| return Foo)\n    |                                ^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL |         res.unwrap_or_else(|_| Foo)\n+   |                                ~~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:157:5\n+  --> $DIR/needless_return.rs:158:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return true;\n+LL +     true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:161:5\n+  --> $DIR/needless_return.rs:162:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return true;\n+LL +     true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:166:9\n+  --> $DIR/needless_return.rs:167:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return true;\n+LL +         true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:168:9\n+  --> $DIR/needless_return.rs:169:9\n    |\n LL |         return false;\n    |         ^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return false;\n+LL +         false\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:174:17\n+  --> $DIR/needless_return.rs:175:17\n    |\n LL |         true => return false,\n    |                 ^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL |         true => false,\n+   |                 ~~~~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:176:13\n+  --> $DIR/needless_return.rs:177:13\n    |\n LL |             return true;\n    |             ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -             return true;\n+LL +             true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:183:9\n+  --> $DIR/needless_return.rs:184:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return true;\n+LL +         true\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:185:16\n+  --> $DIR/needless_return.rs:186:16\n    |\n LL |     let _ = || return true;\n    |                ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL |     let _ = || true;\n+   |                ~~~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:189:5\n+  --> $DIR/needless_return.rs:190:5\n    |\n LL |     return the_answer!();\n    |     ^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return the_answer!();\n+LL +     the_answer!()\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:192:33\n+  --> $DIR/needless_return.rs:193:33\n    |\n LL |   async fn async_test_void_fun() {\n    |  _________________________________^\n LL | |     return;\n    | |__________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL - async fn async_test_void_fun() {\n+LL -     return;\n+LL + async fn async_test_void_fun() {\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:197:11\n+  --> $DIR/needless_return.rs:198:11\n    |\n LL |       if b {\n    |  ___________^\n LL | |         return;\n    | |______________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     if b {\n+LL -         return;\n+LL +     if b {\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:199:13\n+  --> $DIR/needless_return.rs:200:13\n    |\n LL |       } else {\n    |  _____________^\n LL | |         return;\n    | |______________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     } else {\n+LL -         return;\n+LL +     } else {\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:207:14\n+  --> $DIR/needless_return.rs:208:14\n    |\n LL |         _ => return,\n    |              ^^^^^^\n    |\n-   = help: replace `return` with a unit value\n+help: replace `return` with a unit value\n+   |\n+LL |         _ => (),\n+   |              ~~\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:220:9\n+  --> $DIR/needless_return.rs:221:9\n    |\n LL |         return String::from(\"test\");\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return String::from(\"test\");\n+LL +         String::from(\"test\")\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:222:9\n+  --> $DIR/needless_return.rs:223:9\n    |\n LL |         return String::new();\n    |         ^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return String::new();\n+LL +         String::new()\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:238:5\n+  --> $DIR/needless_return.rs:239:5\n    |\n LL |     return format!(\"Hello {}\", \"world!\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -     return format!(\"Hello {}\", \"world!\");\n+LL +     format!(\"Hello {}\", \"world!\")\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:250:9\n+  --> $DIR/needless_return.rs:251:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL ~         true\n+LL |     } else {\n+LL |         return false;\n+LL ~     }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:252:9\n+  --> $DIR/needless_return.rs:253:9\n    |\n LL |         return false;\n    |         ^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL ~         false\n+LL ~     }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:259:13\n+  --> $DIR/needless_return.rs:260:13\n    |\n LL |             return 10;\n    |             ^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL ~             10\n+LL |         },\n+ ...\n+LL |         },\n+LL ~     }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:262:13\n+  --> $DIR/needless_return.rs:263:13\n    |\n LL |             return 100;\n    |             ^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL ~             100\n+LL |         },\n+LL ~     }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:270:9\n+  --> $DIR/needless_return.rs:271:9\n    |\n LL |         return 0;\n    |         ^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL ~         0\n+LL ~     }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:277:13\n+  --> $DIR/needless_return.rs:278:13\n    |\n LL |             return *(x as *const isize);\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL ~             *(x as *const isize)\n+LL |         } else {\n+LL |             return !*(x as *const isize);\n+LL ~         }\n+LL ~     }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:279:13\n+  --> $DIR/needless_return.rs:280:13\n    |\n LL |             return !*(x as *const isize);\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL ~             !*(x as *const isize)\n+LL ~         }\n+LL ~     }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:286:20\n+  --> $DIR/needless_return.rs:287:20\n    |\n LL |           let _ = 42;\n    |  ____________________^\n LL | |\n LL | |         return;\n    | |______________^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         let _ = 42;\n+LL - \n+LL -         return;\n+LL +         let _ = 42;\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:293:20\n+  --> $DIR/needless_return.rs:294:20\n    |\n LL |         let _ = 42; return;\n    |                    ^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         let _ = 42; return;\n+LL +         let _ = 42;\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:305:9\n+  --> $DIR/needless_return.rs:306:9\n    |\n LL |         return Ok(format!(\"ok!\"));\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return Ok(format!(\"ok!\"));\n+LL +         Ok(format!(\"ok!\"))\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:307:9\n+  --> $DIR/needless_return.rs:308:9\n    |\n LL |         return Err(format!(\"err!\"));\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return Err(format!(\"err!\"));\n+LL +         Err(format!(\"err!\"))\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:313:9\n+  --> $DIR/needless_return.rs:314:9\n    |\n LL |         return if true { 1 } else { 2 };\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return`\n+help: remove `return`\n+   |\n+LL -         return if true { 1 } else { 2 };\n+LL +         if true { 1 } else { 2 }\n+   |\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:317:9\n+  --> $DIR/needless_return.rs:318:9\n    |\n LL |         return if b1 { 0 } else { 1 } | if b2 { 2 } else { 3 } | if b3 { 4 } else { 5 };\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: remove `return` and wrap the sequence with parentheses\n+help: remove `return` and wrap the sequence with parentheses\n+   |\n+LL -         return if b1 { 0 } else { 1 } | if b2 { 2 } else { 3 } | if b3 { 4 } else { 5 };\n+LL +         (if b1 { 0 } else { 1 } | if b2 { 2 } else { 3 } | if b3 { 4 } else { 5 })\n+   |\n \n error: aborting due to 52 previous errors\n "}, {"sha": "fec6b7713eef8682f430b9d0591e025228a88e96", "filename": "tests/ui/nonminimal_bool.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fnonminimal_bool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fnonminimal_bool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fnonminimal_bool.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -110,3 +110,17 @@ fn issue_10435() {\n         println!(\"{}\", line!());\n     }\n }\n+\n+fn issue10836() {\n+    struct Foo(bool);\n+    impl std::ops::Not for Foo {\n+        type Output = bool;\n+\n+        fn not(self) -> Self::Output {\n+            !self.0\n+        }\n+    }\n+\n+    // Should not lint\n+    let _: bool = !!Foo(true);\n+}"}, {"sha": "24de573d0838e56f600eb18b685e188796b27a32", "filename": "tests/ui/ptr_cast_constness.fixed", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fptr_cast_constness.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fptr_cast_constness.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fptr_cast_constness.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,55 @@\n+//@run-rustfix\n+//@aux-build:proc_macros.rs\n+\n+#![warn(clippy::ptr_cast_constness)]\n+\n+extern crate proc_macros;\n+use proc_macros::{external, inline_macros};\n+\n+#[inline_macros]\n+fn main() {\n+    let ptr: *const u32 = &42_u32;\n+    let mut_ptr: *mut u32 = &mut 42_u32;\n+\n+    let _ = ptr as *const i32;\n+    let _ = mut_ptr as *mut i32;\n+\n+    // Make sure the lint can handle the difference in their operator precedences.\n+    unsafe {\n+        let ptr_ptr: *const *const u32 = &ptr;\n+        let _ = (*ptr_ptr).cast_mut();\n+    }\n+\n+    let _ = ptr.cast_mut();\n+    let _ = mut_ptr.cast_const();\n+\n+    // Lint this, since pointer::cast_mut and pointer::cast_const have ?Sized\n+    let ptr_of_array: *const [u32; 4] = &[1, 2, 3, 4];\n+    let _ = ptr_of_array as *const [u32];\n+    let _ = ptr_of_array as *const dyn std::fmt::Debug;\n+\n+    // Make sure the lint is triggered inside a macro\n+    let _ = inline!($ptr as *const i32);\n+\n+    // Do not lint inside macros from external crates\n+    let _ = external!($ptr as *const i32);\n+}\n+\n+#[clippy::msrv = \"1.64\"]\n+fn _msrv_1_64() {\n+    let ptr: *const u32 = &42_u32;\n+    let mut_ptr: *mut u32 = &mut 42_u32;\n+\n+    // `pointer::cast_const` and `pointer::cast_mut` were stabilized in 1.65. Do not lint this\n+    let _ = ptr as *mut i32;\n+    let _ = mut_ptr as *const i32;\n+}\n+\n+#[clippy::msrv = \"1.65\"]\n+fn _msrv_1_65() {\n+    let ptr: *const u32 = &42_u32;\n+    let mut_ptr: *mut u32 = &mut 42_u32;\n+\n+    let _ = ptr.cast_mut();\n+    let _ = mut_ptr.cast_const();\n+}"}, {"sha": "63d973a9fca87dacca5da4410b2aed9d89364624", "filename": "tests/ui/ptr_cast_constness.rs", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fptr_cast_constness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fptr_cast_constness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fptr_cast_constness.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,55 @@\n+//@run-rustfix\n+//@aux-build:proc_macros.rs\n+\n+#![warn(clippy::ptr_cast_constness)]\n+\n+extern crate proc_macros;\n+use proc_macros::{external, inline_macros};\n+\n+#[inline_macros]\n+fn main() {\n+    let ptr: *const u32 = &42_u32;\n+    let mut_ptr: *mut u32 = &mut 42_u32;\n+\n+    let _ = ptr as *const i32;\n+    let _ = mut_ptr as *mut i32;\n+\n+    // Make sure the lint can handle the difference in their operator precedences.\n+    unsafe {\n+        let ptr_ptr: *const *const u32 = &ptr;\n+        let _ = *ptr_ptr as *mut i32;\n+    }\n+\n+    let _ = ptr as *mut i32;\n+    let _ = mut_ptr as *const i32;\n+\n+    // Lint this, since pointer::cast_mut and pointer::cast_const have ?Sized\n+    let ptr_of_array: *const [u32; 4] = &[1, 2, 3, 4];\n+    let _ = ptr_of_array as *const [u32];\n+    let _ = ptr_of_array as *const dyn std::fmt::Debug;\n+\n+    // Make sure the lint is triggered inside a macro\n+    let _ = inline!($ptr as *const i32);\n+\n+    // Do not lint inside macros from external crates\n+    let _ = external!($ptr as *const i32);\n+}\n+\n+#[clippy::msrv = \"1.64\"]\n+fn _msrv_1_64() {\n+    let ptr: *const u32 = &42_u32;\n+    let mut_ptr: *mut u32 = &mut 42_u32;\n+\n+    // `pointer::cast_const` and `pointer::cast_mut` were stabilized in 1.65. Do not lint this\n+    let _ = ptr as *mut i32;\n+    let _ = mut_ptr as *const i32;\n+}\n+\n+#[clippy::msrv = \"1.65\"]\n+fn _msrv_1_65() {\n+    let ptr: *const u32 = &42_u32;\n+    let mut_ptr: *mut u32 = &mut 42_u32;\n+\n+    let _ = ptr as *mut i32;\n+    let _ = mut_ptr as *const i32;\n+}"}, {"sha": "43816c87c19071cbd7bb8a0abfcb32c2f6ad721b", "filename": "tests/ui/ptr_cast_constness.stderr", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fptr_cast_constness.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fptr_cast_constness.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fptr_cast_constness.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,34 @@\n+error: `as` casting between raw pointers while changing its constness\n+  --> $DIR/ptr_cast_constness.rs:20:17\n+   |\n+LL |         let _ = *ptr_ptr as *mut i32;\n+   |                 ^^^^^^^^^^^^^^^^^^^^ help: try `pointer::cast_mut`, a safer alternative: `(*ptr_ptr).cast_mut()`\n+   |\n+   = note: `-D clippy::ptr-cast-constness` implied by `-D warnings`\n+\n+error: `as` casting between raw pointers while changing its constness\n+  --> $DIR/ptr_cast_constness.rs:23:13\n+   |\n+LL |     let _ = ptr as *mut i32;\n+   |             ^^^^^^^^^^^^^^^ help: try `pointer::cast_mut`, a safer alternative: `ptr.cast_mut()`\n+\n+error: `as` casting between raw pointers while changing its constness\n+  --> $DIR/ptr_cast_constness.rs:24:13\n+   |\n+LL |     let _ = mut_ptr as *const i32;\n+   |             ^^^^^^^^^^^^^^^^^^^^^ help: try `pointer::cast_const`, a safer alternative: `mut_ptr.cast_const()`\n+\n+error: `as` casting between raw pointers while changing its constness\n+  --> $DIR/ptr_cast_constness.rs:53:13\n+   |\n+LL |     let _ = ptr as *mut i32;\n+   |             ^^^^^^^^^^^^^^^ help: try `pointer::cast_mut`, a safer alternative: `ptr.cast_mut()`\n+\n+error: `as` casting between raw pointers while changing its constness\n+  --> $DIR/ptr_cast_constness.rs:54:13\n+   |\n+LL |     let _ = mut_ptr as *const i32;\n+   |             ^^^^^^^^^^^^^^^^^^^^^ help: try `pointer::cast_const`, a safer alternative: `mut_ptr.cast_const()`\n+\n+error: aborting due to 5 previous errors\n+"}, {"sha": "481c9b263fbb8933a9f09afae1d1a6e26ab7e4a1", "filename": "tests/ui/redundant_pattern_matching_drop_order.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_drop_order.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_drop_order.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_drop_order.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -2,7 +2,7 @@\n \n // Issue #5746\n #![warn(clippy::redundant_pattern_matching)]\n-#![allow(clippy::if_same_then_else, clippy::equatable_if_let)]\n+#![allow(clippy::if_same_then_else, clippy::equatable_if_let, clippy::needless_else)]\n use std::task::Poll::{Pending, Ready};\n \n fn main() {"}, {"sha": "86e46d41e65a1bfc0dd01f8f07b30a026ff5a198", "filename": "tests/ui/redundant_pattern_matching_drop_order.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_drop_order.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_drop_order.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_drop_order.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -2,7 +2,7 @@\n \n // Issue #5746\n #![warn(clippy::redundant_pattern_matching)]\n-#![allow(clippy::if_same_then_else, clippy::equatable_if_let)]\n+#![allow(clippy::if_same_then_else, clippy::equatable_if_let, clippy::needless_else)]\n use std::task::Poll::{Pending, Ready};\n \n fn main() {"}, {"sha": "dae931541d4543b8650f6cf3a56eed9d40c3a9bd", "filename": "tests/ui/redundant_pattern_matching_option.fixed", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_option.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_option.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_option.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -47,6 +47,7 @@ fn main() {\n \n     issue6067();\n     issue10726();\n+    issue10803();\n \n     let _ = if gen_opt().is_some() {\n         1\n@@ -107,3 +108,14 @@ fn issue10726() {\n         _ => false,\n     };\n }\n+\n+fn issue10803() {\n+    let x = Some(42);\n+\n+    let _ = x.is_some();\n+\n+    let _ = x.is_none();\n+\n+    // Don't lint\n+    let _ = matches!(x, Some(16));\n+}"}, {"sha": "3f2fa3f53ce992323c9e12e0b660463b8262f70d", "filename": "tests/ui/redundant_pattern_matching_option.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_option.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_option.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_option.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -56,6 +56,7 @@ fn main() {\n \n     issue6067();\n     issue10726();\n+    issue10803();\n \n     let _ = if let Some(_) = gen_opt() {\n         1\n@@ -134,3 +135,14 @@ fn issue10726() {\n         _ => false,\n     };\n }\n+\n+fn issue10803() {\n+    let x = Some(42);\n+\n+    let _ = matches!(x, Some(_));\n+\n+    let _ = matches!(x, None);\n+\n+    // Don't lint\n+    let _ = matches!(x, Some(16));\n+}"}, {"sha": "93760ce97a8f6260657def44718d54bea44474e4", "filename": "tests/ui/redundant_pattern_matching_option.stderr", "status": "modified", "additions": 28, "deletions": 16, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_option.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_option.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_option.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -77,49 +77,49 @@ LL |     let _ = if let Some(_) = opt { true } else { false };\n    |             -------^^^^^^^------ help: try this: `if opt.is_some()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_option.rs:60:20\n+  --> $DIR/redundant_pattern_matching_option.rs:61:20\n    |\n LL |     let _ = if let Some(_) = gen_opt() {\n    |             -------^^^^^^^------------ help: try this: `if gen_opt().is_some()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:62:19\n+  --> $DIR/redundant_pattern_matching_option.rs:63:19\n    |\n LL |     } else if let None = gen_opt() {\n    |            -------^^^^------------ help: try this: `if gen_opt().is_none()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_option.rs:68:12\n+  --> $DIR/redundant_pattern_matching_option.rs:69:12\n    |\n LL |     if let Some(..) = gen_opt() {}\n    |     -------^^^^^^^^------------ help: try this: `if gen_opt().is_some()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_option.rs:83:12\n+  --> $DIR/redundant_pattern_matching_option.rs:84:12\n    |\n LL |     if let Some(_) = Some(42) {}\n    |     -------^^^^^^^----------- help: try this: `if Some(42).is_some()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:85:12\n+  --> $DIR/redundant_pattern_matching_option.rs:86:12\n    |\n LL |     if let None = None::<()> {}\n    |     -------^^^^------------- help: try this: `if None::<()>.is_none()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_option.rs:87:15\n+  --> $DIR/redundant_pattern_matching_option.rs:88:15\n    |\n LL |     while let Some(_) = Some(42) {}\n    |     ----------^^^^^^^----------- help: try this: `while Some(42).is_some()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:89:15\n+  --> $DIR/redundant_pattern_matching_option.rs:90:15\n    |\n LL |     while let None = None::<()> {}\n    |     ----------^^^^------------- help: try this: `while None::<()>.is_none()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_option.rs:91:5\n+  --> $DIR/redundant_pattern_matching_option.rs:92:5\n    |\n LL | /     match Some(42) {\n LL | |         Some(_) => true,\n@@ -128,7 +128,7 @@ LL | |     };\n    | |_____^ help: try this: `Some(42).is_some()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:96:5\n+  --> $DIR/redundant_pattern_matching_option.rs:97:5\n    |\n LL | /     match None::<()> {\n LL | |         Some(_) => false,\n@@ -137,19 +137,19 @@ LL | |     };\n    | |_____^ help: try this: `None::<()>.is_none()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:104:12\n+  --> $DIR/redundant_pattern_matching_option.rs:105:12\n    |\n LL |     if let None = *(&None::<()>) {}\n    |     -------^^^^----------------- help: try this: `if (&None::<()>).is_none()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:105:12\n+  --> $DIR/redundant_pattern_matching_option.rs:106:12\n    |\n LL |     if let None = *&None::<()> {}\n    |     -------^^^^--------------- help: try this: `if (&None::<()>).is_none()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_option.rs:111:5\n+  --> $DIR/redundant_pattern_matching_option.rs:112:5\n    |\n LL | /     match x {\n LL | |         Some(_) => true,\n@@ -158,7 +158,7 @@ LL | |     };\n    | |_____^ help: try this: `x.is_some()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:116:5\n+  --> $DIR/redundant_pattern_matching_option.rs:117:5\n    |\n LL | /     match x {\n LL | |         None => true,\n@@ -167,7 +167,7 @@ LL | |     };\n    | |_____^ help: try this: `x.is_none()`\n \n error: redundant pattern matching, consider using `is_none()`\n-  --> $DIR/redundant_pattern_matching_option.rs:121:5\n+  --> $DIR/redundant_pattern_matching_option.rs:122:5\n    |\n LL | /     match x {\n LL | |         Some(_) => false,\n@@ -176,13 +176,25 @@ LL | |     };\n    | |_____^ help: try this: `x.is_none()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_option.rs:126:5\n+  --> $DIR/redundant_pattern_matching_option.rs:127:5\n    |\n LL | /     match x {\n LL | |         None => false,\n LL | |         _ => true,\n LL | |     };\n    | |_____^ help: try this: `x.is_some()`\n \n-error: aborting due to 26 previous errors\n+error: redundant pattern matching, consider using `is_some()`\n+  --> $DIR/redundant_pattern_matching_option.rs:142:13\n+   |\n+LL |     let _ = matches!(x, Some(_));\n+   |             ^^^^^^^^^^^^^^^^^^^^ help: try this: `x.is_some()`\n+\n+error: redundant pattern matching, consider using `is_none()`\n+  --> $DIR/redundant_pattern_matching_option.rs:144:13\n+   |\n+LL |     let _ = matches!(x, None);\n+   |             ^^^^^^^^^^^^^^^^^ help: try this: `x.is_none()`\n+\n+error: aborting due to 28 previous errors\n "}, {"sha": "d77a2af761642cf72a99d9c2839160321c823937", "filename": "tests/ui/redundant_pattern_matching_result.fixed", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_result.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_result.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_result.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -44,6 +44,7 @@ fn main() {\n     issue6067();\n     issue6065();\n     issue10726();\n+    issue10803();\n \n     let _ = if gen_res().is_ok() {\n         1\n@@ -133,3 +134,17 @@ fn issue10726() {\n         _ => true,\n     };\n }\n+\n+fn issue10803() {\n+    let x: Result<i32, i32> = Ok(42);\n+\n+    let _ = x.is_ok();\n+\n+    let _ = x.is_err();\n+\n+    // Don't lint\n+    let _ = matches!(x, Ok(16));\n+\n+    // Don't lint\n+    let _ = matches!(x, Err(16));\n+}"}, {"sha": "aa884ac6bb1ee2136afcb344c5cd2734c963b935", "filename": "tests/ui/redundant_pattern_matching_result.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_result.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_result.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_result.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -56,6 +56,7 @@ fn main() {\n     issue6067();\n     issue6065();\n     issue10726();\n+    issue10803();\n \n     let _ = if let Ok(_) = gen_res() {\n         1\n@@ -163,3 +164,17 @@ fn issue10726() {\n         _ => true,\n     };\n }\n+\n+fn issue10803() {\n+    let x: Result<i32, i32> = Ok(42);\n+\n+    let _ = matches!(x, Ok(_));\n+\n+    let _ = matches!(x, Err(_));\n+\n+    // Don't lint\n+    let _ = matches!(x, Ok(16));\n+\n+    // Don't lint\n+    let _ = matches!(x, Err(16));\n+}"}, {"sha": "b462f7f41b9cc71a70907b950c6b3dc1c41c18ad", "filename": "tests/ui/redundant_pattern_matching_result.stderr", "status": "modified", "additions": 29, "deletions": 17, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_result.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fredundant_pattern_matching_result.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_pattern_matching_result.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -73,67 +73,67 @@ LL |     let _ = if let Ok(_) = Ok::<usize, ()>(4) { true } else { false };\n    |             -------^^^^^--------------------- help: try this: `if Ok::<usize, ()>(4).is_ok()`\n \n error: redundant pattern matching, consider using `is_ok()`\n-  --> $DIR/redundant_pattern_matching_result.rs:60:20\n+  --> $DIR/redundant_pattern_matching_result.rs:61:20\n    |\n LL |     let _ = if let Ok(_) = gen_res() {\n    |             -------^^^^^------------ help: try this: `if gen_res().is_ok()`\n \n error: redundant pattern matching, consider using `is_err()`\n-  --> $DIR/redundant_pattern_matching_result.rs:62:19\n+  --> $DIR/redundant_pattern_matching_result.rs:63:19\n    |\n LL |     } else if let Err(_) = gen_res() {\n    |            -------^^^^^^------------ help: try this: `if gen_res().is_err()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_result.rs:85:19\n+  --> $DIR/redundant_pattern_matching_result.rs:86:19\n    |\n LL |         while let Some(_) = r#try!(result_opt()) {}\n    |         ----------^^^^^^^----------------------- help: try this: `while r#try!(result_opt()).is_some()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_result.rs:86:16\n+  --> $DIR/redundant_pattern_matching_result.rs:87:16\n    |\n LL |         if let Some(_) = r#try!(result_opt()) {}\n    |         -------^^^^^^^----------------------- help: try this: `if r#try!(result_opt()).is_some()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_result.rs:92:12\n+  --> $DIR/redundant_pattern_matching_result.rs:93:12\n    |\n LL |     if let Some(_) = m!() {}\n    |     -------^^^^^^^------- help: try this: `if m!().is_some()`\n \n error: redundant pattern matching, consider using `is_some()`\n-  --> $DIR/redundant_pattern_matching_result.rs:93:15\n+  --> $DIR/redundant_pattern_matching_result.rs:94:15\n    |\n LL |     while let Some(_) = m!() {}\n    |     ----------^^^^^^^------- help: try this: `while m!().is_some()`\n \n error: redundant pattern matching, consider using `is_ok()`\n-  --> $DIR/redundant_pattern_matching_result.rs:111:12\n+  --> $DIR/redundant_pattern_matching_result.rs:112:12\n    |\n LL |     if let Ok(_) = Ok::<i32, i32>(42) {}\n    |     -------^^^^^--------------------- help: try this: `if Ok::<i32, i32>(42).is_ok()`\n \n error: redundant pattern matching, consider using `is_err()`\n-  --> $DIR/redundant_pattern_matching_result.rs:113:12\n+  --> $DIR/redundant_pattern_matching_result.rs:114:12\n    |\n LL |     if let Err(_) = Err::<i32, i32>(42) {}\n    |     -------^^^^^^---------------------- help: try this: `if Err::<i32, i32>(42).is_err()`\n \n error: redundant pattern matching, consider using `is_ok()`\n-  --> $DIR/redundant_pattern_matching_result.rs:115:15\n+  --> $DIR/redundant_pattern_matching_result.rs:116:15\n    |\n LL |     while let Ok(_) = Ok::<i32, i32>(10) {}\n    |     ----------^^^^^--------------------- help: try this: `while Ok::<i32, i32>(10).is_ok()`\n \n error: redundant pattern matching, consider using `is_err()`\n-  --> $DIR/redundant_pattern_matching_result.rs:117:15\n+  --> $DIR/redundant_pattern_matching_result.rs:118:15\n    |\n LL |     while let Err(_) = Ok::<i32, i32>(10) {}\n    |     ----------^^^^^^--------------------- help: try this: `while Ok::<i32, i32>(10).is_err()`\n \n error: redundant pattern matching, consider using `is_ok()`\n-  --> $DIR/redundant_pattern_matching_result.rs:119:5\n+  --> $DIR/redundant_pattern_matching_result.rs:120:5\n    |\n LL | /     match Ok::<i32, i32>(42) {\n LL | |         Ok(_) => true,\n@@ -142,7 +142,7 @@ LL | |     };\n    | |_____^ help: try this: `Ok::<i32, i32>(42).is_ok()`\n \n error: redundant pattern matching, consider using `is_err()`\n-  --> $DIR/redundant_pattern_matching_result.rs:124:5\n+  --> $DIR/redundant_pattern_matching_result.rs:125:5\n    |\n LL | /     match Err::<i32, i32>(42) {\n LL | |         Ok(_) => false,\n@@ -151,7 +151,7 @@ LL | |     };\n    | |_____^ help: try this: `Err::<i32, i32>(42).is_err()`\n \n error: redundant pattern matching, consider using `is_ok()`\n-  --> $DIR/redundant_pattern_matching_result.rs:134:5\n+  --> $DIR/redundant_pattern_matching_result.rs:135:5\n    |\n LL | /     match x {\n LL | |         Ok(_) => true,\n@@ -160,7 +160,7 @@ LL | |     };\n    | |_____^ help: try this: `x.is_ok()`\n \n error: redundant pattern matching, consider using `is_err()`\n-  --> $DIR/redundant_pattern_matching_result.rs:139:5\n+  --> $DIR/redundant_pattern_matching_result.rs:140:5\n    |\n LL | /     match x {\n LL | |         Ok(_) => false,\n@@ -169,7 +169,7 @@ LL | |     };\n    | |_____^ help: try this: `x.is_err()`\n \n error: redundant pattern matching, consider using `is_err()`\n-  --> $DIR/redundant_pattern_matching_result.rs:144:5\n+  --> $DIR/redundant_pattern_matching_result.rs:145:5\n    |\n LL | /     match x {\n LL | |         Err(_) => true,\n@@ -178,13 +178,25 @@ LL | |     };\n    | |_____^ help: try this: `x.is_err()`\n \n error: redundant pattern matching, consider using `is_ok()`\n-  --> $DIR/redundant_pattern_matching_result.rs:149:5\n+  --> $DIR/redundant_pattern_matching_result.rs:150:5\n    |\n LL | /     match x {\n LL | |         Err(_) => false,\n LL | |         _ => true,\n LL | |     };\n    | |_____^ help: try this: `x.is_ok()`\n \n-error: aborting due to 26 previous errors\n+error: redundant pattern matching, consider using `is_ok()`\n+  --> $DIR/redundant_pattern_matching_result.rs:171:13\n+   |\n+LL |     let _ = matches!(x, Ok(_));\n+   |             ^^^^^^^^^^^^^^^^^^ help: try this: `x.is_ok()`\n+\n+error: redundant pattern matching, consider using `is_err()`\n+  --> $DIR/redundant_pattern_matching_result.rs:173:13\n+   |\n+LL |     let _ = matches!(x, Err(_));\n+   |             ^^^^^^^^^^^^^^^^^^^ help: try this: `x.is_err()`\n+\n+error: aborting due to 28 previous errors\n "}, {"sha": "1c8e47ab594949f0f9466c70aaf82f607b570c03", "filename": "tests/ui/regex.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fregex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fregex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fregex.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -42,6 +42,11 @@ fn syntax_error() {\n     let escaped_string_span = Regex::new(\"\\\\b\\\\c\");\n \n     let aux_span = Regex::new(\"(?ixi)\");\n+\n+    let should_not_lint = Regex::new(\"(?u).\");\n+    let should_not_lint = BRegex::new(\"(?u).\");\n+    let invalid_utf8_should_not_lint = BRegex::new(\"(?-u).\");\n+    let invalid_utf8_should_lint = Regex::new(\"(?-u).\");\n }\n \n fn trivial_regex() {\n@@ -71,6 +76,8 @@ fn trivial_regex() {\n     // non-trivial regexes\n     let non_trivial_dot = Regex::new(\"a.b\");\n     let non_trivial_dot_builder = RegexBuilder::new(\"a.b\");\n+    let non_trivial_dot = Regex::new(\".\");\n+    let non_trivial_dot = BRegex::new(\".\");\n     let non_trivial_eq = Regex::new(\"^foo|bar$\");\n     let non_trivial_starts_with = Regex::new(\"^foo|bar\");\n     let non_trivial_ends_with = Regex::new(\"^foo|bar\");"}, {"sha": "1e8a21283cd9584f4ab974da8c0d0a68ad49613a", "filename": "tests/ui/regex.stderr", "status": "modified", "additions": 18, "deletions": 12, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fregex.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fregex.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fregex.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -99,93 +99,99 @@ error: regex syntax error: duplicate flag\n LL |     let aux_span = Regex::new(\"(?ixi)\");\n    |                                  ^ ^\n \n+error: regex syntax error: pattern can match invalid UTF-8\n+  --> $DIR/regex.rs:49:53\n+   |\n+LL |     let invalid_utf8_should_lint = Regex::new(\"(?-u).\");\n+   |                                                     ^\n+\n error: trivial regex\n-  --> $DIR/regex.rs:48:33\n+  --> $DIR/regex.rs:53:33\n    |\n LL |     let trivial_eq = Regex::new(\"^foobar$\");\n    |                                 ^^^^^^^^^^\n    |\n    = help: consider using `==` on `str`s\n \n error: trivial regex\n-  --> $DIR/regex.rs:50:48\n+  --> $DIR/regex.rs:55:48\n    |\n LL |     let trivial_eq_builder = RegexBuilder::new(\"^foobar$\");\n    |                                                ^^^^^^^^^^\n    |\n    = help: consider using `==` on `str`s\n \n error: trivial regex\n-  --> $DIR/regex.rs:52:42\n+  --> $DIR/regex.rs:57:42\n    |\n LL |     let trivial_starts_with = Regex::new(\"^foobar\");\n    |                                          ^^^^^^^^^\n    |\n    = help: consider using `str::starts_with`\n \n error: trivial regex\n-  --> $DIR/regex.rs:54:40\n+  --> $DIR/regex.rs:59:40\n    |\n LL |     let trivial_ends_with = Regex::new(\"foobar$\");\n    |                                        ^^^^^^^^^\n    |\n    = help: consider using `str::ends_with`\n \n error: trivial regex\n-  --> $DIR/regex.rs:56:39\n+  --> $DIR/regex.rs:61:39\n    |\n LL |     let trivial_contains = Regex::new(\"foobar\");\n    |                                       ^^^^^^^^\n    |\n    = help: consider using `str::contains`\n \n error: trivial regex\n-  --> $DIR/regex.rs:58:39\n+  --> $DIR/regex.rs:63:39\n    |\n LL |     let trivial_contains = Regex::new(NOT_A_REAL_REGEX);\n    |                                       ^^^^^^^^^^^^^^^^\n    |\n    = help: consider using `str::contains`\n \n error: trivial regex\n-  --> $DIR/regex.rs:60:40\n+  --> $DIR/regex.rs:65:40\n    |\n LL |     let trivial_backslash = Regex::new(\"a/.b\");\n    |                                        ^^^^^^^\n    |\n    = help: consider using `str::contains`\n \n error: trivial regex\n-  --> $DIR/regex.rs:63:36\n+  --> $DIR/regex.rs:68:36\n    |\n LL |     let trivial_empty = Regex::new(\"\");\n    |                                    ^^\n    |\n    = help: the regex is unlikely to be useful as it is\n \n error: trivial regex\n-  --> $DIR/regex.rs:65:36\n+  --> $DIR/regex.rs:70:36\n    |\n LL |     let trivial_empty = Regex::new(\"^\");\n    |                                    ^^^\n    |\n    = help: the regex is unlikely to be useful as it is\n \n error: trivial regex\n-  --> $DIR/regex.rs:67:36\n+  --> $DIR/regex.rs:72:36\n    |\n LL |     let trivial_empty = Regex::new(\"^$\");\n    |                                    ^^^^\n    |\n    = help: consider using `str::is_empty`\n \n error: trivial regex\n-  --> $DIR/regex.rs:69:44\n+  --> $DIR/regex.rs:74:44\n    |\n LL |     let binary_trivial_empty = BRegex::new(\"^$\");\n    |                                            ^^^^\n    |\n    = help: consider using `str::is_empty`\n \n-error: aborting due to 23 previous errors\n+error: aborting due to 24 previous errors\n "}, {"sha": "0a58100df484c020fad8341d7ffaaf284e8755a2", "filename": "tests/ui/rename.fixed", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Frename.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Frename.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frename.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -28,8 +28,8 @@\n #![allow(clippy::module_name_repetitions)]\n #![allow(clippy::recursive_format_impl)]\n #![allow(clippy::invisible_characters)]\n-#![allow(suspicious_double_ref_op)]\n #![allow(cast_ref_to_mut)]\n+#![allow(suspicious_double_ref_op)]\n #![allow(drop_bounds)]\n #![allow(dropping_copy_types)]\n #![allow(dropping_references)]\n@@ -44,7 +44,6 @@\n #![allow(enum_intrinsics_non_enums)]\n #![allow(non_fmt_panics)]\n #![allow(named_arguments_used_positionally)]\n-#![allow(suspicious_double_ref_op)]\n #![allow(temporary_cstring_as_ptr)]\n #![allow(unknown_lints)]\n #![allow(unused_labels)]"}, {"sha": "75aec9cf2aca1b01346023d85a80cde9e4916ebe", "filename": "tests/ui/rename.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frename.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -28,8 +28,8 @@\n #![allow(clippy::module_name_repetitions)]\n #![allow(clippy::recursive_format_impl)]\n #![allow(clippy::invisible_characters)]\n-#![allow(suspicious_double_ref_op)]\n #![allow(cast_ref_to_mut)]\n+#![allow(suspicious_double_ref_op)]\n #![allow(drop_bounds)]\n #![allow(dropping_copy_types)]\n #![allow(dropping_references)]\n@@ -44,7 +44,6 @@\n #![allow(enum_intrinsics_non_enums)]\n #![allow(non_fmt_panics)]\n #![allow(named_arguments_used_positionally)]\n-#![allow(suspicious_double_ref_op)]\n #![allow(temporary_cstring_as_ptr)]\n #![allow(unknown_lints)]\n #![allow(unused_labels)]"}, {"sha": "a72c87387a83947569affdde701e755ee0e8032e", "filename": "tests/ui/rename.stderr", "status": "modified", "additions": 50, "deletions": 50, "changes": 100, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Frename.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Frename.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frename.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,301 +1,301 @@\n error: lint `clippy::almost_complete_letter_range` has been renamed to `clippy::almost_complete_range`\n-  --> $DIR/rename.rs:51:9\n+  --> $DIR/rename.rs:50:9\n    |\n LL | #![warn(clippy::almost_complete_letter_range)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::almost_complete_range`\n    |\n    = note: `-D renamed-and-removed-lints` implied by `-D warnings`\n \n error: lint `clippy::blacklisted_name` has been renamed to `clippy::disallowed_names`\n-  --> $DIR/rename.rs:52:9\n+  --> $DIR/rename.rs:51:9\n    |\n LL | #![warn(clippy::blacklisted_name)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::disallowed_names`\n \n error: lint `clippy::block_in_if_condition_expr` has been renamed to `clippy::blocks_in_if_conditions`\n-  --> $DIR/rename.rs:53:9\n+  --> $DIR/rename.rs:52:9\n    |\n LL | #![warn(clippy::block_in_if_condition_expr)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::blocks_in_if_conditions`\n \n error: lint `clippy::block_in_if_condition_stmt` has been renamed to `clippy::blocks_in_if_conditions`\n-  --> $DIR/rename.rs:54:9\n+  --> $DIR/rename.rs:53:9\n    |\n LL | #![warn(clippy::block_in_if_condition_stmt)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::blocks_in_if_conditions`\n \n error: lint `clippy::box_vec` has been renamed to `clippy::box_collection`\n-  --> $DIR/rename.rs:55:9\n+  --> $DIR/rename.rs:54:9\n    |\n LL | #![warn(clippy::box_vec)]\n    |         ^^^^^^^^^^^^^^^ help: use the new name: `clippy::box_collection`\n \n error: lint `clippy::const_static_lifetime` has been renamed to `clippy::redundant_static_lifetimes`\n-  --> $DIR/rename.rs:56:9\n+  --> $DIR/rename.rs:55:9\n    |\n LL | #![warn(clippy::const_static_lifetime)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::redundant_static_lifetimes`\n \n error: lint `clippy::cyclomatic_complexity` has been renamed to `clippy::cognitive_complexity`\n-  --> $DIR/rename.rs:57:9\n+  --> $DIR/rename.rs:56:9\n    |\n LL | #![warn(clippy::cyclomatic_complexity)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::cognitive_complexity`\n \n error: lint `clippy::derive_hash_xor_eq` has been renamed to `clippy::derived_hash_with_manual_eq`\n-  --> $DIR/rename.rs:58:9\n+  --> $DIR/rename.rs:57:9\n    |\n LL | #![warn(clippy::derive_hash_xor_eq)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::derived_hash_with_manual_eq`\n \n error: lint `clippy::disallowed_method` has been renamed to `clippy::disallowed_methods`\n-  --> $DIR/rename.rs:59:9\n+  --> $DIR/rename.rs:58:9\n    |\n LL | #![warn(clippy::disallowed_method)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::disallowed_methods`\n \n error: lint `clippy::disallowed_type` has been renamed to `clippy::disallowed_types`\n-  --> $DIR/rename.rs:60:9\n+  --> $DIR/rename.rs:59:9\n    |\n LL | #![warn(clippy::disallowed_type)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::disallowed_types`\n \n error: lint `clippy::eval_order_dependence` has been renamed to `clippy::mixed_read_write_in_expression`\n-  --> $DIR/rename.rs:61:9\n+  --> $DIR/rename.rs:60:9\n    |\n LL | #![warn(clippy::eval_order_dependence)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::mixed_read_write_in_expression`\n \n error: lint `clippy::identity_conversion` has been renamed to `clippy::useless_conversion`\n-  --> $DIR/rename.rs:62:9\n+  --> $DIR/rename.rs:61:9\n    |\n LL | #![warn(clippy::identity_conversion)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::useless_conversion`\n \n error: lint `clippy::if_let_some_result` has been renamed to `clippy::match_result_ok`\n-  --> $DIR/rename.rs:63:9\n+  --> $DIR/rename.rs:62:9\n    |\n LL | #![warn(clippy::if_let_some_result)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::match_result_ok`\n \n error: lint `clippy::integer_arithmetic` has been renamed to `clippy::arithmetic_side_effects`\n-  --> $DIR/rename.rs:64:9\n+  --> $DIR/rename.rs:63:9\n    |\n LL | #![warn(clippy::integer_arithmetic)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::arithmetic_side_effects`\n \n error: lint `clippy::logic_bug` has been renamed to `clippy::overly_complex_bool_expr`\n-  --> $DIR/rename.rs:65:9\n+  --> $DIR/rename.rs:64:9\n    |\n LL | #![warn(clippy::logic_bug)]\n    |         ^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::overly_complex_bool_expr`\n \n error: lint `clippy::new_without_default_derive` has been renamed to `clippy::new_without_default`\n-  --> $DIR/rename.rs:66:9\n+  --> $DIR/rename.rs:65:9\n    |\n LL | #![warn(clippy::new_without_default_derive)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::new_without_default`\n \n error: lint `clippy::option_and_then_some` has been renamed to `clippy::bind_instead_of_map`\n-  --> $DIR/rename.rs:67:9\n+  --> $DIR/rename.rs:66:9\n    |\n LL | #![warn(clippy::option_and_then_some)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::bind_instead_of_map`\n \n error: lint `clippy::option_expect_used` has been renamed to `clippy::expect_used`\n-  --> $DIR/rename.rs:68:9\n+  --> $DIR/rename.rs:67:9\n    |\n LL | #![warn(clippy::option_expect_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::expect_used`\n \n error: lint `clippy::option_map_unwrap_or` has been renamed to `clippy::map_unwrap_or`\n-  --> $DIR/rename.rs:69:9\n+  --> $DIR/rename.rs:68:9\n    |\n LL | #![warn(clippy::option_map_unwrap_or)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::map_unwrap_or`\n \n error: lint `clippy::option_map_unwrap_or_else` has been renamed to `clippy::map_unwrap_or`\n-  --> $DIR/rename.rs:70:9\n+  --> $DIR/rename.rs:69:9\n    |\n LL | #![warn(clippy::option_map_unwrap_or_else)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::map_unwrap_or`\n \n error: lint `clippy::option_unwrap_used` has been renamed to `clippy::unwrap_used`\n-  --> $DIR/rename.rs:71:9\n+  --> $DIR/rename.rs:70:9\n    |\n LL | #![warn(clippy::option_unwrap_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::unwrap_used`\n \n error: lint `clippy::ref_in_deref` has been renamed to `clippy::needless_borrow`\n-  --> $DIR/rename.rs:72:9\n+  --> $DIR/rename.rs:71:9\n    |\n LL | #![warn(clippy::ref_in_deref)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::needless_borrow`\n \n error: lint `clippy::result_expect_used` has been renamed to `clippy::expect_used`\n-  --> $DIR/rename.rs:73:9\n+  --> $DIR/rename.rs:72:9\n    |\n LL | #![warn(clippy::result_expect_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::expect_used`\n \n error: lint `clippy::result_map_unwrap_or_else` has been renamed to `clippy::map_unwrap_or`\n-  --> $DIR/rename.rs:74:9\n+  --> $DIR/rename.rs:73:9\n    |\n LL | #![warn(clippy::result_map_unwrap_or_else)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::map_unwrap_or`\n \n error: lint `clippy::result_unwrap_used` has been renamed to `clippy::unwrap_used`\n-  --> $DIR/rename.rs:75:9\n+  --> $DIR/rename.rs:74:9\n    |\n LL | #![warn(clippy::result_unwrap_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::unwrap_used`\n \n error: lint `clippy::single_char_push_str` has been renamed to `clippy::single_char_add_str`\n-  --> $DIR/rename.rs:76:9\n+  --> $DIR/rename.rs:75:9\n    |\n LL | #![warn(clippy::single_char_push_str)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::single_char_add_str`\n \n error: lint `clippy::stutter` has been renamed to `clippy::module_name_repetitions`\n-  --> $DIR/rename.rs:77:9\n+  --> $DIR/rename.rs:76:9\n    |\n LL | #![warn(clippy::stutter)]\n    |         ^^^^^^^^^^^^^^^ help: use the new name: `clippy::module_name_repetitions`\n \n error: lint `clippy::to_string_in_display` has been renamed to `clippy::recursive_format_impl`\n-  --> $DIR/rename.rs:78:9\n+  --> $DIR/rename.rs:77:9\n    |\n LL | #![warn(clippy::to_string_in_display)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::recursive_format_impl`\n \n error: lint `clippy::zero_width_space` has been renamed to `clippy::invisible_characters`\n-  --> $DIR/rename.rs:79:9\n+  --> $DIR/rename.rs:78:9\n    |\n LL | #![warn(clippy::zero_width_space)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::invisible_characters`\n \n error: lint `clippy::cast_ref_to_mut` has been renamed to `cast_ref_to_mut`\n-  --> $DIR/rename.rs:80:9\n+  --> $DIR/rename.rs:79:9\n    |\n LL | #![warn(clippy::cast_ref_to_mut)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `cast_ref_to_mut`\n \n error: lint `clippy::clone_double_ref` has been renamed to `suspicious_double_ref_op`\n-  --> $DIR/rename.rs:81:9\n+  --> $DIR/rename.rs:80:9\n    |\n LL | #![warn(clippy::clone_double_ref)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `suspicious_double_ref_op`\n \n error: lint `clippy::drop_bounds` has been renamed to `drop_bounds`\n-  --> $DIR/rename.rs:82:9\n+  --> $DIR/rename.rs:81:9\n    |\n LL | #![warn(clippy::drop_bounds)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `drop_bounds`\n \n error: lint `clippy::drop_copy` has been renamed to `dropping_copy_types`\n-  --> $DIR/rename.rs:83:9\n+  --> $DIR/rename.rs:82:9\n    |\n LL | #![warn(clippy::drop_copy)]\n    |         ^^^^^^^^^^^^^^^^^ help: use the new name: `dropping_copy_types`\n \n error: lint `clippy::drop_ref` has been renamed to `dropping_references`\n-  --> $DIR/rename.rs:84:9\n+  --> $DIR/rename.rs:83:9\n    |\n LL | #![warn(clippy::drop_ref)]\n    |         ^^^^^^^^^^^^^^^^ help: use the new name: `dropping_references`\n \n error: lint `clippy::for_loop_over_option` has been renamed to `for_loops_over_fallibles`\n-  --> $DIR/rename.rs:85:9\n+  --> $DIR/rename.rs:84:9\n    |\n LL | #![warn(clippy::for_loop_over_option)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n error: lint `clippy::for_loop_over_result` has been renamed to `for_loops_over_fallibles`\n-  --> $DIR/rename.rs:86:9\n+  --> $DIR/rename.rs:85:9\n    |\n LL | #![warn(clippy::for_loop_over_result)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n error: lint `clippy::for_loops_over_fallibles` has been renamed to `for_loops_over_fallibles`\n-  --> $DIR/rename.rs:87:9\n+  --> $DIR/rename.rs:86:9\n    |\n LL | #![warn(clippy::for_loops_over_fallibles)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n error: lint `clippy::forget_copy` has been renamed to `forgetting_copy_types`\n-  --> $DIR/rename.rs:88:9\n+  --> $DIR/rename.rs:87:9\n    |\n LL | #![warn(clippy::forget_copy)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `forgetting_copy_types`\n \n error: lint `clippy::forget_ref` has been renamed to `forgetting_references`\n-  --> $DIR/rename.rs:89:9\n+  --> $DIR/rename.rs:88:9\n    |\n LL | #![warn(clippy::forget_ref)]\n    |         ^^^^^^^^^^^^^^^^^^ help: use the new name: `forgetting_references`\n \n error: lint `clippy::into_iter_on_array` has been renamed to `array_into_iter`\n-  --> $DIR/rename.rs:90:9\n+  --> $DIR/rename.rs:89:9\n    |\n LL | #![warn(clippy::into_iter_on_array)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `array_into_iter`\n \n error: lint `clippy::invalid_atomic_ordering` has been renamed to `invalid_atomic_ordering`\n-  --> $DIR/rename.rs:91:9\n+  --> $DIR/rename.rs:90:9\n    |\n LL | #![warn(clippy::invalid_atomic_ordering)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_atomic_ordering`\n \n error: lint `clippy::invalid_ref` has been renamed to `invalid_value`\n-  --> $DIR/rename.rs:92:9\n+  --> $DIR/rename.rs:91:9\n    |\n LL | #![warn(clippy::invalid_ref)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_value`\n \n error: lint `clippy::invalid_utf8_in_unchecked` has been renamed to `invalid_from_utf8_unchecked`\n-  --> $DIR/rename.rs:93:9\n+  --> $DIR/rename.rs:92:9\n    |\n LL | #![warn(clippy::invalid_utf8_in_unchecked)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_from_utf8_unchecked`\n \n error: lint `clippy::let_underscore_drop` has been renamed to `let_underscore_drop`\n-  --> $DIR/rename.rs:94:9\n+  --> $DIR/rename.rs:93:9\n    |\n LL | #![warn(clippy::let_underscore_drop)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `let_underscore_drop`\n \n error: lint `clippy::mem_discriminant_non_enum` has been renamed to `enum_intrinsics_non_enums`\n-  --> $DIR/rename.rs:95:9\n+  --> $DIR/rename.rs:94:9\n    |\n LL | #![warn(clippy::mem_discriminant_non_enum)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `enum_intrinsics_non_enums`\n \n error: lint `clippy::panic_params` has been renamed to `non_fmt_panics`\n-  --> $DIR/rename.rs:96:9\n+  --> $DIR/rename.rs:95:9\n    |\n LL | #![warn(clippy::panic_params)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `non_fmt_panics`\n \n error: lint `clippy::positional_named_format_parameters` has been renamed to `named_arguments_used_positionally`\n-  --> $DIR/rename.rs:97:9\n+  --> $DIR/rename.rs:96:9\n    |\n LL | #![warn(clippy::positional_named_format_parameters)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `named_arguments_used_positionally`\n \n error: lint `clippy::temporary_cstring_as_ptr` has been renamed to `temporary_cstring_as_ptr`\n-  --> $DIR/rename.rs:98:9\n+  --> $DIR/rename.rs:97:9\n    |\n LL | #![warn(clippy::temporary_cstring_as_ptr)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `temporary_cstring_as_ptr`\n \n error: lint `clippy::unknown_clippy_lints` has been renamed to `unknown_lints`\n-  --> $DIR/rename.rs:99:9\n+  --> $DIR/rename.rs:98:9\n    |\n LL | #![warn(clippy::unknown_clippy_lints)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `unknown_lints`\n \n error: lint `clippy::unused_label` has been renamed to `unused_labels`\n-  --> $DIR/rename.rs:100:9\n+  --> $DIR/rename.rs:99:9\n    |\n LL | #![warn(clippy::unused_label)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `unused_labels`"}, {"sha": "77a2cf3b991f6064fd506b67ce10979144455dbd", "filename": "tests/ui/single_match.fixed", "status": "added", "additions": 209, "deletions": 0, "changes": 209, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_match.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,209 @@\n+//@run-rustfix\n+#![warn(clippy::single_match)]\n+#![allow(unused, clippy::uninlined_format_args, clippy::redundant_pattern_matching)]\n+fn dummy() {}\n+\n+fn single_match() {\n+    let x = Some(1u8);\n+\n+    if let Some(y) = x {\n+        println!(\"{:?}\", y);\n+    };\n+\n+    let x = Some(1u8);\n+    if let Some(y) = x { println!(\"{:?}\", y) }\n+\n+    let z = (1u8, 1u8);\n+    if let (2..=3, 7..=9) = z { dummy() };\n+\n+    // Not linted (pattern guards used)\n+    match x {\n+        Some(y) if y == 0 => println!(\"{:?}\", y),\n+        _ => (),\n+    }\n+\n+    // Not linted (no block with statements in the single arm)\n+    match z {\n+        (2..=3, 7..=9) => println!(\"{:?}\", z),\n+        _ => println!(\"nope\"),\n+    }\n+}\n+\n+enum Foo {\n+    Bar,\n+    Baz(u8),\n+}\n+use std::borrow::Cow;\n+use Foo::*;\n+\n+fn single_match_know_enum() {\n+    let x = Some(1u8);\n+    let y: Result<_, i8> = Ok(1i8);\n+\n+    if let Some(y) = x { dummy() };\n+\n+    if let Ok(y) = y { dummy() };\n+\n+    let c = Cow::Borrowed(\"\");\n+\n+    if let Cow::Borrowed(..) = c { dummy() };\n+\n+    let z = Foo::Bar;\n+    // no warning\n+    match z {\n+        Bar => println!(\"42\"),\n+        Baz(_) => (),\n+    }\n+\n+    match z {\n+        Baz(_) => println!(\"42\"),\n+        Bar => (),\n+    }\n+}\n+\n+// issue #173\n+fn if_suggestion() {\n+    let x = \"test\";\n+    if x == \"test\" { println!() }\n+\n+    #[derive(PartialEq, Eq)]\n+    enum Foo {\n+        A,\n+        B,\n+        C(u32),\n+    }\n+\n+    let x = Foo::A;\n+    if x == Foo::A { println!() }\n+\n+    const FOO_C: Foo = Foo::C(0);\n+    if x == FOO_C { println!() }\n+\n+    if x == Foo::A { println!() }\n+\n+    let x = &x;\n+    if x == &Foo::A { println!() }\n+\n+    enum Bar {\n+        A,\n+        B,\n+    }\n+    impl PartialEq for Bar {\n+        fn eq(&self, rhs: &Self) -> bool {\n+            matches!((self, rhs), (Self::A, Self::A) | (Self::B, Self::B))\n+        }\n+    }\n+    impl Eq for Bar {}\n+\n+    let x = Bar::A;\n+    if let Bar::A = x { println!() }\n+\n+    // issue #7038\n+    struct X;\n+    let x = Some(X);\n+    if let None = x { println!() };\n+}\n+\n+// See: issue #8282\n+fn ranges() {\n+    enum E {\n+        V,\n+    }\n+    let x = (Some(E::V), Some(42));\n+\n+    // Don't lint, because the `E` enum can be extended with additional fields later. Thus, the\n+    // proposed replacement to `if let Some(E::V)` may hide non-exhaustive warnings that appeared\n+    // because of `match` construction.\n+    match x {\n+        (Some(E::V), _) => {},\n+        (None, _) => {},\n+    }\n+\n+    // lint\n+    if let (Some(_), _) = x {}\n+\n+    // lint\n+    if let (Some(E::V), _) = x { todo!() }\n+\n+    // lint\n+    if let (.., Some(E::V), _) = (Some(42), Some(E::V), Some(42)) {}\n+\n+    // Don't lint, see above.\n+    match (Some(E::V), Some(E::V), Some(E::V)) {\n+        (.., Some(E::V), _) => {},\n+        (.., None, _) => {},\n+    }\n+\n+    // Don't lint, see above.\n+    match (Some(E::V), Some(E::V), Some(E::V)) {\n+        (Some(E::V), ..) => {},\n+        (None, ..) => {},\n+    }\n+\n+    // Don't lint, see above.\n+    match (Some(E::V), Some(E::V), Some(E::V)) {\n+        (_, Some(E::V), ..) => {},\n+        (_, None, ..) => {},\n+    }\n+}\n+\n+fn skip_type_aliases() {\n+    enum OptionEx {\n+        Some(i32),\n+        None,\n+    }\n+    enum ResultEx {\n+        Err(i32),\n+        Ok(i32),\n+    }\n+\n+    use OptionEx::{None, Some};\n+    use ResultEx::{Err, Ok};\n+\n+    // don't lint\n+    match Err(42) {\n+        Ok(_) => dummy(),\n+        Err(_) => (),\n+    };\n+\n+    // don't lint\n+    match Some(1i32) {\n+        Some(_) => dummy(),\n+        None => (),\n+    };\n+}\n+\n+macro_rules! single_match {\n+    ($num:literal) => {\n+        match $num {\n+            15 => println!(\"15\"),\n+            _ => (),\n+        }\n+    };\n+}\n+\n+fn main() {\n+    single_match!(5);\n+\n+    // Don't lint\n+    let _ = match Some(0) {\n+        #[cfg(feature = \"foo\")]\n+        Some(10) => 11,\n+        Some(x) => x,\n+        _ => 0,\n+    };\n+}\n+\n+fn issue_10808(bar: Option<i32>) {\n+    if let Some(v) = bar { unsafe {\n+        let r = &v as *const i32;\n+        println!(\"{}\", *r);\n+    } }\n+\n+    if let Some(v) = bar {\n+        unsafe {\n+            let r = &v as *const i32;\n+            println!(\"{}\", *r);\n+        }\n+    }\n+}"}, {"sha": "8d0ab5b99ad51e84e8b9066d277acf3cc12b3c9e", "filename": "tests/ui/single_match.rs", "status": "modified", "additions": 23, "deletions": 2, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_match.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,6 +1,6 @@\n+//@run-rustfix\n #![warn(clippy::single_match)]\n-#![allow(clippy::uninlined_format_args)]\n-\n+#![allow(unused, clippy::uninlined_format_args, clippy::redundant_pattern_matching)]\n fn dummy() {}\n \n fn single_match() {\n@@ -244,3 +244,24 @@ fn main() {\n         _ => 0,\n     };\n }\n+\n+fn issue_10808(bar: Option<i32>) {\n+    match bar {\n+        Some(v) => unsafe {\n+            let r = &v as *const i32;\n+            println!(\"{}\", *r);\n+        },\n+        _ => {},\n+    }\n+\n+    match bar {\n+        #[rustfmt::skip]\n+        Some(v) => {\n+            unsafe {\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+        _ => {},\n+    }\n+}"}, {"sha": "dad66e2ab2ec3aa7c352945efc993691362fdf86", "filename": "tests/ui/single_match.stderr", "status": "modified", "additions": 43, "deletions": 1, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_match.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -155,5 +155,47 @@ LL | |         (..) => {},\n LL | |     }\n    | |_____^ help: try this: `if let (.., Some(E::V), _) = (Some(42), Some(E::V), Some(42)) {}`\n \n-error: aborting due to 16 previous errors\n+error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`\n+  --> $DIR/single_match.rs:249:5\n+   |\n+LL | /     match bar {\n+LL | |         Some(v) => unsafe {\n+LL | |             let r = &v as *const i32;\n+LL | |             println!(\"{}\", *r);\n+LL | |         },\n+LL | |         _ => {},\n+LL | |     }\n+   | |_____^\n+   |\n+help: try this\n+   |\n+LL ~     if let Some(v) = bar { unsafe {\n+LL +         let r = &v as *const i32;\n+LL +         println!(\"{}\", *r);\n+LL +     } }\n+   |\n+\n+error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`\n+  --> $DIR/single_match.rs:257:5\n+   |\n+LL | /     match bar {\n+LL | |         #[rustfmt::skip]\n+LL | |         Some(v) => {\n+LL | |             unsafe {\n+...  |\n+LL | |         _ => {},\n+LL | |     }\n+   | |_____^\n+   |\n+help: try this\n+   |\n+LL ~     if let Some(v) = bar {\n+LL +         unsafe {\n+LL +             let r = &v as *const i32;\n+LL +             println!(\"{}\", *r);\n+LL +         }\n+LL +     }\n+   |\n+\n+error: aborting due to 18 previous errors\n "}, {"sha": "f88498655a41850601deca91cf2fd026c7f2f278", "filename": "tests/ui/single_match_else.fixed", "status": "added", "additions": 173, "deletions": 0, "changes": 173, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match_else.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match_else.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_match_else.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -0,0 +1,173 @@\n+//@run-rustfix\n+//@aux-build: proc_macros.rs\n+#![warn(clippy::single_match_else)]\n+#![allow(unused, clippy::needless_return, clippy::no_effect, clippy::uninlined_format_args)]\n+extern crate proc_macros;\n+use proc_macros::with_span;\n+\n+enum ExprNode {\n+    ExprAddrOf,\n+    Butterflies,\n+    Unicorns,\n+}\n+\n+static NODE: ExprNode = ExprNode::Unicorns;\n+\n+fn unwrap_addr() -> Option<&'static ExprNode> {\n+    let _ = if let ExprNode::ExprAddrOf = ExprNode::Butterflies { Some(&NODE) } else {\n+        let x = 5;\n+        None\n+    };\n+\n+    // Don't lint\n+    with_span!(span match ExprNode::Butterflies {\n+        ExprNode::ExprAddrOf => Some(&NODE),\n+        _ => {\n+            let x = 5;\n+            None\n+        },\n+    })\n+}\n+\n+macro_rules! unwrap_addr {\n+    ($expression:expr) => {\n+        match $expression {\n+            ExprNode::ExprAddrOf => Some(&NODE),\n+            _ => {\n+                let x = 5;\n+                None\n+            },\n+        }\n+    };\n+}\n+\n+#[rustfmt::skip]\n+fn main() {\n+    unwrap_addr!(ExprNode::Unicorns);\n+\n+    //\n+    // don't lint single exprs/statements\n+    //\n+\n+    // don't lint here\n+    match Some(1) {\n+        Some(a) => println!(\"${:?}\", a),\n+        None => return,\n+    }\n+\n+    // don't lint here\n+    match Some(1) {\n+        Some(a) => println!(\"${:?}\", a),\n+        None => {\n+            return\n+        },\n+    }\n+\n+    // don't lint here\n+    match Some(1) {\n+        Some(a) => println!(\"${:?}\", a),\n+        None => {\n+            return;\n+        },\n+    }\n+\n+    //\n+    // lint multiple exprs/statements \"else\" blocks\n+    //\n+\n+    // lint here\n+    if let Some(a) = Some(1) { println!(\"${:?}\", a) } else {\n+        println!(\"else block\");\n+        return\n+    }\n+\n+    // lint here\n+    if let Some(a) = Some(1) { println!(\"${:?}\", a) } else {\n+        println!(\"else block\");\n+        return;\n+    }\n+\n+    // lint here\n+    use std::convert::Infallible;\n+    if let Ok(a) = Result::<i32, Infallible>::Ok(1) { println!(\"${:?}\", a) } else {\n+        println!(\"else block\");\n+        return;\n+    }\n+\n+    use std::borrow::Cow;\n+    if let Cow::Owned(a) = Cow::from(\"moo\") { println!(\"${:?}\", a) } else {\n+        println!(\"else block\");\n+        return;\n+    }\n+}\n+\n+fn issue_10808(bar: Option<i32>) {\n+    if let Some(v) = bar { unsafe {\n+        let r = &v as *const i32;\n+        println!(\"{}\", *r);\n+    } } else {\n+        println!(\"None1\");\n+        println!(\"None2\");\n+    }\n+\n+    if let Some(v) = bar {\n+        println!(\"Some\");\n+        println!(\"{v}\");\n+    } else { unsafe {\n+        let v = 0;\n+        let r = &v as *const i32;\n+        println!(\"{}\", *r);\n+    } }\n+\n+    if let Some(v) = bar { unsafe {\n+        let r = &v as *const i32;\n+        println!(\"{}\", *r);\n+    } } else { unsafe {\n+        let v = 0;\n+        let r = &v as *const i32;\n+        println!(\"{}\", *r);\n+    } }\n+\n+    if let Some(v) = bar {\n+        unsafe {\n+            let r = &v as *const i32;\n+            println!(\"{}\", *r);\n+        }\n+    } else {\n+        println!(\"None\");\n+        println!(\"None\");\n+    }\n+\n+    match bar {\n+        Some(v) => {\n+            println!(\"Some\");\n+            println!(\"{v}\");\n+        },\n+        #[rustfmt::skip]\n+        None => {\n+            unsafe {\n+                let v = 0;\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+    }\n+\n+    match bar {\n+        #[rustfmt::skip]\n+        Some(v) => {\n+            unsafe {\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+        #[rustfmt::skip]\n+        None => {\n+            unsafe {\n+                let v = 0;\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+    }\n+}"}, {"sha": "b34b95539190cdbd4389364a6485e00afa3edc05", "filename": "tests/ui/single_match_else.rs", "status": "modified", "additions": 86, "deletions": 2, "changes": 88, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_match_else.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,7 +1,7 @@\n+//@run-rustfix\n //@aux-build: proc_macros.rs\n #![warn(clippy::single_match_else)]\n-#![allow(clippy::needless_return, clippy::no_effect, clippy::uninlined_format_args)]\n-\n+#![allow(unused, clippy::needless_return, clippy::no_effect, clippy::uninlined_format_args)]\n extern crate proc_macros;\n use proc_macros::with_span;\n \n@@ -115,3 +115,87 @@ fn main() {\n         }\n     }\n }\n+\n+fn issue_10808(bar: Option<i32>) {\n+    match bar {\n+        Some(v) => unsafe {\n+            let r = &v as *const i32;\n+            println!(\"{}\", *r);\n+        },\n+        None => {\n+            println!(\"None1\");\n+            println!(\"None2\");\n+        },\n+    }\n+\n+    match bar {\n+        Some(v) => {\n+            println!(\"Some\");\n+            println!(\"{v}\");\n+        },\n+        None => unsafe {\n+            let v = 0;\n+            let r = &v as *const i32;\n+            println!(\"{}\", *r);\n+        },\n+    }\n+\n+    match bar {\n+        Some(v) => unsafe {\n+            let r = &v as *const i32;\n+            println!(\"{}\", *r);\n+        },\n+        None => unsafe {\n+            let v = 0;\n+            let r = &v as *const i32;\n+            println!(\"{}\", *r);\n+        },\n+    }\n+\n+    match bar {\n+        #[rustfmt::skip]\n+        Some(v) => {\n+            unsafe {\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+        None => {\n+            println!(\"None\");\n+            println!(\"None\");\n+        },\n+    }\n+\n+    match bar {\n+        Some(v) => {\n+            println!(\"Some\");\n+            println!(\"{v}\");\n+        },\n+        #[rustfmt::skip]\n+        None => {\n+            unsafe {\n+                let v = 0;\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+    }\n+\n+    match bar {\n+        #[rustfmt::skip]\n+        Some(v) => {\n+            unsafe {\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+        #[rustfmt::skip]\n+        None => {\n+            unsafe {\n+                let v = 0;\n+                let r = &v as *const i32;\n+                println!(\"{}\", *r);\n+            }\n+        },\n+    }\n+}"}, {"sha": "228236f3bb8e84723d79d270f15eefe2599a1491", "filename": "tests/ui/single_match_else.stderr", "status": "modified", "additions": 97, "deletions": 1, "changes": 98, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match_else.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsingle_match_else.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_match_else.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -100,5 +100,101 @@ LL +         return;\n LL +     }\n    |\n \n-error: aborting due to 5 previous errors\n+error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`\n+  --> $DIR/single_match_else.rs:120:5\n+   |\n+LL | /     match bar {\n+LL | |         Some(v) => unsafe {\n+LL | |             let r = &v as *const i32;\n+LL | |             println!(\"{}\", *r);\n+...  |\n+LL | |         },\n+LL | |     }\n+   | |_____^\n+   |\n+help: try this\n+   |\n+LL ~     if let Some(v) = bar { unsafe {\n+LL +         let r = &v as *const i32;\n+LL +         println!(\"{}\", *r);\n+LL +     } } else {\n+LL +         println!(\"None1\");\n+LL +         println!(\"None2\");\n+LL +     }\n+   |\n+\n+error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`\n+  --> $DIR/single_match_else.rs:131:5\n+   |\n+LL | /     match bar {\n+LL | |         Some(v) => {\n+LL | |             println!(\"Some\");\n+LL | |             println!(\"{v}\");\n+...  |\n+LL | |         },\n+LL | |     }\n+   | |_____^\n+   |\n+help: try this\n+   |\n+LL ~     if let Some(v) = bar {\n+LL +         println!(\"Some\");\n+LL +         println!(\"{v}\");\n+LL +     } else { unsafe {\n+LL +         let v = 0;\n+LL +         let r = &v as *const i32;\n+LL +         println!(\"{}\", *r);\n+LL +     } }\n+   |\n+\n+error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`\n+  --> $DIR/single_match_else.rs:143:5\n+   |\n+LL | /     match bar {\n+LL | |         Some(v) => unsafe {\n+LL | |             let r = &v as *const i32;\n+LL | |             println!(\"{}\", *r);\n+...  |\n+LL | |         },\n+LL | |     }\n+   | |_____^\n+   |\n+help: try this\n+   |\n+LL ~     if let Some(v) = bar { unsafe {\n+LL +         let r = &v as *const i32;\n+LL +         println!(\"{}\", *r);\n+LL +     } } else { unsafe {\n+LL +         let v = 0;\n+LL +         let r = &v as *const i32;\n+LL +         println!(\"{}\", *r);\n+LL +     } }\n+   |\n+\n+error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`\n+  --> $DIR/single_match_else.rs:155:5\n+   |\n+LL | /     match bar {\n+LL | |         #[rustfmt::skip]\n+LL | |         Some(v) => {\n+LL | |             unsafe {\n+...  |\n+LL | |         },\n+LL | |     }\n+   | |_____^\n+   |\n+help: try this\n+   |\n+LL ~     if let Some(v) = bar {\n+LL +         unsafe {\n+LL +             let r = &v as *const i32;\n+LL +             println!(\"{}\", *r);\n+LL +         }\n+LL +     } else {\n+LL +         println!(\"None\");\n+LL +         println!(\"None\");\n+LL +     }\n+   |\n+\n+error: aborting due to 9 previous errors\n "}, {"sha": "4823d9092089b291953261da687cc0b8bce81515", "filename": "tests/ui/suspicious_else_formatting.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsuspicious_else_formatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fsuspicious_else_formatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsuspicious_else_formatting.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,7 +1,7 @@\n //@aux-build:proc_macro_suspicious_else_formatting.rs\n \n #![warn(clippy::suspicious_else_formatting)]\n-#![allow(clippy::if_same_then_else, clippy::let_unit_value)]\n+#![allow(clippy::if_same_then_else, clippy::let_unit_value, clippy::needless_else)]\n \n extern crate proc_macro_suspicious_else_formatting;\n use proc_macro_suspicious_else_formatting::DeriveBadSpan;"}, {"sha": "ac4c1bc65979fb5f38661d3f8ac37487ef802e89", "filename": "tests/ui/temporary_assignment.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Ftemporary_assignment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Ftemporary_assignment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftemporary_assignment.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,5 +1,4 @@\n #![warn(clippy::temporary_assignment)]\n-#![allow(const_item_mutation)]\n \n use std::ops::{Deref, DerefMut};\n "}, {"sha": "7d79901a28d1be70a17f22f33806278c09b0e340", "filename": "tests/ui/temporary_assignment.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Ftemporary_assignment.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Ftemporary_assignment.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftemporary_assignment.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,13 +1,13 @@\n error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:48:5\n+  --> $DIR/temporary_assignment.rs:47:5\n    |\n LL |     Struct { field: 0 }.field = 1;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: `-D clippy::temporary-assignment` implied by `-D warnings`\n \n error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:49:5\n+  --> $DIR/temporary_assignment.rs:48:5\n    |\n LL | /     MultiStruct {\n LL | |         structure: Struct { field: 0 },\n@@ -17,13 +17,13 @@ LL | |     .field = 1;\n    | |______________^\n \n error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:54:5\n+  --> $DIR/temporary_assignment.rs:53:5\n    |\n LL |     ArrayStruct { array: [0] }.array[0] = 1;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:55:5\n+  --> $DIR/temporary_assignment.rs:54:5\n    |\n LL |     (0, 0).0 = 1;\n    |     ^^^^^^^^^^^^"}, {"sha": "bfaa5dadfa59ee2a56e259d84a5bf2ef41dd9584", "filename": "tests/ui/unused_async.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Funused_async.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Funused_async.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funused_async.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -3,6 +3,26 @@\n use std::future::Future;\n use std::pin::Pin;\n \n+mod issue10800 {\n+    #![allow(dead_code, unused_must_use, clippy::no_effect)]\n+\n+    use std::future::ready;\n+\n+    async fn async_block_await() {\n+        async {\n+            ready(()).await;\n+        };\n+    }\n+\n+    async fn normal_block_await() {\n+        {\n+            {\n+                ready(()).await;\n+            }\n+        }\n+    }\n+}\n+\n async fn foo() -> i32 {\n     4\n }"}, {"sha": "8ac2066a6b24dd62619491e7ee8ec6547935a005", "filename": "tests/ui/unused_async.stderr", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Funused_async.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Funused_async.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funused_async.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -1,16 +1,33 @@\n error: unused `async` for function with no await statements\n-  --> $DIR/unused_async.rs:6:1\n+  --> $DIR/unused_async.rs:11:5\n+   |\n+LL | /     async fn async_block_await() {\n+LL | |         async {\n+LL | |             ready(()).await;\n+LL | |         };\n+LL | |     }\n+   | |_____^\n+   |\n+   = help: consider removing the `async` from this function\n+note: `await` used in an async block, which does not require the enclosing function to be `async`\n+  --> $DIR/unused_async.rs:13:23\n+   |\n+LL |             ready(()).await;\n+   |                       ^^^^^\n+   = note: `-D clippy::unused-async` implied by `-D warnings`\n+\n+error: unused `async` for function with no await statements\n+  --> $DIR/unused_async.rs:26:1\n    |\n LL | / async fn foo() -> i32 {\n LL | |     4\n LL | | }\n    | |_^\n    |\n    = help: consider removing the `async` from this function\n-   = note: `-D clippy::unused-async` implied by `-D warnings`\n \n error: unused `async` for function with no await statements\n-  --> $DIR/unused_async.rs:17:5\n+  --> $DIR/unused_async.rs:37:5\n    |\n LL | /     async fn unused(&self) -> i32 {\n LL | |         1\n@@ -19,5 +36,5 @@ LL | |     }\n    |\n    = help: consider removing the `async` from this function\n \n-error: aborting due to 2 previous errors\n+error: aborting due to 3 previous errors\n "}, {"sha": "733bbcfbcefab5e9db422f0cd7b8091fe8919ffb", "filename": "tests/ui/wildcard_imports.fixed", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fwildcard_imports.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fwildcard_imports.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports.fixed?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -24,6 +24,7 @@ use wildcard_imports_helper::inner::inner_for_self_import::inner_extern_bar;\n use wildcard_imports_helper::{ExternA, extern_foo};\n \n use std::io::prelude::*;\n+use wildcard_imports_helper::extern_prelude::v1::*;\n use wildcard_imports_helper::prelude::v1::*;\n \n struct ReadFoo;\n@@ -81,6 +82,7 @@ fn main() {\n     let _ = inner_struct_mod::C;\n     let _ = ExternA;\n     let _ = PreludeModAnywhere;\n+    let _ = ExternPreludeModAnywhere;\n \n     double_struct_import_test!();\n     double_struct_import_test!();"}, {"sha": "4acdd374bdeca85d08188866264009ca3929fe04", "filename": "tests/ui/wildcard_imports.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fwildcard_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fwildcard_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports.rs?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -24,6 +24,7 @@ use wildcard_imports_helper::inner::inner_for_self_import::*;\n use wildcard_imports_helper::*;\n \n use std::io::prelude::*;\n+use wildcard_imports_helper::extern_prelude::v1::*;\n use wildcard_imports_helper::prelude::v1::*;\n \n struct ReadFoo;\n@@ -81,6 +82,7 @@ fn main() {\n     let _ = inner_struct_mod::C;\n     let _ = ExternA;\n     let _ = PreludeModAnywhere;\n+    let _ = ExternPreludeModAnywhere;\n \n     double_struct_import_test!();\n     double_struct_import_test!();"}, {"sha": "235be2d57081b353228bd9211fc22ab134864c0e", "filename": "tests/ui/wildcard_imports.stderr", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fwildcard_imports.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa3247c891bd50c305adfa26c4d1072f2c1e532c/tests%2Fui%2Fwildcard_imports.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports.stderr?ref=aa3247c891bd50c305adfa26c4d1072f2c1e532c", "patch": "@@ -37,93 +37,93 @@ LL | use wildcard_imports_helper::*;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `wildcard_imports_helper::{ExternA, extern_foo}`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:95:13\n+  --> $DIR/wildcard_imports.rs:97:13\n    |\n LL |         use crate::fn_mod::*;\n    |             ^^^^^^^^^^^^^^^^ help: try: `crate::fn_mod::foo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:101:75\n+  --> $DIR/wildcard_imports.rs:103:75\n    |\n LL |         use wildcard_imports_helper::inner::inner_for_self_import::{self, *};\n    |                                                                           ^ help: try: `inner_extern_foo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:102:13\n+  --> $DIR/wildcard_imports.rs:104:13\n    |\n LL |         use wildcard_imports_helper::*;\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `wildcard_imports_helper::{ExternA, extern_foo}`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:113:20\n+  --> $DIR/wildcard_imports.rs:115:20\n    |\n LL |         use self::{inner::*, inner2::*};\n    |                    ^^^^^^^^ help: try: `inner::inner_foo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:113:30\n+  --> $DIR/wildcard_imports.rs:115:30\n    |\n LL |         use self::{inner::*, inner2::*};\n    |                              ^^^^^^^^^ help: try: `inner2::inner_bar`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:120:13\n+  --> $DIR/wildcard_imports.rs:122:13\n    |\n LL |         use wildcard_imports_helper::*;\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `wildcard_imports_helper::{ExternExportedEnum, ExternExportedStruct, extern_exported}`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:149:9\n+  --> $DIR/wildcard_imports.rs:151:9\n    |\n LL |     use crate::in_fn_test::*;\n    |         ^^^^^^^^^^^^^^^^^^^^ help: try: `crate::in_fn_test::{ExportedEnum, ExportedStruct, exported}`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:158:9\n+  --> $DIR/wildcard_imports.rs:160:9\n    |\n LL |     use crate:: in_fn_test::  * ;\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate:: in_fn_test::exported`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:159:9\n+  --> $DIR/wildcard_imports.rs:161:9\n    |\n LL |       use crate:: fn_mod::\n    |  _________^\n LL | |         *;\n    | |_________^ help: try: `crate:: fn_mod::foo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:170:13\n+  --> $DIR/wildcard_imports.rs:172:13\n    |\n LL |         use super::*;\n    |             ^^^^^^^^ help: try: `super::foofoo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:205:17\n+  --> $DIR/wildcard_imports.rs:207:17\n    |\n LL |             use super::*;\n    |                 ^^^^^^^^ help: try: `super::insidefoo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:213:13\n+  --> $DIR/wildcard_imports.rs:215:13\n    |\n LL |         use super_imports::*;\n    |             ^^^^^^^^^^^^^^^^ help: try: `super_imports::foofoo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:222:17\n+  --> $DIR/wildcard_imports.rs:224:17\n    |\n LL |             use super::super::*;\n    |                 ^^^^^^^^^^^^^^^ help: try: `super::super::foofoo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:231:13\n+  --> $DIR/wildcard_imports.rs:233:13\n    |\n LL |         use super::super::super_imports::*;\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `super::super::super_imports::foofoo`\n \n error: usage of wildcard import\n-  --> $DIR/wildcard_imports.rs:239:13\n+  --> $DIR/wildcard_imports.rs:241:13\n    |\n LL |         use super::*;\n    |             ^^^^^^^^ help: try: `super::foofoo`"}]}