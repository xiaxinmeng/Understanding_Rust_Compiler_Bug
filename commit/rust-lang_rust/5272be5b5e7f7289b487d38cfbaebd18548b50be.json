{"sha": "5272be5b5e7f7289b487d38cfbaebd18548b50be", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyNzJiZTViNWU3ZjcyODliNDg3ZDM4Y2ZiYWViZDE4NTQ4YjUwYmU=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-01-19T13:21:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-01-19T13:21:18Z"}, "message": "Rollup merge of #57502 - nikomatsakis:fix-trait-alias-1b, r=nikomatsakis\n\nmake trait-aliases work across crates\n\nThis is rebase of a small part of @alexreg's PR #55994. It focuses just on the changes that integrate trait aliases properly into crate metadata, excluding the stylistic edits and the trait objects.\n\nThe stylistic edits I also rebased and can open a separate PR.\n\nThe trait object stuff I found challenging and decided it basically needed to be reimplemented. For now I've excluded it.\n\nSince this is really @alexreg's work (I really just rebased) I am going to make it r=me once it is working.\n\nFixes #56488.\nFixes #57023.", "tree": {"sha": "5392e00013e1246f8a70520d1d44038261eb5ad1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5392e00013e1246f8a70520d1d44038261eb5ad1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5272be5b5e7f7289b487d38cfbaebd18548b50be", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcQyROCRBK7hj4Ov3rIwAAdHIIAAOlj/LcbAynmu8uNtIv3iKk\nhkj2to/hdKciNTBGDMLtzdPQdF83MscvFfm7JdFjQEW+yIa/jivj+/nViVaI2zFb\nYdC/lcieqgTFuOkXV3JOs7sVDT/y8AQqRbUKtoFMIO85BqB9+WALQT95xfcSnM4V\nupY0xyBSPWjvdVaCpeSX+dPVTmpWKyiw1KrIyVQ1xLw4286oKLc3u1jjnT+u5J5B\nLLOz2CfNe7t7Nj7dfPD9w2GEt+4pEirDdXXt+ZA2JNZewnra4k67Q1LkCI/OlutB\n2w/cnEUUqHHV9/JmqujfgIQSmoFuhsysiRczdafzTPVbe02/2mqdz26ksQeSh40=\n=Zrax\n-----END PGP SIGNATURE-----\n", "payload": "tree 5392e00013e1246f8a70520d1d44038261eb5ad1\nparent 349c9eeb355a979c2e51f832d05ce9212f0aeeba\nparent b411994b3b9a571db486cb7de9ea06b071a22b6c\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1547904078 +0100\ncommitter GitHub <noreply@github.com> 1547904078 +0100\n\nRollup merge of #57502 - nikomatsakis:fix-trait-alias-1b, r=nikomatsakis\n\nmake trait-aliases work across crates\n\nThis is rebase of a small part of @alexreg's PR #55994. It focuses just on the changes that integrate trait aliases properly into crate metadata, excluding the stylistic edits and the trait objects.\n\nThe stylistic edits I also rebased and can open a separate PR.\n\nThe trait object stuff I found challenging and decided it basically needed to be reimplemented. For now I've excluded it.\n\nSince this is really @alexreg's work (I really just rebased) I am going to make it r=me once it is working.\n\nFixes #56488.\nFixes #57023.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5272be5b5e7f7289b487d38cfbaebd18548b50be", "html_url": "https://github.com/rust-lang/rust/commit/5272be5b5e7f7289b487d38cfbaebd18548b50be", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5272be5b5e7f7289b487d38cfbaebd18548b50be/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "349c9eeb355a979c2e51f832d05ce9212f0aeeba", "url": "https://api.github.com/repos/rust-lang/rust/commits/349c9eeb355a979c2e51f832d05ce9212f0aeeba", "html_url": "https://github.com/rust-lang/rust/commit/349c9eeb355a979c2e51f832d05ce9212f0aeeba"}, {"sha": "b411994b3b9a571db486cb7de9ea06b071a22b6c", "url": "https://api.github.com/repos/rust-lang/rust/commits/b411994b3b9a571db486cb7de9ea06b071a22b6c", "html_url": "https://github.com/rust-lang/rust/commit/b411994b3b9a571db486cb7de9ea06b071a22b6c"}], "stats": {"total": 280, "additions": 223, "deletions": 57}, "files": [{"sha": "c9b4b2bb997178184d8a5dc8eaa5f2620f103cab", "filename": "src/librustc/hir/map/def_collector.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fhir%2Fmap%2Fdef_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fhir%2Fmap%2Fdef_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fdef_collector.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -120,10 +120,10 @@ impl<'a> visit::Visitor<'a> for DefCollector<'a> {\n         let def_data = match i.node {\n             ItemKind::Impl(..) => DefPathData::Impl,\n             ItemKind::Trait(..) => DefPathData::Trait(i.ident.as_interned_str()),\n+            ItemKind::TraitAlias(..) => DefPathData::TraitAlias(i.ident.as_interned_str()),\n             ItemKind::Enum(..) | ItemKind::Struct(..) | ItemKind::Union(..) |\n-            ItemKind::TraitAlias(..) | ItemKind::Existential(..) |\n-            ItemKind::ExternCrate(..) | ItemKind::ForeignMod(..) | ItemKind::Ty(..) =>\n-                DefPathData::TypeNs(i.ident.as_interned_str()),\n+            ItemKind::Existential(..) | ItemKind::ExternCrate(..) | ItemKind::ForeignMod(..) |\n+            ItemKind::Ty(..) => DefPathData::TypeNs(i.ident.as_interned_str()),\n             ItemKind::Mod(..) if i.ident == keywords::Invalid.ident() => {\n                 return visit::walk_item(self, i);\n             }"}, {"sha": "1b7445199475c4ccaf215afc2336fad9681148c9", "filename": "src/librustc/hir/map/definitions.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fhir%2Fmap%2Fdefinitions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fhir%2Fmap%2Fdefinitions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fdefinitions.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -373,7 +373,9 @@ pub enum DefPathData {\n     /// GlobalMetaData identifies a piece of crate metadata that is global to\n     /// a whole crate (as opposed to just one item). GlobalMetaData components\n     /// are only supposed to show up right below the crate root.\n-    GlobalMetaData(InternedString)\n+    GlobalMetaData(InternedString),\n+    /// A trait alias.\n+    TraitAlias(InternedString),\n }\n \n #[derive(Copy, Clone, Hash, PartialEq, Eq, PartialOrd, Ord, Debug,\n@@ -615,6 +617,7 @@ impl DefPathData {\n         match *self {\n             TypeNs(name) |\n             Trait(name) |\n+            TraitAlias(name) |\n             AssocTypeInTrait(name) |\n             AssocTypeInImpl(name) |\n             AssocExistentialInImpl(name) |\n@@ -642,6 +645,7 @@ impl DefPathData {\n         let s = match *self {\n             TypeNs(name) |\n             Trait(name) |\n+            TraitAlias(name) |\n             AssocTypeInTrait(name) |\n             AssocTypeInImpl(name) |\n             AssocExistentialInImpl(name) |"}, {"sha": "4fc50bce272fa0a8a49e863ae844003f0227c9a8", "filename": "src/librustc/hir/mod.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmod.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -10,6 +10,7 @@ pub use self::PrimTy::*;\n pub use self::UnOp::*;\n pub use self::UnsafeSource::*;\n \n+use errors::FatalError;\n use hir::def::Def;\n use hir::def_id::{DefId, DefIndex, LocalDefId, CRATE_DEF_INDEX};\n use util::nodemap::{NodeMap, FxHashSet};\n@@ -2055,6 +2056,20 @@ pub struct TraitRef {\n     pub hir_ref_id: HirId,\n }\n \n+impl TraitRef {\n+    /// Get the `DefId` of the referenced trait. It _must_ actually be a trait or trait alias.\n+    pub fn trait_def_id(&self) -> DefId {\n+        match self.path.def {\n+            Def::Trait(did) => did,\n+            Def::TraitAlias(did) => did,\n+            Def::Err => {\n+                FatalError.raise();\n+            }\n+            _ => unreachable!(),\n+        }\n+    }\n+}\n+\n #[derive(Clone, RustcEncodable, RustcDecodable, Debug)]\n pub struct PolyTraitRef {\n     /// The `'a` in `<'a> Foo<&'a T>`"}, {"sha": "9a0610f45dec2053ebe81d1b8c44a998c1fdb553", "filename": "src/librustc/traits/select.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Ftraits%2Fselect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Ftraits%2Fselect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fselect.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -2198,7 +2198,7 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n \n         let def_id = obligation.predicate.def_id();\n \n-        if ty::is_trait_alias(self.tcx(), def_id) {\n+        if self.tcx().is_trait_alias(def_id) {\n             candidates.vec.push(TraitAliasCandidate(def_id.clone()));\n         }\n "}, {"sha": "9328de4f6a0a15347913a486a3875852f9297b3c", "filename": "src/librustc/ty/item_path.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fty%2Fitem_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fty%2Fitem_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fitem_path.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -311,6 +311,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n             data @ DefPathData::Misc |\n             data @ DefPathData::TypeNs(..) |\n             data @ DefPathData::Trait(..) |\n+            data @ DefPathData::TraitAlias(..) |\n             data @ DefPathData::AssocTypeInTrait(..) |\n             data @ DefPathData::AssocTypeInImpl(..) |\n             data @ DefPathData::AssocExistentialInImpl(..) |"}, {"sha": "dd315cf42ce7e78a42801d71d16db690a5d84780", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -3170,18 +3170,6 @@ pub fn is_impl_trait_defn(tcx: TyCtxt<'_, '_, '_>, def_id: DefId) -> Option<DefI\n     None\n }\n \n-/// Returns `true` if `def_id` is a trait alias.\n-pub fn is_trait_alias(tcx: TyCtxt<'_, '_, '_>, def_id: DefId) -> bool {\n-    if let Some(node_id) = tcx.hir().as_local_node_id(def_id) {\n-        if let Node::Item(item) = tcx.hir().get(node_id) {\n-            if let hir::ItemKind::TraitAlias(..) = item.node {\n-                return true;\n-            }\n-        }\n-    }\n-    false\n-}\n-\n /// See `ParamEnv` struct definition for details.\n fn param_env<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                        def_id: DefId)"}, {"sha": "75fc0f716a2f6424319dc91d720bd0f3354a9a87", "filename": "src/librustc/ty/util.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fty%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Fty%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Futil.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -526,6 +526,15 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n         }\n     }\n \n+    /// True if `def_id` refers to a trait alias (i.e., `trait Foo = ...;`).\n+    pub fn is_trait_alias(self, def_id: DefId) -> bool {\n+        if let DefPathData::TraitAlias(_) = self.def_key(def_id).disambiguated_data.data {\n+            true\n+        } else {\n+            false\n+        }\n+    }\n+\n     /// True if this def-id refers to the implicit constructor for\n     /// a tuple struct like `struct Foo(u32)`.\n     pub fn is_struct_constructor(self, def_id: DefId) -> bool {"}, {"sha": "51e9192cd290d107d0f7d1f1ab12c2469b8f04a1", "filename": "src/librustc/util/ppaux.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Futil%2Fppaux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc%2Futil%2Fppaux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Futil%2Fppaux.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -409,6 +409,7 @@ impl PrintContext {\n                     DefPathData::AssocTypeInImpl(_) |\n                     DefPathData::AssocExistentialInImpl(_) |\n                     DefPathData::Trait(_) |\n+                    DefPathData::TraitAlias(_) |\n                     DefPathData::Impl |\n                     DefPathData::TypeNs(_) => {\n                         break;"}, {"sha": "1f07e8f478b5a05ef9803711aa6cf5fd6081b198", "filename": "src/librustc_metadata/decoder.rs", "status": "modified", "additions": 30, "deletions": 16, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_metadata%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_metadata%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fdecoder.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -418,6 +418,7 @@ impl<'tcx> EntryKind<'tcx> {\n             EntryKind::Mod(_) => Def::Mod(did),\n             EntryKind::Variant(_) => Def::Variant(did),\n             EntryKind::Trait(_) => Def::Trait(did),\n+            EntryKind::TraitAlias(_) => Def::TraitAlias(did),\n             EntryKind::Enum(..) => Def::Enum(did),\n             EntryKind::MacroDef(_) => Def::Macro(did, MacroKind::Bang),\n             EntryKind::ForeignType => Def::ForeignTy(did),\n@@ -520,17 +521,26 @@ impl<'a, 'tcx> CrateMetadata {\n     }\n \n     pub fn get_trait_def(&self, item_id: DefIndex, sess: &Session) -> ty::TraitDef {\n-        let data = match self.entry(item_id).kind {\n-            EntryKind::Trait(data) => data.decode((self, sess)),\n-            _ => bug!(),\n-        };\n-\n-        ty::TraitDef::new(self.local_def_id(item_id),\n-                          data.unsafety,\n-                          data.paren_sugar,\n-                          data.has_auto_impl,\n-                          data.is_marker,\n-                          self.def_path_table.def_path_hash(item_id))\n+        match self.entry(item_id).kind {\n+            EntryKind::Trait(data) => {\n+                let data = data.decode((self, sess));\n+                ty::TraitDef::new(self.local_def_id(item_id),\n+                                  data.unsafety,\n+                                  data.paren_sugar,\n+                                  data.has_auto_impl,\n+                                  data.is_marker,\n+                                  self.def_path_table.def_path_hash(item_id))\n+            },\n+            EntryKind::TraitAlias(_) => {\n+                ty::TraitDef::new(self.local_def_id(item_id),\n+                                  hir::Unsafety::Normal,\n+                                  false,\n+                                  false,\n+                                  false,\n+                                  self.def_path_table.def_path_hash(item_id))\n+            },\n+            _ => bug!(\"def-index does not refer to trait or trait alias\"),\n+        }\n     }\n \n     fn get_variant(&self,\n@@ -615,10 +625,13 @@ impl<'a, 'tcx> CrateMetadata {\n                                 item_id: DefIndex,\n                                 tcx: TyCtxt<'a, 'tcx, 'tcx>)\n                                 -> ty::GenericPredicates<'tcx> {\n-        match self.entry(item_id).kind {\n-            EntryKind::Trait(data) => data.decode(self).super_predicates.decode((self, tcx)),\n-            _ => bug!(),\n-        }\n+        let super_predicates = match self.entry(item_id).kind {\n+            EntryKind::Trait(data) => data.decode(self).super_predicates,\n+            EntryKind::TraitAlias(data) => data.decode(self).super_predicates,\n+            _ => bug!(\"def-index does not refer to trait or trait alias\"),\n+        };\n+\n+        super_predicates.decode((self, tcx))\n     }\n \n     pub fn get_generics(&self,\n@@ -1014,7 +1027,8 @@ impl<'a, 'tcx> CrateMetadata {\n         }\n         def_key.parent.and_then(|parent_index| {\n             match self.entry(parent_index).kind {\n-                EntryKind::Trait(_) => Some(self.local_def_id(parent_index)),\n+                EntryKind::Trait(_) |\n+                EntryKind::TraitAlias(_) => Some(self.local_def_id(parent_index)),\n                 _ => None,\n             }\n         })"}, {"sha": "afb0218501d1877481f3a0e1b0e51a7c646b2e16", "filename": "src/librustc_metadata/encoder.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_metadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_metadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fencoder.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -1128,8 +1128,7 @@ impl<'a, 'b: 'a, 'tcx: 'b> IsolatedEncoder<'a, 'b, 'tcx> {\n \n                 EntryKind::Impl(self.lazy(&data))\n             }\n-            hir::ItemKind::Trait(..) |\n-            hir::ItemKind::TraitAlias(..) => {\n+            hir::ItemKind::Trait(..) => {\n                 let trait_def = tcx.trait_def(def_id);\n                 let data = TraitData {\n                     unsafety: trait_def.unsafety,\n@@ -1141,6 +1140,13 @@ impl<'a, 'b: 'a, 'tcx: 'b> IsolatedEncoder<'a, 'b, 'tcx> {\n \n                 EntryKind::Trait(self.lazy(&data))\n             }\n+            hir::ItemKind::TraitAlias(..) => {\n+                let data = TraitAliasData {\n+                    super_predicates: self.lazy(&tcx.super_predicates_of(def_id)),\n+                };\n+\n+                EntryKind::TraitAlias(self.lazy(&data))\n+            }\n             hir::ItemKind::ExternCrate(_) |\n             hir::ItemKind::Use(..) => bug!(\"cannot encode info for item {:?}\", item),\n         };\n@@ -1214,6 +1220,7 @@ impl<'a, 'b: 'a, 'tcx: 'b> IsolatedEncoder<'a, 'b, 'tcx> {\n                 hir::ItemKind::Impl(..) |\n                 hir::ItemKind::Existential(..) |\n                 hir::ItemKind::Trait(..) => Some(self.encode_generics(def_id)),\n+                hir::ItemKind::TraitAlias(..) => Some(self.encode_generics(def_id)),\n                 _ => None,\n             },\n             predicates: match item.node {\n@@ -1226,7 +1233,8 @@ impl<'a, 'b: 'a, 'tcx: 'b> IsolatedEncoder<'a, 'b, 'tcx> {\n                 hir::ItemKind::Union(..) |\n                 hir::ItemKind::Impl(..) |\n                 hir::ItemKind::Existential(..) |\n-                hir::ItemKind::Trait(..) => Some(self.encode_predicates(def_id)),\n+                hir::ItemKind::Trait(..) |\n+                hir::ItemKind::TraitAlias(..) => Some(self.encode_predicates(def_id)),\n                 _ => None,\n             },\n \n@@ -1236,7 +1244,8 @@ impl<'a, 'b: 'a, 'tcx: 'b> IsolatedEncoder<'a, 'b, 'tcx> {\n             // hack. (No reason not to expand it in the future if\n             // necessary.)\n             predicates_defined_on: match item.node {\n-                hir::ItemKind::Trait(..) => Some(self.encode_predicates_defined_on(def_id)),\n+                hir::ItemKind::Trait(..) |\n+                hir::ItemKind::TraitAlias(..) => Some(self.encode_predicates_defined_on(def_id)),\n                 _ => None, // not *wrong* for other kinds of items, but not needed\n             },\n "}, {"sha": "f3ff9747625f5b68724701049c5f6a660f347869", "filename": "src/librustc_metadata/schema.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_metadata%2Fschema.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_metadata%2Fschema.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fschema.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -316,6 +316,7 @@ pub enum EntryKind<'tcx> {\n     AssociatedType(AssociatedContainer),\n     AssociatedExistential(AssociatedContainer),\n     AssociatedConst(AssociatedContainer, ConstQualif, Lazy<RenderedConst>),\n+    TraitAlias(Lazy<TraitAliasData<'tcx>>),\n }\n \n impl<'a, 'gcx> HashStable<StableHashingContext<'a>> for EntryKind<'gcx> {\n@@ -370,6 +371,9 @@ impl<'a, 'gcx> HashStable<StableHashingContext<'a>> for EntryKind<'gcx> {\n             EntryKind::Trait(ref trait_data) => {\n                 trait_data.hash_stable(hcx, hasher);\n             }\n+            EntryKind::TraitAlias(ref trait_alias_data) => {\n+                trait_alias_data.hash_stable(hcx, hasher);\n+            }\n             EntryKind::Impl(ref impl_data) => {\n                 impl_data.hash_stable(hcx, hasher);\n             }\n@@ -474,6 +478,15 @@ impl_stable_hash_for!(struct TraitData<'tcx> {\n     super_predicates\n });\n \n+#[derive(RustcEncodable, RustcDecodable)]\n+pub struct TraitAliasData<'tcx> {\n+    pub super_predicates: Lazy<ty::GenericPredicates<'tcx>>,\n+}\n+\n+impl_stable_hash_for!(struct TraitAliasData<'tcx> {\n+    super_predicates\n+});\n+\n #[derive(RustcEncodable, RustcDecodable)]\n pub struct ImplData<'tcx> {\n     pub polarity: hir::ImplPolarity,"}, {"sha": "28b80fe3aaf295bce7bf660a01a5555f9a0701ac", "filename": "src/librustc_resolve/build_reduced_graph.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -673,6 +673,9 @@ impl<'a> Resolver<'a> {\n                 }\n                 module.populated.set(true);\n             }\n+            Def::TraitAlias(..) => {\n+                self.define(parent, ident, TypeNS, (def, vis, DUMMY_SP, expansion));\n+            }\n             Def::Struct(..) | Def::Union(..) => {\n                 self.define(parent, ident, TypeNS, (def, vis, DUMMY_SP, expansion));\n "}, {"sha": "9bdef3051e58934403ec63e0be1712fff71fdda2", "filename": "src/librustc_traits/lowering/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_traits%2Flowering%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_traits%2Flowering%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_traits%2Flowering%2Fmod.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -158,7 +158,8 @@ crate fn program_clauses_for<'a, 'tcx>(\n     def_id: DefId,\n ) -> Clauses<'tcx> {\n     match tcx.def_key(def_id).disambiguated_data.data {\n-        DefPathData::Trait(_) => program_clauses_for_trait(tcx, def_id),\n+        DefPathData::Trait(_) |\n+        DefPathData::TraitAlias(_) => program_clauses_for_trait(tcx, def_id),\n         DefPathData::Impl => program_clauses_for_impl(tcx, def_id),\n         DefPathData::AssocTypeInImpl(..) => program_clauses_for_associated_type_value(tcx, def_id),\n         DefPathData::AssocTypeInTrait(..) => program_clauses_for_associated_type_def(tcx, def_id),"}, {"sha": "e89506aaf99f9232bc0a103c0339f63fb99f84d3", "filename": "src/librustc_typeck/astconv.rs", "status": "modified", "additions": 4, "deletions": 18, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_typeck%2Fastconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_typeck%2Fastconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fastconv.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -2,7 +2,7 @@\n //! The main routine here is `ast_ty_to_ty()`; each use is parameterized by an\n //! instance of `AstConv`.\n \n-use errors::{Applicability, FatalError, DiagnosticId};\n+use errors::{Applicability, DiagnosticId};\n use hir::{self, GenericArg, GenericArgs};\n use hir::def::Def;\n use hir::def_id::DefId;\n@@ -690,35 +690,21 @@ impl<'o, 'gcx: 'tcx, 'tcx> dyn AstConv<'gcx, 'tcx> + 'o {\n     {\n         self.prohibit_generics(trait_ref.path.segments.split_last().unwrap().1);\n \n-        let trait_def_id = self.trait_def_id(trait_ref);\n         self.ast_path_to_mono_trait_ref(trait_ref.path.span,\n-                                        trait_def_id,\n+                                        trait_ref.trait_def_id(),\n                                         self_ty,\n                                         trait_ref.path.segments.last().unwrap())\n     }\n \n-    /// Get the `DefId` of the given trait ref. It _must_ actually be a trait.\n-    fn trait_def_id(&self, trait_ref: &hir::TraitRef) -> DefId {\n-        let path = &trait_ref.path;\n-        match path.def {\n-            Def::Trait(trait_def_id) => trait_def_id,\n-            Def::TraitAlias(alias_def_id) => alias_def_id,\n-            Def::Err => {\n-                FatalError.raise();\n-            }\n-            _ => unreachable!(),\n-        }\n-    }\n-\n-    /// The given trait ref must actually be a trait.\n+    /// The given trait-ref must actually be a trait.\n     pub(super) fn instantiate_poly_trait_ref_inner(&self,\n         trait_ref: &hir::TraitRef,\n         self_ty: Ty<'tcx>,\n         poly_projections: &mut Vec<(ty::PolyProjectionPredicate<'tcx>, Span)>,\n         speculative: bool)\n         -> (ty::PolyTraitRef<'tcx>, Option<Vec<Span>>)\n     {\n-        let trait_def_id = self.trait_def_id(trait_ref);\n+        let trait_def_id = trait_ref.trait_def_id();\n \n         debug!(\"instantiate_poly_trait_ref({:?}, def_id={:?})\", trait_ref, trait_def_id);\n "}, {"sha": "93f14a2ea6f647b26ee4836b556c20cdad8eeb9b", "filename": "src/librustc_typeck/collect.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_typeck%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Flibrustc_typeck%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcollect.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -715,7 +715,7 @@ fn super_predicates_of<'a, 'tcx>(\n     // In the case of trait aliases, however, we include all bounds in the where clause,\n     // so e.g., `trait Foo = where u32: PartialEq<Self>` would include `u32: PartialEq<Self>`\n     // as one of its \"superpredicates\".\n-    let is_trait_alias = ty::is_trait_alias(tcx, trait_def_id);\n+    let is_trait_alias = tcx.is_trait_alias(trait_def_id);\n     let superbounds2 = icx.type_parameter_bounds_in_generics(\n         generics, item.id, self_param_ty, OnlySelfBounds(!is_trait_alias));\n "}, {"sha": "e2f3996927b7f8b93d850c779fd4fe83f78833cc", "filename": "src/test/ui/issues/issue-56488.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Fissues%2Fissue-56488.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Fissues%2Fissue-56488.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-56488.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -0,0 +1,13 @@\n+// run-pass\n+\n+#![feature(trait_alias)]\n+\n+mod alpha {\n+    pub trait A {}\n+    pub trait C = A;\n+}\n+\n+#[allow(unused_imports)]\n+use alpha::C;\n+\n+fn main() {}"}, {"sha": "0d18965ee73387b6ae1715785235c2d1233f8423", "filename": "src/test/ui/lint/lint-incoherent-auto-trait-objects.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Flint%2Flint-incoherent-auto-trait-objects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Flint%2Flint-incoherent-auto-trait-objects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-incoherent-auto-trait-objects.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -0,0 +1,21 @@\n+// ignore-tidy-linelength\n+\n+trait Foo {}\n+\n+impl Foo for dyn Send {}\n+\n+impl Foo for dyn Send + Send {}\n+//~^ ERROR conflicting implementations\n+//~| hard error\n+\n+impl Foo for dyn Send + Sync {}\n+\n+impl Foo for dyn Sync + Send {}\n+//~^ ERROR conflicting implementations\n+//~| hard error\n+\n+impl Foo for dyn Send + Sync + Send {}\n+//~^ ERROR conflicting implementations\n+//~| hard error\n+\n+fn main() {}"}, {"sha": "928c92ef9165531c2beb0c723b1431cd6830113f", "filename": "src/test/ui/lint/lint-incoherent-auto-trait-objects.stderr", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Flint%2Flint-incoherent-auto-trait-objects.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Flint%2Flint-incoherent-auto-trait-objects.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-incoherent-auto-trait-objects.stderr?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -0,0 +1,39 @@\n+error: conflicting implementations of trait `Foo` for type `(dyn std::marker::Send + 'static)`: (E0119)\n+  --> $DIR/lint-incoherent-auto-trait-objects.rs:7:1\n+   |\n+LL | impl Foo for dyn Send {}\n+   | --------------------- first implementation here\n+LL | \n+LL | impl Foo for dyn Send + Send {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `(dyn std::marker::Send + 'static)`\n+   |\n+   = note: #[deny(order_dependent_trait_objects)] on by default\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #56484 <https://github.com/rust-lang/rust/issues/56484>\n+\n+error: conflicting implementations of trait `Foo` for type `(dyn std::marker::Send + std::marker::Sync + 'static)`: (E0119)\n+  --> $DIR/lint-incoherent-auto-trait-objects.rs:13:1\n+   |\n+LL | impl Foo for dyn Send + Sync {}\n+   | ---------------------------- first implementation here\n+LL | \n+LL | impl Foo for dyn Sync + Send {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `(dyn std::marker::Send + std::marker::Sync + 'static)`\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #56484 <https://github.com/rust-lang/rust/issues/56484>\n+\n+error: conflicting implementations of trait `Foo` for type `(dyn std::marker::Send + std::marker::Sync + 'static)`: (E0119)\n+  --> $DIR/lint-incoherent-auto-trait-objects.rs:17:1\n+   |\n+LL | impl Foo for dyn Sync + Send {}\n+   | ---------------------------- first implementation here\n+...\n+LL | impl Foo for dyn Send + Sync + Send {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `(dyn std::marker::Send + std::marker::Sync + 'static)`\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #56484 <https://github.com/rust-lang/rust/issues/56484>\n+\n+error: aborting due to 3 previous errors\n+"}, {"sha": "9e56b87e088133d6e632ec47f25b066698297922", "filename": "src/test/ui/traits/auxiliary/trait_alias.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Ftraits%2Fauxiliary%2Ftrait_alias.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Ftraits%2Fauxiliary%2Ftrait_alias.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fauxiliary%2Ftrait_alias.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -0,0 +1,3 @@\n+#![feature(trait_alias)]\n+\n+pub trait SendSync = Send + Sync;"}, {"sha": "259fc4fa5d1ce9ef2ce92eeb1df727027bd290dd", "filename": "src/test/ui/traits/trait-alias-cross-crate.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Ftraits%2Ftrait-alias-cross-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Ftraits%2Ftrait-alias-cross-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Ftrait-alias-cross-crate.rs?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -0,0 +1,17 @@\n+// aux-build:trait_alias.rs\n+\n+#![feature(trait_alias)]\n+\n+extern crate trait_alias;\n+\n+use std::rc::Rc;\n+use trait_alias::SendSync;\n+\n+fn use_alias<T: SendSync>() {}\n+\n+fn main() {\n+    use_alias::<u32>();\n+    use_alias::<Rc<u32>>();\n+    //~^ ERROR `std::rc::Rc<u32>` cannot be sent between threads safely [E0277]\n+    //~^^ ERROR `std::rc::Rc<u32>` cannot be shared between threads safely [E0277]\n+}"}, {"sha": "972d213ac8f8f30a79de429403850aa998dfbeb9", "filename": "src/test/ui/traits/trait-alias-cross-crate.stderr", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Ftraits%2Ftrait-alias-cross-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5272be5b5e7f7289b487d38cfbaebd18548b50be/src%2Ftest%2Fui%2Ftraits%2Ftrait-alias-cross-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Ftrait-alias-cross-crate.stderr?ref=5272be5b5e7f7289b487d38cfbaebd18548b50be", "patch": "@@ -0,0 +1,29 @@\n+error[E0277]: `std::rc::Rc<u32>` cannot be sent between threads safely\n+  --> $DIR/trait-alias-cross-crate.rs:14:5\n+   |\n+LL |     use_alias::<Rc<u32>>();\n+   |     ^^^^^^^^^^^^^^^^^^^^ `std::rc::Rc<u32>` cannot be sent between threads safely\n+   |\n+   = help: the trait `std::marker::Send` is not implemented for `std::rc::Rc<u32>`\n+note: required by `use_alias`\n+  --> $DIR/trait-alias-cross-crate.rs:10:1\n+   |\n+LL | fn use_alias<T: SendSync>() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0277]: `std::rc::Rc<u32>` cannot be shared between threads safely\n+  --> $DIR/trait-alias-cross-crate.rs:14:5\n+   |\n+LL |     use_alias::<Rc<u32>>();\n+   |     ^^^^^^^^^^^^^^^^^^^^ `std::rc::Rc<u32>` cannot be shared between threads safely\n+   |\n+   = help: the trait `std::marker::Sync` is not implemented for `std::rc::Rc<u32>`\n+note: required by `use_alias`\n+  --> $DIR/trait-alias-cross-crate.rs:10:1\n+   |\n+LL | fn use_alias<T: SendSync>() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0277`."}]}