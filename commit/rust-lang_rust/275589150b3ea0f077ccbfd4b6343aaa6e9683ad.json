{"sha": "275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3NTU4OTE1MGIzZWEwZjA3N2NjYmZkNGI2MzQzYWFhNmU5NjgzYWQ=", "commit": {"author": {"name": "Denis Merigoux", "email": "denis.merigoux@gmail.com", "date": "2018-08-21T15:54:12Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2018-11-16T12:11:09Z"}, "message": "Generalized AtomicRmwBinOp for BuilderMethods", "tree": {"sha": "5a721a072656cf8c5d610497590e9ecd3c1ecc4e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a721a072656cf8c5d610497590e9ecd3c1ecc4e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "html_url": "https://github.com/rust-lang/rust/commit/275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/comments", "author": {"login": "denismerigoux", "id": 1766128, "node_id": "MDQ6VXNlcjE3NjYxMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/1766128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/denismerigoux", "html_url": "https://github.com/denismerigoux", "followers_url": "https://api.github.com/users/denismerigoux/followers", "following_url": "https://api.github.com/users/denismerigoux/following{/other_user}", "gists_url": "https://api.github.com/users/denismerigoux/gists{/gist_id}", "starred_url": "https://api.github.com/users/denismerigoux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/denismerigoux/subscriptions", "organizations_url": "https://api.github.com/users/denismerigoux/orgs", "repos_url": "https://api.github.com/users/denismerigoux/repos", "events_url": "https://api.github.com/users/denismerigoux/events{/privacy}", "received_events_url": "https://api.github.com/users/denismerigoux/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1bcb4df16678a71b484ea9d1b65911f22b381d86", "url": "https://api.github.com/repos/rust-lang/rust/commits/1bcb4df16678a71b484ea9d1b65911f22b381d86", "html_url": "https://github.com/rust-lang/rust/commit/1bcb4df16678a71b484ea9d1b65911f22b381d86"}], "stats": {"total": 74, "additions": 56, "deletions": 18}, "files": [{"sha": "83467bba20f13b251085aabaa2bdf55589c13775", "filename": "src/librustc_codegen_llvm/builder.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fbuilder.rs?ref=275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "patch": "@@ -1059,13 +1059,19 @@ impl BuilderMethods<'a, 'll, 'tcx, Value, BasicBlock>\n     }\n     fn atomic_rmw(\n         &self,\n-        op: AtomicRmwBinOp,\n+        op: traits::AtomicRmwBinOp,\n         dst: &'ll Value,\n         src: &'ll Value,\n         order: AtomicOrdering,\n     ) -> &'ll Value {\n         unsafe {\n-            llvm::LLVMBuildAtomicRMW(self.llbuilder, op, dst, src, order, False)\n+            llvm::LLVMBuildAtomicRMW(\n+                self.llbuilder,\n+                AtomicRmwBinOp::from_generic(op),\n+                dst,\n+                src,\n+                order,\n+                False)\n         }\n     }\n "}, {"sha": "6893adc513797083dc427f60f9aacb2cd918b6b3", "filename": "src/librustc_codegen_llvm/intrinsic.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fintrinsic.rs?ref=275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "patch": "@@ -31,7 +31,7 @@ use syntax::symbol::Symbol;\n use builder::Builder;\n use value::Value;\n \n-use traits::BuilderMethods;\n+use traits::{BuilderMethods, AtomicRmwBinOp};\n \n use rustc::session::Session;\n use syntax_pos::Span;\n@@ -533,17 +533,17 @@ pub fn codegen_intrinsic_call(\n                 // These are all AtomicRMW ops\n                 op => {\n                     let atom_op = match op {\n-                        \"xchg\"  => llvm::AtomicXchg,\n-                        \"xadd\"  => llvm::AtomicAdd,\n-                        \"xsub\"  => llvm::AtomicSub,\n-                        \"and\"   => llvm::AtomicAnd,\n-                        \"nand\"  => llvm::AtomicNand,\n-                        \"or\"    => llvm::AtomicOr,\n-                        \"xor\"   => llvm::AtomicXor,\n-                        \"max\"   => llvm::AtomicMax,\n-                        \"min\"   => llvm::AtomicMin,\n-                        \"umax\"  => llvm::AtomicUMax,\n-                        \"umin\"  => llvm::AtomicUMin,\n+                        \"xchg\"  => AtomicRmwBinOp::AtomicXchg,\n+                        \"xadd\"  => AtomicRmwBinOp::AtomicAdd,\n+                        \"xsub\"  => AtomicRmwBinOp::AtomicSub,\n+                        \"and\"   => AtomicRmwBinOp::AtomicAnd,\n+                        \"nand\"  => AtomicRmwBinOp::AtomicNand,\n+                        \"or\"    => AtomicRmwBinOp::AtomicOr,\n+                        \"xor\"   => AtomicRmwBinOp::AtomicXor,\n+                        \"max\"   => AtomicRmwBinOp::AtomicMax,\n+                        \"min\"   => AtomicRmwBinOp::AtomicMin,\n+                        \"umax\"  => AtomicRmwBinOp::AtomicUMax,\n+                        \"umin\"  => AtomicRmwBinOp::AtomicUMin,\n                         _ => cx.sess().fatal(\"unknown atomic operation\")\n                     };\n "}, {"sha": "b44b611f439c3aa39ef2fac4742c43d9bb74a93a", "filename": "src/librustc_codegen_llvm/llvm/ffi.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs?ref=275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "patch": "@@ -244,6 +244,24 @@ pub enum AtomicRmwBinOp {\n     AtomicUMin = 10,\n }\n \n+impl AtomicRmwBinOp {\n+    pub fn from_generic(op : traits::AtomicRmwBinOp) -> Self {\n+        match op {\n+            traits::AtomicRmwBinOp::AtomicXchg => AtomicRmwBinOp::AtomicXchg,\n+            traits::AtomicRmwBinOp::AtomicAdd => AtomicRmwBinOp::AtomicAdd,\n+            traits::AtomicRmwBinOp::AtomicSub => AtomicRmwBinOp::AtomicSub,\n+            traits::AtomicRmwBinOp::AtomicAnd => AtomicRmwBinOp::AtomicAnd,\n+            traits::AtomicRmwBinOp::AtomicNand => AtomicRmwBinOp::AtomicNand,\n+            traits::AtomicRmwBinOp::AtomicOr => AtomicRmwBinOp::AtomicOr,\n+            traits::AtomicRmwBinOp::AtomicXor => AtomicRmwBinOp::AtomicXor,\n+            traits::AtomicRmwBinOp::AtomicMax => AtomicRmwBinOp::AtomicMax,\n+            traits::AtomicRmwBinOp::AtomicMin => AtomicRmwBinOp::AtomicMin,\n+            traits::AtomicRmwBinOp::AtomicUMax => AtomicRmwBinOp::AtomicUMax,\n+            traits::AtomicRmwBinOp::AtomicUMin => AtomicRmwBinOp::AtomicUMin\n+        }\n+    }\n+}\n+\n /// LLVMAtomicOrdering\n #[derive(Copy, Clone)]\n #[repr(C)]"}, {"sha": "c647fceb994b69d14a77348f77396e1639ee47aa", "filename": "src/librustc_codegen_llvm/traits.rs", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/275589150b3ea0f077ccbfd4b6343aaa6e9683ad/src%2Flibrustc_codegen_llvm%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Ftraits.rs?ref=275589150b3ea0f077ccbfd4b6343aaa6e9683ad", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use llvm::{AtomicRmwBinOp, AtomicOrdering, SynchronizationScope, AsmDialect};\n+use llvm::{AtomicOrdering, SynchronizationScope, AsmDialect};\n use common::*;\n use type_::Type;\n use libc::c_char;\n@@ -30,7 +30,7 @@ impl OperandBundleDef<'ll, &'ll Value> {\n     pub fn new(name: &'ll str, val: &'ll Value) -> Self {\n         OperandBundleDef {\n             name,\n-            val,\n+            val\n         }\n     }\n }\n@@ -45,7 +45,7 @@ pub enum IntPredicate {\n     IntSGT,\n     IntSGE,\n     IntSLT,\n-    IntSLE,\n+    IntSLE\n }\n \n #[allow(dead_code)]\n@@ -65,7 +65,21 @@ pub enum RealPredicate {\n     RealULT,\n     RealULE,\n     RealUNE,\n-    RealPredicateTrue,\n+    RealPredicateTrue\n+}\n+\n+pub enum AtomicRmwBinOp {\n+    AtomicXchg,\n+    AtomicAdd,\n+    AtomicSub,\n+    AtomicAnd,\n+    AtomicNand,\n+    AtomicOr,\n+    AtomicXor,\n+    AtomicMax,\n+    AtomicMin,\n+    AtomicUMax,\n+    AtomicUMin\n }\n \n pub trait BuilderMethods<'a, 'll :'a, 'tcx: 'll,"}]}