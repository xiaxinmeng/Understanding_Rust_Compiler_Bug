{"sha": "8c35a9279ca50d3e5a6f33d80a7191454fd89cbe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjMzVhOTI3OWNhNTBkM2U1YTZmMzNkODBhNzE5MTQ1NGZkODljYmU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-10T16:42:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-10T16:42:00Z"}, "message": "Auto merge of #76564 - pietroalbini:ci-avoid-wasting-10-minutes, r=Mark-Simulacrum\n\nci: avoid moving the build directory on GHA\n\nWhile waiting for a PR job to start testing my code, I noticed the symlink-build-dir step took 10 minutes to complete, so I investigated what caused that.\n\nIt seems like something changed in the build environment between version 20200901.1 (where the step took 45 seconds) and version 20200908.1 (where the step took 10 minutes). At the time of writing this commit, the rust-lang organization is on vertsion 20200908.1, while the rust-lang-ci organization is at version 20200901.1 (and is not affected by this yet).\n\nThere is no need for this step anymore on GHA, as our XL builders got an increase in the root paritition size, so this commit removes the code that moved stuff around on GHA (while keeping it on Azure).\n\nFor the record, at the time of writing this, the disk situation is:\n\n```\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1       667G   60G  607G   9% /\n/dev/sdb1       110G  4.1G  101G   4% /mnt\n```\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "a30eadf1741de3a6912df3aee321da7ad81fae67", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a30eadf1741de3a6912df3aee321da7ad81fae67"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8c35a9279ca50d3e5a6f33d80a7191454fd89cbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8c35a9279ca50d3e5a6f33d80a7191454fd89cbe", "html_url": "https://github.com/rust-lang/rust/commit/8c35a9279ca50d3e5a6f33d80a7191454fd89cbe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8c35a9279ca50d3e5a6f33d80a7191454fd89cbe/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "25b2f4861222d6507598149f576e7d25dc308c8c", "url": "https://api.github.com/repos/rust-lang/rust/commits/25b2f4861222d6507598149f576e7d25dc308c8c", "html_url": "https://github.com/rust-lang/rust/commit/25b2f4861222d6507598149f576e7d25dc308c8c"}, {"sha": "a5cdc06db88d9a9d41dd18353fedb6467260437a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5cdc06db88d9a9d41dd18353fedb6467260437a", "html_url": "https://github.com/rust-lang/rust/commit/a5cdc06db88d9a9d41dd18353fedb6467260437a"}], "stats": {"total": 18, "additions": 0, "deletions": 18}, "files": [{"sha": "23849f7047c546e173c94f3471a5749899ecae3d", "filename": "src/ci/scripts/symlink-build-dir.sh", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8c35a9279ca50d3e5a6f33d80a7191454fd89cbe/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "raw_url": "https://github.com/rust-lang/rust/raw/8c35a9279ca50d3e5a6f33d80a7191454fd89cbe/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh?ref=8c35a9279ca50d3e5a6f33d80a7191454fd89cbe", "patch": "@@ -12,22 +12,4 @@ source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n if isWindows && isAzurePipelines; then\n     cmd //c \"mkdir c:\\\\MORE_SPACE\"\n     cmd //c \"mklink /J build c:\\\\MORE_SPACE\"\n-elif isLinux && isGitHubActions && ! isSelfHostedGitHubActions; then\n-    sudo mkdir -p /mnt/more-space\n-    sudo chown -R \"$(whoami):\" /mnt/more-space\n-\n-    # Switch the whole workspace to the /mnt partition, which has more space.\n-    # We don't just symlink the `obj` directory as doing that creates problems\n-    # with the docker container.\n-    current_dir=\"$(readlink -f \"$(pwd)\")\"\n-    cd /tmp\n-    mv \"${current_dir}\" /mnt/more-space/workspace\n-    ln -s /mnt/more-space/workspace \"${current_dir}\"\n-    cd \"${current_dir}\"\n-\n-    # Move the Docker data directory to /mnt\n-    sudo systemctl stop docker.service\n-    sudo mv /var/lib/docker /mnt/docker\n-    sudo ln -s /mnt/docker /var/lib/docker\n-    sudo systemctl start docker.service\n fi"}]}