{"sha": "8066dfd4ad24c011f581c80b818ac352711a5942", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwNjZkZmQ0YWQyNGMwMTFmNTgxYzgwYjgxOGFjMzUyNzExYTU5NDI=", "commit": {"author": {"name": "Philipp Br\u00fcschweiler", "email": "blei42@gmail.com", "date": "2013-06-19T11:42:47Z"}, "committer": {"name": "Philipp Br\u00fcschweiler", "email": "blei42@gmail.com", "date": "2013-06-19T11:43:19Z"}, "message": "syntax::diagnostics: Color the ^~~~ in green for better visibility\n\nFixes #7164.", "tree": {"sha": "64c18895228e26380acbea5e01aebe0ac7b7b4fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64c18895228e26380acbea5e01aebe0ac7b7b4fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8066dfd4ad24c011f581c80b818ac352711a5942", "comment_count": 35, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8066dfd4ad24c011f581c80b818ac352711a5942", "html_url": "https://github.com/rust-lang/rust/commit/8066dfd4ad24c011f581c80b818ac352711a5942", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8066dfd4ad24c011f581c80b818ac352711a5942/comments", "author": {"login": "Blei", "id": 52674, "node_id": "MDQ6VXNlcjUyNjc0", "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Blei", "html_url": "https://github.com/Blei", "followers_url": "https://api.github.com/users/Blei/followers", "following_url": "https://api.github.com/users/Blei/following{/other_user}", "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}", "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Blei/subscriptions", "organizations_url": "https://api.github.com/users/Blei/orgs", "repos_url": "https://api.github.com/users/Blei/repos", "events_url": "https://api.github.com/users/Blei/events{/privacy}", "received_events_url": "https://api.github.com/users/Blei/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Blei", "id": 52674, "node_id": "MDQ6VXNlcjUyNjc0", "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Blei", "html_url": "https://github.com/Blei", "followers_url": "https://api.github.com/users/Blei/followers", "following_url": "https://api.github.com/users/Blei/following{/other_user}", "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}", "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Blei/subscriptions", "organizations_url": "https://api.github.com/users/Blei/orgs", "repos_url": "https://api.github.com/users/Blei/repos", "events_url": "https://api.github.com/users/Blei/events{/privacy}", "received_events_url": "https://api.github.com/users/Blei/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1120f8c1e57b7b30134d670dd1dfc18c6444c15f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1120f8c1e57b7b30134d670dd1dfc18c6444c15f", "html_url": "https://github.com/rust-lang/rust/commit/1120f8c1e57b7b30134d670dd1dfc18c6444c15f"}], "stats": {"total": 33, "additions": 20, "deletions": 13}, "files": [{"sha": "5af6e3679aad912f7932241ed79dff529692a4e4", "filename": "src/libsyntax/diagnostic.rs", "status": "modified", "additions": 20, "deletions": 13, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/8066dfd4ad24c011f581c80b818ac352711a5942/src%2Flibsyntax%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8066dfd4ad24c011f581c80b818ac352711a5942/src%2Flibsyntax%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostic.rs?ref=8066dfd4ad24c011f581c80b818ac352711a5942", "patch": "@@ -189,30 +189,36 @@ fn diagnosticcolor(lvl: level) -> u8 {\n     }\n }\n \n-fn print_diagnostic(topic: &str, lvl: level, msg: &str) {\n-    let t = term::Terminal::new(io::stderr());\n-\n+fn print_maybe_colored(msg: &str, color: u8) {\n     let stderr = io::stderr();\n \n-    if !topic.is_empty() {\n-        stderr.write_str(fmt!(\"%s \", topic));\n-    }\n+    let t = term::Terminal::new(stderr);\n \n     match t {\n         Ok(term) => {\n             if stderr.get_type() == io::Screen {\n-                term.fg(diagnosticcolor(lvl));\n-                stderr.write_str(fmt!(\"%s: \", diagnosticstr(lvl)));\n+                term.fg(color);\n+                stderr.write_str(msg);\n                 term.reset();\n-                stderr.write_str(fmt!(\"%s\\n\", msg));\n             } else {\n-                stderr.write_str(fmt!(\"%s: %s\\n\", diagnosticstr(lvl), msg));\n+                stderr.write_str(msg);\n             }\n         },\n-        _ => stderr.write_str(fmt!(\"%s: %s\\n\", diagnosticstr(lvl), msg))\n+        _ => stderr.write_str(msg)\n     }\n }\n \n+fn print_diagnostic(topic: &str, lvl: level, msg: &str) {\n+    let stderr = io::stderr();\n+\n+    if !topic.is_empty() {\n+        stderr.write_str(fmt!(\"%s \", topic));\n+    }\n+\n+    print_maybe_colored(fmt!(\"%s: \", diagnosticstr(lvl)), diagnosticcolor(lvl));\n+    stderr.write_str(fmt!(\"%s\\n\", msg));\n+}\n+\n pub fn collect(messages: @mut ~[~str])\n             -> @fn(Option<(@codemap::CodeMap, span)>, &str, level) {\n     let f: @fn(Option<(@codemap::CodeMap, span)>, &str, level) =\n@@ -292,14 +298,15 @@ fn highlight_lines(cm: @codemap::CodeMap,\n                 _ => \" \"         // -squigly-line as well (instead of a\n             };                   // space). This way the squigly-line will\n         }                        // usually appear in the correct position.\n-        s += \"^\";\n+        io::stderr().write_str(s);\n+        let mut s = ~\"^\";\n         let hi = cm.lookup_char_pos(sp.hi);\n         if hi.col != lo.col {\n             // the ^ already takes up one space\n             let num_squiglies = hi.col.to_uint()-lo.col.to_uint()-1u;\n             for num_squiglies.times() { s += \"~\"; }\n         }\n-        io::stderr().write_str(s + \"\\n\");\n+        print_maybe_colored(s + \"\\n\", term::color_bright_green);\n     }\n }\n "}]}