{"sha": "949aca6eebf974939ebda84549ee79ecbeb84811", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0OWFjYTZlZWJmOTc0OTM5ZWJkYTg0NTQ5ZWU3OWVjYmViODQ4MTE=", "commit": {"author": {"name": "R\u00e9my Rakic", "email": "remy.rakic+github@gmail.com", "date": "2021-05-27T20:28:04Z"}, "committer": {"name": "R\u00e9my Rakic", "email": "remy.rakic+github@gmail.com", "date": "2021-05-27T20:28:04Z"}, "message": "don't trim paths in collector PME message", "tree": {"sha": "b3da87c13606e711b562fabcc6304495ca30538f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b3da87c13606e711b562fabcc6304495ca30538f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/949aca6eebf974939ebda84549ee79ecbeb84811", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/949aca6eebf974939ebda84549ee79ecbeb84811", "html_url": "https://github.com/rust-lang/rust/commit/949aca6eebf974939ebda84549ee79ecbeb84811", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/949aca6eebf974939ebda84549ee79ecbeb84811/comments", "author": {"login": "lqd", "id": 247183, "node_id": "MDQ6VXNlcjI0NzE4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/247183?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lqd", "html_url": "https://github.com/lqd", "followers_url": "https://api.github.com/users/lqd/followers", "following_url": "https://api.github.com/users/lqd/following{/other_user}", "gists_url": "https://api.github.com/users/lqd/gists{/gist_id}", "starred_url": "https://api.github.com/users/lqd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lqd/subscriptions", "organizations_url": "https://api.github.com/users/lqd/orgs", "repos_url": "https://api.github.com/users/lqd/repos", "events_url": "https://api.github.com/users/lqd/events{/privacy}", "received_events_url": "https://api.github.com/users/lqd/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lqd", "id": 247183, "node_id": "MDQ6VXNlcjI0NzE4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/247183?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lqd", "html_url": "https://github.com/lqd", "followers_url": "https://api.github.com/users/lqd/followers", "following_url": "https://api.github.com/users/lqd/following{/other_user}", "gists_url": "https://api.github.com/users/lqd/gists{/gist_id}", "starred_url": "https://api.github.com/users/lqd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lqd/subscriptions", "organizations_url": "https://api.github.com/users/lqd/orgs", "repos_url": "https://api.github.com/users/lqd/repos", "events_url": "https://api.github.com/users/lqd/events{/privacy}", "received_events_url": "https://api.github.com/users/lqd/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d854c3c0e9d256b923fbfc8b5193433a6edcd08f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d854c3c0e9d256b923fbfc8b5193433a6edcd08f", "html_url": "https://github.com/rust-lang/rust/commit/d854c3c0e9d256b923fbfc8b5193433a6edcd08f"}], "stats": {"total": 11, "additions": 5, "deletions": 6}, "files": [{"sha": "31cb5484bcefb3ae842bbacbeeb41a857941a3fa", "filename": "compiler/rustc_mir/src/monomorphize/collector.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/949aca6eebf974939ebda84549ee79ecbeb84811/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/949aca6eebf974939ebda84549ee79ecbeb84811/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fcollector.rs?ref=949aca6eebf974939ebda84549ee79ecbeb84811", "patch": "@@ -194,6 +194,7 @@ use rustc_middle::mir::mono::{InstantiationMode, MonoItem};\n use rustc_middle::mir::visit::Visitor as MirVisitor;\n use rustc_middle::mir::{self, Local, Location};\n use rustc_middle::ty::adjustment::{CustomCoerceUnsized, PointerCast};\n+use rustc_middle::ty::print::with_no_trimmed_paths;\n use rustc_middle::ty::subst::{GenericArgKind, InternalSubsts};\n use rustc_middle::ty::{self, GenericParamDefKind, Instance, Ty, TyCtxt, TypeFoldable};\n use rustc_middle::{middle::codegen_fn_attrs::CodegenFnAttrFlags, mir::visit::TyContext};\n@@ -444,12 +445,10 @@ fn collect_items_rec<'tcx>(\n     // defined in the local crate.\n     if tcx.sess.diagnostic().err_count() > error_count && starting_point.node.krate() != LOCAL_CRATE\n     {\n+        let formatted_item = with_no_trimmed_paths(|| starting_point.node.to_string());\n         tcx.sess.span_note_without_error(\n             starting_point.span,\n-            &format!(\n-                \"the above error was encountered while instantiating `{}`\",\n-                starting_point.node\n-            ),\n+            &format!(\"the above error was encountered while instantiating `{}`\", formatted_item),\n         );\n     }\n "}, {"sha": "c36d7c172152674e1285f3c222035672abe2b8ce", "filename": "src/test/ui/consts/const-eval/issue-85155.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/949aca6eebf974939ebda84549ee79ecbeb84811/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-85155.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/949aca6eebf974939ebda84549ee79ecbeb84811/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-85155.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-85155.stderr?ref=949aca6eebf974939ebda84549ee79ecbeb84811", "patch": "@@ -1,10 +1,10 @@\n-error[E0080]: evaluation of constant value failed\n+error[E0080]: evaluation of `post_monomorphization_error::ValidateConstImm::<2_i32, 0_i32, 1_i32>::VALID` failed\n   --> $DIR/auxiliary/post_monomorphization_error.rs:7:17\n    |\n LL |         let _ = 1 / ((IMM >= MIN && IMM <= MAX) as usize);\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ attempt to divide `1_usize` by zero\n \n-note: the above error was encountered while instantiating `fn stdarch_intrinsic::<2_i32>`\n+note: the above error was encountered while instantiating `fn post_monomorphization_error::stdarch_intrinsic::<2_i32>`\n   --> $DIR/issue-85155.rs:19:5\n    |\n LL |     post_monomorphization_error::stdarch_intrinsic::<2>();"}]}