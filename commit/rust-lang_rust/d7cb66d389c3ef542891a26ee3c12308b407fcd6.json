{"sha": "d7cb66d389c3ef542891a26ee3c12308b407fcd6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3Y2I2NmQzODljM2VmNTQyODkxYTI2ZWUzYzEyMzA4YjQwN2ZjZDY=", "commit": {"author": {"name": "Henry Boisdequin", "email": "65845077+henryboisdequin@users.noreply.github.com", "date": "2021-02-17T14:50:59Z"}, "committer": {"name": "Henry Boisdequin", "email": "65845077+henryboisdequin@users.noreply.github.com", "date": "2021-02-25T10:41:18Z"}, "message": "add helpful error notes and fix the false 'defined here' messages", "tree": {"sha": "5bf2af8f6bbeafcf40135b662f65d420bd83a955", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5bf2af8f6bbeafcf40135b662f65d420bd83a955"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7cb66d389c3ef542891a26ee3c12308b407fcd6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7cb66d389c3ef542891a26ee3c12308b407fcd6", "html_url": "https://github.com/rust-lang/rust/commit/d7cb66d389c3ef542891a26ee3c12308b407fcd6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7cb66d389c3ef542891a26ee3c12308b407fcd6/comments", "author": {"login": "henryboisdequin", "id": 65845077, "node_id": "MDQ6VXNlcjY1ODQ1MDc3", "avatar_url": "https://avatars.githubusercontent.com/u/65845077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/henryboisdequin", "html_url": "https://github.com/henryboisdequin", "followers_url": "https://api.github.com/users/henryboisdequin/followers", "following_url": "https://api.github.com/users/henryboisdequin/following{/other_user}", "gists_url": "https://api.github.com/users/henryboisdequin/gists{/gist_id}", "starred_url": "https://api.github.com/users/henryboisdequin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/henryboisdequin/subscriptions", "organizations_url": "https://api.github.com/users/henryboisdequin/orgs", "repos_url": "https://api.github.com/users/henryboisdequin/repos", "events_url": "https://api.github.com/users/henryboisdequin/events{/privacy}", "received_events_url": "https://api.github.com/users/henryboisdequin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "henryboisdequin", "id": 65845077, "node_id": "MDQ6VXNlcjY1ODQ1MDc3", "avatar_url": "https://avatars.githubusercontent.com/u/65845077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/henryboisdequin", "html_url": "https://github.com/henryboisdequin", "followers_url": "https://api.github.com/users/henryboisdequin/followers", "following_url": "https://api.github.com/users/henryboisdequin/following{/other_user}", "gists_url": "https://api.github.com/users/henryboisdequin/gists{/gist_id}", "starred_url": "https://api.github.com/users/henryboisdequin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/henryboisdequin/subscriptions", "organizations_url": "https://api.github.com/users/henryboisdequin/orgs", "repos_url": "https://api.github.com/users/henryboisdequin/repos", "events_url": "https://api.github.com/users/henryboisdequin/events{/privacy}", "received_events_url": "https://api.github.com/users/henryboisdequin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1279b3b9232e4c44112d98f19cfa8846776d1fe8", "url": "https://api.github.com/repos/rust-lang/rust/commits/1279b3b9232e4c44112d98f19cfa8846776d1fe8", "html_url": "https://github.com/rust-lang/rust/commit/1279b3b9232e4c44112d98f19cfa8846776d1fe8"}], "stats": {"total": 76, "additions": 67, "deletions": 9}, "files": [{"sha": "bd41ef85ce8c81a6070fbff651d9214b173a4cf8", "filename": "compiler/rustc_typeck/src/check/callee.rs", "status": "modified", "additions": 21, "deletions": 2, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcallee.rs?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -4,7 +4,7 @@ use crate::type_error_struct;\n \n use rustc_errors::{struct_span_err, Applicability, DiagnosticBuilder};\n use rustc_hir as hir;\n-use rustc_hir::def::Res;\n+use rustc_hir::def::{Namespace, Res};\n use rustc_hir::def_id::{DefId, LOCAL_CRATE};\n use rustc_infer::infer::type_variable::{TypeVariableOrigin, TypeVariableOriginKind};\n use rustc_infer::{infer, traits};\n@@ -374,7 +374,26 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                     |p| format!(\"`{}` defined here returns `{}`\", p, callee_ty),\n                                 )\n                             }\n-                            _ => Some(format!(\"`{}` defined here\", callee_ty)),\n+                            _ => {\n+                                match def {\n+                                    // Emit a different diagnostic for local variables, as they are not\n+                                    // type definitions themselves, but rather variables *of* that type.\n+                                    Res::Local(hir_id) => Some(format!(\n+                                        \"`{}` has type `{}`\",\n+                                        self.tcx.hir().name(hir_id),\n+                                        callee_ty\n+                                    )),\n+                                    Res::Def(kind, def_id)\n+                                        if kind.ns() == Some(Namespace::ValueNS) =>\n+                                    {\n+                                        Some(format!(\n+                                            \"`{}` defined here\",\n+                                            self.tcx.def_path_str(def_id),\n+                                        ))\n+                                    }\n+                                    _ => Some(format!(\"`{}` defined here\", callee_ty)),\n+                                }\n+                            }\n                         };\n                         if let Some(label) = label {\n                             err.span_label(span, label);"}, {"sha": "388f907f8d2c36acbef578fe7b0ba983c596f2f1", "filename": "src/test/ui/consts/const-as-fn.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fconsts%2Fconst-as-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fconsts%2Fconst-as-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-as-fn.rs?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -0,0 +1,5 @@\n+const FOO: usize = 0;\n+\n+fn main() {\n+    FOO(); //~ ERROR expected function, found `usize`\n+}"}, {"sha": "b8dd4134b284dda2dec640000b090ad19e602247", "filename": "src/test/ui/consts/const-as-fn.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fconsts%2Fconst-as-fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fconsts%2Fconst-as-fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-as-fn.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -0,0 +1,14 @@\n+error[E0618]: expected function, found `usize`\n+  --> $DIR/const-as-fn.rs:4:5\n+   |\n+LL | const FOO: usize = 0;\n+   | --------------------- `FOO` defined here\n+...\n+LL |     FOO();\n+   |     ^^^--\n+   |     |\n+   |     call expression requires function\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0618`."}, {"sha": "714c8d1e4d75ce0182cbcbaa0fa3bbe254b4054a", "filename": "src/test/ui/error-codes/E0618.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Ferror-codes%2FE0618.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Ferror-codes%2FE0618.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0618.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -18,7 +18,7 @@ error[E0618]: expected function, found `i32`\n   --> $DIR/E0618.rs:9:5\n    |\n LL |     let x = 0i32;\n-   |         - `i32` defined here\n+   |         - `x` has type `i32`\n LL |     x();\n    |     ^--\n    |     |"}, {"sha": "f64b61aaeb05c942f3f5c6678e5d844c2d80ff38", "filename": "src/test/ui/issues/issue-10969.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-10969.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-10969.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-10969.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -2,7 +2,7 @@ error[E0618]: expected function, found `i32`\n   --> $DIR/issue-10969.rs:2:5\n    |\n LL | fn func(i: i32) {\n-   |         - `i32` defined here\n+   |         - `i` has type `i32`\n LL |     i();\n    |     ^--\n    |     |\n@@ -12,7 +12,7 @@ error[E0618]: expected function, found `i32`\n   --> $DIR/issue-10969.rs:6:5\n    |\n LL |     let i = 0i32;\n-   |         - `i32` defined here\n+   |         - `i` has type `i32`\n LL |     i();\n    |     ^--\n    |     |"}, {"sha": "0405ce551b0ab5db73097001fb0f075851e3c8a1", "filename": "src/test/ui/issues/issue-21701.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-21701.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-21701.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-21701.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -2,7 +2,7 @@ error[E0618]: expected function, found `U`\n   --> $DIR/issue-21701.rs:2:13\n    |\n LL | fn foo<U>(t: U) {\n-   |           - `U` defined here\n+   |           - `t` has type `U`\n LL |     let y = t();\n    |             ^--\n    |             |"}, {"sha": "3fff91acbc25fa3c0ec3008653543a47c083e75a", "filename": "src/test/ui/issues/issue-22468.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-22468.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-22468.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-22468.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -2,7 +2,7 @@ error[E0618]: expected function, found `&str`\n   --> $DIR/issue-22468.rs:3:13\n    |\n LL |     let foo = \"bar\";\n-   |         --- `&str` defined here\n+   |         --- `foo` has type `&str`\n LL |     let x = foo(\"baz\");\n    |             ^^^-------\n    |             |"}, {"sha": "91d28a5e1e1eff70dd6b4a5a8bae5acfc7fa7ff0", "filename": "src/test/ui/issues/issue-26237.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-26237.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fissues%2Fissue-26237.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-26237.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -5,7 +5,7 @@ LL |         $not_a_function($some_argument)\n    |         ------------------------------- call expression requires function\n ...\n LL |     let mut value_a = 0;\n-   |         ----------- `{integer}` defined here\n+   |         ----------- `value_a` has type `{integer}`\n LL |     let mut value_b = 0;\n LL |     macro_panic!(value_a, value_b);\n    |                  ^^^^^^^"}, {"sha": "691df91268b246212e0e4a360e6ecf076e5a4eb6", "filename": "src/test/ui/parser/parse-error-correct.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fparser%2Fparse-error-correct.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fparser%2Fparse-error-correct.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fparse-error-correct.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -14,7 +14,7 @@ error[E0618]: expected function, found `{integer}`\n   --> $DIR/parse-error-correct.rs:7:13\n    |\n LL |     let y = 42;\n-   |         - `{integer}` defined here\n+   |         - `y` has type `{integer}`\n LL |     let x = y.;\n LL |     let x = y.();\n    |             ^---"}, {"sha": "242d0af959d40f385d2609a0450c3138c81d62cd", "filename": "src/test/ui/structs/80853.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fstructs%2F80853.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fstructs%2F80853.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstructs%2F80853.rs?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -0,0 +1,7 @@\n+struct S;\n+\n+fn repro_ref(thing: S) {\n+    thing(); //~ ERROR expected function, found `S`\n+}\n+\n+fn main() {}"}, {"sha": "8a38e32c1d0ca90bfdc21ee2230ace95fcbfb11e", "filename": "src/test/ui/structs/80853.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fstructs%2F80853.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7cb66d389c3ef542891a26ee3c12308b407fcd6/src%2Ftest%2Fui%2Fstructs%2F80853.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstructs%2F80853.stderr?ref=d7cb66d389c3ef542891a26ee3c12308b407fcd6", "patch": "@@ -0,0 +1,13 @@\n+error[E0618]: expected function, found `S`\n+  --> $DIR/80853.rs:4:5\n+   |\n+LL | fn repro_ref(thing: S) {\n+   |              ----- `thing` has type `S`\n+LL |     thing();\n+   |     ^^^^^--\n+   |     |\n+   |     call expression requires function\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0618`."}]}