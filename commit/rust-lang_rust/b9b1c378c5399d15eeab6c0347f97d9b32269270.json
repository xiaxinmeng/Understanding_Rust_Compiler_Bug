{"sha": "b9b1c378c5399d15eeab6c0347f97d9b32269270", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5YjFjMzc4YzUzOTlkMTVlZWFiNmMwMzQ3Zjk3ZDliMzIyNjkyNzA=", "commit": {"author": {"name": "Mark Mansi", "email": "markm@cs.wisc.edu", "date": "2018-02-26T17:05:43Z"}, "committer": {"name": "Mark Mansi", "email": "markm@cs.wisc.edu", "date": "2018-03-05T20:43:44Z"}, "message": "Get the path to cargo from rustbuild", "tree": {"sha": "e84d883af711b7851e5d3a60e708fbd9542b949a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e84d883af711b7851e5d3a60e708fbd9542b949a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9b1c378c5399d15eeab6c0347f97d9b32269270", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9b1c378c5399d15eeab6c0347f97d9b32269270", "html_url": "https://github.com/rust-lang/rust/commit/b9b1c378c5399d15eeab6c0347f97d9b32269270", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9b1c378c5399d15eeab6c0347f97d9b32269270/comments", "author": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6e016c587ff4feae9f2401c744f6d69fa3e22c77", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e016c587ff4feae9f2401c744f6d69fa3e22c77", "html_url": "https://github.com/rust-lang/rust/commit/6e016c587ff4feae9f2401c744f6d69fa3e22c77"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "48490493525f971708c1781b4a2fb1a984a1c0ba", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b9b1c378c5399d15eeab6c0347f97d9b32269270/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9b1c378c5399d15eeab6c0347f97d9b32269270/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=b9b1c378c5399d15eeab6c0347f97d9b32269270", "patch": "@@ -528,6 +528,7 @@ impl Step for Tidy {\n         println!(\"tidy check ({})\", host);\n         let mut cmd = builder.tool_cmd(Tool::Tidy);\n         cmd.arg(build.src.join(\"src\"));\n+        cmd.arg(&build.initial_cargo);\n         if !build.config.vendor {\n             cmd.arg(\"--no-vendor\");\n         }"}, {"sha": "4c9c0d8cf6680d8e4ace8c016905097ba09c4cbd", "filename": "src/tools/tidy/src/deps.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b9b1c378c5399d15eeab6c0347f97d9b32269270/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9b1c378c5399d15eeab6c0347f97d9b32269270/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs?ref=b9b1c378c5399d15eeab6c0347f97d9b32269270", "patch": "@@ -426,9 +426,9 @@ pub fn check(path: &Path, bad: &mut bool) {\n /// Checks the dependency at the given path. Changes `bad` to `true` if a check failed.\n ///\n /// Specifically, this checks that the dependencies are on the whitelist.\n-pub fn check_whitelist(path: &Path, bad: &mut bool) {\n+pub fn check_whitelist(path: &Path, cargo: &Path, bad: &mut bool) {\n     // Check dependencies\n-    let deps: HashSet<_> = get_deps(&path)\n+    let deps: HashSet<_> = get_deps(&path, &cargo)\n         .into_iter()\n         .map(|Package { name, version, .. }| (name, version))\n         .collect();\n@@ -492,10 +492,9 @@ fn extract_license(line: &str) -> String {\n }\n \n /// Get the dependencies of the crate at the given path using `cargo metadata`.\n-fn get_deps(path: &Path) -> Vec<Package> {\n+fn get_deps(path: &Path, cargo: &Path) -> Vec<Package> {\n     // Run `cargo metadata` to get the set of dependencies\n-    println!(\"Getting metadata from {:?}\", path.join(\"Cargo.toml\"));\n-    let output = Command::new(\"cargo\")\n+    let output = Command::new(cargo)\n         .arg(\"metadata\")\n         .arg(\"--format-version\")\n         .arg(\"1\")"}, {"sha": "afa3ebd198319c681427dd3a58301e4410ab7eda", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b9b1c378c5399d15eeab6c0347f97d9b32269270/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9b1c378c5399d15eeab6c0347f97d9b32269270/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=b9b1c378c5399d15eeab6c0347f97d9b32269270", "patch": "@@ -24,9 +24,12 @@ use std::path::PathBuf;\n use std::env;\n \n fn main() {\n-    let path = env::args_os().skip(1).next().expect(\"need an argument\");\n+    let path = env::args_os().skip(1).next().expect(\"need path to src\");\n     let path = PathBuf::from(path);\n \n+    let cargo = env::args_os().skip(2).next().expect(\"need path to cargo\");\n+    let cargo = PathBuf::from(cargo);\n+\n     let args: Vec<String> = env::args().skip(1).collect();\n \n     let mut bad = false;\n@@ -41,7 +44,7 @@ fn main() {\n     if !args.iter().any(|s| *s == \"--no-vendor\") {\n         deps::check(&path, &mut bad);\n     }\n-    deps::check_whitelist(&path, &mut bad);\n+    deps::check_whitelist(&path, &cargo, &mut bad);\n \n     if bad {\n         eprintln!(\"some tidy checks failed\");"}]}