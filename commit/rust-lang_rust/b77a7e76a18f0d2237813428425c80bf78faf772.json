{"sha": "b77a7e76a18f0d2237813428425c80bf78faf772", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3N2E3ZTc2YTE4ZjBkMjIzNzgxMzQyODQyNWM4MGJmNzhmYWY3NzI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-14T19:16:38Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-14T19:16:38Z"}, "message": "auto merge of #11539 : dotdash/rust/void_type_fixup, r=alexcrichton\n\nCurrently, we have c_void defined to be represented as an empty struct,\r\nbut LLVM expects C's void* to be represented as i8*. That means we\r\ncurrently generate code in which LLVM doesn't recognize malloc() and\r\nfree() and can't apply certain optimization that would remove calls to\r\nthose functions.", "tree": {"sha": "712189fad88221597f9dda9a2fbf7692fd978f92", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/712189fad88221597f9dda9a2fbf7692fd978f92"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b77a7e76a18f0d2237813428425c80bf78faf772", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b77a7e76a18f0d2237813428425c80bf78faf772", "html_url": "https://github.com/rust-lang/rust/commit/b77a7e76a18f0d2237813428425c80bf78faf772", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b77a7e76a18f0d2237813428425c80bf78faf772/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d150f6b4427a9f4307f27e0781bcf9898452eede", "url": "https://api.github.com/repos/rust-lang/rust/commits/d150f6b4427a9f4307f27e0781bcf9898452eede", "html_url": "https://github.com/rust-lang/rust/commit/d150f6b4427a9f4307f27e0781bcf9898452eede"}, {"sha": "5902263d0af99fba3f286f589ac864ad9ccffc42", "url": "https://api.github.com/repos/rust-lang/rust/commits/5902263d0af99fba3f286f589ac864ad9ccffc42", "html_url": "https://github.com/rust-lang/rust/commit/5902263d0af99fba3f286f589ac864ad9ccffc42"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "6b54a176e8904152c8832b07cd1ce702f844c7cd", "filename": "src/libstd/libc.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b77a7e76a18f0d2237813428425c80bf78faf772/src%2Flibstd%2Flibc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b77a7e76a18f0d2237813428425c80bf78faf772/src%2Flibstd%2Flibc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flibc.rs?ref=b77a7e76a18f0d2237813428425c80bf78faf772", "patch": "@@ -194,8 +194,19 @@ pub mod types {\n             This type is only useful as a pointer target. Do not use it as a\n             return type for FFI functions which have the `void` return type in\n             C. Use the unit type `()` or omit the return type instead.\n+\n+            For LLVM to recognize the void pointer type and by extension\n+            functions like malloc(), we need to have it represented as i8* in\n+            LLVM bitcode. The enum used here ensures this and prevents misuse\n+            of the \"raw\" type by only having private variants.. We need two\n+            variants, because the compiler complains about the repr attribute\n+            otherwise.\n             */\n-            pub enum c_void {}\n+            #[repr(u8)]\n+            pub enum c_void {\n+                priv variant1,\n+                priv variant2\n+            }\n             pub enum FILE {}\n             pub enum fpos_t {}\n         }"}]}