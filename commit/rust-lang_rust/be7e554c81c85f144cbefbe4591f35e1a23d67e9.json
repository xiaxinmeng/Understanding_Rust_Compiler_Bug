{"sha": "be7e554c81c85f144cbefbe4591f35e1a23d67e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlN2U1NTRjODFjODVmMTQ0Y2JlZmJlNDU5MWYzNWUxYTIzZDY3ZTk=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2018-05-13T09:56:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-05-13T09:56:03Z"}, "message": "Merge pull request #2753 from phansch/fix_build_script_for_dev_channel\n\nFix build script for dev channel", "tree": {"sha": "32fdbce86ed6bf89d74ec41c1ab5ac0a5e596073", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/32fdbce86ed6bf89d74ec41c1ab5ac0a5e596073"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be7e554c81c85f144cbefbe4591f35e1a23d67e9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJa+AuzCRBK7hj4Ov3rIwAAdHIIAFzQav4o9mkWk6u+CiSHISEX\nugav3ow0s48l402CbaklMxEmOemtUPUMB4k1ibP+YD5xkxoPtMKnY2seWrBpdSiC\nQnCTdzBWyrJ7aqDgYwgeZTVdFx3I2zNtvk4JF05yBhQaqeWKUS1iK2UBB4GGhCTs\nsRbmRLGOjEAagmorc86Wv6W/pKKCA+Alr8dFTaY+x2sAunxeK9J7hRZ+heDFgdD0\nVHbPoMFyU/9JnTIyuse8M3NoXDvUA7RP2dmjnuwnIxgzRQ4vlD2BDn9FdKL1NUEY\nXVKc3P+BRVjm8WhSj8zfbMzs03uE+U3iyKKAD4nN/BFMVRN0o3XjF88gFE96wTU=\n=Yexh\n-----END PGP SIGNATURE-----\n", "payload": "tree 32fdbce86ed6bf89d74ec41c1ab5ac0a5e596073\nparent 29a900d9165607492f1c7c9322278bc1f0239e1b\nparent 364f42d78d5227c6d31360a4fe6ba3503256133a\nauthor Oliver Schneider <oli-obk@users.noreply.github.com> 1526205363 +0200\ncommitter GitHub <noreply@github.com> 1526205363 +0200\n\nMerge pull request #2753 from phansch/fix_build_script_for_dev_channel\n\nFix build script for dev channel"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be7e554c81c85f144cbefbe4591f35e1a23d67e9", "html_url": "https://github.com/rust-lang/rust/commit/be7e554c81c85f144cbefbe4591f35e1a23d67e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be7e554c81c85f144cbefbe4591f35e1a23d67e9/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29a900d9165607492f1c7c9322278bc1f0239e1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/29a900d9165607492f1c7c9322278bc1f0239e1b", "html_url": "https://github.com/rust-lang/rust/commit/29a900d9165607492f1c7c9322278bc1f0239e1b"}, {"sha": "364f42d78d5227c6d31360a4fe6ba3503256133a", "url": "https://api.github.com/repos/rust-lang/rust/commits/364f42d78d5227c6d31360a4fe6ba3503256133a", "html_url": "https://github.com/rust-lang/rust/commit/364f42d78d5227c6d31360a4fe6ba3503256133a"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "913f7b4ee89864e0f21eb1c84c0f8accb6d6ef35", "filename": "build.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/be7e554c81c85f144cbefbe4591f35e1a23d67e9/build.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be7e554c81c85f144cbefbe4591f35e1a23d67e9/build.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.rs?ref=be7e554c81c85f144cbefbe4591f35e1a23d67e9", "patch": "@@ -21,6 +21,15 @@ use rustc_version::{version_meta, version_meta_for, Channel, Version, VersionMet\n use ansi_term::Colour::Red;\n \n fn main() {\n+    check_rustc_version();\n+\n+    // Forward the profile to the main compilation\n+    println!(\"cargo:rustc-env=PROFILE={}\", env::var(\"PROFILE\").unwrap());\n+    // Don't rebuild even if nothing changed\n+    println!(\"cargo:rerun-if-changed=build.rs\");\n+}\n+\n+fn check_rustc_version() {\n     let string = include_str!(\"min_version.txt\");\n     let min_version_meta = version_meta_for(string)\n         .expect(\"Could not parse version string in min_version.txt\");\n@@ -31,6 +40,12 @@ fn main() {\n     let min_date_str = min_version_meta.clone().commit_date\n         .expect(\"min_version.txt does not contain a rustc commit date\");\n \n+    // Dev channel (rustc built from git) does not have any date or commit information in rustc -vV\n+    // `current_version_meta.commit_date` would crash, so we return early here.\n+    if current_version_meta.channel == Channel::Dev {\n+        return\n+    }\n+\n     let current_version = current_version_meta.clone().semver;\n     let current_date_str = current_version_meta.clone().commit_date\n         .expect(\"current rustc version information does not contain a rustc commit date\");\n@@ -69,11 +84,6 @@ fn main() {\n         print_version_err(&current_version, &*current_date_str);\n         panic!(\"Aborting compilation due to incompatible compiler.\")\n     }\n-\n-    // Forward the profile to the main compilation\n-    println!(\"cargo:rustc-env=PROFILE={}\", env::var(\"PROFILE\").unwrap());\n-    // Don't rebuild even if nothing changed\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n }\n \n fn correct_channel(version_meta: &VersionMeta) -> bool {"}]}