{"sha": "d2199e87166e82c394bf7d8c28374287145ff1b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyMTk5ZTg3MTY2ZTgyYzM5NGJmN2Q4YzI4Mzc0Mjg3MTQ1ZmYxYjc=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-15T22:27:55Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-11-16T23:24:56Z"}, "message": "Various fixes for x86_64 on linux\n\nConfigure LLVM correctly, use the right data layout, add the readlink\nfunction back, fix C constants, etc.", "tree": {"sha": "478b9e2c62765ace785d3b0ce023da6f416d68ba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/478b9e2c62765ace785d3b0ce023da6f416d68ba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2199e87166e82c394bf7d8c28374287145ff1b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2199e87166e82c394bf7d8c28374287145ff1b7", "html_url": "https://github.com/rust-lang/rust/commit/d2199e87166e82c394bf7d8c28374287145ff1b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2199e87166e82c394bf7d8c28374287145ff1b7/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "319f3b02f3272ce5b58b04bc3d2abfc5b33991f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/319f3b02f3272ce5b58b04bc3d2abfc5b33991f0", "html_url": "https://github.com/rust-lang/rust/commit/319f3b02f3272ce5b58b04bc3d2abfc5b33991f0"}], "stats": {"total": 42, "additions": 31, "deletions": 11}, "files": [{"sha": "bc904afbeebc3f2e2d40ae535b3fafd74741c770", "filename": "configure", "status": "modified", "additions": 21, "deletions": 7, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/d2199e87166e82c394bf7d8c28374287145ff1b7/configure", "raw_url": "https://github.com/rust-lang/rust/raw/d2199e87166e82c394bf7d8c28374287145ff1b7/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=d2199e87166e82c394bf7d8c28374287145ff1b7", "patch": "@@ -339,7 +339,7 @@ if [ -z \"$CFG_TARGET_TRIPLES\" ]\n then\n     CFG_TARGET_TRIPLES=\"${CFG_HOST_TRIPLE}\"\n else\n-    CFG_TARGET_TRIPLES=\"${CFG_TARGET_TRIPLES/,/ }\"\n+    CFG_TARGET_TRIPLES=\"$(echo $CFG_TARGET_TRIPLES | tr ',' ' ')\"\n fi\n \n \n@@ -459,12 +459,26 @@ do\n \tLLVM_CXXFLAGS_32=\"-m32\"\n \tLLVM_LDFLAGS_32=\"-m32\"\n \n-        # FIXME: Need to change flags for x64\n-\tLLVM_CXX=$LLVM_CXX_32\n-\tLLVM_CC=$LLVM_CC_32\n-\tLLVM_CFLAGS=$LLVM_CFLAGS_32\n-\tLLVM_CXXFLAGS=$LLVM_CXXFLAGS_32\n-\tLLVM_LDFLAGS=$LLVM_LDFLAGS_32\n+\tLLVM_CXX_64=\"g++\"\n+\tLLVM_CC_64=\"gcc\"\n+\tLLVM_CFLAGS_64=\"\"\n+\tLLVM_CXXFLAGS_64=\"\"\n+\tLLVM_LDFLAGS_64=\"\"\n+\n+\tif echo $t | grep x86_64\n+\tthen\n+\t    LLVM_CXX=$LLVM_CXX_64\n+\t    LLVM_CC=$LLVM_CC_64\n+\t    LLVM_CFLAGS=$LLVM_CFLAGS_64\n+\t    LLVM_CXXFLAGS=$LLVM_CXXFLAGS_64\n+\t    LLVM_LDFLAGS=$LLVM_LDFLAGS_64\n+\telse\n+\t    LLVM_CXX=$LLVM_CXX_32\n+\t    LLVM_CC=$LLVM_CC_32\n+\t    LLVM_CFLAGS=$LLVM_CFLAGS_32\n+\t    LLVM_CXXFLAGS=$LLVM_CXXFLAGS_32\n+\t    LLVM_LDFLAGS=$LLVM_LDFLAGS_32\n+\tfi\n \n \tCXX=$LLVM_CXX\n \tCC=$LLVM_CC"}, {"sha": "97731965e9341fa830d43d69a070ed600af46853", "filename": "src/comp/back/x86_64.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Fcomp%2Fback%2Fx86_64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Fcomp%2Fback%2Fx86_64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Fx86_64.rs?ref=d2199e87166e82c394bf7d8c28374287145ff1b7", "patch": "@@ -18,11 +18,16 @@ fn get_target_strs(target_os: session::os) -> target_strs::t {\n           }\n \n           session::os_win32. {\n-            \"e-p:32:32-f64:64:64-i64:64:64-f80:32:32-n8:16:32\" //NDM i386\n+            // FIXME: Test this. Copied from linux\n+            \"e-p:64:64:64-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:64:64-\"+\n+                \"f32:32:32-f64:64:64-v64:64:64-v128:128:128-a0:0:64-\"+\n+                \"s0:64:64-f80:128:128-n8:16:32:64-S128\"\n           }\n \n           session::os_linux. {\n-            \"e-p:32:32-f64:32:64-i64:32:64-f80:32:32-n8:16:32\" //NDM i386\n+            \"e-p:64:64:64-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:64:64-\"+\n+                \"f32:32:32-f64:64:64-v64:64:64-v128:128:128-a0:0:64-\"+\n+                \"s0:64:64-f80:128:128-n8:16:32:64-S128\"\n           }\n         },\n "}, {"sha": "2a172fb1d3c44039609d029198aa734a68154703", "filename": "src/lib/linux_os.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Flib%2Flinux_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Flib%2Flinux_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Flinux_os.rs?ref=d2199e87166e82c394bf7d8c28374287145ff1b7", "patch": "@@ -50,6 +50,7 @@ native mod libc {\n     fn unsetenv(n: str::sbuf) -> c_int;\n     fn pipe(buf: *mutable fd_t) -> c_int;\n     fn waitpid(pid: pid_t, &status: c_int, options: c_int) -> pid_t;\n+    fn readlink(path: str::sbuf, buf: str::sbuf, bufsize: size_t) -> ssize_t;\n }\n \n mod libc_constants {"}, {"sha": "1808abd51ae650f64f941ea3aea9016490e42d50", "filename": "src/lib/run_program.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Flib%2Frun_program.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Flib%2Frun_program.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Frun_program.rs?ref=d2199e87166e82c394bf7d8c28374287145ff1b7", "patch": "@@ -278,7 +278,7 @@ fn waitpid(pid: pid_t) -> int {\n \n         #[cfg(target_os = \"linux\")]\n         fn WEXITSTATUS(status: i32) -> i32 {\n-            (status >> 8) & 0xff\n+            (status >> 8i32) & 0xffi32\n         }\n \n         #[cfg(target_os = \"macos\")]"}, {"sha": "7ea29f2cea1af58a12b9e2f6b5414d3cbeaac94b", "filename": "src/rt/arch/x86_64/ccall.S", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Frt%2Farch%2Fx86_64%2Fccall.S", "raw_url": "https://github.com/rust-lang/rust/raw/d2199e87166e82c394bf7d8c28374287145ff1b7/src%2Frt%2Farch%2Fx86_64%2Fccall.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fccall.S?ref=d2199e87166e82c394bf7d8c28374287145ff1b7", "patch": "@@ -61,7 +61,7 @@ upcall_call_c_stack_float:\n _upcall_call_c_stack_shim:\n #else\n .globl upcall_call_c_stack_shim\n-upcall_call_c_stack_shim\n+upcall_call_c_stack_shim:\n #endif\n     push %rbp\n     mov %rsp,%rbp          // save rsp"}]}