{"sha": "79f99e7969846f1e64b653757c73ddbe6da74df5", "node_id": "C_kwDOAAsO6NoAKDc5Zjk5ZTc5Njk4NDZmMWU2NGI2NTM3NTdjNzNkZGJlNmRhNzRkZjU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-11T22:36:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-11T22:36:47Z"}, "message": "Rollup merge of #105555 - krasimirgg:llvm-int-opt-2, r=cuviper\n\nllvm-wrapper: adapt for LLVM API changes\n\nThis is a follow-up of https://github.com/rust-lang/rust/commit/75aec4703dea7ef8e13924ccfa3a3d2e8c5c7cff. There, I updated the wrapper to only include llvm/ADT/Optional.h for LLVM version below 16. But I missed updating some of the None references.\n\nFound by our experimental rust + llvm at HEAD bot: https://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/15587#0185006b-e0af-49e5-8b06-280ed125ff0d/200-539", "tree": {"sha": "c0b03ba539640147a3dcc6ecaf424f8f16225bce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0b03ba539640147a3dcc6ecaf424f8f16225bce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79f99e7969846f1e64b653757c73ddbe6da74df5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjllt/CRBK7hj4Ov3rIwAAQKoIAH/Hd+Ei0Cmh8qtF6PsbPJkJ\nEJIFDDYF8h8Dde1TV/T3tdRaKl5XOf31VGqln1DHXqclAihFip2qvSlfGcDAFuM9\nK7XYV6O2EVk4o1wsE7213/MI4AukadT387RYwpVyftFUD3ZraHFjEKqvPNbtHyBZ\nS/sVe2cGCfp5vlLfwzfzrQxsxNGwTxUY/GB2WrGZBHScNEVD0GzY7LWh4YeI9l+2\nYnZ4XP7i+htbGYhZ7km5hr+mOUEpmMssbPdzUZRJbU9+ZxYF0yZF4yEXZuRjevol\nFuGQ7F0TjDLuTr8dFkJxwcEViF/DOJiFZIFWdG+T/i2Bwa9dH3+8GlqAuJGN17U=\n=SC2U\n-----END PGP SIGNATURE-----\n", "payload": "tree c0b03ba539640147a3dcc6ecaf424f8f16225bce\nparent 6042f5bca76f581c2572d3f36d1b2caa23d2c953\nparent cbdc00f6e61132cbb74397cbb91171756e5d5834\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1670798207 +0100\ncommitter GitHub <noreply@github.com> 1670798207 +0100\n\nRollup merge of #105555 - krasimirgg:llvm-int-opt-2, r=cuviper\n\nllvm-wrapper: adapt for LLVM API changes\n\nThis is a follow-up of https://github.com/rust-lang/rust/commit/75aec4703dea7ef8e13924ccfa3a3d2e8c5c7cff. There, I updated the wrapper to only include llvm/ADT/Optional.h for LLVM version below 16. But I missed updating some of the None references.\n\nFound by our experimental rust + llvm at HEAD bot: https://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/15587#0185006b-e0af-49e5-8b06-280ed125ff0d/200-539\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79f99e7969846f1e64b653757c73ddbe6da74df5", "html_url": "https://github.com/rust-lang/rust/commit/79f99e7969846f1e64b653757c73ddbe6da74df5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79f99e7969846f1e64b653757c73ddbe6da74df5/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6042f5bca76f581c2572d3f36d1b2caa23d2c953", "url": "https://api.github.com/repos/rust-lang/rust/commits/6042f5bca76f581c2572d3f36d1b2caa23d2c953", "html_url": "https://github.com/rust-lang/rust/commit/6042f5bca76f581c2572d3f36d1b2caa23d2c953"}, {"sha": "cbdc00f6e61132cbb74397cbb91171756e5d5834", "url": "https://api.github.com/repos/rust-lang/rust/commits/cbdc00f6e61132cbb74397cbb91171756e5d5834", "html_url": "https://github.com/rust-lang/rust/commit/cbdc00f6e61132cbb74397cbb91171756e5d5834"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "2865ea8927336143490193bddbeaec125dda6789", "filename": "compiler/rustc_llvm/llvm-wrapper/PassWrapper.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/79f99e7969846f1e64b653757c73ddbe6da74df5/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/79f99e7969846f1e64b653757c73ddbe6da74df5/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp?ref=79f99e7969846f1e64b653757c73ddbe6da74df5", "patch": "@@ -223,7 +223,11 @@ fromRust(LLVMRustCodeModel Model) {\n   case LLVMRustCodeModel::Large:\n     return CodeModel::Large;\n   case LLVMRustCodeModel::None:\n+#if LLVM_VERSION_LT(16, 0)\n     return None;\n+#else\n+    return std::nullopt;\n+#endif\n   default:\n     report_fatal_error(\"Bad CodeModel.\");\n   }"}, {"sha": "279b699185421982026fad27f12804d00a8e7d8d", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/79f99e7969846f1e64b653757c73ddbe6da74df5/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/79f99e7969846f1e64b653757c73ddbe6da74df5/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=79f99e7969846f1e64b653757c73ddbe6da74df5", "patch": "@@ -322,7 +322,13 @@ extern \"C\" LLVMAttributeRef LLVMRustCreateUWTableAttr(LLVMContextRef C, bool Asy\n }\n \n extern \"C\" LLVMAttributeRef LLVMRustCreateAllocSizeAttr(LLVMContextRef C, uint32_t ElementSizeArg) {\n-  return wrap(Attribute::getWithAllocSizeArgs(*unwrap(C), ElementSizeArg, None));\n+  return wrap(Attribute::getWithAllocSizeArgs(*unwrap(C), ElementSizeArg,\n+#if LLVM_VERSION_LT(16, 0)\n+                                              None\n+#else\n+                                              std::nullopt\n+#endif\n+                                              ));\n }\n \n #if LLVM_VERSION_GE(15, 0)\n@@ -717,7 +723,11 @@ static std::optional<DIFile::ChecksumKind> fromRust(LLVMRustChecksumKind Kind) {\n #endif\n   switch (Kind) {\n   case LLVMRustChecksumKind::None:\n+#if LLVM_VERSION_LT(16, 0)\n     return None;\n+#else\n+    return std::nullopt;\n+#endif\n   case LLVMRustChecksumKind::MD5:\n     return DIFile::ChecksumKind::CSK_MD5;\n   case LLVMRustChecksumKind::SHA1:"}]}