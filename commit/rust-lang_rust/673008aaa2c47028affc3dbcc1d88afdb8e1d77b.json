{"sha": "673008aaa2c47028affc3dbcc1d88afdb8e1d77b", "node_id": "C_kwDOAAsO6NoAKDY3MzAwOGFhYTJjNDcwMjhhZmZjM2RiY2MxZDg4YWZkYjhlMWQ3N2I", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-18T06:48:21Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-18T06:48:21Z"}, "message": "Auto merge of #14822 - Veykril:augmentsSyntaxTokens-vscode, r=Veykril\n\nfix: Force disable augmentsSyntaxTokens capability on VSCode\n\nThe default textmate grammar for rust in VSCode is pretty brittle, quite often coloring things very differently than we'd like to so we force full semantic highlighting by disabling that config.", "tree": {"sha": "0e760f16df3145b9fdf2ed6dfcee0698f2efb3c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e760f16df3145b9fdf2ed6dfcee0698f2efb3c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/673008aaa2c47028affc3dbcc1d88afdb8e1d77b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/673008aaa2c47028affc3dbcc1d88afdb8e1d77b", "html_url": "https://github.com/rust-lang/rust/commit/673008aaa2c47028affc3dbcc1d88afdb8e1d77b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/673008aaa2c47028affc3dbcc1d88afdb8e1d77b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7b03491cdb40a3b900c7db3c4193d5cc704a7d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7b03491cdb40a3b900c7db3c4193d5cc704a7d7", "html_url": "https://github.com/rust-lang/rust/commit/c7b03491cdb40a3b900c7db3c4193d5cc704a7d7"}, {"sha": "0028e73927fc4e3402c7243511936de0f2bc17bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/0028e73927fc4e3402c7243511936de0f2bc17bc", "html_url": "https://github.com/rust-lang/rust/commit/0028e73927fc4e3402c7243511936de0f2bc17bc"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "f721fcce7663860d3e1b3b95d75375b49bbb0d6b", "filename": "editors/code/src/client.ts", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/673008aaa2c47028affc3dbcc1d88afdb8e1d77b/editors%2Fcode%2Fsrc%2Fclient.ts", "raw_url": "https://github.com/rust-lang/rust/raw/673008aaa2c47028affc3dbcc1d88afdb8e1d77b/editors%2Fcode%2Fsrc%2Fclient.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fclient.ts?ref=673008aaa2c47028affc3dbcc1d88afdb8e1d77b", "patch": "@@ -366,6 +366,7 @@ export async function createClient(\n \n     // To turn on all proposed features use: client.registerProposedFeatures();\n     client.registerFeature(new ExperimentalFeatures());\n+    client.registerFeature(new OverrideFeatures());\n \n     return client;\n }\n@@ -401,6 +402,25 @@ class ExperimentalFeatures implements lc.StaticFeature {\n     dispose(): void {}\n }\n \n+class OverrideFeatures implements lc.StaticFeature {\n+    getState(): lc.FeatureState {\n+        return { kind: \"static\" };\n+    }\n+    fillClientCapabilities(capabilities: lc.ClientCapabilities): void {\n+        // Force disable `augmentsSyntaxTokens`, VSCode's textmate grammar is somewhat incomplete\n+        // making the experience generally worse\n+        const caps = capabilities.textDocument?.semanticTokens;\n+        if (caps) {\n+            caps.augmentsSyntaxTokens = false;\n+        }\n+    }\n+    initialize(\n+        _capabilities: lc.ServerCapabilities,\n+        _documentSelector: lc.DocumentSelector | undefined\n+    ): void {}\n+    dispose(): void {}\n+}\n+\n function isCodeActionWithoutEditsAndCommands(value: any): boolean {\n     const candidate: lc.CodeAction = value;\n     return ("}]}