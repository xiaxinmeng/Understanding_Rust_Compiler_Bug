{"sha": "9c83f8c4d1e562cd73a29a00828d68e2b520a086", "node_id": "C_kwDOAAsO6NoAKDljODNmOGM0ZDFlNTYyY2Q3M2EyOWEwMDgyOGQ2OGUyYjUyMGEwODY", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-10-26T04:33:12Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-11-21T14:15:21Z"}, "message": "Simplify for loop desugar", "tree": {"sha": "a7b824c188a775e1de44c0e9c44dffe2d039c78f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7b824c188a775e1de44c0e9c44dffe2d039c78f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c83f8c4d1e562cd73a29a00828d68e2b520a086", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c83f8c4d1e562cd73a29a00828d68e2b520a086", "html_url": "https://github.com/rust-lang/rust/commit/9c83f8c4d1e562cd73a29a00828d68e2b520a086", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c83f8c4d1e562cd73a29a00828d68e2b520a086/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bfde2f1f4fc9409ecb63dfe1370df66171cf861", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bfde2f1f4fc9409ecb63dfe1370df66171cf861", "html_url": "https://github.com/rust-lang/rust/commit/3bfde2f1f4fc9409ecb63dfe1370df66171cf861"}], "stats": {"total": 433, "additions": 179, "deletions": 254}, "files": [{"sha": "a0a63620c08a9e02fae235ec9ed36a2b56a71cb5", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 38, "deletions": 99, "changes": 137, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -13,7 +13,7 @@ use rustc_session::parse::feature_err;\n use rustc_span::hygiene::ExpnId;\n use rustc_span::source_map::{respan, DesugaringKind, Span, Spanned};\n use rustc_span::symbol::{sym, Ident, Symbol};\n-use rustc_span::{hygiene::ForLoopLoc, DUMMY_SP};\n+use rustc_span::DUMMY_SP;\n \n impl<'hir> LoweringContext<'_, 'hir> {\n     fn lower_exprs(&mut self, exprs: &[AstP<Expr>]) -> &'hir [hir::Expr<'hir>] {\n@@ -1308,16 +1308,13 @@ impl<'hir> LoweringContext<'_, 'hir> {\n     /// Desugar `ExprForLoop` from: `[opt_ident]: for <pat> in <head> <body>` into:\n     /// ```rust\n     /// {\n-    ///     let result = match ::std::iter::IntoIterator::into_iter(<head>) {\n+    ///     let result = match IntoIterator::into_iter(<head>) {\n     ///         mut iter => {\n     ///             [opt_ident]: loop {\n-    ///                 let mut __next;\n-    ///                 match ::std::iter::Iterator::next(&mut iter) {\n-    ///                     ::std::option::Option::Some(val) => __next = val,\n-    ///                     ::std::option::Option::None => break\n+    ///                 match Iterator::next(&mut iter) {\n+    ///                     None => break,\n+    ///                     Some(<pat>) => <body>,\n     ///                 };\n-    ///                 let <pat> = __next;\n-    ///                 StmtKind::Expr(<body>);\n     ///             }\n     ///         }\n     ///     };\n@@ -1332,133 +1329,75 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         body: &Block,\n         opt_label: Option<Label>,\n     ) -> hir::Expr<'hir> {\n-        // expand <head>\n         let head = self.lower_expr_mut(head);\n-        let desugared_span =\n-            self.mark_span_with_reason(DesugaringKind::ForLoop(ForLoopLoc::Head), head.span, None);\n-        let e_span = self.lower_span(e.span);\n-\n-        let iter = Ident::with_dummy_span(sym::iter);\n-\n-        let next_ident = Ident::with_dummy_span(sym::__next);\n-        let (next_pat, next_pat_hid) = self.pat_ident_binding_mode(\n-            desugared_span,\n-            next_ident,\n-            hir::BindingAnnotation::Mutable,\n-        );\n-\n-        // `::std::option::Option::Some(val) => __next = val`\n-        let pat_arm = {\n-            let val_ident = Ident::with_dummy_span(sym::val);\n-            let pat_span = self.lower_span(pat.span);\n-            let (val_pat, val_pat_hid) = self.pat_ident(pat_span, val_ident);\n-            let val_expr = self.expr_ident(pat_span, val_ident, val_pat_hid);\n-            let next_expr = self.expr_ident(pat_span, next_ident, next_pat_hid);\n-            let assign = self.arena.alloc(self.expr(\n-                pat_span,\n-                hir::ExprKind::Assign(next_expr, val_expr, self.lower_span(pat_span)),\n-                ThinVec::new(),\n-            ));\n-            let some_pat = self.pat_some(pat_span, val_pat);\n-            self.arm(some_pat, assign)\n-        };\n+        let pat = self.lower_pat(pat);\n+        let for_span =\n+            self.mark_span_with_reason(DesugaringKind::ForLoop, self.lower_span(e.span), None);\n+        let head_span = self.mark_span_with_reason(DesugaringKind::ForLoop, head.span, None);\n+        let pat_span = self.mark_span_with_reason(DesugaringKind::ForLoop, pat.span, None);\n \n-        // `::std::option::Option::None => break`\n-        let break_arm = {\n+        // `None => break`\n+        let none_arm = {\n             let break_expr =\n-                self.with_loop_scope(e.id, |this| this.expr_break_alloc(e_span, ThinVec::new()));\n-            let pat = self.pat_none(e_span);\n+                self.with_loop_scope(e.id, |this| this.expr_break_alloc(for_span, ThinVec::new()));\n+            let pat = self.pat_none(for_span);\n             self.arm(pat, break_expr)\n         };\n \n+        // Some(<pat>) => <body>,\n+        let some_arm = {\n+            let some_pat = self.pat_some(pat_span, pat);\n+            let body_block = self.with_loop_scope(e.id, |this| this.lower_block(body, false));\n+            let body_expr = self.arena.alloc(self.expr_block(body_block, ThinVec::new()));\n+            self.arm(some_pat, body_expr)\n+        };\n+\n         // `mut iter`\n+        let iter = Ident::with_dummy_span(sym::iter);\n         let (iter_pat, iter_pat_nid) =\n-            self.pat_ident_binding_mode(desugared_span, iter, hir::BindingAnnotation::Mutable);\n+            self.pat_ident_binding_mode(head_span, iter, hir::BindingAnnotation::Mutable);\n \n-        // `match ::std::iter::Iterator::next(&mut iter) { ... }`\n+        // `match Iterator::next(&mut iter) { ... }`\n         let match_expr = {\n-            let iter = self.expr_ident(desugared_span, iter, iter_pat_nid);\n-            let ref_mut_iter = self.expr_mut_addr_of(desugared_span, iter);\n+            let iter = self.expr_ident(head_span, iter, iter_pat_nid);\n+            let ref_mut_iter = self.expr_mut_addr_of(head_span, iter);\n             let next_expr = self.expr_call_lang_item_fn(\n-                desugared_span,\n+                head_span,\n                 hir::LangItem::IteratorNext,\n                 arena_vec![self; ref_mut_iter],\n             );\n-            let arms = arena_vec![self; pat_arm, break_arm];\n+            let arms = arena_vec![self; none_arm, some_arm];\n \n-            self.expr_match(desugared_span, next_expr, arms, hir::MatchSource::ForLoopDesugar)\n+            self.expr_match(head_span, next_expr, arms, hir::MatchSource::ForLoopDesugar)\n         };\n-        let match_stmt = self.stmt_expr(desugared_span, match_expr);\n-\n-        let next_expr = self.expr_ident(desugared_span, next_ident, next_pat_hid);\n-\n-        // `let mut __next`\n-        let next_let = self.stmt_let_pat(\n-            None,\n-            desugared_span,\n-            None,\n-            next_pat,\n-            hir::LocalSource::ForLoopDesugar,\n-        );\n+        let match_stmt = self.stmt_expr(for_span, match_expr);\n \n-        // `let <pat> = __next`\n-        let pat = self.lower_pat(pat);\n-        let pat_let = self.stmt_let_pat(\n-            None,\n-            desugared_span,\n-            Some(next_expr),\n-            pat,\n-            hir::LocalSource::ForLoopDesugar,\n-        );\n-\n-        let body_block = self.with_loop_scope(e.id, |this| this.lower_block(body, false));\n-        let body_expr = self.expr_block(body_block, ThinVec::new());\n-        let body_stmt = self.stmt_expr(body_block.span, body_expr);\n-\n-        let loop_block = self.block_all(\n-            e_span,\n-            arena_vec![self; next_let, match_stmt, pat_let, body_stmt],\n-            None,\n-        );\n+        let loop_block = self.block_all(for_span, arena_vec![self; match_stmt], None);\n \n         // `[opt_ident]: loop { ... }`\n         let kind = hir::ExprKind::Loop(\n             loop_block,\n             self.lower_label(opt_label),\n             hir::LoopSource::ForLoop,\n-            self.lower_span(e_span.with_hi(head.span.hi())),\n+            self.lower_span(for_span.with_hi(head.span.hi())),\n         );\n-        let loop_expr = self.arena.alloc(hir::Expr {\n-            hir_id: self.lower_node_id(e.id),\n-            kind,\n-            span: self.lower_span(e.span),\n-        });\n+        let loop_expr =\n+            self.arena.alloc(hir::Expr { hir_id: self.lower_node_id(e.id), kind, span: for_span });\n \n         // `mut iter => { ... }`\n         let iter_arm = self.arm(iter_pat, loop_expr);\n \n-        let into_iter_span = self.mark_span_with_reason(\n-            DesugaringKind::ForLoop(ForLoopLoc::IntoIter),\n-            head.span,\n-            None,\n-        );\n-\n         // `match ::std::iter::IntoIterator::into_iter(<head>) { ... }`\n         let into_iter_expr = {\n             self.expr_call_lang_item_fn(\n-                into_iter_span,\n+                head_span,\n                 hir::LangItem::IntoIterIntoIter,\n                 arena_vec![self; head],\n             )\n         };\n \n-        // #82462: to correctly diagnose borrow errors, the block that contains\n-        // the iter expr needs to have a span that covers the loop body.\n-        let desugared_full_span =\n-            self.mark_span_with_reason(DesugaringKind::ForLoop(ForLoopLoc::Head), e_span, None);\n-\n         let match_expr = self.arena.alloc(self.expr_match(\n-            desugared_full_span,\n+            for_span,\n             into_iter_expr,\n             arena_vec![self; iter_arm],\n             hir::MatchSource::ForLoopDesugar,\n@@ -1472,7 +1411,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         // surrounding scope of the `match` since the `match` is not a terminating scope.\n         //\n         // Also, add the attributes to the outer returned expr node.\n-        self.expr_drop_temps_mut(desugared_full_span, match_expr, attrs.into())\n+        self.expr_drop_temps_mut(for_span, match_expr, attrs.into())\n     }\n \n     /// Desugar `ExprKind::Try` from: `<expr>?` into:"}, {"sha": "db8268c8e2e89bfbdd275d68956328e1f5d14503", "filename": "compiler/rustc_borrowck/src/diagnostics/explain_borrow.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fexplain_borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fexplain_borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fexplain_borrow.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -13,7 +13,7 @@ use rustc_middle::mir::{\n use rustc_middle::ty::adjustment::PointerCast;\n use rustc_middle::ty::{self, RegionVid, TyCtxt};\n use rustc_span::symbol::Symbol;\n-use rustc_span::Span;\n+use rustc_span::{sym, DesugaringKind, Span};\n \n use crate::region_infer::BlameConstraint;\n use crate::{\n@@ -135,7 +135,16 @@ impl BorrowExplanation {\n                 should_note_order,\n             } => {\n                 let local_decl = &body.local_decls[dropped_local];\n-                let (dtor_desc, type_desc) = match local_decl.ty.kind() {\n+                let mut ty = local_decl.ty;\n+                if local_decl.source_info.span.desugaring_kind() == Some(DesugaringKind::ForLoop) {\n+                    if let ty::Adt(adt, substs) = local_decl.ty.kind() {\n+                        if tcx.is_diagnostic_item(sym::Option, adt.did) {\n+                            // in for loop desugaring, only look at the `Some(..)` inner type\n+                            ty = substs.type_at(0);\n+                        }\n+                    }\n+                }\n+                let (dtor_desc, type_desc) = match ty.kind() {\n                     // If type is an ADT that implements Drop, then\n                     // simplify output by reporting just the ADT name.\n                     ty::Adt(adt, _substs) if adt.has_dtor(tcx) && !adt.is_box() => {"}, {"sha": "79623e26eb710d304d4556ad30a335aa42a07fbe", "filename": "compiler/rustc_borrowck/src/diagnostics/mod.rs", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -13,11 +13,7 @@ use rustc_middle::mir::{\n use rustc_middle::ty::print::Print;\n use rustc_middle::ty::{self, DefIdTree, Instance, Ty, TyCtxt};\n use rustc_mir_dataflow::move_paths::{InitLocation, LookupResult};\n-use rustc_span::{\n-    hygiene::{DesugaringKind, ForLoopLoc},\n-    symbol::sym,\n-    Span,\n-};\n+use rustc_span::{hygiene::DesugaringKind, symbol::sym, Span};\n use rustc_target::abi::VariantIdx;\n \n use super::borrow_set::BorrowData;\n@@ -955,10 +951,8 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n             let kind = kind.unwrap_or_else(|| {\n                 // This isn't a 'special' use of `self`\n                 debug!(\"move_spans: method_did={:?}, fn_call_span={:?}\", method_did, fn_call_span);\n-                let implicit_into_iter = matches!(\n-                    fn_call_span.desugaring_kind(),\n-                    Some(DesugaringKind::ForLoop(ForLoopLoc::IntoIter))\n-                );\n+                let implicit_into_iter = Some(method_did) == tcx.lang_items().into_iter_fn()\n+                    && fn_call_span.desugaring_kind() == Some(DesugaringKind::ForLoop);\n                 let parent_self_ty = parent\n                     .filter(|did| tcx.def_kind(*did) == rustc_hir::def::DefKind::Impl)\n                     .and_then(|did| match tcx.type_of(did).kind() {"}, {"sha": "46e2a99a0d0940cd381dafef4ee1fda32267913b", "filename": "compiler/rustc_borrowck/src/diagnostics/mutability_errors.rs", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -445,15 +445,23 @@ impl<'a, 'tcx> MirBorrowckCtxt<'a, 'tcx> {\n                                 },\n                             ))) => {\n                                 // check if the RHS is from desugaring\n-                                let locations = self.body.find_assignments(local);\n-                                let opt_assignment_rhs_span = locations\n-                                    .first()\n-                                    .map(|&location| self.body.source_info(location).span);\n-                                let opt_desugaring_kind =\n-                                    opt_assignment_rhs_span.and_then(|span| span.desugaring_kind());\n-                                match opt_desugaring_kind {\n+                                let opt_assignment_rhs_span =\n+                                    self.body.find_assignments(local).first().map(|&location| {\n+                                        let stmt = &self.body[location.block].statements\n+                                            [location.statement_index];\n+                                        match stmt.kind {\n+                                            mir::StatementKind::Assign(box (\n+                                                _,\n+                                                mir::Rvalue::Use(mir::Operand::Copy(place)),\n+                                            )) => {\n+                                                self.body.local_decls[place.local].source_info.span\n+                                            }\n+                                            _ => self.body.source_info(location).span,\n+                                        }\n+                                    });\n+                                match opt_assignment_rhs_span.and_then(|s| s.desugaring_kind()) {\n                                     // on for loops, RHS points to the iterator part\n-                                    Some(DesugaringKind::ForLoop(_)) => {\n+                                    Some(DesugaringKind::ForLoop) => {\n                                         self.suggest_similar_mut_method_for_for_loop(&mut err);\n                                         Some((\n                                             false,"}, {"sha": "c67d3df3dedd85b9d4457e50ecdcf9b669809ebd", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -1821,8 +1821,6 @@ impl<'hir> QPath<'hir> {\n pub enum LocalSource {\n     /// A `match _ { .. }`.\n     Normal,\n-    /// A desugared `for _ in _ { .. }` loop.\n-    ForLoopDesugar,\n     /// When lowering async functions, we create locals within the `async move` so that\n     /// all parameters are dropped after the future is polled.\n     ///"}, {"sha": "b30076100bb2c5f665aeb164db7a6208f522b838", "filename": "compiler/rustc_hir/src/pat_util.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_hir%2Fsrc%2Fpat_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_hir%2Fsrc%2Fpat_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fpat_util.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -2,6 +2,7 @@ use crate::def::{CtorOf, DefKind, Res};\n use crate::def_id::DefId;\n use crate::hir::{self, HirId, PatKind};\n use rustc_data_structures::stable_set::FxHashSet;\n+use rustc_span::hygiene::DesugaringKind;\n use rustc_span::symbol::Ident;\n use rustc_span::Span;\n \n@@ -143,4 +144,14 @@ impl hir::Pat<'_> {\n         });\n         result\n     }\n+\n+    /// If the pattern is `Some(<pat>)` from a desugared for loop, returns the inner pattern\n+    pub fn for_loop_some(&self) -> Option<&Self> {\n+        if self.span.desugaring_kind() == Some(DesugaringKind::ForLoop) {\n+            if let hir::PatKind::Struct(_, [pat_field], _) = self.kind {\n+                return Some(pat_field.pat);\n+            }\n+        }\n+        None\n+    }\n }"}, {"sha": "a7e019a53ee13586c835b1991c38109fa0e32915", "filename": "compiler/rustc_infer/src/infer/error_reporting/need_type_info.rs", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fneed_type_info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fneed_type_info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fneed_type_info.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -5,13 +5,12 @@ use rustc_hir as hir;\n use rustc_hir::def::{DefKind, Namespace};\n use rustc_hir::def_id::DefId;\n use rustc_hir::intravisit::{self, NestedVisitorMap, Visitor};\n-use rustc_hir::{Body, Expr, ExprKind, FnRetTy, HirId, Local, Pat};\n+use rustc_hir::{Body, Expr, ExprKind, FnRetTy, HirId, Local, MatchSource, Pat};\n use rustc_middle::hir::map::Map;\n use rustc_middle::infer::unify_key::ConstVariableOriginKind;\n use rustc_middle::ty::print::Print;\n use rustc_middle::ty::subst::{GenericArg, GenericArgKind};\n use rustc_middle::ty::{self, DefIdTree, InferConst, Ty, TyCtxt};\n-use rustc_span::source_map::DesugaringKind;\n use rustc_span::symbol::kw;\n use rustc_span::Span;\n use std::borrow::Cow;\n@@ -26,6 +25,7 @@ struct FindHirNodeVisitor<'a, 'tcx> {\n     found_closure: Option<&'tcx Expr<'tcx>>,\n     found_method_call: Option<&'tcx Expr<'tcx>>,\n     found_exact_method_call: Option<&'tcx Expr<'tcx>>,\n+    found_for_loop_iter: Option<&'tcx Expr<'tcx>>,\n     found_use_diagnostic: Option<UseDiagnostic<'tcx>>,\n }\n \n@@ -41,6 +41,7 @@ impl<'a, 'tcx> FindHirNodeVisitor<'a, 'tcx> {\n             found_closure: None,\n             found_method_call: None,\n             found_exact_method_call: None,\n+            found_for_loop_iter: None,\n             found_use_diagnostic: None,\n         }\n     }\n@@ -111,6 +112,15 @@ impl<'a, 'tcx> Visitor<'tcx> for FindHirNodeVisitor<'a, 'tcx> {\n     }\n \n     fn visit_expr(&mut self, expr: &'tcx Expr<'tcx>) {\n+        if let ExprKind::Match(scrutinee, [_, arm], MatchSource::ForLoopDesugar) = expr.kind {\n+            if let Some(pat) = arm.pat.for_loop_some() {\n+                if let Some(ty) = self.node_ty_contains_target(pat.hir_id) {\n+                    self.found_for_loop_iter = Some(scrutinee);\n+                    self.found_node_ty = Some(ty);\n+                    return;\n+                }\n+            }\n+        }\n         if let ExprKind::MethodCall(_, call_span, exprs, _) = expr.kind {\n             if call_span == self.target_span\n                 && Some(self.target)\n@@ -643,10 +653,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n             let msg = if let Some(simple_ident) = pattern.simple_ident() {\n                 match pattern.span.desugaring_kind() {\n                     None => format!(\"consider giving `{}` {}\", simple_ident, suffix),\n-                    Some(DesugaringKind::ForLoop(_)) => {\n-                        \"the element type for this iterator is not specified\".to_string()\n-                    }\n-                    _ => format!(\"this needs {}\", suffix),\n+                    Some(_) => format!(\"this needs {}\", suffix),\n                 }\n             } else {\n                 format!(\"consider giving this pattern {}\", suffix)\n@@ -719,6 +726,11 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                 //    = note: type must be known at this point\n                 self.annotate_method_call(segment, e, &mut err);\n             }\n+        } else if let Some(scrutinee) = local_visitor.found_for_loop_iter {\n+            err.span_label(\n+                scrutinee.span,\n+                \"the element type for this iterator is not specified\".to_string(),\n+            );\n         }\n         // Instead of the following:\n         // error[E0282]: type annotations needed"}, {"sha": "881b14278e99ed7186329facf09a70210e997ed0", "filename": "compiler/rustc_middle/src/lint.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Flint.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -395,7 +395,7 @@ pub fn in_external_macro(sess: &Session, span: Span) -> bool {\n     match expn_data.kind {\n         ExpnKind::Inlined\n         | ExpnKind::Root\n-        | ExpnKind::Desugaring(DesugaringKind::ForLoop(_) | DesugaringKind::WhileLoop) => false,\n+        | ExpnKind::Desugaring(DesugaringKind::ForLoop | DesugaringKind::WhileLoop) => false,\n         ExpnKind::AstPass(_) | ExpnKind::Desugaring(_) => true, // well, it's \"external\"\n         ExpnKind::Macro(MacroKind::Bang, _) => {\n             // Dummy span for the `def_site` means it's an external macro."}, {"sha": "d74c53fae533b425eac31501a70a6240edf2a825", "filename": "compiler/rustc_mir_build/src/thir/pattern/check_match.rs", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fcheck_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fcheck_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fcheck_match.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -74,19 +74,16 @@ impl<'tcx> Visitor<'tcx> for MatchVisitor<'_, '_, 'tcx> {\n \n         let (msg, sp) = match loc.source {\n             hir::LocalSource::Normal => (\"local binding\", Some(loc.span)),\n-            hir::LocalSource::ForLoopDesugar => (\"`for` loop binding\", None),\n             hir::LocalSource::AsyncFn => (\"async fn binding\", None),\n             hir::LocalSource::AwaitDesugar => (\"`await` future binding\", None),\n             hir::LocalSource::AssignDesugar(_) => (\"destructuring assignment binding\", None),\n         };\n         self.check_irrefutable(&loc.pat, msg, sp);\n-        self.check_patterns(&loc.pat, Irrefutable);\n     }\n \n     fn visit_param(&mut self, param: &'tcx hir::Param<'tcx>) {\n         intravisit::walk_param(self, param);\n         self.check_irrefutable(&param.pat, \"function argument\", None);\n-        self.check_patterns(&param.pat, Irrefutable);\n     }\n }\n \n@@ -161,12 +158,12 @@ impl<'p, 'tcx> MatchVisitor<'_, 'p, 'tcx> {\n     fn check_match(\n         &mut self,\n         scrut: &hir::Expr<'_>,\n-        arms: &'tcx [hir::Arm<'tcx>],\n+        hir_arms: &'tcx [hir::Arm<'tcx>],\n         source: hir::MatchSource,\n     ) {\n         let mut cx = self.new_cx(scrut.hir_id);\n \n-        for arm in arms {\n+        for arm in hir_arms {\n             // Check the arm for some things unrelated to exhaustiveness.\n             self.check_patterns(&arm.pat, Refutable);\n             if let Some(hir::Guard::IfLet(ref pat, _)) = arm.guard {\n@@ -178,7 +175,7 @@ impl<'p, 'tcx> MatchVisitor<'_, 'p, 'tcx> {\n \n         let mut have_errors = false;\n \n-        let arms: Vec<_> = arms\n+        let arms: Vec<_> = hir_arms\n             .iter()\n             .map(|hir::Arm { pat, guard, .. }| MatchArm {\n                 pat: self.lower_pattern(&mut cx, pat, &mut have_errors),\n@@ -196,6 +193,9 @@ impl<'p, 'tcx> MatchVisitor<'_, 'p, 'tcx> {\n         let report = compute_match_usefulness(&cx, &arms, scrut.hir_id, scrut_ty);\n \n         match source {\n+            // Don't report arm reachability of desugared `match $iter.into_iter() { iter => .. }`\n+            // when the iterator is an uninhabited type. unreachable_code will trigger instead.\n+            hir::MatchSource::ForLoopDesugar if arms.len() == 1 => {}\n             hir::MatchSource::ForLoopDesugar | hir::MatchSource::Normal => {\n                 report_arm_reachability(&cx, &report)\n             }\n@@ -208,7 +208,13 @@ impl<'p, 'tcx> MatchVisitor<'_, 'p, 'tcx> {\n         let is_empty_match = arms.is_empty();\n         let witnesses = report.non_exhaustiveness_witnesses;\n         if !witnesses.is_empty() {\n-            non_exhaustive_match(&cx, scrut_ty, scrut.span, witnesses, is_empty_match);\n+            if source == hir::MatchSource::ForLoopDesugar && hir_arms.len() == 2 {\n+                // the for loop pattern is not irrefutable\n+                let pat = hir_arms[1].pat.for_loop_some().unwrap();\n+                self.check_irrefutable(pat, \"`for` loop binding\", None);\n+            } else {\n+                non_exhaustive_match(&cx, scrut_ty, scrut.span, witnesses, is_empty_match);\n+            }\n         }\n     }\n \n@@ -225,6 +231,7 @@ impl<'p, 'tcx> MatchVisitor<'_, 'p, 'tcx> {\n         let witnesses = report.non_exhaustiveness_witnesses;\n         if witnesses.is_empty() {\n             // The pattern is irrefutable.\n+            self.check_patterns(pat, Irrefutable);\n             return;\n         }\n "}, {"sha": "d590776676bef53dd3067f5bc6b542a0c21fcefd", "filename": "compiler/rustc_span/src/hygiene.rs", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -1099,18 +1099,11 @@ pub enum DesugaringKind {\n     OpaqueTy,\n     Async,\n     Await,\n-    ForLoop(ForLoopLoc),\n+    ForLoop,\n     LetElse,\n     WhileLoop,\n }\n \n-/// A location in the desugaring of a `for` loop\n-#[derive(Clone, Copy, PartialEq, Debug, Encodable, Decodable, HashStable_Generic)]\n-pub enum ForLoopLoc {\n-    Head,\n-    IntoIter,\n-}\n-\n impl DesugaringKind {\n     /// The description wording should combine well with \"desugaring of {}\".\n     pub fn descr(self) -> &'static str {\n@@ -1121,7 +1114,7 @@ impl DesugaringKind {\n             DesugaringKind::QuestionMark => \"operator `?`\",\n             DesugaringKind::TryBlock => \"`try` block\",\n             DesugaringKind::OpaqueTy => \"`impl Trait`\",\n-            DesugaringKind::ForLoop(_) => \"`for` loop\",\n+            DesugaringKind::ForLoop => \"`for` loop\",\n             DesugaringKind::LetElse => \"`let...else`\",\n             DesugaringKind::WhileLoop => \"`while` loop\",\n         }"}, {"sha": "66c01140abc17e1e8c1360f92633933cb4931f3f", "filename": "compiler/rustc_span/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_span%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_span%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Flib.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -41,7 +41,7 @@ pub mod edition;\n use edition::Edition;\n pub mod hygiene;\n use hygiene::Transparency;\n-pub use hygiene::{DesugaringKind, ExpnKind, ForLoopLoc, MacroKind};\n+pub use hygiene::{DesugaringKind, ExpnKind, MacroKind};\n pub use hygiene::{ExpnData, ExpnHash, ExpnId, LocalExpnId, SyntaxContext};\n pub mod def_id;\n use def_id::{CrateNum, DefId, DefPathHash, LocalDefId, LOCAL_CRATE};"}, {"sha": "0d556b5eda609133fe988d581b51d0dee208a6f4", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -269,7 +269,6 @@ symbols! {\n         __D,\n         __H,\n         __S,\n-        __next,\n         __try_var,\n         _args,\n         _d,"}, {"sha": "a90140a9b50b924ded3a3ec7e52e5c2b3bbbcb45", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -27,7 +27,7 @@ use rustc_middle::ty::{TypeAndMut, TypeckResults};\n use rustc_session::Limit;\n use rustc_span::def_id::LOCAL_CRATE;\n use rustc_span::symbol::{kw, sym, Ident, Symbol};\n-use rustc_span::{BytePos, DesugaringKind, ExpnKind, ForLoopLoc, MultiSpan, Span, DUMMY_SP};\n+use rustc_span::{BytePos, DesugaringKind, ExpnKind, MultiSpan, Span, DUMMY_SP};\n use rustc_target::spec::abi;\n use std::fmt;\n \n@@ -685,7 +685,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n             &obligation.cause.code\n         {\n             parent_code.clone()\n-        } else if let ExpnKind::Desugaring(DesugaringKind::ForLoop(ForLoopLoc::IntoIter)) =\n+        } else if let ExpnKind::Desugaring(DesugaringKind::ForLoop) =\n             span.ctxt().outer_expn_data().kind\n         {\n             Lrc::new(obligation.cause.code.clone())\n@@ -765,8 +765,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                     // This if is to prevent a special edge-case\n                     if matches!(\n                         span.ctxt().outer_expn_data().kind,\n-                        ExpnKind::Root\n-                            | ExpnKind::Desugaring(DesugaringKind::ForLoop(ForLoopLoc::IntoIter))\n+                        ExpnKind::Root | ExpnKind::Desugaring(DesugaringKind::ForLoop)\n                     ) {\n                         // We don't want a borrowing suggestion on the fields in structs,\n                         // ```"}, {"sha": "a370485102e35a85cafaf6cd6b0f505016a2d072", "filename": "library/std/src/keyword_docs.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/library%2Fstd%2Fsrc%2Fkeyword_docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/library%2Fstd%2Fsrc%2Fkeyword_docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fkeyword_docs.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -549,13 +549,10 @@ mod fn_keyword {}\n /// {\n ///     let result = match IntoIterator::into_iter(iterator) {\n ///         mut iter => loop {\n-///             let next;\n ///             match iter.next() {\n-///                 Some(val) => next = val,\n ///                 None => break,\n+///                 Some(loop_variable) => { code(); },\n ///             };\n-///             let loop_variable = next;\n-///             let () = { code(); };\n ///         },\n ///     };\n ///     result"}, {"sha": "d3687d5b9081ea28b01063a37a41f565b9257b04", "filename": "src/test/incremental/hashes/for_loops.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fincremental%2Fhashes%2Ffor_loops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fincremental%2Fhashes%2Ffor_loops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental%2Fhashes%2Ffor_loops.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -183,7 +183,7 @@ pub fn add_loop_label_to_break() {\n #[cfg(not(any(cfail1,cfail4)))]\n #[rustc_clean(cfg=\"cfail2\", except=\"hir_owner_nodes\")]\n #[rustc_clean(cfg=\"cfail3\")]\n-#[rustc_clean(cfg=\"cfail5\", except=\"hir_owner_nodes\")]\n+#[rustc_clean(cfg=\"cfail5\", except=\"hir_owner_nodes, optimized_mir\")]\n #[rustc_clean(cfg=\"cfail6\")]\n pub fn add_loop_label_to_break() {\n     let mut _x = 0;"}, {"sha": "2dfc94f21868e149049e70df81fd68b84b875663", "filename": "src/test/mir-opt/remove_storage_markers.main.RemoveStorageMarkers.diff", "status": "modified", "additions": 46, "deletions": 69, "changes": 115, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fmir-opt%2Fremove_storage_markers.main.RemoveStorageMarkers.diff", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fmir-opt%2Fremove_storage_markers.main.RemoveStorageMarkers.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fremove_storage_markers.main.RemoveStorageMarkers.diff?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -7,39 +7,29 @@\n       let mut _2: std::ops::Range<i32>;    // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n       let mut _3: std::ops::Range<i32>;    // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n       let mut _5: ();                      // in scope 0 at $DIR/remove_storage_markers.rs:6:1: 11:2\n-      let _7: ();                          // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-      let mut _8: std::option::Option<i32>; // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+      let _6: ();                          // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+      let mut _7: std::option::Option<i32>; // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+      let mut _8: &mut std::ops::Range<i32>; // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n       let mut _9: &mut std::ops::Range<i32>; // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-      let mut _10: &mut std::ops::Range<i32>; // in scope 0 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-      let mut _11: isize;                  // in scope 0 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-      let mut _13: i32;                    // in scope 0 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-      let mut _14: !;                      // in scope 0 at $DIR/remove_storage_markers.rs:8:5: 10:6\n-      let _16: ();                         // in scope 0 at $DIR/remove_storage_markers.rs:8:20: 10:6\n-      let mut _17: i32;                    // in scope 0 at $DIR/remove_storage_markers.rs:9:16: 9:17\n+      let mut _10: isize;                  // in scope 0 at $DIR/remove_storage_markers.rs:8:5: 10:6\n+      let mut _11: !;                      // in scope 0 at $DIR/remove_storage_markers.rs:8:5: 10:6\n+      let mut _13: i32;                    // in scope 0 at $DIR/remove_storage_markers.rs:9:16: 9:17\n       scope 1 {\n           debug sum => _1;                 // in scope 1 at $DIR/remove_storage_markers.rs:7:9: 7:16\n           let mut _4: std::ops::Range<i32>; // in scope 1 at $DIR/remove_storage_markers.rs:8:14: 8:19\n           scope 2 {\n               debug iter => _4;            // in scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-              let mut _6: i32;             // in scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+              let _12: i32;                // in scope 2 at $DIR/remove_storage_markers.rs:8:9: 8:10\n               scope 3 {\n-                  debug __next => _6;      // in scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-                  let _12: i32;            // in scope 3 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-                  let _15: i32;            // in scope 3 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-                  scope 4 {\n-                      debug val => _12;    // in scope 4 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-                  }\n-                  scope 5 {\n-                      debug i => _15;      // in scope 5 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-                  }\n-                  scope 7 (inlined iter::range::<impl Iterator for std::ops::Range<i32>>::next) { // at $DIR/remove_storage_markers.rs:8:14: 8:19\n-                      debug self => _9;    // in scope 7 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-                      let mut _18: &mut std::ops::Range<i32>; // in scope 7 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-                  }\n+                  debug i => _12;          // in scope 3 at $DIR/remove_storage_markers.rs:8:9: 8:10\n+              }\n+              scope 5 (inlined iter::range::<impl Iterator for std::ops::Range<i32>>::next) { // at $DIR/remove_storage_markers.rs:8:14: 8:19\n+                  debug self => _8;        // in scope 5 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+                  let mut _14: &mut std::ops::Range<i32>; // in scope 5 at $DIR/remove_storage_markers.rs:8:14: 8:19\n               }\n           }\n-          scope 6 (inlined <std::ops::Range<i32> as IntoIterator>::into_iter) { // at $DIR/remove_storage_markers.rs:8:14: 8:19\n-              debug self => _3;            // in scope 6 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+          scope 4 (inlined <std::ops::Range<i32> as IntoIterator>::into_iter) { // at $DIR/remove_storage_markers.rs:8:14: 8:19\n+              debug self => _3;            // in scope 4 at $DIR/remove_storage_markers.rs:8:14: 8:19\n           }\n       }\n   \n@@ -50,7 +40,7 @@\n -         StorageLive(_3);                 // scope 1 at $DIR/remove_storage_markers.rs:8:14: 8:19\n           (_3.0: i32) = const 0_i32;       // scope 1 at $DIR/remove_storage_markers.rs:8:14: 8:19\n           (_3.1: i32) = const 10_i32;      // scope 1 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-          _2 = move _3;                    // scope 6 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+          _2 = move _3;                    // scope 4 at $DIR/remove_storage_markers.rs:8:14: 8:19\n -         StorageDead(_3);                 // scope 1 at $DIR/remove_storage_markers.rs:8:18: 8:19\n -         StorageLive(_4);                 // scope 1 at $DIR/remove_storage_markers.rs:8:14: 8:19\n           _4 = move _2;                    // scope 1 at $DIR/remove_storage_markers.rs:8:14: 8:19\n@@ -59,64 +49,51 @@\n   \n       bb1: {\n -         StorageLive(_6);                 // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n--         StorageLive(_7);                 // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n--         StorageLive(_8);                 // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n--         StorageLive(_9);                 // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n--         StorageLive(_10);                // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-          _10 = &mut _4;                   // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-          _9 = &mut (*_10);                // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n--         StorageLive(_18);                // scope 7 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-          _18 = &mut (*_9);                // scope 7 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-          _8 = <std::ops::Range<i32> as iter::range::RangeIteratorImpl>::spec_next(move _18) -> bb4; // scope 7 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+-         StorageLive(_7);                 // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+-         StorageLive(_8);                 // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+-         StorageLive(_9);                 // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+          _9 = &mut _4;                    // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+          _8 = &mut (*_9);                 // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+-         StorageLive(_14);                // scope 5 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+          _14 = &mut (*_8);                // scope 5 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+          _7 = <std::ops::Range<i32> as iter::range::RangeIteratorImpl>::spec_next(move _14) -> bb4; // scope 5 at $DIR/remove_storage_markers.rs:8:14: 8:19\n                                            // mir::Constant\n                                            // + span: $DIR/remove_storage_markers.rs:8:14: 8:19\n                                            // + literal: Const { ty: for<'r> fn(&'r mut std::ops::Range<i32>) -> std::option::Option<<std::ops::Range<i32> as std::iter::range::RangeIteratorImpl>::Item> {<std::ops::Range<i32> as std::iter::range::RangeIteratorImpl>::spec_next}, val: Value(Scalar(<ZST>)) }\n       }\n   \n       bb2: {\n-          _0 = const ();                   // scope 3 at $DIR/remove_storage_markers.rs:8:5: 10:6\n--         StorageDead(_10);                // scope 3 at $DIR/remove_storage_markers.rs:8:18: 8:19\n--         StorageDead(_8);                 // scope 3 at $DIR/remove_storage_markers.rs:8:18: 8:19\n--         StorageDead(_7);                 // scope 3 at $DIR/remove_storage_markers.rs:8:18: 8:19\n+-         StorageLive(_12);                // scope 2 at $DIR/remove_storage_markers.rs:8:9: 8:10\n+          _12 = ((_7 as Some).0: i32);     // scope 2 at $DIR/remove_storage_markers.rs:8:9: 8:10\n+-         StorageLive(_13);                // scope 3 at $DIR/remove_storage_markers.rs:9:16: 9:17\n+          _13 = _12;                       // scope 3 at $DIR/remove_storage_markers.rs:9:16: 9:17\n+          _1 = Add(_1, move _13);          // scope 3 at $DIR/remove_storage_markers.rs:9:9: 9:17\n+-         StorageDead(_13);                // scope 3 at $DIR/remove_storage_markers.rs:9:16: 9:17\n+          _6 = const ();                   // scope 3 at $DIR/remove_storage_markers.rs:8:20: 10:6\n+-         StorageDead(_12);                // scope 2 at $DIR/remove_storage_markers.rs:10:5: 10:6\n+-         StorageDead(_9);                 // scope 2 at $DIR/remove_storage_markers.rs:10:5: 10:6\n+-         StorageDead(_7);                 // scope 2 at $DIR/remove_storage_markers.rs:10:5: 10:6\n -         StorageDead(_6);                 // scope 2 at $DIR/remove_storage_markers.rs:10:5: 10:6\n--         StorageDead(_4);                 // scope 1 at $DIR/remove_storage_markers.rs:10:5: 10:6\n--         StorageDead(_2);                 // scope 1 at $DIR/remove_storage_markers.rs:10:5: 10:6\n--         StorageDead(_1);                 // scope 0 at $DIR/remove_storage_markers.rs:11:1: 11:2\n-          return;                          // scope 0 at $DIR/remove_storage_markers.rs:11:2: 11:2\n+          _5 = const ();                   // scope 2 at $DIR/remove_storage_markers.rs:8:5: 10:6\n+          goto -> bb1;                     // scope 2 at $DIR/remove_storage_markers.rs:8:5: 10:6\n       }\n   \n       bb3: {\n--         StorageLive(_12);                // scope 3 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-          _12 = ((_8 as Some).0: i32);     // scope 3 at $DIR/remove_storage_markers.rs:8:9: 8:10\n--         StorageLive(_13);                // scope 4 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-          _13 = _12;                       // scope 4 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-          _6 = move _13;                   // scope 4 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-          _7 = const ();                   // scope 4 at $DIR/remove_storage_markers.rs:8:9: 8:10\n--         StorageDead(_13);                // scope 4 at $DIR/remove_storage_markers.rs:8:9: 8:10\n--         StorageDead(_12);                // scope 3 at $DIR/remove_storage_markers.rs:8:9: 8:10\n--         StorageDead(_10);                // scope 3 at $DIR/remove_storage_markers.rs:8:18: 8:19\n--         StorageDead(_8);                 // scope 3 at $DIR/remove_storage_markers.rs:8:18: 8:19\n--         StorageDead(_7);                 // scope 3 at $DIR/remove_storage_markers.rs:8:18: 8:19\n--         StorageLive(_15);                // scope 3 at $DIR/remove_storage_markers.rs:8:9: 8:10\n-          _15 = _6;                        // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n--         StorageLive(_16);                // scope 5 at $DIR/remove_storage_markers.rs:8:20: 10:6\n--         StorageLive(_17);                // scope 5 at $DIR/remove_storage_markers.rs:9:16: 9:17\n-          _17 = _15;                       // scope 5 at $DIR/remove_storage_markers.rs:9:16: 9:17\n-          _1 = Add(_1, move _17);          // scope 5 at $DIR/remove_storage_markers.rs:9:9: 9:17\n--         StorageDead(_17);                // scope 5 at $DIR/remove_storage_markers.rs:9:16: 9:17\n-          _16 = const ();                  // scope 5 at $DIR/remove_storage_markers.rs:8:20: 10:6\n--         StorageDead(_16);                // scope 5 at $DIR/remove_storage_markers.rs:10:5: 10:6\n-          _5 = const ();                   // scope 2 at $DIR/remove_storage_markers.rs:8:5: 10:6\n--         StorageDead(_15);                // scope 3 at $DIR/remove_storage_markers.rs:10:5: 10:6\n+          _0 = const ();                   // scope 2 at $DIR/remove_storage_markers.rs:8:5: 10:6\n+-         StorageDead(_9);                 // scope 2 at $DIR/remove_storage_markers.rs:10:5: 10:6\n+-         StorageDead(_7);                 // scope 2 at $DIR/remove_storage_markers.rs:10:5: 10:6\n -         StorageDead(_6);                 // scope 2 at $DIR/remove_storage_markers.rs:10:5: 10:6\n-          goto -> bb1;                     // scope 2 at $DIR/remove_storage_markers.rs:8:5: 10:6\n+-         StorageDead(_4);                 // scope 1 at $DIR/remove_storage_markers.rs:10:5: 10:6\n+-         StorageDead(_2);                 // scope 1 at $DIR/remove_storage_markers.rs:10:5: 10:6\n+-         StorageDead(_1);                 // scope 0 at $DIR/remove_storage_markers.rs:11:1: 11:2\n+          return;                          // scope 0 at $DIR/remove_storage_markers.rs:11:2: 11:2\n       }\n   \n       bb4: {\n--         StorageDead(_18);                // scope 7 at $DIR/remove_storage_markers.rs:8:14: 8:19\n--         StorageDead(_9);                 // scope 3 at $DIR/remove_storage_markers.rs:8:18: 8:19\n-          _11 = discriminant(_8);          // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n-          switchInt(move _11) -> [0_isize: bb2, otherwise: bb3]; // scope 3 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+-         StorageDead(_14);                // scope 5 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+-         StorageDead(_8);                 // scope 2 at $DIR/remove_storage_markers.rs:8:18: 8:19\n+          _10 = discriminant(_7);          // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n+          switchInt(move _10) -> [0_isize: bb3, otherwise: bb2]; // scope 2 at $DIR/remove_storage_markers.rs:8:14: 8:19\n       }\n   }\n   "}, {"sha": "c6643edf5a9547f2f6393e4f3df30ccde3142b02", "filename": "src/test/ui/borrowck/return-local-binding-from-desugaring.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fborrowck%2Freturn-local-binding-from-desugaring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fborrowck%2Freturn-local-binding-from-desugaring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Freturn-local-binding-from-desugaring.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -27,7 +27,7 @@ where\n         let key = f(x);\n         result.entry(key).or_insert(Vec::new()).push(x);\n     }\n-    result //~ ERROR cannot return value referencing local binding\n+    result //~ ERROR cannot return value referencing temporary value\n }\n \n fn main() {}"}, {"sha": "9f952542e18b0348c5b1c7bc113afb00e1e5fac1", "filename": "src/test/ui/borrowck/return-local-binding-from-desugaring.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fborrowck%2Freturn-local-binding-from-desugaring.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fborrowck%2Freturn-local-binding-from-desugaring.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Freturn-local-binding-from-desugaring.stderr?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -1,8 +1,8 @@\n-error[E0515]: cannot return value referencing local binding\n+error[E0515]: cannot return value referencing temporary value\n   --> $DIR/return-local-binding-from-desugaring.rs:30:5\n    |\n LL |     for ref x in xs {\n-   |                  -- local binding introduced here\n+   |                  -- temporary value created here\n ...\n LL |     result\n    |     ^^^^^^ returns a value referencing data owned by the current function"}, {"sha": "580b135ac2d712fdff96b5cc299c226f74f48c6b", "filename": "src/test/ui/for/for-loop-unconstrained-element-type.stderr", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Ffor%2Ffor-loop-unconstrained-element-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Ffor%2Ffor-loop-unconstrained-element-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffor%2Ffor-loop-unconstrained-element-type.stderr?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -1,8 +1,10 @@\n error[E0282]: type annotations needed\n-  --> $DIR/for-loop-unconstrained-element-type.rs:8:14\n+  --> $DIR/for-loop-unconstrained-element-type.rs:8:9\n    |\n LL |     for i in Vec::new() { }\n-   |              ^^^^^^^^^^ the element type for this iterator is not specified\n+   |         ^    ---------- the element type for this iterator is not specified\n+   |         |\n+   |         cannot infer type\n \n error: aborting due to previous error\n "}, {"sha": "6330364c92b6a68e62061c3dc46c31f5ef4dfe4b", "filename": "src/test/ui/issues/issue-20261.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fissues%2Fissue-20261.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fissues%2Fissue-20261.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-20261.stderr?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -1,8 +1,8 @@\n-error[E0282]: type annotations needed for `&(_,)`\n+error[E0282]: type annotations needed for `(_,)`\n   --> $DIR/issue-20261.rs:4:11\n    |\n LL |     for (ref i,) in [].iter() {\n-   |                     --------- the element type for this iterator is not specified\n+   |                     --------- this method call resolves to `std::slice::Iter<'_, T>`\n LL |         i.clone();\n    |           ^^^^^ cannot infer type\n    |"}, {"sha": "ccaa6334856b45f55487e44c1301abdd1d7b83a9", "filename": "src/test/ui/issues/issue-33941.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fissues%2Fissue-33941.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fissues%2Fissue-33941.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-33941.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -3,5 +3,4 @@ use std::collections::HashMap;\n fn main() {\n     for _ in HashMap::new().iter().cloned() {} //~ ERROR type mismatch\n     //~^ ERROR type mismatch\n-    //~| ERROR type mismatch\n }"}, {"sha": "eb98a3a29a6981ff524fde56a9dba6abae84d5b8", "filename": "src/test/ui/issues/issue-33941.stderr", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fissues%2Fissue-33941.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fissues%2Fissue-33941.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-33941.stderr?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -23,16 +23,6 @@ LL |     for _ in HashMap::new().iter().cloned() {}\n    = note: required because of the requirements on the impl of `Iterator` for `Cloned<std::collections::hash_map::Iter<'_, _, _>>`\n    = note: required because of the requirements on the impl of `IntoIterator` for `Cloned<std::collections::hash_map::Iter<'_, _, _>>`\n \n-error[E0271]: type mismatch resolving `<std::collections::hash_map::Iter<'_, _, _> as Iterator>::Item == &_`\n-  --> $DIR/issue-33941.rs:4:14\n-   |\n-LL |     for _ in HashMap::new().iter().cloned() {}\n-   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected reference, found tuple\n-   |\n-   = note: expected reference `&_`\n-                  found tuple `(&_, &_)`\n-   = note: required because of the requirements on the impl of `Iterator` for `Cloned<std::collections::hash_map::Iter<'_, _, _>>`\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0271`."}, {"sha": "fad6121cbca52f4da0e2c0031dea932e322e78ea", "filename": "src/test/ui/nll/dont-print-desugared.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fnll%2Fdont-print-desugared.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fnll%2Fdont-print-desugared.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fdont-print-desugared.stderr?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -2,7 +2,7 @@ error[E0596]: cannot borrow data in a `&` reference as mutable\n   --> $DIR/dont-print-desugared.rs:4:10\n    |\n LL |     for &ref mut x in s {}\n-   |          ^^^^^^^^^ cannot borrow as mutable through `&` reference\n+   |          ^^^^^^^^^ cannot borrow as mutable\n \n error[E0597]: `y` does not live long enough\n   --> $DIR/dont-print-desugared.rs:17:16"}, {"sha": "90cba2a145f5592fbdfb7f2b42dc81753b3f143f", "filename": "src/test/ui/nll/issue-53773.stderr", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fnll%2Fissue-53773.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Fnll%2Fissue-53773.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-53773.stderr?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -2,12 +2,10 @@ error[E0713]: borrow may still be in use when destructor runs\n   --> $DIR/issue-53773.rs:41:22\n    |\n LL |         members.push(child.raw);\n-   |                      ^^^^^^^^^\n+   |         -------------^^^^^^^^^- borrow later used here\n LL |\n LL |     }\n    |     - here, drop of `child` needs exclusive access to `*child.raw`, because the type `C<'_>` implements the `Drop` trait\n-LL |     members.len();\n-   |     ------------- borrow later used here\n    |\n    = note: consider using a `let` binding to create a longer lived value\n "}, {"sha": "e9cef5f47d4aa555e6c8e010c5f4c17cbfe8b858", "filename": "src/test/ui/reachable/unreachable-loop-patterns.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Freachable%2Funreachable-loop-patterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Freachable%2Funreachable-loop-patterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Freachable%2Funreachable-loop-patterns.rs?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -17,5 +17,4 @@ impl Iterator for Void {\n fn main() {\n     for _ in unimplemented!() as Void {}\n     //~^ ERROR unreachable pattern\n-    //~^^ ERROR unreachable pattern\n }"}, {"sha": "80ffa5d73f034224bf4ddef273c0038740735f45", "filename": "src/test/ui/reachable/unreachable-loop-patterns.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Freachable%2Funreachable-loop-patterns.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c83f8c4d1e562cd73a29a00828d68e2b520a086/src%2Ftest%2Fui%2Freachable%2Funreachable-loop-patterns.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Freachable%2Funreachable-loop-patterns.stderr?ref=9c83f8c4d1e562cd73a29a00828d68e2b520a086", "patch": "@@ -10,11 +10,5 @@ note: the lint level is defined here\n LL | #![deny(unreachable_patterns)]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n-error: unreachable pattern\n-  --> $DIR/unreachable-loop-patterns.rs:18:14\n-   |\n-LL |     for _ in unimplemented!() as Void {}\n-   |              ^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n "}]}