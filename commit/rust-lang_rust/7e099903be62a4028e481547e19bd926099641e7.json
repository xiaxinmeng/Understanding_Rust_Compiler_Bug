{"sha": "7e099903be62a4028e481547e19bd926099641e7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlMDk5OTAzYmU2MmE0MDI4ZTQ4MTU0N2UxOWJkOTI2MDk5NjQxZTc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2017-12-22T04:42:47Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2017-12-22T04:54:49Z"}, "message": "Update to handle GenericParam\n\nintroduced in https://github.com/rust-lang/rust/pull/45930", "tree": {"sha": "6558c1c4d7fc20551c44ebccd9e2e0503d77e4eb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6558c1c4d7fc20551c44ebccd9e2e0503d77e4eb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e099903be62a4028e481547e19bd926099641e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e099903be62a4028e481547e19bd926099641e7", "html_url": "https://github.com/rust-lang/rust/commit/7e099903be62a4028e481547e19bd926099641e7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e099903be62a4028e481547e19bd926099641e7/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ebcdf031476cacef699dbbe879c641b33e1f8fc3", "url": "https://api.github.com/repos/rust-lang/rust/commits/ebcdf031476cacef699dbbe879c641b33e1f8fc3", "html_url": "https://github.com/rust-lang/rust/commit/ebcdf031476cacef699dbbe879c641b33e1f8fc3"}], "stats": {"total": 56, "additions": 31, "deletions": 25}, "files": [{"sha": "684e09e93c418e62cc1a0a52d649b084285da09c", "filename": "clippy_lints/src/lifetimes.rs", "status": "modified", "additions": 17, "deletions": 13, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flifetimes.rs?ref=7e099903be62a4028e481547e19bd926099641e7", "patch": "@@ -2,7 +2,7 @@ use reexport::*;\n use rustc::lint::*;\n use rustc::hir::def::Def;\n use rustc::hir::*;\n-use rustc::hir::intravisit::{walk_fn_decl, walk_generics, walk_ty, walk_ty_param_bound, NestedVisitorMap, Visitor};\n+use rustc::hir::intravisit::*;\n use std::collections::{HashMap, HashSet};\n use syntax::codemap::Span;\n use utils::{in_external_macro, last_path_segment, span_lint};\n@@ -101,7 +101,7 @@ fn check_fn_inner<'a, 'tcx>(\n     }\n \n     let mut bounds_lts = Vec::new();\n-    for typ in &generics.ty_params {\n+    for typ in generics.ty_params() {\n         for bound in &typ.bounds {\n             if let TraitTyParamBound(ref trait_ref, _) = *bound {\n                 let params = &trait_ref\n@@ -122,7 +122,7 @@ fn check_fn_inner<'a, 'tcx>(\n             }\n         }\n     }\n-    if could_use_elision(cx, decl, body, &generics.lifetimes, bounds_lts) {\n+    if could_use_elision(cx, decl, body, &generics.params, bounds_lts) {\n         span_lint(\n             cx,\n             NEEDLESS_LIFETIMES,\n@@ -137,7 +137,7 @@ fn could_use_elision<'a, 'tcx: 'a>(\n     cx: &LateContext<'a, 'tcx>,\n     func: &'tcx FnDecl,\n     body: Option<BodyId>,\n-    named_lts: &'tcx [LifetimeDef],\n+    named_generics: &'tcx [GenericParam],\n     bounds_lts: Vec<&'tcx Lifetime>,\n ) -> bool {\n     // There are two scenarios where elision works:\n@@ -147,7 +147,7 @@ fn could_use_elision<'a, 'tcx: 'a>(\n     // level of the current item.\n \n     // check named LTs\n-    let allowed_lts = allowed_lts_from(named_lts);\n+    let allowed_lts = allowed_lts_from(named_generics);\n \n     // these will collect all the lifetimes for references in arg/return types\n     let mut input_visitor = RefVisitor::new(cx);\n@@ -222,11 +222,13 @@ fn could_use_elision<'a, 'tcx: 'a>(\n     }\n }\n \n-fn allowed_lts_from(named_lts: &[LifetimeDef]) -> HashSet<RefLt> {\n+fn allowed_lts_from(named_generics: &[GenericParam]) -> HashSet<RefLt> {\n     let mut allowed_lts = HashSet::new();\n-    for lt in named_lts {\n-        if lt.bounds.is_empty() {\n-            allowed_lts.insert(RefLt::Named(lt.lifetime.name.name()));\n+    for par in named_generics.iter() {\n+        if let GenericParam::Lifetime(ref lt) = *par {\n+            if lt.bounds.is_empty() {\n+                allowed_lts.insert(RefLt::Named(lt.lifetime.name.name()));\n+            }\n         }\n     }\n     allowed_lts.insert(RefLt::Unnamed);\n@@ -370,7 +372,7 @@ fn has_where_lifetimes<'a, 'tcx: 'a>(cx: &LateContext<'a, 'tcx>, where_clause: &\n                     return true;\n                 }\n                 // if the bounds define new lifetimes, they are fine to occur\n-                let allowed_lts = allowed_lts_from(&pred.bound_lifetimes);\n+                let allowed_lts = allowed_lts_from(&pred.bound_generic_params);\n                 // now walk the bounds\n                 for bound in pred.bounds.iter() {\n                     walk_ty_param_bound(&mut visitor, bound);\n@@ -408,12 +410,15 @@ impl<'tcx> Visitor<'tcx> for LifetimeChecker {\n         self.map.remove(&lifetime.name.name());\n     }\n \n-    fn visit_lifetime_def(&mut self, _: &'tcx LifetimeDef) {\n+    fn visit_generic_param(&mut self, param: &'tcx GenericParam) {\n         // don't actually visit `<'a>` or `<'a: 'b>`\n         // we've already visited the `'a` declarations and\n         // don't want to spuriously remove them\n         // `'b` in `'a: 'b` is useless unless used elsewhere in\n         // a non-lifetime bound\n+        if param.is_type_param() {\n+            walk_generic_param(self, param)\n+        }\n     }\n     fn nested_visit_map<'this>(&'this mut self) -> NestedVisitorMap<'this, 'tcx> {\n         NestedVisitorMap::None\n@@ -422,8 +427,7 @@ impl<'tcx> Visitor<'tcx> for LifetimeChecker {\n \n fn report_extra_lifetimes<'a, 'tcx: 'a>(cx: &LateContext<'a, 'tcx>, func: &'tcx FnDecl, generics: &'tcx Generics) {\n     let hs = generics\n-        .lifetimes\n-        .iter()\n+        .lifetimes()\n         .map(|lt| (lt.lifetime.name.name(), lt.lifetime.span))\n         .collect();\n     let mut checker = LifetimeChecker { map: hs };"}, {"sha": "64335f81a6347110eeb9c6901a6f037eb99b28c9", "filename": "clippy_lints/src/methods.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods.rs?ref=7e099903be62a4028e481547e19bd926099641e7", "patch": "@@ -1849,7 +1849,7 @@ impl SelfKind {\n \n fn is_as_ref_or_mut_trait(ty: &hir::Ty, self_ty: &hir::Ty, generics: &hir::Generics, name: &[&str]) -> bool {\n     single_segment_ty(ty).map_or(false, |seg| {\n-        generics.ty_params.iter().any(|param| {\n+        generics.ty_params().any(|param| {\n             param.name == seg.name && param.bounds.iter().any(|bound| {\n                 if let hir::TyParamBound::TraitTyParamBound(ref ptr, ..) = *bound {\n                     let path = &ptr.trait_ref.path;"}, {"sha": "4e45525ed099296941e8e1738f2b9c416d0bd6ca", "filename": "clippy_lints/src/misc_early.rs", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Fmisc_early.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Fmisc_early.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc_early.rs?ref=7e099903be62a4028e481547e19bd926099641e7", "patch": "@@ -188,15 +188,17 @@ impl LintPass for MiscEarly {\n \n impl EarlyLintPass for MiscEarly {\n     fn check_generics(&mut self, cx: &EarlyContext, gen: &Generics) {\n-        for ty in &gen.ty_params {\n-            let name = ty.ident.name.as_str();\n-            if constants::BUILTIN_TYPES.contains(&&*name) {\n-                span_lint(\n-                    cx,\n-                    BUILTIN_TYPE_SHADOW,\n-                    ty.span,\n-                    &format!(\"This generic shadows the built-in type `{}`\", name),\n-                );\n+        for param in &gen.params {\n+            if let GenericParam::Type(ref ty) = *param {\n+                let name = ty.ident.name.as_str();\n+                if constants::BUILTIN_TYPES.contains(&&*name) {\n+                    span_lint(\n+                        cx,\n+                        BUILTIN_TYPE_SHADOW,\n+                        ty.span,\n+                        &format!(\"This generic shadows the built-in type `{}`\", name),\n+                    );\n+                }\n             }\n         }\n     }"}, {"sha": "5f2370951156db20ad64cf382e087ffdb25dba4f", "filename": "clippy_lints/src/new_without_default.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Fnew_without_default.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Fnew_without_default.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fnew_without_default.rs?ref=7e099903be62a4028e481547e19bd926099641e7", "patch": "@@ -103,7 +103,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NewWithoutDefault {\n                             // can't be implemented by default\n                             return;\n                         }\n-                        if !impl_item.generics.ty_params.is_empty() {\n+                        if impl_item.generics.params.iter().any(|gen| gen.is_type_param()) {\n                             // when the result of `new()` depends on a type parameter we should not require\n                             // an\n                             // impl of `Default`"}, {"sha": "c146d306a5a694eb0262825785a4321e488efd18", "filename": "clippy_lints/src/types.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e099903be62a4028e481547e19bd926099641e7/clippy_lints%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftypes.rs?ref=7e099903be62a4028e481547e19bd926099641e7", "patch": "@@ -957,7 +957,7 @@ impl<'tcx> Visitor<'tcx> for TypeComplexityVisitor {\n             TyTraitObject(ref param_bounds, _) => {\n                 let has_lifetime_parameters = param_bounds\n                     .iter()\n-                    .any(|bound| !bound.bound_lifetimes.is_empty());\n+                    .any(|bound| bound.bound_generic_params.iter().any(|gen| gen.is_lifetime_param()));\n                 if has_lifetime_parameters {\n                     // complex trait bounds like A<'a, 'b>\n                     (50 * self.nest, 1)"}]}