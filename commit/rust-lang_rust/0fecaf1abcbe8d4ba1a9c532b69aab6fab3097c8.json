{"sha": "0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmZWNhZjFhYmNiZThkNGJhMWE5YzUzMmI2OWFhYjZmYWIzMDk3Yzg=", "commit": {"author": {"name": "Tim Nielens", "email": "tim.nielens@gmail.com", "date": "2020-07-18T22:33:54Z"}, "committer": {"name": "Tim Nielens", "email": "tim.nielens@gmail.com", "date": "2020-07-19T22:30:43Z"}, "message": "redundant_closure_call - extract lint from misc_early.rs, adapt to LatePass", "tree": {"sha": "4b6d8bda5ebcd22ef5a81f0dcbcca319dcb57e29", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b6d8bda5ebcd22ef5a81f0dcbcca319dcb57e29"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "html_url": "https://github.com/rust-lang/rust/commit/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/comments", "author": {"login": "tnielens", "id": 11885535, "node_id": "MDQ6VXNlcjExODg1NTM1", "avatar_url": "https://avatars.githubusercontent.com/u/11885535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tnielens", "html_url": "https://github.com/tnielens", "followers_url": "https://api.github.com/users/tnielens/followers", "following_url": "https://api.github.com/users/tnielens/following{/other_user}", "gists_url": "https://api.github.com/users/tnielens/gists{/gist_id}", "starred_url": "https://api.github.com/users/tnielens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tnielens/subscriptions", "organizations_url": "https://api.github.com/users/tnielens/orgs", "repos_url": "https://api.github.com/users/tnielens/repos", "events_url": "https://api.github.com/users/tnielens/events{/privacy}", "received_events_url": "https://api.github.com/users/tnielens/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tnielens", "id": 11885535, "node_id": "MDQ6VXNlcjExODg1NTM1", "avatar_url": "https://avatars.githubusercontent.com/u/11885535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tnielens", "html_url": "https://github.com/tnielens", "followers_url": "https://api.github.com/users/tnielens/followers", "following_url": "https://api.github.com/users/tnielens/following{/other_user}", "gists_url": "https://api.github.com/users/tnielens/gists{/gist_id}", "starred_url": "https://api.github.com/users/tnielens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tnielens/subscriptions", "organizations_url": "https://api.github.com/users/tnielens/orgs", "repos_url": "https://api.github.com/users/tnielens/repos", "events_url": "https://api.github.com/users/tnielens/events{/privacy}", "received_events_url": "https://api.github.com/users/tnielens/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c720d823e1e633cccfd24e1df76cc04a628e83b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/c720d823e1e633cccfd24e1df76cc04a628e83b0", "html_url": "https://github.com/rust-lang/rust/commit/c720d823e1e633cccfd24e1df76cc04a628e83b0"}], "stats": {"total": 347, "additions": 196, "deletions": 151}, "files": [{"sha": "f371942dbeec57056ca35176bbda2f005d9d8084", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -276,6 +276,7 @@ mod ptr_offset_with_cast;\n mod question_mark;\n mod ranges;\n mod redundant_clone;\n+mod redundant_closure_call;\n mod redundant_field_names;\n mod redundant_pub_crate;\n mod redundant_static_lifetimes;\n@@ -702,7 +703,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &misc_early::DOUBLE_NEG,\n         &misc_early::DUPLICATE_UNDERSCORE_ARGUMENT,\n         &misc_early::MIXED_CASE_HEX_LITERALS,\n-        &misc_early::REDUNDANT_CLOSURE_CALL,\n         &misc_early::REDUNDANT_PATTERN,\n         &misc_early::UNNEEDED_FIELD_PATTERN,\n         &misc_early::UNNEEDED_WILDCARD_PATTERN,\n@@ -759,6 +759,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &ranges::RANGE_ZIP_WITH_LEN,\n         &ranges::REVERSED_EMPTY_RANGES,\n         &redundant_clone::REDUNDANT_CLONE,\n+        &redundant_closure_call::REDUNDANT_CLOSURE_CALL,\n         &redundant_field_names::REDUNDANT_FIELD_NAMES,\n         &redundant_pub_crate::REDUNDANT_PUB_CRATE,\n         &redundant_static_lifetimes::REDUNDANT_STATIC_LIFETIMES,\n@@ -1018,6 +1019,8 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_early_pass(|| box int_plus_one::IntPlusOne);\n     store.register_early_pass(|| box formatting::Formatting);\n     store.register_early_pass(|| box misc_early::MiscEarlyLints);\n+    store.register_early_pass(|| box redundant_closure_call::RedundantClosureCall);\n+    store.register_late_pass(|| box redundant_closure_call::RedundantClosureCall);\n     store.register_early_pass(|| box returns::Return);\n     store.register_late_pass(|| box let_and_return::LetReturn);\n     store.register_early_pass(|| box collapsible_if::CollapsibleIf);\n@@ -1359,7 +1362,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&misc_early::DOUBLE_NEG),\n         LintId::of(&misc_early::DUPLICATE_UNDERSCORE_ARGUMENT),\n         LintId::of(&misc_early::MIXED_CASE_HEX_LITERALS),\n-        LintId::of(&misc_early::REDUNDANT_CLOSURE_CALL),\n         LintId::of(&misc_early::REDUNDANT_PATTERN),\n         LintId::of(&misc_early::UNNEEDED_WILDCARD_PATTERN),\n         LintId::of(&misc_early::ZERO_PREFIXED_LITERAL),\n@@ -1393,6 +1395,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&ranges::RANGE_ZIP_WITH_LEN),\n         LintId::of(&ranges::REVERSED_EMPTY_RANGES),\n         LintId::of(&redundant_clone::REDUNDANT_CLONE),\n+        LintId::of(&redundant_closure_call::REDUNDANT_CLOSURE_CALL),\n         LintId::of(&redundant_field_names::REDUNDANT_FIELD_NAMES),\n         LintId::of(&redundant_static_lifetimes::REDUNDANT_STATIC_LIFETIMES),\n         LintId::of(&reference::DEREF_ADDROF),\n@@ -1593,7 +1596,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&methods::UNNECESSARY_FILTER_MAP),\n         LintId::of(&methods::USELESS_ASREF),\n         LintId::of(&misc::SHORT_CIRCUIT_STATEMENT),\n-        LintId::of(&misc_early::REDUNDANT_CLOSURE_CALL),\n         LintId::of(&misc_early::UNNEEDED_WILDCARD_PATTERN),\n         LintId::of(&misc_early::ZERO_PREFIXED_LITERAL),\n         LintId::of(&needless_bool::BOOL_COMPARISON),\n@@ -1608,6 +1610,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&precedence::PRECEDENCE),\n         LintId::of(&ptr_offset_with_cast::PTR_OFFSET_WITH_CAST),\n         LintId::of(&ranges::RANGE_ZIP_WITH_LEN),\n+        LintId::of(&redundant_closure_call::REDUNDANT_CLOSURE_CALL),\n         LintId::of(&reference::DEREF_ADDROF),\n         LintId::of(&reference::REF_IN_DEREF),\n         LintId::of(&repeat_once::REPEAT_ONCE),"}, {"sha": "29aba7c121873bbd6c57aa3d24d2758942040ba3", "filename": "clippy_lints/src/misc_early.rs", "status": "modified", "additions": 4, "deletions": 128, "changes": 132, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/clippy_lints%2Fsrc%2Fmisc_early.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/clippy_lints%2Fsrc%2Fmisc_early.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc_early.rs?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -1,20 +1,15 @@\n-use crate::utils::{\n-    constants, snippet_opt, snippet_with_applicability, span_lint, span_lint_and_help, span_lint_and_sugg,\n-    span_lint_and_then,\n-};\n-use if_chain::if_chain;\n+use crate::utils::{constants, snippet_opt, span_lint, span_lint_and_help, span_lint_and_sugg, span_lint_and_then};\n use rustc_ast::ast::{\n-    BindingMode, Block, Expr, ExprKind, GenericParamKind, Generics, Lit, LitFloatType, LitIntType, LitKind, Mutability,\n-    NodeId, Pat, PatKind, StmtKind, UnOp,\n+    BindingMode, Expr, ExprKind, GenericParamKind, Generics, Lit, LitFloatType, LitIntType, LitKind, Mutability,\n+    NodeId, Pat, PatKind, UnOp,\n };\n-use rustc_ast::visit::{walk_expr, FnKind, Visitor};\n+use rustc_ast::visit::FnKind;\n use rustc_data_structures::fx::FxHashMap;\n use rustc_errors::Applicability;\n use rustc_lint::{EarlyContext, EarlyLintPass, LintContext};\n use rustc_middle::lint::in_external_macro;\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::source_map::Span;\n-use rustc_span::symbol::Ident;\n \n declare_clippy_lint! {\n     /// **What it does:** Checks for structure field patterns bound to wildcards.\n@@ -71,28 +66,6 @@ declare_clippy_lint! {\n     \"function arguments having names which only differ by an underscore\"\n }\n \n-declare_clippy_lint! {\n-    /// **What it does:** Detects closures called in the same expression where they\n-    /// are defined.\n-    ///\n-    /// **Why is this bad?** It is unnecessarily adding to the expression's\n-    /// complexity.\n-    ///\n-    /// **Known problems:** None.\n-    ///\n-    /// **Example:**\n-    /// ```rust,ignore\n-    /// // Bad\n-    /// let a = (|| 42)()\n-    ///\n-    /// // Good\n-    /// let a = 42\n-    /// ```\n-    pub REDUNDANT_CLOSURE_CALL,\n-    complexity,\n-    \"throwaway closures called in the expression they are defined\"\n-}\n-\n declare_clippy_lint! {\n     /// **What it does:** Detects expressions of the form `--x`.\n     ///\n@@ -279,7 +252,6 @@ declare_clippy_lint! {\n declare_lint_pass!(MiscEarlyLints => [\n     UNNEEDED_FIELD_PATTERN,\n     DUPLICATE_UNDERSCORE_ARGUMENT,\n-    REDUNDANT_CLOSURE_CALL,\n     DOUBLE_NEG,\n     MIXED_CASE_HEX_LITERALS,\n     UNSEPARATED_LITERAL_SUFFIX,\n@@ -289,30 +261,6 @@ declare_lint_pass!(MiscEarlyLints => [\n     UNNEEDED_WILDCARD_PATTERN,\n ]);\n \n-// Used to find `return` statements or equivalents e.g., `?`\n-struct ReturnVisitor {\n-    found_return: bool,\n-}\n-\n-impl ReturnVisitor {\n-    #[must_use]\n-    fn new() -> Self {\n-        Self { found_return: false }\n-    }\n-}\n-\n-impl<'ast> Visitor<'ast> for ReturnVisitor {\n-    fn visit_expr(&mut self, ex: &'ast Expr) {\n-        if let ExprKind::Ret(_) = ex.kind {\n-            self.found_return = true;\n-        } else if let ExprKind::Try(_) = ex.kind {\n-            self.found_return = true;\n-        }\n-\n-        walk_expr(self, ex)\n-    }\n-}\n-\n impl EarlyLintPass for MiscEarlyLints {\n     fn check_generics(&mut self, cx: &EarlyContext<'_>, gen: &Generics) {\n         for param in &gen.params {\n@@ -454,30 +402,6 @@ impl EarlyLintPass for MiscEarlyLints {\n             return;\n         }\n         match expr.kind {\n-            ExprKind::Call(ref paren, _) => {\n-                if let ExprKind::Paren(ref closure) = paren.kind {\n-                    if let ExprKind::Closure(_, _, _, ref decl, ref block, _) = closure.kind {\n-                        let mut visitor = ReturnVisitor::new();\n-                        visitor.visit_expr(block);\n-                        if !visitor.found_return {\n-                            span_lint_and_then(\n-                                cx,\n-                                REDUNDANT_CLOSURE_CALL,\n-                                expr.span,\n-                                \"Try not to call a closure in the expression where it is declared.\",\n-                                |diag| {\n-                                    if decl.inputs.is_empty() {\n-                                        let mut app = Applicability::MachineApplicable;\n-                                        let hint =\n-                                            snippet_with_applicability(cx, block.span, \"..\", &mut app).into_owned();\n-                                        diag.span_suggestion(expr.span, \"Try doing something like: \", hint, app);\n-                                    }\n-                                },\n-                            );\n-                        }\n-                    }\n-                }\n-            },\n             ExprKind::Unary(UnOp::Neg, ref inner) => {\n                 if let ExprKind::Unary(UnOp::Neg, _) = inner.kind {\n                     span_lint(\n@@ -492,54 +416,6 @@ impl EarlyLintPass for MiscEarlyLints {\n             _ => (),\n         }\n     }\n-\n-    fn check_block(&mut self, cx: &EarlyContext<'_>, block: &Block) {\n-        fn count_closure_usage(block: &Block, ident: &Ident) -> usize {\n-            struct ClosureUsageCount<'ast> {\n-                ident: &'ast Ident,\n-                count: usize,\n-            };\n-            impl<'ast> Visitor<'ast> for ClosureUsageCount<'ast> {\n-                fn visit_expr(&mut self, expr: &'ast Expr) {\n-                    if_chain! {\n-                        if let ExprKind::Call(ref closure, _) = expr.kind;\n-                        if let ExprKind::Path(_, ref path) = closure.kind;\n-                        if self.ident == &path.segments[0].ident;\n-                        then {\n-                            self.count += 1;\n-                        }\n-                    }\n-                    walk_expr(self, expr);\n-                }\n-            }\n-            let mut closure_usage_count = ClosureUsageCount { ident, count: 0 };\n-            closure_usage_count.visit_block(block);\n-            closure_usage_count.count\n-        }\n-\n-        for w in block.stmts.windows(2) {\n-            if_chain! {\n-                if let StmtKind::Local(ref local) = w[0].kind;\n-                if let Option::Some(ref t) = local.init;\n-                if let ExprKind::Closure(..) = t.kind;\n-                if let PatKind::Ident(_, ident, _) = local.pat.kind;\n-                if let StmtKind::Semi(ref second) = w[1].kind;\n-                if let ExprKind::Assign(_, ref call, _) = second.kind;\n-                if let ExprKind::Call(ref closure, _) = call.kind;\n-                if let ExprKind::Path(_, ref path) = closure.kind;\n-                if ident == path.segments[0].ident;\n-                if  count_closure_usage(block, &ident) == 1;\n-                then {\n-                    span_lint(\n-                        cx,\n-                        REDUNDANT_CLOSURE_CALL,\n-                        second.span,\n-                        \"Closure called just once immediately after it was declared\",\n-                    );\n-                }\n-            }\n-        }\n-    }\n }\n \n impl MiscEarlyLints {"}, {"sha": "391d70af1599c1262fd109aa5052eaebe74857d9", "filename": "clippy_lints/src/redundant_closure_call.rs", "status": "added", "additions": 151, "deletions": 0, "changes": 151, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/clippy_lints%2Fsrc%2Fredundant_closure_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/clippy_lints%2Fsrc%2Fredundant_closure_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fredundant_closure_call.rs?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -0,0 +1,151 @@\n+use crate::utils::{snippet_with_applicability, span_lint, span_lint_and_then};\n+use if_chain::if_chain;\n+use rustc_ast::ast;\n+use rustc_ast::visit as ast_visit;\n+use rustc_ast::visit::Visitor as AstVisitor;\n+use rustc_errors::Applicability;\n+use rustc_hir as hir;\n+use rustc_hir::intravisit as hir_visit;\n+use rustc_hir::intravisit::Visitor as HirVisitor;\n+use rustc_lint::{EarlyContext, EarlyLintPass, LateContext, LateLintPass, LintContext};\n+use rustc_middle::hir::map::Map;\n+use rustc_middle::lint::in_external_macro;\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+use rustc_span::symbol::Ident;\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Detects closures called in the same expression where they\n+    /// are defined.\n+    ///\n+    /// **Why is this bad?** It is unnecessarily adding to the expression's\n+    /// complexity.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    /// ```rust,ignore\n+    /// // Bad\n+    /// let a = (|| 42)()\n+    ///\n+    /// // Good\n+    /// let a = 42\n+    /// ```\n+    pub REDUNDANT_CLOSURE_CALL,\n+    complexity,\n+    \"throwaway closures called in the expression they are defined\"\n+}\n+\n+declare_lint_pass!(RedundantClosureCall => [REDUNDANT_CLOSURE_CALL]);\n+\n+// Used to find `return` statements or equivalents e.g., `?`\n+struct ReturnVisitor {\n+    found_return: bool,\n+}\n+\n+impl ReturnVisitor {\n+    #[must_use]\n+    fn new() -> Self {\n+        Self { found_return: false }\n+    }\n+}\n+\n+impl<'ast> ast_visit::Visitor<'ast> for ReturnVisitor {\n+    fn visit_expr(&mut self, ex: &'ast ast::Expr) {\n+        if let ast::ExprKind::Ret(_) = ex.kind {\n+            self.found_return = true;\n+        } else if let ast::ExprKind::Try(_) = ex.kind {\n+            self.found_return = true;\n+        }\n+\n+        ast_visit::walk_expr(self, ex)\n+    }\n+}\n+\n+impl EarlyLintPass for RedundantClosureCall {\n+    fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &ast::Expr) {\n+        if in_external_macro(cx.sess(), expr.span) {\n+            return;\n+        }\n+        if_chain! {\n+            if let ast::ExprKind::Call(ref paren, _) = expr.kind;\n+            if let ast::ExprKind::Paren(ref closure) = paren.kind;\n+            if let ast::ExprKind::Closure(_, _, _, ref decl, ref block, _) = closure.kind;\n+            then {\n+                let mut visitor = ReturnVisitor::new();\n+                visitor.visit_expr(block);\n+                if !visitor.found_return {\n+                    span_lint_and_then(\n+                        cx,\n+                        REDUNDANT_CLOSURE_CALL,\n+                        expr.span,\n+                        \"Try not to call a closure in the expression where it is declared.\",\n+                        |diag| {\n+                            if decl.inputs.is_empty() {\n+                                let mut app = Applicability::MachineApplicable;\n+                                let hint =\n+                                    snippet_with_applicability(cx, block.span, \"..\", &mut app).into_owned();\n+                                diag.span_suggestion(expr.span, \"Try doing something like: \", hint, app);\n+                            }\n+                        },\n+                    );\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+impl<'tcx> LateLintPass<'tcx> for RedundantClosureCall {\n+    fn check_block(&mut self, cx: &LateContext<'tcx>, block: &'tcx hir::Block<'_>) {\n+        fn count_closure_usage<'tcx>(block: &'tcx hir::Block<'_>, ident: &'tcx Ident) -> usize {\n+            struct ClosureUsageCount<'tcx> {\n+                ident: &'tcx Ident,\n+                count: usize,\n+            };\n+            impl<'tcx> hir_visit::Visitor<'tcx> for ClosureUsageCount<'tcx> {\n+                type Map = Map<'tcx>;\n+\n+                fn visit_expr(&mut self, expr: &'tcx hir::Expr<'tcx>) {\n+                    if_chain! {\n+                        if let hir::ExprKind::Call(ref closure, _) = expr.kind;\n+                        if let hir::ExprKind::Path(hir::QPath::Resolved(_, ref path)) = closure.kind;\n+                        if self.ident == &path.segments[0].ident;\n+                        then {\n+                            self.count += 1;\n+                        }\n+                    }\n+                    hir_visit::walk_expr(self, expr);\n+                }\n+\n+                fn nested_visit_map(&mut self) -> hir_visit::NestedVisitorMap<Self::Map> {\n+                    hir_visit::NestedVisitorMap::None\n+                }\n+            };\n+            let mut closure_usage_count = ClosureUsageCount { ident, count: 0 };\n+            closure_usage_count.visit_block(block);\n+            closure_usage_count.count\n+        }\n+\n+        for w in block.stmts.windows(2) {\n+            if_chain! {\n+                if let hir::StmtKind::Local(ref local) = w[0].kind;\n+                if let Option::Some(ref t) = local.init;\n+                if let hir::ExprKind::Closure(..) = t.kind;\n+                if let hir::PatKind::Binding(_, _, ident, _) = local.pat.kind;\n+                if let hir::StmtKind::Semi(ref second) = w[1].kind;\n+                if let hir::ExprKind::Assign(_, ref call, _) = second.kind;\n+                if let hir::ExprKind::Call(ref closure, _) = call.kind;\n+                if let hir::ExprKind::Path(hir::QPath::Resolved(_, ref path)) = closure.kind;\n+                if ident == path.segments[0].ident;\n+                if  count_closure_usage(block, &ident) == 1;\n+                then {\n+                    span_lint(\n+                        cx,\n+                        REDUNDANT_CLOSURE_CALL,\n+                        second.span,\n+                        \"Closure called just once immediately after it was declared\",\n+                    );\n+                }\n+            }\n+        }\n+    }\n+}"}, {"sha": "1879aae77fb650783301cd1bc8500cca8551bdb7", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -1835,7 +1835,7 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n         group: \"complexity\",\n         desc: \"throwaway closures called in the expression they are defined\",\n         deprecation: None,\n-        module: \"misc_early\",\n+        module: \"redundant_closure_call\",\n     },\n     Lint {\n         name: \"redundant_closure_for_method_calls\","}, {"sha": "3dd365620ccbf1b4f4eef131819ce9da695f84dd", "filename": "tests/ui/redundant_closure_call_early.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_early.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_early.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_closure_call_early.rs?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -0,0 +1,19 @@\n+// non rustfixable, see redundant_closure_call_fixable.rs\n+\n+#![warn(clippy::redundant_closure_call)]\n+\n+fn main() {\n+    let mut i = 1;\n+\n+    // lint here\n+    let mut k = (|m| m + 1)(i);\n+\n+    // lint here\n+    k = (|a, b| a * b)(1, 5);\n+\n+    // don't lint these\n+    #[allow(clippy::needless_return)]\n+    (|| return 2)();\n+    (|| -> Option<i32> { None? })();\n+    (|| -> Result<i32, i32> { Err(2)? })();\n+}"}, {"sha": "0ac97ae25d0926674d9d045fb0b5a16fce95b86e", "filename": "tests/ui/redundant_closure_call_early.stderr", "status": "renamed", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_early.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_early.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_closure_call_early.stderr?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -1,22 +1,16 @@\n-error: Closure called just once immediately after it was declared\n-  --> $DIR/redundant_closure_call.rs:18:5\n-   |\n-LL |     i = redun_closure();\n-   |     ^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: `-D clippy::redundant-closure-call` implied by `-D warnings`\n-\n error: Try not to call a closure in the expression where it is declared.\n-  --> $DIR/redundant_closure_call.rs:7:17\n+  --> $DIR/redundant_closure_call_early.rs:9:17\n    |\n LL |     let mut k = (|m| m + 1)(i);\n    |                 ^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::redundant-closure-call` implied by `-D warnings`\n \n error: Try not to call a closure in the expression where it is declared.\n-  --> $DIR/redundant_closure_call.rs:9:9\n+  --> $DIR/redundant_closure_call_early.rs:12:9\n    |\n LL |     k = (|a, b| a * b)(1, 5);\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n ", "previous_filename": "tests/ui/redundant_closure_call.stderr"}, {"sha": "21ee58e5b44c8a1ec06ea1683ffb0201c346daff", "filename": "tests/ui/redundant_closure_call_late.rs", "status": "renamed", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_late.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_late.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_closure_call_late.rs?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -4,9 +4,6 @@\n \n fn main() {\n     let mut i = 1;\n-    let mut k = (|m| m + 1)(i);\n-\n-    k = (|a, b| a * b)(1, 5);\n \n     // don't lint here, the closure is used more than once\n     let closure = |i| i + 1;\n@@ -22,9 +19,4 @@ fn main() {\n     i = redefined_closure();\n     let redefined_closure = || 2;\n     i = redefined_closure();\n-\n-    #[allow(clippy::needless_return)]\n-    (|| return 2)();\n-    (|| -> Option<i32> { None? })();\n-    (|| -> Result<i32, i32> { Err(2)? })();\n }", "previous_filename": "tests/ui/redundant_closure_call.rs"}, {"sha": "0aebc3c419e9bb053a13e90097f04fdd0e9cee86", "filename": "tests/ui/redundant_closure_call_late.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_late.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8/tests%2Fui%2Fredundant_closure_call_late.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_closure_call_late.stderr?ref=0fecaf1abcbe8d4ba1a9c532b69aab6fab3097c8", "patch": "@@ -0,0 +1,10 @@\n+error: Closure called just once immediately after it was declared\n+  --> $DIR/redundant_closure_call_late.rs:15:5\n+   |\n+LL |     i = redun_closure();\n+   |     ^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::redundant-closure-call` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}