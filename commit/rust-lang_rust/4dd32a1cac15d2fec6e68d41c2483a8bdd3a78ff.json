{"sha": "4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkZDMyYTFjYWMxNWQyZmVjNmU2OGQ0MWMyNDgzYThiZGQzYTc4ZmY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-07-19T09:37:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-19T09:37:47Z"}, "message": "Rollup merge of #87256 - Aaron1011:hir-wf-assoc-default, r=oli-obk\n\nExtend HIR-based WF checking to associated type defaults\n\nPreviously, we would only look at associated types in `impl` blocks.", "tree": {"sha": "923b4ba4dbdb9cc9de02d8334a0d282c3e4b5f2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/923b4ba4dbdb9cc9de02d8334a0d282c3e4b5f2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg9UfrCRBK7hj4Ov3rIwAAFNoIABcB8u/cYgK6MORSJXPn5g7Z\nQ1mbNEhVTMh8a8UmWVsR4nMKBGxiZJRdo/bqyv3aI+6KoKvrNBh1SVdsnvSh68EF\nbOYCuvpHUWKNFIAcLsp0QHg8Ha/GUq3wzcBvyAeYcYmH3oYHyY2tqC3FA2HkDGnG\nXUGJiCFl135GJBjbSyEx1WH+hm9Z/sO1k/x7Z7kj43d7Xb0OEk60PO15C1RaAJqC\nnZqOpJZSVjr9cZmJDXrNqAXC3T43mh23VzIC3/gdhgWNmuMx/VDAmSVyRwxE8krY\nYVjbJF5497X+lOBHD1T/kJXveFtmyvpVQ172/Didfj6/S2uvngEhLNHIKuA681k=\n=s9o6\n-----END PGP SIGNATURE-----\n", "payload": "tree 923b4ba4dbdb9cc9de02d8334a0d282c3e4b5f2f\nparent 8cf995f6acb70cb09f14080df4d1232f736b2fc5\nparent 93aa89023fb7eb9149e6739c7f54c3ae4a8235bf\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1626687467 +0200\ncommitter GitHub <noreply@github.com> 1626687467 +0200\n\nRollup merge of #87256 - Aaron1011:hir-wf-assoc-default, r=oli-obk\n\nExtend HIR-based WF checking to associated type defaults\n\nPreviously, we would only look at associated types in `impl` blocks.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "html_url": "https://github.com/rust-lang/rust/commit/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8cf995f6acb70cb09f14080df4d1232f736b2fc5", "url": "https://api.github.com/repos/rust-lang/rust/commits/8cf995f6acb70cb09f14080df4d1232f736b2fc5", "html_url": "https://github.com/rust-lang/rust/commit/8cf995f6acb70cb09f14080df4d1232f736b2fc5"}, {"sha": "93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "html_url": "https://github.com/rust-lang/rust/commit/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "a8ec7b79e571f284141e7343e525a86ea6faba56", "filename": "compiler/rustc_typeck/src/hir_wf_check.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs?ref=4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "patch": "@@ -121,7 +121,11 @@ fn diagnostic_hir_wf_check<'tcx>(\n \n     let ty = match tcx.hir().get(hir_id) {\n         hir::Node::ImplItem(item) => match item.kind {\n-            hir::ImplItemKind::TyAlias(ref ty) => Some(ty),\n+            hir::ImplItemKind::TyAlias(ty) => Some(ty),\n+            _ => None,\n+        },\n+        hir::Node::TraitItem(item) => match item.kind {\n+            hir::TraitItemKind::Type(_, ty) => ty,\n             _ => None,\n         },\n         _ => None,"}, {"sha": "73ef567ffae6db158edd31d1f79f17644e2dd4c5", "filename": "src/test/ui/associated-types/defaults-wf.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/src%2Ftest%2Fui%2Fassociated-types%2Fdefaults-wf.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/src%2Ftest%2Fui%2Fassociated-types%2Fdefaults-wf.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fassociated-types%2Fdefaults-wf.stderr?ref=4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "patch": "@@ -1,8 +1,8 @@\n error[E0277]: the size for values of type `[u8]` cannot be known at compilation time\n-  --> $DIR/defaults-wf.rs:7:5\n+  --> $DIR/defaults-wf.rs:7:15\n    |\n LL |     type Ty = Vec<[u8]>;\n-   |     ^^^^^^^^^^^^^^^^^^^^ doesn't have a size known at compile-time\n+   |               ^^^^^^^^^ doesn't have a size known at compile-time\n    | \n   ::: $SRC_DIR/alloc/src/vec/mod.rs:LL:COL\n    |"}, {"sha": "d67e110edeeee0aabb7406503e707c9615e21df0", "filename": "src/test/ui/wf/wf-trait-associated-type-trait.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.rs?ref=4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "patch": "@@ -8,7 +8,7 @@ struct IsCopy<T:Copy> { x: T }\n \n trait SomeTrait {\n     type Type1;\n-    type Type2 = IsCopy<Self::Type1>;\n+    type Type2 = (IsCopy<Self::Type1>, bool);\n     //~^ ERROR E0277\n }\n "}, {"sha": "d1c2c65043d21b8ee8fe2ec862cc504bd8d4743a", "filename": "src/test/ui/wf/wf-trait-associated-type-trait.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.stderr?ref=4dd32a1cac15d2fec6e68d41c2483a8bdd3a78ff", "patch": "@@ -1,11 +1,11 @@\n error[E0277]: the trait bound `<Self as SomeTrait>::Type1: Copy` is not satisfied\n-  --> $DIR/wf-trait-associated-type-trait.rs:11:5\n+  --> $DIR/wf-trait-associated-type-trait.rs:11:19\n    |\n LL | struct IsCopy<T:Copy> { x: T }\n    |                 ---- required by this bound in `IsCopy`\n ...\n-LL |     type Type2 = IsCopy<Self::Type1>;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `<Self as SomeTrait>::Type1`\n+LL |     type Type2 = (IsCopy<Self::Type1>, bool);\n+   |                   ^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `<Self as SomeTrait>::Type1`\n    |\n help: consider further restricting the associated type\n    |"}]}