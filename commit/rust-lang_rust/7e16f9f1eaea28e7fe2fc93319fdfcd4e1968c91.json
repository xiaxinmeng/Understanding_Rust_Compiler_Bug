{"sha": "7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "node_id": "C_kwDOAAsO6NoAKDdlMTZmOWYxZWFlYTI4ZTdmZTJmYzkzMzE5ZmRmY2Q0ZTE5NjhjOTE", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-10-10T08:13:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-10T08:13:40Z"}, "message": "Rollup merge of #99696 - WaffleLapkin:uplift, r=fee1-dead\n\nUplift `clippy::for_loops_over_fallibles` lint into rustc\n\nThis PR, as the title suggests, uplifts [`clippy::for_loops_over_fallibles`] lint into rustc. This lint warns for code like this:\n```rust\nfor _ in Some(1) {}\nfor _ in Ok::<_, ()>(1) {}\n```\ni.e. directly iterating over `Option` and `Result` using `for` loop.\n\nThere are a number of suggestions that this PR adds (on top of what clippy suggested):\n1. If the argument (? is there a better name for that expression) of a `for` loop is a `.next()` call, then we can suggest removing it (or rather replacing with `.by_ref()` to allow iterator being used later)\n   ```rust\n    for _ in iter.next() {}\n    // turns into\n    for _ in iter.by_ref() {}\n    ```\n2. (otherwise) We can suggest using `while let`, this is useful for non-iterator, iterator-like things like [async] channels\n   ```rust\n   for _ in rx.recv() {}\n   // turns into\n   while let Some(_) = rx.recv() {}\n   ```\n3. If the argument type is `Result<impl IntoIterator, _>` and the body has a `Result<_, _>` type, we can suggest using `?`\n   ```rust\n   for _ in f() {}\n   // turns into\n   for _ in f()? {}\n   ```\n4. To preserve the original behavior and clear intent, we can suggest using `if let`\n   ```rust\n   for _ in f() {}\n   // turns into\n   if let Some(_) = f() {}\n   ```\n(P.S. `Some` and `Ok` are interchangeable depending on the type)\n\nI still feel that the lint wording/look is somewhat off, so I'll be happy to hear suggestions (on how to improve suggestions :D)!\n\nResolves #99272\n\n[`clippy::for_loops_over_fallibles`]: https://rust-lang.github.io/rust-clippy/master/index.html#for_loops_over_fallibles", "tree": {"sha": "b96433616143a8f0a449cec841fc9be07de08d4b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b96433616143a8f0a449cec841fc9be07de08d4b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjQ9Q0CRBK7hj4Ov3rIwAAycsIAFyGb1YCL15YIqE3v+LisSJI\n9R2PYyRZN8i60h3u5gTcizclch7Ap19S7c7wpI++bUmzTVXirGyKXvFHFlPgE6vl\nO5i3egw736mgVyftIlwV+4+97qOchltPAmwuvn532SwjKePuUdVpjxy7GDLd+gL5\ncNIGczqJaidE0GFm07opZlmnR9u98Nmrt1SPWylBR2i8FdbrTCafutJjrNorBKPe\n+VVAHyLtLuwMgjX+U3tvOwv24WBMSs9qIywU82wrh0K0h0kuZVI6NWhY3x8Kl3t2\nQMpTa/nTM8GxhhXVZQqdIsRkEiHTUiND5jf33wnBnxmsR+BxjjfGUixr24xBJqo=\n=i6eI\n-----END PGP SIGNATURE-----\n", "payload": "tree b96433616143a8f0a449cec841fc9be07de08d4b\nparent e495b37c9a301d776a7bd0c72d5c4a202e159032\nparent 9d4edff1b0179e3514bcc27618edd6348903e99a\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1665389620 +0530\ncommitter GitHub <noreply@github.com> 1665389620 +0530\n\nRollup merge of #99696 - WaffleLapkin:uplift, r=fee1-dead\n\nUplift `clippy::for_loops_over_fallibles` lint into rustc\n\nThis PR, as the title suggests, uplifts [`clippy::for_loops_over_fallibles`] lint into rustc. This lint warns for code like this:\n```rust\nfor _ in Some(1) {}\nfor _ in Ok::<_, ()>(1) {}\n```\ni.e. directly iterating over `Option` and `Result` using `for` loop.\n\nThere are a number of suggestions that this PR adds (on top of what clippy suggested):\n1. If the argument (? is there a better name for that expression) of a `for` loop is a `.next()` call, then we can suggest removing it (or rather replacing with `.by_ref()` to allow iterator being used later)\n   ```rust\n    for _ in iter.next() {}\n    // turns into\n    for _ in iter.by_ref() {}\n    ```\n2. (otherwise) We can suggest using `while let`, this is useful for non-iterator, iterator-like things like [async] channels\n   ```rust\n   for _ in rx.recv() {}\n   // turns into\n   while let Some(_) = rx.recv() {}\n   ```\n3. If the argument type is `Result<impl IntoIterator, _>` and the body has a `Result<_, _>` type, we can suggest using `?`\n   ```rust\n   for _ in f() {}\n   // turns into\n   for _ in f()? {}\n   ```\n4. To preserve the original behavior and clear intent, we can suggest using `if let`\n   ```rust\n   for _ in f() {}\n   // turns into\n   if let Some(_) = f() {}\n   ```\n(P.S. `Some` and `Ok` are interchangeable depending on the type)\n\nI still feel that the lint wording/look is somewhat off, so I'll be happy to hear suggestions (on how to improve suggestions :D)!\n\nResolves #99272\n\n[`clippy::for_loops_over_fallibles`]: https://rust-lang.github.io/rust-clippy/master/index.html#for_loops_over_fallibles\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "html_url": "https://github.com/rust-lang/rust/commit/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e495b37c9a301d776a7bd0c72d5c4a202e159032", "url": "https://api.github.com/repos/rust-lang/rust/commits/e495b37c9a301d776a7bd0c72d5c4a202e159032", "html_url": "https://github.com/rust-lang/rust/commit/e495b37c9a301d776a7bd0c72d5c4a202e159032"}, {"sha": "9d4edff1b0179e3514bcc27618edd6348903e99a", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d4edff1b0179e3514bcc27618edd6348903e99a", "html_url": "https://github.com/rust-lang/rust/commit/9d4edff1b0179e3514bcc27618edd6348903e99a"}], "stats": {"total": 747, "additions": 381, "deletions": 366}, "files": [{"sha": "145b31842ef6989a4b7429887b17520d35b85b88", "filename": "compiler/rustc_ast/src/visit.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -244,14 +244,12 @@ pub trait Visitor<'ast>: Sized {\n \n #[macro_export]\n macro_rules! walk_list {\n-    ($visitor: expr, $method: ident, $list: expr) => {\n-        for elem in $list {\n-            $visitor.$method(elem)\n-        }\n-    };\n-    ($visitor: expr, $method: ident, $list: expr, $($extra_args: expr),*) => {\n-        for elem in $list {\n-            $visitor.$method(elem, $($extra_args,)*)\n+    ($visitor: expr, $method: ident, $list: expr $(, $($extra_args: expr),* )?) => {\n+        {\n+            #[cfg_attr(not(bootstrap), allow(for_loops_over_fallibles))]\n+            for elem in $list {\n+                $visitor.$method(elem $(, $($extra_args,)* )?)\n+            }\n         }\n     }\n }"}, {"sha": "ed8d424e0c62d489f30906b770c0fd54d3eaced2", "filename": "compiler/rustc_lint/src/for_loops_over_fallibles.rs", "status": "added", "additions": 183, "deletions": 0, "changes": 183, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/compiler%2Frustc_lint%2Fsrc%2Ffor_loops_over_fallibles.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/compiler%2Frustc_lint%2Fsrc%2Ffor_loops_over_fallibles.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ffor_loops_over_fallibles.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -0,0 +1,183 @@\n+use crate::{LateContext, LateLintPass, LintContext};\n+\n+use hir::{Expr, Pat};\n+use rustc_errors::{Applicability, DelayDm};\n+use rustc_hir as hir;\n+use rustc_infer::traits::TraitEngine;\n+use rustc_infer::{infer::TyCtxtInferExt, traits::ObligationCause};\n+use rustc_middle::ty::{self, List};\n+use rustc_span::{sym, Span};\n+use rustc_trait_selection::traits::TraitEngineExt;\n+\n+declare_lint! {\n+    /// The `for_loops_over_fallibles` lint checks for `for` loops over `Option` or `Result` values.\n+    ///\n+    /// ### Example\n+    ///\n+    /// ```rust\n+    /// let opt = Some(1);\n+    /// for x in opt { /* ... */}\n+    /// ```\n+    ///\n+    /// {{produces}}\n+    ///\n+    /// ### Explanation\n+    ///\n+    /// Both `Option` and `Result` implement `IntoIterator` trait, which allows using them in a `for` loop.\n+    /// `for` loop over `Option` or `Result` will iterate either 0 (if the value is `None`/`Err(_)`)\n+    /// or 1 time (if the value is `Some(_)`/`Ok(_)`). This is not very useful and is more clearly expressed\n+    /// via `if let`.\n+    ///\n+    /// `for` loop can also be accidentally written with the intention to call a function multiple times,\n+    /// while the function returns `Some(_)`, in these cases `while let` loop should be used instead.\n+    ///\n+    /// The \"intended\" use of `IntoIterator` implementations for `Option` and `Result` is passing them to\n+    /// generic code that expects something implementing `IntoIterator`. For example using `.chain(option)`\n+    /// to optionally add a value to an iterator.\n+    pub FOR_LOOPS_OVER_FALLIBLES,\n+    Warn,\n+    \"for-looping over an `Option` or a `Result`, which is more clearly expressed as an `if let`\"\n+}\n+\n+declare_lint_pass!(ForLoopsOverFallibles => [FOR_LOOPS_OVER_FALLIBLES]);\n+\n+impl<'tcx> LateLintPass<'tcx> for ForLoopsOverFallibles {\n+    fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n+        let Some((pat, arg)) = extract_for_loop(expr) else { return };\n+\n+        let ty = cx.typeck_results().expr_ty(arg);\n+\n+        let &ty::Adt(adt, substs) = ty.kind() else { return };\n+\n+        let (article, ty, var) = match adt.did() {\n+            did if cx.tcx.is_diagnostic_item(sym::Option, did) => (\"an\", \"Option\", \"Some\"),\n+            did if cx.tcx.is_diagnostic_item(sym::Result, did) => (\"a\", \"Result\", \"Ok\"),\n+            _ => return,\n+        };\n+\n+        let msg = DelayDm(|| {\n+            format!(\n+                \"for loop over {article} `{ty}`. This is more readably written as an `if let` statement\",\n+            )\n+        });\n+\n+        cx.struct_span_lint(FOR_LOOPS_OVER_FALLIBLES, arg.span, msg, |lint| {\n+            if let Some(recv) = extract_iterator_next_call(cx, arg)\n+            && let Ok(recv_snip) = cx.sess().source_map().span_to_snippet(recv.span)\n+            {\n+                lint.span_suggestion(\n+                    recv.span.between(arg.span.shrink_to_hi()),\n+                    format!(\"to iterate over `{recv_snip}` remove the call to `next`\"),\n+                    \".by_ref()\",\n+                    Applicability::MaybeIncorrect\n+                );\n+            } else {\n+                lint.multipart_suggestion_verbose(\n+                    format!(\"to check pattern in a loop use `while let`\"),\n+                    vec![\n+                        // NB can't use `until` here because `expr.span` and `pat.span` have different syntax contexts\n+                        (expr.span.with_hi(pat.span.lo()), format!(\"while let {var}(\")),\n+                        (pat.span.between(arg.span), format!(\") = \")),\n+                    ],\n+                    Applicability::MaybeIncorrect\n+                );\n+            }\n+\n+            if suggest_question_mark(cx, adt, substs, expr.span) {\n+                lint.span_suggestion(\n+                    arg.span.shrink_to_hi(),\n+                    \"consider unwrapping the `Result` with `?` to iterate over its contents\",\n+                    \"?\",\n+                    Applicability::MaybeIncorrect,\n+                );\n+            }\n+\n+            lint.multipart_suggestion_verbose(\n+                \"consider using `if let` to clear intent\",\n+                vec![\n+                    // NB can't use `until` here because `expr.span` and `pat.span` have different syntax contexts\n+                    (expr.span.with_hi(pat.span.lo()), format!(\"if let {var}(\")),\n+                    (pat.span.between(arg.span), format!(\") = \")),\n+                ],\n+                Applicability::MaybeIncorrect,\n+            )\n+        })\n+    }\n+}\n+\n+fn extract_for_loop<'tcx>(expr: &Expr<'tcx>) -> Option<(&'tcx Pat<'tcx>, &'tcx Expr<'tcx>)> {\n+    if let hir::ExprKind::DropTemps(e) = expr.kind\n+    && let hir::ExprKind::Match(iterexpr, [arm], hir::MatchSource::ForLoopDesugar) = e.kind\n+    && let hir::ExprKind::Call(_, [arg]) = iterexpr.kind\n+    && let hir::ExprKind::Loop(block, ..) = arm.body.kind\n+    && let [stmt] = block.stmts\n+    && let hir::StmtKind::Expr(e) = stmt.kind\n+    && let hir::ExprKind::Match(_, [_, some_arm], _) = e.kind\n+    && let hir::PatKind::Struct(_, [field], _) = some_arm.pat.kind\n+    {\n+        Some((field.pat, arg))\n+    } else {\n+        None\n+    }\n+}\n+\n+fn extract_iterator_next_call<'tcx>(\n+    cx: &LateContext<'_>,\n+    expr: &Expr<'tcx>,\n+) -> Option<&'tcx Expr<'tcx>> {\n+    // This won't work for `Iterator::next(iter)`, is this an issue?\n+    if let hir::ExprKind::MethodCall(_, recv, _, _) = expr.kind\n+    && cx.typeck_results().type_dependent_def_id(expr.hir_id) == cx.tcx.lang_items().next_fn()\n+    {\n+        Some(recv)\n+    } else {\n+        return None\n+    }\n+}\n+\n+fn suggest_question_mark<'tcx>(\n+    cx: &LateContext<'tcx>,\n+    adt: ty::AdtDef<'tcx>,\n+    substs: &List<ty::GenericArg<'tcx>>,\n+    span: Span,\n+) -> bool {\n+    let Some(body_id) = cx.enclosing_body else { return false };\n+    let Some(into_iterator_did) = cx.tcx.get_diagnostic_item(sym::IntoIterator) else { return false };\n+\n+    if !cx.tcx.is_diagnostic_item(sym::Result, adt.did()) {\n+        return false;\n+    }\n+\n+    // Check that the function/closure/constant we are in has a `Result` type.\n+    // Otherwise suggesting using `?` may not be a good idea.\n+    {\n+        let ty = cx.typeck_results().expr_ty(&cx.tcx.hir().body(body_id).value);\n+        let ty::Adt(ret_adt, ..) = ty.kind() else { return false };\n+        if !cx.tcx.is_diagnostic_item(sym::Result, ret_adt.did()) {\n+            return false;\n+        }\n+    }\n+\n+    let ty = substs.type_at(0);\n+    let infcx = cx.tcx.infer_ctxt().build();\n+    let mut fulfill_cx = <dyn TraitEngine<'_>>::new(infcx.tcx);\n+\n+    let cause = ObligationCause::new(\n+        span,\n+        body_id.hir_id,\n+        rustc_infer::traits::ObligationCauseCode::MiscObligation,\n+    );\n+    fulfill_cx.register_bound(\n+        &infcx,\n+        ty::ParamEnv::empty(),\n+        // Erase any region vids from the type, which may not be resolved\n+        infcx.tcx.erase_regions(ty),\n+        into_iterator_did,\n+        cause,\n+    );\n+\n+    // Select all, including ambiguous predicates\n+    let errors = fulfill_cx.select_all_or_error(&infcx);\n+\n+    errors.is_empty()\n+}"}, {"sha": "fee6e080c4fc7c377145d63dc24faa77ebd36460", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -52,6 +52,7 @@ mod early;\n mod enum_intrinsics_non_enums;\n mod errors;\n mod expect;\n+mod for_loops_over_fallibles;\n pub mod hidden_unicode_codepoints;\n mod internal;\n mod late;\n@@ -86,6 +87,7 @@ use rustc_span::Span;\n use array_into_iter::ArrayIntoIter;\n use builtin::*;\n use enum_intrinsics_non_enums::EnumIntrinsicsNonEnums;\n+use for_loops_over_fallibles::*;\n use hidden_unicode_codepoints::*;\n use internal::*;\n use let_underscore::*;\n@@ -188,6 +190,7 @@ macro_rules! late_lint_mod_passes {\n         $macro!(\n             $args,\n             [\n+                ForLoopsOverFallibles: ForLoopsOverFallibles,\n                 HardwiredLints: HardwiredLints,\n                 ImproperCTypesDeclarations: ImproperCTypesDeclarations,\n                 ImproperCTypesDefinitions: ImproperCTypesDefinitions,"}, {"sha": "f36f7c268064f27e7b97cbfa1187803ec5811f66", "filename": "library/core/tests/option.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/library%2Fcore%2Ftests%2Foption.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/library%2Fcore%2Ftests%2Foption.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Foption.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -57,6 +57,7 @@ fn test_get_resource() {\n }\n \n #[test]\n+#[cfg_attr(not(bootstrap), allow(for_loops_over_fallibles))]\n fn test_option_dance() {\n     let x = Some(());\n     let mut y = Some(5);"}, {"sha": "6a0fe7784fbcc37b8193d198ab9ed227d3b8a12d", "filename": "src/test/ui/drop/dropck_legal_cycles.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Fdrop%2Fdropck_legal_cycles.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Fdrop%2Fdropck_legal_cycles.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdrop%2Fdropck_legal_cycles.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -1017,7 +1017,7 @@ impl<'a> Children<'a> for HM<'a> {\n         where C: Context + PrePost<Self>, Self: Sized\n     {\n         if let Some(ref hm) = self.contents.get() {\n-            for (k, v) in hm.iter().nth(index / 2) {\n+            if let Some((k, v)) = hm.iter().nth(index / 2) {\n                 [k, v][index % 2].descend_into_self(context);\n             }\n         }\n@@ -1032,7 +1032,7 @@ impl<'a> Children<'a> for VD<'a> {\n         where C: Context + PrePost<Self>, Self: Sized\n     {\n         if let Some(ref vd) = self.contents.get() {\n-            for r in vd.iter().nth(index) {\n+            if let Some(r) = vd.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1047,7 +1047,7 @@ impl<'a> Children<'a> for VM<'a> {\n         where C: Context + PrePost<VM<'a>>\n     {\n         if let Some(ref vd) = self.contents.get() {\n-            for (_idx, r) in vd.iter().nth(index) {\n+            if let Some((_idx, r)) = vd.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1062,7 +1062,7 @@ impl<'a> Children<'a> for LL<'a> {\n         where C: Context + PrePost<LL<'a>>\n     {\n         if let Some(ref ll) = self.contents.get() {\n-            for r in ll.iter().nth(index) {\n+            if let Some(r) = ll.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1077,7 +1077,7 @@ impl<'a> Children<'a> for BH<'a> {\n         where C: Context + PrePost<BH<'a>>\n     {\n         if let Some(ref bh) = self.contents.get() {\n-            for r in bh.iter().nth(index) {\n+            if let Some(r) = bh.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1092,7 +1092,7 @@ impl<'a> Children<'a> for BTM<'a> {\n         where C: Context + PrePost<BTM<'a>>\n     {\n         if let Some(ref bh) = self.contents.get() {\n-            for (k, v) in bh.iter().nth(index / 2) {\n+            if let Some((k, v)) = bh.iter().nth(index / 2) {\n                 [k, v][index % 2].descend_into_self(context);\n             }\n         }\n@@ -1107,7 +1107,7 @@ impl<'a> Children<'a> for BTS<'a> {\n         where C: Context + PrePost<BTS<'a>>\n     {\n         if let Some(ref bh) = self.contents.get() {\n-            for r in bh.iter().nth(index) {\n+            if let Some(r) = bh.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }"}, {"sha": "eea548c482ff2f9ffc08d61331b0dd873b8df9dc", "filename": "src/test/ui/issues/issue-30371.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Fissues%2Fissue-30371.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Fissues%2Fissue-30371.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-30371.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -1,5 +1,6 @@\n // run-pass\n #![allow(unreachable_code)]\n+#![allow(for_loops_over_fallibles)]\n #![deny(unused_variables)]\n \n fn main() {"}, {"sha": "43d71c2e808a91d5c261aba452ad9808671f735f", "filename": "src/test/ui/lint/for_loop_over_fallibles.rs", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Flint%2Ffor_loop_over_fallibles.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Flint%2Ffor_loop_over_fallibles.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Ffor_loop_over_fallibles.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -0,0 +1,43 @@\n+// check-pass\n+\n+fn main() {\n+    // Common\n+    for _ in Some(1) {}\n+    //~^ WARN for loop over an `Option`. This is more readably written as an `if let` statement\n+    //~| HELP to check pattern in a loop use `while let`\n+    //~| HELP consider using `if let` to clear intent\n+    for _ in Ok::<_, ()>(1) {}\n+    //~^ WARN for loop over a `Result`. This is more readably written as an `if let` statement\n+    //~| HELP to check pattern in a loop use `while let`\n+    //~| HELP consider using `if let` to clear intent\n+\n+    // `Iterator::next` specific\n+    for _ in [0; 0].iter().next() {}\n+    //~^ WARN for loop over an `Option`. This is more readably written as an `if let` statement\n+    //~| HELP to iterate over `[0; 0].iter()` remove the call to `next`\n+    //~| HELP consider using `if let` to clear intent\n+\n+    // `Result<impl Iterator, _>`, but function doesn't return `Result`\n+    for _ in Ok::<_, ()>([0; 0].iter()) {}\n+    //~^ WARN for loop over a `Result`. This is more readably written as an `if let` statement\n+    //~| HELP to check pattern in a loop use `while let`\n+    //~| HELP consider using `if let` to clear intent\n+}\n+\n+fn _returns_result() -> Result<(), ()> {\n+    // `Result<impl Iterator, _>`\n+    for _ in Ok::<_, ()>([0; 0].iter()) {}\n+    //~^ WARN for loop over a `Result`. This is more readably written as an `if let` statement\n+    //~| HELP to check pattern in a loop use `while let`\n+    //~| HELP consider unwrapping the `Result` with `?` to iterate over its contents\n+    //~| HELP consider using `if let` to clear intent\n+\n+    // `Result<impl IntoIterator>`\n+    for _ in Ok::<_, ()>([0; 0]) {}\n+    //~^ WARN for loop over a `Result`. This is more readably written as an `if let` statement\n+    //~| HELP to check pattern in a loop use `while let`\n+    //~| HELP consider unwrapping the `Result` with `?` to iterate over its contents\n+    //~| HELP consider using `if let` to clear intent\n+\n+    Ok(())\n+}"}, {"sha": "96efdf85c490195fa84c51f3191990fe51f10c18", "filename": "src/test/ui/lint/for_loop_over_fallibles.stderr", "status": "added", "additions": 101, "deletions": 0, "changes": 101, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Flint%2Ffor_loop_over_fallibles.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftest%2Fui%2Flint%2Ffor_loop_over_fallibles.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Ffor_loop_over_fallibles.stderr?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -0,0 +1,101 @@\n+warning: for loop over an `Option`. This is more readably written as an `if let` statement\n+  --> $DIR/for_loop_over_fallibles.rs:5:14\n+   |\n+LL |     for _ in Some(1) {}\n+   |              ^^^^^^^\n+   |\n+   = note: `#[warn(for_loops_over_fallibles)]` on by default\n+help: to check pattern in a loop use `while let`\n+   |\n+LL |     while let Some(_) = Some(1) {}\n+   |     ~~~~~~~~~~~~~~~ ~~~\n+help: consider using `if let` to clear intent\n+   |\n+LL |     if let Some(_) = Some(1) {}\n+   |     ~~~~~~~~~~~~ ~~~\n+\n+warning: for loop over a `Result`. This is more readably written as an `if let` statement\n+  --> $DIR/for_loop_over_fallibles.rs:9:14\n+   |\n+LL |     for _ in Ok::<_, ()>(1) {}\n+   |              ^^^^^^^^^^^^^^\n+   |\n+help: to check pattern in a loop use `while let`\n+   |\n+LL |     while let Ok(_) = Ok::<_, ()>(1) {}\n+   |     ~~~~~~~~~~~~~ ~~~\n+help: consider using `if let` to clear intent\n+   |\n+LL |     if let Ok(_) = Ok::<_, ()>(1) {}\n+   |     ~~~~~~~~~~ ~~~\n+\n+warning: for loop over an `Option`. This is more readably written as an `if let` statement\n+  --> $DIR/for_loop_over_fallibles.rs:15:14\n+   |\n+LL |     for _ in [0; 0].iter().next() {}\n+   |              ^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: to iterate over `[0; 0].iter()` remove the call to `next`\n+   |\n+LL |     for _ in [0; 0].iter().by_ref() {}\n+   |                           ~~~~~~~~~\n+help: consider using `if let` to clear intent\n+   |\n+LL |     if let Some(_) = [0; 0].iter().next() {}\n+   |     ~~~~~~~~~~~~ ~~~\n+\n+warning: for loop over a `Result`. This is more readably written as an `if let` statement\n+  --> $DIR/for_loop_over_fallibles.rs:21:14\n+   |\n+LL |     for _ in Ok::<_, ()>([0; 0].iter()) {}\n+   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: to check pattern in a loop use `while let`\n+   |\n+LL |     while let Ok(_) = Ok::<_, ()>([0; 0].iter()) {}\n+   |     ~~~~~~~~~~~~~ ~~~\n+help: consider using `if let` to clear intent\n+   |\n+LL |     if let Ok(_) = Ok::<_, ()>([0; 0].iter()) {}\n+   |     ~~~~~~~~~~ ~~~\n+\n+warning: for loop over a `Result`. This is more readably written as an `if let` statement\n+  --> $DIR/for_loop_over_fallibles.rs:29:14\n+   |\n+LL |     for _ in Ok::<_, ()>([0; 0].iter()) {}\n+   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: to check pattern in a loop use `while let`\n+   |\n+LL |     while let Ok(_) = Ok::<_, ()>([0; 0].iter()) {}\n+   |     ~~~~~~~~~~~~~ ~~~\n+help: consider unwrapping the `Result` with `?` to iterate over its contents\n+   |\n+LL |     for _ in Ok::<_, ()>([0; 0].iter())? {}\n+   |                                        +\n+help: consider using `if let` to clear intent\n+   |\n+LL |     if let Ok(_) = Ok::<_, ()>([0; 0].iter()) {}\n+   |     ~~~~~~~~~~ ~~~\n+\n+warning: for loop over a `Result`. This is more readably written as an `if let` statement\n+  --> $DIR/for_loop_over_fallibles.rs:36:14\n+   |\n+LL |     for _ in Ok::<_, ()>([0; 0]) {}\n+   |              ^^^^^^^^^^^^^^^^^^^\n+   |\n+help: to check pattern in a loop use `while let`\n+   |\n+LL |     while let Ok(_) = Ok::<_, ()>([0; 0]) {}\n+   |     ~~~~~~~~~~~~~ ~~~\n+help: consider unwrapping the `Result` with `?` to iterate over its contents\n+   |\n+LL |     for _ in Ok::<_, ()>([0; 0])? {}\n+   |                                 +\n+help: consider using `if let` to clear intent\n+   |\n+LL |     if let Ok(_) = Ok::<_, ()>([0; 0]) {}\n+   |     ~~~~~~~~~~ ~~~\n+\n+warning: 6 warnings emitted\n+"}, {"sha": "fe1f0b56646cde331bafc0fa2c6f82fc6cf59072", "filename": "src/tools/clippy/clippy_lints/src/lib.register_all.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_all.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_all.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_all.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -109,7 +109,6 @@ store.register_group(true, \"clippy::all\", Some(\"clippy_all\"), vec![\n     LintId::of(loops::EMPTY_LOOP),\n     LintId::of(loops::EXPLICIT_COUNTER_LOOP),\n     LintId::of(loops::FOR_KV_MAP),\n-    LintId::of(loops::FOR_LOOPS_OVER_FALLIBLES),\n     LintId::of(loops::ITER_NEXT_LOOP),\n     LintId::of(loops::MANUAL_FIND),\n     LintId::of(loops::MANUAL_FLATTEN),"}, {"sha": "306cb6a61c94390c2f4d1c6db8067c2063f53728", "filename": "src/tools/clippy/clippy_lints/src/lib.register_lints.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_lints.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -227,7 +227,6 @@ store.register_lints(&[\n     loops::EXPLICIT_INTO_ITER_LOOP,\n     loops::EXPLICIT_ITER_LOOP,\n     loops::FOR_KV_MAP,\n-    loops::FOR_LOOPS_OVER_FALLIBLES,\n     loops::ITER_NEXT_LOOP,\n     loops::MANUAL_FIND,\n     loops::MANUAL_FLATTEN,"}, {"sha": "d6d95c95c85d2f7f065b97fceb2997521a2da61d", "filename": "src/tools/clippy/clippy_lints/src/lib.register_suspicious.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_suspicious.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_suspicious.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.register_suspicious.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -21,7 +21,6 @@ store.register_group(true, \"clippy::suspicious\", Some(\"clippy_suspicious\"), vec!\n     LintId::of(formatting::SUSPICIOUS_ELSE_FORMATTING),\n     LintId::of(formatting::SUSPICIOUS_UNARY_OP_FORMATTING),\n     LintId::of(loops::EMPTY_LOOP),\n-    LintId::of(loops::FOR_LOOPS_OVER_FALLIBLES),\n     LintId::of(loops::MUT_RANGE_BOUND),\n     LintId::of(methods::NO_EFFECT_REPLACE),\n     LintId::of(methods::SUSPICIOUS_MAP),"}, {"sha": "77de90fd7b94ac7fb196f388f21e29c097ba8e65", "filename": "src/tools/clippy/clippy_lints/src/loops/for_loops_over_fallibles.rs", "status": "removed", "additions": 0, "deletions": 65, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Ffor_loops_over_fallibles.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Ffor_loops_over_fallibles.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Ffor_loops_over_fallibles.rs?ref=e495b37c9a301d776a7bd0c72d5c4a202e159032", "patch": "@@ -1,65 +0,0 @@\n-use super::FOR_LOOPS_OVER_FALLIBLES;\n-use clippy_utils::diagnostics::span_lint_and_help;\n-use clippy_utils::source::snippet;\n-use clippy_utils::ty::is_type_diagnostic_item;\n-use rustc_hir::{Expr, Pat};\n-use rustc_lint::LateContext;\n-use rustc_span::symbol::sym;\n-\n-/// Checks for `for` loops over `Option`s and `Result`s.\n-pub(super) fn check(cx: &LateContext<'_>, pat: &Pat<'_>, arg: &Expr<'_>, method_name: Option<&str>) {\n-    let ty = cx.typeck_results().expr_ty(arg);\n-    if is_type_diagnostic_item(cx, ty, sym::Option) {\n-        let help_string = if let Some(method_name) = method_name {\n-            format!(\n-                \"consider replacing `for {0} in {1}.{method_name}()` with `if let Some({0}) = {1}`\",\n-                snippet(cx, pat.span, \"_\"),\n-                snippet(cx, arg.span, \"_\")\n-            )\n-        } else {\n-            format!(\n-                \"consider replacing `for {0} in {1}` with `if let Some({0}) = {1}`\",\n-                snippet(cx, pat.span, \"_\"),\n-                snippet(cx, arg.span, \"_\")\n-            )\n-        };\n-        span_lint_and_help(\n-            cx,\n-            FOR_LOOPS_OVER_FALLIBLES,\n-            arg.span,\n-            &format!(\n-                \"for loop over `{0}`, which is an `Option`. This is more readably written as an \\\n-                `if let` statement\",\n-                snippet(cx, arg.span, \"_\")\n-            ),\n-            None,\n-            &help_string,\n-        );\n-    } else if is_type_diagnostic_item(cx, ty, sym::Result) {\n-        let help_string = if let Some(method_name) = method_name {\n-            format!(\n-                \"consider replacing `for {0} in {1}.{method_name}()` with `if let Ok({0}) = {1}`\",\n-                snippet(cx, pat.span, \"_\"),\n-                snippet(cx, arg.span, \"_\")\n-            )\n-        } else {\n-            format!(\n-                \"consider replacing `for {0} in {1}` with `if let Ok({0}) = {1}`\",\n-                snippet(cx, pat.span, \"_\"),\n-                snippet(cx, arg.span, \"_\")\n-            )\n-        };\n-        span_lint_and_help(\n-            cx,\n-            FOR_LOOPS_OVER_FALLIBLES,\n-            arg.span,\n-            &format!(\n-                \"for loop over `{0}`, which is a `Result`. This is more readably written as an \\\n-                `if let` statement\",\n-                snippet(cx, arg.span, \"_\")\n-            ),\n-            None,\n-            &help_string,\n-        );\n-    }\n-}"}, {"sha": "b8a263817d2971b218b922bdb55d090edcf30bce", "filename": "src/tools/clippy/clippy_lints/src/loops/iter_next_loop.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fiter_next_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fiter_next_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fiter_next_loop.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -5,7 +5,7 @@ use rustc_hir::Expr;\n use rustc_lint::LateContext;\n use rustc_span::sym;\n \n-pub(super) fn check(cx: &LateContext<'_>, arg: &Expr<'_>) -> bool {\n+pub(super) fn check(cx: &LateContext<'_>, arg: &Expr<'_>) {\n     if is_trait_method(cx, arg, sym::Iterator) {\n         span_lint(\n             cx,\n@@ -14,8 +14,5 @@ pub(super) fn check(cx: &LateContext<'_>, arg: &Expr<'_>) -> bool {\n             \"you are iterating over `Iterator::next()` which is an Option; this will compile but is \\\n             probably not what you want\",\n         );\n-        true\n-    } else {\n-        false\n     }\n }"}, {"sha": "bcf278d9c8339c374449c0168a885a139e98a74c", "filename": "src/tools/clippy/clippy_lints/src/loops/mod.rs", "status": "modified", "additions": 2, "deletions": 55, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fmod.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -3,7 +3,6 @@ mod explicit_counter_loop;\n mod explicit_into_iter_loop;\n mod explicit_iter_loop;\n mod for_kv_map;\n-mod for_loops_over_fallibles;\n mod iter_next_loop;\n mod manual_find;\n mod manual_flatten;\n@@ -173,49 +172,6 @@ declare_clippy_lint! {\n     \"for-looping over `_.next()` which is probably not intended\"\n }\n \n-declare_clippy_lint! {\n-    /// ### What it does\n-    /// Checks for `for` loops over `Option` or `Result` values.\n-    ///\n-    /// ### Why is this bad?\n-    /// Readability. This is more clearly expressed as an `if\n-    /// let`.\n-    ///\n-    /// ### Example\n-    /// ```rust\n-    /// # let opt = Some(1);\n-    /// # let res: Result<i32, std::io::Error> = Ok(1);\n-    /// for x in opt {\n-    ///     // ..\n-    /// }\n-    ///\n-    /// for x in &res {\n-    ///     // ..\n-    /// }\n-    ///\n-    /// for x in res.iter() {\n-    ///     // ..\n-    /// }\n-    /// ```\n-    ///\n-    /// Use instead:\n-    /// ```rust\n-    /// # let opt = Some(1);\n-    /// # let res: Result<i32, std::io::Error> = Ok(1);\n-    /// if let Some(x) = opt {\n-    ///     // ..\n-    /// }\n-    ///\n-    /// if let Ok(x) = res {\n-    ///     // ..\n-    /// }\n-    /// ```\n-    #[clippy::version = \"1.45.0\"]\n-    pub FOR_LOOPS_OVER_FALLIBLES,\n-    suspicious,\n-    \"for-looping over an `Option` or a `Result`, which is more clearly expressed as an `if let`\"\n-}\n-\n declare_clippy_lint! {\n     /// ### What it does\n     /// Detects `loop + match` combinations that are easier\n@@ -648,7 +604,6 @@ declare_lint_pass!(Loops => [\n     EXPLICIT_ITER_LOOP,\n     EXPLICIT_INTO_ITER_LOOP,\n     ITER_NEXT_LOOP,\n-    FOR_LOOPS_OVER_FALLIBLES,\n     WHILE_LET_LOOP,\n     NEEDLESS_COLLECT,\n     EXPLICIT_COUNTER_LOOP,\n@@ -739,30 +694,22 @@ fn check_for_loop<'tcx>(\n     manual_find::check(cx, pat, arg, body, span, expr);\n }\n \n-fn check_for_loop_arg(cx: &LateContext<'_>, pat: &Pat<'_>, arg: &Expr<'_>) {\n-    let mut next_loop_linted = false; // whether or not ITER_NEXT_LOOP lint was used\n-\n+fn check_for_loop_arg(cx: &LateContext<'_>, _: &Pat<'_>, arg: &Expr<'_>) {\n     if let ExprKind::MethodCall(method, self_arg, [], _) = arg.kind {\n         let method_name = method.ident.as_str();\n         // check for looping over x.iter() or x.iter_mut(), could use &x or &mut x\n         match method_name {\n             \"iter\" | \"iter_mut\" => {\n                 explicit_iter_loop::check(cx, self_arg, arg, method_name);\n-                for_loops_over_fallibles::check(cx, pat, self_arg, Some(method_name));\n             },\n             \"into_iter\" => {\n                 explicit_iter_loop::check(cx, self_arg, arg, method_name);\n                 explicit_into_iter_loop::check(cx, self_arg, arg);\n-                for_loops_over_fallibles::check(cx, pat, self_arg, Some(method_name));\n             },\n             \"next\" => {\n-                next_loop_linted = iter_next_loop::check(cx, arg);\n+                iter_next_loop::check(cx, arg);\n             },\n             _ => {},\n         }\n     }\n-\n-    if !next_loop_linted {\n-        for_loops_over_fallibles::check(cx, pat, arg, None);\n-    }\n }"}, {"sha": "76d6ad0b23e6a82ffb31259f35dac6356fe45977", "filename": "src/tools/clippy/clippy_lints/src/renamed_lints.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Frenamed_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Frenamed_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Frenamed_lints.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -11,8 +11,8 @@ pub static RENAMED_LINTS: &[(&str, &str)] = &[\n     (\"clippy::disallowed_method\", \"clippy::disallowed_methods\"),\n     (\"clippy::disallowed_type\", \"clippy::disallowed_types\"),\n     (\"clippy::eval_order_dependence\", \"clippy::mixed_read_write_in_expression\"),\n-    (\"clippy::for_loop_over_option\", \"clippy::for_loops_over_fallibles\"),\n-    (\"clippy::for_loop_over_result\", \"clippy::for_loops_over_fallibles\"),\n+    (\"clippy::for_loop_over_option\", \"for_loops_over_fallibles\"),\n+    (\"clippy::for_loop_over_result\", \"for_loops_over_fallibles\"),\n     (\"clippy::identity_conversion\", \"clippy::useless_conversion\"),\n     (\"clippy::if_let_some_result\", \"clippy::match_result_ok\"),\n     (\"clippy::logic_bug\", \"clippy::overly_complex_bool_expr\"),\n@@ -31,6 +31,7 @@ pub static RENAMED_LINTS: &[(&str, &str)] = &[\n     (\"clippy::to_string_in_display\", \"clippy::recursive_format_impl\"),\n     (\"clippy::zero_width_space\", \"clippy::invisible_characters\"),\n     (\"clippy::drop_bounds\", \"drop_bounds\"),\n+    (\"clippy::for_loops_over_fallibles\", \"for_loops_over_fallibles\"),\n     (\"clippy::into_iter_on_array\", \"array_into_iter\"),\n     (\"clippy::invalid_atomic_ordering\", \"invalid_atomic_ordering\"),\n     (\"clippy::invalid_ref\", \"invalid_value\"),"}, {"sha": "bd27bc7938f8ef5aeb0a02ab243f1dce20150240", "filename": "src/tools/clippy/src/docs.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fsrc%2Fdocs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Fsrc%2Fdocs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fsrc%2Fdocs.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -170,7 +170,6 @@ docs! {\n     \"fn_to_numeric_cast_any\",\n     \"fn_to_numeric_cast_with_truncation\",\n     \"for_kv_map\",\n-    \"for_loops_over_fallibles\",\n     \"forget_copy\",\n     \"forget_non_drop\",\n     \"forget_ref\","}, {"sha": "c5a7508e45d40e58cef17a27e3f92a855dd0b398", "filename": "src/tools/clippy/src/docs/for_loops_over_fallibles.txt", "status": "removed", "additions": 0, "deletions": 32, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Fsrc%2Fdocs%2Ffor_loops_over_fallibles.txt", "raw_url": "https://github.com/rust-lang/rust/raw/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Fsrc%2Fdocs%2Ffor_loops_over_fallibles.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fsrc%2Fdocs%2Ffor_loops_over_fallibles.txt?ref=e495b37c9a301d776a7bd0c72d5c4a202e159032", "patch": "@@ -1,32 +0,0 @@\n-### What it does\n-Checks for `for` loops over `Option` or `Result` values.\n-\n-### Why is this bad?\n-Readability. This is more clearly expressed as an `if\n-let`.\n-\n-### Example\n-```\n-for x in opt {\n-    // ..\n-}\n-\n-for x in &res {\n-    // ..\n-}\n-\n-for x in res.iter() {\n-    // ..\n-}\n-```\n-\n-Use instead:\n-```\n-if let Some(x) = opt {\n-    // ..\n-}\n-\n-if let Ok(x) = res {\n-    // ..\n-}\n-```\n\\ No newline at end of file"}, {"sha": "55fb3788a8b1a568c1e9b5d0c9be2327194f5238", "filename": "src/tools/clippy/tests/ui/for_loop_unfixable.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loop_unfixable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loop_unfixable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loop_unfixable.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -8,6 +8,7 @@\n     clippy::for_kv_map\n )]\n #[allow(clippy::linkedlist, clippy::unnecessary_mut_passed, clippy::similar_names)]\n+#[allow(for_loops_over_fallibles)]\n fn main() {\n     let vec = vec![1, 2, 3, 4];\n "}, {"sha": "50a86eaa68f7dffe5e4f632aea276cf3463a49bb", "filename": "src/tools/clippy/tests/ui/for_loop_unfixable.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loop_unfixable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loop_unfixable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loop_unfixable.stderr?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -1,5 +1,5 @@\n error: you are iterating over `Iterator::next()` which is an Option; this will compile but is probably not what you want\n-  --> $DIR/for_loop_unfixable.rs:14:15\n+  --> $DIR/for_loop_unfixable.rs:15:15\n    |\n LL |     for _v in vec.iter().next() {}\n    |               ^^^^^^^^^^^^^^^^^"}, {"sha": "4b2a9297d084eba02835154bcc81789962cb3f03", "filename": "src/tools/clippy/tests/ui/for_loops_over_fallibles.rs", "status": "removed", "additions": 0, "deletions": 73, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loops_over_fallibles.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loops_over_fallibles.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loops_over_fallibles.rs?ref=e495b37c9a301d776a7bd0c72d5c4a202e159032", "patch": "@@ -1,73 +0,0 @@\n-#![warn(clippy::for_loops_over_fallibles)]\n-#![allow(clippy::uninlined_format_args)]\n-\n-fn for_loops_over_fallibles() {\n-    let option = Some(1);\n-    let mut result = option.ok_or(\"x not found\");\n-    let v = vec![0, 1, 2];\n-\n-    // check over an `Option`\n-    for x in option {\n-        println!(\"{}\", x);\n-    }\n-\n-    // check over an `Option`\n-    for x in option.iter() {\n-        println!(\"{}\", x);\n-    }\n-\n-    // check over a `Result`\n-    for x in result {\n-        println!(\"{}\", x);\n-    }\n-\n-    // check over a `Result`\n-    for x in result.iter_mut() {\n-        println!(\"{}\", x);\n-    }\n-\n-    // check over a `Result`\n-    for x in result.into_iter() {\n-        println!(\"{}\", x);\n-    }\n-\n-    for x in option.ok_or(\"x not found\") {\n-        println!(\"{}\", x);\n-    }\n-\n-    // make sure LOOP_OVER_NEXT lint takes clippy::precedence when next() is the last call\n-    // in the chain\n-    for x in v.iter().next() {\n-        println!(\"{}\", x);\n-    }\n-\n-    // make sure we lint when next() is not the last call in the chain\n-    for x in v.iter().next().and(Some(0)) {\n-        println!(\"{}\", x);\n-    }\n-\n-    for x in v.iter().next().ok_or(\"x not found\") {\n-        println!(\"{}\", x);\n-    }\n-\n-    // check for false positives\n-\n-    // for loop false positive\n-    for x in v {\n-        println!(\"{}\", x);\n-    }\n-\n-    // while let false positive for Option\n-    while let Some(x) = option {\n-        println!(\"{}\", x);\n-        break;\n-    }\n-\n-    // while let false positive for Result\n-    while let Ok(x) = result {\n-        println!(\"{}\", x);\n-        break;\n-    }\n-}\n-\n-fn main() {}"}, {"sha": "f09adccabd1a8d15d25a36d937d02d61f2bbb025", "filename": "src/tools/clippy/tests/ui/for_loops_over_fallibles.stderr", "status": "removed", "additions": 0, "deletions": 95, "changes": 95, "blob_url": "https://github.com/rust-lang/rust/blob/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loops_over_fallibles.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e495b37c9a301d776a7bd0c72d5c4a202e159032/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loops_over_fallibles.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Ffor_loops_over_fallibles.stderr?ref=e495b37c9a301d776a7bd0c72d5c4a202e159032", "patch": "@@ -1,95 +0,0 @@\n-error: for loop over `option`, which is an `Option`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:10:14\n-   |\n-LL |     for x in option {\n-   |              ^^^^^^\n-   |\n-   = help: consider replacing `for x in option` with `if let Some(x) = option`\n-   = note: `-D clippy::for-loops-over-fallibles` implied by `-D warnings`\n-\n-error: for loop over `option`, which is an `Option`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:15:14\n-   |\n-LL |     for x in option.iter() {\n-   |              ^^^^^^\n-   |\n-   = help: consider replacing `for x in option.iter()` with `if let Some(x) = option`\n-\n-error: for loop over `result`, which is a `Result`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:20:14\n-   |\n-LL |     for x in result {\n-   |              ^^^^^^\n-   |\n-   = help: consider replacing `for x in result` with `if let Ok(x) = result`\n-\n-error: for loop over `result`, which is a `Result`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:25:14\n-   |\n-LL |     for x in result.iter_mut() {\n-   |              ^^^^^^\n-   |\n-   = help: consider replacing `for x in result.iter_mut()` with `if let Ok(x) = result`\n-\n-error: for loop over `result`, which is a `Result`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:30:14\n-   |\n-LL |     for x in result.into_iter() {\n-   |              ^^^^^^\n-   |\n-   = help: consider replacing `for x in result.into_iter()` with `if let Ok(x) = result`\n-\n-error: for loop over `option.ok_or(\"x not found\")`, which is a `Result`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:34:14\n-   |\n-LL |     for x in option.ok_or(\"x not found\") {\n-   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = help: consider replacing `for x in option.ok_or(\"x not found\")` with `if let Ok(x) = option.ok_or(\"x not found\")`\n-\n-error: you are iterating over `Iterator::next()` which is an Option; this will compile but is probably not what you want\n-  --> $DIR/for_loops_over_fallibles.rs:40:14\n-   |\n-LL |     for x in v.iter().next() {\n-   |              ^^^^^^^^^^^^^^^\n-   |\n-   = note: `#[deny(clippy::iter_next_loop)]` on by default\n-\n-error: for loop over `v.iter().next().and(Some(0))`, which is an `Option`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:45:14\n-   |\n-LL |     for x in v.iter().next().and(Some(0)) {\n-   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = help: consider replacing `for x in v.iter().next().and(Some(0))` with `if let Some(x) = v.iter().next().and(Some(0))`\n-\n-error: for loop over `v.iter().next().ok_or(\"x not found\")`, which is a `Result`. This is more readably written as an `if let` statement\n-  --> $DIR/for_loops_over_fallibles.rs:49:14\n-   |\n-LL |     for x in v.iter().next().ok_or(\"x not found\") {\n-   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = help: consider replacing `for x in v.iter().next().ok_or(\"x not found\")` with `if let Ok(x) = v.iter().next().ok_or(\"x not found\")`\n-\n-error: this loop never actually loops\n-  --> $DIR/for_loops_over_fallibles.rs:61:5\n-   |\n-LL | /     while let Some(x) = option {\n-LL | |         println!(\"{}\", x);\n-LL | |         break;\n-LL | |     }\n-   | |_____^\n-   |\n-   = note: `#[deny(clippy::never_loop)]` on by default\n-\n-error: this loop never actually loops\n-  --> $DIR/for_loops_over_fallibles.rs:67:5\n-   |\n-LL | /     while let Ok(x) = result {\n-LL | |         println!(\"{}\", x);\n-LL | |         break;\n-LL | |     }\n-   | |_____^\n-\n-error: aborting due to 11 previous errors\n-"}, {"sha": "e12ea7ec14500f956a9b29ae3ce4fcec41da63cb", "filename": "src/tools/clippy/tests/ui/manual_map_option.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmanual_map_option.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmanual_map_option.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmanual_map_option.fixed?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -7,7 +7,7 @@\n     clippy::unit_arg,\n     clippy::match_ref_pats,\n     clippy::redundant_pattern_matching,\n-    clippy::for_loops_over_fallibles,\n+    for_loops_over_fallibles,\n     dead_code\n )]\n "}, {"sha": "325a6db06c4e53a533348d41462e81dff808e09d", "filename": "src/tools/clippy/tests/ui/manual_map_option.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmanual_map_option.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmanual_map_option.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmanual_map_option.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -7,7 +7,7 @@\n     clippy::unit_arg,\n     clippy::match_ref_pats,\n     clippy::redundant_pattern_matching,\n-    clippy::for_loops_over_fallibles,\n+    for_loops_over_fallibles,\n     dead_code\n )]\n "}, {"sha": "8beae8dee08542e993e40136bfe0404fe8b5ff13", "filename": "src/tools/clippy/tests/ui/rename.fixed", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.fixed?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -12,7 +12,7 @@\n #![allow(clippy::disallowed_methods)]\n #![allow(clippy::disallowed_types)]\n #![allow(clippy::mixed_read_write_in_expression)]\n-#![allow(clippy::for_loops_over_fallibles)]\n+#![allow(for_loops_over_fallibles)]\n #![allow(clippy::useless_conversion)]\n #![allow(clippy::match_result_ok)]\n #![allow(clippy::overly_complex_bool_expr)]\n@@ -45,8 +45,8 @@\n #![warn(clippy::disallowed_methods)]\n #![warn(clippy::disallowed_types)]\n #![warn(clippy::mixed_read_write_in_expression)]\n-#![warn(clippy::for_loops_over_fallibles)]\n-#![warn(clippy::for_loops_over_fallibles)]\n+#![warn(for_loops_over_fallibles)]\n+#![warn(for_loops_over_fallibles)]\n #![warn(clippy::useless_conversion)]\n #![warn(clippy::match_result_ok)]\n #![warn(clippy::overly_complex_bool_expr)]\n@@ -65,6 +65,7 @@\n #![warn(clippy::recursive_format_impl)]\n #![warn(clippy::invisible_characters)]\n #![warn(drop_bounds)]\n+#![warn(for_loops_over_fallibles)]\n #![warn(array_into_iter)]\n #![warn(invalid_atomic_ordering)]\n #![warn(invalid_value)]"}, {"sha": "9e665047baaeb93e8c779239a0e61aba8a8d41c9", "filename": "src/tools/clippy/tests/ui/rename.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.rs?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -12,7 +12,7 @@\n #![allow(clippy::disallowed_methods)]\n #![allow(clippy::disallowed_types)]\n #![allow(clippy::mixed_read_write_in_expression)]\n-#![allow(clippy::for_loops_over_fallibles)]\n+#![allow(for_loops_over_fallibles)]\n #![allow(clippy::useless_conversion)]\n #![allow(clippy::match_result_ok)]\n #![allow(clippy::overly_complex_bool_expr)]\n@@ -65,6 +65,7 @@\n #![warn(clippy::to_string_in_display)]\n #![warn(clippy::zero_width_space)]\n #![warn(clippy::drop_bounds)]\n+#![warn(clippy::for_loops_over_fallibles)]\n #![warn(clippy::into_iter_on_array)]\n #![warn(clippy::invalid_atomic_ordering)]\n #![warn(clippy::invalid_ref)]"}, {"sha": "63eb565185f07b31af72b755650758dcc6f5eeae", "filename": "src/tools/clippy/tests/ui/rename.stderr", "status": "modified", "additions": 20, "deletions": 14, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.stderr?ref=7e16f9f1eaea28e7fe2fc93319fdfcd4e1968c91", "patch": "@@ -54,17 +54,17 @@ error: lint `clippy::eval_order_dependence` has been renamed to `clippy::mixed_r\n LL | #![warn(clippy::eval_order_dependence)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::mixed_read_write_in_expression`\n \n-error: lint `clippy::for_loop_over_option` has been renamed to `clippy::for_loops_over_fallibles`\n+error: lint `clippy::for_loop_over_option` has been renamed to `for_loops_over_fallibles`\n   --> $DIR/rename.rs:48:9\n    |\n LL | #![warn(clippy::for_loop_over_option)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::for_loops_over_fallibles`\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n-error: lint `clippy::for_loop_over_result` has been renamed to `clippy::for_loops_over_fallibles`\n+error: lint `clippy::for_loop_over_result` has been renamed to `for_loops_over_fallibles`\n   --> $DIR/rename.rs:49:9\n    |\n LL | #![warn(clippy::for_loop_over_result)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::for_loops_over_fallibles`\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n error: lint `clippy::identity_conversion` has been renamed to `clippy::useless_conversion`\n   --> $DIR/rename.rs:50:9\n@@ -174,59 +174,65 @@ error: lint `clippy::drop_bounds` has been renamed to `drop_bounds`\n LL | #![warn(clippy::drop_bounds)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `drop_bounds`\n \n-error: lint `clippy::into_iter_on_array` has been renamed to `array_into_iter`\n+error: lint `clippy::for_loops_over_fallibles` has been renamed to `for_loops_over_fallibles`\n   --> $DIR/rename.rs:68:9\n    |\n+LL | #![warn(clippy::for_loops_over_fallibles)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n+\n+error: lint `clippy::into_iter_on_array` has been renamed to `array_into_iter`\n+  --> $DIR/rename.rs:69:9\n+   |\n LL | #![warn(clippy::into_iter_on_array)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `array_into_iter`\n \n error: lint `clippy::invalid_atomic_ordering` has been renamed to `invalid_atomic_ordering`\n-  --> $DIR/rename.rs:69:9\n+  --> $DIR/rename.rs:70:9\n    |\n LL | #![warn(clippy::invalid_atomic_ordering)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_atomic_ordering`\n \n error: lint `clippy::invalid_ref` has been renamed to `invalid_value`\n-  --> $DIR/rename.rs:70:9\n+  --> $DIR/rename.rs:71:9\n    |\n LL | #![warn(clippy::invalid_ref)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_value`\n \n error: lint `clippy::mem_discriminant_non_enum` has been renamed to `enum_intrinsics_non_enums`\n-  --> $DIR/rename.rs:71:9\n+  --> $DIR/rename.rs:72:9\n    |\n LL | #![warn(clippy::mem_discriminant_non_enum)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `enum_intrinsics_non_enums`\n \n error: lint `clippy::panic_params` has been renamed to `non_fmt_panics`\n-  --> $DIR/rename.rs:72:9\n+  --> $DIR/rename.rs:73:9\n    |\n LL | #![warn(clippy::panic_params)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `non_fmt_panics`\n \n error: lint `clippy::positional_named_format_parameters` has been renamed to `named_arguments_used_positionally`\n-  --> $DIR/rename.rs:73:9\n+  --> $DIR/rename.rs:74:9\n    |\n LL | #![warn(clippy::positional_named_format_parameters)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `named_arguments_used_positionally`\n \n error: lint `clippy::temporary_cstring_as_ptr` has been renamed to `temporary_cstring_as_ptr`\n-  --> $DIR/rename.rs:74:9\n+  --> $DIR/rename.rs:75:9\n    |\n LL | #![warn(clippy::temporary_cstring_as_ptr)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `temporary_cstring_as_ptr`\n \n error: lint `clippy::unknown_clippy_lints` has been renamed to `unknown_lints`\n-  --> $DIR/rename.rs:75:9\n+  --> $DIR/rename.rs:76:9\n    |\n LL | #![warn(clippy::unknown_clippy_lints)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `unknown_lints`\n \n error: lint `clippy::unused_label` has been renamed to `unused_labels`\n-  --> $DIR/rename.rs:76:9\n+  --> $DIR/rename.rs:77:9\n    |\n LL | #![warn(clippy::unused_label)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `unused_labels`\n \n-error: aborting due to 38 previous errors\n+error: aborting due to 39 previous errors\n "}]}