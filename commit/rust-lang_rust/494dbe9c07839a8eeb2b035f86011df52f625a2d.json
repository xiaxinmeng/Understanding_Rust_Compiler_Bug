{"sha": "494dbe9c07839a8eeb2b035f86011df52f625a2d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ5NGRiZTljMDc4MzlhOGVlYjJiMDM1Zjg2MDExZGY1MmY2MjVhMmQ=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-02-21T20:22:22Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-02-21T20:22:22Z"}, "message": "Rollup merge of #22516 - leejunseok:nonpub_field_sugg, r=jakub-\n\n  closes #22421", "tree": {"sha": "825a0542758469c54cf3ec349ea400cd2472bfff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/825a0542758469c54cf3ec349ea400cd2472bfff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/494dbe9c07839a8eeb2b035f86011df52f625a2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/494dbe9c07839a8eeb2b035f86011df52f625a2d", "html_url": "https://github.com/rust-lang/rust/commit/494dbe9c07839a8eeb2b035f86011df52f625a2d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/494dbe9c07839a8eeb2b035f86011df52f625a2d/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a95d7f53a7f80085c972adb996c6e10f705db4ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/a95d7f53a7f80085c972adb996c6e10f705db4ef", "html_url": "https://github.com/rust-lang/rust/commit/a95d7f53a7f80085c972adb996c6e10f705db4ef"}, {"sha": "9b67d07acc7573276a15dfcd9e4418bc3d838074", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b67d07acc7573276a15dfcd9e4418bc3d838074", "html_url": "https://github.com/rust-lang/rust/commit/9b67d07acc7573276a15dfcd9e4418bc3d838074"}], "stats": {"total": 42, "additions": 41, "deletions": 1}, "files": [{"sha": "0430954ad7e2f9612e9482636956ca01b4bb5cb2", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/494dbe9c07839a8eeb2b035f86011df52f625a2d/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/494dbe9c07839a8eeb2b035f86011df52f625a2d/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=494dbe9c07839a8eeb2b035f86011df52f625a2d", "patch": "@@ -117,7 +117,7 @@ use std::iter::repeat;\n use std::slice;\n use syntax::{self, abi, attr};\n use syntax::attr::AttrMetaMethods;\n-use syntax::ast::{self, ProvidedMethod, RequiredMethod, TypeTraitItem, DefId};\n+use syntax::ast::{self, ProvidedMethod, RequiredMethod, TypeTraitItem, DefId, Visibility};\n use syntax::ast_util::{self, local_def, PostExpansionMethod};\n use syntax::codemap::{self, Span};\n use syntax::owned_slice::OwnedSlice;\n@@ -3117,6 +3117,10 @@ fn check_expr_with_unifier<'a, 'tcx, F>(fcx: &FnCtxt<'a, 'tcx>,\n             if skip.iter().any(|&x| x == n) {\n                 continue;\n             }\n+            // ignore private fields from non-local crates\n+            if id.krate != ast::LOCAL_CRATE && elem.vis != Visibility::Public {\n+                continue;\n+            }\n             let dist = lev_distance(n, name);\n             if dist < best_dist {\n                 best = Some(n);"}, {"sha": "30648498ba88589db46d0e9b2b89a268083de59e", "filename": "src/test/compile-fail/suggest-private-fields.rs", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/494dbe9c07839a8eeb2b035f86011df52f625a2d/src%2Ftest%2Fcompile-fail%2Fsuggest-private-fields.rs", "raw_url": "https://github.com/rust-lang/rust/raw/494dbe9c07839a8eeb2b035f86011df52f625a2d/src%2Ftest%2Fcompile-fail%2Fsuggest-private-fields.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fsuggest-private-fields.rs?ref=494dbe9c07839a8eeb2b035f86011df52f625a2d", "patch": "@@ -0,0 +1,36 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:struct-field-privacy.rs\n+\n+extern crate \"struct-field-privacy\" as xc;\n+\n+use xc::B;\n+\n+struct A {\n+    pub a: u32,\n+    b: u32,\n+}\n+\n+fn main () {\n+    // external crate struct\n+    let k = B {\n+        aa: 20, //~ ERROR structure `struct-field-privacy::B` has no field named `aa`\n+        //~^ HELP did you mean `a`?\n+        bb: 20, //~ ERROR structure `struct-field-privacy::B` has no field named `bb`\n+    };\n+    // local crate struct\n+    let l = A {\n+        aa: 20, //~ ERROR structure `A` has no field named `aa`\n+        //~^ HELP did you mean `a`?\n+        bb: 20, //~ ERROR structure `A` has no field named `bb`\n+        //~^ HELP did you mean `b`?\n+    };\n+}"}]}