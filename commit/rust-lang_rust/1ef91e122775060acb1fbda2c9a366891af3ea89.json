{"sha": "1ef91e122775060acb1fbda2c9a366891af3ea89", "node_id": "C_kwDOAAsO6NoAKDFlZjkxZTEyMjc3NTA2MGFjYjFmYmRhMmM5YTM2Njg5MWFmM2VhODk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-16T12:42:58Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-16T12:42:58Z"}, "message": "Auto merge of #2064 - RalfJung:rustup, r=RalfJung\n\nrustup", "tree": {"sha": "3f25569114c432371d875b912f4855d7b3886cfb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3f25569114c432371d875b912f4855d7b3886cfb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ef91e122775060acb1fbda2c9a366891af3ea89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ef91e122775060acb1fbda2c9a366891af3ea89", "html_url": "https://github.com/rust-lang/rust/commit/1ef91e122775060acb1fbda2c9a366891af3ea89", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ef91e122775060acb1fbda2c9a366891af3ea89/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05bbfe84a9fd93a2c1afe1d6caff8927c69edcd8", "url": "https://api.github.com/repos/rust-lang/rust/commits/05bbfe84a9fd93a2c1afe1d6caff8927c69edcd8", "html_url": "https://github.com/rust-lang/rust/commit/05bbfe84a9fd93a2c1afe1d6caff8927c69edcd8"}, {"sha": "0669b227596969c1c2f6b6315d1d05e1f4c6a60d", "url": "https://api.github.com/repos/rust-lang/rust/commits/0669b227596969c1c2f6b6315d1d05e1f4c6a60d", "html_url": "https://github.com/rust-lang/rust/commit/0669b227596969c1c2f6b6315d1d05e1f4c6a60d"}], "stats": {"total": 24, "additions": 19, "deletions": 5}, "files": [{"sha": "d476da0baaf87e511229e2a71eae600849c9a4cc", "filename": "rust-version", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ef91e122775060acb1fbda2c9a366891af3ea89/rust-version", "raw_url": "https://github.com/rust-lang/rust/raw/1ef91e122775060acb1fbda2c9a366891af3ea89/rust-version", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-version?ref=1ef91e122775060acb1fbda2c9a366891af3ea89", "patch": "@@ -1 +1 @@\n-7af93292c27cd8b4a14f0f35bcb4c7e7ca9c287a\n+c8422403f775126c40d558838d321c063554c822"}, {"sha": "1b69be5153b061dc0dfa2cce86c881fa8a3094cb", "filename": "src/shims/intrinsics.rs", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/1ef91e122775060acb1fbda2c9a366891af3ea89/src%2Fshims%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ef91e122775060acb1fbda2c9a366891af3ea89/src%2Fshims%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fintrinsics.rs?ref=1ef91e122775060acb1fbda2c9a366891af3ea89", "patch": "@@ -437,7 +437,8 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n             | \"simd_fmax\"\n             | \"simd_fmin\"\n             | \"simd_saturating_add\"\n-            | \"simd_saturating_sub\" => {\n+            | \"simd_saturating_sub\"\n+            | \"simd_arith_offset\" => {\n                 use mir::BinOp;\n \n                 let &[ref left, ref right] = check_arg_count(args)?;\n@@ -453,6 +454,7 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                     SaturatingOp(BinOp),\n                     FMax,\n                     FMin,\n+                    WrappingOffset,\n                 }\n                 let which = match intrinsic_name {\n                     \"simd_add\" => Op::MirOp(BinOp::Add),\n@@ -475,6 +477,7 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                     \"simd_fmin\" => Op::FMin,\n                     \"simd_saturating_add\" => Op::SaturatingOp(BinOp::Add),\n                     \"simd_saturating_sub\" => Op::SaturatingOp(BinOp::Sub),\n+                    \"simd_arith_offset\" => Op::WrappingOffset,\n                     _ => unreachable!(),\n                 };\n \n@@ -504,15 +507,25 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                                 val\n                             }\n                         }\n+                        Op::SaturatingOp(mir_op) => {\n+                            this.saturating_arith(mir_op, &left, &right)?\n+                        }\n+                        Op::WrappingOffset => {\n+                            let ptr = this.scalar_to_ptr(left.to_scalar()?)?;\n+                            let offset_count = right.to_scalar()?.to_machine_isize(this)?;\n+                            let pointee_ty = left.layout.ty.builtin_deref(true).unwrap().ty;\n+\n+                            let pointee_size = i64::try_from(this.layout_of(pointee_ty)?.size.bytes()).unwrap();\n+                            let offset_bytes = offset_count.wrapping_mul(pointee_size);\n+                            let offset_ptr = ptr.wrapping_signed_offset(offset_bytes, this);\n+                            Scalar::from_maybe_pointer(offset_ptr, this)\n+                        }\n                         Op::FMax => {\n                             fmax_op(&left, &right)?\n                         }\n                         Op::FMin => {\n                             fmin_op(&left, &right)?\n                         }\n-                        Op::SaturatingOp(mir_op) => {\n-                            this.saturating_arith(mir_op, &left, &right)?\n-                        }\n                     };\n                     this.write_scalar(val, &dest.into())?;\n                 }"}, {"sha": "3e43595c94aee8141910a12f602a7098b9c6301f", "filename": "tests/run-pass/portable-simd.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ef91e122775060acb1fbda2c9a366891af3ea89/tests%2Frun-pass%2Fportable-simd.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ef91e122775060acb1fbda2c9a366891af3ea89/tests%2Frun-pass%2Fportable-simd.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fportable-simd.rs?ref=1ef91e122775060acb1fbda2c9a366891af3ea89", "patch": "@@ -1,3 +1,4 @@\n+// compile-flags: -Zmiri-strict-provenance\n #![feature(portable_simd, platform_intrinsics)]\n use std::simd::*;\n "}]}