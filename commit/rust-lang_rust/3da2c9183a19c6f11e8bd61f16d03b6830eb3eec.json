{"sha": "3da2c9183a19c6f11e8bd61f16d03b6830eb3eec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkYTJjOTE4M2ExOWM2ZjExZThiZDYxZjE2ZDAzYjY4MzBlYjNlZWM=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-11T10:10:54Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-14T13:37:56Z"}, "message": "Save Lint::module as full path of module", "tree": {"sha": "97c36ee8a8b13adc3a8e297628ec90f150a2c30e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/97c36ee8a8b13adc3a8e297628ec90f150a2c30e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3da2c9183a19c6f11e8bd61f16d03b6830eb3eec", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl5GorQACgkQaTCGhp1Q\nZjfsyw//RE9YqosA+tila5kc3349pOtydhh+BFrpKhF/Z75xFHxd8Vo4ptcs6DcJ\nROaLF2YWi8TUvvQWy8N5EPflzPurJ9Q1dqVk6xpkQpwh9K3wqwwrlNsrOmzmya5G\nxs5g8TjQSFQaWABRZAL9IKJSahqZfdUBLrtrHcv36tVwtBKqDeDrZ98tAKCsYFPF\n+uokkt/W45t6j3dG0SkJitZoekuC1oC28OtZegEowXS+Iu9HvV6NLcqV2OUdgs9m\nGvcKOGyvcM2cV12bentNU8g5Ui1a0JKY5AnldVFBfL/M09aHocP2OqqBbgrBpEUl\nqZjivn5+U4+p9znig7XmPLkXnbuFCtq+lsf5nfsfohO9ay8ycTVnEJymWhNCKQx5\ntVrT7fCiGKk6f1CfeZyUMGmp+mL1i5PIBOfHjZOmjlTZY/cyBl2QqlSSJ0Rac+4J\n5QA7XEV73GiVKRPZuUMgP9Sv1w/0SpYEtBMWPbCfzhhgUqurbpJZ8wwpFdTz/jSm\nbgC0vKdSs7tKKZZPYA0a+7pT8GXniTg4Ax7741HkLLlNC2aGR08F/UsujJD4AOh/\nIZ6erOVCbMBsVqXwxkR11sL1J3+CkgpvQ2YlVBVyontvjYBiaNRvXUZCAt60nodQ\n6sj2jL9N3a/f6UxBiDd6c7i1bH41W/v6uONKiafF4/KLqpHcFEY=\n=6CGc\n-----END PGP SIGNATURE-----", "payload": "tree 97c36ee8a8b13adc3a8e297628ec90f150a2c30e\nparent 560559bafe1d61bca3d815ce80c53ae2d48e1829\nauthor flip1995 <hello@philkrones.com> 1581415854 +0100\ncommitter flip1995 <hello@philkrones.com> 1581687476 +0100\n\nSave Lint::module as full path of module\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3da2c9183a19c6f11e8bd61f16d03b6830eb3eec", "html_url": "https://github.com/rust-lang/rust/commit/3da2c9183a19c6f11e8bd61f16d03b6830eb3eec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3da2c9183a19c6f11e8bd61f16d03b6830eb3eec/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "560559bafe1d61bca3d815ce80c53ae2d48e1829", "url": "https://api.github.com/repos/rust-lang/rust/commits/560559bafe1d61bca3d815ce80c53ae2d48e1829", "html_url": "https://github.com/rust-lang/rust/commit/560559bafe1d61bca3d815ce80c53ae2d48e1829"}], "stats": {"total": 31, "additions": 18, "deletions": 13}, "files": [{"sha": "042ce9bc009b9e65f55b9df69f2b0dd81a75ebbd", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 18, "deletions": 13, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/3da2c9183a19c6f11e8bd61f16d03b6830eb3eec/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3da2c9183a19c6f11e8bd61f16d03b6830eb3eec/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=3da2c9183a19c6f11e8bd61f16d03b6830eb3eec", "patch": "@@ -170,29 +170,34 @@ pub fn gather_all() -> impl Iterator<Item = Lint> {\n \n fn gather_from_file(dir_entry: &walkdir::DirEntry) -> impl Iterator<Item = Lint> {\n     let content = fs::read_to_string(dir_entry.path()).unwrap();\n-    let mut filename = dir_entry.path().file_stem().unwrap().to_str().unwrap();\n+    let path = dir_entry.path();\n+    let filename = path.file_stem().unwrap();\n+    let path_buf = path.with_file_name(filename);\n+    let mut rel_path = path_buf\n+        .strip_prefix(clippy_project_root().join(\"clippy_lints/src\"))\n+        .expect(\"only files in `clippy_lints/src` should be looked at\");\n     // If the lints are stored in mod.rs, we get the module name from\n     // the containing directory:\n     if filename == \"mod\" {\n-        filename = dir_entry\n-            .path()\n-            .parent()\n-            .unwrap()\n-            .file_stem()\n-            .unwrap()\n-            .to_str()\n-            .unwrap()\n+        rel_path = rel_path.parent().unwrap();\n     }\n-    parse_contents(&content, filename)\n+\n+    let module = rel_path\n+        .components()\n+        .map(|c| c.as_os_str().to_str().unwrap())\n+        .collect::<Vec<_>>()\n+        .join(\"::\");\n+\n+    parse_contents(&content, &module)\n }\n \n-fn parse_contents(content: &str, filename: &str) -> impl Iterator<Item = Lint> {\n+fn parse_contents(content: &str, module: &str) -> impl Iterator<Item = Lint> {\n     let lints = DEC_CLIPPY_LINT_RE\n         .captures_iter(content)\n-        .map(|m| Lint::new(&m[\"name\"], &m[\"cat\"], &m[\"desc\"], None, filename));\n+        .map(|m| Lint::new(&m[\"name\"], &m[\"cat\"], &m[\"desc\"], None, module));\n     let deprecated = DEC_DEPRECATED_LINT_RE\n         .captures_iter(content)\n-        .map(|m| Lint::new(&m[\"name\"], \"Deprecated\", &m[\"desc\"], Some(&m[\"desc\"]), filename));\n+        .map(|m| Lint::new(&m[\"name\"], \"Deprecated\", &m[\"desc\"], Some(&m[\"desc\"]), module));\n     // Removing the `.collect::<Vec<Lint>>().into_iter()` causes some lifetime issues due to the map\n     lints.chain(deprecated).collect::<Vec<Lint>>().into_iter()\n }"}]}