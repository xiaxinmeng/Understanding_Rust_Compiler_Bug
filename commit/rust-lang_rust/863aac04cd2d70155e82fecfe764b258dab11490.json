{"sha": "863aac04cd2d70155e82fecfe764b258dab11490", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2M2FhYzA0Y2QyZDcwMTU1ZTgyZmVjZmU3NjRiMjU4ZGFiMTE0OTA=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-08-13T13:30:08Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-08-15T02:10:21Z"}, "message": "ported lang_items from oldvisit to <V:Visitor> trait.", "tree": {"sha": "234ecab9e0a46ed67fe0d837b0988c5bc6152355", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/234ecab9e0a46ed67fe0d837b0988c5bc6152355"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/863aac04cd2d70155e82fecfe764b258dab11490", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/863aac04cd2d70155e82fecfe764b258dab11490", "html_url": "https://github.com/rust-lang/rust/commit/863aac04cd2d70155e82fecfe764b258dab11490", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/863aac04cd2d70155e82fecfe764b258dab11490/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c802a68d195f39f9452a03b0e491c7a338fdcca", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c802a68d195f39f9452a03b0e491c7a338fdcca", "html_url": "https://github.com/rust-lang/rust/commit/5c802a68d195f39f9452a03b0e491c7a338fdcca"}], "stats": {"total": 41, "additions": 26, "deletions": 15}, "files": [{"sha": "18af303f239a3fce42f6b65d1a0c51e27a9255cf", "filename": "src/librustc/middle/lang_items.rs", "status": "modified", "additions": 26, "deletions": 15, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/863aac04cd2d70155e82fecfe764b258dab11490/src%2Flibrustc%2Fmiddle%2Flang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/863aac04cd2d70155e82fecfe764b258dab11490/src%2Flibrustc%2Fmiddle%2Flang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flang_items.rs?ref=863aac04cd2d70155e82fecfe764b258dab11490", "patch": "@@ -26,8 +26,9 @@ use metadata::cstore::iter_crate_data;\n use syntax::ast::{Crate, def_id, MetaItem};\n use syntax::ast_util::local_def;\n use syntax::attr::AttrMetaMethods;\n-use syntax::oldvisit::{default_simple_visitor, mk_simple_visitor};\n-use syntax::oldvisit::{SimpleVisitor, visit_crate};\n+use syntax::ast::{item};\n+use syntax::visit;\n+use syntax::visit::Visitor;\n \n use std::hashmap::HashMap;\n \n@@ -297,6 +298,27 @@ struct LanguageItemCollector<'self> {\n     item_refs: HashMap<@str, uint>,\n }\n \n+struct LanguageItemVisitor<'self> {\n+    this: *mut LanguageItemCollector<'self>,\n+}\n+\n+impl<'self> Visitor<()> for LanguageItemVisitor<'self> {\n+\n+    fn visit_item(&mut self, item:@item, _:()) {\n+\n+                for attribute in item.attrs.iter() {\n+                    unsafe {\n+                        (*self.this).match_and_collect_meta_item(\n+                            local_def(item.id),\n+                            attribute.node.value\n+                        );\n+                    }\n+                }\n+\n+        visit::walk_item(self, item, ());\n+    }\n+}\n+\n impl<'self> LanguageItemCollector<'self> {\n     pub fn new<'a>(crate: &'a Crate, session: Session)\n                    -> LanguageItemCollector<'a> {\n@@ -410,19 +432,8 @@ impl<'self> LanguageItemCollector<'self> {\n \n     pub fn collect_local_language_items(&mut self) {\n         let this: *mut LanguageItemCollector = &mut *self;\n-        visit_crate(self.crate, ((), mk_simple_visitor(@SimpleVisitor {\n-            visit_item: |item| {\n-                for attribute in item.attrs.iter() {\n-                    unsafe {\n-                        (*this).match_and_collect_meta_item(\n-                            local_def(item.id),\n-                            attribute.node.value\n-                        );\n-                    }\n-                }\n-            },\n-            .. *default_simple_visitor()\n-        })));\n+        let mut v = LanguageItemVisitor { this: this };\n+        visit::walk_crate(&mut v, self.crate, ());\n     }\n \n     pub fn collect_external_language_items(&mut self) {"}]}