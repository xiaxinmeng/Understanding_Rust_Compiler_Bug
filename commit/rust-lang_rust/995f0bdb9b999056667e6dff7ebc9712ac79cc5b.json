{"sha": "995f0bdb9b999056667e6dff7ebc9712ac79cc5b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5NWYwYmRiOWI5OTkwNTY2NjdlNmRmZjdlYmM5NzEyYWM3OWNjNWI=", "commit": {"author": {"name": "MaulingMonkey", "email": "git@maulingmonkey.com", "date": "2017-09-11T02:37:59Z"}, "committer": {"name": "MaulingMonkey", "email": "git@maulingmonkey.com", "date": "2017-09-16T05:16:18Z"}, "message": "Skip passing /natvis to lld-link until supported.\n\nLLVM 5.0.0's lld-link frontend errors out if passed /natvis.\nLLVM 6 (maybe earlier?) should at least ignore the flag.\nHopefully LLVM will eventually support the flag, at which point\nthis workaround can perhaps be simply removed, if 6? is old enough.", "tree": {"sha": "15bf9616e3781b225dc00977c491aa50f34fa106", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/15bf9616e3781b225dc00977c491aa50f34fa106"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/995f0bdb9b999056667e6dff7ebc9712ac79cc5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/995f0bdb9b999056667e6dff7ebc9712ac79cc5b", "html_url": "https://github.com/rust-lang/rust/commit/995f0bdb9b999056667e6dff7ebc9712ac79cc5b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/995f0bdb9b999056667e6dff7ebc9712ac79cc5b/comments", "author": {"login": "MaulingMonkey", "id": 75894, "node_id": "MDQ6VXNlcjc1ODk0", "avatar_url": "https://avatars.githubusercontent.com/u/75894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MaulingMonkey", "html_url": "https://github.com/MaulingMonkey", "followers_url": "https://api.github.com/users/MaulingMonkey/followers", "following_url": "https://api.github.com/users/MaulingMonkey/following{/other_user}", "gists_url": "https://api.github.com/users/MaulingMonkey/gists{/gist_id}", "starred_url": "https://api.github.com/users/MaulingMonkey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MaulingMonkey/subscriptions", "organizations_url": "https://api.github.com/users/MaulingMonkey/orgs", "repos_url": "https://api.github.com/users/MaulingMonkey/repos", "events_url": "https://api.github.com/users/MaulingMonkey/events{/privacy}", "received_events_url": "https://api.github.com/users/MaulingMonkey/received_events", "type": "User", "site_admin": false}, "committer": {"login": "MaulingMonkey", "id": 75894, "node_id": "MDQ6VXNlcjc1ODk0", "avatar_url": "https://avatars.githubusercontent.com/u/75894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MaulingMonkey", "html_url": "https://github.com/MaulingMonkey", "followers_url": "https://api.github.com/users/MaulingMonkey/followers", "following_url": "https://api.github.com/users/MaulingMonkey/following{/other_user}", "gists_url": "https://api.github.com/users/MaulingMonkey/gists{/gist_id}", "starred_url": "https://api.github.com/users/MaulingMonkey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MaulingMonkey/subscriptions", "organizations_url": "https://api.github.com/users/MaulingMonkey/orgs", "repos_url": "https://api.github.com/users/MaulingMonkey/repos", "events_url": "https://api.github.com/users/MaulingMonkey/events{/privacy}", "received_events_url": "https://api.github.com/users/MaulingMonkey/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11f64d8f881a8bd994210efc1d3ff1982abf9df3", "url": "https://api.github.com/repos/rust-lang/rust/commits/11f64d8f881a8bd994210efc1d3ff1982abf9df3", "html_url": "https://github.com/rust-lang/rust/commit/11f64d8f881a8bd994210efc1d3ff1982abf9df3"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "de2b5905d6f785bf11d330c5d19e12e7d723a6d8", "filename": "src/librustc_trans/back/linker.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/995f0bdb9b999056667e6dff7ebc9712ac79cc5b/src%2Flibrustc_trans%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/995f0bdb9b999056667e6dff7ebc9712ac79cc5b/src%2Flibrustc_trans%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flinker.rs?ref=995f0bdb9b999056667e6dff7ebc9712ac79cc5b", "patch": "@@ -498,6 +498,18 @@ impl<'a> Linker for MsvcLinker<'a> {\n         let sysroot = self.sess.sysroot();\n         let natvis_dir_path = sysroot.join(\"lib\\\\rustlib\\\\etc\");\n         if let Ok(natvis_dir) = fs::read_dir(&natvis_dir_path) {\n+            // LLVM 5.0.0's lld-link frontend doesn't yet recognize, and chokes\n+            // on, the /NATVIS:... flags.  LLVM 6 (or earlier) should at worst ignore\n+            // them, eventually mooting this workaround, per this landed patch:\n+            // https://github.com/llvm-mirror/lld/commit/27b9c4285364d8d76bb43839daa100\n+            if let Some(ref linker_path) = self.sess.opts.cg.linker {\n+                if let Some(linker_name) = Path::new(&linker_path).file_stem() {\n+                    if linker_name.to_str().unwrap().to_lowercase() == \"lld-link\" {\n+                        self.sess.warn(\"not embedding natvis: lld-link may not support the flag\");\n+                        return;\n+                    }\n+                }\n+            }\n             for entry in natvis_dir {\n                 match entry {\n                     Ok(entry) => {"}]}