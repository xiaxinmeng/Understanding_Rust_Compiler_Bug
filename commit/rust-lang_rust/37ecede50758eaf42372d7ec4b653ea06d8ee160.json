{"sha": "37ecede50758eaf42372d7ec4b653ea06d8ee160", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3ZWNlZGU1MDc1OGVhZjQyMzcyZDdlYzRiNjUzZWEwNmQ4ZWUxNjA=", "commit": {"author": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2021-05-19T02:35:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-19T02:35:59Z"}, "message": "Rollup merge of #84883 - durin42:allow-unused-prefixes, r=nikic\n\ncompiletest: \"fix\" FileCheck with --allow-unused-prefixes\n\nThe default of --allow-unused-prefixes used to be false, but in LLVM\nchange 87dbdd2e3b (https://reviews.llvm.org/D95849) the default became\ntrue. I'm not quite sure how we could do better here (specifically not\nproviding the CHECK prefix when it's not needed), but this seems to work\nfor now.\n\nThis reduces codegen test failures against LLVM HEAD from 31 cases to 5.", "tree": {"sha": "d99e0c58e643e663d0411900b23d5dfeb061db6a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d99e0c58e643e663d0411900b23d5dfeb061db6a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37ecede50758eaf42372d7ec4b653ea06d8ee160", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgpHmSCRBK7hj4Ov3rIwAAxpsIAJ48/TMWGH3A8xjlvvJyV9Xk\nuJJp4HKe6C3hjDH9XOMmxb7FUtgyChhSEdD+GC/6bFhLZ2W9QzqXcGZ0HbnoEdXd\nB29n8tvcVRCCHGJ7Rqw3yQzdMFaJyxyWJ09DIpILzxBTEZ9KCpRlAIDTV/Ay3rYM\nhWXB2gokA7zMCONZNw4Sys1Mlr4bWM8YfKkEuJQPNwwdIaxGYPZ5IxNUR5bQ5TA4\n/8bWjPaNySL0rhFy2s/zWxTLbouDjiOkVAHlOk+z4iRpNSFuEhW9zO4kb5114xDq\noI2tEHtZGxEv97a9mR9CfR6Nfkz2yIOzK5jm1WzCI0ycfKa+QmHSpXlP4kqEt/Y=\n=Okek\n-----END PGP SIGNATURE-----\n", "payload": "tree d99e0c58e643e663d0411900b23d5dfeb061db6a\nparent 809e975bbf3afdab0552519d75e91d18077626ce\nparent 3035816fc13c2ae30d46849bfcceec085a2f47e2\nauthor Jack Huey <31162821+jackh726@users.noreply.github.com> 1621391759 -0400\ncommitter GitHub <noreply@github.com> 1621391759 -0400\n\nRollup merge of #84883 - durin42:allow-unused-prefixes, r=nikic\n\ncompiletest: \"fix\" FileCheck with --allow-unused-prefixes\n\nThe default of --allow-unused-prefixes used to be false, but in LLVM\nchange 87dbdd2e3b (https://reviews.llvm.org/D95849) the default became\ntrue. I'm not quite sure how we could do better here (specifically not\nproviding the CHECK prefix when it's not needed), but this seems to work\nfor now.\n\nThis reduces codegen test failures against LLVM HEAD from 31 cases to 5.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37ecede50758eaf42372d7ec4b653ea06d8ee160", "html_url": "https://github.com/rust-lang/rust/commit/37ecede50758eaf42372d7ec4b653ea06d8ee160", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37ecede50758eaf42372d7ec4b653ea06d8ee160/comments", "author": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "809e975bbf3afdab0552519d75e91d18077626ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/809e975bbf3afdab0552519d75e91d18077626ce", "html_url": "https://github.com/rust-lang/rust/commit/809e975bbf3afdab0552519d75e91d18077626ce"}, {"sha": "3035816fc13c2ae30d46849bfcceec085a2f47e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/3035816fc13c2ae30d46849bfcceec085a2f47e2", "html_url": "https://github.com/rust-lang/rust/commit/3035816fc13c2ae30d46849bfcceec085a2f47e2"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "54b079a3e861057422fe1e075d786b2c10517385", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/37ecede50758eaf42372d7ec4b653ea06d8ee160/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37ecede50758eaf42372d7ec4b653ea06d8ee160/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=37ecede50758eaf42372d7ec4b653ea06d8ee160", "patch": "@@ -2327,7 +2327,11 @@ impl<'test> TestCx<'test> {\n         // For now, though\u2026\n         if let Some(rev) = self.revision {\n             let prefixes = format!(\"CHECK,{}\", rev);\n-            filecheck.args(&[\"--check-prefixes\", &prefixes]);\n+            if self.config.llvm_version.unwrap_or(0) >= 130000 {\n+                filecheck.args(&[\"--allow-unused-prefixes\", \"--check-prefixes\", &prefixes]);\n+            } else {\n+                filecheck.args(&[\"--check-prefixes\", &prefixes]);\n+            }\n         }\n         self.compose_and_run(filecheck, \"\", None, None)\n     }"}]}