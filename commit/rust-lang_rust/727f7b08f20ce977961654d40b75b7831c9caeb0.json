{"sha": "727f7b08f20ce977961654d40b75b7831c9caeb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcyN2Y3YjA4ZjIwY2U5Nzc5NjE2NTRkNDBiNzViNzgzMWM5Y2FlYjA=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2018-01-10T08:17:18Z"}, "committer": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2018-01-10T08:17:18Z"}, "message": "Fix error message printing wrong file names\n\nThe error messsages from `self_test` does not display correct file names\n(it just prints `src/lib.rs` for every file). This commit fixes it.", "tree": {"sha": "11a909f91042ee5e774521d202b25e688abd481f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/11a909f91042ee5e774521d202b25e688abd481f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/727f7b08f20ce977961654d40b75b7831c9caeb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/727f7b08f20ce977961654d40b75b7831c9caeb0", "html_url": "https://github.com/rust-lang/rust/commit/727f7b08f20ce977961654d40b75b7831c9caeb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/727f7b08f20ce977961654d40b75b7831c9caeb0/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cb0b366b381e4268ce9ce4f1669c2745af01f17e", "url": "https://api.github.com/repos/rust-lang/rust/commits/cb0b366b381e4268ce9ce4f1669c2745af01f17e", "html_url": "https://github.com/rust-lang/rust/commit/cb0b366b381e4268ce9ce4f1669c2745af01f17e"}], "stats": {"total": 20, "additions": 11, "deletions": 9}, "files": [{"sha": "316d60b7ec6d0368d55ec0d1a9cb94a43a824ae5", "filename": "tests/system.rs", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/727f7b08f20ce977961654d40b75b7831c9caeb0/tests%2Fsystem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/727f7b08f20ce977961654d40b75b7831c9caeb0/tests%2Fsystem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsystem.rs?ref=727f7b08f20ce977961654d40b75b7831c9caeb0", "patch": "@@ -166,7 +166,7 @@ fn assert_output(source: &Path, expected_filename: &Path) {\n     if !compare.is_empty() {\n         let mut failures = HashMap::new();\n         failures.insert(source.to_owned(), compare);\n-        print_mismatches_default_message(failures, source.display());\n+        print_mismatches_default_message(failures);\n         assert!(false, \"Text does not match expected output\");\n     }\n }\n@@ -281,7 +281,7 @@ fn check_files(files: Vec<PathBuf>) -> (Vec<FormatReport>, u32, u32) {\n             Ok(report) => reports.push(report),\n             Err(err) => {\n                 if let IdempotentCheckError::Mismatch(msg) = err {\n-                    print_mismatches_default_message(msg, file_name.display());\n+                    print_mismatches_default_message(msg);\n                 }\n                 fails += 1;\n             }\n@@ -293,13 +293,15 @@ fn check_files(files: Vec<PathBuf>) -> (Vec<FormatReport>, u32, u32) {\n     (reports, count, fails)\n }\n \n-fn print_mismatches_default_message(\n-    result: HashMap<PathBuf, Vec<Mismatch>>,\n-    file_name: std::path::Display,\n-) {\n-    print_mismatches(result, |line_num| {\n-        format!(\"\\nMismatch at {}:{}:\", file_name, line_num)\n-    });\n+fn print_mismatches_default_message(result: HashMap<PathBuf, Vec<Mismatch>>) {\n+    let mut t = term::stdout().unwrap();\n+    for (file_name, diff) in result {\n+        let mismatch_msg_formatter =\n+            |line_num| format!(\"\\nMismatch at {}:{}:\", file_name.display(), line_num);\n+        print_diff(diff, &mismatch_msg_formatter, Color::Auto);\n+    }\n+\n+    t.reset().unwrap();\n }\n \n fn print_mismatches<T: Fn(u32) -> String>("}]}