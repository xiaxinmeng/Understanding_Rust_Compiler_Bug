{"sha": "1954756aa53d03e59e40669eaa47a15d8497c352", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5NTQ3NTZhYTUzZDAzZTU5ZTQwNjY5ZWFhNDdhMTVkODQ5N2MzNTI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-17T21:13:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-17T21:13:51Z"}, "message": "Auto merge of #80122 - davidtwco:revert-76030, r=oli-obk\n\nRevert \"cg_llvm: `fewer_names` in `uncached_llvm_type`\"\n\nFixes #76213 and fixes #79564.\n\nThis PR temporarily reverts commit fa01ce802f1b403a2140fd945b43af86ec3998a1 from #76030 to until the root issue can be resolved. Requested [in t-compiler meeting](https://rust-lang.zulipchat.com/#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bweekly.20meeting.5D.202020-12-17.20.2354818/near/220261541).\n\n*Note*: I was seeing some failing debuginfo-gdb tests locally but I wasn't sure if they were spurious.", "tree": {"sha": "c2ce5046320e43c9a95162e7a608c9658a29b870", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2ce5046320e43c9a95162e7a608c9658a29b870"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1954756aa53d03e59e40669eaa47a15d8497c352", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1954756aa53d03e59e40669eaa47a15d8497c352", "html_url": "https://github.com/rust-lang/rust/commit/1954756aa53d03e59e40669eaa47a15d8497c352", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1954756aa53d03e59e40669eaa47a15d8497c352/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb4fc71dc9024f15a0c9cc44bcc10c861e9d585e", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb4fc71dc9024f15a0c9cc44bcc10c861e9d585e", "html_url": "https://github.com/rust-lang/rust/commit/eb4fc71dc9024f15a0c9cc44bcc10c861e9d585e"}, {"sha": "88dc58fc9bb3dddccb99fc0e9f7a917c2052f8d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/88dc58fc9bb3dddccb99fc0e9f7a917c2052f8d0", "html_url": "https://github.com/rust-lang/rust/commit/88dc58fc9bb3dddccb99fc0e9f7a917c2052f8d0"}], "stats": {"total": 13, "additions": 3, "deletions": 10}, "files": [{"sha": "0876907e1194b27e3b69c1bb0de0d12beb264970", "filename": "compiler/rustc_codegen_llvm/src/type_of.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1954756aa53d03e59e40669eaa47a15d8497c352/compiler%2Frustc_codegen_llvm%2Fsrc%2Ftype_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1954756aa53d03e59e40669eaa47a15d8497c352/compiler%2Frustc_codegen_llvm%2Fsrc%2Ftype_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Ftype_of.rs?ref=1954756aa53d03e59e40669eaa47a15d8497c352", "patch": "@@ -40,9 +40,7 @@ fn uncached_llvm_type<'a, 'tcx>(\n         // FIXME(eddyb) producing readable type names for trait objects can result\n         // in problematically distinct types due to HRTB and subtyping (see #47638).\n         // ty::Dynamic(..) |\n-        ty::Adt(..) | ty::Closure(..) | ty::Foreign(..) | ty::Generator(..) | ty::Str\n-            if !cx.sess().fewer_names() =>\n-        {\n+        ty::Adt(..) | ty::Closure(..) | ty::Foreign(..) | ty::Generator(..) | ty::Str => {\n             let mut name = with_no_trimmed_paths(|| layout.ty.to_string());\n             if let (&ty::Adt(def, _), &Variants::Single { index }) =\n                 (layout.ty.kind(), &layout.variants)\n@@ -58,12 +56,6 @@ fn uncached_llvm_type<'a, 'tcx>(\n             }\n             Some(name)\n         }\n-        ty::Adt(..) => {\n-            // If `Some` is returned then a named struct is created in LLVM. Name collisions are\n-            // avoided by LLVM (with increasing suffixes). If rustc doesn't generate names then that\n-            // can improve perf.\n-            Some(String::new())\n-        }\n         _ => None,\n     };\n "}, {"sha": "c311de05a1cff1c4e6bcfea32053ad516217c6b7", "filename": "src/test/ui/issues/issue-75763.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1954756aa53d03e59e40669eaa47a15d8497c352/src%2Ftest%2Fui%2Fissues%2Fissue-75763.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1954756aa53d03e59e40669eaa47a15d8497c352/src%2Ftest%2Fui%2Fissues%2Fissue-75763.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-75763.rs?ref=1954756aa53d03e59e40669eaa47a15d8497c352", "patch": "@@ -1,4 +1,5 @@\n-// build-pass\n+// ignore-test\n+// FIXME(const_generics): This test causes an ICE after reverting #76030.\n \n #![allow(incomplete_features)]\n #![feature(const_generics)]"}]}