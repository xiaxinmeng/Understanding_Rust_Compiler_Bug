{"sha": "ee160f2f5e73b6f5954bc33f059c316d9e8582c4", "node_id": "C_kwDOAAsO6NoAKGVlMTYwZjJmNWU3M2I2ZjU5NTRiYzMzZjA1OWMzMTZkOWU4NTgyYzQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-23T20:50:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-23T20:50:23Z"}, "message": "Auto merge of #97120 - Kobzol:rustc-pgo-expansion, r=Mark-Simulacrum\n\nUpdate `rustc` PGO benchmark list\n\nI noticed that the `rustc` PGO crates do not contain any crate that would stress the trait system. I tried adding and removing various crates to the PGO benchmark list here. Here's what I found:\n\n- Removing [`externs` and `match-stress`](https://perf.rust-lang.org/compare.html?start=c0672870491e84362f76ddecd50fa229f9b06dff&end=b056963e0324fa76c721d79f12658a64cfa4cb5e&stat=instructions:u) regresses these two benchmarks by up to 15 % and removing them doesn't improve anything else, so we should keep them.\n- Adding [`keccak`](https://perf.rust-lang.org/compare.html?start=52cc7795245347500ddf6dc959cf58a7abe2d935&end=6fd27b23fd7860c79752479173b4a1b877cba490) regresses `diesel`, otherwise it doesn't do much.\n- Adding [`tt-muncher`](https://perf.rust-lang.org/compare.html?start=c0672870491e84362f76ddecd50fa229f9b06dff&end=2ab5994d9cdfb098344895f7d8d5aee3cf3d6eff&stat=instructions:u) improves it very slightly, not worth it to include it IMO.\n- Adding just [`diesel`](https://perf.rust-lang.org/compare.html?start=00755e4ca68f12ed200e921276788ab19975e85f&end=cd37706ad459ee8ddfda4631be71120cb7eda19d) improves it by up to 1.5 % and others crate slightly, but regresses `bitmaps`.\n- Adding [`bitmaps`](https://perf.rust-lang.org/compare.html?start=67a9bcb31b85e87cc8bb327022632e48a0ca64a8&end=0cd80ba74425e6614cd52c4ea2bf6b0191c6dbc4&stat=instructions:u) improves both it and diesel, no other regressions.\n- Adding [both](https://perf.rust-lang.org/compare.html?start=77972d2d0134fb597249b3b64dcf9510a790c34e&end=f968d7af511d750db96cfdc04f844fb017c079ce) `bitmaps` and `diesel` produces quite nice improvements and almost no regressions.\n- Adding [ucd](https://perf.rust-lang.org/compare.html?start=b5caa5a8421f84cb7664f999b7635801bcf3f96a&end=327cc09917311f65cf427e6c0bf5f7424af9fd05&stat=instructions:u) did not have a large effect on primary benchmarks.\n\nr? `@lqd`", "tree": {"sha": "f8906bf9a3e2b08875810c1219cb4227dd2852fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f8906bf9a3e2b08875810c1219cb4227dd2852fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee160f2f5e73b6f5954bc33f059c316d9e8582c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee160f2f5e73b6f5954bc33f059c316d9e8582c4", "html_url": "https://github.com/rust-lang/rust/commit/ee160f2f5e73b6f5954bc33f059c316d9e8582c4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee160f2f5e73b6f5954bc33f059c316d9e8582c4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "222c5724ecc922fe67815f428c19f82c129d9386", "url": "https://api.github.com/repos/rust-lang/rust/commits/222c5724ecc922fe67815f428c19f82c129d9386", "html_url": "https://github.com/rust-lang/rust/commit/222c5724ecc922fe67815f428c19f82c129d9386"}, {"sha": "a050d6bab1bf67d9cd595c5ddd09941514e15f69", "url": "https://api.github.com/repos/rust-lang/rust/commits/a050d6bab1bf67d9cd595c5ddd09941514e15f69", "html_url": "https://github.com/rust-lang/rust/commit/a050d6bab1bf67d9cd595c5ddd09941514e15f69"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "ab6c888030e1bf783f863aadcc2cbf695fce5876", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/Dockerfile", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ee160f2f5e73b6f5954bc33f059c316d9e8582c4/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ee160f2f5e73b6f5954bc33f059c316d9e8582c4/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile?ref=ee160f2f5e73b6f5954bc33f059c316d9e8582c4", "patch": "@@ -98,8 +98,8 @@ COPY host-x86_64/dist-x86_64-linux/build-clang.sh /tmp/\n RUN ./build-clang.sh\n ENV CC=clang CXX=clang++\n \n-# rustc-perf version from 2022-04-05\n-ENV PERF_COMMIT 04fccd80396f954b339c366e30221f4bd52c5e03\n+# rustc-perf version from 2022-05-18\n+ENV PERF_COMMIT f66cc8f3e04392b0e2fd811f21fd1ece6ebaded3\n RUN curl -LS -o perf.zip https://github.com/rust-lang/rustc-perf/archive/$PERF_COMMIT.zip && \\\n     unzip perf.zip && \\\n     mv rustc-perf-$PERF_COMMIT rustc-perf && \\"}, {"sha": "9b727947f6ad1c9d570a265926eefa2c77fb4b1f", "filename": "src/ci/pgo.sh", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ee160f2f5e73b6f5954bc33f059c316d9e8582c4/src%2Fci%2Fpgo.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ee160f2f5e73b6f5954bc33f059c316d9e8582c4/src%2Fci%2Fpgo.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fpgo.sh?ref=ee160f2f5e73b6f5954bc33f059c316d9e8582c4", "patch": "@@ -1,4 +1,5 @@\n #!/bin/bash\n+# ignore-tidy-linelength\n \n set -euxo pipefail\n \n@@ -87,7 +88,7 @@ python3 ../x.py build --target=$PGO_HOST --host=$PGO_HOST \\\n # That's why we override the profile path to include the PID. This will produce many more profiling\n # files, but the resulting profile will produce a slightly faster rustc binary.\n LLVM_PROFILE_FILE=/tmp/rustc-pgo/default_%m_%p.profraw gather_profiles \"Check,Debug,Opt\" \"All\" \\\n-  \"externs,ctfe-stress-4,cargo-0.60.0,token-stream-stress,match-stress,tuple-stress\"\n+\"externs,ctfe-stress-5,cargo-0.60.0,token-stream-stress,match-stress,tuple-stress,diesel-1.4.8,bitmaps-3.1.0\"\n \n # Merge the profile data we gathered\n ./build/$PGO_HOST/llvm/bin/llvm-profdata \\"}]}