{"sha": "f7c4a44149b4e3a683f5506929050f2b50117328", "node_id": "C_kwDOAAsO6NoAKGY3YzRhNDQxNDliNGUzYTY4M2Y1NTA2OTI5MDUwZjJiNTAxMTczMjg", "commit": {"author": {"name": "Yacin Tmimi", "email": "ytmimi@horizonmedia.com", "date": "2021-10-05T05:24:10Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2021-10-13T01:08:07Z"}, "message": "Adjust non-empty tuple struct span to start before fields\n\nResolves 5011\n\nTuple structs with visibility modifiers and comments before the first\nfield were incorrectly formatted. Comments would duplicate part of the\nvisibility modifier and struct name.\n\nWhen trying to parse the tuple fields the ``items::Context`` searches\nfor the opening '(', but because the visibility modifier introduces\nanother '(' -- for example ``pub(crate)`` -- the parsing gets messed up.\n\nNow the span is adjusted to start after the struct identifier, or after\nany generics. Adjusting the span in this way ensures that the\n``items::Contex`` will correctly find the tuple fields.", "tree": {"sha": "f3d8ec2d149bbabf47f12424fca4d62aca9551f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f3d8ec2d149bbabf47f12424fca4d62aca9551f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f7c4a44149b4e3a683f5506929050f2b50117328", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f7c4a44149b4e3a683f5506929050f2b50117328", "html_url": "https://github.com/rust-lang/rust/commit/f7c4a44149b4e3a683f5506929050f2b50117328", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f7c4a44149b4e3a683f5506929050f2b50117328/comments", "author": {"login": "ytmimi", "id": 29028348, "node_id": "MDQ6VXNlcjI5MDI4MzQ4", "avatar_url": "https://avatars.githubusercontent.com/u/29028348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ytmimi", "html_url": "https://github.com/ytmimi", "followers_url": "https://api.github.com/users/ytmimi/followers", "following_url": "https://api.github.com/users/ytmimi/following{/other_user}", "gists_url": "https://api.github.com/users/ytmimi/gists{/gist_id}", "starred_url": "https://api.github.com/users/ytmimi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ytmimi/subscriptions", "organizations_url": "https://api.github.com/users/ytmimi/orgs", "repos_url": "https://api.github.com/users/ytmimi/repos", "events_url": "https://api.github.com/users/ytmimi/events{/privacy}", "received_events_url": "https://api.github.com/users/ytmimi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d41805704d4a07ac77e0bc59ea5c91cdb69dea26", "url": "https://api.github.com/repos/rust-lang/rust/commits/d41805704d4a07ac77e0bc59ea5c91cdb69dea26", "html_url": "https://github.com/rust-lang/rust/commit/d41805704d4a07ac77e0bc59ea5c91cdb69dea26"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "471a365e4706d01a6667a22cbf4d2e9d58e06cb2", "filename": "src/items.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f7c4a44149b4e3a683f5506929050f2b50117328/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7c4a44149b4e3a683f5506929050f2b50117328/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=f7c4a44149b4e3a683f5506929050f2b50117328", "patch": "@@ -1469,12 +1469,17 @@ fn format_tuple_struct(\n         format_empty_struct_or_tuple(context, inner_span, offset, &mut result, \"(\", \")\");\n     } else {\n         let shape = Shape::indented(offset, context.config).sub_width(1)?;\n+        let lo = if let Some(generics) = struct_parts.generics {\n+            generics.span.hi()\n+        } else {\n+            struct_parts.ident.span.hi()\n+        };\n         result = overflow::rewrite_with_parens(\n             context,\n             &result,\n             fields.iter(),\n             shape,\n-            span,\n+            mk_sp(lo, span.hi()),\n             context.config.fn_call_width(),\n             None,\n         )?;"}, {"sha": "b48292164e43ab4b13d9f4e22a97d3c2ec1af769", "filename": "tests/source/issue-5011.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f7c4a44149b4e3a683f5506929050f2b50117328/tests%2Fsource%2Fissue-5011.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7c4a44149b4e3a683f5506929050f2b50117328/tests%2Fsource%2Fissue-5011.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-5011.rs?ref=f7c4a44149b4e3a683f5506929050f2b50117328", "patch": "@@ -0,0 +1,12 @@\n+pub(crate) struct ASlash(\n+    // hello\n+    i32\n+);\n+\n+pub(crate) struct AStar(\n+    /* hello */\n+    i32\n+);\n+\n+pub(crate) struct BStar(/* hello */ i32);\n+"}, {"sha": "9ad4a1929bdbf808932b7ba835b8041cb0f9537a", "filename": "tests/target/issue-5011.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f7c4a44149b4e3a683f5506929050f2b50117328/tests%2Ftarget%2Fissue-5011.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7c4a44149b4e3a683f5506929050f2b50117328/tests%2Ftarget%2Fissue-5011.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-5011.rs?ref=f7c4a44149b4e3a683f5506929050f2b50117328", "patch": "@@ -0,0 +1,8 @@\n+pub(crate) struct ASlash(\n+    // hello\n+    i32,\n+);\n+\n+pub(crate) struct AStar(/* hello */ i32);\n+\n+pub(crate) struct BStar(/* hello */ i32);"}]}