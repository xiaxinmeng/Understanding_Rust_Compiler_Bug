{"sha": "9909875bfe89d2b901c35c0667bed018338b44e1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5MDk4NzViZmU4OWQyYjkwMWMzNWMwNjY3YmVkMDE4MzM4YjQ0ZTE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-22T07:18:58Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-22T07:53:48Z"}, "message": "parent module request", "tree": {"sha": "cf33277e282f951c323d71236be0044cdb689739", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf33277e282f951c323d71236be0044cdb689739"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9909875bfe89d2b901c35c0667bed018338b44e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9909875bfe89d2b901c35c0667bed018338b44e1", "html_url": "https://github.com/rust-lang/rust/commit/9909875bfe89d2b901c35c0667bed018338b44e1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9909875bfe89d2b901c35c0667bed018338b44e1/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ecc9df5f009deb8e8bbd8e52db9afbe41f8f880c", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecc9df5f009deb8e8bbd8e52db9afbe41f8f880c", "html_url": "https://github.com/rust-lang/rust/commit/ecc9df5f009deb8e8bbd8e52db9afbe41f8f880c"}], "stats": {"total": 54, "additions": 52, "deletions": 2}, "files": [{"sha": "042821b1cadc5dc2a85e17776057c6e219922793", "filename": "code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9909875bfe89d2b901c35c0667bed018338b44e1/code%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/9909875bfe89d2b901c35c0667bed018338b44e1/code%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/code%2Fpackage.json?ref=9909875bfe89d2b901c35c0667bed018338b44e1", "patch": "@@ -41,6 +41,11 @@\n         \"command\": \"libsyntax-rust.matchingBrace\",\n         \"key\": \"ctrl+shift+m\",\n         \"title\": \"Rust Matching Brace\"\n+      },\n+      {\n+        \"command\": \"libsyntax-rust.parentModule\",\n+        \"key\": \"ctrl+u\",\n+        \"title\": \"Rust Parent Module\"\n       }\n     ],\n     \"keybindings\": ["}, {"sha": "fb6841fa0f4d42d95b40d5f98e7d8affced07952", "filename": "code/src/extension.ts", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9909875bfe89d2b901c35c0667bed018338b44e1/code%2Fsrc%2Fextension.ts", "raw_url": "https://github.com/rust-lang/rust/raw/9909875bfe89d2b901c35c0667bed018338b44e1/code%2Fsrc%2Fextension.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/code%2Fsrc%2Fextension.ts?ref=9909875bfe89d2b901c35c0667bed018338b44e1", "patch": "@@ -51,6 +51,22 @@ export function activate(context: vscode.ExtensionContext) {\n             return new vscode.Selection(anchor, active)\n         })\n     })\n+    registerCommand('libsyntax-rust.parentModule', async () => {\n+        let editor = vscode.window.activeTextEditor\n+        if (editor == null || editor.document.languageId != \"rust\") return\n+        let request: lc.TextDocumentIdentifier = {\n+            uri: editor.document.uri.toString()\n+        }\n+        let response = await client.sendRequest<lc.TextDocumentIdentifier>(\"m/parentModule\", request)\n+        let loc: lc.Location = response[0]\n+        if (loc == null) return\n+        let uri = client.protocol2CodeConverter.asUri(loc.uri)\n+        let range = client.protocol2CodeConverter.asRange(loc.range)\n+\n+        let doc = await vscode.workspace.openTextDocument(uri)\n+        let e = await vscode.window.showTextDocument(doc)\n+        e.revealRange(range, vscode.TextEditorRevealType.InCenter)\n+    })\n \n     dispose(vscode.workspace.registerTextDocumentContentProvider(\n         'libsyntax-rust',"}, {"sha": "16cc924645c6f71b440cc3d105ffc24abb506e87", "filename": "crates/server/src/main_loop/handlers.rs", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/9909875bfe89d2b901c35c0667bed018338b44e1/crates%2Fserver%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9909875bfe89d2b901c35c0667bed018338b44e1/crates%2Fserver%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=9909875bfe89d2b901c35c0667bed018338b44e1", "patch": "@@ -3,7 +3,7 @@ use std::collections::HashMap;\n use languageserver_types::{\n     Diagnostic, DiagnosticSeverity, Url, DocumentSymbol,\n     Command, TextDocumentIdentifier, WorkspaceEdit,\n-    SymbolInformation, Position,\n+    SymbolInformation, Position, Location,\n };\n use libanalysis::{Query};\n use libeditor::{self, CursorPosition};\n@@ -184,6 +184,23 @@ pub fn handle_goto_definition(\n     Ok(Some(req::GotoDefinitionResponse::Array(res)))\n }\n \n+pub fn handle_parent_module(\n+    world: ServerWorld,\n+    params: TextDocumentIdentifier,\n+) -> Result<Vec<Location>> {\n+    let file_id = params.try_conv_with(&world)?;\n+    let mut res = Vec::new();\n+    for (file_id, symbol) in world.analysis().parent_module(file_id) {\n+        let line_index = world.analysis().file_line_index(file_id)?;\n+        let location = to_location(\n+            file_id, symbol.node_range,\n+            &world, &line_index\n+        )?;\n+        res.push(location);\n+    }\n+    Ok(res)\n+}\n+\n pub fn handle_execute_command(\n     world: ServerWorld,\n     mut params: req::ExecuteCommandParams,"}, {"sha": "9499b826c2314cc5d36e93b051d093a7d24a3671", "filename": "crates/server/src/main_loop/mod.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9909875bfe89d2b901c35c0667bed018338b44e1/crates%2Fserver%2Fsrc%2Fmain_loop%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9909875bfe89d2b901c35c0667bed018338b44e1/crates%2Fserver%2Fsrc%2Fmain_loop%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Fmain_loop%2Fmod.rs?ref=9909875bfe89d2b901c35c0667bed018338b44e1", "patch": "@@ -26,6 +26,7 @@ use {\n         handle_workspace_symbol,\n         handle_goto_definition,\n         handle_find_matching_brace,\n+        handle_parent_module,\n     },\n };\n \n@@ -141,6 +142,9 @@ fn on_request(\n     handle_request_on_threadpool::<req::GotoDefinition>(\n         &mut req, pool, world, sender, handle_goto_definition,\n     )?;\n+    handle_request_on_threadpool::<req::ParentModule>(\n+        &mut req, pool, world, sender, handle_parent_module,\n+    )?;\n     dispatch::handle_request::<req::ExecuteCommand, _>(&mut req, |params, resp| {\n         io.send(RawMsg::Response(resp.into_response(Ok(None))?));\n "}, {"sha": "a8aa2462956113803a218c25b57ff829551cf278", "filename": "crates/server/src/req.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9909875bfe89d2b901c35c0667bed018338b44e1/crates%2Fserver%2Fsrc%2Freq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9909875bfe89d2b901c35c0667bed018338b44e1/crates%2Fserver%2Fsrc%2Freq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Freq.rs?ref=9909875bfe89d2b901c35c0667bed018338b44e1", "patch": "@@ -1,5 +1,5 @@\n use serde::{ser::Serialize, de::DeserializeOwned};\n-use languageserver_types::{TextDocumentIdentifier, Range, Url, Position};\n+use languageserver_types::{TextDocumentIdentifier, Range, Url, Position, Location};\n use url_serde;\n \n pub use languageserver_types::{\n@@ -109,3 +109,11 @@ impl Request for MoveCursor {\n     type Result = ();\n     const METHOD: &'static str = \"m/moveCursor\";\n }\n+\n+pub enum ParentModule {}\n+\n+impl Request for ParentModule {\n+    type Params = TextDocumentIdentifier;\n+    type Result = Vec<Location>;\n+    const METHOD: &'static str = \"m/parentModule\";\n+}"}]}