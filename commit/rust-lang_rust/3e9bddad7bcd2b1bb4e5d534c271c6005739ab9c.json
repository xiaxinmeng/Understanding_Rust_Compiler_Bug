{"sha": "3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlOWJkZGFkN2JjZDJiMWJiNGU1ZDUzNGMyNzFjNjAwNTczOWFiOWM=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-02-18T12:12:21Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-02-28T13:43:47Z"}, "message": "remove `Option` from the `tables` field", "tree": {"sha": "330102b89ed374449160740efb52478f99ac1548", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/330102b89ed374449160740efb52478f99ac1548"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c", "html_url": "https://github.com/rust-lang/rust/commit/3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc2e4cd7e33d195a8ba8ea334d4baa291a438a56", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc2e4cd7e33d195a8ba8ea334d4baa291a438a56", "html_url": "https://github.com/rust-lang/rust/commit/cc2e4cd7e33d195a8ba8ea334d4baa291a438a56"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "f5d6780213b20617c023cee3d2bb961621e501e8", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=3e9bddad7bcd2b1bb4e5d534c271c6005739ab9c", "patch": "@@ -87,7 +87,7 @@ fn borrowck_fn<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, body_id: hir::BodyId) {\n \n     let mut bccx = &mut BorrowckCtxt {\n         tcx: tcx,\n-        tables: Some(tables),\n+        tables: tables,\n     };\n \n     let body = bccx.tcx.hir.body(body_id);\n@@ -159,17 +159,20 @@ fn build_borrowck_dataflow_data<'a, 'tcx>(this: &mut BorrowckCtxt<'a, 'tcx>,\n /// the `BorrowckCtxt` itself , e.g. the flowgraph visualizer.\n pub fn build_borrowck_dataflow_data_for_fn<'a, 'tcx>(\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n-    body: hir::BodyId,\n+    body_id: hir::BodyId,\n     cfg: &cfg::CFG)\n     -> (BorrowckCtxt<'a, 'tcx>, AnalysisData<'a, 'tcx>)\n {\n+    let owner_id = tcx.hir.body_owner(body_id);\n+    let owner_def_id = tcx.hir.local_def_id(owner_id);\n+    let tables = tcx.item_tables(owner_def_id);\n \n     let mut bccx = BorrowckCtxt {\n         tcx: tcx,\n-        tables: None,\n+        tables: tables,\n     };\n \n-    let dataflow_data = build_borrowck_dataflow_data(&mut bccx, cfg, body);\n+    let dataflow_data = build_borrowck_dataflow_data(&mut bccx, cfg, body_id);\n     (bccx, dataflow_data)\n }\n \n@@ -181,7 +184,7 @@ pub struct BorrowckCtxt<'a, 'tcx: 'a> {\n \n     // tables for the current thing we are checking; set to\n     // Some in `borrowck_fn` and cleared later\n-    tables: Option<&'a ty::TypeckTables<'tcx>>,\n+    tables: &'a ty::TypeckTables<'tcx>,\n }\n \n ///////////////////////////////////////////////////////////////////////////\n@@ -472,8 +475,7 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                            r_sup: &'tcx ty::Region)\n                            -> bool\n     {\n-        self.tables.unwrap().free_region_map\n-                            .is_subregion_of(self.tcx, r_sub, r_sup)\n+        self.tables.free_region_map.is_subregion_of(self.tcx, r_sub, r_sup)\n     }\n \n     pub fn report(&self, err: BckError<'tcx>) {"}]}