{"sha": "0883973d2a1a0346832e1d8556997f771c87e5d7", "node_id": "C_kwDOAAsO6NoAKDA4ODM5NzNkMmExYTAzNDY4MzJlMWQ4NTU2OTk3Zjc3MWM4N2U1ZDc", "commit": {"author": {"name": "nx2k3", "email": "nx2k3@duck.com", "date": "2023-02-27T13:25:03Z"}, "committer": {"name": "nx2k3", "email": "nx2k3@duck.com", "date": "2023-02-27T13:25:03Z"}, "message": "check double negation", "tree": {"sha": "5d5842e18c59b8299fbc2463a2c5290fd4e6a0a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5d5842e18c59b8299fbc2463a2c5290fd4e6a0a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0883973d2a1a0346832e1d8556997f771c87e5d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0883973d2a1a0346832e1d8556997f771c87e5d7", "html_url": "https://github.com/rust-lang/rust/commit/0883973d2a1a0346832e1d8556997f771c87e5d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0883973d2a1a0346832e1d8556997f771c87e5d7/comments", "author": {"login": "nx2k3", "id": 71603665, "node_id": "MDQ6VXNlcjcxNjAzNjY1", "avatar_url": "https://avatars.githubusercontent.com/u/71603665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nx2k3", "html_url": "https://github.com/nx2k3", "followers_url": "https://api.github.com/users/nx2k3/followers", "following_url": "https://api.github.com/users/nx2k3/following{/other_user}", "gists_url": "https://api.github.com/users/nx2k3/gists{/gist_id}", "starred_url": "https://api.github.com/users/nx2k3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nx2k3/subscriptions", "organizations_url": "https://api.github.com/users/nx2k3/orgs", "repos_url": "https://api.github.com/users/nx2k3/repos", "events_url": "https://api.github.com/users/nx2k3/events{/privacy}", "received_events_url": "https://api.github.com/users/nx2k3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nx2k3", "id": 71603665, "node_id": "MDQ6VXNlcjcxNjAzNjY1", "avatar_url": "https://avatars.githubusercontent.com/u/71603665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nx2k3", "html_url": "https://github.com/nx2k3", "followers_url": "https://api.github.com/users/nx2k3/followers", "following_url": "https://api.github.com/users/nx2k3/following{/other_user}", "gists_url": "https://api.github.com/users/nx2k3/gists{/gist_id}", "starred_url": "https://api.github.com/users/nx2k3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nx2k3/subscriptions", "organizations_url": "https://api.github.com/users/nx2k3/orgs", "repos_url": "https://api.github.com/users/nx2k3/repos", "events_url": "https://api.github.com/users/nx2k3/events{/privacy}", "received_events_url": "https://api.github.com/users/nx2k3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13a741afaccf03a4e98bedfc09e46c72e22810e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/13a741afaccf03a4e98bedfc09e46c72e22810e0", "html_url": "https://github.com/rust-lang/rust/commit/13a741afaccf03a4e98bedfc09e46c72e22810e0"}], "stats": {"total": 174, "additions": 90, "deletions": 84}, "files": [{"sha": "d1dc4ce1e9919ea3f1ac1f655e1ab4de701390a7", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/0883973d2a1a0346832e1d8556997f771c87e5d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0883973d2a1a0346832e1d8556997f771c87e5d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=0883973d2a1a0346832e1d8556997f771c87e5d7", "patch": "@@ -284,6 +284,7 @@ impl<'a> Parser<'a> {\n             if self.prev_token == token::BinOp(token::Minus)\n                 && self.token == token::BinOp(token::Minus)\n                 && self.prev_token.span.between(self.token.span).is_empty()\n+                && !self.look_ahead(1, |tok| tok.can_begin_expr())\n             {\n                 let op_span = self.prev_token.span.to(self.token.span);\n                 // Eat the second `-`\n@@ -560,7 +561,10 @@ impl<'a> Parser<'a> {\n             token::Not => make_it!(this, attrs, |this, _| this.parse_unary_expr(lo, UnOp::Not)),\n             // `~expr`\n             token::Tilde => make_it!(this, attrs, |this, _| this.recover_tilde_expr(lo)),\n-\n+            // // `-expr`\n+            // token::BinOp(token::Minus) => {\n+            //     make_it!(this, attrs, |this, _| this.parse_unary_expr(lo, UnOp::Neg))\n+            // }\n             // `*expr`\n             token::BinOp(token::Star) => {\n                 make_it!(this, attrs, |this, _| this.parse_unary_expr(lo, UnOp::Deref))\n@@ -604,17 +608,20 @@ impl<'a> Parser<'a> {\n             }\n             // Recover from `--x`:\n             token::BinOp(token::Minus)\n-                if this.look_ahead(1, |t| *t == token::BinOp(token::Minus)) =>\n+                if this.look_ahead(1, |t| *t == token::BinOp(token::Minus))\n+                    && !this.token.can_begin_expr() =>\n             {\n                 let starts_stmt = this.prev_token == token::Semi\n                     || this.prev_token == token::CloseDelim(Delimiter::Brace);\n                 let pre_span = this.token.span.to(this.look_ahead(1, |t| t.span));\n+                // if !this.token.can_begin_expr() {\n                 // Eat both `-`s.\n                 this.bump();\n                 this.bump();\n-\n                 let operand_expr = this.parse_dot_or_call_expr(Default::default())?;\n                 this.recover_from_prefix_decrement(operand_expr, pre_span, starts_stmt)\n+\n+                // }\n             }\n             // `-expr`\n             token::BinOp(token::Minus) => {"}, {"sha": "2e17a317b685c4c7fb3ec3fe5aeb72c0550046d1", "filename": "tests/ui/parser/issue-108495-dec-pass.rs", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/0883973d2a1a0346832e1d8556997f771c87e5d7/tests%2Fui%2Fparser%2Fissue-108495-dec-pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0883973d2a1a0346832e1d8556997f771c87e5d7/tests%2Fui%2Fparser%2Fissue-108495-dec-pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissue-108495-dec-pass.rs?ref=0883973d2a1a0346832e1d8556997f771c87e5d7", "patch": "@@ -0,0 +1,48 @@\n+// run-pass\n+fn test1() {\n+    let i = 0;\n+    let c = i + --i;\n+    println!(\"{c}\");\n+}\n+fn test2() {\n+    let i = 9;\n+    let c = -- i + --i;\n+    println!(\"{c}\");\n+}\n+\n+fn test3(){\n+    let i=10;\n+    println!(\"{}\",i--i);\n+}\n+fn test4(){\n+    let i=10;\n+    println!(\"{}\",--i);\n+\n+}\n+struct Foo {\n+    bar: Bar,\n+}\n+\n+struct Bar {\n+    qux: i32,\n+}\n+\n+fn test5() {\n+    let foo = Foo { bar: Bar { qux: 0 } };\n+    let c=--foo.bar.qux;\n+    println!(\"{c}\");\n+}\n+\n+fn test6(){\n+    let x=2;\n+    let y=--x;\n+    println!(\"{y}\");\n+}\n+fn main(){\n+    test1();\n+    test2();\n+    test3();\n+    test4();\n+    test5();\n+    test6();\n+}"}, {"sha": "db45577ec01893ebcc04a79eadb5bf04445ac887", "filename": "tests/ui/parser/issue-108495-dec.rs", "status": "modified", "additions": 12, "deletions": 23, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/0883973d2a1a0346832e1d8556997f771c87e5d7/tests%2Fui%2Fparser%2Fissue-108495-dec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0883973d2a1a0346832e1d8556997f771c87e5d7/tests%2Fui%2Fparser%2Fissue-108495-dec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissue-108495-dec.rs?ref=0883973d2a1a0346832e1d8556997f771c87e5d7", "patch": "@@ -1,18 +1,3 @@\n-fn test1() {\n-    let mut i = 0;\n-    let _ = i + --i; //~ ERROR Rust has no prefix decrement operator\n-}\n-\n-fn test2() {\n-    let mut i = 0;\n-    let _ = --i + i; //~ ERROR Rust has no prefix decrement operator\n-}\n-\n-fn test3() {\n-    let mut i = 0;\n-    let _ = --i + --i; //~ ERROR Rust has no prefix decrement operator\n-}\n-\n fn test4() {\n     let mut i = 0;\n     let _ = i + i--; //~ ERROR Rust has no postfix decrement operator\n@@ -21,32 +6,36 @@ fn test4() {\n \n fn test5() {\n     let mut i = 0;\n-    let _ = i-- + i; //~ ERROR Rust has no postfix decrement operator\n+    let _ = i-- + i--; //~ ERROR Rust has no postfix decrement operator\n }\n \n fn test6() {\n     let mut i = 0;\n-    let _ = i-- + i--; //~ ERROR Rust has no postfix decrement operator\n+    let _ = --i + i--; //~ ERROR Rust has no postfix decrement operator\n }\n \n fn test7() {\n     let mut i = 0;\n-    let _ = --i + i--; //~ ERROR Rust has no prefix decrement operator\n+    let _ = i-- + --i; //~ ERROR Rust has no postfix decrement operator\n }\n \n fn test8() {\n     let mut i = 0;\n-    let _ = i-- + --i; //~ ERROR Rust has no postfix decrement operator\n+    let _ = (1 + 2 + i)--; //~ ERROR Rust has no postfix decrement operator\n }\n \n fn test9() {\n     let mut i = 0;\n-    let _ = (1 + 2 + i)--; //~ ERROR Rust has no postfix decrement operator\n+    let _ = (i-- + 1) + 2; //~ ERROR Rust has no postfix decrement operator\n }\n \n-fn test10() {\n-    let mut i = 0;\n-    let _ = (i-- + 1) + 2; //~ ERROR Rust has no postfix decrement operator\n+\n+\n+fn test14(){\n+    let i=10;\n+    while i!=0{\n+        i--; //~ ERROR Rust has no postfix decrement operator\n+    }\n }\n \n fn main() { }"}, {"sha": "90019e68f44607b649c78769cc3ff53d4bed7a92", "filename": "tests/ui/parser/issue-108495-dec.stderr", "status": "modified", "additions": 20, "deletions": 58, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/0883973d2a1a0346832e1d8556997f771c87e5d7/tests%2Fui%2Fparser%2Fissue-108495-dec.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0883973d2a1a0346832e1d8556997f771c87e5d7/tests%2Fui%2Fparser%2Fissue-108495-dec.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissue-108495-dec.stderr?ref=0883973d2a1a0346832e1d8556997f771c87e5d7", "patch": "@@ -1,55 +1,11 @@\n-error: Rust has no prefix decrement operator\n-  --> $DIR/issue-dec.rs:3:17\n-   |\n-LL |     let _ = i + --i;\n-   |                 ^^ not a valid prefix operator\n-   |\n-help: use `-= 1` instead\n-   |\n-LL |     let _ = i + { i -= 1; i };\n-   |                 ~   +++++++++\n-\n-error: Rust has no prefix decrement operator\n-  --> $DIR/issue-dec.rs:8:13\n-   |\n-LL |     let _ = --i + i;\n-   |             ^^ not a valid prefix operator\n-   |\n-help: use `-= 1` instead\n-   |\n-LL |     let _ = { i -= 1; i } + i;\n-   |             ~   +++++++++\n-\n-error: Rust has no prefix decrement operator\n-  --> $DIR/issue-dec.rs:13:13\n-   |\n-LL |     let _ = --i + --i;\n-   |             ^^ not a valid prefix operator\n-   |\n-help: use `-= 1` instead\n-   |\n-LL |     let _ = { i -= 1; i } + --i;\n-   |             ~   +++++++++\n-\n error: Rust has no postfix decrement operator\n-  --> $DIR/issue-dec.rs:18:18\n+  --> $DIR/issue-108495-dec.rs:3:18\n    |\n LL |     let _ = i + i--;\n    |                  ^^ not a valid postfix operator\n \n error: Rust has no postfix decrement operator\n-  --> $DIR/issue-dec.rs:24:14\n-   |\n-LL |     let _ = i-- + i;\n-   |              ^^ not a valid postfix operator\n-   |\n-help: use `-= 1` instead\n-   |\n-LL |     let _ = { let tmp = i; i -= 1; tmp } + i;\n-   |             +++++++++++  ~~~~~~~~~~~~~~~\n-\n-error: Rust has no postfix decrement operator\n-  --> $DIR/issue-dec.rs:29:14\n+  --> $DIR/issue-108495-dec.rs:9:14\n    |\n LL |     let _ = i-- + i--;\n    |              ^^ not a valid postfix operator\n@@ -59,19 +15,14 @@ help: use `-= 1` instead\n LL |     let _ = { let tmp = i; i -= 1; tmp } + i--;\n    |             +++++++++++  ~~~~~~~~~~~~~~~\n \n-error: Rust has no prefix decrement operator\n-  --> $DIR/issue-dec.rs:34:13\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:14:20\n    |\n LL |     let _ = --i + i--;\n-   |             ^^ not a valid prefix operator\n-   |\n-help: use `-= 1` instead\n-   |\n-LL |     let _ = { i -= 1; i } + i--;\n-   |             ~   +++++++++\n+   |                    ^^ not a valid postfix operator\n \n error: Rust has no postfix decrement operator\n-  --> $DIR/issue-dec.rs:39:14\n+  --> $DIR/issue-108495-dec.rs:19:14\n    |\n LL |     let _ = i-- + --i;\n    |              ^^ not a valid postfix operator\n@@ -82,7 +33,7 @@ LL |     let _ = { let tmp = i; i -= 1; tmp } + --i;\n    |             +++++++++++  ~~~~~~~~~~~~~~~\n \n error: Rust has no postfix decrement operator\n-  --> $DIR/issue-dec.rs:44:24\n+  --> $DIR/issue-108495-dec.rs:24:24\n    |\n LL |     let _ = (1 + 2 + i)--;\n    |                        ^^ not a valid postfix operator\n@@ -93,7 +44,7 @@ LL |     let _ = { let tmp = (1 + 2 + i); (1 + 2 + i) -= 1; tmp };\n    |             +++++++++++            ~~~~~~~~~~~~~~~~~~~~~~~~~\n \n error: Rust has no postfix decrement operator\n-  --> $DIR/issue-dec.rs:49:15\n+  --> $DIR/issue-108495-dec.rs:29:15\n    |\n LL |     let _ = (i-- + 1) + 2;\n    |               ^^ not a valid postfix operator\n@@ -103,5 +54,16 @@ help: use `-= 1` instead\n LL |     let _ = ({ let tmp = i; i -= 1; tmp } + 1) + 2;\n    |              +++++++++++  ~~~~~~~~~~~~~~~\n \n-error: aborting due to 10 previous errors\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:37:10\n+   |\n+LL |         i--;\n+   |          ^^ not a valid postfix operator\n+   |\n+help: use `-= 1` instead\n+   |\n+LL |         i -= 1;\n+   |           ~~~~\n+\n+error: aborting due to 7 previous errors\n "}]}