{"sha": "9cb47de81337482b226cde3a2f59594ed78412d1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljYjQ3ZGU4MTMzNzQ4MmIyMjZjZGUzYTJmNTk1OTRlZDc4NDEyZDE=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-06-03T00:04:20Z"}, "committer": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-06-05T18:49:46Z"}, "message": "Referring to erroneous constants in promoteds must abort the build", "tree": {"sha": "8403163950c2db806ded8df1f84583a2e2ef5861", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8403163950c2db806ded8df1f84583a2e2ef5861"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9cb47de81337482b226cde3a2f59594ed78412d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9cb47de81337482b226cde3a2f59594ed78412d1", "html_url": "https://github.com/rust-lang/rust/commit/9cb47de81337482b226cde3a2f59594ed78412d1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9cb47de81337482b226cde3a2f59594ed78412d1/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c0d1355f261efd624e0f7755a87e46d954771d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c0d1355f261efd624e0f7755a87e46d954771d3", "html_url": "https://github.com/rust-lang/rust/commit/5c0d1355f261efd624e0f7755a87e46d954771d3"}], "stats": {"total": 324, "additions": 291, "deletions": 33}, "files": [{"sha": "4f3adaaae274cece31021b80e5a86a47513a6fbb", "filename": "src/librustc_mir/monomorphize/collector.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -1190,13 +1190,25 @@ fn collect_neighbours<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     let param_env = ty::ParamEnv::reveal_all();\n     for i in 0..mir.promoted.len() {\n         use rustc_data_structures::indexed_vec::Idx;\n+        let i = Promoted::new(i);\n         let cid = GlobalId {\n             instance,\n-            promoted: Some(Promoted::new(i)),\n+            promoted: Some(i),\n         };\n         match tcx.const_eval(param_env.and(cid)) {\n             Ok(val) => collect_const(tcx, val, instance.substs, output),\n-            Err(_) => {},\n+            Err(err) => {\n+                use rustc::middle::const_val::ErrKind;\n+                use rustc::mir::interpret::EvalErrorKind;\n+                if let ErrKind::Miri(ref miri, ..) = *err.kind {\n+                    if let EvalErrorKind::ReferencedConstant = miri.kind {\n+                        err.report_as_error(\n+                            tcx.at(mir.promoted[i].span),\n+                            \"erroneous constant used\",\n+                        );\n+                    }\n+                }\n+            },\n         }\n     }\n }"}, {"sha": "a35252c47893a71c374ebf827da145c5607e61ff", "filename": "src/test/ui/const-eval/conditional_array_execution.nll.stderr", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.nll.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -0,0 +1,45 @@\n+warning: attempt to subtract with overflow\n+  --> $DIR/conditional_array_execution.rs:15:19\n+   |\n+LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n+   |                   ^^^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/conditional_array_execution.rs:11:9\n+   |\n+LL | #![warn(const_err)]\n+   |         ^^^^^^^^^\n+\n+warning: this constant cannot be used\n+  --> $DIR/conditional_array_execution.rs:15:1\n+   |\n+LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n+   | ^^^^^^^^^^^^^^^^^^-----^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |                   |\n+   |                   attempt to subtract with overflow\n+\n+warning: this expression will panic at runtime\n+  --> $DIR/conditional_array_execution.rs:20:20\n+   |\n+LL |     println!(\"{}\", FOO);\n+   |                    ^^^ referenced constant has errors\n+\n+error[E0080]: erroneous constant used\n+  --> $DIR/conditional_array_execution.rs:20:5\n+   |\n+LL |     println!(\"{}\", FOO);\n+   |     ^^^^^^^^^^^^^^^---^^\n+   |                    |\n+   |                    referenced constant has errors\n+   |\n+   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n+\n+error[E0080]: erroneous constant used\n+  --> $DIR/conditional_array_execution.rs:20:20\n+   |\n+LL |     println!(\"{}\", FOO);\n+   |                    ^^^ referenced constant has errors\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0080`."}, {"sha": "055224d27315d0312c17d3ddb10384731031d760", "filename": "src/test/ui/const-eval/conditional_array_execution.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.rs?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -8,7 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// compile-pass\n #![warn(const_err)]\n \n const X: u32 = 5;\n@@ -20,4 +19,5 @@ const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n fn main() {\n     println!(\"{}\", FOO);\n     //~^ WARN this expression will panic at runtime\n+    //~| ERROR erroneous constant used\n }"}, {"sha": "f396c8f0444e7ffc48b28a7d3774aa09244abecd", "filename": "src/test/ui/const-eval/conditional_array_execution.stderr", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -1,26 +1,35 @@\n warning: attempt to subtract with overflow\n-  --> $DIR/conditional_array_execution.rs:16:19\n+  --> $DIR/conditional_array_execution.rs:15:19\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n    |                   ^^^^^\n    |\n note: lint level defined here\n-  --> $DIR/conditional_array_execution.rs:12:9\n+  --> $DIR/conditional_array_execution.rs:11:9\n    |\n LL | #![warn(const_err)]\n    |         ^^^^^^^^^\n \n warning: this constant cannot be used\n-  --> $DIR/conditional_array_execution.rs:16:1\n+  --> $DIR/conditional_array_execution.rs:15:1\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n    | ^^^^^^^^^^^^^^^^^^-----^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |                   |\n    |                   attempt to subtract with overflow\n \n warning: this expression will panic at runtime\n-  --> $DIR/conditional_array_execution.rs:21:20\n+  --> $DIR/conditional_array_execution.rs:20:20\n    |\n LL |     println!(\"{}\", FOO);\n    |                    ^^^ referenced constant has errors\n \n+error[E0080]: erroneous constant used\n+  --> $DIR/conditional_array_execution.rs:20:20\n+   |\n+LL |     println!(\"{}\", FOO);\n+   |                    ^^^ referenced constant has errors\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0080`."}, {"sha": "416967613f089e094f807022500985b8e57c8ec8", "filename": "src/test/ui/const-eval/issue-43197.nll.stderr", "status": "added", "additions": 71, "deletions": 0, "changes": 71, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.nll.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -0,0 +1,71 @@\n+warning: attempt to subtract with overflow\n+  --> $DIR/issue-43197.rs:20:20\n+   |\n+LL |     const X: u32 = 0-1;\n+   |                    ^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/issue-43197.rs:11:9\n+   |\n+LL | #![warn(const_err)]\n+   |         ^^^^^^^^^\n+\n+warning: this constant cannot be used\n+  --> $DIR/issue-43197.rs:20:5\n+   |\n+LL |     const X: u32 = 0-1;\n+   |     ^^^^^^^^^^^^^^^---^\n+   |                    |\n+   |                    attempt to subtract with overflow\n+\n+warning: attempt to subtract with overflow\n+  --> $DIR/issue-43197.rs:23:24\n+   |\n+LL |     const Y: u32 = foo(0-1);\n+   |                        ^^^\n+\n+warning: this constant cannot be used\n+  --> $DIR/issue-43197.rs:23:5\n+   |\n+LL |     const Y: u32 = foo(0-1);\n+   |     ^^^^^^^^^^^^^^^^^^^---^^\n+   |                        |\n+   |                        attempt to subtract with overflow\n+\n+warning: this expression will panic at runtime\n+  --> $DIR/issue-43197.rs:26:23\n+   |\n+LL |     println!(\"{} {}\", X, Y);\n+   |                       ^ referenced constant has errors\n+\n+warning: this expression will panic at runtime\n+  --> $DIR/issue-43197.rs:26:26\n+   |\n+LL |     println!(\"{} {}\", X, Y);\n+   |                          ^ referenced constant has errors\n+\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-43197.rs:26:5\n+   |\n+LL |     println!(\"{} {}\", X, Y);\n+   |     ^^^^^^^^^^^^^^^^^^-^^^^^\n+   |                       |\n+   |                       referenced constant has errors\n+   |\n+   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n+\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-43197.rs:26:26\n+   |\n+LL |     println!(\"{} {}\", X, Y);\n+   |                          ^ referenced constant has errors\n+\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-43197.rs:26:23\n+   |\n+LL |     println!(\"{} {}\", X, Y);\n+   |                       ^ referenced constant has errors\n+\n+error: aborting due to 3 previous errors\n+\n+For more information about this error, try `rustc --explain E0080`."}, {"sha": "f8d820db74796da3078d3bb556a0de6aaef03550", "filename": "src/test/ui/const-eval/issue-43197.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.rs?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -8,7 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// compile-pass\n #![warn(const_err)]\n \n #![feature(const_fn)]\n@@ -27,4 +26,6 @@ fn main() {\n     println!(\"{} {}\", X, Y);\n     //~^ WARN this expression will panic at runtime\n     //~| WARN this expression will panic at runtime\n+    //~| ERROR erroneous constant used\n+    //~| ERROR erroneous constant used\n }"}, {"sha": "207523f688f977d11966b80611fdb0485f310233", "filename": "src/test/ui/const-eval/issue-43197.stderr", "status": "modified", "additions": 22, "deletions": 7, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -1,46 +1,61 @@\n warning: attempt to subtract with overflow\n-  --> $DIR/issue-43197.rs:21:20\n+  --> $DIR/issue-43197.rs:20:20\n    |\n LL |     const X: u32 = 0-1;\n    |                    ^^^\n    |\n note: lint level defined here\n-  --> $DIR/issue-43197.rs:12:9\n+  --> $DIR/issue-43197.rs:11:9\n    |\n LL | #![warn(const_err)]\n    |         ^^^^^^^^^\n \n warning: this constant cannot be used\n-  --> $DIR/issue-43197.rs:21:5\n+  --> $DIR/issue-43197.rs:20:5\n    |\n LL |     const X: u32 = 0-1;\n    |     ^^^^^^^^^^^^^^^---^\n    |                    |\n    |                    attempt to subtract with overflow\n \n warning: attempt to subtract with overflow\n-  --> $DIR/issue-43197.rs:24:24\n+  --> $DIR/issue-43197.rs:23:24\n    |\n LL |     const Y: u32 = foo(0-1);\n    |                        ^^^\n \n warning: this constant cannot be used\n-  --> $DIR/issue-43197.rs:24:5\n+  --> $DIR/issue-43197.rs:23:5\n    |\n LL |     const Y: u32 = foo(0-1);\n    |     ^^^^^^^^^^^^^^^^^^^---^^\n    |                        |\n    |                        attempt to subtract with overflow\n \n warning: this expression will panic at runtime\n-  --> $DIR/issue-43197.rs:27:23\n+  --> $DIR/issue-43197.rs:26:23\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                       ^ referenced constant has errors\n \n warning: this expression will panic at runtime\n-  --> $DIR/issue-43197.rs:27:26\n+  --> $DIR/issue-43197.rs:26:26\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^ referenced constant has errors\n \n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-43197.rs:26:26\n+   |\n+LL |     println!(\"{} {}\", X, Y);\n+   |                          ^ referenced constant has errors\n+\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-43197.rs:26:23\n+   |\n+LL |     println!(\"{} {}\", X, Y);\n+   |                       ^ referenced constant has errors\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0080`."}, {"sha": "49587fa0809d03fac21fa3ad5f66aa3c92ffaa32", "filename": "src/test/ui/const-eval/issue-44578.nll.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.nll.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -0,0 +1,19 @@\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-44578.rs:35:5\n+   |\n+LL |     println!(\"{}\", <Bar<u16, u8> as Foo>::AMT);\n+   |     ^^^^^^^^^^^^^^^--------------------------^^\n+   |                    |\n+   |                    referenced constant has errors\n+   |\n+   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n+\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-44578.rs:35:20\n+   |\n+LL |     println!(\"{}\", <Bar<u16, u8> as Foo>::AMT);\n+   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^ referenced constant has errors\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0080`."}, {"sha": "331de4ab661558e7f389b9c26328085e20c1b191", "filename": "src/test/ui/const-eval/issue-44578.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.rs?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -8,8 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// compile-pass\n-#![warn(const_err)]\n+#![allow(const_err)]\n \n trait Foo {\n     const AMT: usize;\n@@ -33,6 +32,6 @@ impl Foo for u16 {\n }\n \n fn main() {\n-    println!(\"{}\", <Bar<u16, u8> as Foo>::AMT); //~ WARN const_err\n-    //~^ WARN const_err\n+    println!(\"{}\", <Bar<u16, u8> as Foo>::AMT);\n+    //~^ ERROR erroneous constant used\n }"}, {"sha": "42d60c604b8f2ca4ab02b1016b4e8d6901fd007a", "filename": "src/test/ui/const-eval/issue-44578.stderr", "status": "modified", "additions": 5, "deletions": 14, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-44578.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -1,18 +1,9 @@\n-warning: this expression will panic at runtime\n-  --> $DIR/issue-44578.rs:36:20\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-44578.rs:35:20\n    |\n-LL |     println!(\"{}\", <Bar<u16, u8> as Foo>::AMT); //~ WARN const_err\n+LL |     println!(\"{}\", <Bar<u16, u8> as Foo>::AMT);\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^ referenced constant has errors\n-   |\n-note: lint level defined here\n-  --> $DIR/issue-44578.rs:12:9\n-   |\n-LL | #![warn(const_err)]\n-   |         ^^^^^^^^^\n \n-warning: this expression will panic at runtime\n-  --> $DIR/issue-44578.rs:36:20\n-   |\n-LL |     println!(\"{}\", <Bar<u16, u8> as Foo>::AMT); //~ WARN const_err\n-   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^ referenced constant has errors\n+error: aborting due to previous error\n \n+For more information about this error, try `rustc --explain E0080`."}, {"sha": "a90579296cb13c6a232d2d58fe4b02a5b663b11a", "filename": "src/test/ui/const-eval/issue-50814-2.rs", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814-2.rs?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -0,0 +1,42 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+trait C {\n+    const BOO: usize;\n+}\n+\n+trait Foo<T> {\n+    const BAR: usize;\n+}\n+\n+struct A<T>(T);\n+\n+impl<T: C> Foo<T> for A<T> {\n+    const BAR: usize = [5, 6, 7][T::BOO];\n+}\n+\n+fn foo<T: C>() -> &'static usize {\n+    &<A<T> as Foo<T>>::BAR //~ ERROR erroneous constant used\n+}\n+\n+impl C for () {\n+    const BOO: usize = 42;\n+}\n+\n+impl C for u32 {\n+    const BOO: usize = 1;\n+}\n+\n+fn main() {\n+    println!(\"{:x}\", foo::<()>() as *const usize as usize);\n+    println!(\"{:x}\", foo::<u32>() as *const usize as usize);\n+    println!(\"{:x}\", foo::<()>());\n+    println!(\"{:x}\", foo::<u32>());\n+}\n\\ No newline at end of file"}, {"sha": "3c6131303543aa4c74b8366caa95d510bfd9639b", "filename": "src/test/ui/const-eval/issue-50814-2.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814-2.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -0,0 +1,11 @@\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-50814-2.rs:26:5\n+   |\n+LL |     &<A<T> as Foo<T>>::BAR //~ ERROR erroneous constant used\n+   |     ^---------------------\n+   |      |\n+   |      referenced constant has errors\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0080`."}, {"sha": "2af51c48bd4436e02956c41a1156d0d5282f5b07", "filename": "src/test/ui/const-eval/issue-50814.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814.rs?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -0,0 +1,32 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+trait Unsigned {\n+    const MAX: u8;\n+}\n+\n+struct U8(u8);\n+impl Unsigned for U8 {\n+    const MAX: u8 = 0xff;\n+}\n+\n+struct Sum<A,B>(A,B);\n+\n+impl<A: Unsigned, B: Unsigned> Unsigned for Sum<A,B> {\n+    const MAX: u8 = A::MAX + B::MAX;\n+}\n+\n+fn foo<T>(_: T) -> &'static u8 {\n+    &Sum::<U8,U8>::MAX //~ ERROR erroneous constant used\n+}\n+\n+fn main() {\n+    foo(0);\n+}\n\\ No newline at end of file"}, {"sha": "b3e13b43894731816d2788818e4bfdb8957ba0fe", "filename": "src/test/ui/const-eval/issue-50814.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cb47de81337482b226cde3a2f59594ed78412d1/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-50814.stderr?ref=9cb47de81337482b226cde3a2f59594ed78412d1", "patch": "@@ -0,0 +1,11 @@\n+error[E0080]: erroneous constant used\n+  --> $DIR/issue-50814.rs:27:5\n+   |\n+LL |     &Sum::<U8,U8>::MAX //~ ERROR erroneous constant used\n+   |     ^-----------------\n+   |      |\n+   |      referenced constant has errors\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0080`."}]}