{"sha": "0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBhNGZiZTMyNmE0YTA1ZmYwMWQwN2QzNjJjYzU1NGJkODQxNGNlODk=", "commit": {"author": {"name": "Isaac Whitfield", "email": "iw@whitfin.io", "date": "2018-05-09T15:16:08Z"}, "committer": {"name": "Isaac Whitfield", "email": "iw@whitfin.io", "date": "2018-05-11T15:09:53Z"}, "message": "Update naming in line with PR comments", "tree": {"sha": "e666daaec5f7ad0a19a7cfaa7de19662da1354ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e666daaec5f7ad0a19a7cfaa7de19662da1354ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "html_url": "https://github.com/rust-lang/rust/commit/0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/comments", "author": {"login": "whitfin", "id": 5376378, "node_id": "MDQ6VXNlcjUzNzYzNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/5376378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/whitfin", "html_url": "https://github.com/whitfin", "followers_url": "https://api.github.com/users/whitfin/followers", "following_url": "https://api.github.com/users/whitfin/following{/other_user}", "gists_url": "https://api.github.com/users/whitfin/gists{/gist_id}", "starred_url": "https://api.github.com/users/whitfin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/whitfin/subscriptions", "organizations_url": "https://api.github.com/users/whitfin/orgs", "repos_url": "https://api.github.com/users/whitfin/repos", "events_url": "https://api.github.com/users/whitfin/events{/privacy}", "received_events_url": "https://api.github.com/users/whitfin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "whitfin", "id": 5376378, "node_id": "MDQ6VXNlcjUzNzYzNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/5376378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/whitfin", "html_url": "https://github.com/whitfin", "followers_url": "https://api.github.com/users/whitfin/followers", "following_url": "https://api.github.com/users/whitfin/following{/other_user}", "gists_url": "https://api.github.com/users/whitfin/gists{/gist_id}", "starred_url": "https://api.github.com/users/whitfin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/whitfin/subscriptions", "organizations_url": "https://api.github.com/users/whitfin/orgs", "repos_url": "https://api.github.com/users/whitfin/repos", "events_url": "https://api.github.com/users/whitfin/events{/privacy}", "received_events_url": "https://api.github.com/users/whitfin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c83422a5bdf8eacd4bbc727fb880b99ed66b04f", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c83422a5bdf8eacd4bbc727fb880b99ed66b04f", "html_url": "https://github.com/rust-lang/rust/commit/5c83422a5bdf8eacd4bbc727fb880b99ed66b04f"}], "stats": {"total": 43, "additions": 23, "deletions": 20}, "files": [{"sha": "ababce69e3170d850e939df33dfefdc3b4039ad6", "filename": "src/librustc_incremental/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Flib.rs?ref=0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "patch": "@@ -36,9 +36,9 @@ pub use persist::dep_graph_tcx_init;\n pub use persist::load_dep_graph;\n pub use persist::load_query_result_cache;\n pub use persist::LoadResult;\n-pub use persist::create_trans_partition;\n+pub use persist::copy_cgu_workproducts_to_incr_comp_cache_dir;\n pub use persist::save_dep_graph;\n-pub use persist::save_work_products;\n+pub use persist::save_work_product_index;\n pub use persist::in_incr_comp_dir;\n pub use persist::prepare_session_directory;\n pub use persist::finalize_session_directory;"}, {"sha": "e1f00db56d5cbc0572214a3a15d94941e7a8b09e", "filename": "src/librustc_incremental/persist/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Fpersist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Fpersist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fmod.rs?ref=0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "patch": "@@ -29,6 +29,6 @@ pub use self::load::load_dep_graph;\n pub use self::load::load_query_result_cache;\n pub use self::load::LoadResult;\n pub use self::save::save_dep_graph;\n-pub use self::save::save_work_products;\n-pub use self::work_product::create_trans_partition;\n+pub use self::save::save_work_product_index;\n+pub use self::work_product::copy_cgu_workproducts_to_incr_comp_cache_dir;\n pub use self::work_product::delete_workproduct_files;"}, {"sha": "be725b17933215661af70724ba01e6b4c432a7b7", "filename": "src/librustc_incremental/persist/save.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs?ref=0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "patch": "@@ -55,17 +55,17 @@ pub fn save_dep_graph<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>) {\n     })\n }\n \n-pub fn save_work_products(sess: &Session,\n-                          dep_graph: &DepGraph,\n-                          new_work_products: FxHashMap<WorkProductId, WorkProduct>) {\n+pub fn save_work_product_index(sess: &Session,\n+                               dep_graph: &DepGraph,\n+                               new_work_products: FxHashMap<WorkProductId, WorkProduct>) {\n     if sess.opts.incremental.is_none() {\n         return;\n     }\n \n-    debug!(\"save_work_products()\");\n+    debug!(\"save_work_product_index()\");\n     dep_graph.assert_ignored();\n     let path = work_products_path(sess);\n-    save_in(sess, path, |e| encode_work_products(&new_work_products, e));\n+    save_in(sess, path, |e| encode_work_product_index(&new_work_products, e));\n \n     // We also need to clean out old work-products, as not all of them are\n     // deleted during invalidation. Some object files don't change their\n@@ -234,8 +234,8 @@ fn encode_dep_graph(tcx: TyCtxt,\n     Ok(())\n }\n \n-fn encode_work_products(work_products: &FxHashMap<WorkProductId, WorkProduct>,\n-                        encoder: &mut Encoder) -> io::Result<()> {\n+fn encode_work_product_index(work_products: &FxHashMap<WorkProductId, WorkProduct>,\n+                             encoder: &mut Encoder) -> io::Result<()> {\n     let serialized_products: Vec<_> = work_products\n         .iter()\n         .map(|(id, work_product)| {"}, {"sha": "d163ad1f3f322b6c9dc69aefb2e1bcf07f2d326a", "filename": "src/librustc_incremental/persist/work_product.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Fpersist%2Fwork_product.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_incremental%2Fpersist%2Fwork_product.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fwork_product.rs?ref=0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "patch": "@@ -17,10 +17,11 @@ use rustc::util::fs::link_or_copy;\n use std::path::PathBuf;\n use std::fs as std_fs;\n \n-pub fn create_trans_partition(sess: &Session,\n-                              cgu_name: &str,\n-                              files: &[(WorkProductFileKind, PathBuf)])\n-                                -> Option<(WorkProductId, WorkProduct)> {\n+pub fn copy_cgu_workproducts_to_incr_comp_cache_dir(\n+    sess: &Session,\n+    cgu_name: &str,\n+    files: &[(WorkProductFileKind, PathBuf)]\n+) -> Option<(WorkProductId, WorkProduct)> {\n     debug!(\"create_trans_partition({:?},{:?})\",\n            cgu_name,\n            files);"}, {"sha": "888173d4fc515053a7c2173f5e7d0db6c78dcbe8", "filename": "src/librustc_trans/back/write.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fwrite.rs?ref=0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "patch": "@@ -17,7 +17,7 @@ use back::linker::LinkerInfo;\n use back::symbol_export::ExportedSymbols;\n use base;\n use consts;\n-use rustc_incremental::{create_trans_partition, in_incr_comp_dir};\n+use rustc_incremental::{copy_cgu_workproducts_to_incr_comp_cache_dir, in_incr_comp_dir};\n use rustc::dep_graph::{WorkProduct, WorkProductId, WorkProductFileKind};\n use rustc::middle::cstore::{LinkMeta, EncodedMetadata};\n use rustc::session::config::{self, OutputFilenames, OutputType, Passes, SomePasses,\n@@ -1021,7 +1021,7 @@ pub fn start_async_translation(tcx: TyCtxt,\n     }\n }\n \n-fn generate_module_artifacts(\n+fn copy_all_cgu_workproducts_to_incr_comp_cache_dir(\n     sess: &Session,\n     compiled_modules: &CompiledModules\n ) -> FxHashMap<WorkProductId, WorkProduct> {\n@@ -1044,7 +1044,8 @@ fn generate_module_artifacts(\n             files.push((WorkProductFileKind::BytecodeCompressed, path.clone()));\n         }\n \n-        if let Some((id, product)) = create_trans_partition(sess, &module.name, &files) {\n+        if let Some((id, product)) =\n+                copy_cgu_workproducts_to_incr_comp_cache_dir(sess, &module.name, &files) {\n             work_products.insert(id, product);\n         }\n     }\n@@ -2265,7 +2266,8 @@ impl OngoingCrateTranslation {\n             time_graph.dump(&format!(\"{}-timings\", self.crate_name));\n         }\n \n-        let work_products = generate_module_artifacts(sess, &compiled_modules);\n+        let work_products = copy_all_cgu_workproducts_to_incr_comp_cache_dir(sess,\n+                                                                             &compiled_modules);\n \n         produce_final_output_artifacts(sess,\n                                        &compiled_modules,"}, {"sha": "30780b8c965637704a683b5e16552ecd4e8bc0d6", "filename": "src/librustc_trans/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_trans%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4fbe326a4a05ff01d07d362cc554bd8414ce89/src%2Flibrustc_trans%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Flib.rs?ref=0a4fbe326a4a05ff01d07d362cc554bd8414ce89", "patch": "@@ -221,7 +221,7 @@ impl TransCrate for LlvmTransCrate {\n \n         time(sess,\n              \"serialize work products\",\n-             move || rustc_incremental::save_work_products(sess, &dep_graph, work_products));\n+             move || rustc_incremental::save_work_product_index(sess, &dep_graph, work_products));\n \n         sess.compile_status()?;\n "}]}