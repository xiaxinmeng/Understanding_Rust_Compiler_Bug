{"sha": "fa14f22fcb260ca0bc7dca395b456ea14bcde712", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhMTRmMjJmY2IyNjBjYTBiYzdkY2EzOTViNDU2ZWExNGJjZGU3MTI=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-11-26T13:02:01Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-11-26T20:59:45Z"}, "message": "Improve rustdoc JS tests error output", "tree": {"sha": "9ff79486a91140bfb303eacf15f7b9db61047b1b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9ff79486a91140bfb303eacf15f7b9db61047b1b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fa14f22fcb260ca0bc7dca395b456ea14bcde712", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fa14f22fcb260ca0bc7dca395b456ea14bcde712", "html_url": "https://github.com/rust-lang/rust/commit/fa14f22fcb260ca0bc7dca395b456ea14bcde712", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fa14f22fcb260ca0bc7dca395b456ea14bcde712/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "53d19b37c514246acab020eaba9527cb97c421cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/53d19b37c514246acab020eaba9527cb97c421cf", "html_url": "https://github.com/rust-lang/rust/commit/53d19b37c514246acab020eaba9527cb97c421cf"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "63f2d2f5d2f684b2abb3a8035a7ef547561915f5", "filename": "src/tools/rustdoc-js/tester.js", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/fa14f22fcb260ca0bc7dca395b456ea14bcde712/src%2Ftools%2Frustdoc-js%2Ftester.js", "raw_url": "https://github.com/rust-lang/rust/raw/fa14f22fcb260ca0bc7dca395b456ea14bcde712/src%2Ftools%2Frustdoc-js%2Ftester.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustdoc-js%2Ftester.js?ref=fa14f22fcb260ca0bc7dca395b456ea14bcde712", "patch": "@@ -190,6 +190,30 @@ function loadThings(thingsToLoad, kindOfLoad, funcToCall, fileContent) {\n     return content;\n }\n \n+function contentToDiffLine(key, value) {\n+    return `\"${key}\": \"${value}\",`;\n+}\n+\n+// This function is only called when no matching result was found and therefore will only display\n+// the diff between the two items.\n+function betterLookingDiff(entry, data) {\n+    let output = ' {\\n';\n+    let spaces = '     ';\n+    for (let key in entry) {\n+        if (!entry.hasOwnProperty(key)) {\n+            continue;\n+        }\n+        let value = data[key];\n+        if (value !== entry[key]) {\n+            output += '-' + spaces + contentToDiffLine(key, entry[key]) + '\\n';\n+            output += '+' + spaces + contentToDiffLine(key, value) + '\\n';\n+        } else {\n+            output += spaces + contentToDiffLine(key, value) + '\\n';\n+        }\n+    }\n+    return output + ' }';\n+}\n+\n function lookForEntry(entry, data) {\n     for (var i = 0; i < data.length; ++i) {\n         var allGood = true;\n@@ -281,6 +305,13 @@ function runSearch(query, expected, index, loaded, loadedFile, queryName) {\n             if (entry_pos === null) {\n                 error_text.push(queryName + \"==> Result not found in '\" + key + \"': '\" +\n                                 JSON.stringify(entry[i]) + \"'\");\n+                // By default, we just compare the two first items.\n+                let item_to_diff = 0;\n+                if ((ignore_order === false || exact_check === true) && i < results[key].length) {\n+                    item_to_diff = i;\n+                }\n+                error_text.push(\"Diff of first error:\\n\" +\n+                    betterLookingDiff(entry[i], results[key][item_to_diff]));\n             } else if (exact_check === true && prev_pos + 1 !== entry_pos) {\n                 error_text.push(queryName + \"==> Exact check failed at position \" + (prev_pos + 1) +\n                                 \": expected '\" + JSON.stringify(entry[i]) + \"' but found '\" +"}]}