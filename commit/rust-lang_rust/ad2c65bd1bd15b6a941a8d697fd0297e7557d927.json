{"sha": "ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkMmM2NWJkMWJkMTViNmE5NDFhOGQ2OTdmZDAyOTdlNzU1N2Q5Mjc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2019-04-15T21:39:41Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2019-04-15T21:39:41Z"}, "message": "Also suggest .copied() when .clone() is called on a Copy type", "tree": {"sha": "14a031900e799887a4803ad3f65493a1837695c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/14a031900e799887a4803ad3f65493a1837695c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "html_url": "https://github.com/rust-lang/rust/commit/ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2f7ae70ae07f039321b35a1f9f48585e8ddc9bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/d2f7ae70ae07f039321b35a1f9f48585e8ddc9bd", "html_url": "https://github.com/rust-lang/rust/commit/d2f7ae70ae07f039321b35a1f9f48585e8ddc9bd"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "cb504e651e47adf3a43c81dcbb51009c2c4ebf70", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "patch": "@@ -1,6 +1,6 @@\n use crate::utils::paths;\n use crate::utils::{\n-    in_macro, match_trait_method, match_type, remove_blocks, snippet_with_applicability, span_lint_and_sugg,\n+    in_macro, match_trait_method, match_type, remove_blocks, snippet_with_applicability, span_lint_and_sugg, is_copy\n };\n use if_chain::if_chain;\n use rustc::hir;\n@@ -88,8 +88,9 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n                                     && match_trait_method(cx, closure_expr, &paths::CLONE_TRAIT) {\n \n                                     let obj_ty = cx.tables.expr_ty(&obj[0]);\n-                                    if let ty::Ref(..) = obj_ty.sty {\n-                                        lint(cx, e.span, args[0].span, false);\n+                                    if let ty::Ref(_, ty, _) = obj_ty.sty {\n+                                        let copy = is_copy(cx, ty);\n+                                        lint(cx, e.span, args[0].span, copy);\n                                     } else {\n                                         lint_needless_cloning(cx, e.span, args[0].span);\n                                     }"}, {"sha": "4991f010547b13d203042490358535e5c9066e18", "filename": "tests/ui/map_clone.fixed", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/tests%2Fui%2Fmap_clone.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/tests%2Fui%2Fmap_clone.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.fixed?ref=ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "patch": "@@ -11,6 +11,7 @@ fn main() {\n     let _: Vec<String> = vec![String::new()].iter().cloned().collect();\n     let _: Vec<u32> = vec![42, 43].iter().copied().collect();\n     let _: Option<u64> = Some(Box::new(16)).map(|b| *b);\n+    let _: Vec<u8> = vec![1; 6].iter().copied().collect();\n \n     // Don't lint these\n     let v = vec![5_i8; 6];"}, {"sha": "1f18fcf6398c0056a21c0ad0ef5f79d7a19bf95a", "filename": "tests/ui/map_clone.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/tests%2Fui%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/tests%2Fui%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.rs?ref=ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "patch": "@@ -11,6 +11,7 @@ fn main() {\n     let _: Vec<String> = vec![String::new()].iter().map(|x| x.clone()).collect();\n     let _: Vec<u32> = vec![42, 43].iter().map(|&x| x).collect();\n     let _: Option<u64> = Some(Box::new(16)).map(|b| *b);\n+    let _: Vec<u8> = vec![1; 6].iter().map(|x| x.clone()).collect();\n \n     // Don't lint these\n     let v = vec![5_i8; 6];"}, {"sha": "b1a165a4253269109979996cbef2364195410c41", "filename": "tests/ui/map_clone.stderr", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/tests%2Fui%2Fmap_clone.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ad2c65bd1bd15b6a941a8d697fd0297e7557d927/tests%2Fui%2Fmap_clone.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.stderr?ref=ad2c65bd1bd15b6a941a8d697fd0297e7557d927", "patch": "@@ -18,11 +18,17 @@ error: You are using an explicit closure for copying elements\n LL |     let _: Vec<u32> = vec![42, 43].iter().map(|&x| x).collect();\n    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: Consider calling the dedicated `copied` method: `vec![42, 43].iter().copied()`\n \n+error: You are using an explicit closure for copying elements\n+  --> $DIR/map_clone.rs:14:22\n+   |\n+LL |     let _: Vec<u8> = vec![1; 6].iter().map(|x| x.clone()).collect();\n+   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: Consider calling the dedicated `copied` method: `vec![1; 6].iter().copied()`\n+\n error: You are needlessly cloning iterator elements\n-  --> $DIR/map_clone.rs:24:29\n+  --> $DIR/map_clone.rs:25:29\n    |\n LL |     let _ = std::env::args().map(|v| v.clone());\n    |                             ^^^^^^^^^^^^^^^^^^^ help: Remove the map call\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 5 previous errors\n "}]}