{"sha": "1664ebb18ba1d50fc2b77daef5a496b167f9fad0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2NjRlYmIxOGJhMWQ1MGZjMmI3N2RhZWY1YTQ5NmIxNjdmOWZhZDA=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-11-11T14:14:24Z"}, "committer": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-11-11T14:14:24Z"}, "message": "Return 'None' when macro call snippet from source exceeds max width", "tree": {"sha": "4d352279fbee5c337c0b8532fbbeb4c34b703bd3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4d352279fbee5c337c0b8532fbbeb4c34b703bd3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1664ebb18ba1d50fc2b77daef5a496b167f9fad0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1664ebb18ba1d50fc2b77daef5a496b167f9fad0", "html_url": "https://github.com/rust-lang/rust/commit/1664ebb18ba1d50fc2b77daef5a496b167f9fad0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1664ebb18ba1d50fc2b77daef5a496b167f9fad0/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "881c5b5a6dd8d22a184c5f2cfb2f054ad0d2a113", "url": "https://api.github.com/repos/rust-lang/rust/commits/881c5b5a6dd8d22a184c5f2cfb2f054ad0d2a113", "html_url": "https://github.com/rust-lang/rust/commit/881c5b5a6dd8d22a184c5f2cfb2f054ad0d2a113"}], "stats": {"total": 13, "additions": 8, "deletions": 5}, "files": [{"sha": "6cbbcc5c466e7932fe281dc9b666be309150a5c8", "filename": "src/expr.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/1664ebb18ba1d50fc2b77daef5a496b167f9fad0/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1664ebb18ba1d50fc2b77daef5a496b167f9fad0/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=1664ebb18ba1d50fc2b77daef5a496b167f9fad0", "patch": "@@ -35,7 +35,7 @@ use types::{can_be_overflowed_type, rewrite_path, PathContext};\n use utils::{colon_spaces, contains_skip, extra_offset, first_line_width, inner_attributes,\n             last_line_extendable, last_line_width, left_most_sub_expr, mk_sp, outer_attributes,\n             paren_overhead, ptr_vec_to_ref_vec, semicolon_for_stmt, stmt_expr,\n-            trimmed_last_line_width};\n+            trimmed_last_line_width, wrap_str};\n use vertical::rewrite_with_alignment;\n use visitor::FmtVisitor;\n \n@@ -168,10 +168,13 @@ pub fn format_expr(\n         ast::ExprKind::TupField(..) |\n         ast::ExprKind::MethodCall(..) => rewrite_chain(expr, context, shape),\n         ast::ExprKind::Mac(ref mac) => {\n-            // Failure to rewrite a macro should not imply failure to\n-            // rewrite the expression.\n-            rewrite_macro(mac, None, context, shape, MacroPosition::Expression)\n-                .or_else(|| Some(context.snippet(expr.span)))\n+            rewrite_macro(mac, None, context, shape, MacroPosition::Expression).or_else(|| {\n+                wrap_str(\n+                    context.snippet(expr.span),\n+                    context.config.max_width(),\n+                    shape,\n+                )\n+            })\n         }\n         ast::ExprKind::Ret(None) => Some(\"return\".to_owned()),\n         ast::ExprKind::Ret(Some(ref expr)) => {"}]}