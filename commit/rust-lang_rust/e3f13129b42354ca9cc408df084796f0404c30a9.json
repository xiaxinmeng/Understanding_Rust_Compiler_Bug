{"sha": "e3f13129b42354ca9cc408df084796f0404c30a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzZjEzMTI5YjQyMzU0Y2E5Y2M0MDhkZjA4NDc5NmYwNDA0YzMwYTk=", "commit": {"author": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2016-05-01T17:23:29Z"}, "committer": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2016-05-01T17:33:58Z"}, "message": "dep_graph: avoid panicking in thread when channel closed\n\nOn my system, when the processor is already loaded, and I try to\nrun the test suite, e.g. compile-fail/dep-graph-assoc-type-trans.rs\nfails because of undecodable JSON.\n\nRunning the compiler manually, I can see that the dep graph thread\npanics (and puts non-JSON on stderr) while `send`ing on `swap_out`,\npresumably because the other end has already quit.  I think that in\nthis case, we can just gracefully exit the thread.", "tree": {"sha": "f70e8f9fcf6f9b94e3a14471326d6f71bb2c2c32", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f70e8f9fcf6f9b94e3a14471326d6f71bb2c2c32"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3f13129b42354ca9cc408df084796f0404c30a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3f13129b42354ca9cc408df084796f0404c30a9", "html_url": "https://github.com/rust-lang/rust/commit/e3f13129b42354ca9cc408df084796f0404c30a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3f13129b42354ca9cc408df084796f0404c30a9/comments", "author": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "committer": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a815a26c8ce70e1aede585827c020d9775a8faf", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a815a26c8ce70e1aede585827c020d9775a8faf", "html_url": "https://github.com/rust-lang/rust/commit/2a815a26c8ce70e1aede585827c020d9775a8faf"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "b15e0e33b84026cdc384685b8d1e81cf4528290e", "filename": "src/librustc/dep_graph/thread.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e3f13129b42354ca9cc408df084796f0404c30a9/src%2Flibrustc%2Fdep_graph%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3f13129b42354ca9cc408df084796f0404c30a9/src%2Flibrustc%2Fdep_graph%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fthread.rs?ref=e3f13129b42354ca9cc408df084796f0404c30a9", "patch": "@@ -176,6 +176,9 @@ pub fn main(swap_in: Receiver<Vec<DepMessage>>,\n                 DepMessage::Query => query_out.send(edges.query()).unwrap(),\n             }\n         }\n-        swap_out.send(messages).unwrap();\n+        if let Err(_) = swap_out.send(messages) {\n+            // the receiver must have been dropped already\n+            break;\n+        }\n     }\n }"}]}