{"sha": "6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZkNmNjYjc1ZmYyMjQwZWQyOTRmY2Y2YWE1N2U5NmM3MjMxNjk1NGM=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-11-17T01:07:32Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-11-30T02:36:14Z"}, "message": "Add a new run-make test directory\n\nThis infrastructure is meant to support runnings tests that involve various\ninteresting interdependencies about the types of crates being linked or possibly\ninteracting with C libraries. The goal of these make tests is to not restrict\nthem to a particular test runner, but allow each test to run its own tests.\n\nTo this end, there is a new src/test/run-make directory which has sub-folders of\ntests. Each test requires a `Makefile`, and running the tests constitues simply\nrunning `make` inside the directory. The new target is `check-stageN-rmake`.\n\nThese tests will have the destination directory (as TMPDIR) and the local rust\ncompiler (as RUSTC) passed along to them. There is also some helpful\ncross-platform utilities included in src/test/run-make/tools.mk to aid with\ncompiling C programs and running them.\n\nThe impetus for adding this new test suite is to allow various interesting forms\nof testing rust linkage. All of the tests initially added are various flavors of\ncompiling Rust and C with one another as well as just making sure that rust\nlinkage works in general.\n\nCloses #10434", "tree": {"sha": "ae07356d883d3d076460b5a0a821e2b93f554e2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ae07356d883d3d076460b5a0a821e2b93f554e2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "html_url": "https://github.com/rust-lang/rust/commit/6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fbba7b2eeabd073f9518f2dbd50f4eabb621c67", "url": "https://api.github.com/repos/rust-lang/rust/commits/9fbba7b2eeabd073f9518f2dbd50f4eabb621c67", "html_url": "https://github.com/rust-lang/rust/commit/9fbba7b2eeabd073f9518f2dbd50f4eabb621c67"}], "stats": {"total": 435, "additions": 433, "deletions": 2}, "files": [{"sha": "5b021eb48f15fafa5a64099a676e5aab61fc3049", "filename": "mk/tests.mk", "status": "modified", "additions": 37, "deletions": 2, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -193,7 +193,7 @@ check-lite: cleantestlibs cleantmptestlogs \\\n \tcheck-stage2-std check-stage2-extra check-stage2-rpass \\\n \tcheck-stage2-rustuv \\\n \tcheck-stage2-rustpkg \\\n-\tcheck-stage2-rfail check-stage2-cfail\n+\tcheck-stage2-rfail check-stage2-cfail check-stage2-rmake\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n .PHONY: cleantmptestlogs cleantestlibs\n@@ -284,7 +284,8 @@ check-stage$(1)-T-$(2)-H-$(3)-exec:     \t\t\t\t\\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-rfail-exec\t\t\t\\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-cfail-exec\t\t\t\\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-rpass-full-exec\t\t\t\\\n-        check-stage$(1)-T-$(2)-H-$(3)-crates-exec                      \\\n+\tcheck-stage$(1)-T-$(2)-H-$(3)-rmake-exec\t\t\t\\\n+        check-stage$(1)-T-$(2)-H-$(3)-crates-exec                       \\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-bench-exec\t\t\t\\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-debuginfo-exec \\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-codegen-exec \\\n@@ -770,6 +771,7 @@ TEST_GROUPS = \\\n \tcfail \\\n \tbench \\\n \tperf \\\n+\trmake \\\n \tdebuginfo \\\n \tcodegen \\\n \tdoc \\\n@@ -900,3 +902,36 @@ endef\n \n $(foreach host,$(CFG_HOST),\t\t\t\\\n  $(eval $(call DEF_CHECK_FAST_FOR_H,$(host))))\n+\n+RMAKE_TESTS := $(shell ls -d $(S)src/test/run-make/*/)\n+RMAKE_TESTS := $(RMAKE_TESTS:$(S)src/test/run-make/%/=%)\n+\n+define DEF_RMAKE_FOR_T_H\n+# $(1) the stage\n+# $(2) target triple\n+# $(3) host triple\n+\n+check-stage$(1)-T-$(2)-H-$(3)-rmake-exec: \\\n+\t\t$$(call TEST_OK_FILE,$(1),$(2),$(3),rmake)\n+\n+$$(call TEST_OK_FILE,$(1),$(2),$(3),rmake): \\\n+\t\t$$(RMAKE_TESTS:%=$(3)/test/run-make/%-$(1)-T-$(2)-H-$(3).ok)\n+\t@touch $$@\n+\n+$(3)/test/run-make/%-$(1)-T-$(2)-H-$(3).ok: \\\n+\t\t$(S)src/test/run-make/%/Makefile \\\n+\t\t$$(HBIN$(1)_H_$(3))/rustc$$(X_$(3))\n+\t@rm -rf $(3)/test/run-make/$$*\n+\t@mkdir -p $(3)/test/run-make/$$*\n+\t@echo maketest: $$*\n+\t@python $(S)src/etc/maketest.py $$(dir $$<) \\\n+\t    $$(HBIN$(1)_H_$(3))/rustc$$(X_$(3)) \\\n+\t    $(3)/test/run-make/$$*\n+\t@touch $$@\n+\n+endef\n+\n+$(foreach stage,$(STAGES), \\\n+ $(foreach target,$(CFG_TARGET), \\\n+  $(foreach host,$(CFG_HOST), \\\n+   $(eval $(call DEF_RMAKE_FOR_T_H,$(stage),$(target),$(host))))))"}, {"sha": "d42bf06565767c670f2adaf6eceaf6c14a15c5b8", "filename": "src/etc/maketest.py", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Fetc%2Fmaketest.py", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Fetc%2Fmaketest.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmaketest.py?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,26 @@\n+# xfail-license\n+\n+import subprocess\n+import os\n+import sys\n+\n+os.putenv('RUSTC', os.path.abspath(sys.argv[2]))\n+os.putenv('TMPDIR', os.path.abspath(sys.argv[3]))\n+\n+proc = subprocess.Popen(['make', '-C', sys.argv[1]],\n+                        stdout = subprocess.PIPE,\n+                        stderr = subprocess.PIPE)\n+out, err = proc.communicate()\n+i = proc.wait()\n+\n+if i != 0:\n+\n+    print '----- ' + sys.argv[1] + \"\"\" --------------------\n+------ stdout ---------------------------------------------\n+\"\"\" + out + \"\"\"\n+------ stderr ---------------------------------------------\n+\"\"\" + err + \"\"\"\n+------        ---------------------------------------------\n+\"\"\"\n+    sys.exit(i)\n+"}, {"sha": "2b2e5d56e92da29cf4b51e0821c714c8c75cfc93", "filename": "src/test/run-make/c-dynamic-dylib/Makefile", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,14 @@\n+-include ../tools.mk\n+\n+# This hits an assertion in the linker on older versions of osx apparently\n+ifeq ($(shell uname),Darwin)\n+all:\n+\techo ignored\n+else\n+all: $(call DYLIB,cfoo)\n+\t$(RUSTC) foo.rs\n+\t$(RUSTC) bar.rs\n+\t$(call RUN,bar)\n+\trm $(TMPDIR)/$(call DYLIB_GLOB,cfoo)\n+\t$(call FAIL,bar)\n+endif"}, {"sha": "7c4aca1e02807885ec0f5a96d4b676de49616ce3", "filename": "src/test/run-make/c-dynamic-dylib/bar.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod foo;\n+\n+fn main() {\n+    foo::rsfoo();\n+}"}, {"sha": "9fe07f82f9ed1495b13e4e4dcd2e092115b01b25", "filename": "src/test/run-make/c-dynamic-dylib/cfoo.c", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Fcfoo.c", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Fcfoo.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Fcfoo.c?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+int foo() { return 0; }"}, {"sha": "0c4a6f7df4b3ccea6c08dce0136132bf6780926a", "filename": "src/test/run-make/c-dynamic-dylib/foo.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-dylib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,10 @@\n+#[crate_type = \"dylib\"];\n+\n+#[link(name = \"cfoo\")]\n+extern {\n+    fn foo();\n+}\n+\n+pub fn rsfoo() {\n+    unsafe { foo() }\n+}"}, {"sha": "18992703b2c8517a5df4b75ea4b5f54016f22360", "filename": "src/test/run-make/c-dynamic-rlib/Makefile", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,14 @@\n+-include ../tools.mk\n+\n+# This hits an assertion in the linker on older versions of osx apparently\n+ifeq ($(shell uname),Darwin)\n+all:\n+\techo ignored\n+else\n+all: $(call DYLIB,cfoo)\n+\t$(RUSTC) foo.rs\n+\t$(RUSTC) bar.rs\n+\tLD_LIBRARY_PATH=$(TMPDIR) $(call RUN,bar)\n+\trm $(TMPDIR)/$(call DYLIB_GLOB,cfoo)\n+\t$(call FAIL,bar)\n+endif"}, {"sha": "7c4aca1e02807885ec0f5a96d4b676de49616ce3", "filename": "src/test/run-make/c-dynamic-rlib/bar.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod foo;\n+\n+fn main() {\n+    foo::rsfoo();\n+}"}, {"sha": "9fe07f82f9ed1495b13e4e4dcd2e092115b01b25", "filename": "src/test/run-make/c-dynamic-rlib/cfoo.c", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Fcfoo.c", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Fcfoo.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Fcfoo.c?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+int foo() { return 0; }"}, {"sha": "e64811af9c763db21b3c69552d5de14980ffe579", "filename": "src/test/run-make/c-dynamic-rlib/foo.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-dynamic-rlib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,10 @@\n+#[crate_type = \"rlib\"];\n+\n+#[link(name = \"cfoo\")]\n+extern {\n+    fn foo();\n+}\n+\n+pub fn rsfoo() {\n+    unsafe { foo() }\n+}"}, {"sha": "fb57a08a8261c91dddb393fd50424f7500648172", "filename": "src/test/run-make/c-link-to-rust-dylib/Makefile", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,9 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) foo.rs\n+\tln -s $(call DYLIB,foo-*) $(call DYLIB,foo)\n+\t$(CC) bar.c -lfoo -o $(call RUN,bar) -Wl,-rpath,$(TMPDIR)\n+\t$(call RUN,bar)\n+\trm $(call DYLIB,foo)\n+\t$(call FAIL,bar)"}, {"sha": "bb4036b06e13b79a32ec78ae04db97590f54b2cc", "filename": "src/test/run-make/c-link-to-rust-dylib/bar.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2Fbar.c", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2Fbar.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2Fbar.c?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,6 @@\n+void foo();\n+\n+int main() {\n+    foo();\n+    return 0;\n+}"}, {"sha": "6b6a786ef54a21eec2579c49ce787bbe1fbef7e3", "filename": "src/test/run-make/c-link-to-rust-dylib/foo.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-link-to-rust-dylib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"dylib\"];\n+\n+#[no_mangle]\n+pub extern \"C\" fn foo() {}"}, {"sha": "a81f19d6eb36bdf550b208c463b790cb2a0dcfc7", "filename": "src/test/run-make/c-link-to-rust-staticlib/Makefile", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,13 @@\n+-include ../tools.mk\n+\n+ifneq ($(shell uname),Darwin)\n+\tEXTRAFLAGS := -lm -lrt -ldl -lpthread\n+endif\n+\n+all:\n+\t$(RUSTC) foo.rs -Z gen-crate-map\n+\tln -s $(call STATICLIB,foo-*) $(call STATICLIB,foo)\n+\t$(CC) bar.c -lfoo -o $(call RUN,bar) $(EXTRAFLAGS) -lstdc++ \n+\t$(call RUN,bar)\n+\trm $(call STATICLIB,foo*)\n+\t$(call RUN,bar)"}, {"sha": "bb4036b06e13b79a32ec78ae04db97590f54b2cc", "filename": "src/test/run-make/c-link-to-rust-staticlib/bar.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2Fbar.c", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2Fbar.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2Fbar.c?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,6 @@\n+void foo();\n+\n+int main() {\n+    foo();\n+    return 0;\n+}"}, {"sha": "3da09eb6bb6a87b0eca9600106ec86af9b37cd6c", "filename": "src/test/run-make/c-link-to-rust-staticlib/foo.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"staticlib\"];\n+\n+#[no_mangle]\n+pub extern \"C\" fn foo() {}"}, {"sha": "62d9c8e90f21a452c84f28ed0102f847e70c50b0", "filename": "src/test/run-make/c-static-dylib/Makefile", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-dylib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,9 @@\n+-include ../tools.mk\n+\n+all: $(call STATICLIB,cfoo)\n+\t$(RUSTC) foo.rs\n+\t$(RUSTC) bar.rs\n+\trm $(TMPDIR)/$(call STATICLIB_GLOB,cfoo)\n+\t$(call RUN,bar)\n+\trm $(TMPDIR)/$(call DYLIB_GLOB,foo)\n+\t$(call FAIL,bar)"}, {"sha": "7c4aca1e02807885ec0f5a96d4b676de49616ce3", "filename": "src/test/run-make/c-static-dylib/bar.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-dylib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod foo;\n+\n+fn main() {\n+    foo::rsfoo();\n+}"}, {"sha": "9fe07f82f9ed1495b13e4e4dcd2e092115b01b25", "filename": "src/test/run-make/c-static-dylib/cfoo.c", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2Fcfoo.c", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2Fcfoo.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-dylib%2Fcfoo.c?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+int foo() { return 0; }"}, {"sha": "0c4a6f7df4b3ccea6c08dce0136132bf6780926a", "filename": "src/test/run-make/c-static-dylib/foo.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-dylib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-dylib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,10 @@\n+#[crate_type = \"dylib\"];\n+\n+#[link(name = \"cfoo\")]\n+extern {\n+    fn foo();\n+}\n+\n+pub fn rsfoo() {\n+    unsafe { foo() }\n+}"}, {"sha": "09eb4b1249e53515279bd25cddd859b7da8d84ae", "filename": "src/test/run-make/c-static-rlib/Makefile", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-rlib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,8 @@\n+-include ../tools.mk\n+\n+all: $(call STATICLIB,cfoo)\n+\t$(RUSTC) foo.rs\n+\t$(RUSTC) bar.rs\n+\trm $(TMPDIR)/$(call RLIB_GLOB,foo)\n+\trm $(TMPDIR)/$(call STATICLIB_GLOB,cfoo)\n+\t$(call RUN,bar)"}, {"sha": "7c4aca1e02807885ec0f5a96d4b676de49616ce3", "filename": "src/test/run-make/c-static-rlib/bar.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-rlib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod foo;\n+\n+fn main() {\n+    foo::rsfoo();\n+}"}, {"sha": "9fe07f82f9ed1495b13e4e4dcd2e092115b01b25", "filename": "src/test/run-make/c-static-rlib/cfoo.c", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2Fcfoo.c", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2Fcfoo.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-rlib%2Fcfoo.c?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+int foo() { return 0; }"}, {"sha": "e64811af9c763db21b3c69552d5de14980ffe579", "filename": "src/test/run-make/c-static-rlib/foo.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fc-static-rlib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-static-rlib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,10 @@\n+#[crate_type = \"rlib\"];\n+\n+#[link(name = \"cfoo\")]\n+extern {\n+    fn foo();\n+}\n+\n+pub fn rsfoo() {\n+    unsafe { foo() }\n+}"}, {"sha": "e60e904240d188b410071832a1abb0dff77f4668", "filename": "src/test/run-make/dylib-chain/Makefile", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fdylib-chain%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,12 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) m1.rs\n+\t$(RUSTC) m2.rs\n+\t$(RUSTC) m3.rs\n+\t$(RUSTC) m4.rs\n+\t$(call RUN,m4)\n+\trm $(TMPDIR)/$(call DYLIB_GLOB,m1)\n+\trm $(TMPDIR)/$(call DYLIB_GLOB,m2)\n+\trm $(TMPDIR)/$(call DYLIB_GLOB,m3)\n+\t$(call FAIL,m4)"}, {"sha": "69ea8dcecfc6b9d508190c324cd7b8e8ec1c83db", "filename": "src/test/run-make/dylib-chain/m1.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm1.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,2 @@\n+#[crate_type = \"dylib\"];\n+pub fn m1() {}"}, {"sha": "2f5d75a3872cf022a96dd58fd6e523244b406ed5", "filename": "src/test/run-make/dylib-chain/m2.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm2.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"dylib\"];\n+extern mod m1;\n+\n+pub fn m2() { m1::m1() }"}, {"sha": "cc4ff2cff74e16a0bacef0d5a92c4b49dea8b371", "filename": "src/test/run-make/dylib-chain/m3.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm3.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"dylib\"];\n+extern mod m2;\n+\n+pub fn m3() { m2::m2() }"}, {"sha": "c52d1f7fcbcd2be4fd16f04b87affd0b02811297", "filename": "src/test/run-make/dylib-chain/m4.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fdylib-chain%2Fm4.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,3 @@\n+extern mod m3;\n+\n+fn main() { m3::m3() }"}, {"sha": "9ab2abca72952b0480d8ed73254e13e2be9f4b30", "filename": "src/test/run-make/mixing-deps/Makefile", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-deps%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,7 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) both.rs\n+\t$(RUSTC) dylib.rs -Z prefer-dynamic\n+\t$(RUSTC) prog.rs\n+\t$(call RUN,prog)"}, {"sha": "89d7b6452c9095fbf3d646f40206313644e65540", "filename": "src/test/run-make/mixing-deps/both.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2Fboth.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2Fboth.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-deps%2Fboth.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"rlib\"];\n+#[crate_type = \"dylib\"];\n+\n+pub static foo: int = 4;"}, {"sha": "130bc2fe8032a20877469be001f6bd4de28d70d5", "filename": "src/test/run-make/mixing-deps/dylib.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2Fdylib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2Fdylib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-deps%2Fdylib.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,6 @@\n+#[crate_type = \"dylib\"];\n+extern mod both;\n+\n+use std::cast;\n+\n+pub fn addr() -> uint { unsafe { cast::transmute(&both::foo) } }"}, {"sha": "da90f8731f42d457f5cec6727f3fd90525a3958b", "filename": "src/test/run-make/mixing-deps/prog.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2Fprog.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-deps%2Fprog.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-deps%2Fprog.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,9 @@\n+extern mod dylib;\n+extern mod both;\n+\n+use std::cast;\n+\n+fn main() {\n+    assert_eq!(unsafe { cast::transmute::<&int, uint>(&both::foo) },\n+               dylib::addr());\n+}"}, {"sha": "eb00c80139092eb7fb7e6d1ce9c28d694bc639d7", "filename": "src/test/run-make/mixing-libs/Makefile", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-libs%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,9 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) rlib.rs\n+\t$(RUSTC) dylib.rs && exit 1 || exit 0\n+\t$(RUSTC) rlib.rs --dylib\n+\t$(RUSTC) dylib.rs\n+\trm $(call DYLIB,rlib-*)\n+\t$(RUSTC) prog.rs && exit 1 || exit 0"}, {"sha": "9652cb2764120a1ad0f32b3cb0b940ce6f1a7410", "filename": "src/test/run-make/mixing-libs/dylib.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2Fdylib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2Fdylib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-libs%2Fdylib.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"dylib\"];\n+extern mod rlib;\n+\n+pub fn dylib() { rlib::rlib() }"}, {"sha": "ec67dea0ab01375dd27b90793c667c9c9b5d1204", "filename": "src/test/run-make/mixing-libs/prog.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2Fprog.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2Fprog.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-libs%2Fprog.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,7 @@\n+extern mod dylib;\n+extern mod rlib;\n+\n+fn main() {\n+    dylib::dylib();\n+    rlib::rlib();\n+}"}, {"sha": "32c322f3f59dda6f7aae1fd6d92371d515c29914", "filename": "src/test/run-make/mixing-libs/rlib.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2Frlib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fmixing-libs%2Frlib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmixing-libs%2Frlib.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,2 @@\n+#[crate_type = \"rlib\"];\n+pub fn rlib() {}"}, {"sha": "8229547176a48be7750e24778e2dd4489a73a046", "filename": "src/test/run-make/prefer-dylib/Makefile", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-dylib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-dylib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprefer-dylib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,8 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) bar.rs --dylib --rlib\n+\t$(RUSTC) foo.rs -Z prefer-dynamic\n+\t$(call RUN,foo)\n+\trm $(TMPDIR)/*bar*\n+\t$(call FAILS,foo)"}, {"sha": "c5c0bc606cd699cda9d339035a1ca95bff4a70f4", "filename": "src/test/run-make/prefer-dylib/bar.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-dylib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-dylib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprefer-dylib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+pub fn bar() {}"}, {"sha": "f86ef62a9feef2f9399450b7d3c4e13233c6de06", "filename": "src/test/run-make/prefer-dylib/foo.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-dylib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-dylib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprefer-dylib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod bar;\n+\n+fn main() {\n+    bar::bar();\n+}"}, {"sha": "eedb70c4efdf025b8e81eea6aeaf1838ed9d041e", "filename": "src/test/run-make/prefer-rlib/Makefile", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-rlib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-rlib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprefer-rlib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,8 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) bar.rs --dylib --rlib\n+\tls $(TMPDIR)/$(call RLIB_GLOB,bar)\n+\t$(RUSTC) foo.rs\n+\trm $(TMPDIR)/*bar*\n+\t$(call RUN,foo)"}, {"sha": "c5c0bc606cd699cda9d339035a1ca95bff4a70f4", "filename": "src/test/run-make/prefer-rlib/bar.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-rlib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-rlib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprefer-rlib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+pub fn bar() {}"}, {"sha": "f86ef62a9feef2f9399450b7d3c4e13233c6de06", "filename": "src/test/run-make/prefer-rlib/foo.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-rlib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fprefer-rlib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprefer-rlib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod bar;\n+\n+fn main() {\n+    bar::bar();\n+}"}, {"sha": "30b6811a388cad6f463995fc0e1b77f1cc435aab", "filename": "src/test/run-make/rlib-chain/Makefile", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frlib-chain%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,10 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) m1.rs\n+\t$(RUSTC) m2.rs\n+\t$(RUSTC) m3.rs\n+\t$(RUSTC) m4.rs\n+\t$(call RUN,m4)\n+\trm $(TMPDIR)/*lib\n+\t$(call RUN,m4)"}, {"sha": "1a244efd4dda4eb9004e3d7da959be1043b9a149", "filename": "src/test/run-make/rlib-chain/m1.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frlib-chain%2Fm1.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,2 @@\n+#[crate_type = \"rlib\"];\n+pub fn m1() {}"}, {"sha": "96f771220838e338b4eacd4902001f6ed5ea6de4", "filename": "src/test/run-make/rlib-chain/m2.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frlib-chain%2Fm2.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"rlib\"];\n+extern mod m1;\n+\n+pub fn m2() { m1::m1() }"}, {"sha": "cb8d75291605a8985aa40f4956070a08065ba277", "filename": "src/test/run-make/rlib-chain/m3.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frlib-chain%2Fm3.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,4 @@\n+#[crate_type = \"rlib\"];\n+extern mod m2;\n+\n+pub fn m3() { m2::m2() }"}, {"sha": "c52d1f7fcbcd2be4fd16f04b87affd0b02811297", "filename": "src/test/run-make/rlib-chain/m4.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Frlib-chain%2Fm4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frlib-chain%2Fm4.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,3 @@\n+extern mod m3;\n+\n+fn main() { m3::m3() }"}, {"sha": "d4f215c69f07e50a058d66d07997ccbbd0d4c411", "filename": "src/test/run-make/simple-dylib/Makefile", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-dylib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-dylib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsimple-dylib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+-include ../tools.mk\n+all:\n+\t$(RUSTC) bar.rs --dylib\n+\t$(RUSTC) foo.rs\n+\t$(call RUN,foo)"}, {"sha": "c5c0bc606cd699cda9d339035a1ca95bff4a70f4", "filename": "src/test/run-make/simple-dylib/bar.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-dylib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-dylib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsimple-dylib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+pub fn bar() {}"}, {"sha": "f86ef62a9feef2f9399450b7d3c4e13233c6de06", "filename": "src/test/run-make/simple-dylib/foo.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-dylib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-dylib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsimple-dylib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod bar;\n+\n+fn main() {\n+    bar::bar();\n+}"}, {"sha": "e8909ef134bf5a6952ec8e999abca84e5cf8e5f8", "filename": "src/test/run-make/simple-rlib/Makefile", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-rlib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-rlib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsimple-rlib%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+-include ../tools.mk\n+all:\n+\t$(RUSTC) bar.rs --rlib\n+\t$(RUSTC) foo.rs\n+\t$(call RUN,foo)"}, {"sha": "c5c0bc606cd699cda9d339035a1ca95bff4a70f4", "filename": "src/test/run-make/simple-rlib/bar.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-rlib%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-rlib%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsimple-rlib%2Fbar.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1 @@\n+pub fn bar() {}"}, {"sha": "f86ef62a9feef2f9399450b7d3c4e13233c6de06", "filename": "src/test/run-make/simple-rlib/foo.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-rlib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fsimple-rlib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsimple-rlib%2Ffoo.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,5 @@\n+extern mod bar;\n+\n+fn main() {\n+    bar::bar();\n+}"}, {"sha": "cb0397442658df659765388617854b25dabf5d71", "filename": "src/test/run-make/static-unwinding/Makefile", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fstatic-unwinding%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fstatic-unwinding%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fstatic-unwinding%2FMakefile?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,6 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTC) lib.rs\n+\t$(RUSTC) main.rs\n+\t$(call RUN,main)"}, {"sha": "4e2cdb6c222165b1579eb70b91b29aa4395a5370", "filename": "src/test/run-make/static-unwinding/lib.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fstatic-unwinding%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fstatic-unwinding%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fstatic-unwinding%2Flib.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,15 @@\n+#[crate_type = \"rlib\"];\n+\n+pub static mut statik: int = 0;\n+\n+struct A;\n+impl Drop for A {\n+    fn drop(&mut self) {\n+        unsafe { statik = 1; }\n+    }\n+}\n+\n+pub fn callback(f: ||) {\n+    let _a = A;\n+    f();\n+}"}, {"sha": "029933a819cc55195a195e8aad9ccc4891e2673f", "filename": "src/test/run-make/static-unwinding/main.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fstatic-unwinding%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Fstatic-unwinding%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fstatic-unwinding%2Fmain.rs?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,25 @@\n+extern mod lib;\n+\n+use std::task;\n+\n+static mut statik: int = 0;\n+\n+struct A;\n+impl Drop for A {\n+    fn drop(&mut self) {\n+        unsafe { statik = 1; }\n+    }\n+}\n+\n+fn main() {\n+    do task::try {\n+        let _a = A;\n+        lib::callback(|| fail!());\n+        1\n+    };\n+\n+    unsafe {\n+        assert!(lib::statik == 1);\n+        assert!(statik == 1);\n+    }\n+}"}, {"sha": "9c7af7f52c1880d3639bc706e62965a2c5cf9964", "filename": "src/test/run-make/tools.mk", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Ftools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6d6ccb75ff2240ed294fcf6aa57e96c72316954c/src%2Ftest%2Frun-make%2Ftools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Ftools.mk?ref=6d6ccb75ff2240ed294fcf6aa57e96c72316954c", "patch": "@@ -0,0 +1,27 @@\n+RUSTC := $(RUSTC) --out-dir $(TMPDIR) -L $(TMPDIR)\n+CC := $(CC) -L $(TMPDIR)\n+\n+RUN = $(TMPDIR)/$(1)\n+FAILS = $(TMPDIR)/$(1) && exit 1 || exit 0\n+\n+RLIB_GLOB = lib$(1)*.rlib\n+STATICLIB = $(TMPDIR)/lib$(1).a\n+STATICLIB_GLOB = lib$(1)*.a\n+\n+ifeq ($(shell uname),Darwin)\n+DYLIB_GLOB = lib$(1)*.dylib\n+DYLIB = $(TMPDIR)/lib$(1).dylib\n+else\n+DYLIB_GLOB = lib$(1)*.so\n+DYLIB = $(TMPDIR)/lib$(1).so\n+endif\n+\n+%.a: %.o\n+\tar crus $@ $<\n+%.dylib: %.o\n+\tld -o $@ $< -dylib\n+%.so: %.o\n+\tld -o $@ $< -shared\n+$(TMPDIR)/lib%.o: %.c\n+\t$(CC) -c -o $@ $<\n+"}]}