{"sha": "aa265869baf55d59d310edf76fef50026d7c70e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhMjY1ODY5YmFmNTVkNTlkMzEwZWRmNzZmZWY1MDAyNmQ3YzcwZTM=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-01-05T18:07:45Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-01-06T02:05:50Z"}, "message": "Add DepGraph to tcx.", "tree": {"sha": "536f7f6878689f641e3cae0a1e5b6073a99ede0c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/536f7f6878689f641e3cae0a1e5b6073a99ede0c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa265869baf55d59d310edf76fef50026d7c70e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa265869baf55d59d310edf76fef50026d7c70e3", "html_url": "https://github.com/rust-lang/rust/commit/aa265869baf55d59d310edf76fef50026d7c70e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa265869baf55d59d310edf76fef50026d7c70e3/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c77cd480cf2105afcbb92de4f514f1f9637912c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/c77cd480cf2105afcbb92de4f514f1f9637912c5", "html_url": "https://github.com/rust-lang/rust/commit/c77cd480cf2105afcbb92de4f514f1f9637912c5"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "e700abf9db197b262da88fc37d1f18e5c619b2b4", "filename": "src/librustc/middle/ty/context.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/aa265869baf55d59d310edf76fef50026d7c70e3/src%2Flibrustc%2Fmiddle%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa265869baf55d59d310edf76fef50026d7c70e3/src%2Flibrustc%2Fmiddle%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty%2Fcontext.rs?ref=aa265869baf55d59d310edf76fef50026d7c70e3", "patch": "@@ -13,6 +13,7 @@\n // FIXME: (@jroesch) @eddyb should remove this when he renames ctxt\n #![allow(non_camel_case_types)]\n \n+use dep_graph::{DepGraph, DepNode, DepTrackingMap};\n use front::map as ast_map;\n use session::Session;\n use lint;\n@@ -224,6 +225,8 @@ pub struct ctxt<'tcx> {\n     region_interner: RefCell<FnvHashMap<&'tcx Region, &'tcx Region>>,\n     stability_interner: RefCell<FnvHashMap<&'tcx attr::Stability, &'tcx attr::Stability>>,\n \n+    pub dep_graph: DepGraph,\n+\n     /// Common types, pre-interned for your convenience.\n     pub types: CommonTypes<'tcx>,\n \n@@ -483,14 +486,15 @@ impl<'tcx> ctxt<'tcx> {\n     {\n         let interner = RefCell::new(FnvHashMap());\n         let common_types = CommonTypes::new(&arenas.type_, &interner);\n-\n+        let dep_graph = DepGraph::new(s.opts.incremental_compilation);\n         tls::enter(ctxt {\n             arenas: arenas,\n             interner: interner,\n             substs_interner: RefCell::new(FnvHashMap()),\n             bare_fn_interner: RefCell::new(FnvHashMap()),\n             region_interner: RefCell::new(FnvHashMap()),\n             stability_interner: RefCell::new(FnvHashMap()),\n+            dep_graph: dep_graph.clone(),\n             types: common_types,\n             named_region_map: named_region_map,\n             region_maps: region_maps,"}]}