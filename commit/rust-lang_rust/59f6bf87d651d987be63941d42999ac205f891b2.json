{"sha": "59f6bf87d651d987be63941d42999ac205f891b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5ZjZiZjg3ZDY1MWQ5ODdiZTYzOTQxZDQyOTk5YWMyMDVmODkxYjI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-03-23T13:33:44Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-03-23T13:33:44Z"}, "message": "Fix release", "tree": {"sha": "22d845c4bd45bf9dab8a11c735cbb27042006653", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/22d845c4bd45bf9dab8a11c735cbb27042006653"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59f6bf87d651d987be63941d42999ac205f891b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59f6bf87d651d987be63941d42999ac205f891b2", "html_url": "https://github.com/rust-lang/rust/commit/59f6bf87d651d987be63941d42999ac205f891b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59f6bf87d651d987be63941d42999ac205f891b2/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f8fd242199bb5cb41ab2579548b89dbfe6af94c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/f8fd242199bb5cb41ab2579548b89dbfe6af94c2", "html_url": "https://github.com/rust-lang/rust/commit/f8fd242199bb5cb41ab2579548b89dbfe6af94c2"}], "stats": {"total": 35, "additions": 25, "deletions": 10}, "files": [{"sha": "fb9e207b1d29068ec627f7f314e4c24fe883c68b", "filename": ".github/workflows/release.yaml", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/59f6bf87d651d987be63941d42999ac205f891b2/.github%2Fworkflows%2Frelease.yaml", "raw_url": "https://github.com/rust-lang/rust/raw/59f6bf87d651d987be63941d42999ac205f891b2/.github%2Fworkflows%2Frelease.yaml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Frelease.yaml?ref=59f6bf87d651d987be63941d42999ac205f891b2", "patch": "@@ -49,11 +49,15 @@ jobs:\n         node-version: 12.x\n \n     - name: Dist\n-      if: github.ref == 'refs/heads/release'\n-      run: cargo xtask dist --version 0.2.$GITHUB_RUN_NUMBER         --tag $(date --iso --utc)\n+      if: matrix.os == 'ubuntu-latest' && github.ref == 'refs/heads/release'\n+      run: cargo xtask dist --client --version 0.2.$GITHUB_RUN_NUMBER         --tag $(date --iso --utc)\n \n     - name: Dist\n-      if: github.ref != 'refs/heads/release'\n+      if: matrix.os == 'ubuntu-latest' && github.ref == 'refs/heads/release'\n+      run: cargo xtask dist --client --version 0.3.$GITHUB_RUN_NUMBER-nightly --tag nightly\n+\n+    - name: Dist\n+      if: matrix.os != 'ubuntu-latest'\n       run: cargo xtask dist --version 0.3.$GITHUB_RUN_NUMBER-nightly --tag nightly\n \n     - name: Upload artifacts"}, {"sha": "78dea08e7d2ec89e838b3899d29fc40d5b9a6b4e", "filename": "xtask/src/dist.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/59f6bf87d651d987be63941d42999ac205f891b2/xtask%2Fsrc%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59f6bf87d651d987be63941d42999ac205f891b2/xtask%2Fsrc%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fdist.rs?ref=59f6bf87d651d987be63941d42999ac205f891b2", "patch": "@@ -7,13 +7,18 @@ use crate::{\n     project_root,\n };\n \n-pub fn run_dist(version: &str, release_tag: &str) -> Result<()> {\n+pub struct ClientOpts {\n+    pub version: String,\n+    pub release_tag: String,\n+}\n+\n+pub fn run_dist(client_opts: Option<ClientOpts>) -> Result<()> {\n     let dist = project_root().join(\"dist\");\n     rm_rf(&dist)?;\n     fs2::create_dir_all(&dist)?;\n \n-    if cfg!(target_os = \"linux\") {\n-        dist_client(version, release_tag)?;\n+    if let Some(ClientOpts { version, release_tag}) = client_opts {\n+        dist_client(&version, &release_tag)?;\n     }\n     dist_server()?;\n     Ok(())"}, {"sha": "b1a56b67fc64b79e5d83d270006f02a0b003b11c", "filename": "xtask/src/main.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/59f6bf87d651d987be63941d42999ac205f891b2/xtask%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59f6bf87d651d987be63941d42999ac205f891b2/xtask%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fmain.rs?ref=59f6bf87d651d987be63941d42999ac205f891b2", "patch": "@@ -13,7 +13,7 @@ use std::env;\n use pico_args::Arguments;\n use xtask::{\n     codegen::{self, Mode},\n-    dist::run_dist,\n+    dist::{ClientOpts, run_dist},\n     install::{ClientOpt, InstallCmd, ServerOpt},\n     not_bash::pushd,\n     pre_commit, project_root, run_clippy, run_fuzzer, run_pre_cache, run_release, run_rustfmt,\n@@ -103,10 +103,16 @@ FLAGS:\n             run_release(dry_run)\n         }\n         \"dist\" => {\n-            let version: String = args.value_from_str(\"--version\")?;\n-            let release_tag: String = args.value_from_str(\"--tag\")?;\n+            let client_opts = if args.contains(\"--client\") {\n+                Some(ClientOpts {\n+                    version: args.value_from_str(\"--version\")?,\n+                    release_tag: args.value_from_str(\"--tag\")?,\n+                })\n+            } else {\n+                None\n+            };\n             args.finish()?;\n-            run_dist(&version, &release_tag)\n+            run_dist(client_opts)\n         }\n         _ => {\n             eprintln!("}]}