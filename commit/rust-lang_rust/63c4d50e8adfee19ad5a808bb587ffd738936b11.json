{"sha": "63c4d50e8adfee19ad5a808bb587ffd738936b11", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYzYzRkNTBlOGFkZmVlMTlhZDVhODA4YmI1ODdmZmQ3Mzg5MzZiMTE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-11T11:56:43Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-04-11T11:56:43Z"}, "message": "Rollup merge of #49614 - zackmdavis:the_phantom_menace, r=petrochenkov\n\nin which the non-shorthand patterns lint keeps its own counsel in macros\n\nIn issue #49588, Michael Lamparski pointed out a scenario in which the\nnon-shorthand-field-patterns lint could be triggered by a macro-expanded\npattern, in a way which was direly unwieldy for the macro author to guard\nagainst and unreasonable to expect the macro user to take into account. We can\navoid this by not linting patterns that come from macro-expansions. Although\nthis entails accepting \"false negatives\" where the lint could genuinely improve\nmacro-templated code, avoiding the reported \"true-but-super-annoying positive\"\nmay be worth the trade? (Some precedent for these relative priorities exists as\nno. 47775 (5985b0b0).)\n\nResolves #49588.", "tree": {"sha": "4ee5ac8984a8f522f8b3da29bc1f54349b9861ba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ee5ac8984a8f522f8b3da29bc1f54349b9861ba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/63c4d50e8adfee19ad5a808bb587ffd738936b11", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJazff7CRBK7hj4Ov3rIwAAdHIIAGbc3FRFfQ1wTPTHyTtoIy0o\nNefOGhkE6eq7bdOGGq61EDQLatX3k1gbJPD5sPG+9wtw61I8lgG+nx58e+QG7/ll\n5Ct39xphJafD00IIUtlPJd9g53N6k41cNveK5cNc9oAFp14wRYL+sawmx23eU0ho\nxTDMuPRpq5bISNRRLijDoTqBZxign1RwAr9/aMJ/kd0BDW2mB4Gza2B+VKRRDJzx\n5h4FHiETy7pke7RVwBksg335DOaAIFmBxChh0BQaY8SceyRp82whT90Rgts+IEyh\ncmqoPdctiqWBVU6SlPdxd2QHgpw0ZZna1NpZG1QcD1RBsnfJeva1NOX4vdPN4Vo=\n=h4RG\n-----END PGP SIGNATURE-----\n", "payload": "tree 4ee5ac8984a8f522f8b3da29bc1f54349b9861ba\nparent 5ee5de10d2d19eebbca26fbc31b7e49cb51406b1\nparent a1d90a2a2a2d3ff6843d8fca17be4819dba9ab6b\nauthor kennytm <kennytm@gmail.com> 1523447803 +0800\ncommitter GitHub <noreply@github.com> 1523447803 +0800\n\nRollup merge of #49614 - zackmdavis:the_phantom_menace, r=petrochenkov\n\nin which the non-shorthand patterns lint keeps its own counsel in macros\n\nIn issue #49588, Michael Lamparski pointed out a scenario in which the\nnon-shorthand-field-patterns lint could be triggered by a macro-expanded\npattern, in a way which was direly unwieldy for the macro author to guard\nagainst and unreasonable to expect the macro user to take into account. We can\navoid this by not linting patterns that come from macro-expansions. Although\nthis entails accepting \"false negatives\" where the lint could genuinely improve\nmacro-templated code, avoiding the reported \"true-but-super-annoying positive\"\nmay be worth the trade? (Some precedent for these relative priorities exists as\nno. 47775 (5985b0b0).)\n\nResolves #49588.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/63c4d50e8adfee19ad5a808bb587ffd738936b11", "html_url": "https://github.com/rust-lang/rust/commit/63c4d50e8adfee19ad5a808bb587ffd738936b11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/63c4d50e8adfee19ad5a808bb587ffd738936b11/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ee5de10d2d19eebbca26fbc31b7e49cb51406b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ee5de10d2d19eebbca26fbc31b7e49cb51406b1", "html_url": "https://github.com/rust-lang/rust/commit/5ee5de10d2d19eebbca26fbc31b7e49cb51406b1"}, {"sha": "a1d90a2a2a2d3ff6843d8fca17be4819dba9ab6b", "url": "https://api.github.com/repos/rust-lang/rust/commits/a1d90a2a2a2d3ff6843d8fca17be4819dba9ab6b", "html_url": "https://github.com/rust-lang/rust/commit/a1d90a2a2a2d3ff6843d8fca17be4819dba9ab6b"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "48e9cc498dceb8b44ceba28e9abaf0202e8b3bd8", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/63c4d50e8adfee19ad5a808bb587ffd738936b11/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63c4d50e8adfee19ad5a808bb587ffd738936b11/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=63c4d50e8adfee19ad5a808bb587ffd738936b11", "patch": "@@ -173,6 +173,12 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NonShorthandFieldPatterns {\n                 }\n                 if let PatKind::Binding(_, _, name, None) = fieldpat.node.pat.node {\n                     if name.node == fieldpat.node.name {\n+                        if let Some(_) = fieldpat.span.ctxt().outer().expn_info() {\n+                            // Don't lint if this is a macro expansion: macro authors\n+                            // shouldn't have to worry about this kind of style issue\n+                            // (Issue #49588)\n+                            return;\n+                        }\n                         let mut err = cx.struct_span_lint(NON_SHORTHAND_FIELD_PATTERNS,\n                                      fieldpat.span,\n                                      &format!(\"the `{}:` in this pattern is redundant\","}, {"sha": "51b2b5a4f7c0f00e6e4f035e62d6c6baadf00010", "filename": "src/test/run-pass/issue-49588-non-shorthand-field-patterns-in-pattern-macro.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/63c4d50e8adfee19ad5a808bb587ffd738936b11/src%2Ftest%2Frun-pass%2Fissue-49588-non-shorthand-field-patterns-in-pattern-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63c4d50e8adfee19ad5a808bb587ffd738936b11/src%2Ftest%2Frun-pass%2Fissue-49588-non-shorthand-field-patterns-in-pattern-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-49588-non-shorthand-field-patterns-in-pattern-macro.rs?ref=63c4d50e8adfee19ad5a808bb587ffd738936b11", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![deny(non_shorthand_field_patterns)]\n+\n+pub struct Value<A> { pub value: A }\n+\n+#[macro_export]\n+macro_rules! pat {\n+    ($a:pat) => {\n+        Value { value: $a }\n+    };\n+}\n+\n+fn main() {\n+    let pat!(value) = Value { value: () };\n+}"}]}