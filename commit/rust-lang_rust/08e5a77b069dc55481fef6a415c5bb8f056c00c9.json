{"sha": "08e5a77b069dc55481fef6a415c5bb8f056c00c9", "node_id": "C_kwDOAAsO6NoAKDA4ZTVhNzdiMDY5ZGM1NTQ4MWZlZjZhNDE1YzViYjhmMDU2YzAwYzk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-03-07T22:03:12Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-03-08T01:55:32Z"}, "message": "Don't report E0740 for type error", "tree": {"sha": "e4a8899b0c5b2dfb703f8456720b3e7a8840b6d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4a8899b0c5b2dfb703f8456720b3e7a8840b6d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/08e5a77b069dc55481fef6a415c5bb8f056c00c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/08e5a77b069dc55481fef6a415c5bb8f056c00c9", "html_url": "https://github.com/rust-lang/rust/commit/08e5a77b069dc55481fef6a415c5bb8f056c00c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/08e5a77b069dc55481fef6a415c5bb8f056c00c9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "38b96553112dce3de630890701f17d86e265f6ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/38b96553112dce3de630890701f17d86e265f6ba", "html_url": "https://github.com/rust-lang/rust/commit/38b96553112dce3de630890701f17d86e265f6ba"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "ec09a12e9a152766025337d04d3fe386e87a9ea2", "filename": "compiler/rustc_hir_analysis/src/check/check.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/08e5a77b069dc55481fef6a415c5bb8f056c00c9/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08e5a77b069dc55481fef6a415c5bb8f056c00c9/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcheck.rs?ref=08e5a77b069dc55481fef6a415c5bb8f056c00c9", "patch": "@@ -114,9 +114,11 @@ fn check_union_fields(tcx: TyCtxt<'_>, span: Span, item_def_id: LocalDefId) -> b\n                     allowed_union_field(*elem, tcx, param_env)\n                 }\n                 _ => {\n-                    // Fallback case: allow `ManuallyDrop` and things that are `Copy`.\n+                    // Fallback case: allow `ManuallyDrop` and things that are `Copy`,\n+                    // also no need to report an error if the type is unresolved.\n                     ty.ty_adt_def().is_some_and(|adt_def| adt_def.is_manually_drop())\n                         || ty.is_copy_modulo_regions(tcx, param_env)\n+                        || ty.references_error()\n                 }\n             }\n         }"}, {"sha": "7a6d79b2faa8850df582a849e747ac0223017fe4", "filename": "tests/ui/union/unresolved-field-isnt-copy.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/08e5a77b069dc55481fef6a415c5bb8f056c00c9/tests%2Fui%2Funion%2Funresolved-field-isnt-copy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08e5a77b069dc55481fef6a415c5bb8f056c00c9/tests%2Fui%2Funion%2Funresolved-field-isnt-copy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funion%2Funresolved-field-isnt-copy.rs?ref=08e5a77b069dc55481fef6a415c5bb8f056c00c9", "patch": "@@ -0,0 +1,8 @@\n+// Unresolved fields are not copy, but also shouldn't report an extra E0740.\n+\n+pub union Foo {\n+    x: *const Missing,\n+    //~^ ERROR cannot find type `Missing` in this scope\n+}\n+\n+fn main() {}"}, {"sha": "22301582eefc7a0cd44bca76baf75a88f0ab93de", "filename": "tests/ui/union/unresolved-field-isnt-copy.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/08e5a77b069dc55481fef6a415c5bb8f056c00c9/tests%2Fui%2Funion%2Funresolved-field-isnt-copy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/08e5a77b069dc55481fef6a415c5bb8f056c00c9/tests%2Fui%2Funion%2Funresolved-field-isnt-copy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funion%2Funresolved-field-isnt-copy.stderr?ref=08e5a77b069dc55481fef6a415c5bb8f056c00c9", "patch": "@@ -0,0 +1,9 @@\n+error[E0412]: cannot find type `Missing` in this scope\n+  --> $DIR/unresolved-field-isnt-copy.rs:4:15\n+   |\n+LL |     x: *const Missing,\n+   |               ^^^^^^^ not found in this scope\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0412`."}]}