{"sha": "ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhN2NmOTA0YjA5YTlhNmRhYmIwMzVkMmJkZTRlZjIzNmQzOTE0NGE=", "commit": {"author": {"name": "mitaa", "email": "mitaa.ceb@gmail.com", "date": "2016-03-10T03:49:40Z"}, "committer": {"name": "mitaa", "email": "mitaa.ceb@gmail.com", "date": "2016-03-14T19:03:43Z"}, "message": "Allow custom filenames for anonymous inputs", "tree": {"sha": "56690837786b1fd209cec22e338a88fe5b705b4a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/56690837786b1fd209cec22e338a88fe5b705b4a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "html_url": "https://github.com/rust-lang/rust/commit/ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/comments", "author": {"login": "mitaa", "id": 6785936, "node_id": "MDQ6VXNlcjY3ODU5MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6785936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitaa", "html_url": "https://github.com/mitaa", "followers_url": "https://api.github.com/users/mitaa/followers", "following_url": "https://api.github.com/users/mitaa/following{/other_user}", "gists_url": "https://api.github.com/users/mitaa/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitaa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitaa/subscriptions", "organizations_url": "https://api.github.com/users/mitaa/orgs", "repos_url": "https://api.github.com/users/mitaa/repos", "events_url": "https://api.github.com/users/mitaa/events{/privacy}", "received_events_url": "https://api.github.com/users/mitaa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mitaa", "id": 6785936, "node_id": "MDQ6VXNlcjY3ODU5MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6785936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitaa", "html_url": "https://github.com/mitaa", "followers_url": "https://api.github.com/users/mitaa/followers", "following_url": "https://api.github.com/users/mitaa/following{/other_user}", "gists_url": "https://api.github.com/users/mitaa/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitaa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitaa/subscriptions", "organizations_url": "https://api.github.com/users/mitaa/orgs", "repos_url": "https://api.github.com/users/mitaa/repos", "events_url": "https://api.github.com/users/mitaa/events{/privacy}", "received_events_url": "https://api.github.com/users/mitaa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc62db802f9cb19606d3bfa4c4df0d0bc438543b", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc62db802f9cb19606d3bfa4c4df0d0bc438543b", "html_url": "https://github.com/rust-lang/rust/commit/cc62db802f9cb19606d3bfa4c4df0d0bc438543b"}], "stats": {"total": 51, "additions": 32, "deletions": 19}, "files": [{"sha": "fbbca331a64b12545af366de1c509231ad7b6d26", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -172,16 +172,20 @@ pub enum PrintRequest {\n pub enum Input {\n     /// Load source from file\n     File(PathBuf),\n-    /// The string is the source\n-    Str(String)\n+    Str {\n+        /// String that is shown in place of a filename\n+        name: String,\n+        /// Anonymous source string\n+        input: String,\n+    },\n }\n \n impl Input {\n     pub fn filestem(&self) -> String {\n         match *self {\n             Input::File(ref ifile) => ifile.file_stem().unwrap()\n                                            .to_str().unwrap().to_string(),\n-            Input::Str(_) => \"rust_out\".to_string(),\n+            Input::Str { .. } => \"rust_out\".to_string(),\n         }\n     }\n }"}, {"sha": "6d9ff3f462e5f5229cf08986484db745bfb04977", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -231,7 +231,6 @@ pub fn compile_input(sess: &Session,\n     Ok(())\n }\n \n-\n /// The name used for source code that doesn't originate in a file\n /// (e.g. source from stdin or a string)\n pub fn anon_src() -> String {\n@@ -242,7 +241,7 @@ pub fn source_name(input: &Input) -> String {\n     match *input {\n         // FIXME (#9639): This needs to handle non-utf8 paths\n         Input::File(ref ifile) => ifile.to_str().unwrap().to_string(),\n-        Input::Str(_) => anon_src(),\n+        Input::Str { ref name, .. } => name.clone(),\n     }\n }\n \n@@ -434,9 +433,9 @@ pub fn phase_1_parse_input<'a>(sess: &'a Session,\n             Input::File(ref file) => {\n                 parse::parse_crate_from_file(file, cfg.clone(), &sess.parse_sess)\n             }\n-            Input::Str(ref src) => {\n-                parse::parse_crate_from_source_str(anon_src().to_string(),\n-                                                   src.to_string(),\n+            Input::Str { ref input, ref name } => {\n+                parse::parse_crate_from_source_str(name.clone(),\n+                                                   input.clone(),\n                                                    cfg.clone(),\n                                                    &sess.parse_sess)\n             }"}, {"sha": "357c7238c1f6c9572a939d1b90615c005083688d", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -223,7 +223,8 @@ fn make_input(free_matches: &[String]) -> Option<(Input, Option<PathBuf>)> {\n         if ifile == \"-\" {\n             let mut src = String::new();\n             io::stdin().read_to_string(&mut src).unwrap();\n-            Some((Input::Str(src), None))\n+            Some((Input::Str { name: driver::anon_src(), input: src },\n+                  None))\n         } else {\n             Some((Input::File(PathBuf::from(ifile)),\n                   Some(PathBuf::from(ifile))))\n@@ -511,7 +512,7 @@ impl RustcDefaultCalls {\n                         .unwrap();\n                     println!(\"{}\", String::from_utf8(v).unwrap());\n                 }\n-                &Input::Str(_) => {\n+                &Input::Str { .. } => {\n                     early_error(ErrorOutputType::default(), \"cannot list metadata for stdin\");\n                 }\n             }\n@@ -994,9 +995,9 @@ fn parse_crate_attrs<'a>(sess: &'a Session, input: &Input) -> PResult<'a, Vec<as\n         Input::File(ref ifile) => {\n             parse::parse_crate_attrs_from_file(ifile, Vec::new(), &sess.parse_sess)\n         }\n-        Input::Str(ref src) => {\n-            parse::parse_crate_attrs_from_source_str(driver::anon_src().to_string(),\n-                                                     src.to_string(),\n+        Input::Str { ref name, ref input } => {\n+            parse::parse_crate_attrs_from_source_str(name.clone(),\n+                                                     input.clone(),\n                                                      Vec::new(),\n                                                      &sess.parse_sess)\n         }"}, {"sha": "9fbdaed47746ccb6bc67af3daf50fbb1fbdc28a7", "filename": "src/librustc_driver/test.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc_driver%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustc_driver%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Ftest.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -113,7 +113,10 @@ fn test_env<F>(source_string: &str,\n                                        Rc::new(CodeMap::new()), cstore.clone());\n     rustc_lint::register_builtins(&mut sess.lint_store.borrow_mut(), Some(&sess));\n     let krate_config = Vec::new();\n-    let input = config::Input::Str(source_string.to_string());\n+    let input = config::Input::Str {\n+        name: driver::anon_src(),\n+        input: source_string.to_string(),\n+    };\n     let krate = driver::phase_1_parse_input(&sess, krate_config, &input).unwrap();\n     let krate = driver::phase_2_configure_and_expand(&sess, &cstore, krate, \"test\", None)\n                     .expect(\"phase 2 aborted\");"}, {"sha": "4f0808e81a01a557497f5406d983955d34897359", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -205,7 +205,7 @@ impl<'a, 'tcx> Clean<Crate> for visit_ast::RustdocVisitor<'a, 'tcx> {\n                     current_dir().unwrap().join(path)\n                 }\n             },\n-            Input::Str(_) => PathBuf::new() // FIXME: this is wrong\n+            Input::Str { ref name, .. } => PathBuf::from(name.clone()),\n         };\n \n         Crate {"}, {"sha": "8c752a01496d397362147ae82e51511b4887eb1c", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -182,7 +182,10 @@ fn runtest(test: &str, cratename: &str, cfgs: Vec<String>, libs: SearchPaths,\n     // the test harness wants its own `main` & top level functions, so\n     // never wrap the test in `fn main() { ... }`\n     let test = maketest(test, Some(cratename), as_test_harness, opts);\n-    let input = config::Input::Str(test.to_string());\n+    let input = config::Input::Str {\n+        name: driver::anon_src(),\n+        input: test.to_owned(),\n+    };\n     let mut outputs = HashMap::new();\n     outputs.insert(OutputType::Exe, None);\n "}, {"sha": "4ff531d4755c80c41b3191188736af04cbfa243c", "filename": "src/test/run-make/execution-engine/test.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Ftest%2Frun-make%2Fexecution-engine%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Ftest%2Frun-make%2Fexecution-engine%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fexecution-engine%2Ftest.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -216,7 +216,10 @@ fn build_exec_options(sysroot: PathBuf) -> Options {\n /// for crates used in the given input.\n fn compile_program(input: &str, sysroot: PathBuf)\n                    -> Option<(llvm::ModuleRef, Vec<PathBuf>)> {\n-    let input = Input::Str(input.to_string());\n+    let input = Input::Str {\n+        name: driver::anon_src(),\n+        input: input.to_string(),\n+    };\n     let thread = Builder::new().name(\"compile_program\".to_string());\n \n     let handle = thread.spawn(move || {"}, {"sha": "80c06ca3274f245af1bd718ae3ae7edfc31d0782", "filename": "src/test/run-make/issue-19371/foo.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Ftest%2Frun-make%2Fissue-19371%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7cf904b09a9a6dabb035d2bde4ef236d39144a/src%2Ftest%2Frun-make%2Fissue-19371%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fissue-19371%2Ffoo.rs?ref=ea7cf904b09a9a6dabb035d2bde4ef236d39144a", "patch": "@@ -18,7 +18,7 @@ extern crate syntax;\n \n use rustc::session::{build_session, Session};\n use rustc::session::config::{basic_options, build_configuration, Input, OutputType};\n-use rustc_driver::driver::{compile_input, CompileController};\n+use rustc_driver::driver::{compile_input, CompileController, anon_src};\n use rustc_metadata::cstore::CStore;\n use syntax::diagnostics::registry::Registry;\n use syntax::parse::token;\n@@ -67,7 +67,7 @@ fn compile(code: String, output: PathBuf, sysroot: PathBuf) {\n \n     compile_input(&sess, &cstore,\n             cfg,\n-            &Input::Str(code),\n+            &Input::Str { name: anon_src(), input: code },\n             &None,\n             &Some(output),\n             None,"}]}