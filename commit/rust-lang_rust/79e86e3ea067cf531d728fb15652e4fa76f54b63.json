{"sha": "79e86e3ea067cf531d728fb15652e4fa76f54b63", "node_id": "C_kwDOAAsO6NoAKDc5ZTg2ZTNlYTA2N2NmNTMxZDcyOGZiMTU2NTJlNGZhNzZmNTRiNjM", "commit": {"author": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-10-02T04:05:32Z"}, "committer": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-10-27T17:16:15Z"}, "message": "More build-manifest docs", "tree": {"sha": "6778264223f5adb5f67639f570fe70d66a84d0ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6778264223f5adb5f67639f570fe70d66a84d0ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79e86e3ea067cf531d728fb15652e4fa76f54b63", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79e86e3ea067cf531d728fb15652e4fa76f54b63", "html_url": "https://github.com/rust-lang/rust/commit/79e86e3ea067cf531d728fb15652e4fa76f54b63", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79e86e3ea067cf531d728fb15652e4fa76f54b63/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d44e14225ab00e164aa9ea9e8d9e1bee40f96b3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d44e14225ab00e164aa9ea9e8d9e1bee40f96b3e", "html_url": "https://github.com/rust-lang/rust/commit/d44e14225ab00e164aa9ea9e8d9e1bee40f96b3e"}], "stats": {"total": 38, "additions": 20, "deletions": 18}, "files": [{"sha": "b5c6371e553a5b1faff7c551e910afe597011be8", "filename": "src/tools/build-manifest/README.md", "status": "modified", "additions": 19, "deletions": 13, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/79e86e3ea067cf531d728fb15652e4fa76f54b63/src%2Ftools%2Fbuild-manifest%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/79e86e3ea067cf531d728fb15652e4fa76f54b63/src%2Ftools%2Fbuild-manifest%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2FREADME.md?ref=79e86e3ea067cf531d728fb15652e4fa76f54b63", "patch": "@@ -1,27 +1,33 @@\n # build-manifest\n \n-This tool generates the manifests uploaded to static.rust-lang.org and used by\n-rustup. The tool is invoked by the bootstrap tool.\n+This tool generates the manifests uploaded to static.rust-lang.org and used by rustup.\n+You can see a full list of all manifests at <https://static.rust-lang.org/manifests.txt>.\n+\n+This gets called by `promote-release` <https://github.com/rust-lang/promote-release> via `x.py dist hash-and-sign`.\n+\n+## Adding a new component\n+\n+There are several steps involved here.\n+1. Add a new `Step` to `dist.rs`. This should usually be named after the filename of the uploaded tarball. See https://github.com/rust-lang/rust/pull/101799/files#diff-2c56335faa24486df09ba392d8900c57e2fac4633e1f7038469bcf9ed3feb871 for an example.\n+    a. If appropriate, call `tarball.is_preview(true)` for the component.\n+3. Add a new `PkgType` to build-manifest. Fix all the compile errors as appropriate.\n \n ## Testing changes locally\n \n In order to test the changes locally you need to have a valid dist directory\n available locally. If you don't want to build all the compiler, you can easily\n create one from the nightly artifacts with:\n \n-```\n-#!/bin/bash\n-for cmpn in rust rustc rust-std rust-docs cargo; do\n-    wget https://static.rust-lang.org/dist/${cmpn}-nightly-x86_64-unknown-linux-gnu.tar.gz\n+```sh\n+for component in rust rustc rust-std rust-docs cargo; do\n+    wget -P build/dist https://static.rust-lang.org/dist/${component}-nightly-x86_64-unknown-linux-gnu.tar.gz\n done\n ```\n \n-Then, you can generate the manifest and all the packages from `path/to/dist` to\n-`path/to/output` with:\n+Then, you can generate the manifest and all the packages from `build/dist` to\n+`build/manifest` with:\n \n+```sh\n+mkdir -p build/manifest\n+cargo +nightly run -p build-manifest build/dist build/manifest 1970-01-01 http://example.com nightly\n ```\n-$ cargo +nightly run path/to/dist path/to/output 1970-01-01 http://example.com CHANNEL\n-```\n-\n-Remember to replace `CHANNEL` with the channel you produced dist artifacts of\n-and `VERSION` with the current Rust version."}, {"sha": "983f4ca713882c2285273e322bab088789fb0446", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/79e86e3ea067cf531d728fb15652e4fa76f54b63/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79e86e3ea067cf531d728fb15652e4fa76f54b63/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=79e86e3ea067cf531d728fb15652e4fa76f54b63", "patch": "@@ -1,8 +1,4 @@\n-//! Build a dist manifest, hash and sign everything.\n-//! This gets called by `promote-release`\n-//! (https://github.com/rust-lang/rust-central-station/tree/master/promote-release)\n-//! via `x.py dist hash-and-sign`; the cmdline arguments are set up\n-//! by rustbuild (in `src/bootstrap/dist.rs`).\n+#![doc = include_str!(\"../README.md\")]\n \n mod checksum;\n mod manifest;"}]}