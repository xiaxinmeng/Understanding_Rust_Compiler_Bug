{"sha": "44e31b91ad05ba0bdb6db5c6f75451ba60160d84", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0ZTMxYjkxYWQwNWJhMGJkYjZkYjVjNmY3NTQ1MWJhNjAxNjBkODQ=", "commit": {"author": {"name": "Paul Dicker", "email": "pitdicker@gmail.com", "date": "2016-02-15T11:43:30Z"}, "committer": {"name": "Paul Dicker", "email": "pitdicker@gmail.com", "date": "2016-02-15T11:43:30Z"}, "message": "Refactor windows::fs::FileAttr\nBecause we no longer use `GetFileAttributesExW` FileAttr is never created\ndirectly from `WIN32_FILE_ATTRIBUTE_DATA` anymore.\nSo we should no longer store FileAttr's attributes in that c struct.", "tree": {"sha": "e549324a6455c19158d7971cd3cc01e0ab4a03dc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e549324a6455c19158d7971cd3cc01e0ab4a03dc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44e31b91ad05ba0bdb6db5c6f75451ba60160d84", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44e31b91ad05ba0bdb6db5c6f75451ba60160d84", "html_url": "https://github.com/rust-lang/rust/commit/44e31b91ad05ba0bdb6db5c6f75451ba60160d84", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44e31b91ad05ba0bdb6db5c6f75451ba60160d84/comments", "author": {"login": "pitdicker", "id": 6255050, "node_id": "MDQ6VXNlcjYyNTUwNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/6255050?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pitdicker", "html_url": "https://github.com/pitdicker", "followers_url": "https://api.github.com/users/pitdicker/followers", "following_url": "https://api.github.com/users/pitdicker/following{/other_user}", "gists_url": "https://api.github.com/users/pitdicker/gists{/gist_id}", "starred_url": "https://api.github.com/users/pitdicker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pitdicker/subscriptions", "organizations_url": "https://api.github.com/users/pitdicker/orgs", "repos_url": "https://api.github.com/users/pitdicker/repos", "events_url": "https://api.github.com/users/pitdicker/events{/privacy}", "received_events_url": "https://api.github.com/users/pitdicker/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pitdicker", "id": 6255050, "node_id": "MDQ6VXNlcjYyNTUwNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/6255050?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pitdicker", "html_url": "https://github.com/pitdicker", "followers_url": "https://api.github.com/users/pitdicker/followers", "following_url": "https://api.github.com/users/pitdicker/following{/other_user}", "gists_url": "https://api.github.com/users/pitdicker/gists{/gist_id}", "starred_url": "https://api.github.com/users/pitdicker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pitdicker/subscriptions", "organizations_url": "https://api.github.com/users/pitdicker/orgs", "repos_url": "https://api.github.com/users/pitdicker/repos", "events_url": "https://api.github.com/users/pitdicker/events{/privacy}", "received_events_url": "https://api.github.com/users/pitdicker/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4ce803837e8a414d20b17274aac5a2cbd06237bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/4ce803837e8a414d20b17274aac5a2cbd06237bc", "html_url": "https://github.com/rust-lang/rust/commit/4ce803837e8a414d20b17274aac5a2cbd06237bc"}], "stats": {"total": 54, "additions": 26, "deletions": 28}, "files": [{"sha": "95fb1e7c60052c27d2355153a9178a11a6d40cd7", "filename": "src/libstd/sys/windows/fs.rs", "status": "modified", "additions": 26, "deletions": 28, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/44e31b91ad05ba0bdb6db5c6f75451ba60160d84/src%2Flibstd%2Fsys%2Fwindows%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44e31b91ad05ba0bdb6db5c6f75451ba60160d84/src%2Flibstd%2Fsys%2Fwindows%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Ffs.rs?ref=44e31b91ad05ba0bdb6db5c6f75451ba60160d84", "patch": "@@ -30,7 +30,11 @@ pub struct File { handle: Handle }\n \n #[derive(Clone)]\n pub struct FileAttr {\n-    data: c::WIN32_FILE_ATTRIBUTE_DATA,\n+    attributes: c::DWORD,\n+    creation_time: c::FILETIME,\n+    last_access_time: c::FILETIME,\n+    last_write_time: c::FILETIME,\n+    file_size: u64,\n     reparse_tag: c::DWORD,\n }\n \n@@ -142,14 +146,11 @@ impl DirEntry {\n \n     pub fn metadata(&self) -> io::Result<FileAttr> {\n         Ok(FileAttr {\n-            data: c::WIN32_FILE_ATTRIBUTE_DATA {\n-                dwFileAttributes: self.data.dwFileAttributes,\n-                ftCreationTime: self.data.ftCreationTime,\n-                ftLastAccessTime: self.data.ftLastAccessTime,\n-                ftLastWriteTime: self.data.ftLastWriteTime,\n-                nFileSizeHigh: self.data.nFileSizeHigh,\n-                nFileSizeLow: self.data.nFileSizeLow,\n-            },\n+            attributes: self.data.dwFileAttributes,\n+            creation_time: self.data.ftCreationTime,\n+            last_access_time: self.data.ftLastAccessTime,\n+            last_write_time: self.data.ftLastWriteTime,\n+            file_size: ((self.data.nFileSizeHigh as u64) << 32) | (self.data.nFileSizeLow as u64),\n             reparse_tag: if self.data.dwFileAttributes & c::FILE_ATTRIBUTE_REPARSE_POINT != 0 {\n                     // reserved unless this is a reparse point\n                     self.data.dwReserved0\n@@ -290,14 +291,11 @@ impl File {\n             try!(cvt(c::GetFileInformationByHandle(self.handle.raw(),\n                                                    &mut info)));\n             let mut attr = FileAttr {\n-                data: c::WIN32_FILE_ATTRIBUTE_DATA {\n-                    dwFileAttributes: info.dwFileAttributes,\n-                    ftCreationTime: info.ftCreationTime,\n-                    ftLastAccessTime: info.ftLastAccessTime,\n-                    ftLastWriteTime: info.ftLastWriteTime,\n-                    nFileSizeHigh: info.nFileSizeHigh,\n-                    nFileSizeLow: info.nFileSizeLow,\n-                },\n+                attributes: info.dwFileAttributes,\n+                creation_time: info.ftCreationTime,\n+                last_access_time: info.ftLastAccessTime,\n+                last_write_time: info.ftLastWriteTime,\n+                file_size: ((info.nFileSizeHigh as u64) << 32) | (info.nFileSizeLow as u64),\n                 reparse_tag: 0,\n             };\n             if attr.is_reparse_point() {\n@@ -420,45 +418,45 @@ impl fmt::Debug for File {\n \n impl FileAttr {\n     pub fn size(&self) -> u64 {\n-        ((self.data.nFileSizeHigh as u64) << 32) | (self.data.nFileSizeLow as u64)\n+        self.file_size\n     }\n \n     pub fn perm(&self) -> FilePermissions {\n-        FilePermissions { attrs: self.data.dwFileAttributes }\n+        FilePermissions { attrs: self.attributes }\n     }\n \n-    pub fn attrs(&self) -> u32 { self.data.dwFileAttributes as u32 }\n+    pub fn attrs(&self) -> u32 { self.attributes as u32 }\n \n     pub fn file_type(&self) -> FileType {\n-        FileType::new(self.data.dwFileAttributes, self.reparse_tag)\n+        FileType::new(self.attributes, self.reparse_tag)\n     }\n \n     pub fn modified(&self) -> io::Result<SystemTime> {\n-        Ok(SystemTime::from(self.data.ftLastWriteTime))\n+        Ok(SystemTime::from(self.last_write_time))\n     }\n \n     pub fn accessed(&self) -> io::Result<SystemTime> {\n-        Ok(SystemTime::from(self.data.ftLastAccessTime))\n+        Ok(SystemTime::from(self.last_access_time))\n     }\n \n     pub fn created(&self) -> io::Result<SystemTime> {\n-        Ok(SystemTime::from(self.data.ftCreationTime))\n+        Ok(SystemTime::from(self.creation_time))\n     }\n \n     pub fn modified_u64(&self) -> u64 {\n-        to_u64(&self.data.ftLastWriteTime)\n+        to_u64(&self.last_write_time)\n     }\n \n     pub fn accessed_u64(&self) -> u64 {\n-        to_u64(&self.data.ftLastAccessTime)\n+        to_u64(&self.last_access_time)\n     }\n \n     pub fn created_u64(&self) -> u64 {\n-        to_u64(&self.data.ftCreationTime)\n+        to_u64(&self.creation_time)\n     }\n \n     fn is_reparse_point(&self) -> bool {\n-        self.data.dwFileAttributes & c::FILE_ATTRIBUTE_REPARSE_POINT != 0\n+        self.attributes & c::FILE_ATTRIBUTE_REPARSE_POINT != 0\n     }\n }\n "}]}