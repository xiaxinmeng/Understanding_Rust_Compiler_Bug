{"sha": "fedde3790c32c4956b06ae45699f0f76b4502865", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlZGRlMzc5MGMzMmM0OTU2YjA2YWU0NTY5OWYwZjc2YjQ1MDI4NjU=", "commit": {"author": {"name": "Ben Brittain", "email": "ben@brittain.org", "date": "2018-07-29T15:45:31Z"}, "committer": {"name": "Ben Brittain", "email": "ben@brittain.org", "date": "2018-07-29T15:55:36Z"}, "message": "Add tests for async & async move", "tree": {"sha": "704003056f507e40c97b8e322763faea5da6bc6b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/704003056f507e40c97b8e322763faea5da6bc6b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fedde3790c32c4956b06ae45699f0f76b4502865", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fedde3790c32c4956b06ae45699f0f76b4502865", "html_url": "https://github.com/rust-lang/rust/commit/fedde3790c32c4956b06ae45699f0f76b4502865", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fedde3790c32c4956b06ae45699f0f76b4502865/comments", "author": {"login": "benbrittain", "id": 207432, "node_id": "MDQ6VXNlcjIwNzQzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/207432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benbrittain", "html_url": "https://github.com/benbrittain", "followers_url": "https://api.github.com/users/benbrittain/followers", "following_url": "https://api.github.com/users/benbrittain/following{/other_user}", "gists_url": "https://api.github.com/users/benbrittain/gists{/gist_id}", "starred_url": "https://api.github.com/users/benbrittain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benbrittain/subscriptions", "organizations_url": "https://api.github.com/users/benbrittain/orgs", "repos_url": "https://api.github.com/users/benbrittain/repos", "events_url": "https://api.github.com/users/benbrittain/events{/privacy}", "received_events_url": "https://api.github.com/users/benbrittain/received_events", "type": "User", "site_admin": false}, "committer": {"login": "benbrittain", "id": 207432, "node_id": "MDQ6VXNlcjIwNzQzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/207432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benbrittain", "html_url": "https://github.com/benbrittain", "followers_url": "https://api.github.com/users/benbrittain/followers", "following_url": "https://api.github.com/users/benbrittain/following{/other_user}", "gists_url": "https://api.github.com/users/benbrittain/gists{/gist_id}", "starred_url": "https://api.github.com/users/benbrittain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benbrittain/subscriptions", "organizations_url": "https://api.github.com/users/benbrittain/orgs", "repos_url": "https://api.github.com/users/benbrittain/repos", "events_url": "https://api.github.com/users/benbrittain/events{/privacy}", "received_events_url": "https://api.github.com/users/benbrittain/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0b25f602fd60dc0961d8e507919328889ceeb32e", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b25f602fd60dc0961d8e507919328889ceeb32e", "html_url": "https://github.com/rust-lang/rust/commit/0b25f602fd60dc0961d8e507919328889ceeb32e"}], "stats": {"total": 63, "additions": 57, "deletions": 6}, "files": [{"sha": "65284182cb2dae5ef255f01564477c5eb539ee82", "filename": "src/expr.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/fedde3790c32c4956b06ae45699f0f76b4502865/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fedde3790c32c4956b06ae45699f0f76b4502865/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=fedde3790c32c4956b06ae45699f0f76b4502865", "patch": "@@ -345,17 +345,28 @@ pub fn format_expr(\n         }\n         // FIXME(#2743)\n         ast::ExprKind::ObsoleteInPlace(..) => unimplemented!(),\n-        ast::ExprKind::Async(_capture_by, _node_id, ref block) => {\n-            if let rw @ Some(_) =\n-                rewrite_single_line_block(context, \"async \", block, Some(&expr.attrs), None, shape)\n-            {\n+        ast::ExprKind::Async(capture_by, _node_id, ref block) => {\n+            let mover = if capture_by == ast::CaptureBy::Value {\n+                \"move \"\n+            } else {\n+                \"\"\n+            };\n+            if let rw @ Some(_) = rewrite_single_line_block(\n+                context,\n+                format!(\"{}{}\", \"async \", mover).as_str(),\n+                block,\n+                Some(&expr.attrs),\n+                None,\n+                shape,\n+            ) {\n                 rw\n             } else {\n                 // 6 = `async `\n                 let budget = shape.width.saturating_sub(6);\n                 Some(format!(\n-                    \"{}{}\",\n+                    \"{}{}{}\",\n                     \"async \",\n+                    mover,\n                     rewrite_block(\n                         block,\n                         Some(&expr.attrs),"}, {"sha": "47e35fb101d9c56820bb0f65de6296755c46bee5", "filename": "src/items.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fedde3790c32c4956b06ae45699f0f76b4502865/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fedde3790c32c4956b06ae45699f0f76b4502865/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=fedde3790c32c4956b06ae45699f0f76b4502865", "patch": "@@ -239,9 +239,9 @@ impl<'a> FnSig<'a> {\n         // Vis defaultness constness unsafety abi.\n         result.push_str(&*format_visibility(context, &self.visibility));\n         result.push_str(format_defaultness(self.defaultness));\n-        result.push_str(format_asyncness(self.asyncness));\n         result.push_str(format_constness(self.constness));\n         result.push_str(format_unsafety(self.unsafety));\n+        result.push_str(format_asyncness(self.asyncness));\n         result.push_str(&format_abi(\n             self.abi,\n             context.config.force_explicit_abi(),"}, {"sha": "69e9892fbf7eac8dc92918239fb19812e284e27d", "filename": "tests/source/async_block.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Fsource%2Fasync_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Fsource%2Fasync_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fasync_block.rs?ref=fedde3790c32c4956b06ae45699f0f76b4502865", "patch": "@@ -0,0 +1,7 @@\n+// rustfmt-edition: Edition2018\n+\n+fn main() {\n+    let x = async {\n+        Ok(())\n+    };\n+}"}, {"sha": "651cca7c340d74e29b135ff78fec723e0a73ce09", "filename": "tests/source/async_fn.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Fsource%2Fasync_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Fsource%2Fasync_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fasync_fn.rs?ref=fedde3790c32c4956b06ae45699f0f76b4502865", "patch": "@@ -0,0 +1,15 @@\n+// rustfmt-edition: Edition2018\n+\n+async fn bar() -> Result<(), ()> {\n+    Ok(())\n+}\n+\n+pub async fn baz() -> Result<(), ()> {\n+    Ok(())\n+}\n+\n+unsafe async fn foo() {\n+    async move {\n+        Ok(())\n+    }\n+}"}, {"sha": "1bc24d1de15a7d7a4b3ae81f51a9b2ea3d59d4a8", "filename": "tests/target/async_block.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Ftarget%2Fasync_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Ftarget%2Fasync_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fasync_block.rs?ref=fedde3790c32c4956b06ae45699f0f76b4502865", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-edition: Edition2018\n+\n+fn main() {\n+    let x = async { Ok(()) };\n+}"}, {"sha": "a6e7cbc44b2c5bdf62b262cc42ef8f3b1c424a5a", "filename": "tests/target/async_fn.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Ftarget%2Fasync_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fedde3790c32c4956b06ae45699f0f76b4502865/tests%2Ftarget%2Fasync_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fasync_fn.rs?ref=fedde3790c32c4956b06ae45699f0f76b4502865", "patch": "@@ -0,0 +1,13 @@\n+// rustfmt-edition: Edition2018\n+\n+async fn bar() -> Result<(), ()> {\n+    Ok(())\n+}\n+\n+pub async fn baz() -> Result<(), ()> {\n+    Ok(())\n+}\n+\n+unsafe async fn foo() {\n+    async move { Ok(()) }\n+}"}]}