{"sha": "fe5b81348fcf1c2c39e774e61d6962111582f020", "node_id": "C_kwDOAAsO6NoAKGZlNWI4MTM0OGZjZjFjMmMzOWU3NzRlNjFkNjk2MjExMTU4MmYwMjA", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-03-21T06:07:09Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-03-21T06:07:09Z"}, "message": "Tidy up", "tree": {"sha": "154359961b40bc01e3b0ceec0e4e14b9f0fa966c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/154359961b40bc01e3b0ceec0e4e14b9f0fa966c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe5b81348fcf1c2c39e774e61d6962111582f020", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE3RQPHNISvvEnSKtjbQF6ltjmwvkFAmI4Fg0ACgkQbQF6ltjm\nwvm1AQ/8CArQHgDMa5x5beS+xgWVV7F+4N7vI3aeTHsEeoaMB45xOYP9Cx9/tioh\nDgtF1PVpVHPo2MUA/d2EB6/DoKMACt6qHauGsMY2HfR4LbWLW2BUKv1FD4tyqL+2\nMsQitHFZhggSi6o1PBmYGsQIbItgJEKHqlcwcsRpwpiVZTOTzd8dKAmbcW7IgOpn\nNIrybDs97DZ7DdccMzgIW2zH16wlvoRaGhxPOTW86BQAQKp9sHd8BrVDiB6G+AnH\nZeFxeLJXWVBKBEJx3JTUjSDzUZ7hTyuhieQXEvDJw/2XMC3T2eg0q6rmdOuAG4jb\n6faLC/XSBSkZOIma/Nh5Z7Dqfh570nMy1c5LpnmIlwENYjivSDEN6vY4L3Cf91nB\new+UpZFOJUvIfsrZ/DSxbI5kxmlKq5kO+nG1euiP5k1WLAkDQ/cqNXtAZcUcg8W5\nWKecWa9P7JvIIfPHeSIwmskXR+lJ95xviVU5nNloshzqiHXIH2MnG75Yt9sVeU9p\niLTFFL7FpKcSkn6Tt1JcWljl4UPE3+mboHNqaeEdHnMruLCImjF8AdHrBG3lcMCm\nglhwtttuNWywMk9eCTyKIwk4uTu9zUOoJMcNFDvctxZQzQAgMm9x6B6mRoF75UeR\nVB2Ey/8YNpGT7KejT52TLVe4m2lNNF09b2iiCLvObVDHlRlQNKE=\n=HLE8\n-----END PGP SIGNATURE-----", "payload": "tree 154359961b40bc01e3b0ceec0e4e14b9f0fa966c\nparent 1f3ee7f32e1345e70f31adf1cb2d6f11d1d87c9a\nauthor Deadbeef <ent3rm4n@gmail.com> 1647842829 +1100\ncommitter Deadbeef <ent3rm4n@gmail.com> 1647842829 +1100\n\nTidy up\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe5b81348fcf1c2c39e774e61d6962111582f020", "html_url": "https://github.com/rust-lang/rust/commit/fe5b81348fcf1c2c39e774e61d6962111582f020", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe5b81348fcf1c2c39e774e61d6962111582f020/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f3ee7f32e1345e70f31adf1cb2d6f11d1d87c9a", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f3ee7f32e1345e70f31adf1cb2d6f11d1d87c9a", "html_url": "https://github.com/rust-lang/rust/commit/1f3ee7f32e1345e70f31adf1cb2d6f11d1d87c9a"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "df760a166e82c52945bb80786aa3a96d80bd768e", "filename": "compiler/rustc_trait_selection/src/traits/select/confirmation.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/fe5b81348fcf1c2c39e774e61d6962111582f020/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe5b81348fcf1c2c39e774e61d6962111582f020/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs?ref=fe5b81348fcf1c2c39e774e61d6962111582f020", "patch": "@@ -1051,8 +1051,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n         #[cfg(bootstrap)]\n         {}\n \n-        if obligation.predicate.skip_binder().def_id() == drop_trait\n-        {\n+        if obligation.predicate.skip_binder().def_id() == drop_trait {\n             return Ok(ImplSourceConstDestructData { nested: vec![] });\n         }\n \n@@ -1068,7 +1067,10 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n         if let Some(impl_def_id) = impl_def_id {\n             let obligations = self.infcx.commit_unconditionally(|_| {\n                 let mut new_obligation = obligation.clone();\n-                new_obligation.predicate = new_obligation.predicate.map_bound(|mut trait_pred| { trait_pred.trait_ref.def_id = drop_trait; trait_pred });\n+                new_obligation.predicate = new_obligation.predicate.map_bound(|mut trait_pred| {\n+                    trait_pred.trait_ref.def_id = drop_trait;\n+                    trait_pred\n+                });\n                 let substs = self.rematch_impl(impl_def_id, &new_obligation);\n                 debug!(?substs, \"impl substs\");\n                 let cause = obligation.derived_cause(ImplDerivedObligation);\n@@ -1140,7 +1142,9 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                             self_ty\n                                 .rebind(ty::TraitPredicate {\n                                     trait_ref: ty::TraitRef {\n-                                        def_id: self.tcx().require_lang_item(LangItem::Destruct, None),\n+                                        def_id: self\n+                                            .tcx()\n+                                            .require_lang_item(LangItem::Destruct, None),\n                                         substs: self.tcx().mk_substs_trait(nested_ty, &[]),\n                                     },\n                                     constness: ty::BoundConstness::ConstIfConst,"}, {"sha": "948f0efbcfcb587a6759840c1b3735e2c9ccf016", "filename": "src/test/ui/rfc-2632-const-trait-impl/const-drop-bound.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fe5b81348fcf1c2c39e774e61d6962111582f020/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst-drop-bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe5b81348fcf1c2c39e774e61d6962111582f020/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst-drop-bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst-drop-bound.rs?ref=fe5b81348fcf1c2c39e774e61d6962111582f020", "patch": "@@ -14,7 +14,11 @@ const fn foo<T, E>(res: Result<T, E>) -> Option<T> where E: ~const Destruct {\n \n pub struct Foo<T>(T);\n \n-const fn baz<T: ~const Destruct, E: ~const Destruct>(res: Result<Foo<T>, Foo<E>>) -> Option<Foo<T>> {\n+const fn baz<T, E>(res: Result<Foo<T>, Foo<E>>) -> Option<Foo<T>>\n+where\n+    T: ~const Destruct,\n+    E: ~const Destruct,\n+{\n     foo(res)\n }\n "}]}