{"sha": "6be97e225099cc59dc63f6fc01af7c525d0334df", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiZTk3ZTIyNTA5OWNjNTlkYzYzZjZmYzAxYWY3YzUyNWQwMzM0ZGY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-10-31T12:46:28Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-11-05T09:22:08Z"}, "message": "Improve lint even more", "tree": {"sha": "576c7557953368f8460ee9467331d7091defb7d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/576c7557953368f8460ee9467331d7091defb7d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6be97e225099cc59dc63f6fc01af7c525d0334df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6be97e225099cc59dc63f6fc01af7c525d0334df", "html_url": "https://github.com/rust-lang/rust/commit/6be97e225099cc59dc63f6fc01af7c525d0334df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6be97e225099cc59dc63f6fc01af7c525d0334df/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fb404bebe9e7d228859a26b7e40340438d0c427", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fb404bebe9e7d228859a26b7e40340438d0c427", "html_url": "https://github.com/rust-lang/rust/commit/1fb404bebe9e7d228859a26b7e40340438d0c427"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "f09c44b41c97650174ad5ae9f0f9429956b99ad4", "filename": "src/librustdoc/passes/url_improvements.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6be97e225099cc59dc63f6fc01af7c525d0334df/src%2Flibrustdoc%2Fpasses%2Furl_improvements.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6be97e225099cc59dc63f6fc01af7c525d0334df/src%2Flibrustdoc%2Fpasses%2Furl_improvements.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Furl_improvements.rs?ref=6be97e225099cc59dc63f6fc01af7c525d0334df", "patch": "@@ -19,8 +19,8 @@ pub const CHECK_URL_IMPROVEMENTS: Pass = Pass {\n const URL_REGEX: &str = concat!(\n     r\"https?://\",                          // url scheme\n     r\"([-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.)+\", // one or more subdomains\n-    r\"[a-zA-Z]{2,4}\",                      // root domain\n-    r\"\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)\"     // optional query or url fragments\n+    r\"[a-zA-Z]{2,63}\",                     // root domain\n+    r\"\\b([-a-zA-Z0-9@:%_\\+.~#?&/=]*)\"      // optional query or url fragments\n );\n \n struct UrlImprovementsLinter<'a, 'tcx> {\n@@ -101,8 +101,9 @@ impl<'a, 'tcx> DocFolder for UrlImprovementsLinter<'a, 'tcx> {\n                         while let Some((event, range)) = p.next() {\n                             match event {\n                                 Event::End(Tag::Link(_, url, _)) => {\n-                                    // NOTE: links cannot be nested, so we don't need to check `kind`\n-                                    if url.as_ref() == title && !ignore {\n+                                    // NOTE: links cannot be nested, so we don't need to\n+                                    // check `kind`\n+                                    if url.as_ref() == title && !ignore && self.regex.matches(url) {\n                                         report_diag(\n                                             self.cx,\n                                             \"unneeded long form for URL\","}, {"sha": "b7b1c26cd6deb620a7aa8560c704bece8aebde3e", "filename": "src/test/rustdoc-ui/url-improvements.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6be97e225099cc59dc63f6fc01af7c525d0334df/src%2Ftest%2Frustdoc-ui%2Furl-improvements.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6be97e225099cc59dc63f6fc01af7c525d0334df/src%2Ftest%2Frustdoc-ui%2Furl-improvements.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Furl-improvements.rs?ref=6be97e225099cc59dc63f6fc01af7c525d0334df", "patch": "@@ -55,6 +55,8 @@ pub fn c() {}\n /// ```\n /// This link should not be linted: http://example.com\n /// ```\n+///\n+/// [should_not.lint](should_not.lint)\n pub fn everything_is_fine_here() {}\n \n #[allow(url_improvements)]"}]}