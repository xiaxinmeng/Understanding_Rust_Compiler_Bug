{"sha": "0616cee92b47b539a802171f7e6817663175502d", "node_id": "C_kwDOAAsO6NoAKDA2MTZjZWU5MmI0N2I1MzlhODAyMTcxZjdlNjgxNzY2MzE3NTUwMmQ", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-08-16T14:51:40Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-08-16T14:51:40Z"}, "message": "Add a setting for keyword hover popups", "tree": {"sha": "3f1063db26911cfc05c0fbb462c54a5f0316a694", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3f1063db26911cfc05c0fbb462c54a5f0316a694"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0616cee92b47b539a802171f7e6817663175502d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0616cee92b47b539a802171f7e6817663175502d", "html_url": "https://github.com/rust-lang/rust/commit/0616cee92b47b539a802171f7e6817663175502d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0616cee92b47b539a802171f7e6817663175502d/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b6fae56e38f7eac1472df250712c7987510343f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/b6fae56e38f7eac1472df250712c7987510343f1", "html_url": "https://github.com/rust-lang/rust/commit/b6fae56e38f7eac1472df250712c7987510343f1"}], "stats": {"total": 67, "additions": 57, "deletions": 10}, "files": [{"sha": "3687b597fc642f6ad17cd8b9443341192cd8d28b", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=0616cee92b47b539a802171f7e6817663175502d", "patch": "@@ -27,6 +27,7 @@ use crate::{\n pub struct HoverConfig {\n     pub links_in_hover: bool,\n     pub documentation: Option<HoverDocFormat>,\n+    pub keywords: bool,\n }\n \n impl HoverConfig {"}, {"sha": "d52adaee535f99371b3ca9547ef380fb9cfa65d6", "filename": "crates/ide/src/hover/render.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fhover%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fhover%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover%2Frender.rs?ref=0616cee92b47b539a802171f7e6817663175502d", "patch": "@@ -230,7 +230,7 @@ pub(super) fn keyword(\n     config: &HoverConfig,\n     token: &SyntaxToken,\n ) -> Option<HoverResult> {\n-    if !token.kind().is_keyword() || !config.documentation.is_some() {\n+    if !token.kind().is_keyword() || !config.documentation.is_some() || !config.keywords {\n         return None;\n     }\n     let parent = token.parent()?;"}, {"sha": "685eb4521ebdaf7f10ee93be5f92d346d76f2c1d", "filename": "crates/ide/src/hover/tests.rs", "status": "modified", "additions": 35, "deletions": 7, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs?ref=0616cee92b47b539a802171f7e6817663175502d", "patch": "@@ -8,7 +8,11 @@ fn check_hover_no_result(ra_fixture: &str) {\n     let (analysis, position) = fixture::position(ra_fixture);\n     let hover = analysis\n         .hover(\n-            &HoverConfig { links_in_hover: true, documentation: Some(HoverDocFormat::Markdown) },\n+            &HoverConfig {\n+                links_in_hover: true,\n+                documentation: Some(HoverDocFormat::Markdown),\n+                keywords: true,\n+            },\n             FileRange { file_id: position.file_id, range: TextRange::empty(position.offset) },\n         )\n         .unwrap();\n@@ -20,7 +24,11 @@ fn check(ra_fixture: &str, expect: Expect) {\n     let (analysis, position) = fixture::position(ra_fixture);\n     let hover = analysis\n         .hover(\n-            &HoverConfig { links_in_hover: true, documentation: Some(HoverDocFormat::Markdown) },\n+            &HoverConfig {\n+                links_in_hover: true,\n+                documentation: Some(HoverDocFormat::Markdown),\n+                keywords: true,\n+            },\n             FileRange { file_id: position.file_id, range: TextRange::empty(position.offset) },\n         )\n         .unwrap()\n@@ -37,7 +45,11 @@ fn check_hover_no_links(ra_fixture: &str, expect: Expect) {\n     let (analysis, position) = fixture::position(ra_fixture);\n     let hover = analysis\n         .hover(\n-            &HoverConfig { links_in_hover: false, documentation: Some(HoverDocFormat::Markdown) },\n+            &HoverConfig {\n+                links_in_hover: false,\n+                documentation: Some(HoverDocFormat::Markdown),\n+                keywords: true,\n+            },\n             FileRange { file_id: position.file_id, range: TextRange::empty(position.offset) },\n         )\n         .unwrap()\n@@ -54,7 +66,11 @@ fn check_hover_no_markdown(ra_fixture: &str, expect: Expect) {\n     let (analysis, position) = fixture::position(ra_fixture);\n     let hover = analysis\n         .hover(\n-            &HoverConfig { links_in_hover: true, documentation: Some(HoverDocFormat::PlainText) },\n+            &HoverConfig {\n+                links_in_hover: true,\n+                documentation: Some(HoverDocFormat::PlainText),\n+                keywords: true,\n+            },\n             FileRange { file_id: position.file_id, range: TextRange::empty(position.offset) },\n         )\n         .unwrap()\n@@ -71,7 +87,11 @@ fn check_actions(ra_fixture: &str, expect: Expect) {\n     let (analysis, file_id, position) = fixture::range_or_position(ra_fixture);\n     let hover = analysis\n         .hover(\n-            &HoverConfig { links_in_hover: true, documentation: Some(HoverDocFormat::Markdown) },\n+            &HoverConfig {\n+                links_in_hover: true,\n+                documentation: Some(HoverDocFormat::Markdown),\n+                keywords: true,\n+            },\n             FileRange { file_id, range: position.range_or_empty() },\n         )\n         .unwrap()\n@@ -83,7 +103,11 @@ fn check_hover_range(ra_fixture: &str, expect: Expect) {\n     let (analysis, range) = fixture::range(ra_fixture);\n     let hover = analysis\n         .hover(\n-            &HoverConfig { links_in_hover: false, documentation: Some(HoverDocFormat::Markdown) },\n+            &HoverConfig {\n+                links_in_hover: false,\n+                documentation: Some(HoverDocFormat::Markdown),\n+                keywords: true,\n+            },\n             range,\n         )\n         .unwrap()\n@@ -95,7 +119,11 @@ fn check_hover_range_no_results(ra_fixture: &str) {\n     let (analysis, range) = fixture::range(ra_fixture);\n     let hover = analysis\n         .hover(\n-            &HoverConfig { links_in_hover: false, documentation: Some(HoverDocFormat::Markdown) },\n+            &HoverConfig {\n+                links_in_hover: false,\n+                documentation: Some(HoverDocFormat::Markdown),\n+                keywords: true,\n+            },\n             range,\n         )\n         .unwrap();"}, {"sha": "9e5eb909508f624e051042623de24232070a78ed", "filename": "crates/ide/src/static_index.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fstatic_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0616cee92b47b539a802171f7e6817663175502d/crates%2Fide%2Fsrc%2Fstatic_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fstatic_index.rs?ref=0616cee92b47b539a802171f7e6817663175502d", "patch": "@@ -130,8 +130,11 @@ impl StaticIndex<'_> {\n             syntax::NodeOrToken::Node(_) => None,\n             syntax::NodeOrToken::Token(x) => Some(x),\n         });\n-        let hover_config =\n-            HoverConfig { links_in_hover: true, documentation: Some(HoverDocFormat::Markdown) };\n+        let hover_config = HoverConfig {\n+            links_in_hover: true,\n+            documentation: Some(HoverDocFormat::Markdown),\n+            keywords: true,\n+        };\n         let tokens = tokens.filter(|token| {\n             matches!(\n                 token.kind(),"}, {"sha": "f2fae586024ad4e1759faf0990214dfb59f89ecb", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0616cee92b47b539a802171f7e6817663175502d/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0616cee92b47b539a802171f7e6817663175502d/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=0616cee92b47b539a802171f7e6817663175502d", "patch": "@@ -244,6 +244,9 @@ config_data! {\n \n         /// Whether to show documentation on hover.\n         hover_documentation_enable: bool       = \"true\",\n+        /// Whether to show keyword hover popups. Only applies when\n+        /// `#rust-analyzer.hover.documentation.enable#` is set.\n+        hover_documentation_keywords: bool     = \"true\",\n         /// Use markdown syntax for links in hover.\n         hover_links_enable: bool = \"true\",\n \n@@ -1187,6 +1190,7 @@ impl Config {\n                     HoverDocFormat::PlainText\n                 }\n             }),\n+            keywords: self.data.hover_documentation_keywords,\n         }\n     }\n "}, {"sha": "00a6e3c43c5cbd65d8dd0df5103e6e1324ee4c54", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0616cee92b47b539a802171f7e6817663175502d/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/0616cee92b47b539a802171f7e6817663175502d/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=0616cee92b47b539a802171f7e6817663175502d", "patch": "@@ -318,6 +318,12 @@ Whether to show `Run` action. Only applies when\n --\n Whether to show documentation on hover.\n --\n+[[rust-analyzer.hover.documentation.keywords]]rust-analyzer.hover.documentation.keywords (default: `true`)::\n++\n+--\n+Whether to show keyword hover popups. Only applies when\n+`#rust-analyzer.hover.documentation.enable#` is set.\n+--\n [[rust-analyzer.hover.links.enable]]rust-analyzer.hover.links.enable (default: `true`)::\n +\n --"}, {"sha": "6352e9681107e5d90084680cdcfa5abfc52fd19e", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0616cee92b47b539a802171f7e6817663175502d/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/0616cee92b47b539a802171f7e6817663175502d/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=0616cee92b47b539a802171f7e6817663175502d", "patch": "@@ -756,6 +756,11 @@\n                     \"default\": true,\n                     \"type\": \"boolean\"\n                 },\n+                \"rust-analyzer.hover.documentation.keywords\": {\n+                    \"markdownDescription\": \"Whether to show keyword hover popups. Only applies when\\n`#rust-analyzer.hover.documentation.enable#` is set.\",\n+                    \"default\": true,\n+                    \"type\": \"boolean\"\n+                },\n                 \"rust-analyzer.hover.links.enable\": {\n                     \"markdownDescription\": \"Use markdown syntax for links in hover.\",\n                     \"default\": true,"}]}