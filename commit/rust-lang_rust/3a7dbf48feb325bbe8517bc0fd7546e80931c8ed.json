{"sha": "3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhN2RiZjQ4ZmViMzI1YmJlODUxN2JjMGZkNzU0NmU4MDkzMWM4ZWQ=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2017-06-12T06:47:26Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2017-06-12T06:47:26Z"}, "message": "Suggest non-ambiguous comparison after cast\n\n```\nwarning: `<` is interpreted as a start of generic arguments for `usize`, not comparison\n  --> $DIR/issue-22644.rs:16:33\n   |\n16 |     println!(\"{}\", a as usize < b);\n   |                                 ^ expected one of `!`, `(`, `+`, `,`, `::`, or `>` here\n   |\nhelp: if you want to compare the casted value then write\n   |     println!(\"{}\", (a as usize) < b);\n```", "tree": {"sha": "5d56cb9e9d64e0cd41900be2305b1ef22f1b95e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5d56cb9e9d64e0cd41900be2305b1ef22f1b95e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "html_url": "https://github.com/rust-lang/rust/commit/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6d32153a6a70390e1c0c24907179d1e2a1f1ef9", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6d32153a6a70390e1c0c24907179d1e2a1f1ef9", "html_url": "https://github.com/rust-lang/rust/commit/a6d32153a6a70390e1c0c24907179d1e2a1f1ef9"}], "stats": {"total": 45, "additions": 43, "deletions": 2}, "files": [{"sha": "d7c21127474a49053b001133ce9f8e7ee8cf5b84", "filename": "src/librustc_errors/diagnostic.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Flibrustc_errors%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Flibrustc_errors%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Fdiagnostic.rs?ref=3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "patch": "@@ -248,6 +248,10 @@ impl Diagnostic {\n         self.message.iter().map(|i| i.0.to_owned()).collect::<String>()\n     }\n \n+    pub fn set_message(&mut self, message: &str) {\n+        self.message = vec![(message.to_owned(), Style::NoStyle)];\n+    }\n+\n     pub fn styled_message(&self) -> &Vec<(String, Style)> {\n         &self.message\n     }"}, {"sha": "76b14071ec3215f8dc8409ee09f94b409c9847a9", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "patch": "@@ -42,7 +42,7 @@ use ast::RangeEnd;\n use {ast, attr};\n use codemap::{self, CodeMap, Spanned, respan};\n use syntax_pos::{self, Span, BytePos};\n-use errors::{self, DiagnosticBuilder};\n+use errors::{self, DiagnosticBuilder, Level};\n use parse::{self, classify, token};\n use parse::common::SeqSep;\n use parse::lexer::TokenAndSpan;\n@@ -2840,7 +2840,24 @@ impl<'a> Parser<'a> {\n                         let path = match self.parse_path_without_generics(PathStyle::Type) {\n                             Ok(path) => {\n                                 // Successfully parsed the type leaving a `<` yet to parse\n-                                err.cancel();\n+                                let codemap = self.sess.codemap();\n+                                let suggestion_span = lhs_span.to(self.prev_span);\n+                                let suggestion = match codemap.span_to_snippet(suggestion_span) {\n+                                    Ok(lstring) => format!(\"({})\", lstring),\n+                                    _ => format!(\"(<expression>)\")\n+                                };\n+                                let warn_message = match codemap.span_to_snippet(self.prev_span) {\n+                                    Ok(lstring) => format!(\"`{}`\", lstring),\n+                                    _ => \"a type\".to_string(),\n+                                };\n+                                err.span_suggestion(suggestion_span,\n+                                                    \"if you want to compare the casted value then write\",\n+                                                    suggestion);\n+                                err.level = Level::Warning;\n+                                err.set_message(&format!(\"`<` is interpreted as a start of generic \\\n+                                                          arguments for {}, not a comparison\",\n+                                                          warn_message));\n+                                err.emit();\n                                 path\n                             }\n                             Err(mut path_err) => {"}, {"sha": "9269180396c5481ccaef648a9d640af194f5af37", "filename": "src/test/ui/issue-22644.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Ftest%2Fui%2Fissue-22644.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Ftest%2Fui%2Fissue-22644.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-22644.rs?ref=3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "previous_filename": "src/test/run-pass/issue-22644.rs"}, {"sha": "1e85daa57780036b4d83399b22bf35cb2480fa91", "filename": "src/test/ui/issue-22644.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Ftest%2Fui%2Fissue-22644.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3a7dbf48feb325bbe8517bc0fd7546e80931c8ed/src%2Ftest%2Fui%2Fissue-22644.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-22644.stderr?ref=3a7dbf48feb325bbe8517bc0fd7546e80931c8ed", "patch": "@@ -0,0 +1,20 @@\n+warning: `<` is interpreted as a start of generic arguments for `usize`, not comparison\n+  --> $DIR/issue-22644.rs:16:33\n+   |\n+16 |     println!(\"{}\", a as usize < b);\n+   |                                 ^ expected one of `!`, `(`, `+`, `,`, `::`, or `>` here\n+   |\n+help: if you want to compare the casted value then write\n+   |     println!(\"{}\", (a as usize) < b);\n+\n+warning: `<` is interpreted as a start of generic arguments for `usize`, not comparison\n+  --> $DIR/issue-22644.rs:17:33\n+   |\n+17 |     println!(\"{}\", a as usize < 4);\n+   |                                -^ unexpected token\n+   |                                |\n+   |                                expected one of `>`, identifier, lifetime, or type here\n+   |\n+help: if you want to compare the casted value then write\n+   |     println!(\"{}\", (a as usize) < 4);\n+"}]}