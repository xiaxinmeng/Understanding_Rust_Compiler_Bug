{"sha": "632f06d8eb586e9386723fa54a71c1dd19605a11", "node_id": "C_kwDOAAsO6NoAKDYzMmYwNmQ4ZWI1ODZlOTM4NjcyM2ZhNTRhNzFjMWRkMTk2MDVhMTE", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-10-21T05:11:07Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-21T05:11:07Z"}, "message": "Rollup merge of #90031 - durin42:allow-llvm-tests, r=Mark-Simulacrum\n\nconfig: add the option to enable LLVM tests\n\nI'm working on some LLVM patches in concert with a Rust patch, and it's\nhelping me quite a bit to have this as an option. It doesn't seem that\nhard, so I figured I'd formalize it in x.py and send it upstream.", "tree": {"sha": "6a84848f50cc0290388fdbf21cb3825d3bf73dfc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a84848f50cc0290388fdbf21cb3825d3bf73dfc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/632f06d8eb586e9386723fa54a71c1dd19605a11", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhcPZrCRBK7hj4Ov3rIwAAxv8IAKHSK9K3NP7RacFS5RH/zc5p\njGOL8tVu4QmcStXiBokxjuo4TuBiQCzI3JoasJOiY31Khkwih7VyM9eXtb06mesF\nzTboFFNI1uH2UhqZCy4kC5r2oRYpB9VV9Ia9jFC9Zlk7Utk85I2REMwVmK4ZeUn7\nUqZkiBMYz7gNgUQ/HaErJdbeS/x6XGKy5JfDn8mTYi2DXTVeHC+QpdXHO60PltDu\nxlWPlE5fX+s5FsCNFqhCT6IqEY+/GSrsUPjbLWZMzoGEAkWjLJhfDOyUJZWjZ2Zu\nZ6GCf6Zu/JMsEA99vF/ufP2Jub8s1Qx4np6xRaH7BszXEknlm5akZ+Jy78OEXs4=\n=NeLx\n-----END PGP SIGNATURE-----\n", "payload": "tree 6a84848f50cc0290388fdbf21cb3825d3bf73dfc\nparent a980587421aa25ee382acc9dc577430a77327edd\nparent f2a234e63c6f5db70a363507bf940dbc51d4efda\nauthor Yuki Okushi <jtitor@2k36.org> 1634793067 +0900\ncommitter GitHub <noreply@github.com> 1634793067 +0900\n\nRollup merge of #90031 - durin42:allow-llvm-tests, r=Mark-Simulacrum\n\nconfig: add the option to enable LLVM tests\n\nI'm working on some LLVM patches in concert with a Rust patch, and it's\nhelping me quite a bit to have this as an option. It doesn't seem that\nhard, so I figured I'd formalize it in x.py and send it upstream.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/632f06d8eb586e9386723fa54a71c1dd19605a11", "html_url": "https://github.com/rust-lang/rust/commit/632f06d8eb586e9386723fa54a71c1dd19605a11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/632f06d8eb586e9386723fa54a71c1dd19605a11/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a980587421aa25ee382acc9dc577430a77327edd", "url": "https://api.github.com/repos/rust-lang/rust/commits/a980587421aa25ee382acc9dc577430a77327edd", "html_url": "https://github.com/rust-lang/rust/commit/a980587421aa25ee382acc9dc577430a77327edd"}, {"sha": "f2a234e63c6f5db70a363507bf940dbc51d4efda", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2a234e63c6f5db70a363507bf940dbc51d4efda", "html_url": "https://github.com/rust-lang/rust/commit/f2a234e63c6f5db70a363507bf940dbc51d4efda"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "2128fdea2eb460e3144b4ba7265119f8434238b9", "filename": "config.toml.example", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/632f06d8eb586e9386723fa54a71c1dd19605a11/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/632f06d8eb586e9386723fa54a71c1dd19605a11/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=632f06d8eb586e9386723fa54a71c1dd19605a11", "patch": "@@ -68,6 +68,12 @@ changelog-seen = 2\n # Indicates whether the LLVM assertions are enabled or not\n #assertions = false\n \n+# Indicates whether the LLVM testsuite is enabled in the build or not. Does\n+# not execute the tests as part of the build as part of x.py build et al,\n+# just makes it possible to do `ninja check-llvm` in the staged LLVM build\n+# directory when doing LLVM development as part of Rust development.\n+#tests = false\n+\n # Indicates whether the LLVM plugin is enabled or not\n #plugins = false\n "}, {"sha": "8d03aade3413a42a0e59d717d853114f9ed3e8db", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/632f06d8eb586e9386723fa54a71c1dd19605a11/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/632f06d8eb586e9386723fa54a71c1dd19605a11/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=632f06d8eb586e9386723fa54a71c1dd19605a11", "patch": "@@ -90,6 +90,7 @@ pub struct Config {\n     // llvm codegen options\n     pub llvm_skip_rebuild: bool,\n     pub llvm_assertions: bool,\n+    pub llvm_tests: bool,\n     pub llvm_plugins: bool,\n     pub llvm_optimize: bool,\n     pub llvm_thin_lto: bool,\n@@ -422,6 +423,7 @@ struct Llvm {\n     thin_lto: Option<bool>,\n     release_debuginfo: Option<bool>,\n     assertions: Option<bool>,\n+    tests: Option<bool>,\n     plugins: Option<bool>,\n     ccache: Option<StringOrBool>,\n     version_check: Option<bool>,\n@@ -715,6 +717,7 @@ impl Config {\n         // Store off these values as options because if they're not provided\n         // we'll infer default values for them later\n         let mut llvm_assertions = None;\n+        let mut llvm_tests = None;\n         let mut llvm_plugins = None;\n         let mut debug = None;\n         let mut debug_assertions = None;\n@@ -740,6 +743,7 @@ impl Config {\n             }\n             set(&mut config.ninja_in_file, llvm.ninja);\n             llvm_assertions = llvm.assertions;\n+            llvm_tests = llvm.tests;\n             llvm_plugins = llvm.plugins;\n             llvm_skip_rebuild = llvm_skip_rebuild.or(llvm.skip_rebuild);\n             set(&mut config.llvm_optimize, llvm.optimize);\n@@ -991,6 +995,7 @@ impl Config {\n \n         config.llvm_skip_rebuild = llvm_skip_rebuild.unwrap_or(false);\n         config.llvm_assertions = llvm_assertions.unwrap_or(false);\n+        config.llvm_tests = llvm_tests.unwrap_or(false);\n         config.llvm_plugins = llvm_plugins.unwrap_or(false);\n         config.rust_optimize = optimize.unwrap_or(true);\n "}, {"sha": "6bfaeffa80705e65419d562a42ed2c9abcd8bb64", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/632f06d8eb586e9386723fa54a71c1dd19605a11/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/632f06d8eb586e9386723fa54a71c1dd19605a11/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=632f06d8eb586e9386723fa54a71c1dd19605a11", "patch": "@@ -170,6 +170,7 @@ impl Step for Llvm {\n \n         let assertions = if builder.config.llvm_assertions { \"ON\" } else { \"OFF\" };\n         let plugins = if builder.config.llvm_plugins { \"ON\" } else { \"OFF\" };\n+        let enable_tests = if builder.config.llvm_tests { \"ON\" } else { \"OFF\" };\n \n         cfg.out_dir(&out_dir)\n             .profile(profile)\n@@ -180,7 +181,7 @@ impl Step for Llvm {\n             .define(\"LLVM_INCLUDE_EXAMPLES\", \"OFF\")\n             .define(\"LLVM_INCLUDE_DOCS\", \"OFF\")\n             .define(\"LLVM_INCLUDE_BENCHMARKS\", \"OFF\")\n-            .define(\"LLVM_INCLUDE_TESTS\", \"OFF\")\n+            .define(\"LLVM_INCLUDE_TESTS\", enable_tests)\n             .define(\"LLVM_ENABLE_TERMINFO\", \"OFF\")\n             .define(\"LLVM_ENABLE_LIBEDIT\", \"OFF\")\n             .define(\"LLVM_ENABLE_BINDINGS\", \"OFF\")"}]}