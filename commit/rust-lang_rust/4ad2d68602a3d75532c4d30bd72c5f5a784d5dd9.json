{"sha": "4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhZDJkNjg2MDJhM2Q3NTUzMmM0ZDMwYmQ3MmM1ZjVhNzg0ZDVkZDk=", "commit": {"author": {"name": "Noah Lev", "email": "camelidcamel@gmail.com", "date": "2021-07-05T02:22:24Z"}, "committer": {"name": "Noah Lev", "email": "camelidcamel@gmail.com", "date": "2021-07-25T00:15:01Z"}, "message": "Escape item search summaries\n\nI noticed that `Pin::new()`'s search summary looked off, and I realized\nthat the reason is that it has inline code containing `Pin<P>`, which is\nnot escaped and thus renders as a paragraph tag!", "tree": {"sha": "33b23b97d9c3c75ccae787fc5b5f65fe66f93a62", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33b23b97d9c3c75ccae787fc5b5f65fe66f93a62"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "html_url": "https://github.com/rust-lang/rust/commit/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9/comments", "author": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e742158ef5483b9cd756b193402329af3d4ba177", "url": "https://api.github.com/repos/rust-lang/rust/commits/e742158ef5483b9cd756b193402329af3d4ba177", "html_url": "https://github.com/rust-lang/rust/commit/e742158ef5483b9cd756b193402329af3d4ba177"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "783b8b2db46a10be5619ca8b660331d85e2b9ab0", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "patch": "@@ -34,15 +34,14 @@ use std::str;\n use crate::clean::RenderedLink;\n use crate::doctest;\n use crate::html::escape::Escape;\n+use crate::html::format::Buffer;\n use crate::html::highlight;\n use crate::html::toc::TocBuilder;\n \n use pulldown_cmark::{\n     html, BrokenLink, CodeBlockKind, CowStr, Event, LinkType, Options, Parser, Tag,\n };\n \n-use super::format::Buffer;\n-\n #[cfg(test)]\n mod tests;\n \n@@ -1086,7 +1085,7 @@ fn markdown_summary_with_limit(\n     let mut stopped_early = false;\n \n     fn push(s: &mut String, text_length: &mut usize, text: &str) {\n-        s.push_str(text);\n+        write!(s, \"{}\", Escape(text)).unwrap();\n         *text_length += text.len();\n     }\n "}, {"sha": "1e4bdc2d15199525b173ed084984cfcc50ff04e2", "filename": "src/librustdoc/html/markdown/tests.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs?ref=4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "patch": "@@ -234,7 +234,17 @@ fn test_short_markdown_summary() {\n     t(\"hello [Rust](https://www.rust-lang.org \\\"Rust\\\") :)\", \"hello Rust :)\");\n     t(\"dud [link]\", \"dud [link]\");\n     t(\"code `let x = i32;` ...\", \"code <code>let x = i32;</code> \u2026\");\n-    t(\"type `Type<'static>` ...\", \"type <code>Type<'static></code> \u2026\");\n+    t(\"type `Type<'static>` ...\", \"type <code>Type&lt;&#39;static&gt;</code> \u2026\");\n+    // Test to ensure escaping and length-limiting work well together.\n+    // The output should be limited based on the input length,\n+    // rather than the output, because escaped versions of characters\n+    // are usually longer than how the character is actually displayed.\n+    t(\n+        \"& & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & &\",\n+        \"&amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \\\n+         &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \\\n+         &amp; &amp; &amp; &amp; &amp; \u2026\",\n+    );\n     t(\"# top header\", \"top header\");\n     t(\"# top header\\n\\nfollowed by a paragraph\", \"top header\");\n     t(\"## header\", \"header\");"}]}