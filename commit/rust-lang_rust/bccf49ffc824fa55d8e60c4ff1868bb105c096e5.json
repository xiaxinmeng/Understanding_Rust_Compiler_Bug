{"sha": "bccf49ffc824fa55d8e60c4ff1868bb105c096e5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjY2Y0OWZmYzgyNGZhNTVkOGU2MGM0ZmYxODY4YmIxMDVjMDk2ZTU=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-01T09:39:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-01T09:39:26Z"}, "message": "Rollup merge of #64029 - estebank:fix-miri, r=RalfJung\n\nAccount for rounding errors when deciding the diagnostic boundaries\n\nFix Miri by fixing the bug raised in https://github.com/rust-lang/rust/pull/63402#discussion_r319485328.\n\nFixes https://github.com/rust-lang/rust/issues/64020", "tree": {"sha": "94750b71958e60e4313c3629ef194d28cd43717a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/94750b71958e60e4313c3629ef194d28cd43717a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bccf49ffc824fa55d8e60c4ff1868bb105c096e5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJda5HOCRBK7hj4Ov3rIwAAdHIIAKUQrmx2XcKkW9+EYkMqcAlE\nUBKYUHJnPGjabu2w8LiarTWikzbXQfHpgT4F81ylFx3Zcyr3XBaIlIcnjlvTxRgE\nSUiNnxArrKMbBmWp0jpq9zFliFs6roENXN9GKlGZp2Q8qTlM0JhDxRKf32Us5Fjv\nEbVcZ520vy772ihtbE++9UrwUkhDSOxQ0EboN3gBQqiv2tUFfBmOYhKv9Go0H8N3\nIRGFrMuqKLtNnP612dt6IASkVwq3fdrbLbA/csbS/NiBgZd3kbLJ8ucRe/SiwtCC\nGjp5mivNWnxEc/LG9ziF02R0a/z+VwIwJwXSPmR7HRlSZoSOO+f6QSYMC1I6ZD0=\n=Gx7G\n-----END PGP SIGNATURE-----\n", "payload": "tree 94750b71958e60e4313c3629ef194d28cd43717a\nparent 064b7041c509d5004a5e7b027f56202e1eb13167\nparent 84567190e0d36f9a61f9bc833bd9fa559aeb0089\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1567330766 +0200\ncommitter GitHub <noreply@github.com> 1567330766 +0200\n\nRollup merge of #64029 - estebank:fix-miri, r=RalfJung\n\nAccount for rounding errors when deciding the diagnostic boundaries\n\nFix Miri by fixing the bug raised in https://github.com/rust-lang/rust/pull/63402#discussion_r319485328.\n\nFixes https://github.com/rust-lang/rust/issues/64020\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bccf49ffc824fa55d8e60c4ff1868bb105c096e5", "html_url": "https://github.com/rust-lang/rust/commit/bccf49ffc824fa55d8e60c4ff1868bb105c096e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bccf49ffc824fa55d8e60c4ff1868bb105c096e5/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "064b7041c509d5004a5e7b027f56202e1eb13167", "url": "https://api.github.com/repos/rust-lang/rust/commits/064b7041c509d5004a5e7b027f56202e1eb13167", "html_url": "https://github.com/rust-lang/rust/commit/064b7041c509d5004a5e7b027f56202e1eb13167"}, {"sha": "84567190e0d36f9a61f9bc833bd9fa559aeb0089", "url": "https://api.github.com/repos/rust-lang/rust/commits/84567190e0d36f9a61f9bc833bd9fa559aeb0089", "html_url": "https://github.com/rust-lang/rust/commit/84567190e0d36f9a61f9bc833bd9fa559aeb0089"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "a0ce761cfa2771010458b6b7b2e44d49a2d088fe", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bccf49ffc824fa55d8e60c4ff1868bb105c096e5/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bccf49ffc824fa55d8e60c4ff1868bb105c096e5/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=bccf49ffc824fa55d8e60c4ff1868bb105c096e5", "patch": "@@ -146,12 +146,12 @@ impl Margin {\n             } else if self.label_right - self.span_left <= self.column_width {\n                 // Attempt to fit the code window considering only the spans and labels.\n                 let padding_left = (self.column_width - (self.label_right - self.span_left)) / 2;\n-                self.computed_left = self.span_left - padding_left;\n+                self.computed_left = self.span_left.saturating_sub(padding_left);\n                 self.computed_right = self.computed_left + self.column_width;\n             } else if self.span_right - self.span_left <= self.column_width {\n                 // Attempt to fit the code window considering the spans and labels plus padding.\n                 let padding_left = (self.column_width - (self.span_right - self.span_left)) / 5 * 2;\n-                self.computed_left = self.span_left - padding_left;\n+                self.computed_left = self.span_left.saturating_sub(padding_left);\n                 self.computed_right = self.computed_left + self.column_width;\n             } else { // Mostly give up but still don't show the full line.\n                 self.computed_left = self.span_left;\n@@ -1304,11 +1304,13 @@ impl EmitterWriter {\n                 };\n \n                 let column_width = if let Some(width) = self.terminal_width {\n-                    width\n+                    width.saturating_sub(code_offset)\n                 } else if self.ui_testing {\n                     140\n                 } else {\n-                    term_size::dimensions().map(|(w, _)| w - code_offset).unwrap_or(140)\n+                    term_size::dimensions()\n+                        .map(|(w, _)| w.saturating_sub(code_offset))\n+                        .unwrap_or(std::usize::MAX)\n                 };\n \n                 let margin = Margin::new("}]}