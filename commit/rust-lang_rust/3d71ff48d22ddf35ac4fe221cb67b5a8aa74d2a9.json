{"sha": "3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "node_id": "C_kwDOAAsO6NoAKDNkNzFmZjQ4ZDIyZGRmMzVhYzRmZTIyMWNiNjdiNWE4YWE3NGQyYTk", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-10-02T01:16:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-02T01:16:39Z"}, "message": "Rollup merge of #102525 - notriddle:notriddle/array-link, r=GuillaumeGomez,jsha\n\nrustdoc: remove orphaned link on array bracket\n\nThis is #98069, but for arrays instead.\n\nFor non-generics, this retains links to the array page, but instead of trying to link it all, it only links the length part, which distinguishes arrays from slices.\n\nFor generics, the entire thing becomes a link, just like slices.\n\n| Type | Before | After |\n|--|--|--|\n| u32 | <code>pub fn alpha() -&gt; &amp;'static <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">[</a><a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.u32.html\">u32</a><a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">; 1]</a></code> | <code>pub fn alpha() -&gt; &amp;'static [<a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.u32.html\">u32</a>; <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">1</a>]</code>\n| generic | <code>pub fn beta&lt;T&gt;() -&gt; &amp;'static <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">[</a>T<a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">; 1]</a></code> | <code>pub fn beta&lt;T&gt;() -&gt; &amp;'static <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">[T; 1]</a></code>", "tree": {"sha": "7aac4d01a50f7cf451f5412d7317abd453ab3db2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7aac4d01a50f7cf451f5412d7317abd453ab3db2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjOOZ3CRBK7hj4Ov3rIwAAc3sIAFW9CmjUFp4W3XjERSd6p3J+\nX9fYthMcYKUHM2Ws60eZCmuwrxPVVDkrAROMdcEtDaRQikoN6pLNZmfDV0eqTSZD\nrjB6fX9Z6zmtyiv8FAAikD7kOSSQyA5ihFnPUR5EBLLqap2DkIGHktFbQEgy1Wy5\nFAIBz0s5pp13WUsCU4ZWF2UrS+GUZ2whfsw/VFo2pTlQaxopV2tXHn9aiNlOntMN\nU/jykn4WwPVuSHMQm81KcDLKQmoH8bHyzRUAymqpWyU5F/wfPosnMJjWf3B7djXU\nnhSXYU/tm/Vm5kIt36E+U0+QTYjbcjo8HtGx8KXf5t9dUjvkGj8Al0fDicnrwf8=\n=zcmO\n-----END PGP SIGNATURE-----\n", "payload": "tree 7aac4d01a50f7cf451f5412d7317abd453ab3db2\nparent baba8391c30e6dfdbc712dc5be6693886677ffe3\nparent 598a02c6ad78fc00fbfc1370391c645b9446e3f1\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1664673399 +0200\ncommitter GitHub <noreply@github.com> 1664673399 +0200\n\nRollup merge of #102525 - notriddle:notriddle/array-link, r=GuillaumeGomez,jsha\n\nrustdoc: remove orphaned link on array bracket\n\nThis is #98069, but for arrays instead.\n\nFor non-generics, this retains links to the array page, but instead of trying to link it all, it only links the length part, which distinguishes arrays from slices.\n\nFor generics, the entire thing becomes a link, just like slices.\n\n| Type | Before | After |\n|--|--|--|\n| u32 | <code>pub fn alpha() -&gt; &amp;'static <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">[</a><a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.u32.html\">u32</a><a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">; 1]</a></code> | <code>pub fn alpha() -&gt; &amp;'static [<a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.u32.html\">u32</a>; <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">1</a>]</code>\n| generic | <code>pub fn beta&lt;T&gt;() -&gt; &amp;'static <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">[</a>T<a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">; 1]</a></code> | <code>pub fn beta&lt;T&gt;() -&gt; &amp;'static <a class=\"primitive\" href=\"http://doc.rust-lang.org/nightly/core/primitive.array.html\">[T; 1]</a></code>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "html_url": "https://github.com/rust-lang/rust/commit/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "baba8391c30e6dfdbc712dc5be6693886677ffe3", "url": "https://api.github.com/repos/rust-lang/rust/commits/baba8391c30e6dfdbc712dc5be6693886677ffe3", "html_url": "https://github.com/rust-lang/rust/commit/baba8391c30e6dfdbc712dc5be6693886677ffe3"}, {"sha": "598a02c6ad78fc00fbfc1370391c645b9446e3f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/598a02c6ad78fc00fbfc1370391c645b9446e3f1", "html_url": "https://github.com/rust-lang/rust/commit/598a02c6ad78fc00fbfc1370391c645b9446e3f1"}], "stats": {"total": 58, "additions": 50, "deletions": 8}, "files": [{"sha": "6d46267931bad589b7e0db93390d209ec11d24b0", "filename": "src/librustdoc/html/format.rs", "status": "modified", "additions": 18, "deletions": 8, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fformat.rs?ref=3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "patch": "@@ -1010,15 +1010,25 @@ fn fmt_type<'cx>(\n                 write!(f, \"]\")\n             }\n         },\n-        clean::Array(ref t, ref n) => {\n-            primitive_link(f, PrimitiveType::Array, \"[\", cx)?;\n-            fmt::Display::fmt(&t.print(cx), f)?;\n-            if f.alternate() {\n-                primitive_link(f, PrimitiveType::Array, &format!(\"; {}]\", n), cx)\n-            } else {\n-                primitive_link(f, PrimitiveType::Array, &format!(\"; {}]\", Escape(n)), cx)\n+        clean::Array(ref t, ref n) => match **t {\n+            clean::Generic(name) if !f.alternate() => primitive_link(\n+                f,\n+                PrimitiveType::Array,\n+                &format!(\"[{name}; {n}]\", n = Escape(n)),\n+                cx,\n+            ),\n+            _ => {\n+                write!(f, \"[\")?;\n+                fmt::Display::fmt(&t.print(cx), f)?;\n+                if f.alternate() {\n+                    write!(f, \"; {n}\")?;\n+                } else {\n+                    write!(f, \"; \")?;\n+                    primitive_link(f, PrimitiveType::Array, &format!(\"{n}\", n = Escape(n)), cx)?;\n+                }\n+                write!(f, \"]\")\n             }\n-        }\n+        },\n         clean::RawPointer(m, ref t) => {\n             let m = match m {\n                 hir::Mutability::Mut => \"mut\","}, {"sha": "3481bb6a025473101c28d877838e2db87603abd1", "filename": "src/test/rustdoc/array-links.link_box_generic.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_box_generic.html", "raw_url": "https://github.com/rust-lang/rust/raw/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_box_generic.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Farray-links.link_box_generic.html?ref=3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "patch": "@@ -0,0 +1 @@\n+<code>pub fn delta&lt;T&gt;() -&gt; <a class=\"struct\" href=\"struct.MyBox.html\" title=\"struct foo::MyBox\">MyBox</a>&lt;<a class=\"primitive\" href=\"{{channel}}/core/primitive.array.html\">[T; 1]</a>&gt;</code>\n\\ No newline at end of file"}, {"sha": "e864ae55c9f4bbf3bd0000380e29dc4589e93177", "filename": "src/test/rustdoc/array-links.link_box_u32.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_box_u32.html", "raw_url": "https://github.com/rust-lang/rust/raw/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_box_u32.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Farray-links.link_box_u32.html?ref=3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "patch": "@@ -0,0 +1 @@\n+<code>pub fn gamma() -&gt; <a class=\"struct\" href=\"struct.MyBox.html\" title=\"struct foo::MyBox\">MyBox</a>&lt;[<a class=\"primitive\" href=\"{{channel}}/core/primitive.u32.html\">u32</a>; <a class=\"primitive\" href=\"{{channel}}/core/primitive.array.html\">1</a>]&gt;</code>\n\\ No newline at end of file"}, {"sha": "f1ca2f59bd7ca9328f43082cbf5d616159f71f16", "filename": "src/test/rustdoc/array-links.link_slice_generic.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_slice_generic.html", "raw_url": "https://github.com/rust-lang/rust/raw/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_slice_generic.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Farray-links.link_slice_generic.html?ref=3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "patch": "@@ -0,0 +1 @@\n+<code>pub fn beta&lt;T&gt;() -&gt; &amp;'static <a class=\"primitive\" href=\"{{channel}}/core/primitive.array.html\">[T; 1]</a></code>\n\\ No newline at end of file"}, {"sha": "c3943e8d3212290b1dd7af7463bee517a2291ecd", "filename": "src/test/rustdoc/array-links.link_slice_u32.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_slice_u32.html", "raw_url": "https://github.com/rust-lang/rust/raw/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.link_slice_u32.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Farray-links.link_slice_u32.html?ref=3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "patch": "@@ -0,0 +1 @@\n+<code>pub fn alpha() -&gt; &amp;'static [<a class=\"primitive\" href=\"{{channel}}/core/primitive.u32.html\">u32</a>; <a class=\"primitive\" href=\"{{channel}}/core/primitive.array.html\">1</a>]</code>\n\\ No newline at end of file"}, {"sha": "07f92ac51b9f53de511b434344791a001f42fd37", "filename": "src/test/rustdoc/array-links.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9/src%2Ftest%2Frustdoc%2Farray-links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Farray-links.rs?ref=3d71ff48d22ddf35ac4fe221cb67b5a8aa74d2a9", "patch": "@@ -0,0 +1,28 @@\n+#![crate_name = \"foo\"]\n+#![no_std]\n+\n+pub struct MyBox<T: ?Sized>(*const T);\n+\n+// @has 'foo/fn.alpha.html'\n+// @snapshot link_slice_u32 - '//pre[@class=\"rust fn\"]/code'\n+pub fn alpha() -> &'static [u32; 1] {\n+    loop {}\n+}\n+\n+// @has 'foo/fn.beta.html'\n+// @snapshot link_slice_generic - '//pre[@class=\"rust fn\"]/code'\n+pub fn beta<T>() -> &'static [T; 1] {\n+    loop {}\n+}\n+\n+// @has 'foo/fn.gamma.html'\n+// @snapshot link_box_u32 - '//pre[@class=\"rust fn\"]/code'\n+pub fn gamma() -> MyBox<[u32; 1]> {\n+    loop {}\n+}\n+\n+// @has 'foo/fn.delta.html'\n+// @snapshot link_box_generic - '//pre[@class=\"rust fn\"]/code'\n+pub fn delta<T>() -> MyBox<[T; 1]> {\n+    loop {}\n+}"}]}