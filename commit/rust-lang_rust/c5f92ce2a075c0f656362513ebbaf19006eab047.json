{"sha": "c5f92ce2a075c0f656362513ebbaf19006eab047", "node_id": "C_kwDOAAsO6NoAKGM1ZjkyY2UyYTA3NWMwZjY1NjM2MjUxM2ViYmFmMTkwMDZlYWIwNDc", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-20T17:21:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-20T17:21:49Z"}, "message": "Rollup merge of #104611 - notriddle:notriddle/scrape-examples-button, r=GuillaumeGomez\n\nrustdoc: use real buttons for scrape examples controls\n\nThis makes the expand and switch controls keyboard-accessible.\n\nPreview: https://notriddle.com/notriddle-rustdoc-demos/scrape-examples-button/test_dingus/fn.test.html", "tree": {"sha": "cab658b97c22a3d21cec0af024765c28b0a10d52", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cab658b97c22a3d21cec0af024765c28b0a10d52"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c5f92ce2a075c0f656362513ebbaf19006eab047", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjemItCRBK7hj4Ov3rIwAAKk8IACnKFpruVfe0aNe5lcMeCu8b\n7fb+Fk/oWuXaWPiwhQea296NPmOtXlEShQ/JtgUYk02ZELIVVubPCzu8KN6Gmh+Y\nM281BVggKNT5oH+9BwwILiDbQ+A1X7pLvjXzGejjC/ugNKkaK4Edo1yFPe7+snJO\nHDfa9EbG6gYuVq67eCpWJcCDdYL6Qv4nf8ZsnXC+xfhqkgrNpBNo+vRiqoHSXTMQ\nsgCm1Y8wFIxpqhv7xpVU9suNkOTTiETkcrBHu88WqB80IFKFUeS9K99TRYksOf5E\npyUt+mEIbmTd4qAfIf13Wg0ID5rxGHMCMESVfTvWTwKxTzMiHgJ59OCYjt07LHY=\n=btaK\n-----END PGP SIGNATURE-----\n", "payload": "tree cab658b97c22a3d21cec0af024765c28b0a10d52\nparent db5f005f35ee8abdf772d518fea09fcadd97fb43\nparent a3ae6fec8970a09f2983bbc8db90719f11d438ca\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1668964909 +0100\ncommitter GitHub <noreply@github.com> 1668964909 +0100\n\nRollup merge of #104611 - notriddle:notriddle/scrape-examples-button, r=GuillaumeGomez\n\nrustdoc: use real buttons for scrape examples controls\n\nThis makes the expand and switch controls keyboard-accessible.\n\nPreview: https://notriddle.com/notriddle-rustdoc-demos/scrape-examples-button/test_dingus/fn.test.html\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c5f92ce2a075c0f656362513ebbaf19006eab047", "html_url": "https://github.com/rust-lang/rust/commit/c5f92ce2a075c0f656362513ebbaf19006eab047", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c5f92ce2a075c0f656362513ebbaf19006eab047/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db5f005f35ee8abdf772d518fea09fcadd97fb43", "url": "https://api.github.com/repos/rust-lang/rust/commits/db5f005f35ee8abdf772d518fea09fcadd97fb43", "html_url": "https://github.com/rust-lang/rust/commit/db5f005f35ee8abdf772d518fea09fcadd97fb43"}, {"sha": "a3ae6fec8970a09f2983bbc8db90719f11d438ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3ae6fec8970a09f2983bbc8db90719f11d438ca", "html_url": "https://github.com/rust-lang/rust/commit/a3ae6fec8970a09f2983bbc8db90719f11d438ca"}], "stats": {"total": 82, "additions": 77, "deletions": 5}, "files": [{"sha": "38873cee93bd982475849358869314fca0a41eac", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -1011,6 +1011,8 @@ impl Step for RustdocGUI {\n                 //        instead of hard-coding this test\n                 if entry.file_name() == \"link_to_definition\" {\n                     cargo.env(\"RUSTDOCFLAGS\", \"-Zunstable-options --generate-link-to-definition\");\n+                } else if entry.file_name() == \"scrape_examples\" {\n+                    cargo.arg(\"-Zrustdoc-scrape-examples=examples\");\n                 }\n                 builder.run(&mut cargo);\n             }"}, {"sha": "647eb69d9a6f6e8d0a6923c0f0026679c86d2330", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -2915,7 +2915,7 @@ fn render_call_locations(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Ite\n         );\n \n         if line_ranges.len() > 1 {\n-            write!(w, r#\"<span class=\"prev\">&pr;</span> <span class=\"next\">&sc;</span>\"#);\n+            write!(w, r#\"<button class=\"prev\">&pr;</button> <button class=\"next\">&sc;</button>\"#);\n         }\n \n         // Look for the example file in the source map if it exists, otherwise return a dummy span"}, {"sha": "54e296959b0ec97fb569a2210d1e0054cece775f", "filename": "src/librustdoc/html/sources.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Fsources.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Fsources.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fsources.rs?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -287,8 +287,11 @@ pub(crate) fn print_src(\n             }\n         }\n         SourceContext::Embedded { offset, needs_expansion } => {\n-            extra =\n-                if needs_expansion { Some(r#\"<span class=\"expand\">&varr;</span>\"#) } else { None };\n+            extra = if needs_expansion {\n+                Some(r#\"<button class=\"expand\">&varr;</button>\"#)\n+            } else {\n+                None\n+            };\n             for line_number in 1..=lines {\n                 let line = line_number + offset;\n                 writeln!(line_numbers, \"<span>{line}</span>\")"}, {"sha": "10f3c0e95d7085833769d2187499b29ec0f6aa02", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -1965,6 +1965,12 @@ in storage.js\n \ttop: 0.25em;\n \tz-index: 1;\n \tcursor: pointer;\n+\tpadding: 0;\n+\tbackground: none;\n+\tborder: none;\n+\t/* iOS button gradient: https://stackoverflow.com/q/5438567 */\n+\t-webkit-appearance: none;\n+\topacity: 1;\n }\n .scraped-example .code-wrapper .prev {\n \tright: 2.25em;"}, {"sha": "df13e597f1fdce383482e2f8ef37baef21dacc73", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -40,7 +40,7 @@\n     {%- endif -%}\n     <script defer src=\"{{static_root_path|safe}}{{files.main_js}}\"></script> {#- -#}\n     {%- if layout.scrape_examples_extension -%}\n-    <script defer src=\"{{page.root_path|safe}}{{files.scrape_examples_js}}\"></script> {#- -#}\n+    <script defer src=\"{{static_root_path|safe}}{{files.scrape_examples_js}}\"></script> {#- -#}\n     {%- endif -%}\n     <noscript> {#- -#}\n         <link rel=\"stylesheet\" {# -#}"}, {"sha": "2a263a87a47566b834700fc8763af3db24e03cbb", "filename": "src/test/rustdoc-gui/scrape-examples-button-focus.goml", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-button-focus.goml", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-button-focus.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-button-focus.goml?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -0,0 +1,14 @@\n+goto: \"file://\" + |DOC_PATH| + \"/scrape_examples/fn.test.html\"\n+store-property: (smallOffsetHeight, \".scraped-example-list > .scraped-example pre\", \"offsetHeight\")\n+assert-property-false: (\".scraped-example-list > .scraped-example pre\", {\n+\t\"scrollHeight\": |smallOffsetHeight|\n+})\n+focus: \".scraped-example-list > .scraped-example .expand\"\n+press-key: \"Enter\"\n+assert-property-false: (\".scraped-example-list > .scraped-example pre\", {\n+\t\"offsetHeight\": |smallOffsetHeight|\n+})\n+store-property: (fullOffsetHeight, \".scraped-example-list > .scraped-example pre\", \"offsetHeight\")\n+assert-property: (\".scraped-example-list > .scraped-example pre\", {\n+\t\"scrollHeight\": |fullOffsetHeight|\n+})"}, {"sha": "36e4d555b8ed21ec68abfac989e875f36f3c8dee", "filename": "src/test/rustdoc-gui/sidebar-source-code.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -28,7 +28,7 @@ assert: \"//*[@class='dir-entry' and @open]/*[text()='sub_mod']\"\n // Only \"another_folder\" should be \"open\" in \"lib2\".\n assert: \"//*[@class='dir-entry' and not(@open)]/*[text()='another_mod']\"\n // All other trees should be collapsed.\n-assert-count: (\"//*[@id='source-sidebar']/details[not(text()='lib2') and not(@open)]\", 6)\n+assert-count: (\"//*[@id='source-sidebar']/details[not(text()='lib2') and not(@open)]\", 7)\n \n // We now switch to mobile mode.\n size: (600, 600)"}, {"sha": "7cd6d0844e4b3a8df67cd79ed32d7f73576f3b5f", "filename": "src/test/rustdoc-gui/src/scrape_examples/Cargo.lock", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2FCargo.lock?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -0,0 +1,7 @@\n+# This file is automatically @generated by Cargo.\n+# It is not intended for manual editing.\n+version = 3\n+\n+[[package]]\n+name = \"scrape_examples\"\n+version = \"0.1.0\""}, {"sha": "aea9b657d307e80c4ebe43175c5d66453f332ec9", "filename": "src/test/rustdoc-gui/src/scrape_examples/Cargo.toml", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2FCargo.toml?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -0,0 +1,8 @@\n+[package]\n+name = \"scrape_examples\"\n+version = \"0.1.0\"\n+edition = \"2021\"\n+\n+# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n+\n+[dependencies]"}, {"sha": "3e69c6086ae2ed51928af3b47a919a8206fe3c8c", "filename": "src/test/rustdoc-gui/src/scrape_examples/examples/check.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2Fexamples%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2Fexamples%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2Fexamples%2Fcheck.rs?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -0,0 +1,25 @@\n+fn main() {\n+    for i in 0..9 {\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+    }\n+    scrape_examples::test();\n+    for i in 0..9 {\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+        println!(\"hello world!\");\n+    }\n+}"}, {"sha": "6412de2c03afd2747786c62f9213945308b437b5", "filename": "src/test/rustdoc-gui/src/scrape_examples/src/lib.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5f92ce2a075c0f656362513ebbaf19006eab047/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Fscrape_examples%2Fsrc%2Flib.rs?ref=c5f92ce2a075c0f656362513ebbaf19006eab047", "patch": "@@ -0,0 +1,7 @@\n+/// # Examples\n+///\n+/// ```\n+/// test();\n+/// test();\n+/// ```\n+pub fn test() {}"}]}