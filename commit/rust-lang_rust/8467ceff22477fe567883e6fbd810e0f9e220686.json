{"sha": "8467ceff22477fe567883e6fbd810e0f9e220686", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0NjdjZWZmMjI0NzdmZTU2Nzg4M2U2ZmJkODEwZTBmOWUyMjA2ODY=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-10-24T00:32:33Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-10-24T00:32:33Z"}, "message": "Tweak format string error to point at arguments always\n\nAdd secondary span labels with no text to make it clear when there's a\nmismatch bewteen the positional arguments in a format string and the\narguments to the macro. This shouldn't affect experienced users, but it\nshould make it easier for newcomers to more clearly understand how\n`format!()` and `println!()` are supposed to be used.\n\n```\nerror: 2 positional arguments in format string, but there is 1 argument\n --> file8.rs:2:14\n  |\n2 |     format!(\"{} {}\", 1);\n  |              ^^ ^^   -\n```\n\ninstead of\n\n```\nerror: 2 positional arguments in format string, but there is 1 argument\n --> file8.rs:2:14\n  |\n2 |     format!(\"{} {}\", 1);\n  |              ^^ ^^\n```", "tree": {"sha": "d302064b010d4a5698efea38ec1071c5f06c828b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d302064b010d4a5698efea38ec1071c5f06c828b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8467ceff22477fe567883e6fbd810e0f9e220686", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8467ceff22477fe567883e6fbd810e0f9e220686", "html_url": "https://github.com/rust-lang/rust/commit/8467ceff22477fe567883e6fbd810e0f9e220686", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8467ceff22477fe567883e6fbd810e0f9e220686/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4a8c5b20c7772bc5342b83d4b0696ea216ef75a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/4a8c5b20c7772bc5342b83d4b0696ea216ef75a7", "html_url": "https://github.com/rust-lang/rust/commit/4a8c5b20c7772bc5342b83d4b0696ea216ef75a7"}], "stats": {"total": 25, "additions": 19, "deletions": 6}, "files": [{"sha": "37310f46f7eed7c4a93fca9b99306fd0ab610593", "filename": "src/libsyntax_ext/format.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Flibsyntax_ext%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Flibsyntax_ext%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fformat.rs?ref=8467ceff22477fe567883e6fbd810e0f9e220686", "patch": "@@ -278,7 +278,7 @@ impl<'a, 'b> Context<'a, 'b> {\n     /// format string.\n     fn report_invalid_references(&self, numbered_position_args: bool) {\n         let mut e;\n-        let sp = if self.is_literal {\n+        let sp = if self.is_literal { // Point at the formatting arguments.\n             MultiSpan::from_spans(self.arg_spans.clone())\n         } else {\n             MultiSpan::from_span(self.fmtsp)\n@@ -304,6 +304,9 @@ impl<'a, 'b> Context<'a, 'b> {\n                     self.describe_num_args(),\n                 ),\n             );\n+            for arg in &self.args { // Point at the arguments that will be formatted.\n+                e.span_label(arg.span, \"\");\n+            }\n         } else {\n             let (mut refs, spans): (Vec<_>, Vec<_>) = refs.unzip();\n             // Avoid `invalid reference to positional arguments 7 and 7 (there is 1 argument)`"}, {"sha": "691c06a2402c5352ec39c4650ff3d82bb0d76505", "filename": "src/test/ui/fmt/format-string-error.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.rs?ref=8467ceff22477fe567883e6fbd810e0f9e220686", "patch": "@@ -48,4 +48,6 @@ fn main() {\n \n \"###);\n     //~^^^ ERROR invalid format string: unmatched `}` found\n+    println!(\"{} {} {}\", 1, 2);\n+    //~^ ERROR 3 positional arguments in format string, but there are 2 arguments\n }"}, {"sha": "32119b18774b25585c1f00395a2a80b5fd04dbf0", "filename": "src/test/ui/fmt/format-string-error.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.stderr?ref=8467ceff22477fe567883e6fbd810e0f9e220686", "patch": "@@ -107,5 +107,11 @@ LL |         }\n    |\n    = note: if you intended to print `}`, you can escape it using `}}`\n \n-error: aborting due to 12 previous errors\n+error: 3 positional arguments in format string, but there are 2 arguments\n+  --> $DIR/format-string-error.rs:51:15\n+   |\n+LL |     println!(\"{} {} {}\", 1, 2);\n+   |               ^^ ^^ ^^   -  -\n+\n+error: aborting due to 13 previous errors\n "}, {"sha": "c58cbc312335a6588553ec4967cd721672eb074d", "filename": "src/test/ui/if/ifmt-bad-arg.stderr", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8467ceff22477fe567883e6fbd810e0f9e220686/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr?ref=8467ceff22477fe567883e6fbd810e0f9e220686", "patch": "@@ -224,8 +224,9 @@ error: 4 positional arguments in format string, but there are 3 arguments\n   --> $DIR/ifmt-bad-arg.rs:78:15\n    |\n LL |     println!(\"{} {:.*} {}\", 1, 3.2, 4);\n-   |               ^^ ^^--^ ^^      --- this parameter corresponds to the precision flag\n-   |                    |\n+   |               ^^ ^^--^ ^^   -  ---  -\n+   |                    |           |\n+   |                    |           this parameter corresponds to the precision flag\n    |                    this precision flag adds an extra required argument at position 1, which is why there are 4 arguments expected\n    |\n    = note: positional arguments are zero-based\n@@ -235,8 +236,9 @@ error: 4 positional arguments in format string, but there are 3 arguments\n   --> $DIR/ifmt-bad-arg.rs:81:15\n    |\n LL |     println!(\"{} {:07$.*} {}\", 1, 3.2, 4);\n-   |               ^^ ^^^----^ ^^      --- this parameter corresponds to the precision flag\n-   |                     | |\n+   |               ^^ ^^^----^ ^^   -  ---  -\n+   |                     | |           |\n+   |                     | |           this parameter corresponds to the precision flag\n    |                     | this precision flag adds an extra required argument at position 1, which is why there are 4 arguments expected\n    |                     this width flag expects an `usize` argument at position 7, but there are 3 arguments\n    |"}]}