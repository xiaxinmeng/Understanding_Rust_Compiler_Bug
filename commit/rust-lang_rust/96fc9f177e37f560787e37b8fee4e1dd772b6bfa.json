{"sha": "96fc9f177e37f560787e37b8fee4e1dd772b6bfa", "node_id": "C_kwDOAAsO6NoAKDk2ZmM5ZjE3N2UzN2Y1NjA3ODdlMzdiOGZlZTRlMWRkNzcyYjZiZmE", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-08-10T16:28:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-10T16:28:24Z"}, "message": "Rollup merge of #100359 - b-naber:valtrees-pretty-print-ice, r=lcnr\n\nSpecial-case references to leafs in valtree pretty-printing\n\nFixes https://github.com/rust-lang/rust/issues/100313", "tree": {"sha": "3b83176d382bfb3fca5dca109622f8d2074d032d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3b83176d382bfb3fca5dca109622f8d2074d032d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96fc9f177e37f560787e37b8fee4e1dd772b6bfa", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi89yoCRBK7hj4Ov3rIwAA6rgIAJZJGIILBPmkvduN7lnh8lX2\nG3si5JNr148iSzuCsQY9WjLnT9gPi25qAXKd1StoiNygV0w6jOP/m3brTpPigdbd\neO3+wscevd5RrBJJtSZRZ/tboNaxkr/kQC7Nhr4/sXifTeVwDFp4KeYyvC+h531B\n46rrl9Z+r2OKUV++zqIcqqHlUGmza9oHUovkFl+sqLnTMcOSlLk2fJnb0+cctzox\n9rBcnN45SOhz48b7WjeBi9lI0fVZvOmpTUpL4gYcAXfcOCRHaFpsx4mUYalFHvpC\n8b6r9Ytpg+XliwCvjj1G3sz8tb5Q3/l7m8DJJd27up83fkCytHJP8ChIdH4/sQg=\n=3N4u\n-----END PGP SIGNATURE-----\n", "payload": "tree 3b83176d382bfb3fca5dca109622f8d2074d032d\nparent efa182f3db46b70841dc4481b112cb365b52921a\nparent 4bf350dc388792fe859580ad92b422f701573616\nauthor Michael Goulet <michael@errs.io> 1660148904 -0700\ncommitter GitHub <noreply@github.com> 1660148904 -0700\n\nRollup merge of #100359 - b-naber:valtrees-pretty-print-ice, r=lcnr\n\nSpecial-case references to leafs in valtree pretty-printing\n\nFixes https://github.com/rust-lang/rust/issues/100313\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96fc9f177e37f560787e37b8fee4e1dd772b6bfa", "html_url": "https://github.com/rust-lang/rust/commit/96fc9f177e37f560787e37b8fee4e1dd772b6bfa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96fc9f177e37f560787e37b8fee4e1dd772b6bfa/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efa182f3db46b70841dc4481b112cb365b52921a", "url": "https://api.github.com/repos/rust-lang/rust/commits/efa182f3db46b70841dc4481b112cb365b52921a", "html_url": "https://github.com/rust-lang/rust/commit/efa182f3db46b70841dc4481b112cb365b52921a"}, {"sha": "4bf350dc388792fe859580ad92b422f701573616", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bf350dc388792fe859580ad92b422f701573616", "html_url": "https://github.com/rust-lang/rust/commit/4bf350dc388792fe859580ad92b422f701573616"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "cc55b7e8611af2b6562a2904b5d1c42687aef7c3", "filename": "compiler/rustc_middle/src/ty/print/pretty.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/96fc9f177e37f560787e37b8fee4e1dd772b6bfa/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96fc9f177e37f560787e37b8fee4e1dd772b6bfa/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs?ref=96fc9f177e37f560787e37b8fee4e1dd772b6bfa", "patch": "@@ -1513,6 +1513,10 @@ pub trait PrettyPrinter<'tcx>:\n                 }\n                 return Ok(self);\n             }\n+            (ty::ValTree::Leaf(leaf), ty::Ref(_, inner_ty, _)) => {\n+                p!(write(\"&\"));\n+                return self.pretty_print_const_scalar_int(leaf, *inner_ty, print_ty);\n+            }\n             (ty::ValTree::Leaf(leaf), _) => {\n                 return self.pretty_print_const_scalar_int(leaf, ty, print_ty);\n             }"}, {"sha": "4e9d3626aa89c82be790cd1036addc6738ac1e70", "filename": "src/test/ui/const-generics/issues/issue-100313.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/96fc9f177e37f560787e37b8fee4e1dd772b6bfa/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-100313.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96fc9f177e37f560787e37b8fee4e1dd772b6bfa/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-100313.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-100313.rs?ref=96fc9f177e37f560787e37b8fee4e1dd772b6bfa", "patch": "@@ -0,0 +1,21 @@\n+#![allow(incomplete_features)]\n+#![feature(const_mut_refs)]\n+#![feature(adt_const_params)]\n+\n+struct T<const B: &'static bool>;\n+\n+impl <const B: &'static bool> T<B> {\n+    const fn set_false(&self) {\n+        unsafe {\n+            *(B as *const bool as *mut bool) = false;\n+            //~^ ERROR evaluation of constant value failed [E0080]\n+        }\n+    }\n+}\n+\n+const _: () = {\n+    let x = T::<{&true}>;\n+    x.set_false();\n+};\n+\n+fn main() {}"}, {"sha": "f3ce357c2bb8d9b8f221d0f9e436b36c4a9eb84e", "filename": "src/test/ui/const-generics/issues/issue-100313.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/96fc9f177e37f560787e37b8fee4e1dd772b6bfa/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-100313.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/96fc9f177e37f560787e37b8fee4e1dd772b6bfa/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-100313.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-100313.stderr?ref=96fc9f177e37f560787e37b8fee4e1dd772b6bfa", "patch": "@@ -0,0 +1,15 @@\n+error[E0080]: evaluation of constant value failed\n+  --> $DIR/issue-100313.rs:10:13\n+   |\n+LL |             *(B as *const bool as *mut bool) = false;\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |             |\n+   |             writing to alloc7 which is read-only\n+   |             inside `T::<&true>::set_false` at $DIR/issue-100313.rs:10:13\n+...\n+LL |     x.set_false();\n+   |     ------------- inside `_` at $DIR/issue-100313.rs:18:5\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0080`."}]}