{"sha": "35994db6d3426e3f4545e0061cb5046a7979265f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1OTk0ZGI2ZDM0MjZlM2Y0NTQ1ZTAwNjFjYjUwNDZhNzk3OTI2NWY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-08-21T11:30:39Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-08-21T11:30:39Z"}, "message": "Minor, remove double nesting of a test module", "tree": {"sha": "d679f932a67649b9b2b8e3286d1172d94f3c91d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d679f932a67649b9b2b8e3286d1172d94f3c91d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/35994db6d3426e3f4545e0061cb5046a7979265f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/35994db6d3426e3f4545e0061cb5046a7979265f", "html_url": "https://github.com/rust-lang/rust/commit/35994db6d3426e3f4545e0061cb5046a7979265f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/35994db6d3426e3f4545e0061cb5046a7979265f/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32cb8d40eb4382bd67510c0f06fc855063f0fde8", "url": "https://api.github.com/repos/rust-lang/rust/commits/32cb8d40eb4382bd67510c0f06fc855063f0fde8", "html_url": "https://github.com/rust-lang/rust/commit/32cb8d40eb4382bd67510c0f06fc855063f0fde8"}], "stats": {"total": 257, "additions": 121, "deletions": 136}, "files": [{"sha": "b0209ac2899d616fd7e0fab082ea4b2915e5ed1c", "filename": "src/librustc_lexer/src/tests.rs", "status": "modified", "additions": 121, "deletions": 136, "changes": 257, "blob_url": "https://github.com/rust-lang/rust/blob/35994db6d3426e3f4545e0061cb5046a7979265f/src%2Flibrustc_lexer%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/35994db6d3426e3f4545e0061cb5046a7979265f/src%2Flibrustc_lexer%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lexer%2Fsrc%2Ftests.rs?ref=35994db6d3426e3f4545e0061cb5046a7979265f", "patch": "@@ -1,137 +1,122 @@\n-#[cfg(test)]\n-mod tests {\n-    use crate::*;\n-\n-    fn check_raw_str(s: &str, expected_hashes: u16, expected_err: Option<RawStrError>) {\n-        let s = &format!(\"r{}\", s);\n-        let mut cursor = Cursor::new(s);\n-        cursor.bump();\n-        let (n_hashes, err) = cursor.raw_double_quoted_string(0);\n-        assert_eq!(n_hashes, expected_hashes);\n-        assert_eq!(err, expected_err);\n-    }\n-\n-    #[test]\n-    fn test_naked_raw_str() {\n-        check_raw_str(r#\"\"abc\"\"#, 0, None);\n-    }\n-\n-    #[test]\n-    fn test_raw_no_start() {\n-        check_raw_str(r##\"\"abc\"#\"##, 0, None);\n-    }\n-\n-    #[test]\n-    fn test_too_many_terminators() {\n-        // this error is handled in the parser later\n-        check_raw_str(r###\"#\"abc\"##\"###, 1, None);\n-    }\n-\n-    #[test]\n-    fn test_unterminated() {\n-        check_raw_str(\n-            r#\"#\"abc\"#,\n-            1,\n-            Some(RawStrError::NoTerminator {\n-                expected: 1,\n-                found: 0,\n-                possible_terminator_offset: None,\n-            }),\n-        );\n-        check_raw_str(\n-            r###\"##\"abc\"#\"###,\n-            2,\n-            Some(RawStrError::NoTerminator {\n-                expected: 2,\n-                found: 1,\n-                possible_terminator_offset: Some(7),\n-            }),\n-        );\n-        // We're looking for \"# not just any #\n-        check_raw_str(\n-            r###\"##\"abc#\"###,\n-            2,\n-            Some(RawStrError::NoTerminator {\n-                expected: 2,\n-                found: 0,\n-                possible_terminator_offset: None,\n-            }),\n-        )\n-    }\n-\n-    #[test]\n-    fn test_invalid_start() {\n-        check_raw_str(r##\"#~\"abc\"#\"##, 1, Some(RawStrError::InvalidStarter { bad_char: '~' }));\n-    }\n-\n-    #[test]\n-    fn test_unterminated_no_pound() {\n-        // https://github.com/rust-lang/rust/issues/70677\n-        check_raw_str(\n-            r#\"\"\"#,\n-            0,\n-            Some(RawStrError::NoTerminator {\n-                expected: 0,\n-                found: 0,\n-                possible_terminator_offset: None,\n-            }),\n-        );\n-    }\n-\n-    #[test]\n-    fn test_valid_shebang() {\n-        // https://github.com/rust-lang/rust/issues/70528\n-        let input = \"#!/usr/bin/rustrun\\nlet x = 5;\";\n-        assert_eq!(strip_shebang(input), Some(18));\n-    }\n-\n-    #[test]\n-    fn test_invalid_shebang_valid_rust_syntax() {\n-        // https://github.com/rust-lang/rust/issues/70528\n-        let input = \"#!    [bad_attribute]\";\n-        assert_eq!(strip_shebang(input), None);\n-    }\n-\n-    #[test]\n-    fn test_shebang_second_line() {\n-        // Because shebangs are interpreted by the kernel, they must be on the first line\n-        let input = \"\\n#!/bin/bash\";\n-        assert_eq!(strip_shebang(input), None);\n-    }\n-\n-    #[test]\n-    fn test_shebang_space() {\n-        let input = \"#!    /bin/bash\";\n-        assert_eq!(strip_shebang(input), Some(input.len()));\n-    }\n-\n-    #[test]\n-    fn test_shebang_empty_shebang() {\n-        let input = \"#!    \\n[attribute(foo)]\";\n-        assert_eq!(strip_shebang(input), None);\n-    }\n-\n-    #[test]\n-    fn test_invalid_shebang_comment() {\n-        let input = \"#!//bin/ami/a/comment\\n[\";\n-        assert_eq!(strip_shebang(input), None)\n-    }\n-\n-    #[test]\n-    fn test_invalid_shebang_another_comment() {\n-        let input = \"#!/*bin/ami/a/comment*/\\n[attribute\";\n-        assert_eq!(strip_shebang(input), None)\n-    }\n-\n-    #[test]\n-    fn test_shebang_valid_rust_after() {\n-        let input = \"#!/*bin/ami/a/comment*/\\npub fn main() {}\";\n-        assert_eq!(strip_shebang(input), Some(23))\n-    }\n-\n-    #[test]\n-    fn test_shebang_followed_by_attrib() {\n-        let input = \"#!/bin/rust-scripts\\n#![allow_unused(true)]\";\n-        assert_eq!(strip_shebang(input), Some(19));\n-    }\n+use super::*;\n+\n+fn check_raw_str(s: &str, expected_hashes: u16, expected_err: Option<RawStrError>) {\n+    let s = &format!(\"r{}\", s);\n+    let mut cursor = Cursor::new(s);\n+    cursor.bump();\n+    let (n_hashes, err) = cursor.raw_double_quoted_string(0);\n+    assert_eq!(n_hashes, expected_hashes);\n+    assert_eq!(err, expected_err);\n+}\n+\n+#[test]\n+fn test_naked_raw_str() {\n+    check_raw_str(r#\"\"abc\"\"#, 0, None);\n+}\n+\n+#[test]\n+fn test_raw_no_start() {\n+    check_raw_str(r##\"\"abc\"#\"##, 0, None);\n+}\n+\n+#[test]\n+fn test_too_many_terminators() {\n+    // this error is handled in the parser later\n+    check_raw_str(r###\"#\"abc\"##\"###, 1, None);\n+}\n+\n+#[test]\n+fn test_unterminated() {\n+    check_raw_str(\n+        r#\"#\"abc\"#,\n+        1,\n+        Some(RawStrError::NoTerminator { expected: 1, found: 0, possible_terminator_offset: None }),\n+    );\n+    check_raw_str(\n+        r###\"##\"abc\"#\"###,\n+        2,\n+        Some(RawStrError::NoTerminator {\n+            expected: 2,\n+            found: 1,\n+            possible_terminator_offset: Some(7),\n+        }),\n+    );\n+    // We're looking for \"# not just any #\n+    check_raw_str(\n+        r###\"##\"abc#\"###,\n+        2,\n+        Some(RawStrError::NoTerminator { expected: 2, found: 0, possible_terminator_offset: None }),\n+    )\n+}\n+\n+#[test]\n+fn test_invalid_start() {\n+    check_raw_str(r##\"#~\"abc\"#\"##, 1, Some(RawStrError::InvalidStarter { bad_char: '~' }));\n+}\n+\n+#[test]\n+fn test_unterminated_no_pound() {\n+    // https://github.com/rust-lang/rust/issues/70677\n+    check_raw_str(\n+        r#\"\"\"#,\n+        0,\n+        Some(RawStrError::NoTerminator { expected: 0, found: 0, possible_terminator_offset: None }),\n+    );\n+}\n+\n+#[test]\n+fn test_valid_shebang() {\n+    // https://github.com/rust-lang/rust/issues/70528\n+    let input = \"#!/usr/bin/rustrun\\nlet x = 5;\";\n+    assert_eq!(strip_shebang(input), Some(18));\n+}\n+\n+#[test]\n+fn test_invalid_shebang_valid_rust_syntax() {\n+    // https://github.com/rust-lang/rust/issues/70528\n+    let input = \"#!    [bad_attribute]\";\n+    assert_eq!(strip_shebang(input), None);\n+}\n+\n+#[test]\n+fn test_shebang_second_line() {\n+    // Because shebangs are interpreted by the kernel, they must be on the first line\n+    let input = \"\\n#!/bin/bash\";\n+    assert_eq!(strip_shebang(input), None);\n+}\n+\n+#[test]\n+fn test_shebang_space() {\n+    let input = \"#!    /bin/bash\";\n+    assert_eq!(strip_shebang(input), Some(input.len()));\n+}\n+\n+#[test]\n+fn test_shebang_empty_shebang() {\n+    let input = \"#!    \\n[attribute(foo)]\";\n+    assert_eq!(strip_shebang(input), None);\n+}\n+\n+#[test]\n+fn test_invalid_shebang_comment() {\n+    let input = \"#!//bin/ami/a/comment\\n[\";\n+    assert_eq!(strip_shebang(input), None)\n+}\n+\n+#[test]\n+fn test_invalid_shebang_another_comment() {\n+    let input = \"#!/*bin/ami/a/comment*/\\n[attribute\";\n+    assert_eq!(strip_shebang(input), None)\n+}\n+\n+#[test]\n+fn test_shebang_valid_rust_after() {\n+    let input = \"#!/*bin/ami/a/comment*/\\npub fn main() {}\";\n+    assert_eq!(strip_shebang(input), Some(23))\n+}\n+\n+#[test]\n+fn test_shebang_followed_by_attrib() {\n+    let input = \"#!/bin/rust-scripts\\n#![allow_unused(true)]\";\n+    assert_eq!(strip_shebang(input), Some(19));\n }"}]}