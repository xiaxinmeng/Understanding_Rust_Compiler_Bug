{"sha": "b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8", "node_id": "C_kwDOAAsO6NoAKGI4N2E5YThhN2M0MDQ4NGJjOTQ1MTVmZDZkNTFlNmUyNzFhZDRjYjg", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-10-06T19:33:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-06T19:33:18Z"}, "message": "Rollup merge of #89329 - tmiasko:print-type-sizes-no-fields, r=jackh726\n\nprint-type-sizes: skip field printing for primitives\n\nFixes #86528.", "tree": {"sha": "c74bddaf74a414dbedae743b8d53b6eba6b604ed", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c74bddaf74a414dbedae743b8d53b6eba6b604ed"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhXfn+CRBK7hj4Ov3rIwAAbwMIALLGFQBihdnp2wAseaKQIKzw\n2yfFxBxOi/J+JCIOKQZTYXrMYv/VOGYDMvfX/AakKVhooRIlt8okjh6YLCY8NZeA\n1o3Z5tR7aAa23Isqb8g59FK4jQS+R2eNPZvPOhWZFqQVJOL24L6D1ffEA3iTpFwc\nKxLobYEor3jlHgBFKFbslFz/O+1f4aqcIdNKYdnP880oPQYpNTtQ767jNdeIFp/K\nidBG65w/S8p4Z+UbXQVQSti3uRynjGPGNF5wQArnK+CO5NeMyopIdZ6t9wJPOYVP\n4VP//od4bEM+BpqpvFOhnNwXDZoqs8hvXqSrxf5wOWD7cRrM3ZdaYj2ZBaa8qZ4=\n=89oH\n-----END PGP SIGNATURE-----\n", "payload": "tree c74bddaf74a414dbedae743b8d53b6eba6b604ed\nparent b4615b5bf9e3e722b480190714ad44ecd7fa2ed1\nparent 25b6f9b68b6ff4bdcce01feaa5259ff2786c4851\nauthor Manish Goregaokar <manishsmail@gmail.com> 1633548798 -0700\ncommitter GitHub <noreply@github.com> 1633548798 -0700\n\nRollup merge of #89329 - tmiasko:print-type-sizes-no-fields, r=jackh726\n\nprint-type-sizes: skip field printing for primitives\n\nFixes #86528.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8", "html_url": "https://github.com/rust-lang/rust/commit/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4615b5bf9e3e722b480190714ad44ecd7fa2ed1", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4615b5bf9e3e722b480190714ad44ecd7fa2ed1", "html_url": "https://github.com/rust-lang/rust/commit/b4615b5bf9e3e722b480190714ad44ecd7fa2ed1"}, {"sha": "25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "url": "https://api.github.com/repos/rust-lang/rust/commits/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "html_url": "https://github.com/rust-lang/rust/commit/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "fee13fd2e2eaff797bcd0c85967a06654c395c06", "filename": "compiler/rustc_middle/src/ty/layout.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs?ref=b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8", "patch": "@@ -1826,8 +1826,11 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n \n         match layout.variants {\n             Variants::Single { index } => {\n-                debug!(\"print-type-size `{:#?}` variant {}\", layout, adt_def.variants[index].ident);\n-                if !adt_def.variants.is_empty() {\n+                if !adt_def.variants.is_empty() && layout.fields != FieldsShape::Primitive {\n+                    debug!(\n+                        \"print-type-size `{:#?}` variant {}\",\n+                        layout, adt_def.variants[index].ident\n+                    );\n                     let variant_def = &adt_def.variants[index];\n                     let fields: Vec<_> = variant_def.fields.iter().map(|f| f.ident.name).collect();\n                     record("}, {"sha": "06a62db4ebb0f37014d835f0e71fc2f2fe85ad25", "filename": "src/test/ui/print_type_sizes/uninhabited.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.rs?ref=b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8", "patch": "@@ -11,5 +11,5 @@\n fn start(_: isize, _: *const *const u8) -> isize {\n     let _x: Option<!> = None;\n     let _y: Result<u32, !> = Ok(42);\n-    0\n+    let _z: Result<!, !> = loop {};\n }"}, {"sha": "5eb5384bce34060023359990010bc47617a2e145", "filename": "src/test/ui/print_type_sizes/uninhabited.stdout", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.stdout?ref=b87a9a8a7c40484bc94515fd6d51e6e271ad4cb8", "patch": "@@ -3,3 +3,4 @@ print-type-size     variant `Ok`: 4 bytes\n print-type-size         field `.0`: 4 bytes\n print-type-size type: `std::option::Option<!>`: 0 bytes, alignment: 1 bytes\n print-type-size     variant `None`: 0 bytes\n+print-type-size type: `std::result::Result<!, !>`: 0 bytes, alignment: 1 bytes"}]}