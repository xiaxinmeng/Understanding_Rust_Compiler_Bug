{"sha": "7628806997c4ace2dc334f4d88bfc0bf8adc583a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2Mjg4MDY5OTdjNGFjZTJkYzMzNGY0ZDg4YmZjMGJmOGFkYzU4M2E=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-12-30T00:47:21Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-12-30T01:26:05Z"}, "message": "mk: Package mingw components in unix installer on windows\n\nThis puts stdc++ and the unwinding dll into the main package\nand creates a separate rust-mingw package for everything else.", "tree": {"sha": "b562c892d09439b9e46d6493203d68bfb8bf48c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b562c892d09439b9e46d6493203d68bfb8bf48c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7628806997c4ace2dc334f4d88bfc0bf8adc583a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7628806997c4ace2dc334f4d88bfc0bf8adc583a", "html_url": "https://github.com/rust-lang/rust/commit/7628806997c4ace2dc334f4d88bfc0bf8adc583a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7628806997c4ace2dc334f4d88bfc0bf8adc583a/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "022d48566be471cc0e29aa0b0c552b3684529866", "url": "https://api.github.com/repos/rust-lang/rust/commits/022d48566be471cc0e29aa0b0c552b3684529866", "html_url": "https://github.com/rust-lang/rust/commit/022d48566be471cc0e29aa0b0c552b3684529866"}], "stats": {"total": 41, "additions": 33, "deletions": 8}, "files": [{"sha": "1fa1a85e55b74f9b998f722887237c2bbaaca551", "filename": "mk/dist.mk", "status": "modified", "additions": 33, "deletions": 2, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/7628806997c4ace2dc334f4d88bfc0bf8adc583a/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7628806997c4ace2dc334f4d88bfc0bf8adc583a/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=7628806997c4ace2dc334f4d88bfc0bf8adc583a", "patch": "@@ -24,6 +24,7 @@\n \n PKG_NAME := $(CFG_PACKAGE_NAME)\n DOC_PKG_NAME := rust-docs-$(CFG_PACKAGE_VERS)\n+MINGW_PKG_NAME := rust-mingw-$(CFG_PACKAGE_VERS)\n \n # License suitable for displaying in a popup\n LICENSE.txt: $(S)COPYRIGHT $(S)LICENSE-APACHE $(S)LICENSE-MIT\n@@ -238,6 +239,12 @@ dist-install-dir-$(1): prepare-base-dir-$(1) docs compiler-docs\n \n dist/$$(PKG_NAME)-$(1).tar.gz: dist-install-dir-$(1)\n \t@$(call E, build: $$@)\n+# Copy essential gcc components into installer\n+ifdef CFG_WINDOWSY_$(1)\n+\t$$(Q)rm -Rf dist/win-rust-gcc-$(1)\n+\t$$(Q)$$(CFG_PYTHON) $$(S)src/etc/make-win-dist.py tmp/dist/$$(PKG_NAME)-$(1)-image dist/win-rust-gcc-$(1) $(1)\n+\t$$(Q)cp -r $$(S)src/etc/third-party tmp/dist/$$(PKG_NAME)-$(1)-image/share/doc/\n+endif\n \t$$(Q)$$(S)src/rust-installer/gen-installer.sh \\\n \t\t--product-name=Rust \\\n \t\t--verify-bin=rustc \\\n@@ -271,6 +278,25 @@ dist/$$(DOC_PKG_NAME)-$(1).tar.gz: dist-doc-install-dir-$(1)\n \t\t--bulk-dirs=share/doc/rust/html\n \t$$(Q)rm -R tmp/dist/$$(DOC_PKG_NAME)-$(1)-image\n \n+dist-mingw-install-dir-$(1):\n+\t$$(Q)mkdir -p tmp/dist/rust-mingw-tmp-$(1)-image\n+\t$$(Q)rm -Rf tmp/dist/$$(MINGW_PKG_NAME)-$(1)-image\n+\t$$(Q)$$(CFG_PYTHON) $$(S)src/etc/make-win-dist.py \\\n+\t\ttmp/dist/rust-mingw-tmp-$(1)-image tmp/dist/$$(MINGW_PKG_NAME)-$(1)-image $(1)\n+\n+dist/$$(MINGW_PKG_NAME)-$(1).tar.gz: dist-mingw-install-dir-$(1)\n+\t@$(call E, build: $$@)\n+\t$$(Q)$$(S)src/rust-installer/gen-installer.sh \\\n+\t\t--product-name=Rust-MinGW \\\n+\t\t--rel-manifest-dir=rustlib \\\n+\t\t--success-message=Rust-MinGW-is-installed. \\\n+\t\t--image-dir=tmp/dist/$$(MINGW_PKG_NAME)-$(1)-image \\\n+\t\t--work-dir=tmp/dist \\\n+\t\t--output-dir=dist \\\n+\t\t--package-name=$$(MINGW_PKG_NAME)-$(1) \\\n+\t\t--component-name=rust-mingw \\\n+\t\t--legacy-manifest-dirs=rustlib,cargo\n+\t$$(Q)rm -R tmp/dist/$$(MINGW_PKG_NAME)-$(1)-image\n \n endef\n \n@@ -284,11 +310,16 @@ endif\n \n dist-install-dirs: $(foreach host,$(CFG_HOST),dist-install-dir-$(host))\n \n+ifdef CFG_WINDOWSY_$(CFG_BUILD)\n+MAYBE_MINGW_TARBALLS=$(foreach host,$(CFG_HOST),dist/$(MINGW_PKG_NAME)-$(host).tar.gz)\n+endif\n+\n ifneq ($(CFG_DISABLE_DOCS),)\n-dist-tar-bins: $(foreach host,$(CFG_HOST),dist/$(PKG_NAME)-$(host).tar.gz)\n+dist-tar-bins: $(foreach host,$(CFG_HOST),dist/$(PKG_NAME)-$(host).tar.gz) $(MAYBE_MINGW_TARBALLS)\n else\n dist-tar-bins: $(foreach host,$(CFG_HOST),dist/$(PKG_NAME)-$(host).tar.gz) \\\n-               $(foreach host,$(CFG_HOST),dist/$(DOC_PKG_NAME)-$(host).tar.gz)\n+               $(foreach host,$(CFG_HOST),dist/$(DOC_PKG_NAME)-$(host).tar.gz) \\\n+               $(MAYBE_MINGW_TARBALLS)\n endif\n \n # Just try to run the compiler for the build host"}, {"sha": "ea2a98db2dc1f94bc98fce3668c9a33fa18fadfd", "filename": "src/etc/make-win-dist.py", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7628806997c4ace2dc334f4d88bfc0bf8adc583a/src%2Fetc%2Fmake-win-dist.py", "raw_url": "https://github.com/rust-lang/rust/raw/7628806997c4ace2dc334f4d88bfc0bf8adc583a/src%2Fetc%2Fmake-win-dist.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmake-win-dist.py?ref=7628806997c4ace2dc334f4d88bfc0bf8adc583a", "patch": "@@ -114,11 +114,5 @@ def make_win_dist(rust_root, gcc_root, target_triple):\n     for src in target_libs:\n         shutil.copy(src, target_lib_dir)\n \n-    # Copy license files\n-    lic_dir = os.path.join(rust_root, \"bin\", \"third-party\")\n-    if os.path.exists(lic_dir):\n-        shutil.rmtree(lic_dir) # copytree() won't overwrite existing files\n-    shutil.copytree(os.path.join(os.path.dirname(__file__), \"third-party\"), lic_dir)\n-\n if __name__==\"__main__\":\n     make_win_dist(sys.argv[1], sys.argv[2], sys.argv[3])"}]}