{"sha": "58fdbdc4ef7cee014775bafff23830900fcaf3ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4ZmRiZGM0ZWY3Y2VlMDE0Nzc1YmFmZmYyMzgzMDkwMGZjYWYzY2E=", "commit": {"author": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-30T22:32:19Z"}, "committer": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-31T00:39:53Z"}, "message": "Avoid some more copies.", "tree": {"sha": "b4ceb9b62d1864e145df7cacf481ed642f605fdc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4ceb9b62d1864e145df7cacf481ed642f605fdc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/58fdbdc4ef7cee014775bafff23830900fcaf3ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/58fdbdc4ef7cee014775bafff23830900fcaf3ca", "html_url": "https://github.com/rust-lang/rust/commit/58fdbdc4ef7cee014775bafff23830900fcaf3ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/58fdbdc4ef7cee014775bafff23830900fcaf3ca/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0c345841ce14f6ce618d1ed09c1d728bd253c87", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0c345841ce14f6ce618d1ed09c1d728bd253c87", "html_url": "https://github.com/rust-lang/rust/commit/f0c345841ce14f6ce618d1ed09c1d728bd253c87"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "56f764bf4d5cf08dffc9abb5e22ebbf0d955c367", "filename": "src/test/bench/graph500-bfs.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/58fdbdc4ef7cee014775bafff23830900fcaf3ca/src%2Ftest%2Fbench%2Fgraph500-bfs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58fdbdc4ef7cee014775bafff23830900fcaf3ca/src%2Ftest%2Fbench%2Fgraph500-bfs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fgraph500-bfs.rs?ref=58fdbdc4ef7cee014775bafff23830900fcaf3ca", "patch": "@@ -199,7 +199,7 @@ fn bfs2(graph: graph, key: node_id) -> bfs_result {\n }\n \n #[doc=\"A parallel version of the bfs function.\"]\n-fn pbfs(graph: graph, key: node_id) -> bfs_result {\n+fn pbfs(&&graph: arc::arc<graph>, key: node_id) -> bfs_result {\n     // This works by doing functional updates of a color vector.\n \n     enum color {\n@@ -210,7 +210,7 @@ fn pbfs(graph: graph, key: node_id) -> bfs_result {\n         black(node_id)\n     };\n \n-    let mut colors = vec::from_fn(graph.len()) {|i|\n+    let mut colors = vec::from_fn((*arc::get(&graph)).len()) {|i|\n         if i as node_id == key {\n             gray(key)\n         }\n@@ -227,8 +227,6 @@ fn pbfs(graph: graph, key: node_id) -> bfs_result {\n         }\n     }\n \n-    let graph = arc::arc(copy graph);\n-\n     let mut i = 0u;\n     while par::any(colors, is_gray) {\n         // Do the BFS.\n@@ -386,7 +384,7 @@ fn main(args: [str]) {\n     let scale = uint::from_str(args[1]).get();\n     let num_keys = uint::from_str(args[2]).get();\n     let do_validate = false;\n-    let do_sequential = true;\n+    let do_sequential = false;\n \n     let start = time::precise_time_s();\n     let edges = make_edges(scale, 16u);\n@@ -409,6 +407,8 @@ fn main(args: [str]) {\n     let mut total_seq = 0.0;\n     let mut total_par = 0.0;\n \n+    let graph_arc = arc::arc(copy graph);\n+\n     gen_search_keys(graph, num_keys).map() {|root|\n         io::stdout().write_line(\"\");\n         io::stdout().write_line(#fmt(\"Search key: %?\", root));\n@@ -456,7 +456,7 @@ fn main(args: [str]) {\n         }\n         \n         let start = time::precise_time_s();\n-        let bfs_tree = pbfs(graph, root);\n+        let bfs_tree = pbfs(graph_arc, root);\n         let stop = time::precise_time_s();\n \n         total_par += stop - start;"}]}