{"sha": "b6cce7ea5497977291f4ae57937360978e764e41", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2Y2NlN2VhNTQ5Nzk3NzI5MWY0YWU1NzkzNzM2MDk3OGU3NjRlNDE=", "commit": {"author": {"name": "Phil Ruffwind", "email": "rf@rufflewind.com", "date": "2014-05-04T21:27:42Z"}, "committer": {"name": "Phil Ruffwind", "email": "rf@rufflewind.com", "date": "2014-05-13T21:19:00Z"}, "message": "Fix make_command_line to handle Unicode correctly\n\nPreviously, make_command_line iterates over each u8 in the string and\nthen appends them as chars, so any non-ASCII string will get horribly\nmangled by this function.  This fix should allow Unicode arguments to\nwork correctly in native::io::process::spawn.", "tree": {"sha": "abab69acc49459e6a354cc577831b0a1d46dbf36", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abab69acc49459e6a354cc577831b0a1d46dbf36"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6cce7ea5497977291f4ae57937360978e764e41", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6cce7ea5497977291f4ae57937360978e764e41", "html_url": "https://github.com/rust-lang/rust/commit/b6cce7ea5497977291f4ae57937360978e764e41", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6cce7ea5497977291f4ae57937360978e764e41/comments", "author": {"login": "Rufflewind", "id": 6571068, "node_id": "MDQ6VXNlcjY1NzEwNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/6571068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rufflewind", "html_url": "https://github.com/Rufflewind", "followers_url": "https://api.github.com/users/Rufflewind/followers", "following_url": "https://api.github.com/users/Rufflewind/following{/other_user}", "gists_url": "https://api.github.com/users/Rufflewind/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rufflewind/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rufflewind/subscriptions", "organizations_url": "https://api.github.com/users/Rufflewind/orgs", "repos_url": "https://api.github.com/users/Rufflewind/repos", "events_url": "https://api.github.com/users/Rufflewind/events{/privacy}", "received_events_url": "https://api.github.com/users/Rufflewind/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Rufflewind", "id": 6571068, "node_id": "MDQ6VXNlcjY1NzEwNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/6571068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rufflewind", "html_url": "https://github.com/Rufflewind", "followers_url": "https://api.github.com/users/Rufflewind/followers", "following_url": "https://api.github.com/users/Rufflewind/following{/other_user}", "gists_url": "https://api.github.com/users/Rufflewind/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rufflewind/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rufflewind/subscriptions", "organizations_url": "https://api.github.com/users/Rufflewind/orgs", "repos_url": "https://api.github.com/users/Rufflewind/repos", "events_url": "https://api.github.com/users/Rufflewind/events{/privacy}", "received_events_url": "https://api.github.com/users/Rufflewind/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e12aeb39bc4221421890011006c5ae23154cc695", "url": "https://api.github.com/repos/rust-lang/rust/commits/e12aeb39bc4221421890011006c5ae23154cc695", "html_url": "https://github.com/rust-lang/rust/commit/e12aeb39bc4221421890011006c5ae23154cc695"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "be67d0a3fb45decc030c593c7f1cc1daf570475b", "filename": "src/libnative/io/process.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b6cce7ea5497977291f4ae57937360978e764e41/src%2Flibnative%2Fio%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6cce7ea5497977291f4ae57937360978e764e41/src%2Flibnative%2Fio%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibnative%2Fio%2Fprocess.rs?ref=b6cce7ea5497977291f4ae57937360978e764e41", "patch": "@@ -409,16 +409,17 @@ fn make_command_line(prog: &str, args: &[~str]) -> ~str {\n         if quote {\n             cmd.push_char('\"');\n         }\n-        for i in range(0u, arg.len()) {\n-            append_char_at(cmd, arg, i);\n+        let argvec: Vec<char> = arg.chars().collect();\n+        for i in range(0u, argvec.len()) {\n+            append_char_at(cmd, &argvec, i);\n         }\n         if quote {\n             cmd.push_char('\"');\n         }\n     }\n \n-    fn append_char_at(cmd: &mut StrBuf, arg: &str, i: uint) {\n-        match arg[i] as char {\n+    fn append_char_at(cmd: &mut StrBuf, arg: &Vec<char>, i: uint) {\n+        match *arg.get(i) {\n             '\"' => {\n                 // Escape quotes.\n                 cmd.push_str(\"\\\\\\\"\");\n@@ -438,11 +439,11 @@ fn make_command_line(prog: &str, args: &[~str]) -> ~str {\n         }\n     }\n \n-    fn backslash_run_ends_in_quote(s: &str, mut i: uint) -> bool {\n-        while i < s.len() && s[i] as char == '\\\\' {\n+    fn backslash_run_ends_in_quote(s: &Vec<char>, mut i: uint) -> bool {\n+        while i < s.len() && *s.get(i) == '\\\\' {\n             i += 1;\n         }\n-        return i < s.len() && s[i] as char == '\"';\n+        return i < s.len() && *s.get(i) == '\"';\n     }\n }\n "}]}