{"sha": "e64a7bf64b70a9630d1ba8741665158d91f4cca7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2NGE3YmY2NGI3MGE5NjMwZDFiYTg3NDE2NjUxNThkOTFmNGNjYTc=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2019-06-06T17:32:00Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2019-06-11T23:07:32Z"}, "message": "introduce a stack depth", "tree": {"sha": "0c4383e93bd274489dd4d1db48041c4c9621116e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c4383e93bd274489dd4d1db48041c4c9621116e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e64a7bf64b70a9630d1ba8741665158d91f4cca7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e64a7bf64b70a9630d1ba8741665158d91f4cca7", "html_url": "https://github.com/rust-lang/rust/commit/e64a7bf64b70a9630d1ba8741665158d91f4cca7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e64a7bf64b70a9630d1ba8741665158d91f4cca7/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db1dfb2f36be40eb3ae5aff982f1f6ac34452883", "url": "https://api.github.com/repos/rust-lang/rust/commits/db1dfb2f36be40eb3ae5aff982f1f6ac34452883", "html_url": "https://github.com/rust-lang/rust/commit/db1dfb2f36be40eb3ae5aff982f1f6ac34452883"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "d8ffc55ada5c8d8563cffb04e9b21cd13dee793f", "filename": "src/librustc/traits/select.rs", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e64a7bf64b70a9630d1ba8741665158d91f4cca7/src%2Flibrustc%2Ftraits%2Fselect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e64a7bf64b70a9630d1ba8741665158d91f4cca7/src%2Flibrustc%2Ftraits%2Fselect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fselect.rs?ref=e64a7bf64b70a9630d1ba8741665158d91f4cca7", "patch": "@@ -185,6 +185,9 @@ struct TraitObligationStack<'prev, 'tcx: 'prev> {\n     in_cycle: Cell<bool>,\n \n     previous: TraitObligationStackList<'prev, 'tcx>,\n+\n+    /// Number of parent frames plus one -- so the topmost frame has depth 1.\n+    depth: usize,\n }\n \n #[derive(Clone, Default)]\n@@ -662,8 +665,10 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n         obligation: &PredicateObligation<'tcx>,\n     ) -> Result<EvaluationResult, OverflowError> {\n         self.evaluation_probe(|this| {\n-            this.evaluate_predicate_recursively(TraitObligationStackList::empty(),\n-                obligation.clone())\n+            this.evaluate_predicate_recursively(\n+                TraitObligationStackList::empty(),\n+                obligation.clone(),\n+            )\n         })\n     }\n \n@@ -3743,6 +3748,7 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n             fresh_trait_ref,\n             in_cycle: Cell::new(false),\n             previous: previous_stack,\n+            depth: previous_stack.depth() + 1,\n         }\n     }\n \n@@ -3957,6 +3963,14 @@ impl<'o, 'tcx> TraitObligationStackList<'o, 'tcx> {\n     fn head(&self) -> Option<&'o TraitObligationStack<'o, 'tcx>> {\n         self.head\n     }\n+\n+    fn depth(&self) -> usize {\n+        if let Some(head) = self.head {\n+            head.depth\n+        } else {\n+            0\n+        }\n+    }\n }\n \n impl<'o, 'tcx> Iterator for TraitObligationStackList<'o, 'tcx> {"}]}