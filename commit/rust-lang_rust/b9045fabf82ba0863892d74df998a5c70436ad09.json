{"sha": "b9045fabf82ba0863892d74df998a5c70436ad09", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5MDQ1ZmFiZjgyYmEwODYzODkyZDc0ZGY5OThhNWM3MDQzNmFkMDk=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-02-08T18:28:20Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-08T18:28:20Z"}, "message": "Rollup merge of #81828 - davidhewitt:capture-raw-format-strings, r=estebank\n\nparse_format: treat r\" as a literal\n\nThis PR changes `format_args!` internal parsing machinery to treat raw strings starting `r\"` as a literal.\n\nCurrently `\"` and `r#` are recognised as valid starting combinations for string literals, but `r\"` is not.\n\nThis was noticed when debugging https://github.com/rust-lang/rust/issues/67984#issuecomment-753413156\n\nAs well as fixing the behavior observed in that comment, this improves diagnostic spans for `r\"` formatting strings.", "tree": {"sha": "370fcaead00392a3256dc6aac0261a6e97cf7e26", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/370fcaead00392a3256dc6aac0261a6e97cf7e26"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9045fabf82ba0863892d74df998a5c70436ad09", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgIYLECRBK7hj4Ov3rIwAAdHIIAAClKXPLy6LJL7WyrhrDOyIY\nkQjn0tcj5N52haEQ7us7AgiqeLL5dWErsAGnBgsn/v1RCw1B4I5AQwJ5NgGTsAVW\nImRuTYutr9s6z4wjOoi1IzOJc+aGJM5ZwWdeYdZYfFo5d1vmPU07Q1u3JxKcRYvJ\n8K1vXSjQvclpiXe3MC3bcMfkpmtaOgR7J0+dipwy7078G7/STqtkgLcmZ2JUh3ib\nIrYiNjbdHlx7jdqMZa8p3R5q2VFeLmKl30U6ueYlSDjrwTk/hmnaiuPYbM5RzqjQ\ntivtbPSHrkbZbV/9WmkYdFQ4v20FriAYz3TK+jXn1m3BsGH3T0HJg8jBZNU6nmw=\n=HtO0\n-----END PGP SIGNATURE-----\n", "payload": "tree 370fcaead00392a3256dc6aac0261a6e97cf7e26\nparent 480865d59505a72b53d1dd8dd99b998120099e6b\nparent 04a19b93c63d090b8c31ddea700859825bd28334\nauthor Mara Bos <m-ou.se@m-ou.se> 1612808900 +0100\ncommitter GitHub <noreply@github.com> 1612808900 +0100\n\nRollup merge of #81828 - davidhewitt:capture-raw-format-strings, r=estebank\n\nparse_format: treat r\" as a literal\n\nThis PR changes `format_args!` internal parsing machinery to treat raw strings starting `r\"` as a literal.\n\nCurrently `\"` and `r#` are recognised as valid starting combinations for string literals, but `r\"` is not.\n\nThis was noticed when debugging https://github.com/rust-lang/rust/issues/67984#issuecomment-753413156\n\nAs well as fixing the behavior observed in that comment, this improves diagnostic spans for `r\"` formatting strings.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9045fabf82ba0863892d74df998a5c70436ad09", "html_url": "https://github.com/rust-lang/rust/commit/b9045fabf82ba0863892d74df998a5c70436ad09", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9045fabf82ba0863892d74df998a5c70436ad09/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "480865d59505a72b53d1dd8dd99b998120099e6b", "url": "https://api.github.com/repos/rust-lang/rust/commits/480865d59505a72b53d1dd8dd99b998120099e6b", "html_url": "https://github.com/rust-lang/rust/commit/480865d59505a72b53d1dd8dd99b998120099e6b"}, {"sha": "04a19b93c63d090b8c31ddea700859825bd28334", "url": "https://api.github.com/repos/rust-lang/rust/commits/04a19b93c63d090b8c31ddea700859825bd28334", "html_url": "https://github.com/rust-lang/rust/commit/04a19b93c63d090b8c31ddea700859825bd28334"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "92d974690b51486238c2f9082d248e589d3077e7", "filename": "compiler/rustc_parse_format/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b9045fabf82ba0863892d74df998a5c70436ad09/compiler%2Frustc_parse_format%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9045fabf82ba0863892d74df998a5c70436ad09/compiler%2Frustc_parse_format%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse_format%2Fsrc%2Flib.rs?ref=b9045fabf82ba0863892d74df998a5c70436ad09", "patch": "@@ -730,7 +730,7 @@ fn find_skips_from_snippet(\n     str_style: Option<usize>,\n ) -> (Vec<usize>, bool) {\n     let snippet = match snippet {\n-        Some(ref s) if s.starts_with('\"') || s.starts_with(\"r#\") => s,\n+        Some(ref s) if s.starts_with('\"') || s.starts_with(\"r\\\"\") || s.starts_with(\"r#\") => s,\n         _ => return (vec![], false),\n     };\n "}, {"sha": "6c97a807b052b34890f0e3ff43d303c8aedc1063", "filename": "src/test/ui/fmt/format-args-capture.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b9045fabf82ba0863892d74df998a5c70436ad09/src%2Ftest%2Fui%2Ffmt%2Fformat-args-capture.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9045fabf82ba0863892d74df998a5c70436ad09/src%2Ftest%2Fui%2Ffmt%2Fformat-args-capture.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffmt%2Fformat-args-capture.rs?ref=b9045fabf82ba0863892d74df998a5c70436ad09", "patch": "@@ -5,6 +5,7 @@\n fn main() {\n     named_argument_takes_precedence_to_captured();\n     formatting_parameters_can_be_captured();\n+    capture_raw_strings_and_idents();\n \n     #[cfg(panic = \"unwind\")]\n     {\n@@ -25,6 +26,16 @@ fn named_argument_takes_precedence_to_captured() {\n     assert_eq!(&s, \"positional-named-captured\");\n }\n \n+fn capture_raw_strings_and_idents() {\n+    let r#type = \"apple\";\n+    let s = format!(r#\"The fruit is an {type}\"#);\n+    assert_eq!(&s, \"The fruit is an apple\");\n+\n+    let r#type = \"orange\";\n+    let s = format!(r\"The fruit is an {type}\");\n+    assert_eq!(&s, \"The fruit is an orange\");\n+}\n+\n #[cfg(panic = \"unwind\")]\n fn panic_with_single_argument_does_not_get_formatted() {\n     // panic! with a single argument does not perform string formatting."}, {"sha": "10c952006c208d196305c636d0b3c6be4a7e76f3", "filename": "src/test/ui/issues/issue-75307.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b9045fabf82ba0863892d74df998a5c70436ad09/src%2Ftest%2Fui%2Fissues%2Fissue-75307.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b9045fabf82ba0863892d74df998a5c70436ad09/src%2Ftest%2Fui%2Fissues%2Fissue-75307.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-75307.stderr?ref=b9045fabf82ba0863892d74df998a5c70436ad09", "patch": "@@ -1,8 +1,8 @@\n error: invalid reference to positional arguments 1 and 2 (there is 1 argument)\n-  --> $DIR/issue-75307.rs:2:13\n+  --> $DIR/issue-75307.rs:2:17\n    |\n LL |     format!(r\"{}{}{}\", named_arg=1);\n-   |             ^^^^^^^^^\n+   |                 ^^^^\n    |\n    = note: positional arguments are zero-based\n "}]}