{"sha": "9fc5463c18af25b880b1ca476ae05bcba87140e6", "node_id": "C_kwDOAAsO6NoAKDlmYzU0NjNjMThhZjI1Yjg4MGIxY2E0NzZhZTA1YmNiYTg3MTQwZTY", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-12-29T06:07:54Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-07-24T12:01:22Z"}, "message": "Constify a few const `(Partial)Ord` impls", "tree": {"sha": "3a2af256cd3b36116cf0b3b453de82eb69bdc100", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3a2af256cd3b36116cf0b3b453de82eb69bdc100"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9fc5463c18af25b880b1ca476ae05bcba87140e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9fc5463c18af25b880b1ca476ae05bcba87140e6", "html_url": "https://github.com/rust-lang/rust/commit/9fc5463c18af25b880b1ca476ae05bcba87140e6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9fc5463c18af25b880b1ca476ae05bcba87140e6/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "35a061724802377a21fc6dac1ebcbb9b8d1f558a", "url": "https://api.github.com/repos/rust-lang/rust/commits/35a061724802377a21fc6dac1ebcbb9b8d1f558a", "html_url": "https://github.com/rust-lang/rust/commit/35a061724802377a21fc6dac1ebcbb9b8d1f558a"}], "stats": {"total": 69, "additions": 50, "deletions": 19}, "files": [{"sha": "f3034159f040c05e9fb3b80d7bf726b41c325e38", "filename": "library/core/src/cmp.rs", "status": "modified", "additions": 49, "deletions": 19, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/9fc5463c18af25b880b1ca476ae05bcba87140e6/library%2Fcore%2Fsrc%2Fcmp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fc5463c18af25b880b1ca476ae05bcba87140e6/library%2Fcore%2Fsrc%2Fcmp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fcmp.rs?ref=9fc5463c18af25b880b1ca476ae05bcba87140e6", "patch": "@@ -22,6 +22,8 @@\n \n #![stable(feature = \"rust1\", since = \"1.0.0\")]\n \n+use crate::marker::Destruct;\n+\n use self::Ordering::*;\n \n /// Trait for equality comparisons which are [partial equivalence\n@@ -603,7 +605,8 @@ impl Ordering {\n pub struct Reverse<T>(#[stable(feature = \"reverse_cmp_key\", since = \"1.19.0\")] pub T);\n \n #[stable(feature = \"reverse_cmp_key\", since = \"1.19.0\")]\n-impl<T: PartialOrd> PartialOrd for Reverse<T> {\n+#[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+impl<T: ~const PartialOrd> const PartialOrd for Reverse<T> {\n     #[inline]\n     fn partial_cmp(&self, other: &Reverse<T>) -> Option<Ordering> {\n         other.0.partial_cmp(&self.0)\n@@ -761,6 +764,7 @@ impl<T: Clone> Clone for Reverse<T> {\n #[doc(alias = \">=\")]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[rustc_diagnostic_item = \"Ord\"]\n+#[const_trait]\n pub trait Ord: Eq + PartialOrd<Self> {\n     /// This method returns an [`Ordering`] between `self` and `other`.\n     ///\n@@ -796,8 +800,12 @@ pub trait Ord: Eq + PartialOrd<Self> {\n     fn max(self, other: Self) -> Self\n     where\n         Self: Sized,\n+        Self: ~const Destruct,\n     {\n-        max_by(self, other, Ord::cmp)\n+        match self.cmp(&other) {\n+            Ordering::Less | Ordering::Equal => other,\n+            Ordering::Greater => self,\n+        }\n     }\n \n     /// Compares and returns the minimum of two values.\n@@ -816,8 +824,12 @@ pub trait Ord: Eq + PartialOrd<Self> {\n     fn min(self, other: Self) -> Self\n     where\n         Self: Sized,\n+        Self: ~const Destruct,\n     {\n-        min_by(self, other, Ord::cmp)\n+        match self.cmp(&other) {\n+            Ordering::Less | Ordering::Equal => self,\n+            Ordering::Greater => other,\n+        }\n     }\n \n     /// Restrict a value to a certain interval.\n@@ -841,6 +853,8 @@ pub trait Ord: Eq + PartialOrd<Self> {\n     fn clamp(self, min: Self, max: Self) -> Self\n     where\n         Self: Sized,\n+        Self: ~const Destruct,\n+        Self: ~const PartialOrd,\n     {\n         assert!(min <= max);\n         if self < min {\n@@ -862,15 +876,17 @@ pub macro Ord($item:item) {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl Ord for Ordering {\n+#[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+impl const Ord for Ordering {\n     #[inline]\n     fn cmp(&self, other: &Ordering) -> Ordering {\n         (*self as i32).cmp(&(*other as i32))\n     }\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl PartialOrd for Ordering {\n+#[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+impl const PartialOrd for Ordering {\n     #[inline]\n     fn partial_cmp(&self, other: &Ordering) -> Option<Ordering> {\n         (*self as i32).partial_cmp(&(*other as i32))\n@@ -1187,8 +1203,9 @@ pub macro PartialOrd($item:item) {\n #[inline]\n #[must_use]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+#[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"cmp_min\")]\n-pub fn min<T: Ord>(v1: T, v2: T) -> T {\n+pub const fn min<T: ~const Ord + ~const Destruct>(v1: T, v2: T) -> T {\n     v1.min(v2)\n }\n \n@@ -1250,8 +1267,9 @@ pub fn min_by_key<T, F: FnMut(&T) -> K, K: Ord>(v1: T, v2: T, mut f: F) -> T {\n #[inline]\n #[must_use]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+#[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"cmp_max\")]\n-pub fn max<T: Ord>(v1: T, v2: T) -> T {\n+pub const fn max<T: ~const Ord + ~const Destruct>(v1: T, v2: T) -> T {\n     v1.max(v2)\n }\n \n@@ -1304,7 +1322,8 @@ mod impls {\n     macro_rules! partial_eq_impl {\n         ($($t:ty)*) => ($(\n             #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-            impl PartialEq for $t {\n+            #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+            impl const PartialEq for $t {\n                 #[inline]\n                 fn eq(&self, other: &$t) -> bool { (*self) == (*other) }\n                 #[inline]\n@@ -1314,7 +1333,8 @@ mod impls {\n     }\n \n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    impl PartialEq for () {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const PartialEq for () {\n         #[inline]\n         fn eq(&self, _other: &()) -> bool {\n             true\n@@ -1341,7 +1361,8 @@ mod impls {\n     macro_rules! partial_ord_impl {\n         ($($t:ty)*) => ($(\n             #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-            impl PartialOrd for $t {\n+            #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+            impl const PartialOrd for $t {\n                 #[inline]\n                 fn partial_cmp(&self, other: &$t) -> Option<Ordering> {\n                     match (*self <= *other, *self >= *other) {\n@@ -1364,15 +1385,17 @@ mod impls {\n     }\n \n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    impl PartialOrd for () {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const PartialOrd for () {\n         #[inline]\n         fn partial_cmp(&self, _: &()) -> Option<Ordering> {\n             Some(Equal)\n         }\n     }\n \n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    impl PartialOrd for bool {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const PartialOrd for bool {\n         #[inline]\n         fn partial_cmp(&self, other: &bool) -> Option<Ordering> {\n             Some(self.cmp(other))\n@@ -1384,7 +1407,8 @@ mod impls {\n     macro_rules! ord_impl {\n         ($($t:ty)*) => ($(\n             #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-            impl PartialOrd for $t {\n+            #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+            impl const PartialOrd for $t {\n                 #[inline]\n                 fn partial_cmp(&self, other: &$t) -> Option<Ordering> {\n                     Some(self.cmp(other))\n@@ -1400,7 +1424,8 @@ mod impls {\n             }\n \n             #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-            impl Ord for $t {\n+            #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+            impl const Ord for $t {\n                 #[inline]\n                 fn cmp(&self, other: &$t) -> Ordering {\n                     // The order here is important to generate more optimal assembly.\n@@ -1414,15 +1439,17 @@ mod impls {\n     }\n \n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    impl Ord for () {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const Ord for () {\n         #[inline]\n         fn cmp(&self, _other: &()) -> Ordering {\n             Equal\n         }\n     }\n \n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    impl Ord for bool {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const Ord for bool {\n         #[inline]\n         fn cmp(&self, other: &bool) -> Ordering {\n             // Casting to i8's and converting the difference to an Ordering generates\n@@ -1441,7 +1468,8 @@ mod impls {\n     ord_impl! { char usize u8 u16 u32 u64 u128 isize i8 i16 i32 i64 i128 }\n \n     #[unstable(feature = \"never_type\", issue = \"35121\")]\n-    impl PartialEq for ! {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const PartialEq for ! {\n         fn eq(&self, _: &!) -> bool {\n             *self\n         }\n@@ -1451,14 +1479,16 @@ mod impls {\n     impl Eq for ! {}\n \n     #[unstable(feature = \"never_type\", issue = \"35121\")]\n-    impl PartialOrd for ! {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const PartialOrd for ! {\n         fn partial_cmp(&self, _: &!) -> Option<Ordering> {\n             *self\n         }\n     }\n \n     #[unstable(feature = \"never_type\", issue = \"35121\")]\n-    impl Ord for ! {\n+    #[rustc_const_unstable(feature = \"const_cmp\", issue = \"none\")]\n+    impl const Ord for ! {\n         fn cmp(&self, _: &!) -> Ordering {\n             *self\n         }"}, {"sha": "30f2f0ee05c259db5508884732d1e14653f95990", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9fc5463c18af25b880b1ca476ae05bcba87140e6/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fc5463c18af25b880b1ca476ae05bcba87140e6/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=9fc5463c18af25b880b1ca476ae05bcba87140e6", "patch": "@@ -105,6 +105,7 @@\n #![feature(const_cell_into_inner)]\n #![feature(const_char_convert)]\n #![feature(const_clone)]\n+#![feature(const_cmp)]\n #![feature(const_discriminant)]\n #![feature(const_eval_select)]\n #![feature(const_float_bits_conv)]"}]}