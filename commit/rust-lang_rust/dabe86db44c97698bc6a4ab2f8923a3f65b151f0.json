{"sha": "dabe86db44c97698bc6a4ab2f8923a3f65b151f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhYmU4NmRiNDRjOTc2OThiYzZhNGFiMmY4OTIzYTNmNjViMTUxZjA=", "commit": {"author": {"name": "mark", "email": "markm@cs.wisc.edu", "date": "2019-01-15T17:31:49Z"}, "committer": {"name": "mark", "email": "markm@cs.wisc.edu", "date": "2019-01-15T18:48:44Z"}, "message": "update/add tests", "tree": {"sha": "31014870785aeb5957091952627a32d9e39594a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/31014870785aeb5957091952627a32d9e39594a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dabe86db44c97698bc6a4ab2f8923a3f65b151f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dabe86db44c97698bc6a4ab2f8923a3f65b151f0", "html_url": "https://github.com/rust-lang/rust/commit/dabe86db44c97698bc6a4ab2f8923a3f65b151f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dabe86db44c97698bc6a4ab2f8923a3f65b151f0/comments", "author": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6046be42ab911cf2eddd41cffaa0467098bb2317", "url": "https://api.github.com/repos/rust-lang/rust/commits/6046be42ab911cf2eddd41cffaa0467098bb2317", "html_url": "https://github.com/rust-lang/rust/commit/6046be42ab911cf2eddd41cffaa0467098bb2317"}], "stats": {"total": 191, "additions": 183, "deletions": 8}, "files": [{"sha": "616fd09907a2be4a2c39ddb2f94b897a51ffe18e", "filename": "src/test/ui/issues/issue-5067.rs", "status": "modified", "additions": 29, "deletions": 8, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/dabe86db44c97698bc6a4ab2f8923a3f65b151f0/src%2Ftest%2Fui%2Fissues%2Fissue-5067.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dabe86db44c97698bc6a4ab2f8923a3f65b151f0/src%2Ftest%2Fui%2Fissues%2Fissue-5067.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-5067.rs?ref=dabe86db44c97698bc6a4ab2f8923a3f65b151f0", "patch": "@@ -1,37 +1,59 @@\n #![allow(unused_macros)]\n \n+// Tests that repetition matchers cannot match the empty token tree (since that would be\n+// ambiguous).\n+\n+// edition:2018\n+\n macro_rules! foo {\n     ( $()* ) => {};\n     //~^ ERROR repetition matches empty token tree\n     ( $()+ ) => {};\n     //~^ ERROR repetition matches empty token tree\n-\n+    ( $()? ) => {};\n+    //~^ ERROR repetition matches empty token tree\n     ( $(),* ) => {}; // PASS\n     ( $(),+ ) => {}; // PASS\n-\n+    // `?` cannot have a separator...\n     ( [$()*] ) => {};\n     //~^ ERROR repetition matches empty token tree\n     ( [$()+] ) => {};\n     //~^ ERROR repetition matches empty token tree\n-\n+    ( [$()?] ) => {};\n+    //~^ ERROR repetition matches empty token tree\n     ( [$(),*] ) => {}; // PASS\n     ( [$(),+] ) => {}; // PASS\n-\n+    // `?` cannot have a separator...\n     ( $($()* $(),* $(a)* $(a),* )* ) => {};\n     //~^ ERROR repetition matches empty token tree\n     ( $($()* $(),* $(a)* $(a),* )+ ) => {};\n     //~^ ERROR repetition matches empty token tree\n-\n+    ( $($()* $(),* $(a)* $(a),* )? ) => {};\n+    //~^ ERROR repetition matches empty token tree\n+    ( $($()? $(),* $(a)? $(a),* )* ) => {};\n+    //~^ ERROR repetition matches empty token tree\n+    ( $($()? $(),* $(a)? $(a),* )+ ) => {};\n+    //~^ ERROR repetition matches empty token tree\n+    ( $($()? $(),* $(a)? $(a),* )? ) => {};\n+    //~^ ERROR repetition matches empty token tree\n     ( $(a     $(),* $(a)* $(a),* )* ) => {}; // PASS\n     ( $($(a)+ $(),* $(a)* $(a),* )+ ) => {}; // PASS\n+    ( $($(a)+ $(),* $(a)* $(a),* )? ) => {}; // PASS\n+\n+    ( $(a     $(),* $(a)? $(a),* )* ) => {}; // PASS\n+    ( $($(a)+ $(),* $(a)? $(a),* )+ ) => {}; // PASS\n+    ( $($(a)+ $(),* $(a)? $(a),* )? ) => {}; // PASS\n \n     ( $(a $()+)* ) => {};\n     //~^ ERROR repetition matches empty token tree\n     ( $(a $()*)+ ) => {};\n     //~^ ERROR repetition matches empty token tree\n+    ( $(a $()+)? ) => {};\n+    //~^ ERROR repetition matches empty token tree\n+    ( $(a $()?)+ ) => {};\n+    //~^ ERROR repetition matches empty token tree\n }\n \n-\n // --- Original Issue --- //\n \n macro_rules! make_vec {\n@@ -43,11 +65,10 @@ fn main() {\n     let _ = make_vec![a 1, a 2, a 3];\n }\n \n-\n // --- Minified Issue --- //\n \n macro_rules! m {\n-    ( $()* ) => {}\n+    ( $()* ) => {};\n     //~^ ERROR repetition matches empty token tree\n }\n "}, {"sha": "ebeb3fe07adb4401d660066d9e22102e6475a896", "filename": "src/test/ui/issues/issue-57597.rs", "status": "added", "additions": 80, "deletions": 0, "changes": 80, "blob_url": "https://github.com/rust-lang/rust/blob/dabe86db44c97698bc6a4ab2f8923a3f65b151f0/src%2Ftest%2Fui%2Fissues%2Fissue-57597.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dabe86db44c97698bc6a4ab2f8923a3f65b151f0/src%2Ftest%2Fui%2Fissues%2Fissue-57597.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-57597.rs?ref=dabe86db44c97698bc6a4ab2f8923a3f65b151f0", "patch": "@@ -0,0 +1,80 @@\n+// Regression test for #57597.\n+//\n+// Make sure that nested matchers work correctly rather than causing an infinite loop or crash.\n+\n+// edition:2018\n+\n+macro_rules! foo1 {\n+    ($($($i:ident)?)+) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo2 {\n+    ($($($i:ident)?)*) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo3 {\n+    ($($($i:ident)?)?) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo4 {\n+    ($($($($i:ident)?)?)?) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo5 {\n+    ($($($($i:ident)*)?)?) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo6 {\n+    ($($($($i:ident)?)*)?) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo7 {\n+    ($($($($i:ident)?)?)*) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo8 {\n+    ($($($($i:ident)*)*)?) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo9 {\n+    ($($($($i:ident)?)*)*) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo10 {\n+    ($($($($i:ident)?)*)+) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo11 {\n+    ($($($($i:ident)+)?)*) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+macro_rules! foo12 {\n+    ($($($($i:ident)+)*)?) => {};\n+    //~^ ERROR repetition matches empty token tree\n+}\n+\n+fn main() {\n+    foo1!();\n+    foo2!();\n+    foo3!();\n+    foo4!();\n+    foo5!();\n+    foo6!();\n+    foo7!();\n+    foo8!();\n+    foo9!();\n+    foo10!();\n+    foo11!();\n+    foo12!();\n+}"}, {"sha": "0a02ac8c499b690efb4c184665be4af02470090c", "filename": "src/test/ui/issues/issue-57597.stderr", "status": "added", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/dabe86db44c97698bc6a4ab2f8923a3f65b151f0/src%2Ftest%2Fui%2Fissues%2Fissue-57597.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dabe86db44c97698bc6a4ab2f8923a3f65b151f0/src%2Ftest%2Fui%2Fissues%2Fissue-57597.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-57597.stderr?ref=dabe86db44c97698bc6a4ab2f8923a3f65b151f0", "patch": "@@ -0,0 +1,74 @@\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:8:7\n+   |\n+LL |     ($($($i:ident)?)+) => {};\n+   |       ^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:13:7\n+   |\n+LL |     ($($($i:ident)?)*) => {};\n+   |       ^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:18:7\n+   |\n+LL |     ($($($i:ident)?)?) => {};\n+   |       ^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:23:7\n+   |\n+LL |     ($($($($i:ident)?)?)?) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:28:7\n+   |\n+LL |     ($($($($i:ident)*)?)?) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:33:7\n+   |\n+LL |     ($($($($i:ident)?)*)?) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:38:7\n+   |\n+LL |     ($($($($i:ident)?)?)*) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:43:7\n+   |\n+LL |     ($($($($i:ident)*)*)?) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:48:7\n+   |\n+LL |     ($($($($i:ident)?)*)*) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:53:7\n+   |\n+LL |     ($($($($i:ident)?)*)+) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:58:7\n+   |\n+LL |     ($($($($i:ident)+)?)*) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: repetition matches empty token tree\n+  --> $DIR/issue-57597.rs:63:7\n+   |\n+LL |     ($($($($i:ident)+)*)?) => {};\n+   |       ^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 12 previous errors\n+"}]}