{"sha": "44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "node_id": "C_kwDOAAsO6NoAKDQ0YTNhNjZlZTg5MDU0NWEyYzFhYzc4ZmY4ZjEwN2ZlNWU3MjA0Zjk", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2021-12-10T00:15:33Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2021-12-12T11:20:03Z"}, "message": "Stabilize asm! and global_asm!\n\nThey are also removed from the prelude as per the decision in\nhttps://github.com/rust-lang/rust/issues/87228.\n\nstdarch and compiler-builtins are updated to work with the new, stable\nasm! and global_asm! macros.", "tree": {"sha": "8821e53e6c339fca0b3fc58e34fc702a0866d087", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8821e53e6c339fca0b3fc58e34fc702a0866d087"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "html_url": "https://github.com/rust-lang/rust/commit/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b3a55371a72f665f5d9476d07980e76d3e755fe6", "url": "https://api.github.com/repos/rust-lang/rust/commits/b3a55371a72f665f5d9476d07980e76d3e755fe6", "html_url": "https://github.com/rust-lang/rust/commit/b3a55371a72f665f5d9476d07980e76d3e755fe6"}], "stats": {"total": 2176, "additions": 540, "deletions": 1636}, "files": [{"sha": "64a2ed70a5167086c39355864d34e7ea41f100c9", "filename": "Cargo.lock", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -680,9 +680,9 @@ dependencies = [\n \n [[package]]\n name = \"compiler_builtins\"\n-version = \"0.1.55\"\n+version = \"0.1.65\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"c9ac60765140c97aaf531dae151a287646b0805ec725805da9e2a3ee31cd501c\"\n+checksum = \"ed37ea958309f2451e1cea7fd2b37aa56b1894c9a9fbdbbe6a194f7b78f0362d\"\n dependencies = [\n  \"cc\",\n  \"rustc-std-workspace-core\","}, {"sha": "48c0203d594a33a326956812f4fcc662dbbe7ffc", "filename": "compiler/rustc_codegen_gcc/tests/run/asm.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_codegen_gcc%2Ftests%2Frun%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_codegen_gcc%2Ftests%2Frun%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_gcc%2Ftests%2Frun%2Fasm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,8 +3,6 @@\n // Run-time:\n //   status: 0\n \n-#![feature(asm, global_asm)]\n-\n global_asm!(\"\n     .global add_asm\n add_asm:"}, {"sha": "61695109a894a268b368239683cd8ea0de106f74", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3147,7 +3147,8 @@ declare_lint! {\n     /// ### Example\n     ///\n     /// ```rust,compile_fail\n-    /// #![feature(asm)]\n+    /// use std::arch::asm;\n+    ///\n     /// fn main() {\n     ///     unsafe {\n     ///         asm!(\"foo: bar\");\n@@ -3164,10 +3165,7 @@ declare_lint! {\n     /// of this, GNU assembler [local labels] *must* be used instead of labels\n     /// with a name. Using named labels might cause assembler or linker errors.\n     ///\n-    /// See the [unstable book] for more details.\n-    ///\n     /// [local labels]: https://sourceware.org/binutils/docs/as/Symbol-Names.html#Local-Labels\n-    /// [unstable book]: https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels\n     pub NAMED_ASM_LABELS,\n     Deny,\n     \"named labels in inline assembly\","}, {"sha": "800b6d4a79d3cd0ba50d7dae5936e456be377b5e", "filename": "compiler/rustc_lint/src/context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -772,7 +772,7 @@ pub trait LintContext: Sized {\n                 }\n                 BuiltinLintDiagnostics::NamedAsmLabel(help) => {\n                     db.help(&help);\n-                    db.note(\"see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\");\n+                    //db.note(\"see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\");\n                 }\n             }\n             // Rewrap `db`, and pass control to the user."}, {"sha": "d1adb4a19de3047ef3eec9d0734fe40938e196ce", "filename": "compiler/rustc_lint_defs/src/builtin.rs", "status": "modified", "additions": 9, "deletions": 37, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2419,8 +2419,8 @@ declare_lint! {\n     ///\n     /// ### Example\n     ///\n-    /// ```rust,ignore (fails on system llvm)\n-    /// #![feature(asm)]\n+    /// ```rust\n+    /// use std::arch::asm;\n     ///\n     /// fn main() {\n     ///     #[cfg(target_arch=\"x86_64\")]\n@@ -2430,19 +2430,7 @@ declare_lint! {\n     /// }\n     /// ```\n     ///\n-    /// This will produce:\n-    ///\n-    /// ```text\n-    /// warning: formatting may not be suitable for sub-register argument\n-    ///  --> src/main.rs:6:19\n-    ///   |\n-    /// 6 |         asm!(\"mov {0}, {0}\", in(reg) 0i16);\n-    ///   |                   ^^^  ^^^           ---- for this argument\n-    ///   |\n-    ///   = note: `#[warn(asm_sub_register)]` on by default\n-    ///   = help: use the `x` modifier to have the register formatted as `ax`\n-    ///   = help: or use the `r` modifier to keep the default formatting of `rax`\n-    /// ```\n+    /// {{produces}}\n     ///\n     /// ### Explanation\n     ///\n@@ -2455,10 +2443,6 @@ declare_lint! {\n     /// register size, to alert you of possibly using the incorrect width. To\n     /// fix this, add the suggested modifier to the template, or cast the\n     /// value to the correct size.\n-    ///\n-    /// See [register template modifiers] for more details.\n-    ///\n-    /// [register template modifiers]: https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#register-template-modifiers\n     pub ASM_SUB_REGISTER,\n     Warn,\n     \"using only a subset of a register for inline asm inputs\",\n@@ -2470,34 +2454,21 @@ declare_lint! {\n     ///\n     /// ### Example\n     ///\n-    /// ```rust,ignore (fails on system llvm)\n-    /// #![feature(asm)]\n+    /// ```rust\n+    /// use std::arch::asm;\n     ///\n     /// fn main() {\n     ///     #[cfg(target_arch=\"x86_64\")]\n     ///     unsafe {\n     ///         asm!(\n     ///             \".att_syntax\",\n-    ///             \"movl {0}, {0}\", in(reg) 0usize\n+    ///             \"movq %{0}, %{0}\", in(reg) 0usize\n     ///         );\n     ///     }\n     /// }\n     /// ```\n     ///\n-    /// This will produce:\n-    ///\n-    /// ```text\n-    ///  warning: avoid using `.att_syntax`, prefer using `options(att_syntax)` instead\n-    ///  --> test.rs:7:14\n-    ///   |\n-    /// 7 |             \".att_syntax\",\n-    ///   |              ^^^^^^^^^^^\n-    /// 8 |             \"movq {0}, {0}\", out(reg) _,\n-    /// 9 |         );\n-    ///   |         - help: add option: `, options(att_syntax)`\n-    ///   |\n-    ///   = note: `#[warn(bad_asm_style)]` on by default\n-    /// ```\n+    /// {{produces}}\n     ///\n     /// ### Explanation\n     ///\n@@ -2739,7 +2710,8 @@ declare_lint! {\n     ///\n     /// ```rust\n     /// #![feature(naked_functions)]\n-    /// #![feature(asm)]\n+    ///\n+    /// use std::arch::asm;\n     ///\n     /// #[naked]\n     /// pub fn default_abi() -> u32 {"}, {"sha": "a2c95b253f83b2a3f9c9b1d2e2e01c5a38404305", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 2, "deletions": 15, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -152,7 +152,6 @@\n #![feature(abi_unadjusted)]\n #![feature(allow_internal_unsafe)]\n #![feature(allow_internal_unstable)]\n-#![feature(asm)]\n #![feature(associated_type_bounds)]\n #![feature(auto_traits)]\n #![feature(cfg_target_has_atomic)]\n@@ -372,26 +371,14 @@ pub mod arch {\n     pub use crate::core_arch::arch::*;\n \n     /// Inline assembly.\n-    ///\n-    /// Read the [unstable book] for the usage.\n-    ///\n-    /// [unstable book]: ../../unstable-book/library-features/asm.html\n-    #[unstable(\n-        feature = \"asm\",\n-        issue = \"72016\",\n-        reason = \"inline assembly is not stable enough for use and is subject to change\"\n-    )]\n+    #[stable(feature = \"asm\", since = \"1.59.0\")]\n     #[rustc_builtin_macro]\n     pub macro asm(\"assembly template\", $(operands,)* $(options($(option),*))?) {\n         /* compiler built-in */\n     }\n \n     /// Module-level inline assembly.\n-    #[unstable(\n-        feature = \"global_asm\",\n-        issue = \"35119\",\n-        reason = \"`global_asm!` is not stable enough for use and is subject to change\"\n-    )]\n+    #[stable(feature = \"global_asm\", since = \"1.59.0\")]\n     #[rustc_builtin_macro]\n     pub macro global_asm(\"assembly template\", $(operands,)* $(options($(option),*))?) {\n         /* compiler built-in */"}, {"sha": "ec5fa45fdaddd72489d612d87617c14ed7ce8012", "filename": "library/core/src/num/dec2flt/fpu.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fcore%2Fsrc%2Fnum%2Fdec2flt%2Ffpu.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fcore%2Fsrc%2Fnum%2Fdec2flt%2Ffpu.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fdec2flt%2Ffpu.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -10,6 +10,7 @@ pub use fpu_precision::set_precision;\n // computations are performed in the desired precision.\n #[cfg(all(target_arch = \"x86\", not(target_feature = \"sse2\")))]\n mod fpu_precision {\n+    use core::arch::asm;\n     use core::mem::size_of;\n \n     /// A structure used to preserve the original value of the FPU control word, so that it can be"}, {"sha": "54f498d1dc15e2a83f8493914adbc11d139bdd2b", "filename": "library/core/src/prelude/v1.rs", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fcore%2Fsrc%2Fprelude%2Fv1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fcore%2Fsrc%2Fprelude%2Fv1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fprelude%2Fv1.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -69,22 +69,6 @@ pub use crate::{\n #[doc(no_inline)]\n pub use crate::concat_bytes;\n \n-#[unstable(\n-    feature = \"asm\",\n-    issue = \"72016\",\n-    reason = \"inline assembly is not stable enough for use and is subject to change\"\n-)]\n-#[doc(no_inline)]\n-pub use crate::arch::asm;\n-\n-#[unstable(\n-    feature = \"global_asm\",\n-    issue = \"35119\",\n-    reason = \"`global_asm!` is not stable enough for use and is subject to change\"\n-)]\n-#[doc(no_inline)]\n-pub use crate::arch::global_asm;\n-\n #[stable(feature = \"builtin_macro_prelude\", since = \"1.38.0\")]\n #[allow(deprecated, deprecated_in_future)]\n #[doc(no_inline)]"}, {"sha": "5c5632a9d0164e056d72af2264e68a519d0d18bf", "filename": "library/panic_abort/src/lib.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fpanic_abort%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fpanic_abort%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fpanic_abort%2Fsrc%2Flib.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -14,7 +14,6 @@\n #![feature(std_internals)]\n #![feature(staged_api)]\n #![feature(rustc_attrs)]\n-#![feature(asm)]\n #![feature(c_unwind)]\n \n #[cfg(target_os = \"android\")]\n@@ -69,11 +68,11 @@ pub unsafe extern \"C-unwind\" fn __rust_start_panic(_payload: *mut &mut dyn BoxMe\n                 const FAST_FAIL_FATAL_APP_EXIT: usize = 7;\n                 cfg_if::cfg_if! {\n                     if #[cfg(any(target_arch = \"x86\", target_arch = \"x86_64\"))] {\n-                        asm!(\"int $$0x29\", in(\"ecx\") FAST_FAIL_FATAL_APP_EXIT);\n+                        core::arch::asm!(\"int $$0x29\", in(\"ecx\") FAST_FAIL_FATAL_APP_EXIT);\n                     } else if #[cfg(all(target_arch = \"arm\", target_feature = \"thumb-mode\"))] {\n-                        asm!(\".inst 0xDEFB\", in(\"r0\") FAST_FAIL_FATAL_APP_EXIT);\n+                        core::arch::asm!(\".inst 0xDEFB\", in(\"r0\") FAST_FAIL_FATAL_APP_EXIT);\n                     } else if #[cfg(target_arch = \"aarch64\")] {\n-                        asm!(\"brk 0xF003\", in(\"x0\") FAST_FAIL_FATAL_APP_EXIT);\n+                        core::arch::asm!(\"brk 0xF003\", in(\"x0\") FAST_FAIL_FATAL_APP_EXIT);\n                     } else {\n                         core::intrinsics::abort();\n                     }"}, {"sha": "b71faf76f692b7c73b70ad101453ef2ea98439c1", "filename": "library/std/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2FCargo.toml?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -16,7 +16,7 @@ panic_unwind = { path = \"../panic_unwind\", optional = true }\n panic_abort = { path = \"../panic_abort\" }\n core = { path = \"../core\" }\n libc = { version = \"0.2.108\", default-features = false, features = ['rustc-dep-of-std'] }\n-compiler_builtins = { version = \"0.1.55\" }\n+compiler_builtins = { version = \"0.1.65\" }\n profiler_builtins = { path = \"../profiler_builtins\", optional = true }\n unwind = { path = \"../unwind\" }\n hashbrown = { version = \"0.11\", default-features = false, features = ['rustc-dep-of-std'] }"}, {"sha": "b725fc8bd525575040c621a219f067d67af12d55", "filename": "library/std/src/lib.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Flib.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -233,7 +233,6 @@\n #![feature(allow_internal_unstable)]\n #![feature(arbitrary_self_types)]\n #![feature(array_error_internals)]\n-#![feature(asm)]\n #![feature(assert_matches)]\n #![feature(associated_type_bounds)]\n #![feature(async_stream)]\n@@ -288,7 +287,6 @@\n #![feature(gen_future)]\n #![feature(generator_trait)]\n #![feature(get_mut_unchecked)]\n-#![feature(global_asm)]\n #![feature(hashmap_internals)]\n #![feature(int_error_internals)]\n #![feature(integer_atomics)]"}, {"sha": "8358cb9e81b6513c8ee6edf9c791a17d7112b9c4", "filename": "library/std/src/os/fortanix_sgx/arch.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fos%2Ffortanix_sgx%2Farch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fos%2Ffortanix_sgx%2Farch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Ffortanix_sgx%2Farch.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -5,6 +5,7 @@\n #![unstable(feature = \"sgx_platform\", issue = \"56975\")]\n \n use crate::mem::MaybeUninit;\n+use core::arch::asm;\n \n /// Wrapper struct to force 16-byte alignment.\n #[repr(align(16))]"}, {"sha": "743dd51333d18f9fc271dc90b14110b3ffa80770", "filename": "library/std/src/prelude/v1.rs", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fprelude%2Fv1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fprelude%2Fv1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fprelude%2Fv1.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -54,22 +54,6 @@ pub use core::prelude::v1::{\n #[doc(no_inline)]\n pub use core::prelude::v1::concat_bytes;\n \n-#[unstable(\n-    feature = \"asm\",\n-    issue = \"72016\",\n-    reason = \"inline assembly is not stable enough for use and is subject to change\"\n-)]\n-#[doc(no_inline)]\n-pub use core::prelude::v1::asm;\n-\n-#[unstable(\n-    feature = \"global_asm\",\n-    issue = \"35119\",\n-    reason = \"`global_asm!` is not stable enough for use and is subject to change\"\n-)]\n-#[doc(no_inline)]\n-pub use core::prelude::v1::global_asm;\n-\n // FIXME: Attribute and internal derive macros are not documented because for them rustdoc generates\n // dead links which fail link checker testing.\n #[stable(feature = \"builtin_macro_prelude\", since = \"1.38.0\")]"}, {"sha": "18e6d5b3fa24d52725377869cc0fb210cfcbf56d", "filename": "library/std/src/sys/sgx/abi/mem.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmem.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,3 +1,5 @@\n+use core::arch::asm;\n+\n // Do not remove inline: will result in relocation failure\n #[inline(always)]\n pub(crate) unsafe fn rel_ptr<T>(offset: u64) -> *const T {"}, {"sha": "5df08a4ff593ce3e42b56d8a28e116185775c161", "filename": "library/std/src/sys/sgx/abi/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmod.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,7 @@\n #![cfg_attr(test, allow(unused))] // RT initialization logic is not compiled for test\n \n use crate::io::Write;\n+use core::arch::global_asm;\n use core::sync::atomic::{AtomicUsize, Ordering};\n \n // runtime features"}, {"sha": "bbbee4fd6d1e26cd5f0afd55f12f87903389d314", "filename": "library/std/src/sys/solid/abi/mod.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fsolid%2Fabi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fsolid%2Fabi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fsolid%2Fabi%2Fmod.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -10,9 +10,9 @@ pub fn breakpoint_program_exited(tid: usize) {\n         match () {\n             // SOLID_BP_PROGRAM_EXITED = 15\n             #[cfg(target_arch = \"arm\")]\n-            () => asm!(\"bkpt #15\", in(\"r0\") tid),\n-            #[cfg(target_arch = \"aarch64\")]\n-            () => asm!(\"hlt #15\", in(\"x0\") tid),\n+            () => core::arch::asm!(\"bkpt #15\", in(\"r0\") tid),\n+            #[cfg(core::arch::asm = \"aarch64\")]\n+            () => core::arch::asm!(\"hlt #15\", in(\"x0\") tid),\n         }\n     }\n }\n@@ -23,9 +23,9 @@ pub fn breakpoint_abort() {\n         match () {\n             // SOLID_BP_CSABORT = 16\n             #[cfg(target_arch = \"arm\")]\n-            () => asm!(\"bkpt #16\"),\n+            () => core::arch::asm!(\"bkpt #16\"),\n             #[cfg(target_arch = \"aarch64\")]\n-            () => asm!(\"hlt #16\"),\n+            () => core::arch::asm!(\"hlt #16\"),\n         }\n     }\n }"}, {"sha": "084af4325e7b30d92c6a505b5a227820d225af35", "filename": "library/std/src/sys/windows/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fmod.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -288,13 +288,13 @@ pub fn abort_internal() -> ! {\n     unsafe {\n         cfg_if::cfg_if! {\n             if #[cfg(any(target_arch = \"x86\", target_arch = \"x86_64\"))] {\n-                asm!(\"int $$0x29\", in(\"ecx\") FAST_FAIL_FATAL_APP_EXIT);\n+                core::arch::asm!(\"int $$0x29\", in(\"ecx\") FAST_FAIL_FATAL_APP_EXIT);\n                 crate::intrinsics::unreachable();\n             } else if #[cfg(all(target_arch = \"arm\", target_feature = \"thumb-mode\"))] {\n-                asm!(\".inst 0xDEFB\", in(\"r0\") FAST_FAIL_FATAL_APP_EXIT);\n+                core::arch::asm!(\".inst 0xDEFB\", in(\"r0\") FAST_FAIL_FATAL_APP_EXIT);\n                 crate::intrinsics::unreachable();\n             } else if #[cfg(target_arch = \"aarch64\")] {\n-                asm!(\"brk 0xF003\", in(\"x0\") FAST_FAIL_FATAL_APP_EXIT);\n+                core::arch::asm!(\"brk 0xF003\", in(\"x0\") FAST_FAIL_FATAL_APP_EXIT);\n                 crate::intrinsics::unreachable();\n             }\n         }"}, {"sha": "d219ad63c5075098fc224a57deb4852b9734327d", "filename": "library/stdarch", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstdarch?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1 +1 @@\n-Subproject commit b70ae88ef2a6c83acad0a1e83d5bd78f9655fd05\n+Subproject commit d219ad63c5075098fc224a57deb4852b9734327d"}, {"sha": "b946d8cf21c5c7e13ac98920ae670d5d602a29bd", "filename": "src/doc/unstable-book/src/compiler-flags/sanitizer.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsanitizer.md", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsanitizer.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsanitizer.md?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -199,7 +199,7 @@ LLVM CFI can be enabled with -Zsanitizer=cfi and requires LTO (i.e., -Clto).\n ## Example\n \n ```text\n-#![feature(asm, naked_functions)]\n+#![feature(naked_functions)]\n \n use std::mem;\n "}, {"sha": "59987cccde67385bb265568f1e3003908140b6b5", "filename": "src/doc/unstable-book/src/library-features/asm.md", "status": "removed", "additions": 0, "deletions": 910, "changes": 910, "blob_url": "https://github.com/rust-lang/rust/blob/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fasm.md", "raw_url": "https://github.com/rust-lang/rust/raw/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fasm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fasm.md?ref=b3a55371a72f665f5d9476d07980e76d3e755fe6", "patch": "@@ -1,910 +0,0 @@\n-# `asm`\n-\n-The tracking issue for this feature is: [#72016]\n-\n-[#72016]: https://github.com/rust-lang/rust/issues/72016\n-\n-------------------------\n-\n-For extremely low-level manipulations and performance reasons, one\n-might wish to control the CPU directly. Rust supports using inline\n-assembly to do this via the `asm!` macro.\n-\n-# Guide-level explanation\n-[guide-level-explanation]: #guide-level-explanation\n-\n-Rust provides support for inline assembly via the `asm!` macro.\n-It can be used to embed handwritten assembly in the assembly output generated by the compiler.\n-Generally this should not be necessary, but might be where the required performance or timing\n-cannot be otherwise achieved. Accessing low level hardware primitives, e.g. in kernel code, may also demand this functionality.\n-\n-> **Note**: the examples here are given in x86/x86-64 assembly, but other architectures are also supported.\n-\n-Inline assembly is currently supported on the following architectures:\n-- x86 and x86-64\n-- ARM\n-- AArch64\n-- RISC-V\n-- NVPTX\n-- PowerPC\n-- Hexagon\n-- MIPS32r2 and MIPS64r2\n-- wasm32\n-- BPF\n-- SPIR-V\n-- AVR\n-\n-## Basic usage\n-\n-Let us start with the simplest possible example:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-unsafe {\n-    asm!(\"nop\");\n-}\n-```\n-\n-This will insert a NOP (no operation) instruction into the assembly generated by the compiler.\n-Note that all `asm!` invocations have to be inside an `unsafe` block, as they could insert\n-arbitrary instructions and break various invariants. The instructions to be inserted are listed\n-in the first argument of the `asm!` macro as a string literal.\n-\n-## Inputs and outputs\n-\n-Now inserting an instruction that does nothing is rather boring. Let us do something that\n-actually acts on data:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let x: u64;\n-unsafe {\n-    asm!(\"mov {}, 5\", out(reg) x);\n-}\n-assert_eq!(x, 5);\n-```\n-\n-This will write the value `5` into the `u64` variable `x`.\n-You can see that the string literal we use to specify instructions is actually a template string.\n-It is governed by the same rules as Rust [format strings][format-syntax].\n-The arguments that are inserted into the template however look a bit different than you may\n-be familiar with. First we need to specify if the variable is an input or an output of the\n-inline assembly. In this case it is an output. We declared this by writing `out`.\n-We also need to specify in what kind of register the assembly expects the variable.\n-In this case we put it in an arbitrary general purpose register by specifying `reg`.\n-The compiler will choose an appropriate register to insert into\n-the template and will read the variable from there after the inline assembly finishes executing.\n-\n-Let us see another example that also uses an input:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let i: u64 = 3;\n-let o: u64;\n-unsafe {\n-    asm!(\n-        \"mov {0}, {1}\",\n-        \"add {0}, {number}\",\n-        out(reg) o,\n-        in(reg) i,\n-        number = const 5,\n-    );\n-}\n-assert_eq!(o, 8);\n-```\n-\n-This will add `5` to the input in variable `i` and write the result to variable `o`.\n-The particular way this assembly does this is first copying the value from `i` to the output,\n-and then adding `5` to it.\n-\n-The example shows a few things:\n-\n-First, we can see that `asm!` allows multiple template string arguments; each\n-one is treated as a separate line of assembly code, as if they were all joined\n-together with newlines between them. This makes it easy to format assembly\n-code.\n-\n-Second, we can see that inputs are declared by writing `in` instead of `out`.\n-\n-Third, one of our operands has a type we haven't seen yet, `const`.\n-This tells the compiler to expand this argument to a value directly inside the assembly template.\n-This is only possible for constants and literals.\n-\n-Fourth, we can see that we can specify an argument number, or name as in any format string.\n-For inline assembly templates this is particularly useful as arguments are often used more than once.\n-For more complex inline assembly using this facility is generally recommended, as it improves\n-readability, and allows reordering instructions without changing the argument order.\n-\n-We can further refine the above example to avoid the `mov` instruction:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let mut x: u64 = 3;\n-unsafe {\n-    asm!(\"add {0}, {number}\", inout(reg) x, number = const 5);\n-}\n-assert_eq!(x, 8);\n-```\n-\n-We can see that `inout` is used to specify an argument that is both input and output.\n-This is different from specifying an input and output separately in that it is guaranteed to assign both to the same register.\n-\n-It is also possible to specify different variables for the input and output parts of an `inout` operand:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let x: u64 = 3;\n-let y: u64;\n-unsafe {\n-    asm!(\"add {0}, {number}\", inout(reg) x => y, number = const 5);\n-}\n-assert_eq!(y, 8);\n-```\n-\n-## Late output operands\n-\n-The Rust compiler is conservative with its allocation of operands. It is assumed that an `out`\n-can be written at any time, and can therefore not share its location with any other argument.\n-However, to guarantee optimal performance it is important to use as few registers as possible,\n-so they won't have to be saved and reloaded around the inline assembly block.\n-To achieve this Rust provides a `lateout` specifier. This can be used on any output that is\n-written only after all inputs have been consumed.\n-There is also a `inlateout` variant of this specifier.\n-\n-Here is an example where `inlateout` *cannot* be used:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let mut a: u64 = 4;\n-let b: u64 = 4;\n-let c: u64 = 4;\n-unsafe {\n-    asm!(\n-        \"add {0}, {1}\",\n-        \"add {0}, {2}\",\n-        inout(reg) a,\n-        in(reg) b,\n-        in(reg) c,\n-    );\n-}\n-assert_eq!(a, 12);\n-```\n-\n-Here the compiler is free to allocate the same register for inputs `b` and `c` since it knows they have the same value. However it must allocate a separate register for `a` since it uses `inout` and not `inlateout`. If `inlateout` was used, then `a` and `c` could be allocated to the same register, in which case the first instruction to overwrite the value of `c` and cause the assembly code to produce the wrong result.\n-\n-However the following example can use `inlateout` since the output is only modified after all input registers have been read:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let mut a: u64 = 4;\n-let b: u64 = 4;\n-unsafe {\n-    asm!(\"add {0}, {1}\", inlateout(reg) a, in(reg) b);\n-}\n-assert_eq!(a, 8);\n-```\n-\n-As you can see, this assembly fragment will still work correctly if `a` and `b` are assigned to the same register.\n-\n-## Explicit register operands\n-\n-Some instructions require that the operands be in a specific register.\n-Therefore, Rust inline assembly provides some more specific constraint specifiers.\n-While `reg` is generally available on any architecture, explicit registers are highly architecture specific. E.g. for x86 the general purpose registers `eax`, `ebx`, `ecx`, `edx`, `ebp`, `esi`, and `edi` among others can be addressed by their name.\n-\n-```rust,allow_fail,no_run\n-#![feature(asm)]\n-let cmd = 0xd1;\n-unsafe {\n-    asm!(\"out 0x64, eax\", in(\"eax\") cmd);\n-}\n-```\n-\n-In this example we call the `out` instruction to output the content of the `cmd` variable to port `0x64`. Since the `out` instruction only accepts `eax` (and its sub registers) as operand we had to use the `eax` constraint specifier.\n-\n-> **Note**: unlike other operand types, explicit register operands cannot be used in the template string: you can't use `{}` and should write the register name directly instead. Also, they must appear at the end of the operand list after all other operand types.\n-\n-Consider this example which uses the x86 `mul` instruction:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-fn mul(a: u64, b: u64) -> u128 {\n-    let lo: u64;\n-    let hi: u64;\n-\n-    unsafe {\n-        asm!(\n-            // The x86 mul instruction takes rax as an implicit input and writes\n-            // the 128-bit result of the multiplication to rax:rdx.\n-            \"mul {}\",\n-            in(reg) a,\n-            inlateout(\"rax\") b => lo,\n-            lateout(\"rdx\") hi\n-        );\n-    }\n-\n-    ((hi as u128) << 64) + lo as u128\n-}\n-```\n-\n-This uses the `mul` instruction to multiply two 64-bit inputs with a 128-bit result.\n-The only explicit operand is a register, that we fill from the variable `a`.\n-The second operand is implicit, and must be the `rax` register, which we fill from the variable `b`.\n-The lower 64 bits of the result are stored in `rax` from which we fill the variable `lo`.\n-The higher 64 bits are stored in `rdx` from which we fill the variable `hi`.\n-\n-## Clobbered registers\n-\n-In many cases inline assembly will modify state that is not needed as an output.\n-Usually this is either because we have to use a scratch register in the assembly or because instructions modify state that we don't need to further examine.\n-This state is generally referred to as being \"clobbered\".\n-We need to tell the compiler about this since it may need to save and restore this state around the inline assembly block.\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let ebx: u32;\n-let ecx: u32;\n-\n-unsafe {\n-    asm!(\n-        \"cpuid\",\n-        // EAX 4 selects the \"Deterministic Cache Parameters\" CPUID leaf\n-        inout(\"eax\") 4 => _,\n-        // ECX 0 selects the L0 cache information.\n-        inout(\"ecx\") 0 => ecx,\n-        lateout(\"ebx\") ebx,\n-        lateout(\"edx\") _,\n-    );\n-}\n-\n-println!(\n-    \"L0 Cache: {}\",\n-    ((ebx >> 22) + 1) * (((ebx >> 12) & 0x3ff) + 1) * ((ebx & 0xfff) + 1) * (ecx + 1)\n-);\n-```\n-\n-In the example above we use the `cpuid` instruction to get the L1 cache size.\n-This instruction writes to `eax`, `ebx`, `ecx`, and `edx`, but for the cache size we only care about the contents of `ebx` and `ecx`.\n-\n-However we still need to tell the compiler that `eax` and `edx` have been modified so that it can save any values that were in these registers before the asm. This is done by declaring these as outputs but with `_` instead of a variable name, which indicates that the output value is to be discarded.\n-\n-This can also be used with a general register class (e.g. `reg`) to obtain a scratch register for use inside the asm code:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-// Multiply x by 6 using shifts and adds\n-let mut x: u64 = 4;\n-unsafe {\n-    asm!(\n-        \"mov {tmp}, {x}\",\n-        \"shl {tmp}, 1\",\n-        \"shl {x}, 2\",\n-        \"add {x}, {tmp}\",\n-        x = inout(reg) x,\n-        tmp = out(reg) _,\n-    );\n-}\n-assert_eq!(x, 4 * 6);\n-```\n-\n-## Symbol operands and ABI clobbers\n-\n-A special operand type, `sym`, allows you to use the symbol name of a `fn` or `static` in inline assembly code.\n-This allows you to call a function or access a global variable without needing to keep its address in a register.\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-extern \"C\" fn foo(arg: i32) -> i32 {\n-    println!(\"arg = {}\", arg);\n-    arg * 2\n-}\n-\n-fn call_foo(arg: i32) -> i32 {\n-    unsafe {\n-        let result;\n-        asm!(\n-            \"call {}\",\n-            sym foo,\n-            // 1st argument in rdi\n-            in(\"rdi\") arg,\n-            // Return value in rax\n-            out(\"rax\") result,\n-            // Mark all registers which are not preserved by the \"C\" calling\n-            // convention as clobbered.\n-            clobber_abi(\"C\"),\n-        );\n-        result\n-    }\n-}\n-```\n-\n-Note that the `fn` or `static` item does not need to be public or `#[no_mangle]`: the compiler will automatically insert the appropriate mangled symbol name into the assembly code.\n-\n-By default, `asm!` assumes that any register not specified as an output will have its contents preserved by the assembly code. The [`clobber_abi`](#abi-clobbers) argument to `asm!` tells the compiler to automatically insert the necessary clobber operands according to the given calling convention ABI: any register which is not fully preserved in that ABI will be treated as clobbered.  Multiple `clobber_abi` arguments may be provided and all clobbers from all specified ABIs will be inserted.\n-\n-## Register template modifiers\n-\n-In some cases, fine control is needed over the way a register name is formatted when inserted into the template string. This is needed when an architecture's assembly language has several names for the same register, each typically being a \"view\" over a subset of the register (e.g. the low 32 bits of a 64-bit register).\n-\n-By default the compiler will always choose the name that refers to the full register size (e.g. `rax` on x86-64, `eax` on x86, etc).\n-\n-This default can be overriden by using modifiers on the template string operands, just like you would with format strings:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let mut x: u16 = 0xab;\n-\n-unsafe {\n-    asm!(\"mov {0:h}, {0:l}\", inout(reg_abcd) x);\n-}\n-\n-assert_eq!(x, 0xabab);\n-```\n-\n-In this example, we use the `reg_abcd` register class to restrict the register allocator to the 4 legacy x86 register (`ax`, `bx`, `cx`, `dx`) of which the first two bytes can be addressed independently.\n-\n-Let us assume that the register allocator has chosen to allocate `x` in the `ax` register.\n-The `h` modifier will emit the register name for the high byte of that register and the `l` modifier will emit the register name for the low byte. The asm code will therefore be expanded as `mov ah, al` which copies the low byte of the value into the high byte.\n-\n-If you use a smaller data type (e.g. `u16`) with an operand and forget the use template modifiers, the compiler will emit a warning and suggest the correct modifier to use.\n-\n-## Memory address operands\n-\n-Sometimes assembly instructions require operands passed via memory addresses/memory locations.\n-You have to manually use the memory address syntax specified by the target architecture.\n-For example, on x86/x86_64 using intel assembly syntax, you should wrap inputs/outputs in `[]` to indicate they are memory operands:\n-\n-```rust,allow_fail\n-#![feature(asm, llvm_asm)]\n-# fn load_fpu_control_word(control: u16) {\n-unsafe {\n-    asm!(\"fldcw [{}]\", in(reg) &control, options(nostack));\n-\n-    // Previously this would have been written with the deprecated `llvm_asm!` like this\n-    llvm_asm!(\"fldcw $0\" :: \"m\" (control) :: \"volatile\");\n-}\n-# }\n-```\n-\n-## Labels\n-\n-Any reuse of a named label, local or otherwise, can result in a assembler or linker error or may cause other strange behavior. Reuse of a named label can happen in a variety of ways including:\n-\n--   explicitly: using a label more than once in one `asm!` block, or multiple times across blocks\n--   implicitly via inlining: the compiler is allowed to instantiate multiple copies of an `asm!` block, for example when the function containing it is inlined in multiple places.\n--   implicitly via LTO: LTO can cause code from *other crates* to be placed in the same codegen unit, and so could bring in arbitrary labels\n-\n-As a consequence, you should only use GNU assembler **numeric** [local labels] inside inline assembly code. Defining symbols in assembly code may lead to assembler and/or linker errors due to duplicate symbol definitions.\n-\n-Moreover, on x86 when using the default intel syntax, due to [an llvm bug], you shouldn't use labels exclusively made of `0` and `1` digits, e.g. `0`, `11` or `101010`, as they may end up being interpreted as binary values. Using `options(att_syntax)` will avoid any ambiguity, but that affects the syntax of the _entire_ `asm!` block.\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-\n-let mut a = 0;\n-unsafe {\n-    asm!(\n-        \"mov {0}, 10\",\n-        \"2:\",\n-        \"sub {0}, 1\",\n-        \"cmp {0}, 3\",\n-        \"jle 2f\",\n-        \"jmp 2b\",\n-        \"2:\",\n-        \"add {0}, 2\",\n-        out(reg) a\n-    );\n-}\n-assert_eq!(a, 5);\n-```\n-\n-This will decrement the `{0}` register value from 10 to 3, then add 2 and store it in `a`.\n-\n-This example shows a few things:\n-\n-First that the same number can be used as a label multiple times in the same inline block.\n-\n-Second, that when a numeric label is used as a reference (as an instruction operand, for example), the suffixes b (\u201cbackward\u201d) or f (\u201cforward\u201d) should be added to the numeric label. It will then refer to the nearest label defined by this number in this direction.\n-\n-[local labels]: https://sourceware.org/binutils/docs/as/Symbol-Names.html#Local-Labels\n-[an llvm bug]: https://bugs.llvm.org/show_bug.cgi?id=36144\n-\n-## Options\n-\n-By default, an inline assembly block is treated the same way as an external FFI function call with a custom calling convention: it may read/write memory, have observable side effects, etc. However, in many cases it is desirable to give the compiler more information about what the assembly code is actually doing so that it can optimize better.\n-\n-Let's take our previous example of an `add` instruction:\n-\n-```rust,allow_fail\n-#![feature(asm)]\n-let mut a: u64 = 4;\n-let b: u64 = 4;\n-unsafe {\n-    asm!(\n-        \"add {0}, {1}\",\n-        inlateout(reg) a, in(reg) b,\n-        options(pure, nomem, nostack),\n-    );\n-}\n-assert_eq!(a, 8);\n-```\n-\n-Options can be provided as an optional final argument to the `asm!` macro. We specified three options here:\n-- `pure` means that the asm code has no observable side effects and that its output depends only on its inputs. This allows the compiler optimizer to call the inline asm fewer times or even eliminate it entirely.\n-- `nomem` means that the asm code does not read or write to memory. By default the compiler will assume that inline assembly can read or write any memory address that is accessible to it (e.g. through a pointer passed as an operand, or a global).\n-- `nostack` means that the asm code does not push any data onto the stack. This allows the compiler to use optimizations such as the stack red zone on x86-64 to avoid stack pointer adjustments.\n-\n-These allow the compiler to better optimize code using `asm!`, for example by eliminating pure `asm!` blocks whose outputs are not needed.\n-\n-See the reference for the full list of available options and their effects.\n-\n-# Reference-level explanation\n-[reference-level-explanation]: #reference-level-explanation\n-\n-Inline assembler is implemented as an unsafe macro `asm!()`.\n-The first argument to this macro is a template string literal used to build the final assembly.\n-The following arguments specify input and output operands.\n-When required, options are specified as the final argument.\n-\n-The following ABNF specifies the general syntax:\n-\n-```text\n-dir_spec := \"in\" / \"out\" / \"lateout\" / \"inout\" / \"inlateout\"\n-reg_spec := <register class> / \"<explicit register>\"\n-operand_expr := expr / \"_\" / expr \"=>\" expr / expr \"=>\" \"_\"\n-reg_operand := dir_spec \"(\" reg_spec \")\" operand_expr\n-operand := reg_operand / \"const\" const_expr / \"sym\" path\n-clobber_abi := \"clobber_abi(\" <abi> *[\",\" <abi>] [\",\"] \")\"\n-option := \"pure\" / \"nomem\" / \"readonly\" / \"preserves_flags\" / \"noreturn\" / \"nostack\" / \"att_syntax\" / \"raw\" / \"may_unwind\"\n-options := \"options(\" option *[\",\" option] [\",\"] \")\"\n-asm := \"asm!(\" format_string *(\",\" format_string) *(\",\" [ident \"=\"] operand) *(\",\" clobber_abi) *(\",\" options) [\",\"] \")\"\n-```\n-\n-Inline assembly is currently supported on the following architectures:\n-- x86 and x86-64\n-- ARM\n-- AArch64\n-- RISC-V\n-- NVPTX\n-- PowerPC\n-- Hexagon\n-- MIPS32r2 and MIPS64r2\n-- wasm32\n-- BPF\n-- SPIR-V\n-- AVR\n-\n-Support for more targets may be added in the future. The compiler will emit an error if `asm!` is used on an unsupported target.\n-\n-[format-syntax]: https://doc.rust-lang.org/std/fmt/#syntax\n-\n-## Template string arguments\n-\n-The assembler template uses the same syntax as [format strings][format-syntax] (i.e. placeholders are specified by curly braces). The corresponding arguments are accessed in order, by index, or by name. However, implicit named arguments (introduced by [RFC #2795][rfc-2795]) are not supported.\n-\n-An `asm!` invocation may have one or more template string arguments; an `asm!` with multiple template string arguments is treated as if all the strings were concatenated with a `\\n` between them. The expected usage is for each template string argument to correspond to a line of assembly code. All template string arguments must appear before any other arguments.\n-\n-As with format strings, named arguments must appear after positional arguments. Explicit register operands must appear at the end of the operand list, after named arguments if any.\n-\n-Explicit register operands cannot be used by placeholders in the template string. All other named and positional operands must appear at least once in the template string, otherwise a compiler error is generated.\n-\n-The exact assembly code syntax is target-specific and opaque to the compiler except for the way operands are substituted into the template string to form the code passed to the assembler.\n-\n-The 5 targets specified in this RFC (x86, ARM, AArch64, RISC-V, Hexagon) all use the assembly code syntax of the GNU assembler (GAS). On x86, the `.intel_syntax noprefix` mode of GAS is used by default. On ARM, the `.syntax unified` mode is used. These targets impose an additional restriction on the assembly code: any assembler state (e.g. the current section which can be changed with `.section`) must be restored to its original value at the end of the asm string. Assembly code that does not conform to the GAS syntax will result in assembler-specific behavior.\n-\n-[rfc-2795]: https://github.com/rust-lang/rfcs/pull/2795\n-\n-## Operand type\n-\n-Several types of operands are supported:\n-\n-* `in(<reg>) <expr>`\n-  - `<reg>` can refer to a register class or an explicit register. The allocated register name is substituted into the asm template string.\n-  - The allocated register will contain the value of `<expr>` at the start of the asm code.\n-  - The allocated register must contain the same value at the end of the asm code (except if a `lateout` is allocated to the same register).\n-* `out(<reg>) <expr>`\n-  - `<reg>` can refer to a register class or an explicit register. The allocated register name is substituted into the asm template string.\n-  - The allocated register will contain an undefined value at the start of the asm code.\n-  - `<expr>` must be a (possibly uninitialized) place expression, to which the contents of the allocated register is written to at the end of the asm code.\n-  - An underscore (`_`) may be specified instead of an expression, which will cause the contents of the register to be discarded at the end of the asm code (effectively acting as a clobber).\n-* `lateout(<reg>) <expr>`\n-  - Identical to `out` except that the register allocator can reuse a register allocated to an `in`.\n-  - You should only write to the register after all inputs are read, otherwise you may clobber an input.\n-* `inout(<reg>) <expr>`\n-  - `<reg>` can refer to a register class or an explicit register. The allocated register name is substituted into the asm template string.\n-  - The allocated register will contain the value of `<expr>` at the start of the asm code.\n-  - `<expr>` must be a mutable initialized place expression, to which the contents of the allocated register is written to at the end of the asm code.\n-* `inout(<reg>) <in expr> => <out expr>`\n-  - Same as `inout` except that the initial value of the register is taken from the value of `<in expr>`.\n-  - `<out expr>` must be a (possibly uninitialized) place expression, to which the contents of the allocated register is written to at the end of the asm code.\n-  - An underscore (`_`) may be specified instead of an expression for `<out expr>`, which will cause the contents of the register to be discarded at the end of the asm code (effectively acting as a clobber).\n-  - `<in expr>` and `<out expr>` may have different types.\n-* `inlateout(<reg>) <expr>` / `inlateout(<reg>) <in expr> => <out expr>`\n-  - Identical to `inout` except that the register allocator can reuse a register allocated to an `in` (this can happen if the compiler knows the `in` has the same initial value as the `inlateout`).\n-  - You should only write to the register after all inputs are read, otherwise you may clobber an input.\n-* `const <expr>`\n-  - `<expr>` must be an integer constant expression.\n-  - The value of the expression is formatted as a string and substituted directly into the asm template string.\n-* `sym <path>`\n-  - `<path>` must refer to a `fn` or `static`.\n-  - A mangled symbol name referring to the item is substituted into the asm template string.\n-  - The substituted string does not include any modifiers (e.g. GOT, PLT, relocations, etc).\n-  - `<path>` is allowed to point to a `#[thread_local]` static, in which case the asm code can combine the symbol with relocations (e.g. `@plt`, `@TPOFF`) to read from thread-local data.\n-\n-Operand expressions are evaluated from left to right, just like function call arguments. After the `asm!` has executed, outputs are written to in left to right order. This is significant if two outputs point to the same place: that place will contain the value of the rightmost output.\n-\n-## Register operands\n-\n-Input and output operands can be specified either as an explicit register or as a register class from which the register allocator can select a register. Explicit registers are specified as string literals (e.g. `\"eax\"`) while register classes are specified as identifiers (e.g. `reg`). Using string literals for register names enables support for architectures that use special characters in register names, such as MIPS (`$0`, `$1`, etc).\n-\n-Note that explicit registers treat register aliases (e.g. `r14` vs `lr` on ARM) and smaller views of a register (e.g. `eax` vs `rax`) as equivalent to the base register. It is a compile-time error to use the same explicit register for two input operands or two output operands. Additionally, it is also a compile-time error to use overlapping registers (e.g. ARM VFP) in input operands or in output operands.\n-\n-Only the following types are allowed as operands for inline assembly:\n-- Integers (signed and unsigned)\n-- Floating-point numbers\n-- Pointers (thin only)\n-- Function pointers\n-- SIMD vectors (structs defined with `#[repr(simd)]` and which implement `Copy`). This includes architecture-specific vector types defined in `std::arch` such as `__m128` (x86) or `int8x16_t` (ARM).\n-\n-Here is the list of currently supported register classes:\n-\n-| Architecture | Register class | Registers | LLVM constraint code |\n-| ------------ | -------------- | --------- | -------------------- |\n-| x86 | `reg` | `ax`, `bx`, `cx`, `dx`, `si`, `di`, `bp`, `r[8-15]` (x86-64 only) | `r` |\n-| x86 | `reg_abcd` | `ax`, `bx`, `cx`, `dx` | `Q` |\n-| x86-32 | `reg_byte` | `al`, `bl`, `cl`, `dl`, `ah`, `bh`, `ch`, `dh` | `q` |\n-| x86-64 | `reg_byte`\\* | `al`, `bl`, `cl`, `dl`, `sil`, `dil`, `bpl`, `r[8-15]b` | `q` |\n-| x86 | `xmm_reg` | `xmm[0-7]` (x86) `xmm[0-15]` (x86-64) | `x` |\n-| x86 | `ymm_reg` | `ymm[0-7]` (x86) `ymm[0-15]` (x86-64) | `x` |\n-| x86 | `zmm_reg` | `zmm[0-7]` (x86) `zmm[0-31]` (x86-64) | `v` |\n-| x86 | `kreg` | `k[1-7]` | `Yk` |\n-| x86 | `x87_reg` | `st([0-7])` | Only clobbers |\n-| x86 | `mmx_reg` | `mm[0-7]` | Only clobbers |\n-| AArch64 | `reg` | `x[0-30]` | `r` |\n-| AArch64 | `vreg` | `v[0-31]` | `w` |\n-| AArch64 | `vreg_low16` | `v[0-15]` | `x` |\n-| AArch64 | `preg` | `p[0-15]`, `ffr` | Only clobbers |\n-| ARM (ARM/Thumb2) | `reg` | `r[0-12]`, `r14` | `r` |\n-| ARM (Thumb1) | `reg` | `r[0-7]` | `r` |\n-| ARM | `sreg` | `s[0-31]` | `t` |\n-| ARM | `sreg_low16` | `s[0-15]` | `x` |\n-| ARM | `dreg` | `d[0-31]` | `w` |\n-| ARM | `dreg_low16` | `d[0-15]` | `t` |\n-| ARM | `dreg_low8` | `d[0-8]` | `x` |\n-| ARM | `qreg` | `q[0-15]` | `w` |\n-| ARM | `qreg_low8` | `q[0-7]` | `t` |\n-| ARM | `qreg_low4` | `q[0-3]` | `x` |\n-| MIPS | `reg` | `$[2-25]` | `r` |\n-| MIPS | `freg` | `$f[0-31]` | `f` |\n-| NVPTX | `reg16` | None\\* | `h` |\n-| NVPTX | `reg32` | None\\* | `r` |\n-| NVPTX | `reg64` | None\\* | `l` |\n-| RISC-V | `reg` | `x1`, `x[5-7]`, `x[9-15]`, `x[16-31]` (non-RV32E) | `r` |\n-| RISC-V | `freg` | `f[0-31]` | `f` |\n-| RISC-V | `vreg` | `v[0-31]` | Only clobbers |\n-| Hexagon | `reg` | `r[0-28]` | `r` |\n-| PowerPC | `reg` | `r[0-31]` | `r` |\n-| PowerPC | `reg_nonzero` | | `r[1-31]` | `b` |\n-| PowerPC | `freg` | `f[0-31]` | `f` |\n-| PowerPC | `cr` | `cr[0-7]`, `cr` | Only clobbers |\n-| PowerPC | `xer` | `xer` | Only clobbers |\n-| wasm32 | `local` | None\\* | `r` |\n-| BPF | `reg` |\u00a0`r[0-10]` | `r` |\n-| BPF | `wreg` |\u00a0`w[0-10]` | `w` |\n-| AVR | `reg` | `r[2-25]`, `XH`, `XL`, `ZH`, `ZL` | `r` |\n-| AVR | `reg_upper` | `r[16-25]`, `XH`, `XL`, `ZH`, `ZL` | `d` |\n-| AVR | `reg_pair` | `r3r2` .. `r25r24`, `X`, `Z` | `r` |\n-| AVR | `reg_iw` | `r25r24`, `X`, `Z` | `w` |\n-| AVR | `reg_ptr` | `X`, `Z` | `e` |\n-\n-> **Note**: On x86 we treat `reg_byte` differently from `reg` because the compiler can allocate `al` and `ah` separately whereas `reg` reserves the whole register.\n->\n-> Note #2: On x86-64 the high byte registers (e.g. `ah`) are not available in the `reg_byte` register class.\n->\n-> Note #3: NVPTX doesn't have a fixed register set, so named registers are not supported.\n->\n-> Note #4: WebAssembly doesn't have registers, so named registers are not supported.\n->\n-> Note #5: Some register classes are marked as \"Only clobbers\" which means that they cannot be used for inputs or outputs, only clobbers of the form `out(\"reg\") _` or `lateout(\"reg\") _`.\n-\n-Additional register classes may be added in the future based on demand (e.g. MMX, x87, etc).\n-\n-Each register class has constraints on which value types they can be used with. This is necessary because the way a value is loaded into a register depends on its type. For example, on big-endian systems, loading a `i32x4` and a `i8x16` into a SIMD register may result in different register contents even if the byte-wise memory representation of both values is identical. The availability of supported types for a particular register class may depend on what target features are currently enabled.\n-\n-| Architecture | Register class | Target feature | Allowed types |\n-| ------------ | -------------- | -------------- | ------------- |\n-| x86-32 | `reg` | None | `i16`, `i32`, `f32` |\n-| x86-64 | `reg` | None | `i16`, `i32`, `f32`, `i64`, `f64` |\n-| x86 | `reg_byte` | None | `i8` |\n-| x86 | `xmm_reg` | `sse` | `i32`, `f32`, `i64`, `f64`, <br> `i8x16`, `i16x8`, `i32x4`, `i64x2`, `f32x4`, `f64x2` |\n-| x86 | `ymm_reg` | `avx` | `i32`, `f32`, `i64`, `f64`, <br> `i8x16`, `i16x8`, `i32x4`, `i64x2`, `f32x4`, `f64x2` <br> `i8x32`, `i16x16`, `i32x8`, `i64x4`, `f32x8`, `f64x4` |\n-| x86 | `zmm_reg` | `avx512f` | `i32`, `f32`, `i64`, `f64`, <br> `i8x16`, `i16x8`, `i32x4`, `i64x2`, `f32x4`, `f64x2` <br> `i8x32`, `i16x16`, `i32x8`, `i64x4`, `f32x8`, `f64x4` <br> `i8x64`, `i16x32`, `i32x16`, `i64x8`, `f32x16`, `f64x8` |\n-| x86 | `kreg` | `avx512f` | `i8`, `i16` |\n-| x86 | `kreg` | `avx512bw` | `i32`, `i64` |\n-| x86 | `mmx_reg` | N/A | Only clobbers |\n-| x86 | `x87_reg` | N/A | Only clobbers |\n-| AArch64 | `reg` | None | `i8`, `i16`, `i32`, `f32`, `i64`, `f64` |\n-| AArch64 | `vreg` | `fp` | `i8`, `i16`, `i32`, `f32`, `i64`, `f64`, <br> `i8x8`, `i16x4`, `i32x2`, `i64x1`, `f32x2`, `f64x1`, <br> `i8x16`, `i16x8`, `i32x4`, `i64x2`, `f32x4`, `f64x2` |\n-| AArch64 | `preg` | N/A | Only clobbers |\n-| ARM | `reg` | None | `i8`, `i16`, `i32`, `f32` |\n-| ARM | `sreg` | `vfp2` | `i32`, `f32` |\n-| ARM | `dreg` | `vfp2` | `i64`, `f64`, `i8x8`, `i16x4`, `i32x2`, `i64x1`, `f32x2` |\n-| ARM | `qreg` | `neon` | `i8x16`, `i16x8`, `i32x4`, `i64x2`, `f32x4` |\n-| MIPS32 | `reg` | None | `i8`, `i16`, `i32`, `f32` |\n-| MIPS32 | `freg` | None | `f32`, `f64` |\n-| MIPS64 | `reg` | None | `i8`, `i16`, `i32`, `i64`, `f32`, `f64` |\n-| MIPS64 | `freg` | None | `f32`, `f64` |\n-| NVPTX | `reg16` | None | `i8`, `i16` |\n-| NVPTX | `reg32` | None | `i8`, `i16`, `i32`, `f32` |\n-| NVPTX | `reg64` | None | `i8`, `i16`, `i32`, `f32`, `i64`, `f64` |\n-| RISC-V32 | `reg` | None | `i8`, `i16`, `i32`, `f32` |\n-| RISC-V64 | `reg` | None | `i8`, `i16`, `i32`, `f32`, `i64`, `f64` |\n-| RISC-V | `freg` | `f` | `f32` |\n-| RISC-V | `freg` | `d` | `f64` |\n-| RISC-V | `vreg` | N/A | Only clobbers |\n-| Hexagon | `reg` | None | `i8`, `i16`, `i32`, `f32` |\n-| PowerPC | `reg` | None | `i8`, `i16`, `i32` |\n-| PowerPC | `reg_nonzero` | None | `i8`, `i16`, `i32` |\n-| PowerPC | `freg` | None | `f32`, `f64` |\n-| PowerPC | `cr` | N/A | Only clobbers |\n-| PowerPC | `xer` | N/A | Only clobbers |\n-| wasm32 | `local` | None | `i8` `i16` `i32` `i64` `f32` `f64` |\n-| BPF |\u00a0`reg` |\u00a0None | `i8` `i16` `i32` `i64` |\n-| BPF |\u00a0`wreg` |\u00a0`alu32` | `i8` `i16` `i32` |\n-| AVR | `reg`, `reg_upper` | None | `i8` |\n-| AVR | `reg_pair`, `reg_iw`, `reg_ptr` | None | `i16` |\n-\n-> **Note**: For the purposes of the above table pointers, function pointers and `isize`/`usize` are treated as the equivalent integer type (`i16`/`i32`/`i64` depending on the target).\n-\n-If a value is of a smaller size than the register it is allocated in then the upper bits of that register will have an undefined value for inputs and will be ignored for outputs. The only exception is the `freg` register class on RISC-V where `f32` values are NaN-boxed in a `f64` as required by the RISC-V architecture.\n-\n-When separate input and output expressions are specified for an `inout` operand, both expressions must have the same type. The only exception is if both operands are pointers or integers, in which case they are only required to have the same size. This restriction exists because the register allocators in LLVM and GCC sometimes cannot handle tied operands with different types.\n-\n-## Register names\n-\n-Some registers have multiple names. These are all treated by the compiler as identical to the base register name. Here is the list of all supported register aliases:\n-\n-| Architecture | Base register | Aliases |\n-| ------------ | ------------- | ------- |\n-| x86 | `ax` | `eax`, `rax` |\n-| x86 | `bx` | `ebx`, `rbx` |\n-| x86 | `cx` | `ecx`, `rcx` |\n-| x86 | `dx` | `edx`, `rdx` |\n-| x86 | `si` | `esi`, `rsi` |\n-| x86 | `di` | `edi`, `rdi` |\n-| x86 | `bp` | `bpl`, `ebp`, `rbp` |\n-| x86 | `sp` | `spl`, `esp`, `rsp` |\n-| x86 | `ip` | `eip`, `rip` |\n-| x86 | `st(0)` | `st` |\n-| x86 | `r[8-15]` | `r[8-15]b`, `r[8-15]w`, `r[8-15]d` |\n-| x86 | `xmm[0-31]` | `ymm[0-31]`, `zmm[0-31]` |\n-| AArch64 | `x[0-30]` | `w[0-30]` |\n-| AArch64 | `x29` | `fp` |\n-| AArch64 | `x30` | `lr` |\n-| AArch64 | `sp` | `wsp` |\n-| AArch64 | `xzr` | `wzr` |\n-| AArch64 | `v[0-31]` | `b[0-31]`, `h[0-31]`, `s[0-31]`, `d[0-31]`, `q[0-31]` |\n-| ARM | `r[0-3]` | `a[1-4]` |\n-| ARM | `r[4-9]` | `v[1-6]` |\n-| ARM | `r9` | `rfp` |\n-| ARM | `r10` | `sl` |\n-| ARM | `r11` | `fp` |\n-| ARM | `r12` | `ip` |\n-| ARM | `r13` | `sp` |\n-| ARM | `r14` | `lr` |\n-| ARM | `r15` | `pc` |\n-| RISC-V | `x0` | `zero` |\n-| RISC-V | `x1` | `ra` |\n-| RISC-V | `x2` | `sp` |\n-| RISC-V | `x3` | `gp` |\n-| RISC-V | `x4` | `tp` |\n-| RISC-V | `x[5-7]` | `t[0-2]` |\n-| RISC-V | `x8` | `fp`, `s0` |\n-| RISC-V | `x9` | `s1` |\n-| RISC-V | `x[10-17]` | `a[0-7]` |\n-| RISC-V | `x[18-27]` | `s[2-11]` |\n-| RISC-V | `x[28-31]` | `t[3-6]` |\n-| RISC-V | `f[0-7]` | `ft[0-7]` |\n-| RISC-V | `f[8-9]` | `fs[0-1]` |\n-| RISC-V | `f[10-17]` | `fa[0-7]` |\n-| RISC-V | `f[18-27]` | `fs[2-11]` |\n-| RISC-V | `f[28-31]` | `ft[8-11]` |\n-| Hexagon | `r29` | `sp` |\n-| Hexagon | `r30` | `fr` |\n-| Hexagon | `r31` | `lr` |\n-| BPF | `r[0-10]` | `w[0-10]` |\n-| AVR | `XH` | `r27` |\n-| AVR | `XL` | `r26` |\n-| AVR | `ZH` | `r31` |\n-| AVR | `ZL` | `r30` |\n-\n-Some registers cannot be used for input or output operands:\n-\n-| Architecture | Unsupported register | Reason |\n-| ------------ | -------------------- | ------ |\n-| All | `sp` | The stack pointer must be restored to its original value at the end of an asm code block. |\n-| All | `bp` (x86), `x29` (AArch64), `x8` (RISC-V), `fr` (Hexagon), `$fp` (MIPS), `Y` (AVR) | The frame pointer cannot be used as an input or output. |\n-| ARM | `r7` or `r11` | On ARM the frame pointer can be either `r7` or `r11` depending on the target. The frame pointer cannot be used as an input or output. |\n-| All | `si` (x86-32), `bx` (x86-64), `r6` (ARM), `x19` (AArch64), `r19` (Hexagon), `x9` (RISC-V) | This is used internally by LLVM as a \"base pointer\" for functions with complex stack frames. |\n-| x86 | `k0` | This is a constant zero register which can't be modified. |\n-| x86 | `ip` | This is the program counter, not a real register. |\n-| x86 | `mm[0-7]` | MMX registers are not currently supported (but may be in the future). |\n-| x86 | `st([0-7])` | x87 registers are not currently supported (but may be in the future). |\n-| AArch64 | `xzr` | This is a constant zero register which can't be modified. |\n-| ARM | `pc` | This is the program counter, not a real register. |\n-| ARM | `r9` | This is a reserved register on some ARM targets. |\n-| MIPS | `$0` or `$zero` | This is a constant zero register which can't be modified. |\n-| MIPS | `$1` or `$at` | Reserved for assembler. |\n-| MIPS | `$26`/`$k0`, `$27`/`$k1` | OS-reserved registers. |\n-| MIPS | `$28`/`$gp` | Global pointer cannot be used as inputs or outputs. |\n-| MIPS | `$ra` | Return address cannot be used as inputs or outputs. |\n-| RISC-V | `x0` | This is a constant zero register which can't be modified. |\n-| RISC-V | `gp`, `tp` | These registers are reserved and cannot be used as inputs or outputs. |\n-| Hexagon | `lr` | This is the link register which cannot be used as an input or output. |\n-| AVR | `r0`, `r1`, `r1r0` | Due to an issue in LLVM, the `r0` and `r1` registers cannot be used as inputs or outputs.  If modified, they must be restored to their original values before the end of the block. |\n-\n-In some cases LLVM will allocate a \"reserved register\" for `reg` operands even though this register cannot be explicitly specified. Assembly code making use of reserved registers should be careful since `reg` operands may alias with those registers. Reserved registers are the frame pointer and base pointer\n-- The frame pointer and LLVM base pointer on all architectures.\n-- `r9` on ARM.\n-- `x18` on AArch64.\n-- `r0` and `r1` on AVR.\n-\n-## Template modifiers\n-\n-The placeholders can be augmented by modifiers which are specified after the `:` in the curly braces. These modifiers do not affect register allocation, but change the way operands are formatted when inserted into the template string. Only one modifier is allowed per template placeholder.\n-\n-The supported modifiers are a subset of LLVM's (and GCC's) [asm template argument modifiers][llvm-argmod], but do not use the same letter codes.\n-\n-| Architecture | Register class | Modifier | Example output | LLVM modifier |\n-| ------------ | -------------- | -------- | -------------- | ------------- |\n-| x86-32 | `reg` | None | `eax` | `k` |\n-| x86-64 | `reg` | None | `rax` | `q` |\n-| x86-32 | `reg_abcd` | `l` | `al` | `b` |\n-| x86-64 | `reg` | `l` | `al` | `b` |\n-| x86 | `reg_abcd` | `h` | `ah` | `h` |\n-| x86 | `reg` | `x` | `ax` | `w` |\n-| x86 | `reg` | `e` | `eax` | `k` |\n-| x86-64 | `reg` | `r` | `rax` | `q` |\n-| x86 | `reg_byte` | None | `al` / `ah` | None |\n-| x86 | `xmm_reg` | None | `xmm0` | `x` |\n-| x86 | `ymm_reg` | None | `ymm0` | `t` |\n-| x86 | `zmm_reg` | None | `zmm0` | `g` |\n-| x86 | `*mm_reg` | `x` | `xmm0` | `x` |\n-| x86 | `*mm_reg` | `y` | `ymm0` | `t` |\n-| x86 | `*mm_reg` | `z` | `zmm0` | `g` |\n-| x86 | `kreg` | None | `k1` | None |\n-| AArch64 | `reg` | None | `x0` | `x` |\n-| AArch64 | `reg` | `w` | `w0` | `w` |\n-| AArch64 | `reg` | `x` | `x0` | `x` |\n-| AArch64 | `vreg` | None | `v0` | None |\n-| AArch64 | `vreg` | `v` | `v0` | None |\n-| AArch64 | `vreg` | `b` | `b0` | `b` |\n-| AArch64 | `vreg` | `h` | `h0` | `h` |\n-| AArch64 | `vreg` | `s` | `s0` | `s` |\n-| AArch64 | `vreg` | `d` | `d0` | `d` |\n-| AArch64 | `vreg` | `q` | `q0` | `q` |\n-| ARM | `reg` | None | `r0` | None |\n-| ARM | `sreg` | None | `s0` | None |\n-| ARM | `dreg` | None | `d0` | `P` |\n-| ARM | `qreg` | None | `q0` | `q` |\n-| ARM | `qreg` | `e` / `f` | `d0` / `d1` | `e` / `f` |\n-| MIPS | `reg` | None | `$2` | None |\n-| MIPS | `freg` | None | `$f0` | None |\n-| NVPTX | `reg16` | None | `rs0` | None |\n-| NVPTX | `reg32` | None | `r0` | None |\n-| NVPTX | `reg64` | None | `rd0` | None |\n-| RISC-V | `reg` | None | `x1` | None |\n-| RISC-V | `freg` | None | `f0` | None |\n-| Hexagon | `reg` | None | `r0` | None |\n-| PowerPC | `reg` | None | `0` | None |\n-| PowerPC | `reg_nonzero` | None | `3` | `b` |\n-| PowerPC | `freg` | None | `0` | None |\n-\n-> Notes:\n-> - on ARM `e` / `f`: this prints the low or high doubleword register name of a NEON quad (128-bit) register.\n-> - on x86: our behavior for `reg` with no modifiers differs from what GCC does. GCC will infer the modifier based on the operand value type, while we default to the full register size.\n-> - on x86 `xmm_reg`: the `x`, `t` and `g` LLVM modifiers are not yet implemented in LLVM (they are supported by GCC only), but this should be a simple change.\n-\n-As stated in the previous section, passing an input value smaller than the register width will result in the upper bits of the register containing undefined values. This is not a problem if the inline asm only accesses the lower bits of the register, which can be done by using a template modifier to use a subregister name in the asm code (e.g. `ax` instead of `rax`). Since this an easy pitfall, the compiler will suggest a template modifier to use where appropriate given the input type. If all references to an operand already have modifiers then the warning is suppressed for that operand.\n-\n-[llvm-argmod]: http://llvm.org/docs/LangRef.html#asm-template-argument-modifiers\n-\n-## ABI clobbers\n-\n-The `clobber_abi` keyword can be used to apply a default set of clobbers to an `asm` block. This will automatically insert the necessary clobber constraints as needed for calling a function with a particular calling convention: if the calling convention does not fully preserve the value of a register across a call then a `lateout(\"reg\") _` is implicitly added to the operands list.\n-\n-`clobber_abi` may be specified any number of times. It will insert a clobber for all unique registers in the union of all specified calling conventions.\n-\n-Generic register class outputs are disallowed by the compiler when `clobber_abi` is used: all outputs must specify an explicit register. Explicit register outputs have precedence over the implicit clobbers inserted by `clobber_abi`: a clobber will only be inserted for a register if that register is not used as an output.\n-The following ABIs can be used with `clobber_abi`:\n-\n-| Architecture | ABI name | Clobbered registers |\n-| ------------ | -------- | ------------------- |\n-| x86-32 | `\"C\"`, `\"system\"`, `\"efiapi\"`, `\"cdecl\"`, `\"stdcall\"`, `\"fastcall\"` | `ax`, `cx`, `dx`, `xmm[0-7]`, `mm[0-7]`, `k[1-7]`, `st([0-7])` |\n-| x86-64 | `\"C\"`, `\"system\"` (on Windows), `\"efiapi\"`, `\"win64\"` | `ax`, `cx`, `dx`, `r[8-11]`, `xmm[0-31]`, `mm[0-7]`, `k[1-7]`, `st([0-7])` |\n-| x86-64 | `\"C\"`, `\"system\"` (on non-Windows), `\"sysv64\"` | `ax`, `cx`, `dx`, `si`, `di`, `r[8-11]`, `xmm[0-31]`, `mm[0-7]`, `k[1-7]`, `st([0-7])` |\n-| AArch64 | `\"C\"`, `\"system\"`, `\"efiapi\"` | `x[0-17]`, `x30`, `v[0-31]`, `p[0-15]`, `ffr` |\n-| ARM | `\"C\"`, `\"system\"`, `\"efiapi\"`, `\"aapcs\"` | `r[0-3]`, `r12`, `r14`, `s[0-15]`, `d[0-7]`, `d[16-31]` |\n-| RISC-V | `\"C\"`, `\"system\"`, `\"efiapi\"` | `x1`, `x[5-7]`, `x[10-17]`, `x[28-31]`, `f[0-7]`, `f[10-17]`, `f[28-31]`, `v[0-31]` |\n-\n-The list of clobbered registers for each ABI is updated in rustc as architectures gain new registers: this ensures that `asm` clobbers will continue to be correct when LLVM starts using these new registers in its generated code.\n-\n-## Options\n-\n-Flags are used to further influence the behavior of the inline assembly block.\n-Currently the following options are defined:\n-- `pure`: The `asm` block has no side effects, and its outputs depend only on its direct inputs (i.e. the values themselves, not what they point to) or values read from memory (unless the `nomem` options is also set). This allows the compiler to execute the `asm` block fewer times than specified in the program (e.g. by hoisting it out of a loop) or even eliminate it entirely if the outputs are not used.\n-- `nomem`: The `asm` blocks does not read or write to any memory. This allows the compiler to cache the values of modified global variables in registers across the `asm` block since it knows that they are not read or written to by the `asm`.\n-- `readonly`: The `asm` block does not write to any memory. This allows the compiler to cache the values of unmodified global variables in registers across the `asm` block since it knows that they are not written to by the `asm`.\n-- `preserves_flags`: The `asm` block does not modify the flags register (defined in the rules below). This allows the compiler to avoid recomputing the condition flags after the `asm` block.\n-- `noreturn`: The `asm` block never returns, and its return type is defined as `!` (never). Behavior is undefined if execution falls through past the end of the asm code. A `noreturn` asm block behaves just like a function which doesn't return; notably, local variables in scope are not dropped before it is invoked.\n-- `nostack`: The `asm` block does not push data to the stack, or write to the stack red-zone (if supported by the target). If this option is *not* used then the stack pointer is guaranteed to be suitably aligned (according to the target ABI) for a function call.\n-- `att_syntax`: This option is only valid on x86, and causes the assembler to use the `.att_syntax prefix` mode of the GNU assembler. Register operands are substituted in with a leading `%`.\n-- `may_unwind`: The `asm` block may unwind the stack and be part of the stack unwinding process (This option is only supported by the LLVM backend right now).\n-- `raw`: This causes the template string to be parsed as a raw assembly string, with no special handling for `{` and `}`. This is primarily useful when including raw assembly code from an external file using `include_str!`.\n-\n-The compiler performs some additional checks on options:\n-- The `nomem` and `readonly` options are mutually exclusive: it is a compile-time error to specify both.\n-- The `pure` option must be combined with either the `nomem` or `readonly` options, otherwise a compile-time error is emitted.\n-- It is a compile-time error to specify `pure` on an asm block with no outputs or only discarded outputs (`_`).\n-- It is a compile-time error to specify `noreturn` on an asm block with outputs.\n-\n-## Rules for inline assembly\n-\n-- Any registers not specified as inputs will contain an undefined value on entry to the asm block.\n-  - An \"undefined value\" in the context of inline assembly means that the register can (non-deterministically) have any one of the possible values allowed by the architecture. Notably it is not the same as an LLVM `undef` which can have a different value every time you read it (since such a concept does not exist in assembly code).\n-- Any registers not specified as outputs must have the same value upon exiting the asm block as they had on entry, otherwise behavior is undefined.\n-  - This only applies to registers which can be specified as an input or output. Other registers follow target-specific rules.\n-  - Note that a `lateout` may be allocated to the same register as an `in`, in which case this rule does not apply. Code should not rely on this however since it depends on the results of register allocation.\n-- Behavior is undefined if execution unwinds out of an asm block.\n-  - This also applies if the assembly code calls a function which then unwinds.\n-- The set of memory locations that assembly code is allowed to read and write are the same as those allowed for an FFI function.\n-  - Refer to the unsafe code guidelines for the exact rules.\n-  - If the `readonly` option is set, then only memory reads are allowed.\n-  - If the `nomem` option is set then no reads or writes to memory are allowed.\n-  - These rules do not apply to memory which is private to the asm code, such as stack space allocated within the asm block.\n-- The compiler cannot assume that the instructions in the asm are the ones that will actually end up executed.\n-  - This effectively means that the compiler must treat the `asm!` as a black box and only take the interface specification into account, not the instructions themselves.\n-  - Runtime code patching is allowed, via target-specific mechanisms (outside the scope of this RFC).\n-- Unless the `nostack` option is set, asm code is allowed to use stack space below the stack pointer.\n-  - On entry to the asm block the stack pointer is guaranteed to be suitably aligned (according to the target ABI) for a function call.\n-  - You are responsible for making sure you don't overflow the stack (e.g. use stack probing to ensure you hit a guard page).\n-  - You should adjust the stack pointer when allocating stack memory as required by the target ABI.\n-  - The stack pointer must be restored to its original value before leaving the asm block.\n-- If the `noreturn` option is set then behavior is undefined if execution falls through to the end of the asm block.\n-- If the `pure` option is set then behavior is undefined if the `asm` has side-effects other than its direct outputs. Behavior is also undefined if two executions of the `asm` code with the same inputs result in different outputs.\n-  - When used with the `nomem` option, \"inputs\" are just the direct inputs of the `asm!`.\n-  - When used with the `readonly` option, \"inputs\" comprise the direct inputs of the `asm!` and any memory that the `asm!` block is allowed to read.\n-- These flags registers must be restored upon exiting the asm block if the `preserves_flags` option is set:\n-  - x86\n-    - Status flags in `EFLAGS` (CF, PF, AF, ZF, SF, OF).\n-    - Floating-point status word (all).\n-    - Floating-point exception flags in `MXCSR` (PE, UE, OE, ZE, DE, IE).\n-  - ARM\n-    - Condition flags in `CPSR` (N, Z, C, V)\n-    - Saturation flag in `CPSR` (Q)\n-    - Greater than or equal flags in `CPSR` (GE).\n-    - Condition flags in `FPSCR` (N, Z, C, V)\n-    - Saturation flag in `FPSCR` (QC)\n-    - Floating-point exception flags in `FPSCR` (IDC, IXC, UFC, OFC, DZC, IOC).\n-  - AArch64\n-    - Condition flags (`NZCV` register).\n-    - Floating-point status (`FPSR` register).\n-  - RISC-V\n-    - Floating-point exception flags in `fcsr` (`fflags`).\n-    - Vector extension state (`vtype`, `vl`, `vcsr`).\n-  - AVR\n-    - The status register `SREG`.\n-- On x86, the direction flag (DF in `EFLAGS`) is clear on entry to an asm block and must be clear on exit.\n-  - Behavior is undefined if the direction flag is set on exiting an asm block.\n-- The requirement of restoring the stack pointer and non-output registers to their original value only applies when exiting an `asm!` block.\n-  - This means that `asm!` blocks that never return (even if not marked `noreturn`) don't need to preserve these registers.\n-  - When returning to a different `asm!` block than you entered (e.g. for context switching), these registers must contain the value they had upon entering the `asm!` block that you are *exiting*.\n-    - You cannot exit an `asm!` block that has not been entered. Neither can you exit an `asm!` block that has already been exited.\n-    - You are responsible for switching any target-specific state (e.g. thread-local storage, stack bounds).\n-    - The set of memory locations that you may access is the intersection of those allowed by the `asm!` blocks you entered and exited.\n-- You cannot assume that an `asm!` block will appear exactly once in the output binary. The compiler is allowed to instantiate multiple copies of the `asm!` block, for example when the function containing it is inlined in multiple places.\n-- On x86, inline assembly must not end with an instruction prefix (such as `LOCK`) that would apply to instructions generated by the compiler.\n-  - The compiler is currently unable to detect this due to the way inline assembly is compiled, but may catch and reject this in the future.\n-\n-> **Note**: As a general rule, the flags covered by `preserves_flags` are those which are *not* preserved when performing a function call."}, {"sha": "3f8e165841d1421bb906720da5f8fc2171c4c26d", "filename": "src/doc/unstable-book/src/library-features/global-asm.md", "status": "removed", "additions": 0, "deletions": 113, "changes": 113, "blob_url": "https://github.com/rust-lang/rust/blob/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fglobal-asm.md", "raw_url": "https://github.com/rust-lang/rust/raw/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fglobal-asm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fglobal-asm.md?ref=b3a55371a72f665f5d9476d07980e76d3e755fe6", "patch": "@@ -1,113 +0,0 @@\n-# `global_asm`\n-\n-The tracking issue for this feature is: [#35119]\n-\n-[#35119]: https://github.com/rust-lang/rust/issues/35119\n-\n-------------------------\n-\n-The `global_asm!` macro allows the programmer to write arbitrary\n-assembly outside the scope of a function body, passing it through\n-`rustc` and `llvm` to the assembler. That is to say, `global_asm!` is\n-equivalent to assembling the asm with an external assembler and then\n-linking the resulting object file with the current crate.\n-\n-`global_asm!` fills a role not currently satisfied by either `asm!`\n-or `#[naked]` functions. The programmer has _all_ features of the\n-assembler at their disposal. The linker will expect to resolve any\n-symbols defined in the inline assembly, modulo any symbols marked as\n-external. It also means syntax for directives and assembly follow the\n-conventions of the assembler in your toolchain.\n-\n-A simple usage looks like this:\n-\n-```rust,ignore (requires-external-file)\n-#![feature(global_asm)]\n-# // you also need relevant target_arch cfgs\n-global_asm!(include_str!(\"something_neato.s\"));\n-```\n-\n-And a more complicated usage looks like this:\n-\n-```rust,no_run\n-#![feature(global_asm)]\n-# #[cfg(any(target_arch=\"x86\", target_arch=\"x86_64\"))]\n-# mod x86 {\n-\n-pub mod sally {\n-    global_asm!(\n-        \".global foo\",\n-        \"foo:\",\n-        \"jmp baz\",\n-    );\n-\n-    #[no_mangle]\n-    pub unsafe extern \"C\" fn baz() {}\n-}\n-\n-// the symbols `foo` and `bar` are global, no matter where\n-// `global_asm!` was used.\n-extern \"C\" {\n-    fn foo();\n-    fn bar();\n-}\n-\n-pub mod harry {\n-    global_asm!(\n-        \".global bar\",\n-        \"bar:\",\n-        \"jmp quux\",\n-    );\n-\n-    #[no_mangle]\n-    pub unsafe extern \"C\" fn quux() {}\n-}\n-# }\n-```\n-\n-You may use `global_asm!` multiple times, anywhere in your crate, in\n-whatever way suits you. However, you should not rely on assembler state\n-(e.g. assembler macros) defined in one `global_asm!` to be available in\n-another one. It is implementation-defined whether the multiple usages\n-are concatenated into one or assembled separately.\n-\n-`global_asm!` also supports `const` operands like `asm!`, which allows\n-constants defined in Rust to be used in assembly code:\n-\n-```rust,no_run\n-#![feature(global_asm, asm_const)]\n-# #[cfg(any(target_arch=\"x86\", target_arch=\"x86_64\"))]\n-# mod x86 {\n-const C: i32 = 1234;\n-global_asm!(\n-    \".global bar\",\n-    \"bar: .word {c}\",\n-    c = const C,\n-);\n-# }\n-```\n-\n-The syntax for passing operands is the same as `asm!` except that only\n-`const` operands are allowed. Refer to the [asm](asm.md) documentation\n-for more details.\n-\n-On x86, the assembly code will use intel syntax by default. You can\n-override this by adding `options(att_syntax)` at the end of the macro\n-arguments list:\n-\n-```rust,no_run\n-#![feature(global_asm, asm_const)]\n-# #[cfg(any(target_arch=\"x86\", target_arch=\"x86_64\"))]\n-# mod x86 {\n-global_asm!(\"movl ${}, %ecx\", const 5, options(att_syntax));\n-// is equivalent to\n-global_asm!(\"mov ecx, {}\", const 5);\n-# }\n-```\n-\n-------------------------\n-\n-If you don't need quite as much power and flexibility as\n-`global_asm!` provides, and you don't mind restricting your inline\n-assembly to `fn` bodies only, you might try the\n-[asm](asm.md) feature instead."}, {"sha": "094124998b6e738686a98c6400dc1c663efc0c16", "filename": "src/doc/unstable-book/src/library-features/llvm-asm.md", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fllvm-asm.md", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fllvm-asm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fllvm-asm.md?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -188,6 +188,3 @@ documentation as well][llvm-docs] for more information about clobbers,\n constraints, etc.\n \n [llvm-docs]: http://llvm.org/docs/LangRef.html#inline-assembler-expressions\n-\n-If you need more power and don't mind losing some of the niceties of\n-`llvm_asm!`, check out [global_asm](global-asm.md)."}, {"sha": "0358bc6d27c29eac5a6ff13a2a34d466eb5b88f2", "filename": "src/test/assembly/asm/global_asm.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fassembly%2Fasm%2Fglobal_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fassembly%2Fasm%2Fglobal_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fassembly%2Fasm%2Fglobal_asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,9 +2,11 @@\n // assembly-output: emit-asm\n // compile-flags: -C llvm-args=--x86-asm-syntax=intel\n \n-#![feature(global_asm, asm_const)]\n+#![feature(asm_const)]\n #![crate_type = \"rlib\"]\n \n+use std::arch::global_asm;\n+\n // CHECK: mov eax, eax\n global_asm!(\"mov eax, eax\");\n // CHECK: mov ebx, 5"}, {"sha": "720850e91e82da5c4ac4a4a74d892e4bb5968b41", "filename": "src/test/assembly/x86_64-fortanix-unknown-sgx-lvi-inline-assembly.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fassembly%2Fx86_64-fortanix-unknown-sgx-lvi-inline-assembly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fassembly%2Fx86_64-fortanix-unknown-sgx-lvi-inline-assembly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fassembly%2Fx86_64-fortanix-unknown-sgx-lvi-inline-assembly.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -4,11 +4,11 @@\n // compile-flags: --crate-type staticlib\n // only-x86_64-fortanix-unknown-sgx\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n #[no_mangle]\n-pub extern fn get(ptr: *const u64) -> u64 {\n-    let value : u64;\n+pub extern \"C\" fn get(ptr: *const u64) -> u64 {\n+    let value: u64;\n     unsafe {\n         asm!(\".start_inline_asm:\",\n             \"mov {}, [{}]\",\n@@ -26,11 +26,13 @@ pub extern fn get(ptr: *const u64) -> u64 {\n // CHECK-NEXT: .end_inline_asm\n \n #[no_mangle]\n-pub extern fn myret() {\n+pub extern \"C\" fn myret() {\n     unsafe {\n-        asm!(\".start_myret_inline_asm:\n+        asm!(\n+            \".start_myret_inline_asm:\n             ret\n-            .end_myret_inline_asm:\");\n+            .end_myret_inline_asm:\"\n+        );\n     }\n }\n "}, {"sha": "69e35270266555d0f0cdf8f583cda8d63a382217", "filename": "src/test/codegen/asm-clobber_abi.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-clobber_abi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-clobber_abi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-clobber_abi.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,8 @@\n // only-x86_64\n \n #![crate_type = \"rlib\"]\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n // CHECK-LABEL: @clobber_sysv64\n // CHECK: ={ax},={cx},={dx},={si},={di},={r8},={r9},={r10},={r11},={xmm0},={xmm1},={xmm2},={xmm3},={xmm4},={xmm5},={xmm6},={xmm7},={xmm8},={xmm9},={xmm10},={xmm11},={xmm12},={xmm13},={xmm14},={xmm15},~{xmm16},~{xmm17},~{xmm18},~{xmm19},~{xmm20},~{xmm21},~{xmm22},~{xmm23},~{xmm24},~{xmm25},~{xmm26},~{xmm27},~{xmm28},~{xmm29},~{xmm30},~{xmm31},~{k1},~{k2},~{k3},~{k4},~{k5},~{k6},~{k7},~{st},~{st(1)},~{st(2)},~{st(3)},~{st(4)},~{st(5)},~{st(6)},~{st(7)},~{dirflag},~{fpsr},~{flags},~{memory}"}, {"sha": "2ef10a2837d22621a755662122adc7ddb3de97a3", "filename": "src/test/codegen/asm-clobbers.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-clobbers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-clobbers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-clobbers.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,8 @@\n // only-x86_64\n \n #![crate_type = \"rlib\"]\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n // CHECK-LABEL: @x87_clobber\n // CHECK: ~{st},~{st(1)},~{st(2)},~{st(3)},~{st(4)},~{st(5)},~{st(6)},~{st(7)}"}, {"sha": "3b34d79c3a946a1b18017bceb48fccc8ed0566be", "filename": "src/test/codegen/asm-may_unwind.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-may_unwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-may_unwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-may_unwind.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,9 @@\n // only-x86_64\n \n #![crate_type = \"rlib\"]\n-#![feature(asm, asm_unwind)]\n+#![feature(asm_unwind)]\n+\n+use std::arch::asm;\n \n #[no_mangle]\n pub extern \"C\" fn panicky() {}"}, {"sha": "1ae37d627d67147700c392f5906f5117a866a165", "filename": "src/test/codegen/asm-multiple-options.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-multiple-options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-multiple-options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-multiple-options.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,8 @@\n // only-x86_64\n \n #![crate_type = \"rlib\"]\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n // CHECK-LABEL: @pure\n // CHECK-NOT: asm"}, {"sha": "963b60cfe35b706b9c34baf64f3e61f2ceac3941", "filename": "src/test/codegen/asm-options.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-options.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,8 @@\n // only-x86_64\n \n #![crate_type = \"rlib\"]\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n // CHECK-LABEL: @pure\n // CHECK-NOT: asm"}, {"sha": "8845cfbe76792a0e0a25c7b21d0b5188607c61e0", "filename": "src/test/codegen/asm-target-clobbers.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-target-clobbers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fasm-target-clobbers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-target-clobbers.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,8 @@\n // [avx512]compile-flags: -C target-feature=+avx512f\n \n #![crate_type = \"rlib\"]\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n // CHECK-LABEL: @avx512_clobber\n // base: call void asm sideeffect inteldialect \"\", \"~{xmm31}\"()"}, {"sha": "fab84868fdfbbb9529db73b9e464a889db1000a0", "filename": "src/test/codegen/global_asm.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fglobal_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fglobal_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fglobal_asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -39,18 +39,21 @@\n // ignore-emscripten\n // compile-flags: -C no-prepopulate-passes\n \n-#![feature(global_asm)]\n #![crate_type = \"lib\"]\n \n+use std::arch::global_asm;\n+\n // CHECK-LABEL: foo\n // CHECK: module asm\n // this regex will capture the correct unconditional branch inst.\n // CHECK: module asm \"{{[[:space:]]+}}jmp baz\"\n-global_asm!(r#\"\n+global_asm!(\n+    r#\"\n     .global foo\n foo:\n     jmp baz\n-\"#);\n+\"#\n+);\n \n extern \"C\" {\n     fn foo();"}, {"sha": "02ee916458f4ad1dcc91de2b3d2f17ff1fb1cf17", "filename": "src/test/codegen/global_asm_include.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fglobal_asm_include.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fglobal_asm_include.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fglobal_asm_include.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -39,9 +39,10 @@\n // ignore-emscripten\n // compile-flags: -C no-prepopulate-passes\n \n-#![feature(global_asm)]\n #![crate_type = \"lib\"]\n \n+use std::arch::global_asm;\n+\n // CHECK-LABEL: foo\n // CHECK: module asm\n // CHECK: module asm \"{{[[:space:]]+}}jmp baz\""}, {"sha": "bdcf0ea843c4c53012bcd21214d98db804983f2a", "filename": "src/test/codegen/global_asm_x2.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fglobal_asm_x2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fglobal_asm_x2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fglobal_asm_x2.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -39,21 +39,24 @@\n // ignore-emscripten\n // compile-flags: -C no-prepopulate-passes\n \n-#![feature(global_asm)]\n #![crate_type = \"lib\"]\n-#[no_std]\n+#![no_std]\n+\n+use core::arch::global_asm;\n \n // CHECK-LABEL: foo\n // CHECK: module asm\n // CHECK: module asm \"{{[[:space:]]+}}jmp baz\"\n // any other global_asm will be appended to this first block, so:\n // CHECK-LABEL: bar\n // CHECK: module asm \"{{[[:space:]]+}}jmp quux\"\n-global_asm!(r#\"\n+global_asm!(\n+    r#\"\n     .global foo\n foo:\n     jmp baz\n-\"#);\n+\"#\n+);\n \n extern \"C\" {\n     fn foo();\n@@ -64,11 +67,13 @@ extern \"C\" {\n pub unsafe extern \"C\" fn baz() {}\n \n // no checks here; this has been appended to the first occurrence\n-global_asm!(r#\"\n+global_asm!(\n+    r#\"\n     .global bar\n bar:\n     jmp quux\n-\"#);\n+\"#\n+);\n \n extern \"C\" {\n     fn bar();"}, {"sha": "e34ccf5c5fe99e9fe3e584db3ee7318c1c9712e4", "filename": "src/test/codegen/naked-noinline.rs", "status": "modified", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fnaked-noinline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fcodegen%2Fnaked-noinline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fnaked-noinline.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,28 +3,29 @@\n // needs-asm-support\n // ignore-wasm32\n #![crate_type = \"lib\"]\n-#![feature(asm)]\n #![feature(naked_functions)]\n \n+use std::arch::asm;\n+\n #[inline(always)]\n #[naked]\n #[no_mangle]\n pub unsafe extern \"C\" fn f() {\n-// Check that f has naked and noinline attributes.\n-//\n-// CHECK:       define void @f() unnamed_addr [[ATTR:#[0-9]+]]\n-// CHECK-NEXT:  start:\n-// CHECK-NEXT:    call void asm\n+    // Check that f has naked and noinline attributes.\n+    //\n+    // CHECK:       define void @f() unnamed_addr [[ATTR:#[0-9]+]]\n+    // CHECK-NEXT:  start:\n+    // CHECK-NEXT:    call void asm\n     asm!(\"\", options(noreturn));\n }\n \n #[no_mangle]\n pub unsafe fn g() {\n-// Check that call to f is not inlined.\n-//\n-// CHECK-LABEL: define void @g()\n-// CHECK-NEXT:  start:\n-// CHECK-NEXT:    call void @f()\n+    // Check that call to f is not inlined.\n+    //\n+    // CHECK-LABEL: define void @g()\n+    // CHECK-NEXT:  start:\n+    // CHECK-NEXT:    call void @f()\n     f();\n }\n "}, {"sha": "be624faad04b1a324ae415628e6bf3bdad43b35b", "filename": "src/test/incremental/issue-72386.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fincremental%2Fissue-72386.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fincremental%2Fissue-72386.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental%2Fissue-72386.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -4,13 +4,11 @@\n // Checks that we don't ICE when switching to an invalid register\n // and back again\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n #[cfg(any(rpass1, rpass3))]\n fn main() {\n-    unsafe {\n-        asm!(\"nop\")\n-    }\n+    unsafe { asm!(\"nop\") }\n }\n \n #[cfg(cfail1)]"}, {"sha": "5eade2933b82cc292b843a6b76a7691b4b9abaf5", "filename": "src/test/pretty/asm.pp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fpretty%2Fasm.pp", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fpretty%2Fasm.pp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fpretty%2Fasm.pp?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,15 +1,15 @@\n #![feature(prelude_import)]\n #![no_std]\n-#![feature(asm)]\n #[prelude_import]\n use ::std::prelude::rust_2015::*;\n #[macro_use]\n extern crate std;\n-\n // pretty-mode:expanded\n // pp-exact:asm.pp\n // only-x86_64\n \n+use std::arch::asm;\n+\n pub fn main() {\n     let a: i32;\n     let mut b = 4i32;"}, {"sha": "1a3f972c8f2e1c0de8faca89bef3c0d9ac1025e2", "filename": "src/test/pretty/asm.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fpretty%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fpretty%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fpretty%2Fasm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,9 +1,9 @@\n-#![feature(asm)]\n-\n // pretty-mode:expanded\n // pp-exact:asm.pp\n // only-x86_64\n \n+use std::arch::asm;\n+\n pub fn main() {\n     let a: i32;\n     let mut b = 4i32;\n@@ -20,8 +20,10 @@ pub fn main() {\n         asm!(\"inst1 {}, 42\", \"inst2 {}, 24\", in(reg) a, out(reg) b);\n         asm!(\"inst2 {1}, 24\", \"inst1 {0}, 42\", in(reg) a, out(reg) b);\n         asm!(\"inst1 {}, 42\", \"inst2 {name}, 24\", in(reg) a, name = out(reg) b);\n-        asm!(\"inst1\n-inst2\");\n+        asm!(\n+            \"inst1\n+inst2\"\n+        );\n         asm!(\"inst1\\ninst2\");\n         asm!(\"inst1\\n\\tinst2\");\n         asm!(\"inst1\\ninst2\", \"inst3\\ninst4\");"}, {"sha": "cde38aacf7f3633f1d74f8d3e95d2f9b4d084967", "filename": "src/test/run-make/x86_64-fortanix-unknown-sgx-lvi/enclave/src/main.rs", "status": "modified", "additions": 34, "deletions": 33, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fsrc%2Fmain.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,48 +1,49 @@\n-#![feature(global_asm)]\n-\n-global_asm!( r#\"\n+std::arch::global_asm!(\n+    r#\"\n     .text\n     .global rust_plus_one_global_asm\n     .type rust_plus_one_global_asm, @function\n rust_plus_one_global_asm:\n     movl (%rdi), %eax\n     inc %eax\n     retq\n-\"#, options(att_syntax));\n+\"#,\n+    options(att_syntax)\n+);\n \n-extern {\n-    fn cc_plus_one_c(arg : &u32) -> u32;\n-    fn cc_plus_one_c_asm(arg : &u32) -> u32;\n-    fn cc_plus_one_cxx(arg : &u32) -> u32;\n-    fn cc_plus_one_cxx_asm(arg : &u32) -> u32;\n-    fn cc_plus_one_asm(arg : &u32) -> u32;\n-    fn cmake_plus_one_c(arg : &u32) -> u32;\n-    fn cmake_plus_one_c_asm(arg : &u32) -> u32;\n-    fn cmake_plus_one_cxx(arg : &u32) -> u32;\n-    fn cmake_plus_one_cxx_asm(arg : &u32) -> u32;\n-    fn cmake_plus_one_c_global_asm(arg : &u32) -> u32;\n-    fn cmake_plus_one_cxx_global_asm(arg : &u32) -> u32;\n-    fn cmake_plus_one_asm(arg : &u32) -> u32;\n-    fn rust_plus_one_global_asm(arg : &u32) -> u32;\n+extern \"C\" {\n+    fn cc_plus_one_c(arg: &u32) -> u32;\n+    fn cc_plus_one_c_asm(arg: &u32) -> u32;\n+    fn cc_plus_one_cxx(arg: &u32) -> u32;\n+    fn cc_plus_one_cxx_asm(arg: &u32) -> u32;\n+    fn cc_plus_one_asm(arg: &u32) -> u32;\n+    fn cmake_plus_one_c(arg: &u32) -> u32;\n+    fn cmake_plus_one_c_asm(arg: &u32) -> u32;\n+    fn cmake_plus_one_cxx(arg: &u32) -> u32;\n+    fn cmake_plus_one_cxx_asm(arg: &u32) -> u32;\n+    fn cmake_plus_one_c_global_asm(arg: &u32) -> u32;\n+    fn cmake_plus_one_cxx_global_asm(arg: &u32) -> u32;\n+    fn cmake_plus_one_asm(arg: &u32) -> u32;\n+    fn rust_plus_one_global_asm(arg: &u32) -> u32;\n }\n \n fn main() {\n-    let value : u32 = 41;\n+    let value: u32 = 41;\n     let question = \"Answer to the Ultimate Question of Life, the Universe, and Everything:\";\n \n-    unsafe{\n-        println!(\"{}: {}!\", question,rust_plus_one_global_asm(&value));\n-        println!(\"{}: {}!\", question,cc_plus_one_c(&value));\n-        println!(\"{}: {}!\", question,cc_plus_one_c_asm(&value));\n-        println!(\"{}: {}!\", question,cc_plus_one_cxx(&value));\n-        println!(\"{}: {}!\", question,cc_plus_one_cxx_asm(&value));\n-        println!(\"{}: {}!\", question,cc_plus_one_asm(&value));\n-        println!(\"{}: {}!\", question,cmake_plus_one_c(&value));\n-        println!(\"{}: {}!\", question,cmake_plus_one_c_asm(&value));\n-        println!(\"{}: {}!\", question,cmake_plus_one_cxx(&value));\n-        println!(\"{}: {}!\", question,cmake_plus_one_cxx_asm(&value));\n-        println!(\"{}: {}!\", question,cmake_plus_one_c_global_asm(&value));\n-        println!(\"{}: {}!\", question,cmake_plus_one_cxx_global_asm(&value));\n-        println!(\"{}: {}!\", question,cmake_plus_one_asm(&value));\n+    unsafe {\n+        println!(\"{}: {}!\", question, rust_plus_one_global_asm(&value));\n+        println!(\"{}: {}!\", question, cc_plus_one_c(&value));\n+        println!(\"{}: {}!\", question, cc_plus_one_c_asm(&value));\n+        println!(\"{}: {}!\", question, cc_plus_one_cxx(&value));\n+        println!(\"{}: {}!\", question, cc_plus_one_cxx_asm(&value));\n+        println!(\"{}: {}!\", question, cc_plus_one_asm(&value));\n+        println!(\"{}: {}!\", question, cmake_plus_one_c(&value));\n+        println!(\"{}: {}!\", question, cmake_plus_one_c_asm(&value));\n+        println!(\"{}: {}!\", question, cmake_plus_one_cxx(&value));\n+        println!(\"{}: {}!\", question, cmake_plus_one_cxx_asm(&value));\n+        println!(\"{}: {}!\", question, cmake_plus_one_c_global_asm(&value));\n+        println!(\"{}: {}!\", question, cmake_plus_one_cxx_global_asm(&value));\n+        println!(\"{}: {}!\", question, cmake_plus_one_asm(&value));\n     }\n }"}, {"sha": "d7550ca5aca311ec9b84981826eaca4950219306", "filename": "src/test/rustdoc/asm-foreign.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Frustdoc%2Fasm-foreign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Frustdoc%2Fasm-foreign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fasm-foreign.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // Make sure rustdoc accepts asm! for a foreign architecture.\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n // @has asm_foreign/fn.aarch64.html\n pub unsafe fn aarch64(a: f64, b: f64) -> f64 {"}, {"sha": "87306901eb77fb1e11ba81dfe3fcf3f39a61f554", "filename": "src/test/rustdoc/asm-foreign2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Frustdoc%2Fasm-foreign2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Frustdoc%2Fasm-foreign2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fasm-foreign2.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,7 @@\n // only-aarch64\n // Make sure rustdoc accepts options(att_syntax) asm! on non-x86 targets.\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n // @has asm_foreign2/fn.x86.html\n pub unsafe fn x86(x: i64) -> i64 {"}, {"sha": "6172027a2fa5ab4bc4efb334b1c09e3261c35ae5", "filename": "src/test/ui/asm/aarch64/bad-options.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-options.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // only-aarch64\n \n-#![feature(asm, global_asm)]\n+use std::arch::{asm, global_asm};\n \n fn main() {\n     let mut foo = 0;"}, {"sha": "8619b3960a6408f22aca5016c0c2d952528426f6", "filename": "src/test/ui/asm/aarch64/bad-reg.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-reg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-reg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-reg.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,9 @@\n // only-aarch64\n // compile-flags: -C target-feature=+fp\n \n-#![feature(asm, asm_const, asm_sym)]\n+#![feature(asm_const, asm_sym)]\n+\n+use std::arch::asm;\n \n fn main() {\n     let mut foo = 0;"}, {"sha": "73512dcc44674a2187eff2d3fa5e1283bb69cdf8", "filename": "src/test/ui/asm/aarch64/const.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fconst.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fconst.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fconst.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,9 @@\n // revisions: mirunsafeck thirunsafeck\n // [thirunsafeck]compile-flags: -Z thir-unsafeck\n \n-#![feature(asm, global_asm, asm_const)]\n+#![feature(asm_const)]\n+\n+use std::arch::{asm, global_asm};\n \n fn const_generic<const X: usize>() -> usize {\n     unsafe {"}, {"sha": "7cc378e34d8fa5c0d9a4d2bf97e741c0c3cc0d66", "filename": "src/test/ui/asm/aarch64/duplicate-options.fixed", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fduplicate-options.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fduplicate-options.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fduplicate-options.fixed?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,8 +1,6 @@\n // only-aarch64\n // run-rustfix\n \n-#![feature(asm, global_asm)]\n-\n fn main() {\n     unsafe {\n         asm!(\"\", options(nomem, ));"}, {"sha": "bd1f15701368741b2257e711cea13f649ed72cd7", "filename": "src/test/ui/asm/aarch64/duplicate-options.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fduplicate-options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fduplicate-options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fduplicate-options.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,7 @@\n // only-aarch64\n // run-rustfix\n \n-#![feature(asm, global_asm)]\n+use std::arch::asm;\n \n fn main() {\n     unsafe {\n@@ -19,8 +19,8 @@ fn main() {\n             \"\",\n             options(nomem, noreturn),\n             options(preserves_flags, noreturn), //~ ERROR the `noreturn` option was already provided\n-            options(nomem, nostack), //~ ERROR the `nomem` option was already provided\n-            options(noreturn), //~ ERROR the `noreturn` option was already provided\n+            options(nomem, nostack),            //~ ERROR the `nomem` option was already provided\n+            options(noreturn),                  //~ ERROR the `noreturn` option was already provided\n         );\n     }\n }"}, {"sha": "ece62ce3930e6629c31302ee8fd41a597bc58d91", "filename": "src/test/ui/asm/aarch64/interpolated-idents.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Finterpolated-idents.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Finterpolated-idents.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Finterpolated-idents.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // only-aarch64\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n macro_rules! m {\n     ($in:ident $out:ident $lateout:ident $inout:ident $inlateout:ident $const:ident $sym:ident"}, {"sha": "ac8cc62027e4aa403ac7aacfd952466bb574661c", "filename": "src/test/ui/asm/aarch64/may_unwind.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fmay_unwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fmay_unwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fmay_unwind.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,8 +3,9 @@\n // run-pass\n // needs-asm-support\n \n-#![feature(asm, asm_sym, asm_unwind)]\n+#![feature(asm_sym, asm_unwind)]\n \n+use std::arch::asm;\n use std::panic::{catch_unwind, resume_unwind, AssertUnwindSafe};\n \n struct Foo<'a>(&'a mut bool);"}, {"sha": "59d6b28d0fd99bc160f4454af93f01876b70f118", "filename": "src/test/ui/asm/aarch64/parse-error.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fparse-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fparse-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fparse-error.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,8 @@\n // only-aarch64\n \n-#![feature(asm, global_asm, asm_const)]\n+#![feature(asm_const)]\n+\n+use std::arch::{asm, global_asm};\n \n fn main() {\n     let mut foo = 0;"}, {"sha": "609f5e80d24089db03e0d8f7ac5ad69bc9c595ca", "filename": "src/test/ui/asm/aarch64/srcloc.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,8 @@\n // only-aarch64\n // build-fail\n // compile-flags: -Ccodegen-units=1\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n // Checks that inline asm errors are mapped to the correct line in the source code.\n "}, {"sha": "4fd31070ec79e75d2348d3903f8e14a9213a17f1", "filename": "src/test/ui/asm/aarch64/sym.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsym.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsym.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsym.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,9 @@\n // only-linux\n // run-pass\n \n-#![feature(asm, thread_local, asm_sym)]\n+#![feature(thread_local, asm_sym)]\n+\n+use std::arch::asm;\n \n extern \"C\" fn f1() -> i32 {\n     111"}, {"sha": "1b91f5d0678b4102eacadce733181d61a52909c2", "filename": "src/test/ui/asm/aarch64/type-check-2.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Ftype-check-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Ftype-check-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Ftype-check-2.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,8 @@\n // only-aarch64\n \n-#![feature(asm, repr_simd, never_type, asm_sym)]\n+#![feature(repr_simd, never_type, asm_sym)]\n+\n+use std::arch::asm;\n \n #[repr(simd)]\n #[derive(Clone, Copy)]"}, {"sha": "8cac18b805269956e474f6b33acdbe745db05a46", "filename": "src/test/ui/asm/aarch64/type-check-3.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Ftype-check-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Faarch64%2Ftype-check-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Ftype-check-3.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,9 +1,10 @@\n // only-aarch64\n // compile-flags: -C target-feature=+neon\n \n-#![feature(asm, global_asm, repr_simd, stdsimd, asm_const)]\n+#![feature(repr_simd, stdsimd, asm_const)]\n \n use std::arch::aarch64::float64x2_t;\n+use std::arch::{asm, global_asm};\n \n #[repr(simd)]\n #[derive(Copy, Clone)]"}, {"sha": "bb13816348d789ad6c25b1a9d5e426bc583dcb57", "filename": "src/test/ui/asm/issue-72570.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-72570.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-72570.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-72570.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,7 @@\n // needs-asm-support\n // Also test for #72960\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n fn main() {\n     unsafe {"}, {"sha": "5b2e636c29f2b0ea8daf6fce80df4e0e0b1bac14", "filename": "src/test/ui/asm/issue-87802.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-87802.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-87802.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-87802.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -4,7 +4,7 @@\n // ignore-wasm32\n // Make sure rustc doesn't ICE on asm! when output type is !.\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n fn hmm() -> ! {\n     let x;"}, {"sha": "05677912dff47c83c24a025d9dfdefc011dbd05a", "filename": "src/test/ui/asm/issue-89305.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-89305.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-89305.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-89305.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -4,9 +4,10 @@\n // check-pass\n // needs-asm-support\n \n-#![feature(asm)]\n #![warn(unused)]\n \n+use std::arch::asm;\n+\n fn main() {\n     unsafe {\n         let x: () = asm!(\"nop\");"}, {"sha": "7efc5102042c2d1ab1107bd22ace2a404dc10ca6", "filename": "src/test/ui/asm/issue-89305.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-89305.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fissue-89305.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-89305.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,11 +1,11 @@\n warning: unused variable: `x`\n-  --> $DIR/issue-89305.rs:12:13\n+  --> $DIR/issue-89305.rs:13:13\n    |\n LL |         let x: () = asm!(\"nop\");\n    |             ^ help: if this is intentional, prefix it with an underscore: `_x`\n    |\n note: the lint level is defined here\n-  --> $DIR/issue-89305.rs:8:9\n+  --> $DIR/issue-89305.rs:7:9\n    |\n LL | #![warn(unused)]\n    |         ^^^^^^"}, {"sha": "117c0a63aa4b943f4c8c36f90437135c5d50ddcc", "filename": "src/test/ui/asm/may_unwind.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fmay_unwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fmay_unwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fmay_unwind.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,9 @@\n // run-pass\n // needs-asm-support\n \n-#![feature(asm, asm_unwind)]\n+#![feature(asm_unwind)]\n+\n+use std::arch::asm;\n \n fn main() {\n     unsafe { asm!(\"\", options(may_unwind)) };"}, {"sha": "c8bee504d02bb3aa4373e3a9bf63f27c6145c5e3", "filename": "src/test/ui/asm/naked-functions-ffi.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-ffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-ffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-ffi.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,12 +1,15 @@\n // check-pass\n // needs-asm-support\n-#![feature(asm)]\n #![feature(naked_functions)]\n #![crate_type = \"lib\"]\n \n+use std::arch::asm;\n+\n #[naked]\n pub extern \"C\" fn naked(p: char) -> u128 {\n     //~^ WARN uses type `char`\n     //~| WARN uses type `u128`\n-    unsafe { asm!(\"\", options(noreturn)); }\n+    unsafe {\n+        asm!(\"\", options(noreturn));\n+    }\n }"}, {"sha": "ac74355131178e0b47b358685cae4d545ee43d14", "filename": "src/test/ui/asm/naked-functions-ffi.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-ffi.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-ffi.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-ffi.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,5 @@\n warning: `extern` fn uses type `char`, which is not FFI-safe\n-  --> $DIR/naked-functions-ffi.rs:8:28\n+  --> $DIR/naked-functions-ffi.rs:9:28\n    |\n LL | pub extern \"C\" fn naked(p: char) -> u128 {\n    |                            ^^^^ not FFI-safe\n@@ -9,7 +9,7 @@ LL | pub extern \"C\" fn naked(p: char) -> u128 {\n    = note: the `char` type has no C equivalent\n \n warning: `extern` fn uses type `u128`, which is not FFI-safe\n-  --> $DIR/naked-functions-ffi.rs:8:37\n+  --> $DIR/naked-functions-ffi.rs:9:37\n    |\n LL | pub extern \"C\" fn naked(p: char) -> u128 {\n    |                                     ^^^^ not FFI-safe"}, {"sha": "4360d9addf0003bebd80d8c3e776e8d1946c7ee5", "filename": "src/test/ui/asm/naked-functions-unused.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-unused.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -2,7 +2,6 @@\n //[x86_64] only-x86_64\n //[aarch64] only-aarch64\n #![deny(unused)]\n-#![feature(asm)]\n #![feature(naked_functions)]\n #![crate_type = \"lib\"]\n \n@@ -12,6 +11,8 @@ pub trait Trait {\n }\n \n pub mod normal {\n+    use std::arch::asm;\n+\n     pub extern \"C\" fn function(a: usize, b: usize) -> usize {\n         //~^ ERROR unused variable: `a`\n         //~| ERROR unused variable: `b`\n@@ -50,6 +51,8 @@ pub mod normal {\n }\n \n pub mod naked {\n+    use std::arch::asm;\n+\n     #[naked]\n     pub extern \"C\" fn function(a: usize, b: usize) -> usize {\n         unsafe { asm!(\"\", options(noreturn)); }"}, {"sha": "cf4a1d9174e3d7fdf2f9f24e841c937bf316a4d1", "filename": "src/test/ui/asm/naked-functions-unused.x86_64.stderr", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-unused.x86_64.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-unused.x86_64.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-functions-unused.x86_64.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,5 @@\n error: unused variable: `a`\n-  --> $DIR/naked-functions-unused.rs:15:32\n+  --> $DIR/naked-functions-unused.rs:16:32\n    |\n LL |     pub extern \"C\" fn function(a: usize, b: usize) -> usize {\n    |                                ^ help: if this is intentional, prefix it with an underscore: `_a`\n@@ -12,55 +12,55 @@ LL | #![deny(unused)]\n    = note: `#[deny(unused_variables)]` implied by `#[deny(unused)]`\n \n error: unused variable: `b`\n-  --> $DIR/naked-functions-unused.rs:15:42\n+  --> $DIR/naked-functions-unused.rs:16:42\n    |\n LL |     pub extern \"C\" fn function(a: usize, b: usize) -> usize {\n    |                                          ^ help: if this is intentional, prefix it with an underscore: `_b`\n \n error: unused variable: `a`\n-  --> $DIR/naked-functions-unused.rs:24:38\n+  --> $DIR/naked-functions-unused.rs:25:38\n    |\n LL |         pub extern \"C\" fn associated(a: usize, b: usize) -> usize {\n    |                                      ^ help: if this is intentional, prefix it with an underscore: `_a`\n \n error: unused variable: `b`\n-  --> $DIR/naked-functions-unused.rs:24:48\n+  --> $DIR/naked-functions-unused.rs:25:48\n    |\n LL |         pub extern \"C\" fn associated(a: usize, b: usize) -> usize {\n    |                                                ^ help: if this is intentional, prefix it with an underscore: `_b`\n \n error: unused variable: `a`\n-  --> $DIR/naked-functions-unused.rs:30:41\n+  --> $DIR/naked-functions-unused.rs:31:41\n    |\n LL |         pub extern \"C\" fn method(&self, a: usize, b: usize) -> usize {\n    |                                         ^ help: if this is intentional, prefix it with an underscore: `_a`\n \n error: unused variable: `b`\n-  --> $DIR/naked-functions-unused.rs:30:51\n+  --> $DIR/naked-functions-unused.rs:31:51\n    |\n LL |         pub extern \"C\" fn method(&self, a: usize, b: usize) -> usize {\n    |                                                   ^ help: if this is intentional, prefix it with an underscore: `_b`\n \n error: unused variable: `a`\n-  --> $DIR/naked-functions-unused.rs:38:40\n+  --> $DIR/naked-functions-unused.rs:39:40\n    |\n LL |         extern \"C\" fn trait_associated(a: usize, b: usize) -> usize {\n    |                                        ^ help: if this is intentional, prefix it with an underscore: `_a`\n \n error: unused variable: `b`\n-  --> $DIR/naked-functions-unused.rs:38:50\n+  --> $DIR/naked-functions-unused.rs:39:50\n    |\n LL |         extern \"C\" fn trait_associated(a: usize, b: usize) -> usize {\n    |                                                  ^ help: if this is intentional, prefix it with an underscore: `_b`\n \n error: unused variable: `a`\n-  --> $DIR/naked-functions-unused.rs:44:43\n+  --> $DIR/naked-functions-unused.rs:45:43\n    |\n LL |         extern \"C\" fn trait_method(&self, a: usize, b: usize) -> usize {\n    |                                           ^ help: if this is intentional, prefix it with an underscore: `_a`\n \n error: unused variable: `b`\n-  --> $DIR/naked-functions-unused.rs:44:53\n+  --> $DIR/naked-functions-unused.rs:45:53\n    |\n LL |         extern \"C\" fn trait_method(&self, a: usize, b: usize) -> usize {\n    |                                                     ^ help: if this is intentional, prefix it with an underscore: `_b`"}, {"sha": "b44204b9005655d260f372dd72ecac94c6b681ad", "filename": "src/test/ui/asm/naked-functions.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-functions.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,14 +3,15 @@\n // ignore-spirv\n // ignore-wasm32\n \n-#![feature(asm)]\n #![feature(llvm_asm)]\n #![feature(naked_functions)]\n #![feature(or_patterns)]\n #![feature(asm_const, asm_sym)]\n #![crate_type = \"lib\"]\n #![allow(deprecated)] // llvm_asm!\n \n+use std::arch::asm;\n+\n #[repr(C)]\n pub struct P {\n     x: u8,"}, {"sha": "8e177f5a52ca4004b779ed72632a297048670f55", "filename": "src/test/ui/asm/naked-functions.stderr", "status": "modified", "additions": 33, "deletions": 33, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-functions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-functions.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,43 +1,43 @@\n error: asm with the `pure` option must have at least one output\n-  --> $DIR/naked-functions.rs:135:14\n+  --> $DIR/naked-functions.rs:136:14\n    |\n LL |     asm!(\"\", options(readonly, nostack), options(pure));\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^\n \n error: patterns not allowed in naked function parameters\n-  --> $DIR/naked-functions.rs:22:5\n+  --> $DIR/naked-functions.rs:23:5\n    |\n LL |     mut a: u32,\n    |     ^^^^^\n \n error: patterns not allowed in naked function parameters\n-  --> $DIR/naked-functions.rs:24:5\n+  --> $DIR/naked-functions.rs:25:5\n    |\n LL |     &b: &i32,\n    |     ^^\n \n error: patterns not allowed in naked function parameters\n-  --> $DIR/naked-functions.rs:26:6\n+  --> $DIR/naked-functions.rs:27:6\n    |\n LL |     (None | Some(_)): Option<std::ptr::NonNull<u8>>,\n    |      ^^^^^^^^^^^^^^\n \n error: patterns not allowed in naked function parameters\n-  --> $DIR/naked-functions.rs:28:5\n+  --> $DIR/naked-functions.rs:29:5\n    |\n LL |     P { x, y }: P,\n    |     ^^^^^^^^^^\n \n error: referencing function parameters is not allowed in naked functions\n-  --> $DIR/naked-functions.rs:38:5\n+  --> $DIR/naked-functions.rs:39:5\n    |\n LL |     a + 1\n    |     ^\n    |\n    = help: follow the calling convention in asm block to use parameters\n \n warning: naked functions must contain a single asm block\n-  --> $DIR/naked-functions.rs:35:1\n+  --> $DIR/naked-functions.rs:36:1\n    |\n LL | / pub unsafe extern \"C\" fn inc(a: u32) -> u32 {\n LL | |\n@@ -53,15 +53,15 @@ LL | | }\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n error: referencing function parameters is not allowed in naked functions\n-  --> $DIR/naked-functions.rs:44:31\n+  --> $DIR/naked-functions.rs:45:31\n    |\n LL |     asm!(\"/* {0} */\", in(reg) a, options(noreturn));\n    |                               ^\n    |\n    = help: follow the calling convention in asm block to use parameters\n \n warning: only `const` and `sym` operands are supported in naked functions\n-  --> $DIR/naked-functions.rs:44:23\n+  --> $DIR/naked-functions.rs:45:23\n    |\n LL |     asm!(\"/* {0} */\", in(reg) a, options(noreturn));\n    |                       ^^^^^^^^^\n@@ -70,7 +70,7 @@ LL |     asm!(\"/* {0} */\", in(reg) a, options(noreturn));\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions must contain a single asm block\n-  --> $DIR/naked-functions.rs:51:1\n+  --> $DIR/naked-functions.rs:52:1\n    |\n LL | / pub unsafe extern \"C\" fn inc_closure(a: u32) -> u32 {\n LL | |\n@@ -84,7 +84,7 @@ LL | | }\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: only `const` and `sym` operands are supported in naked functions\n-  --> $DIR/naked-functions.rs:71:10\n+  --> $DIR/naked-functions.rs:72:10\n    |\n LL |          in(reg) a,\n    |          ^^^^^^^^^\n@@ -102,7 +102,7 @@ LL |          out(reg) e,\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: asm in naked functions must use `noreturn` option\n-  --> $DIR/naked-functions.rs:68:5\n+  --> $DIR/naked-functions.rs:69:5\n    |\n LL | /     asm!(\"/* {0} {1} {2} {3} {4} {5} {6} */\",\n LL | |\n@@ -117,7 +117,7 @@ LL | |     );\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions must contain a single asm block\n-  --> $DIR/naked-functions.rs:58:1\n+  --> $DIR/naked-functions.rs:59:1\n    |\n LL | / pub unsafe extern \"C\" fn unsupported_operands() {\n LL | |\n@@ -141,7 +141,7 @@ LL | | }\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions must contain a single asm block\n-  --> $DIR/naked-functions.rs:84:1\n+  --> $DIR/naked-functions.rs:85:1\n    |\n LL | / pub extern \"C\" fn missing_assembly() {\n LL | |\n@@ -153,7 +153,7 @@ LL | | }\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: asm in naked functions must use `noreturn` option\n-  --> $DIR/naked-functions.rs:93:5\n+  --> $DIR/naked-functions.rs:94:5\n    |\n LL |     asm!(\"\");\n    |     ^^^^^^^^\n@@ -162,7 +162,7 @@ LL |     asm!(\"\");\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: asm in naked functions must use `noreturn` option\n-  --> $DIR/naked-functions.rs:96:5\n+  --> $DIR/naked-functions.rs:97:5\n    |\n LL |     asm!(\"\");\n    |     ^^^^^^^^\n@@ -171,7 +171,7 @@ LL |     asm!(\"\");\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: asm in naked functions must use `noreturn` option\n-  --> $DIR/naked-functions.rs:99:5\n+  --> $DIR/naked-functions.rs:100:5\n    |\n LL |     asm!(\"\");\n    |     ^^^^^^^^\n@@ -180,7 +180,7 @@ LL |     asm!(\"\");\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions must contain a single asm block\n-  --> $DIR/naked-functions.rs:90:1\n+  --> $DIR/naked-functions.rs:91:1\n    |\n LL | / pub extern \"C\" fn too_many_asm_blocks() {\n LL | |\n@@ -202,15 +202,15 @@ LL | | }\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n error: referencing function parameters is not allowed in naked functions\n-  --> $DIR/naked-functions.rs:110:11\n+  --> $DIR/naked-functions.rs:111:11\n    |\n LL |         *&y\n    |           ^\n    |\n    = help: follow the calling convention in asm block to use parameters\n \n warning: naked functions must contain a single asm block\n-  --> $DIR/naked-functions.rs:107:5\n+  --> $DIR/naked-functions.rs:108:5\n    |\n LL | /     pub extern \"C\" fn inner(y: usize) -> usize {\n LL | |\n@@ -225,7 +225,7 @@ LL | |     }\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: the LLVM-style inline assembly is unsupported in naked functions\n-  --> $DIR/naked-functions.rs:120:5\n+  --> $DIR/naked-functions.rs:121:5\n    |\n LL |     llvm_asm!(\"\");\n    |     ^^^^^^^^^^^^^\n@@ -236,7 +236,7 @@ LL |     llvm_asm!(\"\");\n    = note: this warning originates in the macro `llvm_asm` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n warning: naked functions must contain a single asm block\n-  --> $DIR/naked-functions.rs:117:1\n+  --> $DIR/naked-functions.rs:118:1\n    |\n LL | / unsafe extern \"C\" fn llvm() -> ! {\n LL | |\n@@ -252,7 +252,7 @@ LL | | }\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: asm options unsupported in naked functions: `nomem`, `preserves_flags`\n-  --> $DIR/naked-functions.rs:128:5\n+  --> $DIR/naked-functions.rs:129:5\n    |\n LL |     asm!(\"\", options(nomem, preserves_flags, noreturn));\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -261,7 +261,7 @@ LL |     asm!(\"\", options(nomem, preserves_flags, noreturn));\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: asm options unsupported in naked functions: `nostack`, `pure`, `readonly`\n-  --> $DIR/naked-functions.rs:135:5\n+  --> $DIR/naked-functions.rs:136:5\n    |\n LL |     asm!(\"\", options(readonly, nostack), options(pure));\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -270,7 +270,7 @@ LL |     asm!(\"\", options(readonly, nostack), options(pure));\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: asm in naked functions must use `noreturn` option\n-  --> $DIR/naked-functions.rs:135:5\n+  --> $DIR/naked-functions.rs:136:5\n    |\n LL |     asm!(\"\", options(readonly, nostack), options(pure));\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -279,21 +279,21 @@ LL |     asm!(\"\", options(readonly, nostack), options(pure));\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: Rust ABI is unsupported in naked functions\n-  --> $DIR/naked-functions.rs:144:15\n+  --> $DIR/naked-functions.rs:145:15\n    |\n LL | pub unsafe fn default_abi() {\n    |               ^^^^^^^^^^^\n    |\n    = note: `#[warn(undefined_naked_function_abi)]` on by default\n \n warning: Rust ABI is unsupported in naked functions\n-  --> $DIR/naked-functions.rs:150:15\n+  --> $DIR/naked-functions.rs:151:15\n    |\n LL | pub unsafe fn rust_abi() {\n    |               ^^^^^^^^\n \n warning: naked functions cannot be inlined\n-  --> $DIR/naked-functions.rs:190:1\n+  --> $DIR/naked-functions.rs:191:1\n    |\n LL | #[inline]\n    | ^^^^^^^^^\n@@ -302,7 +302,7 @@ LL | #[inline]\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions cannot be inlined\n-  --> $DIR/naked-functions.rs:198:1\n+  --> $DIR/naked-functions.rs:199:1\n    |\n LL | #[inline(always)]\n    | ^^^^^^^^^^^^^^^^^\n@@ -311,7 +311,7 @@ LL | #[inline(always)]\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions cannot be inlined\n-  --> $DIR/naked-functions.rs:206:1\n+  --> $DIR/naked-functions.rs:207:1\n    |\n LL | #[inline(never)]\n    | ^^^^^^^^^^^^^^^^\n@@ -320,7 +320,7 @@ LL | #[inline(never)]\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions cannot be inlined\n-  --> $DIR/naked-functions.rs:214:1\n+  --> $DIR/naked-functions.rs:215:1\n    |\n LL | #[inline]\n    | ^^^^^^^^^\n@@ -329,7 +329,7 @@ LL | #[inline]\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions cannot be inlined\n-  --> $DIR/naked-functions.rs:217:1\n+  --> $DIR/naked-functions.rs:218:1\n    |\n LL | #[inline(always)]\n    | ^^^^^^^^^^^^^^^^^\n@@ -338,7 +338,7 @@ LL | #[inline(always)]\n    = note: for more information, see issue #32408 <https://github.com/rust-lang/rust/issues/32408>\n \n warning: naked functions cannot be inlined\n-  --> $DIR/naked-functions.rs:220:1\n+  --> $DIR/naked-functions.rs:221:1\n    |\n LL | #[inline(never)]\n    | ^^^^^^^^^^^^^^^^"}, {"sha": "ea8f560ff5d9eb1d02d0d5437a9ac3e26e13102f", "filename": "src/test/ui/asm/naked-invalid-attr.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-invalid-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-invalid-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-invalid-attr.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,10 +1,11 @@\n // Checks that #[naked] attribute can be placed on function definitions only.\n //\n // needs-asm-support\n-#![feature(asm)]\n #![feature(naked_functions)]\n #![naked] //~ ERROR should be applied to a function definition\n \n+use std::arch::asm;\n+\n extern \"C\" {\n     #[naked] //~ ERROR should be applied to a function definition\n     fn f();"}, {"sha": "58344be93346d4ba0a2a1f8c5027a257c19e8851", "filename": "src/test/ui/asm/naked-invalid-attr.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-invalid-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnaked-invalid-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnaked-invalid-attr.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,5 @@\n error: attribute should be applied to a function definition\n-  --> $DIR/naked-invalid-attr.rs:13:1\n+  --> $DIR/naked-invalid-attr.rs:14:1\n    |\n LL |   #[naked]\n    |   ^^^^^^^^\n@@ -11,29 +11,29 @@ LL | | }\n    | |_- not a function definition\n \n error: attribute should be applied to a function definition\n-  --> $DIR/naked-invalid-attr.rs:50:5\n+  --> $DIR/naked-invalid-attr.rs:51:5\n    |\n LL |     #[naked] || {};\n    |     ^^^^^^^^ ----- not a function definition\n \n error: attribute should be applied to a function definition\n-  --> $DIR/naked-invalid-attr.rs:21:5\n+  --> $DIR/naked-invalid-attr.rs:22:5\n    |\n LL |     #[naked]\n    |     ^^^^^^^^\n LL |     extern \"C\" fn invoke(&self);\n    |     ---------------------------- not a function definition\n \n error: attribute should be applied to a function definition\n-  --> $DIR/naked-invalid-attr.rs:9:5\n+  --> $DIR/naked-invalid-attr.rs:10:5\n    |\n LL |     #[naked]\n    |     ^^^^^^^^\n LL |     fn f();\n    |     ------- not a function definition\n \n error: attribute should be applied to a function definition\n-  --> $DIR/naked-invalid-attr.rs:6:1\n+  --> $DIR/naked-invalid-attr.rs:5:1\n    |\n LL | #![naked]\n    | ^^^^^^^^^"}, {"sha": "160dbf617c4f6ade89881b7f04c7edd352f0e45b", "filename": "src/test/ui/asm/named-asm-labels.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnamed-asm-labels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnamed-asm-labels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnamed-asm-labels.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -11,7 +11,9 @@\n // which causes less readable LLVM errors and in the worst cases causes ICEs\n // or segfaults based on system dependent behavior and codegen flags.\n \n-#![feature(asm, global_asm, naked_functions, asm_const)]\n+#![feature(naked_functions, asm_const)]\n+\n+use std::arch::{asm, global_asm};\n \n #[no_mangle]\n pub static FOO: usize = 42;"}, {"sha": "b8ff42d86b5646de8c8f33fb9a62eac021e10663", "filename": "src/test/ui/asm/named-asm-labels.stderr", "status": "modified", "additions": 37, "deletions": 73, "changes": 110, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnamed-asm-labels.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnamed-asm-labels.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnamed-asm-labels.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,334 +1,298 @@\n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:22:15\n+  --> $DIR/named-asm-labels.rs:24:15\n    |\n LL |         asm!(\"bar: nop\");\n    |               ^^^\n    |\n    = note: `#[deny(named_asm_labels)]` on by default\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:25:15\n+  --> $DIR/named-asm-labels.rs:27:15\n    |\n LL |         asm!(\"abcd:\");\n    |               ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:28:15\n+  --> $DIR/named-asm-labels.rs:30:15\n    |\n LL |         asm!(\"foo: bar1: nop\");\n    |               ^^^  ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:32:15\n+  --> $DIR/named-asm-labels.rs:34:15\n    |\n LL |         asm!(\"foo1: nop\", \"nop\");\n    |               ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:33:15\n+  --> $DIR/named-asm-labels.rs:35:15\n    |\n LL |         asm!(\"foo2: foo3: nop\", \"nop\");\n    |               ^^^^  ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:35:22\n+  --> $DIR/named-asm-labels.rs:37:22\n    |\n LL |         asm!(\"nop\", \"foo4: nop\");\n    |                      ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:36:15\n+  --> $DIR/named-asm-labels.rs:38:15\n    |\n LL |         asm!(\"foo5: nop\", \"foo6: nop\");\n    |               ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:36:28\n+  --> $DIR/named-asm-labels.rs:38:28\n    |\n LL |         asm!(\"foo5: nop\", \"foo6: nop\");\n    |                            ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:41:15\n+  --> $DIR/named-asm-labels.rs:43:15\n    |\n LL |         asm!(\"foo7: nop; foo8: nop\");\n    |               ^^^^       ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:43:15\n+  --> $DIR/named-asm-labels.rs:45:15\n    |\n LL |         asm!(\"foo9: nop; nop\");\n    |               ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:44:20\n+  --> $DIR/named-asm-labels.rs:46:20\n    |\n LL |         asm!(\"nop; foo10: nop\");\n    |                    ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:47:15\n+  --> $DIR/named-asm-labels.rs:49:15\n    |\n LL |         asm!(\"bar2: nop\\n bar3: nop\");\n    |               ^^^^        ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:49:15\n+  --> $DIR/named-asm-labels.rs:51:15\n    |\n LL |         asm!(\"bar4: nop\\n nop\");\n    |               ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:50:21\n+  --> $DIR/named-asm-labels.rs:52:21\n    |\n LL |         asm!(\"nop\\n bar5: nop\");\n    |                     ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:51:21\n+  --> $DIR/named-asm-labels.rs:53:21\n    |\n LL |         asm!(\"nop\\n bar6: bar7: nop\");\n    |                     ^^^^  ^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:57:13\n+  --> $DIR/named-asm-labels.rs:59:13\n    |\n LL |             blah2: nop\n    |             ^^^^^\n LL |             blah3: nop\n    |             ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:66:19\n+  --> $DIR/named-asm-labels.rs:68:19\n    |\n LL |             nop ; blah4: nop\n    |                   ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:80:15\n+  --> $DIR/named-asm-labels.rs:82:15\n    |\n LL |         asm!(\"blah1: 2bar: nop\");\n    |               ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:83:15\n+  --> $DIR/named-asm-labels.rs:85:15\n    |\n LL |         asm!(\"def: def: nop\");\n    |               ^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:84:15\n+  --> $DIR/named-asm-labels.rs:86:15\n    |\n LL |         asm!(\"def: nop\\ndef: nop\");\n    |               ^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:85:15\n+  --> $DIR/named-asm-labels.rs:87:15\n    |\n LL |         asm!(\"def: nop; def: nop\");\n    |               ^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:93:15\n+  --> $DIR/named-asm-labels.rs:95:15\n    |\n LL |         asm!(\"fooo\\u{003A} nop\");\n    |               ^^^^^^^^^^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:94:15\n+  --> $DIR/named-asm-labels.rs:96:15\n    |\n LL |         asm!(\"foooo\\x3A nop\");\n    |               ^^^^^^^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:97:15\n+  --> $DIR/named-asm-labels.rs:99:15\n    |\n LL |         asm!(\"fooooo:\\u{000A} nop\");\n    |               ^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:98:15\n+  --> $DIR/named-asm-labels.rs:100:15\n    |\n LL |         asm!(\"foooooo:\\x0A nop\");\n    |               ^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:102:14\n+  --> $DIR/named-asm-labels.rs:104:14\n    |\n LL |         asm!(\"\\x41\\x42\\x43\\x3A\\x20\\x6E\\x6F\\x70\");\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:110:13\n+  --> $DIR/named-asm-labels.rs:112:13\n    |\n LL |             ab: nop // ab: does foo\n    |             ^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:122:14\n+  --> $DIR/named-asm-labels.rs:124:14\n    |\n LL |         asm!(include_str!(\"named-asm-labels.s\"));\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n warning: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:132:19\n+  --> $DIR/named-asm-labels.rs:134:19\n    |\n LL |             asm!(\"warned: nop\");\n    |                   ^^^^^^\n    |\n note: the lint level is defined here\n-  --> $DIR/named-asm-labels.rs:130:16\n+  --> $DIR/named-asm-labels.rs:132:16\n    |\n LL |         #[warn(named_asm_labels)]\n    |                ^^^^^^^^^^^^^^^^\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:141:20\n+  --> $DIR/named-asm-labels.rs:143:20\n    |\n LL |     unsafe { asm!(\".Lfoo: mov rax, {}; ret;\", \"nop\", const 1, options(noreturn)) }\n    |                    ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:147:20\n+  --> $DIR/named-asm-labels.rs:149:20\n    |\n LL |     unsafe { asm!(\".Lbar: mov rax, {}; ret;\", \"nop\", const 1, options(noreturn)) }\n    |                    ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:155:20\n+  --> $DIR/named-asm-labels.rs:157:20\n    |\n LL |     unsafe { asm!(\".Laaa: nop; ret;\", options(noreturn)) }\n    |                    ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:165:24\n+  --> $DIR/named-asm-labels.rs:167:24\n    |\n LL |         unsafe { asm!(\".Lbbb: nop; ret;\", options(noreturn)) }\n    |                        ^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:174:15\n+  --> $DIR/named-asm-labels.rs:176:15\n    |\n LL |         asm!(\"closure1: nop\");\n    |               ^^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:178:15\n+  --> $DIR/named-asm-labels.rs:180:15\n    |\n LL |         asm!(\"closure2: nop\");\n    |               ^^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: avoid using named labels in inline assembly\n-  --> $DIR/named-asm-labels.rs:188:19\n+  --> $DIR/named-asm-labels.rs:190:19\n    |\n LL |             asm!(\"closure3: nop\");\n    |                   ^^^^^^^^\n    |\n    = help: only local labels of the form `<number>:` should be used in inline asm\n-   = note: see the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: aborting due to 35 previous errors; 1 warning emitted\n "}, {"sha": "03fa087ae3766c533ce55014cf6db174777d78b2", "filename": "src/test/ui/asm/noreturn.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnoreturn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fnoreturn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnoreturn.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,9 +1,11 @@\n // needs-asm-support\n // check-pass\n \n-#![feature(asm, never_type)]\n+#![feature(never_type)]\n #![crate_type = \"rlib\"]\n \n+use std::arch::asm;\n+\n pub unsafe fn asm1() {\n     let _: () = asm!(\"\");\n }"}, {"sha": "695fd27efd4e3216a0f9d2da30eafc1c1441bd52", "filename": "src/test/ui/asm/type-check-1.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Ftype-check-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Ftype-check-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Ftype-check-1.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,9 @@\n // ignore-spirv\n // ignore-wasm32\n \n-#![feature(asm, global_asm, asm_const)]\n+#![feature(asm_const)]\n+\n+use std::arch::{asm, global_asm};\n \n fn main() {\n     unsafe {"}, {"sha": "d774c78ca9a721974a6e9c65da25f2979f156b9f", "filename": "src/test/ui/asm/type-check-1.stderr", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Ftype-check-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Ftype-check-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Ftype-check-1.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,5 @@\n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/type-check-1.rs:37:26\n+  --> $DIR/type-check-1.rs:39:26\n    |\n LL |         let x = 0;\n    |         ----- help: consider using `const` instead of `let`: `const x`\n@@ -8,7 +8,7 @@ LL |         asm!(\"{}\", const x);\n    |                          ^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/type-check-1.rs:40:36\n+  --> $DIR/type-check-1.rs:42:36\n    |\n LL |         let x = 0;\n    |         ----- help: consider using `const` instead of `let`: `const x`\n@@ -17,7 +17,7 @@ LL |         asm!(\"{}\", const const_foo(x));\n    |                                    ^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/type-check-1.rs:43:36\n+  --> $DIR/type-check-1.rs:45:36\n    |\n LL |         let x = 0;\n    |         ----- help: consider using `const` instead of `let`: `const x`\n@@ -26,13 +26,13 @@ LL |         asm!(\"{}\", const const_bar(x));\n    |                                    ^ non-constant value\n \n error[E0308]: mismatched types\n-  --> $DIR/type-check-1.rs:51:26\n+  --> $DIR/type-check-1.rs:53:26\n    |\n LL |         asm!(\"{}\", const 0f32);\n    |                          ^^^^ expected integer, found `f32`\n \n error[E0308]: mismatched types\n-  --> $DIR/type-check-1.rs:53:26\n+  --> $DIR/type-check-1.rs:55:26\n    |\n LL |         asm!(\"{}\", const 0 as *mut u8);\n    |                          ^^^^^^^^^^^^ expected integer, found *-ptr\n@@ -41,7 +41,7 @@ LL |         asm!(\"{}\", const 0 as *mut u8);\n            found raw pointer `*mut u8`\n \n error[E0308]: mismatched types\n-  --> $DIR/type-check-1.rs:55:26\n+  --> $DIR/type-check-1.rs:57:26\n    |\n LL |         asm!(\"{}\", const &0);\n    |                          ^^ expected integer, found `&{integer}`\n@@ -53,19 +53,19 @@ LL +         asm!(\"{}\", const 0);\n    | \n \n error: invalid asm output\n-  --> $DIR/type-check-1.rs:13:29\n+  --> $DIR/type-check-1.rs:15:29\n    |\n LL |         asm!(\"{}\", out(reg) 1 + 2);\n    |                             ^^^^^ cannot assign to this expression\n \n error: invalid asm output\n-  --> $DIR/type-check-1.rs:15:31\n+  --> $DIR/type-check-1.rs:17:31\n    |\n LL |         asm!(\"{}\", inout(reg) 1 + 2);\n    |                               ^^^^^ cannot assign to this expression\n \n error[E0277]: the size for values of type `[u64]` cannot be known at compilation time\n-  --> $DIR/type-check-1.rs:21:28\n+  --> $DIR/type-check-1.rs:23:28\n    |\n LL |         asm!(\"{}\", in(reg) v[..]);\n    |                            ^^^^^ doesn't have a size known at compile-time\n@@ -74,7 +74,7 @@ LL |         asm!(\"{}\", in(reg) v[..]);\n    = note: all inline asm arguments must have a statically known size\n \n error[E0277]: the size for values of type `[u64]` cannot be known at compilation time\n-  --> $DIR/type-check-1.rs:23:29\n+  --> $DIR/type-check-1.rs:25:29\n    |\n LL |         asm!(\"{}\", out(reg) v[..]);\n    |                             ^^^^^ doesn't have a size known at compile-time\n@@ -83,7 +83,7 @@ LL |         asm!(\"{}\", out(reg) v[..]);\n    = note: all inline asm arguments must have a statically known size\n \n error[E0277]: the size for values of type `[u64]` cannot be known at compilation time\n-  --> $DIR/type-check-1.rs:25:31\n+  --> $DIR/type-check-1.rs:27:31\n    |\n LL |         asm!(\"{}\", inout(reg) v[..]);\n    |                               ^^^^^ doesn't have a size known at compile-time\n@@ -92,13 +92,13 @@ LL |         asm!(\"{}\", inout(reg) v[..]);\n    = note: all inline asm arguments must have a statically known size\n \n error[E0308]: mismatched types\n-  --> $DIR/type-check-1.rs:65:25\n+  --> $DIR/type-check-1.rs:67:25\n    |\n LL | global_asm!(\"{}\", const 0f32);\n    |                         ^^^^ expected integer, found `f32`\n \n error[E0308]: mismatched types\n-  --> $DIR/type-check-1.rs:67:25\n+  --> $DIR/type-check-1.rs:69:25\n    |\n LL | global_asm!(\"{}\", const 0 as *mut u8);\n    |                         ^^^^^^^^^^^^ expected integer, found *-ptr"}, {"sha": "666d2c677834bff870bbfb0d29899074f270f4d4", "filename": "src/test/ui/asm/type-check-4.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Ftype-check-4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Ftype-check-4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Ftype-check-4.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,7 @@\n // ignore-spirv\n // ignore-wasm32\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n fn main() {\n     unsafe {"}, {"sha": "ddcd2065bfedfcd8b6d5d7add47ca9ca1278db2a", "filename": "src/test/ui/asm/x86_64/bad-clobber-abi.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-clobber-abi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-clobber-abi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-clobber-abi.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,9 +1,9 @@\n // needs-asm-support\n // only-x86_64\n \n-// checks various modes of failure for the `clobber_abi` argument (after parsing)\n+use std::arch::asm;\n \n-#![feature(asm)]\n+// checks various modes of failure for the `clobber_abi` argument (after parsing)\n \n fn main() {\n     unsafe {"}, {"sha": "f7c2cd6c5056a7623d87b2bb2c465cae5270e372", "filename": "src/test/ui/asm/x86_64/bad-options.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-options.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // only-x86_64\n \n-#![feature(asm, global_asm)]\n+use std::arch::{asm, global_asm};\n \n fn main() {\n     let mut foo = 0;"}, {"sha": "257274b0bc318294b7e39b805d8bc7c09d638289", "filename": "src/test/ui/asm/x86_64/bad-reg.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-reg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-reg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-reg.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,9 @@\n // only-x86_64\n // compile-flags: -C target-feature=+avx2\n \n-#![feature(asm, asm_const, asm_sym)]\n+#![feature(asm_const, asm_sym)]\n+\n+use std::arch::asm;\n \n fn main() {\n     let mut foo = 0;"}, {"sha": "3a89b2fdb74dd8f9cf73e82dfb7b587110869bdb", "filename": "src/test/ui/asm/x86_64/bad-reg.stderr", "status": "modified", "additions": 23, "deletions": 23, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-reg.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-reg.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-reg.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,17 +1,17 @@\n error: invalid register class `foo`: unknown register class\n-  --> $DIR/bad-reg.rs:12:20\n+  --> $DIR/bad-reg.rs:14:20\n    |\n LL |         asm!(\"{}\", in(foo) foo);\n    |                    ^^^^^^^^^^^\n \n error: invalid register `foo`: unknown register\n-  --> $DIR/bad-reg.rs:14:18\n+  --> $DIR/bad-reg.rs:16:18\n    |\n LL |         asm!(\"\", in(\"foo\") foo);\n    |                  ^^^^^^^^^^^^^\n \n error: invalid asm template modifier for this register class\n-  --> $DIR/bad-reg.rs:16:15\n+  --> $DIR/bad-reg.rs:18:15\n    |\n LL |         asm!(\"{:z}\", in(reg) foo);\n    |               ^^^^   ----------- argument\n@@ -21,7 +21,7 @@ LL |         asm!(\"{:z}\", in(reg) foo);\n    = note: the `reg` register class supports the following template modifiers: `l`, `x`, `e`, `r`\n \n error: invalid asm template modifier for this register class\n-  --> $DIR/bad-reg.rs:18:15\n+  --> $DIR/bad-reg.rs:20:15\n    |\n LL |         asm!(\"{:r}\", in(xmm_reg) foo);\n    |               ^^^^   --------------- argument\n@@ -31,127 +31,127 @@ LL |         asm!(\"{:r}\", in(xmm_reg) foo);\n    = note: the `xmm_reg` register class supports the following template modifiers: `x`, `y`, `z`\n \n error: asm template modifiers are not allowed for `const` arguments\n-  --> $DIR/bad-reg.rs:20:15\n+  --> $DIR/bad-reg.rs:22:15\n    |\n LL |         asm!(\"{:a}\", const 0);\n    |               ^^^^   ------- argument\n    |               |\n    |               template modifier\n \n error: asm template modifiers are not allowed for `sym` arguments\n-  --> $DIR/bad-reg.rs:22:15\n+  --> $DIR/bad-reg.rs:24:15\n    |\n LL |         asm!(\"{:a}\", sym main);\n    |               ^^^^   -------- argument\n    |               |\n    |               template modifier\n \n error: invalid register `ebp`: the frame pointer cannot be used as an operand for inline asm\n-  --> $DIR/bad-reg.rs:24:18\n+  --> $DIR/bad-reg.rs:26:18\n    |\n LL |         asm!(\"\", in(\"ebp\") foo);\n    |                  ^^^^^^^^^^^^^\n \n error: invalid register `rsp`: the stack pointer cannot be used as an operand for inline asm\n-  --> $DIR/bad-reg.rs:26:18\n+  --> $DIR/bad-reg.rs:28:18\n    |\n LL |         asm!(\"\", in(\"rsp\") foo);\n    |                  ^^^^^^^^^^^^^\n \n error: invalid register `ip`: the instruction pointer cannot be used as an operand for inline asm\n-  --> $DIR/bad-reg.rs:28:18\n+  --> $DIR/bad-reg.rs:30:18\n    |\n LL |         asm!(\"\", in(\"ip\") foo);\n    |                  ^^^^^^^^^^^^\n \n error: invalid register `k0`: the k0 AVX mask register cannot be used as an operand for inline asm\n-  --> $DIR/bad-reg.rs:30:18\n+  --> $DIR/bad-reg.rs:32:18\n    |\n LL |         asm!(\"\", in(\"k0\") foo);\n    |                  ^^^^^^^^^^^^\n \n error: invalid register `ah`: high byte registers cannot be used as an operand on x86_64\n-  --> $DIR/bad-reg.rs:32:18\n+  --> $DIR/bad-reg.rs:34:18\n    |\n LL |         asm!(\"\", in(\"ah\") foo);\n    |                  ^^^^^^^^^^^^\n \n error: register class `x87_reg` can only be used as a clobber, not as an input or output\n-  --> $DIR/bad-reg.rs:35:18\n+  --> $DIR/bad-reg.rs:37:18\n    |\n LL |         asm!(\"\", in(\"st(2)\") foo);\n    |                  ^^^^^^^^^^^^^^^\n \n error: register class `mmx_reg` can only be used as a clobber, not as an input or output\n-  --> $DIR/bad-reg.rs:37:18\n+  --> $DIR/bad-reg.rs:39:18\n    |\n LL |         asm!(\"\", in(\"mm0\") foo);\n    |                  ^^^^^^^^^^^^^\n \n error: register class `x87_reg` can only be used as a clobber, not as an input or output\n-  --> $DIR/bad-reg.rs:41:20\n+  --> $DIR/bad-reg.rs:43:20\n    |\n LL |         asm!(\"{}\", in(x87_reg) foo);\n    |                    ^^^^^^^^^^^^^^^\n \n error: register class `mmx_reg` can only be used as a clobber, not as an input or output\n-  --> $DIR/bad-reg.rs:43:20\n+  --> $DIR/bad-reg.rs:45:20\n    |\n LL |         asm!(\"{}\", in(mmx_reg) foo);\n    |                    ^^^^^^^^^^^^^^^\n \n error: register class `x87_reg` can only be used as a clobber, not as an input or output\n-  --> $DIR/bad-reg.rs:45:20\n+  --> $DIR/bad-reg.rs:47:20\n    |\n LL |         asm!(\"{}\", out(x87_reg) _);\n    |                    ^^^^^^^^^^^^^^\n \n error: register class `mmx_reg` can only be used as a clobber, not as an input or output\n-  --> $DIR/bad-reg.rs:47:20\n+  --> $DIR/bad-reg.rs:49:20\n    |\n LL |         asm!(\"{}\", out(mmx_reg) _);\n    |                    ^^^^^^^^^^^^^^\n \n error: register `al` conflicts with register `ax`\n-  --> $DIR/bad-reg.rs:53:33\n+  --> $DIR/bad-reg.rs:55:33\n    |\n LL |         asm!(\"\", in(\"eax\") foo, in(\"al\") bar);\n    |                  -------------  ^^^^^^^^^^^^ register `al`\n    |                  |\n    |                  register `ax`\n \n error: register `ax` conflicts with register `ax`\n-  --> $DIR/bad-reg.rs:55:33\n+  --> $DIR/bad-reg.rs:57:33\n    |\n LL |         asm!(\"\", in(\"rax\") foo, out(\"rax\") bar);\n    |                  -------------  ^^^^^^^^^^^^^^ register `ax`\n    |                  |\n    |                  register `ax`\n    |\n help: use `lateout` instead of `out` to avoid conflict\n-  --> $DIR/bad-reg.rs:55:18\n+  --> $DIR/bad-reg.rs:57:18\n    |\n LL |         asm!(\"\", in(\"rax\") foo, out(\"rax\") bar);\n    |                  ^^^^^^^^^^^^^\n \n error: register `ymm0` conflicts with register `xmm0`\n-  --> $DIR/bad-reg.rs:58:34\n+  --> $DIR/bad-reg.rs:60:34\n    |\n LL |         asm!(\"\", in(\"xmm0\") foo, in(\"ymm0\") bar);\n    |                  --------------  ^^^^^^^^^^^^^^ register `ymm0`\n    |                  |\n    |                  register `xmm0`\n \n error: register `ymm0` conflicts with register `xmm0`\n-  --> $DIR/bad-reg.rs:60:34\n+  --> $DIR/bad-reg.rs:62:34\n    |\n LL |         asm!(\"\", in(\"xmm0\") foo, out(\"ymm0\") bar);\n    |                  --------------  ^^^^^^^^^^^^^^^ register `ymm0`\n    |                  |\n    |                  register `xmm0`\n    |\n help: use `lateout` instead of `out` to avoid conflict\n-  --> $DIR/bad-reg.rs:60:18\n+  --> $DIR/bad-reg.rs:62:18\n    |\n LL |         asm!(\"\", in(\"xmm0\") foo, out(\"ymm0\") bar);\n    |                  ^^^^^^^^^^^^^^"}, {"sha": "aa4cdf99176ca22a9737dc495110a6737c9d8651", "filename": "src/test/ui/asm/x86_64/const.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fconst.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fconst.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fconst.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,9 @@\n // revisions: mirunsafeck thirunsafeck\n // [thirunsafeck]compile-flags: -Z thir-unsafeck\n \n-#![feature(asm, global_asm, asm_const)]\n+#![feature(asm_const)]\n+\n+use std::arch::{asm, global_asm};\n \n fn const_generic<const X: usize>() -> usize {\n     unsafe {"}, {"sha": "c5f14f5f75ce06d042fcbbefbbe1d1e2a1ab94db", "filename": "src/test/ui/asm/x86_64/duplicate-options.fixed", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fduplicate-options.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fduplicate-options.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fduplicate-options.fixed?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,7 @@\n // only-x86_64\n // run-rustfix\n \n-#![feature(asm, global_asm)]\n+use std::arch::{asm, global_asm};\n \n fn main() {\n     unsafe {\n@@ -19,8 +19,8 @@ fn main() {\n             \"\",\n             options(nomem, noreturn),\n             options(att_syntax, ), //~ ERROR the `noreturn` option was already provided\n-            options( nostack), //~ ERROR the `nomem` option was already provided\n-            options(), //~ ERROR the `noreturn` option was already provided\n+            options( nostack),       //~ ERROR the `nomem` option was already provided\n+            options(),             //~ ERROR the `noreturn` option was already provided\n         );\n     }\n }"}, {"sha": "a8dce1f8d7126275c9a3ce60a984cb04b9b1c8de", "filename": "src/test/ui/asm/x86_64/duplicate-options.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fduplicate-options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fduplicate-options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fduplicate-options.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,7 @@\n // only-x86_64\n // run-rustfix\n \n-#![feature(asm, global_asm)]\n+use std::arch::{asm, global_asm};\n \n fn main() {\n     unsafe {\n@@ -19,8 +19,8 @@ fn main() {\n             \"\",\n             options(nomem, noreturn),\n             options(att_syntax, noreturn), //~ ERROR the `noreturn` option was already provided\n-            options(nomem, nostack), //~ ERROR the `nomem` option was already provided\n-            options(noreturn), //~ ERROR the `noreturn` option was already provided\n+            options(nomem, nostack),       //~ ERROR the `nomem` option was already provided\n+            options(noreturn),             //~ ERROR the `noreturn` option was already provided\n         );\n     }\n }"}, {"sha": "c05633ae88560cdb9e76bfa5f86d44ffafb4d645", "filename": "src/test/ui/asm/x86_64/interpolated-idents.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Finterpolated-idents.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Finterpolated-idents.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Finterpolated-idents.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // only-x86_64\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n macro_rules! m {\n     ($in:ident $out:ident $lateout:ident $inout:ident $inlateout:ident $const:ident $sym:ident"}, {"sha": "3e632eaf88dda90458a15af01091561112fcb922", "filename": "src/test/ui/asm/x86_64/issue-82869.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-82869.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-82869.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-82869.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,9 +1,10 @@\n // only-x86_64\n // Make sure rustc doesn't ICE on asm! for a foreign architecture.\n \n-#![feature(asm)]\n #![crate_type = \"rlib\"]\n \n+use std::arch::asm;\n+\n pub unsafe fn aarch64(a: f64, b: f64) -> f64 {\n     let c;\n     asm!(\"add {:d}, {:d}, d0\", out(vreg) c, in(vreg) a, in(\"d0\") {"}, {"sha": "42be1b6de725af6b33f6b45d431a11cbce9a997d", "filename": "src/test/ui/asm/x86_64/issue-82869.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-82869.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-82869.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-82869.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,17 +1,17 @@\n error: invalid register class `vreg`: unknown register class\n-  --> $DIR/issue-82869.rs:9:32\n+  --> $DIR/issue-82869.rs:10:32\n    |\n LL |     asm!(\"add {:d}, {:d}, d0\", out(vreg) c, in(vreg) a, in(\"d0\") {\n    |                                ^^^^^^^^^^^\n \n error: invalid register class `vreg`: unknown register class\n-  --> $DIR/issue-82869.rs:9:45\n+  --> $DIR/issue-82869.rs:10:45\n    |\n LL |     asm!(\"add {:d}, {:d}, d0\", out(vreg) c, in(vreg) a, in(\"d0\") {\n    |                                             ^^^^^^^^^^\n \n error: invalid register `d0`: unknown register\n-  --> $DIR/issue-82869.rs:9:57\n+  --> $DIR/issue-82869.rs:10:57\n    |\n LL |       asm!(\"add {:d}, {:d}, d0\", out(vreg) c, in(vreg) a, in(\"d0\") {\n    |  _________________________________________________________^"}, {"sha": "e4b6687e00ba71bca2a2190936fc82734c573a90", "filename": "src/test/ui/asm/x86_64/issue-89875.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-89875.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-89875.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fissue-89875.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,9 @@\n // build-pass\n // only-x86_64\n \n-#![feature(asm, target_feature_11)]\n+#![feature(target_feature_11)]\n+\n+use std::arch::asm;\n \n #[target_feature(enable = \"avx\")]\n fn main() {"}, {"sha": "9844d63f0cd43653c5e0ebf110f00043ec7565e0", "filename": "src/test/ui/asm/x86_64/may_unwind.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fmay_unwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fmay_unwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fmay_unwind.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,8 +3,9 @@\n // run-pass\n // needs-asm-support\n \n-#![feature(asm, asm_sym, asm_unwind)]\n+#![feature(asm_sym, asm_unwind)]\n \n+use std::arch::asm;\n use std::panic::{catch_unwind, resume_unwind, AssertUnwindSafe};\n \n struct Foo<'a>(&'a mut bool);"}, {"sha": "513eb270e4f36711d75f5504d0cbebd8613258aa", "filename": "src/test/ui/asm/x86_64/multiple-clobber-abi.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fmultiple-clobber-abi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fmultiple-clobber-abi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fmultiple-clobber-abi.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -4,7 +4,9 @@\n \n // Checks that multiple clobber_abi options can be used\n \n-#![feature(asm, asm_sym)]\n+#![feature(asm_sym)]\n+\n+use std::arch::asm;\n \n extern \"sysv64\" fn foo(x: i32) -> i32 {\n     x + 16"}, {"sha": "f0629f9f51cdf33d0d877b64c1f5251775621b10", "filename": "src/test/ui/asm/x86_64/parse-error.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,8 @@\n // only-x86_64\n \n-#![feature(asm, global_asm, asm_const)]\n+#![feature(asm_const)]\n+\n+use std::arch::{asm, global_asm};\n \n fn main() {\n     let mut foo = 0;"}, {"sha": "2d0a7a94d56765d8d1b4cea1c7ed370b142d99aa", "filename": "src/test/ui/asm/x86_64/parse-error.stderr", "status": "modified", "additions": 66, "deletions": 66, "changes": 132, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,397 +1,397 @@\n error: requires at least a template string argument\n-  --> $DIR/parse-error.rs:9:9\n+  --> $DIR/parse-error.rs:11:9\n    |\n LL |         asm!();\n    |         ^^^^^^\n \n error: asm template must be a string literal\n-  --> $DIR/parse-error.rs:11:14\n+  --> $DIR/parse-error.rs:13:14\n    |\n LL |         asm!(foo);\n    |              ^^^\n \n error: expected token: `,`\n-  --> $DIR/parse-error.rs:13:19\n+  --> $DIR/parse-error.rs:15:19\n    |\n LL |         asm!(\"{}\" foo);\n    |                   ^^^ expected `,`\n \n error: expected operand, clobber_abi, options, or additional template string\n-  --> $DIR/parse-error.rs:15:20\n+  --> $DIR/parse-error.rs:17:20\n    |\n LL |         asm!(\"{}\", foo);\n    |                    ^^^ expected operand, clobber_abi, options, or additional template string\n \n error: expected `(`, found `foo`\n-  --> $DIR/parse-error.rs:17:23\n+  --> $DIR/parse-error.rs:19:23\n    |\n LL |         asm!(\"{}\", in foo);\n    |                       ^^^ expected `(`\n \n error: expected `)`, found `foo`\n-  --> $DIR/parse-error.rs:19:27\n+  --> $DIR/parse-error.rs:21:27\n    |\n LL |         asm!(\"{}\", in(reg foo));\n    |                           ^^^ expected `)`\n \n error: expected expression, found end of macro arguments\n-  --> $DIR/parse-error.rs:21:27\n+  --> $DIR/parse-error.rs:23:27\n    |\n LL |         asm!(\"{}\", in(reg));\n    |                           ^ expected expression\n \n error: expected register class or explicit register\n-  --> $DIR/parse-error.rs:23:26\n+  --> $DIR/parse-error.rs:25:26\n    |\n LL |         asm!(\"{}\", inout(=) foo => bar);\n    |                          ^\n \n error: expected expression, found end of macro arguments\n-  --> $DIR/parse-error.rs:25:37\n+  --> $DIR/parse-error.rs:27:37\n    |\n LL |         asm!(\"{}\", inout(reg) foo =>);\n    |                                     ^ expected expression\n \n error: expected one of `!`, `,`, `.`, `::`, `?`, `{`, or an operator, found `=>`\n-  --> $DIR/parse-error.rs:27:32\n+  --> $DIR/parse-error.rs:29:32\n    |\n LL |         asm!(\"{}\", in(reg) foo => bar);\n    |                                ^^ expected one of 7 possible tokens\n \n error: argument to `sym` must be a path expression\n-  --> $DIR/parse-error.rs:29:24\n+  --> $DIR/parse-error.rs:31:24\n    |\n LL |         asm!(\"{}\", sym foo + bar);\n    |                        ^^^^^^^^^\n \n error: expected one of `)`, `att_syntax`, `may_unwind`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n-  --> $DIR/parse-error.rs:31:26\n+  --> $DIR/parse-error.rs:33:26\n    |\n LL |         asm!(\"\", options(foo));\n    |                          ^^^ expected one of 10 possible tokens\n \n error: expected one of `)` or `,`, found `foo`\n-  --> $DIR/parse-error.rs:33:32\n+  --> $DIR/parse-error.rs:35:32\n    |\n LL |         asm!(\"\", options(nomem foo));\n    |                                ^^^ expected one of `)` or `,`\n \n error: expected one of `)`, `att_syntax`, `may_unwind`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n-  --> $DIR/parse-error.rs:35:33\n+  --> $DIR/parse-error.rs:37:33\n    |\n LL |         asm!(\"\", options(nomem, foo));\n    |                                 ^^^ expected one of 10 possible tokens\n \n error: arguments are not allowed after options\n-  --> $DIR/parse-error.rs:37:31\n+  --> $DIR/parse-error.rs:39:31\n    |\n LL |         asm!(\"{}\", options(), const foo);\n    |                    ---------  ^^^^^^^^^ argument\n    |                    |\n    |                    previous options\n \n error: at least one abi must be provided as an argument to `clobber_abi`\n-  --> $DIR/parse-error.rs:40:30\n+  --> $DIR/parse-error.rs:42:30\n    |\n LL |         asm!(\"\", clobber_abi());\n    |                              ^\n \n error: expected string literal\n-  --> $DIR/parse-error.rs:42:30\n+  --> $DIR/parse-error.rs:44:30\n    |\n LL |         asm!(\"\", clobber_abi(foo));\n    |                              ^^^ not a string literal\n \n error: expected one of `)` or `,`, found `foo`\n-  --> $DIR/parse-error.rs:44:34\n+  --> $DIR/parse-error.rs:46:34\n    |\n LL |         asm!(\"\", clobber_abi(\"C\" foo));\n    |                                  ^^^ expected one of `)` or `,`\n \n error: expected string literal\n-  --> $DIR/parse-error.rs:46:35\n+  --> $DIR/parse-error.rs:48:35\n    |\n LL |         asm!(\"\", clobber_abi(\"C\", foo));\n    |                                   ^^^ not a string literal\n \n error: arguments are not allowed after clobber_abi\n-  --> $DIR/parse-error.rs:48:38\n+  --> $DIR/parse-error.rs:50:38\n    |\n LL |         asm!(\"{}\", clobber_abi(\"C\"), const foo);\n    |                    ----------------  ^^^^^^^^^ argument\n    |                    |\n    |                    clobber_abi\n \n error: clobber_abi is not allowed after options\n-  --> $DIR/parse-error.rs:51:29\n+  --> $DIR/parse-error.rs:53:29\n    |\n LL |         asm!(\"\", options(), clobber_abi(\"C\"));\n    |                  ---------  ^^^^^^^^^^^^^^^^\n    |                  |\n    |                  options\n \n error: clobber_abi is not allowed after options\n-  --> $DIR/parse-error.rs:53:31\n+  --> $DIR/parse-error.rs:55:31\n    |\n LL |         asm!(\"{}\", options(), clobber_abi(\"C\"), const foo);\n    |                    ---------  ^^^^^^^^^^^^^^^^\n    |                    |\n    |                    options\n \n error: duplicate argument named `a`\n-  --> $DIR/parse-error.rs:55:36\n+  --> $DIR/parse-error.rs:57:36\n    |\n LL |         asm!(\"{a}\", a = const foo, a = const bar);\n    |                     -------------  ^^^^^^^^^^^^^ duplicate argument\n    |                     |\n    |                     previously here\n \n error: argument never used\n-  --> $DIR/parse-error.rs:55:36\n+  --> $DIR/parse-error.rs:57:36\n    |\n LL |         asm!(\"{a}\", a = const foo, a = const bar);\n    |                                    ^^^^^^^^^^^^^ argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {1} */\"`\n \n error: explicit register arguments cannot have names\n-  --> $DIR/parse-error.rs:60:18\n+  --> $DIR/parse-error.rs:62:18\n    |\n LL |         asm!(\"\", a = in(\"eax\") foo);\n    |                  ^^^^^^^^^^^^^^^^^\n \n error: named arguments cannot follow explicit register arguments\n-  --> $DIR/parse-error.rs:62:36\n+  --> $DIR/parse-error.rs:64:36\n    |\n LL |         asm!(\"{a}\", in(\"eax\") foo, a = const bar);\n    |                     -------------  ^^^^^^^^^^^^^ named argument\n    |                     |\n    |                     explicit register argument\n \n error: named arguments cannot follow explicit register arguments\n-  --> $DIR/parse-error.rs:65:36\n+  --> $DIR/parse-error.rs:67:36\n    |\n LL |         asm!(\"{a}\", in(\"eax\") foo, a = const bar);\n    |                     -------------  ^^^^^^^^^^^^^ named argument\n    |                     |\n    |                     explicit register argument\n \n error: positional arguments cannot follow named arguments or explicit register arguments\n-  --> $DIR/parse-error.rs:68:36\n+  --> $DIR/parse-error.rs:70:36\n    |\n LL |         asm!(\"{1}\", in(\"eax\") foo, const bar);\n    |                     -------------  ^^^^^^^^^ positional argument\n    |                     |\n    |                     explicit register argument\n \n error: expected one of `clobber_abi`, `const`, `in`, `inlateout`, `inout`, `lateout`, `options`, `out`, or `sym`, found `\"\"`\n-  --> $DIR/parse-error.rs:71:29\n+  --> $DIR/parse-error.rs:73:29\n    |\n LL |         asm!(\"\", options(), \"\");\n    |                             ^^ expected one of 9 possible tokens\n \n error: expected one of `clobber_abi`, `const`, `in`, `inlateout`, `inout`, `lateout`, `options`, `out`, or `sym`, found `\"{}\"`\n-  --> $DIR/parse-error.rs:73:33\n+  --> $DIR/parse-error.rs:75:33\n    |\n LL |         asm!(\"{}\", in(reg) foo, \"{}\", out(reg) foo);\n    |                                 ^^^^ expected one of 9 possible tokens\n \n error: asm template must be a string literal\n-  --> $DIR/parse-error.rs:75:14\n+  --> $DIR/parse-error.rs:77:14\n    |\n LL |         asm!(format!(\"{{{}}}\", 0), in(reg) foo);\n    |              ^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: this error originates in the macro `format` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: asm template must be a string literal\n-  --> $DIR/parse-error.rs:77:21\n+  --> $DIR/parse-error.rs:79:21\n    |\n LL |         asm!(\"{1}\", format!(\"{{{}}}\", 0), in(reg) foo, out(reg) bar);\n    |                     ^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: this error originates in the macro `format` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: _ cannot be used for input operands\n-  --> $DIR/parse-error.rs:79:28\n+  --> $DIR/parse-error.rs:81:28\n    |\n LL |         asm!(\"{}\", in(reg) _);\n    |                            ^\n \n error: _ cannot be used for input operands\n-  --> $DIR/parse-error.rs:81:31\n+  --> $DIR/parse-error.rs:83:31\n    |\n LL |         asm!(\"{}\", inout(reg) _);\n    |                               ^\n \n error: _ cannot be used for input operands\n-  --> $DIR/parse-error.rs:83:35\n+  --> $DIR/parse-error.rs:85:35\n    |\n LL |         asm!(\"{}\", inlateout(reg) _);\n    |                                   ^\n \n error: requires at least a template string argument\n-  --> $DIR/parse-error.rs:90:1\n+  --> $DIR/parse-error.rs:92:1\n    |\n LL | global_asm!();\n    | ^^^^^^^^^^^^^\n \n error: asm template must be a string literal\n-  --> $DIR/parse-error.rs:92:13\n+  --> $DIR/parse-error.rs:94:13\n    |\n LL | global_asm!(FOO);\n    |             ^^^\n \n error: expected token: `,`\n-  --> $DIR/parse-error.rs:94:18\n+  --> $DIR/parse-error.rs:96:18\n    |\n LL | global_asm!(\"{}\" FOO);\n    |                  ^^^ expected `,`\n \n error: expected operand, options, or additional template string\n-  --> $DIR/parse-error.rs:96:19\n+  --> $DIR/parse-error.rs:98:19\n    |\n LL | global_asm!(\"{}\", FOO);\n    |                   ^^^ expected operand, options, or additional template string\n \n error: expected expression, found end of macro arguments\n-  --> $DIR/parse-error.rs:98:24\n+  --> $DIR/parse-error.rs:100:24\n    |\n LL | global_asm!(\"{}\", const);\n    |                        ^ expected expression\n \n error: expected one of `,`, `.`, `?`, or an operator, found `FOO`\n-  --> $DIR/parse-error.rs:100:30\n+  --> $DIR/parse-error.rs:102:30\n    |\n LL | global_asm!(\"{}\", const(reg) FOO);\n    |                              ^^^ expected one of `,`, `.`, `?`, or an operator\n \n error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `FOO`\n-  --> $DIR/parse-error.rs:102:25\n+  --> $DIR/parse-error.rs:104:25\n    |\n LL | global_asm!(\"\", options(FOO));\n    |                         ^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n-  --> $DIR/parse-error.rs:104:25\n+  --> $DIR/parse-error.rs:106:25\n    |\n LL | global_asm!(\"\", options(nomem FOO));\n    |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n-  --> $DIR/parse-error.rs:106:25\n+  --> $DIR/parse-error.rs:108:25\n    |\n LL | global_asm!(\"\", options(nomem, FOO));\n    |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n error: arguments are not allowed after options\n-  --> $DIR/parse-error.rs:108:30\n+  --> $DIR/parse-error.rs:110:30\n    |\n LL | global_asm!(\"{}\", options(), const FOO);\n    |                   ---------  ^^^^^^^^^ argument\n    |                   |\n    |                   previous options\n \n error: expected string literal\n-  --> $DIR/parse-error.rs:110:29\n+  --> $DIR/parse-error.rs:112:29\n    |\n LL | global_asm!(\"\", clobber_abi(FOO));\n    |                             ^^^ not a string literal\n \n error: expected one of `)` or `,`, found `FOO`\n-  --> $DIR/parse-error.rs:112:33\n+  --> $DIR/parse-error.rs:114:33\n    |\n LL | global_asm!(\"\", clobber_abi(\"C\" FOO));\n    |                                 ^^^ expected one of `)` or `,`\n \n error: expected string literal\n-  --> $DIR/parse-error.rs:114:34\n+  --> $DIR/parse-error.rs:116:34\n    |\n LL | global_asm!(\"\", clobber_abi(\"C\", FOO));\n    |                                  ^^^ not a string literal\n \n error: arguments are not allowed after clobber_abi\n-  --> $DIR/parse-error.rs:116:37\n+  --> $DIR/parse-error.rs:118:37\n    |\n LL | global_asm!(\"{}\", clobber_abi(\"C\"), const FOO);\n    |                   ----------------  ^^^^^^^^^ argument\n    |                   |\n    |                   clobber_abi\n \n error: `clobber_abi` cannot be used with `global_asm!`\n-  --> $DIR/parse-error.rs:116:19\n+  --> $DIR/parse-error.rs:118:19\n    |\n LL | global_asm!(\"{}\", clobber_abi(\"C\"), const FOO);\n    |                   ^^^^^^^^^^^^^^^^\n \n error: clobber_abi is not allowed after options\n-  --> $DIR/parse-error.rs:119:28\n+  --> $DIR/parse-error.rs:121:28\n    |\n LL | global_asm!(\"\", options(), clobber_abi(\"C\"));\n    |                 ---------  ^^^^^^^^^^^^^^^^\n    |                 |\n    |                 options\n \n error: clobber_abi is not allowed after options\n-  --> $DIR/parse-error.rs:121:30\n+  --> $DIR/parse-error.rs:123:30\n    |\n LL | global_asm!(\"{}\", options(), clobber_abi(\"C\"), const FOO);\n    |                   ---------  ^^^^^^^^^^^^^^^^\n    |                   |\n    |                   options\n \n error: `clobber_abi` cannot be used with `global_asm!`\n-  --> $DIR/parse-error.rs:123:17\n+  --> $DIR/parse-error.rs:125:17\n    |\n LL | global_asm!(\"\", clobber_abi(\"C\"), clobber_abi(\"C\"));\n    |                 ^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^\n \n error: duplicate argument named `a`\n-  --> $DIR/parse-error.rs:125:35\n+  --> $DIR/parse-error.rs:127:35\n    |\n LL | global_asm!(\"{a}\", a = const FOO, a = const BAR);\n    |                    -------------  ^^^^^^^^^^^^^ duplicate argument\n    |                    |\n    |                    previously here\n \n error: argument never used\n-  --> $DIR/parse-error.rs:125:35\n+  --> $DIR/parse-error.rs:127:35\n    |\n LL | global_asm!(\"{a}\", a = const FOO, a = const BAR);\n    |                                   ^^^^^^^^^^^^^ argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {1} */\"`\n \n error: expected one of `clobber_abi`, `const`, or `options`, found `\"\"`\n-  --> $DIR/parse-error.rs:128:28\n+  --> $DIR/parse-error.rs:130:28\n    |\n LL | global_asm!(\"\", options(), \"\");\n    |                            ^^ expected one of `clobber_abi`, `const`, or `options`\n \n error: expected one of `clobber_abi`, `const`, or `options`, found `\"{}\"`\n-  --> $DIR/parse-error.rs:130:30\n+  --> $DIR/parse-error.rs:132:30\n    |\n LL | global_asm!(\"{}\", const FOO, \"{}\", const FOO);\n    |                              ^^^^ expected one of `clobber_abi`, `const`, or `options`\n \n error: asm template must be a string literal\n-  --> $DIR/parse-error.rs:132:13\n+  --> $DIR/parse-error.rs:134:13\n    |\n LL | global_asm!(format!(\"{{{}}}\", 0), const FOO);\n    |             ^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: this error originates in the macro `format` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: asm template must be a string literal\n-  --> $DIR/parse-error.rs:134:20\n+  --> $DIR/parse-error.rs:136:20\n    |\n LL | global_asm!(\"{1}\", format!(\"{{{}}}\", 0), const FOO, const BAR);\n    |                    ^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: this error originates in the macro `format` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/parse-error.rs:37:37\n+  --> $DIR/parse-error.rs:39:37\n    |\n LL |     let mut foo = 0;\n    |      ---------- help: consider using `const` instead of `let`: `const foo`\n@@ -400,7 +400,7 @@ LL |         asm!(\"{}\", options(), const foo);\n    |                                     ^^^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/parse-error.rs:48:44\n+  --> $DIR/parse-error.rs:50:44\n    |\n LL |     let mut foo = 0;\n    |      ---------- help: consider using `const` instead of `let`: `const foo`\n@@ -409,7 +409,7 @@ LL |         asm!(\"{}\", clobber_abi(\"C\"), const foo);\n    |                                            ^^^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/parse-error.rs:55:31\n+  --> $DIR/parse-error.rs:57:31\n    |\n LL |     let mut foo = 0;\n    |      ---------- help: consider using `const` instead of `let`: `const foo`\n@@ -418,7 +418,7 @@ LL |         asm!(\"{a}\", a = const foo, a = const bar);\n    |                               ^^^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/parse-error.rs:55:46\n+  --> $DIR/parse-error.rs:57:46\n    |\n LL |     let mut bar = 0;\n    |      ---------- help: consider using `const` instead of `let`: `const bar`\n@@ -427,7 +427,7 @@ LL |         asm!(\"{a}\", a = const foo, a = const bar);\n    |                                              ^^^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/parse-error.rs:62:46\n+  --> $DIR/parse-error.rs:64:46\n    |\n LL |     let mut bar = 0;\n    |      ---------- help: consider using `const` instead of `let`: `const bar`\n@@ -436,7 +436,7 @@ LL |         asm!(\"{a}\", in(\"eax\") foo, a = const bar);\n    |                                              ^^^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/parse-error.rs:65:46\n+  --> $DIR/parse-error.rs:67:46\n    |\n LL |     let mut bar = 0;\n    |      ---------- help: consider using `const` instead of `let`: `const bar`\n@@ -445,7 +445,7 @@ LL |         asm!(\"{a}\", in(\"eax\") foo, a = const bar);\n    |                                              ^^^ non-constant value\n \n error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/parse-error.rs:68:42\n+  --> $DIR/parse-error.rs:70:42\n    |\n LL |     let mut bar = 0;\n    |      ---------- help: consider using `const` instead of `let`: `const bar`"}, {"sha": "8a21d75977212ad4ced130492c75ababdaca04fb", "filename": "src/test/ui/asm/x86_64/srcloc.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,8 @@\n // only-x86_64\n // build-fail\n // compile-flags: -Ccodegen-units=1\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n // Checks that inline asm errors are mapped to the correct line in the source code.\n "}, {"sha": "b62c8948289ddf1bf55575457bdc2e178c99d50c", "filename": "src/test/ui/asm/x86_64/srcloc.stderr", "status": "modified", "additions": 24, "deletions": 24, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,5 @@\n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:10:15\n+  --> $DIR/srcloc.rs:11:15\n    |\n LL |         asm!(\"invalid_instruction\");\n    |               ^\n@@ -11,7 +11,7 @@ LL |     invalid_instruction\n    |     ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:14:13\n+  --> $DIR/srcloc.rs:15:13\n    |\n LL |             invalid_instruction\n    |             ^\n@@ -23,7 +23,7 @@ LL |             invalid_instruction\n    |             ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:19:13\n+  --> $DIR/srcloc.rs:20:13\n    |\n LL |             invalid_instruction\n    |             ^\n@@ -35,7 +35,7 @@ LL |             invalid_instruction\n    |             ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:25:13\n+  --> $DIR/srcloc.rs:26:13\n    |\n LL |             invalid_instruction\n    |             ^\n@@ -47,7 +47,7 @@ LL |             invalid_instruction\n    |             ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:32:13\n+  --> $DIR/srcloc.rs:33:13\n    |\n LL |             invalid_instruction\n    |             ^\n@@ -59,7 +59,7 @@ LL |             invalid_instruction\n    |             ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:37:14\n+  --> $DIR/srcloc.rs:38:14\n    |\n LL |         asm!(concat!(\"invalid\", \"_\", \"instruction\"));\n    |              ^\n@@ -71,7 +71,7 @@ LL |     invalid_instruction\n    |     ^^^^^^^^^^^^^^^^^^^\n \n warning: scale factor without index register is ignored\n-  --> $DIR/srcloc.rs:40:15\n+  --> $DIR/srcloc.rs:41:15\n    |\n LL |         asm!(\"movaps %xmm3, (%esi, 2)\", options(att_syntax));\n    |               ^\n@@ -83,7 +83,7 @@ LL |     movaps %xmm3, (%esi, 2)\n    |                          ^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:44:14\n+  --> $DIR/srcloc.rs:45:14\n    |\n LL |             \"invalid_instruction\",\n    |              ^\n@@ -95,7 +95,7 @@ LL |     invalid_instruction\n    |     ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:50:14\n+  --> $DIR/srcloc.rs:51:14\n    |\n LL |             \"invalid_instruction\",\n    |              ^\n@@ -107,7 +107,7 @@ LL | invalid_instruction\n    | ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:57:14\n+  --> $DIR/srcloc.rs:58:14\n    |\n LL |             \"invalid_instruction\",\n    |              ^\n@@ -119,7 +119,7 @@ LL | invalid_instruction\n    | ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:64:13\n+  --> $DIR/srcloc.rs:65:13\n    |\n LL |             concat!(\"invalid\", \"_\", \"instruction\"),\n    |             ^\n@@ -131,7 +131,7 @@ LL | invalid_instruction\n    | ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction'\n-  --> $DIR/srcloc.rs:71:13\n+  --> $DIR/srcloc.rs:72:13\n    |\n LL |             concat!(\"invalid\", \"_\", \"instruction\"),\n    |             ^\n@@ -143,7 +143,7 @@ LL | invalid_instruction\n    | ^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction1'\n-  --> $DIR/srcloc.rs:78:14\n+  --> $DIR/srcloc.rs:79:14\n    |\n LL |             \"invalid_instruction1\",\n    |              ^\n@@ -155,7 +155,7 @@ LL |     invalid_instruction1\n    |     ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction2'\n-  --> $DIR/srcloc.rs:79:14\n+  --> $DIR/srcloc.rs:80:14\n    |\n LL |             \"invalid_instruction2\",\n    |              ^\n@@ -167,7 +167,7 @@ LL | invalid_instruction2\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction1'\n-  --> $DIR/srcloc.rs:85:13\n+  --> $DIR/srcloc.rs:86:13\n    |\n LL |             concat!(\n    |             ^\n@@ -179,7 +179,7 @@ LL |     invalid_instruction1\n    |     ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction2'\n-  --> $DIR/srcloc.rs:85:13\n+  --> $DIR/srcloc.rs:86:13\n    |\n LL |             concat!(\n    |             ^\n@@ -191,7 +191,7 @@ LL | invalid_instruction2\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction1'\n-  --> $DIR/srcloc.rs:94:13\n+  --> $DIR/srcloc.rs:95:13\n    |\n LL |             concat!(\n    |             ^\n@@ -203,7 +203,7 @@ LL |     invalid_instruction1\n    |     ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction2'\n-  --> $DIR/srcloc.rs:94:13\n+  --> $DIR/srcloc.rs:95:13\n    |\n LL |             concat!(\n    |             ^\n@@ -215,7 +215,7 @@ LL | invalid_instruction2\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction3'\n-  --> $DIR/srcloc.rs:98:13\n+  --> $DIR/srcloc.rs:99:13\n    |\n LL |             concat!(\n    |             ^\n@@ -227,7 +227,7 @@ LL | invalid_instruction3\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction4'\n-  --> $DIR/srcloc.rs:98:13\n+  --> $DIR/srcloc.rs:99:13\n    |\n LL |             concat!(\n    |             ^\n@@ -239,7 +239,7 @@ LL | invalid_instruction4\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction1'\n-  --> $DIR/srcloc.rs:109:13\n+  --> $DIR/srcloc.rs:110:13\n    |\n LL |             concat!(\n    |             ^\n@@ -251,7 +251,7 @@ LL |     invalid_instruction1\n    |     ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction2'\n-  --> $DIR/srcloc.rs:109:13\n+  --> $DIR/srcloc.rs:110:13\n    |\n LL |             concat!(\n    |             ^\n@@ -263,7 +263,7 @@ LL | invalid_instruction2\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction3'\n-  --> $DIR/srcloc.rs:113:13\n+  --> $DIR/srcloc.rs:114:13\n    |\n LL |             concat!(\n    |             ^\n@@ -275,7 +275,7 @@ LL | invalid_instruction3\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: invalid instruction mnemonic 'invalid_instruction4'\n-  --> $DIR/srcloc.rs:113:13\n+  --> $DIR/srcloc.rs:114:13\n    |\n LL |             concat!(\n    |             ^"}, {"sha": "fcb6c5fbfaf84634423d7a001fb028f1e5cb5f05", "filename": "src/test/ui/asm/x86_64/sym.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsym.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsym.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsym.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,9 @@\n // only-linux\n // run-pass\n \n-#![feature(asm, thread_local, asm_sym)]\n+#![feature(thread_local, asm_sym)]\n+\n+use std::arch::asm;\n \n extern \"C\" fn f1() -> i32 {\n     111"}, {"sha": "14490c3e0f23dc0134d9097800fce09cc26bee3a", "filename": "src/test/ui/asm/x86_64/target-feature-attr.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftarget-feature-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftarget-feature-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftarget-feature-attr.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,8 @@\n // only-x86_64\n \n-#![feature(asm, avx512_target_feature)]\n+#![feature(avx512_target_feature)]\n+\n+use std::arch::asm;\n \n #[target_feature(enable = \"avx\")]\n unsafe fn foo() {"}, {"sha": "c852726ee7ff83a72bedfdba647294259b97b58a", "filename": "src/test/ui/asm/x86_64/target-feature-attr.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftarget-feature-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftarget-feature-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftarget-feature-attr.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,23 +1,23 @@\n error: register class `ymm_reg` requires the `avx` target feature\n-  --> $DIR/target-feature-attr.rs:16:40\n+  --> $DIR/target-feature-attr.rs:18:40\n    |\n LL |     asm!(\"vaddps {2:y}, {0:y}, {1:y}\", in(ymm_reg) x, in(ymm_reg) y, lateout(ymm_reg) x);\n    |                                        ^^^^^^^^^^^^^\n \n error: register class `ymm_reg` requires the `avx` target feature\n-  --> $DIR/target-feature-attr.rs:16:55\n+  --> $DIR/target-feature-attr.rs:18:55\n    |\n LL |     asm!(\"vaddps {2:y}, {0:y}, {1:y}\", in(ymm_reg) x, in(ymm_reg) y, lateout(ymm_reg) x);\n    |                                                       ^^^^^^^^^^^^^\n \n error: register class `ymm_reg` requires the `avx` target feature\n-  --> $DIR/target-feature-attr.rs:16:70\n+  --> $DIR/target-feature-attr.rs:18:70\n    |\n LL |     asm!(\"vaddps {2:y}, {0:y}, {1:y}\", in(ymm_reg) x, in(ymm_reg) y, lateout(ymm_reg) x);\n    |                                                                      ^^^^^^^^^^^^^^^^^^\n \n error: register class `kreg` requires at least one of the following target features: avx512bw, avx512f\n-  --> $DIR/target-feature-attr.rs:31:23\n+  --> $DIR/target-feature-attr.rs:33:23\n    |\n LL |     asm!(\"/* {0} */\", in(kreg) x);\n    |                       ^^^^^^^^^^"}, {"sha": "f95aebb78b5f8a425998472ffc6ac506f0e5feb2", "filename": "src/test/ui/asm/x86_64/type-check-2.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-2.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,8 @@\n // only-x86_64\n \n-#![feature(asm, repr_simd, never_type, asm_sym)]\n+#![feature(repr_simd, never_type, asm_sym)]\n+\n+use std::arch::asm;\n \n #[repr(simd)]\n struct SimdNonCopy(f32, f32, f32, f32);"}, {"sha": "cec750fdf9a55c00cf004f5a3f6326660239c781", "filename": "src/test/ui/asm/x86_64/type-check-2.stderr", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-2.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,21 +1,21 @@\n error: arguments for inline assembly must be copyable\n-  --> $DIR/type-check-2.rs:42:32\n+  --> $DIR/type-check-2.rs:44:32\n    |\n LL |         asm!(\"{}\", in(xmm_reg) SimdNonCopy(0.0, 0.0, 0.0, 0.0));\n    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: `SimdNonCopy` does not implement the Copy trait\n \n-error: cannot use value of type `[closure@$DIR/type-check-2.rs:54:28: 54:38]` for inline assembly\n-  --> $DIR/type-check-2.rs:54:28\n+error: cannot use value of type `[closure@$DIR/type-check-2.rs:56:28: 56:38]` for inline assembly\n+  --> $DIR/type-check-2.rs:56:28\n    |\n LL |         asm!(\"{}\", in(reg) |x: i32| x);\n    |                            ^^^^^^^^^^\n    |\n    = note: only integers, floats, SIMD vectors, pointers and function pointers can be used as arguments for inline assembly\n \n error: cannot use value of type `Vec<i32>` for inline assembly\n-  --> $DIR/type-check-2.rs:56:28\n+  --> $DIR/type-check-2.rs:58:28\n    |\n LL |         asm!(\"{}\", in(reg) vec![0]);\n    |                            ^^^^^^^\n@@ -24,63 +24,63 @@ LL |         asm!(\"{}\", in(reg) vec![0]);\n    = note: this error originates in the macro `vec` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: cannot use value of type `(i32, i32, i32)` for inline assembly\n-  --> $DIR/type-check-2.rs:58:28\n+  --> $DIR/type-check-2.rs:60:28\n    |\n LL |         asm!(\"{}\", in(reg) (1, 2, 3));\n    |                            ^^^^^^^^^\n    |\n    = note: only integers, floats, SIMD vectors, pointers and function pointers can be used as arguments for inline assembly\n \n error: cannot use value of type `[i32; 3]` for inline assembly\n-  --> $DIR/type-check-2.rs:60:28\n+  --> $DIR/type-check-2.rs:62:28\n    |\n LL |         asm!(\"{}\", in(reg) [1, 2, 3]);\n    |                            ^^^^^^^^^\n    |\n    = note: only integers, floats, SIMD vectors, pointers and function pointers can be used as arguments for inline assembly\n \n error: cannot use value of type `fn() {main}` for inline assembly\n-  --> $DIR/type-check-2.rs:68:31\n+  --> $DIR/type-check-2.rs:70:31\n    |\n LL |         asm!(\"{}\", inout(reg) f);\n    |                               ^\n    |\n    = note: only integers, floats, SIMD vectors, pointers and function pointers can be used as arguments for inline assembly\n \n error: cannot use value of type `&mut i32` for inline assembly\n-  --> $DIR/type-check-2.rs:71:31\n+  --> $DIR/type-check-2.rs:73:31\n    |\n LL |         asm!(\"{}\", inout(reg) r);\n    |                               ^\n    |\n    = note: only integers, floats, SIMD vectors, pointers and function pointers can be used as arguments for inline assembly\n \n error: asm `sym` operand must point to a fn or static\n-  --> $DIR/type-check-2.rs:35:24\n+  --> $DIR/type-check-2.rs:37:24\n    |\n LL |         asm!(\"{}\", sym C);\n    |                        ^\n \n error: asm `sym` operand must point to a fn or static\n-  --> $DIR/type-check-2.rs:37:24\n+  --> $DIR/type-check-2.rs:39:24\n    |\n LL |         asm!(\"{}\", sym x);\n    |                        ^\n \n error[E0381]: use of possibly-uninitialized variable: `x`\n-  --> $DIR/type-check-2.rs:13:28\n+  --> $DIR/type-check-2.rs:15:28\n    |\n LL |         asm!(\"{}\", in(reg) x);\n    |                            ^ use of possibly-uninitialized `x`\n \n error[E0381]: use of possibly-uninitialized variable: `y`\n-  --> $DIR/type-check-2.rs:16:9\n+  --> $DIR/type-check-2.rs:18:9\n    |\n LL |         asm!(\"{}\", inout(reg) y);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ use of possibly-uninitialized `y`\n \n error[E0596]: cannot borrow `v` as mutable, as it is not declared as mutable\n-  --> $DIR/type-check-2.rs:24:29\n+  --> $DIR/type-check-2.rs:26:29\n    |\n LL |         let v: Vec<u64> = vec![0, 1, 2];\n    |             - help: consider changing this to be mutable: `mut v`\n@@ -89,7 +89,7 @@ LL |         asm!(\"{}\", out(reg) v[0]);\n    |                             ^ cannot borrow as mutable\n \n error[E0596]: cannot borrow `v` as mutable, as it is not declared as mutable\n-  --> $DIR/type-check-2.rs:26:31\n+  --> $DIR/type-check-2.rs:28:31\n    |\n LL |         let v: Vec<u64> = vec![0, 1, 2];\n    |             - help: consider changing this to be mutable: `mut v`"}, {"sha": "595de55fd8bc861c6377305b070833b790b7b73a", "filename": "src/test/ui/asm/x86_64/type-check-3.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-3.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,9 @@\n // only-x86_64\n // compile-flags: -C target-feature=+avx512f\n \n-#![feature(asm, global_asm, asm_const)]\n+#![feature(asm_const)]\n+\n+use std::arch::{asm, global_asm};\n \n use std::arch::x86_64::{_mm256_setzero_ps, _mm_setzero_ps};\n "}, {"sha": "aeb638d6949ceaa2dea13a71bf9fa27879183731", "filename": "src/test/ui/asm/x86_64/type-check-3.stderr", "status": "modified", "additions": 16, "deletions": 16, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Ftype-check-3.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,45 +1,45 @@\n error: type `i128` cannot be used with this register class\n-  --> $DIR/type-check-3.rs:12:28\n+  --> $DIR/type-check-3.rs:14:28\n    |\n LL |         asm!(\"{}\", in(reg) 0i128);\n    |                            ^^^^^\n    |\n    = note: register class `reg` supports these types: i16, i32, i64, f32, f64\n \n error: type `__m128` cannot be used with this register class\n-  --> $DIR/type-check-3.rs:14:28\n+  --> $DIR/type-check-3.rs:16:28\n    |\n LL |         asm!(\"{}\", in(reg) _mm_setzero_ps());\n    |                            ^^^^^^^^^^^^^^^^\n    |\n    = note: register class `reg` supports these types: i16, i32, i64, f32, f64\n \n error: type `__m256` cannot be used with this register class\n-  --> $DIR/type-check-3.rs:16:28\n+  --> $DIR/type-check-3.rs:18:28\n    |\n LL |         asm!(\"{}\", in(reg) _mm256_setzero_ps());\n    |                            ^^^^^^^^^^^^^^^^^^^\n    |\n    = note: register class `reg` supports these types: i16, i32, i64, f32, f64\n \n error: type `u8` cannot be used with this register class\n-  --> $DIR/type-check-3.rs:18:32\n+  --> $DIR/type-check-3.rs:20:32\n    |\n LL |         asm!(\"{}\", in(xmm_reg) 0u8);\n    |                                ^^^\n    |\n    = note: register class `xmm_reg` supports these types: i32, i64, f32, f64, i8x16, i16x8, i32x4, i64x2, f32x4, f64x2\n \n error: `avx512bw` target feature is not enabled\n-  --> $DIR/type-check-3.rs:27:29\n+  --> $DIR/type-check-3.rs:29:29\n    |\n LL |         asm!(\"{}\", in(kreg) 0u64);\n    |                             ^^^^\n    |\n    = note: this is required to use type `u64` with register class `kreg`\n \n warning: formatting may not be suitable for sub-register argument\n-  --> $DIR/type-check-3.rs:32:15\n+  --> $DIR/type-check-3.rs:34:15\n    |\n LL |         asm!(\"{0} {0}\", in(reg) 0i16);\n    |               ^^^ ^^^           ---- for this argument\n@@ -49,7 +49,7 @@ LL |         asm!(\"{0} {0}\", in(reg) 0i16);\n    = help: or use the `r` modifier to keep the default formatting of `rax`\n \n warning: formatting may not be suitable for sub-register argument\n-  --> $DIR/type-check-3.rs:34:15\n+  --> $DIR/type-check-3.rs:36:15\n    |\n LL |         asm!(\"{0} {0:x}\", in(reg) 0i16);\n    |               ^^^                 ---- for this argument\n@@ -58,7 +58,7 @@ LL |         asm!(\"{0} {0:x}\", in(reg) 0i16);\n    = help: or use the `r` modifier to keep the default formatting of `rax`\n \n warning: formatting may not be suitable for sub-register argument\n-  --> $DIR/type-check-3.rs:36:15\n+  --> $DIR/type-check-3.rs:38:15\n    |\n LL |         asm!(\"{}\", in(reg) 0i32);\n    |               ^^           ---- for this argument\n@@ -67,7 +67,7 @@ LL |         asm!(\"{}\", in(reg) 0i32);\n    = help: or use the `r` modifier to keep the default formatting of `rax`\n \n warning: formatting may not be suitable for sub-register argument\n-  --> $DIR/type-check-3.rs:39:15\n+  --> $DIR/type-check-3.rs:41:15\n    |\n LL |         asm!(\"{}\", in(ymm_reg) 0i64);\n    |               ^^               ---- for this argument\n@@ -76,7 +76,7 @@ LL |         asm!(\"{}\", in(ymm_reg) 0i64);\n    = help: or use the `y` modifier to keep the default formatting of `ymm0`\n \n error: type `i8` cannot be used with this register class\n-  --> $DIR/type-check-3.rs:50:28\n+  --> $DIR/type-check-3.rs:52:28\n    |\n LL |         asm!(\"{}\", in(reg) 0i8);\n    |                            ^^^\n@@ -85,7 +85,7 @@ LL |         asm!(\"{}\", in(reg) 0i8);\n    = help: consider using the `reg_byte` register class instead\n \n error: incompatible types for asm inout argument\n-  --> $DIR/type-check-3.rs:62:33\n+  --> $DIR/type-check-3.rs:64:33\n    |\n LL |         asm!(\"{:r}\", inout(reg) 0u32 => val_f32);\n    |                                 ^^^^    ^^^^^^^ type `f32`\n@@ -95,7 +95,7 @@ LL |         asm!(\"{:r}\", inout(reg) 0u32 => val_f32);\n    = note: asm inout arguments must have the same type, unless they are both pointers or integers of the same size\n \n error: incompatible types for asm inout argument\n-  --> $DIR/type-check-3.rs:64:33\n+  --> $DIR/type-check-3.rs:66:33\n    |\n LL |         asm!(\"{:r}\", inout(reg) 0u32 => val_ptr);\n    |                                 ^^^^    ^^^^^^^ type `*mut u8`\n@@ -105,7 +105,7 @@ LL |         asm!(\"{:r}\", inout(reg) 0u32 => val_ptr);\n    = note: asm inout arguments must have the same type, unless they are both pointers or integers of the same size\n \n error: incompatible types for asm inout argument\n-  --> $DIR/type-check-3.rs:66:33\n+  --> $DIR/type-check-3.rs:68:33\n    |\n LL |         asm!(\"{:r}\", inout(reg) main => val_u32);\n    |                                 ^^^^    ^^^^^^^ type `u32`\n@@ -115,23 +115,23 @@ LL |         asm!(\"{:r}\", inout(reg) main => val_u32);\n    = note: asm inout arguments must have the same type, unless they are both pointers or integers of the same size\n \n error[E0013]: constants cannot refer to statics\n-  --> $DIR/type-check-3.rs:82:25\n+  --> $DIR/type-check-3.rs:84:25\n    |\n LL | global_asm!(\"{}\", const S);\n    |                         ^\n    |\n    = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n error[E0013]: constants cannot refer to statics\n-  --> $DIR/type-check-3.rs:85:35\n+  --> $DIR/type-check-3.rs:87:35\n    |\n LL | global_asm!(\"{}\", const const_foo(S));\n    |                                   ^\n    |\n    = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n error[E0013]: constants cannot refer to statics\n-  --> $DIR/type-check-3.rs:88:35\n+  --> $DIR/type-check-3.rs:90:35\n    |\n LL | global_asm!(\"{}\", const const_bar(S));\n    |                                   ^"}, {"sha": "4cd7e2717fe453fdd0254a61d56f6b6767e30674", "filename": "src/test/ui/consts/inline_asm.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fconsts%2Finline_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fconsts%2Finline_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Finline_asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // needs-asm-support\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n const _: () = unsafe { asm!(\"nop\") };\n //~^ ERROR inline assembly"}, {"sha": "1bb22a1301abf9b72f35788fc0b1b15de342fd40", "filename": "src/test/ui/consts/miri_unleashed/inline_asm.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Finline_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Finline_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Finline_asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,9 +1,11 @@\n // compile-flags: -Zunleash-the-miri-inside-of-you\n // only-x86_64\n-#![feature(asm,llvm_asm)]\n+#![feature(llvm_asm)]\n #![allow(const_err)]\n #![allow(deprecated)] // llvm_asm!\n \n+use std::arch::asm;\n+\n fn main() {}\n \n // Make sure we catch executing inline assembly."}, {"sha": "34ac808ed1702415d796ce08090d9140ec6a9b21", "filename": "src/test/ui/consts/miri_unleashed/inline_asm.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Finline_asm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Finline_asm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Finline_asm.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,26 +1,26 @@\n error[E0080]: could not evaluate static initializer\n-  --> $DIR/inline_asm.rs:11:14\n+  --> $DIR/inline_asm.rs:13:14\n    |\n LL |     unsafe { llvm_asm!(\"xor %eax, %eax\" ::: \"eax\"); }\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ inline assembly is not supported\n    |\n    = note: this error originates in the macro `llvm_asm` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error[E0080]: could not evaluate static initializer\n-  --> $DIR/inline_asm.rs:20:14\n+  --> $DIR/inline_asm.rs:22:14\n    |\n LL |     unsafe { asm!(\"nop\"); }\n    |              ^^^^^^^^^^^ inline assembly is not supported\n \n warning: skipping const checks\n    |\n help: skipping check that does not even have a feature gate\n-  --> $DIR/inline_asm.rs:11:14\n+  --> $DIR/inline_asm.rs:13:14\n    |\n LL |     unsafe { llvm_asm!(\"xor %eax, %eax\" ::: \"eax\"); }\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n help: skipping check that does not even have a feature gate\n-  --> $DIR/inline_asm.rs:20:14\n+  --> $DIR/inline_asm.rs:22:14\n    |\n LL |     unsafe { asm!(\"nop\"); }\n    |              ^^^^^^^^^^^"}, {"sha": "bff5c203b91a391b07aa15c7c5793a394e75a2cb", "filename": "src/test/ui/empty_global_asm.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fempty_global_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fempty_global_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fempty_global_asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // run-pass\n \n-#![feature(global_asm)]\n+use std::arch::global_asm;\n \n #[cfg(target_arch = \"x86\")]\n global_asm!(\"\");"}, {"sha": "556219b98a93ad4450dc65f9ec45c1ff973b8ae3", "filename": "src/test/ui/feature-gates/feature-gate-asm.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -4,8 +4,6 @@\n \n fn main() {\n     unsafe {\n-        asm!(\"\");\n-        //~^ ERROR inline assembly is not stable enough\n         llvm_asm!(\"\");\n         //~^ ERROR prefer using the new asm! syntax instead\n     }"}, {"sha": "72ba70d0d9149cc6ff0fb67a20806c24a21d324f", "filename": "src/test/ui/feature-gates/feature-gate-asm.stderr", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,21 +1,12 @@\n-error[E0658]: use of unstable library feature 'asm': inline assembly is not stable enough for use and is subject to change\n-  --> $DIR/feature-gate-asm.rs:7:9\n-   |\n-LL |         asm!(\"\");\n-   |         ^^^\n-   |\n-   = note: see issue #72016 <https://github.com/rust-lang/rust/issues/72016> for more information\n-   = help: add `#![feature(asm)]` to the crate attributes to enable\n-\n error[E0658]: use of unstable library feature 'llvm_asm': prefer using the new asm! syntax instead\n-  --> $DIR/feature-gate-asm.rs:9:9\n+  --> $DIR/feature-gate-asm.rs:7:9\n    |\n LL |         llvm_asm!(\"\");\n    |         ^^^^^^^^\n    |\n    = note: see issue #70173 <https://github.com/rust-lang/rust/issues/70173> for more information\n    = help: add `#![feature(llvm_asm)]` to the crate attributes to enable\n \n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0658`."}, {"sha": "712e3a56fd87f1a5eb0dbd85961629fea9086a1b", "filename": "src/test/ui/feature-gates/feature-gate-asm2.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -4,8 +4,6 @@\n \n fn main() {\n     unsafe {\n-        println!(\"{:?}\", asm!(\"\"));\n-        //~^ ERROR inline assembly is not stable enough\n         println!(\"{:?}\", llvm_asm!(\"\"));\n         //~^ ERROR prefer using the new asm! syntax instead\n     }"}, {"sha": "0297fec16dd7252348c4bd63814d64a2adf11b3f", "filename": "src/test/ui/feature-gates/feature-gate-asm2.stderr", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,21 +1,12 @@\n-error[E0658]: use of unstable library feature 'asm': inline assembly is not stable enough for use and is subject to change\n-  --> $DIR/feature-gate-asm2.rs:7:26\n-   |\n-LL |         println!(\"{:?}\", asm!(\"\"));\n-   |                          ^^^\n-   |\n-   = note: see issue #72016 <https://github.com/rust-lang/rust/issues/72016> for more information\n-   = help: add `#![feature(asm)]` to the crate attributes to enable\n-\n error[E0658]: use of unstable library feature 'llvm_asm': prefer using the new asm! syntax instead\n-  --> $DIR/feature-gate-asm2.rs:9:26\n+  --> $DIR/feature-gate-asm2.rs:7:26\n    |\n LL |         println!(\"{:?}\", llvm_asm!(\"\"));\n    |                          ^^^^^^^^\n    |\n    = note: see issue #70173 <https://github.com/rust-lang/rust/issues/70173> for more information\n    = help: add `#![feature(llvm_asm)]` to the crate attributes to enable\n \n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0658`."}, {"sha": "d41d7b258aafb5714649f2ecd772a2f4d49ed63d", "filename": "src/test/ui/feature-gates/feature-gate-asm_const.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_const.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // only-x86_64\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n fn main() {\n     unsafe {"}, {"sha": "e4d781c6859324d2a0d17bebece4d805ade4c414", "filename": "src/test/ui/feature-gates/feature-gate-asm_sym.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_sym.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_sym.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_sym.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // only-x86_64\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n fn main() {\n     unsafe {"}, {"sha": "df161b60081123cae36e43787529d26457da7e7b", "filename": "src/test/ui/feature-gates/feature-gate-asm_unwind.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_unwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_unwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm_unwind.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,6 +1,6 @@\n // only-x86_64\n \n-#![feature(asm)]\n+use std::arch::asm;\n \n fn main() {\n     unsafe {"}, {"sha": "1420eef299bbfdee82e82934535e8f8ed34a3064", "filename": "src/test/ui/feature-gates/feature-gate-global_asm.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-global_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-global_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-global_asm.rs?ref=b3a55371a72f665f5d9476d07980e76d3e755fe6", "patch": "@@ -1,5 +0,0 @@\n-// needs-asm-support\n-\n-global_asm!(\"\"); //~ ERROR `global_asm!` is not stable\n-\n-fn main() {}"}, {"sha": "7c4d3e3e6e5953d8930d550471225ffb41879e9f", "filename": "src/test/ui/feature-gates/feature-gate-global_asm.stderr", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-global_asm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b3a55371a72f665f5d9476d07980e76d3e755fe6/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-global_asm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-global_asm.stderr?ref=b3a55371a72f665f5d9476d07980e76d3e755fe6", "patch": "@@ -1,12 +0,0 @@\n-error[E0658]: use of unstable library feature 'global_asm': `global_asm!` is not stable enough for use and is subject to change\n-  --> $DIR/feature-gate-global_asm.rs:3:1\n-   |\n-LL | global_asm!(\"\");\n-   | ^^^^^^^^^^\n-   |\n-   = note: see issue #35119 <https://github.com/rust-lang/rust/issues/35119> for more information\n-   = help: add `#![feature(global_asm)]` to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "8e93b194174ff49d3c965c23ce3378e098b48e05", "filename": "src/test/ui/feature-gates/feature-gate-naked_functions.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-naked_functions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-naked_functions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-naked_functions.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,6 @@\n // needs-asm-support\n-#![feature(asm)]\n+\n+use std::arch::asm;\n \n #[naked]\n //~^ the `#[naked]` attribute is an experimental feature"}, {"sha": "4378fb36367ad89f673627f864626b16034b77e8", "filename": "src/test/ui/feature-gates/feature-gate-naked_functions.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-naked_functions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-naked_functions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-naked_functions.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,5 @@\n error[E0658]: the `#[naked]` attribute is an experimental feature\n-  --> $DIR/feature-gate-naked_functions.rs:4:1\n+  --> $DIR/feature-gate-naked_functions.rs:5:1\n    |\n LL | #[naked]\n    | ^^^^^^^^\n@@ -8,7 +8,7 @@ LL | #[naked]\n    = help: add `#![feature(naked_functions)]` to the crate attributes to enable\n \n error[E0658]: the `#[naked]` attribute is an experimental feature\n-  --> $DIR/feature-gate-naked_functions.rs:10:1\n+  --> $DIR/feature-gate-naked_functions.rs:11:1\n    |\n LL | #[naked]\n    | ^^^^^^^^"}, {"sha": "ea5f033cb8644d35f837ca70b10061bcc640b0da", "filename": "src/test/ui/liveness/liveness-asm.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fliveness%2Fliveness-asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fliveness%2Fliveness-asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fliveness%2Fliveness-asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,11 +3,12 @@\n // only-x86_64\n // check-pass\n \n-#![feature(asm)]\n #![allow(dead_code)]\n #![warn(unused_assignments)]\n #![warn(unused_variables)]\n \n+use std::arch::asm;\n+\n // Test the single inout case\n unsafe fn f1(mut src: *const u8) {\n     asm!(\"/*{0}*/\", inout(reg) src); //~ WARN value assigned to `src` is never read"}, {"sha": "d052aca338c91665f0891297b54a5342a7c25b09", "filename": "src/test/ui/liveness/liveness-asm.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fliveness%2Fliveness-asm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fliveness%2Fliveness-asm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fliveness%2Fliveness-asm.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,18 +1,18 @@\n warning: value assigned to `src` is never read\n-  --> $DIR/liveness-asm.rs:13:32\n+  --> $DIR/liveness-asm.rs:14:32\n    |\n LL |     asm!(\"/*{0}*/\", inout(reg) src);\n    |                                ^^^\n    |\n note: the lint level is defined here\n-  --> $DIR/liveness-asm.rs:8:9\n+  --> $DIR/liveness-asm.rs:7:9\n    |\n LL | #![warn(unused_assignments)]\n    |         ^^^^^^^^^^^^^^^^^^\n    = help: maybe it is overwritten before being read?\n \n warning: value assigned to `src` is never read\n-  --> $DIR/liveness-asm.rs:23:39\n+  --> $DIR/liveness-asm.rs:24:39\n    |\n LL |     asm!(\"/*{0}*/\", inout(reg) src => src);\n    |                                       ^^^"}, {"sha": "26e90edce0b189eb1613e3b6df44ae755e39fa1b", "filename": "src/test/ui/macros/global-asm.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fglobal-asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fglobal-asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fglobal-asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,7 +1,7 @@\n-#![feature(global_asm)]\n+use std::arch::global_asm;\n \n fn main() {\n-    global_asm!();  //~ ERROR requires at least a template string argument\n+    global_asm!(); //~ ERROR requires at least a template string argument\n     global_asm!(struct); //~ ERROR expected expression\n     global_asm!(123); //~ ERROR asm template must be a string literal\n }"}, {"sha": "cff110470f213711864b570649178f1c6319e279", "filename": "src/test/ui/macros/macro-expanded-include/foo/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacro-expanded-include%2Ffoo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacro-expanded-include%2Ffoo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-expanded-include%2Ffoo%2Fmod.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -5,5 +5,5 @@ macro_rules! m {\n }\n \n macro_rules! n {\n-    () => { unsafe { asm!(include_str!(\"file.txt\")); } }\n+    () => { unsafe { core::arch::asm!(include_str!(\"file.txt\")); } }\n }"}, {"sha": "20da58a7e8ede719028d7fc6a44cd2dbd6bba47e", "filename": "src/test/ui/macros/macro-expanded-include/test.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacro-expanded-include%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacro-expanded-include%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-expanded-include%2Ftest.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,13 +1,13 @@\n // needs-asm-support\n // build-pass (FIXME(62277): could be check-pass?)\n-#![feature(asm)]\n #![allow(unused)]\n \n #[macro_use]\n mod foo;\n \n m!();\n-fn f() { n!(); }\n-\n+fn f() {\n+    n!();\n+}\n \n fn main() {}"}, {"sha": "66e6a2fb78323ae89045e3c65a178993723cfdb7", "filename": "src/test/ui/macros/macros-nonfatal-errors.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,7 +3,7 @@\n // test that errors in a (selection) of macros don't kill compilation\n // immediately, so that we get more errors listed at a time.\n \n-#![feature(asm, llvm_asm)]\n+#![feature(llvm_asm)]\n #![feature(trace_macros, concat_idents)]\n #![feature(stmt_expr_attributes, arbitrary_enum_discriminant)]\n #![feature(derive_default_enum)]"}, {"sha": "56e4a07843d359d4ac6efceb57754916fd4ed6a4", "filename": "src/test/ui/macros/macros-nonfatal-errors.stderr", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -126,12 +126,6 @@ LL |     Foo,\n    |\n    = help: consider a manual implementation of `Default`\n \n-error: asm template must be a string literal\n-  --> $DIR/macros-nonfatal-errors.rs:99:10\n-   |\n-LL |     asm!(invalid);\n-   |          ^^^^^^^\n-\n error: inline assembly must be a string literal\n   --> $DIR/macros-nonfatal-errors.rs:100:15\n    |\n@@ -221,5 +215,14 @@ error: trace_macros! accepts only `true` or `false`\n LL |     trace_macros!(invalid);\n    |     ^^^^^^^^^^^^^^^^^^^^^^\n \n+error: cannot find macro `asm` in this scope\n+  --> $DIR/macros-nonfatal-errors.rs:99:5\n+   |\n+LL |     asm!(invalid);\n+   |     ^^^\n+   |\n+   = note: consider importing this macro:\n+           std::arch::asm\n+\n error: aborting due to 27 previous errors\n "}, {"sha": "0045d608133a631152936d07a8bf1def003f1742", "filename": "src/test/ui/rfc-2091-track-caller/error-with-naked.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Ferror-with-naked.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Ferror-with-naked.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Ferror-with-naked.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,5 +1,7 @@\n // needs-asm-support\n-#![feature(asm, naked_functions)]\n+#![feature(naked_functions)]\n+\n+use std::arch::asm;\n \n #[track_caller] //~ ERROR cannot use `#[track_caller]` with `#[naked]`\n #[naked]"}, {"sha": "d33aecc0f97bf6087db6d0b5a979574435f1fa5a", "filename": "src/test/ui/rfc-2091-track-caller/error-with-naked.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Ferror-with-naked.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Ferror-with-naked.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Ferror-with-naked.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,11 +1,11 @@\n error[E0736]: cannot use `#[track_caller]` with `#[naked]`\n-  --> $DIR/error-with-naked.rs:4:1\n+  --> $DIR/error-with-naked.rs:6:1\n    |\n LL | #[track_caller]\n    | ^^^^^^^^^^^^^^^\n \n error[E0736]: cannot use `#[track_caller]` with `#[naked]`\n-  --> $DIR/error-with-naked.rs:13:5\n+  --> $DIR/error-with-naked.rs:15:5\n    |\n LL |     #[track_caller]\n    |     ^^^^^^^^^^^^^^^"}, {"sha": "3c69379ff1459c05b13a946008296368ed20a3e1", "filename": "src/test/ui/simple_global_asm.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fsimple_global_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Fsimple_global_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimple_global_asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,11 +1,10 @@\n // run-pass\n \n-#![feature(global_asm)]\n #![feature(naked_functions)]\n #![allow(dead_code)]\n \n #[cfg(any(target_arch = \"x86_64\", target_arch = \"x86\"))]\n-global_asm!(\n+core::arch::global_asm!(\n     r#\"\n     .global foo\n     .global _foo"}, {"sha": "fee93dc070d5b5bf03b632bf9dd82ac91bb54e7b", "filename": "src/test/ui/unsafe/inline_asm.mir.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Funsafe%2Finline_asm.mir.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Funsafe%2Finline_asm.mir.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsafe%2Finline_asm.mir.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,13 +1,13 @@\n error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n-  --> $DIR/inline_asm.rs:10:5\n+  --> $DIR/inline_asm.rs:11:5\n    |\n LL |     asm!(\"nop\");\n    |     ^^^^^^^^^^^ use of inline assembly\n    |\n    = note: inline assembly is entirely unchecked and can cause undefined behavior\n \n error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n-  --> $DIR/inline_asm.rs:11:5\n+  --> $DIR/inline_asm.rs:12:5\n    |\n LL |     llvm_asm!(\"nop\");\n    |     ^^^^^^^^^^^^^^^^ use of inline assembly"}, {"sha": "7c1f86ac0e091dc21a16a6128483ef3df2288d75", "filename": "src/test/ui/unsafe/inline_asm.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Funsafe%2Finline_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Funsafe%2Finline_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsafe%2Finline_asm.rs?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -3,9 +3,10 @@\n // needs-asm-support\n \n #![feature(llvm_asm)]\n-#![feature(asm)]\n #![allow(deprecated)] // llvm_asm!\n \n+use std::arch::asm;\n+\n fn main() {\n     asm!(\"nop\"); //~ ERROR use of inline assembly is unsafe and requires unsafe function or block\n     llvm_asm!(\"nop\"); //~ ERROR use of inline assembly is unsafe and requires unsafe function or block"}, {"sha": "fee93dc070d5b5bf03b632bf9dd82ac91bb54e7b", "filename": "src/test/ui/unsafe/inline_asm.thir.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Funsafe%2Finline_asm.thir.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/44a3a66ee890545a2c1ac78ff8f107fe5e7204f9/src%2Ftest%2Fui%2Funsafe%2Finline_asm.thir.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsafe%2Finline_asm.thir.stderr?ref=44a3a66ee890545a2c1ac78ff8f107fe5e7204f9", "patch": "@@ -1,13 +1,13 @@\n error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n-  --> $DIR/inline_asm.rs:10:5\n+  --> $DIR/inline_asm.rs:11:5\n    |\n LL |     asm!(\"nop\");\n    |     ^^^^^^^^^^^ use of inline assembly\n    |\n    = note: inline assembly is entirely unchecked and can cause undefined behavior\n \n error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n-  --> $DIR/inline_asm.rs:11:5\n+  --> $DIR/inline_asm.rs:12:5\n    |\n LL |     llvm_asm!(\"nop\");\n    |     ^^^^^^^^^^^^^^^^ use of inline assembly"}]}