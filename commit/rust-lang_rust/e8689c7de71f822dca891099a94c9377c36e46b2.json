{"sha": "e8689c7de71f822dca891099a94c9377c36e46b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4Njg5YzdkZTcxZjgyMmRjYTg5MTA5OWE5NGM5Mzc3YzM2ZTQ2YjI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2017-06-06T02:07:43Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2017-06-06T21:51:17Z"}, "message": "Fix setting PATH during linkage on windows-gnu", "tree": {"sha": "1164ef1f9278df4e473b272970386e8d391cb4ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1164ef1f9278df4e473b272970386e8d391cb4ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e8689c7de71f822dca891099a94c9377c36e46b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e8689c7de71f822dca891099a94c9377c36e46b2", "html_url": "https://github.com/rust-lang/rust/commit/e8689c7de71f822dca891099a94c9377c36e46b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e8689c7de71f822dca891099a94c9377c36e46b2/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d015610db7b7d30f3c92d3272ce166397a81349e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d015610db7b7d30f3c92d3272ce166397a81349e", "html_url": "https://github.com/rust-lang/rust/commit/d015610db7b7d30f3c92d3272ce166397a81349e"}], "stats": {"total": 20, "additions": 11, "deletions": 9}, "files": [{"sha": "e57cbb1c910137e8452e7dc4e7043a0094d83eaf", "filename": "src/librustc_trans/back/link.rs", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e8689c7de71f822dca891099a94c9377c36e46b2/src%2Flibrustc_trans%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8689c7de71f822dca891099a94c9377c36e46b2/src%2Flibrustc_trans%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flink.rs?ref=e8689c7de71f822dca891099a94c9377c36e46b2", "patch": "@@ -141,17 +141,20 @@ pub fn build_link_meta(incremental_hashes_map: &IncrementalHashesMap) -> LinkMet\n     return r;\n }\n \n-// The third parameter is for an env vars, used to set up the path for MSVC\n-// to find its DLLs\n+// The third parameter is for env vars, used on windows to set up the\n+// path for MSVC to find its DLLs, and gcc to find its bundled\n+// toolchain\n pub fn get_linker(sess: &Session) -> (String, Command, Vec<(OsString, OsString)>) {\n+    let envs = vec![(\"PATH\".into(), command_path(sess))];\n+\n     if let Some(ref linker) = sess.opts.cg.linker {\n-        (linker.clone(), Command::new(linker), vec![])\n+        (linker.clone(), Command::new(linker), envs)\n     } else if sess.target.target.options.is_like_msvc {\n         let (cmd, envs) = msvc_link_exe_cmd(sess);\n         (\"link.exe\".to_string(), cmd, envs)\n     } else {\n-        (sess.target.target.options.linker.clone(),\n-         Command::new(&sess.target.target.options.linker), vec![])\n+        let linker = &sess.target.target.options.linker;\n+        (linker.clone(), Command::new(&linker), envs)\n     }\n }\n \n@@ -182,15 +185,14 @@ pub fn get_ar_prog(sess: &Session) -> String {\n     })\n }\n \n-fn command_path(sess: &Session, extra: Option<PathBuf>) -> OsString {\n+fn command_path(sess: &Session) -> OsString {\n     // The compiler's sysroot often has some bundled tools, so add it to the\n     // PATH for the child.\n     let mut new_path = sess.host_filesearch(PathKind::All)\n                            .get_tools_search_paths();\n     if let Some(path) = env::var_os(\"PATH\") {\n         new_path.extend(env::split_paths(&path));\n     }\n-    new_path.extend(extra);\n     env::join_paths(new_path).unwrap()\n }\n \n@@ -451,7 +453,7 @@ fn archive_config<'a>(sess: &'a Session,\n         src: input.map(|p| p.to_path_buf()),\n         lib_search_paths: archive_search_paths(sess),\n         ar_prog: get_ar_prog(sess),\n-        command_path: command_path(sess, None),\n+        command_path: command_path(sess),\n     }\n }\n \n@@ -727,7 +729,7 @@ fn link_natively(sess: &Session,\n \n     // The invocations of cc share some flags across platforms\n     let (pname, mut cmd, envs) = get_linker(sess);\n-    // This will set PATH on MSVC\n+    // This will set PATH on windows\n     cmd.envs(envs);\n \n     let root = sess.target_filesearch(PathKind::Native).get_lib_path();"}]}