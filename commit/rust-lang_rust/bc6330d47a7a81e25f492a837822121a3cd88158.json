{"sha": "bc6330d47a7a81e25f492a837822121a3cd88158", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjNjMzMGQ0N2E3YTgxZTI1ZjQ5MmE4Mzc4MjIxMjFhM2NkODgxNTg=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2021-05-13T01:39:37Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2021-05-13T01:43:09Z"}, "message": "Don't suggest adding `'static` lifetime to arguments\n\nFixes #69350\n\nThis is almost always the wrong this to do", "tree": {"sha": "f3deaf98dece0cfe67b506652e972824a5433d41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f3deaf98dece0cfe67b506652e972824a5433d41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bc6330d47a7a81e25f492a837822121a3cd88158", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAmCchEoACgkQtAh+UQ6Y\nsWS9HRAAhNTFF8CH5z433Dg/J4LfD12e1cDicwSMLQo8pgxd90+GWz4KzhyyEKC3\nxpMgLOTXIC0oPqm1Yd5Dqt6BOads2nT16A7J3JK6Tok+eGFz27pYVFEtDHO0aFSw\nICuEmjv/ZaACDPHfFtz79Y3jy9J971/M4Ct+OXdDWbmkhLJXINGZ6JuKRJ8hlHdg\n+uLtctDUsq4y/dgRv6faARK/9TkI2NzXGMkwWxFXwC/GJ8NL6o9hDBc8M05Cs9CF\nAvnHLUVq7eKB+8JX3StYnR8PRLKJSJylz7cM6/a2kP2rbR8qTDQcJlQMkma7bOIG\nTE0I0ZG2pAhbrzOb3tRBddxSH8CmJE6LWznwD7dYWkeb+EqdWCFNpEEWs8h+jq3f\nIvWAGyhsDY1Ix2yqoo5nwFiDkBaBibswn3ch5mXF9KVFZedoWAsGkSvl87SVZsZY\nBeMJB+JwLBlB+i+JnhCwQ5132TkrP7l1RCe7WXCLPWRmrEOSLhk173V8534LwvVc\nf6T5TCkxqR6OY39nCu9j2DJeJ6lvN1ZT+uBNV4IBVxtv5fYqhcxQVjGEdLj6JZQ0\nHY8vhrj8FmRjjXdHTAJcab04Lhkks6YvNNHXOLXit5cOM6bGn69mlaXmqU6F70Sz\n8gDHuUXuCNioSaYPIJbLMHMa9tp8cHf62m7TCGCdmQL9UQIFF9k=\n=PpjJ\n-----END PGP SIGNATURE-----", "payload": "tree f3deaf98dece0cfe67b506652e972824a5433d41\nparent 31bd868c39fd9ded7dd3a373bdcf9e8a45aadfe4\nauthor Aaron Hill <aa1ronham@gmail.com> 1620869977 -0400\ncommitter Aaron Hill <aa1ronham@gmail.com> 1620870189 -0400\n\nDon't suggest adding `'static` lifetime to arguments\n\nFixes #69350\n\nThis is almost always the wrong this to do\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bc6330d47a7a81e25f492a837822121a3cd88158", "html_url": "https://github.com/rust-lang/rust/commit/bc6330d47a7a81e25f492a837822121a3cd88158", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bc6330d47a7a81e25f492a837822121a3cd88158/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31bd868c39fd9ded7dd3a373bdcf9e8a45aadfe4", "url": "https://api.github.com/repos/rust-lang/rust/commits/31bd868c39fd9ded7dd3a373bdcf9e8a45aadfe4", "html_url": "https://github.com/rust-lang/rust/commit/31bd868c39fd9ded7dd3a373bdcf9e8a45aadfe4"}], "stats": {"total": 51, "additions": 10, "deletions": 41}, "files": [{"sha": "0878f8550da35a6a3d7abf830039bbc4943124ad", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/named_anon_conflict.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fnamed_anon_conflict.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fnamed_anon_conflict.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fnamed_anon_conflict.rs?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -114,12 +114,16 @@ impl<'a, 'tcx> NiceRegionError<'a, 'tcx> {\n         );\n \n         diag.span_label(span, format!(\"lifetime `{}` required\", named));\n-        diag.span_suggestion(\n-            new_ty_span,\n-            &format!(\"add explicit lifetime `{}` to {}\", named, span_label_var),\n-            new_ty.to_string(),\n-            Applicability::Unspecified,\n-        );\n+        // Suggesting `'static` is nearly always incorrect, and can steer users\n+        // down the wrong path.\n+        if *named != ty::ReStatic {\n+            diag.span_suggestion(\n+                new_ty_span,\n+                &format!(\"add explicit lifetime `{}` to {}\", named, span_label_var),\n+                new_ty.to_string(),\n+                Applicability::Unspecified,\n+            );\n+        }\n \n         Some(diag)\n     }"}, {"sha": "1b0e0902d67ba3fe88cf9fe345b41d64071c2015", "filename": "src/test/ui/closures/closure-bounds-static-cant-capture-borrowed.nll.stderr", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fclosures%2Fclosure-bounds-static-cant-capture-borrowed.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fclosures%2Fclosure-bounds-static-cant-capture-borrowed.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2Fclosure-bounds-static-cant-capture-borrowed.nll.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -1,8 +1,6 @@\n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/closure-bounds-static-cant-capture-borrowed.rs:5:5\n    |\n-LL |   fn foo(x: &()) {\n-   |             --- help: add explicit lifetime `'static` to the type of `x`: `&'static ()`\n LL | /     bar(|| {\n LL | |\n LL | |         let _ = x;"}, {"sha": "a9add6184f13eab5f969eee592ffe031b1b3ed9c", "filename": "src/test/ui/closures/closure-bounds-static-cant-capture-borrowed.stderr", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fclosures%2Fclosure-bounds-static-cant-capture-borrowed.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fclosures%2Fclosure-bounds-static-cant-capture-borrowed.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2Fclosure-bounds-static-cant-capture-borrowed.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -1,8 +1,6 @@\n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/closure-bounds-static-cant-capture-borrowed.rs:5:5\n    |\n-LL | fn foo(x: &()) {\n-   |           --- help: add explicit lifetime `'static` to the type of `x`: `&'static ()`\n LL |     bar(|| {\n    |     ^^^ lifetime `'static` required\n "}, {"sha": "de90a599e76b79189f94b6718eb8cde298b386ec", "filename": "src/test/ui/generator/generator-region-requirements.stderr", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fgenerator%2Fgenerator-region-requirements.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fgenerator%2Fgenerator-region-requirements.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerator%2Fgenerator-region-requirements.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -1,9 +1,6 @@\n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/generator-region-requirements.rs:12:51\n    |\n-LL | fn dangle(x: &mut i32) -> &'static mut i32 {\n-   |              -------- help: add explicit lifetime `'static` to the type of `x`: `&'static mut i32`\n-...\n LL |             GeneratorState::Complete(c) => return c,\n    |                                                   ^ lifetime `'static` required\n "}, {"sha": "aec878625661bef9bb668b8d7f0300515432dc84", "filename": "src/test/ui/generic-associated-types/projection-type-lifetime-mismatch.stderr", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fprojection-type-lifetime-mismatch.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fprojection-type-lifetime-mismatch.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fprojection-type-lifetime-mismatch.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -1,24 +1,18 @@\n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/projection-type-lifetime-mismatch.rs:18:5\n    |\n-LL | fn f(x: &impl for<'a> X<Y<'a> = &'a ()>) -> &'static () {\n-   |         ------------------------------- help: add explicit lifetime `'static` to the type of `x`: `&'static impl for<'a> X<Y<'a> = &'a ()>`\n LL |     x.m()\n    |     ^^^^^ lifetime `'static` required\n \n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/projection-type-lifetime-mismatch.rs:23:5\n    |\n-LL | fn g<T: for<'a> X<Y<'a> = &'a ()>>(x: &T) -> &'static () {\n-   |                                       -- help: add explicit lifetime `'static` to the type of `x`: `&'static T`\n LL |     x.m()\n    |     ^^^^^ lifetime `'static` required\n \n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/projection-type-lifetime-mismatch.rs:28:5\n    |\n-LL | fn h(x: &()) -> &'static () {\n-   |         --- help: add explicit lifetime `'static` to the type of `x`: `&'static ()`\n LL |     x.m()\n    |     ^^^^^ lifetime `'static` required\n "}, {"sha": "d328329edad22209166ef61166d347bf00c959f1", "filename": "src/test/ui/issues/issue-46983.stderr", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fissues%2Fissue-46983.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fissues%2Fissue-46983.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-46983.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -1,8 +1,6 @@\n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/issue-46983.rs:2:5\n    |\n-LL | fn foo(x: &u32) -> &'static u32 {\n-   |           ---- help: add explicit lifetime `'static` to the type of `x`: `&'static u32`\n LL |     &*x\n    |     ^^^ lifetime `'static` required\n "}, {"sha": "4c302d935db96338085329cd6099a5e99e397082", "filename": "src/test/ui/nll/closure-requirements/region-lbr-anon-does-not-outlive-static.stderr", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fregion-lbr-anon-does-not-outlive-static.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fregion-lbr-anon-does-not-outlive-static.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fregion-lbr-anon-does-not-outlive-static.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -1,8 +1,6 @@\n error[E0621]: explicit lifetime required in the type of `x`\n   --> $DIR/region-lbr-anon-does-not-outlive-static.rs:9:5\n    |\n-LL | fn foo(x: &u32) -> &'static u32 {\n-   |           ---- help: add explicit lifetime `ReStatic` to the type of `x`: `&ReStatic u32`\n LL |     &*x\n    |     ^^^ lifetime `ReStatic` required\n "}, {"sha": "eabc3105c029307a119e5a94489f6aca70d55784", "filename": "src/test/ui/nll/guarantor-issue-46974.stderr", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fnll%2Fguarantor-issue-46974.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fnll%2Fguarantor-issue-46974.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fguarantor-issue-46974.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -12,9 +12,6 @@ LL |     *x\n error[E0621]: explicit lifetime required in the type of `s`\n   --> $DIR/guarantor-issue-46974.rs:15:5\n    |\n-LL | fn bar(s: &Box<(i32,)>) -> &'static i32 {\n-   |           ------------ help: add explicit lifetime `'static` to the type of `s`: `&'static Box<(i32,)>`\n-LL |     // FIXME(#46983): error message should be better\n LL |     &s.0\n    |     ^^^^ lifetime `'static` required\n "}, {"sha": "a4c8e721145eb4c3afef74e83f2f550d9e80e21d", "filename": "src/test/ui/regions/regions-static-bound.migrate.nll.stderr", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.migrate.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.migrate.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.migrate.nll.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -11,17 +11,12 @@ LL |     t\n error[E0621]: explicit lifetime required in the type of `u`\n   --> $DIR/regions-static-bound.rs:14:5\n    |\n-LL | fn error(u: &(), v: &()) {\n-   |             --- help: add explicit lifetime `'static` to the type of `u`: `&'static ()`\n LL |     static_id(&u);\n    |     ^^^^^^^^^^^^^ lifetime `'static` required\n \n error[E0621]: explicit lifetime required in the type of `v`\n   --> $DIR/regions-static-bound.rs:16:5\n    |\n-LL | fn error(u: &(), v: &()) {\n-   |                     --- help: add explicit lifetime `'static` to the type of `v`: `&'static ()`\n-...\n LL |     static_id_indirect(&v);\n    |     ^^^^^^^^^^^^^^^^^^^^^^ lifetime `'static` required\n "}, {"sha": "644458e2063ce8efa80f3c44ace25de2a1184e20", "filename": "src/test/ui/regions/regions-static-bound.migrate.stderr", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.migrate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.migrate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.migrate.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -14,17 +14,12 @@ LL | fn static_id_wrong_way<'a>(t: &'a ()) -> &'static () where 'static: 'a {\n error[E0621]: explicit lifetime required in the type of `u`\n   --> $DIR/regions-static-bound.rs:14:5\n    |\n-LL | fn error(u: &(), v: &()) {\n-   |             --- help: add explicit lifetime `'static` to the type of `u`: `&'static ()`\n LL |     static_id(&u);\n    |     ^^^^^^^^^ lifetime `'static` required\n \n error[E0621]: explicit lifetime required in the type of `v`\n   --> $DIR/regions-static-bound.rs:16:5\n    |\n-LL | fn error(u: &(), v: &()) {\n-   |                     --- help: add explicit lifetime `'static` to the type of `v`: `&'static ()`\n-...\n LL |     static_id_indirect(&v);\n    |     ^^^^^^^^^^^^^^^^^^ lifetime `'static` required\n "}, {"sha": "a4c8e721145eb4c3afef74e83f2f550d9e80e21d", "filename": "src/test/ui/regions/regions-static-bound.nll.stderr", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc6330d47a7a81e25f492a837822121a3cd88158/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-static-bound.nll.stderr?ref=bc6330d47a7a81e25f492a837822121a3cd88158", "patch": "@@ -11,17 +11,12 @@ LL |     t\n error[E0621]: explicit lifetime required in the type of `u`\n   --> $DIR/regions-static-bound.rs:14:5\n    |\n-LL | fn error(u: &(), v: &()) {\n-   |             --- help: add explicit lifetime `'static` to the type of `u`: `&'static ()`\n LL |     static_id(&u);\n    |     ^^^^^^^^^^^^^ lifetime `'static` required\n \n error[E0621]: explicit lifetime required in the type of `v`\n   --> $DIR/regions-static-bound.rs:16:5\n    |\n-LL | fn error(u: &(), v: &()) {\n-   |                     --- help: add explicit lifetime `'static` to the type of `v`: `&'static ()`\n-...\n LL |     static_id_indirect(&v);\n    |     ^^^^^^^^^^^^^^^^^^^^^^ lifetime `'static` required\n "}]}