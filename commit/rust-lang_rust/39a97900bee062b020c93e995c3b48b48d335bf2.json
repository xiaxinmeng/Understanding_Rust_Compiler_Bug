{"sha": "39a97900bee062b020c93e995c3b48b48d335bf2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5YTk3OTAwYmVlMDYyYjAyMGM5M2U5OTVjM2I0OGI0OGQzMzViZjI=", "commit": {"author": {"name": "Markus Reiter", "email": "me@reitermark.us", "date": "2020-05-02T05:05:22Z"}, "committer": {"name": "Markus Reiter", "email": "me@reitermark.us", "date": "2020-05-02T15:06:16Z"}, "message": "Replace `cfg` macro with attribute.", "tree": {"sha": "055e2adc1fc05191fdc56d6bdcf9903c54b0018a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/055e2adc1fc05191fdc56d6bdcf9903c54b0018a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/39a97900bee062b020c93e995c3b48b48d335bf2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/39a97900bee062b020c93e995c3b48b48d335bf2", "html_url": "https://github.com/rust-lang/rust/commit/39a97900bee062b020c93e995c3b48b48d335bf2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/39a97900bee062b020c93e995c3b48b48d335bf2/comments", "author": {"login": "reitermarkus", "id": 1309829, "node_id": "MDQ6VXNlcjEzMDk4Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/1309829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reitermarkus", "html_url": "https://github.com/reitermarkus", "followers_url": "https://api.github.com/users/reitermarkus/followers", "following_url": "https://api.github.com/users/reitermarkus/following{/other_user}", "gists_url": "https://api.github.com/users/reitermarkus/gists{/gist_id}", "starred_url": "https://api.github.com/users/reitermarkus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reitermarkus/subscriptions", "organizations_url": "https://api.github.com/users/reitermarkus/orgs", "repos_url": "https://api.github.com/users/reitermarkus/repos", "events_url": "https://api.github.com/users/reitermarkus/events{/privacy}", "received_events_url": "https://api.github.com/users/reitermarkus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "reitermarkus", "id": 1309829, "node_id": "MDQ6VXNlcjEzMDk4Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/1309829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reitermarkus", "html_url": "https://github.com/reitermarkus", "followers_url": "https://api.github.com/users/reitermarkus/followers", "following_url": "https://api.github.com/users/reitermarkus/following{/other_user}", "gists_url": "https://api.github.com/users/reitermarkus/gists{/gist_id}", "starred_url": "https://api.github.com/users/reitermarkus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reitermarkus/subscriptions", "organizations_url": "https://api.github.com/users/reitermarkus/orgs", "repos_url": "https://api.github.com/users/reitermarkus/repos", "events_url": "https://api.github.com/users/reitermarkus/events{/privacy}", "received_events_url": "https://api.github.com/users/reitermarkus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7184d137f65bb8d143ce8b5b664e50d33c4b5fbd", "url": "https://api.github.com/repos/rust-lang/rust/commits/7184d137f65bb8d143ce8b5b664e50d33c4b5fbd", "html_url": "https://github.com/rust-lang/rust/commit/7184d137f65bb8d143ce8b5b664e50d33c4b5fbd"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "6115d652b0cea3975ff26d5d60e4d0c92df38d00", "filename": "src/libstd/sys/windows/c.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/39a97900bee062b020c93e995c3b48b48d335bf2/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39a97900bee062b020c93e995c3b48b48d335bf2/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs?ref=39a97900bee062b020c93e995c3b48b48d335bf2", "patch": "@@ -216,7 +216,6 @@ pub const SOCK_STREAM: c_int = 1;\n pub const SOL_SOCKET: c_int = 0xffff;\n pub const SO_RCVTIMEO: c_int = 0x1006;\n pub const SO_SNDTIMEO: c_int = 0x1005;\n-pub const SO_REUSEADDR: c_int = 0x0004;\n pub const IPPROTO_IP: c_int = 0;\n pub const IPPROTO_TCP: c_int = 6;\n pub const IPPROTO_IPV6: c_int = 41;"}, {"sha": "1c03bc923444873ab5b82249881a02f5a7a1b78b", "filename": "src/libstd/sys_common/net.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/39a97900bee062b020c93e995c3b48b48d335bf2/src%2Flibstd%2Fsys_common%2Fnet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39a97900bee062b020c93e995c3b48b48d335bf2/src%2Flibstd%2Fsys_common%2Fnet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys_common%2Fnet.rs?ref=39a97900bee062b020c93e995c3b48b48d335bf2", "patch": "@@ -368,12 +368,15 @@ impl TcpListener {\n \n         let sock = Socket::new(addr, c::SOCK_STREAM)?;\n \n-        // On platforms with Berkeley-derived sockets, this allows\n-        // to quickly rebind a socket, without needing to wait for\n-        // the OS to clean up the previous one.\n-        if !cfg!(windows) {\n-            setsockopt(&sock, c::SOL_SOCKET, c::SO_REUSEADDR, 1 as c_int)?;\n-        }\n+        // On platforms with Berkeley-derived sockets, this allows to quickly\n+        // rebind a socket, without needing to wait for the OS to clean up the\n+        // previous one.\n+        //\n+        // On Windows, this allows rebinding sockets which are actively in use,\n+        // which allows \u201csocket hijacking\u201d, so we explicitly don't set it here.\n+        // https://docs.microsoft.com/en-us/windows/win32/winsock/using-so-reuseaddr-and-so-exclusiveaddruse\n+        #[cfg(not(windows))]\n+        setsockopt(&sock, c::SOL_SOCKET, c::SO_REUSEADDR, 1 as c_int)?;\n \n         // Bind our new socket\n         let (addrp, len) = addr.into_inner();"}]}