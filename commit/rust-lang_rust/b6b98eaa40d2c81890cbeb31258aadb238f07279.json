{"sha": "b6b98eaa40d2c81890cbeb31258aadb238f07279", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2Yjk4ZWFhNDBkMmM4MTg5MGNiZWIzMTI1OGFhZGIyMzhmMDcyNzk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-11-13T06:36:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-11-13T06:36:49Z"}, "message": "Auto merge of #37728 - QuietMisdreavus:rustdoc-enum-struct, r=GuillaumeGomez\n\nrustdoc: fold fields for enum struct variants into a docblock\n\nPer discussion in #37500, this PR updates the enum rendering code to wrap variants with named struct fields in a `docblock` span that is hidden automatically upon load of the page. This gives struct variant fields a clean separation from other enum variants, giving a boost to the readability of such documentation. Preview output is available [on the issue page](https://github.com/rust-lang/rust/issues/37500#issuecomment-260069269), but for the sake of completeness I'll include the images here again.\n\n![rustdoc struct enum variant 4 part 1](https://cloud.githubusercontent.com/assets/5217170/20231925/96160b7e-a82a-11e6-945b-bbba95c5e4bc.PNG)\n\nWhen you initially load the page, there's a line under variants with struct fields letting you know you can click to expand the listing.\n\n![rustdoc struct enum variant 4 part 2](https://cloud.githubusercontent.com/assets/3050060/20232067/1dc63266-a866-11e6-9555-8fb1c8afdcec.png)\n\nIf you click to expand, the header and table unfold into a nicely-indented listing.\n\nIf you want to take a look in your own browser and screen size, [I've got this version hosted on my server](https://shiva.icesoldier.me/doctest/doctest/enum.OldTopicRemoval.html).\n\nFixes #37500\n\nr? @GuillaumeGomez", "tree": {"sha": "bee0add735ab2d3c38542765d58f9edd1e5cdaea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bee0add735ab2d3c38542765d58f9edd1e5cdaea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6b98eaa40d2c81890cbeb31258aadb238f07279", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6b98eaa40d2c81890cbeb31258aadb238f07279", "html_url": "https://github.com/rust-lang/rust/commit/b6b98eaa40d2c81890cbeb31258aadb238f07279", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6b98eaa40d2c81890cbeb31258aadb238f07279/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c2b0e6347064da85ef776832bc94f4fa0d152e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c2b0e6347064da85ef776832bc94f4fa0d152e4", "html_url": "https://github.com/rust-lang/rust/commit/8c2b0e6347064da85ef776832bc94f4fa0d152e4"}, {"sha": "fff921672f8e679c42d0659c475ee57fddac13b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/fff921672f8e679c42d0659c475ee57fddac13b6", "html_url": "https://github.com/rust-lang/rust/commit/fff921672f8e679c42d0659c475ee57fddac13b6"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "5aed37edbd42045b7e7007466c98769a4597b281", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b6b98eaa40d2c81890cbeb31258aadb238f07279/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6b98eaa40d2c81890cbeb31258aadb238f07279/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=b6b98eaa40d2c81890cbeb31258aadb238f07279", "patch": "@@ -2488,8 +2488,13 @@ fn item_enum(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n             if let clean::VariantItem(Variant {\n                 kind: VariantKind::Struct(ref s)\n             }) = variant.inner {\n-                write!(w, \"<h3 class='fields'>Fields</h3>\\n\n-                           <table>\")?;\n+                let variant_id = derive_id(format!(\"{}.{}.fields\",\n+                                                   ItemType::Variant,\n+                                                   variant.name.as_ref().unwrap()));\n+                write!(w, \"<span class='docblock autohide sub-variant' id='{id}'>\",\n+                       id = variant_id)?;\n+                write!(w, \"<h3 class='fields'>Fields of <code>{name}</code></h3>\\n\n+                           <table>\", name = variant.name.as_ref().unwrap())?;\n                 for field in &s.fields {\n                     use clean::StructFieldItem;\n                     if let StructFieldItem(ref ty) = field.inner {\n@@ -2513,7 +2518,7 @@ fn item_enum(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n                         write!(w, \"</td></tr>\")?;\n                     }\n                 }\n-                write!(w, \"</table>\")?;\n+                write!(w, \"</table></span>\")?;\n             }\n             render_stability_since(w, variant, it)?;\n         }"}, {"sha": "5ffab949d019c38afde76552f7d07b9e5d2bd861", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b6b98eaa40d2c81890cbeb31258aadb238f07279/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/b6b98eaa40d2c81890cbeb31258aadb238f07279/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=b6b98eaa40d2c81890cbeb31258aadb238f07279", "patch": "@@ -1013,6 +1013,22 @@\n                     .html('&nbsp;Expand&nbsp;description'));\n         var wrapper = $(\"<div class='toggle-wrapper'>\").append(mainToggle);\n         $(\"#main > .docblock\").before(wrapper);\n+\n+        $(\".docblock.autohide\").each(function() {\n+            var wrap = $(this).prev();\n+            if (wrap.is(\".toggle-wrapper\")) {\n+                var toggle = wrap.children().first();\n+                if ($(this).children().first().is(\"h3\")) {\n+                    toggle.children(\".toggle-label\")\n+                          .text(\" Show \" + $(this).children().first().text());\n+                }\n+                $(this).hide();\n+                wrap.addClass(\"collapsed\");\n+                toggle.children(\".inner\").text(labelForToggleButton(true));\n+                toggle.children(\".toggle-label\").show();\n+            }\n+        });\n+\n         var mainToggle =\n             $(toggle).append(\n                 $('<span/>', {'class': 'toggle-label'})"}, {"sha": "7ee184c089ca44503437dc98102b555962bdffcc", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b6b98eaa40d2c81890cbeb31258aadb238f07279/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/b6b98eaa40d2c81890cbeb31258aadb238f07279/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=b6b98eaa40d2c81890cbeb31258aadb238f07279", "patch": "@@ -339,6 +339,10 @@ h4 > code, h3 > code, .invisible > code {\n \tborder-bottom: 1px solid;\n }\n \n+.fields + table {\n+\tmargin-bottom: 1em;\n+}\n+\n .content .item-list {\n \tlist-style-type: none;\n \tpadding: 0;\n@@ -671,6 +675,10 @@ span.since {\n \tmargin-top: 5px;\n }\n \n+.sub-variant, .sub-variant > h3 {\n+\tmargin-top: 0 !important;\n+}\n+\n .enum > .toggle-wrapper + .docblock, .struct > .toggle-wrapper + .docblock {\n \tmargin-left: 30px;\n \tmargin-bottom: 20px;"}]}