{"sha": "55568419acfc312ac0d4200ed3334040f2034c4b", "node_id": "C_kwDOAAsO6NoAKDU1NTY4NDE5YWNmYzMxMmFjMGQ0MjAwZWQzMzM0MDQwZjIwMzRjNGI", "commit": {"author": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-10-29T17:32:04Z"}, "committer": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-10-29T22:21:27Z"}, "message": "fix #103783, fix ICE checking transmutability of NaughtyLenArray", "tree": {"sha": "20058c7cd898ec06f917d6d7677ec905b27b6129", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20058c7cd898ec06f917d6d7677ec905b27b6129"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/55568419acfc312ac0d4200ed3334040f2034c4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/55568419acfc312ac0d4200ed3334040f2034c4b", "html_url": "https://github.com/rust-lang/rust/commit/55568419acfc312ac0d4200ed3334040f2034c4b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/55568419acfc312ac0d4200ed3334040f2034c4b/comments", "author": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "126dbdc9c78446ad4cf41f5f8510a7cee59ff966", "url": "https://api.github.com/repos/rust-lang/rust/commits/126dbdc9c78446ad4cf41f5f8510a7cee59ff966", "html_url": "https://github.com/rust-lang/rust/commit/126dbdc9c78446ad4cf41f5f8510a7cee59ff966"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "2bc6bc1fc23aefd98135e45626a433f34acc721f", "filename": "compiler/rustc_transmute/src/layout/tree.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/55568419acfc312ac0d4200ed3334040f2034c4b/compiler%2Frustc_transmute%2Fsrc%2Flayout%2Ftree.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55568419acfc312ac0d4200ed3334040f2034c4b/compiler%2Frustc_transmute%2Fsrc%2Flayout%2Ftree.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_transmute%2Fsrc%2Flayout%2Ftree.rs?ref=55568419acfc312ac0d4200ed3334040f2034c4b", "patch": "@@ -284,7 +284,8 @@ pub(crate) mod rustc {\n                 }\n \n                 ty::Array(ty, len) => {\n-                    let len = len.try_eval_usize(tcx, ParamEnv::reveal_all()).unwrap();\n+                    let len =\n+                        len.try_eval_usize(tcx, ParamEnv::reveal_all()).ok_or(Err::Unspecified)?;\n                     let elt = Tree::from_ty(*ty, tcx)?;\n                     Ok(std::iter::repeat(elt)\n                         .take(len as usize)"}, {"sha": "cb36e539ed11a1e7299b2a1a5ac2e72168d9cf96", "filename": "src/test/ui/transmutability/arrays/issue-103783-array-length.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/55568419acfc312ac0d4200ed3334040f2034c4b/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55568419acfc312ac0d4200ed3334040f2034c4b/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.rs?ref=55568419acfc312ac0d4200ed3334040f2034c4b", "patch": "@@ -0,0 +1,24 @@\n+#![crate_type = \"lib\"]\n+#![feature(transmutability)]\n+#![allow(dead_code)]\n+\n+mod assert {\n+    use std::mem::{Assume, BikeshedIntrinsicFrom};\n+    pub struct Context;\n+\n+    pub fn is_maybe_transmutable<Src, Dst>()\n+    where\n+        Dst: BikeshedIntrinsicFrom<\n+            Src,\n+            Context,\n+            { Assume { alignment: true, lifetimes: true, safety: true, validity: true } },\n+        >,\n+    {\n+    }\n+}\n+\n+fn test() {\n+    type NaughtyLenArray = [u32; 3.14159]; //~ ERROR mismatched types\n+    type JustUnit = ();\n+    assert::is_maybe_transmutable::<JustUnit, NaughtyLenArray>();\n+}"}, {"sha": "37774c59e6cbb50af0efab097df8ec3c442698a6", "filename": "src/test/ui/transmutability/arrays/issue-103783-array-length.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/55568419acfc312ac0d4200ed3334040f2034c4b/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/55568419acfc312ac0d4200ed3334040f2034c4b/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.stderr?ref=55568419acfc312ac0d4200ed3334040f2034c4b", "patch": "@@ -0,0 +1,9 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-103783-array-length.rs:21:34\n+   |\n+LL |     type NaughtyLenArray = [u32; 3.14159];\n+   |                                  ^^^^^^^ expected `usize`, found floating-point number\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}