{"sha": "5c52e05498a31c1d67834eee39d96081a708029f", "node_id": "C_kwDOAAsO6NoAKDVjNTJlMDU0OThhMzFjMWQ2NzgzNGVlZTM5ZDk2MDgxYTcwODAyOWY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-26T13:35:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-26T13:35:13Z"}, "message": "Auto merge of #13110 - DesmondWillowbrook:issue-11197, r=jonas-schievink\n\nfix: make \"Extract type as type alias\" assist work with const generics in array\n\nfixes #11197", "tree": {"sha": "1e2541525150622427a25cd94838b9601cc32148", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e2541525150622427a25cd94838b9601cc32148"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c52e05498a31c1d67834eee39d96081a708029f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c52e05498a31c1d67834eee39d96081a708029f", "html_url": "https://github.com/rust-lang/rust/commit/5c52e05498a31c1d67834eee39d96081a708029f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c52e05498a31c1d67834eee39d96081a708029f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca8093e282cdcdfb94d2d8adc224b7d05b151f8e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca8093e282cdcdfb94d2d8adc224b7d05b151f8e", "html_url": "https://github.com/rust-lang/rust/commit/ca8093e282cdcdfb94d2d8adc224b7d05b151f8e"}, {"sha": "0d7ba13b7227c66774decc059d96246ac05558da", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d7ba13b7227c66774decc059d96246ac05558da", "html_url": "https://github.com/rust-lang/rust/commit/0d7ba13b7227c66774decc059d96246ac05558da"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "03aa8601d14e1ef3e34207da916dd4574d175bbf", "filename": "crates/ide-assists/src/handlers/extract_type_alias.rs", "status": "modified", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/5c52e05498a31c1d67834eee39d96081a708029f/crates%2Fide-assists%2Fsrc%2Fhandlers%2Fextract_type_alias.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c52e05498a31c1d67834eee39d96081a708029f/crates%2Fide-assists%2Fsrc%2Fhandlers%2Fextract_type_alias.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-assists%2Fsrc%2Fhandlers%2Fextract_type_alias.rs?ref=5c52e05498a31c1d67834eee39d96081a708029f", "patch": "@@ -171,6 +171,25 @@ fn collect_used_generics<'gp>(\n         ast::Type::RefType(ref_) => generics.extend(\n             ref_.lifetime().and_then(|lt| known_generics.iter().find(find_lifetime(&lt.text()))),\n         ),\n+        ast::Type::ArrayType(ar) => {\n+            if let Some(expr) = ar.expr() {\n+                if let ast::Expr::PathExpr(p) = expr {\n+                    if let Some(path) = p.path() {\n+                        if let Some(name_ref) = path.as_single_name_ref() {\n+                            if let Some(param) = known_generics.iter().find(|gp| {\n+                                if let ast::GenericParam::ConstParam(cp) = gp {\n+                                    cp.name().map_or(false, |n| n.text() == name_ref.text())\n+                                } else {\n+                                    false\n+                                }\n+                            }) {\n+                                generics.push(param);\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n         _ => (),\n     });\n     // stable resort to lifetime, type, const\n@@ -357,4 +376,29 @@ impl<'outer, Outer, const OUTER: usize> () {\n \"#,\n         );\n     }\n+\n+    #[test]\n+    fn issue_11197() {\n+        check_assist(\n+            extract_type_alias,\n+            r#\"\n+struct Foo<T, const N: usize>\n+where\n+    [T; N]: Sized,\n+{\n+    arr: $0[T; N]$0,\n+}\n+            \"#,\n+            r#\"\n+type $0Type<T, const N: usize> = [T; N];\n+\n+struct Foo<T, const N: usize>\n+where\n+    [T; N]: Sized,\n+{\n+    arr: Type<T, N>,\n+}\n+            \"#,\n+        );\n+    }\n }"}]}