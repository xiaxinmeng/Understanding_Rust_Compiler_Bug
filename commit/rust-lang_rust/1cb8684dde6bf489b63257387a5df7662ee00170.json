{"sha": "1cb8684dde6bf489b63257387a5df7662ee00170", "node_id": "C_kwDOAAsO6NoAKDFjYjg2ODRkZGU2YmY0ODliNjMyNTczODdhNWRmNzY2MmVlMDAxNzA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-04T17:52:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-04T17:52:27Z"}, "message": "Rollup merge of #103792 - JhonnyBillM:migrate-codegen-ssa-to-diagnostics-structs-pt2, r=davidtwco\n\nMigrate `codegen_ssa` to diagnostics structs - [Part 2]\n\nCompletes migrating `link.rs` in `codegen_ssa` module.\n\n_Part 1 - https://github.com/rust-lang/rust/pull/102612_\n\nr? `@davidtwco`", "tree": {"sha": "e8e4de55a1b689d72c50a4db654691772f70e9de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e8e4de55a1b689d72c50a4db654691772f70e9de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1cb8684dde6bf489b63257387a5df7662ee00170", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjZVFbCRBK7hj4Ov3rIwAAra0IAKftq8MhH61ONAnSQPbmRm86\nyTch+KfHdEpNI+JaQQKgYIdgNZFcETpyzq8Y14Sz2EEqAGV3S8Mxpx3YjRT2ErjA\nhypdlys27Lkb7ABlB8aIFl1WizTbNz8fz+argXHAJpU9pLVdNFyHOXzqTzvORPN8\n1FxgcWmzyBeQx/AsNX6o456NrtJXr4XRnhNpey661olG273v5Z7rpKl1cjDzwh/8\n1zSLEYjXxL/a4yuKx6sJTzYcVNhHYi8Qwuw5wSKNwtmI4eDDTBXbNB3aj4hUoMsB\nENas/YxWj/omg/BgUUyG9B2AHSu6MkZUMWKdF1lojdomglZPF2s0J3yUiA2W4nc=\n=zmuB\n-----END PGP SIGNATURE-----\n", "payload": "tree e8e4de55a1b689d72c50a4db654691772f70e9de\nparent c38ee06b62af10924259525c652ef29a70e98e08\nparent 540c3f94d71879f413a151bc8c83c20c10b386dc\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1667584347 +0100\ncommitter GitHub <noreply@github.com> 1667584347 +0100\n\nRollup merge of #103792 - JhonnyBillM:migrate-codegen-ssa-to-diagnostics-structs-pt2, r=davidtwco\n\nMigrate `codegen_ssa` to diagnostics structs - [Part 2]\n\nCompletes migrating `link.rs` in `codegen_ssa` module.\n\n_Part 1 - https://github.com/rust-lang/rust/pull/102612_\n\nr? `@davidtwco`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1cb8684dde6bf489b63257387a5df7662ee00170", "html_url": "https://github.com/rust-lang/rust/commit/1cb8684dde6bf489b63257387a5df7662ee00170", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1cb8684dde6bf489b63257387a5df7662ee00170/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c38ee06b62af10924259525c652ef29a70e98e08", "url": "https://api.github.com/repos/rust-lang/rust/commits/c38ee06b62af10924259525c652ef29a70e98e08", "html_url": "https://github.com/rust-lang/rust/commit/c38ee06b62af10924259525c652ef29a70e98e08"}, {"sha": "540c3f94d71879f413a151bc8c83c20c10b386dc", "url": "https://api.github.com/repos/rust-lang/rust/commits/540c3f94d71879f413a151bc8c83c20c10b386dc", "html_url": "https://github.com/rust-lang/rust/commit/540c3f94d71879f413a151bc8c83c20c10b386dc"}], "stats": {"total": 397, "additions": 298, "deletions": 99}, "files": [{"sha": "18789d00fd3a43592ead105593149437f5d204bc", "filename": "compiler/rustc_codegen_ssa/src/back/archive.rs", "status": "modified", "additions": 17, "deletions": 13, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Farchive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Farchive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Farchive.rs?ref=1cb8684dde6bf489b63257387a5df7662ee00170", "patch": "@@ -6,11 +6,12 @@ use rustc_span::symbol::Symbol;\n \n use object::read::archive::ArchiveFile;\n \n-use std::fmt::Display;\n use std::fs::File;\n use std::io;\n use std::path::{Path, PathBuf};\n \n+use crate::errors::ExtractBundledLibsError;\n+\n pub trait ArchiveBuilderBuilder {\n     fn new_archive_builder<'a>(&self, sess: &'a Session) -> Box<dyn ArchiveBuilder<'a> + 'a>;\n \n@@ -28,32 +29,35 @@ pub trait ArchiveBuilderBuilder {\n         is_direct_dependency: bool,\n     ) -> PathBuf;\n \n-    fn extract_bundled_libs(\n-        &self,\n-        rlib: &Path,\n+    fn extract_bundled_libs<'a>(\n+        &'a self,\n+        rlib: &'a Path,\n         outdir: &Path,\n         bundled_lib_file_names: &FxHashSet<Symbol>,\n-    ) -> Result<(), String> {\n-        let message = |msg: &str, e: &dyn Display| format!(\"{} '{}': {}\", msg, &rlib.display(), e);\n+    ) -> Result<(), ExtractBundledLibsError<'_>> {\n         let archive_map = unsafe {\n-            Mmap::map(File::open(rlib).map_err(|e| message(\"failed to open file\", &e))?)\n-                .map_err(|e| message(\"failed to mmap file\", &e))?\n+            Mmap::map(\n+                File::open(rlib)\n+                    .map_err(|e| ExtractBundledLibsError::OpenFile { rlib, error: Box::new(e) })?,\n+            )\n+            .map_err(|e| ExtractBundledLibsError::MmapFile { rlib, error: Box::new(e) })?\n         };\n         let archive = ArchiveFile::parse(&*archive_map)\n-            .map_err(|e| message(\"failed to parse archive\", &e))?;\n+            .map_err(|e| ExtractBundledLibsError::ParseArchive { rlib, error: Box::new(e) })?;\n \n         for entry in archive.members() {\n-            let entry = entry.map_err(|e| message(\"failed to read entry\", &e))?;\n+            let entry = entry\n+                .map_err(|e| ExtractBundledLibsError::ReadEntry { rlib, error: Box::new(e) })?;\n             let data = entry\n                 .data(&*archive_map)\n-                .map_err(|e| message(\"failed to get data from archive member\", &e))?;\n+                .map_err(|e| ExtractBundledLibsError::ArchiveMember { rlib, error: Box::new(e) })?;\n             let name = std::str::from_utf8(entry.name())\n-                .map_err(|e| message(\"failed to convert name\", &e))?;\n+                .map_err(|e| ExtractBundledLibsError::ConvertName { rlib, error: Box::new(e) })?;\n             if !bundled_lib_file_names.contains(&Symbol::intern(name)) {\n                 continue; // We need to extract only native libraries.\n             }\n             std::fs::write(&outdir.join(&name), data)\n-                .map_err(|e| message(\"failed to write file\", &e))?;\n+                .map_err(|e| ExtractBundledLibsError::WriteFile { rlib, error: Box::new(e) })?;\n         }\n         Ok(())\n     }"}, {"sha": "6f0a8d0a54cbac03b5158e35a8647a819bdd0912", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 47, "deletions": 85, "changes": 132, "blob_url": "https://github.com/rust-lang/rust/blob/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=1cb8684dde6bf489b63257387a5df7662ee00170", "patch": "@@ -919,29 +919,17 @@ fn link_natively<'a>(\n                         )\n                         .is_some();\n \n-                        sess.note_without_error(\"`link.exe` returned an unexpected error\");\n+                        sess.emit_note(errors::LinkExeUnexpectedError);\n                         if is_vs_installed && has_linker {\n                             // the linker is broken\n-                            sess.note_without_error(\n-                                \"the Visual Studio build tools may need to be repaired \\\n-                                using the Visual Studio installer\",\n-                            );\n-                            sess.note_without_error(\n-                                \"or a necessary component may be missing from the \\\n-                                \\\"C++ build tools\\\" workload\",\n-                            );\n+                            sess.emit_note(errors::RepairVSBuildTools);\n+                            sess.emit_note(errors::MissingCppBuildToolComponent);\n                         } else if is_vs_installed {\n                             // the linker is not installed\n-                            sess.note_without_error(\n-                                \"in the Visual Studio installer, ensure the \\\n-                                \\\"C++ build tools\\\" workload is selected\",\n-                            );\n+                            sess.emit_note(errors::SelectCppBuildToolWorkload);\n                         } else {\n                             // visual studio is not installed\n-                            sess.note_without_error(\n-                                \"you may need to install Visual Studio build tools with the \\\n-                                \\\"C++ build tools\\\" workload\",\n-                            );\n+                            sess.emit_note(errors::VisualStudioNotInstalled);\n                         }\n                     }\n                 }\n@@ -954,35 +942,20 @@ fn link_natively<'a>(\n         Err(e) => {\n             let linker_not_found = e.kind() == io::ErrorKind::NotFound;\n \n-            let mut linker_error = {\n-                if linker_not_found {\n-                    sess.struct_err(&format!(\"linker `{}` not found\", linker_path.display()))\n-                } else {\n-                    sess.struct_err(&format!(\n-                        \"could not exec the linker `{}`\",\n-                        linker_path.display()\n-                    ))\n-                }\n-            };\n-\n-            linker_error.note(&e.to_string());\n-\n-            if !linker_not_found {\n-                linker_error.note(&format!(\"{:?}\", &cmd));\n+            if linker_not_found {\n+                sess.emit_err(errors::LinkerNotFound { linker_path, error: e });\n+            } else {\n+                sess.emit_err(errors::UnableToExeLinker {\n+                    linker_path,\n+                    error: e,\n+                    command_formatted: format!(\"{:?}\", &cmd),\n+                });\n             }\n \n-            linker_error.emit();\n-\n             if sess.target.is_like_msvc && linker_not_found {\n-                sess.note_without_error(\n-                    \"the msvc targets depend on the msvc linker \\\n-                     but `link.exe` was not found\",\n-                );\n-                sess.note_without_error(\n-                    \"please ensure that Visual Studio 2017 or later, or Build Tools \\\n-                     for Visual Studio were installed with the Visual C++ option.\",\n-                );\n-                sess.note_without_error(\"VS Code is a different product, and is not sufficient.\");\n+                sess.emit_note(errors::MsvcMissingLinker);\n+                sess.emit_note(errors::CheckInstalledVisualStudio);\n+                sess.emit_note(errors::UnsufficientVSCodeProduct);\n             }\n             sess.abort_if_errors();\n         }\n@@ -1007,15 +980,13 @@ fn link_natively<'a>(\n                     if !prog.status.success() {\n                         let mut output = prog.stderr.clone();\n                         output.extend_from_slice(&prog.stdout);\n-                        sess.struct_warn(&format!(\n-                            \"processing debug info with `dsymutil` failed: {}\",\n-                            prog.status\n-                        ))\n-                        .note(&escape_string(&output))\n-                        .emit();\n+                        sess.emit_warning(errors::ProcessingDymutilFailed {\n+                            status: prog.status,\n+                            output: escape_string(&output),\n+                        });\n                     }\n                 }\n-                Err(e) => sess.fatal(&format!(\"unable to run `dsymutil`: {}\", e)),\n+                Err(error) => sess.emit_fatal(errors::UnableToRunDsymutil { error }),\n             }\n         }\n \n@@ -1092,15 +1063,14 @@ fn strip_symbols_with_external_utility<'a>(\n             if !prog.status.success() {\n                 let mut output = prog.stderr.clone();\n                 output.extend_from_slice(&prog.stdout);\n-                sess.struct_warn(&format!(\n-                    \"stripping debug info with `{}` failed: {}\",\n-                    util, prog.status\n-                ))\n-                .note(&escape_string(&output))\n-                .emit();\n+                sess.emit_warning(errors::StrippingDebugInfoFailed {\n+                    util,\n+                    status: prog.status,\n+                    output: escape_string(&output),\n+                });\n             }\n         }\n-        Err(e) => sess.fatal(&format!(\"unable to run `{}`: {}\", util, e)),\n+        Err(error) => sess.emit_fatal(errors::UnableToRun { util, error }),\n     }\n }\n \n@@ -1251,7 +1221,7 @@ pub fn linker_and_flavor(sess: &Session) -> (PathBuf, LinkerFlavor) {\n             )),\n             (Some(linker), None) => {\n                 let stem = linker.file_stem().and_then(|stem| stem.to_str()).unwrap_or_else(|| {\n-                    sess.fatal(\"couldn't extract file stem from specified linker\")\n+                    sess.emit_fatal(errors::LinkerFileStem);\n                 });\n \n                 let flavor = if stem == \"emcc\" {\n@@ -1378,13 +1348,9 @@ fn print_native_static_libs(sess: &Session, all_native_libs: &[NativeLib]) {\n         })\n         .collect();\n     if !lib_args.is_empty() {\n-        sess.note_without_error(\n-            \"Link against the following native artifacts when linking \\\n-                                 against this static library. The order and any duplication \\\n-                                 can be significant on some platforms.\",\n-        );\n+        sess.emit_note(errors::StaticLibraryNativeArtifacts);\n         // Prefix for greppability\n-        sess.note_without_error(&format!(\"native-static-libs: {}\", &lib_args.join(\" \")));\n+        sess.emit_note(errors::NativeStaticLibs { arguments: lib_args.join(\" \") });\n     }\n }\n \n@@ -1688,14 +1654,14 @@ fn add_link_script(cmd: &mut dyn Linker, sess: &Session, tmpdir: &Path, crate_ty\n     match (crate_type, &sess.target.link_script) {\n         (CrateType::Cdylib | CrateType::Executable, Some(script)) => {\n             if !sess.target.linker_flavor.is_gnu() {\n-                sess.fatal(\"can only use link script when linking with GNU-like linker\");\n+                sess.emit_fatal(errors::LinkScriptUnavailable);\n             }\n \n             let file_name = [\"rustc\", &sess.target.llvm_target, \"linkfile.ld\"].join(\"-\");\n \n             let path = tmpdir.join(file_name);\n-            if let Err(e) = fs::write(&path, script.as_ref()) {\n-                sess.fatal(&format!(\"failed to write link script to {}: {}\", path.display(), e));\n+            if let Err(error) = fs::write(&path, script.as_ref()) {\n+                sess.emit_fatal(errors::LinkScriptWriteFailure { path, error });\n             }\n \n             cmd.arg(\"--script\");\n@@ -1841,8 +1807,8 @@ fn add_linked_symbol_object(\n \n     let path = tmpdir.join(\"symbols.o\");\n     let result = std::fs::write(&path, file.write().unwrap());\n-    if let Err(e) = result {\n-        sess.fatal(&format!(\"failed to write {}: {}\", path.display(), e));\n+    if let Err(error) = result {\n+        sess.emit_fatal(errors::FailedToWrite { path, error });\n     }\n     cmd.add_object(&path);\n }\n@@ -2299,14 +2265,10 @@ fn collect_natvis_visualizers(\n                 visualizer_paths.push(visualizer_out_file);\n             }\n             Err(error) => {\n-                sess.warn(\n-                    format!(\n-                        \"Unable to write debugger visualizer file `{}`: {} \",\n-                        visualizer_out_file.display(),\n-                        error\n-                    )\n-                    .as_str(),\n-                );\n+                sess.emit_warning(errors::UnableToWriteDebuggerVisualizer {\n+                    path: visualizer_out_file,\n+                    error,\n+                });\n             }\n         };\n     }\n@@ -2484,7 +2446,7 @@ fn add_upstream_rust_crates<'a>(\n                         let rlib = &src.rlib.as_ref().unwrap().0;\n                         archive_builder_builder\n                             .extract_bundled_libs(rlib, tmpdir, &bundled_libs)\n-                            .unwrap_or_else(|e| sess.fatal(e));\n+                            .unwrap_or_else(|e| sess.emit_fatal(e));\n                     }\n \n                     let mut last = (None, NativeLibKind::Unspecified, None);\n@@ -2641,7 +2603,7 @@ fn add_upstream_rust_crates<'a>(\n                 || !codegen_results.crate_info.is_no_builtins.contains(&cnum);\n \n             let mut archive = archive_builder_builder.new_archive_builder(sess);\n-            if let Err(e) = archive.add_archive(\n+            if let Err(error) = archive.add_archive(\n                 cratepath,\n                 Box::new(move |f| {\n                     if f == METADATA_FILENAME {\n@@ -2681,7 +2643,7 @@ fn add_upstream_rust_crates<'a>(\n                     false\n                 }),\n             ) {\n-                sess.fatal(&format!(\"failed to build archive from rlib: {}\", e));\n+                sess.emit_fatal(errors::RlibArchiveBuildFailure { error });\n             }\n             if archive.build(&dst) {\n                 link_upstream(&dst);\n@@ -2813,14 +2775,14 @@ fn add_apple_sdk(cmd: &mut dyn Linker, sess: &Session, flavor: LinkerFlavor) {\n         (\"arm\", \"watchos\") => \"watchos\",\n         (_, \"macos\") => \"macosx\",\n         _ => {\n-            sess.err(&format!(\"unsupported arch `{}` for os `{}`\", arch, os));\n+            sess.emit_err(errors::UnsupportedArch { arch, os });\n             return;\n         }\n     };\n     let sdk_root = match get_apple_sdk_root(sdk_name) {\n         Ok(s) => s,\n         Err(e) => {\n-            sess.err(&e);\n+            sess.emit_err(e);\n             return;\n         }\n     };\n@@ -2836,7 +2798,7 @@ fn add_apple_sdk(cmd: &mut dyn Linker, sess: &Session, flavor: LinkerFlavor) {\n     }\n }\n \n-fn get_apple_sdk_root(sdk_name: &str) -> Result<String, String> {\n+fn get_apple_sdk_root(sdk_name: &str) -> Result<String, errors::AppleSdkRootError<'_>> {\n     // Following what clang does\n     // (https://github.com/llvm/llvm-project/blob/\n     // 296a80102a9b72c3eda80558fb78a3ed8849b341/clang/lib/Driver/ToolChains/Darwin.cpp#L1661-L1678)\n@@ -2886,7 +2848,7 @@ fn get_apple_sdk_root(sdk_name: &str) -> Result<String, String> {\n \n     match res {\n         Ok(output) => Ok(output.trim().to_string()),\n-        Err(e) => Err(format!(\"failed to get {} SDK path: {}\", sdk_name, e)),\n+        Err(error) => Err(errors::AppleSdkRootError::SdkPath { sdk_name, error }),\n     }\n }\n \n@@ -2919,7 +2881,7 @@ fn add_gcc_ld_path(cmd: &mut dyn Linker, sess: &Session, flavor: LinkerFlavor) {\n                 }\n             }\n         } else {\n-            sess.fatal(\"option `-Z gcc-ld` is used even though linker flavor is not gcc\");\n+            sess.emit_fatal(errors::OptionGccOnly);\n         }\n     }\n }"}, {"sha": "36c94462b0b3e50cd338e8ef3a2420231b289297", "filename": "compiler/rustc_codegen_ssa/src/errors.rs", "status": "modified", "additions": 167, "deletions": 0, "changes": 167, "blob_url": "https://github.com/rust-lang/rust/blob/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs?ref=1cb8684dde6bf489b63257387a5df7662ee00170", "patch": "@@ -354,3 +354,170 @@ impl IntoDiagnostic<'_> for LinkingFailed<'_> {\n         diag\n     }\n }\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_link_exe_unexpected_error)]\n+pub struct LinkExeUnexpectedError;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_repair_vs_build_tools)]\n+pub struct RepairVSBuildTools;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_missing_cpp_build_tool_component)]\n+pub struct MissingCppBuildToolComponent;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_select_cpp_build_tool_workload)]\n+pub struct SelectCppBuildToolWorkload;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_visual_studio_not_installed)]\n+pub struct VisualStudioNotInstalled;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_linker_not_found)]\n+#[note]\n+pub struct LinkerNotFound {\n+    pub linker_path: PathBuf,\n+    pub error: Error,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_unable_to_exe_linker)]\n+#[note]\n+#[note(command_note)]\n+pub struct UnableToExeLinker {\n+    pub linker_path: PathBuf,\n+    pub error: Error,\n+    pub command_formatted: String,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_msvc_missing_linker)]\n+pub struct MsvcMissingLinker;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_check_installed_visual_studio)]\n+pub struct CheckInstalledVisualStudio;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_unsufficient_vs_code_product)]\n+pub struct UnsufficientVSCodeProduct;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_processing_dymutil_failed)]\n+#[note]\n+pub struct ProcessingDymutilFailed {\n+    pub status: ExitStatus,\n+    pub output: String,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_unable_to_run_dsymutil)]\n+#[note]\n+pub struct UnableToRunDsymutil {\n+    pub error: Error,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_stripping_debu_info_failed)]\n+#[note]\n+pub struct StrippingDebugInfoFailed<'a> {\n+    pub util: &'a str,\n+    pub status: ExitStatus,\n+    pub output: String,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_unable_to_run)]\n+pub struct UnableToRun<'a> {\n+    pub util: &'a str,\n+    pub error: Error,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_linker_file_stem)]\n+pub struct LinkerFileStem;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_static_library_native_artifacts)]\n+pub struct StaticLibraryNativeArtifacts;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_native_static_libs)]\n+pub struct NativeStaticLibs {\n+    pub arguments: String,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_link_script_unavailable)]\n+pub struct LinkScriptUnavailable;\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_link_script_write_failure)]\n+pub struct LinkScriptWriteFailure {\n+    pub path: PathBuf,\n+    pub error: Error,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_failed_to_write)]\n+pub struct FailedToWrite {\n+    pub path: PathBuf,\n+    pub error: Error,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_unable_to_write_debugger_visualizer)]\n+pub struct UnableToWriteDebuggerVisualizer {\n+    pub path: PathBuf,\n+    pub error: Error,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_rlib_archive_build_failure)]\n+pub struct RlibArchiveBuildFailure {\n+    pub error: Error,\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_option_gcc_only)]\n+pub struct OptionGccOnly;\n+\n+#[derive(Diagnostic)]\n+pub enum ExtractBundledLibsError<'a> {\n+    #[diag(codegen_ssa_extract_bundled_libs_open_file)]\n+    OpenFile { rlib: &'a Path, error: Box<dyn std::error::Error> },\n+\n+    #[diag(codegen_ssa_extract_bundled_libs_mmap_file)]\n+    MmapFile { rlib: &'a Path, error: Box<dyn std::error::Error> },\n+\n+    #[diag(codegen_ssa_extract_bundled_libs_parse_archive)]\n+    ParseArchive { rlib: &'a Path, error: Box<dyn std::error::Error> },\n+\n+    #[diag(codegen_ssa_extract_bundled_libs_read_entry)]\n+    ReadEntry { rlib: &'a Path, error: Box<dyn std::error::Error> },\n+\n+    #[diag(codegen_ssa_extract_bundled_libs_archive_member)]\n+    ArchiveMember { rlib: &'a Path, error: Box<dyn std::error::Error> },\n+\n+    #[diag(codegen_ssa_extract_bundled_libs_convert_name)]\n+    ConvertName { rlib: &'a Path, error: Box<dyn std::error::Error> },\n+\n+    #[diag(codegen_ssa_extract_bundled_libs_write_file)]\n+    WriteFile { rlib: &'a Path, error: Box<dyn std::error::Error> },\n+}\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_unsupported_arch)]\n+pub struct UnsupportedArch<'a> {\n+    pub arch: &'a str,\n+    pub os: &'a str,\n+}\n+\n+#[derive(Diagnostic)]\n+pub enum AppleSdkRootError<'a> {\n+    #[diag(codegen_ssa_apple_sdk_error_sdk_path)]\n+    SdkPath { sdk_name: &'a str, error: Error },\n+}"}, {"sha": "ad0d758210175fb096eefe07f0929da10767fae6", "filename": "compiler/rustc_error_messages/locales/en-US/codegen_ssa.ftl", "status": "modified", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl?ref=1cb8684dde6bf489b63257387a5df7662ee00170", "patch": "@@ -119,3 +119,66 @@ codegen_ssa_thorin_object_read = {$error}\n codegen_ssa_thorin_object_write = {$error}\n codegen_ssa_thorin_gimli_read = {$error}\n codegen_ssa_thorin_gimli_write = {$error}\n+\n+codegen_ssa_link_exe_unexpected_error = `link.exe` returned an unexpected error\n+\n+codegen_ssa_repair_vs_build_tools = the Visual Studio build tools may need to be repaired using the Visual Studio installer\n+\n+codegen_ssa_missing_cpp_build_tool_component = or a necessary component may be missing from the \"C++ build tools\" workload\n+\n+codegen_ssa_select_cpp_build_tool_workload = in the Visual Studio installer, ensure the \"C++ build tools\" workload is selected\n+\n+codegen_ssa_visual_studio_not_installed = you may need to install Visual Studio build tools with the \"C++ build tools\" workload\n+\n+codegen_ssa_linker_not_found = linker `{$linker_path}` not found\n+    .note = {$error}\n+\n+codegen_ssa_unable_to_exe_linker = could not exec the linker `{$linker_path}`\n+    .note = {$error}\n+    .command_note = {$command_formatted}\n+\n+codegen_ssa_msvc_missing_linker = the msvc targets depend on the msvc linker but `link.exe` was not found\n+\n+codegen_ssa_check_installed_visual_studio = please ensure that Visual Studio 2017 or later, or Build Tools for Visual Studio were installed with the Visual C++ option.\n+\n+codegen_ssa_unsufficient_vs_code_product = VS Code is a different product, and is not sufficient.\n+\n+codegen_ssa_processing_dymutil_failed = processing debug info with `dsymutil` failed: {$status}\n+    .note = {$output}\n+\n+codegen_ssa_unable_to_run_dsymutil = unable to run `dsymutil`: {$error}\n+\n+codegen_ssa_stripping_debu_info_failed = stripping debug info with `{$util}` failed: {$status}\n+    .note = {$output}\n+\n+codegen_ssa_unable_to_run = unable to run `{$util}`: {$error}\n+\n+codegen_ssa_linker_file_stem = couldn't extract file stem from specified linker\n+\n+codegen_ssa_static_library_native_artifacts = Link against the following native artifacts when linking against this static library. The order and any duplication can be significant on some platforms.\n+\n+codegen_ssa_native_static_libs = native-static-libs: {$arguments}\n+\n+codegen_ssa_link_script_unavailable = can only use link script when linking with GNU-like linker\n+\n+codegen_ssa_link_script_write_failure = failed to write link script to {$path}: {$error}\n+\n+codegen_ssa_failed_to_write = failed to write {$path}: {$error}\n+\n+codegen_ssa_unable_to_write_debugger_visualizer = Unable to write debugger visualizer file `{$path}`: {$error}\n+\n+codegen_ssa_rlib_archive_build_failure = failed to build archive from rlib: {$error}\n+\n+codegen_ssa_option_gcc_only = option `-Z gcc-ld` is used even though linker flavor is not gcc\n+\n+codegen_ssa_extract_bundled_libs_open_file = failed to open file '{$rlib}': {$error}\n+codegen_ssa_extract_bundled_libs_mmap_file = failed to mmap file '{$rlib}': {$error}\n+codegen_ssa_extract_bundled_libs_parse_archive = failed to parse archive '{$rlib}': {$error}\n+codegen_ssa_extract_bundled_libs_read_entry = failed to read entry '{$rlib}': {$error}\n+codegen_ssa_extract_bundled_libs_archive_member = failed to get data from archive member '{$rlib}': {$error}\n+codegen_ssa_extract_bundled_libs_convert_name = failed to convert name '{$rlib}': {$error}\n+codegen_ssa_extract_bundled_libs_write_file = failed to write file '{$rlib}': {$error}\n+\n+codegen_ssa_unsupported_arch = unsupported arch `{$arch}` for os `{$os}`\n+\n+codegen_ssa_apple_sdk_error_sdk_path = failed to get {$sdk_name} SDK path: {error}"}, {"sha": "22f6fc700fad371be7c15ecd14ff14ecb4136aa3", "filename": "compiler/rustc_errors/src/diagnostic_impls.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cb8684dde6bf489b63257387a5df7662ee00170/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_impls.rs?ref=1cb8684dde6bf489b63257387a5df7662ee00170", "patch": "@@ -14,6 +14,7 @@ use std::fmt;\n use std::fmt::Write;\n use std::num::ParseIntError;\n use std::path::{Path, PathBuf};\n+use std::process::ExitStatus;\n \n pub struct DiagnosticArgFromDisplay<'a>(pub &'a dyn fmt::Display);\n \n@@ -59,6 +60,7 @@ into_diagnostic_arg_using_display!(\n     i128,\n     u128,\n     std::io::Error,\n+    std::boxed::Box<dyn std::error::Error>,\n     std::num::NonZeroU32,\n     hir::Target,\n     Edition,\n@@ -67,7 +69,8 @@ into_diagnostic_arg_using_display!(\n     ParseIntError,\n     StackProtector,\n     &TargetTriple,\n-    SplitDebuginfo\n+    SplitDebuginfo,\n+    ExitStatus,\n );\n \n impl IntoDiagnosticArg for bool {"}]}