{"sha": "30c990b69354f9bfb1d7851da931bce2d1efe087", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwYzk5MGI2OTM1NGY5YmZiMWQ3ODUxZGE5MzFiY2UyZDFlZmUwODc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-30T17:18:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-04-30T17:18:39Z"}, "message": "Rollup merge of #50325 - petrochenkov:pmgate, r=alexcrichton\n\nAdd a few more tests for proc macro feature gating", "tree": {"sha": "fbd733f4cfb827bbc255064db080b0c4bd56744c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fbd733f4cfb827bbc255064db080b0c4bd56744c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30c990b69354f9bfb1d7851da931bce2d1efe087", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJa50/vCRBK7hj4Ov3rIwAAdHIIAAYTMt2QnEMBS7Uiznmsnla+\nsZtc6hoQOXq0M0HrXBY2h53g9FJIjJfnbIIG1VRxQqP2oziGotl/wkNHX+2snWdo\n8yAc+Aq/e/9dTh9Jh60jsgscj92h53MhYNNYqNSqff6eFWnqK4n4LZpo0L73yOtB\n6O9BVwP5Ii7kAc5+6/rl6YAvE4xMo2iYN5FuM3oXsop8rE81CBkG4rbysiCJ73UZ\nh42b91GX8/Xd7MYHZdAjWB7CYor7E7eO5VicJ8STdwq4qqVz0ia4pMDS11tIQXfT\nzzI3gACmY45GsOMiCvkHGVDi9rXj0HunBTSqlWyncFaYswmOlcPOtRlSdIdnmQA=\n=xF4k\n-----END PGP SIGNATURE-----\n", "payload": "tree fbd733f4cfb827bbc255064db080b0c4bd56744c\nparent b2392938955a5bc5c892f277624b772fb2358e31\nparent 0a6e91bdbc6368a15bd5ccc632954b8247284b6d\nauthor kennytm <kennytm@gmail.com> 1525108719 +0800\ncommitter GitHub <noreply@github.com> 1525108719 +0800\n\nRollup merge of #50325 - petrochenkov:pmgate, r=alexcrichton\n\nAdd a few more tests for proc macro feature gating\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30c990b69354f9bfb1d7851da931bce2d1efe087", "html_url": "https://github.com/rust-lang/rust/commit/30c990b69354f9bfb1d7851da931bce2d1efe087", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30c990b69354f9bfb1d7851da931bce2d1efe087/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2392938955a5bc5c892f277624b772fb2358e31", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2392938955a5bc5c892f277624b772fb2358e31", "html_url": "https://github.com/rust-lang/rust/commit/b2392938955a5bc5c892f277624b772fb2358e31"}, {"sha": "0a6e91bdbc6368a15bd5ccc632954b8247284b6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a6e91bdbc6368a15bd5ccc632954b8247284b6d", "html_url": "https://github.com/rust-lang/rust/commit/0a6e91bdbc6368a15bd5ccc632954b8247284b6d"}], "stats": {"total": 55, "additions": 42, "deletions": 13}, "files": [{"sha": "fff433b90ce69683905d541734f8cef980b61c8c", "filename": "src/test/compile-fail-fulldeps/proc-macro/proc-macro-gates.rs", "status": "modified", "additions": 42, "deletions": 13, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/30c990b69354f9bfb1d7851da931bce2d1efe087/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fproc-macro-gates.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30c990b69354f9bfb1d7851da931bce2d1efe087/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fproc-macro-gates.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fproc-macro-gates.rs?ref=30c990b69354f9bfb1d7851da931bce2d1efe087", "patch": "@@ -24,9 +24,17 @@ use foo::*;\n #[foo::a] //~ ERROR: paths of length greater than one\n fn _test() {}\n \n+fn _test_inner() {\n+    #![a] // OK\n+}\n+\n #[a] //~ ERROR: custom attributes cannot be applied to modules\n mod _test2 {}\n \n+mod _test2_inner {\n+    #![a] //~ ERROR: custom attributes cannot be applied to modules\n+}\n+\n #[a = y] //~ ERROR: must only be followed by a delimiter token\n fn _test3() {}\n \n@@ -36,19 +44,40 @@ fn _test4() {}\n #[a () = ] //~ ERROR: must only be followed by a delimiter token\n fn _test5() {}\n \n-fn main() {\n+fn attrs() {\n+    // Statement, item\n+    #[a] // OK\n+    struct S;\n+\n+    // Statement, macro\n+    #[a] //~ ERROR: custom attributes cannot be applied to statements\n+    println!();\n+\n+    // Statement, semi\n+    #[a] //~ ERROR: custom attributes cannot be applied to statements\n+    S;\n+\n+    // Statement, local\n     #[a] //~ ERROR: custom attributes cannot be applied to statements\n     let _x = 2;\n-    let _x = #[a] 2;\n-    //~^ ERROR: custom attributes cannot be applied to expressions\n-\n-    let _x: m!(u32) = 3;\n-    //~^ ERROR: procedural macros cannot be expanded to types\n-    if let m!(Some(_x)) = Some(3) {\n-    //~^ ERROR: procedural macros cannot be expanded to patterns\n-    }\n-    let _x = m!(3);\n-    //~^ ERROR: procedural macros cannot be expanded to expressions\n-    m!(let _x = 3;);\n-    //~^ ERROR: procedural macros cannot be expanded to statements\n+\n+    // Expr\n+    let _x = #[a] 2; //~ ERROR: custom attributes cannot be applied to expressions\n+\n+    // Opt expr\n+    let _x = [#[a] 2]; //~ ERROR: custom attributes cannot be applied to expressions\n+\n+    // Expr macro\n+    let _x = #[a] println!(); //~ ERROR: custom attributes cannot be applied to expressions\n+}\n+\n+fn main() {\n+    let _x: m!(u32) = 3; //~ ERROR: procedural macros cannot be expanded to types\n+    if let m!(Some(_x)) = Some(3) {} //~ ERROR: procedural macros cannot be expanded to patterns\n+\n+    m!(struct S;); //~ ERROR: procedural macros cannot be expanded to statements\n+    m!(let _x = 3;); //~ ERROR: procedural macros cannot be expanded to statements\n+\n+    let _x = m!(3); //~ ERROR: procedural macros cannot be expanded to expressions\n+    let _x = [m!(3)]; //~ ERROR: procedural macros cannot be expanded to expressions\n }"}]}