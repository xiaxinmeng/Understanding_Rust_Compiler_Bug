{"sha": "d62163188a21e5afc3d0f476eaf7856d91f715b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2MjE2MzE4OGEyMWU1YWZjM2QwZjQ3NmVhZjc4NTZkOTFmNzE1YjI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-24T19:04:27Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-24T21:29:22Z"}, "message": "Revert \"mk: Run 'make install' through install.sh\"\n\nThis reverts commit e93709a911637194835268420e67d768ee19b5df.", "tree": {"sha": "0f809168568734cbab01fa71ef892f367e0d6984", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f809168568734cbab01fa71ef892f367e0d6984"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d62163188a21e5afc3d0f476eaf7856d91f715b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d62163188a21e5afc3d0f476eaf7856d91f715b2", "html_url": "https://github.com/rust-lang/rust/commit/d62163188a21e5afc3d0f476eaf7856d91f715b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d62163188a21e5afc3d0f476eaf7856d91f715b2/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c796f89dbc3e61845d1e44d117acc471f583c417", "url": "https://api.github.com/repos/rust-lang/rust/commits/c796f89dbc3e61845d1e44d117acc471f583c417", "html_url": "https://github.com/rust-lang/rust/commit/c796f89dbc3e61845d1e44d117acc471f583c417"}], "stats": {"total": 80, "additions": 65, "deletions": 15}, "files": [{"sha": "04ff606d0b93991c71f87a8870bffa372fcc2dfb", "filename": "Makefile.in", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d62163188a21e5afc3d0f476eaf7856d91f715b2/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/d62163188a21e5afc3d0f476eaf7856d91f715b2/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=d62163188a21e5afc3d0f476eaf7856d91f715b2", "patch": "@@ -232,20 +232,19 @@ ifneq ($(strip $(findstring prepare,$(MAKECMDGOALS)) \\\n   include $(CFG_SRC_DIR)mk/prepare.mk\n endif\n \n+# (Unix) Installation from the build directory\n+ifneq ($(findstring install,$(MAKECMDGOALS)),)\n+  CFG_INFO := $(info cfg: including install rules)\n+  include $(CFG_SRC_DIR)mk/install.mk\n+endif\n+\n # Source and binary distribution artifacts\n ifneq ($(strip $(findstring dist,$(MAKECMDGOALS)) \\\n-               $(findstring install,$(MAKECMDGOALS)) \\\n                $(findstring clean,$(MAKECMDGOALS))),)\n   CFG_INFO := $(info cfg: including dist rules)\n   include $(CFG_SRC_DIR)mk/dist.mk\n endif\n \n-# (Unix) Installation from the build directory\n-ifneq ($(findstring install,$(MAKECMDGOALS)),)\n-  CFG_INFO := $(info cfg: including install rules)\n-  include $(CFG_SRC_DIR)mk/install.mk\n-endif\n-\n # Cleaning\n ifneq ($(findstring clean,$(MAKECMDGOALS)),)\n   CFG_INFO := $(info cfg: including clean rules)"}, {"sha": "80bd048b8b42d1d9c023417cf6c89d32bb4ef0b7", "filename": "mk/dist.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d62163188a21e5afc3d0f476eaf7856d91f715b2/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/d62163188a21e5afc3d0f476eaf7856d91f715b2/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=d62163188a21e5afc3d0f476eaf7856d91f715b2", "patch": "@@ -22,7 +22,7 @@\n # * dist-tar-bins - Ad-hoc Unix binary installers\n # * dist-docs - Stage docs for upload\n \n-PKG_NAME := $(CFG_PACKAGE_NAME)\n+PKG_NAME = $(CFG_PACKAGE_NAME)\n \n # License suitable for displaying in a popup\n LICENSE.txt: $(S)COPYRIGHT $(S)LICENSE-APACHE $(S)LICENSE-MIT"}, {"sha": "6e56767a9d7e346b8707b2f6620b9910dfa4b7d8", "filename": "mk/install.mk", "status": "modified", "additions": 58, "deletions": 7, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/d62163188a21e5afc3d0f476eaf7856d91f715b2/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/d62163188a21e5afc3d0f476eaf7856d91f715b2/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=d62163188a21e5afc3d0f476eaf7856d91f715b2", "patch": "@@ -8,17 +8,68 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n+# FIXME: Docs are currently not installed from the stageN dirs.\n+# For consistency it might be desirable for stageN to be an exact\n+# mirror of the installation directory structure.\n \n-install: dist-install-dir-$(CFG_BUILD)\n-\t$(Q)sh tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(CFG_PREFIX)\"\n+# The stage we install from\n+ISTAGE = $(PREPARE_STAGE)\n \n-uninstall: dist-install-dir-$(CFG_BUILD)\n-\t$(Q)sh tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(CFG_PREFIX)\" --uninstall\n+install: PREPARE_HOST=$(CFG_BUILD)\n+install: PREPARE_TARGETS=$(CFG_TARGET)\n+install: PREPARE_DIR_CMD=$(DEFAULT_PREPARE_DIR_CMD)\n+install: PREPARE_BIN_CMD=$(DEFAULT_PREPARE_BIN_CMD)\n+install: PREPARE_LIB_CMD=$(DEFAULT_PREPARE_LIB_CMD)\n+install: PREPARE_MAN_CMD=$(DEFAULT_PREPARE_MAN_CMD)\n+install: PREPARE_SOURCE_DIR=$(PREPARE_HOST)/stage$(PREPARE_STAGE)\n+install: PREPARE_SOURCE_BIN_DIR=$(PREPARE_SOURCE_DIR)/bin\n+install: PREPARE_SOURCE_LIB_DIR=$(PREPARE_SOURCE_DIR)/$(CFG_LIBDIR_RELATIVE)\n+install: PREPARE_SOURCE_MAN_DIR=$(S)/man\n+install: PREPARE_DEST_BIN_DIR=$(DESTDIR)$(CFG_PREFIX)/bin\n+install: PREPARE_DEST_LIB_DIR=$(DESTDIR)$(CFG_LIBDIR)\n+install: PREPARE_DEST_MAN_DIR=$(DESTDIR)$(CFG_MANDIR)/man1\n+install: prepare-everything\n \n \n-######################################################################\n-# Android remote installation\n-######################################################################\n+# Uninstall code\n+\n+PREFIX_ROOT = $(CFG_PREFIX)\n+PREFIX_BIN = $(PREFIX_ROOT)/bin\n+PREFIX_LIB = $(CFG_LIBDIR)\n+\n+INSTALL_TOOLS := $(PREPARE_TOOLS)\n+\n+# Shorthand for build/stageN/bin\n+HB = $(HBIN$(ISTAGE)_H_$(CFG_BUILD))\n+HB2 = $(HBIN2_H_$(CFG_BUILD))\n+# Shorthand for build/stageN/lib\n+HL = $(HLIB$(ISTAGE)_H_$(CFG_BUILD))\n+# Shorthand for the prefix bin directory\n+PHB = $(PREFIX_BIN)\n+# Shorthand for the prefix bin directory\n+PHL = $(PREFIX_LIB)\n+\n+HOST_LIB_FROM_HL_GLOB = \\\n+  $(patsubst $(HL)/%,$(PHL)/%,$(wildcard $(HL)/$(1)))\n+\n+uninstall: $(foreach tool,$(INSTALL_TOOLS),uninstall-tool-$(tool))\n+\t$(Q)rm -Rf $(PHL)/$(CFG_RUSTLIBDIR)\n+\n+define UNINSTALL_TOOL\n+uninstall-tool-$(1): $$(foreach dep,$$(TOOL_DEPS_$(1)),uninstall-lib-$$(dep))\n+\t$$(Q)rm -f $$(PHB)/$(1)$$(X_$$(CFG_BUILD))\n+\t$$(Q)rm -f $$(CFG_MANDIR)/man1/$(1).1\n+endef\n+\n+$(foreach tool,$(INSTALL_TOOLS),$(eval $(call UNINSTALL_TOOL,$(tool))))\n+\n+define UNINSTALL_LIB\n+uninstall-lib-$(1): $$(foreach dep,$$(RUST_DEPS_$(1)),uninstall-lib-$$(dep))\n+\t$$(Q)rm -f $$(call HOST_LIB_FROM_HL_GLOB,$$(call CFG_LIB_GLOB_$$(CFG_BUILD),$(1)))\n+endef\n+\n+$(foreach lib,$(CRATES),$(eval $(call UNINSTALL_LIB,$(lib))))\n+\n \n # Android runtime setup\n # FIXME: This probably belongs somewhere else"}]}