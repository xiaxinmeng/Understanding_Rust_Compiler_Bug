{"sha": "b01b5b911f3bb209ee619055a154cd81ca0674be", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIwMWI1YjkxMWYzYmIyMDllZTYxOTA1NWExNTRjZDgxY2EwNjc0YmU=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-07-25T09:51:08Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-07-25T09:51:08Z"}, "message": "ci: gate toolstate repo pushes on the TOOLSTATE_PUBLISH envvar\n\nUnfortunately due to an Azure quirk the TOOLSTATE_REPO_ACCESS_TOKEN is\nnot suitable to gate whether to push new commits to the repo, as if it's\nnot defined on the Azure side it will actually be set to the literal\n`$(TOOLSTATE_REPO_ACCESS_TOKEN)`, which screws everything up.\n\nThis instead adds another, non-secret environment variable to gate\npublishing: TOOLSTATE_PUBLISH. As non-secret environment variables\nbehave correctly this fixes the issue.", "tree": {"sha": "72c67b1aab60e7b96ac2a70ceccf0fb7c9f1bff7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/72c67b1aab60e7b96ac2a70ceccf0fb7c9f1bff7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b01b5b911f3bb209ee619055a154cd81ca0674be", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl05fH8ACgkQPgar6Auq\n8ZxTHg//RnEjI02VniO08+MsB+POyZz2MCUUOxO4dak46Xp6m2iIX+KqlTdmvLh3\nzEPlERY0X+a83pVuxN6pr8lVCDwW4Aewxc5RJGG4W0E5U1wjdXCivGjUeRx6QM9M\nW/qr4tRRytbyiSIvYWlMTEurERiHAqx1XJbo+twEV2HzVE7tD7CdnuG1c3fdV+Ye\nM6TopFkOKNcIGRFw+CuTlnP1zP9s9eRp774nEG+nz6r2krILxrefgieFvLKPPkNB\nWgFUYAcAPjjEE3Cj29hGeG2n+prmRD616Pzu8X+SiIN+gun6VoV4mktOmIkQ9eVq\nnst+rmJvxR1aBdaJ7NNHU+psNk1Zz9BohjNDaV7eiuG2MkFt18Oy0av0+XSyO37u\nwA6yRt1JeQryrv3Mw25YFZlZhjtjJTSr43HzoMgg4Q1Ua5U0NCU8sxp+6Md7Lkp5\nvPfqOWav3Lx5ffn1kmBtLN6cWL4gg8BWpnVjcJDL/zJqMDZIlriGeRXnMVz4Wj/d\nCiY2MzjPCIJFcVtGKEzNGgaY74QILH+0mqIsPrnAaeVpB+xt4AD5//wF3ZQ7AUpN\ni/WO0krLh4X3oa4eGq0A55Ml8WgnzTJL3YMoamN39By8mWMc+8OFKuRjSqJN37nX\nZaXV9L0/UoxU1VNgW6rfHIhn0IJrsEwT4+c2JM3mAG/ofJ6RFwc=\n=CBcm\n-----END PGP SIGNATURE-----", "payload": "tree 72c67b1aab60e7b96ac2a70ceccf0fb7c9f1bff7\nparent a7f28678bbf4e16893bb6a718e427504167a9494\nauthor Pietro Albini <pietro@pietroalbini.org> 1564048268 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1564048268 +0200\n\nci: gate toolstate repo pushes on the TOOLSTATE_PUBLISH envvar\n\nUnfortunately due to an Azure quirk the TOOLSTATE_REPO_ACCESS_TOKEN is\nnot suitable to gate whether to push new commits to the repo, as if it's\nnot defined on the Azure side it will actually be set to the literal\n`$(TOOLSTATE_REPO_ACCESS_TOKEN)`, which screws everything up.\n\nThis instead adds another, non-secret environment variable to gate\npublishing: TOOLSTATE_PUBLISH. As non-secret environment variables\nbehave correctly this fixes the issue.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b01b5b911f3bb209ee619055a154cd81ca0674be", "html_url": "https://github.com/rust-lang/rust/commit/b01b5b911f3bb209ee619055a154cd81ca0674be", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b01b5b911f3bb209ee619055a154cd81ca0674be/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a7f28678bbf4e16893bb6a718e427504167a9494", "url": "https://api.github.com/repos/rust-lang/rust/commits/a7f28678bbf4e16893bb6a718e427504167a9494", "html_url": "https://github.com/rust-lang/rust/commit/a7f28678bbf4e16893bb6a718e427504167a9494"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "2191d5d6e4680ce443cdae19d4bdbbccf3d1e1d3", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b01b5b911f3bb209ee619055a154cd81ca0674be/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b01b5b911f3bb209ee619055a154cd81ca0674be/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=b01b5b911f3bb209ee619055a154cd81ca0674be", "patch": "@@ -112,7 +112,7 @@ $COMMIT\\t$(cat \"$TOOLSTATE_FILE\")\n }\n \n if [ \"$RUST_RELEASE_CHANNEL\" = nightly ]; then\n-    if [ -n \"${TOOLSTATE_REPO_ACCESS_TOKEN+is_set}\" ]; then\n+    if [ -n \"${TOOLSTATE_PUBLISH+is_set}\" ]; then\n         . \"$(dirname $0)/repo.sh\"\n         MESSAGE_FILE=$(mktemp -t msg.XXXXXX)\n         echo \"($OS CI update)\" > \"$MESSAGE_FILE\""}]}