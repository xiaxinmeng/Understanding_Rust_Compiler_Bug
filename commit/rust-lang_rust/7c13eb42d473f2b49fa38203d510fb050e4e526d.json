{"sha": "7c13eb42d473f2b49fa38203d510fb050e4e526d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdjMTNlYjQyZDQ3M2YyYjQ5ZmEzODIwM2Q1MTBmYjA1MGU0ZTUyNmQ=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-09T15:17:20Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-14T09:12:10Z"}, "message": "Fix no-link-with-link-args by introducing another normalization.", "tree": {"sha": "a6e22f849389a2845dccd56943b45b4a7a1ebe72", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6e22f849389a2845dccd56943b45b4a7a1ebe72"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7c13eb42d473f2b49fa38203d510fb050e4e526d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAltynOoACgkQAXYLT59T\n8VQ7gxAApOr2Uyhi8v3FHNJz+qUvManCZdD84oPvMVeMQEh4BQd5n2e4Vm4PpyZs\nRnzh/9FMvYZZfdTmGE0eGB8yU+MkfYH7uP2+vf0k+GIwoMaKWUyV6RMpf5avtARL\nmJ7UOjqhS4ui88aFTNKSSEdUiW00LTYLXLJIFLPt5PTCBiT3hdJiuV/6H7LUifCF\nquoN61Tf61LMJSq42HUc6kGGnz5jAUbuQ+KAr95R9sBsI+VMGfozplfcapBjAygH\n2H77q0plw/YpuPB9LE1twCfh1VR8AyM/UqkFqLcjfQrcYXROBB1A1tR/xPlhaXls\npQaGEG0rrYCeXTu0vvlPLfxfVDA73m6ixB8VygL9QF/SHZGUeGnFo1sYfek9PxIv\nGuUedSCCH6Xvjv0OEUr2NcMnXbnvkdxuGUaINuoyMkkAlmb+CZb+gPUzqoDUm4Vp\nvTUF0hRj5iesKmnzPmCaYsZGPr+LynqEq0BDMwQlX2SlqqDEnSnVkMcNjcaSF7o/\nWcTxjc6dSsDAn594KLlC+W8/NjJYRUU3I7k7D/71MJsUMGfu+tIXjHFgI6y9LwCm\n2dUaZ6X8ljRRieREv4CyyNjdhC8p3Xk8kSK03hwIK/fOgvk9icxoEI9kxhSOuSu5\n5nKcTcwJfzvsi9EYRqHmQ2VUZo731sw/03avOCoZLDEUuupdkiU=\n=Daz1\n-----END PGP SIGNATURE-----", "payload": "tree a6e22f849389a2845dccd56943b45b4a7a1ebe72\nparent 003b5a8b0f22f99b45217389033ea713957121da\nauthor David Wood <david@davidtw.co> 1533827840 +0200\ncommitter David Wood <david@davidtw.co> 1534237930 +0200\n\nFix no-link-with-link-args by introducing another normalization.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7c13eb42d473f2b49fa38203d510fb050e4e526d", "html_url": "https://github.com/rust-lang/rust/commit/7c13eb42d473f2b49fa38203d510fb050e4e526d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7c13eb42d473f2b49fa38203d510fb050e4e526d/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "003b5a8b0f22f99b45217389033ea713957121da", "url": "https://api.github.com/repos/rust-lang/rust/commits/003b5a8b0f22f99b45217389033ea713957121da", "html_url": "https://github.com/rust-lang/rust/commit/003b5a8b0f22f99b45217389033ea713957121da"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "fc36c7c934928cb3dcc49592bc1b0dd1852a1839", "filename": "src/test/ui/nolink-with-link-args.nll.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftest%2Fui%2Fnolink-with-link-args.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftest%2Fui%2Fnolink-with-link-args.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnolink-with-link-args.nll.stderr?ref=7c13eb42d473f2b49fa38203d510fb050e4e526d", "patch": "@@ -1,6 +1,6 @@\n error: linking with `ld` failed: exit code: 1\n    |\n-   = note: \"ld\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/auxiliary\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-41f43a30bc296e4f\" \"--end-group\" \"-Bstatic\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-ce73107aecc35a63.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,/home/david/projects/rust/workdirs/rust1/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n+   = note: \"ld\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/auxiliary\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-XXXXXXXXXXXXXXXX\" \"--end-group\" \"-Bstatic\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-XXXXXXXXXXXXXXXX.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,$LIB_DIR/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n    = note: ld: unrecognized option '-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n            ld: use the --help option for usage information\n            "}, {"sha": "ba7a3adaa31a83e802da62d00828d0ffd0874e89", "filename": "src/test/ui/nolink-with-link-args.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftest%2Fui%2Fnolink-with-link-args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftest%2Fui%2Fnolink-with-link-args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnolink-with-link-args.rs?ref=7c13eb42d473f2b49fa38203d510fb050e4e526d", "patch": "@@ -8,6 +8,9 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+// normalize-stderr-test: \"-lstd-[\\d\\w]{16}\" -> \"-lstd-XXXXXXXXXXXXXXXX\"\n+// normalize-stderr-test: \"builtins-[\\d\\w]{16}.rlib\" -> \"builtins-XXXXXXXXXXXXXXXX.rlib\"\n+\n // error-pattern:aFdEfSeVEE\n // compile-flags: -Z linker-flavor=ld\n "}, {"sha": "03e7f476479e5f1da68d37ec498e9bac3e805400", "filename": "src/test/ui/nolink-with-link-args.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftest%2Fui%2Fnolink-with-link-args.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftest%2Fui%2Fnolink-with-link-args.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnolink-with-link-args.stderr?ref=7c13eb42d473f2b49fa38203d510fb050e4e526d", "patch": "@@ -1,6 +1,6 @@\n error: linking with `ld` failed: exit code: 1\n    |\n-   = note: \"ld\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"$TEST_BUILD_DIR/nolink-with-link-args/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"$TEST_BUILD_DIR/nolink-with-link-args/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"$TEST_BUILD_DIR/nolink-with-link-args/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"$TEST_BUILD_DIR/nolink-with-link-args/auxiliary\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-41f43a30bc296e4f\" \"--end-group\" \"-Bstatic\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-ce73107aecc35a63.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,/home/david/projects/rust/workdirs/rust1/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n+   = note: \"ld\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"$TEST_BUILD_DIR/nolink-with-link-args/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"$TEST_BUILD_DIR/nolink-with-link-args/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"$TEST_BUILD_DIR/nolink-with-link-args/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"$TEST_BUILD_DIR/nolink-with-link-args/auxiliary\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-XXXXXXXXXXXXXXXX\" \"--end-group\" \"-Bstatic\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-XXXXXXXXXXXXXXXX.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,$LIB_DIR/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n    = note: ld: unrecognized option '-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n            ld: use the --help option for usage information\n            "}, {"sha": "4b246ab674522f8b94afcdb0c19f7f4c3a0cae1a", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7c13eb42d473f2b49fa38203d510fb050e4e526d/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=7c13eb42d473f2b49fa38203d510fb050e4e526d", "patch": "@@ -2927,6 +2927,11 @@ impl<'test> TestCx<'test> {\n         // eg. /home/user/rust/build\n         normalized = normalized.replace(&parent_build_dir.to_str().unwrap(), \"$BUILD_DIR\");\n \n+        // Paths into lib directory.\n+        let mut lib_dir = parent_build_dir.parent().unwrap().to_path_buf();\n+        lib_dir.push(\"lib\");\n+        normalized = normalized.replace(&lib_dir.to_str().unwrap(), \"$LIB_DIR\");\n+\n         if json {\n             // escaped newlines in json strings should be readable\n             // in the stderr files. There's no point int being correct,"}]}