{"sha": "0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "node_id": "C_kwDOAAsO6NoAKDBlZmY1ODlhZmM4M2UyMWEwM2ExNjg0OTdiYmFiNmI0ZGZiYjRlZjY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-30T13:22:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-30T13:22:47Z"}, "message": "Auto merge of #8196 - flip1995:rustup, r=flip1995\n\nRustup\n\nr? `@ghost`\n\nchangelog: none", "tree": {"sha": "6f152609abd712912fd88ce0b0486dc267b0c183", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f152609abd712912fd88ce0b0486dc267b0c183"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "html_url": "https://github.com/rust-lang/rust/commit/0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1cd64b9c6b29ed2a577fc174a50c76267a966e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/c1cd64b9c6b29ed2a577fc174a50c76267a966e2", "html_url": "https://github.com/rust-lang/rust/commit/c1cd64b9c6b29ed2a577fc174a50c76267a966e2"}, {"sha": "b0f9894491a0d71e60d36871a7c6b45c96eb0a2b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0f9894491a0d71e60d36871a7c6b45c96eb0a2b", "html_url": "https://github.com/rust-lang/rust/commit/b0f9894491a0d71e60d36871a7c6b45c96eb0a2b"}], "stats": {"total": 309, "additions": 168, "deletions": 141}, "files": [{"sha": "5061c9d1eaf6f41a4a68b1c23a211b4ffb863c83", "filename": "clippy_lints/src/approx_const.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fapprox_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fapprox_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fapprox_const.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -87,7 +87,7 @@ impl ApproxConstant {\n         let s = s.as_str();\n         if s.parse::<f64>().is_ok() {\n             for &(constant, name, min_digits, msrv) in &KNOWN_CONSTS {\n-                if is_approx_const(constant, &s, min_digits)\n+                if is_approx_const(constant, s, min_digits)\n                     && msrv.as_ref().map_or(true, |msrv| meets_msrv(self.msrv.as_ref(), msrv))\n                 {\n                     span_lint_and_help("}, {"sha": "0629674307ba77dd86ad61b4f042a1a726cdf8dd", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -17,7 +17,7 @@ use rustc_semver::RustcVersion;\n use rustc_session::{declare_lint_pass, declare_tool_lint, impl_lint_pass};\n use rustc_span::source_map::Span;\n use rustc_span::sym;\n-use rustc_span::symbol::{Symbol, SymbolStr};\n+use rustc_span::symbol::Symbol;\n use semver::Version;\n \n static UNIX_SYSTEMS: &[&str] = &[\n@@ -310,8 +310,10 @@ impl<'tcx> LateLintPass<'tcx> for Attributes {\n                                             || is_word(lint, sym::deprecated)\n                                             || is_word(lint, sym!(unreachable_pub))\n                                             || is_word(lint, sym!(unused))\n-                                            || extract_clippy_lint(lint).map_or(false, |s| s == \"wildcard_imports\")\n-                                            || extract_clippy_lint(lint).map_or(false, |s| s == \"enum_glob_use\")\n+                                            || extract_clippy_lint(lint)\n+                                                .map_or(false, |s| s.as_str() == \"wildcard_imports\")\n+                                            || extract_clippy_lint(lint)\n+                                                .map_or(false, |s| s.as_str() == \"enum_glob_use\")\n                                         {\n                                             return;\n                                         }\n@@ -370,15 +372,15 @@ impl<'tcx> LateLintPass<'tcx> for Attributes {\n }\n \n /// Returns the lint name if it is clippy lint.\n-fn extract_clippy_lint(lint: &NestedMetaItem) -> Option<SymbolStr> {\n+fn extract_clippy_lint(lint: &NestedMetaItem) -> Option<Symbol> {\n     if_chain! {\n         if let Some(meta_item) = lint.meta_item();\n         if meta_item.path.segments.len() > 1;\n         if let tool_name = meta_item.path.segments[0].ident;\n         if tool_name.name == sym::clippy;\n         then {\n             let lint_name = meta_item.path.segments.last().unwrap().ident.name;\n-            return Some(lint_name.as_str());\n+            return Some(lint_name);\n         }\n     }\n     None\n@@ -387,7 +389,7 @@ fn extract_clippy_lint(lint: &NestedMetaItem) -> Option<SymbolStr> {\n fn check_clippy_lint_names(cx: &LateContext<'_>, name: Symbol, items: &[NestedMetaItem]) {\n     for lint in items {\n         if let Some(lint_name) = extract_clippy_lint(lint) {\n-            if lint_name == \"restriction\" && name != sym::allow {\n+            if lint_name.as_str() == \"restriction\" && name != sym::allow {\n                 span_lint_and_help(\n                     cx,\n                     BLANKET_CLIPPY_RESTRICTION_LINTS,\n@@ -486,7 +488,7 @@ fn check_attrs(cx: &LateContext<'_>, span: Span, name: Symbol, attrs: &[Attribut\n \n fn check_semver(cx: &LateContext<'_>, span: Span, lit: &Lit) {\n     if let LitKind::Str(is, _) = lit.kind {\n-        if Version::parse(&is.as_str()).is_ok() {\n+        if Version::parse(is.as_str()).is_ok() {\n             return;\n         }\n     }\n@@ -619,7 +621,7 @@ fn check_mismatched_target_os(cx: &EarlyContext<'_>, attr: &Attribute) {\n                     MetaItemKind::Word => {\n                         if_chain! {\n                             if let Some(ident) = meta.ident();\n-                            if let Some(os) = find_os(&*ident.name.as_str());\n+                            if let Some(os) = find_os(ident.name.as_str());\n                             then {\n                                 mismatched.push((os, ident.span));\n                             }"}, {"sha": "43ad0f7605c106bdf4ce1a4899a99c955e295a00", "filename": "clippy_lints/src/booleans.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fbooleans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fbooleans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fbooleans.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -272,7 +272,7 @@ fn simplify_not(cx: &LateContext<'_>, expr: &Expr<'_>) -> Option<String> {\n                 .copied()\n                 .flat_map(|(a, b)| vec![(a, b), (b, a)])\n                 .find(|&(a, _)| {\n-                    let path: &str = &path.ident.name.as_str();\n+                    let path: &str = path.ident.name.as_str();\n                     a == path\n                 })\n                 .and_then(|(_, neg_method)| Some(format!(\"{}.{}()\", snippet_opt(cx, args[0].span)?, neg_method)))"}, {"sha": "31cc3698592b35d26440a901ef34a3cb926bda92", "filename": "clippy_lints/src/checked_conversions.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fchecked_conversions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fchecked_conversions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fchecked_conversions.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -321,8 +321,8 @@ fn get_implementing_type<'a>(path: &QPath<'_>, candidates: &'a [&str], function:\n         if let TyKind::Path(QPath::Resolved(None, tp)) = &ty.kind;\n         if let [int] = &*tp.segments;\n         then {\n-            let name = &int.ident.name.as_str();\n-            candidates.iter().find(|c| name == *c).copied()\n+            let name = int.ident.name.as_str();\n+            candidates.iter().find(|c| &name == *c).copied()\n         } else {\n             None\n         }\n@@ -335,8 +335,8 @@ fn int_ty_to_sym<'tcx>(path: &QPath<'_>) -> Option<&'tcx str> {\n         if let QPath::Resolved(_, path) = *path;\n         if let [ty] = &*path.segments;\n         then {\n-            let name = &ty.ident.name.as_str();\n-            INTS.iter().find(|c| name == *c).copied()\n+            let name = ty.ident.name.as_str();\n+            INTS.iter().find(|c| &name == *c).copied()\n         } else {\n             None\n         }"}, {"sha": "3650e4f91a001020c8952f518ae89af0b3bc3a19", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -437,7 +437,7 @@ fn check_attrs<'a>(cx: &LateContext<'_>, valid_idents: &FxHashSet<String>, attrs\n \n     for attr in attrs {\n         if let AttrKind::DocComment(comment_kind, comment) = attr.kind {\n-            let (comment, current_spans) = strip_doc_comment_decoration(&comment.as_str(), comment_kind, attr.span);\n+            let (comment, current_spans) = strip_doc_comment_decoration(comment.as_str(), comment_kind, attr.span);\n             spans.extend_from_slice(&current_spans);\n             doc.push_str(&comment);\n         } else if attr.has_name(sym::doc) {"}, {"sha": "50dd0d84fda518f0d3d4663c694187f8e0d55128", "filename": "clippy_lints/src/duration_subsec.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fduration_subsec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fduration_subsec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fduration_subsec.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -49,7 +49,7 @@ impl<'tcx> LateLintPass<'tcx> for DurationSubsec {\n             if match_type(cx, cx.typeck_results().expr_ty(&args[0]).peel_refs(), &paths::DURATION);\n             if let Some((Constant::Int(divisor), _)) = constant(cx, cx.typeck_results(), right);\n             then {\n-                let suggested_fn = match (method_path.ident.as_str().as_ref(), divisor) {\n+                let suggested_fn = match (method_path.ident.as_str(), divisor) {\n                     (\"subsec_micros\", 1_000) | (\"subsec_nanos\", 1_000_000) => \"subsec_millis\",\n                     (\"subsec_nanos\", 1_000) => \"subsec_micros\",\n                     _ => return,"}, {"sha": "4f89e5674306817ab83b3f3f791e80716aed6c4c", "filename": "clippy_lints/src/enum_variants.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fenum_variants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fenum_variants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fenum_variants.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -130,7 +130,7 @@ fn check_enum_start(cx: &LateContext<'_>, item_name: &str, variant: &Variant<'_>\n     let name = variant.ident.name.as_str();\n     let item_name_chars = item_name.chars().count();\n \n-    if count_match_start(item_name, &name).char_count == item_name_chars\n+    if count_match_start(item_name, name).char_count == item_name_chars\n         && name.chars().nth(item_name_chars).map_or(false, |c| !c.is_lowercase())\n         && name.chars().nth(item_name_chars + 1).map_or(false, |c| !c.is_numeric())\n     {\n@@ -147,7 +147,7 @@ fn check_enum_end(cx: &LateContext<'_>, item_name: &str, variant: &Variant<'_>)\n     let name = variant.ident.name.as_str();\n     let item_name_chars = item_name.chars().count();\n \n-    if count_match_end(item_name, &name).char_count == item_name_chars {\n+    if count_match_end(item_name, name).char_count == item_name_chars {\n         span_lint(\n             cx,\n             ENUM_VARIANT_NAMES,\n@@ -171,7 +171,7 @@ fn check_variant(cx: &LateContext<'_>, threshold: u64, def: &EnumDef<'_>, item_n\n         check_enum_end(cx, item_name, var);\n         let name = var.ident.name.as_str();\n \n-        let variant_split = camel_case_split(&name);\n+        let variant_split = camel_case_split(name);\n \n         pre = pre\n             .iter()\n@@ -240,7 +240,7 @@ impl LateLintPass<'_> for EnumVariantNames {\n     #[allow(clippy::similar_names)]\n     fn check_item(&mut self, cx: &LateContext<'_>, item: &Item<'_>) {\n         let item_name = item.ident.name.as_str();\n-        let item_camel = to_camel_case(&item_name);\n+        let item_camel = to_camel_case(item_name);\n         if !item.span.from_expansion() && is_present_in_source(cx, item.span) {\n             if let Some(&(ref mod_name, ref mod_camel)) = self.modules.last() {\n                 // constants don't have surrounding modules\n@@ -289,7 +289,7 @@ impl LateLintPass<'_> for EnumVariantNames {\n         }\n         if let ItemKind::Enum(ref def, _) = item.kind {\n             if !(self.avoid_breaking_exported_api && cx.access_levels.is_exported(item.def_id)) {\n-                check_variant(cx, self.threshold, def, &item_name, item.span);\n+                check_variant(cx, self.threshold, def, item_name, item.span);\n             }\n         }\n         self.modules.push((item.ident.name, item_camel));"}, {"sha": "06d128f5527b5d8ba3d965b65853c1a0507cf153", "filename": "clippy_lints/src/equatable_if_let.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fequatable_if_let.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fequatable_if_let.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fequatable_if_let.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -67,20 +67,20 @@ fn is_structural_partial_eq(cx: &LateContext<'tcx>, ty: Ty<'tcx>, other: Ty<'tcx\n impl<'tcx> LateLintPass<'tcx> for PatternEquality {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'tcx>) {\n         if_chain! {\n-            if let ExprKind::Let(pat, exp, _) = expr.kind;\n-            if unary_pattern(pat);\n-            let exp_ty = cx.typeck_results().expr_ty(exp);\n-            let pat_ty = cx.typeck_results().pat_ty(pat);\n+            if let ExprKind::Let(let_expr) = expr.kind;\n+            if unary_pattern(let_expr.pat);\n+            let exp_ty = cx.typeck_results().expr_ty(let_expr.init);\n+            let pat_ty = cx.typeck_results().pat_ty(let_expr.pat);\n             if is_structural_partial_eq(cx, exp_ty, pat_ty);\n             then {\n \n                 let mut applicability = Applicability::MachineApplicable;\n-                let pat_str = match pat.kind {\n+                let pat_str = match let_expr.pat.kind {\n                     PatKind::Struct(..) => format!(\n                         \"({})\",\n-                        snippet_with_context(cx, pat.span, expr.span.ctxt(), \"..\", &mut applicability).0,\n+                        snippet_with_context(cx, let_expr.pat.span, expr.span.ctxt(), \"..\", &mut applicability).0,\n                     ),\n-                    _ => snippet_with_context(cx, pat.span, expr.span.ctxt(), \"..\", &mut applicability).0.to_string(),\n+                    _ => snippet_with_context(cx, let_expr.pat.span, expr.span.ctxt(), \"..\", &mut applicability).0.to_string(),\n                 };\n                 span_lint_and_sugg(\n                     cx,\n@@ -90,7 +90,7 @@ impl<'tcx> LateLintPass<'tcx> for PatternEquality {\n                     \"try\",\n                     format!(\n                         \"{} == {}\",\n-                        snippet_with_context(cx, exp.span, expr.span.ctxt(), \"..\", &mut applicability).0,\n+                        snippet_with_context(cx, let_expr.init.span, expr.span.ctxt(), \"..\", &mut applicability).0,\n                         pat_str,\n                     ),\n                     applicability,"}, {"sha": "7a4397a7b746714ac8cd70d26d4a797e76976f13", "filename": "clippy_lints/src/float_literal.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Ffloat_literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Ffloat_literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ffloat_literal.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -68,12 +68,12 @@ impl<'tcx> LateLintPass<'tcx> for FloatLiteral {\n             if let LitKind::Float(sym, lit_float_ty) = lit.node;\n             then {\n                 let sym_str = sym.as_str();\n-                let formatter = FloatFormat::new(&sym_str);\n+                let formatter = FloatFormat::new(sym_str);\n                 // Try to bail out if the float is for sure fine.\n                 // If its within the 2 decimal digits of being out of precision we\n                 // check if the parsed representation is the same as the string\n                 // since we'll need the truncated string anyway.\n-                let digits = count_digits(&sym_str);\n+                let digits = count_digits(sym_str);\n                 let max = max_digits(fty);\n                 let type_suffix = match lit_float_ty {\n                     LitFloatType::Suffixed(ast::FloatTy::F32) => Some(\"f32\"),"}, {"sha": "6dcbaf68dfdbcb3787087603e2cba3bb00a94fef", "filename": "clippy_lints/src/floating_point_arithmetic.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -595,7 +595,7 @@ fn are_same_base_logs(cx: &LateContext<'_>, expr_a: &Expr<'_>, expr_b: &Expr<'_>\n             return method_name_a.as_str() == method_name_b.as_str() &&\n                 args_a.len() == args_b.len() &&\n                 (\n-                    [\"ln\", \"log2\", \"log10\"].contains(&&*method_name_a.as_str()) ||\n+                    [\"ln\", \"log2\", \"log10\"].contains(&method_name_a.as_str()) ||\n                     method_name_a.as_str() == \"log\" && args_a.len() == 2 && eq_expr_value(cx, &args_a[1], &args_b[1])\n                 );\n         }\n@@ -718,7 +718,7 @@ impl<'tcx> LateLintPass<'tcx> for FloatingPointArithmetic {\n             let recv_ty = cx.typeck_results().expr_ty(&args[0]);\n \n             if recv_ty.is_floating_point() {\n-                match &*path.ident.name.as_str() {\n+                match path.ident.name.as_str() {\n                     \"ln\" => check_ln1p(cx, expr, args),\n                     \"log\" => check_log_base(cx, expr, args),\n                     \"powf\" => check_powf(cx, expr, args),"}, {"sha": "6515975fbffdc8b1b723e4196059168ebdda1256", "filename": "clippy_lints/src/implicit_saturating_sub.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -96,7 +96,7 @@ impl<'tcx> LateLintPass<'tcx> for ImplicitSaturatingSub {\n                         if let LitKind::Int(0, _) = cond_lit.node {\n                             if cx.typeck_results().expr_ty(cond_left).is_signed() {\n                             } else {\n-                                print_lint_and_sugg(cx, &var_name, expr);\n+                                print_lint_and_sugg(cx, var_name, expr);\n                             };\n                         }\n                     },\n@@ -108,7 +108,7 @@ impl<'tcx> LateLintPass<'tcx> for ImplicitSaturatingSub {\n                             let mut int_ids = INT_TYPES.iter().filter_map(|&ty| cx.tcx.lang_items().require(ty).ok());\n                             if int_ids.any(|int_id| int_id == impl_id);\n                             then {\n-                                print_lint_and_sugg(cx, &var_name, expr)\n+                                print_lint_and_sugg(cx, var_name, expr)\n                             }\n                         }\n                     },\n@@ -121,7 +121,7 @@ impl<'tcx> LateLintPass<'tcx> for ImplicitSaturatingSub {\n                             let mut int_ids = INT_TYPES.iter().filter_map(|&ty| cx.tcx.lang_items().require(ty).ok());\n                             if int_ids.any(|int_id| int_id == impl_id);\n                             then {\n-                                print_lint_and_sugg(cx, &var_name, expr)\n+                                print_lint_and_sugg(cx, var_name, expr)\n                             }\n                         }\n                     },"}, {"sha": "0af6b3b7d464ef67ab1e7b1ba16dcbe2ac802dca", "filename": "clippy_lints/src/iter_not_returning_iterator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -42,7 +42,7 @@ declare_lint_pass!(IterNotReturningIterator => [ITER_NOT_RETURNING_ITERATOR]);\n \n impl LateLintPass<'_> for IterNotReturningIterator {\n     fn check_impl_item(&mut self, cx: &LateContext<'tcx>, impl_item: &'tcx ImplItem<'tcx>) {\n-        let name: &str = &impl_item.ident.name.as_str();\n+        let name = impl_item.ident.name.as_str();\n         if_chain! {\n             if let ImplItemKind::Fn(fn_sig, _) = &impl_item.kind;\n             let ret_ty = return_ty(cx, impl_item.hir_id());"}, {"sha": "20e6220ec7d3adaa3250873b8285e53e533462a9", "filename": "clippy_lints/src/len_zero.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Flen_zero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Flen_zero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flen_zero.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -441,7 +441,7 @@ fn is_empty_string(expr: &Expr<'_>) -> bool {\n     if let ExprKind::Lit(ref lit) = expr.kind {\n         if let LitKind::Str(lit, _) = lit.node {\n             let lit = lit.as_str();\n-            return lit == \"\";\n+            return lit.is_empty();\n         }\n     }\n     false"}, {"sha": "b03445b8cd6b08df5008424ec994f9e15a46266f", "filename": "clippy_lints/src/loops/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Floops%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Floops%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops%2Fmod.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -659,7 +659,7 @@ fn check_for_loop_arg(cx: &LateContext<'_>, pat: &Pat<'_>, arg: &Expr<'_>) {\n     let mut next_loop_linted = false; // whether or not ITER_NEXT_LOOP lint was used\n \n     if let ExprKind::MethodCall(method, _, [self_arg], _) = arg.kind {\n-        let method_name = &*method.ident.as_str();\n+        let method_name = method.ident.as_str();\n         // check for looping over x.iter() or x.iter_mut(), could use &x or &mut x\n         match method_name {\n             \"iter\" | \"iter_mut\" => explicit_iter_loop::check(cx, self_arg, arg, method_name),"}, {"sha": "ba895f35faa267a1d7e0545bdc6f8bdf978f3afd", "filename": "clippy_lints/src/loops/needless_collect.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Floops%2Fneedless_collect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Floops%2Fneedless_collect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops%2Fneedless_collect.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -31,7 +31,7 @@ fn check_needless_collect_direct_usage<'tcx>(expr: &'tcx Expr<'_>, cx: &LateCont\n             let ty = cx.typeck_results().expr_ty(&args[0]);\n             let mut applicability = Applicability::MaybeIncorrect;\n             let is_empty_sugg = \"next().is_none()\".to_string();\n-            let method_name = &*method.ident.name.as_str();\n+            let method_name = method.ident.name.as_str();\n             let sugg = if is_type_diagnostic_item(cx, ty, sym::Vec) ||\n                         is_type_diagnostic_item(cx, ty, sym::VecDeque) ||\n                         is_type_diagnostic_item(cx, ty, sym::LinkedList) ||\n@@ -210,7 +210,7 @@ impl<'tcx> Visitor<'tcx> for IterFunctionVisitor<'_, 'tcx> {\n                     if let Some(hir_id) = self.current_statement_hir_id {\n                         self.hir_id_uses_map.insert(hir_id, self.uses.len());\n                     }\n-                    match &*method_name.ident.name.as_str() {\n+                    match method_name.ident.name.as_str() {\n                         \"into_iter\" => self.uses.push(Some(IterFunction {\n                             func: IterFunctionKind::IntoIter,\n                             span: expr.span,"}, {"sha": "a3aa6be6afd645ccd94a717d431c481af8c1ed5d", "filename": "clippy_lints/src/loops/never_loop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Floops%2Fnever_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Floops%2Fnever_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops%2Fnever_loop.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -115,12 +115,12 @@ fn never_loop_expr(expr: &Expr<'_>, main_loop_id: HirId) -> NeverLoopResult {\n         | ExprKind::Unary(_, e)\n         | ExprKind::Cast(e, _)\n         | ExprKind::Type(e, _)\n-        | ExprKind::Let(_, e, _)\n         | ExprKind::Field(e, _)\n         | ExprKind::AddrOf(_, _, e)\n         | ExprKind::Struct(_, _, Some(e))\n         | ExprKind::Repeat(e, _)\n         | ExprKind::DropTemps(e) => never_loop_expr(e, main_loop_id),\n+        ExprKind::Let(let_expr) => never_loop_expr(let_expr.init, main_loop_id),\n         ExprKind::Array(es) | ExprKind::MethodCall(_, _, es, _) | ExprKind::Tup(es) => {\n             never_loop_expr_all(&mut es.iter(), main_loop_id)\n         },"}, {"sha": "5a2a965716cc6bc457454f304ae9157db0970b9a", "filename": "clippy_lints/src/manual_assert.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmanual_assert.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmanual_assert.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmanual_assert.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -50,7 +50,7 @@ impl LateLintPass<'_> for ManualAssert {\n                 ..\n             } = &expr;\n             if is_expn_of(stmt.span, \"panic\").is_some();\n-            if !matches!(cond.kind, ExprKind::Let(_, _, _));\n+            if !matches!(cond.kind, ExprKind::Let(_));\n             if let StmtKind::Semi(semi) = stmt.kind;\n             if !cx.tcx.sess.source_map().is_multiline(cond.span);\n "}, {"sha": "2c0fc218ca07c0d5eabb6a3140c540406a938a6d", "filename": "clippy_lints/src/match_str_case_mismatch.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmatch_str_case_mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmatch_str_case_mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatch_str_case_mismatch.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -9,7 +9,7 @@ use rustc_middle::hir::map::Map;\n use rustc_middle::lint::in_external_macro;\n use rustc_middle::ty;\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n-use rustc_span::symbol::SymbolStr;\n+use rustc_span::symbol::Symbol;\n use rustc_span::{sym, Span};\n \n declare_clippy_lint! {\n@@ -71,8 +71,8 @@ impl LateLintPass<'_> for MatchStrCaseMismatch {\n                 visitor.visit_expr(match_expr);\n \n                 if let Some(case_method) = visitor.case_method {\n-                    if let Some((bad_case_span, bad_case_str)) = verify_case(&case_method, arms) {\n-                        lint(cx, &case_method, bad_case_span, &bad_case_str);\n+                    if let Some((bad_case_span, bad_case_sym)) = verify_case(&case_method, arms) {\n+                        lint(cx, &case_method, bad_case_span, bad_case_sym.as_str());\n                     }\n                 }\n             }\n@@ -94,8 +94,8 @@ impl<'a, 'tcx> Visitor<'tcx> for MatchExprVisitor<'a, 'tcx> {\n \n     fn visit_expr(&mut self, ex: &'tcx Expr<'_>) {\n         match ex.kind {\n-            ExprKind::MethodCall(segment, _, [receiver], _)\n-                if self.case_altered(&*segment.ident.as_str(), receiver) => {},\n+            ExprKind::MethodCall(segment, _, [receiver], _) if self.case_altered(segment.ident.as_str(), receiver) => {\n+            },\n             _ => walk_expr(self, ex),\n         }\n     }\n@@ -126,7 +126,7 @@ fn get_case_method(segment_ident_str: &str) -> Option<CaseMethod> {\n     }\n }\n \n-fn verify_case<'a>(case_method: &'a CaseMethod, arms: &'a [Arm<'_>]) -> Option<(Span, SymbolStr)> {\n+fn verify_case<'a>(case_method: &'a CaseMethod, arms: &'a [Arm<'_>]) -> Option<(Span, Symbol)> {\n     let case_check = match case_method {\n         CaseMethod::LowerCase => |input: &str| -> bool { input.chars().all(|c| c.to_lowercase().next() == Some(c)) },\n         CaseMethod::AsciiLowerCase => |input: &str| -> bool { !input.chars().any(|c| c.is_ascii_uppercase()) },\n@@ -142,9 +142,9 @@ fn verify_case<'a>(case_method: &'a CaseMethod, arms: &'a [Arm<'_>]) -> Option<(\n                             }) = arm.pat.kind;\n             if let LitKind::Str(symbol, _) = lit.node;\n             let input = symbol.as_str();\n-            if !case_check(&input);\n+            if !case_check(input);\n             then {\n-                return Some((lit.span, input));\n+                return Some((lit.span, symbol));\n             }\n         }\n     }"}, {"sha": "22970507f964c2c9416ab1fadead327da3637995", "filename": "clippy_lints/src/matches.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -966,7 +966,7 @@ fn check_wild_err_arm<'tcx>(cx: &LateContext<'tcx>, ex: &Expr<'tcx>, arms: &[Arm\n                         for pat in inner.iter() {\n                             if let PatKind::Binding(_, id, ident, None) = pat.kind {\n                                 if ident.as_str().starts_with('_') && !is_local_used(cx, arm.body, id) {\n-                                    ident_bind_name = (&ident.name.as_str()).to_string();\n+                                    ident_bind_name = ident.name.as_str().to_string();\n                                     matching_wild = true;\n                                 }\n                             }\n@@ -1127,7 +1127,7 @@ fn check_wild_enum_match(cx: &LateContext<'_>, ex: &Expr<'_>, arms: &[Arm<'_>])\n             if let CommonPrefixSearcher::Path(path_prefix) = path_prefix {\n                 let mut s = String::new();\n                 for seg in path_prefix {\n-                    s.push_str(&seg.ident.as_str());\n+                    s.push_str(seg.ident.as_str());\n                     s.push_str(\"::\");\n                 }\n                 s"}, {"sha": "4307cbf00507a1fcb130f83793770af35a4c334d", "filename": "clippy_lints/src/methods/manual_saturating_arithmetic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Fmanual_saturating_arithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Fmanual_saturating_arithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmanual_saturating_arithmetic.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -81,7 +81,7 @@ fn is_min_or_max<'tcx>(cx: &LateContext<'tcx>, expr: &hir::Expr<'_>) -> Option<M\n         if args.is_empty();\n         if let hir::ExprKind::Path(hir::QPath::TypeRelative(_, segment)) = &func.kind;\n         then {\n-            match &*segment.ident.as_str() {\n+            match segment.ident.as_str() {\n                 \"max_value\" => return Some(MinMax::Max),\n                 \"min_value\" => return Some(MinMax::Min),\n                 _ => {}"}, {"sha": "4e33b2ff14cdeaa2e3d7427e5349c30c2f22a5d5", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -80,7 +80,7 @@ use rustc_middle::lint::in_external_macro;\n use rustc_middle::ty::{self, TraitRef, Ty, TyS};\n use rustc_semver::RustcVersion;\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n-use rustc_span::symbol::SymbolStr;\n+use rustc_span::symbol::Symbol;\n use rustc_span::{sym, Span};\n use rustc_typeck::hir_ty_to_ty;\n \n@@ -1997,21 +1997,21 @@ impl_lint_pass!(Methods => [\n ]);\n \n /// Extracts a method call name, args, and `Span` of the method name.\n-fn method_call<'tcx>(recv: &'tcx hir::Expr<'tcx>) -> Option<(SymbolStr, &'tcx [hir::Expr<'tcx>], Span)> {\n+fn method_call<'tcx>(recv: &'tcx hir::Expr<'tcx>) -> Option<(Symbol, &'tcx [hir::Expr<'tcx>], Span)> {\n     if let ExprKind::MethodCall(path, span, args, _) = recv.kind {\n         if !args.iter().any(|e| e.span.from_expansion()) {\n-            return Some((path.ident.name.as_str(), args, span));\n+            return Some((path.ident.name, args, span));\n         }\n     }\n     None\n }\n \n-/// Same as `method_call` but the `SymbolStr` is dereferenced into a temporary `&str`\n+/// Same as `method_call` but the `Symbol` is dereferenced into a temporary `&str`\n macro_rules! method_call {\n     ($expr:expr) => {\n         method_call($expr)\n             .as_ref()\n-            .map(|&(ref name, args, span)| (&**name, args, span))\n+            .map(|&(ref name, args, span)| (name.as_str(), args, span))\n     };\n }\n \n@@ -2028,8 +2028,8 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n                 from_iter_instead_of_collect::check(cx, expr, args, func);\n             },\n             hir::ExprKind::MethodCall(method_call, ref method_span, args, _) => {\n-                or_fun_call::check(cx, expr, *method_span, &method_call.ident.as_str(), args);\n-                expect_fun_call::check(cx, expr, *method_span, &method_call.ident.as_str(), args);\n+                or_fun_call::check(cx, expr, *method_span, method_call.ident.as_str(), args);\n+                expect_fun_call::check(cx, expr, *method_span, method_call.ident.as_str(), args);\n                 clone_on_copy::check(cx, expr, method_call.ident.name, args);\n                 clone_on_ref_ptr::check(cx, expr, method_call.ident.name, args);\n                 inefficient_to_string::check(cx, expr, method_call.ident.name, args);\n@@ -2112,7 +2112,7 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n                 {\n                     wrong_self_convention::check(\n                         cx,\n-                        &name,\n+                        name,\n                         self_ty,\n                         first_arg_ty,\n                         first_arg.pat.span,\n@@ -2184,7 +2184,7 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n                 let self_ty = TraitRef::identity(cx.tcx, item.def_id.to_def_id()).self_ty().skip_binder();\n                 wrong_self_convention::check(\n                     cx,\n-                    &item.ident.name.as_str(),\n+                    item.ident.name.as_str(),\n                     self_ty,\n                     first_arg_ty,\n                     first_arg_span,"}, {"sha": "70f20da1d6db795f4e452d1c618d6efeb790d552", "filename": "clippy_lints/src/methods/str_splitn.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Fstr_splitn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Fstr_splitn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fstr_splitn.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -140,7 +140,7 @@ fn parse_iter_usage(\n             let did = cx.typeck_results().type_dependent_def_id(e.hir_id)?;\n             let iter_id = cx.tcx.get_diagnostic_item(sym::Iterator)?;\n \n-            match (&*name.ident.as_str(), args) {\n+            match (name.ident.as_str(), args) {\n                 (\"next\", []) if cx.tcx.trait_of_item(did) == Some(iter_id) => {\n                     if reverse {\n                         (IterUsageKind::Second, e.span)\n@@ -298,7 +298,7 @@ fn check_iter(\n                 if let Some(did) = cx.typeck_results().type_dependent_def_id(e.hir_id);\n                 if let Some(iter_id) = cx.tcx.get_diagnostic_item(sym::Iterator);\n                 then {\n-                    match (&*name.ident.as_str(), args) {\n+                    match (name.ident.as_str(), args) {\n                         (\"next\", []) if cx.tcx.trait_of_item(did) == Some(iter_id) => {\n                             return true;\n                         },"}, {"sha": "24b44f819f41997df804161082b5e7e5a7887ac0", "filename": "clippy_lints/src/methods/utils.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmethods%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Futils.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -57,7 +57,7 @@ pub(super) fn get_hint_if_single_char_arg(\n         let string = r.as_str();\n         if string.chars().count() == 1;\n         then {\n-            let snip = snippet_with_applicability(cx, arg.span, &string, applicability);\n+            let snip = snippet_with_applicability(cx, arg.span, string, applicability);\n             let ch = if let ast::StrStyle::Raw(nhash) = style {\n                 let nhash = nhash as usize;\n                 // for raw string: r##\"a\"##"}, {"sha": "401dc27811dc3aa05ca5de9c822c9bb41c7a7bd5", "filename": "clippy_lints/src/misc.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -407,6 +407,7 @@ impl<'tcx> LateLintPass<'tcx> for MiscLints {\n             // Don't lint things expanded by #[derive(...)], etc or `await` desugaring\n             return;\n         }\n+        let sym;\n         let binding = match expr.kind {\n             ExprKind::Path(ref qpath) if !matches!(qpath, hir::QPath::LangItem(..)) => {\n                 let binding = last_path_segment(qpath).ident.as_str();\n@@ -423,7 +424,8 @@ impl<'tcx> LateLintPass<'tcx> for MiscLints {\n                 }\n             },\n             ExprKind::Field(_, ident) => {\n-                let name = ident.as_str();\n+                sym = ident.name;\n+                let name = sym.as_str();\n                 if name.starts_with('_') && !name.starts_with(\"__\") {\n                     Some(name)\n                 } else {"}, {"sha": "566e15ab2a6d640aff7e55090733d58c4313762b", "filename": "clippy_lints/src/missing_enforced_import_rename.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmissing_enforced_import_rename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmissing_enforced_import_rename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_enforced_import_rename.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -75,7 +75,7 @@ impl LateLintPass<'_> for ImportRename {\n             if let Some(import) = match snip.split_once(\" as \") {\n                 None => Some(snip.as_str()),\n                 Some((import, rename)) => {\n-                    if rename.trim() == &*name.as_str() {\n+                    if rename.trim() == name.as_str() {\n                         None\n                     } else {\n                         Some(import.trim())"}, {"sha": "1f9db39cf8ca6a7e9742a2761d4bb89b466614f6", "filename": "clippy_lints/src/multiple_crate_versions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmultiple_crate_versions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmultiple_crate_versions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmultiple_crate_versions.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -48,15 +48,15 @@ impl LateLintPass<'_> for MultipleCrateVersions {\n         }\n \n         let metadata = unwrap_cargo_metadata!(cx, MULTIPLE_CRATE_VERSIONS, true);\n-        let local_name = cx.tcx.crate_name(LOCAL_CRATE).as_str();\n+        let local_name = cx.tcx.crate_name(LOCAL_CRATE);\n         let mut packages = metadata.packages;\n         packages.sort_by(|a, b| a.name.cmp(&b.name));\n \n         if_chain! {\n             if let Some(resolve) = &metadata.resolve;\n             if let Some(local_id) = packages\n                 .iter()\n-                .find_map(|p| if p.name == *local_name { Some(&p.id) } else { None });\n+                .find_map(|p| if p.name == local_name.as_str() { Some(&p.id) } else { None });\n             then {\n                 for (name, group) in &packages.iter().group_by(|p| p.name.clone()) {\n                     let group: Vec<&Package> = group.collect();"}, {"sha": "22834cf61ee038224db9e08d897bd65d67a7e14d", "filename": "clippy_lints/src/mut_reference.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmut_reference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fmut_reference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmut_reference.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -49,7 +49,7 @@ impl<'tcx> LateLintPass<'tcx> for UnnecessaryMutPassed {\n                 let def_id = cx.typeck_results().type_dependent_def_id(e.hir_id).unwrap();\n                 let substs = cx.typeck_results().node_substs(e.hir_id);\n                 let method_type = cx.tcx.type_of(def_id).subst(cx.tcx, substs);\n-                check_arguments(cx, arguments, method_type, &path.ident.as_str(), \"method\");\n+                check_arguments(cx, arguments, method_type, path.ident.as_str(), \"method\");\n             },\n             _ => (),\n         }"}, {"sha": "0931fec149ebfe557ec6edef687b93671e981cc0", "filename": "clippy_lints/src/needless_option_as_deref.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fneedless_option_as_deref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fneedless_option_as_deref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_option_as_deref.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -48,7 +48,7 @@ impl<'tcx> LateLintPass<'tcx> for OptionNeedlessDeref {\n             if is_type_diagnostic_item(cx,outer_ty,sym::Option);\n             if let ExprKind::MethodCall(path, _, [sub_expr], _) = expr.kind;\n             let symbol = path.ident.as_str();\n-            if symbol==\"as_deref\" || symbol==\"as_deref_mut\";\n+            if symbol == \"as_deref\" || symbol == \"as_deref_mut\";\n             if TyS::same_type( outer_ty, typeck.expr_ty(sub_expr) );\n             then{\n                 span_lint_and_sugg("}, {"sha": "39a37e3e378ed4002b483d4b4800250e55e34e48", "filename": "clippy_lints/src/non_expressive_names.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fnon_expressive_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fnon_expressive_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fnon_expressive_names.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -218,20 +218,20 @@ impl<'a, 'tcx, 'b> SimilarNamesNameVisitor<'a, 'tcx, 'b> {\n             return;\n         }\n         for existing_name in &self.0.names {\n-            if allowed_to_be_similar(&interned_name, existing_name.exemptions) {\n+            if allowed_to_be_similar(interned_name, existing_name.exemptions) {\n                 continue;\n             }\n             match existing_name.len.cmp(&count) {\n                 Ordering::Greater => {\n                     if existing_name.len - count != 1\n-                        || levenstein_not_1(&interned_name, &existing_name.interned.as_str())\n+                        || levenstein_not_1(interned_name, existing_name.interned.as_str())\n                     {\n                         continue;\n                     }\n                 },\n                 Ordering::Less => {\n                     if count - existing_name.len != 1\n-                        || levenstein_not_1(&existing_name.interned.as_str(), &interned_name)\n+                        || levenstein_not_1(existing_name.interned.as_str(), interned_name)\n                     {\n                         continue;\n                     }\n@@ -298,7 +298,7 @@ impl<'a, 'tcx, 'b> SimilarNamesNameVisitor<'a, 'tcx, 'b> {\n             return;\n         }\n         self.0.names.push(ExistingName {\n-            exemptions: get_exemptions(&interned_name).unwrap_or(&[]),\n+            exemptions: get_exemptions(interned_name).unwrap_or(&[]),\n             interned: ident.name,\n             span: ident.span,\n             len: count,"}, {"sha": "4722c031006be465d66049cbab8acfc4ea59c4a8", "filename": "clippy_lints/src/nonstandard_macro_braces.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fnonstandard_macro_braces.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fnonstandard_macro_braces.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fnonstandard_macro_braces.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -104,7 +104,7 @@ fn is_offending_macro<'a>(cx: &EarlyContext<'_>, span: Span, mac_braces: &'a Mac\n     };\n     if_chain! {\n         if let ExpnKind::Macro(MacroKind::Bang, mac_name) = span.ctxt().outer_expn_data().kind;\n-        let name = &*mac_name.as_str();\n+        let name = mac_name.as_str();\n         if let Some(braces) = mac_braces.macro_braces.get(name);\n         if let Some(snip) = snippet_opt(cx, span.ctxt().outer_expn_data().call_site);\n         // we must check only invocation sites"}, {"sha": "1b9285c2298df7f48e5ae9f9fe1da0a942a1c7df", "filename": "clippy_lints/src/open_options.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fopen_options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fopen_options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fopen_options.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -82,7 +82,7 @@ fn get_open_options(cx: &LateContext<'_>, argument: &Expr<'_>, options: &mut Vec\n                 _ => Argument::Unknown,\n             };\n \n-            match &*path.ident.as_str() {\n+            match path.ident.as_str() {\n                 \"create\" => {\n                     options.push((OpenOption::Create, argument_option));\n                 },"}, {"sha": "e58ca95fa042000639a305af32ea1aa8999b2f7b", "filename": "clippy_lints/src/path_buf_push_overwrite.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fpath_buf_push_overwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fpath_buf_push_overwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fpath_buf_push_overwrite.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -53,7 +53,7 @@ impl<'tcx> LateLintPass<'tcx> for PathBufPushOverwrite {\n             if let Some(get_index_arg) = args.get(1);\n             if let ExprKind::Lit(ref lit) = get_index_arg.kind;\n             if let LitKind::Str(ref path_lit, _) = lit.node;\n-            if let pushed_path = Path::new(&*path_lit.as_str());\n+            if let pushed_path = Path::new(path_lit.as_str());\n             if let Some(pushed_path_lit) = pushed_path.to_str();\n             if pushed_path.has_root();\n             if let Some(root) = pushed_path.components().next();"}, {"sha": "be319ee110d24e94538dabc37a08ddda763a4b4b", "filename": "clippy_lints/src/pattern_type_mismatch.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fpattern_type_mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fpattern_type_mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fpattern_type_mismatch.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -1,6 +1,6 @@\n use clippy_utils::diagnostics::span_lint_and_help;\n use rustc_hir::{\n-    intravisit, Body, Expr, ExprKind, FnDecl, HirId, LocalSource, Mutability, Pat, PatKind, Stmt, StmtKind,\n+    intravisit, Body, Expr, ExprKind, FnDecl, HirId, Let, LocalSource, Mutability, Pat, PatKind, Stmt, StmtKind,\n };\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_middle::lint::in_external_macro;\n@@ -104,8 +104,8 @@ impl<'tcx> LateLintPass<'tcx> for PatternTypeMismatch {\n                 }\n             }\n         }\n-        if let ExprKind::Let(let_pat, ..) = expr.kind {\n-            apply_lint(cx, let_pat, DerefPossible::Possible);\n+        if let ExprKind::Let(Let { pat, .. }) = expr.kind {\n+            apply_lint(cx, pat, DerefPossible::Possible);\n         }\n     }\n "}, {"sha": "b6d04334de9e50e71b538e4f81cb40b525c65036", "filename": "clippy_lints/src/regex.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fregex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fregex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fregex.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -150,7 +150,7 @@ fn check_regex<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, utf8: bool) {\n \n     if let ExprKind::Lit(ref lit) = expr.kind {\n         if let LitKind::Str(ref r, style) = lit.node {\n-            let r = &r.as_str();\n+            let r = r.as_str();\n             let offset = if let StrStyle::Raw(n) = style { 2 + n } else { 1 };\n             match parser.parse(r) {\n                 Ok(r) => {"}, {"sha": "398e2c200de3ca777db90fcf9295a8c06217f6a8", "filename": "clippy_lints/src/serde_api.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fserde_api.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fserde_api.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fserde_api.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -37,7 +37,7 @@ impl<'tcx> LateLintPass<'tcx> for SerdeApi {\n                     let mut seen_str = None;\n                     let mut seen_string = None;\n                     for item in items {\n-                        match &*item.ident.as_str() {\n+                        match item.ident.as_str() {\n                             \"visit_str\" => seen_str = Some(item.span),\n                             \"visit_string\" => seen_string = Some(item.span),\n                             _ => {},"}, {"sha": "ce05c5a6164fd76ab6e88bf137de1fcb7bc0663e", "filename": "clippy_lints/src/shadow.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fshadow.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -5,7 +5,7 @@ use rustc_data_structures::fx::FxHashMap;\n use rustc_hir::def::Res;\n use rustc_hir::def_id::LocalDefId;\n use rustc_hir::hir_id::ItemLocalId;\n-use rustc_hir::{Block, Body, BodyOwnerKind, Expr, ExprKind, HirId, Node, Pat, PatKind, QPath, UnOp};\n+use rustc_hir::{Block, Body, BodyOwnerKind, Expr, ExprKind, HirId, Let, Node, Pat, PatKind, QPath, UnOp};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n use rustc_span::{Span, Symbol};\n@@ -227,7 +227,7 @@ fn find_init<'tcx>(cx: &LateContext<'tcx>, hir_id: HirId) -> Option<&'tcx Expr<'\n         let init = match node {\n             Node::Arm(_) | Node::Pat(_) => continue,\n             Node::Expr(expr) => match expr.kind {\n-                ExprKind::Match(e, _, _) | ExprKind::Let(_, e, _) => Some(e),\n+                ExprKind::Match(e, _, _) | ExprKind::Let(&Let { init: e, .. }) => Some(e),\n                 _ => None,\n             },\n             Node::Local(local) => local.init,"}, {"sha": "20e38dc564eb4138e197cbe05c2e8975fb58fdeb", "filename": "clippy_lints/src/stable_sort_primitive.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fstable_sort_primitive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fstable_sort_primitive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fstable_sort_primitive.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -89,7 +89,7 @@ fn detect_stable_sort_primitive(cx: &LateContext<'_>, expr: &Expr<'_>) -> Option\n     if_chain! {\n         if let ExprKind::MethodCall(method_name, _, args, _) = &expr.kind;\n         if let Some(slice) = &args.get(0);\n-        if let Some(method) = SortingKind::from_stable_name(&method_name.ident.name.as_str());\n+        if let Some(method) = SortingKind::from_stable_name(method_name.ident.name.as_str());\n         if let Some(slice_type) = is_slice_of_primitives(cx, slice);\n         then {\n             let args_str = args.iter().skip(1).map(|arg| Sugg::hir(cx, arg, \"..\").to_string()).collect::<Vec<String>>().join(\", \");"}, {"sha": "ad8e72ad764e133ff3b4ce29bbda643b8d4c830b", "filename": "clippy_lints/src/strings.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fstrings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fstrings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fstrings.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -327,7 +327,7 @@ impl<'tcx> LateLintPass<'tcx> for StringLitAsBytes {\n             if let ExprKind::MethodCall(path, _, [recv], _) = &e.kind;\n             if path.ident.name == sym!(into_bytes);\n             if let ExprKind::MethodCall(path, _, [recv], _) = &recv.kind;\n-            if matches!(&*path.ident.name.as_str(), \"to_owned\" | \"to_string\");\n+            if matches!(path.ident.name.as_str(), \"to_owned\" | \"to_string\");\n             if let ExprKind::Lit(lit) = &recv.kind;\n             if let LitKind::Str(lit_content, _) = &lit.node;\n "}, {"sha": "15543b6a2627785bd303a948f911b1fb5bbe1cc1", "filename": "clippy_lints/src/tabs_in_doc_comments.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Ftabs_in_doc_comments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Ftabs_in_doc_comments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftabs_in_doc_comments.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -64,7 +64,7 @@ impl TabsInDocComments {\n         if let ast::AttrKind::DocComment(_, comment) = attr.kind {\n             let comment = comment.as_str();\n \n-            for (lo, hi) in get_chunks_of_tabs(&comment) {\n+            for (lo, hi) in get_chunks_of_tabs(comment) {\n                 // +3 skips the opening delimiter\n                 let new_span = Span::new(\n                     attr.span.lo() + BytePos(3 + lo),"}, {"sha": "6d9aff474214c30420508b7390b28d874f2e5f32", "filename": "clippy_lints/src/unit_types/unit_cmp.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funit_types%2Funit_cmp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funit_types%2Funit_cmp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funit_types%2Funit_cmp.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -12,7 +12,7 @@ pub(super) fn check(cx: &LateContext<'_>, expr: &Expr<'_>) {\n                 if let ExprKind::Binary(ref cmp, left, _) = expr.kind {\n                     let op = cmp.node;\n                     if op.is_comparison() && cx.typeck_results().expr_ty(left).is_unit() {\n-                        let result = match &*symbol.as_str() {\n+                        let result = match symbol.as_str() {\n                             \"assert_eq\" | \"debug_assert_eq\" => \"succeed\",\n                             \"assert_ne\" | \"debug_assert_ne\" => \"fail\",\n                             _ => return,"}, {"sha": "64f7a055cd9bd7f72bff009805bccdb575426cb8", "filename": "clippy_lints/src/unsafe_removed_from_name.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funsafe_removed_from_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funsafe_removed_from_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funsafe_removed_from_name.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -60,7 +60,7 @@ fn check_use_tree(use_tree: &UseTree, cx: &EarlyContext<'_>, span: Span) {\n fn unsafe_to_safe_check(old_name: Ident, new_name: Ident, cx: &EarlyContext<'_>, span: Span) {\n     let old_str = old_name.name.as_str();\n     let new_str = new_name.name.as_str();\n-    if contains_unsafe(&old_str) && !contains_unsafe(&new_str) {\n+    if contains_unsafe(old_str) && !contains_unsafe(new_str) {\n         span_lint(\n             cx,\n             UNSAFE_REMOVED_FROM_NAME,"}, {"sha": "004530db0861d28a1373e34b91a3cf82fb23dc14", "filename": "clippy_lints/src/unused_io_amount.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funused_io_amount.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funused_io_amount.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funused_io_amount.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -57,7 +57,7 @@ impl<'tcx> LateLintPass<'tcx> for UnusedIoAmount {\n                     check_map_error(cx, res, expr);\n                 }\n             },\n-            hir::ExprKind::MethodCall(path, _, [ref arg_0, ..], _) => match &*path.ident.as_str() {\n+            hir::ExprKind::MethodCall(path, _, [ref arg_0, ..], _) => match path.ident.as_str() {\n                 \"expect\" | \"unwrap\" | \"unwrap_or\" | \"unwrap_or_else\" => {\n                     check_map_error(cx, arg_0, expr);\n                 },\n@@ -71,7 +71,7 @@ impl<'tcx> LateLintPass<'tcx> for UnusedIoAmount {\n fn check_map_error(cx: &LateContext<'_>, call: &hir::Expr<'_>, expr: &hir::Expr<'_>) {\n     let mut call = call;\n     while let hir::ExprKind::MethodCall(path, _, args, _) = call.kind {\n-        if matches!(&*path.ident.as_str(), \"or\" | \"or_else\" | \"ok\") {\n+        if matches!(path.ident.as_str(), \"or\" | \"or_else\" | \"ok\") {\n             call = &args[0];\n         } else {\n             break;\n@@ -82,7 +82,7 @@ fn check_map_error(cx: &LateContext<'_>, call: &hir::Expr<'_>, expr: &hir::Expr<\n \n fn check_method_call(cx: &LateContext<'_>, call: &hir::Expr<'_>, expr: &hir::Expr<'_>) {\n     if let hir::ExprKind::MethodCall(path, _, _, _) = call.kind {\n-        let symbol = &*path.ident.as_str();\n+        let symbol = path.ident.as_str();\n         let read_trait = match_trait_method(cx, call, &paths::IO_READ);\n         let write_trait = match_trait_method(cx, call, &paths::IO_WRITE);\n "}, {"sha": "bfd17a6874994390a025d51c58922b10f99ed6b6", "filename": "clippy_lints/src/unused_unit.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funused_unit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funused_unit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funused_unit.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -94,7 +94,7 @@ impl EarlyLintPass for UnusedUnit {\n \n         if_chain! {\n             if segments.len() == 1;\n-            if [\"Fn\", \"FnMut\", \"FnOnce\"].contains(&&*segments[0].ident.name.as_str());\n+            if [\"Fn\", \"FnMut\", \"FnOnce\"].contains(&segments[0].ident.name.as_str());\n             if let Some(args) = &segments[0].args;\n             if let ast::GenericArgs::Parenthesized(generic_args) = &**args;\n             if let ast::FnRetTy::Ty(ty) = &generic_args.output;"}, {"sha": "918fa5f7dc12467bb6a19fd5601756d5ccf027eb", "filename": "clippy_lints/src/unwrap.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Funwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funwrap.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -158,10 +158,10 @@ fn collect_unwrap_info<'tcx>(\n             if let Some(local_id) = path_to_local(&args[0]);\n             let ty = cx.typeck_results().expr_ty(&args[0]);\n             let name = method_name.ident.as_str();\n-            if is_relevant_option_call(cx, ty, &name) || is_relevant_result_call(cx, ty, &name);\n+            if is_relevant_option_call(cx, ty, name) || is_relevant_result_call(cx, ty, name);\n             then {\n                 assert!(args.len() == 1);\n-                let unwrappable = match name.as_ref() {\n+                let unwrappable = match name {\n                     \"is_some\" | \"is_ok\" => true,\n                     \"is_err\" | \"is_none\" => false,\n                     _ => unreachable!(),"}, {"sha": "7286d0a7bf99b890b2bd0f90aa58e754c6e427ab", "filename": "clippy_lints/src/upper_case_acronyms.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fupper_case_acronyms.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fupper_case_acronyms.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fupper_case_acronyms.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -79,15 +79,15 @@ fn correct_ident(ident: &str) -> String {\n \n fn check_ident(cx: &LateContext<'_>, ident: &Ident, be_aggressive: bool) {\n     let span = ident.span;\n-    let ident = &ident.as_str();\n+    let ident = ident.as_str();\n     let corrected = correct_ident(ident);\n     // warn if we have pure-uppercase idents\n     // assume that two-letter words are some kind of valid abbreviation like FP for false positive\n     // (and don't warn)\n     if (ident.chars().all(|c| c.is_ascii_uppercase()) && ident.len() > 2)\n     // otherwise, warn if we have SOmeTHING lIKE THIs but only warn with the aggressive\n     // upper-case-acronyms-aggressive config option enabled\n-    || (be_aggressive && ident != &corrected)\n+    || (be_aggressive && ident != corrected)\n     {\n         span_lint_and_sugg(\n             cx,"}, {"sha": "abd8a3623703b2f14ea8232a8e9eaa0fc69d128c", "filename": "clippy_lints/src/useless_conversion.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fuseless_conversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fuseless_conversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuseless_conversion.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -64,7 +64,7 @@ impl<'tcx> LateLintPass<'tcx> for UselessConversion {\n             },\n \n             ExprKind::MethodCall(name, .., args, _) => {\n-                if is_trait_method(cx, e, sym::Into) && &*name.ident.as_str() == \"into\" {\n+                if is_trait_method(cx, e, sym::Into) && name.ident.as_str() == \"into\" {\n                     let a = cx.typeck_results().expr_ty(e);\n                     let b = cx.typeck_results().expr_ty(&args[0]);\n                     if same_type_and_consts(a, b) {"}, {"sha": "c1b811c2174405ca3c11e7bd68e90d545999b26f", "filename": "clippy_lints/src/utils/author.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Futils%2Fauthor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Futils%2Fauthor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fauthor.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -373,11 +373,18 @@ impl<'a, 'tcx> PrintVisitor<'a, 'tcx> {\n         }\n \n         match expr.value.kind {\n-            ExprKind::Let(pat, expr, _) => {\n-                bind!(self, pat, expr);\n-                kind!(\"Let({pat}, {expr}, _)\");\n-                self.pat(pat);\n-                self.expr(expr);\n+            ExprKind::Let(let_expr) => {\n+                bind!(self, let_expr);\n+                kind!(\"Let({let_expr})\");\n+                self.pat(field!(let_expr.pat));\n+                // Does what ExprKind::Cast does, only adds a clause for the type\n+                // if it's a path\n+                if let Some(TyKind::Path(ref qpath)) = let_expr.value.ty.as_ref().map(|ty| &ty.kind) {\n+                    bind!(self, qpath);\n+                    out!(\"if let TyKind::Path(ref {qpath}) = {let_expr}.ty.kind;\");\n+                    self.qpath(qpath);\n+                }\n+                self.expr(field!(let_expr.init));\n             },\n             ExprKind::Box(inner) => {\n                 bind!(self, inner);"}, {"sha": "abf4826a06917bc5991b4d2514e025ac90d30f20", "filename": "clippy_lints/src/utils/inspector.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finspector.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -142,9 +142,12 @@ fn print_expr(cx: &LateContext<'_>, expr: &hir::Expr<'_>, indent: usize) {\n                 print_expr(cx, arg, indent + 1);\n             }\n         },\n-        hir::ExprKind::Let(pat, expr, _) => {\n+        hir::ExprKind::Let(hir::Let { pat, init, ty, .. }) => {\n             print_pat(cx, pat, indent + 1);\n-            print_expr(cx, expr, indent + 1);\n+            if let Some(ty) = ty {\n+                println!(\"{}  type annotation: {:?}\", ind, ty);\n+            }\n+            print_expr(cx, init, indent + 1);\n         },\n         hir::ExprKind::MethodCall(path, _, args, _) => {\n             println!(\"{}MethodCall\", ind);"}, {"sha": "e98dcd3cf983b721905c555cb9f2c2aceef18d4d", "filename": "clippy_lints/src/utils/internal_lints.rs", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Futils%2Finternal_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Futils%2Finternal_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finternal_lints.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -28,7 +28,7 @@ use rustc_middle::ty;\n use rustc_semver::RustcVersion;\n use rustc_session::{declare_lint_pass, declare_tool_lint, impl_lint_pass};\n use rustc_span::source_map::Spanned;\n-use rustc_span::symbol::{Symbol, SymbolStr};\n+use rustc_span::symbol::Symbol;\n use rustc_span::{sym, BytePos, Span};\n use rustc_typeck::hir_ty_to_ty;\n \n@@ -344,11 +344,11 @@ impl EarlyLintPass for ClippyLintsInternal {\n             if let ItemKind::Mod(_, ModKind::Loaded(ref items, ..)) = utils.kind {\n                 if let Some(paths) = items.iter().find(|item| item.ident.name.as_str() == \"paths\") {\n                     if let ItemKind::Mod(_, ModKind::Loaded(ref items, ..)) = paths.kind {\n-                        let mut last_name: Option<SymbolStr> = None;\n+                        let mut last_name: Option<&str> = None;\n                         for item in items {\n                             let name = item.ident.as_str();\n-                            if let Some(ref last_name) = last_name {\n-                                if **last_name > *name {\n+                            if let Some(last_name) = last_name {\n+                                if *last_name > *name {\n                                     span_lint(\n                                         cx,\n                                         CLIPPY_LINTS_INTERNAL,\n@@ -608,8 +608,7 @@ impl<'tcx> LateLintPass<'tcx> for OuterExpnDataPass {\n         }\n \n         let (method_names, arg_lists, spans) = method_calls(expr, 2);\n-        let method_names: Vec<SymbolStr> = method_names.iter().map(|s| s.as_str()).collect();\n-        let method_names: Vec<&str> = method_names.iter().map(|s| &**s).collect();\n+        let method_names: Vec<&str> = method_names.iter().map(Symbol::as_str).collect();\n         if_chain! {\n             if let [\"expn_data\", \"outer_expn\"] = method_names.as_slice();\n             let args = arg_lists[1];\n@@ -839,7 +838,7 @@ impl<'tcx> LateLintPass<'tcx> for MatchTypeOnDiagItem {\n             if is_expr_path_def_path(cx, fn_path, &[\"clippy_utils\", \"ty\", \"match_type\"]);\n             // Extract the path to the matched type\n             if let Some(segments) = path_to_matched_type(cx, ty_path);\n-            let segments: Vec<&str> = segments.iter().map(|sym| &**sym).collect();\n+            let segments: Vec<&str> = segments.iter().map(Symbol::as_str).collect();\n             if let Some(ty_did) = path_to_res(cx, &segments[..]).opt_def_id();\n             // Check if the matched type is a diagnostic item\n             if let Some(item_name) = cx.tcx.get_diagnostic_name(ty_did);\n@@ -862,7 +861,7 @@ impl<'tcx> LateLintPass<'tcx> for MatchTypeOnDiagItem {\n     }\n }\n \n-fn path_to_matched_type(cx: &LateContext<'_>, expr: &hir::Expr<'_>) -> Option<Vec<SymbolStr>> {\n+fn path_to_matched_type(cx: &LateContext<'_>, expr: &hir::Expr<'_>) -> Option<Vec<Symbol>> {\n     use rustc_hir::ItemKind;\n \n     match &expr.kind {\n@@ -887,12 +886,12 @@ fn path_to_matched_type(cx: &LateContext<'_>, expr: &hir::Expr<'_>) -> Option<Ve\n             _ => {},\n         },\n         ExprKind::Array(exprs) => {\n-            let segments: Vec<SymbolStr> = exprs\n+            let segments: Vec<Symbol> = exprs\n                 .iter()\n                 .filter_map(|expr| {\n                     if let ExprKind::Lit(lit) = &expr.kind {\n                         if let LitKind::Str(sym, _) = lit.node {\n-                            return Some(sym.as_str());\n+                            return Some(sym);\n                         }\n                     }\n \n@@ -1076,7 +1075,6 @@ impl InterningDefinedSymbol {\n             &paths::SYMBOL_TO_IDENT_STRING,\n             &paths::TO_STRING_METHOD,\n         ];\n-        // SymbolStr might be de-referenced: `&*symbol.as_str()`\n         let call = if_chain! {\n             if let ExprKind::AddrOf(_, _, e) = expr.kind;\n             if let ExprKind::Unary(UnOp::Deref, e) = e.kind;"}, {"sha": "f9add927b49b86d7c3b993750b91993decb6fba8", "filename": "clippy_lints/src/write.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_lints%2Fsrc%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fwrite.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -371,9 +371,9 @@ impl EarlyLintPass for Write {\n /// Return this and a boolean indicating whether it only consisted of a newline.\n fn newline_span(fmtstr: &StrLit) -> (Span, bool) {\n     let sp = fmtstr.span;\n-    let contents = &fmtstr.symbol.as_str();\n+    let contents = fmtstr.symbol.as_str();\n \n-    if *contents == r\"\\n\" {\n+    if contents == r\"\\n\" {\n         return (sp, true);\n     }\n \n@@ -484,7 +484,7 @@ impl Write {\n             StrStyle::Raw(n) => Some(n as usize),\n         };\n \n-        let mut parser = Parser::new(&str_sym, style, snippet_opt(cx, str_lit.span), false, ParseMode::Format);\n+        let mut parser = Parser::new(str_sym, style, snippet_opt(cx, str_lit.span), false, ParseMode::Format);\n         let mut args = SimpleFormatArgs::default();\n \n         while let Some(arg) = parser.next() {\n@@ -589,7 +589,7 @@ impl Write {\n                     lit.token.symbol.as_str().replace('{', \"{{\").replace('}', \"}}\")\n                 },\n                 LitKind::StrRaw(_) | LitKind::Str | LitKind::ByteStrRaw(_) | LitKind::ByteStr => continue,\n-                LitKind::Byte | LitKind::Char => match &*lit.token.symbol.as_str() {\n+                LitKind::Byte | LitKind::Char => match lit.token.symbol.as_str() {\n                     \"\\\"\" if matches!(fmtstr.style, StrStyle::Cooked) => \"\\\\\\\"\",\n                     \"\\\"\" if matches!(fmtstr.style, StrStyle::Raw(0)) => continue,\n                     \"\\\\\\\\\" if matches!(fmtstr.style, StrStyle::Raw(_)) => \"\\\\\",\n@@ -671,7 +671,7 @@ fn check_newlines(fmtstr: &StrLit) -> bool {\n     let mut last_was_cr = false;\n     let mut should_lint = false;\n \n-    let contents = &fmtstr.symbol.as_str();\n+    let contents = fmtstr.symbol.as_str();\n \n     let mut cb = |r: Range<usize>, c: Result<char, EscapeError>| {\n         let c = c.unwrap();"}, {"sha": "25a84d16650896e090c49bfa0f68237f9a616b9d", "filename": "clippy_utils/src/attrs.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fattrs.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -113,7 +113,7 @@ pub fn get_attr<'a>(\n fn parse_attrs<F: FnMut(u64)>(sess: &Session, attrs: &[ast::Attribute], name: &'static str, mut f: F) {\n     for attr in get_attr(sess, attrs, name) {\n         if let Some(ref value) = attr.value_str() {\n-            if let Ok(value) = FromStr::from_str(&value.as_str()) {\n+            if let Ok(value) = FromStr::from_str(value.as_str()) {\n                 f(value);\n             } else {\n                 sess.span_err(attr.span, \"not a number\");"}, {"sha": "5c024612f8eba85711aa188d834b663c58a3790f", "filename": "clippy_utils/src/consts.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fconsts.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -327,8 +327,8 @@ impl<'a, 'tcx> ConstEvalLateContext<'a, 'tcx> {\n                     if let ExprKind::Path(qpath) = &callee.kind;\n                     let res = self.typeck_results.qpath_res(qpath, callee.hir_id);\n                     if let Some(def_id) = res.opt_def_id();\n-                    let def_path: Vec<_> = self.lcx.get_def_path(def_id).into_iter().map(Symbol::as_str).collect();\n-                    let def_path: Vec<&str> = def_path.iter().take(4).map(|s| &**s).collect();\n+                    let def_path = self.lcx.get_def_path(def_id);\n+                    let def_path: Vec<&str> = def_path.iter().take(4).map(Symbol::as_str).collect();\n                     if let [\"core\", \"num\", int_impl, \"max_value\"] = *def_path;\n                     then {\n                        let value = match int_impl {"}, {"sha": "61e529a6079c935b65c3345b68dffaf5fded8f9e", "filename": "clippy_utils/src/eager_or_lazy.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Feager_or_lazy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Feager_or_lazy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Feager_or_lazy.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -47,7 +47,7 @@ impl ops::BitOrAssign for EagernessSuggestion {\n /// Determine the eagerness of the given function call.\n fn fn_eagerness(cx: &LateContext<'tcx>, fn_id: DefId, name: Symbol, args: &'tcx [Expr<'_>]) -> EagernessSuggestion {\n     use EagernessSuggestion::{Eager, Lazy, NoChange};\n-    let name = &*name.as_str();\n+    let name = name.as_str();\n \n     let ty = match cx.tcx.impl_of_method(fn_id) {\n         Some(id) => cx.tcx.type_of(id),"}, {"sha": "c764c35d444fb4ec1c96512a7a5969283e054838", "filename": "clippy_utils/src/higher.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fhigher.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fhigher.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fhigher.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -101,7 +101,12 @@ impl<'hir> IfLet<'hir> {\n     pub fn hir(cx: &LateContext<'_>, expr: &Expr<'hir>) -> Option<Self> {\n         if let ExprKind::If(\n             Expr {\n-                kind: ExprKind::Let(let_pat, let_expr, _),\n+                kind:\n+                    ExprKind::Let(hir::Let {\n+                        pat: let_pat,\n+                        init: let_expr,\n+                        ..\n+                    }),\n                 ..\n             },\n             if_then,\n@@ -368,7 +373,12 @@ impl<'hir> WhileLet<'hir> {\n                         kind:\n                             ExprKind::If(\n                                 Expr {\n-                                    kind: ExprKind::Let(let_pat, let_expr, _),\n+                                    kind:\n+                                        ExprKind::Let(hir::Let {\n+                                            pat: let_pat,\n+                                            init: let_expr,\n+                                            ..\n+                                        }),\n                                     ..\n                                 },\n                                 if_then,"}, {"sha": "ad50759effaf85d2f65d2ee330986631b674abe9", "filename": "clippy_utils/src/hir_utils.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fhir_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fhir_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fhir_utils.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -7,7 +7,7 @@ use rustc_hir::def::Res;\n use rustc_hir::HirIdMap;\n use rustc_hir::{\n     BinOpKind, Block, BodyId, Expr, ExprField, ExprKind, FnRetTy, GenericArg, GenericArgs, Guard, HirId,\n-    InlineAsmOperand, Lifetime, LifetimeName, ParamName, Pat, PatField, PatKind, Path, PathSegment, QPath, Stmt,\n+    InlineAsmOperand, Let, Lifetime, LifetimeName, ParamName, Pat, PatField, PatKind, Path, PathSegment, QPath, Stmt,\n     StmtKind, Ty, TyKind, TypeBinding,\n };\n use rustc_lexer::{tokenize, TokenKind};\n@@ -234,7 +234,9 @@ impl HirEqInterExpr<'_, '_, '_> {\n             (&ExprKind::If(lc, lt, ref le), &ExprKind::If(rc, rt, ref re)) => {\n                 self.eq_expr(lc, rc) && self.eq_expr(&**lt, &**rt) && both(le, re, |l, r| self.eq_expr(l, r))\n             },\n-            (&ExprKind::Let(lp, le, _), &ExprKind::Let(rp, re, _)) => self.eq_pat(lp, rp) && self.eq_expr(le, re),\n+            (&ExprKind::Let(l), &ExprKind::Let(r)) => {\n+                self.eq_pat(l.pat, r.pat) && both(&l.ty, &r.ty, |l, r| self.eq_ty(l, r)) && self.eq_expr(l.init, r.init)\n+            },\n             (&ExprKind::Lit(ref l), &ExprKind::Lit(ref r)) => l.node == r.node,\n             (&ExprKind::Loop(lb, ref ll, ref lls, _), &ExprKind::Loop(rb, ref rl, ref rls, _)) => {\n                 lls == rls && self.eq_block(lb, rb) && both(ll, rl, |l, r| l.ident.name == r.ident.name)\n@@ -668,8 +670,11 @@ impl<'a, 'tcx> SpanlessHash<'a, 'tcx> {\n                     }\n                 }\n             },\n-            ExprKind::Let(pat, expr, _) => {\n-                self.hash_expr(expr);\n+            ExprKind::Let(Let { pat, init, ty, .. }) => {\n+                self.hash_expr(init);\n+                if let Some(ty) = ty {\n+                    self.hash_ty(ty);\n+                }\n                 self.hash_pat(pat);\n             },\n             ExprKind::LlvmInlineAsm(..) | ExprKind::Err => {},"}, {"sha": "54d470ca738201c0a783cc6599de3bf42eb4c32b", "filename": "clippy_utils/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Flib.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -887,8 +887,8 @@ pub fn capture_local_usage(cx: &LateContext<'tcx>, e: &Expr<'_>) -> CaptureKind\n                         capture_expr_ty = e;\n                     }\n                 },\n-                ExprKind::Let(pat, ..) => {\n-                    let mutability = match pat_capture_kind(cx, pat) {\n+                ExprKind::Let(let_expr) => {\n+                    let mutability = match pat_capture_kind(cx, let_expr.pat) {\n                         CaptureKind::Value => Mutability::Not,\n                         CaptureKind::Ref(m) => m,\n                     };"}, {"sha": "1a4da1627b7842eecb83d3f85f5f7f3271cad66b", "filename": "clippy_utils/src/qualify_min_const_fn.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/clippy_utils%2Fsrc%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fqualify_min_const_fn.rs?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -372,7 +372,7 @@ fn is_const_fn(tcx: TyCtxt<'_>, def_id: DefId, msrv: Option<&RustcVersion>) -> b\n                 // as a part of an unimplemented MSRV check https://github.com/rust-lang/rust/issues/65262.\n                 crate::meets_msrv(\n                     msrv,\n-                    &RustcVersion::parse(&since.as_str())\n+                    &RustcVersion::parse(since.as_str())\n                         .expect(\"`rustc_attr::StabilityLevel::Stable::since` is ill-formatted\"),\n                 )\n             } else {"}, {"sha": "471ae40f1ac7af43fb20fc1efb8f419a99c4c5f7", "filename": "rust-toolchain", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/rust-toolchain", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/rust-toolchain", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-toolchain?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -1,3 +1,3 @@\n [toolchain]\n-channel = \"nightly-2021-12-17\"\n+channel = \"nightly-2021-12-30\"\n components = [\"cargo\", \"llvm-tools-preview\", \"rust-src\", \"rust-std\", \"rustc\", \"rustc-dev\", \"rustfmt\"]"}, {"sha": "8d92849b3668f4ea410eadcf293e93bbb1db1632", "filename": "tests/ui/author/if.stdout", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/tests%2Fui%2Fauthor%2Fif.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/tests%2Fui%2Fauthor%2Fif.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauthor%2Fif.stdout?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -32,11 +32,11 @@ if_chain! {\n }\n if_chain! {\n     if let ExprKind::If(cond, then, Some(else_expr)) = expr.kind;\n-    if let ExprKind::Let(pat, expr1, _) = cond.kind;\n-    if let PatKind::Lit(lit_expr) = pat.kind;\n+    if let ExprKind::Let(let_expr) = cond.kind;\n+    if let PatKind::Lit(lit_expr) = let_expr.pat.kind;\n     if let ExprKind::Lit(ref lit) = lit_expr.kind;\n     if let LitKind::Bool(true) = lit.node;\n-    if let ExprKind::Path(ref qpath) = expr1.kind;\n+    if let ExprKind::Path(ref qpath) = let_expr.init.kind;\n     if match_qpath(qpath, &[\"a\"]);\n     if let ExprKind::Block(block, None) = then.kind;\n     if block.stmts.is_empty();"}, {"sha": "8bccbaefe23c5611d4e00ec7c9a177c303f23ffd", "filename": "tests/ui/missing_panics_doc.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/tests%2Fui%2Fmissing_panics_doc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0eff589afc83e21a03a168497bbab6b4dfbb4ef6/tests%2Fui%2Fmissing_panics_doc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing_panics_doc.stderr?ref=0eff589afc83e21a03a168497bbab6b4dfbb4ef6", "patch": "@@ -42,7 +42,7 @@ note: first possible panic found here\n    |\n LL |     todo!()\n    |     ^^^^^^^\n-   = note: this error originates in the macro `$crate::panic::panic_2015` (in Nightly builds, run with -Z macro-backtrace for more info)\n+   = note: this error originates in the macro `todo` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: docs for function which may panic missing `# Panics` section\n   --> $DIR/missing_panics_doc.rs:22:1"}]}