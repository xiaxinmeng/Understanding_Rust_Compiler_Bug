{"sha": "965997b369a3c5c46e998e522333aadb7881237b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2NTk5N2IzNjlhM2M1YzQ2ZTk5OGU1MjIzMzNhYWRiNzg4MTIzN2I=", "commit": {"author": {"name": "Tilmann Meyer", "email": "allescrafterx@gmail.com", "date": "2021-05-29T11:20:55Z"}, "committer": {"name": "Tilmann Meyer", "email": "allescrafterx@gmail.com", "date": "2021-06-01T19:37:50Z"}, "message": "Support Android ndk versions `r23-beta3` and up\n\nSince android ndk version `r23-beta3`, `libgcc` has been replaced with\n`libunwind`. This moves the linking of `libgcc`/`libunwind` into the\n`unwind` crate where we check if the system compiler can find\n`libunwind` and fall back to `libgcc` if needed.", "tree": {"sha": "70d502083744f3b7822e83d44d6f9d136a2e8522", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/70d502083744f3b7822e83d44d6f9d136a2e8522"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/965997b369a3c5c46e998e522333aadb7881237b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYIAB0WIQSmtSLjohbbZ/UZ1JOpXhmZiABLYgUCYLaMkAAKCRCpXhmZiABL\nYkGEAQCOm/7qfuc06UWCTJNSBNWp48e0096C5JMS5kK0f2ljMgD+M4+YtRFS/3An\nQQUi/isu/jXX6AVvDMKrlRVTqAWhFAs=\n=SFpo\n-----END PGP SIGNATURE-----", "payload": "tree 70d502083744f3b7822e83d44d6f9d136a2e8522\nparent 971a3f15f02752017e4d067acc01d3793dc72c40\nauthor Tilmann Meyer <allescrafterx@gmail.com> 1622287255 +0200\ncommitter Tilmann Meyer <allescrafterx@gmail.com> 1622576270 +0200\n\nSupport Android ndk versions `r23-beta3` and up\n\nSince android ndk version `r23-beta3`, `libgcc` has been replaced with\n`libunwind`. This moves the linking of `libgcc`/`libunwind` into the\n`unwind` crate where we check if the system compiler can find\n`libunwind` and fall back to `libgcc` if needed.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/965997b369a3c5c46e998e522333aadb7881237b", "html_url": "https://github.com/rust-lang/rust/commit/965997b369a3c5c46e998e522333aadb7881237b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/965997b369a3c5c46e998e522333aadb7881237b/comments", "author": {"login": "ATiltedTree", "id": 47182955, "node_id": "MDQ6VXNlcjQ3MTgyOTU1", "avatar_url": "https://avatars.githubusercontent.com/u/47182955?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ATiltedTree", "html_url": "https://github.com/ATiltedTree", "followers_url": "https://api.github.com/users/ATiltedTree/followers", "following_url": "https://api.github.com/users/ATiltedTree/following{/other_user}", "gists_url": "https://api.github.com/users/ATiltedTree/gists{/gist_id}", "starred_url": "https://api.github.com/users/ATiltedTree/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ATiltedTree/subscriptions", "organizations_url": "https://api.github.com/users/ATiltedTree/orgs", "repos_url": "https://api.github.com/users/ATiltedTree/repos", "events_url": "https://api.github.com/users/ATiltedTree/events{/privacy}", "received_events_url": "https://api.github.com/users/ATiltedTree/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ATiltedTree", "id": 47182955, "node_id": "MDQ6VXNlcjQ3MTgyOTU1", "avatar_url": "https://avatars.githubusercontent.com/u/47182955?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ATiltedTree", "html_url": "https://github.com/ATiltedTree", "followers_url": "https://api.github.com/users/ATiltedTree/followers", "following_url": "https://api.github.com/users/ATiltedTree/following{/other_user}", "gists_url": "https://api.github.com/users/ATiltedTree/gists{/gist_id}", "starred_url": "https://api.github.com/users/ATiltedTree/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ATiltedTree/subscriptions", "organizations_url": "https://api.github.com/users/ATiltedTree/orgs", "repos_url": "https://api.github.com/users/ATiltedTree/repos", "events_url": "https://api.github.com/users/ATiltedTree/events{/privacy}", "received_events_url": "https://api.github.com/users/ATiltedTree/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "971a3f15f02752017e4d067acc01d3793dc72c40", "url": "https://api.github.com/repos/rust-lang/rust/commits/971a3f15f02752017e4d067acc01d3793dc72c40", "html_url": "https://github.com/rust-lang/rust/commit/971a3f15f02752017e4d067acc01d3793dc72c40"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "ca9cc8ca7ba391259529d6c9c4c7b7ccc35ab235", "filename": "library/std/src/sys/unix/mod.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/965997b369a3c5c46e998e522333aadb7881237b/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/965997b369a3c5c46e998e522333aadb7881237b/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs?ref=965997b369a3c5c46e998e522333aadb7881237b", "patch": "@@ -210,7 +210,6 @@ cfg_if::cfg_if! {\n     if #[cfg(target_os = \"android\")] {\n         #[link(name = \"dl\")]\n         #[link(name = \"log\")]\n-        #[link(name = \"gcc\")]\n         extern \"C\" {}\n     } else if #[cfg(target_os = \"freebsd\")] {\n         #[link(name = \"execinfo\")]"}, {"sha": "0529d24a27408002b3b36c500c9b87b8cd925d62", "filename": "library/unwind/build.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/965997b369a3c5c46e998e522333aadb7881237b/library%2Funwind%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/965997b369a3c5c46e998e522333aadb7881237b/library%2Funwind%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Funwind%2Fbuild.rs?ref=965997b369a3c5c46e998e522333aadb7881237b", "patch": "@@ -20,6 +20,20 @@ fn main() {\n         // linking for Linux is handled in lib.rs\n         if target.contains(\"musl\") {\n             llvm_libunwind::compile();\n+        } else if target.contains(\"android\") {\n+            let build = cc::Build::new();\n+\n+            // Since ndk r23 beta 3 `libgcc` was replaced with `libunwind` thus\n+            // check if we have `libunwind` available and if so use it. Otherwise\n+            // fall back to `libgcc` to support older ndk versions.\n+            let has_unwind =\n+                build.is_flag_supported(\"-lunwind\").expect(\"Unable to invoke compiler\");\n+\n+            if has_unwind {\n+                println!(\"cargo:rustc-link-lib=unwind\");\n+            } else {\n+                println!(\"cargo:rustc-link-lib=gcc\");\n+            }\n         }\n     } else if target.contains(\"freebsd\") {\n         println!(\"cargo:rustc-link-lib=gcc_s\");"}]}