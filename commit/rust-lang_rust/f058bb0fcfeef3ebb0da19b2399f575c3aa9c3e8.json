{"sha": "f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8", "node_id": "C_kwDOAAsO6NoAKGYwNThiYjBmY2ZlZWYzZWJiMGRhMTliMjM5OWY1NzVjM2FhOWMzZTg", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-02-27T15:48:50Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-02-27T16:22:51Z"}, "message": "diagnostics: avoid querying `associated_item` in the resolver\n\nFixes #108529", "tree": {"sha": "27aac62b2cab6d91b454ab44e41ec207d25685db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/27aac62b2cab6d91b454ab44e41ec207d25685db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8", "html_url": "https://github.com/rust-lang/rust/commit/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "49b9cc5139dd4d11ef78dc08c1f9170de5b1ca39", "url": "https://api.github.com/repos/rust-lang/rust/commits/49b9cc5139dd4d11ef78dc08c1f9170de5b1ca39", "html_url": "https://github.com/rust-lang/rust/commit/49b9cc5139dd4d11ef78dc08c1f9170de5b1ca39"}], "stats": {"total": 25, "additions": 23, "deletions": 2}, "files": [{"sha": "7add59ac627fd719b0c033539104baaa3c1596b6", "filename": "compiler/rustc_resolve/src/diagnostics.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs?ref=f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8", "patch": "@@ -189,7 +189,9 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n         }\n \n         let container = match parent.kind {\n-            ModuleKind::Def(kind, _, _) => self.tcx.def_kind_descr(kind, parent.def_id()),\n+            // Avoid using TyCtxt::def_kind_descr in the resolver, because it\n+            // indirectly *calls* the resolver, and would cause a query cycle.\n+            ModuleKind::Def(kind, _, _) => kind.descr(parent.def_id()),\n             ModuleKind::Block => \"block\",\n         };\n \n@@ -1804,7 +1806,9 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                         found(\"module\")\n                     } else {\n                         match binding.res() {\n-                            Res::Def(kind, id) => found(self.tcx.def_kind_descr(kind, id)),\n+                            // Avoid using TyCtxt::def_kind_descr in the resolver, because it\n+                            // indirectly *calls* the resolver, and would cause a query cycle.\n+                            Res::Def(kind, id) => found(kind.descr(id)),\n                             _ => found(ns_to_try.descr()),\n                         }\n                     }"}, {"sha": "8e3aafab6aa792ac5238b08fff987096bc541a3d", "filename": "tests/ui/resolve/issue-108529.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8/tests%2Fui%2Fresolve%2Fissue-108529.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8/tests%2Fui%2Fresolve%2Fissue-108529.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fissue-108529.rs?ref=f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8", "patch": "@@ -0,0 +1,8 @@\n+#![allow(nonstandard_style)]\n+use f::f::f; //~ ERROR\n+\n+trait f {\n+    extern \"C\" fn f();\n+}\n+\n+fn main() {}"}, {"sha": "cf4e4759c3702ba58ae8594e73100ed37aef6ad0", "filename": "tests/ui/resolve/issue-108529.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8/tests%2Fui%2Fresolve%2Fissue-108529.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8/tests%2Fui%2Fresolve%2Fissue-108529.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fissue-108529.stderr?ref=f058bb0fcfeef3ebb0da19b2399f575c3aa9c3e8", "patch": "@@ -0,0 +1,9 @@\n+error[E0432]: unresolved import `f::f`\n+  --> $DIR/issue-108529.rs:2:8\n+   |\n+LL | use f::f::f;\n+   |        ^ expected type, found associated function `f` in `f`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0432`."}]}