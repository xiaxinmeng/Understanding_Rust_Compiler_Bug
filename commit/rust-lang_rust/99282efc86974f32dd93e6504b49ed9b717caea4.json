{"sha": "99282efc86974f32dd93e6504b49ed9b717caea4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5MjgyZWZjODY5NzRmMzJkZDkzZTY1MDRiNDllZDliNzE3Y2FlYTQ=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-11-05T10:05:02Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-11-05T10:05:02Z"}, "message": "add an interesting run-pass stacked borrows example", "tree": {"sha": "33046d950e73b170e04c5a1f6bfac4d2124a4701", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33046d950e73b170e04c5a1f6bfac4d2124a4701"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/99282efc86974f32dd93e6504b49ed9b717caea4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/99282efc86974f32dd93e6504b49ed9b717caea4", "html_url": "https://github.com/rust-lang/rust/commit/99282efc86974f32dd93e6504b49ed9b717caea4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/99282efc86974f32dd93e6504b49ed9b717caea4/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "727e77844e65de97afa83dfd1a1d22439d8fe285", "url": "https://api.github.com/repos/rust-lang/rust/commits/727e77844e65de97afa83dfd1a1d22439d8fe285", "html_url": "https://github.com/rust-lang/rust/commit/727e77844e65de97afa83dfd1a1d22439d8fe285"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "fe6a9a54d4f34ad0afeed535e887e50cda3b708e", "filename": "tests/run-pass/stacked-borrows/stacked-borrows.rs", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/99282efc86974f32dd93e6504b49ed9b717caea4/tests%2Frun-pass%2Fstacked-borrows%2Fstacked-borrows.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99282efc86974f32dd93e6504b49ed9b717caea4/tests%2Frun-pass%2Fstacked-borrows%2Fstacked-borrows.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fstacked-borrows%2Fstacked-borrows.rs?ref=99282efc86974f32dd93e6504b49ed9b717caea4", "patch": "@@ -11,6 +11,7 @@ fn main() {\n     direct_mut_to_const_raw();\n     two_raw();\n     shr_and_raw();\n+    disjoint_mutable_subborrows();\n }\n \n // Make sure that reading from an `&mut` does, like reborrowing to `&`,\n@@ -138,3 +139,31 @@ fn shr_and_raw() { /* unsafe {\n     *y2 += 1;\n     // TODO: Once this works, add compile-fail test that tries to read from y1 again.\n } */ }\n+\n+fn disjoint_mutable_subborrows() {\n+    struct Foo {\n+        a: String,\n+        b: Vec<u32>,\n+    }\n+\n+    unsafe fn borrow_field_a<'a>(this:*mut Foo) -> &'a mut String {\n+        &mut (*this).a\n+    }\n+\n+    unsafe fn borrow_field_b<'a>(this:*mut Foo) -> &'a mut Vec<u32> {\n+        &mut (*this).b\n+    }\n+\n+    let mut foo = Foo {\n+        a: \"hello\".into(),\n+        b: vec![0,1,2],\n+    };\n+\n+    let ptr = &mut foo as *mut Foo;\n+\n+    let a = unsafe{ borrow_field_a(ptr) };\n+    let b = unsafe{ borrow_field_b(ptr) };\n+    b.push(4);\n+    a.push_str(\" world\");\n+    dbg!(a,b);\n+}"}, {"sha": "4493d45ae157a17c81eb7b14cb82a97d3443f3e6", "filename": "tests/run-pass/stacked-borrows/stacked-borrows.stderr", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/99282efc86974f32dd93e6504b49ed9b717caea4/tests%2Frun-pass%2Fstacked-borrows%2Fstacked-borrows.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/99282efc86974f32dd93e6504b49ed9b717caea4/tests%2Frun-pass%2Fstacked-borrows%2Fstacked-borrows.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fstacked-borrows%2Fstacked-borrows.stderr?ref=99282efc86974f32dd93e6504b49ed9b717caea4", "patch": "@@ -0,0 +1,7 @@\n+[$DIR/stacked-borrows.rs:168] a = \"hello world\"\n+[$DIR/stacked-borrows.rs:168] b = [\n+    0,\n+    1,\n+    2,\n+    4,\n+]"}]}