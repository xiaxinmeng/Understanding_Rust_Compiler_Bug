{"sha": "81d57de79106171026159399aa821830412fe8e8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxZDU3ZGU3OTEwNjE3MTAyNjE1OTM5OWFhODIxODMwNDEyZmU4ZTg=", "commit": {"author": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2021-09-09T15:38:03Z"}, "committer": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2021-09-13T04:29:24Z"}, "message": "Update `needless_borrow` test output and expected fix", "tree": {"sha": "3584e923f1ad68152d67f3c1b99c0a8357fba455", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3584e923f1ad68152d67f3c1b99c0a8357fba455"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/81d57de79106171026159399aa821830412fe8e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/81d57de79106171026159399aa821830412fe8e8", "html_url": "https://github.com/rust-lang/rust/commit/81d57de79106171026159399aa821830412fe8e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/81d57de79106171026159399aa821830412fe8e8/comments", "author": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46c3076784b94b4f56771ee02850d01480d9aca2", "url": "https://api.github.com/repos/rust-lang/rust/commits/46c3076784b94b4f56771ee02850d01480d9aca2", "html_url": "https://github.com/rust-lang/rust/commit/46c3076784b94b4f56771ee02850d01480d9aca2"}], "stats": {"total": 38, "additions": 26, "deletions": 12}, "files": [{"sha": "42c2bb9f4149eb48bbf2f777e859adcc88623ee0", "filename": "tests/ui/needless_borrow.fixed", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/81d57de79106171026159399aa821830412fe8e8/tests%2Fui%2Fneedless_borrow.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/81d57de79106171026159399aa821830412fe8e8/tests%2Fui%2Fneedless_borrow.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_borrow.fixed?ref=81d57de79106171026159399aa821830412fe8e8", "patch": "@@ -1,17 +1,16 @@\n // run-rustfix\n \n-#![allow(clippy::needless_borrowed_reference)]\n-\n-fn x(y: &i32) -> i32 {\n-    *y\n-}\n-\n #[warn(clippy::all, clippy::needless_borrow)]\n #[allow(unused_variables)]\n fn main() {\n     let a = 5;\n-    let b = x(&a);\n-    let c = x(&a);\n+    let _ = x(&a); // no warning\n+    let _ = x(&a); // warn\n+\n+    let mut b = 5;\n+    mut_ref(&mut b); // no warning\n+    mut_ref(&mut b); // warn\n+\n     let s = &String::from(\"hi\");\n     let s_ident = f(&s); // should not error, because `&String` implements Copy, but `String` does not\n     let g_val = g(&Vec::new()); // should not error, because `&Vec<T>` derefs to `&[T]`\n@@ -29,6 +28,15 @@ fn main() {\n     };\n }\n \n+#[allow(clippy::needless_borrowed_reference)]\n+fn x(y: &i32) -> i32 {\n+    *y\n+}\n+\n+fn mut_ref(y: &mut i32) {\n+    *y = 5;\n+}\n+\n fn f<T: Copy>(y: &T) -> T {\n     *y\n }"}, {"sha": "012d62e287156f850f02871bba101d930a9bbdb7", "filename": "tests/ui/needless_borrow.stderr", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/81d57de79106171026159399aa821830412fe8e8/tests%2Fui%2Fneedless_borrow.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/81d57de79106171026159399aa821830412fe8e8/tests%2Fui%2Fneedless_borrow.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_borrow.stderr?ref=81d57de79106171026159399aa821830412fe8e8", "patch": "@@ -1,16 +1,22 @@\n error: this expression borrows a reference (`&i32`) that is immediately dereferenced by the compiler\n-  --> $DIR/needless_borrow.rs:14:15\n+  --> $DIR/needless_borrow.rs:8:15\n    |\n-LL |     let c = x(&&a);\n+LL |     let _ = x(&&a); // warn\n    |               ^^^ help: change this to: `&a`\n    |\n    = note: `-D clippy::needless-borrow` implied by `-D warnings`\n \n+error: this expression borrows a reference (`&mut i32`) that is immediately dereferenced by the compiler\n+  --> $DIR/needless_borrow.rs:12:13\n+   |\n+LL |     mut_ref(&mut &mut b); // warn\n+   |             ^^^^^^^^^^^ help: change this to: `&mut b`\n+\n error: this expression borrows a reference (`&i32`) that is immediately dereferenced by the compiler\n-  --> $DIR/needless_borrow.rs:27:15\n+  --> $DIR/needless_borrow.rs:26:15\n    |\n LL |         46 => &&a,\n    |               ^^^ help: change this to: `&a`\n \n-error: aborting due to 2 previous errors\n+error: aborting due to 3 previous errors\n "}]}