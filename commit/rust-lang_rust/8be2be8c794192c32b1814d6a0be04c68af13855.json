{"sha": "8be2be8c794192c32b1814d6a0be04c68af13855", "node_id": "C_kwDOAAsO6NoAKDhiZTJiZThjNzk0MTkyYzMyYjE4MTRkNmEwYmUwNGM2OGFmMTM4NTU", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-01-17T17:12:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-17T17:12:14Z"}, "message": "Merge #11308\n\n11308: fix: status: output all crates a file belongs to r=jonas-schievink a=jonas-schievink\n\nWhile investigating https://github.com/rust-analyzer/rust-analyzer/issues/11300 I noticed that we only output the first crate, which masks the reason for that issue \u2013 the file in question is the root of multiple crates, and one is missing dependencies.\r\n\r\nThis PR makes \"Rust Analyzer: Status\" include *every* crate a file is part of.\r\n\r\nbors r+\n\nCo-authored-by: Jonas Schievink <jonas.schievink@ferrous-systems.com>", "tree": {"sha": "cd852f42261fd61d6a7ea83cc04f35c2bbe027c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd852f42261fd61d6a7ea83cc04f35c2bbe027c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8be2be8c794192c32b1814d6a0be04c68af13855", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh5aNuCRBK7hj4Ov3rIwAAftwIAJb6gIkiDl06seXaW7mW6kma\nrLp3D26TciQSHKyQffgThNETWlgWBkV0bYSpqti2kfMDs+RAqePWPGGNcs8hZ3nE\nMA4WWv+YKeGPbBZkGkJugCNdzJnMyeJAW+PfKvawHwpPx6rruoeqf3zjCISKynis\n5celeZAiQrpCZBwMe2pJPeeekERuP/BrjIfrdwYLBcdiySn/cKIrWi5TeL/PHGpn\nVCXPT4nVrSC6rMAVx4Oah8wa38WEwRPGWH11LTWNusKyEzjii9jqvnDKyamjkrCZ\nSLtaHELpnjwkehxV/LNiUecA1Iwy09sX2zFAirQih0lOYDtXa32LsZ4CSiWlMBA=\n=jun0\n-----END PGP SIGNATURE-----\n", "payload": "tree cd852f42261fd61d6a7ea83cc04f35c2bbe027c4\nparent 1861654623f99e879ebace09e286dc96cb980776\nparent a3d06f824b4c2360a675b8a206cc43e200276609\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1642439534 +0000\ncommitter GitHub <noreply@github.com> 1642439534 +0000\n\nMerge #11308\n\n11308: fix: status: output all crates a file belongs to r=jonas-schievink a=jonas-schievink\n\nWhile investigating https://github.com/rust-analyzer/rust-analyzer/issues/11300 I noticed that we only output the first crate, which masks the reason for that issue \u2013 the file in question is the root of multiple crates, and one is missing dependencies.\r\n\r\nThis PR makes \"Rust Analyzer: Status\" include *every* crate a file is part of.\r\n\r\nbors r+\n\nCo-authored-by: Jonas Schievink <jonas.schievink@ferrous-systems.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8be2be8c794192c32b1814d6a0be04c68af13855", "html_url": "https://github.com/rust-lang/rust/commit/8be2be8c794192c32b1814d6a0be04c68af13855", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8be2be8c794192c32b1814d6a0be04c68af13855/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1861654623f99e879ebace09e286dc96cb980776", "url": "https://api.github.com/repos/rust-lang/rust/commits/1861654623f99e879ebace09e286dc96cb980776", "html_url": "https://github.com/rust-lang/rust/commit/1861654623f99e879ebace09e286dc96cb980776"}, {"sha": "a3d06f824b4c2360a675b8a206cc43e200276609", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3d06f824b4c2360a675b8a206cc43e200276609", "html_url": "https://github.com/rust-lang/rust/commit/a3d06f824b4c2360a675b8a206cc43e200276609"}], "stats": {"total": 34, "additions": 17, "deletions": 17}, "files": [{"sha": "ea2b7906e9eaa3fe22c8937ab0d063e0c6292f41", "filename": "crates/ide/src/status.rs", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/8be2be8c794192c32b1814d6a0be04c68af13855/crates%2Fide%2Fsrc%2Fstatus.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8be2be8c794192c32b1814d6a0be04c68af13855/crates%2Fide%2Fsrc%2Fstatus.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fstatus.rs?ref=8be2be8c794192c32b1814d6a0be04c68af13855", "patch": "@@ -45,23 +45,23 @@ pub(crate) fn status(db: &RootDatabase, file_id: Option<FileId>) -> String {\n \n     if let Some(file_id) = file_id {\n         format_to!(buf, \"\\nFile info:\\n\");\n-        let krate = crate::parent_module::crate_for(db, file_id).pop();\n-        match krate {\n-            Some(krate) => {\n-                let crate_graph = db.crate_graph();\n-                let display_crate = |krate: CrateId| match &crate_graph[krate].display_name {\n-                    Some(it) => format!(\"{}({:?})\", it, krate),\n-                    None => format!(\"{:?}\", krate),\n-                };\n-                format_to!(buf, \"Crate: {}\\n\", display_crate(krate));\n-                let deps = crate_graph[krate]\n-                    .dependencies\n-                    .iter()\n-                    .map(|dep| format!(\"{}={:?}\", dep.name, dep.crate_id))\n-                    .format(\", \");\n-                format_to!(buf, \"Dependencies: {}\\n\", deps);\n-            }\n-            None => format_to!(buf, \"Does not belong to any crate\"),\n+        let crates = crate::parent_module::crate_for(db, file_id);\n+        if crates.is_empty() {\n+            format_to!(buf, \"Does not belong to any crate\");\n+        }\n+        let crate_graph = db.crate_graph();\n+        for krate in crates {\n+            let display_crate = |krate: CrateId| match &crate_graph[krate].display_name {\n+                Some(it) => format!(\"{}({:?})\", it, krate),\n+                None => format!(\"{:?}\", krate),\n+            };\n+            format_to!(buf, \"Crate: {}\\n\", display_crate(krate));\n+            let deps = crate_graph[krate]\n+                .dependencies\n+                .iter()\n+                .map(|dep| format!(\"{}={:?}\", dep.name, dep.crate_id))\n+                .format(\", \");\n+            format_to!(buf, \"Dependencies: {}\\n\", deps);\n         }\n     }\n "}]}