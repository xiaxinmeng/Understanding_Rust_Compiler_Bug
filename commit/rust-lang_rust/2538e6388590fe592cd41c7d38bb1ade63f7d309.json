{"sha": "2538e6388590fe592cd41c7d38bb1ade63f7d309", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1MzhlNjM4ODU5MGZlNTkyY2Q0MWM3ZDM4YmIxYWRlNjNmN2QzMDk=", "commit": {"author": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2020-04-15T18:12:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-15T18:12:29Z"}, "message": "Rollup merge of #5430 - michaelsproul:integer-arithmetic, r=flip1995\n\nDisallow bit-shifting in integer_arithmetic\n\nMake the `integer_arithmetic` lint detect all the operations that are defined as being capable of overflow in the [Rust Reference](https://doc.rust-lang.org/reference/expressions/operator-expr.html#overflow), by also linting for bit-shifting operations (`<<`, `>>`).\n\nchangelog: Disallow bit-shifting in `integer_arithmetic`", "tree": {"sha": "bb6b04904ce7f089d67d575b79d209c4abd62b2d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bb6b04904ce7f089d67d575b79d209c4abd62b2d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2538e6388590fe592cd41c7d38bb1ade63f7d309", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJel06NCRBK7hj4Ov3rIwAAdHIIAKgaU1vd3toIM/UHRK1w9Sza\nP0Hr+pfZGvdvtSI/ucfh3hlx7LloIOkX/umE351L2qZIhkvHjSHN10/r31KJHZQE\nJzY2L0C3T7gSitKQc9Oztw0XgW7ayOsqeCALG6WUeX8xFu1XRHEQ7VoH+K+9Fwhd\nXmoCkqKzEMieYcF/FrPiOfLJWt+XEKt+FAigXAlZ+EU+x90dRKuNaZgTL+ivO4YI\nB1S21t1V0YS9QivDj9I14gsqBiolBn1Uem+YJ/6swOyMfeDQFny0Z35MvAKuA0+p\nzN/y3BuZH0juC7ykOgPbl492KOzUquhvJyZDtMqFxu649ZY8hXEZ+6VsBHzqcMU=\n=eVO6\n-----END PGP SIGNATURE-----\n", "payload": "tree bb6b04904ce7f089d67d575b79d209c4abd62b2d\nparent ceea3c6a35bfada9536bac674fc6308831f1938c\nparent 23df4a0183e0d954d47db98824295411d50f742e\nauthor Philipp Krones <hello@philkrones.com> 1586974349 +0200\ncommitter GitHub <noreply@github.com> 1586974349 +0200\n\nRollup merge of #5430 - michaelsproul:integer-arithmetic, r=flip1995\n\nDisallow bit-shifting in integer_arithmetic\n\nMake the `integer_arithmetic` lint detect all the operations that are defined as being capable of overflow in the [Rust Reference](https://doc.rust-lang.org/reference/expressions/operator-expr.html#overflow), by also linting for bit-shifting operations (`<<`, `>>`).\n\nchangelog: Disallow bit-shifting in `integer_arithmetic`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2538e6388590fe592cd41c7d38bb1ade63f7d309", "html_url": "https://github.com/rust-lang/rust/commit/2538e6388590fe592cd41c7d38bb1ade63f7d309", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2538e6388590fe592cd41c7d38bb1ade63f7d309/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ceea3c6a35bfada9536bac674fc6308831f1938c", "url": "https://api.github.com/repos/rust-lang/rust/commits/ceea3c6a35bfada9536bac674fc6308831f1938c", "html_url": "https://github.com/rust-lang/rust/commit/ceea3c6a35bfada9536bac674fc6308831f1938c"}, {"sha": "23df4a0183e0d954d47db98824295411d50f742e", "url": "https://api.github.com/repos/rust-lang/rust/commits/23df4a0183e0d954d47db98824295411d50f742e", "html_url": "https://github.com/rust-lang/rust/commit/23df4a0183e0d954d47db98824295411d50f742e"}], "stats": {"total": 70, "additions": 48, "deletions": 22}, "files": [{"sha": "6cbe10a5352d1d1cf3b91caccfd3c59f8408c2da", "filename": "clippy_lints/src/arithmetic.rs", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/2538e6388590fe592cd41c7d38bb1ade63f7d309/clippy_lints%2Fsrc%2Farithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2538e6388590fe592cd41c7d38bb1ade63f7d309/clippy_lints%2Fsrc%2Farithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Farithmetic.rs?ref=2538e6388590fe592cd41c7d38bb1ade63f7d309", "patch": "@@ -6,11 +6,17 @@ use rustc_session::{declare_tool_lint, impl_lint_pass};\n use rustc_span::source_map::Span;\n \n declare_clippy_lint! {\n-    /// **What it does:** Checks for plain integer arithmetic.\n+    /// **What it does:** Checks for integer arithmetic operations which could overflow or panic.\n     ///\n-    /// **Why is this bad?** This is only checked against overflow in debug builds.\n-    /// In some applications one wants explicitly checked, wrapping or saturating\n-    /// arithmetic.\n+    /// Specifically, checks for any operators (`+`, `-`, `*`, `<<`, etc) which are capable\n+    /// of overflowing according to the [Rust\n+    /// Reference](https://doc.rust-lang.org/reference/expressions/operator-expr.html#overflow),\n+    /// or which can panic (`/`, `%`). No bounds analysis or sophisticated reasoning is\n+    /// attempted.\n+    ///\n+    /// **Why is this bad?** Integer overflow will trigger a panic in debug builds or will wrap in\n+    /// release mode. Division by zero will cause a panic in either mode. In some applications one\n+    /// wants explicitly checked, wrapping or saturating arithmetic.\n     ///\n     /// **Known problems:** None.\n     ///\n@@ -21,7 +27,7 @@ declare_clippy_lint! {\n     /// ```\n     pub INTEGER_ARITHMETIC,\n     restriction,\n-    \"any integer arithmetic statement\"\n+    \"any integer arithmetic expression which could overflow or panic\"\n }\n \n declare_clippy_lint! {\n@@ -71,8 +77,6 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Arithmetic {\n                     | hir::BinOpKind::BitAnd\n                     | hir::BinOpKind::BitOr\n                     | hir::BinOpKind::BitXor\n-                    | hir::BinOpKind::Shl\n-                    | hir::BinOpKind::Shr\n                     | hir::BinOpKind::Eq\n                     | hir::BinOpKind::Lt\n                     | hir::BinOpKind::Le"}, {"sha": "d4602a3ad8e6a82d71fa4a9e273511c1dcbbe82f", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2538e6388590fe592cd41c7d38bb1ade63f7d309/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2538e6388590fe592cd41c7d38bb1ade63f7d309/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=2538e6388590fe592cd41c7d38bb1ade63f7d309", "patch": "@@ -853,7 +853,7 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n     Lint {\n         name: \"integer_arithmetic\",\n         group: \"restriction\",\n-        desc: \"any integer arithmetic statement\",\n+        desc: \"any integer arithmetic expression which could overflow or panic\",\n         deprecation: None,\n         module: \"arithmetic\",\n     },"}, {"sha": "7b1b64f390a5aa25a5f4039761dab8b8dc832e54", "filename": "tests/ui/integer_arithmetic.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2538e6388590fe592cd41c7d38bb1ade63f7d309/tests%2Fui%2Finteger_arithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2538e6388590fe592cd41c7d38bb1ade63f7d309/tests%2Fui%2Finteger_arithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finteger_arithmetic.rs?ref=2538e6388590fe592cd41c7d38bb1ade63f7d309", "patch": "@@ -17,6 +17,8 @@ fn main() {\n     i / 2; // no error, this is part of the expression in the preceding line\n     i - 2 + 2 - i;\n     -i;\n+    i >> 1;\n+    i << 1;\n \n     // no error, overflows are checked by `overflowing_literals`\n     -1;\n@@ -25,18 +27,16 @@ fn main() {\n     i & 1; // no wrapping\n     i | 1;\n     i ^ 1;\n-    i >> 1;\n-    i << 1;\n \n     i += 1;\n     i -= 1;\n     i *= 2;\n     i /= 2;\n     i %= 2;\n-\n-    // no errors\n     i <<= 3;\n     i >>= 2;\n+\n+    // no errors\n     i |= 1;\n     i &= 1;\n     i ^= i;\n@@ -72,8 +72,6 @@ fn main() {\n             1 + 1\n         };\n     }\n-\n-\n }\n \n // warn on references as well! (#5328)"}, {"sha": "83e8a9cde3ff11873f6cbb715af32565f9461ed5", "filename": "tests/ui/integer_arithmetic.stderr", "status": "modified", "additions": 32, "deletions": 8, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/2538e6388590fe592cd41c7d38bb1ade63f7d309/tests%2Fui%2Finteger_arithmetic.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2538e6388590fe592cd41c7d38bb1ade63f7d309/tests%2Fui%2Finteger_arithmetic.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finteger_arithmetic.stderr?ref=2538e6388590fe592cd41c7d38bb1ade63f7d309", "patch": "@@ -31,6 +31,18 @@ error: integer arithmetic detected\n LL |     -i;\n    |     ^^\n \n+error: integer arithmetic detected\n+  --> $DIR/integer_arithmetic.rs:20:5\n+   |\n+LL |     i >> 1;\n+   |     ^^^^^^\n+\n+error: integer arithmetic detected\n+  --> $DIR/integer_arithmetic.rs:21:5\n+   |\n+LL |     i << 1;\n+   |     ^^^^^^\n+\n error: integer arithmetic detected\n   --> $DIR/integer_arithmetic.rs:31:5\n    |\n@@ -62,46 +74,58 @@ LL |     i %= 2;\n    |     ^^^^^^\n \n error: integer arithmetic detected\n-  --> $DIR/integer_arithmetic.rs:81:5\n+  --> $DIR/integer_arithmetic.rs:36:5\n+   |\n+LL |     i <<= 3;\n+   |     ^^^^^^^\n+\n+error: integer arithmetic detected\n+  --> $DIR/integer_arithmetic.rs:37:5\n+   |\n+LL |     i >>= 2;\n+   |     ^^^^^^^\n+\n+error: integer arithmetic detected\n+  --> $DIR/integer_arithmetic.rs:79:5\n    |\n LL |     3 + &1;\n    |     ^^^^^^\n \n error: integer arithmetic detected\n-  --> $DIR/integer_arithmetic.rs:82:5\n+  --> $DIR/integer_arithmetic.rs:80:5\n    |\n LL |     &3 + 1;\n    |     ^^^^^^\n \n error: integer arithmetic detected\n-  --> $DIR/integer_arithmetic.rs:83:5\n+  --> $DIR/integer_arithmetic.rs:81:5\n    |\n LL |     &3 + &1;\n    |     ^^^^^^^\n \n error: integer arithmetic detected\n-  --> $DIR/integer_arithmetic.rs:88:5\n+  --> $DIR/integer_arithmetic.rs:86:5\n    |\n LL |     a + x\n    |     ^^^^^\n \n error: integer arithmetic detected\n-  --> $DIR/integer_arithmetic.rs:92:5\n+  --> $DIR/integer_arithmetic.rs:90:5\n    |\n LL |     x + y\n    |     ^^^^^\n \n error: integer arithmetic detected\n-  --> $DIR/integer_arithmetic.rs:96:5\n+  --> $DIR/integer_arithmetic.rs:94:5\n    |\n LL |     x + y\n    |     ^^^^^\n \n error: integer arithmetic detected\n-  --> $DIR/integer_arithmetic.rs:100:5\n+  --> $DIR/integer_arithmetic.rs:98:5\n    |\n LL |     (&x + &y)\n    |     ^^^^^^^^^\n \n-error: aborting due to 17 previous errors\n+error: aborting due to 21 previous errors\n "}]}