{"sha": "ee0376c368c50c7dadc84801e88cfdbf250b92a4", "node_id": "C_kwDOAAsO6NoAKGVlMDM3NmMzNjhjNTBjN2RhZGM4NDgwMWU4OGNmZGJmMjUwYjkyYTQ", "commit": {"author": {"name": "Lukas Bergdoll", "email": "lukas.bergdoll@gmail.com", "date": "2023-02-11T08:32:52Z"}, "committer": {"name": "Lukas Bergdoll", "email": "lukas.bergdoll@gmail.com", "date": "2023-02-11T08:32:52Z"}, "message": "Split branches in heapsort child selection\n\nThis allows even better code-gen, cmp + adc. While also more clearly\ncommunicating the intent.", "tree": {"sha": "1c5617ae49bd38e79acea9ee9198e27f8f76a79a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c5617ae49bd38e79acea9ee9198e27f8f76a79a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee0376c368c50c7dadc84801e88cfdbf250b92a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee0376c368c50c7dadc84801e88cfdbf250b92a4", "html_url": "https://github.com/rust-lang/rust/commit/ee0376c368c50c7dadc84801e88cfdbf250b92a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee0376c368c50c7dadc84801e88cfdbf250b92a4/comments", "author": {"login": "Voultapher", "id": 6864584, "node_id": "MDQ6VXNlcjY4NjQ1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6864584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Voultapher", "html_url": "https://github.com/Voultapher", "followers_url": "https://api.github.com/users/Voultapher/followers", "following_url": "https://api.github.com/users/Voultapher/following{/other_user}", "gists_url": "https://api.github.com/users/Voultapher/gists{/gist_id}", "starred_url": "https://api.github.com/users/Voultapher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Voultapher/subscriptions", "organizations_url": "https://api.github.com/users/Voultapher/orgs", "repos_url": "https://api.github.com/users/Voultapher/repos", "events_url": "https://api.github.com/users/Voultapher/events{/privacy}", "received_events_url": "https://api.github.com/users/Voultapher/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Voultapher", "id": 6864584, "node_id": "MDQ6VXNlcjY4NjQ1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6864584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Voultapher", "html_url": "https://github.com/Voultapher", "followers_url": "https://api.github.com/users/Voultapher/followers", "following_url": "https://api.github.com/users/Voultapher/following{/other_user}", "gists_url": "https://api.github.com/users/Voultapher/gists{/gist_id}", "starred_url": "https://api.github.com/users/Voultapher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Voultapher/subscriptions", "organizations_url": "https://api.github.com/users/Voultapher/orgs", "repos_url": "https://api.github.com/users/Voultapher/repos", "events_url": "https://api.github.com/users/Voultapher/events{/privacy}", "received_events_url": "https://api.github.com/users/Voultapher/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e072199a6e650698c2f5f1e1053b20d48be43d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e072199a6e650698c2f5f1e1053b20d48be43d3", "html_url": "https://github.com/rust-lang/rust/commit/7e072199a6e650698c2f5f1e1053b20d48be43d3"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "8f02a44667085327366a0a9c2a3e6f3b40e353a7", "filename": "library/core/src/slice/sort.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ee0376c368c50c7dadc84801e88cfdbf250b92a4/library%2Fcore%2Fsrc%2Fslice%2Fsort.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee0376c368c50c7dadc84801e88cfdbf250b92a4/library%2Fcore%2Fsrc%2Fslice%2Fsort.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fslice%2Fsort.rs?ref=ee0376c368c50c7dadc84801e88cfdbf250b92a4", "patch": "@@ -198,7 +198,12 @@ where\n             }\n \n             // Choose the greater child.\n-            child += (child + 1 < v.len() && is_less(&v[child], &v[child + 1])) as usize;\n+            if child + 1 < v.len() {\n+                // We need a branch to be sure not to out-of-bounds index,\n+                // but it's highly predictable.  The comparison, however,\n+                // is better done branchless, especially for primitives.\n+                child += is_less(&v[child], &v[child + 1]) as usize;\n+            }\n \n             // Stop if the invariant holds at `node`.\n             if !is_less(&v[node], &v[child]) {"}]}