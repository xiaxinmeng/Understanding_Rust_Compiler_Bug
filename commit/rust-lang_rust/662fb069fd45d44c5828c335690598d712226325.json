{"sha": "662fb069fd45d44c5828c335690598d712226325", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2MmZiMDY5ZmQ0NWQ0NGM1ODI4YzMzNTY5MDU5OGQ3MTIyMjYzMjU=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2018-07-26T15:18:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-07-26T15:18:29Z"}, "message": "Rollup merge of #52647 - csmoe:closure_arg_ignore, r=estebank\n\nSuggest to take and ignore args while closure args count mismatching\n\nCloses #52473", "tree": {"sha": "5b85554af6125f8385852761a4bc13afe2887503", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5b85554af6125f8385852761a4bc13afe2887503"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/662fb069fd45d44c5828c335690598d712226325", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbWeZFCRBK7hj4Ov3rIwAAdHIIAB8bT9yzFe3GLGTYVz9M1ZD7\nPisndFkTGqrqPgDgSK7iT102UeUzahrf8T8KXmFgKjPtyddpyK6Oc6MbgHptrTsq\nUHK+/fkT6i4D5ErhoCTUP2yr1iD5xsR9p/b1S5vgh6Go3Wn7XJ4lgujQGrbVyXU5\nmDJBKjolZi+4tlZzjyodcMTp3glh3H/OfU1bpkgj+k+5VgsJ6iPGWH5P1BRTMiC3\nkVIlgR2tcPyLBoG68CCArG6fM0Mu4XHqQ/fpVw9rhw2bh/jjxTm0pcWdqjNfF97e\nmZ4qgEY8XhWYdu7JyE/IxOXQQDM0VLa0esBv0WVUGUCUon9rILKy6m7/24xBqgs=\n=4eBS\n-----END PGP SIGNATURE-----\n", "payload": "tree 5b85554af6125f8385852761a4bc13afe2887503\nparent c7555cedde5a560690ffd512932c4a61b60138ee\nparent 1d79588994ca773fa80938021729dbff4679d78b\nauthor Mark Rousskov <mark.simulacrum@gmail.com> 1532618309 -0600\ncommitter GitHub <noreply@github.com> 1532618309 -0600\n\nRollup merge of #52647 - csmoe:closure_arg_ignore, r=estebank\n\nSuggest to take and ignore args while closure args count mismatching\n\nCloses #52473\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/662fb069fd45d44c5828c335690598d712226325", "html_url": "https://github.com/rust-lang/rust/commit/662fb069fd45d44c5828c335690598d712226325", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/662fb069fd45d44c5828c335690598d712226325/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7555cedde5a560690ffd512932c4a61b60138ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7555cedde5a560690ffd512932c4a61b60138ee", "html_url": "https://github.com/rust-lang/rust/commit/c7555cedde5a560690ffd512932c4a61b60138ee"}, {"sha": "1d79588994ca773fa80938021729dbff4679d78b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d79588994ca773fa80938021729dbff4679d78b", "html_url": "https://github.com/rust-lang/rust/commit/1d79588994ca773fa80938021729dbff4679d78b"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "8300f98fb1cd5bee246364c6d36850b73a8deadc", "filename": "src/librustc/traits/error_reporting.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/662fb069fd45d44c5828c335690598d712226325/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/662fb069fd45d44c5828c335690598d712226325/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs?ref=662fb069fd45d44c5828c335690598d712226325", "patch": "@@ -1050,6 +1050,30 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n         if let Some(found_span) = found_span {\n             err.span_label(found_span, format!(\"takes {}\", found_str));\n \n+            // Suggest to take and ignore the arguments with expected_args_length `_`s if\n+            // found arguments is empty (assume the user just wants to ignore args in this case).\n+            // For example, if `expected_args_length` is 2, suggest `|_, _|`.\n+            if found_args.is_empty() && is_closure {\n+                let mut underscores = \"_\".repeat(expected_args.len())\n+                                      .split(\"\")\n+                                      .filter(|s| !s.is_empty())\n+                                      .collect::<Vec<_>>()\n+                                      .join(\", \");\n+                err.span_suggestion_with_applicability(\n+                    found_span,\n+                    &format!(\n+                        \"consider changing the closure to take and ignore the expected argument{}\",\n+                        if expected_args.len() < 2 {\n+                            \"\"\n+                        } else {\n+                            \"s\"\n+                        }\n+                    ),\n+                    format!(\"|{}|\", underscores),\n+                    Applicability::MachineApplicable,\n+                );\n+            }\n+\n             if let &[ArgKind::Tuple(_, ref fields)] = &found_args[..] {\n                 if fields.len() == expected_args.len() {\n                     let sugg = fields.iter()"}, {"sha": "057cf6efa1dea415fa4e72d11c48419496b4a1eb", "filename": "src/test/ui/mismatched_types/closure-arg-count.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/662fb069fd45d44c5828c335690598d712226325/src%2Ftest%2Fui%2Fmismatched_types%2Fclosure-arg-count.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/662fb069fd45d44c5828c335690598d712226325/src%2Ftest%2Fui%2Fmismatched_types%2Fclosure-arg-count.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Fclosure-arg-count.stderr?ref=662fb069fd45d44c5828c335690598d712226325", "patch": "@@ -5,6 +5,10 @@ LL |     [1, 2, 3].sort_by(|| panic!());\n    |               ^^^^^^^ -- takes 0 arguments\n    |               |\n    |               expected closure that takes 2 arguments\n+help: consider changing the closure to take and ignore the expected arguments\n+   |\n+LL |     [1, 2, 3].sort_by(|_, _| panic!());\n+   |                       ^^^^^^\n \n error[E0593]: closure is expected to take 2 arguments, but it takes 1 argument\n   --> $DIR/closure-arg-count.rs:17:15\n@@ -51,6 +55,10 @@ note: required by `f`\n    |\n LL | fn f<F: Fn<usize>>(_: F) {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^\n+help: consider changing the closure to take and ignore the expected argument\n+   |\n+LL |     f(|_| panic!());\n+   |       ^^^\n \n error[E0593]: closure is expected to take a single 2-tuple as argument, but it takes 2 distinct arguments\n   --> $DIR/closure-arg-count.rs:26:53"}]}