{"sha": "5fa96e9242d6afe658b41e4403b7fb1c93cd66da", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmYTk2ZTkyNDJkNmFmZTY1OGI0MWU0NDAzYjdmYjFjOTNjZDY2ZGE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-10-23T05:01:40Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-10-23T05:01:40Z"}, "message": "Auto merge of #29237 - alexcrichton:packaging, r=brson\n\nIt looks like the target libs aren't actually the same across hosts so instead\r\nof always packaging the target libs from CFG_BUILD take the target libs from the\r\nhost if we have them and then only failing that do we take them from CFG_BUILD.\r\n\r\nCloses #29228", "tree": {"sha": "a6122880e2b7edd6fe0f563aa17f26247b22ed07", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6122880e2b7edd6fe0f563aa17f26247b22ed07"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5fa96e9242d6afe658b41e4403b7fb1c93cd66da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5fa96e9242d6afe658b41e4403b7fb1c93cd66da", "html_url": "https://github.com/rust-lang/rust/commit/5fa96e9242d6afe658b41e4403b7fb1c93cd66da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5fa96e9242d6afe658b41e4403b7fb1c93cd66da/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e518c057f5b55523655aa5ea0fb624c693fc8bb4", "url": "https://api.github.com/repos/rust-lang/rust/commits/e518c057f5b55523655aa5ea0fb624c693fc8bb4", "html_url": "https://github.com/rust-lang/rust/commit/e518c057f5b55523655aa5ea0fb624c693fc8bb4"}, {"sha": "0528effcd954bd92434daf11c97d5a07ebc0f227", "url": "https://api.github.com/repos/rust-lang/rust/commits/0528effcd954bd92434daf11c97d5a07ebc0f227", "html_url": "https://github.com/rust-lang/rust/commit/0528effcd954bd92434daf11c97d5a07ebc0f227"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "a4c2c6b473887b502b0fafe1e8afda86863ee901", "filename": "mk/dist.mk", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/5fa96e9242d6afe658b41e4403b7fb1c93cd66da/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/5fa96e9242d6afe658b41e4403b7fb1c93cd66da/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=5fa96e9242d6afe658b41e4403b7fb1c93cd66da", "patch": "@@ -256,7 +256,25 @@ endef\n \n $(foreach host,$(CFG_HOST),\\\n   $(eval $(call DEF_INSTALLER,$(host))))\n-$(foreach target,$(CFG_TARGET),\\\n+\n+# When generating packages for the standard library, we've actually got a lot of\n+# artifacts to choose from. Each of the CFG_HOST compilers will have a copy of\n+# the standard library for each CFG_TARGET, but we only want to generate one\n+# standard library package. As a result, for each entry in CFG_TARGET we need to\n+# pick a CFG_HOST to get the standard library from.\n+#\n+# In theory it doesn't actually matter what host we choose as it should be the\n+# case that all hosts produce the same set of libraries for a target (regardless\n+# of the host itself). Currently there is a bug in the compiler, however, which\n+# means this is not the case (see #29228 and #29235). To solve the first of\n+# those bugs, we prefer to select a standard library from the host it was\n+# generated from, allowing plugins to work in more situations.\n+#\n+# For all CFG_TARGET entries in CFG_HOST, however, we just pick CFG_BUILD as the\n+# host we slurp up a standard library from.\n+$(foreach host,$(CFG_HOST),\\\n+  $(eval $(call DEF_INSTALLER_TARGETS,$(host),$(host))))\n+$(foreach target,$(filter-out $(CFG_HOST),$(CFG_TARGET)),\\\n   $(eval $(call DEF_INSTALLER_TARGETS,$(CFG_BUILD),$(target))))\n \n ifdef CFG_WINDOWSY_$(CFG_BUILD)"}]}