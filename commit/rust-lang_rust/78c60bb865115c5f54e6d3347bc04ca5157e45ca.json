{"sha": "78c60bb865115c5f54e6d3347bc04ca5157e45ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4YzYwYmI4NjUxMTVjNWY1NGU2ZDMzNDdiYzA0Y2E1MTU3ZTQ1Y2E=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-02-13T17:12:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-02-13T17:12:27Z"}, "message": "Rollup merge of #58110 - Centril:libpanic_unwind-2018, r=oli-obk\n\nlibpanic_unwind => 2018\n\nTransitions `libpanic_unwind` to Rust 2018; cc #58099\n\nr? @oli-obk", "tree": {"sha": "60ba0e7d868077170aac209db651857e086080c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/60ba0e7d868077170aac209db651857e086080c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78c60bb865115c5f54e6d3347bc04ca5157e45ca", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcZE/7CRBK7hj4Ov3rIwAAdHIIAKzHMJhdTyabqBL41jGdrkuq\nh9xed9cv//fLqzQ2CtiGyabSHeptWC+eNsmtgisxor69YEbQx/viebltJhPdESVO\n5gbZVfJ4wPJ0XYfe2LWG9mB+3ZU8omshTz1eSIZ8+z1FVTHXI6Mi1komj1tigmMo\n7Fp0+N1h6OjJNmtBEV1RhD5feY99hMiGFPGDjFvZFFmpXx/GjL2F9OmSwN9xBVtB\nvLA3mSUyHTbI7vjfxohG13MemlOP4yXn/L1ghhnECMfM78lZgUZpg21F6zmVbYFC\nTi/w9hw4FBJarDmMmba+p2XA4K6eHUNCFwwSzbcmmdwwzokl04yK9OCK2pAAfWY=\n=7rgQ\n-----END PGP SIGNATURE-----\n", "payload": "tree 60ba0e7d868077170aac209db651857e086080c1\nparent e54494727855cd14229f5d456591ed2a2f027c46\nparent bb08499626d22504a6e212ead546e7ed5190c5e6\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1550077947 +0100\ncommitter GitHub <noreply@github.com> 1550077947 +0100\n\nRollup merge of #58110 - Centril:libpanic_unwind-2018, r=oli-obk\n\nlibpanic_unwind => 2018\n\nTransitions `libpanic_unwind` to Rust 2018; cc #58099\n\nr? @oli-obk\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78c60bb865115c5f54e6d3347bc04ca5157e45ca", "html_url": "https://github.com/rust-lang/rust/commit/78c60bb865115c5f54e6d3347bc04ca5157e45ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78c60bb865115c5f54e6d3347bc04ca5157e45ca/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e54494727855cd14229f5d456591ed2a2f027c46", "url": "https://api.github.com/repos/rust-lang/rust/commits/e54494727855cd14229f5d456591ed2a2f027c46", "html_url": "https://github.com/rust-lang/rust/commit/e54494727855cd14229f5d456591ed2a2f027c46"}, {"sha": "bb08499626d22504a6e212ead546e7ed5190c5e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb08499626d22504a6e212ead546e7ed5190c5e6", "html_url": "https://github.com/rust-lang/rust/commit/bb08499626d22504a6e212ead546e7ed5190c5e6"}], "stats": {"total": 41, "additions": 20, "deletions": 21}, "files": [{"sha": "1b3901ac11a96c580c605497a3a074c2fe58c50d", "filename": "src/libpanic_unwind/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2FCargo.toml?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -2,6 +2,7 @@\n authors = [\"The Rust Project Developers\"]\n name = \"panic_unwind\"\n version = \"0.0.0\"\n+edition = \"2018\"\n \n [lib]\n path = \"lib.rs\""}, {"sha": "07fa2971847f65d5d49df89a547e3b6c8ca86d75", "filename": "src/libpanic_unwind/dwarf/eh.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fdwarf%2Feh.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fdwarf%2Feh.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Fdwarf%2Feh.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -11,7 +11,7 @@\n #![allow(non_upper_case_globals)]\n #![allow(unused)]\n \n-use dwarf::DwarfReader;\n+use crate::dwarf::DwarfReader;\n use core::mem;\n \n pub const DW_EH_PE_omit: u8 = 0xFF;\n@@ -51,7 +51,7 @@ pub enum EHAction {\n \n pub const USING_SJLJ_EXCEPTIONS: bool = cfg!(all(target_os = \"ios\", target_arch = \"arm\"));\n \n-pub unsafe fn find_eh_action(lsda: *const u8, context: &EHContext)\n+pub unsafe fn find_eh_action(lsda: *const u8, context: &EHContext<'_>)\n     -> Result<EHAction, ()>\n {\n     if lsda.is_null() {\n@@ -145,7 +145,7 @@ fn round_up(unrounded: usize, align: usize) -> Result<usize, ()> {\n }\n \n unsafe fn read_encoded_pointer(reader: &mut DwarfReader,\n-                               context: &EHContext,\n+                               context: &EHContext<'_>,\n                                encoding: u8)\n                                -> Result<usize, ()> {\n     if encoding == DW_EH_PE_omit {"}, {"sha": "18e9006468ef3500c6b7f4de3d79d2a440673013", "filename": "src/libpanic_unwind/emcc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Femcc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Femcc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Femcc.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -10,10 +10,10 @@\n \n use core::any::Any;\n use core::ptr;\n+use core::mem;\n use alloc::boxed::Box;\n use libc::{self, c_int};\n use unwind as uw;\n-use core::mem;\n \n pub fn payload() -> *mut u8 {\n     ptr::null_mut()"}, {"sha": "e2b743b379704b5faf18c1d96c14b6aae9a00f72", "filename": "src/libpanic_unwind/gcc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fgcc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fgcc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Fgcc.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -52,7 +52,7 @@ use alloc::boxed::Box;\n \n use unwind as uw;\n use libc::{c_int, uintptr_t};\n-use dwarf::eh::{self, EHContext, EHAction};\n+use crate::dwarf::eh::{self, EHContext, EHAction};\n \n #[repr(C)]\n struct Exception {"}, {"sha": "9d3d8f6185bb3e955b226ad29f2d70305b5d0561", "filename": "src/libpanic_unwind/lib.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Flib.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -17,6 +17,8 @@\n #![doc(html_root_url = \"https://doc.rust-lang.org/nightly/\",\n        issue_tracker_base_url = \"https://github.com/rust-lang/rust/issues/\")]\n \n+#![deny(rust_2018_idioms)]\n+\n #![feature(allocator_api)]\n #![feature(alloc)]\n #![feature(core_intrinsics)]\n@@ -32,11 +34,6 @@\n #![panic_runtime]\n #![feature(panic_runtime)]\n \n-extern crate alloc;\n-extern crate libc;\n-#[cfg(not(any(target_env = \"msvc\", all(windows, target_arch = \"x86_64\", target_env = \"gnu\"))))]\n-extern crate unwind;\n-\n use alloc::boxed::Box;\n use core::intrinsics;\n use core::mem;\n@@ -87,7 +84,7 @@ pub unsafe extern \"C\" fn __rust_maybe_catch_panic(f: fn(*mut u8),\n                                                   vtable_ptr: *mut usize)\n                                                   -> u32 {\n     let mut payload = imp::payload();\n-    if intrinsics::try(f, data, &mut payload as *mut _ as *mut _) == 0 {\n+    if intrinsics::r#try(f, data, &mut payload as *mut _ as *mut _) == 0 {\n         0\n     } else {\n         let obj = mem::transmute::<_, raw::TraitObject>(imp::cleanup(payload));"}, {"sha": "996fdb931eff2d49000f7d56212adea96c5d0172", "filename": "src/libpanic_unwind/seh.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fseh.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fseh.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Fseh.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -52,7 +52,7 @@ use core::any::Any;\n use core::mem;\n use core::raw;\n \n-use windows as c;\n+use crate::windows as c;\n use libc::{c_int, c_uint};\n \n // First up, a whole bunch of type definitions. There's a few platform-specific\n@@ -301,5 +301,5 @@ pub unsafe fn cleanup(payload: [u64; 2]) -> Box<dyn Any + Send> {\n #[lang = \"eh_personality\"]\n #[cfg(not(test))]\n fn rust_eh_personality() {\n-    unsafe { ::core::intrinsics::abort() }\n+    unsafe { core::intrinsics::abort() }\n }"}, {"sha": "457ffcd34f9c7ad423cbeeed910b342e85655534", "filename": "src/libpanic_unwind/seh64_gnu.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fseh64_gnu.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibpanic_unwind%2Fseh64_gnu.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Fseh64_gnu.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -9,8 +9,8 @@ use alloc::boxed::Box;\n use core::any::Any;\n use core::intrinsics;\n use core::ptr;\n-use dwarf::eh::{EHContext, EHAction, find_eh_action};\n-use windows as c;\n+use crate::dwarf::eh::{EHContext, EHAction, find_eh_action};\n+use crate::windows as c;\n \n // Define our exception codes:\n // according to http://msdn.microsoft.com/en-us/library/het71c37(v=VS.80).aspx,"}, {"sha": "b3248018b5529b5a4caaf721f40c702b29a05f1d", "filename": "src/librustc_typeck/check/method/suggest.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -752,12 +752,11 @@ fn compute_all_traits<'a, 'gcx, 'tcx>(tcx: TyCtxt<'a, 'gcx, 'tcx>) -> Vec<DefId>\n                            traits: &mut Vec<DefId>,\n                            external_mods: &mut FxHashSet<DefId>,\n                            def: Def) {\n-        let def_id = def.def_id();\n         match def {\n-            Def::Trait(..) => {\n+            Def::Trait(def_id) => {\n                 traits.push(def_id);\n             }\n-            Def::Mod(..) => {\n+            Def::Mod(def_id) => {\n                 if !external_mods.insert(def_id) {\n                     return;\n                 }"}, {"sha": "bd5cae861e93b4228e954d3f5955754fa25d66b8", "filename": "src/librustdoc/visit_lib.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibrustdoc%2Fvisit_lib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78c60bb865115c5f54e6d3347bc04ca5157e45ca/src%2Flibrustdoc%2Fvisit_lib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_lib.rs?ref=78c60bb865115c5f54e6d3347bc04ca5157e45ca", "patch": "@@ -60,9 +60,11 @@ impl<'a, 'tcx, 'rcx> LibEmbargoVisitor<'a, 'tcx, 'rcx> {\n         }\n \n         for item in self.cx.tcx.item_children(def_id).iter() {\n-            if self.cx.tcx.def_key(item.def.def_id()).parent.map_or(false, |d| d == def_id.index) ||\n-                item.vis == Visibility::Public {\n-                self.visit_item(item.def);\n+            if let Some(def_id) = item.def.opt_def_id() {\n+                if self.cx.tcx.def_key(def_id).parent.map_or(false, |d| d == def_id.index) ||\n+                    item.vis == Visibility::Public {\n+                    self.visit_item(item.def);\n+                }\n             }\n         }\n     }"}]}