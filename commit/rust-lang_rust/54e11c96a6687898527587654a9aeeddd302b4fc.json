{"sha": "54e11c96a6687898527587654a9aeeddd302b4fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0ZTExYzk2YTY2ODc4OTg1Mjc1ODc2NTRhOWFlZWRkZDMwMmI0ZmM=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-08-11T21:54:45Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-08-11T22:01:06Z"}, "message": "Extend documentation of `rustc_on_unimplemented`", "tree": {"sha": "335a3b446e5dd7a3541cbda0ca48c4362ba86aec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/335a3b446e5dd7a3541cbda0ca48c4362ba86aec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54e11c96a6687898527587654a9aeeddd302b4fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54e11c96a6687898527587654a9aeeddd302b4fc", "html_url": "https://github.com/rust-lang/rust/commit/54e11c96a6687898527587654a9aeeddd302b4fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54e11c96a6687898527587654a9aeeddd302b4fc/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0aa8d0320266b5579428312095fe49af05ada972", "url": "https://api.github.com/repos/rust-lang/rust/commits/0aa8d0320266b5579428312095fe49af05ada972", "html_url": "https://github.com/rust-lang/rust/commit/0aa8d0320266b5579428312095fe49af05ada972"}], "stats": {"total": 97, "additions": 95, "deletions": 2}, "files": [{"sha": "52969c9b896bb0002c6cc538f52e87ccc70b9748", "filename": "src/doc/unstable-book/src/language-features/on-unimplemented.md", "status": "modified", "additions": 95, "deletions": 2, "changes": 97, "blob_url": "https://github.com/rust-lang/rust/blob/54e11c96a6687898527587654a9aeeddd302b4fc/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fon-unimplemented.md", "raw_url": "https://github.com/rust-lang/rust/raw/54e11c96a6687898527587654a9aeeddd302b4fc/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fon-unimplemented.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fon-unimplemented.md?ref=54e11c96a6687898527587654a9aeeddd302b4fc", "patch": "@@ -8,7 +8,9 @@ The tracking issue for this feature is: [#29628]\n \n The `on_unimplemented` feature provides the `#[rustc_on_unimplemented]`\n attribute, which allows trait definitions to add specialized notes to error\n-messages when an implementation was expected but not found.\n+messages when an implementation was expected but not found. You can refer\n+to the trait's generic arguments by name and to the resolved type using\n+`Self`.\n \n For example:\n \n@@ -41,7 +43,98 @@ error[E0277]: the trait bound `&[{integer}]: MyIterator<char>` is not satisfied\n    |\n    = help: the trait `MyIterator<char>` is not implemented for `&[{integer}]`\n    = note: required by `iterate_chars`\n+```\n+\n+`on_unimplemented` also supports advanced filtering for better targeting\n+of messages, as well as modifying specific parts of the error message. You\n+target the text of:\n+\n+ - the main error message (`message`)\n+ - the label (`label`)\n+ - an extra note (`note`)\n+\n+For example, the following attribute\n+\n+```rust,compile_fail\n+#[rustc_on_unimplemented(\n+    message=\"message\",\n+    label=\"label\",\n+    note=\"note\"\n+)]\n+trait MyIterator<A> {\n+    fn next(&mut self) -> A;\n+}\n+```\n+\n+Would generate the following output:\n+\n+```text\n+error[E0277]: message\n+  --> <anon>:14:5\n+   |\n+14 |     iterate_chars(&[1, 2, 3][..]);\n+   |     ^^^^^^^^^^^^^ label\n+   |\n+   = note: note\n+   = help: the trait `MyIterator<char>` is not implemented for `&[{integer}]`\n+   = note: required by `iterate_chars`\n+```\n+\n+To allow for more targeted error messages, it is possible to filter the\n+application of these fields based on a variety of attributes when using\n+`on`:\n \n-error: aborting due to previous error\n+ - `crate_local`: whether the code causing the trait bound to not be\n+   fulfilled is part of the user's crate. This is used to avoid suggesting\n+   code changes that would require modifying a dependency.\n+ - Any of the generic arguments that can be substituted in the text can be\n+   referred by name as well for filtering, like `Rhs=\"i32\"`, except for\n+   `Self`.\n+ - `_Self`: to filter only on a particular calculated trait resolution, like\n+   `Self=\"std::iter::Iterator<char>\"`. This is needed because `Self` is a\n+   keyword which cannot appear in attributes.\n+ - `direct`: user-specified rather than derived obligation.\n+ - `from_method`: usable both as boolean (whether the flag is present, like\n+   `crate_local`) or matching against a particular method. Currently used\n+   for `try`.\n+ - `from_desugaring`: usable both as boolean (whether the flag is present)\n+   or matching against a particular desugaring.\n+\n+For example, the `Iterator` trait can be annotated in the following way:\n+\n+```rust,compile_fail\n+#[rustc_on_unimplemented(\n+    on(\n+        _Self=\"&str\",\n+        note=\"call `.chars()` or `.as_bytes()` on `{Self}\"\n+    ),\n+    message=\"`{Self}` is not an iterator\",\n+    label=\"`{Self}` is not an iterator\",\n+    note=\"maybe try calling `.iter()` or a similar method\"\n+)]\n+pub trait Iterator {}\n ```\n \n+Which would produce the following outputs:\n+\n+```text\n+error[E0277]: `Foo` is not an iterator\n+ --> src/main.rs:4:16\n+  |\n+4 |     for foo in Foo {}\n+  |                ^^^ `Foo` is not an iterator\n+  |\n+  = note: maybe try calling `.iter()` or a similar method\n+  = help: the trait `std::iter::Iterator` is not implemented for `Foo`\n+  = note: required by `std::iter::IntoIterator::into_iter`\n+\n+error[E0277]: `&str` is not an iterator\n+ --> src/main.rs:5:16\n+  |\n+5 |     for foo in \"\" {}\n+  |                ^^ `&str` is not an iterator\n+  |\n+  = note: call `.chars()` or `.bytes() on `&str`\n+  = help: the trait `std::iter::Iterator` is not implemented for `&str`\n+  = note: required by `std::iter::IntoIterator::into_iter`\n+```"}]}