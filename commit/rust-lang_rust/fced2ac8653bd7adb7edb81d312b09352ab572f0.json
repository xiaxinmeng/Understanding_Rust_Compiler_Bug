{"sha": "fced2ac8653bd7adb7edb81d312b09352ab572f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjZWQyYWM4NjUzYmQ3YWRiN2VkYjgxZDMxMmIwOTM1MmFiNTcyZjA=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-01-04T14:37:51Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-01-04T14:37:51Z"}, "message": "move env var stuff out of the miri lib", "tree": {"sha": "b0bb07305cc1e6d1b2701bfaead898a2a3a0b3d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0bb07305cc1e6d1b2701bfaead898a2a3a0b3d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fced2ac8653bd7adb7edb81d312b09352ab572f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fced2ac8653bd7adb7edb81d312b09352ab572f0", "html_url": "https://github.com/rust-lang/rust/commit/fced2ac8653bd7adb7edb81d312b09352ab572f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fced2ac8653bd7adb7edb81d312b09352ab572f0/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "723664465000a8ce91e74b97c6f45911d63c2bdc", "url": "https://api.github.com/repos/rust-lang/rust/commits/723664465000a8ce91e74b97c6f45911d63c2bdc", "html_url": "https://github.com/rust-lang/rust/commit/723664465000a8ce91e74b97c6f45911d63c2bdc"}], "stats": {"total": 17, "additions": 8, "deletions": 9}, "files": [{"sha": "d8d7cfe0702e5673ede65541f458a20cba639199", "filename": "src/bin/miri.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fced2ac8653bd7adb7edb81d312b09352ab572f0/src%2Fbin%2Fmiri.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fced2ac8653bd7adb7edb81d312b09352ab572f0/src%2Fbin%2Fmiri.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fmiri.rs?ref=fced2ac8653bd7adb7edb81d312b09352ab572f0", "patch": "@@ -154,6 +154,14 @@ fn init_late_loggers() {\n             rustc_driver::init_rustc_env_logger();\n         }\n     }\n+\n+    // If MIRI_BACKTRACE is set and RUST_CTFE_BACKTRACE is not, set RUST_CTFE_BACKTRACE.\n+    // Do this late, so we really only apply this to miri's errors.\n+    if let Ok(var) = env::var(\"MIRI_BACKTRACE\") {\n+        if env::var(\"RUST_CTFE_BACKTRACE\") == Err(env::VarError::NotPresent) {\n+            env::set_var(\"RUST_CTFE_BACKTRACE\", &var);\n+        }\n+    }\n }\n \n fn find_sysroot() -> String {"}, {"sha": "bb6c9e3ca503fb27b4f495bd17d4b9b3a773e5a4", "filename": "src/lib.rs", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/fced2ac8653bd7adb7edb81d312b09352ab572f0/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fced2ac8653bd7adb7edb81d312b09352ab572f0/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=fced2ac8653bd7adb7edb81d312b09352ab572f0", "patch": "@@ -15,7 +15,6 @@ extern crate rustc_target;\n \n use std::collections::HashMap;\n use std::borrow::Cow;\n-use std::env;\n \n use rustc::ty::{self, TyCtxt, query::TyCtxtAt};\n use rustc::ty::layout::{TyLayout, LayoutOf, Size, Align};\n@@ -184,14 +183,6 @@ pub fn eval_main<'a, 'tcx: 'a>(\n ) {\n     let mut ecx = create_ecx(tcx, main_id, validate).expect(\"Couldn't create ecx\");\n \n-    // If MIRI_BACKTRACE is set and RUST_CTFE_BACKTRACE is not, set RUST_CTFE_BACKTRACE.\n-    // Do this late, so we really only apply this to miri's errors.\n-    if let Ok(var) = env::var(\"MIRI_BACKTRACE\") {\n-        if env::var(\"RUST_CTFE_BACKTRACE\") == Err(env::VarError::NotPresent) {\n-            env::set_var(\"RUST_CTFE_BACKTRACE\", &var);\n-        }\n-    }\n-\n     // Run! The main execution.\n     let res: EvalResult = (|| {\n         ecx.run()?;"}]}