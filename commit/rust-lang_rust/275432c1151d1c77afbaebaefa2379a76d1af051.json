{"sha": "275432c1151d1c77afbaebaefa2379a76d1af051", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3NTQzMmMxMTUxZDFjNzdhZmJhZWJhZWZhMjM3OWE3NmQxYWYwNTE=", "commit": {"author": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2018-10-14T13:53:10Z"}, "committer": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2018-10-20T22:11:30Z"}, "message": "Give an error number for \"borrowed data escapes outside of closure\"", "tree": {"sha": "62e6bb5469f09d7e84328b20b9351a3e07ae0628", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/62e6bb5469f09d7e84328b20b9351a3e07ae0628"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/275432c1151d1c77afbaebaefa2379a76d1af051", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/275432c1151d1c77afbaebaefa2379a76d1af051", "html_url": "https://github.com/rust-lang/rust/commit/275432c1151d1c77afbaebaefa2379a76d1af051", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/275432c1151d1c77afbaebaefa2379a76d1af051/comments", "author": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "049bee09e93919a986c9911c1ef944e467773a84", "url": "https://api.github.com/repos/rust-lang/rust/commits/049bee09e93919a986c9911c1ef944e467773a84", "html_url": "https://github.com/rust-lang/rust/commit/049bee09e93919a986c9911c1ef944e467773a84"}], "stats": {"total": 40, "additions": 31, "deletions": 9}, "files": [{"sha": "f2eb04217153bb08fb4862012adc5783c32c1903", "filename": "src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fmod.rs?ref=275432c1151d1c77afbaebaefa2379a76d1af051", "patch": "@@ -13,6 +13,7 @@ use borrow_check::nll::region_infer::RegionInferenceContext;\n use borrow_check::nll::region_infer::error_reporting::region_name::RegionNameSource;\n use borrow_check::nll::type_check::Locations;\n use borrow_check::nll::universal_regions::DefiningTy;\n+use util::borrowck_errors::{BorrowckErrors, Origin};\n use rustc::hir::def_id::DefId;\n use rustc::infer::error_reporting::nice_region_error::NiceRegionError;\n use rustc::infer::InferCtxt;\n@@ -395,9 +396,7 @@ impl<'tcx> RegionInferenceContext<'tcx> {\n                                              category, span, errors_buffer);\n         }\n \n-        let mut diag = infcx.tcx.sess.struct_span_err(\n-            span, &format!(\"borrowed data escapes outside of {}\", escapes_from),\n-        );\n+        let mut diag = infcx.tcx.borrowed_data_escapes_closure(span, escapes_from, Origin::Mir);\n \n         if let Some((Some(outlived_fr_name), outlived_fr_span)) = outlived_fr_name_and_span {\n             diag.span_label("}, {"sha": "773064f15dcf0698a7b02aa0a6b5472bea7e72b6", "filename": "src/librustc_mir/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Flibrustc_mir%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Flibrustc_mir%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdiagnostics.rs?ref=275432c1151d1c77afbaebaefa2379a76d1af051", "patch": "@@ -2339,6 +2339,7 @@ register_diagnostics! {\n //  E0471, // constant evaluation error (in pattern)\n //    E0385, // {} in an aliasable location\n     E0493, // destructors cannot be evaluated at compile-time\n+    E0521,  // borrowed data escapes outside of closure\n     E0524, // two closures require unique access to `..` at the same time\n     E0526, // shuffle indices are not constant\n     E0594, // cannot assign to {}"}, {"sha": "eff19a2a9aa99327385a4f05e83a6592045acdb9", "filename": "src/librustc_mir/util/borrowck_errors.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Flibrustc_mir%2Futil%2Fborrowck_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Flibrustc_mir%2Futil%2Fborrowck_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fborrowck_errors.rs?ref=275432c1151d1c77afbaebaefa2379a76d1af051", "patch": "@@ -717,6 +717,24 @@ pub trait BorrowckErrors<'cx>: Sized + Copy {\n         self.cancel_if_wrong_origin(err, o)\n     }\n \n+    fn borrowed_data_escapes_closure(\n+        self,\n+        escape_span: Span,\n+        escapes_from: &str,\n+        o: Origin,\n+    ) -> DiagnosticBuilder<'cx> {\n+        let err = struct_span_err!(\n+            self,\n+            escape_span,\n+            E0521,\n+            \"borrowed data escapes outside of {}{OGN}\",\n+            escapes_from,\n+            OGN = o\n+        );\n+\n+        self.cancel_if_wrong_origin(err, o)\n+    }\n+\n     fn thread_local_value_does_not_live_long_enough(\n         self,\n         span: Span,"}, {"sha": "6588215c221fb9ec27d110e766c4181682814328", "filename": "src/test/ui/borrowck/issue-45983.nll.stderr", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fborrowck%2Fissue-45983.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fborrowck%2Fissue-45983.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-45983.nll.stderr?ref=275432c1151d1c77afbaebaefa2379a76d1af051", "patch": "@@ -1,4 +1,4 @@\n-error: borrowed data escapes outside of closure\n+error[E0521]: borrowed data escapes outside of closure\n   --> $DIR/issue-45983.rs:36:18\n    |\n LL |     let x = None;\n@@ -18,4 +18,5 @@ LL |     give_any(|y| x = Some(y));\n \n error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0594`.\n+Some errors occurred: E0521, E0594.\n+For more information about an error, try `rustc --explain E0521`."}, {"sha": "993b28092de9d52cb1de38ffde115c14181da80a", "filename": "src/test/ui/nll/closure-requirements/propagate-approximated-shorter-to-static-comparing-against-free.stderr", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-comparing-against-free.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-comparing-against-free.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-comparing-against-free.stderr?ref=275432c1151d1c77afbaebaefa2379a76d1af051", "patch": "@@ -13,7 +13,7 @@ LL | |     })\n                for<'r> extern \"rust-call\" fn((std::cell::Cell<&'_#1r u32>, std::cell::Cell<&ReLateBound(DebruijnIndex(0), BrNamed(crate0:DefIndex(0:0), 'r)) u32>))\n            ]\n \n-error: borrowed data escapes outside of closure\n+error[E0521]: borrowed data escapes outside of closure\n   --> $DIR/propagate-approximated-shorter-to-static-comparing-against-free.rs:32:9\n    |\n LL |     foo(cell, |cell_a, cell_x| {\n@@ -80,4 +80,5 @@ LL | }\n \n error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0597`.\n+Some errors occurred: E0521, E0597.\n+For more information about an error, try `rustc --explain E0521`."}, {"sha": "a5435cc65caa06802e6903999a483d8dcf3228da", "filename": "src/test/ui/nll/closure-requirements/propagate-approximated-shorter-to-static-no-bound.stderr", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-no-bound.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-no-bound.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-no-bound.stderr?ref=275432c1151d1c77afbaebaefa2379a76d1af051", "patch": "@@ -34,7 +34,7 @@ LL | | }\n    |\n    = note: defining type: DefId(0/0:6 ~ propagate_approximated_shorter_to_static_no_bound[317d]::supply[0]) with substs []\n \n-error: borrowed data escapes outside of function\n+error[E0521]: borrowed data escapes outside of function\n   --> $DIR/propagate-approximated-shorter-to-static-no-bound.rs:45:5\n    |\n LL |   fn supply<'a, 'b>(cell_a: Cell<&'a u32>, cell_b: Cell<&'b u32>) {\n@@ -61,3 +61,4 @@ LL |         demand_y(x, y, x.get())\n \n error: aborting due to 2 previous errors\n \n+For more information about this error, try `rustc --explain E0521`."}, {"sha": "35692414081ac1b545caa5cb48b20c8e2d3133d5", "filename": "src/test/ui/nll/closure-requirements/propagate-approximated-shorter-to-static-wrong-bound.stderr", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-wrong-bound.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/275432c1151d1c77afbaebaefa2379a76d1af051/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-wrong-bound.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-approximated-shorter-to-static-wrong-bound.stderr?ref=275432c1151d1c77afbaebaefa2379a76d1af051", "patch": "@@ -33,7 +33,7 @@ LL | | }\n    |\n    = note: defining type: DefId(0/0:6 ~ propagate_approximated_shorter_to_static_wrong_bound[317d]::supply[0]) with substs []\n \n-error: borrowed data escapes outside of function\n+error[E0521]: borrowed data escapes outside of function\n   --> $DIR/propagate-approximated-shorter-to-static-wrong-bound.rs:48:5\n    |\n LL |   fn supply<'a, 'b>(cell_a: Cell<&'a u32>, cell_b: Cell<&'b u32>) {\n@@ -59,3 +59,4 @@ LL |         demand_y(x, y, x.get())\n \n error: aborting due to 2 previous errors\n \n+For more information about this error, try `rustc --explain E0521`."}]}