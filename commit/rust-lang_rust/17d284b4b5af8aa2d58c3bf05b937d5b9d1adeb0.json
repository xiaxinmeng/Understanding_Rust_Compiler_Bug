{"sha": "17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3ZDI4NGI0YjVhZjhhYTJkNThjM2JmMDViOTM3ZDViOWQxYWRlYjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-02-15T19:30:37Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-02-15T19:30:37Z"}, "message": "Auto merge of #31530 - dirk:dirk/restrict-matching-of-cfg-opts, r=alexcrichton\n\nFixes #31497.", "tree": {"sha": "c6a5e40122f2dbf0f816e6821c4abe319d33532b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6a5e40122f2dbf0f816e6821c4abe319d33532b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "html_url": "https://github.com/rust-lang/rust/commit/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a737d56e93b27fbeabae554168f454cdbb94842", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a737d56e93b27fbeabae554168f454cdbb94842", "html_url": "https://github.com/rust-lang/rust/commit/7a737d56e93b27fbeabae554168f454cdbb94842"}, {"sha": "2766e254b1c326fb32414496c9532bcb3d3f1d51", "url": "https://api.github.com/repos/rust-lang/rust/commits/2766e254b1c326fb32414496c9532bcb3d3f1d51", "html_url": "https://github.com/rust-lang/rust/commit/2766e254b1c326fb32414496c9532bcb3d3f1d51"}], "stats": {"total": 49, "additions": 36, "deletions": 13}, "files": [{"sha": "cf3e479ec21f7bd08375c27b93b632d6414a3235", "filename": "mk/crates.mk", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fcrates.mk", "raw_url": "https://github.com/rust-lang/rust/raw/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fcrates.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcrates.mk?ref=17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "patch": "@@ -59,7 +59,7 @@ RUSTC_CRATES := rustc rustc_typeck rustc_mir rustc_borrowck rustc_resolve rustc_\n                 rustc_data_structures rustc_front rustc_platform_intrinsics \\\n                 rustc_plugin rustc_metadata rustc_passes\n HOST_CRATES := syntax syntax_ext $(RUSTC_CRATES) rustdoc fmt_macros\n-TOOLS := compiletest rustdoc rustc rustbook error-index-generator\n+TOOLS := compiletest rustdoc rustc rustbook error_index_generator\n \n DEPS_core :=\n DEPS_alloc := core libc alloc_system\n@@ -120,12 +120,12 @@ TOOL_DEPS_compiletest := test getopts\n TOOL_DEPS_rustdoc := rustdoc\n TOOL_DEPS_rustc := rustc_driver\n TOOL_DEPS_rustbook := std rustdoc\n-TOOL_DEPS_error-index-generator := rustdoc syntax serialize\n+TOOL_DEPS_error_index_generator := rustdoc syntax serialize\n TOOL_SOURCE_compiletest := $(S)src/compiletest/compiletest.rs\n TOOL_SOURCE_rustdoc := $(S)src/driver/driver.rs\n TOOL_SOURCE_rustc := $(S)src/driver/driver.rs\n TOOL_SOURCE_rustbook := $(S)src/rustbook/main.rs\n-TOOL_SOURCE_error-index-generator := $(S)src/error-index-generator/main.rs\n+TOOL_SOURCE_error_index_generator := $(S)src/error_index_generator/main.rs\n \n ONLY_RLIB_core := 1\n ONLY_RLIB_libc := 1"}, {"sha": "31d3764eefab13ca3fdb455037d2aa519d1de599", "filename": "mk/dist.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "patch": "@@ -52,7 +52,7 @@ PKG_FILES := \\\n       doc                                      \\\n       driver                                   \\\n       etc                                      \\\n-      error-index-generator                    \\\n+      error_index_generator                    \\\n       $(foreach crate,$(CRATES),lib$(crate))   \\\n       libcollectionstest                       \\\n       libcoretest                              \\"}, {"sha": "83cdb7f8023bcdac86de2ce319bde1c4a1d9a0d1", "filename": "mk/docs.mk", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fdocs.mk", "raw_url": "https://github.com/rust-lang/rust/raw/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fdocs.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdocs.mk?ref=17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "patch": "@@ -59,8 +59,8 @@ RUSTBOOK_EXE = $(HBIN2_H_$(CFG_BUILD))/rustbook$(X_$(CFG_BUILD))\n # ./configure\n RUSTBOOK = $(RPATH_VAR2_T_$(CFG_BUILD)_H_$(CFG_BUILD)) $(RUSTBOOK_EXE)\n \n-# The error-index-generator executable...\n-ERR_IDX_GEN_EXE = $(HBIN2_H_$(CFG_BUILD))/error-index-generator$(X_$(CFG_BUILD))\n+# The error_index_generator executable...\n+ERR_IDX_GEN_EXE = $(HBIN2_H_$(CFG_BUILD))/error_index_generator$(X_$(CFG_BUILD))\n ERR_IDX_GEN = $(RPATH_VAR2_T_$(CFG_BUILD)_H_$(CFG_BUILD)) $(ERR_IDX_GEN_EXE)\n ERR_IDX_GEN_MD = $(RPATH_VAR2_T_$(CFG_BUILD)_H_$(CFG_BUILD)) $(ERR_IDX_GEN_EXE) markdown\n \n@@ -221,9 +221,9 @@ error-index: doc/error-index.html\n # Metadata used to generate the index is created as a side effect of\n # the build so this depends on every crate being up to date.\n doc/error-index.html: $(ERR_IDX_GEN_EXE) $(CSREQ$(2)_T_$(CFG_BUILD)_H_$(CFG_BUILD)) | doc/\n-\t$(Q)$(call E, error-index-generator: $@)\n+\t$(Q)$(call E, error_index_generator: $@)\n \t$(Q)$(ERR_IDX_GEN)\n \n doc/error-index.md: $(ERR_IDX_GEN_EXE) $(CSREQ$(2)_T_$(CFG_BUILD)_H_$(CFG_BUILD)) | doc/\n-\t$(Q)$(call E, error-index-generator: $@)\n+\t$(Q)$(call E, error_index_generator: $@)\n \t$(Q)$(ERR_IDX_GEN_MD)"}, {"sha": "2488de4ad5bdf32850aee70658f6600e3b70f4bc", "filename": "mk/prepare.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fprepare.mk", "raw_url": "https://github.com/rust-lang/rust/raw/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/mk%2Fprepare.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fprepare.mk?ref=17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "patch": "@@ -82,7 +82,7 @@ define PREPARE_MAN\n \n endef\n \n-PREPARE_TOOLS = $(filter-out compiletest rustbook error-index-generator, $(TOOLS))\n+PREPARE_TOOLS = $(filter-out compiletest rustbook error_index_generator, $(TOOLS))\n \n \n # $(1) is tool"}, {"sha": "db9dd006f3c86f494123ea0ee68b9577328a69cf", "filename": "src/error_index_generator/main.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/src%2Ferror_index_generator%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/src%2Ferror_index_generator%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ferror_index_generator%2Fmain.rs?ref=17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "previous_filename": "src/error-index-generator/main.rs"}, {"sha": "28422989ea159cba838d096805df5237b04d4ec5", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "patch": "@@ -28,6 +28,7 @@ use syntax::attr;\n use syntax::attr::AttrMetaMethods;\n use syntax::errors::{ColorConfig, Handler};\n use syntax::parse;\n+use syntax::parse::lexer::Reader;\n use syntax::parse::token::InternedString;\n use syntax::feature_gate::UnstableFeatures;\n \n@@ -906,10 +907,19 @@ pub fn rustc_optgroups() -> Vec<RustcOptGroup> {\n // Convert strings provided as --cfg [cfgspec] into a crate_cfg\n pub fn parse_cfgspecs(cfgspecs: Vec<String> ) -> ast::CrateConfig {\n     cfgspecs.into_iter().map(|s| {\n-        parse::parse_meta_from_source_str(\"cfgspec\".to_string(),\n-                                          s.to_string(),\n-                                          Vec::new(),\n-                                          &parse::ParseSess::new())\n+        let sess = parse::ParseSess::new();\n+        let mut parser = parse::new_parser_from_source_str(&sess,\n+                                                           Vec::new(),\n+                                                           \"cfgspec\".to_string(),\n+                                                           s.to_string());\n+        let meta_item = panictry!(parser.parse_meta_item());\n+\n+        if !parser.reader.is_eof() {\n+            early_error(ErrorOutputType::default(), &format!(\"invalid --cfg argument: {}\",\n+                                                             s))\n+        }\n+\n+        meta_item\n     }).collect::<ast::CrateConfig>()\n }\n "}, {"sha": "404630399c601e15450d7311422c58936218960a", "filename": "src/test/compile-fail/cfg-arg-invalid.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/src%2Ftest%2Fcompile-fail%2Fcfg-arg-invalid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0/src%2Ftest%2Fcompile-fail%2Fcfg-arg-invalid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fcfg-arg-invalid.rs?ref=17d284b4b5af8aa2d58c3bf05b937d5b9d1adeb0", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: --cfg a{b}\n+// error-pattern: invalid --cfg argument: a{b}\n+fn main() {}"}]}