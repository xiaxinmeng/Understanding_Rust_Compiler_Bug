{"sha": "8db734990be40e2acd59c2b20bf6e02343830fd6", "node_id": "C_kwDOAAsO6NoAKDhkYjczNDk5MGJlNDBlMmFjZDU5YzJiMjBiZjZlMDIzNDM4MzBmZDY", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2022-06-06T12:03:11Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2022-06-06T12:13:28Z"}, "message": "Fix `#[expect]` for `async_yields_async`", "tree": {"sha": "369061d73a13e789ea4f23cd47583bd5a4ed10bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/369061d73a13e789ea4f23cd47583bd5a4ed10bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8db734990be40e2acd59c2b20bf6e02343830fd6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEwgBEOx3xlHwII7PG9cWdDmaeUwIFAmKd72gACgkQ9cWdDmae\nUwJ7Dg/+Jl1dodtRX3dIk97LENcUjQg2bvIOvv8hBGxoz+egYGMMfrPXJqTfLPtz\npJUbIVZD9gTebRjh51ngdz3nyN4tQMDBSdDWPJodFIUNCEXqzHDMs0XwH0SSxcvq\nYyzILJReSTl8q2zawWS72YcTgY7SnY4E9beIoK6zrz2FBWQcwSHd3SvvYNRgZQPx\n88W5NIkdW1MOLPimVfNARr5k2jOueMFdDsvZH/McZ5ODMrcC4E0ITxHVdLcJaLv+\nbusyxchba3M/um9YrLDB87J2QuMjN71mTYVQjgAawL0Rm2LX8112UD5esvpwbOyg\nPTTpT/Huib8GdfkVEyCWoUvCDVcLsYtxs3xAfpFvNHZ4Wn8+hbs2n21TTeu6Qo/N\nlLQY8tIQFVBb3u9VOQHj5XZyYw1qxpe+rArKUst3K0vaqytRJj9RSIwuw7J7DcC7\nkT/LmSHnOLqOfs4Lc5VPUuEGVnDfbzJZ76zhbqDlnnJthn7qjc5WiVckYV90SIka\nMTbkWuIc53BLXDZMSFq9O+oHKtJKD3ogIQ44p8G1YGc65E44l1BNGExn1Cx6amFR\nTMEo33oYGqC5oGHyTuO3ya8VW+TEAmXv0EELZPfPiyK09/wB23fT7LDAvqjF61zi\n2IJ1pfT075hva1aR05SIhpXYmgCG6cGnNKMGRfVjIT3LLNtSIw4=\n=OZU7\n-----END PGP SIGNATURE-----", "payload": "tree 369061d73a13e789ea4f23cd47583bd5a4ed10bf\nparent 7e1730e16c779f688392e0edcd553036b2afe1f1\nauthor xFrednet <xFrednet@gmail.com> 1654516991 +0200\ncommitter xFrednet <xFrednet@gmail.com> 1654517608 +0200\n\nFix `#[expect]` for `async_yields_async`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8db734990be40e2acd59c2b20bf6e02343830fd6", "html_url": "https://github.com/rust-lang/rust/commit/8db734990be40e2acd59c2b20bf6e02343830fd6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8db734990be40e2acd59c2b20bf6e02343830fd6/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e1730e16c779f688392e0edcd553036b2afe1f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e1730e16c779f688392e0edcd553036b2afe1f1", "html_url": "https://github.com/rust-lang/rust/commit/7e1730e16c779f688392e0edcd553036b2afe1f1"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "d32724d040cdfa929d06ac84681ce44e83dd2a62", "filename": "clippy_lints/src/async_yields_async.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8db734990be40e2acd59c2b20bf6e02343830fd6/clippy_lints%2Fsrc%2Fasync_yields_async.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8db734990be40e2acd59c2b20bf6e02343830fd6/clippy_lints%2Fsrc%2Fasync_yields_async.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fasync_yields_async.rs?ref=8db734990be40e2acd59c2b20bf6e02343830fd6", "patch": "@@ -1,4 +1,4 @@\n-use clippy_utils::diagnostics::span_lint_and_then;\n+use clippy_utils::diagnostics::span_lint_hir_and_then;\n use clippy_utils::source::snippet;\n use clippy_utils::ty::implements_trait;\n use rustc_errors::Applicability;\n@@ -63,9 +63,10 @@ impl<'tcx> LateLintPass<'tcx> for AsyncYieldsAsync {\n                         _ => None,\n                     };\n                     if let Some(return_expr_span) = return_expr_span {\n-                        span_lint_and_then(\n+                        span_lint_hir_and_then(\n                             cx,\n                             ASYNC_YIELDS_ASYNC,\n+                            body.value.hir_id,\n                             return_expr_span,\n                             \"an async construct yields a type which is itself awaitable\",\n                             |db| {"}, {"sha": "73f8e083b29a0dae6e95cd614e40484785dbcc57", "filename": "clippy_lints/src/same_name_method.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8db734990be40e2acd59c2b20bf6e02343830fd6/clippy_lints%2Fsrc%2Fsame_name_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8db734990be40e2acd59c2b20bf6e02343830fd6/clippy_lints%2Fsrc%2Fsame_name_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fsame_name_method.rs?ref=8db734990be40e2acd59c2b20bf6e02343830fd6", "patch": "@@ -47,6 +47,7 @@ struct ExistingName {\n }\n \n impl<'tcx> LateLintPass<'tcx> for SameNameMethod {\n+    #[expect(clippy::too_many_lines)]\n     fn check_crate_post(&mut self, cx: &LateContext<'tcx>) {\n         let mut map = FxHashMap::<Res, ExistingName>::default();\n "}, {"sha": "3cf380d2b954b0b5f4eb1efa22a54d231dac88df", "filename": "tests/ui/async_yields_async.fixed", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fasync_yields_async.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fasync_yields_async.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasync_yields_async.fixed?ref=8db734990be40e2acd59c2b20bf6e02343830fd6", "patch": "@@ -1,5 +1,5 @@\n // run-rustfix\n-\n+#![feature(lint_reasons)]\n #![feature(async_closure)]\n #![warn(clippy::async_yields_async)]\n \n@@ -65,3 +65,14 @@ fn main() {\n     let _n = async || custom_future_type_ctor();\n     let _o = async || f();\n }\n+\n+#[rustfmt::skip]\n+#[allow(dead_code)]\n+fn check_expect_suppression() {\n+    #[expect(clippy::async_yields_async)]\n+    let _j = async || {\n+        async {\n+            3\n+        }\n+    };\n+}"}, {"sha": "dd4131b60ab3ae6b697d5257601fd2630edbb30e", "filename": "tests/ui/async_yields_async.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fasync_yields_async.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fasync_yields_async.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasync_yields_async.rs?ref=8db734990be40e2acd59c2b20bf6e02343830fd6", "patch": "@@ -1,5 +1,5 @@\n // run-rustfix\n-\n+#![feature(lint_reasons)]\n #![feature(async_closure)]\n #![warn(clippy::async_yields_async)]\n \n@@ -65,3 +65,14 @@ fn main() {\n     let _n = async || custom_future_type_ctor();\n     let _o = async || f();\n }\n+\n+#[rustfmt::skip]\n+#[allow(dead_code)]\n+fn check_expect_suppression() {\n+    #[expect(clippy::async_yields_async)]\n+    let _j = async || {\n+        async {\n+            3\n+        }\n+    };\n+}"}, {"sha": "e7a483c058295b39c84c901a721f9530cd2e13a3", "filename": "tests/ui/needless_borrow.fixed", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fneedless_borrow.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fneedless_borrow.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_borrow.fixed?ref=8db734990be40e2acd59c2b20bf6e02343830fd6", "patch": "@@ -99,6 +99,7 @@ impl<'a> Trait for &'a str {}\n \n fn h(_: &dyn Trait) {}\n \n+#[allow(dead_code)]\n fn check_expect_suppression() {\n     let a = 5;\n     #[expect(clippy::needless_borrow)]"}, {"sha": "1d6bf46405a2f0b6cabd288c11780315f15dd9d7", "filename": "tests/ui/needless_borrow.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fneedless_borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8db734990be40e2acd59c2b20bf6e02343830fd6/tests%2Fui%2Fneedless_borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_borrow.rs?ref=8db734990be40e2acd59c2b20bf6e02343830fd6", "patch": "@@ -99,6 +99,7 @@ impl<'a> Trait for &'a str {}\n \n fn h(_: &dyn Trait) {}\n \n+#[allow(dead_code)]\n fn check_expect_suppression() {\n     let a = 5;\n     #[expect(clippy::needless_borrow)]"}]}