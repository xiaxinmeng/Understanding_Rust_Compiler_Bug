{"sha": "ebdfe338e503bda5bfa2117e29d30a1044d2402c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViZGZlMzM4ZTUwM2JkYTViZmEyMTE3ZTI5ZDMwYTEwNDRkMjQwMmM=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-10-18T17:59:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-10-18T17:59:44Z"}, "message": "Rollup merge of #44138 - steveklabnik:rustdoc-deprecations, r=QuietMisdreavus\n\nDeprecate several flags in rustdoc\n\nPart of #44136\n\ncc @rust-lang/dev-tools @rust-lang/docs\n\nThis is a very basic PR to start deprecating some flags; `rustdoc` doesn't really have fancy output options like `rustc` does, so I went with `eprintln!`. Happy to change it if people feel that's not appropriate.\n\nAlso, I have no idea if we can or should write tests here, so I didn't try. If someone feels strongly about it, then let's do it, but given that the only outcome here is a side effect...", "tree": {"sha": "0c232955ac5c5891a5145c674ee13f485a609918", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c232955ac5c5891a5145c674ee13f485a609918"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebdfe338e503bda5bfa2117e29d30a1044d2402c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebdfe338e503bda5bfa2117e29d30a1044d2402c", "html_url": "https://github.com/rust-lang/rust/commit/ebdfe338e503bda5bfa2117e29d30a1044d2402c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebdfe338e503bda5bfa2117e29d30a1044d2402c/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a4f39453cfbeab1c2220331f2eae8938165c964", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a4f39453cfbeab1c2220331f2eae8938165c964", "html_url": "https://github.com/rust-lang/rust/commit/7a4f39453cfbeab1c2220331f2eae8938165c964"}, {"sha": "045ce183cc6f34ec8315b2a99d22b9563c714a08", "url": "https://api.github.com/repos/rust-lang/rust/commits/045ce183cc6f34ec8315b2a99d22b9563c714a08", "html_url": "https://github.com/rust-lang/rust/commit/045ce183cc6f34ec8315b2a99d22b9563c714a08"}], "stats": {"total": 47, "additions": 44, "deletions": 3}, "files": [{"sha": "20da99a6b137658acaec97ef85359666abe58db8", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=ebdfe338e503bda5bfa2117e29d30a1044d2402c", "patch": "@@ -170,6 +170,9 @@ pub fn opts() -> Vec<RustcOptGroup> {\n         stable(\"no-default\", |o| {\n             o.optflag(\"\", \"no-defaults\", \"don't run the default passes\")\n         }),\n+        stable(\"document-private-items\", |o| {\n+            o.optflag(\"\", \"document-private-items\", \"document private items\")\n+        }),\n         stable(\"test\", |o| o.optflag(\"\", \"test\", \"run code examples as tests\")),\n         stable(\"test-args\", |o| {\n             o.optmulti(\"\", \"test-args\", \"arguments to pass to the test runner\",\n@@ -275,6 +278,9 @@ pub fn main_args(args: &[String]) -> isize {\n     // Check for unstable options.\n     nightly_options::check_nightly_options(&matches, &opts());\n \n+    // check for deprecated options\n+    check_deprecated_options(&matches);\n+\n     if matches.opt_present(\"h\") || matches.opt_present(\"help\") {\n         usage(\"rustdoc\");\n         return 0;\n@@ -458,6 +464,18 @@ where R: 'static + Send, F: 'static + Send + FnOnce(Output) -> R {\n     let mut passes = matches.opt_strs(\"passes\");\n     let mut plugins = matches.opt_strs(\"plugins\");\n \n+    // We hardcode in the passes here, as this is a new flag and we\n+    // are generally deprecating passes.\n+    if matches.opt_present(\"document-private-items\") {\n+        default_passes = false;\n+\n+        passes = vec![\n+            String::from(\"strip-hidden\"),\n+            String::from(\"collapse-docs\"),\n+            String::from(\"unindent-comments\"),\n+        ];\n+    }\n+\n     // First, parse the crate and extract all relevant information.\n     let mut paths = SearchPaths::new();\n     for s in &matches.opt_strs(\"L\") {\n@@ -550,3 +568,26 @@ where R: 'static + Send, F: 'static + Send + FnOnce(Output) -> R {\n     });\n     rx.recv().unwrap()\n }\n+\n+/// Prints deprecation warnings for deprecated options\n+fn check_deprecated_options(matches: &getopts::Matches) {\n+    let deprecated_flags = [\n+       \"input-format\",\n+       \"output-format\",\n+       \"plugin-path\",\n+       \"plugins\",\n+       \"no-defaults\",\n+       \"passes\",\n+    ];\n+\n+    for flag in deprecated_flags.into_iter() {\n+        if matches.opt_present(flag) {\n+            eprintln!(\"WARNING: the '{}' flag is considered deprecated\", flag);\n+            eprintln!(\"WARNING: please see https://github.com/rust-lang/rust/issues/44136\");\n+        }\n+    }\n+\n+    if matches.opt_present(\"no-defaults\") {\n+        eprintln!(\"WARNING: (you may want to use --document-private-items)\");\n+    }\n+}"}, {"sha": "6c6af19be88f98f4bb080e7e43d35bf366792c4d", "filename": "src/test/rustdoc/empty-mod-private.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Ftest%2Frustdoc%2Fempty-mod-private.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Ftest%2Frustdoc%2Fempty-mod-private.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fempty-mod-private.rs?ref=ebdfe338e503bda5bfa2117e29d30a1044d2402c", "patch": "@@ -9,7 +9,7 @@\n // except according to those terms.\n \n // ignore-tidy-linelength\n-// compile-flags: --no-defaults --passes collapse-docs --passes unindent-comments --passes strip-priv-imports\n+// compile-flags: --document-private-items\n \n // @has 'empty_mod_private/index.html' '//a[@href=\"foo/index.html\"]' 'foo'\n // @has 'empty_mod_private/sidebar-items.js' 'foo'"}, {"sha": "c50df6edd484a4c9130aa90ab0d3a3b8f59c41ff", "filename": "src/test/rustdoc/issue-15347.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Ftest%2Frustdoc%2Fissue-15347.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Ftest%2Frustdoc%2Fissue-15347.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-15347.rs?ref=ebdfe338e503bda5bfa2117e29d30a1044d2402c", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// compile-flags:--no-defaults --passes collapse-docs --passes unindent-comments\n+// compile-flags: --no-defaults --passes collapse-docs --passes unindent-comments\n \n // @has issue_15347/fn.foo.html\n #[doc(hidden)]"}, {"sha": "24d566e082eea8e01e824e1d9e8dd8c419f3cccc", "filename": "src/test/rustdoc/pub-method.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Ftest%2Frustdoc%2Fpub-method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebdfe338e503bda5bfa2117e29d30a1044d2402c/src%2Ftest%2Frustdoc%2Fpub-method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fpub-method.rs?ref=ebdfe338e503bda5bfa2117e29d30a1044d2402c", "patch": "@@ -9,7 +9,7 @@\n // except according to those terms.\n \n // ignore-tidy-linelength\n-// compile-flags: --no-defaults --passes collapse-docs --passes unindent-comments --passes strip-priv-imports\n+// compile-flags: --document-private-items\n \n #![crate_name = \"foo\"]\n "}]}