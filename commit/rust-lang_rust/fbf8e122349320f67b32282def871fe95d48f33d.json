{"sha": "fbf8e122349320f67b32282def871fe95d48f33d", "node_id": "C_kwDOAAsO6NoAKGZiZjhlMTIyMzQ5MzIwZjY3YjMyMjgyZGVmODcxZmU5NWQ0OGYzM2Q", "commit": {"author": {"name": "XFFXFF", "email": "1247714429@qq.com", "date": "2022-06-16T08:12:46Z"}, "committer": {"name": "XFFXFF", "email": "1247714429@qq.com", "date": "2022-06-16T08:24:18Z"}, "message": "the scope of the return type is not the body of the function", "tree": {"sha": "0760c61e9e14d803693038c3aa91d3456b0d38cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0760c61e9e14d803693038c3aa91d3456b0d38cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fbf8e122349320f67b32282def871fe95d48f33d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fbf8e122349320f67b32282def871fe95d48f33d", "html_url": "https://github.com/rust-lang/rust/commit/fbf8e122349320f67b32282def871fe95d48f33d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fbf8e122349320f67b32282def871fe95d48f33d/comments", "author": {"login": "xffxff", "id": 30254428, "node_id": "MDQ6VXNlcjMwMjU0NDI4", "avatar_url": "https://avatars.githubusercontent.com/u/30254428?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xffxff", "html_url": "https://github.com/xffxff", "followers_url": "https://api.github.com/users/xffxff/followers", "following_url": "https://api.github.com/users/xffxff/following{/other_user}", "gists_url": "https://api.github.com/users/xffxff/gists{/gist_id}", "starred_url": "https://api.github.com/users/xffxff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xffxff/subscriptions", "organizations_url": "https://api.github.com/users/xffxff/orgs", "repos_url": "https://api.github.com/users/xffxff/repos", "events_url": "https://api.github.com/users/xffxff/events{/privacy}", "received_events_url": "https://api.github.com/users/xffxff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xffxff", "id": 30254428, "node_id": "MDQ6VXNlcjMwMjU0NDI4", "avatar_url": "https://avatars.githubusercontent.com/u/30254428?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xffxff", "html_url": "https://github.com/xffxff", "followers_url": "https://api.github.com/users/xffxff/followers", "following_url": "https://api.github.com/users/xffxff/following{/other_user}", "gists_url": "https://api.github.com/users/xffxff/gists{/gist_id}", "starred_url": "https://api.github.com/users/xffxff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xffxff/subscriptions", "organizations_url": "https://api.github.com/users/xffxff/orgs", "repos_url": "https://api.github.com/users/xffxff/repos", "events_url": "https://api.github.com/users/xffxff/events{/privacy}", "received_events_url": "https://api.github.com/users/xffxff/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "519d7484f3b1beb25dec9f2249adeaaa21033433", "url": "https://api.github.com/repos/rust-lang/rust/commits/519d7484f3b1beb25dec9f2249adeaaa21033433", "html_url": "https://github.com/rust-lang/rust/commit/519d7484f3b1beb25dec9f2249adeaaa21033433"}], "stats": {"total": 37, "additions": 30, "deletions": 7}, "files": [{"sha": "0ae30604a8a704f1c86d8de0834e1c78f3d5a225", "filename": "crates/hir/src/source_analyzer.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/fbf8e122349320f67b32282def871fe95d48f33d/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbf8e122349320f67b32282def871fe95d48f33d/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs?ref=fbf8e122349320f67b32282def871fe95d48f33d", "patch": "@@ -600,13 +600,11 @@ fn scope_for_offset(\n             .filter(|it| it.value.kind() == SyntaxKind::MACRO_CALL)?;\n             Some((source.value.text_range(), scope))\n         })\n-        // find containing scope\n-        .min_by_key(|(expr_range, _scope)| {\n-            (\n-                !(expr_range.start() <= offset.value && offset.value <= expr_range.end()),\n-                expr_range.len(),\n-            )\n+        .filter(|(expr_range, _scope)| {\n+            expr_range.start() <= offset.value && offset.value <= expr_range.end()\n         })\n+        // find containing scope\n+        .min_by_key(|(expr_range, _scope)| expr_range.len())\n         .map(|(expr_range, scope)| {\n             adjust(db, scopes, source_map, expr_range, offset).unwrap_or(*scope)\n         })"}, {"sha": "ded8e48d4ea543fbb5d9a848696a9a686f1d258e", "filename": "crates/ide-completion/src/tests/expression.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fbf8e122349320f67b32282def871fe95d48f33d/crates%2Fide-completion%2Fsrc%2Ftests%2Fexpression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbf8e122349320f67b32282def871fe95d48f33d/crates%2Fide-completion%2Fsrc%2Ftests%2Fexpression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Fexpression.rs?ref=fbf8e122349320f67b32282def871fe95d48f33d", "patch": "@@ -513,7 +513,6 @@ fn quux(x: i32) {\n \",\n         expect![[r#\"\n             fn quux(\u2026)   fn(i32)\n-            lc x         i32\n             ma m!(\u2026)     macro_rules! m\n             bt u32\n             kw crate::"}, {"sha": "191acb90532713d107dddd592321ecd0ffbf9b94", "filename": "crates/ide-completion/src/tests/type_pos.rs", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/fbf8e122349320f67b32282def871fe95d48f33d/crates%2Fide-completion%2Fsrc%2Ftests%2Ftype_pos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbf8e122349320f67b32282def871fe95d48f33d/crates%2Fide-completion%2Fsrc%2Ftests%2Ftype_pos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Ftype_pos.rs?ref=fbf8e122349320f67b32282def871fe95d48f33d", "patch": "@@ -89,6 +89,32 @@ fn x<'lt, T, const C: usize>() -> $0\n     );\n }\n \n+#[test]\n+fn fn_return_type2() {\n+    check(\n+        r#\"\n+fn foo() -> B$0 {\n+    struct Bar;\n+}\n+\"#,\n+        expect![[r#\"\n+        en Enum\n+        ma makro!(\u2026) macro_rules! makro\n+        md module\n+        st Record\n+        st Tuple\n+        st Unit\n+        tt Trait\n+        un Union\n+        bt u32\n+        it ()\n+        kw crate::\n+        kw self::\n+        kw super::\n+    \"#]],\n+    )\n+}\n+\n #[test]\n fn inferred_type_const() {\n     check("}]}