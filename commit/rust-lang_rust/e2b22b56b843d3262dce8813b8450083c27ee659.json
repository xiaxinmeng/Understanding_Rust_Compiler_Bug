{"sha": "e2b22b56b843d3262dce8813b8450083c27ee659", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUyYjIyYjU2Yjg0M2QzMjYyZGNlODgxM2I4NDUwMDgzYzI3ZWU2NTk=", "commit": {"author": {"name": "LingMan", "email": "LingMan@users.noreply.github.com", "date": "2021-06-01T16:09:29Z"}, "committer": {"name": "LingMan", "email": "LingMan@users.noreply.github.com", "date": "2021-06-01T20:31:46Z"}, "message": "Use pattern matching instead of checking lengths explicitly\n\nThis piece of code checks that there are exaclty two variants, one having\nexactly one field, the other having exactly zero fields. If any of these\nconditions is violated, it returns `None`. Otherwise it assigns that one\nfield's ty to `field_ty`.\n\nInstead of fiddling with indices and length checks explicitly, use pattern\nmatching to simplify this.", "tree": {"sha": "3d7e0e7bb730fdc476eacf7607d2b3b4fc31c8f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d7e0e7bb730fdc476eacf7607d2b3b4fc31c8f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e2b22b56b843d3262dce8813b8450083c27ee659", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e2b22b56b843d3262dce8813b8450083c27ee659", "html_url": "https://github.com/rust-lang/rust/commit/e2b22b56b843d3262dce8813b8450083c27ee659", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e2b22b56b843d3262dce8813b8450083c27ee659/comments", "author": {"login": "LingMan", "id": 18645382, "node_id": "MDQ6VXNlcjE4NjQ1Mzgy", "avatar_url": "https://avatars.githubusercontent.com/u/18645382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LingMan", "html_url": "https://github.com/LingMan", "followers_url": "https://api.github.com/users/LingMan/followers", "following_url": "https://api.github.com/users/LingMan/following{/other_user}", "gists_url": "https://api.github.com/users/LingMan/gists{/gist_id}", "starred_url": "https://api.github.com/users/LingMan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LingMan/subscriptions", "organizations_url": "https://api.github.com/users/LingMan/orgs", "repos_url": "https://api.github.com/users/LingMan/repos", "events_url": "https://api.github.com/users/LingMan/events{/privacy}", "received_events_url": "https://api.github.com/users/LingMan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "LingMan", "id": 18645382, "node_id": "MDQ6VXNlcjE4NjQ1Mzgy", "avatar_url": "https://avatars.githubusercontent.com/u/18645382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LingMan", "html_url": "https://github.com/LingMan", "followers_url": "https://api.github.com/users/LingMan/followers", "following_url": "https://api.github.com/users/LingMan/following{/other_user}", "gists_url": "https://api.github.com/users/LingMan/gists{/gist_id}", "starred_url": "https://api.github.com/users/LingMan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LingMan/subscriptions", "organizations_url": "https://api.github.com/users/LingMan/orgs", "repos_url": "https://api.github.com/users/LingMan/repos", "events_url": "https://api.github.com/users/LingMan/events{/privacy}", "received_events_url": "https://api.github.com/users/LingMan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1160cf864f2a0014e3442367e1b96496bfbeadf4", "url": "https://api.github.com/repos/rust-lang/rust/commits/1160cf864f2a0014e3442367e1b96496bfbeadf4", "html_url": "https://github.com/rust-lang/rust/commit/1160cf864f2a0014e3442367e1b96496bfbeadf4"}], "stats": {"total": 26, "additions": 7, "deletions": 19}, "files": [{"sha": "319adf42cf1ed2aee243a3d8f2ef2a1803a3344a", "filename": "compiler/rustc_lint/src/types.rs", "status": "modified", "additions": 7, "deletions": 19, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/e2b22b56b843d3262dce8813b8450083c27ee659/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e2b22b56b843d3262dce8813b8450083c27ee659/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs?ref=e2b22b56b843d3262dce8813b8450083c27ee659", "patch": "@@ -5,15 +5,14 @@ use rustc_data_structures::fx::FxHashSet;\n use rustc_errors::Applicability;\n use rustc_hir as hir;\n use rustc_hir::{is_range_literal, ExprKind, Node};\n-use rustc_index::vec::Idx;\n use rustc_middle::ty::layout::{IntegerExt, SizeSkeleton};\n use rustc_middle::ty::subst::SubstsRef;\n use rustc_middle::ty::{self, AdtKind, Ty, TyCtxt, TypeFoldable};\n use rustc_span::source_map;\n use rustc_span::symbol::sym;\n use rustc_span::{Span, DUMMY_SP};\n use rustc_target::abi::Abi;\n-use rustc_target::abi::{Integer, LayoutOf, TagEncoding, VariantIdx, Variants};\n+use rustc_target::abi::{Integer, LayoutOf, TagEncoding, Variants};\n use rustc_target::spec::abi::Abi as SpecAbi;\n \n use std::cmp;\n@@ -783,25 +782,14 @@ crate fn repr_nullable_ptr<'tcx>(\n ) -> Option<Ty<'tcx>> {\n     debug!(\"is_repr_nullable_ptr(cx, ty = {:?})\", ty);\n     if let ty::Adt(ty_def, substs) = ty.kind() {\n-        if ty_def.variants.len() != 2 {\n-            return None;\n-        }\n-\n-        let get_variant_fields = |index| &ty_def.variants[VariantIdx::new(index)].fields;\n-        let variant_fields = [get_variant_fields(0), get_variant_fields(1)];\n-        let fields = if variant_fields[0].is_empty() {\n-            &variant_fields[1]\n-        } else if variant_fields[1].is_empty() {\n-            &variant_fields[0]\n-        } else {\n-            return None;\n+        let field_ty = match &ty_def.variants.raw[..] {\n+            [var_one, var_two] => match (&var_one.fields[..], &var_two.fields[..]) {\n+                ([], [field]) | ([field], []) => field.ty(cx.tcx, substs),\n+                _ => return None,\n+            },\n+            _ => return None,\n         };\n \n-        if fields.len() != 1 {\n-            return None;\n-        }\n-\n-        let field_ty = fields[0].ty(cx.tcx, substs);\n         if !ty_is_known_nonnull(cx, field_ty, ckind) {\n             return None;\n         }"}]}