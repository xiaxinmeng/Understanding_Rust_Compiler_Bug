{"sha": "36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b", "node_id": "C_kwDOAAsO6NoAKDM2ZGNkNGNiZDlhNDU1NzA3ZjJiNzkwZTAxZmJkYzM4YTg2ZDVlOWI", "commit": {"author": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2021-11-21T16:02:00Z"}, "committer": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2021-11-21T16:02:00Z"}, "message": "Update link_ordinal duplicate attribute handling.\n\nThis removes the duplicate check, as this is now handled in a\ncentralized location.", "tree": {"sha": "c45c39a847afd3243834c55f674606d0a080d796", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c45c39a847afd3243834c55f674606d0a080d796"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b", "html_url": "https://github.com/rust-lang/rust/commit/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b/comments", "author": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c60ea8228993a11d46f2dfb110128325441c77b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c60ea8228993a11d46f2dfb110128325441c77b", "html_url": "https://github.com/rust-lang/rust/commit/4c60ea8228993a11d46f2dfb110128325441c77b"}], "stats": {"total": 19, "additions": 8, "deletions": 11}, "files": [{"sha": "de1606a7ed5f07f16f9f8e8b58df2e0a29974a8b", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b", "patch": "@@ -2865,14 +2865,6 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, id: DefId) -> CodegenFnAttrs {\n         } else if attr.has_name(sym::link_name) {\n             codegen_fn_attrs.link_name = attr.value_str();\n         } else if attr.has_name(sym::link_ordinal) {\n-            if link_ordinal_span.is_some() {\n-                tcx.sess\n-                    .struct_span_err(\n-                        attr.span,\n-                        \"multiple `link_ordinal` attributes on a single definition\",\n-                    )\n-                    .emit();\n-            }\n             link_ordinal_span = Some(attr.span);\n             if let ordinal @ Some(_) = check_link_ordinal(tcx, attr) {\n                 codegen_fn_attrs.link_ordinal = ordinal;"}, {"sha": "0ab994ecd45bedeff1ce909a16f40b9049c51a13", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-multiple.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.rs?ref=36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b", "patch": "@@ -4,9 +4,8 @@\n \n #[link(name = \"foo\", kind = \"raw-dylib\")]\n extern \"C\" {\n-    #[link_ordinal(1)]\n+    #[link_ordinal(1)] //~ ERROR multiple `link_ordinal` attributes\n     #[link_ordinal(2)]\n-    //~^ ERROR multiple `link_ordinal` attributes on a single definition\n     fn foo();\n }\n "}, {"sha": "4772533ab2f07199b99dc35e377a3f3fde044b8f", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-multiple.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.stderr?ref=36dcd4cbd9a455707f2b790e01fbdc38a86d5e9b", "patch": "@@ -7,7 +7,13 @@ LL | #![feature(raw_dylib)]\n    = note: `#[warn(incomplete_features)]` on by default\n    = note: see issue #58713 <https://github.com/rust-lang/rust/issues/58713> for more information\n \n-error: multiple `link_ordinal` attributes on a single definition\n+error: multiple `link_ordinal` attributes\n+  --> $DIR/link-ordinal-multiple.rs:7:5\n+   |\n+LL |     #[link_ordinal(1)]\n+   |     ^^^^^^^^^^^^^^^^^^ help: remove this attribute\n+   |\n+note: attribute also specified here\n   --> $DIR/link-ordinal-multiple.rs:8:5\n    |\n LL |     #[link_ordinal(2)]"}]}