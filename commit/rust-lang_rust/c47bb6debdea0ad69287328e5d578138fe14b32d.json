{"sha": "c47bb6debdea0ad69287328e5d578138fe14b32d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0N2JiNmRlYmRlYTBhZDY5Mjg3MzI4ZTVkNTc4MTM4ZmUxNGIzMmQ=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-04-19T03:51:11Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-04-19T03:51:11Z"}, "message": "On `FnDef` type annotation suggestion, use fn-pointer output\n\nPartly addresses #71209.", "tree": {"sha": "2138cbb3f87bf21b53406af75b68c5b931c3b311", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2138cbb3f87bf21b53406af75b68c5b931c3b311"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c47bb6debdea0ad69287328e5d578138fe14b32d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c47bb6debdea0ad69287328e5d578138fe14b32d", "html_url": "https://github.com/rust-lang/rust/commit/c47bb6debdea0ad69287328e5d578138fe14b32d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c47bb6debdea0ad69287328e5d578138fe14b32d/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "52fa23add6fb0776b32cc591ac928618391bdf41", "url": "https://api.github.com/repos/rust-lang/rust/commits/52fa23add6fb0776b32cc591ac928618391bdf41", "html_url": "https://github.com/rust-lang/rust/commit/52fa23add6fb0776b32cc591ac928618391bdf41"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "2b4aeb2138240a9fb6740409afff930f907f1040", "filename": "src/librustc_infer/infer/error_reporting/need_type_info.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c47bb6debdea0ad69287328e5d578138fe14b32d/src%2Flibrustc_infer%2Finfer%2Ferror_reporting%2Fneed_type_info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c47bb6debdea0ad69287328e5d578138fe14b32d/src%2Flibrustc_infer%2Finfer%2Ferror_reporting%2Fneed_type_info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_infer%2Finfer%2Ferror_reporting%2Fneed_type_info.rs?ref=c47bb6debdea0ad69287328e5d578138fe14b32d", "patch": "@@ -247,7 +247,13 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                 None\n             };\n             printer.name_resolver = Some(Box::new(&getter));\n-            let _ = ty.print(printer);\n+            let _ = if let ty::FnDef(..) = ty.kind {\n+                // We don't want the regular output for `fn`s because it inscludes its path in\n+                // invalid pseduo-syntax, we want the `fn`-pointer output instead.\n+                ty.fn_sig(self.tcx).print(printer)\n+            } else {\n+                ty.print(printer)\n+            };\n             s\n         };\n "}, {"sha": "2f140f823afb923707f116ba589670d9c35542ae", "filename": "src/test/ui/suggestions/fn-needing-specified-return-type-param.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c47bb6debdea0ad69287328e5d578138fe14b32d/src%2Ftest%2Fui%2Fsuggestions%2Ffn-needing-specified-return-type-param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c47bb6debdea0ad69287328e5d578138fe14b32d/src%2Ftest%2Fui%2Fsuggestions%2Ffn-needing-specified-return-type-param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ffn-needing-specified-return-type-param.rs?ref=c47bb6debdea0ad69287328e5d578138fe14b32d", "patch": "@@ -0,0 +1,5 @@\n+fn f<A>() -> A { unimplemented!() }\n+fn foo() {\n+    let _ = f; //~ ERROR type annotations needed for `fn() -> A`\n+}\n+fn main() {}"}, {"sha": "b59a3818e704253358074c2a397e6c513a3dbe4b", "filename": "src/test/ui/suggestions/fn-needing-specified-return-type-param.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c47bb6debdea0ad69287328e5d578138fe14b32d/src%2Ftest%2Fui%2Fsuggestions%2Ffn-needing-specified-return-type-param.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c47bb6debdea0ad69287328e5d578138fe14b32d/src%2Ftest%2Fui%2Fsuggestions%2Ffn-needing-specified-return-type-param.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ffn-needing-specified-return-type-param.stderr?ref=c47bb6debdea0ad69287328e5d578138fe14b32d", "patch": "@@ -0,0 +1,11 @@\n+error[E0282]: type annotations needed for `fn() -> A`\n+  --> $DIR/fn-needing-specified-return-type-param.rs:3:13\n+   |\n+LL |     let _ = f;\n+   |         -   ^ cannot infer type for type parameter `A` declared on the function `f`\n+   |         |\n+   |         consider giving this pattern the explicit type `fn() -> A`, where the type parameter `A` is specified\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0282`."}]}