{"sha": "fb1fb7d2ef45760bfe133381286dc750fe51e49e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiMWZiN2QyZWY0NTc2MGJmZTEzMzM4MTI4NmRjNzUwZmU1MWU0OWU=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-04-24T01:24:02Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-04-24T01:57:52Z"}, "message": "Tweak suggestion output", "tree": {"sha": "da4a8c2be1206171a8fbf3f1603d1ad174530c3a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da4a8c2be1206171a8fbf3f1603d1ad174530c3a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb1fb7d2ef45760bfe133381286dc750fe51e49e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb1fb7d2ef45760bfe133381286dc750fe51e49e", "html_url": "https://github.com/rust-lang/rust/commit/fb1fb7d2ef45760bfe133381286dc750fe51e49e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb1fb7d2ef45760bfe133381286dc750fe51e49e/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "64ee9cc28ceda652ac06b7d6bf68d1b7f408cf23", "url": "https://api.github.com/repos/rust-lang/rust/commits/64ee9cc28ceda652ac06b7d6bf68d1b7f408cf23", "html_url": "https://github.com/rust-lang/rust/commit/64ee9cc28ceda652ac06b7d6bf68d1b7f408cf23"}], "stats": {"total": 86, "additions": 67, "deletions": 19}, "files": [{"sha": "73e35f0171aa773b21358c50652487073c8887e4", "filename": "compiler/rustc_typeck/src/check/method/suggest.rs", "status": "modified", "additions": 28, "deletions": 7, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -988,6 +988,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         let mut alt_rcvr_sugg = false;\n         if let SelfSource::MethodCall(rcvr) = source {\n             debug!(?span, ?item_name, ?rcvr_ty, ?rcvr);\n+            let skippable = [\n+                self.tcx.lang_items().clone_trait(),\n+                self.tcx.lang_items().deref_trait(),\n+                self.tcx.lang_items().deref_mut_trait(),\n+                self.tcx.lang_items().drop_trait(),\n+            ];\n             // Try alternative arbitrary self types that could fulfill this call.\n             // FIXME: probe for all types that *could* be arbitrary self-types, not\n             // just this list.\n@@ -996,6 +1002,27 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 (self.tcx.mk_mut_ref(&ty::ReErased, rcvr_ty), \"&mut \"),\n                 (self.tcx.mk_imm_ref(&ty::ReErased, rcvr_ty), \"&\"),\n             ] {\n+                if let Ok(pick) = self.lookup_probe(\n+                    span,\n+                    item_name,\n+                    rcvr_ty,\n+                    rcvr,\n+                    crate::check::method::probe::ProbeScope::AllTraits,\n+                ) {\n+                    // If the method is defined for the receiver we have, it likely wasn't `use`d.\n+                    // We point at the method, but we just skip the rest of the check for arbitrary\n+                    // self types and rely on the suggestion to `use` the trait from\n+                    // `suggest_valid_traits`.\n+                    let did = Some(pick.item.container.id());\n+                    let skip = skippable.contains(&did);\n+                    if pick.autoderefs == 0 && !skip {\n+                        err.span_label(\n+                            pick.item.ident.span,\n+                            &format!(\"the method is available for `{}` here\", rcvr_ty),\n+                        );\n+                    }\n+                    break;\n+                }\n                 for (rcvr_ty, pre) in &[\n                     (self.tcx.mk_lang_item(rcvr_ty, LangItem::OwnedBox), \"Box::new\"),\n                     (self.tcx.mk_lang_item(rcvr_ty, LangItem::Pin), \"Pin::new\"),\n@@ -1015,13 +1042,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             // We don't want to suggest a container type when the missing\n                             // method is `.clone()` or `.deref()` otherwise we'd suggest\n                             // `Arc::new(foo).clone()`, which is far from what the user wants.\n-                            let skip = [\n-                                self.tcx.lang_items().clone_trait(),\n-                                self.tcx.lang_items().deref_trait(),\n-                                self.tcx.lang_items().deref_mut_trait(),\n-                                self.tcx.lang_items().drop_trait(),\n-                            ]\n-                            .contains(&did);\n+                            let skip = skippable.contains(&did);\n                             // Make sure the method is defined for the *actual* receiver: we don't\n                             // want to treat `Box<Self>` as a receiver if it only works because of\n                             // an autoderef to `&self`"}, {"sha": "2913a955dce1b2cf37ff2c61d62528093fb1f549", "filename": "src/test/ui/hygiene/trait_items.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fhygiene%2Ftrait_items.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fhygiene%2Ftrait_items.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fhygiene%2Ftrait_items.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -1,6 +1,9 @@\n error[E0599]: no method named `f` found for unit type `()` in the current scope\n   --> $DIR/trait_items.rs:17:24\n    |\n+LL |         fn f(&self) {}\n+   |            - the method is available for `()` here\n+...\n LL |     fn f() { ::baz::m!(); }\n    |              ------------ in this macro invocation\n ..."}, {"sha": "b993115502fd5f8cde39577ec156aa9a5e18824c", "filename": "src/test/ui/impl-trait/no-method-suggested-traits.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fimpl-trait%2Fno-method-suggested-traits.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fimpl-trait%2Fno-method-suggested-traits.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fno-method-suggested-traits.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -37,6 +37,9 @@ LL | use no_method_suggested_traits::Reexported;\n error[E0599]: no method named `method` found for type `char` in the current scope\n   --> $DIR/no-method-suggested-traits.rs:30:9\n    |\n+LL |         fn method(&self) {}\n+   |            ------ the method is available for `char` here\n+...\n LL |     'a'.method();\n    |         ^^^^^^ method not found in `char`\n    |\n@@ -63,6 +66,11 @@ error[E0599]: no method named `method` found for type `i32` in the current scope\n    |\n LL |     1i32.method();\n    |          ^^^^^^ method not found in `i32`\n+   | \n+  ::: $DIR/auxiliary/no_method_suggested_traits.rs:8:12\n+   |\n+LL |         fn method(&self) {}\n+   |            ------ the method is available for `i32` here\n    |\n    = help: items from traits can only be used if the trait is in scope\n help: the following trait is implemented but not in scope; perhaps add a `use` for it:"}, {"sha": "3a3767c349d651a65d7dd877b67aa1198de0005d", "filename": "src/test/ui/issues/issue-43189.stderr", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fissues%2Fissue-43189.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fissues%2Fissue-43189.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-43189.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -3,6 +3,11 @@ error[E0599]: no method named `a` found for unit type `()` in the current scope\n    |\n LL |     ().a();\n    |        ^ method not found in `()`\n+   | \n+  ::: $DIR/auxiliary/xcrate-issue-43189-a.rs:5:8\n+   |\n+LL |     fn a(&self) {}\n+   |        - the method is available for `()` here\n    |\n    = help: items from traits can only be used if the trait is in scope\n help: the following trait is implemented but not in scope; perhaps add a `use` for it:"}, {"sha": "e6b0fffce663dae0044dc9299e3126767d43178a", "filename": "src/test/ui/issues/issue-56175.stderr", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fissues%2Fissue-56175.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fissues%2Fissue-56175.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-56175.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -3,6 +3,11 @@ error[E0599]: no method named `trait_method` found for struct `FooStruct` in the\n    |\n LL |     reexported_trait::FooStruct.trait_method();\n    |                                 ^^^^^^^^^^^^ method not found in `FooStruct`\n+   | \n+  ::: $DIR/auxiliary/reexported-trait.rs:3:12\n+   |\n+LL |         fn trait_method(&self) {\n+   |            ------------ the method is available for `FooStruct` here\n    |\n    = help: items from traits can only be used if the trait is in scope\n help: the following trait is implemented but not in scope; perhaps add a `use` for it:\n@@ -15,6 +20,11 @@ error[E0599]: no method named `trait_method_b` found for struct `FooStruct` in t\n    |\n LL |     reexported_trait::FooStruct.trait_method_b();\n    |                                 ^^^^^^^^^^^^^^ method not found in `FooStruct`\n+   | \n+  ::: $DIR/auxiliary/reexported-trait.rs:7:12\n+   |\n+LL |         fn trait_method_b(&self) {\n+   |            -------------- the method is available for `FooStruct` here\n    |\n    = help: items from traits can only be used if the trait is in scope\n help: the following trait is implemented but not in scope; perhaps add a `use` for it:"}, {"sha": "2cf5a073fe5c22334a30fb79d4f5b1c06f826b5f", "filename": "src/test/ui/rust-2018/trait-import-suggestions.stderr", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Frust-2018%2Ftrait-import-suggestions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Frust-2018%2Ftrait-import-suggestions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Ftrait-import-suggestions.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -1,6 +1,9 @@\n error[E0599]: no method named `foobar` found for type `u32` in the current scope\n   --> $DIR/trait-import-suggestions.rs:22:11\n    |\n+LL |             fn foobar(&self) { }\n+   |                ------ the method is available for `u32` here\n+...\n LL |         x.foobar();\n    |           ^^^^^^ method not found in `u32`\n    |\n@@ -11,6 +14,9 @@ LL |         x.foobar();\n error[E0599]: no method named `bar` found for type `u32` in the current scope\n   --> $DIR/trait-import-suggestions.rs:28:7\n    |\n+LL |         fn bar(&self) { }\n+   |            --- the method is available for `u32` here\n+...\n LL |     x.bar();\n    |       ^^^ method not found in `u32`\n    |"}, {"sha": "c3b9084affdb3cbabf6f24cd57e1adeee6414d52", "filename": "src/test/ui/shadowed/shadowed-trait-methods.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fshadowed%2Fshadowed-trait-methods.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fshadowed%2Fshadowed-trait-methods.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fshadowed%2Fshadowed-trait-methods.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -1,6 +1,9 @@\n error[E0599]: no method named `f` found for unit type `()` in the current scope\n   --> $DIR/shadowed-trait-methods.rs:13:8\n    |\n+LL |     pub trait T { fn f(&self) {} }\n+   |                      - the method is available for `()` here\n+...\n LL |     ().f()\n    |        ^ method not found in `()`\n    |"}, {"sha": "f3ae20552f3d53c2293d1d0300f1aa71f01370e6", "filename": "src/test/ui/suggestions/import-trait-for-method-call.stderr", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fsuggestions%2Fimport-trait-for-method-call.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Fsuggestions%2Fimport-trait-for-method-call.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fimport-trait-for-method-call.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -7,20 +7,9 @@ LL |     h.finish()\n   ::: $SRC_DIR/core/src/hash/mod.rs:LL:COL\n    |\n LL |     fn finish(&self) -> u64;\n-   |        ------\n-   |        |\n-   |        the method is available for `Box<DefaultHasher>` here\n-   |        the method is available for `Box<&mut DefaultHasher>` here\n+   |        ------ the method is available for `DefaultHasher` here\n    |\n    = help: items from traits can only be used if the trait is in scope\n-help: consider wrapping the receiver expression with the appropriate type\n-   |\n-LL |     Box::new(h).finish()\n-   |     ^^^^^^^^^ ^\n-help: consider wrapping the receiver expression with the appropriate type\n-   |\n-LL |     Box::new(&mut h).finish()\n-   |     ^^^^^^^^^^^^^  ^\n help: the following trait is implemented but not in scope; perhaps add a `use` for it:\n    |\n LL | use std::hash::Hasher;"}, {"sha": "30daf8e27702441b0504987446bc7d6c30d70a38", "filename": "src/test/ui/traits/item-privacy.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Ftraits%2Fitem-privacy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb1fb7d2ef45760bfe133381286dc750fe51e49e/src%2Ftest%2Fui%2Ftraits%2Fitem-privacy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fitem-privacy.stderr?ref=fb1fb7d2ef45760bfe133381286dc750fe51e49e", "patch": "@@ -20,6 +20,9 @@ error[E0599]: no method named `b` found for struct `S` in the current scope\n LL | struct S;\n    | --------- method `b` not found for this\n ...\n+LL |         fn b(&self) { }\n+   |            - the method is available for `S` here\n+...\n LL |     S.b();\n    |       ^ method not found in `S`\n    |"}]}