{"sha": "3125a307596db12d8b014da330373446dda5d7ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMxMjVhMzA3NTk2ZGIxMmQ4YjAxNGRhMzMwMzczNDQ2ZGRhNWQ3Y2E=", "commit": {"author": {"name": "gnzlbg", "email": "gonzalobg88@gmail.com", "date": "2018-03-15T09:08:22Z"}, "committer": {"name": "gnzlbg", "email": "gonzalobg88@gmail.com", "date": "2018-03-15T09:08:22Z"}, "message": "error on vector reduction usage if LLVM version is < 5.0", "tree": {"sha": "530ab56cc7c2708b73837f50c386849bde1f7af7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/530ab56cc7c2708b73837f50c386849bde1f7af7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3125a307596db12d8b014da330373446dda5d7ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3125a307596db12d8b014da330373446dda5d7ca", "html_url": "https://github.com/rust-lang/rust/commit/3125a307596db12d8b014da330373446dda5d7ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3125a307596db12d8b014da330373446dda5d7ca/comments", "author": {"login": "gnzlbg", "id": 904614, "node_id": "MDQ6VXNlcjkwNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gnzlbg", "html_url": "https://github.com/gnzlbg", "followers_url": "https://api.github.com/users/gnzlbg/followers", "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}", "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions", "organizations_url": "https://api.github.com/users/gnzlbg/orgs", "repos_url": "https://api.github.com/users/gnzlbg/repos", "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}", "received_events_url": "https://api.github.com/users/gnzlbg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gnzlbg", "id": 904614, "node_id": "MDQ6VXNlcjkwNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gnzlbg", "html_url": "https://github.com/gnzlbg", "followers_url": "https://api.github.com/users/gnzlbg/followers", "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}", "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions", "organizations_url": "https://api.github.com/users/gnzlbg/orgs", "repos_url": "https://api.github.com/users/gnzlbg/repos", "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}", "received_events_url": "https://api.github.com/users/gnzlbg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c990fa0d880586d85e191b0691a415f9180f4e61", "url": "https://api.github.com/repos/rust-lang/rust/commits/c990fa0d880586d85e191b0691a415f9180f4e61", "html_url": "https://github.com/rust-lang/rust/commit/c990fa0d880586d85e191b0691a415f9180f4e61"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "cd3ae1e743bf811594885b00d35dcaefe53c26f0", "filename": "src/rustllvm/RustWrapper.cpp", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/3125a307596db12d8b014da330373446dda5d7ca/src%2Frustllvm%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/3125a307596db12d8b014da330373446dda5d7ca/src%2Frustllvm%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustWrapper.cpp?ref=3125a307596db12d8b014da330373446dda5d7ca", "patch": "@@ -21,6 +21,8 @@\n \n #if LLVM_VERSION_GE(5, 0)\n #include \"llvm/ADT/Optional.h\"\n+#else\n+#include <cstdlib>\n #endif\n \n //===----------------------------------------------------------------------===\n@@ -1397,7 +1399,7 @@ LLVMRustModuleCost(LLVMModuleRef M) {\n }\n \n // Vector reductions:\n-#if LLVM_VERSION_GE(6, 0)\n+#if LLVM_VERSION_GE(5, 0)\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceFAdd(LLVMBuilderRef B, LLVMValueRef Acc, LLVMValueRef Src) {\n     return wrap(unwrap(B)->CreateFAddReduce(unwrap(Acc),unwrap(Src)));\n@@ -1445,48 +1447,65 @@ LLVMRustBuildVectorReduceFMax(LLVMBuilderRef B, LLVMValueRef Src, bool NoNaN) {\n \n #else\n \n+void error_and_exit(const char* msg) {\n+  raw_fd_ostream OS(2, false);\n+  OS << ::std::string(msg);\n+  std::exit(EXIT_FAILURE);\n+}\n+\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceFAdd(LLVMBuilderRef, LLVMValueRef, LLVMValueRef Src) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceFAdd requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceFMul(LLVMBuilderRef, LLVMValueRef, LLVMValueRef Src) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceFMul requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceAdd(LLVMBuilderRef, LLVMValueRef Src) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceAdd requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceMul(LLVMBuilderRef, LLVMValueRef Src) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceMul requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceAnd(LLVMBuilderRef, LLVMValueRef Src) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceAnd requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceOr(LLVMBuilderRef, LLVMValueRef Src) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceOr requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceXor(LLVMBuilderRef, LLVMValueRef Src) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceXor requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceMin(LLVMBuilderRef, LLVMValueRef Src, bool) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceMin requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceMax(LLVMBuilderRef, LLVMValueRef Src, bool) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceMax requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceFMin(LLVMBuilderRef, LLVMValueRef Src, bool) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceFMin requires LLVM >= 5.0\");\n   return Src;\n }\n extern \"C\" LLVMValueRef\n LLVMRustBuildVectorReduceFMax(LLVMBuilderRef, LLVMValueRef Src, bool) {\n+  error_and_exit(\"LLVMRustBuildVectorReduceFMax requires LLVM >= 5.0\");\n   return Src;\n }\n #endif"}]}