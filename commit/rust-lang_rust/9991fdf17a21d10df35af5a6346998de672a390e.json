{"sha": "9991fdf17a21d10df35af5a6346998de672a390e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5OTFmZGYxN2EyMWQxMGRmMzVhZjVhNjM0Njk5OGRlNjcyYTM5MGU=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2017-12-30T21:44:22Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2017-12-30T21:55:59Z"}, "message": "Fix nested imports not included in the save_analysis output", "tree": {"sha": "e4c4218c4e36168eebe83946424d6f883f3f3bba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4c4218c4e36168eebe83946424d6f883f3f3bba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9991fdf17a21d10df35af5a6346998de672a390e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQEcBAABCAAGBQJaSAt0AAoJEOjBBC3RYkUZ65cH/0RAA5NBTBJgW3PqNACWknB6\nUjARD56Er7L8wIzxAR/X4vve5LLADxIF1nBceVcTO7WYr4Yg7km8SbBZIYrJMpku\n5e3B83x0Dm1HRlQg9w1QWj/Hk0WLyuRDBsrm8hzOxRT8k2B3uXbcpilfHYxyib+z\nDSN85mR90cambA3xaaoiqYfGELsxfRIF6Ilyh4IAsJE6osV4Tvu1C/VMxhlKGIjE\nzs8EDt+S7NtqEumnLq25ShCrBMH9YdXkC75/iwzCl7Vej1cWni9RvMDajyJsrAZs\n4njsNzm07SPa6++2qZtHFpM1V1XD+GEp9K38GODkZJd/kHrQ/w3dTgalQ7sykIA=\n=1Vvu\n-----END PGP SIGNATURE-----", "payload": "tree e4c4218c4e36168eebe83946424d6f883f3f3bba\nparent f0e5c953e4be3b5aee49cdcc0b1c244681392961\nauthor Pietro Albini <pietro@pietroalbini.org> 1514670262 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1514670959 +0100\n\nFix nested imports not included in the save_analysis output\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9991fdf17a21d10df35af5a6346998de672a390e", "html_url": "https://github.com/rust-lang/rust/commit/9991fdf17a21d10df35af5a6346998de672a390e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9991fdf17a21d10df35af5a6346998de672a390e/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0e5c953e4be3b5aee49cdcc0b1c244681392961", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0e5c953e4be3b5aee49cdcc0b1c244681392961", "html_url": "https://github.com/rust-lang/rust/commit/f0e5c953e4be3b5aee49cdcc0b1c244681392961"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "808bd2a22e8a2ef03ba3fef45bfa66580dac9cf7", "filename": "src/librustc_save_analysis/dump_visitor.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9991fdf17a21d10df35af5a6346998de672a390e/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9991fdf17a21d10df35af5a6346998de672a390e/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Fdump_visitor.rs?ref=9991fdf17a21d10df35af5a6346998de672a390e", "patch": "@@ -1252,7 +1252,13 @@ impl<'l, 'tcx: 'l, 'll, O: DumpOutput + 'll> DumpVisitor<'l, 'tcx, 'll, O> {\n                          root_item: &'l ast::Item,\n                          prefix: &ast::Path) {\n         let path = &use_tree.prefix;\n-        let access = access_from!(self.save_ctxt, root_item);\n+\n+        // The access is calculated using the current tree ID, but with the root tree's visibility\n+        // (since nested trees don't have their own visibility).\n+        let access = Access {\n+            public: root_item.vis == ast::Visibility::Public,\n+            reachable: self.save_ctxt.analysis.access_levels.is_reachable(id),\n+        };\n \n         // The parent def id of a given use tree is always the enclosing item.\n         let parent = self.save_ctxt.tcx.hir.opt_local_def_id(id)"}]}