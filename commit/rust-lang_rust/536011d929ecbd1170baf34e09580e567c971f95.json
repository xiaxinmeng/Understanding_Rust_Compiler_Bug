{"sha": "536011d929ecbd1170baf34e09580e567c971f95", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzNjAxMWQ5MjllY2JkMTE3MGJhZjM0ZTA5NTgwZTU2N2M5NzFmOTU=", "commit": {"author": {"name": "Shiz", "email": "hi@shiz.me", "date": "2017-04-08T18:36:00Z"}, "committer": {"name": "Shiz", "email": "hi@shiz.me", "date": "2017-04-08T20:28:32Z"}, "message": "Fix jemalloc support for musl\n\nJust like DragonFlyBSD, using the same symbols as the system allocator will\nresult in a segmentation fault at runtime due to allocator mismatches.\nAs such, prefix the jemalloc symbols instead.", "tree": {"sha": "7e93c8534833baa58f6baa6399d0b8bca61e666f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e93c8534833baa58f6baa6399d0b8bca61e666f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/536011d929ecbd1170baf34e09580e567c971f95", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/536011d929ecbd1170baf34e09580e567c971f95", "html_url": "https://github.com/rust-lang/rust/commit/536011d929ecbd1170baf34e09580e567c971f95", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/536011d929ecbd1170baf34e09580e567c971f95/comments", "author": {"login": "Shizmob", "id": 763230, "node_id": "MDQ6VXNlcjc2MzIzMA==", "avatar_url": "https://avatars.githubusercontent.com/u/763230?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Shizmob", "html_url": "https://github.com/Shizmob", "followers_url": "https://api.github.com/users/Shizmob/followers", "following_url": "https://api.github.com/users/Shizmob/following{/other_user}", "gists_url": "https://api.github.com/users/Shizmob/gists{/gist_id}", "starred_url": "https://api.github.com/users/Shizmob/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Shizmob/subscriptions", "organizations_url": "https://api.github.com/users/Shizmob/orgs", "repos_url": "https://api.github.com/users/Shizmob/repos", "events_url": "https://api.github.com/users/Shizmob/events{/privacy}", "received_events_url": "https://api.github.com/users/Shizmob/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Shizmob", "id": 763230, "node_id": "MDQ6VXNlcjc2MzIzMA==", "avatar_url": "https://avatars.githubusercontent.com/u/763230?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Shizmob", "html_url": "https://github.com/Shizmob", "followers_url": "https://api.github.com/users/Shizmob/followers", "following_url": "https://api.github.com/users/Shizmob/following{/other_user}", "gists_url": "https://api.github.com/users/Shizmob/gists{/gist_id}", "starred_url": "https://api.github.com/users/Shizmob/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Shizmob/subscriptions", "organizations_url": "https://api.github.com/users/Shizmob/orgs", "repos_url": "https://api.github.com/users/Shizmob/repos", "events_url": "https://api.github.com/users/Shizmob/events{/privacy}", "received_events_url": "https://api.github.com/users/Shizmob/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a61011761deeab9e308e6d103b1dc7aaf334f6e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/a61011761deeab9e308e6d103b1dc7aaf334f6e3", "html_url": "https://github.com/rust-lang/rust/commit/a61011761deeab9e308e6d103b1dc7aaf334f6e3"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "f3a0eebe6984d2a11ca73d93871b6c4314683c15", "filename": "src/liballoc_jemalloc/build.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/536011d929ecbd1170baf34e09580e567c971f95/src%2Fliballoc_jemalloc%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/536011d929ecbd1170baf34e09580e567c971f95/src%2Fliballoc_jemalloc%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_jemalloc%2Fbuild.rs?ref=536011d929ecbd1170baf34e09580e567c971f95", "patch": "@@ -129,7 +129,7 @@ fn main() {\n         // should be good to go!\n         cmd.arg(\"--with-jemalloc-prefix=je_\");\n         cmd.arg(\"--disable-tls\");\n-    } else if target.contains(\"dragonfly\") {\n+    } else if target.contains(\"dragonfly\") || target.contains(\"musl\") {\n         cmd.arg(\"--with-jemalloc-prefix=je_\");\n     }\n "}, {"sha": "83cc1ef09c29c2fdf93e1085a1dda309ec7879dd", "filename": "src/liballoc_jemalloc/lib.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/536011d929ecbd1170baf34e09580e567c971f95/src%2Fliballoc_jemalloc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/536011d929ecbd1170baf34e09580e567c971f95/src%2Fliballoc_jemalloc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_jemalloc%2Flib.rs?ref=536011d929ecbd1170baf34e09580e567c971f95", "patch": "@@ -35,23 +35,23 @@ mod imp {\n     // request it as unprefixing cause segfaults (mismatches in allocators).\n     extern \"C\" {\n         #[cfg_attr(any(target_os = \"macos\", target_os = \"android\", target_os = \"ios\",\n-                       target_os = \"dragonfly\", target_os = \"windows\"),\n+                       target_os = \"dragonfly\", target_os = \"windows\", target_env = \"musl\"),\n                    link_name = \"je_mallocx\")]\n         fn mallocx(size: size_t, flags: c_int) -> *mut c_void;\n         #[cfg_attr(any(target_os = \"macos\", target_os = \"android\", target_os = \"ios\",\n-                       target_os = \"dragonfly\", target_os = \"windows\"),\n+                       target_os = \"dragonfly\", target_os = \"windows\", target_env = \"musl\"),\n                    link_name = \"je_rallocx\")]\n         fn rallocx(ptr: *mut c_void, size: size_t, flags: c_int) -> *mut c_void;\n         #[cfg_attr(any(target_os = \"macos\", target_os = \"android\", target_os = \"ios\",\n-                       target_os = \"dragonfly\", target_os = \"windows\"),\n+                       target_os = \"dragonfly\", target_os = \"windows\", target_env = \"musl\"),\n                    link_name = \"je_xallocx\")]\n         fn xallocx(ptr: *mut c_void, size: size_t, extra: size_t, flags: c_int) -> size_t;\n         #[cfg_attr(any(target_os = \"macos\", target_os = \"android\", target_os = \"ios\",\n-                       target_os = \"dragonfly\", target_os = \"windows\"),\n+                       target_os = \"dragonfly\", target_os = \"windows\", target_env = \"musl\"),\n                    link_name = \"je_sdallocx\")]\n         fn sdallocx(ptr: *mut c_void, size: size_t, flags: c_int);\n         #[cfg_attr(any(target_os = \"macos\", target_os = \"android\", target_os = \"ios\",\n-                       target_os = \"dragonfly\", target_os = \"windows\"),\n+                       target_os = \"dragonfly\", target_os = \"windows\", target_env = \"musl\"),\n                    link_name = \"je_nallocx\")]\n         fn nallocx(size: size_t, flags: c_int) -> size_t;\n     }"}]}