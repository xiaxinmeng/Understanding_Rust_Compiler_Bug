{"sha": "4571feac44038752a43cebea632308e61697c3a5", "node_id": "C_kwDOAAsO6NoAKDQ1NzFmZWFjNDQwMzg3NTJhNDNjZWJlYTYzMjMwOGU2MTY5N2MzYTU", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-10-01T06:41:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-01T06:41:11Z"}, "message": "Rollup merge of #89412 - lqd:zvariant-repro, r=Aaron1011\n\nAdd regression test for issues #88969 and #89119\n\nThis adds a regression test to complete https://github.com/rust-lang/rust/pull/89125, and thus for issues #88969 and #89119, which needed a test.\n\nUsed with multiple crates, [this](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=f665e7e882059157e0f86cfb09c47187) minimized from `zvariant-2.8.0` reproduces the error on `nightly-2021-09-19`.\n\nThe test in this PR fails on master if the commit 6dbb9d4eee0a2789a74bb2d4b8228626f7cd741c from #89125 is reverted, and passes otherwise since it's now fixed.\n\nr? `@Aaron1011`", "tree": {"sha": "54efe0a2afa6042189299900a714e15f70ba754f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54efe0a2afa6042189299900a714e15f70ba754f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4571feac44038752a43cebea632308e61697c3a5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhVq2HCRBK7hj4Ov3rIwAAvg0IAC49bpJQ2yvvjGA8HMxfAZlK\nE46EzuVEbfnWDC9B1OQN/PxJi1qasMuqqTCQnL5OnrehFSAofTFZ1oqugjoyeuYs\nPOr8Mxls2Irt77BAIphKJc1ersIE9ugObKZ6T5Ik1UQQsX8vJCo+nP/MYb1C/Gy3\ndPMWqSRXrfN4tqwuPV2E/wzwhXOVVxEWG1LzSVchzFjf3a47PICk+IvC4+S1qo0P\nMffnNfzG0Xz45moNYpOZxvl6TGFwC6sMP7Gdxuv7HjLPPPY9YndUlrNu8hpkFIOG\nELs/r2cWkKQX27Ss6KNQY5LTENNwJdPhC7zJ9lXSQJxQPdTHCwdbwSVhuqa2ZhQ=\n=pAH0\n-----END PGP SIGNATURE-----\n", "payload": "tree 54efe0a2afa6042189299900a714e15f70ba754f\nparent e834b9d9a036d5ec9148348ec55677880c338b79\nparent bec19a72dda2c9e3251ed606e1a017d957b2e8f9\nauthor Manish Goregaokar <manishsmail@gmail.com> 1633070471 -0700\ncommitter GitHub <noreply@github.com> 1633070471 -0700\n\nRollup merge of #89412 - lqd:zvariant-repro, r=Aaron1011\n\nAdd regression test for issues #88969 and #89119\n\nThis adds a regression test to complete https://github.com/rust-lang/rust/pull/89125, and thus for issues #88969 and #89119, which needed a test.\n\nUsed with multiple crates, [this](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=f665e7e882059157e0f86cfb09c47187) minimized from `zvariant-2.8.0` reproduces the error on `nightly-2021-09-19`.\n\nThe test in this PR fails on master if the commit 6dbb9d4eee0a2789a74bb2d4b8228626f7cd741c from #89125 is reverted, and passes otherwise since it's now fixed.\n\nr? `@Aaron1011`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4571feac44038752a43cebea632308e61697c3a5", "html_url": "https://github.com/rust-lang/rust/commit/4571feac44038752a43cebea632308e61697c3a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4571feac44038752a43cebea632308e61697c3a5/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e834b9d9a036d5ec9148348ec55677880c338b79", "url": "https://api.github.com/repos/rust-lang/rust/commits/e834b9d9a036d5ec9148348ec55677880c338b79", "html_url": "https://github.com/rust-lang/rust/commit/e834b9d9a036d5ec9148348ec55677880c338b79"}, {"sha": "bec19a72dda2c9e3251ed606e1a017d957b2e8f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/bec19a72dda2c9e3251ed606e1a017d957b2e8f9", "html_url": "https://github.com/rust-lang/rust/commit/bec19a72dda2c9e3251ed606e1a017d957b2e8f9"}], "stats": {"total": 71, "additions": 71, "deletions": 0}, "files": [{"sha": "769e897316327245d77caf3ab3aa7f023288b478", "filename": "src/test/ui/traits/auxiliary/issue_89119_intercrate_caching.rs", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/4571feac44038752a43cebea632308e61697c3a5/src%2Ftest%2Fui%2Ftraits%2Fauxiliary%2Fissue_89119_intercrate_caching.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4571feac44038752a43cebea632308e61697c3a5/src%2Ftest%2Fui%2Ftraits%2Fauxiliary%2Fissue_89119_intercrate_caching.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fauxiliary%2Fissue_89119_intercrate_caching.rs?ref=4571feac44038752a43cebea632308e61697c3a5", "patch": "@@ -0,0 +1,60 @@\n+// This is the auxiliary crate for the regression test for issue #89119, minimized\n+// from `zvariant-2.8.0`.\n+\n+use std::convert::TryFrom;\n+use std::borrow::Cow;\n+\n+pub struct Str<'a>(Cow<'a, str>);\n+impl<'a> Str<'a> {\n+    pub fn to_owned(&self) -> Str<'static> {\n+        todo!()\n+    }\n+}\n+\n+pub enum Value<'a> {\n+    Str(Str<'a>),\n+    Value(Box<Value<'a>>),\n+}\n+impl<'a> Value<'a> {\n+    pub fn to_owned(&self) -> Value<'static> {\n+        match self {\n+            Value::Str(v) => Value::Str(v.to_owned()),\n+            Value::Value(v) => {\n+                let o = OwnedValue::from(&**v);\n+                Value::Value(Box::new(o.into_inner()))\n+            }\n+        }\n+    }\n+}\n+\n+struct OwnedValue(Value<'static>);\n+impl OwnedValue {\n+    pub(crate) fn into_inner(self) -> Value<'static> {\n+        todo!()\n+    }\n+}\n+impl<'a, T> TryFrom<OwnedValue> for Vec<T>\n+where\n+    T: TryFrom<Value<'a>, Error = ()>,\n+{\n+    type Error = ();\n+    fn try_from(_: OwnedValue) -> Result<Self, Self::Error> {\n+        todo!()\n+    }\n+}\n+impl TryFrom<OwnedValue> for Vec<OwnedValue> {\n+    type Error = ();\n+    fn try_from(_: OwnedValue) -> Result<Self, Self::Error> {\n+        todo!()\n+    }\n+}\n+impl<'a> From<Value<'a>> for OwnedValue {\n+    fn from(_: Value<'a>) -> Self {\n+        todo!()\n+    }\n+}\n+impl<'a> From<&Value<'a>> for OwnedValue {\n+    fn from(_: &Value<'a>) -> Self {\n+        todo!()\n+    }\n+}"}, {"sha": "170f69915e2abbfb0765a8faf908ecf0a598fb4c", "filename": "src/test/ui/traits/issue-89119.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/4571feac44038752a43cebea632308e61697c3a5/src%2Ftest%2Fui%2Ftraits%2Fissue-89119.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4571feac44038752a43cebea632308e61697c3a5/src%2Ftest%2Fui%2Ftraits%2Fissue-89119.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fissue-89119.rs?ref=4571feac44038752a43cebea632308e61697c3a5", "patch": "@@ -0,0 +1,11 @@\n+// This is a regression test for issue #89119: an issue in intercrate mode caching.\n+//\n+// It requires multiple crates, of course, but the bug is triggered by the code in the dependency,\n+// not the main crate. This is why this file is empty.\n+//\n+// The auxiliary crate used in the test contains the code minimized from `zvariant-2.8.0`.\n+\n+// check-pass\n+// aux-build: issue_89119_intercrate_caching.rs\n+\n+fn main() {}"}]}