{"sha": "2b64cb294c7ceae003694e663458025a79f11da4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJiNjRjYjI5NGM3Y2VhZTAwMzY5NGU2NjM0NTgwMjVhNzlmMTFkYTQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-02-16T05:47:28Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-02-17T01:36:43Z"}, "message": "Address review feedback", "tree": {"sha": "6f889a70a4a6cfd85a422b17b67a0d8554b274ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f889a70a4a6cfd85a422b17b67a0d8554b274ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2b64cb294c7ceae003694e663458025a79f11da4", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2b64cb294c7ceae003694e663458025a79f11da4", "html_url": "https://github.com/rust-lang/rust/commit/2b64cb294c7ceae003694e663458025a79f11da4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2b64cb294c7ceae003694e663458025a79f11da4/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "508cb29dc4358a625afaa83dce8a9853864999f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/508cb29dc4358a625afaa83dce8a9853864999f2", "html_url": "https://github.com/rust-lang/rust/commit/508cb29dc4358a625afaa83dce8a9853864999f2"}], "stats": {"total": 70, "additions": 41, "deletions": 29}, "files": [{"sha": "dbb349fcf3a739abe597d91ce62ea895b0dbf0d7", "filename": "mk/install.mk", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2b64cb294c7ceae003694e663458025a79f11da4/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/2b64cb294c7ceae003694e663458025a79f11da4/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=2b64cb294c7ceae003694e663458025a79f11da4", "patch": "@@ -16,7 +16,7 @@\n ISTAGE = 2\n \n install: PREPARE_HOST=$(CFG_BUILD)\n-install: PREPARE_TARGETS=$(CFG_BUILD)\n+install: PREPARE_TARGETS=$(CFG_TARGET)\n install: PREPARE_STAGE=$(ISTAGE)\n install: PREPARE_DIR_CMD=$(DEFAULT_PREPARE_DIR_CMD)\n install: PREPARE_BIN_CMD=$(DEFAULT_PREPARE_BIN_CMD)\n@@ -26,9 +26,9 @@ install: PREPARE_SOURCE_DIR=$(PREPARE_HOST)/stage$(PREPARE_STAGE)\n install: PREPARE_SOURCE_BIN_DIR=$(PREPARE_SOURCE_DIR)/bin\n install: PREPARE_SOURCE_LIB_DIR=$(PREPARE_SOURCE_DIR)/$(CFG_LIBDIR_RELATIVE)\n install: PREPARE_SOURCE_MAN_DIR=$(S)/man\n-install: PREPARE_DEST_BIN_DIR=$(CFG_PREFIX)/bin\n-install: PREPARE_DEST_LIB_DIR=$(CFG_LIBDIR)\n-install: PREPARE_DEST_MAN_DIR=$(CFG_MANDIR)/man1\n+install: PREPARE_DEST_BIN_DIR=$(DESTDIR)$(CFG_PREFIX)/bin\n+install: PREPARE_DEST_LIB_DIR=$(DESTDIR)$(CFG_LIBDIR)\n+install: PREPARE_DEST_MAN_DIR=$(DESTDIR)$(CFG_MANDIR)/man1\n install: prepare-everything\n \n "}, {"sha": "361b9c7ea9b453eaff5528d77bdcea424cf9a5ae", "filename": "mk/prepare.mk", "status": "modified", "additions": 36, "deletions": 25, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/2b64cb294c7ceae003694e663458025a79f11da4/mk%2Fprepare.mk", "raw_url": "https://github.com/rust-lang/rust/raw/2b64cb294c7ceae003694e663458025a79f11da4/mk%2Fprepare.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fprepare.mk?ref=2b64cb294c7ceae003694e663458025a79f11da4", "patch": "@@ -47,9 +47,9 @@ DEFAULT_PREPARE_MAN_CMD = install -m755\n # Because of the way these rules are organized, preparing from any\n # stage requires all these stages to be built\n ifdef CFG_WINDOWSY_$(CFG_BUILD)\n-PREPARE_STAGES=1 2 3\n+PREPARE_STAGES=3\n else\n-PREPARE_STAGES=1 2\n+PREPARE_STAGES=2\n endif\n \n # Create a directory\n@@ -98,25 +98,26 @@ endef\n \n PREPARE_TOOLS = $(filter-out compiletest, $(TOOLS))\n \n-prepare-host: prepare-host-dirs prepare-host-tools\n+prepare-host: prepare-host-tools\n \n-prepare-host-dirs:\n-\t$(call PREPARE_DIR,$(PREPARE_DEST_BIN_DIR))\n-\t$(call PREPARE_DIR,$(PREPARE_DEST_LIB_DIR))\n-\t$(call PREPARE_DIR,$(PREPARE_DEST_MAN_DIR))\n-\n-prepare-host-tools:\\\n+prepare-host-tools: \\\n         $(foreach tool, $(PREPARE_TOOLS),\\\n           $(foreach stage,$(PREPARE_STAGES),\\\n             $(foreach host,$(CFG_HOST),\\\n               prepare-host-tool-$(tool)-$(stage)-$(host))))\n \n+prepare-host-dirs:\n+\t$(call PREPARE_DIR,$(PREPARE_DEST_BIN_DIR))\n+\t$(call PREPARE_DIR,$(PREPARE_DEST_LIB_DIR))\n+\t$(call PREPARE_DIR,$(PREPARE_DEST_MAN_DIR))\n+\n # $(1) is tool\n # $(2) is stage\n # $(3) is host\n define DEF_PREPARE_HOST_TOOL\n prepare-host-tool-$(1)-$(2)-$(3): $$(foreach dep,$$(TOOL_DEPS_$(1)),prepare-host-lib-$$(dep)-$(2)-$(3)) \\\n-                                  $$(HBIN$(2)_H_$(3))/$(1)$$(X_$(3))\n+                                  $$(HBIN$(2)_H_$(3))/$(1)$$(X_$(3)) \\\n+                                  prepare-host-dirs\n \t$$(if $$(findstring $(2), $$(PREPARE_STAGE)),\\\n       $$(if $$(findstring $(3), $$(PREPARE_HOST)),\\\n         $$(call PREPARE_BIN,$(1)$$(X_$$(PREPARE_HOST))),),)\n@@ -130,14 +131,18 @@ $(foreach tool,$(PREPARE_TOOLS),\\\n     $(foreach host,$(CFG_HOST),\\\n         $(eval $(call DEF_PREPARE_HOST_TOOL,$(tool),$(stage),$(host))))))\n \n+# For host libraries only install dylibs, not rlibs since the host libs are only\n+# used to support rustc and rustc uses dynamic linking\n+#\n # $(1) is tool\n # $(2) is stage\n # $(3) is host\n define DEF_PREPARE_HOST_LIB\n prepare-host-lib-$(1)-$(2)-$(3): PREPARE_WORKING_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_LIB_DIR)\n prepare-host-lib-$(1)-$(2)-$(3): PREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_LIB_DIR)\n prepare-host-lib-$(1)-$(2)-$(3): $$(foreach dep,$$(RUST_DEPS_$(1)),prepare-host-lib-$$(dep)-$(2)-$(3))\\\n-                                 $$(HLIB$(2)_H_$(3))/stamp.$(1)\n+                                 $$(HLIB$(2)_H_$(3))/stamp.$(1) \\\n+                                 prepare-host-dirs\n \t$$(if $$(findstring $(2), $$(PREPARE_STAGE)),\\\n       $$(if $$(findstring $(3), $$(PREPARE_HOST)),\\\n         $$(call PREPARE_LIB,$$(call CFG_LIB_GLOB_$$(PREPARE_HOST),$(1))),),)\n@@ -154,30 +159,36 @@ prepare-targets:\\\n              $(foreach stage,$(PREPARE_STAGES),\\\n                prepare-target-$(target)-host-$(host)-$(stage))))\n \n-# $(1) is target\n-# $(2) is host\n-# $(3) is stage\n+# $(1) is stage\n+# $(2) is target\n+# $(3) is host\n define DEF_PREPARE_TARGET_N\n # Rebind PREPARE_*_LIB_DIR to point to rustlib, then install the libs for the targets\n-prepare-target-$(1)-host-$(2)-$(3): PREPARE_WORKING_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_LIB_DIR)/rustlib/$(1)/lib\n-prepare-target-$(1)-host-$(2)-$(3): PREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_LIB_DIR)/rustlib/$(1)/lib\n-prepare-target-$(1)-host-$(2)-$(3): \\\n+prepare-target-$(2)-host-$(3)-$(1): PREPARE_WORKING_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_LIB_DIR)/$$(CFG_RUSTLIBDIR)/$(2)/lib\n+prepare-target-$(2)-host-$(3)-$(1): PREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_LIB_DIR)/$$(CFG_RUSTLIBDIR)/$(2)/lib\n+prepare-target-$(2)-host-$(3)-$(1): \\\n         $$(foreach crate,$$(TARGET_CRATES), \\\n-          $$(TLIB$(3)_T_$(1)_H_$(2))/stamp.$$(crate))\n+          $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate)) \\\n+        $$(if $$(findstring $(2),$$(CFG_HOST)), \\\n+          $$(foreach crate,$$(HOST_CRATES), \\\n+            $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate)),)\n # Only install if this host and target combo is being prepared\n-\t$$(if $$(findstring $(2), $$(PREPARE_HOST)),\\\n-      $$(if $$(findstring $(1), $$(PREPARE_TARGETS)),\\\n-        $$(if $$(findstring $(3), $$(PREPARE_STAGE)),\\\n+\t$$(if $$(findstring $(1), $$(PREPARE_STAGE)),\\\n+      $$(if $$(findstring $(2), $$(PREPARE_TARGETS)),\\\n+        $$(if $$(findstring $(3), $$(PREPARE_HOST)),\\\n           $$(call PREPARE_DIR,$$(PREPARE_WORKING_DEST_LIB_DIR))\\\n           $$(foreach crate,$$(TARGET_CRATES),\\\n-            $$(call PREPARE_LIB,$$(call CFG_LIB_GLOB_$(1),$$(crate))))\\\n-          $$(foreach crate,$$(TARGET_CRATES),\\\n+            $$(call PREPARE_LIB,$$(call CFG_LIB_GLOB_$(2),$$(crate)))\\\n             $$(call PREPARE_LIB,$$(call CFG_RLIB_GLOB,$$(crate))))\\\n-          $$(call PREPARE_LIB,libmorestack.a)\n+          $$(if $$(findstring $(2),$$(CFG_HOST)),\\\n+            $$(foreach crate,$$(HOST_CRATES),\\\n+              $$(call PREPARE_LIB,$$(call CFG_LIB_GLOB_$(2),$$(crate)))\\\n+              $$(call PREPARE_LIB,$$(call CFG_RLIB_GLOB,$$(crate)))),)\\\n+          $$(call PREPARE_LIB,libmorestack.a) \\\n           $$(call PREPARE_LIB,libcompiler-rt.a),),),)\n endef\n \n $(foreach host,$(CFG_HOST),\\\n   $(foreach target,$(CFG_TARGET), \\\n     $(foreach stage,$(PREPARE_STAGES),\\\n-      $(eval $(call DEF_PREPARE_TARGET_N,$(target),$(host),$(stage))))))\n+      $(eval $(call DEF_PREPARE_TARGET_N,$(stage),$(target),$(host))))))"}, {"sha": "73e59c132ebabc71029c6111abe1c0b5b737789d", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2b64cb294c7ceae003694e663458025a79f11da4/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b64cb294c7ceae003694e663458025a79f11da4/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=2b64cb294c7ceae003694e663458025a79f11da4", "patch": "@@ -12,6 +12,7 @@\n #[desc = \"rustdoc, the Rust documentation extractor\"];\n #[license = \"MIT/ASL2\"];\n #[crate_type = \"dylib\"];\n+#[crate_type = \"rlib\"];\n \n #[feature(globs, struct_variant, managed_boxes)];\n "}]}