{"sha": "be454f056fc7637da6d1922c532d73831dc072db", "node_id": "C_kwDOAAsO6NoAKGJlNDU0ZjA1NmZjNzYzN2RhNmQxOTIyYzUzMmQ3MzgzMWRjMDcyZGI", "commit": {"author": {"name": "Arlo Siemsen", "email": "arsiem@microsoft.com", "date": "2021-10-14T17:26:42Z"}, "committer": {"name": "Arlo Siemsen", "email": "arsiem@microsoft.com", "date": "2022-02-23T16:31:10Z"}, "message": "Change `char` type in debuginfo to DW_ATE_UTF\n\nRust previously encoded the `char` type as DW_ATE_unsigned_char. The more\nappropriate encoding is DW_ATE_UTF.\n\nClang uses this same debug encoding for char32_t.\n\nThis fixes the display of `char` types in Windows debuggers as well as LLDB.", "tree": {"sha": "a8d034e32f662d7f5eaf355e1b011c0222bfa814", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a8d034e32f662d7f5eaf355e1b011c0222bfa814"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be454f056fc7637da6d1922c532d73831dc072db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be454f056fc7637da6d1922c532d73831dc072db", "html_url": "https://github.com/rust-lang/rust/commit/be454f056fc7637da6d1922c532d73831dc072db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be454f056fc7637da6d1922c532d73831dc072db/comments", "author": {"login": "arlosi", "id": 704597, "node_id": "MDQ6VXNlcjcwNDU5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/704597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arlosi", "html_url": "https://github.com/arlosi", "followers_url": "https://api.github.com/users/arlosi/followers", "following_url": "https://api.github.com/users/arlosi/following{/other_user}", "gists_url": "https://api.github.com/users/arlosi/gists{/gist_id}", "starred_url": "https://api.github.com/users/arlosi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arlosi/subscriptions", "organizations_url": "https://api.github.com/users/arlosi/orgs", "repos_url": "https://api.github.com/users/arlosi/repos", "events_url": "https://api.github.com/users/arlosi/events{/privacy}", "received_events_url": "https://api.github.com/users/arlosi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arlosi", "id": 704597, "node_id": "MDQ6VXNlcjcwNDU5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/704597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arlosi", "html_url": "https://github.com/arlosi", "followers_url": "https://api.github.com/users/arlosi/followers", "following_url": "https://api.github.com/users/arlosi/following{/other_user}", "gists_url": "https://api.github.com/users/arlosi/gists{/gist_id}", "starred_url": "https://api.github.com/users/arlosi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arlosi/subscriptions", "organizations_url": "https://api.github.com/users/arlosi/orgs", "repos_url": "https://api.github.com/users/arlosi/repos", "events_url": "https://api.github.com/users/arlosi/events{/privacy}", "received_events_url": "https://api.github.com/users/arlosi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c651ba8a542c7d89b271efbf024a31091c824f4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c651ba8a542c7d89b271efbf024a31091c824f4b", "html_url": "https://github.com/rust-lang/rust/commit/c651ba8a542c7d89b271efbf024a31091c824f4b"}], "stats": {"total": 13, "additions": 6, "deletions": 7}, "files": [{"sha": "4ca92b3efe098fc167698b59f2d7c5c0b04128fc", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/be454f056fc7637da6d1922c532d73831dc072db/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be454f056fc7637da6d1922c532d73831dc072db/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=be454f056fc7637da6d1922c532d73831dc072db", "patch": "@@ -87,7 +87,7 @@ const DW_ATE_signed: c_uint = 0x05;\n #[allow(non_upper_case_globals)]\n const DW_ATE_unsigned: c_uint = 0x07;\n #[allow(non_upper_case_globals)]\n-const DW_ATE_unsigned_char: c_uint = 0x08;\n+const DW_ATE_UTF: c_uint = 0x10;\n \n pub const UNKNOWN_LINE_NUMBER: c_uint = 0;\n pub const UNKNOWN_COLUMN_NUMBER: c_uint = 0;\n@@ -933,7 +933,7 @@ fn basic_type_metadata<'ll, 'tcx>(cx: &CodegenCx<'ll, 'tcx>, t: Ty<'tcx>) -> &'l\n         ty::Never => (\"!\", DW_ATE_unsigned),\n         ty::Tuple(elements) if elements.is_empty() => (\"()\", DW_ATE_unsigned),\n         ty::Bool => (\"bool\", DW_ATE_boolean),\n-        ty::Char => (\"char\", DW_ATE_unsigned_char),\n+        ty::Char => (\"char\", DW_ATE_UTF),\n         ty::Int(int_ty) if cpp_like_debuginfo => (int_ty.msvc_basic_name(), DW_ATE_signed),\n         ty::Uint(uint_ty) if cpp_like_debuginfo => (uint_ty.msvc_basic_name(), DW_ATE_unsigned),\n         ty::Float(float_ty) if cpp_like_debuginfo => (float_ty.msvc_basic_name(), DW_ATE_float),"}, {"sha": "07d33be2a071f29904ce79662fcf49e740769dd3", "filename": "src/test/debuginfo/basic-types.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/be454f056fc7637da6d1922c532d73831dc072db/src%2Ftest%2Fdebuginfo%2Fbasic-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be454f056fc7637da6d1922c532d73831dc072db/src%2Ftest%2Fdebuginfo%2Fbasic-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fbasic-types.rs?ref=be454f056fc7637da6d1922c532d73831dc072db", "patch": "@@ -104,7 +104,8 @@\n // cdb-check:b                : false [Type: bool]\n // cdb-command:dx i\n // cdb-check:i                : -1 [Type: [...]]\n-// The variable 'c' doesn't appear for some reason...\n+// cdb-command:dx c\n+// cdb-check:c                : 0x61 'a' [Type: char32_t]\n // cdb-command:dx i8\n // cdb-check:i8               : 68 [Type: char]\n // cdb-command:dx i16"}, {"sha": "b4bb7c146d9df20acde2dcf6fd463823d8d0b046", "filename": "src/test/debuginfo/borrowed-basic.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/be454f056fc7637da6d1922c532d73831dc072db/src%2Ftest%2Fdebuginfo%2Fborrowed-basic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be454f056fc7637da6d1922c532d73831dc072db/src%2Ftest%2Fdebuginfo%2Fborrowed-basic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fborrowed-basic.rs?ref=be454f056fc7637da6d1922c532d73831dc072db", "patch": "@@ -14,8 +14,7 @@\n // gdb-check:$2 = -1\n \n // gdb-command:print *char_ref\n-// gdbg-check:$3 = 97\n-// gdbr-check:$3 = 97 'a'\n+// gdb-check:$3 = 97\n \n // gdb-command:print *i8_ref\n // gdbg-check:$4 = 68 'D'"}, {"sha": "f38cbc10dd3acf8ca94194cf9a0d62c8cf4d4a6f", "filename": "src/test/debuginfo/borrowed-unique-basic.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/be454f056fc7637da6d1922c532d73831dc072db/src%2Ftest%2Fdebuginfo%2Fborrowed-unique-basic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be454f056fc7637da6d1922c532d73831dc072db/src%2Ftest%2Fdebuginfo%2Fborrowed-unique-basic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fborrowed-unique-basic.rs?ref=be454f056fc7637da6d1922c532d73831dc072db", "patch": "@@ -16,8 +16,7 @@\n // gdb-check:$2 = -1\n \n // gdb-command:print *char_ref\n-// gdbg-check:$3 = 97\n-// gdbr-check:$3 = 97 'a'\n+// gdb-check:$3 = 97\n \n // gdb-command:print/d *i8_ref\n // gdb-check:$4 = 68"}]}