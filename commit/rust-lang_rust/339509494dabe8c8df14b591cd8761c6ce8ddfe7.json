{"sha": "339509494dabe8c8df14b591cd8761c6ce8ddfe7", "node_id": "C_kwDOAAsO6NoAKDMzOTUwOTQ5NGRhYmU4YzhkZjE0YjU5MWNkODc2MWM2Y2U4ZGRmZTc", "commit": {"author": {"name": "klensy", "email": "klensy@users.noreply.github.com", "date": "2022-07-28T16:50:11Z"}, "committer": {"name": "klensy", "email": "klensy@users.noreply.github.com", "date": "2022-07-28T16:50:11Z"}, "message": "bootstrap: don't emit warn about duplicated deps with same/different features, if some of lists actually empty", "tree": {"sha": "04e6455389deff7ea7a3265c1fafbc72a841fa3b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04e6455389deff7ea7a3265c1fafbc72a841fa3b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/339509494dabe8c8df14b591cd8761c6ce8ddfe7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/339509494dabe8c8df14b591cd8761c6ce8ddfe7", "html_url": "https://github.com/rust-lang/rust/commit/339509494dabe8c8df14b591cd8761c6ce8ddfe7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/339509494dabe8c8df14b591cd8761c6ce8ddfe7/comments", "author": {"login": "klensy", "id": 1782831, "node_id": "MDQ6VXNlcjE3ODI4MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1782831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klensy", "html_url": "https://github.com/klensy", "followers_url": "https://api.github.com/users/klensy/followers", "following_url": "https://api.github.com/users/klensy/following{/other_user}", "gists_url": "https://api.github.com/users/klensy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klensy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klensy/subscriptions", "organizations_url": "https://api.github.com/users/klensy/orgs", "repos_url": "https://api.github.com/users/klensy/repos", "events_url": "https://api.github.com/users/klensy/events{/privacy}", "received_events_url": "https://api.github.com/users/klensy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "klensy", "id": 1782831, "node_id": "MDQ6VXNlcjE3ODI4MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1782831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klensy", "html_url": "https://github.com/klensy", "followers_url": "https://api.github.com/users/klensy/followers", "following_url": "https://api.github.com/users/klensy/following{/other_user}", "gists_url": "https://api.github.com/users/klensy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klensy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klensy/subscriptions", "organizations_url": "https://api.github.com/users/klensy/orgs", "repos_url": "https://api.github.com/users/klensy/repos", "events_url": "https://api.github.com/users/klensy/events{/privacy}", "received_events_url": "https://api.github.com/users/klensy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05e678ccca974a8d0c26991083fb4cf8fff84e74", "url": "https://api.github.com/repos/rust-lang/rust/commits/05e678ccca974a8d0c26991083fb4cf8fff84e74", "html_url": "https://github.com/rust-lang/rust/commit/05e678ccca974a8d0c26991083fb4cf8fff84e74"}], "stats": {"total": 52, "additions": 28, "deletions": 24}, "files": [{"sha": "06fa5039fdf9243cc4b5b62d7cdcd8381311699d", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 28, "deletions": 24, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/339509494dabe8c8df14b591cd8761c6ce8ddfe7/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/339509494dabe8c8df14b591cd8761c6ce8ddfe7/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=339509494dabe8c8df14b591cd8761c6ce8ddfe7", "patch": "@@ -158,34 +158,38 @@ impl Step for ToolBuild {\n                       a transitive dependency has different features activated \\\n                       than in a previous build:\\n\"\n             );\n-            eprintln!(\n-                \"the following dependencies are duplicated although they \\\n-                      have the same features enabled:\"\n-            );\n             let (same, different): (Vec<_>, Vec<_>) =\n                 duplicates.into_iter().partition(|(_, cur, prev)| cur.2 == prev.2);\n-            for (id, cur, prev) in same {\n-                eprintln!(\"  {}\", id);\n-                // same features\n-                eprintln!(\"    `{}` ({:?})\\n    `{}` ({:?})\", cur.0, cur.1, prev.0, prev.1);\n-            }\n-            eprintln!(\"the following dependencies have different features:\");\n-            for (id, cur, prev) in different {\n-                eprintln!(\"  {}\", id);\n-                let cur_features: HashSet<_> = cur.2.into_iter().collect();\n-                let prev_features: HashSet<_> = prev.2.into_iter().collect();\n-                eprintln!(\n-                    \"    `{}` additionally enabled features {:?} at {:?}\",\n-                    cur.0,\n-                    &cur_features - &prev_features,\n-                    cur.1\n-                );\n+            if !same.is_empty() {\n                 eprintln!(\n-                    \"    `{}` additionally enabled features {:?} at {:?}\",\n-                    prev.0,\n-                    &prev_features - &cur_features,\n-                    prev.1\n+                    \"the following dependencies are duplicated although they \\\n+                      have the same features enabled:\"\n                 );\n+                for (id, cur, prev) in same {\n+                    eprintln!(\"  {}\", id);\n+                    // same features\n+                    eprintln!(\"    `{}` ({:?})\\n    `{}` ({:?})\", cur.0, cur.1, prev.0, prev.1);\n+                }\n+            }\n+            if !different.is_empty() {\n+                eprintln!(\"the following dependencies have different features:\");\n+                for (id, cur, prev) in different {\n+                    eprintln!(\"  {}\", id);\n+                    let cur_features: HashSet<_> = cur.2.into_iter().collect();\n+                    let prev_features: HashSet<_> = prev.2.into_iter().collect();\n+                    eprintln!(\n+                        \"    `{}` additionally enabled features {:?} at {:?}\",\n+                        cur.0,\n+                        &cur_features - &prev_features,\n+                        cur.1\n+                    );\n+                    eprintln!(\n+                        \"    `{}` additionally enabled features {:?} at {:?}\",\n+                        prev.0,\n+                        &prev_features - &cur_features,\n+                        prev.1\n+                    );\n+                }\n             }\n             eprintln!();\n             eprintln!("}]}