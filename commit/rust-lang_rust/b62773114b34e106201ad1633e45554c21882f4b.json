{"sha": "b62773114b34e106201ad1633e45554c21882f4b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2Mjc3MzExNGIzNGUxMDYyMDFhZDE2MzNlNDU1NTRjMjE4ODJmNGI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-28T21:58:07Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-28T21:58:07Z"}, "message": "Auto merge of #6290 - alex-700:fix-match-like-matches, r=flip1995\n\ndo not trigger MATCH_LIKE_MATCHES_MACRO lint with attrs\n\nfixed #6289\nchangelog: do not trigger MATCH_LIKE_MATCHES_MACRO lint for arms with attrs", "tree": {"sha": "c16ab55f79f8135a642ab722c78462c3ed95f208", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c16ab55f79f8135a642ab722c78462c3ed95f208"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b62773114b34e106201ad1633e45554c21882f4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b62773114b34e106201ad1633e45554c21882f4b", "html_url": "https://github.com/rust-lang/rust/commit/b62773114b34e106201ad1633e45554c21882f4b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b62773114b34e106201ad1633e45554c21882f4b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e42ba4829c02e8308ae142b5a2fd5efb6ccf0a7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e42ba4829c02e8308ae142b5a2fd5efb6ccf0a7b", "html_url": "https://github.com/rust-lang/rust/commit/e42ba4829c02e8308ae142b5a2fd5efb6ccf0a7b"}, {"sha": "84cdb0a939cec1e13d6f464bb7b036ff3b92dfb0", "url": "https://api.github.com/repos/rust-lang/rust/commits/84cdb0a939cec1e13d6f464bb7b036ff3b92dfb0", "html_url": "https://github.com/rust-lang/rust/commit/84cdb0a939cec1e13d6f464bb7b036ff3b92dfb0"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "665c59d70936542ea9eddcb68951663eebf2ea1f", "filename": "clippy_lints/src/matches.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b62773114b34e106201ad1633e45554c21882f4b/clippy_lints%2Fsrc%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b62773114b34e106201ad1633e45554c21882f4b/clippy_lints%2Fsrc%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches.rs?ref=b62773114b34e106201ad1633e45554c21882f4b", "patch": "@@ -459,7 +459,8 @@ declare_clippy_lint! {\n     ///\n     /// **Why is this bad?** Readability and needless complexity.\n     ///\n-    /// **Known problems:** None\n+    /// **Known problems:** This lint falsely triggers, if there are arms with\n+    /// `cfg` attributes that remove an arm evaluating to `false`.\n     ///\n     /// **Example:**\n     /// ```rust\n@@ -1167,13 +1168,16 @@ fn find_matches_sugg(cx: &LateContext<'_>, ex: &Expr<'_>, arms: &[Arm<'_>], expr\n         if b0 != b1;\n         let if_guard = &b0_arms[0].guard;\n         if if_guard.is_none() || b0_arms.len() == 1;\n+        if b0_arms[0].attrs.is_empty();\n         if b0_arms[1..].iter()\n             .all(|arm| {\n                 find_bool_lit(&arm.body.kind, desugared).map_or(false, |b| b == b0) &&\n-                arm.guard.is_none()\n+                arm.guard.is_none() && arm.attrs.is_empty()\n             });\n         then {\n-            let mut applicability = Applicability::MachineApplicable;\n+            // The suggestion may be incorrect, because some arms can have `cfg` attributes\n+            // evaluated into `false` and so such arms will be stripped before.\n+            let mut applicability = Applicability::MaybeIncorrect;\n             let pat = {\n                 use itertools::Itertools as _;\n                 b0_arms.iter()"}]}