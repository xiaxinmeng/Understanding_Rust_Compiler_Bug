{"sha": "28a4e778f3d3045ee6ba6c7d10cea077e68c4f46", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4YTRlNzc4ZjNkMzA0NWVlNmJhNmM3ZDEwY2VhMDc3ZTY4YzRmNDY=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-03-23T17:37:35Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-03-23T17:37:35Z"}, "message": "Add doc rules to Makefile.in", "tree": {"sha": "bc4137c8610d992f46a55ee9d4a93b0f3054a54e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc4137c8610d992f46a55ee9d4a93b0f3054a54e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/28a4e778f3d3045ee6ba6c7d10cea077e68c4f46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/28a4e778f3d3045ee6ba6c7d10cea077e68c4f46", "html_url": "https://github.com/rust-lang/rust/commit/28a4e778f3d3045ee6ba6c7d10cea077e68c4f46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/28a4e778f3d3045ee6ba6c7d10cea077e68c4f46/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1bc0101ca4a5e01a71ca0281d9e4f0b4803bba7", "url": "https://api.github.com/repos/rust-lang/rust/commits/c1bc0101ca4a5e01a71ca0281d9e4f0b4803bba7", "html_url": "https://github.com/rust-lang/rust/commit/c1bc0101ca4a5e01a71ca0281d9e4f0b4803bba7"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "02f967d31afde293b0a406b339654af351be4081", "filename": "Makefile.in", "status": "modified", "additions": 39, "deletions": 2, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/28a4e778f3d3045ee6ba6c7d10cea077e68c4f46/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/28a4e778f3d3045ee6ba6c7d10cea077e68c4f46/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=28a4e778f3d3045ee6ba6c7d10cea077e68c4f46", "patch": "@@ -172,6 +172,20 @@ ifdef NO_VALGRIND\n   CFG_VALGRIND :=\n endif\n \n+DOCS :=\n+ifeq ($(CFG_MAKEINFO),)\n+  $(info cfg: no makeinfo found, omitting doc/rust.html)\n+else\n+  DOCS += doc/rust.html\n+endif\n+\n+ifeq ($(CFG_TEXI2PDF),)\n+  $(info cfg: no texi2pdf found, omitting doc/rust.pdf)\n+else\n+  DOCS += doc/rust.pdf\n+endif\n+\n+\n ######################################################################\n # Target-and-rule \"utility variables\"\n ######################################################################\n@@ -347,14 +361,15 @@ COMPILER_INPUTS := $(wildcard $(addprefix $(S)src/comp/, \\\n                                 rustc.rc *.rs */*.rs))\n \n ######################################################################\n-# test dependency variables\n+# Test dependency variables\n ######################################################################\n \n LREQ := rt/$(CFG_RUNTIME) rustllvm/$(CFG_RUSTLLVM)\n BREQ := boot/rustboot$(X) boot/$(CFG_STDLIB)\n SREQ0 := stage0/rustc$(X) $(LREQ)\n SREQ1 := stage1/rustc$(X) $(LREQ)\n \n+\n ######################################################################\n # Single-target rules\n ######################################################################\n@@ -366,7 +381,8 @@ all: boot/rustboot$(X)          \\\n      stage0/rustc$(X)           \\\n      stage0/glue.o              \\\n      stage0/$(CFG_STDLIB)       \\\n-     $(GENERATED)\n+     $(GENERATED)               \\\n+     $(DOCS)\n \n rt/$(CFG_RUNTIME): $(RUNTIME_OBJS) $(MKFILES) $(RUNTIME_HDR) $(RUNTIME_DEF)\n \t@$(call E, link: $@)\n@@ -480,6 +496,24 @@ rustllvm/%.o: rustllvm/%.cpp $(MKFILES)\n \t$(Q)ocamllex$(OPT) -q -o $@ $<\n \n \n+######################################################################\n+# Doc rules\n+######################################################################\n+\n+doc/version.texi: $(MKFILES) rust.texi\n+\tgit log -1 \\\n+      --pretty=format:'@macro gitversion%n%h %ci%n@end macro%n' >$@\n+\n+doc/%.pdf: %.texi doc/version.texi\n+\ttexi2pdf -I doc -o $@ --clean $<\n+\n+doc/%.html: %.texi doc/version.texi\n+\tmakeinfo -I doc --html --ifhtml --force --no-split --output=$@ $<\n+\n+docsnap: doc/rust.pdf\n+\tmv $< doc/rust-$(shell date +\"%Y-%m-%d\")-snap.pdf\n+\n+\n ######################################################################\n # Testing variables\n ######################################################################\n@@ -1106,3 +1140,6 @@ clean:\n                              boot$(X) stage0$(X) stage1$(X) stage2$(X) \\\n                              bc o s exe dSYM,                          \\\n                         $(wildcard test/*/*.$(ext) test/bench/*/*.$(ext)))\n+\t$(Q)rm -Rf $(foreach ext, \\\n+                 aux cp fn ky log pdf html pg toc tp vr cps texi \\\n+                 $(wildcard doc/*.$(ext)))"}]}