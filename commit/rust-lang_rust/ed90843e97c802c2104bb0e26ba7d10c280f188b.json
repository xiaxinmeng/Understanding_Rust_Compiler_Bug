{"sha": "ed90843e97c802c2104bb0e26ba7d10c280f188b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkOTA4NDNlOTdjODAyYzIxMDRiYjBlMjZiYTdkMTBjMjgwZjE4OGI=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2017-10-20T07:20:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-10-20T07:20:15Z"}, "message": "Merge pull request #2153 from rust-lang-nursery/rustup\n\nrustup to rustc 1.22.0-nightly (b7960878b 2017-10-18)", "tree": {"sha": "e5d0ac2e6ed1e387d0650f334592c2705f81552a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e5d0ac2e6ed1e387d0650f334592c2705f81552a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ed90843e97c802c2104bb0e26ba7d10c280f188b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ed90843e97c802c2104bb0e26ba7d10c280f188b", "html_url": "https://github.com/rust-lang/rust/commit/ed90843e97c802c2104bb0e26ba7d10c280f188b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ed90843e97c802c2104bb0e26ba7d10c280f188b/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f47e564a25e65a814c8f489d49dd1d1c6b4078d2", "url": "https://api.github.com/repos/rust-lang/rust/commits/f47e564a25e65a814c8f489d49dd1d1c6b4078d2", "html_url": "https://github.com/rust-lang/rust/commit/f47e564a25e65a814c8f489d49dd1d1c6b4078d2"}, {"sha": "35b2669219002529411fda269b193cd9d89b605a", "url": "https://api.github.com/repos/rust-lang/rust/commits/35b2669219002529411fda269b193cd9d89b605a", "html_url": "https://github.com/rust-lang/rust/commit/35b2669219002529411fda269b193cd9d89b605a"}], "stats": {"total": 33, "additions": 18, "deletions": 15}, "files": [{"sha": "2038a59137c10f7a09074c252a8fefa677d97281", "filename": "clippy_lints/src/escape.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fescape.rs?ref=ed90843e97c802c2104bb0e26ba7d10c280f188b", "patch": "@@ -71,7 +71,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n         };\n \n         let region_scope_tree = &cx.tcx.region_scope_tree(fn_def_id);\n-        ExprUseVisitor::new(&mut v, cx.tcx, cx.param_env, region_scope_tree, cx.tables).consume_body(body);\n+        ExprUseVisitor::new(&mut v, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None).consume_body(body);\n \n         for node in v.set {\n             span_lint("}, {"sha": "6ea48c5ea819b0448834afa26bf2734df7f3b107", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=ed90843e97c802c2104bb0e26ba7d10c280f188b", "patch": "@@ -1390,7 +1390,7 @@ fn check_for_mutation(cx: &LateContext, body: &Expr, bound_ids: &[Option<NodeId>\n     let mut delegate = MutateDelegate { node_id_low: bound_ids[0], node_id_high: bound_ids[1], span_low: None, span_high: None };\n     let def_id = def_id::DefId::local(body.hir_id.owner);\n     let region_scope_tree = &cx.tcx.region_scope_tree(def_id);\n-    ExprUseVisitor::new(&mut delegate, cx.tcx, cx.param_env, region_scope_tree, cx.tables).walk_expr(body);\n+    ExprUseVisitor::new(&mut delegate, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None).walk_expr(body);\n     delegate.mutation_span()\n }\n "}, {"sha": "d8309ff6f8dc1598ef3e53435c4a5558ded7a34a", "filename": "clippy_lints/src/methods.rs", "status": "modified", "additions": 15, "deletions": 12, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods.rs?ref=ed90843e97c802c2104bb0e26ba7d10c280f188b", "patch": "@@ -821,18 +821,6 @@ fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, name: &str, args: &[hir:\n         or_has_args: bool,\n         span: Span,\n     ) {\n-        // don't lint for constant values\n-        // FIXME: can we `expect` here instead of match?\n-        let promotable = cx.tcx\n-            .rvalue_promotable_to_static\n-            .borrow()\n-            .get(&arg.id)\n-            .cloned()\n-            .unwrap_or(true);\n-        if promotable {\n-            return;\n-        }\n-\n         // (path, fn_has_argument, methods, suffix)\n         let know_types: &[(&[_], _, &[_], _)] = &[\n             (&paths::BTREEMAP_ENTRY, false, &[\"or_insert\"], \"with\"),\n@@ -841,6 +829,21 @@ fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, name: &str, args: &[hir:\n             (&paths::RESULT, true, &[\"or\", \"unwrap_or\"], \"else\"),\n         ];\n \n+        // early check if the name is one we care about\n+        if know_types.iter().all(|k| !k.2.contains(&name)) {\n+            return;\n+        }\n+\n+        // don't lint for constant values\n+        // FIXME: can we `expect` here instead of match?\n+        let owner_def = cx.tcx.hir.get_parent_did(arg.id);\n+        let promotable = cx.tcx\n+            .rvalue_promotable_map(owner_def)\n+            [&arg.hir_id.local_id];\n+        if promotable {\n+            return;\n+        }\n+\n         let self_ty = cx.tables.expr_ty(self_expr);\n \n         let (fn_has_arguments, poss, suffix) = if let Some(&(_, fn_has_arguments, poss, suffix)) ="}, {"sha": "60509c1aabb020d8edc005c42da614a4566bf880", "filename": "clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed90843e97c802c2104bb0e26ba7d10c280f188b/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=ed90843e97c802c2104bb0e26ba7d10c280f188b", "patch": "@@ -108,7 +108,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n         } = {\n             let mut ctx = MovedVariablesCtxt::new(cx);\n             let region_scope_tree = &cx.tcx.region_scope_tree(fn_def_id);\n-            euv::ExprUseVisitor::new(&mut ctx, cx.tcx, cx.param_env, region_scope_tree, cx.tables).consume_body(body);\n+            euv::ExprUseVisitor::new(&mut ctx, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None).consume_body(body);\n             ctx\n         };\n "}]}