{"sha": "12fd9011b82c508420cd19b6b50d8626f07430cf", "node_id": "C_kwDOAAsO6NoAKDEyZmQ5MDExYjgyYzUwODQyMGNkMTliNmI1MGQ4NjI2ZjA3NDMwY2Y", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2022-12-23T23:13:04Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2022-12-23T23:13:04Z"}, "message": "Verify receiver is of `self: Pin<&mut Self>`", "tree": {"sha": "01a7959ebe8f247ff0532d7a40cbc74bc3384332", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/01a7959ebe8f247ff0532d7a40cbc74bc3384332"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/12fd9011b82c508420cd19b6b50d8626f07430cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/12fd9011b82c508420cd19b6b50d8626f07430cf", "html_url": "https://github.com/rust-lang/rust/commit/12fd9011b82c508420cd19b6b50d8626f07430cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/12fd9011b82c508420cd19b6b50d8626f07430cf/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a929316aed324598825e5a74a4082d09a846df32", "url": "https://api.github.com/repos/rust-lang/rust/commits/a929316aed324598825e5a74a4082d09a846df32", "html_url": "https://github.com/rust-lang/rust/commit/a929316aed324598825e5a74a4082d09a846df32"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "762188b73b38e268fa60d5683e622bb423b421e3", "filename": "compiler/rustc_borrowck/src/diagnostics/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/12fd9011b82c508420cd19b6b50d8626f07430cf/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12fd9011b82c508420cd19b6b50d8626f07430cf/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs?ref=12fd9011b82c508420cd19b6b50d8626f07430cf", "patch": "@@ -1132,9 +1132,13 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                                 place_name, partially_str, loop_message\n                             ),\n                         );\n-                        let ty = moved_place.ty(self.body, self.infcx.tcx).ty;\n-                        if let ty::Adt(def, ..) = ty.kind()\n+                        let ty = tcx.erase_regions(moved_place.ty(self.body, self.infcx.tcx).ty);\n+                        if let ty::Adt(def, substs) = ty.kind()\n                             && Some(def.did()) == self.infcx.tcx.lang_items().pin_type()\n+                            && let ty::Ref(_, _, hir::Mutability::Mut) = substs.type_at(0).kind()\n+                            // FIXME: this is a hack because we can't call `can_eq`\n+                            && ty.to_string() ==    \n+                                tcx.fn_sig(method_did).input(0).skip_binder().to_string()\n                         {\n                             err.span_suggestion_verbose(\n                                 fn_call_span.shrink_to_lo(),"}, {"sha": "b3f95ee192a565e85a6bc7647068168fd46e203f", "filename": "src/test/ui/moves/move-fn-self-receiver.stderr", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/12fd9011b82c508420cd19b6b50d8626f07430cf/src%2Ftest%2Fui%2Fmoves%2Fmove-fn-self-receiver.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/12fd9011b82c508420cd19b6b50d8626f07430cf/src%2Ftest%2Fui%2Fmoves%2Fmove-fn-self-receiver.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmoves%2Fmove-fn-self-receiver.stderr?ref=12fd9011b82c508420cd19b6b50d8626f07430cf", "patch": "@@ -67,10 +67,6 @@ note: `Foo::use_pin_box_self` takes ownership of the receiver `self`, which move\n    |\n LL |     fn use_pin_box_self(self: Pin<Box<Self>>) {}\n    |                         ^^^^\n-help: consider reborrowing the `Pin` instead of moving it\n-   |\n-LL |     pin_box_foo.as_mut().use_pin_box_self();\n-   |                 +++++++++\n \n error[E0505]: cannot move out of `mut_foo` because it is borrowed\n   --> $DIR/move-fn-self-receiver.rs:50:5"}]}