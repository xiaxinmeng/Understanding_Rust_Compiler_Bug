{"sha": "079f39d07fd75e625a56c8a417bdc946cac389a6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3OWYzOWQwN2ZkNzVlNjI1YTU2YzhhNDE3YmRjOTQ2Y2FjMzg5YTY=", "commit": {"author": {"name": "sinkuu", "email": "sinkuupump@gmail.com", "date": "2016-09-10T05:02:05Z"}, "committer": {"name": "sinkuu", "email": "sinkuupump@gmail.com", "date": "2016-09-17T01:46:20Z"}, "message": "Fix #550: `if` nested in tuple is indented oddly", "tree": {"sha": "edc78a66ac48e3eb94be6c4d1dbf767dc77a63ba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/edc78a66ac48e3eb94be6c4d1dbf767dc77a63ba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/079f39d07fd75e625a56c8a417bdc946cac389a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/079f39d07fd75e625a56c8a417bdc946cac389a6", "html_url": "https://github.com/rust-lang/rust/commit/079f39d07fd75e625a56c8a417bdc946cac389a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/079f39d07fd75e625a56c8a417bdc946cac389a6/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4418fab4f24e6497aa2a1f71bb4cf963c2971a28", "url": "https://api.github.com/repos/rust-lang/rust/commits/4418fab4f24e6497aa2a1f71bb4cf963c2971a28", "html_url": "https://github.com/rust-lang/rust/commit/4418fab4f24e6497aa2a1f71bb4cf963c2971a28"}], "stats": {"total": 61, "additions": 55, "deletions": 6}, "files": [{"sha": "e67a438cbcce55cb1855dd9995658ff76019254f", "filename": "src/comment.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/079f39d07fd75e625a56c8a417bdc946cac389a6/src%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/079f39d07fd75e625a56c8a417bdc946cac389a6/src%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomment.rs?ref=079f39d07fd75e625a56c8a417bdc946cac389a6", "patch": "@@ -425,10 +425,10 @@ impl<'a> Iterator for UngroupedCommentCodeSlices<'a> {\n             None => &self.slice[start_idx..],\n         };\n         Some((if kind.is_comment() {\n-            CodeCharKind::Comment\n-        } else {\n-            CodeCharKind::Normal\n-        },\n+                  CodeCharKind::Comment\n+              } else {\n+                  CodeCharKind::Normal\n+              },\n               start_idx,\n               slice))\n     }"}, {"sha": "a00baf21a8496c7678a9cb22ea4d687ac0954b09", "filename": "src/expr.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/079f39d07fd75e625a56c8a417bdc946cac389a6/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/079f39d07fd75e625a56c8a417bdc946cac389a6/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=079f39d07fd75e625a56c8a417bdc946cac389a6", "patch": "@@ -1716,11 +1716,16 @@ pub fn rewrite_tuple<'a, I>(context: &RewriteContext,\n           <I::Item as Deref>::Target: Rewrite + Spanned + 'a\n {\n     let indent = offset + 1;\n+    let aligned = RewriteContext { block_indent: indent, ..context.clone() };\n+\n     // In case of length 1, need a trailing comma\n     if items.len() == 1 {\n         // 3 = \"(\" + \",)\"\n         let budget = try_opt!(width.checked_sub(3));\n-        return items.next().unwrap().rewrite(context, budget, indent).map(|s| format!(\"({},)\", s));\n+        return items.next()\n+            .unwrap()\n+            .rewrite(&aligned, budget, indent)\n+            .map(|s| format!(\"({},)\", s));\n     }\n \n     let list_lo = context.codemap.span_after(span, \"(\");\n@@ -1733,7 +1738,7 @@ pub fn rewrite_tuple<'a, I>(context: &RewriteContext,\n                                  let inner_width = try_opt!(context.config\n                                      .max_width\n                                      .checked_sub(indent.width() + 1));\n-                                 item.rewrite(context, inner_width, indent)\n+                                 item.rewrite(&aligned, inner_width, indent)\n                              },\n                              list_lo,\n                              span.hi - BytePos(1));"}, {"sha": "b28e83d2f082a2e8b4f21d3350ba16a18b805460", "filename": "tests/source/tuple.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/079f39d07fd75e625a56c8a417bdc946cac389a6/tests%2Fsource%2Ftuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/079f39d07fd75e625a56c8a417bdc946cac389a6/tests%2Fsource%2Ftuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Ftuple.rs?ref=079f39d07fd75e625a56c8a417bdc946cac389a6", "patch": "@@ -0,0 +1,34 @@\n+// Test tuple litterals\n+\n+fn foo() {\n+    let a = (a, a, a, a, a);\n+    let aaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa, aaaaaaaaaaaaaa, aaaaaaaaaaaaaa);\n+    let aaaaaaaaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaa);\n+    let a = (a,);\n+\n+    let b = (// This is a comment\n+             b, // Comment\n+             b /* Trailing comment */);\n+}\n+\n+fn a() {\n+    ((aaaaaaaa,\n+      aaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaa),)\n+}\n+\n+fn b() {\n+    ((bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n+     bbbbbbbbbbbbbbbbbb)\n+}\n+\n+fn issue550() {\n+    self.visitor.visit_volume(self.level.sector_id(sector), (floor_y,\n+    if is_sky_flat(ceil_tex) {from_wad_height(self.height_range.1)} else {ceil_y}));\n+}"}, {"sha": "2d1d0b808d78f0f1bc14970b81d776007da939f9", "filename": "tests/target/tuple.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/079f39d07fd75e625a56c8a417bdc946cac389a6/tests%2Ftarget%2Ftuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/079f39d07fd75e625a56c8a417bdc946cac389a6/tests%2Ftarget%2Ftuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ftuple.rs?ref=079f39d07fd75e625a56c8a417bdc946cac389a6", "patch": "@@ -27,3 +27,13 @@ fn b() {\n     ((bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n      bbbbbbbbbbbbbbbbbb)\n }\n+\n+fn issue550() {\n+    self.visitor.visit_volume(self.level.sector_id(sector),\n+                              (floor_y,\n+                               if is_sky_flat(ceil_tex) {\n+                                   from_wad_height(self.height_range.1)\n+                               } else {\n+                                   ceil_y\n+                               }));\n+}"}]}