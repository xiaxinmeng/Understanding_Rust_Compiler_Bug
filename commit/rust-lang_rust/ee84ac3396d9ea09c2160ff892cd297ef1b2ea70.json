{"sha": "ee84ac3396d9ea09c2160ff892cd297ef1b2ea70", "node_id": "C_kwDOAAsO6NoAKGVlODRhYzMzOTZkOWVhMDljMjE2MGZmODkyY2QyOTdlZjFiMmVhNzA", "commit": {"author": {"name": "Marek Downar", "email": "marek.downar@evomedia.pl", "date": "2022-01-15T14:51:46Z"}, "committer": {"name": "Marek Downar", "email": "marek.downar@evomedia.pl", "date": "2022-01-15T14:51:46Z"}, "message": "issue #8239: Printed hint for lint or_fun_call is cropped and does not show the solution", "tree": {"sha": "c0c58db203fdb57231e3b143a37930ac1c1d97f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0c58db203fdb57231e3b143a37930ac1c1d97f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee84ac3396d9ea09c2160ff892cd297ef1b2ea70", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQSzz0WgAyQDeHzM2Qxi1+PvccqFsgUCYeLfggAKCRBi1+PvccqF\nslmdAP9i/NIfnMSlB1tGbei5uyXLi1sESUzkN3/pjdLmliOTKAEAtzRNKpSSW/bp\nAIrV3hE7xFdnF1p2INMIjnjVLEIc9ww=\n=9fS8\n-----END PGP SIGNATURE-----", "payload": "tree c0c58db203fdb57231e3b143a37930ac1c1d97f1\nparent 5cada57f306ee47ee4e9a78008798d734ff7b9d7\nauthor Marek Downar <marek.downar@evomedia.pl> 1642258306 +0100\ncommitter Marek Downar <marek.downar@evomedia.pl> 1642258306 +0100\n\nissue #8239: Printed hint for lint or_fun_call is cropped and does not show the solution\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee84ac3396d9ea09c2160ff892cd297ef1b2ea70", "html_url": "https://github.com/rust-lang/rust/commit/ee84ac3396d9ea09c2160ff892cd297ef1b2ea70", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee84ac3396d9ea09c2160ff892cd297ef1b2ea70/comments", "author": {"login": "marekdownar", "id": 1872953, "node_id": "MDQ6VXNlcjE4NzI5NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1872953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marekdownar", "html_url": "https://github.com/marekdownar", "followers_url": "https://api.github.com/users/marekdownar/followers", "following_url": "https://api.github.com/users/marekdownar/following{/other_user}", "gists_url": "https://api.github.com/users/marekdownar/gists{/gist_id}", "starred_url": "https://api.github.com/users/marekdownar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marekdownar/subscriptions", "organizations_url": "https://api.github.com/users/marekdownar/orgs", "repos_url": "https://api.github.com/users/marekdownar/repos", "events_url": "https://api.github.com/users/marekdownar/events{/privacy}", "received_events_url": "https://api.github.com/users/marekdownar/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marekdownar", "id": 1872953, "node_id": "MDQ6VXNlcjE4NzI5NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1872953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marekdownar", "html_url": "https://github.com/marekdownar", "followers_url": "https://api.github.com/users/marekdownar/followers", "following_url": "https://api.github.com/users/marekdownar/following{/other_user}", "gists_url": "https://api.github.com/users/marekdownar/gists{/gist_id}", "starred_url": "https://api.github.com/users/marekdownar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marekdownar/subscriptions", "organizations_url": "https://api.github.com/users/marekdownar/orgs", "repos_url": "https://api.github.com/users/marekdownar/repos", "events_url": "https://api.github.com/users/marekdownar/events{/privacy}", "received_events_url": "https://api.github.com/users/marekdownar/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5cada57f306ee47ee4e9a78008798d734ff7b9d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/5cada57f306ee47ee4e9a78008798d734ff7b9d7", "html_url": "https://github.com/rust-lang/rust/commit/5cada57f306ee47ee4e9a78008798d734ff7b9d7"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "6fb67ff89c358330828ab20d6598045266a3b805", "filename": "clippy_lints/src/methods/or_fun_call.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ee84ac3396d9ea09c2160ff892cd297ef1b2ea70/clippy_lints%2Fsrc%2Fmethods%2For_fun_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee84ac3396d9ea09c2160ff892cd297ef1b2ea70/clippy_lints%2Fsrc%2Fmethods%2For_fun_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2For_fun_call.rs?ref=ee84ac3396d9ea09c2160ff892cd297ef1b2ea70", "patch": "@@ -4,6 +4,7 @@ use clippy_utils::source::{snippet, snippet_with_applicability, snippet_with_mac\n use clippy_utils::ty::{implements_trait, match_type};\n use clippy_utils::{contains_return, is_trait_item, last_path_segment, paths};\n use if_chain::if_chain;\n+use rustc_errors::emitter::MAX_SUGGESTION_HIGHLIGHT_LINES;\n use rustc_errors::Applicability;\n use rustc_hir as hir;\n use rustc_lint::LateContext;\n@@ -52,16 +53,24 @@ pub(super) fn check<'tcx>(\n \n             then {\n                 let mut applicability = Applicability::MachineApplicable;\n+                let hint = \".unwrap_or_default()\";\n+                let mut sugg: String = format!(\n+                    \"{}{}\",\n+                    snippet_with_applicability(cx, self_expr.span, \"..\", &mut applicability),\n+                    hint\n+                );\n+\n+                if sugg.lines().count() > MAX_SUGGESTION_HIGHLIGHT_LINES {\n+                    sugg = hint.to_string();\n+                }\n+\n                 span_lint_and_sugg(\n                     cx,\n                     OR_FUN_CALL,\n                     span,\n                     &format!(\"use of `{}` followed by a call to `{}`\", name, path),\n                     \"try this\",\n-                    format!(\n-                        \"{}.unwrap_or_default()\",\n-                        snippet_with_applicability(cx, self_expr.span, \"..\", &mut applicability)\n-                    ),\n+                    sugg,\n                     applicability,\n                 );\n "}]}