{"sha": "dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRjOTEyOGZmZjg1YmRiMDRkNmJlZjdiNjU1ZDZkOTVmNGE1YWJmYjA=", "commit": {"author": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2018-04-05T13:50:48Z"}, "committer": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2018-04-05T15:39:36Z"}, "message": "Fix ICE with `main`'s return type containing lifetimes", "tree": {"sha": "26aef6bb4ef39c357b8eb524af07e339178eba59", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26aef6bb4ef39c357b8eb524af07e339178eba59"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "html_url": "https://github.com/rust-lang/rust/commit/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c75d5e242fa5c745a89e5d9541e3cc737d269061", "url": "https://api.github.com/repos/rust-lang/rust/commits/c75d5e242fa5c745a89e5d9541e3cc737d269061", "html_url": "https://github.com/rust-lang/rust/commit/c75d5e242fa5c745a89e5d9541e3cc737d269061"}], "stats": {"total": 86, "additions": 78, "deletions": 8}, "files": [{"sha": "ebe918ed26c15752242b6a3102ff765a9e8fa7f3", "filename": "src/librustc_mir/monomorphize/collector.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs?ref=dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "patch": "@@ -212,8 +212,6 @@ use monomorphize::item::{MonoItemExt, DefPathBasedNames, InstantiationMode};\n \n use rustc_data_structures::bitvec::BitVector;\n \n-use std::iter;\n-\n #[derive(PartialEq, Eq, Hash, Clone, Copy, Debug)]\n pub enum MonoItemCollectionMode {\n     Eager,\n@@ -1030,13 +1028,15 @@ impl<'b, 'a, 'v> RootCollector<'b, 'a, 'v> {\n         // late-bound regions, since late-bound\n         // regions must appear in the argument\n         // listing.\n-        let main_ret_ty = main_ret_ty.no_late_bound_regions().unwrap();\n+        let main_ret_ty = self.tcx.erase_regions(\n+            &main_ret_ty.no_late_bound_regions().unwrap(),\n+        );\n \n         let start_instance = Instance::resolve(\n             self.tcx,\n             ty::ParamEnv::reveal_all(),\n             start_def_id,\n-            self.tcx.mk_substs(iter::once(Kind::from(main_ret_ty)))\n+            self.tcx.intern_substs(&[Kind::from(main_ret_ty)])\n         ).unwrap();\n \n         self.output.push(create_fn_mono_item(start_instance));"}, {"sha": "a513ebbf6c7f47bc81e1b3bf9c2eda8e2bb2edc6", "filename": "src/librustc_trans/base.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Flibrustc_trans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Flibrustc_trans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fbase.rs?ref=dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "patch": "@@ -82,7 +82,6 @@ use std::str;\n use std::sync::Arc;\n use std::time::{Instant, Duration};\n use std::{i32, usize};\n-use std::iter;\n use std::sync::mpsc;\n use syntax_pos::Span;\n use syntax_pos::symbol::InternedString;\n@@ -553,7 +552,9 @@ fn maybe_create_entry_wrapper(cx: &CodegenCx) {\n         // late-bound regions, since late-bound\n         // regions must appear in the argument\n         // listing.\n-        let main_ret_ty = main_ret_ty.no_late_bound_regions().unwrap();\n+        let main_ret_ty = cx.tcx.erase_regions(\n+            &main_ret_ty.no_late_bound_regions().unwrap(),\n+        );\n \n         if declare::get_defined_value(cx, \"main\").is_some() {\n             // FIXME: We should be smart and show a better diagnostic here.\n@@ -580,8 +581,11 @@ fn maybe_create_entry_wrapper(cx: &CodegenCx) {\n \n         let (start_fn, args) = if use_start_lang_item {\n             let start_def_id = cx.tcx.require_lang_item(StartFnLangItem);\n-            let start_fn = callee::resolve_and_get_fn(cx, start_def_id, cx.tcx.mk_substs(\n-                iter::once(Kind::from(main_ret_ty))));\n+            let start_fn = callee::resolve_and_get_fn(\n+                cx,\n+                start_def_id,\n+                cx.tcx.intern_substs(&[Kind::from(main_ret_ty)]),\n+            );\n             (start_fn, vec![bx.pointercast(rust_main, Type::i8p(cx).ptr_to()),\n                             arg_argc, arg_argv])\n         } else {"}, {"sha": "bd6bcf88a0caf2a167046add186335e17d862b65", "filename": "src/test/run-fail/rfc-1937-termination-trait/termination-trait-for-box-dyn-error.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs?ref=dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// must-compile-successfully\n+// failure-status: 1\n+\n+#![feature(dyn_trait)]\n+\n+use std::error::Error;\n+use std::io;\n+\n+fn main() -> Result<(), Box<dyn Error>> {\n+    Err(Box::new(io::Error::new(io::ErrorKind::Other, \"returned Box<dyn Error> from main()\")))\n+}"}, {"sha": "d2828812e9fc337ad027b3dd96d7bc7ec9d419b7", "filename": "src/test/run-fail/rfc-1937-termination-trait/termination-trait-for-str.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs?ref=dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// error-pattern: An error message for you\n+\n+fn main() -> Result<(), &'static str> {\n+    Err(\"An error message for you\")\n+}"}, {"sha": "24c30a5abc22a0207284da443e1ba7fac4fefc90", "filename": "src/test/run-pass/rfc-1937-termination-trait/termination-trait-for-box-dyn-error.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs?ref=dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(dyn_trait)]\n+\n+use std::error::Error;\n+\n+fn main() -> Result<(), Box<dyn Error>> {\n+    Ok(())\n+}"}, {"sha": "2023ff75564f786ca28248aa41b9f789ef90b293", "filename": "src/test/run-pass/rfc-1937-termination-trait/termination-trait-for-str.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs?ref=dc9128fff85bdb04d6bef7b655d6d95f4a5abfb0", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() -> Result<(), &'static str> {\n+    Ok(())\n+}"}]}