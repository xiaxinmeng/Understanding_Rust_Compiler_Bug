{"sha": "fee75fbe11b1fad5d93c723234178b2a329a3c03", "node_id": "C_kwDOAAsO6NoAKGZlZTc1ZmJlMTFiMWZhZDVkOTNjNzIzMjM0MTc4YjJhMzI5YTNjMDM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-10T18:26:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-10T18:26:31Z"}, "message": "Auto merge of #96905 - jyn514:revert-96803-faster-assemble, r=Mark-Simulacrum\n\nRevert \"Make \"Assemble stage1 compiler\" orders of magnitude faster\"\n\nReverts rust-lang/rust#96803. This caused `llvm-tools-nightly` to fail when installing with `rustup-toolchain-install-master` because of the presence of symlinks. I'm not sure how the symlinks got in there, but revert the PR for now while I figure it out.\n\nr? `@Mark-Simulacrum` cc `@RalfJung`", "tree": {"sha": "8a21e9a19494739e4a4ffdab39ef249f0a46436b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a21e9a19494739e4a4ffdab39ef249f0a46436b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fee75fbe11b1fad5d93c723234178b2a329a3c03", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fee75fbe11b1fad5d93c723234178b2a329a3c03", "html_url": "https://github.com/rust-lang/rust/commit/fee75fbe11b1fad5d93c723234178b2a329a3c03", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fee75fbe11b1fad5d93c723234178b2a329a3c03/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d4c364347ce65cf083d4419195b8232440928d4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4c364347ce65cf083d4419195b8232440928d4d", "html_url": "https://github.com/rust-lang/rust/commit/d4c364347ce65cf083d4419195b8232440928d4d"}, {"sha": "89e0c29489ee6375927e86eaf5e5a8080dc8f24e", "url": "https://api.github.com/repos/rust-lang/rust/commits/89e0c29489ee6375927e86eaf5e5a8080dc8f24e", "html_url": "https://github.com/rust-lang/rust/commit/89e0c29489ee6375927e86eaf5e5a8080dc8f24e"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "5d32b4f801a183fb22247e16f7bffcb99aab1d36", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/fee75fbe11b1fad5d93c723234178b2a329a3c03/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fee75fbe11b1fad5d93c723234178b2a329a3c03/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=fee75fbe11b1fad5d93c723234178b2a329a3c03", "patch": "@@ -1497,14 +1497,20 @@ impl Build {\n         let dst = dstdir.join(src.file_name().unwrap());\n         self.verbose_than(1, &format!(\"Install {:?} to {:?}\", src, dst));\n         t!(fs::create_dir_all(dstdir));\n+        drop(fs::remove_file(&dst));\n         {\n             if !src.exists() {\n                 panic!(\"Error: File \\\"{}\\\" not found!\", src.display());\n             }\n-            self.copy(src, &dst);\n+            let metadata = t!(src.symlink_metadata());\n+            if let Err(e) = fs::copy(&src, &dst) {\n+                panic!(\"failed to copy `{}` to `{}`: {}\", src.display(), dst.display(), e)\n+            }\n+            t!(fs::set_permissions(&dst, metadata.permissions()));\n+            let atime = FileTime::from_last_access_time(&metadata);\n+            let mtime = FileTime::from_last_modification_time(&metadata);\n+            t!(filetime::set_file_times(&dst, atime, mtime));\n         }\n-        // NOTE: when using hard-links, this will also update the permissions on the original file.\n-        // We never use permissions that are more restrictive than the original, so this shouldn't cause any issues.\n         chmod(&dst, perms);\n     }\n "}]}