{"sha": "860e069d4dd141ad8d2f2f77a09b9a3ac762ce34", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2MGUwNjlkNGRkMTQxYWQ4ZDJmMmY3N2EwOWI5YTNhYzc2MmNlMzQ=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-03-23T14:44:17Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-03-23T14:44:17Z"}, "message": "Use styleguide conforming import for ast nodes", "tree": {"sha": "c5da02a67a716ee3b80a5dcb7badd2ad39bbf42a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c5da02a67a716ee3b80a5dcb7badd2ad39bbf42a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/860e069d4dd141ad8d2f2f77a09b9a3ac762ce34", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/860e069d4dd141ad8d2f2f77a09b9a3ac762ce34", "html_url": "https://github.com/rust-lang/rust/commit/860e069d4dd141ad8d2f2f77a09b9a3ac762ce34", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/860e069d4dd141ad8d2f2f77a09b9a3ac762ce34/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7352f50ec23739ca53e51eaec96809bd873debfe", "url": "https://api.github.com/repos/rust-lang/rust/commits/7352f50ec23739ca53e51eaec96809bd873debfe", "html_url": "https://github.com/rust-lang/rust/commit/7352f50ec23739ca53e51eaec96809bd873debfe"}], "stats": {"total": 70, "additions": 36, "deletions": 34}, "files": [{"sha": "7030d0f9781b8f89de0b534b1b47d1fe39394f8e", "filename": "crates/ide_assists/src/handlers/add_lifetime_to_type.rs", "status": "modified", "additions": 36, "deletions": 34, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/860e069d4dd141ad8d2f2f77a09b9a3ac762ce34/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fadd_lifetime_to_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/860e069d4dd141ad8d2f2f77a09b9a3ac762ce34/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fadd_lifetime_to_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fadd_lifetime_to_type.rs?ref=860e069d4dd141ad8d2f2f77a09b9a3ac762ce34", "patch": "@@ -1,5 +1,4 @@\n-use ast::FieldList;\n-use syntax::ast::{self, AstNode, GenericParamsOwner, NameOwner, RefType, Type};\n+use syntax::ast::{self, AstNode, GenericParamsOwner, NameOwner};\n \n use crate::{AssistContext, AssistId, AssistKind, Assists};\n \n@@ -65,8 +64,8 @@ pub(crate) fn add_lifetime_to_type(acc: &mut Assists, ctx: &AssistContext) -> Op\n     )\n }\n \n-fn fetch_borrowed_types(node: &ast::Adt) -> Option<Vec<RefType>> {\n-    let ref_types: Vec<RefType> = match node {\n+fn fetch_borrowed_types(node: &ast::Adt) -> Option<Vec<ast::RefType>> {\n+    let ref_types: Vec<ast::RefType> = match node {\n         ast::Adt::Enum(enum_) => {\n             let variant_list = enum_.variant_list()?;\n             variant_list\n@@ -88,7 +87,7 @@ fn fetch_borrowed_types(node: &ast::Adt) -> Option<Vec<RefType>> {\n             record_field_list\n                 .fields()\n                 .filter_map(|r_field| {\n-                    if let Type::RefType(ref_type) = r_field.ty()? {\n+                    if let ast::Type::RefType(ref_type) = r_field.ty()? {\n                         if ref_type.lifetime().is_none() {\n                             return Some(ref_type);\n                         }\n@@ -107,12 +106,12 @@ fn fetch_borrowed_types(node: &ast::Adt) -> Option<Vec<RefType>> {\n     }\n }\n \n-fn find_ref_types_from_field_list(field_list: &FieldList) -> Option<Vec<RefType>> {\n-    let ref_types: Vec<RefType> = match field_list {\n+fn find_ref_types_from_field_list(field_list: &ast::FieldList) -> Option<Vec<ast::RefType>> {\n+    let ref_types: Vec<ast::RefType> = match field_list {\n         ast::FieldList::RecordFieldList(record_list) => record_list\n             .fields()\n             .filter_map(|f| {\n-                if let Type::RefType(ref_type) = f.ty()? {\n+                if let ast::Type::RefType(ref_type) = f.ty()? {\n                     if ref_type.lifetime().is_none() {\n                         return Some(ref_type);\n                     }\n@@ -124,7 +123,7 @@ fn find_ref_types_from_field_list(field_list: &FieldList) -> Option<Vec<RefType>\n         ast::FieldList::TupleFieldList(tuple_field_list) => tuple_field_list\n             .fields()\n             .filter_map(|f| {\n-                if let Type::RefType(ref_type) = f.ty()? {\n+                if let ast::Type::RefType(ref_type) = f.ty()? {\n                     if ref_type.lifetime().is_none() {\n                         return Some(ref_type);\n                     }\n@@ -152,76 +151,79 @@ mod tests {\n     fn add_lifetime_to_struct() {\n         check_assist(\n             add_lifetime_to_type,\n-            \"struct Foo { a: &$0i32 }\",\n-            \"struct Foo<'a> { a: &'a i32 }\",\n+            r#\"struct Foo { a: &$0i32 }\"#,\n+            r#\"struct Foo<'a> { a: &'a i32 }\"#,\n         );\n \n         check_assist(\n             add_lifetime_to_type,\n-            \"struct Foo { a: &$0i32, b: &usize }\",\n-            \"struct Foo<'a> { a: &'a i32, b: &'a usize }\",\n+            r#\"struct Foo { a: &$0i32, b: &usize }\"#,\n+            r#\"struct Foo<'a> { a: &'a i32, b: &'a usize }\"#,\n         );\n \n         check_assist(\n             add_lifetime_to_type,\n-            \"struct Foo { a: &$0i32, b: usize }\",\n-            \"struct Foo<'a> { a: &'a i32, b: usize }\",\n+            r#\"struct Foo { a: &$0i32, b: usize }\"#,\n+            r#\"struct Foo<'a> { a: &'a i32, b: usize }\"#,\n         );\n \n         check_assist(\n             add_lifetime_to_type,\n-            \"struct Foo<T> { a: &$0T, b: usize }\",\n-            \"struct Foo<'a, T> { a: &'a T, b: usize }\",\n+            r#\"struct Foo<T> { a: &$0T, b: usize }\"#,\n+            r#\"struct Foo<'a, T> { a: &'a T, b: usize }\"#,\n         );\n \n-        check_assist_not_applicable(add_lifetime_to_type, \"struct Foo<'a> { a: &$0'a i32 }\");\n-        check_assist_not_applicable(add_lifetime_to_type, \"struct Foo { a: &'a$0 i32 }\");\n+        check_assist_not_applicable(add_lifetime_to_type, r#\"struct Foo<'a> { a: &$0'a i32 }\"#);\n+        check_assist_not_applicable(add_lifetime_to_type, r#\"struct Foo { a: &'a$0 i32 }\"#);\n     }\n \n     #[test]\n     fn add_lifetime_to_enum() {\n         check_assist(\n             add_lifetime_to_type,\n-            \"enum Foo { Bar { a: i32 }, Other, Tuple(u32, &$0u32)}\",\n-            \"enum Foo<'a> { Bar { a: i32 }, Other, Tuple(u32, &'a u32)}\",\n+            r#\"enum Foo { Bar { a: i32 }, Other, Tuple(u32, &$0u32)}\"#,\n+            r#\"enum Foo<'a> { Bar { a: i32 }, Other, Tuple(u32, &'a u32)}\"#,\n         );\n \n         check_assist(\n             add_lifetime_to_type,\n-            \"enum Foo { Bar { a: &$0i32 }}\",\n-            \"enum Foo<'a> { Bar { a: &'a i32 }}\",\n+            r#\"enum Foo { Bar { a: &$0i32 }}\"#,\n+            r#\"enum Foo<'a> { Bar { a: &'a i32 }}\"#,\n         );\n \n         check_assist(\n             add_lifetime_to_type,\n-            \"enum Foo<T> { Bar { a: &$0i32, b: &T }}\",\n-            \"enum Foo<'a, T> { Bar { a: &'a i32, b: &'a T }}\",\n+            r#\"enum Foo<T> { Bar { a: &$0i32, b: &T }}\"#,\n+            r#\"enum Foo<'a, T> { Bar { a: &'a i32, b: &'a T }}\"#,\n         );\n \n-        check_assist_not_applicable(add_lifetime_to_type, \"enum Foo<'a> { Bar { a: &$0'a i32 }}\");\n-        check_assist_not_applicable(add_lifetime_to_type, \"enum Foo { Bar, $0Misc }\");\n+        check_assist_not_applicable(\n+            add_lifetime_to_type,\n+            r#\"enum Foo<'a> { Bar { a: &$0'a i32 }}\"#,\n+        );\n+        check_assist_not_applicable(add_lifetime_to_type, r#\"enum Foo { Bar, $0Misc }\"#);\n     }\n \n     #[test]\n     fn add_lifetime_to_union() {\n         check_assist(\n             add_lifetime_to_type,\n-            \"union Foo { a: &$0i32 }\",\n-            \"union Foo<'a> { a: &'a i32 }\",\n+            r#\"union Foo { a: &$0i32 }\"#,\n+            r#\"union Foo<'a> { a: &'a i32 }\"#,\n         );\n \n         check_assist(\n             add_lifetime_to_type,\n-            \"union Foo { a: &$0i32, b: &usize }\",\n-            \"union Foo<'a> { a: &'a i32, b: &'a usize }\",\n+            r#\"union Foo { a: &$0i32, b: &usize }\"#,\n+            r#\"union Foo<'a> { a: &'a i32, b: &'a usize }\"#,\n         );\n \n         check_assist(\n             add_lifetime_to_type,\n-            \"union Foo<T> { a: &$0T, b: usize }\",\n-            \"union Foo<'a, T> { a: &'a T, b: usize }\",\n+            r#\"union Foo<T> { a: &$0T, b: usize }\"#,\n+            r#\"union Foo<'a, T> { a: &'a T, b: usize }\"#,\n         );\n \n-        check_assist_not_applicable(add_lifetime_to_type, \"struct Foo<'a> { a: &'a $0i32 }\");\n+        check_assist_not_applicable(add_lifetime_to_type, r#\"struct Foo<'a> { a: &'a $0i32 }\"#);\n     }\n }"}]}