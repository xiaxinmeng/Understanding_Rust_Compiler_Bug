{"sha": "0668eed81e51d9794eb83bd3f66ec5d5102f87a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA2NjhlZWQ4MWU1MWQ5Nzk0ZWI4M2JkM2Y2NmVjNWQ1MTAyZjg3YTE=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-11-08T05:50:28Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-11-09T05:11:47Z"}, "message": "fix alignment of xmm register storage", "tree": {"sha": "8158ec08c70d16418d499eeda807a113606f30d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8158ec08c70d16418d499eeda807a113606f30d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0668eed81e51d9794eb83bd3f66ec5d5102f87a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0668eed81e51d9794eb83bd3f66ec5d5102f87a1", "html_url": "https://github.com/rust-lang/rust/commit/0668eed81e51d9794eb83bd3f66ec5d5102f87a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0668eed81e51d9794eb83bd3f66ec5d5102f87a1/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e24d1dd6f54b454b206bb2df79d277e77d818442", "url": "https://api.github.com/repos/rust-lang/rust/commits/e24d1dd6f54b454b206bb2df79d277e77d818442", "html_url": "https://github.com/rust-lang/rust/commit/e24d1dd6f54b454b206bb2df79d277e77d818442"}], "stats": {"total": 37, "additions": 20, "deletions": 17}, "files": [{"sha": "2eba7296df2b3c6007fdd220638011cccf9c526f", "filename": "src/rt/arch/x86_64/_context.S", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/0668eed81e51d9794eb83bd3f66ec5d5102f87a1/src%2Frt%2Farch%2Fx86_64%2F_context.S", "raw_url": "https://github.com/rust-lang/rust/raw/0668eed81e51d9794eb83bd3f66ec5d5102f87a1/src%2Frt%2Farch%2Fx86_64%2F_context.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2F_context.S?ref=0668eed81e51d9794eb83bd3f66ec5d5102f87a1", "patch": "@@ -55,7 +55,7 @@ swap_registers:\n         \n         // Save instruction pointer:\n         pop %rax\n-        mov %rax, 104(%rdi)\n+        mov %rax, 56(%rdi)\n \n         // Save non-volatile integer registers:\n         //   (including RSP)\n@@ -68,12 +68,12 @@ swap_registers:\n         mov %r15,  48(%rdi)\n \n         // Save non-volatile XMM registers:\n-        movapd %xmm0, 56(%rdi)\n-        movapd %xmm1, 64(%rdi)\n-        movapd %xmm2, 72(%rdi)\n-        movapd %xmm3, 80(%rdi)\n-        movapd %xmm4, 88(%rdi)\n-        movapd %xmm5, 96(%rdi)\n+        movapd %xmm0,  64(%rdi)\n+        movapd %xmm1,  80(%rdi)\n+        movapd %xmm2,  96(%rdi)\n+        movapd %xmm3, 112(%rdi)\n+        movapd %xmm4, 128(%rdi)\n+        movapd %xmm5, 144(%rdi)\n \n         // Restore non-volatile integer registers:\n         //   (including RSP)\n@@ -86,14 +86,14 @@ swap_registers:\n         mov 48(%rsi), %r15\n \n         // Restore non-volatile XMM registers:\n-        movapd 56(%rsi), %xmm0\n-        movapd 64(%rsi), %xmm1\n-        movapd 72(%rsi), %xmm2\n-        movapd 80(%rsi), %xmm3\n-        movapd 88(%rsi), %xmm4\n-        movapd 96(%rsi), %xmm5\n+        movapd  64(%rsi), %xmm0\n+        movapd  80(%rsi), %xmm1\n+        movapd  96(%rsi), %xmm2\n+        movapd 112(%rsi), %xmm3\n+        movapd 128(%rsi), %xmm4\n+        movapd 144(%rsi), %xmm5\n \n         // Jump to the instruction pointer\n         // found in regs:\n-        jmp *104(%rsi)\n+        jmp *56(%rsi)\n "}, {"sha": "edfae486b4f2ddae0b264c40a5d31cb9817428e8", "filename": "src/rt/arch/x86_64/context.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0668eed81e51d9794eb83bd3f66ec5d5102f87a1/src%2Frt%2Farch%2Fx86_64%2Fcontext.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/0668eed81e51d9794eb83bd3f66ec5d5102f87a1/src%2Frt%2Farch%2Fx86_64%2Fcontext.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fcontext.cpp?ref=0668eed81e51d9794eb83bd3f66ec5d5102f87a1", "patch": "@@ -17,7 +17,7 @@ context::context()\n \n void context::swap(context &out)\n {\n-  swap_registers(&out.regs, &regs);\n+    swap_registers(&out.regs, &regs);\n }\n \n void context::call(void *f, void *arg, void *stack) {"}, {"sha": "305298093cc48ec77fc45f0e935b60f7b9317546", "filename": "src/rt/arch/x86_64/context.h", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0668eed81e51d9794eb83bd3f66ec5d5102f87a1/src%2Frt%2Farch%2Fx86_64%2Fcontext.h", "raw_url": "https://github.com/rust-lang/rust/raw/0668eed81e51d9794eb83bd3f66ec5d5102f87a1/src%2Frt%2Farch%2Fx86_64%2Fcontext.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fcontext.h?ref=0668eed81e51d9794eb83bd3f66ec5d5102f87a1", "patch": "@@ -6,6 +6,7 @@\n #include <cstdlib>\n #include <inttypes.h>\n #include <stdint.h>\n+#include <xmmintrin.h>\n \n #ifdef HAVE_VALGRIND\n #include <valgrind/memcheck.h>\n@@ -20,9 +21,11 @@ T align_down(T sp)\n }\n \n struct registers_t {\n-    uint64_t regs[7]; // Space for the volatile regs: rbx, rsp, rbp, r12:r15\n-    uint64_t xmms[6]; // Space for the volatile regs: xmm0:xmm5\n+    uint64_t regs[7];  // Space for the volatile regs: rbx, rsp, rbp, r12:r15\n     uint64_t ip;\n+\n+    // n.b.: These must be 16-byte aligned or movapd is unhappy.\n+    __m128 xmms[6]; // Space for the volatile regs: xmm0:xmm5\n };\n \n class context {"}]}