{"sha": "36e93824497c18d9b18596f96521a4bf830f83e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2ZTkzODI0NDk3YzE4ZDliMTg1OTZmOTY1MjFhNGJmODMwZjgzZTM=", "commit": {"author": {"name": "Christiaan Dirkx", "email": "christiaan@dirkx.email", "date": "2021-04-24T15:32:25Z"}, "committer": {"name": "Christiaan Dirkx", "email": "christiaan@dirkx.email", "date": "2021-04-24T15:32:25Z"}, "message": "Reuse `unix::path` and `unsupported::{io, thread_local_key}` on `hermit`", "tree": {"sha": "65db7626cdf735980afaab0af649c2c0850c0462", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/65db7626cdf735980afaab0af649c2c0850c0462"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/36e93824497c18d9b18596f96521a4bf830f83e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/36e93824497c18d9b18596f96521a4bf830f83e3", "html_url": "https://github.com/rust-lang/rust/commit/36e93824497c18d9b18596f96521a4bf830f83e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/36e93824497c18d9b18596f96521a4bf830f83e3/comments", "author": {"login": "CDirkx", "id": 11176562, "node_id": "MDQ6VXNlcjExMTc2NTYy", "avatar_url": "https://avatars.githubusercontent.com/u/11176562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CDirkx", "html_url": "https://github.com/CDirkx", "followers_url": "https://api.github.com/users/CDirkx/followers", "following_url": "https://api.github.com/users/CDirkx/following{/other_user}", "gists_url": "https://api.github.com/users/CDirkx/gists{/gist_id}", "starred_url": "https://api.github.com/users/CDirkx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CDirkx/subscriptions", "organizations_url": "https://api.github.com/users/CDirkx/orgs", "repos_url": "https://api.github.com/users/CDirkx/repos", "events_url": "https://api.github.com/users/CDirkx/events{/privacy}", "received_events_url": "https://api.github.com/users/CDirkx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CDirkx", "id": 11176562, "node_id": "MDQ6VXNlcjExMTc2NTYy", "avatar_url": "https://avatars.githubusercontent.com/u/11176562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CDirkx", "html_url": "https://github.com/CDirkx", "followers_url": "https://api.github.com/users/CDirkx/followers", "following_url": "https://api.github.com/users/CDirkx/following{/other_user}", "gists_url": "https://api.github.com/users/CDirkx/gists{/gist_id}", "starred_url": "https://api.github.com/users/CDirkx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CDirkx/subscriptions", "organizations_url": "https://api.github.com/users/CDirkx/orgs", "repos_url": "https://api.github.com/users/CDirkx/repos", "events_url": "https://api.github.com/users/CDirkx/events{/privacy}", "received_events_url": "https://api.github.com/users/CDirkx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4", "url": "https://api.github.com/repos/rust-lang/rust/commits/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4", "html_url": "https://github.com/rust-lang/rust/commit/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4"}], "stats": {"total": 95, "additions": 3, "deletions": 92}, "files": [{"sha": "d5f475b4310fde64b7f0f50154c14d345ce3788f", "filename": "library/std/src/sys/hermit/io.rs", "status": "removed", "additions": 0, "deletions": 47, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fio.rs?ref=e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4", "patch": "@@ -1,47 +0,0 @@\n-use crate::mem;\n-\n-#[derive(Copy, Clone)]\n-pub struct IoSlice<'a>(&'a [u8]);\n-\n-impl<'a> IoSlice<'a> {\n-    #[inline]\n-    pub fn new(buf: &'a [u8]) -> IoSlice<'a> {\n-        IoSlice(buf)\n-    }\n-\n-    #[inline]\n-    pub fn advance(&mut self, n: usize) {\n-        self.0 = &self.0[n..]\n-    }\n-\n-    #[inline]\n-    pub fn as_slice(&self) -> &[u8] {\n-        self.0\n-    }\n-}\n-\n-pub struct IoSliceMut<'a>(&'a mut [u8]);\n-\n-impl<'a> IoSliceMut<'a> {\n-    #[inline]\n-    pub fn new(buf: &'a mut [u8]) -> IoSliceMut<'a> {\n-        IoSliceMut(buf)\n-    }\n-\n-    #[inline]\n-    pub fn advance(&mut self, n: usize) {\n-        let slice = mem::replace(&mut self.0, &mut []);\n-        let (_, remaining) = slice.split_at_mut(n);\n-        self.0 = remaining;\n-    }\n-\n-    #[inline]\n-    pub fn as_slice(&self) -> &[u8] {\n-        self.0\n-    }\n-\n-    #[inline]\n-    pub fn as_mut_slice(&mut self) -> &mut [u8] {\n-        self.0\n-    }\n-}"}, {"sha": "b6366b105ce4f1a67f363635b769a6c1fd9c9fe7", "filename": "library/std/src/sys/hermit/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/36e93824497c18d9b18596f96521a4bf830f83e3/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36e93824497c18d9b18596f96521a4bf830f83e3/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs?ref=36e93824497c18d9b18596f96521a4bf830f83e3", "patch": "@@ -26,11 +26,13 @@ pub mod env;\n pub mod ext;\n pub mod fd;\n pub mod fs;\n+#[path = \"../unsupported/io.rs\"]\n pub mod io;\n pub mod memchr;\n pub mod mutex;\n pub mod net;\n pub mod os;\n+#[path = \"../unix/path.rs\"]\n pub mod path;\n #[path = \"../unsupported/pipe.rs\"]\n pub mod pipe;\n@@ -41,6 +43,7 @@ pub mod stack_overflow;\n pub mod stdio;\n pub mod thread;\n pub mod thread_local_dtor;\n+#[path = \"../unsupported/thread_local_key.rs\"]\n pub mod thread_local_key;\n pub mod time;\n "}, {"sha": "840a7ae04262508abc1bd81fd78a7f8fd4231363", "filename": "library/std/src/sys/hermit/path.rs", "status": "removed", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fpath.rs?ref=e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4", "patch": "@@ -1,19 +0,0 @@\n-use crate::ffi::OsStr;\n-use crate::path::Prefix;\n-\n-#[inline]\n-pub fn is_sep_byte(b: u8) -> bool {\n-    b == b'/'\n-}\n-\n-#[inline]\n-pub fn is_verbatim_sep(b: u8) -> bool {\n-    b == b'/'\n-}\n-\n-pub fn parse_prefix(_: &OsStr) -> Option<Prefix<'_>> {\n-    None\n-}\n-\n-pub const MAIN_SEP_STR: &str = \"/\";\n-pub const MAIN_SEP: char = '/';"}, {"sha": "bf1b49eb83b7e14ce8c046eb9c50aea20891a0c6", "filename": "library/std/src/sys/hermit/thread_local_key.rs", "status": "removed", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fthread_local_key.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fthread_local_key.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fthread_local_key.rs?ref=e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4", "patch": "@@ -1,26 +0,0 @@\n-pub type Key = usize;\n-\n-#[inline]\n-pub unsafe fn create(_dtor: Option<unsafe extern \"C\" fn(*mut u8)>) -> Key {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub unsafe fn set(_key: Key, _value: *mut u8) {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub unsafe fn get(_key: Key) -> *mut u8 {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub unsafe fn destroy(_key: Key) {\n-    panic!(\"should not be used on the hermit target\");\n-}\n-\n-#[inline]\n-pub fn requires_synchronized_create() -> bool {\n-    panic!(\"should not be used on the hermit target\");\n-}"}]}