{"sha": "c0f7cce96e1bf2122ce00afb735a9feb493638ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwZjdjY2U5NmUxYmYyMTIyY2UwMGFmYjczNWE5ZmViNDkzNjM4Y2E=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2017-11-14T14:01:50Z"}, "committer": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2017-11-14T14:38:34Z"}, "message": "check_unsafety: fix unused unsafe block duplication\n\nThe duplicate error message is later removed by error message\ndeduplication, but it still appears on beta and is still a bug", "tree": {"sha": "53453fc9a8aaaee02af40e4abe0809659e57cf03", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53453fc9a8aaaee02af40e4abe0809659e57cf03"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0f7cce96e1bf2122ce00afb735a9feb493638ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0f7cce96e1bf2122ce00afb735a9feb493638ca", "html_url": "https://github.com/rust-lang/rust/commit/c0f7cce96e1bf2122ce00afb735a9feb493638ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0f7cce96e1bf2122ce00afb735a9feb493638ca/comments", "author": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5a3ab2e81c837df95a21758b00aeb4e88477b30", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5a3ab2e81c837df95a21758b00aeb4e88477b30", "html_url": "https://github.com/rust-lang/rust/commit/b5a3ab2e81c837df95a21758b00aeb4e88477b30"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "86d5f1fd1b96784698b8161ad8f2c8b692c91433", "filename": "src/librustc_mir/transform/check_unsafety.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c0f7cce96e1bf2122ce00afb735a9feb493638ca/src%2Flibrustc_mir%2Ftransform%2Fcheck_unsafety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0f7cce96e1bf2122ce00afb735a9feb493638ca/src%2Flibrustc_mir%2Ftransform%2Fcheck_unsafety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_unsafety.rs?ref=c0f7cce96e1bf2122ce00afb735a9feb493638ca", "patch": "@@ -128,7 +128,6 @@ impl<'a, 'tcx> Visitor<'tcx> for UnsafetyChecker<'a, 'tcx> {\n                     let UnsafetyCheckResult {\n                         violations, unsafe_blocks\n                     } = self.tcx.unsafety_check_result(def_id);\n-                    self.inherited_blocks.extend(unsafe_blocks.iter().cloned());\n                     self.register_violations(&violations, &unsafe_blocks);\n                 }\n             }"}, {"sha": "be6b1e30a59da48015c8abdee5c22b2d47bdef32", "filename": "src/test/ui/issue-45107-unnecessary-unsafe-in-closure.stderr", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/c0f7cce96e1bf2122ce00afb735a9feb493638ca/src%2Ftest%2Fui%2Fissue-45107-unnecessary-unsafe-in-closure.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c0f7cce96e1bf2122ce00afb735a9feb493638ca/src%2Ftest%2Fui%2Fissue-45107-unnecessary-unsafe-in-closure.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-45107-unnecessary-unsafe-in-closure.stderr?ref=c0f7cce96e1bf2122ce00afb735a9feb493638ca", "patch": "@@ -36,15 +36,16 @@ error: unnecessary `unsafe` block\n    | |_________________^ unnecessary `unsafe` block\n    |\n note: because it's nested under this `unsafe` block\n-  --> $DIR/issue-45107-unnecessary-unsafe-in-closure.rs:17:13\n+  --> $DIR/issue-45107-unnecessary-unsafe-in-closure.rs:15:5\n    |\n-17 | /             unsafe {\n+15 | /     unsafe {\n+16 | |         let f = |v: &mut Vec<_>| {\n+17 | |             unsafe {\n 18 | |                 v.set_len(24);\n-19 | |                 |w: &mut Vec<u32>| { unsafe {\n-20 | |                     w.set_len(32);\n-21 | |                 } };\n-22 | |             }\n-   | |_____________^\n+...  |\n+29 | |         f(&mut v);\n+30 | |     }\n+   | |_____^\n \n error: unnecessary `unsafe` block\n   --> $DIR/issue-45107-unnecessary-unsafe-in-closure.rs:23:34\n@@ -67,5 +68,5 @@ note: because it's nested under this `unsafe` block\n 30 | |     }\n    | |_____^\n \n-error: aborting due to 6 previous errors\n+error: aborting due to 3 previous errors\n "}]}