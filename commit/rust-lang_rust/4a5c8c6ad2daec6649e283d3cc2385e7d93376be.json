{"sha": "4a5c8c6ad2daec6649e283d3cc2385e7d93376be", "node_id": "C_kwDOAAsO6NoAKDRhNWM4YzZhZDJkYWVjNjY0OWUyODNkM2NjMjM4NWU3ZDkzMzc2YmU", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-12-20T18:11:21Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-12-20T18:17:31Z"}, "message": "fix: Fix windows not finding the pdb file", "tree": {"sha": "e069f82216d46c98eae0f757ceed29774cafbbd3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e069f82216d46c98eae0f757ceed29774cafbbd3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a5c8c6ad2daec6649e283d3cc2385e7d93376be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a5c8c6ad2daec6649e283d3cc2385e7d93376be", "html_url": "https://github.com/rust-lang/rust/commit/4a5c8c6ad2daec6649e283d3cc2385e7d93376be", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a5c8c6ad2daec6649e283d3cc2385e7d93376be/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5206946674c2f6b15d476eced4faa442e607e049", "url": "https://api.github.com/repos/rust-lang/rust/commits/5206946674c2f6b15d476eced4faa442e607e049", "html_url": "https://github.com/rust-lang/rust/commit/5206946674c2f6b15d476eced4faa442e607e049"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "567cdc48ef4ee23eee677d70306436318266c9b8", "filename": "crates/rust-analyzer/src/bin/main.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/4a5c8c6ad2daec6649e283d3cc2385e7d93376be/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a5c8c6ad2daec6649e283d3cc2385e7d93376be/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs?ref=4a5c8c6ad2daec6649e283d3cc2385e7d93376be", "patch": "@@ -93,6 +93,18 @@ fn try_main() -> Result<()> {\n }\n \n fn setup_logging(log_file: Option<&Path>) -> Result<()> {\n+    if cfg!(windows) {\n+        // This is required so that windows finds our pdb that is placed right beside the exe.\n+        // By default it doesn't look at the folder the exe resides in, only in the current working\n+        // directory which we set to the project workspace.\n+        // https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/general-environment-variables\n+        // https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/nf-dbghelp-syminitialize\n+        if let Ok(path) = env::current_exe() {\n+            if let Some(path) = path.parent() {\n+                env::set_var(\"_NT_SYMBOL_PATH\", path);\n+            }\n+        }\n+    }\n     if env::var(\"RUST_BACKTRACE\").is_err() {\n         env::set_var(\"RUST_BACKTRACE\", \"short\");\n     }"}]}