{"sha": "ab7c4464920531559c4da0a9e9b8972ae2443ed1", "node_id": "C_kwDOAAsO6NoAKGFiN2M0NDY0OTIwNTMxNTU5YzRkYTBhOWU5Yjg5NzJhZTI0NDNlZDE", "commit": {"author": {"name": "ThePuzzlemaker", "email": "tpzker@thepuzzlemaker.info", "date": "2021-12-29T01:39:33Z"}, "committer": {"name": "ThePuzzlemaker", "email": "tpzker@thepuzzlemaker.info", "date": "2021-12-29T01:43:36Z"}, "message": "Add regression test for #92308\n\nThis amends off of an existing test introduced in #81769, if you think I\nshould make a separate test I will.", "tree": {"sha": "fb8b6219095e424057502dd36bcfd053adaf26cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fb8b6219095e424057502dd36bcfd053adaf26cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ab7c4464920531559c4da0a9e9b8972ae2443ed1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEcJXCCpIkPbZRdwewlozZ1xyfu2wFAmHLvUsACgkQlozZ1xyf\nu2wGsQv5AWidUvEBeUumcAI1pvL3EwhS8omIby2r9+sIDgjH883S3wect9LkoAYK\n2M8aOquQQlIvAPquVaGfk1S4WEOGIlvY4v/LQ0Ey5qfFurFKYQWLjmHiJwpk6LEr\nTjB4+kJQ5PTsvJb3IXnNQocNSaguz+tY2eDqhydXZs0FjDwuJPLhskW7Bx6WXfyl\nakwN1ZjuSnzPUpUyrAEA/lj8UXVSAPGBtRQ6pTeN/1Y5AJ3plyZYbWWL3e1rWftW\naWk/e0o0xCWQgRsEkDF8QZFRjAgAhpYkCmdpE8k/svtHCZgnHdTGRTyBDygrBLKE\nzYFjOV1bupJTIpeBw/zPuVSRr+76F8nwvorVmwPAhZjD+3f0OJW43uFV44+dqQWZ\nz/plB5upfHHplxwYQD9b3GMvNmjZG/1191tBy730p6fAe4Aqx/i11NmULaoH4qMH\ndFphyI74os852r9gR74bYtWC8yCQxihil9I1hCkyWB/at/Gxl/FYvmCokzSvUP9Q\nqvPyNTyW\n=m1XN\n-----END PGP SIGNATURE-----", "payload": "tree fb8b6219095e424057502dd36bcfd053adaf26cc\nparent eddf80698fb27165893c7ebfccd2d3228a959d81\nauthor ThePuzzlemaker <tpzker@thepuzzlemaker.info> 1640741973 -0600\ncommitter ThePuzzlemaker <tpzker@thepuzzlemaker.info> 1640742216 -0600\n\nAdd regression test for #92308\n\nThis amends off of an existing test introduced in #81769, if you think I\nshould make a separate test I will.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ab7c4464920531559c4da0a9e9b8972ae2443ed1", "html_url": "https://github.com/rust-lang/rust/commit/ab7c4464920531559c4da0a9e9b8972ae2443ed1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ab7c4464920531559c4da0a9e9b8972ae2443ed1/comments", "author": {"login": "ThePuzzlemaker", "id": 12666617, "node_id": "MDQ6VXNlcjEyNjY2NjE3", "avatar_url": "https://avatars.githubusercontent.com/u/12666617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThePuzzlemaker", "html_url": "https://github.com/ThePuzzlemaker", "followers_url": "https://api.github.com/users/ThePuzzlemaker/followers", "following_url": "https://api.github.com/users/ThePuzzlemaker/following{/other_user}", "gists_url": "https://api.github.com/users/ThePuzzlemaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThePuzzlemaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThePuzzlemaker/subscriptions", "organizations_url": "https://api.github.com/users/ThePuzzlemaker/orgs", "repos_url": "https://api.github.com/users/ThePuzzlemaker/repos", "events_url": "https://api.github.com/users/ThePuzzlemaker/events{/privacy}", "received_events_url": "https://api.github.com/users/ThePuzzlemaker/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ThePuzzlemaker", "id": 12666617, "node_id": "MDQ6VXNlcjEyNjY2NjE3", "avatar_url": "https://avatars.githubusercontent.com/u/12666617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThePuzzlemaker", "html_url": "https://github.com/ThePuzzlemaker", "followers_url": "https://api.github.com/users/ThePuzzlemaker/followers", "following_url": "https://api.github.com/users/ThePuzzlemaker/following{/other_user}", "gists_url": "https://api.github.com/users/ThePuzzlemaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThePuzzlemaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThePuzzlemaker/subscriptions", "organizations_url": "https://api.github.com/users/ThePuzzlemaker/orgs", "repos_url": "https://api.github.com/users/ThePuzzlemaker/repos", "events_url": "https://api.github.com/users/ThePuzzlemaker/events{/privacy}", "received_events_url": "https://api.github.com/users/ThePuzzlemaker/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eddf80698fb27165893c7ebfccd2d3228a959d81", "url": "https://api.github.com/repos/rust-lang/rust/commits/eddf80698fb27165893c7ebfccd2d3228a959d81", "html_url": "https://github.com/rust-lang/rust/commit/eddf80698fb27165893c7ebfccd2d3228a959d81"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "2c3610fb24d4e952e72299ca597ea1e8b6760b4d", "filename": "src/test/ui/return/tail-expr-as-potential-return.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/ab7c4464920531559c4da0a9e9b8972ae2443ed1/src%2Ftest%2Fui%2Freturn%2Ftail-expr-as-potential-return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab7c4464920531559c4da0a9e9b8972ae2443ed1/src%2Ftest%2Fui%2Freturn%2Ftail-expr-as-potential-return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Freturn%2Ftail-expr-as-potential-return.rs?ref=ab7c4464920531559c4da0a9e9b8972ae2443ed1", "patch": "@@ -1,10 +1,32 @@\n+// > Suggest `return`ing tail expressions that match return type\n+// >\n+// > Some newcomers are confused by the behavior of tail expressions,\n+// > interpreting that \"leaving out the `;` makes it the return value\".\n+// > To help them go in the right direction, suggest using `return` instead\n+// > when applicable.\n+// (original commit description for this test)\n+//\n+// This test was amended to also serve as a regression test for #92308, where\n+// this suggestion would not trigger with async functions.\n+//\n+// edition:2018\n+\n fn main() {\n     let _ = foo(true);\n }\n \n fn foo(x: bool) -> Result<f64, i32> {\n     if x {\n         Err(42) //~ ERROR mismatched types\n+                //| HELP you might have meant to return this value\n+    }\n+    Ok(42.0)\n+}\n+\n+async fn bar(x: bool) -> Result<f64, i32> {\n+    if x {\n+        Err(42) //~ ERROR mismatched types\n+                //| HELP you might have meant to return this value\n     }\n     Ok(42.0)\n }"}, {"sha": "dec1cbc4624ef5bece1d9262d612b21663ccb1e7", "filename": "src/test/ui/return/tail-expr-as-potential-return.stderr", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/ab7c4464920531559c4da0a9e9b8972ae2443ed1/src%2Ftest%2Fui%2Freturn%2Ftail-expr-as-potential-return.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ab7c4464920531559c4da0a9e9b8972ae2443ed1/src%2Ftest%2Fui%2Freturn%2Ftail-expr-as-potential-return.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Freturn%2Ftail-expr-as-potential-return.stderr?ref=ab7c4464920531559c4da0a9e9b8972ae2443ed1", "patch": "@@ -1,9 +1,10 @@\n error[E0308]: mismatched types\n-  --> $DIR/tail-expr-as-potential-return.rs:7:9\n+  --> $DIR/tail-expr-as-potential-return.rs:28:9\n    |\n LL | /     if x {\n LL | |         Err(42)\n    | |         ^^^^^^^ expected `()`, found enum `Result`\n+LL | |                 //| HELP you might have meant to return this value\n LL | |     }\n    | |_____- expected this to be `()`\n    |\n@@ -14,6 +15,23 @@ help: you might have meant to return this value\n LL |         return Err(42);\n    |         ++++++        +\n \n-error: aborting due to previous error\n+error[E0308]: mismatched types\n+  --> $DIR/tail-expr-as-potential-return.rs:20:9\n+   |\n+LL | /     if x {\n+LL | |         Err(42)\n+   | |         ^^^^^^^ expected `()`, found enum `Result`\n+LL | |                 //| HELP you might have meant to return this value\n+LL | |     }\n+   | |_____- expected this to be `()`\n+   |\n+   = note: expected unit type `()`\n+                   found enum `Result<_, {integer}>`\n+help: you might have meant to return this value\n+   |\n+LL |         return Err(42);\n+   |         ++++++        +\n+\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0308`."}]}