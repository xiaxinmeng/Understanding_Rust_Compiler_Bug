{"sha": "26186d7ff247b74287f21dfebcd08d0d5e0152aa", "node_id": "C_kwDOAAsO6NoAKDI2MTg2ZDdmZjI0N2I3NDI4N2YyMWRmZWJjZDA4ZDBkNWUwMTUyYWE", "commit": {"author": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2022-10-15T00:04:27Z"}, "committer": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2022-10-15T00:04:27Z"}, "message": "Add a test", "tree": {"sha": "89469d966a937b6624d90409351ad4daaf66a40c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/89469d966a937b6624d90409351ad4daaf66a40c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/26186d7ff247b74287f21dfebcd08d0d5e0152aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/26186d7ff247b74287f21dfebcd08d0d5e0152aa", "html_url": "https://github.com/rust-lang/rust/commit/26186d7ff247b74287f21dfebcd08d0d5e0152aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/26186d7ff247b74287f21dfebcd08d0d5e0152aa/comments", "author": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79cd6f38f3546505f5e7a6e5ce4f696ea6b19d19", "url": "https://api.github.com/repos/rust-lang/rust/commits/79cd6f38f3546505f5e7a6e5ce4f696ea6b19d19", "html_url": "https://github.com/rust-lang/rust/commit/79cd6f38f3546505f5e7a6e5ce4f696ea6b19d19"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "8d96a2e1ca9918720dc1cf8b935464e55febf19d", "filename": "src/tools/miri/tests/pass/stacked-borrows/stack-printing.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/26186d7ff247b74287f21dfebcd08d0d5e0152aa/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Fstack-printing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26186d7ff247b74287f21dfebcd08d0d5e0152aa/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Fstack-printing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Fstack-printing.rs?ref=26186d7ff247b74287f21dfebcd08d0d5e0152aa", "patch": "@@ -0,0 +1,29 @@\n+use std::{\n+    alloc::{self, Layout},\n+    mem::ManuallyDrop,\n+};\n+\n+extern \"Rust\" {\n+    fn miri_get_alloc_id(ptr: *const u8) -> u64;\n+    fn miri_print_stacks(alloc_id: u64);\n+}\n+\n+fn main() {\n+    let ptr = unsafe { alloc::alloc(Layout::new::<u8>()) };\n+    let alloc_id = unsafe { miri_get_alloc_id(ptr) };\n+    unsafe { miri_print_stacks(alloc_id) };\n+\n+    assert!(!ptr.is_null());\n+    unsafe { miri_print_stacks(alloc_id) };\n+\n+    unsafe { *ptr = 42 };\n+    unsafe { miri_print_stacks(alloc_id) };\n+\n+    let _b = unsafe { ManuallyDrop::new(Box::from_raw(ptr)) };\n+    unsafe { miri_print_stacks(alloc_id) };\n+\n+    let _ptr = unsafe { &*ptr };\n+    unsafe { miri_print_stacks(alloc_id) };\n+\n+    unsafe { alloc::dealloc(ptr, Layout::new::<u8>()) };\n+}"}, {"sha": "6d4f15453d27dde7ab2fb32633ef04b9b35ba287", "filename": "src/tools/miri/tests/pass/stacked-borrows/stack-printing.stdout", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/26186d7ff247b74287f21dfebcd08d0d5e0152aa/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Fstack-printing.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/26186d7ff247b74287f21dfebcd08d0d5e0152aa/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Fstack-printing.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Fstack-printing.stdout?ref=26186d7ff247b74287f21dfebcd08d0d5e0152aa", "patch": "@@ -0,0 +1,5 @@\n+0..1: [ SharedReadWrite<2794> ]\n+0..1: [ SharedReadWrite<2794> ]\n+0..1: [ SharedReadWrite<2794> ]\n+0..1: [ SharedReadWrite<2794> Unique<2822> Unique<2823> Unique<2824> Unique<2828> Unique<2830> ]\n+0..1: [ SharedReadWrite<2794> Disabled<2822> Disabled<2823> Disabled<2824> Disabled<2828> Disabled<2830> SharedReadOnly<2832> ]"}]}