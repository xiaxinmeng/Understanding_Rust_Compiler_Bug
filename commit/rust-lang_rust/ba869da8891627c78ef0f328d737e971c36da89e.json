{"sha": "ba869da8891627c78ef0f328d737e971c36da89e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJhODY5ZGE4ODkxNjI3Yzc4ZWYwZjMyOGQ3MzdlOTcxYzM2ZGE4OWU=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-07-23T19:31:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-23T19:31:05Z"}, "message": "Rollup merge of #87185 - waterlens:issue-86499-fix, r=Mark-Simulacrum\n\nFix panics on Windows when the build was cancelled\n\nFixes #86499\n\ncc `@jyn514`", "tree": {"sha": "508953fcaa861eca2d42093d8231e1228054b156", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/508953fcaa861eca2d42093d8231e1228054b156"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba869da8891627c78ef0f328d737e971c36da89e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg+xj6CRBK7hj4Ov3rIwAAxQYIAHJVUSH+Ag1yWiV2B80MEGgZ\nQVw/JcDaUX5vtkVHwnVmSKjxr9OHBigO0R9tk3VDuNdmyqGkzigsw7mULGVGhWmq\nqszOKvIS7ItqDOWoGdilh1MtXSeECNgi9nX6DCzyGHRW6D45pPV+5EpDuaWAOZII\nGlDeJx0+eCi8s3HSF+QaarQDqF5Avia0I7ronLyYeSZZTdx6ObCX+WsurCP8aG48\nERjzd/StQoUHwzoH98ELHPJCN7+3D/NythrHArOoXhmhyBKixHz366er9ky7zWzT\nnd2B10EpYya0bNU9FF4WL73mHDodB0wzw1k1/g7+zpml1WUhMrlc9WWqXr1+nTE=\n=iMuM\n-----END PGP SIGNATURE-----\n", "payload": "tree 508953fcaa861eca2d42093d8231e1228054b156\nparent f335bca8a5a8d754cbe3832e80b40165cd7ec6e3\nparent 3c384cee52e002244caaa0ef0288aadcb85be691\nauthor Yuki Okushi <jtitor@2k36.org> 1627068665 +0900\ncommitter GitHub <noreply@github.com> 1627068665 +0900\n\nRollup merge of #87185 - waterlens:issue-86499-fix, r=Mark-Simulacrum\n\nFix panics on Windows when the build was cancelled\n\nFixes #86499\n\ncc `@jyn514`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba869da8891627c78ef0f328d737e971c36da89e", "html_url": "https://github.com/rust-lang/rust/commit/ba869da8891627c78ef0f328d737e971c36da89e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba869da8891627c78ef0f328d737e971c36da89e/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f335bca8a5a8d754cbe3832e80b40165cd7ec6e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/f335bca8a5a8d754cbe3832e80b40165cd7ec6e3", "html_url": "https://github.com/rust-lang/rust/commit/f335bca8a5a8d754cbe3832e80b40165cd7ec6e3"}, {"sha": "3c384cee52e002244caaa0ef0288aadcb85be691", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c384cee52e002244caaa0ef0288aadcb85be691", "html_url": "https://github.com/rust-lang/rust/commit/3c384cee52e002244caaa0ef0288aadcb85be691"}], "stats": {"total": 20, "additions": 14, "deletions": 6}, "files": [{"sha": "5c0322e18a4ab9fff09fa2b62be5592c546aa08d", "filename": "src/bootstrap/job.rs", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/ba869da8891627c78ef0f328d737e971c36da89e/src%2Fbootstrap%2Fjob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba869da8891627c78ef0f328d737e971c36da89e/src%2Fbootstrap%2Fjob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fjob.rs?ref=ba869da8891627c78ef0f328d737e971c36da89e", "patch": "@@ -103,12 +103,20 @@ pub unsafe fn setup(build: &mut Build) {\n     };\n \n     let parent = OpenProcess(PROCESS_DUP_HANDLE, FALSE, pid.parse().unwrap());\n-    assert!(\n-        !parent.is_null(),\n-        \"PID `{}` doesn't seem to exist: {}\",\n-        pid,\n-        io::Error::last_os_error()\n-    );\n+\n+    // If we get a null parent pointer here, it is possible that either\n+    // we have got an invalid pid or the parent process has been closed.\n+    // Since the first case rarely happens\n+    // (only when wrongly setting the environmental variable),\n+    // so it might be better to improve the experience of the second case\n+    // when users have interrupted the parent process and we don't finish\n+    // duplicating the handle yet.\n+    // We just need close the job object if that occurs.\n+    if parent.is_null() {\n+        CloseHandle(job);\n+        return;\n+    }\n+\n     let mut parent_handle = ptr::null_mut();\n     let r = DuplicateHandle(\n         GetCurrentProcess(),"}]}