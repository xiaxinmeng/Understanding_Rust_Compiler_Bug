{"sha": "919a8a5028e4b94370e9c3f6b19cda48f9c97f7b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxOWE4YTUwMjhlNGI5NDM3MGU5YzNmNmIxOWNkYTQ4ZjljOTdmN2I=", "commit": {"author": {"name": "oxalica", "email": "oxalicc@pm.me", "date": "2021-07-16T11:18:50Z"}, "committer": {"name": "oxalica", "email": "oxalicc@pm.me", "date": "2021-07-20T16:38:41Z"}, "message": "Fix NixOS detection\n\nUse `/etc/os-release` instead of `/etc/NIXOS`.\nThe latter one does not exist on NixOS when using tmpfs as root.", "tree": {"sha": "3aaa6bbb914681e6fdd8d16955c2bed17cfaf923", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3aaa6bbb914681e6fdd8d16955c2bed17cfaf923"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEXLDp5dXVcfV/VA/qztOS3gxIPQAFAmD2/BMACgkQztOS3gxI\nPQDC/w/8CV9DMWGieT3mrHFKhSoKKlkAvmp7gulAahCmq2yY1S2QShRGPVljMEy+\nfez9e4W2z2HhRDXG7Iq4APVgpGGkvyYxhvSCPJVUP4GBGBb5u2RmnfaNdX5OBrKq\ngnKfk6GbubXoWQzJrD3izizE1bZg3XtXz7KXcAH47iVlJ6ivKQPIbIWaYbcfNkR9\nGn1y3Z7KsRmejSlDmSrnHKK1oHGI9hlzNF/2Lth3nBWtn1fhPvekJJdSKRtxpj0a\nW/pUhA9ITmG+ZlIaQDSa4ZX6TxXifV1QKlVN9kO0V8d2YRmXLQJX4+dvQZxF9/tB\ncnllH5Q4oOHJ+i0/nqTHIO/kImJakBa/h2s6MFcdrhfkGjvUfpWGxoo36E0TowiV\n/VOUmfJuBAF3TrrEEF/TYUnwAvuJKRuGOaSGmprMOA0jzjb/p/lAXQkj5zZx4pu+\n1zPNzYXqczHH8PEhO1GXK9iGPhE+Ry6IPNn81hn2HUg7waeflqV53Tz6nEWQuUha\nb0wEGIZmH8WRXHt25dL4pjRbuY/bpyuuVg4QKxGqTF15n+0tQs0EnOZHgWlu/AR3\nLO8+Oruxi7ymm4rP0uVclAwwWsRMDNOsF0xteud1XuDpBrZtb8ozq+vmG0wqnIoc\nmi7h5RzdbYd1XK/78Hv+SE7HFlLoSQrjyepqhxttfJzDYSjtFbE=\n=wc9F\n-----END PGP SIGNATURE-----", "payload": "tree 3aaa6bbb914681e6fdd8d16955c2bed17cfaf923\nparent a6470c7fa8a511cfbcf9e9d3e1ab6779ac661edb\nauthor oxalica <oxalicc@pm.me> 1626434330 +0800\ncommitter oxalica <oxalicc@pm.me> 1626799121 +0800\n\nFix NixOS detection\n\nUse `/etc/os-release` instead of `/etc/NIXOS`.\nThe latter one does not exist on NixOS when using tmpfs as root.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b", "html_url": "https://github.com/rust-lang/rust/commit/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b/comments", "author": {"login": "oxalica", "id": 14816024, "node_id": "MDQ6VXNlcjE0ODE2MDI0", "avatar_url": "https://avatars.githubusercontent.com/u/14816024?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oxalica", "html_url": "https://github.com/oxalica", "followers_url": "https://api.github.com/users/oxalica/followers", "following_url": "https://api.github.com/users/oxalica/following{/other_user}", "gists_url": "https://api.github.com/users/oxalica/gists{/gist_id}", "starred_url": "https://api.github.com/users/oxalica/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oxalica/subscriptions", "organizations_url": "https://api.github.com/users/oxalica/orgs", "repos_url": "https://api.github.com/users/oxalica/repos", "events_url": "https://api.github.com/users/oxalica/events{/privacy}", "received_events_url": "https://api.github.com/users/oxalica/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oxalica", "id": 14816024, "node_id": "MDQ6VXNlcjE0ODE2MDI0", "avatar_url": "https://avatars.githubusercontent.com/u/14816024?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oxalica", "html_url": "https://github.com/oxalica", "followers_url": "https://api.github.com/users/oxalica/followers", "following_url": "https://api.github.com/users/oxalica/following{/other_user}", "gists_url": "https://api.github.com/users/oxalica/gists{/gist_id}", "starred_url": "https://api.github.com/users/oxalica/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oxalica/subscriptions", "organizations_url": "https://api.github.com/users/oxalica/orgs", "repos_url": "https://api.github.com/users/oxalica/repos", "events_url": "https://api.github.com/users/oxalica/events{/privacy}", "received_events_url": "https://api.github.com/users/oxalica/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6470c7fa8a511cfbcf9e9d3e1ab6779ac661edb", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6470c7fa8a511cfbcf9e9d3e1ab6779ac661edb", "html_url": "https://github.com/rust-lang/rust/commit/a6470c7fa8a511cfbcf9e9d3e1ab6779ac661edb"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "1c5e9d5d83736d425267e9430dcfb0608f2fc80f", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=919a8a5028e4b94370e9c3f6b19cda48f9c97f7b", "patch": "@@ -580,7 +580,13 @@ def fix_bin_or_dylib(self, fname):\n         if ostype != \"Linux\":\n             return\n \n-        if not os.path.exists(\"/etc/NIXOS\"):\n+        # Use `/etc/os-release` instead of `/etc/NIXOS`.\n+        # The latter one does not exist on NixOS when using tmpfs as root.\n+        try:\n+            with open(\"/etc/os-release\", \"r\") as f:\n+                if not any(line.strip() == \"ID=nixos\" for line in f):\n+                    return\n+        except FileNotFoundError:\n             return\n         if os.path.exists(\"/lib\"):\n             return"}]}