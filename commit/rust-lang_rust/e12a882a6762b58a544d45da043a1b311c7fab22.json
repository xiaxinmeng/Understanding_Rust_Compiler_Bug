{"sha": "e12a882a6762b58a544d45da043a1b311c7fab22", "node_id": "C_kwDOAAsO6NoAKGUxMmE4ODJhNjc2MmI1OGE1NDRkNDVkYTA0M2ExYjMxMWM3ZmFiMjI", "commit": {"author": {"name": "Afonso Bordado", "email": "afonso360@users.noreply.github.com", "date": "2022-12-03T23:23:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-03T23:23:01Z"}, "message": "S390X CI Support (#1304)", "tree": {"sha": "8a2ca86dc3796bb4e65c526a695a5d436c853a41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a2ca86dc3796bb4e65c526a695a5d436c853a41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e12a882a6762b58a544d45da043a1b311c7fab22", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJji9pVCRBK7hj4Ov3rIwAAkecIACYm7JQi5jFsWktdr7IFICPr\n4yw3WlPlPOrNUFlVhxwvj+4C3+q98VFD6UC7EE5FiTJHzKOpuIGaZJvZg3/354k3\ntDCCtKO+75NRf4ThZGGJadamM6ZAO88UfY1Tp4IpDmZCu51rji31m9J7koF3PIMH\nq09VIKBMnQPgAoHkmoDuVIjAJ/eLzlxdgEsjyXoSiog4EmdnHoGiY6iUseRlZcC2\nHWB1Hvn+4zlC00qax46a8uTWyge7h+hXqI3/TR+oBQN//QtC7FrBzZIF3eiJgrn4\nPqwngqHZ3Ap+wEZxvf0wztUOxoTJJ5t6QtLFwaCI+lh3L50VXYwgcm48BWneye0=\n=gFbC\n-----END PGP SIGNATURE-----\n", "payload": "tree 8a2ca86dc3796bb4e65c526a695a5d436c853a41\nparent f845eafc2f507fe90c787ba3cdc522ca6d5effae\nauthor Afonso Bordado <afonso360@users.noreply.github.com> 1670109781 +0000\ncommitter GitHub <noreply@github.com> 1670109781 +0100\n\nS390X CI Support (#1304)\n\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e12a882a6762b58a544d45da043a1b311c7fab22", "html_url": "https://github.com/rust-lang/rust/commit/e12a882a6762b58a544d45da043a1b311c7fab22", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e12a882a6762b58a544d45da043a1b311c7fab22/comments", "author": {"login": "afonso360", "id": 1357143, "node_id": "MDQ6VXNlcjEzNTcxNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1357143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/afonso360", "html_url": "https://github.com/afonso360", "followers_url": "https://api.github.com/users/afonso360/followers", "following_url": "https://api.github.com/users/afonso360/following{/other_user}", "gists_url": "https://api.github.com/users/afonso360/gists{/gist_id}", "starred_url": "https://api.github.com/users/afonso360/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/afonso360/subscriptions", "organizations_url": "https://api.github.com/users/afonso360/orgs", "repos_url": "https://api.github.com/users/afonso360/repos", "events_url": "https://api.github.com/users/afonso360/events{/privacy}", "received_events_url": "https://api.github.com/users/afonso360/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f845eafc2f507fe90c787ba3cdc522ca6d5effae", "url": "https://api.github.com/repos/rust-lang/rust/commits/f845eafc2f507fe90c787ba3cdc522ca6d5effae", "html_url": "https://github.com/rust-lang/rust/commit/f845eafc2f507fe90c787ba3cdc522ca6d5effae"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "babadc4d4677e56626854a85b9d0d7f34584d3e5", "filename": ".github/workflows/main.yml", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e12a882a6762b58a544d45da043a1b311c7fab22/.github%2Fworkflows%2Fmain.yml", "raw_url": "https://github.com/rust-lang/rust/raw/e12a882a6762b58a544d45da043a1b311c7fab22/.github%2Fworkflows%2Fmain.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fmain.yml?ref=e12a882a6762b58a544d45da043a1b311c7fab22", "patch": "@@ -42,6 +42,10 @@ jobs:\n           - os: ubuntu-latest\n             env:\n               TARGET_TRIPLE: aarch64-unknown-linux-gnu\n+          # s390x requires QEMU 6.1 or greater, we could build it from source, but ubuntu 22.04 comes with 6.2 by default\n+          - os: ubuntu-latest\n+            env:\n+              TARGET_TRIPLE: s390x-unknown-linux-gnu\n \n     steps:\n     - uses: actions/checkout@v3\n@@ -79,6 +83,12 @@ jobs:\n         sudo apt-get update\n         sudo apt-get install -y gcc-aarch64-linux-gnu qemu-user\n \n+    - name: Install s390x toolchain and qemu\n+      if: matrix.env.TARGET_TRIPLE == 's390x-unknown-linux-gnu'\n+      run: |\n+        sudo apt-get update\n+        sudo apt-get install -y gcc-s390x-linux-gnu qemu-user\n+\n     - name: Prepare dependencies\n       run: |\n         git config --global user.email \"user@example.com\""}, {"sha": "cbbf09b9b97b8422ab06caff3b59b34c6352dfd4", "filename": "build_system/build_sysroot.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e12a882a6762b58a544d45da043a1b311c7fab22/build_system%2Fbuild_sysroot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e12a882a6762b58a544d45da043a1b311c7fab22/build_system%2Fbuild_sysroot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fbuild_sysroot.rs?ref=e12a882a6762b58a544d45da043a1b311c7fab22", "patch": "@@ -119,10 +119,10 @@ pub(crate) fn build_sysroot(\n \n             if host_triple != target_triple {\n                 // When cross-compiling it is often necessary to manually pick the right linker\n-                let linker = if target_triple == \"aarch64-unknown-linux-gnu\" {\n-                    Some(\"aarch64-linux-gnu-gcc\")\n-                } else {\n-                    None\n+                let linker = match target_triple {\n+                    \"aarch64-unknown-linux-gnu\" => Some(\"aarch64-linux-gnu-gcc\"),\n+                    \"s390x-unknown-linux-gnu\" => Some(\"s390x-linux-gnu-gcc\"),\n+                    _ => None,\n                 };\n                 build_clif_sysroot_for_triple(\n                     dirs,"}, {"sha": "1c372736ed65d9121dccf04ae5bcf504d45127bc", "filename": "build_system/tests.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e12a882a6762b58a544d45da043a1b311c7fab22/build_system%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e12a882a6762b58a544d45da043a1b311c7fab22/build_system%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Ftests.rs?ref=e12a882a6762b58a544d45da043a1b311c7fab22", "patch": "@@ -526,6 +526,15 @@ impl TestRunner {\n                         \"/usr/aarch64-linux-gnu\".to_owned(),\n                     ];\n                 }\n+                \"s390x-unknown-linux-gnu\" => {\n+                    // We are cross-compiling for s390x. Use the correct linker and run tests in qemu.\n+                    rustflags = format!(\"-Clinker=s390x-linux-gnu-gcc{}\", rustflags);\n+                    runner = vec![\n+                        \"qemu-s390x\".to_owned(),\n+                        \"-L\".to_owned(),\n+                        \"/usr/s390x-linux-gnu\".to_owned(),\n+                    ];\n+                }\n                 \"x86_64-pc-windows-gnu\" => {\n                     // We are cross-compiling for Windows. Run tests in wine.\n                     runner = vec![\"wine\".to_owned()];"}]}