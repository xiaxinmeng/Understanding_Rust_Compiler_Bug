{"sha": "7b4f436a30f00c8b8bf533b92592385cba2ea5f1", "node_id": "C_kwDOAAsO6NoAKDdiNGY0MzZhMzBmMDBjOGI4YmY1MzNiOTI1OTIzODVjYmEyZWE1ZjE", "commit": {"author": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2023-03-26T04:03:25Z"}, "committer": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2023-03-26T04:03:25Z"}, "message": "add comments and cleanup", "tree": {"sha": "f4ca5eb3b825218a18926782f45233c0ab0b3395", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f4ca5eb3b825218a18926782f45233c0ab0b3395"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b4f436a30f00c8b8bf533b92592385cba2ea5f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b4f436a30f00c8b8bf533b92592385cba2ea5f1", "html_url": "https://github.com/rust-lang/rust/commit/7b4f436a30f00c8b8bf533b92592385cba2ea5f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b4f436a30f00c8b8bf533b92592385cba2ea5f1/comments", "author": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a860a720baa508aa28d44f4d277814a086d6bd9d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a860a720baa508aa28d44f4d277814a086d6bd9d", "html_url": "https://github.com/rust-lang/rust/commit/a860a720baa508aa28d44f4d277814a086d6bd9d"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "19c4aae97efebedbce70d3d72bbbb21a5a4fb572", "filename": "compiler/rustc_span/src/edit_distance.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7b4f436a30f00c8b8bf533b92592385cba2ea5f1/compiler%2Frustc_span%2Fsrc%2Fedit_distance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b4f436a30f00c8b8bf533b92592385cba2ea5f1/compiler%2Frustc_span%2Fsrc%2Fedit_distance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fedit_distance.rs?ref=7b4f436a30f00c8b8bf533b92592385cba2ea5f1", "patch": "@@ -190,6 +190,7 @@ fn find_best_match_for_name_impl(\n \n     let mut dist = dist.unwrap_or_else(|| cmp::max(lookup.len(), 3) / 3);\n     let mut best = None;\n+    // store the candidates with the same distance, only for `use_substring_score` current.\n     let mut next_candidates = vec![];\n     for c in candidates {\n         match if use_substring_score {\n@@ -200,19 +201,25 @@ fn find_best_match_for_name_impl(\n             Some(0) => return Some(*c),\n             Some(d) => {\n                 if use_substring_score {\n-                    dist = d;\n+                    if d < dist {\n+                        dist = d;\n+                        next_candidates.clear();\n+                    } else {\n+                        // `d == dist` here, we need to store the candidates with the same distance\n+                        // so we won't decrease the distance in the next loop.\n+                    }\n                     next_candidates.push(*c);\n-                    best = Some(*c);\n                 } else {\n                     dist = d - 1;\n-                    best = Some(*c);\n                 }\n+                best = Some(*c);\n             }\n             None => {}\n         }\n     }\n \n     if next_candidates.len() > 1 {\n+        debug_assert!(use_substring_score);\n         best = find_best_match_for_name_impl(\n             false,\n             &next_candidates,"}]}