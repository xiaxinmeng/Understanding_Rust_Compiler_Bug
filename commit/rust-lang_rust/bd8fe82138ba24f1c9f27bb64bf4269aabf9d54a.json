{"sha": "bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a", "node_id": "C_kwDOAAsO6NoAKGJkOGZlODIxMzhiYTI0ZjFjOWYyN2JiNjRiZjQyNjlhYWJmOWQ1NGE", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-28T13:40:11Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-30T07:59:22Z"}, "message": "lint: port incomplete features diagnostics\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "772ce54092e2d8a7257c59f5b23a9cc567e4538a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/772ce54092e2d8a7257c59f5b23a9cc567e4538a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a", "html_url": "https://github.com/rust-lang/rust/commit/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acea23e79617fd269dfa2ef3caca9225e87e9452", "url": "https://api.github.com/repos/rust-lang/rust/commits/acea23e79617fd269dfa2ef3caca9225e87e9452", "html_url": "https://github.com/rust-lang/rust/commit/acea23e79617fd269dfa2ef3caca9225e87e9452"}], "stats": {"total": 29, "additions": 15, "deletions": 14}, "files": [{"sha": "a1ad032099992d1d9ed56fadc4ee24d4911418ca", "filename": "compiler/rustc_error_messages/locales/en-US/lint.ftl", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl?ref=bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a", "patch": "@@ -382,3 +382,7 @@ lint-builtin-explicit-outlives = outlives requirements can be inferred\n         [one] this bound\n         *[other] these bounds\n     }\n+\n+lint-builtin-incomplete-features = the feature `{$name}` is incomplete and may not be safe to use and/or cause compiler crashes\n+    .note = see issue #{$n} <https://github.com/rust-lang/rust/issues/{$n}> for more information\n+    .help = consider using `min_{$name}` instead, which is more stable and complete"}, {"sha": "3043ae827f92fbae382f915130857cd31ba01dcf", "filename": "compiler/rustc_errors/src/diagnostic.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs?ref=bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a", "patch": "@@ -115,6 +115,12 @@ impl IntoDiagnosticArg for String {\n     }\n }\n \n+impl IntoDiagnosticArg for std::num::NonZeroU32 {\n+    fn into_diagnostic_arg(self) -> DiagnosticArgValue<'static> {\n+        DiagnosticArgValue::Str(Cow::Owned(self.to_string()))\n+    }\n+}\n+\n impl IntoDiagnosticArg for Edition {\n     fn into_diagnostic_arg(self) -> DiagnosticArgValue<'static> {\n         DiagnosticArgValue::Str(Cow::Owned(self.to_string()))"}, {"sha": "035cd358a9155fd6e925c2c0f922cd100d041388", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 5, "deletions": 14, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=bd8fe82138ba24f1c9f27bb64bf4269aabf9d54a", "patch": "@@ -2347,23 +2347,14 @@ impl EarlyLintPass for IncompleteFeatures {\n             .filter(|(&name, _)| features.incomplete(name))\n             .for_each(|(&name, &span)| {\n                 cx.struct_span_lint(INCOMPLETE_FEATURES, span, |lint| {\n-                    let mut builder = lint.build(&format!(\n-                        \"the feature `{}` is incomplete and may not be safe to use \\\n-                         and/or cause compiler crashes\",\n-                        name,\n-                    ));\n+                    let mut builder = lint.build(fluent::lint::builtin_incomplete_features);\n+                    builder.set_arg(\"name\", name);\n                     if let Some(n) = rustc_feature::find_feature_issue(name, GateIssue::Language) {\n-                        builder.note(&format!(\n-                            \"see issue #{} <https://github.com/rust-lang/rust/issues/{}> \\\n-                             for more information\",\n-                            n, n,\n-                        ));\n+                        builder.set_arg(\"n\", n);\n+                        builder.note(fluent::lint::note);\n                     }\n                     if HAS_MIN_FEATURES.contains(&name) {\n-                        builder.help(&format!(\n-                            \"consider using `min_{}` instead, which is more stable and complete\",\n-                            name,\n-                        ));\n+                        builder.help(fluent::lint::help);\n                     }\n                     builder.emit();\n                 })"}]}