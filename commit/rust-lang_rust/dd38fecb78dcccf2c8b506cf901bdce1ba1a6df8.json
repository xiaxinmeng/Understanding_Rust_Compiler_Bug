{"sha": "dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8", "node_id": "C_kwDOAAsO6NoAKGRkMzhmZWNiNzhkY2NjZjJjOGI1MDZjZjkwMWJkY2UxYmExYTZkZjg", "commit": {"author": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2022-06-04T18:31:17Z"}, "committer": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2022-06-04T21:32:27Z"}, "message": "Fix pretty printing named bound regions under -Zverbose", "tree": {"sha": "428a61e08819aeb788731d4c10b93524f723715c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/428a61e08819aeb788731d4c10b93524f723715c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8", "html_url": "https://github.com/rust-lang/rust/commit/dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8/comments", "author": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7b0452ece11bf714f7cf2003747231931504d59", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7b0452ece11bf714f7cf2003747231931504d59", "html_url": "https://github.com/rust-lang/rust/commit/c7b0452ece11bf714f7cf2003747231931504d59"}], "stats": {"total": 54, "additions": 30, "deletions": 24}, "files": [{"sha": "08879afa64a0ebaa601d0e5e24e2a9a1fbd27a51", "filename": "compiler/rustc_middle/src/ty/print/pretty.rs", "status": "modified", "additions": 30, "deletions": 24, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs?ref=dd38fecb78dcccf2c8b506cf901bdce1ba1a6df8", "patch": "@@ -2190,34 +2190,40 @@ impl<'tcx> FmtPrinter<'_, 'tcx> {\n         // this is not *quite* right and changes the ordering of some output\n         // anyways.\n         let (new_value, map) = if self.tcx().sess.verbose() {\n-            // anon index + 1 (BrEnv takes 0) -> name\n-            let mut region_map: FxHashMap<_, _> = Default::default();\n-            let bound_vars = value.bound_vars();\n-            for var in bound_vars {\n-                let ty::BoundVariableKind::Region(var) = var else { continue };\n-                match var {\n-                    ty::BrAnon(_) | ty::BrEnv => {\n-                        start_or_continue(&mut self, \"for<\", \", \");\n-                        let name = next_name(&self);\n-                        do_continue(&mut self, name);\n-                        region_map.insert(var, ty::BrNamed(CRATE_DEF_ID.to_def_id(), name));\n-                    }\n-                    ty::BrNamed(def_id, kw::UnderscoreLifetime) => {\n-                        start_or_continue(&mut self, \"for<\", \", \");\n-                        let name = next_name(&self);\n-                        do_continue(&mut self, name);\n-                        region_map.insert(var, ty::BrNamed(def_id, name));\n-                    }\n-                    ty::BrNamed(_, name) => {\n-                        start_or_continue(&mut self, \"for<\", \", \");\n-                        do_continue(&mut self, name);\n+            let regions: Vec<_> = value\n+                .bound_vars()\n+                .into_iter()\n+                .map(|var| {\n+                    let ty::BoundVariableKind::Region(var) = var else {\n+                    // This doesn't really matter because it doesn't get used,\n+                    // it's just an empty value\n+                    return ty::BrAnon(0);\n+                };\n+                    match var {\n+                        ty::BrAnon(_) | ty::BrEnv => {\n+                            start_or_continue(&mut self, \"for<\", \", \");\n+                            let name = next_name(&self);\n+                            do_continue(&mut self, name);\n+                            ty::BrNamed(CRATE_DEF_ID.to_def_id(), name)\n+                        }\n+                        ty::BrNamed(def_id, kw::UnderscoreLifetime) => {\n+                            start_or_continue(&mut self, \"for<\", \", \");\n+                            let name = next_name(&self);\n+                            do_continue(&mut self, name);\n+                            ty::BrNamed(def_id, name)\n+                        }\n+                        ty::BrNamed(def_id, name) => {\n+                            start_or_continue(&mut self, \"for<\", \", \");\n+                            do_continue(&mut self, name);\n+                            ty::BrNamed(def_id, name)\n+                        }\n                     }\n-                }\n-            }\n+                })\n+                .collect();\n             start_or_continue(&mut self, \"\", \"> \");\n \n             self.tcx.replace_late_bound_regions(value.clone(), |br| {\n-                let kind = region_map[&br.kind];\n+                let kind = regions[br.var.as_usize()];\n                 self.tcx.mk_region(ty::ReLateBound(\n                     ty::INNERMOST,\n                     ty::BoundRegion { var: br.var, kind },"}]}