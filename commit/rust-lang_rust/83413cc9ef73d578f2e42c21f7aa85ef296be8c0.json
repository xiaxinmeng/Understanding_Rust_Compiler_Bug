{"sha": "83413cc9ef73d578f2e42c21f7aa85ef296be8c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzNDEzY2M5ZWY3M2Q1NzhmMmU0MmMyMWY3YWE4NWVmMjk2YmU4YzA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-08-19T08:05:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-08-19T08:05:39Z"}, "message": "Merge #1696\n\n1696: fix #1424 r=matklad a=coderfox\n\n- resolve \"~\" in raLspServerPath\r\n\r\nI think expanding simply `~/` is quite simple as node provides `homedir`, but expanding `~foo/` is difficult as there is no cross-platform approach of reading home directory of another user. So this pull request only resolves `~/` in `raLspServerPath`.\r\n\r\nBesides, the source code is arranged in a way hard to write tests. Would anyone provide me with instructions of writing tests for this feature, or no test is required for this feature?\n\nCo-authored-by: xfoxfu <i@xfox.me>", "tree": {"sha": "12bb8180259d4e9c9cf54c5c42ebf99792fd4f15", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/12bb8180259d4e9c9cf54c5c42ebf99792fd4f15"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/83413cc9ef73d578f2e42c21f7aa85ef296be8c0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdWlhTCRBK7hj4Ov3rIwAAdHIIAHUAtzc9ZxtTtAqj4kgAq8Aq\nJwrS1KYFhZWZmeEutZCD/Q/VtqHOSD8+POEqAwGBP4uQtNxbKIUGfX955Rnkl5CA\n6YF3iNhIPJUeUnQP3smHsWTd5xhvz56YQYe3aVcFL2r7c2Fx8fGq8YU7JMUuGhGs\nsgdvcVWJVn2oamydfFBT2O625bwr/Edw0EuMpFxwIXCrXMVc4zcLjPg8BS96Dh5L\n9sDnga+zl+fVvcl733ps6L1vD/Jw7iBYo5lopvf0H/yeEkxR2S9QnXaCoo1nl5Hn\nSZ/RQq9eq25oweTuf2aRuCFlbN0rTOxnrvKWDFRiDWpmy9Ywz0N/3oAbuYHeay0=\n=6brk\n-----END PGP SIGNATURE-----\n", "payload": "tree 12bb8180259d4e9c9cf54c5c42ebf99792fd4f15\nparent 2bac1bdf174a053f0727e982f0f92d068ef3c208\nparent d07a85ed7e0ed3baac6e8fc66cd27116056e9810\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1566201939 +0000\ncommitter GitHub <noreply@github.com> 1566201939 +0000\n\nMerge #1696\n\n1696: fix #1424 r=matklad a=coderfox\n\n- resolve \"~\" in raLspServerPath\r\n\r\nI think expanding simply `~/` is quite simple as node provides `homedir`, but expanding `~foo/` is difficult as there is no cross-platform approach of reading home directory of another user. So this pull request only resolves `~/` in `raLspServerPath`.\r\n\r\nBesides, the source code is arranged in a way hard to write tests. Would anyone provide me with instructions of writing tests for this feature, or no test is required for this feature?\n\nCo-authored-by: xfoxfu <i@xfox.me>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/83413cc9ef73d578f2e42c21f7aa85ef296be8c0", "html_url": "https://github.com/rust-lang/rust/commit/83413cc9ef73d578f2e42c21f7aa85ef296be8c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/83413cc9ef73d578f2e42c21f7aa85ef296be8c0/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2bac1bdf174a053f0727e982f0f92d068ef3c208", "url": "https://api.github.com/repos/rust-lang/rust/commits/2bac1bdf174a053f0727e982f0f92d068ef3c208", "html_url": "https://github.com/rust-lang/rust/commit/2bac1bdf174a053f0727e982f0f92d068ef3c208"}, {"sha": "d07a85ed7e0ed3baac6e8fc66cd27116056e9810", "url": "https://api.github.com/repos/rust-lang/rust/commits/d07a85ed7e0ed3baac6e8fc66cd27116056e9810", "html_url": "https://github.com/rust-lang/rust/commit/d07a85ed7e0ed3baac6e8fc66cd27116056e9810"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "3273d874970dcbcfe63487721c0acf36cff6c396", "filename": "editors/code/src/server.ts", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/83413cc9ef73d578f2e42c21f7aa85ef296be8c0/editors%2Fcode%2Fsrc%2Fserver.ts", "raw_url": "https://github.com/rust-lang/rust/raw/83413cc9ef73d578f2e42c21f7aa85ef296be8c0/editors%2Fcode%2Fsrc%2Fserver.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fserver.ts?ref=83413cc9ef73d578f2e42c21f7aa85ef296be8c0", "patch": "@@ -1,9 +1,17 @@\n+import { homedir } from 'os';\n import * as lc from 'vscode-languageclient';\n \n import { window, workspace } from 'vscode';\n import { Config } from './config';\n import { Highlighter } from './highlighting';\n \n+function expandPathResolving(path: string) {\n+    if (path.startsWith('~/')) {\n+        return path.replace('~', homedir());\n+    }\n+    return path;\n+}\n+\n export class Server {\n     public static highlighter = new Highlighter();\n     public static config = new Config();\n@@ -20,7 +28,7 @@ export class Server {\n         }\n \n         const run: lc.Executable = {\n-            command: this.config.raLspServerPath,\n+            command: expandPathResolving(this.config.raLspServerPath),\n             options: { cwd: folder }\n         };\n         const serverOptions: lc.ServerOptions = {"}]}