{"sha": "06e4ff4d61f44d7e239e02256829ecf1e5598657", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA2ZTRmZjRkNjFmNDRkN2UyMzllMDIyNTY4MjllY2YxZTU1OTg2NTc=", "commit": {"author": {"name": "Jon Gjengset", "email": "jon@thesquareplanet.com", "date": "2019-09-27T21:15:17Z"}, "committer": {"name": "Jon Gjengset", "email": "jon@thesquareplanet.com", "date": "2019-09-27T21:36:45Z"}, "message": "Scope format! temporaries\n\nThis places the temporaries that `format!` generates to refer to its\narguments (through `&dyn Trait`) in a short-lived scope surrounding just\nthe invocation of `format!`. This enables `format!` to be used in\ngenerators without the temporaries preventing the generator from being\n`Send` (due to `dyn Trait` not being `Sync`).\n\nSee rust-lang/rust#64477 for details.", "tree": {"sha": "d6e8a9c4fb57b4b43bbe3b85808d6b2b54b030e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d6e8a9c4fb57b4b43bbe3b85808d6b2b54b030e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/06e4ff4d61f44d7e239e02256829ecf1e5598657", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTvXA7jm7mAcrpPvqv66ot2GtpfTAUCXY6A7gAKCRD66ot2Gtpf\nTKZZAPsHLu4A3NN6Yyr6/IlukHUhLzVim7cF3d6YNBknpcsh6wD7BKPhRwm7pGS8\nYX0TJPFyWHs3FOB9nGMwAffnYfmXyA0=\n=vrSz\n-----END PGP SIGNATURE-----", "payload": "tree d6e8a9c4fb57b4b43bbe3b85808d6b2b54b030e1\nparent a37fe2de697bb1a9d304e4e811836e125f944cd5\nauthor Jon Gjengset <jon@thesquareplanet.com> 1569618917 -0400\ncommitter Jon Gjengset <jon@thesquareplanet.com> 1569620205 -0400\n\nScope format! temporaries\n\nThis places the temporaries that `format!` generates to refer to its\narguments (through `&dyn Trait`) in a short-lived scope surrounding just\nthe invocation of `format!`. This enables `format!` to be used in\ngenerators without the temporaries preventing the generator from being\n`Send` (due to `dyn Trait` not being `Sync`).\n\nSee rust-lang/rust#64477 for details.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/06e4ff4d61f44d7e239e02256829ecf1e5598657", "html_url": "https://github.com/rust-lang/rust/commit/06e4ff4d61f44d7e239e02256829ecf1e5598657", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/06e4ff4d61f44d7e239e02256829ecf1e5598657/comments", "author": {"login": "jonhoo", "id": 176295, "node_id": "MDQ6VXNlcjE3NjI5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/176295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonhoo", "html_url": "https://github.com/jonhoo", "followers_url": "https://api.github.com/users/jonhoo/followers", "following_url": "https://api.github.com/users/jonhoo/following{/other_user}", "gists_url": "https://api.github.com/users/jonhoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonhoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonhoo/subscriptions", "organizations_url": "https://api.github.com/users/jonhoo/orgs", "repos_url": "https://api.github.com/users/jonhoo/repos", "events_url": "https://api.github.com/users/jonhoo/events{/privacy}", "received_events_url": "https://api.github.com/users/jonhoo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonhoo", "id": 176295, "node_id": "MDQ6VXNlcjE3NjI5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/176295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonhoo", "html_url": "https://github.com/jonhoo", "followers_url": "https://api.github.com/users/jonhoo/followers", "following_url": "https://api.github.com/users/jonhoo/following{/other_user}", "gists_url": "https://api.github.com/users/jonhoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonhoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonhoo/subscriptions", "organizations_url": "https://api.github.com/users/jonhoo/orgs", "repos_url": "https://api.github.com/users/jonhoo/repos", "events_url": "https://api.github.com/users/jonhoo/events{/privacy}", "received_events_url": "https://api.github.com/users/jonhoo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a37fe2de697bb1a9d304e4e811836e125f944cd5", "url": "https://api.github.com/repos/rust-lang/rust/commits/a37fe2de697bb1a9d304e4e811836e125f944cd5", "html_url": "https://github.com/rust-lang/rust/commit/a37fe2de697bb1a9d304e4e811836e125f944cd5"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "422d3486f92b29cc860cc33f4868590c7562f5e7", "filename": "src/liballoc/macros.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/06e4ff4d61f44d7e239e02256829ecf1e5598657/src%2Fliballoc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06e4ff4d61f44d7e239e02256829ecf1e5598657/src%2Fliballoc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fmacros.rs?ref=06e4ff4d61f44d7e239e02256829ecf1e5598657", "patch": "@@ -98,5 +98,8 @@ macro_rules! vec {\n #[macro_export]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n macro_rules! format {\n-    ($($arg:tt)*) => ($crate::fmt::format($crate::__export::format_args!($($arg)*)))\n+    ($($arg:tt)*) => {{\n+        let res = $crate::fmt::format($crate::__export::format_args!($($arg)*));\n+        res\n+    }}\n }"}, {"sha": "b7c8cf17c31484e11d3131709164f5c5d2852ce6", "filename": "src/test/ui/fmt/issue-64477.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/06e4ff4d61f44d7e239e02256829ecf1e5598657/src%2Ftest%2Fui%2Ffmt%2Fissue-64477.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06e4ff4d61f44d7e239e02256829ecf1e5598657/src%2Ftest%2Fui%2Ffmt%2Fissue-64477.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffmt%2Fissue-64477.rs?ref=06e4ff4d61f44d7e239e02256829ecf1e5598657", "patch": "@@ -0,0 +1,16 @@\n+// In the past, the code generated by `format!` produced temporaries in the surrounding scope that\n+// borrowed the arguments through `&dyn Trait`. These temporaries do not implement `Send`, which\n+// meant that when `format!` was used in an async block, the resulting generator was not `Send`.\n+// See https://github.com/rust-lang/rust/issues/64477#issuecomment-534669068 for details\n+// and https://github.com/rust-lang/rust/issues/64477#issuecomment-531882958 for an example.\n+async fn foo(_: String) {}\n+\n+fn bar() -> impl Send {\n+    async move {\n+        foo(format!(\"{}:{}\", 1, 2)).await;\n+    }\n+}\n+\n+fn main() {\n+    let _ = bar();\n+}"}]}