{"sha": "e39c9592948995569ca09a69cdafe1f6035f9364", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzOWM5NTkyOTQ4OTk1NTY5Y2EwOWE2OWNkYWZlMWY2MDM1ZjkzNjQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-05-22T22:34:30Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-05-22T22:59:51Z"}, "message": "rustc: Fix another double-lint issue with `crate::`\n\nThis commit fixes another issue in the `absolute_path_not_starting_with_crate`\nlint where it warns twice about an import which may contain `self`. It turns out\nthere were a few more locations that needed updating to use `root_id` and\n`root_span` introduced in #50970 and after that it looks to work like a charm!\n\nCloses #50978", "tree": {"sha": "f34159b0fc9b4745a4d7e462246cd0e46f9a9e1e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f34159b0fc9b4745a4d7e462246cd0e46f9a9e1e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e39c9592948995569ca09a69cdafe1f6035f9364", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e39c9592948995569ca09a69cdafe1f6035f9364", "html_url": "https://github.com/rust-lang/rust/commit/e39c9592948995569ca09a69cdafe1f6035f9364", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e39c9592948995569ca09a69cdafe1f6035f9364/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d034ae53c43352b06341455fb1394cb5d4069999", "url": "https://api.github.com/repos/rust-lang/rust/commits/d034ae53c43352b06341455fb1394cb5d4069999", "html_url": "https://github.com/rust-lang/rust/commit/d034ae53c43352b06341455fb1394cb5d4069999"}], "stats": {"total": 68, "additions": 44, "deletions": 24}, "files": [{"sha": "91de3a34cc84abc48c837bb8a10690809dfce2cf", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=e39c9592948995569ca09a69cdafe1f6035f9364", "patch": "@@ -684,7 +684,10 @@ impl<'a, 'b:'a> ImportResolver<'a, 'b> {\n                                  \"cannot glob-import all possible crates\".to_string()));\n                 }\n                 GlobImport { .. } if self.session.features_untracked().extern_absolute_paths => {\n-                    self.lint_path_starts_with_module(directive.id, span);\n+                    self.lint_path_starts_with_module(\n+                        directive.root_id,\n+                        directive.root_span,\n+                    );\n                 }\n                 SingleImport { source, target, .. } => {\n                     let crate_root = if source.name == keywords::Crate.name() &&\n@@ -903,7 +906,10 @@ impl<'a, 'b:'a> ImportResolver<'a, 'b> {\n                     return\n                 }\n                 warned = true;\n-                this.lint_path_starts_with_module(directive.id, span);\n+                this.lint_path_starts_with_module(\n+                    directive.root_id,\n+                    directive.root_span,\n+                );\n             });\n         }\n "}, {"sha": "2c14e9a982498461ae249d420b7e5510c985d5a5", "filename": "src/test/ui/rust-2018/edition-lint-nested-paths.fixed", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.fixed?ref=e39c9592948995569ca09a69cdafe1f6035f9364", "patch": "@@ -20,9 +20,18 @@ use crate::foo::{a, b};\n mod foo {\n     crate fn a() {}\n     crate fn b() {}\n+    crate fn c() {}\n }\n \n fn main() {\n     a();\n     b();\n+\n+    {\n+        use crate::foo::{self as x, c};\n+        //~^ ERROR absolute paths must start with\n+        //~| this was previously accepted\n+        x::a();\n+        c();\n+    }\n }"}, {"sha": "611436b03ab1bd502b925a4b3d902e8860f294b8", "filename": "src/test/ui/rust-2018/edition-lint-nested-paths.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.rs?ref=e39c9592948995569ca09a69cdafe1f6035f9364", "patch": "@@ -20,9 +20,18 @@ use foo::{a, b};\n mod foo {\n     crate fn a() {}\n     crate fn b() {}\n+    crate fn c() {}\n }\n \n fn main() {\n     a();\n     b();\n+\n+    {\n+        use foo::{self as x, c};\n+        //~^ ERROR absolute paths must start with\n+        //~| this was previously accepted\n+        x::a();\n+        c();\n+    }\n }"}, {"sha": "185d96690966009fda215e8bc8bc4a590442b77e", "filename": "src/test/ui/rust-2018/edition-lint-nested-paths.stderr", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-nested-paths.stderr?ref=e39c9592948995569ca09a69cdafe1f6035f9364", "patch": "@@ -12,5 +12,14 @@ LL | #![deny(absolute_path_not_starting_with_crate)]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in the 2018 edition!\n    = note: for more information, see issue TBD\n \n-error: aborting due to previous error\n+error: absolute paths must start with `self`, `super`, `crate`, or an external crate name in the 2018 edition\n+  --> $DIR/edition-lint-nested-paths.rs:31:13\n+   |\n+LL |         use foo::{self as x, c};\n+   |             ^^^^^^^^^^^^^^^^^^^ help: use `crate`: `crate::foo::{self as x, c}`\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in the 2018 edition!\n+   = note: for more information, see issue TBD\n+\n+error: aborting due to 2 previous errors\n "}, {"sha": "d452ff20fda9ffc608c0729cdd408d57a7af0f63", "filename": "src/test/ui/rust-2018/edition-lint-paths.fixed", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.fixed?ref=e39c9592948995569ca09a69cdafe1f6035f9364", "patch": "@@ -30,11 +30,9 @@ pub mod foo {\n     //~| WARN this was previously accepted\n     use crate::{bar as something_else};\n \n-    use {crate::Bar as SomethingElse, crate::main};\n+    use crate::{Bar as SomethingElse, main};\n     //~^ ERROR absolute\n     //~| WARN this was previously accepted\n-    //~| ERROR absolute\n-    //~| WARN this was previously accepted\n \n     use crate::{Bar as SomethingElse2, main as another_main};\n "}, {"sha": "3d6d5b052bbbaf68fb82f1bfe8f83923015ad905", "filename": "src/test/ui/rust-2018/edition-lint-paths.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.rs?ref=e39c9592948995569ca09a69cdafe1f6035f9364", "patch": "@@ -33,8 +33,6 @@ pub mod foo {\n     use {Bar as SomethingElse, main};\n     //~^ ERROR absolute\n     //~| WARN this was previously accepted\n-    //~| ERROR absolute\n-    //~| WARN this was previously accepted\n \n     use crate::{Bar as SomethingElse2, main as another_main};\n "}, {"sha": "0416e51b1afcdbc94f5234549f20184f24d85afe", "filename": "src/test/ui/rust-2018/edition-lint-paths.stderr", "status": "modified", "additions": 7, "deletions": 16, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e39c9592948995569ca09a69cdafe1f6035f9364/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-paths.stderr?ref=e39c9592948995569ca09a69cdafe1f6035f9364", "patch": "@@ -22,25 +22,16 @@ LL |     use bar;\n    = note: for more information, see issue TBD\n \n error: absolute paths must start with `self`, `super`, `crate`, or an external crate name in the 2018 edition\n-  --> $DIR/edition-lint-paths.rs:33:10\n+  --> $DIR/edition-lint-paths.rs:33:9\n    |\n LL |     use {Bar as SomethingElse, main};\n-   |          ^^^^^^^^^^^^^^^^^^^^ help: use `crate`: `crate::Bar as SomethingElse`\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use `crate`: `crate::{Bar as SomethingElse, main}`\n    |\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in the 2018 edition!\n    = note: for more information, see issue TBD\n \n error: absolute paths must start with `self`, `super`, `crate`, or an external crate name in the 2018 edition\n-  --> $DIR/edition-lint-paths.rs:33:32\n-   |\n-LL |     use {Bar as SomethingElse, main};\n-   |                                ^^^^ help: use `crate`: `crate::main`\n-   |\n-   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in the 2018 edition!\n-   = note: for more information, see issue TBD\n-\n-error: absolute paths must start with `self`, `super`, `crate`, or an external crate name in the 2018 edition\n-  --> $DIR/edition-lint-paths.rs:47:5\n+  --> $DIR/edition-lint-paths.rs:45:5\n    |\n LL | use bar::Bar;\n    |     ^^^^^^^^ help: use `crate`: `crate::bar::Bar`\n@@ -49,7 +40,7 @@ LL | use bar::Bar;\n    = note: for more information, see issue TBD\n \n error: absolute paths must start with `self`, `super`, `crate`, or an external crate name in the 2018 edition\n-  --> $DIR/edition-lint-paths.rs:59:9\n+  --> $DIR/edition-lint-paths.rs:57:9\n    |\n LL |     use *;\n    |         ^ help: use `crate`: `crate::*`\n@@ -58,7 +49,7 @@ LL |     use *;\n    = note: for more information, see issue TBD\n \n error: absolute paths must start with `self`, `super`, `crate`, or an external crate name in the 2018 edition\n-  --> $DIR/edition-lint-paths.rs:64:6\n+  --> $DIR/edition-lint-paths.rs:62:6\n    |\n LL | impl ::foo::SomeTrait for u32 { }\n    |      ^^^^^^^^^^^^^^^^ help: use `crate`: `crate::foo::SomeTrait`\n@@ -67,13 +58,13 @@ LL | impl ::foo::SomeTrait for u32 { }\n    = note: for more information, see issue TBD\n \n error: absolute paths must start with `self`, `super`, `crate`, or an external crate name in the 2018 edition\n-  --> $DIR/edition-lint-paths.rs:69:13\n+  --> $DIR/edition-lint-paths.rs:67:13\n    |\n LL |     let x = ::bar::Bar;\n    |             ^^^^^^^^^^ help: use `crate`: `crate::bar::Bar`\n    |\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in the 2018 edition!\n    = note: for more information, see issue TBD\n \n-error: aborting due to 8 previous errors\n+error: aborting due to 7 previous errors\n "}]}