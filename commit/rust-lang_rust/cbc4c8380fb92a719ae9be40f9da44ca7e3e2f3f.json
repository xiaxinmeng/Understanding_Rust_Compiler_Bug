{"sha": "cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiYzRjODM4MGZiOTJhNzE5YWU5YmU0MGY5ZGE0NGNhN2UzZTJmM2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-22T19:55:30Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-22T19:55:30Z"}, "message": "Auto merge of #51681 - varkor:rustc_deprecated-future-deprecation, r=petrochenkov\n\nSupport future deprecation for rustc_deprecated\n\nFollow-up to #49179 to allow `since` parameters to be set to future versions of Rust and correspondingly to not be treated as deprecated until that version. This is required for #30459 to be completed (though we'll need to wait until this hits beta).", "tree": {"sha": "53f3e3c2b9cfb12af5e74a8a10c8f4d08e306c47", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53f3e3c2b9cfb12af5e74a8a10c8f4d08e306c47"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f", "html_url": "https://github.com/rust-lang/rust/commit/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f024479d4e702647e7a772e06f77391abcfa571", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f024479d4e702647e7a772e06f77391abcfa571", "html_url": "https://github.com/rust-lang/rust/commit/8f024479d4e702647e7a772e06f77391abcfa571"}, {"sha": "09310947be113f4ccae0f6c5a24f6ddf4b611a72", "url": "https://api.github.com/repos/rust-lang/rust/commits/09310947be113f4ccae0f6c5a24f6ddf4b611a72", "html_url": "https://github.com/rust-lang/rust/commit/09310947be113f4ccae0f6c5a24f6ddf4b611a72"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "4cdc9fdddbf80b1176de05bdd44b9a26ab91315a", "filename": "src/librustc/middle/stability.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f/src%2Flibrustc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f/src%2Flibrustc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fstability.rs?ref=cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f", "patch": "@@ -614,10 +614,12 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n         debug!(\"stability: \\\n                 inspecting def_id={:?} span={:?} of stability={:?}\", def_id, span, stability);\n \n-        if let Some(&Stability{rustc_depr: Some(attr::RustcDeprecation { reason, .. }), ..})\n+        if let Some(&Stability{rustc_depr: Some(attr::RustcDeprecation { reason, since }), ..})\n                 = stability {\n             if let Some(id) = id {\n-                lint_deprecated(def_id, id, Some(reason));\n+                if deprecation_in_effect(&since.as_str()) {\n+                    lint_deprecated(def_id, id, Some(reason));\n+                }\n             }\n         }\n "}, {"sha": "07e80b61cd0a69cc764a016b88c15c940a9efe3d", "filename": "src/test/compile-fail/auxiliary/lint_stability.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f/src%2Ftest%2Fcompile-fail%2Fauxiliary%2Flint_stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f/src%2Ftest%2Fcompile-fail%2Fauxiliary%2Flint_stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fauxiliary%2Flint_stability.rs?ref=cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f", "patch": "@@ -7,6 +7,7 @@\n // <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n+\n #![crate_name=\"lint_stability\"]\n #![crate_type = \"lib\"]\n #![feature(staged_api)]\n@@ -20,6 +21,10 @@ pub fn deprecated() {}\n #[rustc_deprecated(since = \"1.0.0\", reason = \"text\")]\n pub fn deprecated_text() {}\n \n+#[stable(feature = \"test_feature\", since = \"1.0.0\")]\n+#[rustc_deprecated(since = \"99.99.99\", reason = \"text\")]\n+pub fn deprecated_future() {}\n+\n #[unstable(feature = \"test_feature\", issue = \"0\")]\n #[rustc_deprecated(since = \"1.0.0\", reason = \"text\")]\n pub fn deprecated_unstable() {}"}, {"sha": "bd390108bd8f3c40468fc1e122bae926a345f8c3", "filename": "src/test/compile-fail/lint-stability.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f/src%2Ftest%2Fcompile-fail%2Flint-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f/src%2Ftest%2Fcompile-fail%2Flint-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-stability.rs?ref=cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f", "patch": "@@ -50,6 +50,8 @@ mod cross_crate {\n         <Foo>::trait_deprecated_text(&foo);\n         <Foo as Trait>::trait_deprecated_text(&foo);\n \n+        deprecated_future(); // Fine; no error.\n+\n         deprecated_unstable();\n         //~^ ERROR use of unstable library feature\n         Trait::trait_deprecated_unstable(&foo);\n@@ -218,6 +220,10 @@ mod this_crate {\n     #[rustc_deprecated(since = \"1.0.0\", reason = \"text\")]\n     pub fn deprecated_text() {}\n \n+    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_deprecated(since = \"99.99.99\", reason = \"text\")]\n+    pub fn deprecated_future() {}\n+\n     #[unstable(feature = \"test_feature\", issue = \"0\")]\n     pub fn unstable() {}\n     #[unstable(feature = \"test_feature\", reason = \"text\", issue = \"0\")]\n@@ -338,6 +344,8 @@ mod this_crate {\n         <Foo>::trait_deprecated_text(&foo);\n         <Foo as Trait>::trait_deprecated_text(&foo);\n \n+        deprecated_future();\n+\n         unstable();\n         foo.method_unstable();\n         Foo::method_unstable(&foo);"}]}