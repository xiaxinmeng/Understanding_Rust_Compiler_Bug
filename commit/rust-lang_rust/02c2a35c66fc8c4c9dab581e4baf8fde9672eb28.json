{"sha": "02c2a35c66fc8c4c9dab581e4baf8fde9672eb28", "node_id": "C_kwDOAAsO6NoAKDAyYzJhMzVjNjZmYzhjNGM5ZGFiNTgxZTRiYWY4ZmRlOTY3MmViMjg", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2021-10-04T21:09:19Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2021-10-04T21:09:19Z"}, "message": "Discuss field-sensitivity and enums in context of `MaybeLiveLocals`", "tree": {"sha": "6ef155980e82b74fadcbd9269ccb583a2bfacacb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ef155980e82b74fadcbd9269ccb583a2bfacacb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/02c2a35c66fc8c4c9dab581e4baf8fde9672eb28", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/02c2a35c66fc8c4c9dab581e4baf8fde9672eb28", "html_url": "https://github.com/rust-lang/rust/commit/02c2a35c66fc8c4c9dab581e4baf8fde9672eb28", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/02c2a35c66fc8c4c9dab581e4baf8fde9672eb28/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3", "url": "https://api.github.com/repos/rust-lang/rust/commits/175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3", "html_url": "https://github.com/rust-lang/rust/commit/175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "3e2548845e20f693f9d4bd6031dcf2c68abdc570", "filename": "compiler/rustc_mir_dataflow/src/impls/liveness.rs", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/02c2a35c66fc8c4c9dab581e4baf8fde9672eb28/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02c2a35c66fc8c4c9dab581e4baf8fde9672eb28/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs?ref=02c2a35c66fc8c4c9dab581e4baf8fde9672eb28", "patch": "@@ -11,6 +11,37 @@ use crate::{AnalysisDomain, Backward, GenKill, GenKillAnalysis};\n /// exist. See [this `mir-dataflow` test][flow-test] for an example. You almost never want to use\n /// this analysis without also looking at the results of [`MaybeBorrowedLocals`].\n ///\n+/// ## Field-(in)sensitivity\n+///\n+/// As the name suggests, this analysis is field insensitive. If a projection of a variable `x` is\n+/// assigned to (e.g. `x.0 = 42`), it does not \"define\" `x` as far as liveness is concerned. In fact,\n+/// such an assignment is currently marked as a \"use\" of `x` in an attempt to be maximally\n+/// conservative.\n+///\n+/// ## Enums and `SetDiscriminant`\n+///\n+/// Assigning a literal value to an `enum` (e.g. `Option<i32>`), does not result in a simple\n+/// assignment of the form `_1 = /*...*/` in the MIR. For example, the following assignment to `x`:\n+///\n+/// ```\n+/// x = Some(4);\n+/// ```\n+///\n+/// compiles to this MIR\n+///\n+/// ```\n+/// ((_1 as Some).0: i32) = const 4_i32;\n+/// discriminant(_1) = 1;\n+/// ```\n+///\n+/// However, `MaybeLiveLocals` **does** mark `x` (`_1`) as \"killed\" after a statement like this.\n+/// That's because it treats the `SetDiscriminant` operation as a definition of `x`, even though\n+/// the writes that actually initialized the locals happened earlier.\n+///\n+/// This makes `MaybeLiveLocals` unsuitable for certain classes of optimization normally associated\n+/// with a live variables analysis, notably dead-store elimination. It's a dirty hack, but it works\n+/// okay for the generator state transform (currently the main consumuer of this analysis).\n+///\n /// [`MaybeBorrowedLocals`]: super::MaybeBorrowedLocals\n /// [flow-test]: https://github.com/rust-lang/rust/blob/a08c47310c7d49cbdc5d7afb38408ba519967ecd/src/test/ui/mir-dataflow/liveness-ptr.rs\n /// [liveness]: https://en.wikipedia.org/wiki/Live_variable_analysis"}]}