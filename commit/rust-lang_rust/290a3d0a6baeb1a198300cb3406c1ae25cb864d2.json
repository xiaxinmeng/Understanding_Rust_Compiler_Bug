{"sha": "290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5MGEzZDBhNmJhZWIxYTE5ODMwMGNiMzQwNmMxYWUyNWNiODY0ZDI=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-17T12:14:36Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-17T12:14:36Z"}, "message": "Merge #986\n\n986: Fix parse tree of attribute on match arm r=matklad a=pcpthm\n\n```rust\r\nmatch () {\r\n    #[attr]\r\n    () => (),\r\n}\r\n```\r\nIncorrect parse tree: `MatchArmList(Attr(..), MatchArm(..))`.\r\nFixed: `MatchArmList(MatchArm(Attr(..), ...))`.\n\nCo-authored-by: pcpthm <pcpthm@gmail.com>", "tree": {"sha": "76a3434979cc4895dd4f6ca377e59ce031834a9e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/76a3434979cc4895dd4f6ca377e59ce031834a9e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "html_url": "https://github.com/rust-lang/rust/commit/290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "aea9c98f53c66cac350781c3c531ef11cef861b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/aea9c98f53c66cac350781c3c531ef11cef861b6", "html_url": "https://github.com/rust-lang/rust/commit/aea9c98f53c66cac350781c3c531ef11cef861b6"}, {"sha": "a67fe4ea7e623ef31228295aedafb3bd18f4a23d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a67fe4ea7e623ef31228295aedafb3bd18f4a23d", "html_url": "https://github.com/rust-lang/rust/commit/a67fe4ea7e623ef31228295aedafb3bd18f4a23d"}], "stats": {"total": 266, "additions": 133, "deletions": 133}, "files": [{"sha": "d933288cd5e88a817e63f207a4197332ba17063b", "filename": "crates/ra_parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "patch": "@@ -342,21 +342,6 @@ pub(crate) fn match_arm_list(p: &mut Parser) {\n             continue;\n         }\n \n-        // test match_arms_outer_attributes\n-        // fn foo() {\n-        //     match () {\n-        //         #[cfg(feature = \"some\")]\n-        //         _ => (),\n-        //         #[cfg(feature = \"other\")]\n-        //         _ => (),\n-        //         #[cfg(feature = \"many\")]\n-        //         #[cfg(feature = \"attributes\")]\n-        //         #[cfg(feature = \"before\")]\n-        //         _ => (),\n-        //     }\n-        // }\n-        attributes::outer_attributes(p);\n-\n         // test match_arms_commas\n         // fn foo() {\n         //     match () {\n@@ -387,6 +372,21 @@ pub(crate) fn match_arm_list(p: &mut Parser) {\n // }\n fn match_arm(p: &mut Parser) -> BlockLike {\n     let m = p.start();\n+    // test match_arms_outer_attributes\n+    // fn foo() {\n+    //     match () {\n+    //         #[cfg(feature = \"some\")]\n+    //         _ => (),\n+    //         #[cfg(feature = \"other\")]\n+    //         _ => (),\n+    //         #[cfg(feature = \"many\")]\n+    //         #[cfg(feature = \"attributes\")]\n+    //         #[cfg(feature = \"before\")]\n+    //         _ => (),\n+    //     }\n+    // }\n+    attributes::outer_attributes(p);\n+\n     patterns::pattern_list_r(p, TokenSet::empty());\n     if p.at(IF_KW) {\n         match_guard(p);"}, {"sha": "ed5735a63aee3625af2cebd294d69ecaad3d37d6", "filename": "crates/ra_syntax/tests/data/parser/err/0032_match_arms_inner_attrs.txt", "status": "modified", "additions": 26, "deletions": 26, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0032_match_arms_inner_attrs.txt", "raw_url": "https://github.com/rust-lang/rust/raw/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0032_match_arms_inner_attrs.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0032_match_arms_inner_attrs.txt?ref=290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "patch": "@@ -33,11 +33,11 @@ SOURCE_FILE@[0; 293)\n                 R_PAREN@[40; 41)\n             COMMA@[41; 42)\n             WHITESPACE@[42; 51)\n-            ATTR@[51; 52)\n-              POUND@[51; 52)\n-              err: `expected `[``\n-              err: `expected pattern`\n-            MATCH_ARM@[52; 78)\n+            MATCH_ARM@[51; 78)\n+              ATTR@[51; 52)\n+                POUND@[51; 52)\n+                err: `expected `[``\n+                err: `expected pattern`\n               ERROR@[52; 53)\n                 EXCL@[52; 53)\n                 err: `expected FAT_ARROW`\n@@ -103,11 +103,11 @@ SOURCE_FILE@[0; 293)\n                 R_PAREN@[149; 150)\n             COMMA@[150; 151)\n             WHITESPACE@[151; 160)\n-            ATTR@[160; 161)\n-              POUND@[160; 161)\n-              err: `expected `[``\n-              err: `expected pattern`\n-            MATCH_ARM@[161; 179)\n+            MATCH_ARM@[160; 179)\n+              ATTR@[160; 161)\n+                POUND@[160; 161)\n+                err: `expected `[``\n+                err: `expected pattern`\n               ERROR@[161; 162)\n                 EXCL@[161; 162)\n                 err: `expected FAT_ARROW`\n@@ -138,22 +138,22 @@ SOURCE_FILE@[0; 293)\n         MATCH_ARM_LIST@[200; 290)\n           L_CURLY@[200; 201)\n           WHITESPACE@[201; 210)\n-          ATTR@[210; 222)\n-            POUND@[210; 211)\n-            TOKEN_TREE@[211; 222)\n-              L_BRACK@[211; 212)\n-              IDENT@[212; 215) \"cfg\"\n-              TOKEN_TREE@[215; 221)\n-                L_PAREN@[215; 216)\n-                IDENT@[216; 220) \"test\"\n-                R_PAREN@[220; 221)\n-              R_BRACK@[221; 222)\n-          WHITESPACE@[222; 231)\n-          ATTR@[231; 232)\n-            POUND@[231; 232)\n-            err: `expected `[``\n-            err: `expected pattern`\n-          MATCH_ARM@[232; 250)\n+          MATCH_ARM@[210; 250)\n+            ATTR@[210; 222)\n+              POUND@[210; 211)\n+              TOKEN_TREE@[211; 222)\n+                L_BRACK@[211; 212)\n+                IDENT@[212; 215) \"cfg\"\n+                TOKEN_TREE@[215; 221)\n+                  L_PAREN@[215; 216)\n+                  IDENT@[216; 220) \"test\"\n+                  R_PAREN@[220; 221)\n+                R_BRACK@[221; 222)\n+            WHITESPACE@[222; 231)\n+            ATTR@[231; 232)\n+              POUND@[231; 232)\n+              err: `expected `[``\n+              err: `expected pattern`\n             ERROR@[232; 233)\n               EXCL@[232; 233)\n               err: `expected FAT_ARROW`"}, {"sha": "f540409bc2e7b5c4b07833adc08f75aa6feac526", "filename": "crates/ra_syntax/tests/data/parser/err/0033_match_arms_outer_attrs.txt", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0033_match_arms_outer_attrs.txt", "raw_url": "https://github.com/rust-lang/rust/raw/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0033_match_arms_outer_attrs.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0033_match_arms_outer_attrs.txt?ref=290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "patch": "@@ -43,21 +43,21 @@ SOURCE_FILE@[0; 89)\n               R_PAREN@[57; 58)\n           COMMA@[58; 59)\n           WHITESPACE@[59; 68)\n-          ATTR@[68; 80)\n-            POUND@[68; 69)\n-            TOKEN_TREE@[69; 80)\n-              L_BRACK@[69; 70)\n-              IDENT@[70; 73) \"cfg\"\n-              TOKEN_TREE@[73; 79)\n-                L_PAREN@[73; 74)\n-                IDENT@[74; 78) \"test\"\n-                R_PAREN@[78; 79)\n-              R_BRACK@[79; 80)\n+          MATCH_ARM@[68; 80)\n+            ATTR@[68; 80)\n+              POUND@[68; 69)\n+              TOKEN_TREE@[69; 80)\n+                L_BRACK@[69; 70)\n+                IDENT@[70; 73) \"cfg\"\n+                TOKEN_TREE@[73; 79)\n+                  L_PAREN@[73; 74)\n+                  IDENT@[74; 78) \"test\"\n+                  R_PAREN@[78; 79)\n+                R_BRACK@[79; 80)\n+                err: `expected pattern`\n+                err: `expected FAT_ARROW`\n+                err: `expected expression`\n           WHITESPACE@[80; 85)\n-          err: `expected pattern`\n-          err: `expected FAT_ARROW`\n-          err: `expected expression`\n-          MATCH_ARM@[85; 85)\n           R_CURLY@[85; 86)\n       WHITESPACE@[86; 87)\n       R_CURLY@[87; 88)"}, {"sha": "e52a290bf87a65c5cdbddfc1b020c3d1a42a6b9a", "filename": "crates/ra_syntax/tests/data/parser/inline/ok/0121_match_arms_outer_attributes.txt", "status": "modified", "additions": 78, "deletions": 78, "changes": 156, "blob_url": "https://github.com/rust-lang/rust/blob/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0121_match_arms_outer_attributes.txt", "raw_url": "https://github.com/rust-lang/rust/raw/290a3d0a6baeb1a198300cb3406c1ae25cb864d2/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0121_match_arms_outer_attributes.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0121_match_arms_outer_attributes.txt?ref=290a3d0a6baeb1a198300cb3406c1ae25cb864d2", "patch": "@@ -21,22 +21,22 @@ SOURCE_FILE@[0; 259)\n         MATCH_ARM_LIST@[24; 256)\n           L_CURLY@[24; 25)\n           WHITESPACE@[25; 34)\n-          ATTR@[34; 58)\n-            POUND@[34; 35)\n-            TOKEN_TREE@[35; 58)\n-              L_BRACK@[35; 36)\n-              IDENT@[36; 39) \"cfg\"\n-              TOKEN_TREE@[39; 57)\n-                L_PAREN@[39; 40)\n-                IDENT@[40; 47) \"feature\"\n-                WHITESPACE@[47; 48)\n-                EQ@[48; 49)\n-                WHITESPACE@[49; 50)\n-                STRING@[50; 56)\n-                R_PAREN@[56; 57)\n-              R_BRACK@[57; 58)\n-          WHITESPACE@[58; 67)\n-          MATCH_ARM@[67; 74)\n+          MATCH_ARM@[34; 74)\n+            ATTR@[34; 58)\n+              POUND@[34; 35)\n+              TOKEN_TREE@[35; 58)\n+                L_BRACK@[35; 36)\n+                IDENT@[36; 39) \"cfg\"\n+                TOKEN_TREE@[39; 57)\n+                  L_PAREN@[39; 40)\n+                  IDENT@[40; 47) \"feature\"\n+                  WHITESPACE@[47; 48)\n+                  EQ@[48; 49)\n+                  WHITESPACE@[49; 50)\n+                  STRING@[50; 56)\n+                  R_PAREN@[56; 57)\n+                R_BRACK@[57; 58)\n+            WHITESPACE@[58; 67)\n             PLACEHOLDER_PAT@[67; 68)\n               UNDERSCORE@[67; 68)\n             WHITESPACE@[68; 69)\n@@ -47,22 +47,22 @@ SOURCE_FILE@[0; 259)\n               R_PAREN@[73; 74)\n           COMMA@[74; 75)\n           WHITESPACE@[75; 84)\n-          ATTR@[84; 109)\n-            POUND@[84; 85)\n-            TOKEN_TREE@[85; 109)\n-              L_BRACK@[85; 86)\n-              IDENT@[86; 89) \"cfg\"\n-              TOKEN_TREE@[89; 108)\n-                L_PAREN@[89; 90)\n-                IDENT@[90; 97) \"feature\"\n-                WHITESPACE@[97; 98)\n-                EQ@[98; 99)\n-                WHITESPACE@[99; 100)\n-                STRING@[100; 107)\n-                R_PAREN@[107; 108)\n-              R_BRACK@[108; 109)\n-          WHITESPACE@[109; 118)\n-          MATCH_ARM@[118; 125)\n+          MATCH_ARM@[84; 125)\n+            ATTR@[84; 109)\n+              POUND@[84; 85)\n+              TOKEN_TREE@[85; 109)\n+                L_BRACK@[85; 86)\n+                IDENT@[86; 89) \"cfg\"\n+                TOKEN_TREE@[89; 108)\n+                  L_PAREN@[89; 90)\n+                  IDENT@[90; 97) \"feature\"\n+                  WHITESPACE@[97; 98)\n+                  EQ@[98; 99)\n+                  WHITESPACE@[99; 100)\n+                  STRING@[100; 107)\n+                  R_PAREN@[107; 108)\n+                R_BRACK@[108; 109)\n+            WHITESPACE@[109; 118)\n             PLACEHOLDER_PAT@[118; 119)\n               UNDERSCORE@[118; 119)\n             WHITESPACE@[119; 120)\n@@ -73,52 +73,52 @@ SOURCE_FILE@[0; 259)\n               R_PAREN@[124; 125)\n           COMMA@[125; 126)\n           WHITESPACE@[126; 135)\n-          ATTR@[135; 159)\n-            POUND@[135; 136)\n-            TOKEN_TREE@[136; 159)\n-              L_BRACK@[136; 137)\n-              IDENT@[137; 140) \"cfg\"\n-              TOKEN_TREE@[140; 158)\n-                L_PAREN@[140; 141)\n-                IDENT@[141; 148) \"feature\"\n-                WHITESPACE@[148; 149)\n-                EQ@[149; 150)\n-                WHITESPACE@[150; 151)\n-                STRING@[151; 157)\n-                R_PAREN@[157; 158)\n-              R_BRACK@[158; 159)\n-          WHITESPACE@[159; 168)\n-          ATTR@[168; 198)\n-            POUND@[168; 169)\n-            TOKEN_TREE@[169; 198)\n-              L_BRACK@[169; 170)\n-              IDENT@[170; 173) \"cfg\"\n-              TOKEN_TREE@[173; 197)\n-                L_PAREN@[173; 174)\n-                IDENT@[174; 181) \"feature\"\n-                WHITESPACE@[181; 182)\n-                EQ@[182; 183)\n-                WHITESPACE@[183; 184)\n-                STRING@[184; 196)\n-                R_PAREN@[196; 197)\n-              R_BRACK@[197; 198)\n-          WHITESPACE@[198; 207)\n-          ATTR@[207; 233)\n-            POUND@[207; 208)\n-            TOKEN_TREE@[208; 233)\n-              L_BRACK@[208; 209)\n-              IDENT@[209; 212) \"cfg\"\n-              TOKEN_TREE@[212; 232)\n-                L_PAREN@[212; 213)\n-                IDENT@[213; 220) \"feature\"\n-                WHITESPACE@[220; 221)\n-                EQ@[221; 222)\n-                WHITESPACE@[222; 223)\n-                STRING@[223; 231)\n-                R_PAREN@[231; 232)\n-              R_BRACK@[232; 233)\n-          WHITESPACE@[233; 242)\n-          MATCH_ARM@[242; 249)\n+          MATCH_ARM@[135; 249)\n+            ATTR@[135; 159)\n+              POUND@[135; 136)\n+              TOKEN_TREE@[136; 159)\n+                L_BRACK@[136; 137)\n+                IDENT@[137; 140) \"cfg\"\n+                TOKEN_TREE@[140; 158)\n+                  L_PAREN@[140; 141)\n+                  IDENT@[141; 148) \"feature\"\n+                  WHITESPACE@[148; 149)\n+                  EQ@[149; 150)\n+                  WHITESPACE@[150; 151)\n+                  STRING@[151; 157)\n+                  R_PAREN@[157; 158)\n+                R_BRACK@[158; 159)\n+            WHITESPACE@[159; 168)\n+            ATTR@[168; 198)\n+              POUND@[168; 169)\n+              TOKEN_TREE@[169; 198)\n+                L_BRACK@[169; 170)\n+                IDENT@[170; 173) \"cfg\"\n+                TOKEN_TREE@[173; 197)\n+                  L_PAREN@[173; 174)\n+                  IDENT@[174; 181) \"feature\"\n+                  WHITESPACE@[181; 182)\n+                  EQ@[182; 183)\n+                  WHITESPACE@[183; 184)\n+                  STRING@[184; 196)\n+                  R_PAREN@[196; 197)\n+                R_BRACK@[197; 198)\n+            WHITESPACE@[198; 207)\n+            ATTR@[207; 233)\n+              POUND@[207; 208)\n+              TOKEN_TREE@[208; 233)\n+                L_BRACK@[208; 209)\n+                IDENT@[209; 212) \"cfg\"\n+                TOKEN_TREE@[212; 232)\n+                  L_PAREN@[212; 213)\n+                  IDENT@[213; 220) \"feature\"\n+                  WHITESPACE@[220; 221)\n+                  EQ@[221; 222)\n+                  WHITESPACE@[222; 223)\n+                  STRING@[223; 231)\n+                  R_PAREN@[231; 232)\n+                R_BRACK@[232; 233)\n+            WHITESPACE@[233; 242)\n             PLACEHOLDER_PAT@[242; 243)\n               UNDERSCORE@[242; 243)\n             WHITESPACE@[243; 244)"}]}