{"sha": "d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzNTEzNzBmYTEyY2QwMWIyZGM2N2ZkNDQ3YTJkNjdiMDVkYWMzYTE=", "commit": {"author": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2018-07-15T03:52:40Z"}, "committer": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2018-07-15T05:09:27Z"}, "message": "structured suggestion for renamed-and-removed-lints", "tree": {"sha": "87dd59062f0cd60f4791cde25b5d2941701c7a9c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87dd59062f0cd60f4791cde25b5d2941701c7a9c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "html_url": "https://github.com/rust-lang/rust/commit/d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/comments", "author": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e320595320855beb97a5959d67bd12f2afca4d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e320595320855beb97a5959d67bd12f2afca4d1", "html_url": "https://github.com/rust-lang/rust/commit/7e320595320855beb97a5959d67bd12f2afca4d1"}], "stats": {"total": 44, "additions": 27, "deletions": 17}, "files": [{"sha": "2a44845b980dba83a0d3e511b4cc86869cf67c8f", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "patch": "@@ -131,8 +131,8 @@ pub enum CheckLintNameResult<'a> {\n     /// Lint doesn't exist\n     NoLint,\n     /// The lint is either renamed or removed. This is the warning\n-    /// message.\n-    Warning(String),\n+    /// message, and an optional new name (`None` if removed).\n+    Warning(String, Option<String>),\n }\n \n impl LintStore {\n@@ -280,7 +280,7 @@ impl LintStore {\n                                    level: Level) {\n         let db = match self.check_lint_name(lint_name) {\n             CheckLintNameResult::Ok(_) => None,\n-            CheckLintNameResult::Warning(ref msg) => {\n+            CheckLintNameResult::Warning(ref msg, _) => {\n                 Some(sess.struct_warn(msg))\n             },\n             CheckLintNameResult::NoLint => {\n@@ -313,12 +313,14 @@ impl LintStore {\n         match self.by_name.get(lint_name) {\n             Some(&Renamed(ref new_name, _)) => {\n                 CheckLintNameResult::Warning(\n-                    format!(\"lint {} has been renamed to {}\", lint_name, new_name)\n+                    format!(\"lint `{}` has been renamed to `{}`\", lint_name, new_name),\n+                    Some(new_name.to_owned())\n                 )\n             },\n             Some(&Removed(ref reason)) => {\n                 CheckLintNameResult::Warning(\n-                    format!(\"lint {} has been removed: {}\", lint_name, reason)\n+                    format!(\"lint `{}` has been removed: `{}`\", lint_name, reason),\n+                    None\n                 )\n             },\n             None => {"}, {"sha": "b7b6aba970bff21c76a07c1e3f7a65913a7fec5e", "filename": "src/librustc/lint/levels.rs", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Flibrustc%2Flint%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Flibrustc%2Flint%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Flevels.rs?ref=d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "patch": "@@ -260,19 +260,27 @@ impl<'a> LintLevelsBuilder<'a> {\n \n                     _ if !self.warn_about_weird_lints => {}\n \n-                    CheckLintNameResult::Warning(ref msg) => {\n+                    CheckLintNameResult::Warning(msg, renamed) => {\n                         let lint = builtin::RENAMED_AND_REMOVED_LINTS;\n                         let (level, src) = self.sets.get_lint_level(lint,\n                                                                     self.cur,\n                                                                     Some(&specs),\n                                                                     &sess);\n-                        lint::struct_lint_level(self.sess,\n-                                                lint,\n-                                                level,\n-                                                src,\n-                                                Some(li.span.into()),\n-                                                msg)\n-                            .emit();\n+                        let mut err = lint::struct_lint_level(self.sess,\n+                                                              lint,\n+                                                              level,\n+                                                              src,\n+                                                              Some(li.span.into()),\n+                                                              &msg);\n+                        if let Some(new_name) = renamed {\n+                            err.span_suggestion_with_applicability(\n+                                li.span,\n+                                \"use the new name\",\n+                                new_name,\n+                                Applicability::MachineApplicable\n+                            );\n+                        }\n+                        err.emit();\n                     }\n                     CheckLintNameResult::NoLint => {\n                         let lint = builtin::UNKNOWN_LINTS;"}, {"sha": "09725b201466a969a7c5a055c7576e135e69d308", "filename": "src/test/compile-fail/lint-removed-cmdline.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-removed-cmdline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-removed-cmdline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-removed-cmdline.rs?ref=d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "patch": "@@ -13,7 +13,7 @@\n \n // compile-flags:-D raw_pointer_derive\n \n-// error-pattern:lint raw_pointer_derive has been removed\n+// error-pattern:lint `raw_pointer_derive` has been removed\n // error-pattern:requested on the command line with `-D raw_pointer_derive`\n \n #![warn(unused)]"}, {"sha": "4e53852008f13dcb880b5fd1c55d9ab6f642c3b4", "filename": "src/test/compile-fail/lint-removed.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-removed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-removed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-removed.rs?ref=d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "patch": "@@ -13,6 +13,6 @@\n // default, and allowed in cargo dependency builds.\n // cc #30346\n \n-#[deny(raw_pointer_derive)] //~ WARN raw_pointer_derive has been removed\n+#[deny(raw_pointer_derive)] //~ WARN `raw_pointer_derive` has been removed\n #[deny(unused_variables)]\n fn main() { let unused = (); } //~ ERROR unused"}, {"sha": "a5246206d9504726872fd4e565c5cf536eb6010d", "filename": "src/test/compile-fail/lint-renamed-cmdline.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-renamed-cmdline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-renamed-cmdline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-renamed-cmdline.rs?ref=d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "patch": "@@ -10,7 +10,7 @@\n \n // compile-flags:-D unknown_features\n \n-// error-pattern:lint unknown_features has been renamed to unused_features\n+// error-pattern:lint `unknown_features` has been renamed to `unused_features`\n // error-pattern:requested on the command line with `-D unknown_features`\n // error-pattern:unused\n "}, {"sha": "afe4aee7a1d947ef43394060654f99090464cf41", "filename": "src/test/compile-fail/lint-renamed.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-renamed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d351370fa12cd01b2dc67fd447a2d67b05dac3a1/src%2Ftest%2Fcompile-fail%2Flint-renamed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-renamed.rs?ref=d351370fa12cd01b2dc67fd447a2d67b05dac3a1", "patch": "@@ -8,6 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#[deny(unknown_features)] //~ WARN lint unknown_features has been renamed to unused_features\n+#[deny(unknown_features)] //~ WARN lint `unknown_features` has been renamed to `unused_features`\n #[deny(unused)]\n fn main() { let unused = (); } //~ ERROR unused"}]}