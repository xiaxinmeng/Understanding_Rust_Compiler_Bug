{"sha": "d7f5c50a335204e00565c978f5eb7fac40468f96", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3ZjVjNTBhMzM1MjA0ZTAwNTY1Yzk3OGY1ZWI3ZmFjNDA0NjhmOTY=", "commit": {"author": {"name": "Mark Mansi", "email": "markm@cs.wisc.edu", "date": "2019-03-28T17:36:13Z"}, "committer": {"name": "Mark Mansi", "email": "markm@cs.wisc.edu", "date": "2019-04-11T02:29:17Z"}, "message": "make duplicate matcher bindings a hard error", "tree": {"sha": "15d27ac1f1f231c95a2af63e82bd82fca50a4953", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/15d27ac1f1f231c95a2af63e82bd82fca50a4953"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7f5c50a335204e00565c978f5eb7fac40468f96", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7f5c50a335204e00565c978f5eb7fac40468f96", "html_url": "https://github.com/rust-lang/rust/commit/d7f5c50a335204e00565c978f5eb7fac40468f96", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7f5c50a335204e00565c978f5eb7fac40468f96/comments", "author": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96d700f1b7bc9c53fa0d11567adb1ed2c1c27e79", "url": "https://api.github.com/repos/rust-lang/rust/commits/96d700f1b7bc9c53fa0d11567adb1ed2c1c27e79", "html_url": "https://github.com/rust-lang/rust/commit/96d700f1b7bc9c53fa0d11567adb1ed2c1c27e79"}], "stats": {"total": 103, "additions": 44, "deletions": 59}, "files": [{"sha": "bfb0b3e4a6b2d6b2c04047c7e15adeb1e2d94316", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=d7f5c50a335204e00565c978f5eb7fac40468f96", "patch": "@@ -352,12 +352,6 @@ declare_lint! {\n     \"outlives requirements can be inferred\"\n }\n \n-declare_lint! {\n-    pub DUPLICATE_MATCHER_BINDING_NAME,\n-    Deny,\n-    \"duplicate macro matcher binding name\"\n-}\n-\n /// Some lints that are buffered from `libsyntax`. See `syntax::early_buffered_lints`.\n pub mod parser {\n     declare_lint! {"}, {"sha": "112c247d4d663c763d91b97328d137bf57b33279", "filename": "src/librustc/lint/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibrustc%2Flint%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibrustc%2Flint%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fmod.rs?ref=d7f5c50a335204e00565c978f5eb7fac40468f96", "patch": "@@ -26,7 +26,7 @@ use rustc_data_structures::sync::{self, Lrc};\n use crate::hir::def_id::{CrateNum, LOCAL_CRATE};\n use crate::hir::intravisit;\n use crate::hir;\n-use crate::lint::builtin::{BuiltinLintDiagnostics, DUPLICATE_MATCHER_BINDING_NAME};\n+use crate::lint::builtin::BuiltinLintDiagnostics;\n use crate::lint::builtin::parser::{QUESTION_MARK_MACRO_SEP, ILL_FORMED_ATTRIBUTE_INPUT};\n use crate::session::{Session, DiagnosticMessageId};\n use crate::ty::TyCtxt;\n@@ -82,7 +82,6 @@ impl Lint {\n         match lint_id {\n             BufferedEarlyLintId::QuestionMarkMacroSep => QUESTION_MARK_MACRO_SEP,\n             BufferedEarlyLintId::IllFormedAttributeInput => ILL_FORMED_ATTRIBUTE_INPUT,\n-            BufferedEarlyLintId::DuplicateMacroMatcherBindingName => DUPLICATE_MATCHER_BINDING_NAME,\n         }\n     }\n "}, {"sha": "4a2d6dc68ae596afe32f32b66b323cb5da86ffdd", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=d7f5c50a335204e00565c978f5eb7fac40468f96", "patch": "@@ -428,11 +428,6 @@ pub fn register_builtins(store: &mut lint::LintStore, sess: Option<&Session>) {\n             reference: \"issue #57644 <https://github.com/rust-lang/rust/issues/57644>\",\n             edition: None,\n         },\n-        FutureIncompatibleInfo {\n-            id: LintId::of(DUPLICATE_MATCHER_BINDING_NAME),\n-            reference: \"issue #57593 <https://github.com/rust-lang/rust/issues/57593>\",\n-            edition: None,\n-        },\n         FutureIncompatibleInfo {\n             id: LintId::of(NESTED_IMPL_TRAIT),\n             reference: \"issue #59014 <https://github.com/rust-lang/rust/issues/59014>\",\n@@ -494,6 +489,8 @@ pub fn register_builtins(store: &mut lint::LintStore, sess: Option<&Session>) {\n         \"no longer a warning, #[no_mangle] statics always exported\");\n     store.register_removed(\"bad_repr\",\n         \"replaced with a generic attribute input check\");\n+    store.register_removed(\"duplicate_matcher_binding_name\",\n+        \"converted into hard error, see https://github.com/rust-lang/rust/issues/57742\");\n }\n \n pub fn register_internals(store: &mut lint::LintStore, sess: Option<&Session>) {"}, {"sha": "977e6d4587709be238c9b86080c42c7ee20e54d2", "filename": "src/libsyntax/early_buffered_lints.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibsyntax%2Fearly_buffered_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibsyntax%2Fearly_buffered_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fearly_buffered_lints.rs?ref=d7f5c50a335204e00565c978f5eb7fac40468f96", "patch": "@@ -12,8 +12,6 @@ pub enum BufferedEarlyLintId {\n     /// Usage of `?` as a macro separator is deprecated.\n     QuestionMarkMacroSep,\n     IllFormedAttributeInput,\n-    /// Usage of a duplicate macro matcher binding name.\n-    DuplicateMacroMatcherBindingName,\n }\n \n /// Stores buffered lint info which can later be passed to `librustc`."}, {"sha": "b1b9d25b3d56b52624a75c10023cf69f25a099f3", "filename": "src/libsyntax/ext/tt/macro_rules.rs", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs?ref=d7f5c50a335204e00565c978f5eb7fac40468f96", "patch": "@@ -497,22 +497,14 @@ fn check_lhs_duplicate_matcher_bindings(\n     node_id: ast::NodeId,\n ) -> bool {\n     use self::quoted::TokenTree;\n-    use crate::early_buffered_lints::BufferedEarlyLintId;\n     for tt in tts {\n         match *tt {\n             TokenTree::MetaVarDecl(span, name, _kind) => {\n                 if let Some(&prev_span) = metavar_names.get(&name) {\n-                    // FIXME(mark-i-m): in a few cycles, make this a hard error.\n-                    // sess.span_diagnostic\n-                    //     .struct_span_err(span, \"duplicate matcher binding\")\n-                    //     .span_note(prev_span, \"previous declaration was here\")\n-                    //     .emit();\n-                    sess.buffer_lint(\n-                        BufferedEarlyLintId::DuplicateMacroMatcherBindingName,\n-                        crate::source_map::MultiSpan::from(vec![prev_span, span]),\n-                        node_id,\n-                        \"duplicate matcher binding\"\n-                    );\n+                    sess.span_diagnostic\n+                        .struct_span_err(span, \"duplicate matcher binding\")\n+                        .span_note(prev_span, \"previous declaration was here\")\n+                        .emit();\n                     return false;\n                 } else {\n                     metavar_names.insert(name, span);"}, {"sha": "f31af2365ff256dab93f820832a92ff2dd09ddfd", "filename": "src/test/ui/macros/macro-multiple-matcher-bindings.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Ftest%2Fui%2Fmacros%2Fmacro-multiple-matcher-bindings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Ftest%2Fui%2Fmacros%2Fmacro-multiple-matcher-bindings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-multiple-matcher-bindings.rs?ref=d7f5c50a335204e00565c978f5eb7fac40468f96", "patch": "@@ -1,16 +1,12 @@\n // Test that duplicate matcher binding names are caught at declaration time, rather than at macro\n // invocation time.\n-//\n-// FIXME(mark-i-m): Update this when it becomes a hard error.\n-\n-// compile-pass\n \n #![allow(unused_macros)]\n #![warn(duplicate_matcher_binding_name)]\n \n macro_rules! foo1 {\n-    ($a:ident, $a:ident) => {}; //~WARNING duplicate matcher binding\n-    ($a:ident, $a:path) => {};  //~WARNING duplicate matcher binding\n+    ($a:ident, $a:ident) => {}; //~ERROR duplicate matcher binding\n+    ($a:ident, $a:path) => {};  //~ERROR duplicate matcher binding\n }\n \n macro_rules! foo2 {\n@@ -19,8 +15,8 @@ macro_rules! foo2 {\n }\n \n macro_rules! foo3 {\n-    ($a:ident, $($a:ident),*) => {}; //~WARNING duplicate matcher binding\n-    ($($a:ident)+ # $($($a:path),+);*) => {}; //~WARNING duplicate matcher binding\n+    ($a:ident, $($a:ident),*) => {}; //~ERROR duplicate matcher binding\n+    ($($a:ident)+ # $($($a:path),+);*) => {}; //~ERROR duplicate matcher binding\n }\n \n fn main() {}"}, {"sha": "65362388d7de168a2e3c6ba414278fd068d90cc7", "filename": "src/test/ui/macros/macro-multiple-matcher-bindings.stderr", "status": "modified", "additions": 33, "deletions": 24, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Ftest%2Fui%2Fmacros%2Fmacro-multiple-matcher-bindings.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7f5c50a335204e00565c978f5eb7fac40468f96/src%2Ftest%2Fui%2Fmacros%2Fmacro-multiple-matcher-bindings.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-multiple-matcher-bindings.stderr?ref=d7f5c50a335204e00565c978f5eb7fac40468f96", "patch": "@@ -1,41 +1,50 @@\n-warning: duplicate matcher binding\n-  --> $DIR/macro-multiple-matcher-bindings.rs:12:6\n+error: duplicate matcher binding\n+  --> $DIR/macro-multiple-matcher-bindings.rs:7:16\n    |\n LL |     ($a:ident, $a:ident) => {};\n-   |      ^^^^^^^^  ^^^^^^^^\n+   |                ^^^^^^^^\n    |\n-note: lint level defined here\n-  --> $DIR/macro-multiple-matcher-bindings.rs:9:9\n+note: previous declaration was here\n+  --> $DIR/macro-multiple-matcher-bindings.rs:7:6\n    |\n-LL | #![warn(duplicate_matcher_binding_name)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n-   = note: for more information, see issue #57593 <https://github.com/rust-lang/rust/issues/57593>\n+LL |     ($a:ident, $a:ident) => {};\n+   |      ^^^^^^^^\n \n-warning: duplicate matcher binding\n-  --> $DIR/macro-multiple-matcher-bindings.rs:13:6\n+error: duplicate matcher binding\n+  --> $DIR/macro-multiple-matcher-bindings.rs:8:16\n    |\n LL |     ($a:ident, $a:path) => {};\n-   |      ^^^^^^^^  ^^^^^^^\n+   |                ^^^^^^^\n+   |\n+note: previous declaration was here\n+  --> $DIR/macro-multiple-matcher-bindings.rs:8:6\n    |\n-   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n-   = note: for more information, see issue #57593 <https://github.com/rust-lang/rust/issues/57593>\n+LL |     ($a:ident, $a:path) => {};\n+   |      ^^^^^^^^\n \n-warning: duplicate matcher binding\n-  --> $DIR/macro-multiple-matcher-bindings.rs:22:6\n+error: duplicate matcher binding\n+  --> $DIR/macro-multiple-matcher-bindings.rs:17:18\n    |\n LL |     ($a:ident, $($a:ident),*) => {};\n-   |      ^^^^^^^^    ^^^^^^^^\n+   |                  ^^^^^^^^\n+   |\n+note: previous declaration was here\n+  --> $DIR/macro-multiple-matcher-bindings.rs:17:6\n    |\n-   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n-   = note: for more information, see issue #57593 <https://github.com/rust-lang/rust/issues/57593>\n+LL |     ($a:ident, $($a:ident),*) => {};\n+   |      ^^^^^^^^\n \n-warning: duplicate matcher binding\n-  --> $DIR/macro-multiple-matcher-bindings.rs:23:8\n+error: duplicate matcher binding\n+  --> $DIR/macro-multiple-matcher-bindings.rs:18:25\n    |\n LL |     ($($a:ident)+ # $($($a:path),+);*) => {};\n-   |        ^^^^^^^^         ^^^^^^^\n+   |                         ^^^^^^^\n+   |\n+note: previous declaration was here\n+  --> $DIR/macro-multiple-matcher-bindings.rs:18:8\n    |\n-   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n-   = note: for more information, see issue #57593 <https://github.com/rust-lang/rust/issues/57593>\n+LL |     ($($a:ident)+ # $($($a:path),+);*) => {};\n+   |        ^^^^^^^^\n+\n+error: aborting due to 4 previous errors\n "}]}