{"sha": "ce0e5558da1279baba8c744c56bd227b4d2d29d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlMGU1NTU4ZGExMjc5YmFiYThjNzQ0YzU2YmQyMjdiNGQyZDI5ZDU=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-01-20T19:52:16Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-01-20T19:52:16Z"}, "message": "Add span for bad doc comment", "tree": {"sha": "b0b9ab8e72e203a09647ccd3797fba2ee8ddcba9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0b9ab8e72e203a09647ccd3797fba2ee8ddcba9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce0e5558da1279baba8c744c56bd227b4d2d29d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce0e5558da1279baba8c744c56bd227b4d2d29d5", "html_url": "https://github.com/rust-lang/rust/commit/ce0e5558da1279baba8c744c56bd227b4d2d29d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce0e5558da1279baba8c744c56bd227b4d2d29d5/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4db2394156b408e7af5c595bf3c9cbff8ba21157", "url": "https://api.github.com/repos/rust-lang/rust/commits/4db2394156b408e7af5c595bf3c9cbff8ba21157", "html_url": "https://github.com/rust-lang/rust/commit/4db2394156b408e7af5c595bf3c9cbff8ba21157"}], "stats": {"total": 12, "additions": 8, "deletions": 4}, "files": [{"sha": "3195435bba5ad3012107adf797d1b743dfcb1c20", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ce0e5558da1279baba8c744c56bd227b4d2d29d5/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce0e5558da1279baba8c744c56bd227b4d2d29d5/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=ce0e5558da1279baba8c744c56bd227b4d2d29d5", "patch": "@@ -4483,13 +4483,17 @@ impl<'a> Parser<'a> {\n     }\n \n     /// Emit an expected item after attributes error.\n-    fn expected_item_err(&self, attrs: &[Attribute]) {\n+    fn expected_item_err(&mut self, attrs: &[Attribute]) -> PResult<'a,  ()> {\n         let message = match attrs.last() {\n             Some(&Attribute { is_sugared_doc: true, .. }) => \"expected item after doc comment\",\n             _ => \"expected item after attributes\",\n         };\n \n-        self.span_err(self.prev_span, message);\n+        let mut err = self.diagnostic().struct_span_err(self.prev_span, message);\n+        if attrs.last().unwrap().is_sugared_doc {\n+            err.span_label(self.prev_span, \"this doc comment doesn't document anything\");\n+        }\n+        Err(err)\n     }\n \n     /// Parse a statement. This stops just before trailing semicolons on everything but items.\n@@ -7636,7 +7640,7 @@ impl<'a> Parser<'a> {\n             }\n             None => {\n                 if !attrs.is_empty()  {\n-                    self.expected_item_err(&attrs);\n+                    self.expected_item_err(&attrs)?;\n                 }\n \n                 self.unexpected()\n@@ -7699,7 +7703,7 @@ impl<'a> Parser<'a> {\n         }\n \n         if !attributes_allowed && !attrs.is_empty() {\n-            self.expected_item_err(&attrs);\n+            self.expected_item_err(&attrs)?;\n         }\n         Ok(None)\n     }"}]}