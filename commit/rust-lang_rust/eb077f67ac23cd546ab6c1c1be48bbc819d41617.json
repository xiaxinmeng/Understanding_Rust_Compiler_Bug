{"sha": "eb077f67ac23cd546ab6c1c1be48bbc819d41617", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViMDc3ZjY3YWMyM2NkNTQ2YWI2YzFjMWJlNDhiYmM4MTlkNDE2MTc=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2018-07-23T09:17:39Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2018-07-23T09:17:39Z"}, "message": "Support metadata writing", "tree": {"sha": "c582e5da037a4e6d44aa52a55415c3a6f12c2163", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c582e5da037a4e6d44aa52a55415c3a6f12c2163"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb077f67ac23cd546ab6c1c1be48bbc819d41617", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb077f67ac23cd546ab6c1c1be48bbc819d41617", "html_url": "https://github.com/rust-lang/rust/commit/eb077f67ac23cd546ab6c1c1be48bbc819d41617", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb077f67ac23cd546ab6c1c1be48bbc819d41617/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e40d02584332eb0752ff28df84ea4a76041ecea1", "url": "https://api.github.com/repos/rust-lang/rust/commits/e40d02584332eb0752ff28df84ea4a76041ecea1", "html_url": "https://github.com/rust-lang/rust/commit/e40d02584332eb0752ff28df84ea4a76041ecea1"}], "stats": {"total": 550, "additions": 471, "deletions": 79}, "files": [{"sha": "279484b1af7cf1eb4a2bcb8f30f926e00eac04b4", "filename": ".gitmodules", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb077f67ac23cd546ab6c1c1be48bbc819d41617/.gitmodules", "raw_url": "https://github.com/rust-lang/rust/raw/eb077f67ac23cd546ab6c1c1be48bbc819d41617/.gitmodules", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.gitmodules?ref=eb077f67ac23cd546ab6c1c1be48bbc819d41617", "patch": "@@ -1,3 +1,3 @@\n [submodule \"cranelift\"]\n \tpath = cranelift\n-\turl = https://github.com/CraneStation/cranelift.git\n+\turl = https://github.com/bjorn3/cretonne.git"}, {"sha": "df75a456740c3657d1b34dda1117db9a2b290807", "filename": "Cargo.lock", "status": "modified", "additions": 410, "deletions": 39, "changes": 449, "blob_url": "https://github.com/rust-lang/rust/blob/eb077f67ac23cd546ab6c1c1be48bbc819d41617/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/eb077f67ac23cd546ab6c1c1be48bbc819d41617/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=eb077f67ac23cd546ab6c1c1be48bbc819d41617", "patch": "@@ -1,3 +1,29 @@\n+[[package]]\n+name = \"aho-corasick\"\n+version = \"0.6.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"memchr 2.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"ansi_term\"\n+version = \"0.11.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"winapi 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"atty\"\n+version = \"0.2.10\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"termion 1.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"winapi 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"backtrace\"\n version = \"0.3.9\"\n@@ -6,7 +32,7 @@ dependencies = [\n  \"backtrace-sys 0.1.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cfg-if 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rustc-demangle 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rustc-demangle 0.1.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"winapi 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -15,7 +41,7 @@ name = \"backtrace-sys\"\n version = \"0.1.23\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"cc 1.0.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"cc 1.0.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -31,68 +57,99 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"cc\"\n-version = \"1.0.17\"\n+version = \"1.0.18\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"cfg-if\"\n version = \"0.1.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"clap\"\n+version = \"2.32.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"ansi_term 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"atty 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"bitflags 1.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"strsim 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"textwrap 0.10.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"vec_map 0.8.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"cranelift\"\n-version = \"0.14.0\"\n+version = \"0.16.1\"\n dependencies = [\n- \"cranelift-codegen 0.14.0\",\n- \"cranelift-frontend 0.14.0\",\n+ \"cranelift-codegen 0.16.1\",\n+ \"cranelift-frontend 0.16.1\",\n ]\n \n [[package]]\n name = \"cranelift-codegen\"\n-version = \"0.14.0\"\n+version = \"0.16.1\"\n dependencies = [\n- \"cranelift-entity 0.14.0\",\n+ \"cranelift-codegen-meta 0.15.0\",\n+ \"cranelift-entity 0.16.1\",\n  \"failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"failure_derive 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"target-lexicon 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"cranelift-codegen-meta\"\n+version = \"0.15.0\"\n+\n [[package]]\n name = \"cranelift-entity\"\n-version = \"0.14.0\"\n+version = \"0.16.1\"\n+\n+[[package]]\n+name = \"cranelift-faerie\"\n+version = \"0.16.1\"\n+dependencies = [\n+ \"cranelift-codegen 0.16.1\",\n+ \"cranelift-module 0.16.1\",\n+ \"faerie 0.4.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"goblin 0.0.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"target-lexicon 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n \n [[package]]\n name = \"cranelift-frontend\"\n-version = \"0.14.0\"\n+version = \"0.16.1\"\n dependencies = [\n- \"cranelift-codegen 0.14.0\",\n+ \"cranelift-codegen 0.16.1\",\n ]\n \n [[package]]\n name = \"cranelift-module\"\n-version = \"0.14.0\"\n+version = \"0.16.1\"\n dependencies = [\n- \"cranelift-codegen 0.14.0\",\n- \"cranelift-entity 0.14.0\",\n+ \"cranelift-codegen 0.16.1\",\n+ \"cranelift-entity 0.16.1\",\n  \"failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"cranelift-native\"\n-version = \"0.14.0\"\n+version = \"0.16.1\"\n dependencies = [\n- \"cranelift-codegen 0.14.0\",\n+ \"cranelift-codegen 0.16.1\",\n  \"raw-cpuid 3.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"target-lexicon 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"cranelift-simplejit\"\n-version = \"0.14.0\"\n+version = \"0.16.1\"\n dependencies = [\n- \"cranelift-codegen 0.14.0\",\n- \"cranelift-module 0.14.0\",\n- \"cranelift-native 0.14.0\",\n+ \"cranelift-codegen 0.16.1\",\n+ \"cranelift-module 0.16.1\",\n+ \"cranelift-native 0.16.1\",\n  \"errno 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"region 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -102,8 +159,20 @@ dependencies = [\n \n [[package]]\n name = \"dtoa\"\n-version = \"0.4.2\"\n+version = \"0.4.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"env_logger\"\n+version = \"0.5.10\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"atty 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"humantime 1.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"log 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"regex 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"termcolor 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n \n [[package]]\n name = \"errno\"\n@@ -124,6 +193,23 @@ dependencies = [\n  \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"faerie\"\n+version = \"0.4.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"env_logger 0.5.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"goblin 0.0.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"indexmap 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"log 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"scroll 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"string-interner 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"structopt 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"structopt-derive 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"target-lexicon 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"failure\"\n version = \"0.1.1\"\n@@ -148,16 +234,52 @@ name = \"gcc\"\n version = \"0.3.54\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"goblin\"\n+version = \"0.0.17\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"log 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"plain 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"scroll 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"humantime\"\n+version = \"1.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"quick-error 1.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"indexmap\"\n+version = \"1.0.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"itoa\"\n-version = \"0.4.1\"\n+version = \"0.4.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"lazy_static\"\n+version = \"1.0.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"libc\"\n version = \"0.2.42\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"log\"\n+version = \"0.4.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"cfg-if 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"mach\"\n version = \"0.1.2\"\n@@ -166,18 +288,85 @@ dependencies = [\n  \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"memchr\"\n+version = \"2.0.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"plain\"\n+version = \"0.2.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"proc-macro2\"\n+version = \"0.4.9\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"quick-error\"\n+version = \"1.2.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"quote\"\n version = \"0.3.15\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"quote\"\n+version = \"0.6.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"proc-macro2 0.4.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"raw-cpuid\"\n version = \"3.1.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"cc 1.0.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"cc 1.0.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"redox_syscall\"\n+version = \"0.1.40\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"redox_termios\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"redox_syscall 0.1.40 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"regex\"\n+version = \"1.0.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"aho-corasick 0.6.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"memchr 2.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"regex-syntax 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"thread_local 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"utf8-ranges 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"regex-syntax\"\n+version = \"0.6.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"ucd-util 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -195,31 +384,83 @@ dependencies = [\n \n [[package]]\n name = \"rustc-demangle\"\n-version = \"0.1.8\"\n+version = \"0.1.9\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"rustc_codegen_cranelift\"\n version = \"0.1.0\"\n dependencies = [\n- \"cranelift 0.14.0\",\n- \"cranelift-module 0.14.0\",\n- \"cranelift-simplejit 0.14.0\",\n+ \"cranelift 0.16.1\",\n+ \"cranelift-faerie 0.16.1\",\n+ \"cranelift-module 0.16.1\",\n+ \"cranelift-simplejit 0.16.1\",\n+ \"target-lexicon 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"scroll\"\n+version = \"0.9.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"scroll_derive 0.9.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"scroll_derive\"\n+version = \"0.9.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"proc-macro2 0.4.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"quote 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.14.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"serde\"\n-version = \"1.0.68\"\n+version = \"1.0.70\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"serde_json\"\n-version = \"1.0.22\"\n+version = \"1.0.24\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"dtoa 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"itoa 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.70 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"string-interner\"\n+version = \"0.6.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"dtoa 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"itoa 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.68 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.70 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"strsim\"\n+version = \"0.7.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"structopt\"\n+version = \"0.2.10\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"clap 2.32.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"structopt-derive 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"structopt-derive\"\n+version = \"0.2.10\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"proc-macro2 0.4.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"quote 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.14.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -232,6 +473,16 @@ dependencies = [\n  \"unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"syn\"\n+version = \"0.14.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"proc-macro2 0.4.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"quote 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"synom\"\n version = \"0.11.3\"\n@@ -256,14 +507,87 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"failure_derive 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_json 1.0.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"termcolor\"\n+version = \"0.3.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"wincolor 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"termion\"\n+version = \"1.5.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"redox_syscall 0.1.40 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"redox_termios 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"textwrap\"\n+version = \"0.10.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"thread_local\"\n+version = \"0.3.5\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"lazy_static 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"unreachable 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"ucd-util\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"unicode-width\"\n+version = \"0.1.5\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"unicode-xid\"\n version = \"0.0.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"unicode-xid\"\n+version = \"0.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"unreachable\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"void 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"utf8-ranges\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"vec_map\"\n+version = \"0.8.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n+[[package]]\n+name = \"void\"\n+version = \"1.0.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"winapi\"\n version = \"0.3.5\"\n@@ -283,33 +607,80 @@ name = \"winapi-x86_64-pc-windows-gnu\"\n version = \"0.4.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"wincolor\"\n+version = \"0.1.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"winapi 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [metadata]\n+\"checksum aho-corasick 0.6.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c1c6d463cbe7ed28720b5b489e7c083eeb8f90d08be2a0d6bb9e1ffea9ce1afa\"\n+\"checksum ansi_term 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ee49baf6cb617b853aa8d93bf420db2383fab46d314482ca2803b40d5fde979b\"\n+\"checksum atty 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2fc4a1aa4c24c0718a250f0681885c1af91419d242f29eb8f2ab28502d80dbd1\"\n \"checksum backtrace 0.3.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"89a47830402e9981c5c41223151efcced65a0510c13097c769cede7efb34782a\"\n \"checksum backtrace-sys 0.1.23 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bff67d0c06556c0b8e6b5f090f0eac52d950d9dfd1d35ba04e4ca3543eaf6a7e\"\n \"checksum bitflags 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"aad18937a628ec6abcd26d1489012cc0e18c21798210f491af69ded9b881106d\"\n \"checksum bitflags 1.0.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d0c54bb8f454c567f21197eefcdbf5679d0bd99f2ddbe52e84c77061952e6789\"\n-\"checksum cc 1.0.17 (registry+https://github.com/rust-lang/crates.io-index)\" = \"49ec142f5768efb5b7622aebc3fdbdbb8950a4b9ba996393cb76ef7466e8747d\"\n+\"checksum cc 1.0.18 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2119ea4867bd2b8ed3aecab467709720b2d55b1bcfe09f772fd68066eaf15275\"\n \"checksum cfg-if 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"efe5c877e17a9c717a0bf3613b2709f723202c4e4675cc8f12926ded29bcb17e\"\n-\"checksum dtoa 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"09c3753c3db574d215cba4ea76018483895d7bff25a31b49ba45db21c48e50ab\"\n+\"checksum clap 2.32.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b957d88f4b6a63b9d70d5f454ac8011819c6efa7727858f458ab71c756ce2d3e\"\n+\"checksum dtoa 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6d301140eb411af13d3115f9a562c85cc6b541ade9dfa314132244aaee7489dd\"\n+\"checksum env_logger 0.5.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0e6e40ebb0e66918a37b38c7acab4e10d299e0463fe2af5d29b9cc86710cfd2a\"\n \"checksum errno 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c2a071601ed01b988f896ab14b95e67335d1eeb50190932a1320f7fe3cadc84e\"\n \"checksum errno-dragonfly 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"14ca354e36190500e1e1fb267c647932382b54053c50b14970856c0b00a35067\"\n+\"checksum faerie 0.4.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"319f742885b740cec9adca9a9b4bc35229d7e004af9431c694e0aef3eea00f55\"\n \"checksum failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"934799b6c1de475a012a02dab0ace1ace43789ee4b99bcfbf1a2e3e8ced5de82\"\n \"checksum failure_derive 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c7cdda555bb90c9bb67a3b670a0f42de8e73f5981524123ad8578aafec8ddb8b\"\n \"checksum gcc 0.3.54 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5e33ec290da0d127825013597dbdfc28bee4964690c7ce1166cbc2a7bd08b1bb\"\n-\"checksum itoa 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c069bbec61e1ca5a596166e55dfe4773ff745c3d16b700013bcaff9a6df2c682\"\n+\"checksum goblin 0.0.17 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5911d7df7b8f65ab676c5327b50acea29d3c6a1a4ad05e444cf5dce321b26db2\"\n+\"checksum humantime 1.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0484fda3e7007f2a4a0d9c3a703ca38c71c54c55602ce4660c419fd32e188c9e\"\n+\"checksum indexmap 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"08173ba1e906efb6538785a8844dd496f5d34f0a2d88038e95195172fc667220\"\n+\"checksum itoa 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5adb58558dcd1d786b5f0bd15f3226ee23486e24b7b58304b60f64dc68e62606\"\n+\"checksum lazy_static 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fb497c35d362b6a331cfd94956a07fc2c78a4604cdbee844a81170386b996dd3\"\n \"checksum libc 0.2.42 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b685088df2b950fccadf07a7187c8ef846a959c142338a48f9dc0b94517eb5f1\"\n+\"checksum log 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"61bd98ae7f7b754bc53dca7d44b604f733c6bba044ea6f41bc8d89272d8161d2\"\n \"checksum mach 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2fd13ee2dd61cc82833ba05ade5a30bb3d63f7ced605ef827063c63078302de9\"\n+\"checksum memchr 2.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"796fba70e76612589ed2ce7f45282f5af869e0fdd7cc6199fa1aa1f1d591ba9d\"\n+\"checksum plain 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b4596b6d070b27117e987119b4dac604f3c58cfb0b191112e24771b2faeac1a6\"\n+\"checksum proc-macro2 0.4.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cccdc7557a98fe98453030f077df7f3a042052fae465bb61d2c2c41435cfd9b6\"\n+\"checksum quick-error 1.2.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9274b940887ce9addde99c4eee6b5c44cc494b182b97e73dc8ffdcb3397fd3f0\"\n \"checksum quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7a6e920b65c65f10b2ae65c831a81a073a89edd28c7cce89475bff467ab4167a\"\n+\"checksum quote 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e44651a0dc4cdd99f71c83b561e221f714912d11af1a4dff0631f923d53af035\"\n \"checksum raw-cpuid 3.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"233ec1847057cf4d4591a0d76908aa12812140b11ea7d7d05b4c38cadb069c31\"\n+\"checksum redox_syscall 0.1.40 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c214e91d3ecf43e9a4e41e578973adeb14b474f2bee858742d127af75a0112b1\"\n+\"checksum redox_termios 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7e891cfe48e9100a70a3b6eb652fef28920c117d366339687bd5576160db0f76\"\n+\"checksum regex 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5bbbea44c5490a1e84357ff28b7d518b4619a159fed5d25f6c1de2d19cc42814\"\n+\"checksum regex-syntax 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"747ba3b235651f6e2f67dfa8bcdcd073ddb7c243cb21c442fc12395dfcac212d\"\n \"checksum region 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3f9d3f2bb4b7085e6996e2765b56b783bd8f3a8a4ea5b95683063ca13cded993\"\n-\"checksum rustc-demangle 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"76d7ba1feafada44f2d38eed812bd2489a03c0f5abb975799251518b68848649\"\n-\"checksum serde 1.0.68 (registry+https://github.com/rust-lang/crates.io-index)\" = \"429fcc4efa8a11341b5422c2ace724daba276c1748467e869478f53c0ba4562e\"\n-\"checksum serde_json 1.0.22 (registry+https://github.com/rust-lang/crates.io-index)\" = \"84b8035cabe9b35878adec8ac5fe03d5f6bc97ff6edd7ccb96b44c1276ba390e\"\n+\"checksum rustc-demangle 0.1.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bcfe5b13211b4d78e5c2cadfebd7769197d95c639c35a50057eb4c05de811395\"\n+\"checksum scroll 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"66f024a8cc5e456eb870f688dbd899c84f61190c82c7a911e40f926941969074\"\n+\"checksum scroll_derive 0.9.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f9a353f5dd99e42ff097d5a61db3257aa2c7127d76a3fa8287b642ef9ae0f7c5\"\n+\"checksum serde 1.0.70 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0c3adf19c07af6d186d91dae8927b83b0553d07ca56cbf7f2f32560455c91920\"\n+\"checksum serde_json 1.0.24 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c3c6908c7b925cd6c590358a4034de93dbddb20c45e1d021931459fd419bf0e2\"\n+\"checksum string-interner 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"abb38a0d8fe673c40b10b6b75abcb076a958cc10fb894f14993d9737c4c87000\"\n+\"checksum strsim 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bb4f380125926a99e52bc279241539c018323fab05ad6368b56f93d9369ff550\"\n+\"checksum structopt 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d8e9ad6a11096cbecdcca0cc6aa403fdfdbaeda2fb3323a39c98e6a166a1e45a\"\n+\"checksum structopt-derive 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4cbce8ccdc62166bd594c14396a3242bf94c337a51dbfa9be1076dd74b3db2af\"\n \"checksum syn 0.11.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d3b891b9015c88c576343b9b3e41c2c11a51c219ef067b264bd9c8aa9b441dad\"\n+\"checksum syn 0.14.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2beff8ebc3658f07512a413866875adddd20f4fd47b2a4e6c9da65cd281baaea\"\n \"checksum synom 0.11.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a393066ed9010ebaed60b9eafa373d4b1baac186dd7e008555b0f702b51945b6\"\n \"checksum synstructure 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3a761d12e6d8dcb4dcf952a7a89b475e3a9d69e4a69307e01a470977642914bd\"\n \"checksum target-lexicon 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a34226bd63b5a26fc909f5f0d7ef4dc55d5851077035e49437e4e14bf567247f\"\n+\"checksum termcolor 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"adc4587ead41bf016f11af03e55a624c06568b5a19db4e90fde573d805074f83\"\n+\"checksum termion 1.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"689a3bdfaab439fd92bc87df5c4c78417d3cbe537487274e9b0b2dce76e92096\"\n+\"checksum textwrap 0.10.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"307686869c93e71f94da64286f9a9524c0f308a9e1c87a583de8e9c9039ad3f6\"\n+\"checksum thread_local 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"279ef31c19ededf577bfd12dfae728040a21f635b06a24cd670ff510edd38963\"\n+\"checksum ucd-util 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fd2be2d6639d0f8fe6cdda291ad456e23629558d466e2789d2c3e9892bda285d\"\n+\"checksum unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"882386231c45df4700b275c7ff55b6f3698780a650026380e72dabe76fa46526\"\n \"checksum unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8c1f860d7d29cf02cb2f3f359fd35991af3d30bac52c57d265a3c461074cb4dc\"\n+\"checksum unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fc72304796d0818e357ead4e000d19c9c174ab23dc11093ac919054d20a6a7fc\"\n+\"checksum unreachable 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"382810877fe448991dfc7f0dd6e3ae5d58088fd0ea5e35189655f84e6814fa56\"\n+\"checksum utf8-ranges 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"662fab6525a98beff2921d7f61a39e7d59e0b425ebc7d0d9e66d316e55124122\"\n+\"checksum vec_map 0.8.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"05c78687fb1a80548ae3250346c3db86a80a7cdd77bda190189f2d0a0987c81a\"\n+\"checksum void 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6a02e4885ed3bc0f2de90ea6dd45ebcbb66dacffe03547fadbb0eeae2770887d\"\n \"checksum winapi 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"773ef9dcc5f24b7d850d0ff101e542ff24c3b090a9768e03ff889fdef41f00fd\"\n \"checksum winapi-i686-pc-windows-gnu 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6\"\n \"checksum winapi-x86_64-pc-windows-gnu 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f\"\n+\"checksum wincolor 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eeb06499a3a4d44302791052df005d5232b927ed1a9658146d842165c4de7767\""}, {"sha": "921a65bcedf4fdc8bee9ee696a509b35e3c2b319", "filename": "Cargo.toml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/eb077f67ac23cd546ab6c1c1be48bbc819d41617/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/eb077f67ac23cd546ab6c1c1be48bbc819d41617/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=eb077f67ac23cd546ab6c1c1be48bbc819d41617", "patch": "@@ -15,4 +15,5 @@ crate-type = [\"dylib\"]\n cranelift = { path = \"./cranelift/lib/umbrella\" }\n cranelift-module = { path = \"./cranelift/lib/module\" }\n cranelift-simplejit = { path = \"./cranelift/lib/simplejit\" }\n-#cranelift-faerie = { path = \"./cranelift/lib/faerie\" }\n+cranelift-faerie = { path = \"./cranelift/lib/faerie\" }\n+target-lexicon = \"0.0.3\""}, {"sha": "4d50ef87a2f8faa4e590423f712d99bef5cb9148", "filename": "cranelift", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cranelift?ref=eb077f67ac23cd546ab6c1c1be48bbc819d41617", "patch": "@@ -1 +1 @@\n-Subproject commit 1c3601789df0ad52880feebc2e641848838b7c14\n+Subproject commit 4d50ef87a2f8faa4e590423f712d99bef5cb9148"}, {"sha": "2e6d0bcd154911e18a87ceb76240379320613400", "filename": "src/base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb077f67ac23cd546ab6c1c1be48bbc819d41617/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb077f67ac23cd546ab6c1c1be48bbc819d41617/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=eb077f67ac23cd546ab6c1c1be48bbc819d41617", "patch": "@@ -318,7 +318,7 @@ fn trans_stmt<'a, 'tcx: 'a>(fx: &mut FunctionCx<'a, 'tcx>, cur_ebb: Ebb, stmt: &\n                             let res = ::common::cton_intcast(fx, from, from_ty, to_ty, true);\n                             lval.write_cvalue(fx, CValue::ByVal(res, dest_layout));\n                         }\n-                        _ => unimplemented!(\"rval misc {:?} {:?}\", operand, to_ty),\n+                        _ => return Err(format!(\"rval misc {:?} {:?}\", operand, to_ty)),\n                     }\n                 },\n                 Rvalue::Cast(CastKind::ClosureFnPointer, operand, ty) => unimplemented!(\"rval closure_fn_ptr {:?} {:?}\", operand, ty),"}, {"sha": "c3294c3c4cfaf1e3c26fa40f1fe27df707264244", "filename": "src/lib.rs", "status": "modified", "additions": 56, "deletions": 36, "changes": 92, "blob_url": "https://github.com/rust-lang/rust/blob/eb077f67ac23cd546ab6c1c1be48bbc819d41617/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb077f67ac23cd546ab6c1c1be48bbc819d41617/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=eb077f67ac23cd546ab6c1c1be48bbc819d41617", "patch": "@@ -10,10 +10,17 @@ extern crate rustc_target;\n extern crate rustc_incremental;\n extern crate rustc_data_structures;\n \n+extern crate target_lexicon;\n extern crate cranelift;\n extern crate cranelift_module;\n extern crate cranelift_simplejit;\n-//extern crate cranelift_faerie;\n+extern crate cranelift_faerie;\n+\n+use std::any::Any;\n+use std::sync::{mpsc, Arc};\n+use std::path::Path;\n+use std::fs::File;\n+use std::io::Write;\n \n use syntax::symbol::Symbol;\n use rustc::session::{\n@@ -23,16 +30,15 @@ use rustc::session::{\n         OutputFilenames,\n     },\n };\n-use rustc::middle::cstore::{MetadataLoader, EncodedMetadata};\n+use rustc::middle::cstore::MetadataLoader;\n use rustc::dep_graph::DepGraph;\n use rustc::ty::query::Providers;\n-use rustc_codegen_utils::codegen_backend::{CodegenBackend, NoLlvmMetadataLoader};\n+use rustc_codegen_utils::codegen_backend::CodegenBackend;\n use rustc_codegen_utils::link::{out_filename, build_link_meta};\n+use rustc_data_structures::owning_ref;\n \n-use std::any::Any;\n-use std::sync::{mpsc, Arc};\n-use std::fs::File;\n-use std::io::Write;\n+use cranelift::codegen::settings;\n+use cranelift_faerie::*;\n \n mod abi;\n mod base;\n@@ -63,7 +69,7 @@ mod prelude {\n     };\n     pub use cranelift::codegen::Context;\n     pub use cranelift::prelude::*;\n-    pub use cranelift_module::{Module, Backend, FuncId, DataId, Linkage};\n+    pub use cranelift_module::{Module, Backend, DataContext, FuncId, DataId, Linkage, Writability};\n     pub use cranelift_simplejit::{SimpleJITBuilder, SimpleJITBackend};\n \n     pub use abi::*;\n@@ -82,20 +88,25 @@ pub struct CodegenCx<'a, 'tcx: 'a, B: Backend + 'a> {\n     pub constants: HashMap<AllocId, DataId>,\n }\n \n-struct CraneliftCodegenBackend(());\n+struct CraneliftMetadataLoader;\n \n-struct OngoingCodegen {\n-    metadata: EncodedMetadata,\n-    //translated_module: Module<cranelift_faerie::FaerieBackend>,\n-    crate_name: Symbol,\n-}\n+impl MetadataLoader for CraneliftMetadataLoader {\n+    fn get_rlib_metadata(&self, target: &rustc_target::spec::Target, path: &Path) -> Result<owning_ref::ErasedBoxRef<[u8]>, String> {\n+        self.get_dylib_metadata(target, path)\n+    }\n \n-impl CraneliftCodegenBackend {\n-    fn new() -> Box<CodegenBackend> {\n-        Box::new(CraneliftCodegenBackend(()))\n+    fn get_dylib_metadata(&self, _target: &rustc_target::spec::Target, _path: &Path) -> Result<owning_ref::ErasedBoxRef<[u8]>, String> {\n+        Err(\"metadata loading is not yet supported\".to_string())\n     }\n }\n \n+struct CraneliftCodegenBackend;\n+\n+struct OngoingCodegen {\n+    translated_module: Module<cranelift_faerie::FaerieBackend>,\n+    crate_name: Symbol,\n+}\n+\n impl CodegenBackend for CraneliftCodegenBackend {\n     fn init(&self, sess: &Session) {\n         for cty in sess.opts.crate_types.iter() {\n@@ -112,16 +123,13 @@ impl CodegenBackend for CraneliftCodegenBackend {\n     }\n \n     fn metadata_loader(&self) -> Box<MetadataLoader + Sync> {\n-        Box::new(NoLlvmMetadataLoader)\n+        Box::new(CraneliftMetadataLoader)\n     }\n \n     fn provide(&self, providers: &mut Providers) {\n         rustc_codegen_utils::symbol_names::provide(providers);\n \n         providers.target_features_whitelist = |_tcx, _cnum| {\n-            /*Lrc::new(rustc_codegen_utils::llvm_target_features::all_known_features()\n-                .map(|(a, b)| (a.to_string(), b.map(|s| s.to_string())))\n-                .collect())*/\n             Lrc::new(Default::default())\n         };\n         providers.is_reachable_non_generic = |_tcx, _defid| true;\n@@ -172,6 +180,10 @@ impl CodegenBackend for CraneliftCodegenBackend {\n         let link_meta = ::build_link_meta(tcx.crate_hash(LOCAL_CRATE));\n         let metadata = tcx.encode_metadata(&link_meta);\n \n+        let mut flags_builder = settings::builder();\n+        flags_builder.enable(\"is_pic\").unwrap();\n+        let flags = settings::Flags::new(flags_builder);\n+        let isa = cranelift::codegen::isa::lookup(target_lexicon::Triple::host()).unwrap().finish(flags);\n         let mut module: Module<SimpleJITBackend> = Module::new(SimpleJITBuilder::new());\n         let mut context = Context::new();\n         let mut def_id_fn_id_map = HashMap::new();\n@@ -219,11 +231,23 @@ impl CodegenBackend for CraneliftCodegenBackend {\n             module.finish();\n         }\n \n-        tcx.sess.fatal(\"unimplemented\");\n+        let mut translated_module = Module::new(\n+            FaerieBuilder::new(\n+                isa,\n+                \"some_file.o\".to_string(),\n+                FaerieTrapCollection::Disabled,\n+                FaerieBuilder::default_libcall_names()\n+            )\n+                .unwrap()\n+        );\n+\n+        let metadata_id = translated_module.declare_data(\".rustc.metadata\", Linkage::Export, false).unwrap();\n+        let mut data_ctx = DataContext::new();\n+        data_ctx.define(metadata.raw_data.clone().into_boxed_slice(), Writability::Readonly);\n+        translated_module.define_data(metadata_id, &data_ctx).unwrap();\n \n         Box::new(::OngoingCodegen {\n-            metadata: metadata,\n-            //translated_module: Module::new(::cranelift_faerie::FaerieBuilder::new(,\n+            translated_module,\n             crate_name: tcx.crate_name(LOCAL_CRATE),\n         })\n     }\n@@ -235,21 +259,17 @@ impl CodegenBackend for CraneliftCodegenBackend {\n         _dep_graph: &DepGraph,\n         outputs: &OutputFilenames,\n     ) -> Result<(), CompileIncomplete> {\n-        if true {\n-            unimplemented!();\n-        }\n-\n-        let ongoing_codegen = ongoing_codegen.downcast::<OngoingCodegen>()\n-            .expect(\"Expected MetadataOnlyCodegenBackend's OngoingCodegen, found Box<Any>\");\n+        let ongoing_codegen = *ongoing_codegen.downcast::<OngoingCodegen>()\n+            .expect(\"Expected CraneliftCodegenBackend's OngoingCodegen, found Box<Any>\");\n+        let artifact = ongoing_codegen.translated_module.finish().artifact;\n         for &crate_type in sess.opts.crate_types.iter() {\n-            if crate_type != CrateType::CrateTypeRlib && crate_type != CrateType::CrateTypeDylib {\n-                continue;\n+            if crate_type != CrateType::CrateTypeRlib /*&& crate_type != CrateType::CrateTypeDylib*/ {\n+                sess.fatal(&format!(\"Unsupported crate type: {:?}\", crate_type));\n             }\n             let output_name =\n                 out_filename(sess, crate_type, &outputs, &ongoing_codegen.crate_name.as_str());\n-            let metadata = &ongoing_codegen.metadata.raw_data;\n-            let mut file = File::create(&output_name).unwrap();\n-            file.write_all(metadata).unwrap();\n+            let file = File::create(&output_name).unwrap();\n+            artifact.write(file).unwrap();\n         }\n \n         sess.abort_if_errors();\n@@ -265,5 +285,5 @@ impl CodegenBackend for CraneliftCodegenBackend {\n /// This is the entrypoint for a hot plugged rustc_codegen_cranelift\n #[no_mangle]\n pub fn __rustc_codegen_backend() -> Box<CodegenBackend> {\n-    CraneliftCodegenBackend::new()\n+    Box::new(CraneliftCodegenBackend)\n }"}]}