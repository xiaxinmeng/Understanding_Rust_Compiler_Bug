{"sha": "89b7f5f38260437db50ece8d48418f90bf1e42ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5YjdmNWYzODI2MDQzN2RiNTBlY2U4ZDQ4NDE4ZjkwYmYxZTQyZWM=", "commit": {"author": {"name": "mahkoh", "email": "mahkoh@users.noreply.github.com", "date": "2020-05-22T09:55:34Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2020-09-05T00:01:18Z"}, "message": "Fix module resolution in inner modules with paths (#4194)", "tree": {"sha": "7936cb5aae824100c9323a571b05a37d5413278a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7936cb5aae824100c9323a571b05a37d5413278a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/89b7f5f38260437db50ece8d48418f90bf1e42ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/89b7f5f38260437db50ece8d48418f90bf1e42ec", "html_url": "https://github.com/rust-lang/rust/commit/89b7f5f38260437db50ece8d48418f90bf1e42ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/89b7f5f38260437db50ece8d48418f90bf1e42ec/comments", "author": {"login": "mahkoh", "id": 1882250, "node_id": "MDQ6VXNlcjE4ODIyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mahkoh", "html_url": "https://github.com/mahkoh", "followers_url": "https://api.github.com/users/mahkoh/followers", "following_url": "https://api.github.com/users/mahkoh/following{/other_user}", "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}", "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions", "organizations_url": "https://api.github.com/users/mahkoh/orgs", "repos_url": "https://api.github.com/users/mahkoh/repos", "events_url": "https://api.github.com/users/mahkoh/events{/privacy}", "received_events_url": "https://api.github.com/users/mahkoh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa11c27490046e3ad860cecd3b11660c5ca642f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa11c27490046e3ad860cecd3b11660c5ca642f9", "html_url": "https://github.com/rust-lang/rust/commit/aa11c27490046e3ad860cecd3b11660c5ca642f9"}], "stats": {"total": 29, "additions": 13, "deletions": 16}, "files": [{"sha": "23e68a7d4254ded97b32ea65c06caca87a0dddf3", "filename": "src/modules.rs", "status": "modified", "additions": 1, "deletions": 16, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/89b7f5f38260437db50ece8d48418f90bf1e42ec/src%2Fmodules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89b7f5f38260437db50ece8d48418f90bf1e42ec/src%2Fmodules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmodules.rs?ref=89b7f5f38260437db50ece8d48418f90bf1e42ec", "patch": "@@ -56,8 +56,6 @@ enum SubModKind<'a, 'ast> {\n     External(PathBuf, DirectoryOwnership, Cow<'ast, ast::Mod>),\n     /// `mod foo;` with multiple sources.\n     MultiExternal(Vec<(PathBuf, DirectoryOwnership, Cow<'ast, ast::Mod>)>),\n-    /// `#[path = \"...\"] mod foo {}`\n-    InternalWithPath(PathBuf),\n     /// `mod foo {}`\n     Internal(&'a ast::Item),\n }\n@@ -173,12 +171,7 @@ impl<'ast, 'sess, 'c> ModResolver<'ast, 'sess> {\n             self.find_external_module(item.ident, &item.attrs, sub_mod)\n         } else {\n             // An internal module (`mod foo { /* ... */ }`);\n-            if let Some(path) = find_path_value(&item.attrs) {\n-                let path = Path::new(&*path.as_str()).to_path_buf();\n-                Ok(Some(SubModKind::InternalWithPath(path)))\n-            } else {\n-                Ok(Some(SubModKind::Internal(item)))\n-            }\n+            Ok(Some(SubModKind::Internal(item)))\n         }\n     }\n \n@@ -218,14 +211,6 @@ impl<'ast, 'sess, 'c> ModResolver<'ast, 'sess> {\n                 };\n                 self.visit_sub_mod_after_directory_update(sub_mod, Some(directory))\n             }\n-            SubModKind::InternalWithPath(mod_path) => {\n-                // All `#[path]` files are treated as though they are a `mod.rs` file.\n-                let directory = Directory {\n-                    path: mod_path,\n-                    ownership: DirectoryOwnership::Owned { relative: None },\n-                };\n-                self.visit_sub_mod_after_directory_update(sub_mod, Some(directory))\n-            }\n             SubModKind::Internal(ref item) => {\n                 self.push_inline_mod_directory(item.ident, &item.attrs);\n                 self.visit_sub_mod_after_directory_update(sub_mod, None)"}, {"sha": "8b137891791fe96927ad78e64b0aad7bded08bdc", "filename": "tests/target/inner-module-path/b.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/89b7f5f38260437db50ece8d48418f90bf1e42ec/tests%2Ftarget%2Finner-module-path%2Fb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89b7f5f38260437db50ece8d48418f90bf1e42ec/tests%2Ftarget%2Finner-module-path%2Fb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Finner-module-path%2Fb.rs?ref=89b7f5f38260437db50ece8d48418f90bf1e42ec", "patch": "@@ -0,0 +1 @@\n+"}, {"sha": "8b137891791fe96927ad78e64b0aad7bded08bdc", "filename": "tests/target/inner-module-path/c/d.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/89b7f5f38260437db50ece8d48418f90bf1e42ec/tests%2Ftarget%2Finner-module-path%2Fc%2Fd.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89b7f5f38260437db50ece8d48418f90bf1e42ec/tests%2Ftarget%2Finner-module-path%2Fc%2Fd.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Finner-module-path%2Fc%2Fd.rs?ref=89b7f5f38260437db50ece8d48418f90bf1e42ec", "patch": "@@ -0,0 +1 @@\n+"}, {"sha": "fb75d70cd93512c3114346a28be75dd6a6a59f92", "filename": "tests/target/inner-module-path/lib.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/89b7f5f38260437db50ece8d48418f90bf1e42ec/tests%2Ftarget%2Finner-module-path%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89b7f5f38260437db50ece8d48418f90bf1e42ec/tests%2Ftarget%2Finner-module-path%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Finner-module-path%2Flib.rs?ref=89b7f5f38260437db50ece8d48418f90bf1e42ec", "patch": "@@ -0,0 +1,10 @@\n+// rustfmt-recursive: true\n+\n+#[path = \".\"]\n+mod a {\n+    mod b;\n+}\n+\n+mod c {\n+    mod d;\n+}"}]}