{"sha": "b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "node_id": "C_kwDOAAsO6NoAKGIxNjE2ZjM0ZWZjNWJjMGQwMzI4YzFiYmE5NDE3NmM2MmJlMmIzZDA", "commit": {"author": {"name": "Will Crichton", "email": "wcrichto@cs.stanford.edu", "date": "2021-10-09T03:49:05Z"}, "committer": {"name": "Will Crichton", "email": "wcrichto@cs.stanford.edu", "date": "2021-10-09T03:49:05Z"}, "message": "Add test for ordering of examples, simplify with single scrape.mk file", "tree": {"sha": "159bf117f5a97edb7569c99731b87db3de404e3d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/159bf117f5a97edb7569c99731b87db3de404e3d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "html_url": "https://github.com/rust-lang/rust/commit/b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/comments", "author": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e4958a3e6c48630b777244adad80d1381ada32a", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e4958a3e6c48630b777244adad80d1381ada32a", "html_url": "https://github.com/rust-lang/rust/commit/9e4958a3e6c48630b777244adad80d1381ada32a"}], "stats": {"total": 89, "additions": 49, "deletions": 40}, "files": [{"sha": "897805e4405b95908f659015acb6b511298c5ca8", "filename": "src/test/run-make/rustdoc-scrape-examples-multiple/Makefile", "status": "modified", "additions": 3, "deletions": 19, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2FMakefile?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -1,21 +1,5 @@\n--include ../../run-make-fulldeps/tools.mk\n+deps := ex ex2\n \n-OUTPUT_DIR := \"$(TMPDIR)/rustdoc\"\n+-include ./scrape.mk\n \n-all: $(TMPDIR)/ex.calls $(TMPDIR)/ex2.calls\n-\t$(RUSTDOC) src/lib.rs --crate-name foobar --crate-type lib --output $(OUTPUT_DIR) \\\n-\t\t-Z unstable-options \\\n-\t\t--with-examples $(TMPDIR)/ex.calls \\\n-\t\t--with-examples $(TMPDIR)/ex2.calls\n-\n-\t$(HTMLDOCCK) $(OUTPUT_DIR) src/lib.rs\n-\n-$(TMPDIR)/%.calls: $(TMPDIR)/libfoobar.rmeta\n-\t$(RUSTDOC) examples/$*.rs --crate-name $* --crate-type bin --output $(OUTPUT_DIR) \\\n-\t  --extern foobar=$(TMPDIR)/libfoobar.rmeta \\\n-\t\t-Z unstable-options \\\n-\t\t--scrape-examples-output-path $@ \\\n-\t\t--scrape-examples-target-crate foobar\n-\n-$(TMPDIR)/lib%.rmeta: src/lib.rs\n-\t$(RUSTC) src/lib.rs --crate-name $* --crate-type lib --emit=metadata\n+all: scrape"}, {"sha": "1fa1fae1a0b7102b4cd33522a678cf261fbfcf98", "filename": "src/test/run-make/rustdoc-scrape-examples-multiple/scrape.mk", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2Fscrape.mk", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2Fscrape.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2Fscrape.mk?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -0,0 +1,20 @@\n+-include ../../run-make-fulldeps/tools.mk\n+\n+OUTPUT_DIR := \"$(TMPDIR)/rustdoc\"\n+\n+$(TMPDIR)/%.calls: $(TMPDIR)/libfoobar.rmeta\n+\t$(RUSTDOC) examples/$*.rs --crate-name $* --crate-type bin --output $(OUTPUT_DIR) \\\n+\t  --extern foobar=$(TMPDIR)/libfoobar.rmeta \\\n+\t\t-Z unstable-options \\\n+\t\t--scrape-examples-output-path $@ \\\n+\t\t--scrape-examples-target-crate foobar\n+\n+$(TMPDIR)/lib%.rmeta: src/lib.rs\n+\t$(RUSTC) src/lib.rs --crate-name $* --crate-type lib --emit=metadata\n+\n+scrape: $(foreach d,$(deps),$(TMPDIR)/$(d).calls)\n+\t$(RUSTDOC) src/lib.rs --crate-name foobar --crate-type lib --output $(OUTPUT_DIR) \\\n+\t\t-Z unstable-options \\\n+\t\t$(foreach d,$(deps),--with-examples $(TMPDIR)/$(d).calls)\n+\n+\t$(HTMLDOCCK) $(OUTPUT_DIR) src/lib.rs"}, {"sha": "bd59584bbbf4fafbb70c7920d901807bb6d6064e", "filename": "src/test/run-make/rustdoc-scrape-examples-multiple/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-multiple%2Fsrc%2Flib.rs?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -1,4 +1,4 @@\n-// @has foobar/fn.ok.html '//*[@class=\"prev\"]' ''\n+// @has foobar/fn.ok.html '//*[@class=\"docblock scraped-example-list\"]//*[@class=\"prev\"]' ''\n // @has foobar/fn.ok.html '//*[@class=\"more-scraped-examples\"]' ''\n \n pub fn ok() {}"}, {"sha": "339d539bfd57de0425a0bd25cc0a3f9b58aa7156", "filename": "src/test/run-make/rustdoc-scrape-examples-ordering/Makefile", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2FMakefile?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -0,0 +1,5 @@\n+deps := ex1 ex2\n+\n+-include ../rustdoc-scrape-examples-multiple/scrape.mk\n+\n+all: scrape"}, {"sha": "d6d5982087658066359803dbda99c85143ec88fe", "filename": "src/test/run-make/rustdoc-scrape-examples-ordering/examples/ex1.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex1.rs?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -0,0 +1,9 @@\n+fn main() {\n+    foobar::ok();\n+\n+    // this is a\n+\n+    // BIG\n+\n+    // item\n+}"}, {"sha": "a1133117f861e9cab46ce570c989c199b9a4aa7c", "filename": "src/test/run-make/rustdoc-scrape-examples-ordering/examples/ex2.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex2.rs?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    foobar::ok();\n+    // small item\n+}"}, {"sha": "f1b7686d36800f774dc718d0ff793729bdd60302", "filename": "src/test/run-make/rustdoc-scrape-examples-ordering/src/lib.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fsrc%2Flib.rs?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -0,0 +1,4 @@\n+// @has foobar/fn.ok.html '//*[@class=\"docblock scraped-example-list\"]' 'ex2'\n+// @has foobar/fn.ok.html '//*[@class=\"more-scraped-examples\"]' 'ex1'\n+\n+pub fn ok() {}"}, {"sha": "dce8b83eefe4efd68139f03ed800a171f42f9303", "filename": "src/test/run-make/rustdoc-scrape-examples-remap/Makefile", "status": "modified", "additions": 3, "deletions": 20, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-remap%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/b1616f34efc5bc0d0328c1bba94176c62be2b3d0/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-remap%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-remap%2FMakefile?ref=b1616f34efc5bc0d0328c1bba94176c62be2b3d0", "patch": "@@ -1,22 +1,5 @@\n--include ../../run-make-fulldeps/tools.mk\n+deps := ex\n \n-OUTPUT_DIR := \"$(TMPDIR)/rustdoc\"\n+-include ../rustdoc-scrape-examples-multiple/scrape.mk\n \n-all:\n-# 1. compile the library crate and emit an rmeta\n-\t$(RUSTC) src/lib.rs --crate-name foobar --crate-type lib --emit=metadata\n-\n-# 2. scrape examples from the reverse-dependency into an ex.calls file\n-\t$(RUSTDOC) examples/ex.rs --crate-name ex --crate-type bin --output $(OUTPUT_DIR) \\\n-\t  --extern foobar=$(TMPDIR)/libfoobar.rmeta \\\n-\t\t-Z unstable-options \\\n-\t\t--scrape-examples-output-path $(TMPDIR)/ex.calls \\\n-\t\t--scrape-examples-target-crate foobar\n-\n-# 3. pass those examples to rustdoc when documenting the library crate\n-\t$(RUSTDOC) src/lib.rs --crate-name foobar --crate-type lib --output $(OUTPUT_DIR) \\\n-\t\t-Z unstable-options \\\n-\t\t--with-examples $(TMPDIR)/ex.calls\n-\n-# 4. check that the examples were scraped successfully\n-\t$(HTMLDOCCK) $(OUTPUT_DIR) src/lib.rs\n+all: scrape"}]}