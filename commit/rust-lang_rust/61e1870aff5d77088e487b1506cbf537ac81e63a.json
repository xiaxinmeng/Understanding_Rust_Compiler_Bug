{"sha": "61e1870aff5d77088e487b1506cbf537ac81e63a", "node_id": "C_kwDOAAsO6NoAKDYxZTE4NzBhZmY1ZDc3MDg4ZTQ4N2IxNTA2Y2JmNTM3YWM4MWU2M2E", "commit": {"author": {"name": "Evan Typanski", "email": "evan.typanski@microfocus.com", "date": "2022-06-22T18:17:52Z"}, "committer": {"name": "Evan Typanski", "email": "evan.typanski@microfocus.com", "date": "2022-06-22T18:23:04Z"}, "message": "Add MSRV check for const rem_euclid", "tree": {"sha": "a9976109dd4222ef5b573c736e8d080ce30c41da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a9976109dd4222ef5b573c736e8d080ce30c41da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61e1870aff5d77088e487b1506cbf537ac81e63a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61e1870aff5d77088e487b1506cbf537ac81e63a", "html_url": "https://github.com/rust-lang/rust/commit/61e1870aff5d77088e487b1506cbf537ac81e63a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61e1870aff5d77088e487b1506cbf537ac81e63a/comments", "author": null, "committer": null, "parents": [{"sha": "90f8277fe3ce6d0e238feac3bf10891f8c18f23a", "url": "https://api.github.com/repos/rust-lang/rust/commits/90f8277fe3ce6d0e238feac3bf10891f8c18f23a", "html_url": "https://github.com/rust-lang/rust/commit/90f8277fe3ce6d0e238feac3bf10891f8c18f23a"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "d22397ca35ec4cf8479add97bbbb9ab5003b36ad", "filename": "clippy_lints/src/manual_rem_euclid.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/61e1870aff5d77088e487b1506cbf537ac81e63a/clippy_lints%2Fsrc%2Fmanual_rem_euclid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61e1870aff5d77088e487b1506cbf537ac81e63a/clippy_lints%2Fsrc%2Fmanual_rem_euclid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmanual_rem_euclid.rs?ref=61e1870aff5d77088e487b1506cbf537ac81e63a", "patch": "@@ -1,7 +1,7 @@\n use clippy_utils::consts::{constant_full_int, FullInt};\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::source::snippet_with_applicability;\n-use clippy_utils::{meets_msrv, msrvs, path_to_local};\n+use clippy_utils::{in_constant, meets_msrv, msrvs, path_to_local};\n use rustc_errors::Applicability;\n use rustc_hir::{BinOpKind, Expr, ExprKind, Node, TyKind};\n use rustc_lint::{LateContext, LateLintPass};\n@@ -51,6 +51,10 @@ impl<'tcx> LateLintPass<'tcx> for ManualRemEuclid {\n             return;\n         }\n \n+        if in_constant(cx, expr.hir_id) && !meets_msrv(self.msrv, msrvs::REM_EUCLID_CONST) {\n+            return;\n+        }\n+\n         if let ExprKind::Binary(op1, ..) = expr.kind\n             && op1.node == BinOpKind::Rem\n             && let Some((const1, expr1)) = check_for_positive_int_constant(cx, expr, false)"}, {"sha": "43c0a03c42abd502332f2f639deb77ce83272805", "filename": "clippy_utils/src/msrvs.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/61e1870aff5d77088e487b1506cbf537ac81e63a/clippy_utils%2Fsrc%2Fmsrvs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61e1870aff5d77088e487b1506cbf537ac81e63a/clippy_utils%2Fsrc%2Fmsrvs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fmsrvs.rs?ref=61e1870aff5d77088e487b1506cbf537ac81e63a", "patch": "@@ -13,7 +13,7 @@ macro_rules! msrv_aliases {\n // names may refer to stabilized feature flags or library items\n msrv_aliases! {\n     1,53,0 { OR_PATTERNS, MANUAL_BITS }\n-    1,52,0 { STR_SPLIT_ONCE }\n+    1,52,0 { STR_SPLIT_ONCE, REM_EUCLID_CONST }\n     1,51,0 { BORROW_AS_PTR, UNSIGNED_ABS }\n     1,50,0 { BOOL_THEN }\n     1,47,0 { TAU }"}, {"sha": "a3e593eac06cf36fba4825b9ca662e70fe4ff641", "filename": "tests/ui/manual_rem_euclid.fixed", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/61e1870aff5d77088e487b1506cbf537ac81e63a/tests%2Fui%2Fmanual_rem_euclid.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/61e1870aff5d77088e487b1506cbf537ac81e63a/tests%2Fui%2Fmanual_rem_euclid.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_rem_euclid.fixed?ref=61e1870aff5d77088e487b1506cbf537ac81e63a", "patch": "@@ -31,3 +31,8 @@ fn main() {\n pub fn rem_euclid_4(num: i32) -> i32 {\n     num.rem_euclid(4)\n }\n+\n+// Constant version came later, should still lint\n+pub const fn const_rem_euclid_4(num: i32) -> i32 {\n+    num.rem_euclid(4)\n+}"}, {"sha": "2d8c6411f20bc9120c0e3b2a16355d1a35e67eef", "filename": "tests/ui/manual_rem_euclid.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/61e1870aff5d77088e487b1506cbf537ac81e63a/tests%2Fui%2Fmanual_rem_euclid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61e1870aff5d77088e487b1506cbf537ac81e63a/tests%2Fui%2Fmanual_rem_euclid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_rem_euclid.rs?ref=61e1870aff5d77088e487b1506cbf537ac81e63a", "patch": "@@ -31,3 +31,8 @@ fn main() {\n pub fn rem_euclid_4(num: i32) -> i32 {\n     ((num % 4) + 4) % 4\n }\n+\n+// Constant version came later, should still lint\n+pub const fn const_rem_euclid_4(num: i32) -> i32 {\n+    ((num % 4) + 4) % 4\n+}"}, {"sha": "3faeb6c6a883f360cb220f352982db5c4ad7a9fa", "filename": "tests/ui/manual_rem_euclid.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/61e1870aff5d77088e487b1506cbf537ac81e63a/tests%2Fui%2Fmanual_rem_euclid.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/61e1870aff5d77088e487b1506cbf537ac81e63a/tests%2Fui%2Fmanual_rem_euclid.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_rem_euclid.stderr?ref=61e1870aff5d77088e487b1506cbf537ac81e63a", "patch": "@@ -36,5 +36,11 @@ error: manual `rem_euclid` implementation\n LL |     ((num % 4) + 4) % 4\n    |     ^^^^^^^^^^^^^^^^^^^ help: consider using: `num.rem_euclid(4)`\n \n-error: aborting due to 6 previous errors\n+error: manual `rem_euclid` implementation\n+  --> $DIR/manual_rem_euclid.rs:37:5\n+   |\n+LL |     ((num % 4) + 4) % 4\n+   |     ^^^^^^^^^^^^^^^^^^^ help: consider using: `num.rem_euclid(4)`\n+\n+error: aborting due to 7 previous errors\n "}]}