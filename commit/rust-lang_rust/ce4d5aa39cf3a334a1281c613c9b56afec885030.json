{"sha": "ce4d5aa39cf3a334a1281c613c9b56afec885030", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlNGQ1YWEzOWNmM2EzMzRhMTI4MWM2MTNjOWI1NmFmZWM4ODUwMzA=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2015-09-02T02:45:56Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2015-09-02T02:45:56Z"}, "message": "Fix a bug with alignment in one-line match arms", "tree": {"sha": "6c0971878fe0f44bdbaf65f9dc2d807650c25893", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6c0971878fe0f44bdbaf65f9dc2d807650c25893"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce4d5aa39cf3a334a1281c613c9b56afec885030", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce4d5aa39cf3a334a1281c613c9b56afec885030", "html_url": "https://github.com/rust-lang/rust/commit/ce4d5aa39cf3a334a1281c613c9b56afec885030", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce4d5aa39cf3a334a1281c613c9b56afec885030/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5f8b37eeb3e388500e736579ce11533c254fd16", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5f8b37eeb3e388500e736579ce11533c254fd16", "html_url": "https://github.com/rust-lang/rust/commit/a5f8b37eeb3e388500e736579ce11533c254fd16"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "e5e8bc7088ca6664506b55a8ddf7f01c50186a21", "filename": "src/expr.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ce4d5aa39cf3a334a1281c613c9b56afec885030/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce4d5aa39cf3a334a1281c613c9b56afec885030/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=ce4d5aa39cf3a334a1281c613c9b56afec885030", "patch": "@@ -578,8 +578,7 @@ fn rewrite_match(context: &RewriteContext,\n         result.push_str(&arm_indent_str);\n \n         let arm_str = arm.rewrite(&nested_context,\n-                                  context.config.max_width -\n-                                      arm_indent,\n+                                  context.config.max_width - arm_indent,\n                                   arm_indent);\n         if let Some(ref arm_str) = arm_str {\n             result.push_str(arm_str);\n@@ -694,15 +693,14 @@ impl Rewrite for ast::Arm {\n         } else {\n             \",\"\n         };\n-        let nested_indent = context.block_indent + context.config.tab_spaces;\n \n         // Let's try and get the arm body on the same line as the condition.\n         // 4 = ` => `.len()\n         if context.config.max_width > line_start + comma.len() + 4 {\n             let budget = context.config.max_width - line_start - comma.len() - 4;\n             if let Some(ref body_str) = body.rewrite(context,\n                                                      budget,\n-                                                     nested_indent) {\n+                                                     line_start + 4) {\n                 if first_line_width(body_str) <= budget {\n                     return Some(format!(\"{}{} => {}{}\",\n                                         attr_str.trim_left(),\n@@ -720,7 +718,9 @@ impl Rewrite for ast::Arm {\n         }\n \n         let body_budget = try_opt!(width.checked_sub(context.config.tab_spaces));\n-        let body_str = try_opt!(body.rewrite(context, body_budget, nested_indent));\n+        let body_str = try_opt!(body.rewrite(context,\n+                                             body_budget,\n+                                             context.block_indent));\n         Some(format!(\"{}{} =>\\n{}{},\",\n                      attr_str.trim_left(),\n                      pats_str,"}, {"sha": "eab8c604084c5fcd7bcecfabfbe123bdcbb6e421", "filename": "tests/target/match.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ce4d5aa39cf3a334a1281c613c9b56afec885030/tests%2Ftarget%2Fmatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce4d5aa39cf3a334a1281c613c9b56afec885030/tests%2Ftarget%2Fmatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fmatch.rs?ref=ce4d5aa39cf3a334a1281c613c9b56afec885030", "patch": "@@ -62,3 +62,18 @@ fn main() {\n             None => sub_span,\n         };\n }\n+\n+// Test that one-line bodies align.\n+fn main() {\n+    match r {\n+        Variableeeeeeeeeeeeeeeeee => (\"variable\",\n+                                      vec!(\"id\",\"name\",\"qualname\",\"value\",\"type\",\"scopeid\"),\n+                                      true,\n+                                      true),\n+        Enummmmmmmmmmmmmmmmmmmmm => (\"enum\", vec!(\"id\",\"qualname\",\"scopeid\",\"value\"), true, true),\n+        Variantttttttttttttttttttttttt => (\"variant\",\n+                                           vec!(\"id\",\"name\",\"qualname\",\"type\",\"value\",\"scopeid\"),\n+                                           true,\n+                                           true),\n+    }\n+}"}]}