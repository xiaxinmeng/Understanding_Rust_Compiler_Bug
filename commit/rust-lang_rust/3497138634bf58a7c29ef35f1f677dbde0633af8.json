{"sha": "3497138634bf58a7c29ef35f1f677dbde0633af8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0OTcxMzg2MzRiZjU4YTdjMjllZjM1ZjFmNjc3ZGJkZTA2MzNhZjg=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-05-29T15:49:35Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-06-27T12:00:34Z"}, "message": "Use u32 instead of usize of encoding byte count of multi-byte chars.", "tree": {"sha": "55d8150541740a2ed964a4b298995625c8c88e91", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/55d8150541740a2ed964a4b298995625c8c88e91"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3497138634bf58a7c29ef35f1f677dbde0633af8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3497138634bf58a7c29ef35f1f677dbde0633af8", "html_url": "https://github.com/rust-lang/rust/commit/3497138634bf58a7c29ef35f1f677dbde0633af8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3497138634bf58a7c29ef35f1f677dbde0633af8/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04d4da1bf9df23f1bc2ad22115642735bda8b39e", "url": "https://api.github.com/repos/rust-lang/rust/commits/04d4da1bf9df23f1bc2ad22115642735bda8b39e", "html_url": "https://github.com/rust-lang/rust/commit/04d4da1bf9df23f1bc2ad22115642735bda8b39e"}], "stats": {"total": 26, "additions": 20, "deletions": 6}, "files": [{"sha": "68882c4f063ffe406c20f1ad43e01239c36525ef", "filename": "src/libsyntax/codemap.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3497138634bf58a7c29ef35f1f677dbde0633af8/src%2Flibsyntax%2Fcodemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3497138634bf58a7c29ef35f1f677dbde0633af8/src%2Flibsyntax%2Fcodemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fcodemap.rs?ref=3497138634bf58a7c29ef35f1f677dbde0633af8", "patch": "@@ -822,14 +822,14 @@ impl CodeMap {\n                 total_extra_bytes += mbc.bytes - 1;\n                 // We should never see a byte position in the middle of a\n                 // character\n-                assert!(bpos.to_usize() >= mbc.pos.to_usize() + mbc.bytes);\n+                assert!(bpos.to_u32() >= mbc.pos.to_u32() + mbc.bytes);\n             } else {\n                 break;\n             }\n         }\n \n-        assert!(map.start_pos.to_usize() + total_extra_bytes <= bpos.to_usize());\n-        CharPos(bpos.to_usize() - map.start_pos.to_usize() - total_extra_bytes)\n+        assert!(map.start_pos.to_u32() + total_extra_bytes <= bpos.to_u32());\n+        CharPos(bpos.to_usize() - map.start_pos.to_usize() - total_extra_bytes as usize)\n     }\n \n     // Return the index of the filemap (in self.files) which contains pos."}, {"sha": "93b65dac2884e14a73d0e7de138eef82d426e2c0", "filename": "src/libsyntax_pos/lib.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3497138634bf58a7c29ef35f1f677dbde0633af8/src%2Flibsyntax_pos%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3497138634bf58a7c29ef35f1f677dbde0633af8/src%2Flibsyntax_pos%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Flib.rs?ref=3497138634bf58a7c29ef35f1f677dbde0633af8", "patch": "@@ -657,7 +657,7 @@ pub struct MultiByteChar {\n     /// The absolute offset of the character in the CodeMap\n     pub pos: BytePos,\n     /// The number of bytes, >=2\n-    pub bytes: usize,\n+    pub bytes: u32,\n }\n \n /// Identifies an offset of a non-narrow character in a FileMap\n@@ -1174,6 +1174,8 @@ fn remove_bom(src: &mut String) {\n pub trait Pos {\n     fn from_usize(n: usize) -> Self;\n     fn to_usize(&self) -> usize;\n+    fn from_u32(n: u32) -> Self;\n+    fn to_u32(&self) -> u32;\n }\n \n /// A byte offset. Keep this small (currently 32-bits), as AST contains\n@@ -1195,7 +1197,13 @@ impl Pos for BytePos {\n     fn from_usize(n: usize) -> BytePos { BytePos(n as u32) }\n \n     #[inline(always)]\n-    fn to_usize(&self) -> usize { let BytePos(n) = *self; n as usize }\n+    fn to_usize(&self) -> usize { self.0 as usize }\n+\n+    #[inline(always)]\n+    fn from_u32(n: u32) -> BytePos { BytePos(n) }\n+\n+    #[inline(always)]\n+    fn to_u32(&self) -> u32 { self.0 }\n }\n \n impl Add for BytePos {\n@@ -1233,7 +1241,13 @@ impl Pos for CharPos {\n     fn from_usize(n: usize) -> CharPos { CharPos(n) }\n \n     #[inline(always)]\n-    fn to_usize(&self) -> usize { let CharPos(n) = *self; n }\n+    fn to_usize(&self) -> usize { self.0 }\n+\n+    #[inline(always)]\n+    fn from_u32(n: u32) -> CharPos { CharPos(n as usize) }\n+\n+    #[inline(always)]\n+    fn to_u32(&self) -> u32 { self.0 as u32}\n }\n \n impl Add for CharPos {"}]}