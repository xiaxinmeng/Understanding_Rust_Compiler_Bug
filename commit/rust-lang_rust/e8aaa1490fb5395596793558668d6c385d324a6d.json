{"sha": "e8aaa1490fb5395596793558668d6c385d324a6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4YWFhMTQ5MGZiNTM5NTU5Njc5MzU1ODY2OGQ2YzM4NWQzMjRhNmQ=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-02-05T23:14:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-05T23:14:14Z"}, "message": "Rollup merge of #81675 - poliorcetics:respect-shortness, r=jyn514\n\nMake rustdoc respect `--error-format short` in doctests\n\nNote that this will not work with `cargo test`, only with `rustdoc --test`, I'll have to modify `cargo` as well.\n\nFix #81662.\n\n`@rustbot` label +T-rustdoc +A-doctests", "tree": {"sha": "8637ffeeb0955cadec4be3584d3c62b2894a2f15", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8637ffeeb0955cadec4be3584d3c62b2894a2f15"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e8aaa1490fb5395596793558668d6c385d324a6d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgHdFHCRBK7hj4Ov3rIwAAdHIIAHOHAIDSLTcl3I2ssKf+Ly5d\nJvUbzczLF0M9YaAwkaGvygncjBo4DyugN7Ls0yYPBdHYWR/fRA/kzEkxbCXGm//O\nDzuQe9YzeHfasHPQlexmXwLWLqd0cW5GxHhpFPSm1665WHaHT2MdFqhC2iG2oTCf\nPoLpW4PGTKaNQnzxGJNLxemmA1URxODTdqmCp/gipL3LUT+lCKZwDX+EVyDdjPY8\nOXMMT2wvdipO4ljI87MNgNDi2rRBzVV02rB3czbGfOVW/BKvGo+Iqx1GFsbZsZbd\nIObJh4rnq/E3CATUJ69kavKevh6IHbSaWfBmP+cVdWy7WNVwSPDi4WEyGFV2Rhk=\n=wDxa\n-----END PGP SIGNATURE-----\n", "payload": "tree 8637ffeeb0955cadec4be3584d3c62b2894a2f15\nparent add80c9d4b1f3f70297d7738ce6a9e71134f9e88\nparent 716d2cdecc21798f1da28ded1765b2ba1ad8cc10\nauthor Mara Bos <m-ou.se@m-ou.se> 1612566854 +0100\ncommitter GitHub <noreply@github.com> 1612566854 +0100\n\nRollup merge of #81675 - poliorcetics:respect-shortness, r=jyn514\n\nMake rustdoc respect `--error-format short` in doctests\n\nNote that this will not work with `cargo test`, only with `rustdoc --test`, I'll have to modify `cargo` as well.\n\nFix #81662.\n\n`@rustbot` label +T-rustdoc +A-doctests\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e8aaa1490fb5395596793558668d6c385d324a6d", "html_url": "https://github.com/rust-lang/rust/commit/e8aaa1490fb5395596793558668d6c385d324a6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e8aaa1490fb5395596793558668d6c385d324a6d/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "add80c9d4b1f3f70297d7738ce6a9e71134f9e88", "url": "https://api.github.com/repos/rust-lang/rust/commits/add80c9d4b1f3f70297d7738ce6a9e71134f9e88", "html_url": "https://github.com/rust-lang/rust/commit/add80c9d4b1f3f70297d7738ce6a9e71134f9e88"}, {"sha": "716d2cdecc21798f1da28ded1765b2ba1ad8cc10", "url": "https://api.github.com/repos/rust-lang/rust/commits/716d2cdecc21798f1da28ded1765b2ba1ad8cc10", "html_url": "https://github.com/rust-lang/rust/commit/716d2cdecc21798f1da28ded1765b2ba1ad8cc10"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "eecfd337cdf845027b08c59c5e51e2063527fc6e", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e8aaa1490fb5395596793558668d6c385d324a6d/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8aaa1490fb5395596793558668d6c385d324a6d/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=e8aaa1490fb5395596793558668d6c385d324a6d", "patch": "@@ -296,7 +296,12 @@ fn run_test(\n         }\n     });\n     if let ErrorOutputType::HumanReadable(kind) = options.error_format {\n-        let (_, color_config) = kind.unzip();\n+        let (short, color_config) = kind.unzip();\n+\n+        if short {\n+            compiler.arg(\"--error-format\").arg(\"short\");\n+        }\n+\n         match color_config {\n             ColorConfig::Never => {\n                 compiler.arg(\"--color\").arg(\"never\");"}, {"sha": "27a21a313bc552b9b27bcebd21d54b79c188fbb3", "filename": "src/test/rustdoc-ui/issue-81662-shortness.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e8aaa1490fb5395596793558668d6c385d324a6d/src%2Ftest%2Frustdoc-ui%2Fissue-81662-shortness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8aaa1490fb5395596793558668d6c385d324a6d/src%2Ftest%2Frustdoc-ui%2Fissue-81662-shortness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fissue-81662-shortness.rs?ref=e8aaa1490fb5395596793558668d6c385d324a6d", "patch": "@@ -0,0 +1,12 @@\n+// compile-flags:--test --error-format=short\n+// normalize-stdout-test: \"src/test/rustdoc-ui\" -> \"$$DIR\"\n+// normalize-stdout-test \"finished in \\d+\\.\\d+s\" -> \"finished in $$TIME\"\n+// failure-status: 101\n+\n+/// ```rust\n+/// foo();\n+/// ```\n+//~^^ ERROR cannot find function `foo` in this scope\n+fn foo() {\n+    println!(\"Hello, world!\");\n+}"}, {"sha": "748113be3a26d14d94a8d5f96b26b6750677ccd8", "filename": "src/test/rustdoc-ui/issue-81662-shortness.stdout", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e8aaa1490fb5395596793558668d6c385d324a6d/src%2Ftest%2Frustdoc-ui%2Fissue-81662-shortness.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/e8aaa1490fb5395596793558668d6c385d324a6d/src%2Ftest%2Frustdoc-ui%2Fissue-81662-shortness.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fissue-81662-shortness.stdout?ref=e8aaa1490fb5395596793558668d6c385d324a6d", "patch": "@@ -0,0 +1,16 @@\n+\n+running 1 test\n+test $DIR/issue-81662-shortness.rs - foo (line 6) ... FAILED\n+\n+failures:\n+\n+---- $DIR/issue-81662-shortness.rs - foo (line 6) stdout ----\n+$DIR/issue-81662-shortness.rs:7:1: error[E0425]: cannot find function `foo` in this scope\n+error: aborting due to previous error\n+Couldn't compile the test.\n+\n+failures:\n+    $DIR/issue-81662-shortness.rs - foo (line 6)\n+\n+test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in $TIME\n+"}]}