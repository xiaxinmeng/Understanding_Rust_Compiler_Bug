{"sha": "3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkMmQ5NGI5Yzk5ZmEwYjBjYzNiNDJmMmUyZjMyOGU1ZWJmYzdmNDI=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2018-01-16T15:41:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-01-16T15:41:12Z"}, "message": "Merge pull request #2366 from rust-lang-nursery/const-static-fix\n\nShow wider and more accurate suggestion for const_static_lifetime", "tree": {"sha": "dc9f02b785e2a64b407769f79811a6a31baf3ec7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dc9f02b785e2a64b407769f79811a6a31baf3ec7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaXh0YCRBK7hj4Ov3rIwAAdHIIAGuwGewBZsbqovS1xB2wPDY+\nJiV0P7tLGqjy/vKKp3fJMnifBKAhpccB5P6xB5ToO7APeKreLMl4FEMseJITZBfR\nuDDXzq8wh0fpSsIqKLvG+/hVcmuCVIrwYVLvbiYCN+sPYePxC4tRG0LsmpO9W3d8\nqD9PyzxZrpOvk0j3QDFCZQWrzcZwpkUIsYsAGmlJDe2fr26gZr2usCDqkwuWHJIR\nNgCu4DbfLHyvHN5TtQsegPhgRVS1iQ/5QPvhWq3uvzmz6BjIRdO+YsxfUhJ7/Op2\n8lgYUjPnvS/8QUv5d+NK4xo9uJ14ZN9D0bRMgqZssEYox4ytQyQHcupSuTntCOQ=\n=f1rj\n-----END PGP SIGNATURE-----\n", "payload": "tree dc9f02b785e2a64b407769f79811a6a31baf3ec7\nparent 61e2b7a4d62290c7243946ec53546151247f0a58\nparent 37f62a54f83b094cb5de55345945d1fb58d7d1b0\nauthor Oliver Schneider <oli-obk@users.noreply.github.com> 1516117272 +0100\ncommitter GitHub <noreply@github.com> 1516117272 +0100\n\nMerge pull request #2366 from rust-lang-nursery/const-static-fix\n\nShow wider and more accurate suggestion for const_static_lifetime"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42", "html_url": "https://github.com/rust-lang/rust/commit/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61e2b7a4d62290c7243946ec53546151247f0a58", "url": "https://api.github.com/repos/rust-lang/rust/commits/61e2b7a4d62290c7243946ec53546151247f0a58", "html_url": "https://github.com/rust-lang/rust/commit/61e2b7a4d62290c7243946ec53546151247f0a58"}, {"sha": "37f62a54f83b094cb5de55345945d1fb58d7d1b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/37f62a54f83b094cb5de55345945d1fb58d7d1b0", "html_url": "https://github.com/rust-lang/rust/commit/37f62a54f83b094cb5de55345945d1fb58d7d1b0"}], "stats": {"total": 33, "additions": 17, "deletions": 16}, "files": [{"sha": "293d63daaaa12f181760854b4a06233b945b170b", "filename": "clippy_lints/src/const_static_lifetime.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs?ref=3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42", "patch": "@@ -1,6 +1,6 @@\n use syntax::ast::{Item, ItemKind, Ty, TyKind};\n use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n-use utils::{in_macro, span_lint_and_then};\n+use utils::{in_macro, snippet, span_lint_and_then};\n \n /// **What it does:** Checks for constants with an explicit `'static` lifetime.\n ///\n@@ -51,14 +51,15 @@ impl StaticConst {\n                         TyKind::Path(..) | TyKind::Slice(..) | TyKind::Array(..) |\n                         TyKind::Tup(..) => {\n                             if lifetime.ident.name == \"'static\" {\n-                                let mut sug: String = String::new();\n+                                let snip = snippet(cx, borrow_type.ty.span, \"<type>\");\n+                                let sugg = format!(\"&{}\", snip);\n                                 span_lint_and_then(\n                                     cx,\n                                     CONST_STATIC_LIFETIME,\n                                     lifetime.span,\n                                     \"Constants have by default a `'static` lifetime\",\n                                     |db| {\n-                                        db.span_suggestion(lifetime.span, \"consider removing `'static`\", sug);\n+                                        db.span_suggestion(ty.span, \"consider removing `'static`\", sugg);\n                                     },\n                                 );\n                             }"}, {"sha": "448d83ee92159851021e49502fd27baea0f4eacd", "filename": "tests/ui/const_static_lifetime.stderr", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42/tests%2Fui%2Fconst_static_lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42/tests%2Fui%2Fconst_static_lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.stderr?ref=3d2d94b9c99fa0b0cc3b42f2e2f328e5ebfc7f42", "patch": "@@ -2,79 +2,79 @@ error: Constants have by default a `'static` lifetime\n  --> $DIR/const_static_lifetime.rs:4:17\n   |\n 4 | const VAR_ONE: &'static str = \"Test constant #1\"; // ERROR Consider removing 'static.\n-  |                 ^^^^^^^ help: consider removing `'static`\n+  |                -^^^^^^^---- help: consider removing `'static`: `&str`\n   |\n   = note: `-D const-static-lifetime` implied by `-D warnings`\n \n error: Constants have by default a `'static` lifetime\n  --> $DIR/const_static_lifetime.rs:8:21\n   |\n 8 | const VAR_THREE: &[&'static str] = &[\"one\", \"two\"]; // ERROR Consider removing 'static\n-  |                     ^^^^^^^ help: consider removing `'static`\n+  |                    -^^^^^^^---- help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:10:32\n    |\n 10 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n-   |                                ^^^^^^^ help: consider removing `'static`\n+   |                               -^^^^^^^---- help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:10:47\n    |\n 10 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n-   |                                               ^^^^^^^ help: consider removing `'static`\n+   |                                              -^^^^^^^---- help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:12:18\n    |\n 12 | const VAR_FIVE: &'static [&[&'static str]] = &[&[\"test\"], &[\"other one\"]]; // ERROR Consider removing 'static\n-   |                  ^^^^^^^ help: consider removing `'static`\n+   |                 -^^^^^^^------------------ help: consider removing `'static`: `&[&[&'static str]]`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:12:30\n    |\n 12 | const VAR_FIVE: &'static [&[&'static str]] = &[&[\"test\"], &[\"other one\"]]; // ERROR Consider removing 'static\n-   |                              ^^^^^^^ help: consider removing `'static`\n+   |                             -^^^^^^^---- help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:14:17\n    |\n 14 | const VAR_SIX: &'static u8 = &5;\n-   |                 ^^^^^^^ help: consider removing `'static`\n+   |                -^^^^^^^--- help: consider removing `'static`: `&u8`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:16:29\n    |\n 16 | const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"])];\n-   |                             ^^^^^^^ help: consider removing `'static`\n+   |                            -^^^^^^^--------------- help: consider removing `'static`: `&[&'static str]`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:16:39\n    |\n 16 | const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"])];\n-   |                                       ^^^^^^^ help: consider removing `'static`\n+   |                                      -^^^^^^^---- help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:18:20\n    |\n 18 | const VAR_HEIGHT: &'static Foo = &Foo {};\n-   |                    ^^^^^^^ help: consider removing `'static`\n+   |                   -^^^^^^^---- help: consider removing `'static`: `&Foo`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:20:19\n    |\n 20 | const VAR_SLICE: &'static [u8] = b\"Test constant #1\"; // ERROR Consider removing 'static.\n-   |                   ^^^^^^^ help: consider removing `'static`\n+   |                  -^^^^^^^----- help: consider removing `'static`: `&[u8]`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:22:19\n    |\n 22 | const VAR_TUPLE: &'static (u8, u8) = &(1, 2); // ERROR Consider removing 'static.\n-   |                   ^^^^^^^ help: consider removing `'static`\n+   |                  -^^^^^^^--------- help: consider removing `'static`: `&(u8, u8)`\n \n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:24:19\n    |\n 24 | const VAR_ARRAY: &'static [u8; 1] = b\"T\"; // ERROR Consider removing 'static.\n-   |                   ^^^^^^^ help: consider removing `'static`\n+   |                  -^^^^^^^-------- help: consider removing `'static`: `&[u8; 1]`\n "}]}