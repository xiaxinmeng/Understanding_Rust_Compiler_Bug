{"sha": "f6dfbfef01e316c1c374ea36c259963ab0c7f4b4", "node_id": "C_kwDOAAsO6NoAKGY2ZGZiZmVmMDFlMzE2YzFjMzc0ZWEzNmMyNTk5NjNhYjBjN2Y0YjQ", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-04-13T03:54:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-13T03:54:11Z"}, "message": "Rollup merge of #95441 - AlecGoncharow:issue-95204-fix, r=Mark-Simulacrum\n\nAlways use system `python3` on MacOS\n\nThis PR includes 2 changes:\n\n1. Always use the system Python found at `/usr/bin/python3` on MacOS\n2. Removes the hard requirement on having `python` in your system path if you didn't specify alternatives. The proposed change will instead attempt to find and use in order: `python` -> `python3` -> `python2`. This change isn't strictly necessary but without any change to this check, the original issue inspiring this change will still exist.\n\nFixes #95204\nr? ```@jyn514```", "tree": {"sha": "a1f9e5833bb28ca4c43cd84390c9739c498bed69", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a1f9e5833bb28ca4c43cd84390c9739c498bed69"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiVkljCRBK7hj4Ov3rIwAA4+QIAKRd4PlYM/49zHBb5A6PDBlQ\nBNV8WuDzkAZ/mIva5VbB3ttwfPctY6QQdyAAs3QCCkOgmqLMopyeaVjHJw3qhXey\nhW6AYCPstI5Rnr6q8zLnulHSi+lRnfJ+GLiqMeHPvYJHDsise2MYXx6YI/CznLxs\n0BdrOrZwMfRqVCLZRr1bMtX1QCYKeAXBjXsJ94uJ4hORmh8fx9z/y+X64fcoguFM\nSThQM4xNcV46rw+An1y+zVFbCq/i63xT+SRnUvLv/FQ7KyAKqFDE7RtFkMGC7CA6\ndWIV+K2O1bRftB8+w+dwm3m9hDqmQmqT1MXpIorMrVKfjjOI2TyBkCENZQ1F58k=\n=+7LF\n-----END PGP SIGNATURE-----\n", "payload": "tree a1f9e5833bb28ca4c43cd84390c9739c498bed69\nparent 1491e5cc148391f7679542b8e9b4e6d2430a7b69\nparent 03c5f0d2182cc36548b782599412408349b13cbb\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1649822051 +0200\ncommitter GitHub <noreply@github.com> 1649822051 +0200\n\nRollup merge of #95441 - AlecGoncharow:issue-95204-fix, r=Mark-Simulacrum\n\nAlways use system `python3` on MacOS\n\nThis PR includes 2 changes:\n\n1. Always use the system Python found at `/usr/bin/python3` on MacOS\n2. Removes the hard requirement on having `python` in your system path if you didn't specify alternatives. The proposed change will instead attempt to find and use in order: `python` -> `python3` -> `python2`. This change isn't strictly necessary but without any change to this check, the original issue inspiring this change will still exist.\n\nFixes #95204\nr? ```@jyn514```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4", "html_url": "https://github.com/rust-lang/rust/commit/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1491e5cc148391f7679542b8e9b4e6d2430a7b69", "url": "https://api.github.com/repos/rust-lang/rust/commits/1491e5cc148391f7679542b8e9b4e6d2430a7b69", "html_url": "https://github.com/rust-lang/rust/commit/1491e5cc148391f7679542b8e9b4e6d2430a7b69"}, {"sha": "03c5f0d2182cc36548b782599412408349b13cbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/03c5f0d2182cc36548b782599412408349b13cbb", "html_url": "https://github.com/rust-lang/rust/commit/03c5f0d2182cc36548b782599412408349b13cbb"}], "stats": {"total": 25, "additions": 15, "deletions": 10}, "files": [{"sha": "59102ad9f50b8fdd39ba352c235c823c8342f049", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=f6dfbfef01e316c1c374ea36c259963ab0c7f4b4", "patch": "@@ -1176,7 +1176,17 @@ impl Build {\n \n     /// Path to the python interpreter to use\n     fn python(&self) -> &Path {\n-        self.config.python.as_ref().unwrap()\n+        if self.config.build.ends_with(\"apple-darwin\") {\n+            // Force /usr/bin/python3 on macOS for LLDB tests because we're loading the\n+            // LLDB plugin's compiled module which only works with the system python\n+            // (namely not Homebrew-installed python)\n+            Path::new(\"/usr/bin/python3\")\n+        } else {\n+            self.config\n+                .python\n+                .as_ref()\n+                .expect(\"python is required for running LLDB or rustdoc tests\")\n+        }\n     }\n \n     /// Temporary directory that extended error information is emitted to."}, {"sha": "c96e6f9a3678f222937714e4561fa472aae0cbec", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=f6dfbfef01e316c1c374ea36c259963ab0c7f4b4", "patch": "@@ -103,7 +103,9 @@ pub fn check(build: &mut Build) {\n         .take()\n         .map(|p| cmd_finder.must_have(p))\n         .or_else(|| env::var_os(\"BOOTSTRAP_PYTHON\").map(PathBuf::from)) // set by bootstrap.py\n-        .or_else(|| Some(cmd_finder.must_have(\"python\")));\n+        .or_else(|| cmd_finder.maybe_have(\"python\"))\n+        .or_else(|| cmd_finder.maybe_have(\"python3\"))\n+        .or_else(|| cmd_finder.maybe_have(\"python2\"));\n \n     build.config.nodejs = build\n         .config"}, {"sha": "f60766bde726ebc1416239005e46318a0689da9f", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6dfbfef01e316c1c374ea36c259963ab0c7f4b4/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=f6dfbfef01e316c1c374ea36c259963ab0c7f4b4", "patch": "@@ -1402,14 +1402,7 @@ note: if you're sure you want to do this, please open an issue as to why. In the\n \n         cmd.arg(\"--docck-python\").arg(builder.python());\n \n-        if builder.config.build.ends_with(\"apple-darwin\") {\n-            // Force /usr/bin/python3 on macOS for LLDB tests because we're loading the\n-            // LLDB plugin's compiled module which only works with the system python\n-            // (namely not Homebrew-installed python)\n-            cmd.arg(\"--lldb-python\").arg(\"/usr/bin/python3\");\n-        } else {\n-            cmd.arg(\"--lldb-python\").arg(builder.python());\n-        }\n+        cmd.arg(\"--lldb-python\").arg(builder.python());\n \n         if let Some(ref gdb) = builder.config.gdb {\n             cmd.arg(\"--gdb\").arg(gdb);"}]}