{"sha": "34f7fcb862c4c53bc281af8be2542887a965deee", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0ZjdmY2I4NjJjNGM1M2JjMjgxYWY4YmUyNTQyODg3YTk2NWRlZWU=", "commit": {"author": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2019-10-25T10:03:34Z"}, "committer": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2019-11-06T10:04:42Z"}, "message": "Rebase fallout", "tree": {"sha": "be848c0c0bf2d0b04d0fb4889ed11a31d4c02670", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be848c0c0bf2d0b04d0fb4889ed11a31d4c02670"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34f7fcb862c4c53bc281af8be2542887a965deee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34f7fcb862c4c53bc281af8be2542887a965deee", "html_url": "https://github.com/rust-lang/rust/commit/34f7fcb862c4c53bc281af8be2542887a965deee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34f7fcb862c4c53bc281af8be2542887a965deee/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97633f814dd8b93aa026e72861208a8e21ccea5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/97633f814dd8b93aa026e72861208a8e21ccea5a", "html_url": "https://github.com/rust-lang/rust/commit/97633f814dd8b93aa026e72861208a8e21ccea5a"}], "stats": {"total": 58, "additions": 28, "deletions": 30}, "files": [{"sha": "b3ef3217ec6a091a19a67b82ffe0e773a0111c78", "filename": "src/librustc/ty/codec.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Flibrustc%2Fty%2Fcodec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Flibrustc%2Fty%2Fcodec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcodec.rs?ref=34f7fcb862c4c53bc281af8be2542887a965deee", "patch": "@@ -76,7 +76,10 @@ pub fn encode_with_shorthand<E, T, M>(encoder: &mut E,\n \n     // The shorthand encoding uses the same usize as the\n     // discriminant, with an offset so they can't conflict.\n+    #[cfg(bootstrap)]\n     let discriminant = unsafe { intrinsics::discriminant_value(variant) };\n+    #[cfg(not(bootstrap))]\n+    let discriminant = intrinsics::discriminant_value(variant);\n     assert!(discriminant < SHORTHAND_OFFSET as u64);\n     let shorthand = start + SHORTHAND_OFFSET;\n "}, {"sha": "32d2d40241c8222becc670a21099cab67622f2a1", "filename": "src/test/ui/enum-discriminant/discriminant_value.rs", "status": "modified", "additions": 21, "deletions": 24, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Ftest%2Fui%2Fenum-discriminant%2Fdiscriminant_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Ftest%2Fui%2Fenum-discriminant%2Fdiscriminant_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Fdiscriminant_value.rs?ref=34f7fcb862c4c53bc281af8be2542887a965deee", "patch": "@@ -51,34 +51,31 @@ enum Mixed {\n }\n \n pub fn main() {\n-    unsafe {\n+    assert_eq!(discriminant_value(&CLike1::A), 0);\n+    assert_eq!(discriminant_value(&CLike1::B), 1);\n+    assert_eq!(discriminant_value(&CLike1::C), 2);\n+    assert_eq!(discriminant_value(&CLike1::D), 3);\n \n-        assert_eq!(discriminant_value(&CLike1::A), 0);\n-        assert_eq!(discriminant_value(&CLike1::B), 1);\n-        assert_eq!(discriminant_value(&CLike1::C), 2);\n-        assert_eq!(discriminant_value(&CLike1::D), 3);\n+    assert_eq!(discriminant_value(&CLike2::A), 5);\n+    assert_eq!(discriminant_value(&CLike2::B), 2);\n+    assert_eq!(discriminant_value(&CLike2::C), 19);\n+    assert_eq!(discriminant_value(&CLike2::D), 20);\n \n-        assert_eq!(discriminant_value(&CLike2::A), 5);\n-        assert_eq!(discriminant_value(&CLike2::B), 2);\n-        assert_eq!(discriminant_value(&CLike2::C), 19);\n-        assert_eq!(discriminant_value(&CLike2::D), 20);\n+    assert_eq!(discriminant_value(&CLike3::A), 5);\n+    assert_eq!(discriminant_value(&CLike3::B), 6);\n+    assert_eq!(discriminant_value(&CLike3::C), -1_i8 as u64);\n+    assert_eq!(discriminant_value(&CLike3::D), 0);\n \n-        assert_eq!(discriminant_value(&CLike3::A), 5);\n-        assert_eq!(discriminant_value(&CLike3::B), 6);\n-        assert_eq!(discriminant_value(&CLike3::C), -1_i8 as u64);\n-        assert_eq!(discriminant_value(&CLike3::D), 0);\n+    assert_eq!(discriminant_value(&ADT::First(0,0)), 0);\n+    assert_eq!(discriminant_value(&ADT::Second(5)), 1);\n \n-        assert_eq!(discriminant_value(&ADT::First(0,0)), 0);\n-        assert_eq!(discriminant_value(&ADT::Second(5)), 1);\n+    assert_eq!(discriminant_value(&NullablePointer::Nothing), 1);\n+    assert_eq!(discriminant_value(&NullablePointer::Something(&CONST)), 0);\n \n-        assert_eq!(discriminant_value(&NullablePointer::Nothing), 1);\n-        assert_eq!(discriminant_value(&NullablePointer::Something(&CONST)), 0);\n+    assert_eq!(discriminant_value(&10), 0);\n+    assert_eq!(discriminant_value(&\"test\"), 0);\n \n-        assert_eq!(discriminant_value(&10), 0);\n-        assert_eq!(discriminant_value(&\"test\"), 0);\n-\n-        assert_eq!(3, discriminant_value(&Mixed::Unit));\n-        assert_eq!(2, discriminant_value(&Mixed::Tuple(5)));\n-        assert_eq!(1, discriminant_value(&Mixed::Struct{a: 7, b: 11}));\n-    }\n+    assert_eq!(3, discriminant_value(&Mixed::Unit));\n+    assert_eq!(2, discriminant_value(&Mixed::Tuple(5)));\n+    assert_eq!(1, discriminant_value(&Mixed::Struct{a: 7, b: 11}));\n }"}, {"sha": "f0b762c6254a38b5b0532556bda78b78118a201b", "filename": "src/test/ui/issues/issue-43398.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Ftest%2Fui%2Fissues%2Fissue-43398.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Ftest%2Fui%2Fissues%2Fissue-43398.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-43398.rs?ref=34f7fcb862c4c53bc281af8be2542887a965deee", "patch": "@@ -7,9 +7,7 @@\n enum Big { A, B }\n \n fn main() {\n-    unsafe {\n-        println!(\"{} {:?}\",\n-            std::intrinsics::discriminant_value(&Big::A),\n-            std::mem::discriminant(&Big::B));\n-    }\n+    println!(\"{} {:?}\",\n+        std::intrinsics::discriminant_value(&Big::A),\n+        std::mem::discriminant(&Big::B));\n }"}, {"sha": "40a70c623a741bf6f6f55767dab8f5843565ce3d", "filename": "src/test/ui/issues/issue-51582.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Ftest%2Fui%2Fissues%2Fissue-51582.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34f7fcb862c4c53bc281af8be2542887a965deee/src%2Ftest%2Fui%2Fissues%2Fissue-51582.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-51582.rs?ref=34f7fcb862c4c53bc281af8be2542887a965deee", "patch": "@@ -14,5 +14,5 @@ fn main() {\n     assert_eq!(1, make_b() as u8);\n     assert_eq!(1, make_b() as i32);\n     assert_eq!(1, make_b() as u32);\n-    assert_eq!(1, unsafe { std::intrinsics::discriminant_value(&make_b()) });\n+    assert_eq!(1, std::intrinsics::discriminant_value(&make_b()));\n }"}]}