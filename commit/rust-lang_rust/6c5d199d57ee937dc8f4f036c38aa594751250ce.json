{"sha": "6c5d199d57ee937dc8f4f036c38aa594751250ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZjNWQxOTlkNTdlZTkzN2RjOGY0ZjAzNmMzOGFhNTk0NzUxMjUwY2U=", "commit": {"author": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2021-05-31T15:46:20Z"}, "committer": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2021-07-28T12:16:31Z"}, "message": "Update deploy CI\n\nThis updates all the deploy scripts and the deploy workflow.\n\nThe deploy workflow now runs the metadata collector to collect the lint\ndocumentation. It also changes the files that are checked out in the\ndeploy workflow from master and adds an explanation why we have to do\nthis.", "tree": {"sha": "323dc155c10a31e4875ddb7bb53720013c6f5083", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/323dc155c10a31e4875ddb7bb53720013c6f5083"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6c5d199d57ee937dc8f4f036c38aa594751250ce", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmEBSyAACgkQHKDfKvWd\naKU2Iw//aFmTC05hO4sKO0rnR7mX8LRBWc1HlpffSMGvZYBSIcH1EpKqZJkOJAvi\nhzsgfcr6yxUR5CGVqHZVKToIbvf1CgzS9iSvyQNiqYTnihAjG+kRCNpg5RkSOvu8\nskjh2v/hD/qZmuDWQ4yhRsymHNFzDdy2mdYk3Z8xRsOynYuJFeqAFeydb+2CFgvE\nq6gNURM7cfz3OvYE4fjf7ix+BooSi9CFXon9p61rUM2x0+Eff1Dg6czdoLUQ5mY4\nXmCx2A0EVEJdvv1NuVT9uVnYFEsao7/G4WoYkOJNsPboASuUezXtmOESkxjFcNjh\nURbnboprWMuFUwFVaksEWw3HkzhEdZd4wm5+CKKj7ajel6cGFJsgEqpIjg/8O3FP\nBYFnyhtQ/RfZB6L8t2Y4lcrfwyyxqy0t5JWQ/TNEdaBcw3FNetjGXvVnif+3rnLN\nxSpHaPwKrQHd2B+mlO1KiwHfUfmala8G/+Th1wydxM9TBGSoubptv+H1mx42gKUI\nSdD8FUC46/GrknzY5O7TxPLED2xbgbCMm5CH9wwjGxiIMDF3+ceKp8KDlfQx6MBy\nvf+3k45XUtpAKcUk8jZIjCNuNtahlNuyAZh3EmvNdVsseUliJ/inI2fElIaMCaT8\nrJLtRodPC7uBZFWVxn+Q4Q/NFhslTo0I6VC0bFfXAQ9w9SFiR1E=\n=7IIR\n-----END PGP SIGNATURE-----", "payload": "tree 323dc155c10a31e4875ddb7bb53720013c6f5083\nparent ac0fd99194141f189b3fc41ef2d8925e6fa359c2\nauthor flip1995 <philipp.krones@embecosm.com> 1622475980 +0200\ncommitter flip1995 <philipp.krones@embecosm.com> 1627474591 +0200\n\nUpdate deploy CI\n\nThis updates all the deploy scripts and the deploy workflow.\n\nThe deploy workflow now runs the metadata collector to collect the lint\ndocumentation. It also changes the files that are checked out in the\ndeploy workflow from master and adds an explanation why we have to do\nthis.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6c5d199d57ee937dc8f4f036c38aa594751250ce", "html_url": "https://github.com/rust-lang/rust/commit/6c5d199d57ee937dc8f4f036c38aa594751250ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6c5d199d57ee937dc8f4f036c38aa594751250ce/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac0fd99194141f189b3fc41ef2d8925e6fa359c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac0fd99194141f189b3fc41ef2d8925e6fa359c2", "html_url": "https://github.com/rust-lang/rust/commit/ac0fd99194141f189b3fc41ef2d8925e6fa359c2"}], "stats": {"total": 30, "additions": 21, "deletions": 9}, "files": [{"sha": "a3c57232f557c4b774cb53ecc7e10299db1bd8e6", "filename": ".github/deploy.sh", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6c5d199d57ee937dc8f4f036c38aa594751250ce/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/6c5d199d57ee937dc8f4f036c38aa594751250ce/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=6c5d199d57ee937dc8f4f036c38aa594751250ce", "patch": "@@ -8,13 +8,12 @@ rm -rf out/master/ || exit 0\n echo \"Making the docs for master\"\n mkdir out/master/\n cp util/gh-pages/index.html out/master\n-python3 ./util/export.py out/master/lints.json\n+cp util/gh-pages/lints.json out/master\n \n if [[ -n $TAG_NAME ]]; then\n   echo \"Save the doc for the current tag ($TAG_NAME) and point stable/ to it\"\n-  cp -r out/master \"out/$TAG_NAME\"\n-  rm -f out/stable\n-  ln -s \"$TAG_NAME\" out/stable\n+  cp -Tr out/master \"out/$TAG_NAME\"\n+  ln -sf \"$TAG_NAME\" out/stable\n fi\n \n if [[ $BETA = \"true\" ]]; then\n@@ -28,8 +27,8 @@ cp util/gh-pages/versions.html out/index.html\n echo \"Making the versions.json file\"\n python3 ./util/versions.py out\n \n-cd out\n # Now let's go have some fun with the cloned repo\n+cd out\n git config user.name \"GHA CI\"\n git config user.email \"gha@ci.invalid\"\n "}, {"sha": "b8be730be32b00644ec1ed70658a832bf2284397", "filename": ".github/workflows/deploy.yml", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6c5d199d57ee937dc8f4f036c38aa594751250ce/.github%2Fworkflows%2Fdeploy.yml", "raw_url": "https://github.com/rust-lang/rust/raw/6c5d199d57ee937dc8f4f036c38aa594751250ce/.github%2Fworkflows%2Fdeploy.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fdeploy.yml?ref=6c5d199d57ee937dc8f4f036c38aa594751250ce", "patch": "@@ -39,10 +39,23 @@ jobs:\n       if: github.ref == 'refs/heads/beta'\n       run: echo \"BETA=true\" >> $GITHUB_ENV\n \n-    - name: Use scripts and templates from master branch\n+    # We need to check out all files that (transitively) depend on the\n+    # structure of the gh-pages branch, so that we're able to change that\n+    # structure without breaking the deployment.\n+    - name: Use deploy files from master branch\n       run: |\n         git fetch --no-tags --prune --depth=1 origin master\n-        git checkout origin/master -- .github/deploy.sh util/gh-pages/ util/*.py\n+        git checkout origin/master -- .github/deploy.sh util/versions.py util/gh-pages/versions.html\n+\n+    # Generate lockfile for caching to avoid build problems with cached deps\n+    - name: cargo generate-lockfile\n+      run: cargo generate-lockfile\n+\n+    - name: Cache\n+      uses: Swatinem/rust-cache@v1.3.0\n+\n+    - name: cargo collect-metadata\n+      run: cargo collect-metadata\n \n     - name: Deploy\n       run: |"}, {"sha": "598450a725f2935932e4419ad7bb87b8c151e264", "filename": "clippy_lints/src/utils/internal_lints/metadata_collector.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6c5d199d57ee937dc8f4f036c38aa594751250ce/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c5d199d57ee937dc8f4f036c38aa594751250ce/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs?ref=6c5d199d57ee937dc8f4f036c38aa594751250ce", "patch": "@@ -32,7 +32,7 @@ use clippy_utils::{\n };\n \n /// This is the output file of the lint collector.\n-const OUTPUT_FILE: &str = \"../util/gh-pages/metadata_collection.json\";\n+const OUTPUT_FILE: &str = \"../util/gh-pages/lints.json\";\n /// These lints are excluded from the export.\n const BLACK_LISTED_LINTS: [&str; 3] = [\"lint_author\", \"deep_code_inspection\", \"internal_metadata_collector\"];\n /// These groups will be ignored by the lint group matcher. This is useful for collections like"}, {"sha": "4ede20c52583b0bbcef93972f47fff53aa2879db", "filename": "tests/dogfood.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6c5d199d57ee937dc8f4f036c38aa594751250ce/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c5d199d57ee937dc8f4f036c38aa594751250ce/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=6c5d199d57ee937dc8f4f036c38aa594751250ce", "patch": "@@ -183,7 +183,7 @@ fn run_metadata_collection_lint() {\n     use std::time::SystemTime;\n \n     // Setup for validation\n-    let metadata_output_path = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\")).join(\"util/gh-pages/metadata_collection.json\");\n+    let metadata_output_path = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\")).join(\"util/gh-pages/lints.json\");\n     let start_time = SystemTime::now();\n \n     // Run collection as is"}]}