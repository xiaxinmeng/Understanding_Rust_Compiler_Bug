{"sha": "e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2MmVjZGM1YTdjYmQ0NGE5YWRlNTA2MWRkYWQ0ZDhhNGUxZDY1OTk=", "commit": {"author": {"name": "Gary Guo", "email": "gary@garyguo.net", "date": "2021-08-14T20:56:57Z"}, "committer": {"name": "Gary Guo", "email": "gary@garyguo.net", "date": "2021-08-15T17:17:21Z"}, "message": "Add a dead code test for using anon const in pattern", "tree": {"sha": "ca83c26048faffc98c1f946f84a6979575728a76", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ca83c26048faffc98c1f946f84a6979575728a76"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599", "html_url": "https://github.com/rust-lang/rust/commit/e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599/comments", "author": {"login": "nbdd0121", "id": 4065244, "node_id": "MDQ6VXNlcjQwNjUyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4065244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbdd0121", "html_url": "https://github.com/nbdd0121", "followers_url": "https://api.github.com/users/nbdd0121/followers", "following_url": "https://api.github.com/users/nbdd0121/following{/other_user}", "gists_url": "https://api.github.com/users/nbdd0121/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbdd0121/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbdd0121/subscriptions", "organizations_url": "https://api.github.com/users/nbdd0121/orgs", "repos_url": "https://api.github.com/users/nbdd0121/repos", "events_url": "https://api.github.com/users/nbdd0121/events{/privacy}", "received_events_url": "https://api.github.com/users/nbdd0121/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nbdd0121", "id": 4065244, "node_id": "MDQ6VXNlcjQwNjUyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4065244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbdd0121", "html_url": "https://github.com/nbdd0121", "followers_url": "https://api.github.com/users/nbdd0121/followers", "following_url": "https://api.github.com/users/nbdd0121/following{/other_user}", "gists_url": "https://api.github.com/users/nbdd0121/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbdd0121/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbdd0121/subscriptions", "organizations_url": "https://api.github.com/users/nbdd0121/orgs", "repos_url": "https://api.github.com/users/nbdd0121/repos", "events_url": "https://api.github.com/users/nbdd0121/events{/privacy}", "received_events_url": "https://api.github.com/users/nbdd0121/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2969aece415baa1a42df2a06ba635311000a2b5b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2969aece415baa1a42df2a06ba635311000a2b5b", "html_url": "https://github.com/rust-lang/rust/commit/2969aece415baa1a42df2a06ba635311000a2b5b"}], "stats": {"total": 45, "additions": 45, "deletions": 0}, "files": [{"sha": "4c6211a279a58e9483da41ba47f542e0e86b0a16", "filename": "src/test/ui/lint/dead-code/anon-const-in-pat.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599/src%2Ftest%2Fui%2Flint%2Fdead-code%2Fanon-const-in-pat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599/src%2Ftest%2Fui%2Flint%2Fdead-code%2Fanon-const-in-pat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fdead-code%2Fanon-const-in-pat.rs?ref=e62ecdc5a7cbd44a9ade5061ddad4d8a4e1d6599", "patch": "@@ -0,0 +1,45 @@\n+// check-pass\n+#![feature(inline_const)]\n+#![allow(incomplete_features)]\n+#![deny(dead_code)]\n+\n+const fn one() -> i32 {\n+    1\n+}\n+\n+const fn two() -> i32 {\n+    2\n+}\n+\n+const fn three() -> i32 {\n+    3\n+}\n+\n+fn inline_const() {\n+    // rust-lang/rust#78171: dead_code lint triggers even though function is used in const pattern\n+    match 1 {\n+        const { one() } => {}\n+        _ => {}\n+    }\n+}\n+\n+fn inline_const_range() {\n+    match 1 {\n+        1 ..= const { two() } => {}\n+        _ => {}\n+    }\n+}\n+\n+struct S<const C: i32>;\n+\n+fn const_generic_arg() {\n+    match S::<3> {\n+        S::<{three()}> => {}\n+    }\n+}\n+\n+fn main() {\n+    inline_const();\n+    inline_const_range();\n+    const_generic_arg();\n+}"}]}