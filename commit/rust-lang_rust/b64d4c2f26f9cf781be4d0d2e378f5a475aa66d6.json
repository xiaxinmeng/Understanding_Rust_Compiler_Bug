{"sha": "b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6", "node_id": "C_kwDOAAsO6NoAKGI2NGQ0YzJmMjZmOWNmNzgxYmU0ZDBkMmUzNzhmNWE0NzVhYTY2ZDY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-04-30T14:25:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-30T14:25:46Z"}, "message": "Rollup merge of #110118 - jyn514:download-error, r=Mark-Simulacrum\n\ndownload-rustc: Give a better error message if artifacts can't be dowloaded\n\nIt should be very rare in practice to happen; people would need to both have `download-ci-llvm` disabled and `download-rustc` enabled. I think it may be more common if we start turning this on by default, though.\n\nHelps with https://github.com/rust-lang/rust/issues/81930.\n\nBefore:\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/bf5cad8e775fb326465e5c1b98693e5d259da156/rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz\ncurl: (22) The requested URL returned error: 404\n```\n\nAfter:\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/bf5cad8e775fb326465e5c1b98693e5d259da156/rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz\ncurl: (22) The requested URL returned error: 404\n\nerror: failed to download pre-built rustc from CI\n\nnote: old builds get deleted after a certain time\nhelp: if trying to compile an old commit of rustc, disable `download-rustc` in config.toml:\n\n[rust]\ndownload-rustc = false\n```", "tree": {"sha": "d96d540c5af2aeefab6a7b6a9cafd850c8ddd269", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d96d540c5af2aeefab6a7b6a9cafd850c8ddd269"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkTnpqCRBK7hj4Ov3rIwAAAyIIAAGDSXYWFPm2DciIOA/cEJvt\nddsUlScVScGjWOE5qP2tzHceDAY5zcJiRm0g6UOP2TAMRNdUOO0JtMa6XiUCD25R\njjLnZDOdwRXnoBaiT6LGb8EY25Kp+CmcQVfs5xHdv9nXQXbZLfH7o6r9AfKgu+ZN\nUkoUpRpFoaWpkyOJ94p6UuBklwUb2XQytPzTelbEraGnNh7/IP1+hmh3H36tna3A\nWjmf4Zlffm1Ey/HQ81j0NtP3ace3V+nVWk4U/97Yud0zOCFEmi29dCs5KKhy/pm3\nM+8e3m6s3NhO6bNzdTLi83YfboLfJIt7z8sy/jOFnas0q4wtWPdm5VaR6AufXaQ=\n=yWyh\n-----END PGP SIGNATURE-----\n", "payload": "tree d96d540c5af2aeefab6a7b6a9cafd850c8ddd269\nparent 89158e210ce0b9550b42c65ede244087f2e144b5\nparent d50ce1536cf9ce101e08e1f9913076762a9390a6\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1682864746 +0200\ncommitter GitHub <noreply@github.com> 1682864746 +0200\n\nRollup merge of #110118 - jyn514:download-error, r=Mark-Simulacrum\n\ndownload-rustc: Give a better error message if artifacts can't be dowloaded\n\nIt should be very rare in practice to happen; people would need to both have `download-ci-llvm` disabled and `download-rustc` enabled. I think it may be more common if we start turning this on by default, though.\n\nHelps with https://github.com/rust-lang/rust/issues/81930.\n\nBefore:\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/bf5cad8e775fb326465e5c1b98693e5d259da156/rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz\ncurl: (22) The requested URL returned error: 404\n```\n\nAfter:\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/bf5cad8e775fb326465e5c1b98693e5d259da156/rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz\ncurl: (22) The requested URL returned error: 404\n\nerror: failed to download pre-built rustc from CI\n\nnote: old builds get deleted after a certain time\nhelp: if trying to compile an old commit of rustc, disable `download-rustc` in config.toml:\n\n[rust]\ndownload-rustc = false\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6", "html_url": "https://github.com/rust-lang/rust/commit/b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89158e210ce0b9550b42c65ede244087f2e144b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/89158e210ce0b9550b42c65ede244087f2e144b5", "html_url": "https://github.com/rust-lang/rust/commit/89158e210ce0b9550b42c65ede244087f2e144b5"}, {"sha": "d50ce1536cf9ce101e08e1f9913076762a9390a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/d50ce1536cf9ce101e08e1f9913076762a9390a6", "html_url": "https://github.com/rust-lang/rust/commit/d50ce1536cf9ce101e08e1f9913076762a9390a6"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "6405fe3da027496706fd57fc0cf24f5f2795e213", "filename": "src/bootstrap/download.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6/src%2Fbootstrap%2Fdownload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6/src%2Fbootstrap%2Fdownload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdownload.rs?ref=b64d4c2f26f9cf781be4d0d2e378f5a475aa66d6", "patch": "@@ -541,7 +541,18 @@ impl Config {\n             None\n         };\n \n-        self.download_file(&format!(\"{base_url}/{url}\"), &tarball, \"\");\n+        let mut help_on_error = \"\";\n+        if destination == \"ci-rustc\" {\n+            help_on_error = \"error: failed to download pre-built rustc from CI\n+\n+note: old builds get deleted after a certain time\n+help: if trying to compile an old commit of rustc, disable `download-rustc` in config.toml:\n+\n+[rust]\n+download-rustc = false\n+\";\n+        }\n+        self.download_file(&format!(\"{base_url}/{url}\"), &tarball, help_on_error);\n         if let Some(sha256) = checksum {\n             if !self.verify(&tarball, sha256) {\n                 panic!(\"failed to verify {}\", tarball.display());"}]}