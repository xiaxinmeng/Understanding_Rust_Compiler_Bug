{"sha": "7602a46bb9421afc4e158326f438b1853503b804", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2MDJhNDZiYjk0MjFhZmM0ZTE1ODMyNmY0MzhiMTg1MzUwM2I4MDQ=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2019-08-05T14:28:27Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2019-08-05T14:28:27Z"}, "message": "Implement simd_extract", "tree": {"sha": "ea5853295e3aefb5d2ba41d7d7f6abe2b3db3f77", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea5853295e3aefb5d2ba41d7d7f6abe2b3db3f77"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7602a46bb9421afc4e158326f438b1853503b804", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7602a46bb9421afc4e158326f438b1853503b804", "html_url": "https://github.com/rust-lang/rust/commit/7602a46bb9421afc4e158326f438b1853503b804", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7602a46bb9421afc4e158326f438b1853503b804/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1dd460714f05610a5bb9ccbfd5d69cc1478e3f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/a1dd460714f05610a5bb9ccbfd5d69cc1478e3f5", "html_url": "https://github.com/rust-lang/rust/commit/a1dd460714f05610a5bb9ccbfd5d69cc1478e3f5"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "1337c3147660ab946999c3f77d28f62d0ef5635a", "filename": "example/std_example.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7602a46bb9421afc4e158326f438b1853503b804/example%2Fstd_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7602a46bb9421afc4e158326f438b1853503b804/example%2Fstd_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/example%2Fstd_example.rs?ref=7602a46bb9421afc4e158326f438b1853503b804", "patch": "@@ -72,6 +72,7 @@ unsafe fn test_simd() {\n     test_mm_add_epi8();\n     test_mm_add_pd();\n     test_mm_cvtepi8_epi16();\n+    test_mm_cvtsi128_si64();\n \n     let mask1 = _mm_movemask_epi8(dbg!(_mm_setr_epi8(255u8 as i8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)));\n     assert_eq!(mask1, 1);\n@@ -174,6 +175,12 @@ pub unsafe fn assert_eq_m128d(a: __m128d, b: __m128d) {\n     }\n }\n \n+#[target_feature(enable = \"sse2\")]\n+unsafe fn test_mm_cvtsi128_si64() {\n+    let r = _mm_cvtsi128_si64(std::mem::transmute::<[i64; 2], _>([5, 0]));\n+    assert_eq!(r, 5);\n+}\n+\n #[target_feature(enable = \"sse4.1\")]\n unsafe fn test_mm_cvtepi8_epi16() {\n     let a = _mm_set1_epi8(10);"}, {"sha": "4f1cbbe0f109c371e01abdafb8ecfe638e7a0bb4", "filename": "src/intrinsics.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7602a46bb9421afc4e158326f438b1853503b804/src%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7602a46bb9421afc4e158326f438b1853503b804/src%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fintrinsics.rs?ref=7602a46bb9421afc4e158326f438b1853503b804", "patch": "@@ -953,6 +953,18 @@ pub fn codegen_intrinsic_call<'a, 'tcx: 'a>(\n             }\n         };\n \n+        simd_extract, (c v, o idx) {\n+            let idx_const = crate::constant::mir_operand_get_const_val(fx, idx).expect(\"simd_extract* idx not const\");\n+            let idx = idx_const.val.try_to_bits(Size::from_bytes(4 /* u32*/)).expect(&format!(\"kind not scalar: {:?}\", idx_const));\n+            let (_lane_type, lane_count) = lane_type_and_count(fx, v.layout(), intrinsic);\n+            if idx >= lane_count.into() {\n+                fx.tcx.sess.span_fatal(fx.mir.span, &format!(\"[simd_extract] idx {} >= lane_count {}\", idx, lane_count));\n+            }\n+\n+            let ret_lane = v.value_field(fx, mir::Field::new(idx.try_into().unwrap()));\n+            ret.write_cvalue(fx, ret_lane);\n+        };\n+\n         simd_add, (c x, c y) {\n             simd_int_flt_binop!(fx, intrinsic, iadd|fadd(x, y) -> ret);\n         };"}]}