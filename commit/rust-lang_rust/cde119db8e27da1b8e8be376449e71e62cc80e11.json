{"sha": "cde119db8e27da1b8e8be376449e71e62cc80e11", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkZTExOWRiOGUyN2RhMWI4ZThiZTM3NjQ0OWU3MWU2MmNjODBlMTE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-05T18:13:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-02-05T18:13:45Z"}, "message": "Rollup merge of #47496 - QuietMisdreavus:rls-doc-include, r=estebank\n\nadd documentation from doc(include) to analysis data\n\ncc #44732\n\nCurrently save-analysis only loads docs from plain doc comments and doc attributes. Since `#[doc(include=\"filename.md\")]` doesn't create a plain doc attribute when it loads the file, we need to be sure to pick up this info for the analysis data.", "tree": {"sha": "75fbe3e14e6188e6741a1e910534457392f79039", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/75fbe3e14e6188e6741a1e910534457392f79039"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cde119db8e27da1b8e8be376449e71e62cc80e11", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaeJ7ZCRBK7hj4Ov3rIwAAdHIIAEeQkGk9UnTDg654B2rInUIv\nY4icIKoSyP/nw+oY8Gup3/aRewK9Tgcgl7rlmjhOutUD84FujKjSuwxkIjLjTKhE\nubPHurtQQcRGSwaR2czudB+cdMoJfzDfyv+qwZvE4mtd3fJA7Qpnhd3M+s1txJ3+\nDViUoVdaZsAkEjkwoOERebc+VtE+sgqf/iBnbtNDH9Ymysgo+6gf8VHh39cQaQ/e\nVylLxmqQ4ru0EgB7ePxdhRcy0D4a999CgYoS/mJkJ6vy9FHCW0Nieg96EyRKhqyT\nbuRVL+teJRwoAY8ilVNTXYvGmIA+2G42r5bDAxWWhLC6wQnnAHbx3+it0sNSRU4=\n=Xzi5\n-----END PGP SIGNATURE-----\n", "payload": "tree 75fbe3e14e6188e6741a1e910534457392f79039\nparent eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5\nparent 5a350c137196f0a192b632f0380a8e3e5ab71fb3\nauthor kennytm <kennytm@gmail.com> 1517854425 +0800\ncommitter GitHub <noreply@github.com> 1517854425 +0800\n\nRollup merge of #47496 - QuietMisdreavus:rls-doc-include, r=estebank\n\nadd documentation from doc(include) to analysis data\n\ncc #44732\n\nCurrently save-analysis only loads docs from plain doc comments and doc attributes. Since `#[doc(include=\"filename.md\")]` doesn't create a plain doc attribute when it loads the file, we need to be sure to pick up this info for the analysis data.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cde119db8e27da1b8e8be376449e71e62cc80e11", "html_url": "https://github.com/rust-lang/rust/commit/cde119db8e27da1b8e8be376449e71e62cc80e11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cde119db8e27da1b8e8be376449e71e62cc80e11/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "html_url": "https://github.com/rust-lang/rust/commit/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5"}, {"sha": "5a350c137196f0a192b632f0380a8e3e5ab71fb3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5a350c137196f0a192b632f0380a8e3e5ab71fb3", "html_url": "https://github.com/rust-lang/rust/commit/5a350c137196f0a192b632f0380a8e3e5ab71fb3"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "8232a8efd541f242f43abdfabf1c21b5a64b3d3c", "filename": "src/librustc_save_analysis/lib.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/cde119db8e27da1b8e8be376449e71e62cc80e11/src%2Flibrustc_save_analysis%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cde119db8e27da1b8e8be376449e71e62cc80e11/src%2Flibrustc_save_analysis%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Flib.rs?ref=cde119db8e27da1b8e8be376449e71e62cc80e11", "patch": "@@ -870,6 +870,17 @@ impl<'l, 'tcx: 'l> SaveContext<'l, 'tcx> {\n                         result.push_str(&val.as_str());\n                     }\n                     result.push('\\n');\n+                } else if let Some(meta_list) = attr.meta_item_list() {\n+                    meta_list.into_iter()\n+                             .filter(|it| it.check_name(\"include\"))\n+                             .filter_map(|it| it.meta_item_list().map(|l| l.to_owned()))\n+                             .flat_map(|it| it)\n+                             .filter(|meta| meta.check_name(\"contents\"))\n+                             .filter_map(|meta| meta.value_str())\n+                             .for_each(|val| {\n+                                 result.push_str(&val.as_str());\n+                                 result.push('\\n');\n+                             });\n                 }\n             }\n         }"}, {"sha": "0605ca517ff3bdfaf4f613ef0a988ed61187a4d9", "filename": "src/test/run-make/save-analysis/extra-docs.md", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cde119db8e27da1b8e8be376449e71e62cc80e11/src%2Ftest%2Frun-make%2Fsave-analysis%2Fextra-docs.md", "raw_url": "https://github.com/rust-lang/rust/raw/cde119db8e27da1b8e8be376449e71e62cc80e11/src%2Ftest%2Frun-make%2Fsave-analysis%2Fextra-docs.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsave-analysis%2Fextra-docs.md?ref=cde119db8e27da1b8e8be376449e71e62cc80e11", "patch": "@@ -0,0 +1 @@\n+Extra docs for this struct."}, {"sha": "5b4e4802957af8e037c62f96500fe008e1818a55", "filename": "src/test/run-make/save-analysis/foo.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cde119db8e27da1b8e8be376449e71e62cc80e11/src%2Ftest%2Frun-make%2Fsave-analysis%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cde119db8e27da1b8e8be376449e71e62cc80e11/src%2Ftest%2Frun-make%2Fsave-analysis%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsave-analysis%2Ffoo.rs?ref=cde119db8e27da1b8e8be376449e71e62cc80e11", "patch": "@@ -12,6 +12,7 @@\n #![feature(box_syntax)]\n #![feature(rustc_private)]\n #![feature(associated_type_defaults)]\n+#![feature(external_doc)]\n \n extern crate graphviz;\n // A simple rust project\n@@ -461,3 +462,6 @@ impl Iterator for SilenceGenerator {\n trait Foo {\n     type Bar = FrameBuffer;\n }\n+\n+#[doc(include=\"extra-docs.md\")]\n+struct StructWithDocs;"}]}