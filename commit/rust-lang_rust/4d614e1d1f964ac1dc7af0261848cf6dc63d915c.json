{"sha": "4d614e1d1f964ac1dc7af0261848cf6dc63d915c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkNjE0ZTFkMWY5NjRhYzFkYzdhZjAyNjE4NDhjZjZkYzYzZDkxNWM=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-09-15T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-09-18T05:28:55Z"}, "message": "Do not collapse goto chains beginning with the start block\n\nIf any block on a goto chain has more than one predecessor, then the new\nstart block would have basic block predecessors.\n\nSkip the transformation for the start block altogether, to avoid\nviolating the new invariant that the start block does not have any basic\nblock predecessors.", "tree": {"sha": "0cbd9b9d0118cbb0fe5908936bf180fbf9adde58", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0cbd9b9d0118cbb0fe5908936bf180fbf9adde58"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4d614e1d1f964ac1dc7af0261848cf6dc63d915c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4d614e1d1f964ac1dc7af0261848cf6dc63d915c", "html_url": "https://github.com/rust-lang/rust/commit/4d614e1d1f964ac1dc7af0261848cf6dc63d915c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4d614e1d1f964ac1dc7af0261848cf6dc63d915c/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5118dd5a2f0b97a006f55ef68408a7dd1925bc12", "url": "https://api.github.com/repos/rust-lang/rust/commits/5118dd5a2f0b97a006f55ef68408a7dd1925bc12", "html_url": "https://github.com/rust-lang/rust/commit/5118dd5a2f0b97a006f55ef68408a7dd1925bc12"}], "stats": {"total": 25, "additions": 0, "deletions": 25}, "files": [{"sha": "d6cd505cbb569d281ef85fb16cb49ef896071b00", "filename": "compiler/rustc_mir_transform/src/simplify.rs", "status": "modified", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/4d614e1d1f964ac1dc7af0261848cf6dc63d915c/compiler%2Frustc_mir_transform%2Fsrc%2Fsimplify.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4d614e1d1f964ac1dc7af0261848cf6dc63d915c/compiler%2Frustc_mir_transform%2Fsrc%2Fsimplify.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fsimplify.rs?ref=4d614e1d1f964ac1dc7af0261848cf6dc63d915c", "patch": "@@ -95,8 +95,6 @@ impl<'a, 'tcx> CfgSimplifier<'a, 'tcx> {\n     pub fn simplify(mut self) {\n         self.strip_nops();\n \n-        let mut start = START_BLOCK;\n-\n         // Vec of the blocks that should be merged. We store the indices here, instead of the\n         // statements itself to avoid moving the (relatively) large statements twice.\n         // We do not push the statements directly into the target block (`bb`) as that is slower\n@@ -105,8 +103,6 @@ impl<'a, 'tcx> CfgSimplifier<'a, 'tcx> {\n         loop {\n             let mut changed = false;\n \n-            self.collapse_goto_chain(&mut start, &mut changed);\n-\n             for bb in self.basic_blocks.indices() {\n                 if self.pred_count[bb] == 0 {\n                     continue;\n@@ -149,27 +145,6 @@ impl<'a, 'tcx> CfgSimplifier<'a, 'tcx> {\n                 break;\n             }\n         }\n-\n-        if start != START_BLOCK {\n-            debug_assert!(self.pred_count[START_BLOCK] == 0);\n-            self.basic_blocks.swap(START_BLOCK, start);\n-            self.pred_count.swap(START_BLOCK, start);\n-\n-            // pred_count == 1 if the start block has no predecessor _blocks_.\n-            if self.pred_count[START_BLOCK] > 1 {\n-                for (bb, data) in self.basic_blocks.iter_enumerated_mut() {\n-                    if self.pred_count[bb] == 0 {\n-                        continue;\n-                    }\n-\n-                    for target in data.terminator_mut().successors_mut() {\n-                        if *target == start {\n-                            *target = START_BLOCK;\n-                        }\n-                    }\n-                }\n-            }\n-        }\n     }\n \n     /// This function will return `None` if"}]}