{"sha": "89ddd717caf7084c9fe292ceaa46828c65573097", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5ZGRkNzE3Y2FmNzA4NGM5ZmUyOTJjZWFhNDY4MjhjNjU1NzMwOTc=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-03-18T16:24:42Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-03-22T15:13:09Z"}, "message": "Revert \"Auto merge of #39485 - canndrew:inference-fix-39297, r=nikomatsakis\"\n\nThis reverts commit dc0bb3f2839c13ab42feacd423f728fbfd2f2f7a, reversing\nchanges made to e879aa43ef63962f8e4d797292194a9f40a22a13.\n\nThis is a temporary step intended to fix regressions. A more\ncomprehensive fix for type inference and dead-code is in the works.", "tree": {"sha": "d993cc5da9bced83c41670fce0e93ebe09921d58", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d993cc5da9bced83c41670fce0e93ebe09921d58"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/89ddd717caf7084c9fe292ceaa46828c65573097", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/89ddd717caf7084c9fe292ceaa46828c65573097", "html_url": "https://github.com/rust-lang/rust/commit/89ddd717caf7084c9fe292ceaa46828c65573097", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/89ddd717caf7084c9fe292ceaa46828c65573097/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c4f2c64c6759a82f143e23964a46a65c67509c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c4f2c64c6759a82f143e23964a46a65c67509c9", "html_url": "https://github.com/rust-lang/rust/commit/8c4f2c64c6759a82f143e23964a46a65c67509c9"}], "stats": {"total": 47, "additions": 36, "deletions": 11}, "files": [{"sha": "9c62fd486d45a6f7574133a2e5fa387767e27a50", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=89ddd717caf7084c9fe292ceaa46828c65573097", "patch": "@@ -4099,6 +4099,17 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             };\n \n             if self.diverges.get().always() {\n+                if let ExpectHasType(ety) = expected {\n+                    // Avoid forcing a type (only `!` for now) in unreachable code.\n+                    // FIXME(aburka) do we need this special case? and should it be is_uninhabited?\n+                    if !ety.is_never() {\n+                        if let Some(ref e) = blk.expr {\n+                            // Coerce the tail expression to the right type.\n+                            self.demand_coerce(e, ty, ety);\n+                        }\n+                    }\n+                }\n+\n                 ty = self.next_diverging_ty_var(TypeVariableOrigin::DivergingBlockExpr(blk.span));\n             } else if let ExpectHasType(ety) = expected {\n                 if let Some(ref e) = blk.expr {"}, {"sha": "434b795ff31f54404c489ae3491aaaf4a81d4ead", "filename": "src/test/compile-fail/issue-10176.rs", "status": "renamed", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Fcompile-fail%2Fissue-10176.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Fcompile-fail%2Fissue-10176.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-10176.rs?ref=89ddd717caf7084c9fe292ceaa46828c65573097", "patch": "@@ -8,12 +8,12 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-fn g() {\n-    &panic!()\n-}\n-\n fn f() -> isize {\n     (return 1, return 2)\n+//~^ ERROR mismatched types\n+//~| expected type `isize`\n+//~| found type `(_, _)`\n+//~| expected isize, found tuple\n }\n \n fn main() {}", "previous_filename": "src/test/run-pass/inference-changes-39485.rs"}, {"sha": "1cbb7588e17df5e5fdddb3d8f0ff54f5e2608bbf", "filename": "src/test/compile-fail/issue-5500.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Fcompile-fail%2Fissue-5500.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Fcompile-fail%2Fissue-5500.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-5500.rs?ref=89ddd717caf7084c9fe292ceaa46828c65573097", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    &panic!()\n+    //~^ ERROR mismatched types\n+    //~| expected type `()`\n+    //~| found type `&_`\n+    //~| expected (), found reference\n+}"}, {"sha": "0baaaac26768571ca91c8d118794d0bb2a4d5c50", "filename": "src/test/run-pass/issue-15763.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Frun-pass%2Fissue-15763.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Frun-pass%2Fissue-15763.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-15763.rs?ref=89ddd717caf7084c9fe292ceaa46828c65573097", "patch": "@@ -8,8 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![allow(unused_features)]\n-#![allow(unreachable_code)]\n+#![allow(unknown_features)]\n #![feature(box_syntax)]\n \n #[derive(PartialEq, Debug)]\n@@ -29,14 +28,14 @@ struct Foo {\n }\n \n fn foo() -> Result<Foo, isize> {\n-    return Ok::<Foo, isize>(Foo {\n+    return Ok(Foo {\n         x: Bar { x: 22 },\n         a: return Err(32)\n     });\n }\n \n fn baz() -> Result<Foo, isize> {\n-    Ok::<Foo, isize>(Foo {\n+    Ok(Foo {\n         x: Bar { x: 22 },\n         a: return Err(32)\n     })"}, {"sha": "9a6ea2272fea7c5ca453595a1c0f3343eed99212", "filename": "src/test/run-pass/project-defer-unification.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Frun-pass%2Fproject-defer-unification.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89ddd717caf7084c9fe292ceaa46828c65573097/src%2Ftest%2Frun-pass%2Fproject-defer-unification.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fproject-defer-unification.rs?ref=89ddd717caf7084c9fe292ceaa46828c65573097", "patch": "@@ -11,8 +11,6 @@\n // A regression test extracted from image-0.3.11. The point of\n // failure was in `index_colors` below.\n \n-#![allow(unused)]\n-\n use std::ops::{Deref, DerefMut};\n \n #[derive(Copy, Clone)]\n@@ -94,7 +92,7 @@ pub fn index_colors<Pix>(image: &ImageBuffer<Pix, Vec<u8>>)\n                          -> ImageBuffer<Luma<u8>, Vec<u8>>\n where Pix: Pixel<Subpixel=u8> + 'static,\n {\n-    let mut indices: ImageBuffer<Luma<u8>, Vec<u8>> = loop { };\n+    let mut indices: ImageBuffer<_,Vec<_>> = loop { };\n     for (pixel, idx) in image.pixels().zip(indices.pixels_mut()) {\n         // failured occurred here ^^ because we were requiring that we\n         // could project Pixel or Subpixel from `T_indices` (type of"}]}