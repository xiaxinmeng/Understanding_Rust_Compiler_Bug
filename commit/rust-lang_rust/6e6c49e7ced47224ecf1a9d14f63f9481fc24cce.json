{"sha": "6e6c49e7ced47224ecf1a9d14f63f9481fc24cce", "node_id": "C_kwDOAAsO6NoAKDZlNmM0OWU3Y2VkNDcyMjRlY2YxYTlkMTRmNjNmOTQ4MWZjMjRjY2U", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-10T23:36:20Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-10T23:36:20Z"}, "message": "Don't CoerceUnsized dyn* to dyn*", "tree": {"sha": "82946cb6d6898da79d8152fe3637a005e153eb7f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82946cb6d6898da79d8152fe3637a005e153eb7f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce", "html_url": "https://github.com/rust-lang/rust/commit/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0af211af67536f0bd0b86ed5d812b0782d232023", "url": "https://api.github.com/repos/rust-lang/rust/commits/0af211af67536f0bd0b86ed5d812b0782d232023", "html_url": "https://github.com/rust-lang/rust/commit/0af211af67536f0bd0b86ed5d812b0782d232023"}], "stats": {"total": 30, "additions": 28, "deletions": 2}, "files": [{"sha": "1f912894ccc96fad0abca3ccf6efebc45f6e32cd", "filename": "compiler/rustc_trait_selection/src/traits/select/candidate_assembly.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs?ref=6e6c49e7ced47224ecf1a9d14f63f9481fc24cce", "patch": "@@ -779,7 +779,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n \n         match (source.kind(), target.kind()) {\n             // Trait+Kx+'a -> Trait+Ky+'b (upcasts).\n-            (&ty::Dynamic(ref data_a, ..), &ty::Dynamic(ref data_b, ..)) => {\n+            (&ty::Dynamic(ref data_a, _, ty::Dyn), &ty::Dynamic(ref data_b, _, ty::Dyn)) => {\n                 // Upcast coercions permit several things:\n                 //\n                 // 1. Dropping auto traits, e.g., `Foo + Send` to `Foo`"}, {"sha": "f132fbc2e40652e1338e769bb6ed0eb31795c2c7", "filename": "compiler/rustc_trait_selection/src/traits/select/confirmation.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs?ref=6e6c49e7ced47224ecf1a9d14f63f9481fc24cce", "patch": "@@ -1145,7 +1145,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 }));\n             }\n \n-            _ => bug!(),\n+            _ => bug!(\"source: {source}, target: {target}\"),\n         };\n \n         Ok(ImplSourceBuiltinData { nested })"}, {"sha": "b4ff8a222866a5ef787467690cbdf91ff85ed567", "filename": "src/test/ui/dyn-star/dont-unsize-coerce-dyn-star.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce/src%2Ftest%2Fui%2Fdyn-star%2Fdont-unsize-coerce-dyn-star.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e6c49e7ced47224ecf1a9d14f63f9481fc24cce/src%2Ftest%2Fui%2Fdyn-star%2Fdont-unsize-coerce-dyn-star.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Fdont-unsize-coerce-dyn-star.rs?ref=6e6c49e7ced47224ecf1a9d14f63f9481fc24cce", "patch": "@@ -0,0 +1,26 @@\n+// check-pass\n+\n+#![feature(dyn_star)]\n+#![allow(incomplete_features)]\n+\n+trait AddOne {\n+    fn add1(&mut self) -> usize;\n+}\n+\n+impl AddOne for usize {\n+    fn add1(&mut self) -> usize {\n+        *self += 1;\n+        *self\n+    }\n+}\n+\n+fn add_one(i: &mut (dyn* AddOne + '_)) -> usize {\n+    i.add1()\n+}\n+\n+fn main() {\n+    let mut x = 42usize as dyn* AddOne;\n+\n+    println!(\"{}\", add_one(&mut x));\n+    println!(\"{}\", add_one(&mut x));\n+}"}]}