{"sha": "4c745d219ffdb445606047fa476159b836209bf7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjNzQ1ZDIxOWZmZGI0NDU2MDYwNDdmYTQ3NjE1OWI4MzYyMDliZjc=", "commit": {"author": {"name": "Zac Pullar-Strecker", "email": "zacmps@gmail.com", "date": "2020-07-31T23:47:27Z"}, "committer": {"name": "Zac Pullar-Strecker", "email": "zacmps@gmail.com", "date": "2020-07-31T23:47:27Z"}, "message": "remove some crates.io deps", "tree": {"sha": "14a1be5c2b902cb97f608ad1a3be97f23fa785d5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/14a1be5c2b902cb97f608ad1a3be97f23fa785d5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c745d219ffdb445606047fa476159b836209bf7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c745d219ffdb445606047fa476159b836209bf7", "html_url": "https://github.com/rust-lang/rust/commit/4c745d219ffdb445606047fa476159b836209bf7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c745d219ffdb445606047fa476159b836209bf7/comments", "author": {"login": "zacps", "id": 9827696, "node_id": "MDQ6VXNlcjk4Mjc2OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/9827696?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zacps", "html_url": "https://github.com/zacps", "followers_url": "https://api.github.com/users/zacps/followers", "following_url": "https://api.github.com/users/zacps/following{/other_user}", "gists_url": "https://api.github.com/users/zacps/gists{/gist_id}", "starred_url": "https://api.github.com/users/zacps/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zacps/subscriptions", "organizations_url": "https://api.github.com/users/zacps/orgs", "repos_url": "https://api.github.com/users/zacps/repos", "events_url": "https://api.github.com/users/zacps/events{/privacy}", "received_events_url": "https://api.github.com/users/zacps/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zacps", "id": 9827696, "node_id": "MDQ6VXNlcjk4Mjc2OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/9827696?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zacps", "html_url": "https://github.com/zacps", "followers_url": "https://api.github.com/users/zacps/followers", "following_url": "https://api.github.com/users/zacps/following{/other_user}", "gists_url": "https://api.github.com/users/zacps/gists{/gist_id}", "starred_url": "https://api.github.com/users/zacps/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zacps/subscriptions", "organizations_url": "https://api.github.com/users/zacps/orgs", "repos_url": "https://api.github.com/users/zacps/repos", "events_url": "https://api.github.com/users/zacps/events{/privacy}", "received_events_url": "https://api.github.com/users/zacps/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fa842c8c9e9fed28a45fe1e3b109f2f902d128c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fa842c8c9e9fed28a45fe1e3b109f2f902d128c", "html_url": "https://github.com/rust-lang/rust/commit/1fa842c8c9e9fed28a45fe1e3b109f2f902d128c"}], "stats": {"total": 133, "additions": 31, "deletions": 102}, "files": [{"sha": "9bd5fac2ddac2b146cca0b3fa7dd1cbc45ec367b", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 84, "changes": 85, "blob_url": "https://github.com/rust-lang/rust/blob/4c745d219ffdb445606047fa476159b836209bf7/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/4c745d219ffdb445606047fa476159b836209bf7/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=4c745d219ffdb445606047fa476159b836209bf7", "patch": "@@ -408,17 +408,6 @@ dependencies = [\n  \"unicode-width\",\n ]\n \n-[[package]]\n-name = \"getrandom\"\n-version = \"0.1.14\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7abc8dd8451921606d809ba32e95b6111925cd2906060d2dcc29c070220503eb\"\n-dependencies = [\n- \"cfg-if\",\n- \"libc\",\n- \"wasi\",\n-]\n-\n [[package]]\n name = \"gimli\"\n version = \"0.22.0\"\n@@ -639,12 +628,6 @@ dependencies = [\n  \"url\",\n ]\n \n-[[package]]\n-name = \"maplit\"\n-version = \"1.0.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"3e2e65a1a2e43cfcb47a895c4c8b10d1f4a61097f9f254f183aee60cad9c651d\"\n-\n [[package]]\n name = \"matchers\"\n version = \"0.0.1\"\n@@ -907,12 +890,6 @@ version = \"0.2.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"b4596b6d070b27117e987119b4dac604f3c58cfb0b191112e24771b2faeac1a6\"\n \n-[[package]]\n-name = \"ppv-lite86\"\n-version = \"0.2.8\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"237a5ed80e274dbc66f86bd59c1e25edc039660be53194b5fe0a482e0f2612ea\"\n-\n [[package]]\n name = \"proc-macro2\"\n version = \"1.0.19\"\n@@ -1105,9 +1082,8 @@ dependencies = [\n  \"expect\",\n  \"indexmap\",\n  \"itertools\",\n- \"lazy_static\",\n  \"log\",\n- \"maplit\",\n+ \"once_cell\",\n  \"oorandom\",\n  \"pulldown-cmark\",\n  \"pulldown-cmark-to-cmark\",\n@@ -1124,11 +1100,9 @@ dependencies = [\n  \"ra_syntax\",\n  \"ra_text_edit\",\n  \"ra_tt\",\n- \"rand\",\n  \"rustc-hash\",\n  \"stdx\",\n  \"test_utils\",\n- \"url\",\n ]\n \n [[package]]\n@@ -1288,57 +1262,6 @@ dependencies = [\n  \"stdx\",\n ]\n \n-[[package]]\n-name = \"rand\"\n-version = \"0.7.3\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"6a6b1679d49b24bbfe0c803429aa1874472f50d9b363131f0e89fc356b544d03\"\n-dependencies = [\n- \"getrandom\",\n- \"libc\",\n- \"rand_chacha\",\n- \"rand_core\",\n- \"rand_hc\",\n- \"rand_pcg\",\n-]\n-\n-[[package]]\n-name = \"rand_chacha\"\n-version = \"0.2.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f4c8ed856279c9737206bf725bf36935d8666ead7aa69b52be55af369d193402\"\n-dependencies = [\n- \"ppv-lite86\",\n- \"rand_core\",\n-]\n-\n-[[package]]\n-name = \"rand_core\"\n-version = \"0.5.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"90bde5296fc891b0cef12a6d03ddccc162ce7b2aff54160af9338f8d40df6d19\"\n-dependencies = [\n- \"getrandom\",\n-]\n-\n-[[package]]\n-name = \"rand_hc\"\n-version = \"0.2.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ca3129af7b92a17112d59ad498c6f81eaf463253766b90396d39ea7a39d6613c\"\n-dependencies = [\n- \"rand_core\",\n-]\n-\n-[[package]]\n-name = \"rand_pcg\"\n-version = \"0.2.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"16abd0c1b639e9eb4d7c50c0b8100b0d0f849be2349829c740fe8e6eb4816429\"\n-dependencies = [\n- \"rand_core\",\n-]\n-\n [[package]]\n name = \"rayon\"\n version = \"1.3.1\"\n@@ -1923,12 +1846,6 @@ dependencies = [\n  \"winapi-util\",\n ]\n \n-[[package]]\n-name = \"wasi\"\n-version = \"0.9.0+wasi-snapshot-preview1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"cccddf32554fecc6acb585f82a32a72e28b48f8c4c1883ddfeeeaa96f7d8e519\"\n-\n [[package]]\n name = \"winapi\"\n version = \"0.2.8\""}, {"sha": "6d5c9daf574c25d13c17f39a1777d947d8d71835", "filename": "crates/ra_ide/Cargo.toml", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4c745d219ffdb445606047fa476159b836209bf7/crates%2Fra_ide%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/4c745d219ffdb445606047fa476159b836209bf7/crates%2Fra_ide%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2FCargo.toml?ref=4c745d219ffdb445606047fa476159b836209bf7", "patch": "@@ -17,13 +17,11 @@ indexmap = \"1.3.2\"\n itertools = \"0.9.0\"\n log = \"0.4.8\"\n rustc-hash = \"1.1.0\"\n-rand = { version = \"0.7.3\", features = [\"small_rng\"] }\n url = \"*\"\n-maplit = \"*\"\n-lazy_static = \"*\"\n pulldown-cmark-to-cmark = \"4.0.2\"\n pulldown-cmark = \"0.7.0\"\n oorandom = \"11.1.2\"\n+once_cell = \"1\"\n \n stdx = { path = \"../stdx\" }\n "}, {"sha": "1531aca2ea407486eee7e0409a7fd3b91340c26a", "filename": "crates/ra_ide/src/hover.rs", "status": "modified", "additions": 29, "deletions": 15, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/4c745d219ffdb445606047fa476159b836209bf7/crates%2Fra_ide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c745d219ffdb445606047fa476159b836209bf7/crates%2Fra_ide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fhover.rs?ref=4c745d219ffdb445606047fa476159b836209bf7", "patch": "@@ -1,14 +1,16 @@\n use std::collections::{HashMap, HashSet};\n-use std::iter::once;\n+use std::{\n+    iter::{once, FromIterator},\n+    sync::Mutex,\n+};\n \n use hir::{\n     db::DefDatabase, Adt, AsAssocItem, AsName, AssocItemContainer, AttrDef, Crate, Documentation,\n     FieldSource, HasSource, HirDisplay, Hygiene, ItemInNs, ModPath, Module, ModuleDef,\n     ModuleSource, Semantics,\n };\n use itertools::Itertools;\n-use lazy_static::lazy_static;\n-use maplit::{hashmap, hashset};\n+use once_cell::sync::Lazy;\n use pulldown_cmark::{CowStr, Event, Options, Parser, Tag};\n use pulldown_cmark_to_cmark::cmark;\n use ra_db::SourceDatabase;\n@@ -419,14 +421,26 @@ enum Namespace {\n     Macros,\n }\n \n-lazy_static!(\n-    /// Map of namespaces to identifying prefixes and suffixes as defined by RFC1946.\n-    static ref NS_MAP: HashMap<Namespace, (HashSet<&'static str>, HashSet<&'static str>)> = hashmap!{\n-        Namespace::Types => (hashset!{\"type\", \"struct\", \"enum\", \"mod\", \"trait\", \"union\", \"module\"}, hashset!{}),\n-        Namespace::Values => (hashset!{\"value\", \"function\", \"fn\", \"method\", \"const\", \"static\", \"mod\", \"module\"}, hashset!{\"()\"}),\n-        Namespace::Macros => (hashset!{\"macro\"}, hashset!{\"!\"})\n-    };\n-);\n+static NS_MAP: Lazy<\n+    HashMap<Namespace, (HashSet<&'static &'static str>, HashSet<&'static &'static str>)>,\n+> = Lazy::new(|| {\n+    let mut map = HashMap::new();\n+    map.insert(Namespace::Types, (HashSet::new(), HashSet::new()));\n+    map.insert(\n+        Namespace::Values,\n+        (\n+            HashSet::from_iter(\n+                [\"value\", \"function\", \"fn\", \"method\", \"const\", \"static\", \"mod\", \"module\"].iter(),\n+            ),\n+            HashSet::from_iter([\"()\"].iter()),\n+        ),\n+    );\n+    map.insert(\n+        Namespace::Macros,\n+        (HashSet::from_iter([\"macro\"].iter()), HashSet::from_iter([\"!\"].iter())),\n+    );\n+    map\n+});\n \n impl Namespace {\n     /// Extract the specified namespace from an intra-doc-link if one exists.\n@@ -437,7 +451,7 @@ impl Namespace {\n                 prefixes\n                     .iter()\n                     .map(|prefix| {\n-                        s.starts_with(prefix)\n+                        s.starts_with(*prefix)\n                             && s.chars()\n                                 .nth(prefix.len() + 1)\n                                 .map(|c| c == '@' || c == ' ')\n@@ -447,7 +461,7 @@ impl Namespace {\n                     || suffixes\n                         .iter()\n                         .map(|suffix| {\n-                            s.starts_with(suffix)\n+                            s.starts_with(*suffix)\n                                 && s.chars()\n                                     .nth(suffix.len() + 1)\n                                     .map(|c| c == '@' || c == ' ')\n@@ -464,8 +478,8 @@ impl Namespace {\n fn strip_prefixes_suffixes(mut s: &str) -> &str {\n     s = s.trim_matches('`');\n     NS_MAP.iter().for_each(|(_, (prefixes, suffixes))| {\n-        prefixes.iter().for_each(|prefix| s = s.trim_start_matches(prefix));\n-        suffixes.iter().for_each(|suffix| s = s.trim_end_matches(suffix));\n+        prefixes.iter().for_each(|prefix| s = s.trim_start_matches(*prefix));\n+        suffixes.iter().for_each(|suffix| s = s.trim_end_matches(*suffix));\n     });\n     s.trim_start_matches(\"@\").trim()\n }"}]}