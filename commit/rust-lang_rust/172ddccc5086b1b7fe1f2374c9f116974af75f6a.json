{"sha": "172ddccc5086b1b7fe1f2374c9f116974af75f6a", "node_id": "C_kwDOAAsO6NoAKDE3MmRkY2NjNTA4NmIxYjdmZTFmMjM3NGM5ZjExNjk3NGFmNzVmNmE", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-05-08T06:09:23Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-08T06:09:23Z"}, "message": "Rollup merge of #111323 - jyn514:shim-error, r=Mark-Simulacrum\n\nGive a more helpful error when running the rustc shim directly\n\ncc https://rust-lang.zulipchat.com/#narrow/stream/326414-t-infra.2Fbootstrap/topic/Building.20.60coretests.60.20by.20hand", "tree": {"sha": "5379e342cdfc0cf9e4881c22c8d2efbd83247b28", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5379e342cdfc0cf9e4881c22c8d2efbd83247b28"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/172ddccc5086b1b7fe1f2374c9f116974af75f6a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkWJITCRBK7hj4Ov3rIwAAG8QIAACmwoNqjPdeFFS1LqygTU/J\nYaWoBidRmNWaG9IQCm91eSP0cgIvRgEiCZA1Vmy6qVECTg+mM+oopXGcsUgW+Hjf\nAxCTJhdKbTrCkmirbGDcdmIjMKQ29e64S/Kxx9HGxVmqAZTeigYZCebGcyWqcyNQ\nOEzKCY8xHZRSMgdBgH1dl5WoKEZTGgKdTmgQ6mZbwemoeKyRfEG2AhDz1Qhn14lQ\nJlT2vpljJP50fZNs/JuV6f3QsmBNzayzb/MqMlj5FMOouHzENB/q9yiaecdfnbZG\nEJcgmS3vtr4K5M/IuUu5VjXz/ZAoYlItKG/PAk1Ag9NeugPI1CxDtHRXDfBN1Go=\n=Eyxa\n-----END PGP SIGNATURE-----\n", "payload": "tree 5379e342cdfc0cf9e4881c22c8d2efbd83247b28\nparent 940567068c2da9eceec21239e7aad75ad20b0b4e\nparent 654f56e086fad836da5931e1a3defad804d9cfe9\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1683526163 +0530\ncommitter GitHub <noreply@github.com> 1683526163 +0530\n\nRollup merge of #111323 - jyn514:shim-error, r=Mark-Simulacrum\n\nGive a more helpful error when running the rustc shim directly\n\ncc https://rust-lang.zulipchat.com/#narrow/stream/326414-t-infra.2Fbootstrap/topic/Building.20.60coretests.60.20by.20hand\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/172ddccc5086b1b7fe1f2374c9f116974af75f6a", "html_url": "https://github.com/rust-lang/rust/commit/172ddccc5086b1b7fe1f2374c9f116974af75f6a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/172ddccc5086b1b7fe1f2374c9f116974af75f6a/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "940567068c2da9eceec21239e7aad75ad20b0b4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/940567068c2da9eceec21239e7aad75ad20b0b4e", "html_url": "https://github.com/rust-lang/rust/commit/940567068c2da9eceec21239e7aad75ad20b0b4e"}, {"sha": "654f56e086fad836da5931e1a3defad804d9cfe9", "url": "https://api.github.com/repos/rust-lang/rust/commits/654f56e086fad836da5931e1a3defad804d9cfe9", "html_url": "https://github.com/rust-lang/rust/commit/654f56e086fad836da5931e1a3defad804d9cfe9"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "e87125a49a6a048a8d4270264472ec1b13f22ceb", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/172ddccc5086b1b7fe1f2374c9f116974af75f6a/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/172ddccc5086b1b7fe1f2374c9f116974af75f6a/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=172ddccc5086b1b7fe1f2374c9f116974af75f6a", "patch": "@@ -19,7 +19,7 @@ include!(\"../dylib_util.rs\");\n \n use std::env;\n use std::path::PathBuf;\n-use std::process::{Child, Command};\n+use std::process::{exit, Child, Command};\n use std::str::FromStr;\n use std::time::Instant;\n \n@@ -47,7 +47,12 @@ fn main() {\n     } else {\n         (\"RUSTC_REAL\", \"RUSTC_LIBDIR\")\n     };\n-    let stage = env::var(\"RUSTC_STAGE\").expect(\"RUSTC_STAGE was not set\");\n+    let stage = env::var(\"RUSTC_STAGE\").unwrap_or_else(|_| {\n+        // Don't panic here; it's reasonable to try and run these shims directly. Give a helpful error instead.\n+        eprintln!(\"rustc shim: fatal: RUSTC_STAGE was not set\");\n+        eprintln!(\"rustc shim: note: use `x.py build -vvv` to see all environment variables set by bootstrap\");\n+        exit(101);\n+    });\n     let sysroot = env::var_os(\"RUSTC_SYSROOT\").expect(\"RUSTC_SYSROOT was not set\");\n     let on_fail = env::var_os(\"RUSTC_ON_FAIL\").map(Command::new);\n "}, {"sha": "d2b85f7a6297b90caeb1e0c498600b3152e9dfac", "filename": "src/bootstrap/bin/rustdoc.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/172ddccc5086b1b7fe1f2374c9f116974af75f6a/src%2Fbootstrap%2Fbin%2Frustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/172ddccc5086b1b7fe1f2374c9f116974af75f6a/src%2Fbootstrap%2Fbin%2Frustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustdoc.rs?ref=172ddccc5086b1b7fe1f2374c9f116974af75f6a", "patch": "@@ -5,13 +5,18 @@\n use std::env;\n use std::ffi::OsString;\n use std::path::PathBuf;\n-use std::process::Command;\n+use std::process::{exit, Command};\n \n include!(\"../dylib_util.rs\");\n \n fn main() {\n     let args = env::args_os().skip(1).collect::<Vec<_>>();\n-    let stage = env::var(\"RUSTC_STAGE\").expect(\"RUSTC_STAGE was not set\");\n+    let stage = env::var(\"RUSTC_STAGE\").unwrap_or_else(|_| {\n+        // Don't panic here; it's reasonable to try and run these shims directly. Give a helpful error instead.\n+        eprintln!(\"rustc shim: fatal: RUSTC_STAGE was not set\");\n+        eprintln!(\"rustc shim: note: use `x.py build -vvv` to see all environment variables set by bootstrap\");\n+        exit(101);\n+    });\n     let rustdoc = env::var_os(\"RUSTDOC_REAL\").expect(\"RUSTDOC_REAL was not set\");\n     let libdir = env::var_os(\"RUSTDOC_LIBDIR\").expect(\"RUSTDOC_LIBDIR was not set\");\n     let sysroot = env::var_os(\"RUSTC_SYSROOT\").expect(\"RUSTC_SYSROOT was not set\");"}]}