{"sha": "c83ddaef948e5aadf3e64169dd3ab4268834fbff", "node_id": "C_kwDOAAsO6NoAKGM4M2RkYWVmOTQ4ZTVhYWRmM2U2NDE2OWRkM2FiNDI2ODgzNGZiZmY", "commit": {"author": {"name": "Albert Larsan", "email": "74931857+albertlarsan68@users.noreply.github.com", "date": "2022-10-13T08:20:39Z"}, "committer": {"name": "Albert Larsan", "email": "74931857+albertlarsan68@users.noreply.github.com", "date": "2022-10-31T07:33:24Z"}, "message": "Add better python discovery\n\n`x.ps1` and `x` will now search for python executables like `python3.9`\nand `python3.10.exe`", "tree": {"sha": "fd04346a5e9a8dc8af7516a47b0b13d1e89dedad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd04346a5e9a8dc8af7516a47b0b13d1e89dedad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c83ddaef948e5aadf3e64169dd3ab4268834fbff", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEECtuvMkQcAKCG3qpZknCbiLuPE+oFAmNfeo0ACgkQknCbiLuP\nE+obZhAAjfrYOlzKhhma36bwhzJEtrlBN70wdl4+6fr2RBkKE1bprlXb3z9tIb/l\n0sIKSmMGe2XGDctfC2YIlpkeqPWKSJxrehmcPMfwbKyYdHUpj9v1n+4s4p2N1xyt\n6MWz64hFk8eAwg5DnXvXLDJ9NkRTlDgg/fou21roRQvDUstkYdr/sDAiaHDegr3p\nXrNf0IqeDSy68lvzC6/QkEoVzbzvt6/pWEkoeD454Nx+ul07699aJCwcnsVWW7Lc\nqDUXH845Ct9RSpfHXXqTudBi0hkrHV/AWwD9RsNARobRh+TRM8hsTDiw1l4uSdIp\nX75qfH0zybZ/GdUe4XuemJPvzUeZHTWUodQHKe5lu1RfIWEpQWIuEcDpKDT+XD7v\n0ILN7Ahz9vrWW/spDWffKO4xeoBXTS0E6g1XsMMFsoiqeUxs+7scZu6yLapx69cW\nNuvxVRzQn6Ey770TV9jmYmsyno1jqlb2ByqZPW3LNEof06sI7LDJDg9R25EQlq7b\nIP8QhmvlA8z0cjVHDMvE0nVGU8K3yafNrp741GWGbcmRM4J/hwqszwlY6Kv8K/L+\nxkd0sbHLfDIVr3WHZkglvltMZiZh577K+9y0iUgI1gqft4PZXKAwLhk9g5Bkb1ZN\njKFtOgQKlIbIDWXp4b1YkMmoMc3wqeGZSh9RhoK2siAp53jGCck=\n=cT0V\n-----END PGP SIGNATURE-----", "payload": "tree fd04346a5e9a8dc8af7516a47b0b13d1e89dedad\nparent 4596f4f8b565bdd02d3b99d1ab12ff09146a93de\nauthor Albert Larsan <74931857+albertlarsan68@users.noreply.github.com> 1665649239 +0200\ncommitter Albert Larsan <74931857+albertlarsan68@users.noreply.github.com> 1667201604 +0100\n\nAdd better python discovery\n\n`x.ps1` and `x` will now search for python executables like `python3.9`\nand `python3.10.exe`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c83ddaef948e5aadf3e64169dd3ab4268834fbff", "html_url": "https://github.com/rust-lang/rust/commit/c83ddaef948e5aadf3e64169dd3ab4268834fbff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c83ddaef948e5aadf3e64169dd3ab4268834fbff/comments", "author": {"login": "albertlarsan68", "id": 74931857, "node_id": "MDQ6VXNlcjc0OTMxODU3", "avatar_url": "https://avatars.githubusercontent.com/u/74931857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertlarsan68", "html_url": "https://github.com/albertlarsan68", "followers_url": "https://api.github.com/users/albertlarsan68/followers", "following_url": "https://api.github.com/users/albertlarsan68/following{/other_user}", "gists_url": "https://api.github.com/users/albertlarsan68/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertlarsan68/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertlarsan68/subscriptions", "organizations_url": "https://api.github.com/users/albertlarsan68/orgs", "repos_url": "https://api.github.com/users/albertlarsan68/repos", "events_url": "https://api.github.com/users/albertlarsan68/events{/privacy}", "received_events_url": "https://api.github.com/users/albertlarsan68/received_events", "type": "User", "site_admin": false}, "committer": {"login": "albertlarsan68", "id": 74931857, "node_id": "MDQ6VXNlcjc0OTMxODU3", "avatar_url": "https://avatars.githubusercontent.com/u/74931857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertlarsan68", "html_url": "https://github.com/albertlarsan68", "followers_url": "https://api.github.com/users/albertlarsan68/followers", "following_url": "https://api.github.com/users/albertlarsan68/following{/other_user}", "gists_url": "https://api.github.com/users/albertlarsan68/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertlarsan68/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertlarsan68/subscriptions", "organizations_url": "https://api.github.com/users/albertlarsan68/orgs", "repos_url": "https://api.github.com/users/albertlarsan68/repos", "events_url": "https://api.github.com/users/albertlarsan68/events{/privacy}", "received_events_url": "https://api.github.com/users/albertlarsan68/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4596f4f8b565bdd02d3b99d1ab12ff09146a93de", "url": "https://api.github.com/repos/rust-lang/rust/commits/4596f4f8b565bdd02d3b99d1ab12ff09146a93de", "html_url": "https://github.com/rust-lang/rust/commit/4596f4f8b565bdd02d3b99d1ab12ff09146a93de"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "4309b82627c9c47917df4ef29c9ef8c4a3020544", "filename": "x", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c83ddaef948e5aadf3e64169dd3ab4268834fbff/x", "raw_url": "https://github.com/rust-lang/rust/raw/c83ddaef948e5aadf3e64169dd3ab4268834fbff/x", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/x?ref=c83ddaef948e5aadf3e64169dd3ab4268834fbff", "patch": "@@ -29,5 +29,11 @@ for SEARCH_PYTHON in py python3 python python2; do\n         exec \"$python\" $extra_arg \"$xpy\" \"$@\"\n     fi\n done\n+\n+python=$(bash -c \"compgen -c python\" | grep '^python[2-3]\\.[0-9]\\+$' | head -n1)\n+if ! [ \"$python\" = \"\" ]; then\n+    exec \"$python\" \"$xpy\" \"$@\"\n+fi\n+\n echo \"$0: error: did not find python installed\" >&2\n exit 1"}, {"sha": "81b98919f436cdad411ed6f3c8c55a4180382720", "filename": "x.ps1", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c83ddaef948e5aadf3e64169dd3ab4268834fbff/x.ps1", "raw_url": "https://github.com/rust-lang/rust/raw/c83ddaef948e5aadf3e64169dd3ab4268834fbff/x.ps1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/x.ps1?ref=c83ddaef948e5aadf3e64169dd3ab4268834fbff", "patch": "@@ -10,11 +10,15 @@ foreach ($arg in $args) {\n     $xpy_args += \"\"\"$arg\"\"\"\n }\n \n+function Get-Application($app) {\n+    return Get-Command $app -ErrorAction SilentlyContinue -CommandType Application\n+}\n+\n foreach ($python in \"py\", \"python3\", \"python\", \"python2\") {\n     # NOTE: this only tests that the command exists in PATH, not that it's actually\n     # executable. The latter is not possible in a portable way, see\n     # https://github.com/PowerShell/PowerShell/issues/12625.\n-    if (Get-Command $python -ErrorAction SilentlyContinue) {\n+    if (Get-Application $python) {\n         if ($python -eq \"py\") {\n             # Use python3, not python2\n             $xpy_args = @(\"-3\") + $xpy_args\n@@ -24,5 +28,12 @@ foreach ($python in \"py\", \"python3\", \"python\", \"python2\") {\n     }\n }\n \n+$found = (Get-Application \"python*\" | Where-Object {$_.name -match '^python[2-3]\\.[0-9]+(\\.exe)?$'})\n+if (($null -ne $found) -and ($found.Length -ge 1)) {\n+    $python = $found[0]\n+    $process = Start-Process -NoNewWindow -Wait -PassThru $python $xpy_args\n+    Exit $process.ExitCode\n+}\n+\n Write-Error \"${PSCommandPath}: error: did not find python installed\"\n Exit 1"}]}