{"sha": "7f834c5c075afdda7cb493ba75b54dbe950e5b51", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmODM0YzVjMDc1YWZkZGE3Y2I0OTNiYTc1YjU0ZGJlOTUwZTViNTE=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-09-04T11:10:22Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-09-04T11:10:32Z"}, "message": "Update clients of path.rs to use new API.\n\nIn most cases this involved removing a ~str allocations or clones\n(yay), or coercing a ~str to a slice.  In a few places, I had to bind\nan intermediate Path (e.g. path.pop() return values), so that it would\nlive long enough to support the borrowed &str.\n\nAnd in a few places, where the code was actively using the property\nthat the old API returned ~str's, I had to put in to_owned() or\nclone(); but in those cases, we're trading an allocation within the\npath.rs code for one in the client code, so they neutralize each\nother.", "tree": {"sha": "3ec136c0278066dd19afefc456da14402d7cc81c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ec136c0278066dd19afefc456da14402d7cc81c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f834c5c075afdda7cb493ba75b54dbe950e5b51", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f834c5c075afdda7cb493ba75b54dbe950e5b51", "html_url": "https://github.com/rust-lang/rust/commit/7f834c5c075afdda7cb493ba75b54dbe950e5b51", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f834c5c075afdda7cb493ba75b54dbe950e5b51/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f3c87e26e2a3583278a07e032ffc476b60cacc7", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f3c87e26e2a3583278a07e032ffc476b60cacc7", "html_url": "https://github.com/rust-lang/rust/commit/0f3c87e26e2a3583278a07e032ffc476b60cacc7"}], "stats": {"total": 50, "additions": 27, "deletions": 23}, "files": [{"sha": "df0462203a9eba30db3d3c11760f73fa3cfc716e", "filename": "src/compiletest/compiletest.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Fcompiletest%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Fcompiletest%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fcompiletest.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -307,8 +307,9 @@ pub fn make_test_name(config: &config, testfile: &Path) -> test::TestName {\n     // Try to elide redundant long paths\n     fn shorten(path: &Path) -> ~str {\n         let filename = path.filename();\n-        let dir = path.pop().filename();\n-        fmt!(\"%s/%s\", dir.unwrap_or_default(~\"\"), filename.unwrap_or_default(~\"\"))\n+        let p = path.pop();\n+        let dir = p.filename();\n+        fmt!(\"%s/%s\", dir.unwrap_or_default(\"\"), filename.unwrap_or_default(\"\"))\n     }\n \n     test::DynTestName(fmt!(\"[%s] %s\","}, {"sha": "6e2f62f870695821014f0e8a11b380d40205c4d0", "filename": "src/compiletest/runtest.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -880,7 +880,7 @@ fn _arm_push_aux_shared_library(config: &config, testfile: &Path) {\n     let dirs = os::list_dir_path(&Path(tstr));\n     for file in dirs.iter() {\n \n-        if (file.filetype() == Some(~\".so\")) {\n+        if (file.filetype() == Some(\".so\")) {\n \n             let copy_result = procsrv::run(\"\", config.adb_path,\n                 [~\"push\", file.to_str(), config.adb_test_dir.clone()],"}, {"sha": "b44fb100000d6fadb7630456eed317a79d9b74b9", "filename": "src/librust/rust.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrust%2Frust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrust%2Frust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrust%2Frust.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -162,7 +162,8 @@ fn cmd_help(args: &[~str]) -> ValidUsage {\n fn cmd_test(args: &[~str]) -> ValidUsage {\n     match args {\n         [ref filename] => {\n-            let test_exec = Path(*filename).filestem().unwrap() + \"test~\";\n+            let p = Path(*filename);\n+            let test_exec = p.filestem().unwrap() + \"test~\";\n             invoke(\"rustc\", &[~\"--test\", filename.to_owned(),\n                               ~\"-o\", test_exec.to_owned()], rustc::main_args);\n             let exit_code = run::process_status(~\"./\" + test_exec, []);\n@@ -175,7 +176,8 @@ fn cmd_test(args: &[~str]) -> ValidUsage {\n fn cmd_run(args: &[~str]) -> ValidUsage {\n     match args {\n         [ref filename, ..prog_args] => {\n-            let exec = Path(*filename).filestem().unwrap() + \"~\";\n+            let p = Path(*filename);\n+            let exec = p.filestem().unwrap() + \"~\";\n             invoke(\"rustc\", &[filename.to_owned(), ~\"-o\", exec.to_owned()],\n                    rustc::main_args);\n             let exit_code = run::process_status(~\"./\"+exec, prog_args);"}, {"sha": "6d7065c8f32cf708fefd826403a3e490fddf6040", "filename": "src/librustc/back/link.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Flink.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -948,13 +948,13 @@ pub fn link_args(sess: Session,\n     let cstore = sess.cstore;\n     let r = cstore::get_used_crate_files(cstore);\n     for cratepath in r.iter() {\n-        if cratepath.filetype() == Some(~\".rlib\") {\n+        if cratepath.filetype() == Some(\".rlib\") {\n             args.push(cratepath.to_str());\n             loop;\n         }\n         let dir = cratepath.dirname();\n         if dir != ~\"\" { args.push(~\"-L\" + dir); }\n-        let libarg = unlib(sess.targ_cfg, cratepath.filestem().unwrap());\n+        let libarg = unlib(sess.targ_cfg, cratepath.filestem().unwrap().to_owned());\n         args.push(~\"-l\" + libarg);\n     }\n "}, {"sha": "984527eb56a0efec98a9adc6d61a7f18064b73d6", "filename": "src/librustpkg/installed_packages.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Finstalled_packages.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Finstalled_packages.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Finstalled_packages.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -19,7 +19,8 @@ pub fn list_installed_packages(f: &fn(&PkgId) -> bool) -> bool  {\n     for p in workspaces.iter() {\n         let binfiles = os::list_dir(&p.push(\"bin\"));\n         for exec in binfiles.iter() {\n-            let exec_path = Path(*exec).filestem();\n+            let p = Path(*exec);\n+            let exec_path = p.filestem();\n             do exec_path.iter().advance |s| {\n                 f(&PkgId::new(*s))\n             };\n@@ -49,8 +50,8 @@ pub fn has_library(p: &Path) -> Option<~str> {\n     let files = os::list_dir(p);\n     for q in files.iter() {\n         let as_path = Path(*q);\n-        if as_path.filetype() == Some(os::consts::DLL_SUFFIX.to_owned()) {\n-            let stuff : ~str = as_path.filestem().expect(\"has_library: weird path\");\n+        if as_path.filetype() == Some(os::consts::DLL_SUFFIX) {\n+            let stuff : &str = as_path.filestem().expect(\"has_library: weird path\");\n             let mut stuff2 = stuff.split_str_iter(&\"-\");\n             let stuff3: ~[&str] = stuff2.collect();\n             // argh"}, {"sha": "ce1da58a2cb87441b654baf3ee3e32edb82712d2", "filename": "src/librustpkg/package_id.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Fpackage_id.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Fpackage_id.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fpackage_id.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -68,7 +68,7 @@ impl PkgId {\n         if path.components.len() < 1 {\n             return cond.raise((path, ~\"0-length pkgid\"));\n         }\n-        let short_name = path.clone().filestem().expect(fmt!(\"Strange path! %s\", s));\n+        let short_name = path.filestem().expect(fmt!(\"Strange path! %s\", s));\n \n         let version = match given_version {\n             Some(v) => v,\n@@ -83,8 +83,8 @@ impl PkgId {\n \n         debug!(\"path = %s\", path.to_str());\n         PkgId {\n-            path: path,\n-            short_name: short_name,\n+            path: path.clone(),\n+            short_name: short_name.to_owned(),\n             version: version\n         }\n     }"}, {"sha": "27a22a852a92ffdc12bda38a9b9d155d880677fe", "filename": "src/librustpkg/package_source.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Fpackage_source.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Fpackage_source.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fpackage_source.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -118,7 +118,7 @@ impl PkgSrc {\n             return Some(local);\n         }\n \n-        if (self.id.path.clone()).components().len() < 2 {\n+        if self.id.path.components().len() < 2 {\n             // If a non-URL, don't bother trying to fetch\n             return None;\n         }\n@@ -156,7 +156,7 @@ impl PkgSrc {\n \n     /// True if the given path's stem is self's pkg ID's stem\n     fn stem_matches(&self, p: &Path) -> bool {\n-        p.filestem().map_default(false, |p| { p == &self.id.short_name })\n+        p.filestem().map_default(false, |p| { p == &self.id.short_name.as_slice() })\n     }\n \n     fn push_crate(cs: &mut ~[Crate], prefix: uint, p: &Path) {\n@@ -181,10 +181,10 @@ impl PkgSrc {\n         do os::walk_dir(&dir) |pth| {\n             let maybe_known_crate_set = match pth.filename() {\n                 Some(filename) => match filename {\n-                    ~\"lib.rs\" => Some(&mut self.libs),\n-                    ~\"main.rs\" => Some(&mut self.mains),\n-                    ~\"test.rs\" => Some(&mut self.tests),\n-                    ~\"bench.rs\" => Some(&mut self.benchs),\n+                    \"lib.rs\" => Some(&mut self.libs),\n+                    \"main.rs\" => Some(&mut self.mains),\n+                    \"test.rs\" => Some(&mut self.tests),\n+                    \"bench.rs\" => Some(&mut self.benchs),\n                     _ => None\n                 },\n                 _ => None"}, {"sha": "cbe6c8f65c4326cf71d88bbed39e26184a6760ab", "filename": "src/librustpkg/path_util.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Fpath_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Fpath_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fpath_util.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -234,14 +234,14 @@ pub fn library_in_workspace(path: &Path, short_name: &str, where: Target,\n                                Some(j) => {\n                                    debug!(\"Maybe %s equals %s\", f_name.slice(0, j), lib_prefix);\n                                    if f_name.slice(0, j) == lib_prefix {\n-                                       result_filename = Some(p_path);\n+                                       result_filename = Some(p_path.clone());\n                                    }\n                                    break;\n                                }\n                                None => break\n                            }\n                        }\n-                       _ => { f_name = f_name.slice(0, i).to_owned(); }\n+                       _ => { f_name = f_name.slice(0, i); }\n                  }\n                }\n                None => break"}, {"sha": "5226036802eb227521e5da86fbf77d55b24f4889", "filename": "src/librustpkg/tests.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f834c5c075afdda7cb493ba75b54dbe950e5b51/src%2Flibrustpkg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Ftests.rs?ref=7f834c5c075afdda7cb493ba75b54dbe950e5b51", "patch": "@@ -396,7 +396,7 @@ fn touch_source_file(workspace: &Path, pkgid: &PkgId) {\n     let pkg_src_dir = workspace.push(\"src\").push(pkgid.to_str());\n     let contents = os::list_dir_path(&pkg_src_dir);\n     for p in contents.iter() {\n-        if p.filetype() == Some(~\".rs\") {\n+        if p.filetype() == Some(\".rs\") {\n             // should be able to do this w/o a process\n             if run::process_output(\"touch\", [p.to_str()]).status != 0 {\n                 let _ = cond.raise((pkg_src_dir.clone(), ~\"Bad path\"));\n@@ -413,7 +413,7 @@ fn frob_source_file(workspace: &Path, pkgid: &PkgId) {\n     let contents = os::list_dir_path(&pkg_src_dir);\n     let mut maybe_p = None;\n     for p in contents.iter() {\n-        if p.filetype() == Some(~\".rs\") {\n+        if p.filetype() == Some(\".rs\") {\n             maybe_p = Some(p);\n             break;\n         }"}]}