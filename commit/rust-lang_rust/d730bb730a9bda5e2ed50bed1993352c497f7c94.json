{"sha": "d730bb730a9bda5e2ed50bed1993352c497f7c94", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3MzBiYjczMGE5YmRhNWUyZWQ1MGJlZDE5OTMzNTJjNDk3ZjdjOTQ=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-06-28T14:38:14Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-06-28T16:00:05Z"}, "message": "Make it possible to use * to dereference a resource", "tree": {"sha": "43aceb6182f3c364ef3f9ea855f88fcb73e4ea00", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/43aceb6182f3c364ef3f9ea855f88fcb73e4ea00"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d730bb730a9bda5e2ed50bed1993352c497f7c94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d730bb730a9bda5e2ed50bed1993352c497f7c94", "html_url": "https://github.com/rust-lang/rust/commit/d730bb730a9bda5e2ed50bed1993352c497f7c94", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d730bb730a9bda5e2ed50bed1993352c497f7c94/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b3443eb049d6ebcadb388f90496132cb065baed2", "url": "https://api.github.com/repos/rust-lang/rust/commits/b3443eb049d6ebcadb388f90496132cb065baed2", "html_url": "https://github.com/rust-lang/rust/commit/b3443eb049d6ebcadb388f90496132cb065baed2"}], "stats": {"total": 25, "additions": 16, "deletions": 9}, "files": [{"sha": "6f2c4ea837b5b527389943f265da9336e07439fa", "filename": "src/comp/middle/alias.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d730bb730a9bda5e2ed50bed1993352c497f7c94/src%2Fcomp%2Fmiddle%2Falias.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d730bb730a9bda5e2ed50bed1993352c497f7c94/src%2Fcomp%2Fmiddle%2Falias.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Falias.rs?ref=d730bb730a9bda5e2ed50bed1993352c497f7c94", "patch": "@@ -544,10 +544,14 @@ fn expr_root(&ctx cx, @ast::expr ex, bool autoderef) ->\n                     auto base_t = ty::expr_ty(*cx.tcx, base);\n                     alt (ty::struct(*cx.tcx, base_t)) {\n                         case (ty::ty_box(?mt)) {\n-                            vec::push(ds,\n-                                      rec(mut=mt.mut != ast::imm,\n-                                          kind=unbox,\n-                                          outer_t=base_t));\n+                            vec::push(ds, rec(mut=mt.mut != ast::imm,\n+                                              kind=unbox,\n+                                              outer_t=base_t));\n+                        }\n+                        case (ty::ty_res(_, ?inner)) {\n+                            vec::push(ds, rec(mut=false,\n+                                              kind=unbox,\n+                                              outer_t=base_t));\n                         }\n                     }\n                     ex = base;"}, {"sha": "9ab2662af22ef7e6387166a353ad1c78b92ebe90", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d730bb730a9bda5e2ed50bed1993352c497f7c94/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d730bb730a9bda5e2ed50bed1993352c497f7c94/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=d730bb730a9bda5e2ed50bed1993352c497f7c94", "patch": "@@ -4511,8 +4511,7 @@ fn trans_for_each(&@block_ctxt cx, &@ast::local local, &@ast::expr seq,\n             cx.build.Store(llenvblobptr, env_cell);\n             // log \"lliterbody: \" + val_str(lcx.ccx.tn, lliterbody);\n \n-            r =\n-                trans_call(cx, f, some[ValueRef](cx.build.Load(pair)), args,\n+            r = trans_call(cx, f, some[ValueRef](cx.build.Load(pair)), args,\n                            seq.id);\n             ret rslt(r.bcx, C_nil());\n         }\n@@ -4993,9 +4992,12 @@ fn trans_lval(&@block_ctxt cx, &@ast::expr e) -> lval_result {\n         case (ast::expr_unary(?unop, ?base)) {\n             assert (unop == ast::deref);\n             auto sub = trans_expr(cx, base);\n-            auto val =\n-                sub.bcx.build.GEP(sub.val,\n-                                  [C_int(0), C_int(abi::box_rc_field_body)]);\n+            auto t = ty::expr_ty(cx.fcx.lcx.ccx.tcx, base);\n+            auto offset = alt (ty::struct(cx.fcx.lcx.ccx.tcx, t)) {\n+                case (ty::ty_box(_)) { abi::box_rc_field_body }\n+                case (ty::ty_res(_, _)) { 1 }\n+            };\n+            auto val = sub.bcx.build.GEP(sub.val, [C_int(0), C_int(offset)]);\n             ret lval_mem(sub.bcx, val);\n         }\n         case (ast::expr_self_method(?ident)) {"}, {"sha": "faed0b04022acf2d6fce13efa831aa1e9bc92083", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d730bb730a9bda5e2ed50bed1993352c497f7c94/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d730bb730a9bda5e2ed50bed1993352c497f7c94/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=d730bb730a9bda5e2ed50bed1993352c497f7c94", "patch": "@@ -1526,6 +1526,7 @@ fn check_expr(&@fn_ctxt fcx, &@ast::expr expr) {\n                 case (ast::deref) {\n                     alt (structure_of(fcx, expr.span, oper_t)) {\n                         case (ty::ty_box(?inner)) { oper_t = inner.ty; }\n+                        case (ty::ty_res(_, ?inner)) { oper_t = inner; }\n                         case (_) {\n                             auto s = \"dereferencing non-box type: \" +\n                                 ty_to_str(fcx.ccx.tcx, oper_t);"}]}