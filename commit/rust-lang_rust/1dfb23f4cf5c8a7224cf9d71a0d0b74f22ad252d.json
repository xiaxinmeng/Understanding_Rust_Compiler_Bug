{"sha": "1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkZmIyM2Y0Y2Y1YzhhNzIyNGNmOWQ3MWEwZDBiNzRmMjJhZDI1MmQ=", "commit": {"author": {"name": "NODA, Kai", "email": "nodakai@gmail.com", "date": "2014-10-01T11:38:21Z"}, "committer": {"name": "NODA, Kai", "email": "nodakai@gmail.com", "date": "2014-10-01T18:02:43Z"}, "message": "librustc/driver: expose build information of rustc.\n\nCFG_RELEASE, CFG_VER_HASH and CFG_VER_DATE were only available as an output\nto stdout from the driver::version() function that had an inconvenient\nsignature.", "tree": {"sha": "7436e5698837c1a48b2cb4b44fddd22e0c2de451", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7436e5698837c1a48b2cb4b44fddd22e0c2de451"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d", "html_url": "https://github.com/rust-lang/rust/commit/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d/comments", "author": {"login": "nodakai", "id": 90726, "node_id": "MDQ6VXNlcjkwNzI2", "avatar_url": "https://avatars.githubusercontent.com/u/90726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nodakai", "html_url": "https://github.com/nodakai", "followers_url": "https://api.github.com/users/nodakai/followers", "following_url": "https://api.github.com/users/nodakai/following{/other_user}", "gists_url": "https://api.github.com/users/nodakai/gists{/gist_id}", "starred_url": "https://api.github.com/users/nodakai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nodakai/subscriptions", "organizations_url": "https://api.github.com/users/nodakai/orgs", "repos_url": "https://api.github.com/users/nodakai/repos", "events_url": "https://api.github.com/users/nodakai/events{/privacy}", "received_events_url": "https://api.github.com/users/nodakai/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nodakai", "id": 90726, "node_id": "MDQ6VXNlcjkwNzI2", "avatar_url": "https://avatars.githubusercontent.com/u/90726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nodakai", "html_url": "https://github.com/nodakai", "followers_url": "https://api.github.com/users/nodakai/followers", "following_url": "https://api.github.com/users/nodakai/following{/other_user}", "gists_url": "https://api.github.com/users/nodakai/gists{/gist_id}", "starred_url": "https://api.github.com/users/nodakai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nodakai/subscriptions", "organizations_url": "https://api.github.com/users/nodakai/orgs", "repos_url": "https://api.github.com/users/nodakai/repos", "events_url": "https://api.github.com/users/nodakai/events{/privacy}", "received_events_url": "https://api.github.com/users/nodakai/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2f8d4c5050be01923f28308b71ad14a2776b30e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d2f8d4c5050be01923f28308b71ad14a2776b30e", "html_url": "https://github.com/rust-lang/rust/commit/d2f8d4c5050be01923f28308b71ad14a2776b30e"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "95ff2703be8b2cdaa570f65d39ef9edc42525b12", "filename": "src/librustc/driver/mod.rs", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d/src%2Flibrustc%2Fdriver%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d/src%2Flibrustc%2Fdriver%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fmod.rs?ref=1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d", "patch": "@@ -128,6 +128,21 @@ fn run_compiler(args: &[String]) {\n     driver::compile_input(sess, cfg, &input, &odir, &ofile, None);\n }\n \n+/// Returns a version string such as \"0.12.0-dev\".\n+pub fn release_str() -> Option<&'static str> {\n+    option_env!(\"CFG_RELEASE\")\n+}\n+\n+/// Returns the full SHA1 hash of HEAD of the Git repo from which rustc was built.\n+pub fn commit_hash_str() -> Option<&'static str> {\n+    option_env!(\"CFG_VER_HASH\")\n+}\n+\n+/// Returns the \"commit date\" of HEAD of the Git repo from which rustc was built as a static string.\n+pub fn commit_date_str() -> Option<&'static str> {\n+    option_env!(\"CFG_VER_DATE\")\n+}\n+\n /// Prints version information and returns None on success or an error\n /// message on failure.\n pub fn version(binary: &str, matches: &getopts::Matches) -> Option<String> {\n@@ -137,13 +152,14 @@ pub fn version(binary: &str, matches: &getopts::Matches) -> Option<String> {\n         Some(s) => return Some(format!(\"Unrecognized argument: {}\", s))\n     };\n \n-    println!(\"{} {}\", binary, env!(\"CFG_VERSION\"));\n+    println!(\"{} {}\", binary, option_env!(\"CFG_VERSION\").unwrap_or(\"unknown version\"));\n     if verbose {\n+        fn unw(x: Option<&str>) -> &str { x.unwrap_or(\"unknown\") }\n         println!(\"binary: {}\", binary);\n-        println!(\"commit-hash: {}\", option_env!(\"CFG_VER_HASH\").unwrap_or(\"unknown\"));\n-        println!(\"commit-date: {}\", option_env!(\"CFG_VER_DATE\").unwrap_or(\"unknown\"));\n+        println!(\"commit-hash: {}\", unw(commit_hash_str()));\n+        println!(\"commit-date: {}\", unw(commit_date_str()));\n         println!(\"host: {}\", driver::host_triple());\n-        println!(\"release: {}\", env!(\"CFG_RELEASE\"));\n+        println!(\"release: {}\", unw(release_str()));\n     }\n     None\n }"}]}