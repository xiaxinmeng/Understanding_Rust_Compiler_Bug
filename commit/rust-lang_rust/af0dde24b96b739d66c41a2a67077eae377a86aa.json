{"sha": "af0dde24b96b739d66c41a2a67077eae377a86aa", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmMGRkZTI0Yjk2YjczOWQ2NmM0MWEyYTY3MDc3ZWFlMzc3YTg2YWE=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-04-14T13:20:49Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-04-27T16:57:29Z"}, "message": "Implement `x.py test src/tools/clippy --bless`\n\n- Add clippy_dev to the rust workspace\n\n  Before, it would give an error that it wasn't either included or\n  excluded from the workspace:\n\n  ```\n  error: current package believes it's in a workspace when it's not:\n  current:   /home/joshua/rustc/src/tools/clippy/clippy_dev/Cargo.toml\n  workspace: /home/joshua/rustc/Cargo.toml\n\n  this may be fixable by adding `src/tools/clippy/clippy_dev` to the `workspace.members` array of the manifest located at: /home/joshua/rustc/Cargo.toml\n  Alternatively, to keep it out of the workspace, add the package to the `workspace.exclude` array, or add an empty `[workspace]` table to the package's manifest.\n  ```\n\n- Change clippy's copy of compiletest not to special-case\n  rust-lang/rust. Using OUT_DIR confused `clippy_dev` and it couldn't find\n  the test outputs. This is one of the reasons why `cargo dev bless` used\n  to silently do nothing (the others were that `CARGO_TARGET_DIR` and\n  `PROFILE` weren't set appropriately).\n\n- Run clippy_dev on test failure\n\nI tested this by removing a couple lines from a stderr file, and they\nwere correctly replaced.\n\n- Fix clippy_dev warnings", "tree": {"sha": "ad9785cce6ce4e155a30bf3da61186a5260c1cac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ad9785cce6ce4e155a30bf3da61186a5260c1cac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af0dde24b96b739d66c41a2a67077eae377a86aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af0dde24b96b739d66c41a2a67077eae377a86aa", "html_url": "https://github.com/rust-lang/rust/commit/af0dde24b96b739d66c41a2a67077eae377a86aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af0dde24b96b739d66c41a2a67077eae377a86aa/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6d1f368db9e726fde825dc2525cdec07673b416", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6d1f368db9e726fde825dc2525cdec07673b416", "html_url": "https://github.com/rust-lang/rust/commit/f6d1f368db9e726fde825dc2525cdec07673b416"}], "stats": {"total": 13, "additions": 3, "deletions": 10}, "files": [{"sha": "4676c2affad793e93b6999a1a472a45a388fba6b", "filename": "clippy_dev/src/new_lint.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/af0dde24b96b739d66c41a2a67077eae377a86aa/clippy_dev%2Fsrc%2Fnew_lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af0dde24b96b739d66c41a2a67077eae377a86aa/clippy_dev%2Fsrc%2Fnew_lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fnew_lint.rs?ref=af0dde24b96b739d66c41a2a67077eae377a86aa", "patch": "@@ -44,7 +44,7 @@ pub fn create(pass: Option<&str>, lint_name: Option<&str>, category: Option<&str\n     create_test(&lint).context(\"Unable to create a test for the new lint\")\n }\n \n-fn create_lint(lint: &LintData) -> io::Result<()> {\n+fn create_lint(lint: &LintData<'_>) -> io::Result<()> {\n     let (pass_type, pass_lifetimes, pass_import, context_import) = match lint.pass {\n         \"early\" => (\"EarlyLintPass\", \"\", \"use rustc_ast::ast::*;\", \"EarlyContext\"),\n         \"late\" => (\"LateLintPass\", \"<'_>\", \"use rustc_hir::*;\", \"LateContext\"),\n@@ -68,7 +68,7 @@ fn create_lint(lint: &LintData) -> io::Result<()> {\n     write_file(lint.project_root.join(&lint_path), lint_contents.as_bytes())\n }\n \n-fn create_test(lint: &LintData) -> io::Result<()> {\n+fn create_test(lint: &LintData<'_>) -> io::Result<()> {\n     fn create_project_layout<P: Into<PathBuf>>(lint_name: &str, location: P, case: &str, hint: &str) -> io::Result<()> {\n         let mut path = location.into().join(case);\n         fs::create_dir(&path)?;"}, {"sha": "e1110721f6ece396b3eef67475f6598b84c13a58", "filename": "tests/compile-test.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/af0dde24b96b739d66c41a2a67077eae377a86aa/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af0dde24b96b739d66c41a2a67077eae377a86aa/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=af0dde24b96b739d66c41a2a67077eae377a86aa", "patch": "@@ -83,14 +83,7 @@ fn default_config() -> compiletest::Config {\n         third_party_crates(),\n     ));\n \n-    config.build_base = if cargo::is_rustc_test_suite() {\n-        // This make the stderr files go to clippy OUT_DIR on rustc repo build dir\n-        let mut path = PathBuf::from(env!(\"OUT_DIR\"));\n-        path.push(\"test_build_base\");\n-        path\n-    } else {\n-        host_lib().join(\"test_build_base\")\n-    };\n+    config.build_base = host_lib().join(\"test_build_base\");\n     config.rustc_path = clippy_driver_path();\n     config\n }"}]}