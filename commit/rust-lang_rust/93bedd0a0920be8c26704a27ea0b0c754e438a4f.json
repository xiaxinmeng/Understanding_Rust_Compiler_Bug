{"sha": "93bedd0a0920be8c26704a27ea0b0c754e438a4f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzYmVkZDBhMDkyMGJlOGMyNjcwNGEyN2VhMGIwYzc1NGU0MzhhNGY=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-09-11T16:20:41Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-09-17T15:33:47Z"}, "message": "fix cargo-miri-test for cross-runs", "tree": {"sha": "0201696c019df0ffa9a4b699d9b20f3b2dd92418", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0201696c019df0ffa9a4b699d9b20f3b2dd92418"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93bedd0a0920be8c26704a27ea0b0c754e438a4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93bedd0a0920be8c26704a27ea0b0c754e438a4f", "html_url": "https://github.com/rust-lang/rust/commit/93bedd0a0920be8c26704a27ea0b0c754e438a4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93bedd0a0920be8c26704a27ea0b0c754e438a4f/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2205ed5bbb2fb8fb6c3b6a619815513f9d4c8038", "url": "https://api.github.com/repos/rust-lang/rust/commits/2205ed5bbb2fb8fb6c3b6a619815513f9d4c8038", "html_url": "https://github.com/rust-lang/rust/commit/2205ed5bbb2fb8fb6c3b6a619815513f9d4c8038"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "c7694f3854c879d79093bdda5c27e4728b4af074", "filename": "test-cargo-miri/run-test.py", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/93bedd0a0920be8c26704a27ea0b0c754e438a4f/test-cargo-miri%2Frun-test.py", "raw_url": "https://github.com/rust-lang/rust/raw/93bedd0a0920be8c26704a27ea0b0c754e438a4f/test-cargo-miri%2Frun-test.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Frun-test.py?ref=93bedd0a0920be8c26704a27ea0b0c754e438a4f", "patch": "@@ -62,18 +62,22 @@ def test_cargo_miri_run():\n     )\n \n def test_cargo_miri_test():\n+    # rustdoc is not run on foreign targets\n+    is_foreign = 'MIRI_TEST_TARGET' in os.environ\n+    rustdoc_ref = \"test.stderr.ref2\" if is_foreign else \"test.stderr.ref\"\n+\n     test(\"cargo miri test\",\n         cargo_miri(\"test\"),\n-        \"test.stdout.ref\", \"test.stderr.ref\",\n+        \"test.stdout.ref\",rustdoc_ref,\n         env={'MIRIFLAGS': \"-Zmiri-seed=feed\"},\n     )\n     test(\"cargo miri test (with filter)\",\n         cargo_miri(\"test\") + [\"--\", \"--format=pretty\", \"le1\"],\n-        \"test.stdout.ref2\", \"test.stderr.ref\"\n+        \"test.stdout.ref2\", rustdoc_ref\n     )\n     test(\"cargo miri test (without isolation)\",\n         cargo_miri(\"test\") + [\"--\", \"--format=pretty\", \"num_cpus\"],\n-        \"test.stdout.ref3\", \"test.stderr.ref\",\n+        \"test.stdout.ref3\", rustdoc_ref,\n         env={'MIRIFLAGS': \"-Zmiri-disable-isolation\"},\n     )\n     test(\"cargo miri test (test target)\","}]}