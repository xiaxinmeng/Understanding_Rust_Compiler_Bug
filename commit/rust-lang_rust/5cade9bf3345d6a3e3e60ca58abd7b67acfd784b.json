{"sha": "5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "node_id": "C_kwDOAAsO6NoAKDVjYWRlOWJmMzM0NWQ2YTNlM2U2MGNhNThhYmQ3YjY3YWNmZDc4NGI", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-02-26T16:49:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-26T16:49:16Z"}, "message": "Merge #11565\n\n11565: fix: Fix body selection in while loops r=Veykril a=lnicola\n\nCC #11561\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "6b14a8a4868d61162397344d00b600c4a784d025", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6b14a8a4868d61162397344d00b600c4a784d025"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiGloMCRBK7hj4Ov3rIwAAUg8IAKNu0kOgrxA+ULswdroE43tX\nC6zMMlw+pyYK1HoH6YKZQr7FA3k2RFLnKXBnmYcWWQtTYOP57ktOEd7oHPh75H1J\nXMR3IS+FRFM8UlN18R87BmnjQuzRx+VK+x2K1FqAdW2jFZt2d6Znf2AYlIFOv0Kh\nzuznowSuH52EaYWIFG1xqfv0L/3d5rasAsT8PilASgoIcu1wfOml1A3UubbS1pBv\n668358ZdYxciVo09z0fphkxeIw7J7YzgluT5m4hYbvsozdxrH0fom4ce0C1ckwst\ni9iahRej7/IGkRvwXXWJKECCgTmxbXVtm81FnnGo6/7lPc3pL1VEtL9bgWvQlE8=\n=cPBW\n-----END PGP SIGNATURE-----\n", "payload": "tree 6b14a8a4868d61162397344d00b600c4a784d025\nparent a153b18d6d38e06db9465d616dc3b316a0c1b717\nparent 87c4a4104da2acc662f777324f4ae3c6702bb5cc\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1645894156 +0000\ncommitter GitHub <noreply@github.com> 1645894156 +0000\n\nMerge #11565\n\n11565: fix: Fix body selection in while loops r=Veykril a=lnicola\n\nCC #11561\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "html_url": "https://github.com/rust-lang/rust/commit/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a153b18d6d38e06db9465d616dc3b316a0c1b717", "url": "https://api.github.com/repos/rust-lang/rust/commits/a153b18d6d38e06db9465d616dc3b316a0c1b717", "html_url": "https://github.com/rust-lang/rust/commit/a153b18d6d38e06db9465d616dc3b316a0c1b717"}, {"sha": "87c4a4104da2acc662f777324f4ae3c6702bb5cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/87c4a4104da2acc662f777324f4ae3c6702bb5cc", "html_url": "https://github.com/rust-lang/rust/commit/87c4a4104da2acc662f777324f4ae3c6702bb5cc"}], "stats": {"total": 37, "additions": 34, "deletions": 3}, "files": [{"sha": "812f12acede31d717dc1962d6b0c797063ba236a", "filename": "crates/hir_ty/src/tests/regression.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "patch": "@@ -1245,3 +1245,25 @@ fn test() {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn while_loop_block_expr_iterable() {\n+    check_infer(\n+        r#\"\n+fn test() {\n+    while { true } {\n+        let y = 0;\n+    }\n+}\n+        \"#,\n+        expect![[r#\"\n+            10..59 '{     ...   } }': ()\n+            16..57 'while ...     }': ()\n+            22..30 '{ true }': bool\n+            24..28 'true': bool\n+            31..57 '{     ...     }': ()\n+            45..46 'y': i32\n+            49..50 '0': i32\n+        \"#]],\n+    );\n+}"}, {"sha": "11247fbf1c982a45506374db226d65654bddca3f", "filename": "crates/syntax/src/ast/generated/nodes.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs?ref=5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "patch": "@@ -1035,7 +1035,6 @@ pub struct WhileExpr {\n     pub(crate) syntax: SyntaxNode,\n }\n impl ast::HasAttrs for WhileExpr {}\n-impl ast::HasLoopBody for WhileExpr {}\n impl WhileExpr {\n     pub fn while_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![while]) }\n     pub fn condition(&self) -> Option<Expr> { support::child(&self.syntax) }"}, {"sha": "97455abd8094bec32454e4a14a8e90a6814bf8f9", "filename": "crates/syntax/src/ast/node_ext.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fsyntax%2Fsrc%2Fast%2Fnode_ext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fsyntax%2Fsrc%2Fast%2Fnode_ext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fnode_ext.rs?ref=5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "patch": "@@ -769,6 +769,15 @@ impl ast::HasLoopBody for ast::ForExpr {\n     }\n }\n \n+impl ast::HasLoopBody for ast::WhileExpr {\n+    fn loop_body(&self) -> Option<ast::BlockExpr> {\n+        let mut exprs = support::children(self.syntax());\n+        let first = exprs.next();\n+        let second = exprs.next();\n+        second.or(first)\n+    }\n+}\n+\n impl ast::HasAttrs for ast::AnyHasDocComments {}\n \n impl From<ast::Adt> for ast::Item {"}, {"sha": "5ed56a81c49717a48f006b9ef7c84340b7f25a43", "filename": "crates/syntax/src/tests/sourcegen_ast.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fsyntax%2Fsrc%2Ftests%2Fsourcegen_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cade9bf3345d6a3e3e60ca58abd7b67acfd784b/crates%2Fsyntax%2Fsrc%2Ftests%2Fsourcegen_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Ftests%2Fsourcegen_ast.rs?ref=5cade9bf3345d6a3e3e60ca58abd7b67acfd784b", "patch": "@@ -85,8 +85,9 @@ fn generate_nodes(kinds: KindsSrc<'_>, grammar: &AstSrc) -> String {\n                 .traits\n                 .iter()\n                 .filter(|trait_name| {\n-                    // For loops have two expressions so this might collide, therefor manual impl it\n-                    node.name != \"ForExpr\" || trait_name.as_str() != \"HasLoopBody\"\n+                    // Loops have two expressions so this might collide, therefor manual impl it\n+                    node.name != \"ForExpr\" && node.name != \"WhileExpr\"\n+                        || trait_name.as_str() != \"HasLoopBody\"\n                 })\n                 .map(|trait_name| {\n                     let trait_name = format_ident!(\"{}\", trait_name);"}]}