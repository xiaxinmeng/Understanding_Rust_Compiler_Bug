{"sha": "07c3e42bd7c21be29227646dfce465cb57827465", "node_id": "C_kwDOAAsO6NoAKDA3YzNlNDJiZDdjMjFiZTI5MjI3NjQ2ZGZjZTQ2NWNiNTc4Mjc0NjU", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-14T12:13:24Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-14T12:17:18Z"}, "message": "replace a macro by a function", "tree": {"sha": "e58a463b98d7dcf4bec2511cc4bd0f407aa8b780", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e58a463b98d7dcf4bec2511cc4bd0f407aa8b780"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/07c3e42bd7c21be29227646dfce465cb57827465", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/07c3e42bd7c21be29227646dfce465cb57827465", "html_url": "https://github.com/rust-lang/rust/commit/07c3e42bd7c21be29227646dfce465cb57827465", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/07c3e42bd7c21be29227646dfce465cb57827465/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "820f322b86772fe3fdadebb587cc877efff4e61c", "url": "https://api.github.com/repos/rust-lang/rust/commits/820f322b86772fe3fdadebb587cc877efff4e61c", "html_url": "https://github.com/rust-lang/rust/commit/820f322b86772fe3fdadebb587cc877efff4e61c"}], "stats": {"total": 16, "additions": 7, "deletions": 9}, "files": [{"sha": "5e2e78882de555080b870349b51525d49b07cfaf", "filename": "tests/pass/weak_memory/weak.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/07c3e42bd7c21be29227646dfce465cb57827465/tests%2Fpass%2Fweak_memory%2Fweak.rs", "raw_url": "https://github.com/rust-lang/rust/raw/07c3e42bd7c21be29227646dfce465cb57827465/tests%2Fpass%2Fweak_memory%2Fweak.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fpass%2Fweak_memory%2Fweak.rs?ref=07c3e42bd7c21be29227646dfce465cb57827465", "patch": "@@ -72,7 +72,7 @@ fn seq_cst() -> bool {\n \n fn initialization_write() -> bool {\n     let x = static_atomic(11);\n-    assert_eq!(x.load(Relaxed), 11);\n+    assert_eq!(x.load(Relaxed), 11); // work around https://github.com/rust-lang/miri/issues/2164\n \n     let wait = static_atomic(0);\n \n@@ -94,15 +94,13 @@ fn initialization_write() -> bool {\n     r2 == 11\n }\n \n-// Asserts that the function returns true at least once in 100 runs\n-macro_rules! assert_once {\n-    ($f:ident) => {\n-        assert!(std::iter::repeat_with(|| $f()).take(100).any(|x| x));\n-    };\n+/// Asserts that the function returns true at least once in 100 runs\n+fn assert_once(f: fn() -> bool) {\n+    assert!(std::iter::repeat_with(|| f()).take(100).any(|x| x));\n }\n \n pub fn main() {\n-    assert_once!(relaxed);\n-    assert_once!(seq_cst);\n-    assert_once!(initialization_write);\n+    assert_once(relaxed);\n+    assert_once(seq_cst);\n+    assert_once(initialization_write);\n }"}]}