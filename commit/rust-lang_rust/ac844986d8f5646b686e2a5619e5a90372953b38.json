{"sha": "ac844986d8f5646b686e2a5619e5a90372953b38", "node_id": "C_kwDOAAsO6NoAKGFjODQ0OTg2ZDhmNTY0NmI2ODZlMmE1NjE5ZTVhOTAzNzI5NTNiMzg", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-03-07T00:11:31Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-03-07T00:11:31Z"}, "message": "use singed_int_max/min helper methods", "tree": {"sha": "c0e7ca50f19e0e36375405bfb1c45e451067c1e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0e7ca50f19e0e36375405bfb1c45e451067c1e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ac844986d8f5646b686e2a5619e5a90372953b38", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ac844986d8f5646b686e2a5619e5a90372953b38", "html_url": "https://github.com/rust-lang/rust/commit/ac844986d8f5646b686e2a5619e5a90372953b38", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ac844986d8f5646b686e2a5619e5a90372953b38/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "956659e5ced806360b726c103eb7ab1d960c163a", "url": "https://api.github.com/repos/rust-lang/rust/commits/956659e5ced806360b726c103eb7ab1d960c163a", "html_url": "https://github.com/rust-lang/rust/commit/956659e5ced806360b726c103eb7ab1d960c163a"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "63c0248993f6cff1c7b4037ec33e5f3c405f12d8", "filename": "compiler/rustc_const_eval/src/interpret/intrinsics.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ac844986d8f5646b686e2a5619e5a90372953b38/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac844986d8f5646b686e2a5619e5a90372953b38/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs?ref=ac844986d8f5646b686e2a5619e5a90372953b38", "patch": "@@ -493,23 +493,20 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                     // Negative overflow not possible since the positive first term\n                     // can only increase an (in range) negative term for addition\n                     // or corresponding negated positive term for subtraction\n-                    Scalar::from_uint(\n-                        (1u128 << (num_bits - 1)) - 1, // max positive\n-                        Size::from_bits(num_bits),\n-                    )\n+                    Scalar::from_int(size.signed_int_max(), size)\n                 } else {\n                     // Positive overflow not possible for similar reason\n                     // max negative\n-                    Scalar::from_uint(1u128 << (num_bits - 1), Size::from_bits(num_bits))\n+                    Scalar::from_int(size.signed_int_min(), size)\n                 }\n             } else {\n                 // unsigned\n                 if matches!(mir_op, BinOp::Add) {\n                     // max unsigned\n-                    Scalar::from_uint(size.unsigned_int_max(), Size::from_bits(num_bits))\n+                    Scalar::from_uint(size.unsigned_int_max(), size)\n                 } else {\n                     // underflow to 0\n-                    Scalar::from_uint(0u128, Size::from_bits(num_bits))\n+                    Scalar::from_uint(0u128, size)\n                 }\n             }\n         } else {"}]}