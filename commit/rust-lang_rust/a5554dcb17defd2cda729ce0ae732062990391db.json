{"sha": "a5554dcb17defd2cda729ce0ae732062990391db", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1NTU0ZGNiMTdkZWZkMmNkYTcyOWNlMGFlNzMyMDYyOTkwMzkxZGI=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2020-01-29T20:30:24Z"}, "committer": {"name": "Florian Diebold", "email": "florian.diebold@freiheit.com", "date": "2020-02-07T17:28:10Z"}, "message": "Fix enum constructors", "tree": {"sha": "cf026e1d434840960343747132dd54612e679037", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf026e1d434840960343747132dd54612e679037"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5554dcb17defd2cda729ce0ae732062990391db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5554dcb17defd2cda729ce0ae732062990391db", "html_url": "https://github.com/rust-lang/rust/commit/a5554dcb17defd2cda729ce0ae732062990391db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5554dcb17defd2cda729ce0ae732062990391db/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4789a993eb26963a2411dcc3041733a3b034634a", "url": "https://api.github.com/repos/rust-lang/rust/commits/4789a993eb26963a2411dcc3041733a3b034634a", "html_url": "https://github.com/rust-lang/rust/commit/4789a993eb26963a2411dcc3041733a3b034634a"}], "stats": {"total": 20, "additions": 9, "deletions": 11}, "files": [{"sha": "25c894c9597af06c22378aff13863bc1f22f7416", "filename": "crates/ra_hir_ty/src/lower.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a5554dcb17defd2cda729ce0ae732062990391db/crates%2Fra_hir_ty%2Fsrc%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5554dcb17defd2cda729ce0ae732062990391db/crates%2Fra_hir_ty%2Fsrc%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Flower.rs?ref=a5554dcb17defd2cda729ce0ae732062990391db", "patch": "@@ -729,14 +729,12 @@ fn fn_sig_for_enum_variant_constructor(db: &impl HirDatabase, def: EnumVariantId\n     let var_data = &enum_data.variants[def.local_id];\n     let fields = var_data.variant_data.fields();\n     let resolver = def.parent.resolver(db);\n-    let ctx = TyLoweringContext::new(db, &resolver);\n+    let ctx = TyLoweringContext::new(db, &resolver)\n+        .with_type_param_mode(TypeParamLoweringMode::Variable);\n     let params =\n         fields.iter().map(|(_, field)| Ty::from_hir(&ctx, &field.type_ref)).collect::<Vec<_>>();\n-    let generics = generics(db, def.parent.into());\n-    let substs = Substs::bound_vars(&generics);\n-    let ret = type_for_adt(db, def.parent.into()).subst(&substs);\n-    let num_binders = generics.len();\n-    Binders::new(num_binders, FnSig::from_params_and_return(params, ret))\n+    let ret = type_for_adt(db, def.parent.into());\n+    Binders::new(ret.num_binders, FnSig::from_params_and_return(params, ret.value))\n }\n \n /// Build the type of a tuple enum variant constructor."}, {"sha": "3803f5938cfa75bd546a7ef32c4598208e3c5ead", "filename": "crates/ra_hir_ty/src/tests/simple.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a5554dcb17defd2cda729ce0ae732062990391db/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5554dcb17defd2cda729ce0ae732062990391db/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs?ref=a5554dcb17defd2cda729ce0ae732062990391db", "patch": "@@ -1169,16 +1169,16 @@ fn test() {\n \"#),\n         @r###\"\n     [76; 184) '{     ...one; }': ()\n-    [82; 83) 'A': A<i32>(T) -> A<T>\n+    [82; 83) 'A': A<i32>(i32) -> A<i32>\n     [82; 87) 'A(42)': A<i32>\n     [84; 86) '42': i32\n-    [93; 94) 'A': A<u128>(T) -> A<T>\n+    [93; 94) 'A': A<u128>(u128) -> A<u128>\n     [93; 102) 'A(42u128)': A<u128>\n     [95; 101) '42u128': u128\n-    [108; 112) 'Some': Some<&str>(T) -> Option<T>\n+    [108; 112) 'Some': Some<&str>(&str) -> Option<&str>\n     [108; 117) 'Some(\"x\")': Option<&str>\n     [113; 116) '\"x\"': &str\n-    [123; 135) 'Option::Some': Some<&str>(T) -> Option<T>\n+    [123; 135) 'Option::Some': Some<&str>(&str) -> Option<&str>\n     [123; 140) 'Option...e(\"x\")': Option<&str>\n     [136; 139) '\"x\"': &str\n     [146; 150) 'None': Option<{unknown}>"}, {"sha": "9ff396ad56848a635e50585cce9a2a88ba77cfe7", "filename": "crates/ra_hir_ty/src/tests/traits.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a5554dcb17defd2cda729ce0ae732062990391db/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5554dcb17defd2cda729ce0ae732062990391db/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=a5554dcb17defd2cda729ce0ae732062990391db", "patch": "@@ -1322,7 +1322,7 @@ fn test() {\n     [173; 175) '{}': ()\n     [189; 308) '{     ... 1); }': ()\n     [199; 200) 'x': Option<u32>\n-    [203; 215) 'Option::Some': Some<u32>(T) -> Option<T>\n+    [203; 215) 'Option::Some': Some<u32>(u32) -> Option<u32>\n     [203; 221) 'Option...(1u32)': Option<u32>\n     [216; 220) '1u32': u32\n     [227; 228) 'x': Option<u32>"}]}