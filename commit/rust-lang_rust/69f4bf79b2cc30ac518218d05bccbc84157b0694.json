{"sha": "69f4bf79b2cc30ac518218d05bccbc84157b0694", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5ZjRiZjc5YjJjYzMwYWM1MTgyMThkMDViY2NiYzg0MTU3YjA2OTQ=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@gmail", "date": "2013-12-13T13:34:44Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@gmail", "date": "2013-12-16T09:23:28Z"}, "message": "debuginfo: Use same behavior as Clang for calculating scope_line parameter when creating function DIEs.", "tree": {"sha": "356ce700cf780c20e3089c58ad39e978dc457744", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/356ce700cf780c20e3089c58ad39e978dc457744"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69f4bf79b2cc30ac518218d05bccbc84157b0694", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69f4bf79b2cc30ac518218d05bccbc84157b0694", "html_url": "https://github.com/rust-lang/rust/commit/69f4bf79b2cc30ac518218d05bccbc84157b0694", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69f4bf79b2cc30ac518218d05bccbc84157b0694/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "45e472aa4bdcec7a5bfd8cdaa10dd00435242162", "url": "https://api.github.com/repos/rust-lang/rust/commits/45e472aa4bdcec7a5bfd8cdaa10dd00435242162", "html_url": "https://github.com/rust-lang/rust/commit/45e472aa4bdcec7a5bfd8cdaa10dd00435242162"}], "stats": {"total": 18, "additions": 2, "deletions": 16}, "files": [{"sha": "631f32fcd68a2bc1cf3f6d48aacd82d6d7f8d765", "filename": "src/librustc/middle/trans/debuginfo.rs", "status": "modified", "additions": 2, "deletions": 16, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/69f4bf79b2cc30ac518218d05bccbc84157b0694/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdebuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69f4bf79b2cc30ac518218d05bccbc84157b0694/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdebuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdebuginfo.rs?ref=69f4bf79b2cc30ac518218d05bccbc84157b0694", "patch": "@@ -651,7 +651,8 @@ pub fn create_function_debug_context(cx: &mut CrateContext,\n         (function_name.clone(), file_metadata)\n     };\n \n-    let scope_line = get_scope_line(cx, top_level_block, loc.line);\n+    // Clang sets this parameter to the opening brace of the function's block, so let's do this too.\n+    let scope_line = span_start(cx, top_level_block.span).line;\n \n     let fn_metadata = function_name.with_c_str(|function_name| {\n                           linkage_name.with_c_str(|linkage_name| {\n@@ -840,21 +841,6 @@ pub fn create_function_debug_context(cx: &mut CrateContext,\n \n         return create_DIArray(DIB(cx), template_params);\n     }\n-\n-    fn get_scope_line(cx: &CrateContext,\n-                      top_level_block: &ast::Block,\n-                      default: uint)\n-                   -> uint {\n-        match *top_level_block {\n-            ast::Block { stmts: ref statements, .. } if statements.len() > 0 => {\n-                span_start(cx, statements[0].span).line\n-            }\n-            ast::Block { expr: Some(@ref expr), .. } => {\n-                span_start(cx, expr.span).line\n-            }\n-            _ => default\n-        }\n-    }\n }\n \n //=-------------------------------------------------------------------------------------------------"}]}