{"sha": "7821a9b995b34d6b2ab460e045797e6d2662e5bb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4MjFhOWI5OTViMzRkNmIyYWI0NjBlMDQ1Nzk3ZTZkMjY2MmU1YmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-23T00:36:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-23T00:36:00Z"}, "message": "Auto merge of #39247 - est31:master, r=jseyfried\n\nRemove proc_macro from the tidy whitelist again\n\nPR #38842 has exposed that we were missing the src/test/compile-fail-fulldeps\ndirectory in the search for feature gate tests. Because the detection didn't\nwork despite the effort to name the test appropriately and add a correct\n\"// gate-test-proc_macro\" comment, proc_macro was added to the whitelist.\n\nWe fix this little weakness in the feature gate tidy check and add\nthe src/test/compile-fail-fulldeps directory to the checked directories.\n\nPart of issue #39059 .", "tree": {"sha": "ed7ad82d0b67b6da128562c159cd2813171e97e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed7ad82d0b67b6da128562c159cd2813171e97e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7821a9b995b34d6b2ab460e045797e6d2662e5bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7821a9b995b34d6b2ab460e045797e6d2662e5bb", "html_url": "https://github.com/rust-lang/rust/commit/7821a9b995b34d6b2ab460e045797e6d2662e5bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7821a9b995b34d6b2ab460e045797e6d2662e5bb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f261ec4faac7ad95bd9835234993236ff800e7c", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f261ec4faac7ad95bd9835234993236ff800e7c", "html_url": "https://github.com/rust-lang/rust/commit/3f261ec4faac7ad95bd9835234993236ff800e7c"}, {"sha": "e3daab037de17a9e0679356f008f21e164467844", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3daab037de17a9e0679356f008f21e164467844", "html_url": "https://github.com/rust-lang/rust/commit/e3daab037de17a9e0679356f008f21e164467844"}], "stats": {"total": 14, "additions": 10, "deletions": 4}, "files": [{"sha": "ee8113e80e5752dd5284ac10a85cb0d32a07aed5", "filename": "src/tools/tidy/src/features.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7821a9b995b34d6b2ab460e045797e6d2662e5bb/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7821a9b995b34d6b2ab460e045797e6d2662e5bb/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs?ref=7821a9b995b34d6b2ab460e045797e6d2662e5bb", "patch": "@@ -115,9 +115,10 @@ pub fn check(path: &Path, bad: &mut bool) {\n         }\n     });\n \n-    super::walk(&path.join(\"test/compile-fail\"),\n-                &mut |path| super::filter_dirs(path),\n-                &mut |file| {\n+    super::walk_many(&[&path.join(\"test/compile-fail\"),\n+                       &path.join(\"test/compile-fail-fulldeps\")],\n+                     &mut |path| super::filter_dirs(path),\n+                     &mut |file| {\n         let filename = file.file_name().unwrap().to_string_lossy();\n         if !filename.ends_with(\".rs\") || filename == \"features.rs\" ||\n            filename == \"diagnostic_list.rs\" {\n@@ -170,7 +171,7 @@ pub fn check(path: &Path, bad: &mut bool) {\n         \"cfg_target_has_atomic\", \"staged_api\", \"const_indexing\",\n         \"unboxed_closures\", \"stmt_expr_attributes\",\n         \"cfg_target_thread_local\", \"unwind_attributes\",\n-        \"inclusive_range_syntax\", \"proc_macro\"\n+        \"inclusive_range_syntax\"\n     ];\n \n     // Only check the number of lang features."}, {"sha": "9962c6ec9af12209c560d9d2c9edccc1e45b2151", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7821a9b995b34d6b2ab460e045797e6d2662e5bb/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7821a9b995b34d6b2ab460e045797e6d2662e5bb/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=7821a9b995b34d6b2ab460e045797e6d2662e5bb", "patch": "@@ -71,6 +71,11 @@ fn filter_dirs(path: &Path) -> bool {\n     skip.iter().any(|p| path.ends_with(p))\n }\n \n+fn walk_many(paths: &[&Path], skip: &mut FnMut(&Path) -> bool, f: &mut FnMut(&Path)) {\n+    for path in paths {\n+        walk(path, skip, f);\n+    }\n+}\n \n fn walk(path: &Path, skip: &mut FnMut(&Path) -> bool, f: &mut FnMut(&Path)) {\n     for entry in t!(fs::read_dir(path), path) {"}]}