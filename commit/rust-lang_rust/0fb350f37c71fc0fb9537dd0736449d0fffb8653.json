{"sha": "0fb350f37c71fc0fb9537dd0736449d0fffb8653", "node_id": "C_kwDOAAsO6NoAKDBmYjM1MGYzN2M3MWZjMGZiOTUzN2RkMDczNjQ0OWQwZmZmYjg2NTM", "commit": {"author": {"name": "Antoni Boucher", "email": "bouanto@zoho.com", "date": "2022-03-19T16:15:26Z"}, "committer": {"name": "Antoni Boucher", "email": "bouanto@zoho.com", "date": "2022-03-19T16:15:26Z"}, "message": "Fix shift of unsigned integer by signed integer", "tree": {"sha": "fdbdf3ffaaf424bd2056283947a20a8e5712bbaf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fdbdf3ffaaf424bd2056283947a20a8e5712bbaf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0fb350f37c71fc0fb9537dd0736449d0fffb8653", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0fb350f37c71fc0fb9537dd0736449d0fffb8653", "html_url": "https://github.com/rust-lang/rust/commit/0fb350f37c71fc0fb9537dd0736449d0fffb8653", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0fb350f37c71fc0fb9537dd0736449d0fffb8653/comments", "author": {"login": "antoyo", "id": 584972, "node_id": "MDQ6VXNlcjU4NDk3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/584972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antoyo", "html_url": "https://github.com/antoyo", "followers_url": "https://api.github.com/users/antoyo/followers", "following_url": "https://api.github.com/users/antoyo/following{/other_user}", "gists_url": "https://api.github.com/users/antoyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/antoyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antoyo/subscriptions", "organizations_url": "https://api.github.com/users/antoyo/orgs", "repos_url": "https://api.github.com/users/antoyo/repos", "events_url": "https://api.github.com/users/antoyo/events{/privacy}", "received_events_url": "https://api.github.com/users/antoyo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "antoyo", "id": 584972, "node_id": "MDQ6VXNlcjU4NDk3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/584972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antoyo", "html_url": "https://github.com/antoyo", "followers_url": "https://api.github.com/users/antoyo/followers", "following_url": "https://api.github.com/users/antoyo/following{/other_user}", "gists_url": "https://api.github.com/users/antoyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/antoyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antoyo/subscriptions", "organizations_url": "https://api.github.com/users/antoyo/orgs", "repos_url": "https://api.github.com/users/antoyo/repos", "events_url": "https://api.github.com/users/antoyo/events{/privacy}", "received_events_url": "https://api.github.com/users/antoyo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d63ea3e037a143964b19b40a3f5f0b745a85745e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d63ea3e037a143964b19b40a3f5f0b745a85745e", "html_url": "https://github.com/rust-lang/rust/commit/d63ea3e037a143964b19b40a3f5f0b745a85745e"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "c3ed71ff730368f9bbda3473cf9ccfe8a550163b", "filename": "src/int.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0fb350f37c71fc0fb9537dd0736449d0fffb8653/src%2Fint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fb350f37c71fc0fb9537dd0736449d0fffb8653/src%2Fint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fint.rs?ref=0fb350f37c71fc0fb9537dd0736449d0fffb8653", "patch": "@@ -68,14 +68,9 @@ impl<'a, 'gcc, 'tcx> Builder<'a, 'gcc, 'tcx> {\n         let a_native = self.is_native_int_type(a_type);\n         let b_native = self.is_native_int_type(b_type);\n         if a_native && b_native {\n-            // FIXME(antoyo): remove the casts when libgccjit can shift an unsigned number by an unsigned number.\n+            // FIXME(antoyo): remove the casts when libgccjit can shift an unsigned number by a signed number.\n             // TODO(antoyo): cast to unsigned to do a logical shift if that does not work.\n-            if a_type.is_unsigned(self) && b_type.is_signed(self) {\n-                let a = self.context.new_cast(None, a, b_type);\n-                let result = a >> b;\n-                self.context.new_cast(None, result, a_type)\n-            }\n-            else if a_type.is_signed(self) && b_type.is_unsigned(self) {\n+            if a_type.is_signed(self) != b_type.is_signed(self) {\n                 let b = self.context.new_cast(None, b, a_type);\n                 a >> b\n             }"}, {"sha": "49376012c40e79e34ca715aabbb6c1e90c271d52", "filename": "tests/run/int.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0fb350f37c71fc0fb9537dd0736449d0fffb8653/tests%2Frun%2Fint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0fb350f37c71fc0fb9537dd0736449d0fffb8653/tests%2Frun%2Fint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun%2Fint.rs?ref=0fb350f37c71fc0fb9537dd0736449d0fffb8653", "patch": "@@ -71,6 +71,8 @@ fn main(argc: isize, _argv: *const *const u8) -> isize {\n     assert_eq!(var3 << (argc + 62) as u128, 96618259944854013731572476686437974016);\n     assert_eq!(var3 << (argc + 63) as u128, 193236519889708027463144953372875948032);\n \n+    assert_eq!((2220326408_u32 + argc as u32) >> (32 - 6), 33);\n+\n     assert_eq!(var >> (argc as u128 - 1), var);\n     assert_eq!(var >> argc as u128, 67108928);\n     assert_eq!(var >> (argc + 32) as u128, 0);"}]}