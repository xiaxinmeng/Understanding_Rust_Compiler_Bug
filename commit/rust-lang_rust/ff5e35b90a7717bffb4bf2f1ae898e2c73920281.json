{"sha": "ff5e35b90a7717bffb4bf2f1ae898e2c73920281", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZmNWUzNWI5MGE3NzE3YmZmYjRiZjJmMWFlODk4ZTJjNzM5MjAyODE=", "commit": {"author": {"name": "Vytautas Astrauskas", "email": "astrauv@amazon.com", "date": "2020-04-26T21:24:48Z"}, "committer": {"name": "Vytautas Astrauskas", "email": "astrauv@amazon.com", "date": "2020-04-27T21:26:36Z"}, "message": "Added a test that joining main is UB.", "tree": {"sha": "a108cdc1d3283506e686881554f9da54e3b12fd8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a108cdc1d3283506e686881554f9da54e3b12fd8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ff5e35b90a7717bffb4bf2f1ae898e2c73920281", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ff5e35b90a7717bffb4bf2f1ae898e2c73920281", "html_url": "https://github.com/rust-lang/rust/commit/ff5e35b90a7717bffb4bf2f1ae898e2c73920281", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ff5e35b90a7717bffb4bf2f1ae898e2c73920281/comments", "author": null, "committer": null, "parents": [{"sha": "bc9d007e3eccae1bbb7b90bbfd2c2d583e44166f", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc9d007e3eccae1bbb7b90bbfd2c2d583e44166f", "html_url": "https://github.com/rust-lang/rust/commit/bc9d007e3eccae1bbb7b90bbfd2c2d583e44166f"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "69e1a68ef97ae4f30feb13aa0841611860125781", "filename": "tests/compile-fail/concurrency/libc_pthread_join_main.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/ff5e35b90a7717bffb4bf2f1ae898e2c73920281/tests%2Fcompile-fail%2Fconcurrency%2Flibc_pthread_join_main.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ff5e35b90a7717bffb4bf2f1ae898e2c73920281/tests%2Fcompile-fail%2Fconcurrency%2Flibc_pthread_join_main.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fconcurrency%2Flibc_pthread_join_main.rs?ref=ff5e35b90a7717bffb4bf2f1ae898e2c73920281", "patch": "@@ -0,0 +1,20 @@\n+// ignore-windows: Concurrency on Windows is not supported yet.\n+\n+// Joining the main thread is undefined behavior.\n+\n+#![feature(rustc_private)]\n+\n+extern crate libc;\n+\n+use std::{ptr, thread};\n+\n+fn main() {\n+    let thread_id: libc::pthread_t = unsafe { libc::pthread_self() };\n+    let handle = thread::spawn(move || {\n+        unsafe {\n+            assert_eq!(libc::pthread_join(thread_id, ptr::null_mut()), 0); //~ ERROR: Undefined Behavior: trying to join a detached or already joined thread\n+        }\n+    });\n+    thread::yield_now();\n+    handle.join().unwrap();\n+}"}]}