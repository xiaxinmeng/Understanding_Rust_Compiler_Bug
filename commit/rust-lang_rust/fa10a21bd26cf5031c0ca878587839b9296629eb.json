{"sha": "fa10a21bd26cf5031c0ca878587839b9296629eb", "node_id": "C_kwDOAAsO6NoAKGZhMTBhMjFiZDI2Y2Y1MDMxYzBjYTg3ODU4NzgzOWI5Mjk2NjI5ZWI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-02-25T23:46:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-02-25T23:46:25Z"}, "message": "Rollup merge of #107890 - obeis:mapping-to-unit, r=cjgillot\n\nLint against `Iterator::map` receiving a callable that returns `()`\n\nClose #106991", "tree": {"sha": "c26170f0b46427d20f17498138be36d27f179ff9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c26170f0b46427d20f17498138be36d27f179ff9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fa10a21bd26cf5031c0ca878587839b9296629eb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj+p3RCRBK7hj4Ov3rIwAAB2gIAAXkuBqK6DhE+HRvQyN/hsV5\nvDkfjQsKwTLcByN4fViciWOh8vAdojyWaGo+gfYGZ1Kz0whpkL0SYlRT1273pWUd\nieuJCxv4XBilncFtpMHHE7GDpSmf+wU8V96mkVSgMt0RZaJXvhYBIWufxE4eKdCL\njYEuFB83Gwme0vLXmEpXBmbeQ4XoIqThKPLnxvjuGEakhLOKSSAhkT6FijfQfVCz\nVJaGbyldPErQ2HI8C8PS3IGBRZgZU4vlsCbRr5aMGqY/zoLxlVVYCGe1FnCl9YIO\nW0Q0DkuXI/TN+kFuoJAwBuer4Ea/+GBXgkutfp0IwF+gvuhZKc71Z6fVP9U+y1E=\n=6YuM\n-----END PGP SIGNATURE-----\n", "payload": "tree c26170f0b46427d20f17498138be36d27f179ff9\nparent f840799385961b3e047a43af3f44b299f16277df\nparent 99344a8b3231925bc52190b7e9c18a597c54ca90\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1677368785 +0100\ncommitter GitHub <noreply@github.com> 1677368785 +0100\n\nRollup merge of #107890 - obeis:mapping-to-unit, r=cjgillot\n\nLint against `Iterator::map` receiving a callable that returns `()`\n\nClose #106991\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fa10a21bd26cf5031c0ca878587839b9296629eb", "html_url": "https://github.com/rust-lang/rust/commit/fa10a21bd26cf5031c0ca878587839b9296629eb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fa10a21bd26cf5031c0ca878587839b9296629eb/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f840799385961b3e047a43af3f44b299f16277df", "url": "https://api.github.com/repos/rust-lang/rust/commits/f840799385961b3e047a43af3f44b299f16277df", "html_url": "https://github.com/rust-lang/rust/commit/f840799385961b3e047a43af3f44b299f16277df"}, {"sha": "99344a8b3231925bc52190b7e9c18a597c54ca90", "url": "https://api.github.com/repos/rust-lang/rust/commits/99344a8b3231925bc52190b7e9c18a597c54ca90", "html_url": "https://github.com/rust-lang/rust/commit/99344a8b3231925bc52190b7e9c18a597c54ca90"}], "stats": {"total": 261, "additions": 260, "deletions": 1}, "files": [{"sha": "68e62c9789aed9fda1e5a0118d1642cd4f8c6f95", "filename": "compiler/rustc_lint/locales/en-US.ftl", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Flocales%2Fen-US.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Flocales%2Fen-US.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Flocales%2Fen-US.ftl?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -24,6 +24,13 @@ lint_for_loops_over_fallibles =\n     .use_while_let = to check pattern in a loop use `while let`\n     .use_question_mark = consider unwrapping the `Result` with `?` to iterate over its contents\n \n+lint_map_unit_fn = `Iterator::map` call that discard the iterator's values\n+    .note = `Iterator::map`, like many of the methods on `Iterator`, gets executed lazily, meaning that its effects won't be visible until it is iterated\n+    .function_label = this function returns `()`, which is likely not what you wanted\n+    .argument_label = called `Iterator::map` with callable that returns `()`\n+    .map_label = after this call to map, the resulting iterator is `impl Iterator<Item = ()>`, which means the only information carried by the iterator is the number of items\n+    .suggestion = you might have meant to use `Iterator::for_each`\n+\n lint_non_binding_let_on_sync_lock =\n     non-binding let on a synchronization lock\n "}, {"sha": "35dc533e56c24ea900ad26f4ed9bd11850d46d11", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -63,6 +63,7 @@ mod late;\n mod let_underscore;\n mod levels;\n mod lints;\n+mod map_unit_fn;\n mod methods;\n mod multiple_supertrait_upcastable;\n mod non_ascii_idents;\n@@ -100,6 +101,7 @@ use for_loops_over_fallibles::*;\n use hidden_unicode_codepoints::*;\n use internal::*;\n use let_underscore::*;\n+use map_unit_fn::*;\n use methods::*;\n use multiple_supertrait_upcastable::*;\n use non_ascii_idents::*;\n@@ -239,6 +241,7 @@ late_lint_methods!(\n             NamedAsmLabels: NamedAsmLabels,\n             OpaqueHiddenInferredBound: OpaqueHiddenInferredBound,\n             MultipleSupertraitUpcastable: MultipleSupertraitUpcastable,\n+            MapUnitFn: MapUnitFn,\n         ]\n     ]\n );\n@@ -298,7 +301,8 @@ fn register_builtins(store: &mut LintStore) {\n         UNUSED_LABELS,\n         UNUSED_PARENS,\n         UNUSED_BRACES,\n-        REDUNDANT_SEMICOLONS\n+        REDUNDANT_SEMICOLONS,\n+        MAP_UNIT_FN\n     );\n \n     add_lint_group!(\"let_underscore\", LET_UNDERSCORE_DROP, LET_UNDERSCORE_LOCK);"}, {"sha": "20ab0af5856518a22d7099d3c3160849f59f555e", "filename": "compiler/rustc_lint/src/lints.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Fsrc%2Flints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Fsrc%2Flints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flints.rs?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -748,6 +748,22 @@ impl AddToDiagnostic for HiddenUnicodeCodepointsDiagSub {\n     }\n }\n \n+// map_unit_fn.rs\n+#[derive(LintDiagnostic)]\n+#[diag(lint_map_unit_fn)]\n+#[note]\n+pub struct MappingToUnit {\n+    #[label(lint_function_label)]\n+    pub function_label: Span,\n+    #[label(lint_argument_label)]\n+    pub argument_label: Span,\n+    #[label(lint_map_label)]\n+    pub map_label: Span,\n+    #[suggestion(style = \"verbose\", code = \"{replace}\", applicability = \"maybe-incorrect\")]\n+    pub suggestion: Span,\n+    pub replace: String,\n+}\n+\n // internal.rs\n #[derive(LintDiagnostic)]\n #[diag(lint_default_hash_types)]"}, {"sha": "62e8b4fe9e4a2073b7763ceb5174fc1117d34b4f", "filename": "compiler/rustc_lint/src/map_unit_fn.rs", "status": "added", "additions": 120, "deletions": 0, "changes": 120, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Fsrc%2Fmap_unit_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/compiler%2Frustc_lint%2Fsrc%2Fmap_unit_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fmap_unit_fn.rs?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -0,0 +1,120 @@\n+use crate::lints::MappingToUnit;\n+use crate::{LateContext, LateLintPass, LintContext};\n+\n+use rustc_hir::{Expr, ExprKind, HirId, Stmt, StmtKind};\n+use rustc_middle::{\n+    query::Key,\n+    ty::{self, Ty},\n+};\n+\n+declare_lint! {\n+    /// The `map_unit_fn` lint checks for `Iterator::map` receive\n+    /// a callable that returns `()`.\n+    ///\n+    /// ### Example\n+    ///\n+    /// ```rust\n+    /// fn foo(items: &mut Vec<u8>) {\n+    ///     items.sort();\n+    /// }\n+    ///\n+    /// fn main() {\n+    ///     let mut x: Vec<Vec<u8>> = vec![\n+    ///         vec![0, 2, 1],\n+    ///         vec![5, 4, 3],\n+    ///     ];\n+    ///     x.iter_mut().map(foo);\n+    /// }\n+    /// ```\n+    ///\n+    /// {{produces}}\n+    ///\n+    /// ### Explanation\n+    ///\n+    /// Mapping to `()` is almost always a mistake.\n+    pub MAP_UNIT_FN,\n+    Warn,\n+    \"`Iterator::map` call that discard the iterator's values\"\n+}\n+\n+declare_lint_pass!(MapUnitFn => [MAP_UNIT_FN]);\n+\n+impl<'tcx> LateLintPass<'tcx> for MapUnitFn {\n+    fn check_stmt(&mut self, cx: &LateContext<'tcx>, stmt: &Stmt<'_>) {\n+        if stmt.span.from_expansion() {\n+            return;\n+        }\n+\n+        if let StmtKind::Semi(expr) = stmt.kind {\n+            if let ExprKind::MethodCall(path, receiver, args, span) = expr.kind {\n+                if path.ident.name.as_str() == \"map\" {\n+                    if receiver.span.from_expansion()\n+                        || args.iter().any(|e| e.span.from_expansion())\n+                        || !is_impl_slice(cx, receiver)\n+                        || !is_diagnostic_name(cx, expr.hir_id, \"IteratorMap\")\n+                    {\n+                        return;\n+                    }\n+                    let arg_ty = cx.typeck_results().expr_ty(&args[0]);\n+                    if let ty::FnDef(id, _) = arg_ty.kind() {\n+                        let fn_ty = cx.tcx.fn_sig(id).skip_binder();\n+                        let ret_ty = fn_ty.output().skip_binder();\n+                        if is_unit_type(ret_ty) {\n+                            cx.emit_spanned_lint(\n+                                MAP_UNIT_FN,\n+                                span,\n+                                MappingToUnit {\n+                                    function_label: cx.tcx.span_of_impl(*id).unwrap(),\n+                                    argument_label: args[0].span,\n+                                    map_label: arg_ty.default_span(cx.tcx),\n+                                    suggestion: path.ident.span,\n+                                    replace: \"for_each\".to_string(),\n+                                },\n+                            )\n+                        }\n+                    } else if let ty::Closure(id, subs) = arg_ty.kind() {\n+                        let cl_ty = subs.as_closure().sig();\n+                        let ret_ty = cl_ty.output().skip_binder();\n+                        if is_unit_type(ret_ty) {\n+                            cx.emit_spanned_lint(\n+                                MAP_UNIT_FN,\n+                                span,\n+                                MappingToUnit {\n+                                    function_label: cx.tcx.span_of_impl(*id).unwrap(),\n+                                    argument_label: args[0].span,\n+                                    map_label: arg_ty.default_span(cx.tcx),\n+                                    suggestion: path.ident.span,\n+                                    replace: \"for_each\".to_string(),\n+                                },\n+                            )\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+fn is_impl_slice(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n+    if let Some(method_id) = cx.typeck_results().type_dependent_def_id(expr.hir_id) {\n+        if let Some(impl_id) = cx.tcx.impl_of_method(method_id) {\n+            return cx.tcx.type_of(impl_id).skip_binder().is_slice();\n+        }\n+    }\n+    false\n+}\n+\n+fn is_unit_type(ty: Ty<'_>) -> bool {\n+    ty.is_unit() || ty.is_never()\n+}\n+\n+fn is_diagnostic_name(cx: &LateContext<'_>, id: HirId, name: &str) -> bool {\n+    if let Some(def_id) = cx.typeck_results().type_dependent_def_id(id) {\n+        if let Some(item) = cx.tcx.get_diagnostic_name(def_id) {\n+            if item.as_str() == name {\n+                return true;\n+            }\n+        }\n+    }\n+    false\n+}"}, {"sha": "ae00232c12c8ab9ee7987081f765f88d7d2a33c7", "filename": "library/core/src/iter/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/library%2Fcore%2Fsrc%2Fiter%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/library%2Fcore%2Fsrc%2Fiter%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fiter%2Fmod.rs?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -278,6 +278,7 @@\n //!\n //! ```\n //! # #![allow(unused_must_use)]\n+//! # #![cfg_attr(not(bootstrap), allow(map_unit_fn))]\n //! let v = vec![1, 2, 3, 4, 5];\n //! v.iter().map(|x| println!(\"{x}\"));\n //! ```"}, {"sha": "b8e7d0a68da573f229c6cd3deb5474f48b9b4a2d", "filename": "library/core/src/iter/traits/iterator.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fiterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fiterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fiterator.rs?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -789,6 +789,7 @@ pub trait Iterator {\n     ///     println!(\"{x}\");\n     /// }\n     /// ```\n+    #[rustc_diagnostic_item = \"IteratorMap\"]\n     #[inline]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[rustc_do_not_const_check]"}, {"sha": "e4d7f765b4a8a0ec704be2e83825bcaf45831e91", "filename": "tests/ui/lint/issue-106991.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Fissue-106991.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Fissue-106991.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Fissue-106991.rs?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -0,0 +1,13 @@\n+fn foo(items: &mut Vec<u8>) {\n+    items.sort();\n+}\n+\n+fn bar() -> impl Iterator<Item = i32> {\n+    //~^ ERROR expected `foo` to be a fn item that returns `i32`, but it returns `()` [E0271]\n+    let mut x: Vec<Vec<u8>> = vec![vec![0, 2, 1], vec![5, 4, 3]];\n+    x.iter_mut().map(foo)\n+}\n+\n+fn main() {\n+    bar();\n+}"}, {"sha": "7b43f0b2ca8f32f5a5e5279618ff21d80a17ab22", "filename": "tests/ui/lint/issue-106991.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Fissue-106991.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Fissue-106991.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Fissue-106991.stderr?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -0,0 +1,11 @@\n+error[E0271]: expected `foo` to be a fn item that returns `i32`, but it returns `()`\n+  --> $DIR/issue-106991.rs:5:13\n+   |\n+LL | fn bar() -> impl Iterator<Item = i32> {\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^ expected `()`, found `i32`\n+   |\n+   = note: required for `Map<std::slice::IterMut<'_, Vec<u8>>, for<'a> fn(&'a mut Vec<u8>) {foo}>` to implement `Iterator`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0271`."}, {"sha": "dc1ecbf8424d4cf9abb73e1c68dd42ff2e4c0068", "filename": "tests/ui/lint/lint_map_unit_fn.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Flint_map_unit_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Flint_map_unit_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Flint_map_unit_fn.rs?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -0,0 +1,20 @@\n+#![deny(map_unit_fn)]\n+\n+fn foo(items: &mut Vec<u8>) {\n+    items.sort();\n+}\n+\n+fn main() {\n+    let mut x: Vec<Vec<u8>> = vec![vec![0, 2, 1], vec![5, 4, 3]];\n+    x.iter_mut().map(foo);\n+    //~^ ERROR `Iterator::map` call that discard the iterator's values\n+    x.iter_mut().map(|items| {\n+    //~^ ERROR `Iterator::map` call that discard the iterator's values\n+        items.sort();\n+    });\n+    let f = |items: &mut Vec<u8>| {\n+        items.sort();\n+    };\n+    x.iter_mut().map(f);\n+    //~^ ERROR `Iterator::map` call that discard the iterator's values\n+}"}, {"sha": "fbf689c54219ebe29782ea688bbe7f3b3163c759", "filename": "tests/ui/lint/lint_map_unit_fn.stderr", "status": "added", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Flint_map_unit_fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fa10a21bd26cf5031c0ca878587839b9296629eb/tests%2Fui%2Flint%2Flint_map_unit_fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Flint_map_unit_fn.stderr?ref=fa10a21bd26cf5031c0ca878587839b9296629eb", "patch": "@@ -0,0 +1,66 @@\n+error: `Iterator::map` call that discard the iterator's values\n+  --> $DIR/lint_map_unit_fn.rs:9:18\n+   |\n+LL | fn foo(items: &mut Vec<u8>) {\n+   | --------------------------- this function returns `()`, which is likely not what you wanted\n+...\n+LL |     x.iter_mut().map(foo);\n+   |                  ^^^^---^\n+   |                  |   |\n+   |                  |   called `Iterator::map` with callable that returns `()`\n+   |                  after this call to map, the resulting iterator is `impl Iterator<Item = ()>`, which means the only information carried by the iterator is the number of items\n+   |\n+   = note: `Iterator::map`, like many of the methods on `Iterator`, gets executed lazily, meaning that its effects won't be visible until it is iterated\n+note: the lint level is defined here\n+  --> $DIR/lint_map_unit_fn.rs:1:9\n+   |\n+LL | #![deny(map_unit_fn)]\n+   |         ^^^^^^^^^^^\n+help: you might have meant to use `Iterator::for_each`\n+   |\n+LL |     x.iter_mut().for_each(foo);\n+   |                  ~~~~~~~~\n+\n+error: `Iterator::map` call that discard the iterator's values\n+  --> $DIR/lint_map_unit_fn.rs:11:18\n+   |\n+LL |         x.iter_mut().map(|items| {\n+   |                      ^   -------\n+   |                      |   |\n+   |  ____________________|___this function returns `()`, which is likely not what you wanted\n+   | |  __________________|\n+   | | |\n+LL | | |\n+LL | | |         items.sort();\n+LL | | |     });\n+   | | |     -^ after this call to map, the resulting iterator is `impl Iterator<Item = ()>`, which means the only information carried by the iterator is the number of items\n+   | | |_____||\n+   | |_______|\n+   |         called `Iterator::map` with callable that returns `()`\n+   |\n+   = note: `Iterator::map`, like many of the methods on `Iterator`, gets executed lazily, meaning that its effects won't be visible until it is iterated\n+help: you might have meant to use `Iterator::for_each`\n+   |\n+LL |     x.iter_mut().for_each(|items| {\n+   |                  ~~~~~~~~\n+\n+error: `Iterator::map` call that discard the iterator's values\n+  --> $DIR/lint_map_unit_fn.rs:18:18\n+   |\n+LL |     let f = |items: &mut Vec<u8>| {\n+   |             --------------------- this function returns `()`, which is likely not what you wanted\n+...\n+LL |     x.iter_mut().map(f);\n+   |                  ^^^^-^\n+   |                  |   |\n+   |                  |   called `Iterator::map` with callable that returns `()`\n+   |                  after this call to map, the resulting iterator is `impl Iterator<Item = ()>`, which means the only information carried by the iterator is the number of items\n+   |\n+   = note: `Iterator::map`, like many of the methods on `Iterator`, gets executed lazily, meaning that its effects won't be visible until it is iterated\n+help: you might have meant to use `Iterator::for_each`\n+   |\n+LL |     x.iter_mut().for_each(f);\n+   |                  ~~~~~~~~\n+\n+error: aborting due to 3 previous errors\n+"}]}