{"sha": "717c64e18884c20a11603f181b207ff280b13f9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxN2M2NGUxODg4NGMyMGExMTYwM2YxODFiMjA3ZmYyODBiMTNmOWE=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-09-17T23:25:25Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-09-28T14:06:51Z"}, "message": "Silence \"skipping const checks\" if outside a const context", "tree": {"sha": "987e690e8eadc51d7e25e547e482216516de30c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/987e690e8eadc51d7e25e547e482216516de30c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/717c64e18884c20a11603f181b207ff280b13f9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/717c64e18884c20a11603f181b207ff280b13f9a", "html_url": "https://github.com/rust-lang/rust/commit/717c64e18884c20a11603f181b207ff280b13f9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/717c64e18884c20a11603f181b207ff280b13f9a/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3c8eba643a815d720e7f20699b3dca144c845c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3c8eba643a815d720e7f20699b3dca144c845c4", "html_url": "https://github.com/rust-lang/rust/commit/f3c8eba643a815d720e7f20699b3dca144c845c4"}], "stats": {"total": 36, "additions": 6, "deletions": 30}, "files": [{"sha": "cce2c9f5ee9c40bf5bc1c81e06c639d517964d10", "filename": "src/librustc_mir/transform/qualify_consts.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/717c64e18884c20a11603f181b207ff280b13f9a/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/717c64e18884c20a11603f181b207ff280b13f9a/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs?ref=717c64e18884c20a11603f181b207ff280b13f9a", "patch": "@@ -678,7 +678,9 @@ struct Checker<'a, 'tcx> {\n macro_rules! unleash_miri {\n     ($this:expr) => {{\n         if $this.tcx.sess.opts.debugging_opts.unleash_the_miri_inside_of_you {\n-            $this.tcx.sess.span_warn($this.span, \"skipping const checks\");\n+            if $this.mode.requires_const_checking() {\n+                $this.tcx.sess.span_warn($this.span, \"skipping const checks\");\n+            }\n             return;\n         }\n     }}"}, {"sha": "f81c78a8221a1b4f460dafe02b91bbbb14f7b316", "filename": "src/test/ui/consts/miri_unleashed/mutable_references.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references.rs", "raw_url": "https://github.com/rust-lang/rust/raw/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references.rs?ref=717c64e18884c20a11603f181b207ff280b13f9a", "patch": "@@ -27,9 +27,7 @@ static OH_YES: &mut i32 = &mut 42;\n \n fn main() {\n     unsafe {\n-        *MEH.x.get() = 99; //~ WARN skipping const checks\n-        //~^ WARN skipping const checks\n+        *MEH.x.get() = 99;\n     }\n     *OH_YES = 99; //~ ERROR cannot assign to `*OH_YES`, as `OH_YES` is an immutable static item\n-    //~^ WARN skipping const checks\n }"}, {"sha": "12840e00df9b3b734696b43b970f2539e2b1b4a9", "filename": "src/test/ui/consts/miri_unleashed/mutable_references.stderr", "status": "modified", "additions": 1, "deletions": 19, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references.stderr?ref=717c64e18884c20a11603f181b207ff280b13f9a", "patch": "@@ -1,23 +1,5 @@\n-warning: skipping const checks\n-  --> $DIR/mutable_references.rs:30:10\n-   |\n-LL |         *MEH.x.get() = 99;\n-   |          ^^^^^\n-\n-warning: skipping const checks\n-  --> $DIR/mutable_references.rs:30:9\n-   |\n-LL |         *MEH.x.get() = 99;\n-   |         ^^^^^^^^^^^^^^^^^\n-\n-warning: skipping const checks\n-  --> $DIR/mutable_references.rs:33:5\n-   |\n-LL |     *OH_YES = 99;\n-   |     ^^^^^^^^^^^^\n-\n error[E0594]: cannot assign to `*OH_YES`, as `OH_YES` is an immutable static item\n-  --> $DIR/mutable_references.rs:33:5\n+  --> $DIR/mutable_references.rs:32:5\n    |\n LL |     *OH_YES = 99;\n    |     ^^^^^^^^^^^^ cannot assign"}, {"sha": "b051f6b59c46ebd0f43d0a1d319ee7cb68534ce0", "filename": "src/test/ui/consts/miri_unleashed/mutable_references_ice.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references_ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references_ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references_ice.rs?ref=717c64e18884c20a11603f181b207ff280b13f9a", "patch": "@@ -24,6 +24,6 @@ const MUH: Meh = Meh {\n \n fn main() {\n     unsafe {\n-        *MUH.x.get() = 99; //~ WARN skipping const checks\n+        *MUH.x.get() = 99;\n     }\n }"}, {"sha": "24c9de5ee2ecaba20d38b33b4287cfce7c5be1d7", "filename": "src/test/ui/consts/miri_unleashed/mutable_references_ice.stderr", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references_ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/717c64e18884c20a11603f181b207ff280b13f9a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references_ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_references_ice.stderr?ref=717c64e18884c20a11603f181b207ff280b13f9a", "patch": "@@ -1,9 +1,3 @@\n-warning: skipping const checks\n-  --> $DIR/mutable_references_ice.rs:27:9\n-   |\n-LL |         *MUH.x.get() = 99;\n-   |         ^^^^^^^^^^^^^^^^^\n-\n thread 'rustc' panicked at 'assertion failed: `(left != right)`\n   left: `Const`,\n  right: `Const`: UnsafeCells are not allowed behind references in constants. This should have been prevented statically by const qualification. If this were allowed one would be able to change a constant at one use site and other use sites could observe that mutation.', src/librustc_mir/interpret/intern.rs:LL:CC"}]}