{"sha": "42010a23f54c8486b77f97862dff02288cc10800", "node_id": "C_kwDOAAsO6NoAKDQyMDEwYTIzZjU0Yzg0ODZiNzdmOTc4NjJkZmYwMjI4OGNjMTA4MDA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-26T09:39:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-26T09:39:10Z"}, "message": "Rollup merge of #104675 - SarthakSingh31:issue-101666, r=jyn514\n\nUnsupported query error now specifies if its unsupported for local or external crate\n\nFixes #101666.\nI had to move `keys.rs` from `rustc_query_impl` to `rustc_middle`. I don't know if that is problematic. I couldn't think of any other way to get the needed information inside `rustc_middle`.\n\nr? ```@jyn514```", "tree": {"sha": "253576f313264ca953d30b79b4f82b0fa6fc2c14", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/253576f313264ca953d30b79b4f82b0fa6fc2c14"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/42010a23f54c8486b77f97862dff02288cc10800", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjgd6+CRBK7hj4Ov3rIwAAezoIAEooDFS4khnJJDHJ6wE+MH1b\nvDx/sNhvGSwiCfQ0sY6kmJMhPgMx+mO0ZF9jXr40IPUWnEy2hZSIzJPY+nTNtIOr\nLyxMnAqffNLkqx3w4HWHWxNHMcLHaDwdyuV+BWDl7GeYqgGfsPPqzKJo7kLzUaln\nEohLQzd6gXRgamyTB1gq/PibjYV3umbA6FYHx8LDSi8EBNC+GIcAh+3ZfK/Aog0Z\n/kmTwAegKI6QCM4OBy8dkM4YUgp2oTwIq1/GkE1kmmhHIv6OE6bC8Es1DPa28f3x\nQoph4exAJu5zmxsOkfm7DlgjJaSxhFHQOh2kKxPxWEI1cLFw1LsCEws/MLJjg3I=\n=0g2t\n-----END PGP SIGNATURE-----\n", "payload": "tree 253576f313264ca953d30b79b4f82b0fa6fc2c14\nparent 4733312e09c04fec3626ea27083da615d1a1df4d\nparent 1767f9f9bfd63676cee998ea086968ab5f047866\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1669455550 +0100\ncommitter GitHub <noreply@github.com> 1669455550 +0100\n\nRollup merge of #104675 - SarthakSingh31:issue-101666, r=jyn514\n\nUnsupported query error now specifies if its unsupported for local or external crate\n\nFixes #101666.\nI had to move `keys.rs` from `rustc_query_impl` to `rustc_middle`. I don't know if that is problematic. I couldn't think of any other way to get the needed information inside `rustc_middle`.\n\nr? ```@jyn514```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/42010a23f54c8486b77f97862dff02288cc10800", "html_url": "https://github.com/rust-lang/rust/commit/42010a23f54c8486b77f97862dff02288cc10800", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/42010a23f54c8486b77f97862dff02288cc10800/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4733312e09c04fec3626ea27083da615d1a1df4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/4733312e09c04fec3626ea27083da615d1a1df4d", "html_url": "https://github.com/rust-lang/rust/commit/4733312e09c04fec3626ea27083da615d1a1df4d"}, {"sha": "1767f9f9bfd63676cee998ea086968ab5f047866", "url": "https://api.github.com/repos/rust-lang/rust/commits/1767f9f9bfd63676cee998ea086968ab5f047866", "html_url": "https://github.com/rust-lang/rust/commit/1767f9f9bfd63676cee998ea086968ab5f047866"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "afbc9eb0512beb11b387d53908ad0076bb54c49b", "filename": "compiler/rustc_middle/src/ty/query.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/42010a23f54c8486b77f97862dff02288cc10800/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42010a23f54c8486b77f97862dff02288cc10800/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs?ref=42010a23f54c8486b77f97862dff02288cc10800", "patch": "@@ -276,13 +276,16 @@ macro_rules! define_callbacks {\n \n         impl Default for Providers {\n             fn default() -> Self {\n+                use crate::query::Key;\n+\n                 Providers {\n                     $($name: |_, key| bug!(\n-                        \"`tcx.{}({:?})` is not supported for external or local crate;\\n\n-                        hint: Queries can be either made to the local crate, or the external crate. This error means you tried to use it for one that's not supported (likely the local crate).\\n\n+                        \"`tcx.{}({:?})` is not supported for {} crate;\\n\n+                        hint: Queries can be either made to the local crate, or the external crate. This error means you tried to use it for one that's not supported.\\n\n                         If that's not the case, {} was likely never assigned to a provider function.\\n\",\n                         stringify!($name),\n                         key,\n+                        if key.query_crate_is_local() { \"local\" } else { \"external\" },\n                         stringify!($name),\n                     ),)*\n                 }"}, {"sha": "d426a2b6b78a0655220e6785f4b390a87f0d4b05", "filename": "compiler/rustc_query_impl/src/lib.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/42010a23f54c8486b77f97862dff02288cc10800/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42010a23f54c8486b77f97862dff02288cc10800/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs?ref=42010a23f54c8486b77f97862dff02288cc10800", "patch": "@@ -20,6 +20,7 @@ extern crate rustc_middle;\n use rustc_data_structures::sync::AtomicU64;\n use rustc_middle::arena::Arena;\n use rustc_middle::dep_graph::{self, DepKindStruct};\n+use rustc_middle::query::Key;\n use rustc_middle::ty::query::{query_keys, query_storage, query_stored, query_values};\n use rustc_middle::ty::query::{ExternProviders, Providers, QueryEngine};\n use rustc_middle::ty::TyCtxt;\n@@ -32,8 +33,6 @@ use rustc_query_system::query::*;\n #[cfg(parallel_compiler)]\n pub use rustc_query_system::query::{deadlock, QueryContext};\n \n-use rustc_middle::query::Key;\n-\n pub use rustc_query_system::query::QueryConfig;\n pub(crate) use rustc_query_system::query::QueryVTable;\n "}]}