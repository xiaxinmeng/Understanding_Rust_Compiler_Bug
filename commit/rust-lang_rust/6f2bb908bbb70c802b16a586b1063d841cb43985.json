{"sha": "6f2bb908bbb70c802b16a586b1063d841cb43985", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmMmJiOTA4YmJiNzBjODAyYjE2YTU4NmIxMDYzZDg0MWNiNDM5ODU=", "commit": {"author": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2016-03-16T17:06:25Z"}, "committer": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2016-03-16T17:06:25Z"}, "message": "Merge pull request #866 from rust-lang-nursery/empty-extern\n\nKeep empty extern blocks on one line", "tree": {"sha": "4c6c2df520c091c4330fc02d77f4dcaa2eec6cea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c6c2df520c091c4330fc02d77f4dcaa2eec6cea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f2bb908bbb70c802b16a586b1063d841cb43985", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f2bb908bbb70c802b16a586b1063d841cb43985", "html_url": "https://github.com/rust-lang/rust/commit/6f2bb908bbb70c802b16a586b1063d841cb43985", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f2bb908bbb70c802b16a586b1063d841cb43985/comments", "author": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "73f5f4a213defa6909b8d5ed72a1434629b9da44", "url": "https://api.github.com/repos/rust-lang/rust/commits/73f5f4a213defa6909b8d5ed72a1434629b9da44", "html_url": "https://github.com/rust-lang/rust/commit/73f5f4a213defa6909b8d5ed72a1434629b9da44"}, {"sha": "96a2f25788ebda721bdd52de9e6c178ed364a5aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/96a2f25788ebda721bdd52de9e6c178ed364a5aa", "html_url": "https://github.com/rust-lang/rust/commit/96a2f25788ebda721bdd52de9e6c178ed364a5aa"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "b879080d92f42b924652d9a0389d20c6d40e2b01", "filename": "src/items.rs", "status": "modified", "additions": 14, "deletions": 9, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/6f2bb908bbb70c802b16a586b1063d841cb43985/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f2bb908bbb70c802b16a586b1063d841cb43985/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=6f2bb908bbb70c802b16a586b1063d841cb43985", "patch": "@@ -84,19 +84,24 @@ impl<'a> FmtVisitor<'a> {\n         self.buffer.push_str(&::utils::format_abi(fm.abi));\n \n         let snippet = self.snippet(span);\n-        let brace_pos = snippet.find_uncommented(\"{\").unwrap() as u32;\n+        let brace_pos = snippet.find_uncommented(\"{\").unwrap();\n \n-        // FIXME: this skips comments between the extern keyword and the opening\n-        // brace.\n-        self.last_pos = span.lo + BytePos(brace_pos);\n-        self.block_indent = self.block_indent.block_indent(self.config);\n+        if fm.items.is_empty() && !contains_comment(&snippet[brace_pos..]) {\n+            self.buffer.push_str(\"{\");\n+        } else {\n+            // FIXME: this skips comments between the extern keyword and the opening\n+            // brace.\n+            self.last_pos = span.lo + BytePos(brace_pos as u32);\n+            self.block_indent = self.block_indent.block_indent(self.config);\n \n-        for item in &fm.items {\n-            self.format_foreign_item(&*item);\n+            for item in &fm.items {\n+                self.format_foreign_item(&*item);\n+            }\n+\n+            self.block_indent = self.block_indent.block_unindent(self.config);\n+            self.format_missing_with_indent(span.hi - BytePos(1));\n         }\n \n-        self.block_indent = self.block_indent.block_unindent(self.config);\n-        self.format_missing_with_indent(span.hi - BytePos(1));\n         self.buffer.push_str(\"}\");\n         self.last_pos = span.hi;\n     }"}, {"sha": "347612dd8f1aa954527c705959801bb822ad8edb", "filename": "tests/source/extern.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6f2bb908bbb70c802b16a586b1063d841cb43985/tests%2Fsource%2Fextern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f2bb908bbb70c802b16a586b1063d841cb43985/tests%2Fsource%2Fextern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fextern.rs?ref=6f2bb908bbb70c802b16a586b1063d841cb43985", "patch": "@@ -34,3 +34,7 @@ libc::c_long;\n                                file: *mut FILE)\n                               -> *mut FILE;\n    }\n+\n+extern {\n+\n+}"}, {"sha": "e25e8b01cd4b9469bc14ca6e1e1d72252388d0b1", "filename": "tests/target/extern.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6f2bb908bbb70c802b16a586b1063d841cb43985/tests%2Ftarget%2Fextern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f2bb908bbb70c802b16a586b1063d841cb43985/tests%2Ftarget%2Fextern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fextern.rs?ref=6f2bb908bbb70c802b16a586b1063d841cb43985", "patch": "@@ -45,3 +45,5 @@ extern \"C\" {\n                    file: *mut FILE)\n                    -> *mut FILE;\n }\n+\n+extern \"C\" {}"}]}