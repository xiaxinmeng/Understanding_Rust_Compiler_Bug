{"sha": "0e594939aa032c074df925d03c7d1289d6c2efc2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlNTk0OTM5YWEwMzJjMDc0ZGY5MjVkMDNjN2QxMjg5ZDZjMmVmYzI=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-07-12T18:21:14Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-07-12T18:21:14Z"}, "message": "Fix potential use-before-init bug in trans\n\nThis was being masked by a bug in typestate (fixed in the next commit).", "tree": {"sha": "e03079cc37f8b087f2243bc62136f33e309eaa67", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e03079cc37f8b087f2243bc62136f33e309eaa67"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e594939aa032c074df925d03c7d1289d6c2efc2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e594939aa032c074df925d03c7d1289d6c2efc2", "html_url": "https://github.com/rust-lang/rust/commit/0e594939aa032c074df925d03c7d1289d6c2efc2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e594939aa032c074df925d03c7d1289d6c2efc2/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bde52808f0fa6d44b7d738ba2e79a4192ccdd54b", "url": "https://api.github.com/repos/rust-lang/rust/commits/bde52808f0fa6d44b7d738ba2e79a4192ccdd54b", "html_url": "https://github.com/rust-lang/rust/commit/bde52808f0fa6d44b7d738ba2e79a4192ccdd54b"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "592757014316707eccadc1944febb69d7765c6ce", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0e594939aa032c074df925d03c7d1289d6c2efc2/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e594939aa032c074df925d03c7d1289d6c2efc2/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=0e594939aa032c074df925d03c7d1289d6c2efc2", "patch": "@@ -7129,7 +7129,7 @@ fn trans_anon_obj(@block_ctxt bcx, &span sp, &ast::anon_obj anon_obj,\n         methods = anon_obj.methods,\n         dtor = none[@ast::method]);\n \n-    let result with_obj_val;\n+    let option::t[result] with_obj_val = none;\n     let ty::t with_obj_ty;\n     auto vtbl;\n     alt (anon_obj.with_obj) {\n@@ -7155,7 +7155,7 @@ fn trans_anon_obj(@block_ctxt bcx, &span sp, &ast::anon_obj anon_obj,\n             // If with_obj (the object being extended) exists, translate it.\n             // Translating with_obj returns a ValueRef (pointer to a 2-word\n             // value) wrapped in a result.\n-            with_obj_val = trans_expr(bcx, e);\n+            with_obj_val = some(trans_expr(bcx, e));\n \n             // TODO: What makes more sense to get the type of an expr --\n             // calling ty::expr_ty(ccx.tcx, e) on it or calling\n@@ -7332,9 +7332,13 @@ fn trans_anon_obj(@block_ctxt bcx, &span sp, &ast::anon_obj anon_obj,\n             GEP_tup_like(bcx, body_ty, body.val,\n                          ~[0, abi::obj_body_elt_with_obj]);\n         bcx = body_with_obj.bcx;\n-        bcx = copy_val(bcx, INIT, body_with_obj.val,\n-                       with_obj_val.val,\n-                       with_obj_ty).bcx;\n+        alt (with_obj_val) {\n+            case (some(?v)) {\n+                bcx = copy_val(bcx, INIT, body_with_obj.val,\n+                               v.val, with_obj_ty).bcx;\n+            }\n+            case (_) {}\n+        }\n \n         // Store box ptr in outer pair.\n         auto p = bcx.build.PointerCast(box.val, llbox_ty);"}]}