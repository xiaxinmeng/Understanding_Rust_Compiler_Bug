{"sha": "acb7ed141be1ea5b4c7120708d7a48d9155fb38c", "node_id": "C_kwDOAAsO6NoAKGFjYjdlZDE0MWJlMWVhNWI0YzcxMjA3MDhkN2E0OGQ5MTU1ZmIzOGM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-03-20T08:14:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-20T08:14:58Z"}, "message": "Rollup merge of #94749 - RalfJung:remove-dir-all-miri, r=cuviper\n\nremove_dir_all: use fallback implementation on Miri\n\nFixes https://github.com/rust-lang/miri/issues/1966\n\nThe new implementation requires `openat`, `unlinkat`, and `fdopendir`. These cannot easily be shimmed in Miri since libstd does not expose APIs corresponding to them. So for now it is probably easiest to just use the fallback code in Miri. Nobody should run Miri as root anyway...", "tree": {"sha": "6fcea6593d78e2d5609648d3e9e3a03a343c727b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6fcea6593d78e2d5609648d3e9e3a03a343c727b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/acb7ed141be1ea5b4c7120708d7a48d9155fb38c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiNuKDCRBK7hj4Ov3rIwAAKecIAK8F6wTCoQ4TXlT//YfZx3hH\n0GHs/BPsxRIAqpg+W8eHbGagWHKl13A9gTU2QxkD+kSpyMrKMo0bYkF3hT1a7hJR\nosAutH1s36fDZHqyLw08GwBgyLq7fs/SLjpD8NOfigxg5OJ2OhAIrEcYT5KpMyQv\nPMMMB9wqirRFioyHzxNqe3HKsuN0vzE6abxUY9yAF4zIjCHf4/lMWW4agKdlfbkR\ngFHGXV0HobuyOnOB9MwdVkGvIhcokPNoUCrg1O5f4l1kAwhMKE4sMUr6KFakLklE\nwnMTU93uzKJvjOhfYmYe3O9uGC2YYYxhXl4DFhcsiLYrIthaCc3cFTi/yOOrCIo=\n=pfUp\n-----END PGP SIGNATURE-----\n", "payload": "tree 6fcea6593d78e2d5609648d3e9e3a03a343c727b\nparent 499d4a56840e3760905fbda95550553281828dc6\nparent 28eb06bd98169c985f4951b6aaf6855d52ffd514\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1647764098 +0100\ncommitter GitHub <noreply@github.com> 1647764098 +0100\n\nRollup merge of #94749 - RalfJung:remove-dir-all-miri, r=cuviper\n\nremove_dir_all: use fallback implementation on Miri\n\nFixes https://github.com/rust-lang/miri/issues/1966\n\nThe new implementation requires `openat`, `unlinkat`, and `fdopendir`. These cannot easily be shimmed in Miri since libstd does not expose APIs corresponding to them. So for now it is probably easiest to just use the fallback code in Miri. Nobody should run Miri as root anyway...\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/acb7ed141be1ea5b4c7120708d7a48d9155fb38c", "html_url": "https://github.com/rust-lang/rust/commit/acb7ed141be1ea5b4c7120708d7a48d9155fb38c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/acb7ed141be1ea5b4c7120708d7a48d9155fb38c/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "499d4a56840e3760905fbda95550553281828dc6", "url": "https://api.github.com/repos/rust-lang/rust/commits/499d4a56840e3760905fbda95550553281828dc6", "html_url": "https://github.com/rust-lang/rust/commit/499d4a56840e3760905fbda95550553281828dc6"}, {"sha": "28eb06bd98169c985f4951b6aaf6855d52ffd514", "url": "https://api.github.com/repos/rust-lang/rust/commits/28eb06bd98169c985f4951b6aaf6855d52ffd514", "html_url": "https://github.com/rust-lang/rust/commit/28eb06bd98169c985f4951b6aaf6855d52ffd514"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "d4e103ab525e8b880ebe1750e8826235bc32c090", "filename": "library/std/src/fs.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/acb7ed141be1ea5b4c7120708d7a48d9155fb38c/library%2Fstd%2Fsrc%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acb7ed141be1ea5b4c7120708d7a48d9155fb38c/library%2Fstd%2Fsrc%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Ffs.rs?ref=acb7ed141be1ea5b4c7120708d7a48d9155fb38c", "patch": "@@ -2049,9 +2049,10 @@ pub fn remove_dir<P: AsRef<Path>>(path: P) -> io::Result<()> {\n ///\n /// [changes]: io#platform-specific-behavior\n ///\n-/// On macOS before version 10.10 and REDOX this function is not protected against time-of-check to\n-/// time-of-use (TOCTOU) race conditions, and should not be used in security-sensitive code on\n-/// those platforms. All other platforms are protected.\n+/// On macOS before version 10.10 and REDOX, as well as when running in Miri for any target, this\n+/// function is not protected against time-of-check to time-of-use (TOCTOU) race conditions, and\n+/// should not be used in security-sensitive code on those platforms. All other platforms are\n+/// protected.\n ///\n /// # Errors\n ///"}, {"sha": "b93a3d677711f75bee4115c1ea41acad072f81ab", "filename": "library/std/src/sys/unix/fs.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/acb7ed141be1ea5b4c7120708d7a48d9155fb38c/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acb7ed141be1ea5b4c7120708d7a48d9155fb38c/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs?ref=acb7ed141be1ea5b4c7120708d7a48d9155fb38c", "patch": "@@ -1517,14 +1517,14 @@ pub fn chroot(dir: &Path) -> io::Result<()> {\n \n pub use remove_dir_impl::remove_dir_all;\n \n-// Fallback for REDOX and ESP-IDF\n-#[cfg(any(target_os = \"redox\", target_os = \"espidf\"))]\n+// Fallback for REDOX and ESP-IDF (and Miri)\n+#[cfg(any(target_os = \"redox\", target_os = \"espidf\", miri))]\n mod remove_dir_impl {\n     pub use crate::sys_common::fs::remove_dir_all;\n }\n \n // Modern implementation using openat(), unlinkat() and fdopendir()\n-#[cfg(not(any(target_os = \"redox\", target_os = \"espidf\")))]\n+#[cfg(not(any(target_os = \"redox\", target_os = \"espidf\", miri)))]\n mod remove_dir_impl {\n     use super::{cstr, lstat, Dir, DirEntry, InnerReadDir, ReadDir};\n     use crate::ffi::CStr;"}]}