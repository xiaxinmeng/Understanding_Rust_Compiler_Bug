{"sha": "5e8e97f98115191bca09600491d3687e9cf2e8fb", "node_id": "C_kwDOAAsO6NoAKDVlOGU5N2Y5ODExNTE5MWJjYTA5NjAwNDkxZDM2ODdlOWNmMmU4ZmI", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-01-09T03:57:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-09T03:57:56Z"}, "message": "Rollup merge of #106606 - estebank:bad-nested-turbofish, r=compiler-errors\n\nDo not emit structured suggestion for turbofish with wrong span\n\nFix #79161.", "tree": {"sha": "70970b8d512c1f88c62d13cfbec27794a1879f02", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/70970b8d512c1f88c62d13cfbec27794a1879f02"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e8e97f98115191bca09600491d3687e9cf2e8fb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJju5DECRBK7hj4Ov3rIwAAPWMIADk6IxUvR9uMldr8e0l1MpcF\nHqrTCZbtQ/nc/gQkbgrTV5eIbQrdIOaWKNom6Endp9fppO0kdvX1XxESZdpZ0gt/\nhEvjdvOyzCeWWZn2MIDNkiZbfvAzpzlL+n51Vfl/eK6lE/TTQmcZEzgu7KYl19PH\nESYhHjAaRh0pQC3Z+lFXqZQ4z79oPhUMAdYXpnDlgF4pmYIt3FyPqom4omcf+HiQ\nmGHJEns2w5llmG4XeruG9j5rTDGTl8uIxK9DfFoKWA3smgiZDCPb/OXBcuCv5h83\nXUXFx7Z1X2avdo8vKLxUQ5/dmjcNx6l04lAQQiROPXdMDrIqi8Z9qFWB0HwgVgE=\n=GJ9K\n-----END PGP SIGNATURE-----\n", "payload": "tree 70970b8d512c1f88c62d13cfbec27794a1879f02\nparent bb6a88ad5edee0812f61b41a5d41ca794eb3f979\nparent 6fdb54d2f103dc21197037e6b1ad0b51073b9627\nauthor Michael Goulet <michael@errs.io> 1673236676 -0800\ncommitter GitHub <noreply@github.com> 1673236676 -0800\n\nRollup merge of #106606 - estebank:bad-nested-turbofish, r=compiler-errors\n\nDo not emit structured suggestion for turbofish with wrong span\n\nFix #79161.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e8e97f98115191bca09600491d3687e9cf2e8fb", "html_url": "https://github.com/rust-lang/rust/commit/5e8e97f98115191bca09600491d3687e9cf2e8fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e8e97f98115191bca09600491d3687e9cf2e8fb/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "html_url": "https://github.com/rust-lang/rust/commit/bb6a88ad5edee0812f61b41a5d41ca794eb3f979"}, {"sha": "6fdb54d2f103dc21197037e6b1ad0b51073b9627", "url": "https://api.github.com/repos/rust-lang/rust/commits/6fdb54d2f103dc21197037e6b1ad0b51073b9627", "html_url": "https://github.com/rust-lang/rust/commit/6fdb54d2f103dc21197037e6b1ad0b51073b9627"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "d9fa3e31db97226cdb4bebcf81cb0d24042c3387", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5e8e97f98115191bca09600491d3687e9cf2e8fb/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e8e97f98115191bca09600491d3687e9cf2e8fb/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=5e8e97f98115191bca09600491d3687e9cf2e8fb", "patch": "@@ -1104,7 +1104,11 @@ impl<'a> Parser<'a> {\n                     return if token::ModSep == self.token.kind {\n                         // We have some certainty that this was a bad turbofish at this point.\n                         // `foo< bar >::`\n-                        err.suggest_turbofish = Some(op.span.shrink_to_lo());\n+                        if let ExprKind::Binary(o, ..) = inner_op.kind && o.node == BinOpKind::Lt {\n+                            err.suggest_turbofish = Some(op.span.shrink_to_lo());\n+                        } else {\n+                            err.help_turbofish = Some(());\n+                        }\n \n                         let snapshot = self.create_snapshot_for_diagnostic();\n                         self.bump(); // `::`\n@@ -1130,7 +1134,11 @@ impl<'a> Parser<'a> {\n                     } else if token::OpenDelim(Delimiter::Parenthesis) == self.token.kind {\n                         // We have high certainty that this was a bad turbofish at this point.\n                         // `foo< bar >(`\n-                        err.suggest_turbofish = Some(op.span.shrink_to_lo());\n+                        if let ExprKind::Binary(o, ..) = inner_op.kind && o.node == BinOpKind::Lt {\n+                            err.suggest_turbofish = Some(op.span.shrink_to_lo());\n+                        } else {\n+                            err.help_turbofish = Some(());\n+                        }\n                         // Consume the fn call arguments.\n                         match self.consume_fn_args() {\n                             Err(()) => Err(err.into_diagnostic(&self.sess.span_diagnostic)),"}, {"sha": "02099fde21213bcfe1d1b3f9f24be4703d286dcf", "filename": "src/test/ui/parser/nested-bad-turbofish.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5e8e97f98115191bca09600491d3687e9cf2e8fb/src%2Ftest%2Fui%2Fparser%2Fnested-bad-turbofish.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e8e97f98115191bca09600491d3687e9cf2e8fb/src%2Ftest%2Fui%2Fparser%2Fnested-bad-turbofish.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fnested-bad-turbofish.rs?ref=5e8e97f98115191bca09600491d3687e9cf2e8fb", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    foo<<S as T>::V>(); //~ ERROR\n+}"}, {"sha": "d82fa80e594adda49347d882eee0c60711a2faf7", "filename": "src/test/ui/parser/nested-bad-turbofish.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5e8e97f98115191bca09600491d3687e9cf2e8fb/src%2Ftest%2Fui%2Fparser%2Fnested-bad-turbofish.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e8e97f98115191bca09600491d3687e9cf2e8fb/src%2Ftest%2Fui%2Fparser%2Fnested-bad-turbofish.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fnested-bad-turbofish.stderr?ref=5e8e97f98115191bca09600491d3687e9cf2e8fb", "patch": "@@ -0,0 +1,11 @@\n+error: comparison operators cannot be chained\n+  --> $DIR/nested-bad-turbofish.rs:2:16\n+   |\n+LL |     foo<<S as T>::V>();\n+   |                ^   ^\n+   |\n+   = help: use `::<...>` instead of `<...>` to specify lifetime, type, or const arguments\n+   = help: or use `(...)` if you meant to specify fn arguments\n+\n+error: aborting due to previous error\n+"}]}