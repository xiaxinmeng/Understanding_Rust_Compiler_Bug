{"sha": "54be5b044f71ca9e191b26b2e65ff6541f377358", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0YmU1YjA0NGY3MWNhOWUxOTFiMjZiMmU2NWZmNjU0MWYzNzczNTg=", "commit": {"author": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-07-22T23:05:26Z"}, "committer": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-07-22T23:05:51Z"}, "message": "Fixing (or at least improving) translation of move semantics for send and receive. This let's us run all of the task-comm tests.", "tree": {"sha": "5642938a86a2496eef5d6f8f79aec461b325fbea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5642938a86a2496eef5d6f8f79aec461b325fbea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54be5b044f71ca9e191b26b2e65ff6541f377358", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54be5b044f71ca9e191b26b2e65ff6541f377358", "html_url": "https://github.com/rust-lang/rust/commit/54be5b044f71ca9e191b26b2e65ff6541f377358", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54be5b044f71ca9e191b26b2e65ff6541f377358/comments", "author": null, "committer": null, "parents": [{"sha": "75ee817713f3352f2f80639c99ee2ec4477dfd66", "url": "https://api.github.com/repos/rust-lang/rust/commits/75ee817713f3352f2f80639c99ee2ec4477dfd66", "html_url": "https://github.com/rust-lang/rust/commit/75ee817713f3352f2f80639c99ee2ec4477dfd66"}], "stats": {"total": 18, "additions": 6, "deletions": 12}, "files": [{"sha": "8fe7ea761e017f7e24a2285bd34b55d0b73dbeec", "filename": "src/comp/middle/trans_comm.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/54be5b044f71ca9e191b26b2e65ff6541f377358/src%2Fcomp%2Fmiddle%2Ftrans_comm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54be5b044f71ca9e191b26b2e65ff6541f377358/src%2Fcomp%2Fmiddle%2Ftrans_comm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_comm.rs?ref=54be5b044f71ca9e191b26b2e65ff6541f377358", "patch": "@@ -216,11 +216,14 @@ fn trans_send(&@block_ctxt cx, &@ast::expr lhs, &@ast::expr rhs,\n     auto data_tmp = move_val_if_temp(bcx, INIT, data_alloc.val,\n                                      data, unit_ty);\n     bcx = data_tmp.bcx;\n-    add_clean_temp(bcx, data_alloc.val, unit_ty);\n     auto llchanval = bcx.build.PointerCast(chn.val, T_opaque_chan_ptr());\n     auto lldataptr = bcx.build.PointerCast(data_alloc.val, T_ptr(T_i8()));\n     bcx.build.Call(bcx.fcx.lcx.ccx.upcalls.send,\n                    ~[bcx.fcx.lltaskptr, llchanval, lldataptr]);\n+\n+    // Deinit the stuff we sent.\n+    bcx = zero_alloca(bcx, data_alloc.val, unit_ty).bcx;\n+\n     ret rslt(bcx, chn.val);\n     auto unit_ty;\n }\n@@ -231,7 +234,6 @@ fn trans_recv(&@block_ctxt cx, &@ast::expr lhs, &@ast::expr rhs,\n     auto data = trans_lval(bcx, rhs);\n     assert (data.is_mem);\n     bcx = data.res.bcx;\n-    auto unit_ty = node_id_type(bcx.fcx.lcx.ccx, id);\n     // FIXME: calculate copy init-ness in typestate.\n \n     auto prt = trans_expr(bcx, lhs);\n@@ -241,13 +243,8 @@ fn trans_recv(&@block_ctxt cx, &@ast::expr lhs, &@ast::expr rhs,\n     auto llportptr = bcx.build.PointerCast(prt.val, T_opaque_port_ptr());\n     bcx.build.Call(bcx.fcx.lcx.ccx.upcalls.recv,\n                    ~[bcx.fcx.lltaskptr, lldataptr, llportptr]);\n-    auto data_load = load_if_immediate(bcx, data.res.val, unit_ty);\n-    //auto cp = copy_val(bcx, DROP_EXISTING,\n-    //                   data.res.val, data_load, unit_ty);\n-    //bcx = cp.bcx;\n \n-    add_clean_temp(cx, data_load, unit_ty);\n-    ret rslt(bcx, data_load);\n+    ret rslt(bcx, data.res.val);\n }\n \n // Does a deep copy of a value. This is needed for passing arguments to child"}, {"sha": "56585ad9ffb000d8ac49b01dc13fccf95b85fdae", "filename": "src/test/run-pass/task-comm-10.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/54be5b044f71ca9e191b26b2e65ff6541f377358/src%2Ftest%2Frun-pass%2Ftask-comm-10.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54be5b044f71ca9e191b26b2e65ff6541f377358/src%2Ftest%2Frun-pass%2Ftask-comm-10.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftask-comm-10.rs?ref=54be5b044f71ca9e191b26b2e65ff6541f377358", "patch": "@@ -23,11 +23,10 @@ fn main() {\n \n     p = port();\n     child = spawn start(chan(p));\n+    auto c;\n \n     p |> c;\n     c <| \"A\";\n     c <| \"B\";\n     task::yield();\n-\n-    auto c;\n }"}, {"sha": "9a240dcf0e92a073051a558a1284097b84a6ec23", "filename": "src/test/run-pass/task-comm-11.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/54be5b044f71ca9e191b26b2e65ff6541f377358/src%2Ftest%2Frun-pass%2Ftask-comm-11.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54be5b044f71ca9e191b26b2e65ff6541f377358/src%2Ftest%2Frun-pass%2Ftask-comm-11.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftask-comm-11.rs?ref=54be5b044f71ca9e191b26b2e65ff6541f377358", "patch": "@@ -1,6 +1,4 @@\n // xfail-stage0\n-// xfail-stage1\n-// xfail-stage2\n // xfail-stage3\n \n fn start(chan[chan[str]] c) {"}]}