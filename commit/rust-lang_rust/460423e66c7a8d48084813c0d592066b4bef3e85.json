{"sha": "460423e66c7a8d48084813c0d592066b4bef3e85", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2MDQyM2U2NmM3YThkNDgwODQ4MTNjMGQ1OTIwNjZiNGJlZjNlODU=", "commit": {"author": {"name": "Phil Ellison", "email": "phil.j.ellison@gmail.com", "date": "2019-07-28T10:35:48Z"}, "committer": {"name": "Phil Ellison", "email": "phil.j.ellison@gmail.com", "date": "2019-07-28T10:35:48Z"}, "message": "Inline snapshots for all tests in presentation.rs", "tree": {"sha": "3ce24d35f6b69bf156cdfd70337549c726ff8f76", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ce24d35f6b69bf156cdfd70337549c726ff8f76"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/460423e66c7a8d48084813c0d592066b4bef3e85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/460423e66c7a8d48084813c0d592066b4bef3e85", "html_url": "https://github.com/rust-lang/rust/commit/460423e66c7a8d48084813c0d592066b4bef3e85", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/460423e66c7a8d48084813c0d592066b4bef3e85/comments", "author": {"login": "theotherphil", "id": 1974256, "node_id": "MDQ6VXNlcjE5NzQyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1974256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theotherphil", "html_url": "https://github.com/theotherphil", "followers_url": "https://api.github.com/users/theotherphil/followers", "following_url": "https://api.github.com/users/theotherphil/following{/other_user}", "gists_url": "https://api.github.com/users/theotherphil/gists{/gist_id}", "starred_url": "https://api.github.com/users/theotherphil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theotherphil/subscriptions", "organizations_url": "https://api.github.com/users/theotherphil/orgs", "repos_url": "https://api.github.com/users/theotherphil/repos", "events_url": "https://api.github.com/users/theotherphil/events{/privacy}", "received_events_url": "https://api.github.com/users/theotherphil/received_events", "type": "User", "site_admin": false}, "committer": {"login": "theotherphil", "id": 1974256, "node_id": "MDQ6VXNlcjE5NzQyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1974256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theotherphil", "html_url": "https://github.com/theotherphil", "followers_url": "https://api.github.com/users/theotherphil/followers", "following_url": "https://api.github.com/users/theotherphil/following{/other_user}", "gists_url": "https://api.github.com/users/theotherphil/gists{/gist_id}", "starred_url": "https://api.github.com/users/theotherphil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theotherphil/subscriptions", "organizations_url": "https://api.github.com/users/theotherphil/orgs", "repos_url": "https://api.github.com/users/theotherphil/repos", "events_url": "https://api.github.com/users/theotherphil/events{/privacy}", "received_events_url": "https://api.github.com/users/theotherphil/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb7d1b0feeca276c485b8325df2851756ef861b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb7d1b0feeca276c485b8325df2851756ef861b4", "html_url": "https://github.com/rust-lang/rust/commit/eb7d1b0feeca276c485b8325df2851756ef861b4"}], "stats": {"total": 329, "additions": 152, "deletions": 177}, "files": [{"sha": "fe7581adfd2fd291d81799038b6d2f44ea4d65d2", "filename": "crates/ra_ide_api/src/completion/presentation.rs", "status": "modified", "additions": 152, "deletions": 57, "changes": 209, "blob_url": "https://github.com/rust-lang/rust/blob/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fpresentation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fpresentation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fpresentation.rs?ref=460423e66c7a8d48084813c0d592066b4bef3e85", "patch": "@@ -183,79 +183,174 @@ impl Completions {\n #[cfg(test)]\n mod tests {\n     use test_utils::covers;\n+    use crate::completion::{do_completion, CompletionItem, CompletionKind};\n+\tuse insta::assert_debug_snapshot_matches;\n \n-    use crate::completion::{check_completion, CompletionKind};\n-\n-    fn check_reference_completion(code: &str, expected_completions: &str) {\n-        check_completion(code, expected_completions, CompletionKind::Reference);\n+    fn do_reference_completion(code: &str) -> Vec<CompletionItem> {\n+        do_completion(code, CompletionKind::Reference)\n     }\n \n     #[test]\n     fn inserts_parens_for_function_calls() {\n         covers!(inserts_parens_for_function_calls);\n-        check_reference_completion(\n-            \"inserts_parens_for_function_calls1\",\n-            r\"\n-            fn no_args() {}\n-            fn main() { no_<|> }\n-            \",\n+        assert_debug_snapshot_matches!(\n+            do_reference_completion(\n+                r\"\n+                fn no_args() {}\n+                fn main() { no_<|> }\n+                \"\n+            ),\n+@r###\"\n+       \u22ee[\n+       \u22ee    CompletionItem {\n+       \u22ee        label: \"main\",\n+       \u22ee        source_range: [61; 64),\n+       \u22ee        delete: [61; 64),\n+       \u22ee        insert: \"main()$0\",\n+       \u22ee        kind: Function,\n+       \u22ee        detail: \"fn main()\",\n+       \u22ee    },\n+       \u22ee    CompletionItem {\n+       \u22ee        label: \"no_args\",\n+       \u22ee        source_range: [61; 64),\n+       \u22ee        delete: [61; 64),\n+       \u22ee        insert: \"no_args()$0\",\n+       \u22ee        kind: Function,\n+       \u22ee        detail: \"fn no_args()\",\n+       \u22ee    },\n+       \u22ee]\n+        \"###\n         );\n-        check_reference_completion(\n-            \"inserts_parens_for_function_calls2\",\n-            r\"\n-            fn with_args(x: i32, y: String) {}\n-            fn main() { with_<|> }\n-            \",\n+        assert_debug_snapshot_matches!(\n+            do_reference_completion(\n+                r\"\n+                fn with_args(x: i32, y: String) {}\n+                fn main() { with_<|> }\n+                \"\n+            ),\n+@r###\"\n+       \u22ee[\n+       \u22ee    CompletionItem {\n+       \u22ee        label: \"main\",\n+       \u22ee        source_range: [80; 85),\n+       \u22ee        delete: [80; 85),\n+       \u22ee        insert: \"main()$0\",\n+       \u22ee        kind: Function,\n+       \u22ee        detail: \"fn main()\",\n+       \u22ee    },\n+       \u22ee    CompletionItem {\n+       \u22ee        label: \"with_args\",\n+       \u22ee        source_range: [80; 85),\n+       \u22ee        delete: [80; 85),\n+       \u22ee        insert: \"with_args($0)\",\n+       \u22ee        kind: Function,\n+       \u22ee        detail: \"fn with_args(x: i32, y: String)\",\n+       \u22ee    },\n+       \u22ee]\n+        \"###\n+        );\n+        assert_debug_snapshot_matches!(\n+            do_reference_completion(\n+                r\"\n+                struct S {}\n+                impl S {\n+                    fn foo(&self) {}\n+                }\n+                fn bar(s: &S) {\n+                    s.f<|>\n+                }\n+                \"\n+            ),\n+@r###\"\n+       \u22ee[\n+       \u22ee    CompletionItem {\n+       \u22ee        label: \"foo\",\n+       \u22ee        source_range: [163; 164),\n+       \u22ee        delete: [163; 164),\n+       \u22ee        insert: \"foo()$0\",\n+       \u22ee        kind: Method,\n+       \u22ee        detail: \"fn foo(&self)\",\n+       \u22ee    },\n+       \u22ee]\n+        \"###\n         );\n-        check_reference_completion(\n-            \"inserts_parens_for_function_calls3\",\n-            r\"\n-            struct S {}\n-            impl S {\n-                fn foo(&self) {}\n-            }\n-            fn bar(s: &S) {\n-                s.f<|>\n-            }\n-            \",\n-        )\n     }\n \n     #[test]\n     fn dont_render_function_parens_in_use_item() {\n-        check_reference_completion(\n-            \"dont_render_function_parens_in_use_item\",\n-            \"\n-            //- /lib.rs\n-            mod m { pub fn foo() {} }\n-            use crate::m::f<|>;\n-            \",\n-        )\n+        assert_debug_snapshot_matches!(\n+            do_reference_completion(\n+                \"\n+                //- /lib.rs\n+                mod m { pub fn foo() {} }\n+                use crate::m::f<|>;\n+                \"\n+            ),\n+@r#\"[\n+    CompletionItem {\n+        label: \"foo\",\n+        source_range: [40; 41),\n+        delete: [40; 41),\n+        insert: \"foo\",\n+        kind: Function,\n+        detail: \"pub fn foo()\",\n+    },\n+]\"#\n+        );\n     }\n \n     #[test]\n     fn dont_render_function_parens_if_already_call() {\n-        check_reference_completion(\n-            \"dont_render_function_parens_if_already_call\",\n-            \"\n-            //- /lib.rs\n-            fn frobnicate() {}\n-            fn main() {\n-                frob<|>();\n-            }\n-            \",\n+        assert_debug_snapshot_matches!(\n+            do_reference_completion(\n+                \"\n+                //- /lib.rs\n+                fn frobnicate() {}\n+                fn main() {\n+                    frob<|>();\n+                }\n+                \"\n+            ),\n+@r#\"[\n+    CompletionItem {\n+        label: \"frobnicate\",\n+        source_range: [35; 39),\n+        delete: [35; 39),\n+        insert: \"frobnicate\",\n+        kind: Function,\n+        detail: \"fn frobnicate()\",\n+    },\n+    CompletionItem {\n+        label: \"main\",\n+        source_range: [35; 39),\n+        delete: [35; 39),\n+        insert: \"main\",\n+        kind: Function,\n+        detail: \"fn main()\",\n+    },\n+]\"#\n+        );\n+        assert_debug_snapshot_matches!(\n+            do_reference_completion(\n+                \"\n+                //- /lib.rs\n+                struct Foo {}\n+                impl Foo { fn new() -> Foo {} }\n+                fn main() {\n+                    Foo::ne<|>();\n+                }\n+                \"\n+            ),\n+@r#\"[\n+    CompletionItem {\n+        label: \"new\",\n+        source_range: [67; 69),\n+        delete: [67; 69),\n+        insert: \"new\",\n+        kind: Function,\n+        detail: \"fn new() -> Foo\",\n+    },\n+]\"#\n         );\n-        check_reference_completion(\n-            \"dont_render_function_parens_if_already_call_assoc_fn\",\n-            \"\n-            //- /lib.rs\n-            struct Foo {}\n-            impl Foo { fn new() -> Foo {} }\n-            fn main() {\n-                Foo::ne<|>();\n-            }\n-            \",\n-        )\n     }\n-\n }"}, {"sha": "46bea2ccd40a23acf3616d0168bf0c45a647e1e6", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_render_function_parens_if_already_call.snap", "status": "removed", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call.snap", "raw_url": "https://github.com/rust-lang/rust/raw/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call.snap?ref=eb7d1b0feeca276c485b8325df2851756ef861b4", "patch": "@@ -1,24 +0,0 @@\n----\n-created: \"2019-05-23T22:23:35.158296242Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"frobnicate\",\n-        source_range: [35; 39),\n-        delete: [35; 39),\n-        insert: \"frobnicate\",\n-        kind: Function,\n-        detail: \"fn frobnicate()\",\n-    },\n-    CompletionItem {\n-        label: \"main\",\n-        source_range: [35; 39),\n-        delete: [35; 39),\n-        insert: \"main\",\n-        kind: Function,\n-        detail: \"fn main()\",\n-    },\n-]"}, {"sha": "b09a6745e6ad9cc5d2ffbd94c1c24a7fb5924a08", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_render_function_parens_if_already_call_assoc_fn.snap", "status": "removed", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call_assoc_fn.snap", "raw_url": "https://github.com/rust-lang/rust/raw/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call_assoc_fn.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call_assoc_fn.snap?ref=eb7d1b0feeca276c485b8325df2851756ef861b4", "patch": "@@ -1,16 +0,0 @@\n----\n-created: \"2019-05-23T22:44:10.920136527Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"new\",\n-        source_range: [67; 69),\n-        delete: [67; 69),\n-        insert: \"new\",\n-        kind: Function,\n-        detail: \"fn new() -> Foo\",\n-    },\n-]"}, {"sha": "84ccc8160625a0bdd59366f8c6d461730a82f8f0", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_render_function_parens_in_use_item.snap", "status": "removed", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_in_use_item.snap", "raw_url": "https://github.com/rust-lang/rust/raw/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_in_use_item.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_in_use_item.snap?ref=eb7d1b0feeca276c485b8325df2851756ef861b4", "patch": "@@ -1,16 +0,0 @@\n----\n-created: \"2019-05-23T22:23:35.154795561Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"foo\",\n-        source_range: [40; 41),\n-        delete: [40; 41),\n-        insert: \"foo\",\n-        kind: Function,\n-        detail: \"pub fn foo()\",\n-    },\n-]"}, {"sha": "c795b9aaee8be3037ce6eae117fae07f92f53d5f", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__inserts_parens_for_function_calls1.snap", "status": "removed", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls1.snap", "raw_url": "https://github.com/rust-lang/rust/raw/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls1.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls1.snap?ref=eb7d1b0feeca276c485b8325df2851756ef861b4", "patch": "@@ -1,24 +0,0 @@\n----\n-created: \"2019-05-23T22:23:35.156115632Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"main\",\n-        source_range: [53; 56),\n-        delete: [53; 56),\n-        insert: \"main()$0\",\n-        kind: Function,\n-        detail: \"fn main()\",\n-    },\n-    CompletionItem {\n-        label: \"no_args\",\n-        source_range: [53; 56),\n-        delete: [53; 56),\n-        insert: \"no_args()$0\",\n-        kind: Function,\n-        detail: \"fn no_args()\",\n-    },\n-]"}, {"sha": "b49a838e0e512bd680d7fb35ae128c01b20c95f4", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__inserts_parens_for_function_calls2.snap", "status": "removed", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls2.snap", "raw_url": "https://github.com/rust-lang/rust/raw/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls2.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls2.snap?ref=eb7d1b0feeca276c485b8325df2851756ef861b4", "patch": "@@ -1,24 +0,0 @@\n----\n-created: \"2019-05-23T22:44:10.916806744Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"main\",\n-        source_range: [72; 77),\n-        delete: [72; 77),\n-        insert: \"main()$0\",\n-        kind: Function,\n-        detail: \"fn main()\",\n-    },\n-    CompletionItem {\n-        label: \"with_args\",\n-        source_range: [72; 77),\n-        delete: [72; 77),\n-        insert: \"with_args($0)\",\n-        kind: Function,\n-        detail: \"fn with_args(x: i32, y: String)\",\n-    },\n-]"}, {"sha": "b62cb7aa1262123075250b627d0677443b204940", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__inserts_parens_for_function_calls3.snap", "status": "removed", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls3.snap", "raw_url": "https://github.com/rust-lang/rust/raw/eb7d1b0feeca276c485b8325df2851756ef861b4/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls3.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls3.snap?ref=eb7d1b0feeca276c485b8325df2851756ef861b4", "patch": "@@ -1,16 +0,0 @@\n----\n-created: \"2019-05-23T22:44:40.543731193Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"foo\",\n-        source_range: [139; 140),\n-        delete: [139; 140),\n-        insert: \"foo()$0\",\n-        kind: Method,\n-        detail: \"fn foo(&self)\",\n-    },\n-]"}]}