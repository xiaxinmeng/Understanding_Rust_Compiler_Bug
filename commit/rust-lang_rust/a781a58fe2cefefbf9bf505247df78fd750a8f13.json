{"sha": "a781a58fe2cefefbf9bf505247df78fd750a8f13", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3ODFhNThmZTJjZWZlZmJmOWJmNTA1MjQ3ZGY3OGZkNzUwYThmMTM=", "commit": {"author": {"name": "Tim", "email": "tdhutt@gmail.com", "date": "2020-03-31T08:05:22Z"}, "committer": {"name": "Tim Hutt", "email": "timh@graphcore.ai", "date": "2020-03-31T08:06:52Z"}, "message": "Throw error if no folder is opened", "tree": {"sha": "b0a332117f094a98ca9818bb1da53df2a29f3262", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0a332117f094a98ca9818bb1da53df2a29f3262"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a781a58fe2cefefbf9bf505247df78fd750a8f13", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a781a58fe2cefefbf9bf505247df78fd750a8f13", "html_url": "https://github.com/rust-lang/rust/commit/a781a58fe2cefefbf9bf505247df78fd750a8f13", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a781a58fe2cefefbf9bf505247df78fd750a8f13/comments", "author": {"login": "Timmmm", "id": 376842, "node_id": "MDQ6VXNlcjM3Njg0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/376842?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Timmmm", "html_url": "https://github.com/Timmmm", "followers_url": "https://api.github.com/users/Timmmm/followers", "following_url": "https://api.github.com/users/Timmmm/following{/other_user}", "gists_url": "https://api.github.com/users/Timmmm/gists{/gist_id}", "starred_url": "https://api.github.com/users/Timmmm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Timmmm/subscriptions", "organizations_url": "https://api.github.com/users/Timmmm/orgs", "repos_url": "https://api.github.com/users/Timmmm/repos", "events_url": "https://api.github.com/users/Timmmm/events{/privacy}", "received_events_url": "https://api.github.com/users/Timmmm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6e535915bda524de34f011f75067132e88a3a3cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e535915bda524de34f011f75067132e88a3a3cc", "html_url": "https://github.com/rust-lang/rust/commit/6e535915bda524de34f011f75067132e88a3a3cc"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "0de45bb3040275cd13844f1ef16084b286acd449", "filename": "editors/code/src/client.ts", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a781a58fe2cefefbf9bf505247df78fd750a8f13/editors%2Fcode%2Fsrc%2Fclient.ts", "raw_url": "https://github.com/rust-lang/rust/raw/a781a58fe2cefefbf9bf505247df78fd750a8f13/editors%2Fcode%2Fsrc%2Fclient.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fclient.ts?ref=a781a58fe2cefefbf9bf505247df78fd750a8f13", "patch": "@@ -30,14 +30,14 @@ export function configToServerOptions(config: Config) {\n     };\n }\n \n-export async function createClient(config: Config, serverPath: string, workspaceFolder: vscode.WorkspaceFolder | null): Promise<lc.LanguageClient> {\n+export async function createClient(config: Config, serverPath: string, workspaceFolder: vscode.WorkspaceFolder): Promise<lc.LanguageClient> {\n     // '.' Is the fallback if no folder is open\n     // TODO?: Workspace folders support Uri's (eg: file://test.txt).\n     // It might be a good idea to test if the uri points to a file.\n \n     const run: lc.Executable = {\n         command: serverPath,\n-        options: { cwd: workspaceFolder?.uri.fsPath ?? '.' },\n+        options: { cwd: workspaceFolder.uri.fsPath },\n     };\n     const serverOptions: lc.ServerOptions = {\n         run,"}, {"sha": "255d57f5e7e9eccecbf4108f37dd6fbb32004b77", "filename": "editors/code/src/ctx.ts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a781a58fe2cefefbf9bf505247df78fd750a8f13/editors%2Fcode%2Fsrc%2Fctx.ts", "raw_url": "https://github.com/rust-lang/rust/raw/a781a58fe2cefefbf9bf505247df78fd750a8f13/editors%2Fcode%2Fsrc%2Fctx.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fctx.ts?ref=a781a58fe2cefefbf9bf505247df78fd750a8f13", "patch": "@@ -19,7 +19,7 @@ export class Ctx {\n         config: Config,\n         extCtx: vscode.ExtensionContext,\n         serverPath: string,\n-        workspaceFolder: vscode.WorkspaceFolder | null,\n+        workspaceFolder: vscode.WorkspaceFolder,\n     ): Promise<Ctx> {\n         const client = await createClient(config, serverPath, workspaceFolder);\n         const res = new Ctx(config, extCtx, client, serverPath);"}, {"sha": "ee6e712a42d183b0460985cbc3ce76126f3c2262", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a781a58fe2cefefbf9bf505247df78fd750a8f13/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/a781a58fe2cefefbf9bf505247df78fd750a8f13/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=a781a58fe2cefefbf9bf505247df78fd750a8f13", "patch": "@@ -42,7 +42,12 @@ export async function activate(context: vscode.ExtensionContext) {\n     const state = new PersistentState(context.globalState);\n     const serverPath = await bootstrap(config, state);\n \n-    const workspaceFolder = vscode.workspace.workspaceFolders?.[0] ?? null;\n+    const workspaceFolder = vscode.workspace.workspaceFolders?.[0];\n+    if (workspaceFolder === undefined) {\n+        const err = \"Cannot activate rust-analyzer when no folder is opened\";\n+        void vscode.window.showErrorMessage(err);\n+        throw new Error(err);\n+    }\n \n     // Note: we try to start the server before we activate type hints so that it\n     // registers its `onDidChangeDocument` handler before us."}]}