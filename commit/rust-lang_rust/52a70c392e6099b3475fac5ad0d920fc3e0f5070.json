{"sha": "52a70c392e6099b3475fac5ad0d920fc3e0f5070", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyYTcwYzM5MmU2MDk5YjM0NzVmYWM1YWQwZDkyMGZjM2UwZjUwNzA=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-07-19T18:21:41Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-07-19T18:21:41Z"}, "message": "minor: simplify", "tree": {"sha": "540602c5d324c03bc37790bda212395d4fa1b62f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/540602c5d324c03bc37790bda212395d4fa1b62f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/52a70c392e6099b3475fac5ad0d920fc3e0f5070", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/52a70c392e6099b3475fac5ad0d920fc3e0f5070", "html_url": "https://github.com/rust-lang/rust/commit/52a70c392e6099b3475fac5ad0d920fc3e0f5070", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/52a70c392e6099b3475fac5ad0d920fc3e0f5070/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "493ed2c17bb7af3f50fd228b8c6878dea5887044", "url": "https://api.github.com/repos/rust-lang/rust/commits/493ed2c17bb7af3f50fd228b8c6878dea5887044", "html_url": "https://github.com/rust-lang/rust/commit/493ed2c17bb7af3f50fd228b8c6878dea5887044"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "8e66f240909291dbe994761526ea37f8c86417db", "filename": "crates/project_model/src/cargo_workspace.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/52a70c392e6099b3475fac5ad0d920fc3e0f5070/crates%2Fproject_model%2Fsrc%2Fcargo_workspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52a70c392e6099b3475fac5ad0d920fc3e0f5070/crates%2Fproject_model%2Fsrc%2Fcargo_workspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproject_model%2Fsrc%2Fcargo_workspace.rs?ref=52a70c392e6099b3475fac5ad0d920fc3e0f5070", "patch": "@@ -229,6 +229,12 @@ impl CargoWorkspace {\n         config: &CargoConfig,\n         progress: &dyn Fn(String),\n     ) -> Result<cargo_metadata::Metadata> {\n+        let target = config\n+            .target\n+            .clone()\n+            .or_else(|| cargo_config_build_target(cargo_toml))\n+            .or_else(|| rustc_discover_host_triple(cargo_toml));\n+\n         let mut meta = MetadataCommand::new();\n         meta.cargo_path(toolchain::cargo());\n         meta.manifest_path(cargo_toml.to_path_buf());\n@@ -245,13 +251,7 @@ impl CargoWorkspace {\n             }\n         }\n         meta.current_dir(cargo_toml.parent().as_os_str());\n-        let target = if let Some(target) = &config.target {\n-            Some(target.clone())\n-        } else if let stdout @ Some(_) = cargo_config_build_target(cargo_toml) {\n-            stdout\n-        } else {\n-            rustc_discover_host_triple(cargo_toml)\n-        };\n+\n         if let Some(target) = target {\n             meta.other_options(vec![String::from(\"--filter-platform\"), target]);\n         }"}]}