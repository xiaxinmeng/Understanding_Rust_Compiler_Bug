{"sha": "a53b604fea709deb2434319900fb34918cf72469", "node_id": "C_kwDOAAsO6NoAKGE1M2I2MDRmZWE3MDlkZWIyNDM0MzE5OTAwZmIzNDkxOGNmNzI0Njk", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-22T11:16:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-22T11:16:29Z"}, "message": "Rollup merge of #94178 - est31:tolerant_lines_check, r=Mark-Simulacrum\n\ntidy: fire less \"ignoring file length unneccessarily\" warnings\n\nThis avoids a situation where a file is at the border of the limit,\nand alternates between hitting the limit and not hitting it, causing\na back and forth of addition of the ignore-tidy-linelength directive.\n\nAs an example, consider the ignore-tidy-filelength of compiler/rustc_typeck/src/collect.rs.\n\nIt was added in 2ca4964db5d263a8f9222846bd70a7f26cf414cf, removed in\n37354ebc9794b0eb14b08c02177e3094c8fe91cd (a revert of the earlier commit), added again in 448d07683a6defd567996114793a09c9a8aef5df,\nremoved in 3171bd5bf54fb91f7f7df7c40df5adc7d8bd5dea, added in 438826fd1a9a119d00992ede948cdd479431ecbb,\nand removed in bb0a2f985cb6e980cc026ea952733d53bb868f87.\n\nTo avoid this back and forth, we exempt files from the unneccessary\nignoring warning that have length of at least 70% of the limit.", "tree": {"sha": "e6aaba88beb8715c81f4298f234cfe3d770733f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e6aaba88beb8715c81f4298f234cfe3d770733f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a53b604fea709deb2434319900fb34918cf72469", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiFMYNCRBK7hj4Ov3rIwAAHrQIAC8t6sHIm2Ti9GkahM+wI5be\n8HWPMG1UbcItuKba0JcSDP5H6GU5u/v3bjke43iq8vXagGMIET5plNelRERbAa5p\nVcUs2XIYgYCexOOP6yKEbYYUCL/9YVYAsNnHJprCtAJc2AzmsQYbf56tAWxvfKNr\nBcL8PT9CFB+cdFSan4DQKS+mOX10IApnPCf1okdPOe9gtjIE2fI13NaU3NPvT5SO\neKoPhAdoUMxOUvRDY2ZUqA3uFm7j2BeBaEtl567C7cUweJIrc9NjebrqBFJ5e9hL\nPgSnsS4f8bXpyhecb+QBV8Y8ergTfoCZWTxtJSoZisCeZgxhlDXjji0Z6zGlWEw=\n=8q7V\n-----END PGP SIGNATURE-----\n", "payload": "tree e6aaba88beb8715c81f4298f234cfe3d770733f4\nparent 1cf2e6993e58e13abb03f487f401731fe77b5a33\nparent 49a5456606967babaa319954a9710dc2eac6c4f0\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1645528589 +0100\ncommitter GitHub <noreply@github.com> 1645528589 +0100\n\nRollup merge of #94178 - est31:tolerant_lines_check, r=Mark-Simulacrum\n\ntidy: fire less \"ignoring file length unneccessarily\" warnings\n\nThis avoids a situation where a file is at the border of the limit,\nand alternates between hitting the limit and not hitting it, causing\na back and forth of addition of the ignore-tidy-linelength directive.\n\nAs an example, consider the ignore-tidy-filelength of compiler/rustc_typeck/src/collect.rs.\n\nIt was added in 2ca4964db5d263a8f9222846bd70a7f26cf414cf, removed in\n37354ebc9794b0eb14b08c02177e3094c8fe91cd (a revert of the earlier commit), added again in 448d07683a6defd567996114793a09c9a8aef5df,\nremoved in 3171bd5bf54fb91f7f7df7c40df5adc7d8bd5dea, added in 438826fd1a9a119d00992ede948cdd479431ecbb,\nand removed in bb0a2f985cb6e980cc026ea952733d53bb868f87.\n\nTo avoid this back and forth, we exempt files from the unneccessary\nignoring warning that have length of at least 70% of the limit.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a53b604fea709deb2434319900fb34918cf72469", "html_url": "https://github.com/rust-lang/rust/commit/a53b604fea709deb2434319900fb34918cf72469", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a53b604fea709deb2434319900fb34918cf72469/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1cf2e6993e58e13abb03f487f401731fe77b5a33", "url": "https://api.github.com/repos/rust-lang/rust/commits/1cf2e6993e58e13abb03f487f401731fe77b5a33", "html_url": "https://github.com/rust-lang/rust/commit/1cf2e6993e58e13abb03f487f401731fe77b5a33"}, {"sha": "49a5456606967babaa319954a9710dc2eac6c4f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/49a5456606967babaa319954a9710dc2eac6c4f0", "html_url": "https://github.com/rust-lang/rust/commit/49a5456606967babaa319954a9710dc2eac6c4f0"}], "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "c197acd4828a143ee57fcd2b38e0578155abcb48", "filename": "src/tools/tidy/src/style.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a53b604fea709deb2434319900fb34918cf72469/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a53b604fea709deb2434319900fb34918cf72469/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs?ref=a53b604fea709deb2434319900fb34918cf72469", "patch": "@@ -395,6 +395,9 @@ pub fn check(path: &Path, bad: &mut bool) {\n                 );\n             };\n             suppressible_tidy_err!(err, skip_file_length, \"\");\n+        } else if lines > (LINES * 7) / 10 {\n+            // Just set it to something that doesn't trigger the \"unneccessarily ignored\" warning.\n+            skip_file_length = Directive::Ignore(true);\n         }\n \n         if let Directive::Ignore(false) = skip_cr {"}]}