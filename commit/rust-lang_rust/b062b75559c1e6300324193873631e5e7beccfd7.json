{"sha": "b062b75559c1e6300324193873631e5e7beccfd7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIwNjJiNzU1NTljMWU2MzAwMzI0MTkzODczNjMxZTVlN2JlY2NmZDc=", "commit": {"author": {"name": "Andre Bogus", "email": "bogusandre@gmail.com", "date": "2019-01-29T15:15:02Z"}, "committer": {"name": "Andre Bogus", "email": "bogusandre@gmail.com", "date": "2019-01-30T08:11:17Z"}, "message": "override `VecDeque`'s `Iter::try_fold`", "tree": {"sha": "46e999a55c1f662a30c2447116b038336321497a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46e999a55c1f662a30c2447116b038336321497a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b062b75559c1e6300324193873631e5e7beccfd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b062b75559c1e6300324193873631e5e7beccfd7", "html_url": "https://github.com/rust-lang/rust/commit/b062b75559c1e6300324193873631e5e7beccfd7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b062b75559c1e6300324193873631e5e7beccfd7/comments", "author": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "committer": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "106b3e9fa4d53efc4e8eab47d1043789c88f99a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/106b3e9fa4d53efc4e8eab47d1043789c88f99a5", "html_url": "https://github.com/rust-lang/rust/commit/106b3e9fa4d53efc4e8eab47d1043789c88f99a5"}], "stats": {"total": 48, "additions": 47, "deletions": 1}, "files": [{"sha": "579d7de96e6dab8e168141d1e6cabc1163b92991", "filename": "src/liballoc/collections/vec_deque.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b062b75559c1e6300324193873631e5e7beccfd7/src%2Fliballoc%2Fcollections%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b062b75559c1e6300324193873631e5e7beccfd7/src%2Fliballoc%2Fcollections%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fcollections%2Fvec_deque.rs?ref=b062b75559c1e6300324193873631e5e7beccfd7", "patch": "@@ -12,7 +12,7 @@ use core::fmt;\n use core::iter::{repeat_with, FromIterator, FusedIterator};\n use core::mem;\n use core::ops::Bound::{Excluded, Included, Unbounded};\n-use core::ops::{Index, IndexMut, RangeBounds};\n+use core::ops::{Index, IndexMut, RangeBounds, Try};\n use core::ptr;\n use core::ptr::NonNull;\n use core::slice;\n@@ -2172,6 +2172,14 @@ impl<'a, T> Iterator for Iter<'a, T> {\n         accum = front.iter().fold(accum, &mut f);\n         back.iter().fold(accum, &mut f)\n     }\n+\n+    fn try_fold<B, F, R>(&mut self, init: B, mut f: F) -> R where\n+        Self: Sized, F: FnMut(B, Self::Item) -> R, R: Try<Ok=B>\n+    {\n+        let (front, back) = RingSlices::ring_slices(self.ring, self.head, self.tail);\n+        let accum = front.iter().try_fold(init, &mut f)?;\n+        back.iter().try_fold(accum, &mut f)\n+    }\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]"}, {"sha": "5165a7ca5a8f330e60177f074c6590ff409cdc3d", "filename": "src/liballoc/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b062b75559c1e6300324193873631e5e7beccfd7/src%2Fliballoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b062b75559c1e6300324193873631e5e7beccfd7/src%2Fliballoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Flib.rs?ref=b062b75559c1e6300324193873631e5e7beccfd7", "patch": "@@ -113,6 +113,7 @@\n #![feature(slice_partition_dedup)]\n #![feature(maybe_uninit)]\n #![feature(alloc_layout_extra)]\n+#![feature(try_trait)]\n \n // Allow testing this library\n "}, {"sha": "c9d16a06b4773cee9bd474c43619c2778f50672b", "filename": "src/liballoc/tests/vec_deque.rs", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/b062b75559c1e6300324193873631e5e7beccfd7/src%2Fliballoc%2Ftests%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b062b75559c1e6300324193873631e5e7beccfd7/src%2Fliballoc%2Ftests%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Ftests%2Fvec_deque.rs?ref=b062b75559c1e6300324193873631e5e7beccfd7", "patch": "@@ -1433,3 +1433,40 @@ fn test_rotate_right_random() {\n         }\n     }\n }\n+\n+#[test]\n+fn test_try_fold_empty() {\n+    assert_eq!(Some(0), VecDeque::<u32>::new().iter().try_fold(0, |_, _| None));\n+}\n+\n+#[test]\n+fn test_try_fold_none() {\n+    let v: VecDeque<u32> = (0..12).collect();\n+    assert_eq!(None, v.into_iter().try_fold(0, |a, b|\n+        if b < 11 { Some(a + b) } else { None }));\n+}\n+\n+#[test]\n+fn test_try_fold_ok() {\n+    let v: VecDeque<u32> = (0..12).collect();\n+    assert_eq!(Ok::<_, ()>(66), v.into_iter().try_fold(0, |a, b| Ok(a + b)));\n+}\n+\n+#[test]\n+fn test_try_fold_unit() {\n+    let v: VecDeque<()> = std::iter::repeat(()).take(42).collect();\n+    assert_eq!(Some(()), v.into_iter().try_fold((), |(), ()| Some(())));\n+}\n+\n+#[test]\n+fn test_try_fold_rotated() {\n+    let mut v: VecDeque<_> = (0..12).collect();\n+    for n in 0..10 {\n+        if n & 1 == 0 {\n+            v.rotate_left(n);\n+        } else {\n+            v.rotate_right(n);\n+        }\n+        assert_eq!(Ok::<_, ()>(66), v.iter().try_fold(0, |a, b| Ok(a + b)));\n+    }\n+}"}]}