{"sha": "df7a91f1925524fd6084c670726f1e289f224a83", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmN2E5MWYxOTI1NTI0ZmQ2MDg0YzY3MDcyNmYxZTI4OWYyMjRhODM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-07T12:33:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-07T12:33:01Z"}, "message": "Auto merge of #59770 - pietroalbini:pin-android-emulator, r=kennytm\n\nci: pin android emulator to 28.0.23\n\nApparently Android Emulator 28.0.25 (the latest one) is broken for us, and `sdkmanager` doesn't have a way to pin a package to a specific version. This PR stops downloading the emulator from `sdkmanager`, downloading it manually instead.\n\nTested this locally and confirmed it works. I'll open an issue on Google's issue tracker later today.\n\nFixes https://github.com/rust-lang/rust/issues/59757\nr? @kennytm", "tree": {"sha": "fda10abf1799cf0ff50bb58d566dd21df8c9a4d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fda10abf1799cf0ff50bb58d566dd21df8c9a4d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df7a91f1925524fd6084c670726f1e289f224a83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df7a91f1925524fd6084c670726f1e289f224a83", "html_url": "https://github.com/rust-lang/rust/commit/df7a91f1925524fd6084c670726f1e289f224a83", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df7a91f1925524fd6084c670726f1e289f224a83/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4fb888bf04d2f1913e78e9eae51ac5695df1dc01", "url": "https://api.github.com/repos/rust-lang/rust/commits/4fb888bf04d2f1913e78e9eae51ac5695df1dc01", "html_url": "https://github.com/rust-lang/rust/commit/4fb888bf04d2f1913e78e9eae51ac5695df1dc01"}, {"sha": "d13547a1c61b940c1ca20159ad3b24b160c90ac7", "url": "https://api.github.com/repos/rust-lang/rust/commits/d13547a1c61b940c1ca20159ad3b24b160c90ac7", "html_url": "https://github.com/rust-lang/rust/commit/d13547a1c61b940c1ca20159ad3b24b160c90ac7"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "bbf700ae2339fe9a90e4e64524ab5a00d2a9a5f9", "filename": "src/ci/docker/arm-android/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df7a91f1925524fd6084c670726f1e289f224a83/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/df7a91f1925524fd6084c670726f1e289f224a83/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2FDockerfile?ref=df7a91f1925524fd6084c670726f1e289f224a83", "patch": "@@ -23,7 +23,7 @@ RUN dpkg --add-architecture i386 && \\\n \n COPY scripts/android-sdk.sh /scripts/\n RUN . /scripts/android-sdk.sh && \\\n-    download_and_create_avd 4333796 armeabi-v7a 18\n+    download_and_create_avd 4333796 armeabi-v7a 18 5264690\n \n ENV PATH=$PATH:/android/sdk/emulator\n ENV PATH=$PATH:/android/sdk/tools"}, {"sha": "e78e3795c046adde1f55f974e8c7db42163fbc94", "filename": "src/ci/docker/scripts/android-sdk.sh", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/df7a91f1925524fd6084c670726f1e289f224a83/src%2Fci%2Fdocker%2Fscripts%2Fandroid-sdk.sh", "raw_url": "https://github.com/rust-lang/rust/raw/df7a91f1925524fd6084c670726f1e289f224a83/src%2Fci%2Fdocker%2Fscripts%2Fandroid-sdk.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fandroid-sdk.sh?ref=df7a91f1925524fd6084c670726f1e289f224a83", "patch": "@@ -20,11 +20,19 @@ download_sysimage() {\n     # The output from sdkmanager is so noisy that it will occupy all of the 4 MB\n     # log extremely quickly. Thus we must silence all output.\n     yes | sdkmanager --licenses > /dev/null\n-    yes | sdkmanager platform-tools emulator \\\n+    yes | sdkmanager platform-tools \\\n         \"platforms;android-$api\" \\\n         \"system-images;android-$api;default;$abi\" > /dev/null\n }\n \n+download_emulator() {\n+    # Download a pinned version of the emulator since upgrades can cause issues\n+    curl -fo emulator.zip \"https://dl.google.com/android/repository/emulator-linux-$1.zip\"\n+    rm -rf \"${ANDROID_HOME}/emulator\"\n+    unzip -q emulator.zip -d \"${ANDROID_HOME}\"\n+    rm -f emulator.zip\n+}\n+\n create_avd() {\n     abi=$1\n     api=$2\n@@ -40,11 +48,12 @@ download_and_create_avd() {\n     download_sdk $1\n     download_sysimage $2 $3\n     create_avd $2 $3\n+    download_emulator $4\n }\n \n # Usage:\n #\n-#       setup_android_sdk 4333796 armeabi-v7a 18\n+#       download_and_create_avd 4333796 armeabi-v7a 18 5264690\n #\n # 4333796 =>\n #   SDK tool version.\n@@ -53,3 +62,6 @@ download_and_create_avd() {\n #   System image ABI\n # 18 =>\n #   Android API Level (18 = Android 4.3 = Jelly Bean MR2)\n+# 5264690 =>\n+#   Android Emulator version.\n+#   Copy from the \"build_id\" in the `/android/sdk/emulator/emulator -version` output"}]}