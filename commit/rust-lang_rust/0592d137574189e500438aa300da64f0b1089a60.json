{"sha": "0592d137574189e500438aa300da64f0b1089a60", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1OTJkMTM3NTc0MTg5ZTUwMDQzOGFhMzAwZGE2NGYwYjEwODlhNjA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-15T17:36:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-15T17:36:01Z"}, "message": "Rollup merge of #64472 - Mark-Simulacrum:unused-parens-attr, r=varkor\n\nDon't mark expression with attributes as not needing parentheses\n\nThis is not perfectly correct as `#[attr] (5)` will still not lint, but it does seem good enough, in particular as the parentheses in that case are not unambiguously incorrect; I might personally prefer to see them for clarity.\n\nFixes https://github.com/rust-lang/rust/issues/43279.", "tree": {"sha": "51f58d0872e178fb0c9187b855fdfa75127475c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/51f58d0872e178fb0c9187b855fdfa75127475c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0592d137574189e500438aa300da64f0b1089a60", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdfnaBCRBK7hj4Ov3rIwAAdHIIAEtGz3nXLyw6VLaKosSozMgY\nGOIMeHU4V8NAC6xgIaQwb4xczCqJgCPvxOxKu4F//D+WdHO68o3J+a8l41BpYSaX\nSymu3nIZWzlQfxsMZnDHQRpChDGY+xBMLvrBwnUgnk+TL8u4DhPVkEFmDdBX0Ya4\nQZYBSJz1VVa1PE60c+LVswf5X6aRbqZz/igKauVQTfBLZJaGXfrUKuyR8QjJW2lv\n+VDRSZBnmK2njPKxf+td814VRehZ4ELClcMPJppfQsz/CYqsODgbWVBBB+9dne0l\n09zMzQSUMF2H6CjNZtK3+Y4LraOnfjgX29/0tKpqZmzLfC3ZPtEiVFrlD7Wy620=\n=PWys\n-----END PGP SIGNATURE-----\n", "payload": "tree 51f58d0872e178fb0c9187b855fdfa75127475c3\nparent 2e11e81f1e94c7883c7dde694e9ba6f7a562dd91\nparent 1d33f06de80ce6b473460cdf87566d57f53a0b4e\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1568568961 +0200\ncommitter GitHub <noreply@github.com> 1568568961 +0200\n\nRollup merge of #64472 - Mark-Simulacrum:unused-parens-attr, r=varkor\n\nDon't mark expression with attributes as not needing parentheses\n\nThis is not perfectly correct as `#[attr] (5)` will still not lint, but it does seem good enough, in particular as the parentheses in that case are not unambiguously incorrect; I might personally prefer to see them for clarity.\n\nFixes https://github.com/rust-lang/rust/issues/43279.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0592d137574189e500438aa300da64f0b1089a60", "html_url": "https://github.com/rust-lang/rust/commit/0592d137574189e500438aa300da64f0b1089a60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0592d137574189e500438aa300da64f0b1089a60/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e11e81f1e94c7883c7dde694e9ba6f7a562dd91", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e11e81f1e94c7883c7dde694e9ba6f7a562dd91", "html_url": "https://github.com/rust-lang/rust/commit/2e11e81f1e94c7883c7dde694e9ba6f7a562dd91"}, {"sha": "1d33f06de80ce6b473460cdf87566d57f53a0b4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d33f06de80ce6b473460cdf87566d57f53a0b4e", "html_url": "https://github.com/rust-lang/rust/commit/1d33f06de80ce6b473460cdf87566d57f53a0b4e"}], "stats": {"total": 45, "additions": 25, "deletions": 20}, "files": [{"sha": "c3975098351af9f83fed30a3f7d5587aa88905c5", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0592d137574189e500438aa300da64f0b1089a60/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0592d137574189e500438aa300da64f0b1089a60/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=0592d137574189e500438aa300da64f0b1089a60", "patch": "@@ -370,7 +370,8 @@ impl UnusedParens {\n                                      right_pos: Option<BytePos>) {\n         match value.node {\n             ast::ExprKind::Paren(ref inner) => {\n-                if !Self::is_expr_parens_necessary(inner, followed_by_block) {\n+                if !Self::is_expr_parens_necessary(inner, followed_by_block) &&\n+                    value.attrs.is_empty() {\n                     let expr_text = if let Ok(snippet) = cx.sess().source_map()\n                         .span_to_snippet(value.span) {\n                             snippet"}, {"sha": "7dcbdd0863cbd9f2a5c07010632ef2530e30d45d", "filename": "src/test/ui/lint/issue-54538-unused-parens-lint.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0592d137574189e500438aa300da64f0b1089a60/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0592d137574189e500438aa300da64f0b1089a60/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs?ref=0592d137574189e500438aa300da64f0b1089a60", "patch": "@@ -1,4 +1,4 @@\n-#![feature(box_patterns)]\n+#![feature(box_patterns, stmt_expr_attributes)]\n \n #![feature(or_patterns)]\n //~^ WARN the feature `or_patterns` is incomplete\n@@ -17,6 +17,10 @@ fn lint_on_top_level() {\n     let _ = |(a): u8| 0; //~ ERROR unnecessary parentheses around pattern\n }\n \n+fn _no_lint_attr() {\n+    let _x = #[allow(dead_code)] (1 + 2);\n+}\n+\n // Don't lint in these cases (#64106).\n fn or_patterns_no_lint() {\n     match Box::new(0) {"}, {"sha": "675dd4f07def63a3b943ba6070a01f50c8892a09", "filename": "src/test/ui/lint/issue-54538-unused-parens-lint.stderr", "status": "modified", "additions": 18, "deletions": 18, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/0592d137574189e500438aa300da64f0b1089a60/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0592d137574189e500438aa300da64f0b1089a60/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr?ref=0592d137574189e500438aa300da64f0b1089a60", "patch": "@@ -49,109 +49,109 @@ LL |     let _ = |(a): u8| 0;\n    |              ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:41:12\n+  --> $DIR/issue-54538-unused-parens-lint.rs:45:12\n    |\n LL |     if let (0 | 1) = 0 {}\n    |            ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:42:13\n+  --> $DIR/issue-54538-unused-parens-lint.rs:46:13\n    |\n LL |     if let ((0 | 1),) = (0,) {}\n    |             ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:43:13\n+  --> $DIR/issue-54538-unused-parens-lint.rs:47:13\n    |\n LL |     if let [(0 | 1)] = [0] {}\n    |             ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:44:16\n+  --> $DIR/issue-54538-unused-parens-lint.rs:48:16\n    |\n LL |     if let 0 | (1 | 2) = 0 {}\n    |                ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:46:15\n+  --> $DIR/issue-54538-unused-parens-lint.rs:50:15\n    |\n LL |     if let TS((0 | 1)) = TS(0) {}\n    |               ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:48:20\n+  --> $DIR/issue-54538-unused-parens-lint.rs:52:20\n    |\n LL |     if let NS { f: (0 | 1) } = (NS { f: 0 }) {}\n    |                    ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:58:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:62:9\n    |\n LL |         (_) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:59:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:63:9\n    |\n LL |         (y) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:60:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:64:9\n    |\n LL |         (ref r) => {}\n    |         ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:61:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:65:9\n    |\n LL |         (e @ 1...2) => {}\n    |         ^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:67:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:71:9\n    |\n LL |         (e @ &(1...2)) => {}\n    |         ^^^^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:68:10\n+  --> $DIR/issue-54538-unused-parens-lint.rs:72:10\n    |\n LL |         &(_) => {}\n    |          ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:79:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:83:9\n    |\n LL |         (_) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:80:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:84:9\n    |\n LL |         (y) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:81:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:85:9\n    |\n LL |         (ref r) => {}\n    |         ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:82:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:86:9\n    |\n LL |         (e @ 1..=2) => {}\n    |         ^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:88:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:92:9\n    |\n LL |         (e @ &(1..=2)) => {}\n    |         ^^^^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:89:10\n+  --> $DIR/issue-54538-unused-parens-lint.rs:93:10\n    |\n LL |         &(_) => {}\n    |          ^^^ help: remove these parentheses"}]}