{"sha": "0c9bf13f5f11047bb03313624f0430d93d4e840d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBjOWJmMTNmNWYxMTA0N2JiMDMzMTM2MjRmMDQzMGQ5M2Q0ZTg0MGQ=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-09-08T02:06:23Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-09-08T02:06:23Z"}, "message": "Add a script to automatically update Rust/Clang versions", "tree": {"sha": "ab4466c86e48b0f01da06cd002a12b3df5480452", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab4466c86e48b0f01da06cd002a12b3df5480452"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0c9bf13f5f11047bb03313624f0430d93d4e840d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0c9bf13f5f11047bb03313624f0430d93d4e840d", "html_url": "https://github.com/rust-lang/rust/commit/0c9bf13f5f11047bb03313624f0430d93d4e840d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0c9bf13f5f11047bb03313624f0430d93d4e840d/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d289aeade481c03d42e7f6d31bc6b64a73cfa45", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d289aeade481c03d42e7f6d31bc6b64a73cfa45", "html_url": "https://github.com/rust-lang/rust/commit/7d289aeade481c03d42e7f6d31bc6b64a73cfa45"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "7ddd5ae52752e36c8aca5d75f22147cd494e96c7", "filename": "src/doc/rustc/src/linker-plugin-lto.md", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/0c9bf13f5f11047bb03313624f0430d93d4e840d/src%2Fdoc%2Frustc%2Fsrc%2Flinker-plugin-lto.md", "raw_url": "https://github.com/rust-lang/rust/raw/0c9bf13f5f11047bb03313624f0430d93d4e840d/src%2Fdoc%2Frustc%2Fsrc%2Flinker-plugin-lto.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Flinker-plugin-lto.md?ref=0c9bf13f5f11047bb03313624f0430d93d4e840d", "patch": "@@ -89,6 +89,28 @@ rustc -Clinker-plugin-lto=\"/path/to/LLVMgold.so\" -L. -Copt-level=2 ./main.rs\n \n ## Toolchain Compatibility\n \n+<!-- NOTE: to update the below table, you can use this shell script:\n+\n+```sh\n+rustup toolchain install --profile minimal nightly\n+MINOR_VERSION=$(rustc +nightly --version | cut -d . -f 2)\n+LOWER_BOUND=44\n+\n+llvm_version() {\n+    toolchain=\"$1\"\n+    printf \"Rust $toolchain    |    Clang \"\n+    rustc +\"$toolchain\" -Vv | grep LLVM | cut -d ':' -f 2 | tr -d ' '\n+}\n+\n+for version in `seq $LOWER_BOUND $((MINOR_VERSION - 2))`; do\n+    toolchain=1.$version.0\n+    rustup toolchain install --no-self-update --profile  minimal $toolchain >/dev/null 2>&1\n+    llvm_version $toolchain\n+done\n+```\n+\n+-->\n+\n In order for this kind of LTO to work, the LLVM linker plugin must be able to\n handle the LLVM bitcode produced by both `rustc` and `clang`.\n "}]}