{"sha": "da370fe25afd1f4ddf3c4e545356eb3b011c1051", "node_id": "C_kwDOAAsO6NoAKGRhMzcwZmUyNWFmZDFmNGRkZjNjNGU1NDUzNTZlYjNiMDExYzEwNTE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-23T00:17:51Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-23T00:17:51Z"}, "message": "Rollup merge of #106057 - jyn514:trimmed-def-paths-ice, r=compiler-errors\n\nGive a more helpful error for \"trimmed_def_paths constructed\"\n\ncc https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/ice.20debugging/near/315928294, https://github.com/rust-lang/rust/pull/106056\n\n`@mejrs` do you think this would have helped you figure out the problem faster?", "tree": {"sha": "878fb1426298628526a6455d8dda0b23863a7ba1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/878fb1426298628526a6455d8dda0b23863a7ba1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da370fe25afd1f4ddf3c4e545356eb3b011c1051", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjpPOvCRBK7hj4Ov3rIwAA0K0IAJ2lkCO1gmd8ejH6LBa36LBU\nem0670J21n3PYn/uXaTxFOe5tfQwdckpg0eSHCumiKb9Z0DI/CrHCzcBI2GDc2aH\nZBmChKc0MASCOCNZzjlr90MgnOOm5FoEY2PAmAJ0oO9TW/L30lWfSpCFEMaDhneY\nMOGwGhcWWSGB0dh++oU/U5vL0YDMcEz/wkE56UcCsfsR/dg8NIij02H1XKwmAOyf\ni0A4HiWBU1UDHWSbE87iLhenHhTvUsE42D0G62qbbsbDn7FuhkxZ8b/uEDt9hVXX\nGZZlT3cA23J2FErxnquDAy5ozknrzHItamVKU/9XNros2Jsk8oK/YHB7QQl9Pkc=\n=ulJu\n-----END PGP SIGNATURE-----\n", "payload": "tree 878fb1426298628526a6455d8dda0b23863a7ba1\nparent 15a0daca00de1308d6fe3bcd581917057f76c509\nparent e4330295d9bcb8ab302000eae60cd8b9a71f2d7a\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1671754671 +0100\ncommitter GitHub <noreply@github.com> 1671754671 +0100\n\nRollup merge of #106057 - jyn514:trimmed-def-paths-ice, r=compiler-errors\n\nGive a more helpful error for \"trimmed_def_paths constructed\"\n\ncc https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/ice.20debugging/near/315928294, https://github.com/rust-lang/rust/pull/106056\n\n`@mejrs` do you think this would have helped you figure out the problem faster?\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da370fe25afd1f4ddf3c4e545356eb3b011c1051", "html_url": "https://github.com/rust-lang/rust/commit/da370fe25afd1f4ddf3c4e545356eb3b011c1051", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da370fe25afd1f4ddf3c4e545356eb3b011c1051/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "15a0daca00de1308d6fe3bcd581917057f76c509", "url": "https://api.github.com/repos/rust-lang/rust/commits/15a0daca00de1308d6fe3bcd581917057f76c509", "html_url": "https://github.com/rust-lang/rust/commit/15a0daca00de1308d6fe3bcd581917057f76c509"}, {"sha": "e4330295d9bcb8ab302000eae60cd8b9a71f2d7a", "url": "https://api.github.com/repos/rust-lang/rust/commits/e4330295d9bcb8ab302000eae60cd8b9a71f2d7a", "html_url": "https://github.com/rust-lang/rust/commit/e4330295d9bcb8ab302000eae60cd8b9a71f2d7a"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "6a3b2bde84f9cae23e223630301a18b5cd0604e2", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/da370fe25afd1f4ddf3c4e545356eb3b011c1051/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/da370fe25afd1f4ddf3c4e545356eb3b011c1051/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=da370fe25afd1f4ddf3c4e545356eb3b011c1051", "patch": "@@ -4038,6 +4038,7 @@ dependencies = [\n  \"rustc_ast\",\n  \"rustc_attr\",\n  \"rustc_data_structures\",\n+ \"rustc_error_messages\",\n  \"rustc_errors\",\n  \"rustc_feature\",\n  \"rustc_graphviz\","}, {"sha": "8b1ac617af827972363dfd49e326a3c54eddf89d", "filename": "compiler/rustc_error_messages/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/da370fe25afd1f4ddf3c4e545356eb3b011c1051/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da370fe25afd1f4ddf3c4e545356eb3b011c1051/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs?ref=da370fe25afd1f4ddf3c4e545356eb3b011c1051", "patch": "@@ -381,7 +381,7 @@ impl<S: Into<String>> From<S> for DiagnosticMessage {\n     }\n }\n \n-/// A workaround for \"good path\" ICEs when formatting types in disables lints.\n+/// A workaround for \"good path\" ICEs when formatting types in disabled lints.\n ///\n /// Delays formatting until `.into(): DiagnosticMessage` is used.\n pub struct DelayDm<F>(pub F);"}, {"sha": "543bd56a20c18e863b5aa714dc000b71c95a1fef", "filename": "compiler/rustc_middle/Cargo.toml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/da370fe25afd1f4ddf3c4e545356eb3b011c1051/compiler%2Frustc_middle%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/da370fe25afd1f4ddf3c4e545356eb3b011c1051/compiler%2Frustc_middle%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2FCargo.toml?ref=da370fe25afd1f4ddf3c4e545356eb3b011c1051", "patch": "@@ -18,6 +18,8 @@ rustc_ast = { path = \"../rustc_ast\" }\n rustc_attr = { path = \"../rustc_attr\" }\n rustc_data_structures = { path = \"../rustc_data_structures\" }\n rustc_errors = { path = \"../rustc_errors\" }\n+# Used for intra-doc links\n+rustc_error_messages = { path = \"../rustc_error_messages\" }\n rustc_feature = { path = \"../rustc_feature\" }\n rustc_graphviz = { path = \"../rustc_graphviz\" }\n rustc_hir = { path = \"../rustc_hir\" }"}, {"sha": "c49e75d68ad32b3401efcfa533edcf6e94ba9933", "filename": "compiler/rustc_middle/src/ty/print/pretty.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/da370fe25afd1f4ddf3c4e545356eb3b011c1051/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da370fe25afd1f4ddf3c4e545356eb3b011c1051/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs?ref=da370fe25afd1f4ddf3c4e545356eb3b011c1051", "patch": "@@ -2883,13 +2883,19 @@ fn for_each_def(tcx: TyCtxt<'_>, mut collect_fn: impl for<'b> FnMut(&'b Ident, N\n /// `std::vec::Vec` to just `Vec`, as long as there is no other `Vec` importable anywhere.\n ///\n /// The implementation uses similar import discovery logic to that of 'use' suggestions.\n+///\n+/// See also [`DelayDm`](rustc_error_messages::DelayDm) and [`with_no_trimmed_paths`].\n fn trimmed_def_paths(tcx: TyCtxt<'_>, (): ()) -> FxHashMap<DefId, Symbol> {\n     let mut map: FxHashMap<DefId, Symbol> = FxHashMap::default();\n \n     if let TrimmedDefPaths::GoodPath = tcx.sess.opts.trimmed_def_paths {\n+        // Trimming paths is expensive and not optimized, since we expect it to only be used for error reporting.\n+        //\n         // For good paths causing this bug, the `rustc_middle::ty::print::with_no_trimmed_paths`\n         // wrapper can be used to suppress this query, in exchange for full paths being formatted.\n-        tcx.sess.delay_good_path_bug(\"trimmed_def_paths constructed\");\n+        tcx.sess.delay_good_path_bug(\n+            \"trimmed_def_paths constructed but no error emitted; use `DelayDm` for lints or `with_no_trimmed_paths` for debugging\",\n+        );\n     }\n \n     let unique_symbols_rev: &mut FxHashMap<(Namespace, Symbol), Option<DefId>> ="}]}