{"sha": "c7e68638431b2a6639fcbeb44de790619de3b9b1", "node_id": "C_kwDOAAsO6NoAKGM3ZTY4NjM4NDMxYjJhNjYzOWZjYmViNDRkZTc5MDYxOWRlM2I5YjE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-09T14:57:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-09T14:57:06Z"}, "message": "Auto merge of #8664 - yoav-lavi:main, r=xFrednet\n\nAllow passing `--remove` to `cargo dev setup <SUBCOMMAND>`\n\nchangelog: none\n\nAllows passing `--remove` to `cargo dev setup <SUBCOMMAND>` as an alternative to `cargo dev remove ...`\n\nFixes https://github.com/rust-lang/rust-clippy/issues/8663", "tree": {"sha": "d4fcd097d9bfdc1deda85b33f9b420a42bd2e6b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4fcd097d9bfdc1deda85b33f9b420a42bd2e6b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7e68638431b2a6639fcbeb44de790619de3b9b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7e68638431b2a6639fcbeb44de790619de3b9b1", "html_url": "https://github.com/rust-lang/rust/commit/c7e68638431b2a6639fcbeb44de790619de3b9b1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7e68638431b2a6639fcbeb44de790619de3b9b1/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cfd52aa0ffdb3838348b2862d39e1856fad1ad88", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfd52aa0ffdb3838348b2862d39e1856fad1ad88", "html_url": "https://github.com/rust-lang/rust/commit/cfd52aa0ffdb3838348b2862d39e1856fad1ad88"}, {"sha": "ffde78b4564301888fcb4d5b970d8e9475bd33e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/ffde78b4564301888fcb4d5b970d8e9475bd33e9", "html_url": "https://github.com/rust-lang/rust/commit/ffde78b4564301888fcb4d5b970d8e9475bd33e9"}], "stats": {"total": 51, "additions": 44, "deletions": 7}, "files": [{"sha": "833b7393ff8b9748fa99c663a64b0a572cf2b86c", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 44, "deletions": 7, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/c7e68638431b2a6639fcbeb44de790619de3b9b1/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e68638431b2a6639fcbeb44de790619de3b9b1/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=c7e68638431b2a6639fcbeb44de790619de3b9b1", "patch": "@@ -36,13 +36,31 @@ fn main() {\n             }\n         },\n         (\"setup\", Some(sub_command)) => match sub_command.subcommand() {\n-            (\"intellij\", Some(matches)) => setup::intellij::setup_rustc_src(\n-                matches\n-                    .value_of(\"rustc-repo-path\")\n-                    .expect(\"this field is mandatory and therefore always valid\"),\n-            ),\n-            (\"git-hook\", Some(matches)) => setup::git_hook::install_hook(matches.is_present(\"force-override\")),\n-            (\"vscode-tasks\", Some(matches)) => setup::vscode::install_tasks(matches.is_present(\"force-override\")),\n+            (\"intellij\", Some(matches)) => {\n+                if matches.is_present(\"remove\") {\n+                    setup::intellij::remove_rustc_src();\n+                } else {\n+                    setup::intellij::setup_rustc_src(\n+                        matches\n+                            .value_of(\"rustc-repo-path\")\n+                            .expect(\"this field is mandatory and therefore always valid\"),\n+                    );\n+                }\n+            },\n+            (\"git-hook\", Some(matches)) => {\n+                if matches.is_present(\"remove\") {\n+                    setup::git_hook::remove_hook();\n+                } else {\n+                    setup::git_hook::install_hook(matches.is_present(\"force-override\"));\n+                }\n+            },\n+            (\"vscode-tasks\", Some(matches)) => {\n+                if matches.is_present(\"remove\") {\n+                    setup::vscode::remove_tasks();\n+                } else {\n+                    setup::vscode::install_tasks(matches.is_present(\"force-override\"));\n+                }\n+            },\n             _ => {},\n         },\n         (\"remove\", Some(sub_command)) => match sub_command.subcommand() {\n@@ -167,19 +185,32 @@ fn get_clap_config<'a>() -> ArgMatches<'a> {\n                 .subcommand(\n                     SubCommand::with_name(\"intellij\")\n                         .about(\"Alter dependencies so Intellij Rust can find rustc internals\")\n+                        .arg(\n+                            Arg::with_name(\"remove\")\n+                                .long(\"remove\")\n+                                .help(\"Remove the dependencies added with 'cargo dev setup intellij'\")\n+                                .required(false),\n+                        )\n                         .arg(\n                             Arg::with_name(\"rustc-repo-path\")\n                                 .long(\"repo-path\")\n                                 .short(\"r\")\n                                 .help(\"The path to a rustc repo that will be used for setting the dependencies\")\n                                 .takes_value(true)\n                                 .value_name(\"path\")\n+                                .conflicts_with(\"remove\")\n                                 .required(true),\n                         ),\n                 )\n                 .subcommand(\n                     SubCommand::with_name(\"git-hook\")\n                         .about(\"Add a pre-commit git hook that formats your code to make it look pretty\")\n+                        .arg(\n+                            Arg::with_name(\"remove\")\n+                                .long(\"remove\")\n+                                .help(\"Remove the pre-commit hook added with 'cargo dev setup git-hook'\")\n+                                .required(false),\n+                        )\n                         .arg(\n                             Arg::with_name(\"force-override\")\n                                 .long(\"force-override\")\n@@ -191,6 +222,12 @@ fn get_clap_config<'a>() -> ArgMatches<'a> {\n                 .subcommand(\n                     SubCommand::with_name(\"vscode-tasks\")\n                         .about(\"Add several tasks to vscode for formatting, validation and testing\")\n+                        .arg(\n+                            Arg::with_name(\"remove\")\n+                                .long(\"remove\")\n+                                .help(\"Remove the tasks added with 'cargo dev setup vscode-tasks'\")\n+                                .required(false),\n+                        )\n                         .arg(\n                             Arg::with_name(\"force-override\")\n                                 .long(\"force-override\")"}]}