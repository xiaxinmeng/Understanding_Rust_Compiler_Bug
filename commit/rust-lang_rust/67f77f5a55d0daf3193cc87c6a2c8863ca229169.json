{"sha": "67f77f5a55d0daf3193cc87c6a2c8863ca229169", "node_id": "C_kwDOAAsO6NoAKDY3Zjc3ZjVhNTVkMGRhZjMxOTNjYzg3YzZhMmM4ODYzY2EyMjkxNjk", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-20T05:09:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-20T05:09:02Z"}, "message": "Rollup merge of #100709 - JhonnyBillM:port-expected-used-symbol-diagnostic, r=compiler-errors\n\nMigrate typeck's `used` expected symbol diagnostic to `SessionDiagnostic`\n\nr? ``@davidtwco``", "tree": {"sha": "4db1da2559e0a290c0345e681aea2156cbfd0c0f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4db1da2559e0a290c0345e681aea2156cbfd0c0f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/67f77f5a55d0daf3193cc87c6a2c8863ca229169", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjAGxuCRBK7hj4Ov3rIwAAN9IIAIs72+gpTFJiK0ybH8iznKJX\n+kVcq+gAirkFW/901b5xC3nFukNxhDtWLfqqz3POLplIxLJOVprCzs/+q9Biky2m\nkaQSQVLL+7LLb96O42b4KEsyREZJ6dtUqIGUYVJ4cJR3XmQzhLbzRVhH09f18a7y\nDoN+JwP6Kea0knY6uUZylY9egjF8mz3U47u/6vRV4c7cSkkZOHbgZ+HQttdq5l9r\nf2BPEWgmgXW7u7gI2W+5H7lv0JE3PPzMi6msGTYX4WDUBNVG44pkqt7fb2fNo9FU\nG//TjkzDo97Jn0vsEfWQ4LK71bG01+Wukq1Y2NW9CYDxyoSWECkEj1azjvLNzFQ=\n=QTy4\n-----END PGP SIGNATURE-----\n", "payload": "tree 4db1da2559e0a290c0345e681aea2156cbfd0c0f\nparent eacbe5437ec407c57892ba1cf1da312c9bacfc7d\nparent af4f66ef938bd21b82a81473974cb620be9a0c72\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1660972142 +0200\ncommitter GitHub <noreply@github.com> 1660972142 +0200\n\nRollup merge of #100709 - JhonnyBillM:port-expected-used-symbol-diagnostic, r=compiler-errors\n\nMigrate typeck's `used` expected symbol diagnostic to `SessionDiagnostic`\n\nr? ``@davidtwco``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/67f77f5a55d0daf3193cc87c6a2c8863ca229169", "html_url": "https://github.com/rust-lang/rust/commit/67f77f5a55d0daf3193cc87c6a2c8863ca229169", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/67f77f5a55d0daf3193cc87c6a2c8863ca229169/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eacbe5437ec407c57892ba1cf1da312c9bacfc7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/eacbe5437ec407c57892ba1cf1da312c9bacfc7d", "html_url": "https://github.com/rust-lang/rust/commit/eacbe5437ec407c57892ba1cf1da312c9bacfc7d"}, {"sha": "af4f66ef938bd21b82a81473974cb620be9a0c72", "url": "https://api.github.com/repos/rust-lang/rust/commits/af4f66ef938bd21b82a81473974cb620be9a0c72", "html_url": "https://github.com/rust-lang/rust/commit/af4f66ef938bd21b82a81473974cb620be9a0c72"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "272731d9914cc4cb48df34369c03e0e86fa2c028", "filename": "compiler/rustc_error_messages/locales/en-US/typeck.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/67f77f5a55d0daf3193cc87c6a2c8863ca229169/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Ftypeck.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/67f77f5a55d0daf3193cc87c6a2c8863ca229169/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Ftypeck.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Ftypeck.ftl?ref=67f77f5a55d0daf3193cc87c6a2c8863ca229169", "patch": "@@ -131,3 +131,5 @@ typeck_unused_extern_crate =\n typeck_extern_crate_not_idiomatic =\n     `extern crate` is not idiomatic in the new edition\n     .suggestion = convert it to a `{$msg_code}`\n+\n+typeck_expected_used_symbol = expected `used`, `used(compiler)` or `used(linker)`"}, {"sha": "970b39dc845afbf65225a1b1e966068ef052fa5f", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/67f77f5a55d0daf3193cc87c6a2c8863ca229169/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/67f77f5a55d0daf3193cc87c6a2c8863ca229169/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=67f77f5a55d0daf3193cc87c6a2c8863ca229169", "patch": "@@ -2836,12 +2836,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, did: DefId) -> CodegenFnAttrs {\n                     codegen_fn_attrs.flags |= CodegenFnAttrFlags::USED;\n                 }\n                 Some(_) => {\n-                    tcx.sess\n-                        .struct_span_err(\n-                            attr.span,\n-                            \"expected `used`, `used(compiler)` or `used(linker)`\",\n-                        )\n-                        .emit();\n+                    tcx.sess.emit_err(errors::ExpectedUsedSymbol { span: attr.span });\n                 }\n                 None => {\n                     // Unfortunately, unconditionally using `llvm.used` causes"}, {"sha": "8b1cb8d1c939ab144c459d287301b43acbeef267", "filename": "compiler/rustc_typeck/src/errors.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/67f77f5a55d0daf3193cc87c6a2c8863ca229169/compiler%2Frustc_typeck%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/67f77f5a55d0daf3193cc87c6a2c8863ca229169/compiler%2Frustc_typeck%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Ferrors.rs?ref=67f77f5a55d0daf3193cc87c6a2c8863ca229169", "patch": "@@ -340,3 +340,10 @@ pub struct ExternCrateNotIdiomatic {\n     pub msg_code: String,\n     pub suggestion_code: String,\n }\n+\n+#[derive(SessionDiagnostic)]\n+#[error(typeck::expected_used_symbol)]\n+pub struct ExpectedUsedSymbol {\n+    #[primary_span]\n+    pub span: Span,\n+}"}]}