{"sha": "d5f5487252535da878f43486e94007d2b2fce142", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ1ZjU0ODcyNTI1MzVkYTg3OGY0MzQ4NmU5NDAwN2QyYjJmY2UxNDI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-13T13:31:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-13T13:31:55Z"}, "message": "Auto merge of #5899 - JarredAllen:rc-box-suggestion, r=yaahc\n\nChange Rc<Box<T>> recommendation to be Rc<T> instead of Box<T>\n\nFixes #5722\n\nchangelog: Suggest `Rc<Box<T>>` -> `Rc<T>` in [`redundant_allocation`] lint", "tree": {"sha": "eeaa79b496ef6302d5a288780889b99bb737c3da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eeaa79b496ef6302d5a288780889b99bb737c3da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d5f5487252535da878f43486e94007d2b2fce142", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d5f5487252535da878f43486e94007d2b2fce142", "html_url": "https://github.com/rust-lang/rust/commit/d5f5487252535da878f43486e94007d2b2fce142", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d5f5487252535da878f43486e94007d2b2fce142/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fc4fd91914f1d5e7c82c6d3fdfcf77770c9f3404", "url": "https://api.github.com/repos/rust-lang/rust/commits/fc4fd91914f1d5e7c82c6d3fdfcf77770c9f3404", "html_url": "https://github.com/rust-lang/rust/commit/fc4fd91914f1d5e7c82c6d3fdfcf77770c9f3404"}, {"sha": "4e28d99f413572087a74e1a70b17f051a08d3821", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e28d99f413572087a74e1a70b17f051a08d3821", "html_url": "https://github.com/rust-lang/rust/commit/4e28d99f413572087a74e1a70b17f051a08d3821"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "e0204273197f5d8c8ea408f3f50220934800a165", "filename": "clippy_lints/src/types.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d5f5487252535da878f43486e94007d2b2fce142/clippy_lints%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5f5487252535da878f43486e94007d2b2fce142/clippy_lints%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftypes.rs?ref=d5f5487252535da878f43486e94007d2b2fce142", "patch": "@@ -353,14 +353,25 @@ impl Types {\n                             );\n                             return; // don't recurse into the type\n                         }\n-                        if let Some(span) = match_type_parameter(cx, qpath, &paths::BOX) {\n+                        if match_type_parameter(cx, qpath, &paths::BOX).is_some() {\n+                            let box_ty = match &last_path_segment(qpath).args.unwrap().args[0] {\n+                                GenericArg::Type(ty) => match &ty.kind {\n+                                    TyKind::Path(qpath) => qpath,\n+                                    _ => return,\n+                                },\n+                                _ => return,\n+                            };\n+                            let inner_span = match &last_path_segment(&box_ty).args.unwrap().args[0] {\n+                                GenericArg::Type(ty) => ty.span,\n+                                _ => return,\n+                            };\n                             span_lint_and_sugg(\n                                 cx,\n                                 REDUNDANT_ALLOCATION,\n                                 hir_ty.span,\n                                 \"usage of `Rc<Box<T>>`\",\n                                 \"try\",\n-                                snippet(cx, span, \"..\").to_string(),\n+                                format!(\"Rc<{}>\", snippet(cx, inner_span, \"..\")),\n                                 Applicability::MachineApplicable,\n                             );\n                             return; // don't recurse into the type"}, {"sha": "6514fd6d1ac76bbe7ebbbd37453af5002e3c3308", "filename": "tests/ui/redundant_allocation.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d5f5487252535da878f43486e94007d2b2fce142/tests%2Fui%2Fredundant_allocation.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/d5f5487252535da878f43486e94007d2b2fce142/tests%2Fui%2Fredundant_allocation.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_allocation.fixed?ref=d5f5487252535da878f43486e94007d2b2fce142", "patch": "@@ -33,7 +33,7 @@ pub fn test5(a: Rc<bool>) {}\n \n // Rc<Box<T>>\n \n-pub fn test6(a: Box<bool>) {}\n+pub fn test6(a: Rc<bool>) {}\n \n // Box<&T>\n "}, {"sha": "92e4f67f5db6e40e6f2f0f9bd8ed422b3ec32c0c", "filename": "tests/ui/redundant_allocation.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d5f5487252535da878f43486e94007d2b2fce142/tests%2Fui%2Fredundant_allocation.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d5f5487252535da878f43486e94007d2b2fce142/tests%2Fui%2Fredundant_allocation.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_allocation.stderr?ref=d5f5487252535da878f43486e94007d2b2fce142", "patch": "@@ -28,7 +28,7 @@ error: usage of `Rc<Box<T>>`\n   --> $DIR/redundant_allocation.rs:36:17\n    |\n LL | pub fn test6(a: Rc<Box<bool>>) {}\n-   |                 ^^^^^^^^^^^^^ help: try: `Box<bool>`\n+   |                 ^^^^^^^^^^^^^ help: try: `Rc<bool>`\n \n error: usage of `Box<&T>`\n   --> $DIR/redundant_allocation.rs:40:22"}]}