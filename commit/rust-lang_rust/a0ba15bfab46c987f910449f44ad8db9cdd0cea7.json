{"sha": "a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "node_id": "C_kwDOAAsO6NoAKGEwYmExNWJmYWI0NmM5ODdmOTEwNDQ5ZjQ0YWQ4ZGI5Y2RkMGNlYTc", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-04-19T20:57:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-19T20:57:40Z"}, "message": "Rollup merge of #95813 - Urgau:rustdoc-where-clause-space, r=GuillaumeGomez\n\nRemove extra space before a where clause\n\nRemove extra space before where clause in the generated documentation.\n\nThe fix is to move the space before the break-line so that it doesn't appear visually but is still here. Removing it completely would create things like this `impl<D> Delta<D>where D: MyTrait` (missing a space before the where) which I don't think we want.\n\nAdded two regression test, first one test that the `<br>` is after the space and the second check that the `<br>` is before the spaces.\n\nBefore:\n![image](https://user-images.githubusercontent.com/3616612/162475212-d4bb6727-ed66-4a55-a4a2-4f55189bf8bd.png)\n\nAfter:\n![image](https://user-images.githubusercontent.com/3616612/162475467-508fd082-60a7-4a8c-b693-8b188e8843e6.png)\n\nr? ``@GuillaumeGomez``", "tree": {"sha": "d122b8a0ecd4b1be0e3931f65748b0a55d04784b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d122b8a0ecd4b1be0e3931f65748b0a55d04784b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiXyJECRBK7hj4Ov3rIwAANE4IAIYbo+wRwTNmdoXrp4ljkSdE\nB5t3sTRIoIRY3UqUWjfYWzEJOj4pKkq+Kz8gBBcgPFrTcrC5LLTTWa2+K6YaFi/9\nCsYLd2Zjf+0iHkUGhr3kDIctaaNST5cKfFXP4H3wCWTAHOmw+Z04dumZoUeR0XUV\nYattHo/188qq+RE33Ezpkb/MszCUQSSPhav6JtxOk7m16JzW9qKi+CDRII4s6P5c\nzsx5TcFlayeAuz0hck3hm3P8GX0CIL8E2XMIxS/3p/PPq2QcRd2F4Rpsz8X1SW6d\ncfzx85T3kfftCOewAwiPVqqdt9mYbomwzJ8NC9m1WIJCwWA/HXgAMTlPd5txDjw=\n=sb9Z\n-----END PGP SIGNATURE-----\n", "payload": "tree d122b8a0ecd4b1be0e3931f65748b0a55d04784b\nparent 69e45d73b9435e20aa33c8b2ba559e478412974c\nparent f7ce145d83311f7d288d1169376bbcc5f88ea5f9\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1650401860 +0200\ncommitter GitHub <noreply@github.com> 1650401860 +0200\n\nRollup merge of #95813 - Urgau:rustdoc-where-clause-space, r=GuillaumeGomez\n\nRemove extra space before a where clause\n\nRemove extra space before where clause in the generated documentation.\n\nThe fix is to move the space before the break-line so that it doesn't appear visually but is still here. Removing it completely would create things like this `impl<D> Delta<D>where D: MyTrait` (missing a space before the where) which I don't think we want.\n\nAdded two regression test, first one test that the `<br>` is after the space and the second check that the `<br>` is before the spaces.\n\nBefore:\n![image](https://user-images.githubusercontent.com/3616612/162475212-d4bb6727-ed66-4a55-a4a2-4f55189bf8bd.png)\n\nAfter:\n![image](https://user-images.githubusercontent.com/3616612/162475467-508fd082-60a7-4a8c-b693-8b188e8843e6.png)\n\nr? ``@GuillaumeGomez``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "html_url": "https://github.com/rust-lang/rust/commit/a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69e45d73b9435e20aa33c8b2ba559e478412974c", "url": "https://api.github.com/repos/rust-lang/rust/commits/69e45d73b9435e20aa33c8b2ba559e478412974c", "html_url": "https://github.com/rust-lang/rust/commit/69e45d73b9435e20aa33c8b2ba559e478412974c"}, {"sha": "f7ce145d83311f7d288d1169376bbcc5f88ea5f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7ce145d83311f7d288d1169376bbcc5f88ea5f9", "html_url": "https://github.com/rust-lang/rust/commit/f7ce145d83311f7d288d1169376bbcc5f88ea5f9"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "fd6d675dc8b8c5247ee16a9a55a49daea15e3323", "filename": "src/librustdoc/html/format.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fformat.rs?ref=a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "patch": "@@ -370,7 +370,8 @@ crate fn print_where_clause<'a, 'tcx: 'a>(\n             clause = clause.replace(\"<br>\", &format!(\"<br>{}\", padding));\n             clause.insert_str(0, &\"&nbsp;\".repeat(indent.saturating_sub(1)));\n             if !end_newline {\n-                clause.insert_str(0, \"<br>\");\n+                // we insert the <br> after a single space but before multiple spaces at the start\n+                clause.insert_str(if indent == 0 { 1 } else { 0 }, \"<br>\");\n             }\n         }\n         write!(f, \"{}\", clause)"}, {"sha": "0133bcaeb66734f700c59da6b6ec9d0749d812a8", "filename": "src/test/rustdoc/where.SWhere_Simd_item-decl.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Ftest%2Frustdoc%2Fwhere.SWhere_Simd_item-decl.html", "raw_url": "https://github.com/rust-lang/rust/raw/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Ftest%2Frustdoc%2Fwhere.SWhere_Simd_item-decl.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fwhere.SWhere_Simd_item-decl.html?ref=a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "patch": "@@ -0,0 +1 @@\n+<div class=\"docblock item-decl\"><pre class=\"rust struct\"><code>pub struct Simd&lt;T&gt;(_) <br /><span class=\"where\">where<br />&#160;&#160;&#160;&#160;T: <a class=\"trait\" href=\"trait.MyTrait.html\" title=\"trait foo::MyTrait\">MyTrait</a></span>;</code></pre></div>\n\\ No newline at end of file"}, {"sha": "54026ff034e001b93f3b6fd8f4b5141ff5528f76", "filename": "src/test/rustdoc/where.SWhere_TraitWhere_item-decl.html", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Ftest%2Frustdoc%2Fwhere.SWhere_TraitWhere_item-decl.html", "raw_url": "https://github.com/rust-lang/rust/raw/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Ftest%2Frustdoc%2Fwhere.SWhere_TraitWhere_item-decl.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fwhere.SWhere_TraitWhere_item-decl.html?ref=a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "patch": "@@ -0,0 +1,3 @@\n+<div class=\"docblock item-decl\"><pre class=\"rust trait\"><code>pub trait TraitWhere {\n+    type <a href=\"#associatedtype.Item\" class=\"associatedtype\">Item</a>&lt;'a&gt;<br />&#160;&#160;&#160; <span class=\"where\">where<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Self: 'a</span>;\n+}</code></pre></div>\n\\ No newline at end of file"}, {"sha": "50a5722fbaff6926e5feec51c6ffd18d531bac5a", "filename": "src/test/rustdoc/where.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Ftest%2Frustdoc%2Fwhere.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0ba15bfab46c987f910449f44ad8db9cdd0cea7/src%2Ftest%2Frustdoc%2Fwhere.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fwhere.rs?ref=a0ba15bfab46c987f910449f44ad8db9cdd0cea7", "patch": "@@ -1,3 +1,4 @@\n+#![feature(generic_associated_types)]\n #![crate_name = \"foo\"]\n \n pub trait MyTrait { fn dummy(&self) { } }\n@@ -19,6 +20,18 @@ impl<D> Delta<D> where D: MyTrait {\n \n pub struct Echo<E>(E);\n \n+// @has 'foo/struct.Simd.html'\n+// @snapshot SWhere_Simd_item-decl - '//div[@class=\"docblock item-decl\"]'\n+pub struct Simd<T>([T; 1])\n+where\n+    T: MyTrait;\n+\n+// @has 'foo/trait.TraitWhere.html'\n+// @snapshot SWhere_TraitWhere_item-decl - '//div[@class=\"docblock item-decl\"]'\n+pub trait TraitWhere {\n+    type Item<'a> where Self: 'a;\n+}\n+\n // @has foo/struct.Echo.html '//*[@class=\"impl has-srclink\"]//h3[@class=\"code-header in-band\"]' \\\n //          \"impl<E> MyTrait for Echo<E> where E: MyTrait\"\n // @has foo/trait.MyTrait.html '//*[@id=\"implementors-list\"]//h3[@class=\"code-header in-band\"]' \\"}]}