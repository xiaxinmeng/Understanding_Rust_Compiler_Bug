{"sha": "0db527e2f8033e49ee588b3be71f3cd7a0d13b7c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkYjUyN2UyZjgwMzNlNDllZTU4OGIzYmU3MWYzY2Q3YTBkMTNiN2M=", "commit": {"author": {"name": "Zack Corr", "email": "zack@z0w0.me", "date": "2013-02-12T02:27:19Z"}, "committer": {"name": "Zack Corr", "email": "zack@z0w0.me", "date": "2013-02-12T02:27:19Z"}, "message": "core: Fix dec/inc_kernel_live_count mixup", "tree": {"sha": "ca1cd18813bc09c234e2b94640d558e4f86ff1a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ca1cd18813bc09c234e2b94640d558e4f86ff1a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0db527e2f8033e49ee588b3be71f3cd7a0d13b7c", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0db527e2f8033e49ee588b3be71f3cd7a0d13b7c", "html_url": "https://github.com/rust-lang/rust/commit/0db527e2f8033e49ee588b3be71f3cd7a0d13b7c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0db527e2f8033e49ee588b3be71f3cd7a0d13b7c/comments", "author": {"login": "z0w0", "id": 676417, "node_id": "MDQ6VXNlcjY3NjQxNw==", "avatar_url": "https://avatars.githubusercontent.com/u/676417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/z0w0", "html_url": "https://github.com/z0w0", "followers_url": "https://api.github.com/users/z0w0/followers", "following_url": "https://api.github.com/users/z0w0/following{/other_user}", "gists_url": "https://api.github.com/users/z0w0/gists{/gist_id}", "starred_url": "https://api.github.com/users/z0w0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/z0w0/subscriptions", "organizations_url": "https://api.github.com/users/z0w0/orgs", "repos_url": "https://api.github.com/users/z0w0/repos", "events_url": "https://api.github.com/users/z0w0/events{/privacy}", "received_events_url": "https://api.github.com/users/z0w0/received_events", "type": "User", "site_admin": false}, "committer": {"login": "z0w0", "id": 676417, "node_id": "MDQ6VXNlcjY3NjQxNw==", "avatar_url": "https://avatars.githubusercontent.com/u/676417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/z0w0", "html_url": "https://github.com/z0w0", "followers_url": "https://api.github.com/users/z0w0/followers", "following_url": "https://api.github.com/users/z0w0/following{/other_user}", "gists_url": "https://api.github.com/users/z0w0/gists{/gist_id}", "starred_url": "https://api.github.com/users/z0w0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/z0w0/subscriptions", "organizations_url": "https://api.github.com/users/z0w0/orgs", "repos_url": "https://api.github.com/users/z0w0/repos", "events_url": "https://api.github.com/users/z0w0/events{/privacy}", "received_events_url": "https://api.github.com/users/z0w0/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ebd20b7944c3b427a90e89d3b4a9e43926336eb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/ebd20b7944c3b427a90e89d3b4a9e43926336eb8", "html_url": "https://github.com/rust-lang/rust/commit/ebd20b7944c3b427a90e89d3b4a9e43926336eb8"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "7b9dfd9b457c977db104a3943b4d47725da0927f", "filename": "src/libcore/private/weak_task.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0db527e2f8033e49ee588b3be71f3cd7a0d13b7c/src%2Flibcore%2Fprivate%2Fweak_task.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0db527e2f8033e49ee588b3be71f3cd7a0d13b7c/src%2Flibcore%2Fprivate%2Fweak_task.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fprivate%2Fweak_task.rs?ref=0db527e2f8033e49ee588b3be71f3cd7a0d13b7c", "patch": "@@ -40,12 +40,12 @@ pub unsafe fn weaken_task(f: &fn(Port<ShutdownMsg>)) {\n     let task = get_task_id();\n     // Expect the weak task service to be alive\n     assert service.try_send(RegisterWeakTask(task, shutdown_chan));\n-    unsafe { rust_inc_kernel_live_count(); }\n+    unsafe { rust_dec_kernel_live_count(); }\n     do fn&() {\n         let shutdown_port = swap_unwrap(&mut *shutdown_port);\n         f(shutdown_port)\n     }.finally || {\n-        unsafe { rust_dec_kernel_live_count(); }\n+        unsafe { rust_inc_kernel_live_count(); }\n         // Service my have already exited\n         service.send(UnregisterWeakTask(task));\n     }\n@@ -78,11 +78,11 @@ fn create_global_service() -> ~WeakTaskService {\n             let port = swap_unwrap(&mut *port);\n             // The weak task service is itself a weak task\n             debug!(\"weakening the weak service task\");\n-            unsafe { rust_inc_kernel_live_count(); }\n+            unsafe { rust_dec_kernel_live_count(); }\n             run_weak_task_service(port);\n         }.finally {\n             debug!(\"unweakening the weak service task\");\n-            unsafe { rust_dec_kernel_live_count(); }\n+            unsafe { rust_inc_kernel_live_count(); }\n         }\n     }\n "}]}