{"sha": "68bf8d2487103f90c0427701cf2247d758de9d13", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4YmY4ZDI0ODcxMDNmOTBjMDQyNzcwMWNmMjI0N2Q3NThkZTlkMTM=", "commit": {"author": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2020-05-26T23:45:30Z"}, "committer": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2020-05-27T01:49:55Z"}, "message": "expand `env!` with def-site context", "tree": {"sha": "a477fffeba683be8a484f95a22e41137be331ca4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a477fffeba683be8a484f95a22e41137be331ca4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68bf8d2487103f90c0427701cf2247d758de9d13", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFKBAABCAA0FiEELriChyEaiMu0yCg7viIhAz7bw3QFAl7Nx0UWHGFydXNzZWxs\nMTIzQGdtYWlsLmNvbQAKCRC+IiEDPtvDdMBdCACmONQ64R6qCsW2JQ3h0D1NVZFl\n7nRQI59vOW1pnxTdJ3dZoXCTDKm1iox8u47u4vKzf48bhzpndwrCOyjGFE4p3nvK\nrpBb5MjXLuARavn/mnU30zWngd9qeD0/UtWgNtKZ4BLDh46x7Qx7TyN3xGCta114\nAEkM2DWwISjGzNvLi6bpwCSi61x1FLBpzYwOl+94mJ0Q11eq63Wy2A6wNnV1+NEI\neHKjgRP30za8djzIdyrTiaFCsEFWTyQ1xLDfiNzzf4rNBwTN+YrHjzEmEqm8p0r5\n6vMsJWO7parelRnGNKYrmSSTyQTTLZ3LOGDMOugcSPWrL6TPoE5YxzIlWEhR\n=/3Vy\n-----END PGP SIGNATURE-----", "payload": "tree a477fffeba683be8a484f95a22e41137be331ca4\nparent 5239f5c57bb6eb9e894081727f5aba0a67e89763\nauthor Andy Russell <arussell123@gmail.com> 1590536730 -0400\ncommitter Andy Russell <arussell123@gmail.com> 1590544195 -0400\n\nexpand `env!` with def-site context\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68bf8d2487103f90c0427701cf2247d758de9d13", "html_url": "https://github.com/rust-lang/rust/commit/68bf8d2487103f90c0427701cf2247d758de9d13", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68bf8d2487103f90c0427701cf2247d758de9d13/comments", "author": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "committer": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5239f5c57bb6eb9e894081727f5aba0a67e89763", "url": "https://api.github.com/repos/rust-lang/rust/commits/5239f5c57bb6eb9e894081727f5aba0a67e89763", "html_url": "https://github.com/rust-lang/rust/commit/5239f5c57bb6eb9e894081727f5aba0a67e89763"}], "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "d769ebb1f5520d621ef27b299eccee1217607d49", "filename": "src/librustc_builtin_macros/env.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Flibrustc_builtin_macros%2Fenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Flibrustc_builtin_macros%2Fenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_builtin_macros%2Fenv.rs?ref=68bf8d2487103f90c0427701cf2247d758de9d13", "patch": "@@ -77,6 +77,7 @@ pub fn expand_env<'cx>(\n         return DummyResult::any(sp);\n     }\n \n+    let sp = cx.with_def_site_ctxt(sp);\n     let e = match env::var(&*var.as_str()) {\n         Err(_) => {\n             cx.span_err(sp, &msg.as_str());"}, {"sha": "56415fd1f0dd0ef4cd262f0f1d440cdd3557b5ad", "filename": "src/test/ui/extenv/extenv-not-defined-custom.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-custom.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-custom.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-custom.stderr?ref=68bf8d2487103f90c0427701cf2247d758de9d13", "patch": "@@ -3,6 +3,8 @@ error: my error message\n    |\n LL | fn main() { env!(\"__HOPEFULLY_NOT_DEFINED__\", \"my error message\"); }\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: aborting due to previous error\n "}, {"sha": "1a9332c4f1c9fd6e880457cc13ba18e2788cb960", "filename": "src/test/ui/extenv/extenv-not-defined-default.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-default.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-default.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-default.stderr?ref=68bf8d2487103f90c0427701cf2247d758de9d13", "patch": "@@ -3,6 +3,8 @@ error: environment variable `__HOPEFULLY_NOT_DEFINED__` not defined\n    |\n LL |     env!(\"__HOPEFULLY_NOT_DEFINED__\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: aborting due to previous error\n "}, {"sha": "b62f06e33e531ccbf230c6f21d8c12d5e20e6791", "filename": "src/test/ui/extenv/issue-55897.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fextenv%2Fissue-55897.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fextenv%2Fissue-55897.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextenv%2Fissue-55897.stderr?ref=68bf8d2487103f90c0427701cf2247d758de9d13", "patch": "@@ -3,6 +3,8 @@ error: environment variable `NON_EXISTENT` not defined\n    |\n LL |     include!(concat!(env!(\"NON_EXISTENT\"), \"/data.rs\"));\n    |                      ^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: suffixes on a string literal are invalid\n   --> $DIR/issue-55897.rs:16:22"}, {"sha": "42954ebcdc1cd4df6e4cdf7f70804773b13ecfca", "filename": "src/test/ui/macros/macros-nonfatal-errors.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/68bf8d2487103f90c0427701cf2247d758de9d13/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr?ref=68bf8d2487103f90c0427701cf2247d758de9d13", "patch": "@@ -47,6 +47,8 @@ error: environment variable `RUST_HOPEFULLY_THIS_DOESNT_EXIST` not defined\n    |\n LL |     env!(\"RUST_HOPEFULLY_THIS_DOESNT_EXIST\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: format argument must be a string literal\n   --> $DIR/macros-nonfatal-errors.rs:23:13"}]}