{"sha": "b03883279528986bd829e14f967db4b4c980049d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIwMzg4MzI3OTUyODk4NmJkODI5ZTE0Zjk2N2RiNGI0Yzk4MDA0OWQ=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-21T10:56:05Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-21T10:56:05Z"}, "message": "Merge #997\n\n997: Improve filtering of file roots r=matklad a=vipentti\n\n`ProjectWorkspace::to_roots` now returns a new `ProjectRoot` which contains\r\ninformation regarding whether or not the given path is part of the current\r\nworkspace or an external dependency. This information can then be used in\r\n`ra_batch` and `ra_lsp_server` to implement more advanced filtering. This allows\r\nus to filter some unnecessary folders from external dependencies such as tests,\r\nexamples and benches.\r\n\r\nRelates to discussion in #869 \n\nCo-authored-by: Ville Penttinen <villem.penttinen@gmail.com>", "tree": {"sha": "b891f591e240e84d14dc8060e3706ee025cc0906", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b891f591e240e84d14dc8060e3706ee025cc0906"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b03883279528986bd829e14f967db4b4c980049d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b03883279528986bd829e14f967db4b4c980049d", "html_url": "https://github.com/rust-lang/rust/commit/b03883279528986bd829e14f967db4b4c980049d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b03883279528986bd829e14f967db4b4c980049d/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "1eb3bf41d75a8c744a0ecb586d4a2e92a1175c08", "url": "https://api.github.com/repos/rust-lang/rust/commits/1eb3bf41d75a8c744a0ecb586d4a2e92a1175c08", "html_url": "https://github.com/rust-lang/rust/commit/1eb3bf41d75a8c744a0ecb586d4a2e92a1175c08"}, {"sha": "c6d6e6c6259709ec30eadb79a1908dca707a6499", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6d6e6c6259709ec30eadb79a1908dca707a6499", "html_url": "https://github.com/rust-lang/rust/commit/c6d6e6c6259709ec30eadb79a1908dca707a6499"}], "stats": {"total": 242, "additions": 180, "deletions": 62}, "files": [{"sha": "50fe1fa23b5329209ebfec0d3359dfe1d9d5c6b2", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -1089,6 +1089,7 @@ dependencies = [\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ra_arena 0.1.0\",\n  \"ra_db 0.1.0\",\n+ \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde 1.0.89 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde_json 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "deb9f95d75f1e5efdc6284abde43b0d65a53cf36", "filename": "crates/ra_batch/src/lib.rs", "status": "modified", "additions": 7, "deletions": 29, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_batch%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_batch%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_batch%2Fsrc%2Flib.rs?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -1,5 +1,7 @@\n+mod vfs_filter;\n+\n use std::sync::Arc;\n-use std::path::{Path, PathBuf};\n+use std::path::Path;\n use std::collections::HashSet;\n \n use rustc_hash::FxHashMap;\n@@ -9,7 +11,8 @@ use ra_db::{\n };\n use ra_hir::{db, HirInterner};\n use ra_project_model::ProjectWorkspace;\n-use ra_vfs::{Vfs, VfsChange, RootEntry, Filter, RelativePath};\n+use ra_vfs::{Vfs, VfsChange};\n+use vfs_filter::IncludeRustFiles;\n \n type Result<T> = std::result::Result<T, failure::Error>;\n \n@@ -43,30 +46,6 @@ fn vfs_root_to_id(r: ra_vfs::VfsRoot) -> SourceRootId {\n     SourceRootId(r.0.into())\n }\n \n-struct IncludeRustFiles;\n-\n-impl IncludeRustFiles {\n-    fn to_entry(path: PathBuf) -> RootEntry {\n-        RootEntry::new(path, Box::new(Self {}))\n-    }\n-}\n-\n-impl Filter for IncludeRustFiles {\n-    fn include_dir(&self, dir_path: &RelativePath) -> bool {\n-        const IGNORED_FOLDERS: &[&str] = &[\"node_modules\", \"target\", \".git\"];\n-\n-        let is_ignored = dir_path.components().any(|c| IGNORED_FOLDERS.contains(&c.as_str()));\n-\n-        let hidden = dir_path.components().any(|c| c.as_str().starts_with(\".\"));\n-\n-        !is_ignored && !hidden\n-    }\n-\n-    fn include_file(&self, file_path: &RelativePath) -> bool {\n-        file_path.extension() == Some(\"rs\")\n-    }\n-}\n-\n impl BatchDatabase {\n     pub fn load(crate_graph: CrateGraph, vfs: &mut Vfs) -> BatchDatabase {\n         let mut db =\n@@ -122,9 +101,8 @@ impl BatchDatabase {\n         let root = std::env::current_dir()?.join(root);\n         let ws = ProjectWorkspace::discover(root.as_ref())?;\n         let mut roots = Vec::new();\n-        roots.push(root.clone());\n-        roots.extend(ws.to_roots());\n-        let roots = roots.into_iter().map(IncludeRustFiles::to_entry).collect::<Vec<_>>();\n+        roots.push(IncludeRustFiles::member(root.clone()));\n+        roots.extend(IncludeRustFiles::from_roots(ws.to_roots()));\n         let (mut vfs, roots) = Vfs::new(roots);\n         let mut load = |path: &Path| {\n             let vfs_file = vfs.load(path);"}, {"sha": "dd20c12031ffb4a076db7db72b4376efc9b363ec", "filename": "crates/ra_batch/src/vfs_filter.rs", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_batch%2Fsrc%2Fvfs_filter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_batch%2Fsrc%2Fvfs_filter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_batch%2Fsrc%2Fvfs_filter.rs?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -0,0 +1,54 @@\n+use std::path::PathBuf;\r\n+use ra_project_model::ProjectRoot;\r\n+use ra_vfs::{RootEntry, Filter, RelativePath};\r\n+\r\n+/// `IncludeRustFiles` is used to convert\r\n+/// from `ProjectRoot` to `RootEntry` for VFS\r\n+pub struct IncludeRustFiles {\r\n+    root: ProjectRoot,\r\n+}\r\n+\r\n+impl IncludeRustFiles {\r\n+    pub fn from_roots<R>(roots: R) -> impl Iterator<Item = RootEntry>\r\n+    where\r\n+        R: IntoIterator<Item = ProjectRoot>,\r\n+    {\r\n+        roots.into_iter().map(IncludeRustFiles::from_root)\r\n+    }\r\n+\r\n+    pub fn from_root(root: ProjectRoot) -> RootEntry {\r\n+        IncludeRustFiles::from(root).into()\r\n+    }\r\n+\r\n+    #[allow(unused)]\r\n+    pub fn external(path: PathBuf) -> RootEntry {\r\n+        IncludeRustFiles::from_root(ProjectRoot::new(path, false))\r\n+    }\r\n+\r\n+    pub fn member(path: PathBuf) -> RootEntry {\r\n+        IncludeRustFiles::from_root(ProjectRoot::new(path, true))\r\n+    }\r\n+}\r\n+\r\n+impl Filter for IncludeRustFiles {\r\n+    fn include_dir(&self, dir_path: &RelativePath) -> bool {\r\n+        self.root.include_dir(dir_path)\r\n+    }\r\n+\r\n+    fn include_file(&self, file_path: &RelativePath) -> bool {\r\n+        self.root.include_file(file_path)\r\n+    }\r\n+}\r\n+\r\n+impl std::convert::From<ProjectRoot> for IncludeRustFiles {\r\n+    fn from(v: ProjectRoot) -> IncludeRustFiles {\r\n+        IncludeRustFiles { root: v }\r\n+    }\r\n+}\r\n+\r\n+impl std::convert::From<IncludeRustFiles> for RootEntry {\r\n+    fn from(v: IncludeRustFiles) -> RootEntry {\r\n+        let path = v.root.path().clone();\r\n+        RootEntry::new(path, Box::new(v))\r\n+    }\r\n+}\r"}, {"sha": "113883bdde13af546a897832eaae4f4627c91b25", "filename": "crates/ra_lsp_server/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_lsp_server%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_lsp_server%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Flib.rs?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -4,6 +4,7 @@ mod conv;\n mod main_loop;\n mod markdown;\n mod project_model;\n+mod vfs_filter;\n pub mod req;\n pub mod init;\n mod server_world;"}, {"sha": "af4798494bc320b37af5a92bb6c94d120501a844", "filename": "crates/ra_lsp_server/src/server_world.rs", "status": "modified", "additions": 5, "deletions": 29, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_lsp_server%2Fsrc%2Fserver_world.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_lsp_server%2Fsrc%2Fserver_world.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fserver_world.rs?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -8,13 +8,14 @@ use ra_ide_api::{\n     Analysis, AnalysisChange, AnalysisHost, CrateGraph, FileId, LibraryData,\n     SourceRootId\n };\n-use ra_vfs::{Vfs, VfsChange, VfsFile, VfsRoot, RootEntry, Filter};\n-use relative_path::{RelativePath, RelativePathBuf};\n+use ra_vfs::{Vfs, VfsChange, VfsFile, VfsRoot};\n+use relative_path::RelativePathBuf;\n use parking_lot::RwLock;\n use failure::format_err;\n \n use crate::{\n     project_model::ProjectWorkspace,\n+    vfs_filter::IncludeRustFiles,\n     Result,\n };\n \n@@ -33,40 +34,15 @@ pub struct ServerWorld {\n     pub vfs: Arc<RwLock<Vfs>>,\n }\n \n-struct IncludeRustFiles;\n-\n-impl IncludeRustFiles {\n-    fn to_entry(path: PathBuf) -> RootEntry {\n-        RootEntry::new(path, Box::new(Self {}))\n-    }\n-}\n-\n-impl Filter for IncludeRustFiles {\n-    fn include_dir(&self, dir_path: &RelativePath) -> bool {\n-        const IGNORED_FOLDERS: &[&str] = &[\"node_modules\", \"target\", \".git\"];\n-\n-        let is_ignored = dir_path.components().any(|c| IGNORED_FOLDERS.contains(&c.as_str()));\n-\n-        let hidden = dir_path.components().any(|c| c.as_str().starts_with(\".\"));\n-\n-        !is_ignored && !hidden\n-    }\n-\n-    fn include_file(&self, file_path: &RelativePath) -> bool {\n-        file_path.extension() == Some(\"rs\")\n-    }\n-}\n-\n impl ServerWorldState {\n     pub fn new(root: PathBuf, workspaces: Vec<ProjectWorkspace>) -> ServerWorldState {\n         let mut change = AnalysisChange::new();\n \n         let mut roots = Vec::new();\n-        roots.push(root.clone());\n+        roots.push(IncludeRustFiles::member(root.clone()));\n         for ws in workspaces.iter() {\n-            roots.extend(ws.to_roots());\n+            roots.extend(IncludeRustFiles::from_roots(ws.to_roots()));\n         }\n-        let roots = roots.into_iter().map(IncludeRustFiles::to_entry).collect::<Vec<_>>();\n \n         let (mut vfs, roots) = Vfs::new(roots);\n         let roots_to_scan = roots.len();"}, {"sha": "dd20c12031ffb4a076db7db72b4376efc9b363ec", "filename": "crates/ra_lsp_server/src/vfs_filter.rs", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_lsp_server%2Fsrc%2Fvfs_filter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_lsp_server%2Fsrc%2Fvfs_filter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fvfs_filter.rs?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -0,0 +1,54 @@\n+use std::path::PathBuf;\r\n+use ra_project_model::ProjectRoot;\r\n+use ra_vfs::{RootEntry, Filter, RelativePath};\r\n+\r\n+/// `IncludeRustFiles` is used to convert\r\n+/// from `ProjectRoot` to `RootEntry` for VFS\r\n+pub struct IncludeRustFiles {\r\n+    root: ProjectRoot,\r\n+}\r\n+\r\n+impl IncludeRustFiles {\r\n+    pub fn from_roots<R>(roots: R) -> impl Iterator<Item = RootEntry>\r\n+    where\r\n+        R: IntoIterator<Item = ProjectRoot>,\r\n+    {\r\n+        roots.into_iter().map(IncludeRustFiles::from_root)\r\n+    }\r\n+\r\n+    pub fn from_root(root: ProjectRoot) -> RootEntry {\r\n+        IncludeRustFiles::from(root).into()\r\n+    }\r\n+\r\n+    #[allow(unused)]\r\n+    pub fn external(path: PathBuf) -> RootEntry {\r\n+        IncludeRustFiles::from_root(ProjectRoot::new(path, false))\r\n+    }\r\n+\r\n+    pub fn member(path: PathBuf) -> RootEntry {\r\n+        IncludeRustFiles::from_root(ProjectRoot::new(path, true))\r\n+    }\r\n+}\r\n+\r\n+impl Filter for IncludeRustFiles {\r\n+    fn include_dir(&self, dir_path: &RelativePath) -> bool {\r\n+        self.root.include_dir(dir_path)\r\n+    }\r\n+\r\n+    fn include_file(&self, file_path: &RelativePath) -> bool {\r\n+        self.root.include_file(file_path)\r\n+    }\r\n+}\r\n+\r\n+impl std::convert::From<ProjectRoot> for IncludeRustFiles {\r\n+    fn from(v: ProjectRoot) -> IncludeRustFiles {\r\n+        IncludeRustFiles { root: v }\r\n+    }\r\n+}\r\n+\r\n+impl std::convert::From<IncludeRustFiles> for RootEntry {\r\n+    fn from(v: IncludeRustFiles) -> RootEntry {\r\n+        let path = v.root.path().clone();\r\n+        RootEntry::new(path, Box::new(v))\r\n+    }\r\n+}\r"}, {"sha": "cf4adf35cd5d3b631082f6d37dd62e55efea4c96", "filename": "crates/ra_project_model/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_project_model%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_project_model%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2FCargo.toml?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -7,6 +7,7 @@ authors = [\"rust-analyzer developers\"]\n [dependencies]\n log = \"0.4.5\"\n rustc-hash = \"1.0\"\n+relative-path = \"0.4.0\"\n \n failure = \"0.1.4\"\n "}, {"sha": "6f46a2d4350298528c7cee8909b04042d537176c", "filename": "crates/ra_project_model/src/lib.rs", "status": "modified", "additions": 57, "deletions": 4, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_project_model%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b03883279528986bd829e14f967db4b4c980049d/crates%2Fra_project_model%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Flib.rs?ref=b03883279528986bd829e14f967db4b4c980049d", "patch": "@@ -15,6 +15,8 @@ use ra_db::{CrateGraph, FileId, Edition};\n \n use serde_json::from_reader;\n \n+use relative_path::RelativePath;\n+\n pub use crate::{\n     cargo_workspace::{CargoWorkspace, Package, Target, TargetKind},\n     json_project::JsonProject,\n@@ -32,6 +34,52 @@ pub enum ProjectWorkspace {\n     Json { project: JsonProject },\n }\n \n+/// `ProjectRoot` describes a workspace root folder.\n+/// Which may be an external dependency, or a member of\n+/// the current workspace.\n+pub struct ProjectRoot {\n+    /// Path to the root folder\n+    path: PathBuf,\n+    /// Is a member of the current workspace\n+    is_member: bool,\n+}\n+\n+impl ProjectRoot {\n+    pub fn new(path: PathBuf, is_member: bool) -> ProjectRoot {\n+        ProjectRoot { path, is_member }\n+    }\n+\n+    pub fn path(&self) -> &PathBuf {\n+        &self.path\n+    }\n+\n+    pub fn is_member(&self) -> bool {\n+        self.is_member\n+    }\n+\n+    pub fn include_dir(&self, dir_path: &RelativePath) -> bool {\n+        const COMMON_IGNORED_DIRS: &[&str] = &[\"node_modules\", \"target\", \".git\"];\n+        const EXTERNAL_IGNORED_DIRS: &[&str] = &[\"examples\", \"tests\", \"benches\"];\n+\n+        let is_ignored = if self.is_member {\n+            dir_path.components().any(|c| COMMON_IGNORED_DIRS.contains(&c.as_str()))\n+        } else {\n+            dir_path.components().any(|c| {\n+                let path = c.as_str();\n+                COMMON_IGNORED_DIRS.contains(&path) || EXTERNAL_IGNORED_DIRS.contains(&path)\n+            })\n+        };\n+\n+        let hidden = dir_path.components().any(|c| c.as_str().starts_with(\".\"));\n+\n+        !is_ignored && !hidden\n+    }\n+\n+    pub fn include_file(&self, file_path: &RelativePath) -> bool {\n+        file_path.extension() == Some(\"rs\")\n+    }\n+}\n+\n impl ProjectWorkspace {\n     pub fn discover(path: &Path) -> Result<ProjectWorkspace> {\n         match find_rust_project_json(path) {\n@@ -50,23 +98,28 @@ impl ProjectWorkspace {\n         }\n     }\n \n-    pub fn to_roots(&self) -> Vec<PathBuf> {\n+    /// Returns the roots for the current ProjectWorkspace\n+    /// The return type contains the path and whether or not\n+    /// the root is a member of the current workspace\n+    pub fn to_roots(&self) -> Vec<ProjectRoot> {\n         match self {\n             ProjectWorkspace::Json { project } => {\n                 let mut roots = Vec::with_capacity(project.roots.len());\n                 for root in &project.roots {\n-                    roots.push(root.path.clone());\n+                    roots.push(ProjectRoot::new(root.path.clone(), true));\n                 }\n                 roots\n             }\n             ProjectWorkspace::Cargo { cargo, sysroot } => {\n                 let mut roots =\n                     Vec::with_capacity(cargo.packages().count() + sysroot.crates().count());\n                 for pkg in cargo.packages() {\n-                    roots.push(pkg.root(&cargo).to_path_buf());\n+                    let root = pkg.root(&cargo).to_path_buf();\n+                    let member = pkg.is_member(&cargo);\n+                    roots.push(ProjectRoot::new(root, member));\n                 }\n                 for krate in sysroot.crates() {\n-                    roots.push(krate.root_dir(&sysroot).to_path_buf())\n+                    roots.push(ProjectRoot::new(krate.root_dir(&sysroot).to_path_buf(), false))\n                 }\n                 roots\n             }"}]}