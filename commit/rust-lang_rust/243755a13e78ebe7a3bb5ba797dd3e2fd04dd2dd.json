{"sha": "243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0Mzc1NWExM2U3OGViZTdhM2JiNWJhNzk3ZGQzZTJmZDA0ZGQyZGQ=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-02-06T00:26:35Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-02-06T13:18:37Z"}, "message": "Add a test for escaping LLVMisms in inline asm\n\nWe escape certain LLVM-specific features when passing the inline\nassembly string to the LLVM. Until now, however, there was no test\nmaking sure this behaviour stays intact. This commit adds such a test!", "tree": {"sha": "76c1906b03934f16cc7273b21142cda5bd50f4d5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/76c1906b03934f16cc7273b21142cda5bd50f4d5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd", "html_url": "https://github.com/rust-lang/rust/commit/243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23adf9fd843da7a3394c824b056f93151aaa40ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/23adf9fd843da7a3394c824b056f93151aaa40ad", "html_url": "https://github.com/rust-lang/rust/commit/23adf9fd843da7a3394c824b056f93151aaa40ad"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "fe09caa69730936818194fc502e1616631e34965", "filename": "src/test/codegen/asm-sanitize-llvm.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd/src%2Ftest%2Fcodegen%2Fasm-sanitize-llvm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd/src%2Ftest%2Fcodegen%2Fasm-sanitize-llvm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-sanitize-llvm.rs?ref=243755a13e78ebe7a3bb5ba797dd3e2fd04dd2dd", "patch": "@@ -0,0 +1,32 @@\n+// FIXME(nagisa): remove the flags here once all targets support `asm!`.\n+// compile-flags: --target x86_64-unknown-linux-gnu\n+\n+// Verify we sanitize the special tokens for the LLVM inline-assembly, ensuring people won't\n+// inadvertently rely on the LLVM-specific syntax and features.\n+#![no_core]\n+#![feature(no_core, lang_items, rustc_attrs)]\n+#![crate_type = \"rlib\"]\n+\n+#[rustc_builtin_macro]\n+macro_rules! asm {\n+    () => {};\n+}\n+\n+#[lang = \"sized\"]\n+trait Sized {}\n+#[lang = \"copy\"]\n+trait Copy {}\n+\n+pub unsafe fn we_escape_dollar_signs() {\n+    // CHECK: call void asm sideeffect alignstack inteldialect \"banana$$:\"\n+    asm!(\n+        r\"banana$:\",\n+    )\n+}\n+\n+pub unsafe fn we_escape_escapes_too() {\n+    // CHECK: call void asm sideeffect alignstack inteldialect \"banana\\{{(\\\\|5C)}}36:\"\n+    asm!(\n+        r\"banana\\36:\",\n+    )\n+}"}]}