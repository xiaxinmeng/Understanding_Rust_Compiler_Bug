{"sha": "bd2096c497580da263c20e8231666a995722ac29", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkMjA5NmM0OTc1ODBkYTI2M2MyMGU4MjMxNjY2YTk5NTcyMmFjMjk=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2015-03-17T11:36:42Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2015-03-17T11:36:42Z"}, "message": "Only test predicates if this is a default method, as a simple optimization.", "tree": {"sha": "2ab6e9e225e56bfb681385388a586679a572de25", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2ab6e9e225e56bfb681385388a586679a572de25"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd2096c497580da263c20e8231666a995722ac29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd2096c497580da263c20e8231666a995722ac29", "html_url": "https://github.com/rust-lang/rust/commit/bd2096c497580da263c20e8231666a995722ac29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd2096c497580da263c20e8231666a995722ac29/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "99a508bc1795a7913ad790a3bf60f68dc782f282", "url": "https://api.github.com/repos/rust-lang/rust/commits/99a508bc1795a7913ad790a3bf60f68dc782f282", "html_url": "https://github.com/rust-lang/rust/commit/99a508bc1795a7913ad790a3bf60f68dc782f282"}], "stats": {"total": 21, "additions": 14, "deletions": 7}, "files": [{"sha": "b1d705e8683c0169c255d48a2889ac13239a5936", "filename": "src/librustc_trans/trans/meth.rs", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/bd2096c497580da263c20e8231666a995722ac29/src%2Flibrustc_trans%2Ftrans%2Fmeth.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd2096c497580da263c20e8231666a995722ac29/src%2Flibrustc_trans%2Ftrans%2Fmeth.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fmeth.rs?ref=bd2096c497580da263c20e8231666a995722ac29", "patch": "@@ -842,13 +842,20 @@ fn emit_vtable_methods<'a, 'tcx>(ccx: &CrateContext<'a, 'tcx>,\n                 return nullptr;\n             }\n \n-            let predicates =\n-                monomorphize::apply_param_substs(tcx,\n-                                                 &substs,\n-                                                 &impl_method_type.predicates.predicates);\n-            if !predicates_hold(ccx, predicates.into_vec()) {\n-                debug!(\"emit_vtable_methods: predicates do not hold\");\n-                return nullptr;\n+            // If this is a default method, it's possible that it\n+            // relies on where clauses that do not hold for this\n+            // particular set of type parameters. Note that this\n+            // method could then never be called, so we do not want to\n+            // try and trans it, in that case. Issue #23435.\n+            if ty::provided_source(tcx, impl_method_def_id).is_some() {\n+                let predicates =\n+                    monomorphize::apply_param_substs(tcx,\n+                                                     &substs,\n+                                                     &impl_method_type.predicates.predicates);\n+                if !predicates_hold(ccx, predicates.into_vec()) {\n+                    debug!(\"emit_vtable_methods: predicates do not hold\");\n+                    return nullptr;\n+                }\n             }\n \n             trans_fn_ref_with_substs(ccx,"}]}