{"sha": "f31fc31dd49705701fc68f9f9cbd512218df2f83", "node_id": "C_kwDOAAsO6NoAKGYzMWZjMzFkZDQ5NzA1NzAxZmM2OGY5ZjljYmQ1MTIyMThkZjJmODM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-22T18:26:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-22T18:26:51Z"}, "message": "Auto merge of #108340 - eggyal:remove_traversal_trait_aliases, r=oli-obk\n\nRemove type-traversal trait aliases\n\n#107924 moved the type traversal (folding and visiting) traits into the type library, but created trait aliases in `rustc_middle` to minimise both the API churn for trait consumers and the arising boilerplate.  As mentioned in that PR, an alternative approach of defining subtraits with blanket implementations of the respective supertraits was also considered at that time but was ruled out as not adding much value.\n\nUnfortunately, it has since emerged that rust-analyzer has difficulty with these trait aliases at present, resulting in a degraded contributor experience (see the recent [r-a has become useless](https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/r-a.20has.20become.20useless) topic on the #t-compiler/help Zulip stream).\n\nThis PR removes the trait aliases, and accordingly the underlying type library traits are now used directly; they are parameterised by `TyCtxt<'tcx>` rather than just the `'tcx` lifetime, and imports have been updated to reflect the fact that the trait aliases' explicitly named traits are no longer automatically brought into scope.  These changes also roll-back the (no-longer required) workarounds to #107747 that were made in b409329c624b9e3bbd7d8e07697e2e9f861a45b6.\n\nSince this PR is just a find+replace together with the changes necessary for compilation & tidy to pass, it's currently just one mega-commit.  Let me know if you'd like it broken up.\n\nr? `@oli-obk`", "tree": {"sha": "d9ef401a25e43c0766f0c36bee17b5f0be911ff1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d9ef401a25e43c0766f0c36bee17b5f0be911ff1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f31fc31dd49705701fc68f9f9cbd512218df2f83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f31fc31dd49705701fc68f9f9cbd512218df2f83", "html_url": "https://github.com/rust-lang/rust/commit/f31fc31dd49705701fc68f9f9cbd512218df2f83", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f31fc31dd49705701fc68f9f9cbd512218df2f83/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93fdcfa554af34c01970db8ace1e724214913f8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/93fdcfa554af34c01970db8ace1e724214913f8f", "html_url": "https://github.com/rust-lang/rust/commit/93fdcfa554af34c01970db8ace1e724214913f8f"}, {"sha": "d9751e46c7f5462e6183c14b3b8dd3ad95f1995e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9751e46c7f5462e6183c14b3b8dd3ad95f1995e", "html_url": "https://github.com/rust-lang/rust/commit/d9751e46c7f5462e6183c14b3b8dd3ad95f1995e"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "722e2754e8381b9ec113115d8be7ec4b87803c79", "filename": "src/common.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f31fc31dd49705701fc68f9f9cbd512218df2f83/src%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f31fc31dd49705701fc68f9f9cbd512218df2f83/src%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcommon.rs?ref=f31fc31dd49705701fc68f9f9cbd512218df2f83", "patch": "@@ -374,7 +374,7 @@ impl<'tcx> HasTargetSpec for FunctionCx<'_, '_, 'tcx> {\n impl<'tcx> FunctionCx<'_, '_, 'tcx> {\n     pub(crate) fn monomorphize<T>(&self, value: T) -> T\n     where\n-        T: TypeFoldable<'tcx> + Copy,\n+        T: TypeFoldable<TyCtxt<'tcx>> + Copy,\n     {\n         self.instance.subst_mir_and_normalize_erasing_regions(\n             self.tcx,"}, {"sha": "80ce3dc932873fa46e45290a1f2e8113d2974299", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f31fc31dd49705701fc68f9f9cbd512218df2f83/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f31fc31dd49705701fc68f9f9cbd512218df2f83/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=f31fc31dd49705701fc68f9f9cbd512218df2f83", "patch": "@@ -86,7 +86,7 @@ mod prelude {\n     pub(crate) use rustc_middle::ty::layout::{self, LayoutOf, TyAndLayout};\n     pub(crate) use rustc_middle::ty::{\n         self, FloatTy, Instance, InstanceDef, IntTy, ParamEnv, Ty, TyCtxt, TypeAndMut,\n-        TypeFoldable, UintTy,\n+        TypeFoldable, TypeVisitableExt, UintTy,\n     };\n     pub(crate) use rustc_target::abi::{Abi, Scalar, Size, VariantIdx};\n "}]}