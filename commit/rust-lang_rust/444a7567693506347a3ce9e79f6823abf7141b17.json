{"sha": "444a7567693506347a3ce9e79f6823abf7141b17", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0NGE3NTY3NjkzNTA2MzQ3YTNjZTllNzlmNjgyM2FiZjcxNDFiMTc=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2021-03-05T16:46:04Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2021-03-05T16:46:04Z"}, "message": "Revise prefix a bit, adding both `--test` (conditionally) and `[RUSTC-SHIM]` unconditionally.\n\n1. I added `--test` based on review feedback from simulacrum: I decided I would\nrather include such extra context than get confused later on by its absence.\n(However, I chose to encode it differently than how `[RUSTC-TIMING]` does... I\ndon't have much basis for doing so, other than `--test` to me more directly\nreflects what it came from.)\n\n2. I also decided to include `[RUSTC-SHIM]` at start of all of these lines\ndriven by the verbosity level, to make to clear where these lines of text\noriginate from. (Basically, I skimmed over the output and realized that a casual\nobserver might not be able to tell where this huge set of new lines were coming\nfrom.)", "tree": {"sha": "56fb8d6aa280f292e258afa6262eb6fd5907d5c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/56fb8d6aa280f292e258afa6262eb6fd5907d5c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/444a7567693506347a3ce9e79f6823abf7141b17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/444a7567693506347a3ce9e79f6823abf7141b17", "html_url": "https://github.com/rust-lang/rust/commit/444a7567693506347a3ce9e79f6823abf7141b17", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/444a7567693506347a3ce9e79f6823abf7141b17/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5eb5c884f8a4bd67879c85ad76782967ab7f36a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5eb5c884f8a4bd67879c85ad76782967ab7f36a", "html_url": "https://github.com/rust-lang/rust/commit/f5eb5c884f8a4bd67879c85ad76782967ab7f36a"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "0ab5e9c63c94f710b64d4c4001d3bc3b92293d96", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/444a7567693506347a3ce9e79f6823abf7141b17/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/444a7567693506347a3ce9e79f6823abf7141b17/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=444a7567693506347a3ce9e79f6823abf7141b17", "patch": "@@ -138,12 +138,14 @@ fn main() {\n         cmd.arg(\"-Z\").arg(\"force-unstable-if-unmarked\");\n     }\n \n+    let is_test = args.iter().any(|a| a == \"--test\");\n     if verbose > 1 {\n         let rust_env_vars =\n             env::vars().filter(|(k, _)| k.starts_with(\"RUST\") || k.starts_with(\"CARGO\"));\n+        let prefix = if is_test { \"[RUSTC-SHIM] rustc --test\" } else { \"[RUSTC-SHIM] rustc\" };\n         let prefix = match crate_name {\n-            Some(crate_name) => format!(\"rustc {}\", crate_name),\n-            None => \"rustc\".to_string(),\n+            Some(crate_name) => format!(\"{} {}\", prefix, crate_name),\n+            None => prefix.to_string(),\n         };\n         for (i, (k, v)) in rust_env_vars.enumerate() {\n             eprintln!(\"{} env[{}]: {:?}={:?}\", prefix, i, k, v);\n@@ -171,7 +173,6 @@ fn main() {\n     {\n         if let Some(crate_name) = crate_name {\n             let dur = start.elapsed();\n-            let is_test = args.iter().any(|a| a == \"--test\");\n             // If the user requested resource usage data, then\n             // include that in addition to the timing output.\n             let rusage_data ="}]}