{"sha": "c3da28eade867f731d8169a8c143e33353006e29", "node_id": "C_kwDOAAsO6NoAKGMzZGEyOGVhZGU4NjdmNzMxZDgxNjlhOGMxNDNlMzMzNTMwMDZlMjk", "commit": {"author": {"name": "S\u00e9bastien Marie", "email": "semarie@online.fr", "date": "2021-12-17T11:27:14Z"}, "committer": {"name": "S\u00e9bastien Marie", "email": "semarie@online.fr", "date": "2021-12-17T11:27:14Z"}, "message": "pass -Wl,-z,origin to set DF_ORIGIN when using rpath\n\nDF_ORIGIN flag signifies that the object being loaded may make reference to the $ORIGIN substitution string.\n\nSome implementations are just ignoring DF_ORIGIN and do substitution for $ORIGIN if present (whatever DF_ORIGIN pr\n\nSet the flag inconditionally if rpath is wanted.", "tree": {"sha": "852f25ad56cd8993b4935692ac89718b4ccb6214", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/852f25ad56cd8993b4935692ac89718b4ccb6214"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3da28eade867f731d8169a8c143e33353006e29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3da28eade867f731d8169a8c143e33353006e29", "html_url": "https://github.com/rust-lang/rust/commit/c3da28eade867f731d8169a8c143e33353006e29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3da28eade867f731d8169a8c143e33353006e29/comments", "author": {"login": "semarie", "id": 8948701, "node_id": "MDQ6VXNlcjg5NDg3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/8948701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/semarie", "html_url": "https://github.com/semarie", "followers_url": "https://api.github.com/users/semarie/followers", "following_url": "https://api.github.com/users/semarie/following{/other_user}", "gists_url": "https://api.github.com/users/semarie/gists{/gist_id}", "starred_url": "https://api.github.com/users/semarie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/semarie/subscriptions", "organizations_url": "https://api.github.com/users/semarie/orgs", "repos_url": "https://api.github.com/users/semarie/repos", "events_url": "https://api.github.com/users/semarie/events{/privacy}", "received_events_url": "https://api.github.com/users/semarie/received_events", "type": "User", "site_admin": false}, "committer": {"login": "semarie", "id": 8948701, "node_id": "MDQ6VXNlcjg5NDg3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/8948701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/semarie", "html_url": "https://github.com/semarie", "followers_url": "https://api.github.com/users/semarie/followers", "following_url": "https://api.github.com/users/semarie/following{/other_user}", "gists_url": "https://api.github.com/users/semarie/gists{/gist_id}", "starred_url": "https://api.github.com/users/semarie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/semarie/subscriptions", "organizations_url": "https://api.github.com/users/semarie/orgs", "repos_url": "https://api.github.com/users/semarie/repos", "events_url": "https://api.github.com/users/semarie/events{/privacy}", "received_events_url": "https://api.github.com/users/semarie/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "16d8a91d511b0e90391bcb20b8c67036071d9392", "url": "https://api.github.com/repos/rust-lang/rust/commits/16d8a91d511b0e90391bcb20b8c67036071d9392", "html_url": "https://github.com/rust-lang/rust/commit/16d8a91d511b0e90391bcb20b8c67036071d9392"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "0b5656c9ad12786771b15b09fee80cb54e31a6a7", "filename": "compiler/rustc_codegen_ssa/src/back/rpath.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c3da28eade867f731d8169a8c143e33353006e29/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3da28eade867f731d8169a8c143e33353006e29/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Frpath.rs?ref=c3da28eade867f731d8169a8c143e33353006e29", "patch": "@@ -23,9 +23,12 @@ pub fn get_rpath_flags(config: &mut RPathConfig<'_>) -> Vec<String> {\n     let rpaths = get_rpaths(config);\n     let mut flags = rpaths_to_flags(&rpaths);\n \n-    // Use DT_RUNPATH instead of DT_RPATH if available\n     if config.linker_is_gnu {\n+        // Use DT_RUNPATH instead of DT_RPATH if available\n         flags.push(\"-Wl,--enable-new-dtags\".to_owned());\n+\n+        // Set DF_ORIGIN for substitute $ORIGIN\n+        flags.push(\"-Wl,-z,origin\".to_owned());\n     }\n \n     flags"}, {"sha": "bbd2c087ccabbc8858f47eaae444a61d99fe1e1b", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c3da28eade867f731d8169a8c143e33353006e29/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3da28eade867f731d8169a8c143e33353006e29/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=c3da28eade867f731d8169a8c143e33353006e29", "patch": "@@ -1176,6 +1176,7 @@ impl<'a> Builder<'a> {\n                 rustflags.arg(\"-Zosx-rpath-install-name\");\n                 Some(\"-Wl,-rpath,@loader_path/../lib\")\n             } else if !target.contains(\"windows\") {\n+                rustflags.arg(\"-Clink-args=-Wl,-z,origin\");\n                 Some(\"-Wl,-rpath,$ORIGIN/../lib\")\n             } else {\n                 None"}]}