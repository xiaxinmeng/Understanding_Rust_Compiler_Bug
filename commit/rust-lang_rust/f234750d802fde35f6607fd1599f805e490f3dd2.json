{"sha": "f234750d802fde35f6607fd1599f805e490f3dd2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyMzQ3NTBkODAyZmRlMzVmNjYwN2ZkMTU5OWY4MDVlNDkwZjNkZDI=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-10-14T19:41:48Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-10-14T19:41:48Z"}, "message": "Fix crasher in rustc.", "tree": {"sha": "8cc749712920857e9a348e72b8a7855085b893c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8cc749712920857e9a348e72b8a7855085b893c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f234750d802fde35f6607fd1599f805e490f3dd2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f234750d802fde35f6607fd1599f805e490f3dd2", "html_url": "https://github.com/rust-lang/rust/commit/f234750d802fde35f6607fd1599f805e490f3dd2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f234750d802fde35f6607fd1599f805e490f3dd2/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "668f3a90a85edc8d4e1472af0eb530fa7c4bb2ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/668f3a90a85edc8d4e1472af0eb530fa7c4bb2ed", "html_url": "https://github.com/rust-lang/rust/commit/668f3a90a85edc8d4e1472af0eb530fa7c4bb2ed"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "1b99494018b71e31bad89b0c26e71388311749a5", "filename": "src/Makefile", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f234750d802fde35f6607fd1599f805e490f3dd2/src%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/f234750d802fde35f6607fd1599f805e490f3dd2/src%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FMakefile?ref=f234750d802fde35f6607fd1599f805e490f3dd2", "patch": "@@ -465,6 +465,7 @@ TEST_XFAILS_LLVM := $(TASK_XFAILS) \\\n                       destructor-ordering.rs \\\n                       drop-bind-thunk-args.rs \\\n                       drop-on-empty-block-exit.rs \\\n+                      drop-parametric-closure-with-bound-box.rs \\\n                       export-non-interference.rs \\\n                       exterior.rs \\\n                       fn-lval.rs \\"}, {"sha": "13df33cdb07f6fe013436740587ca8ca7e31ab4d", "filename": "src/boot/be/abi.ml", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f234750d802fde35f6607fd1599f805e490f3dd2/src%2Fboot%2Fbe%2Fabi.ml", "raw_url": "https://github.com/rust-lang/rust/raw/f234750d802fde35f6607fd1599f805e490f3dd2/src%2Fboot%2Fbe%2Fabi.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fbe%2Fabi.ml?ref=f234750d802fde35f6607fd1599f805e490f3dd2", "patch": "@@ -62,10 +62,12 @@ let obj_body_elt_fields = 1;;\n let fn_field_code = binding_field_dispatch;;\n let fn_field_box = binding_field_bound_data;;\n \n+(* NB: bound ty params come last to facilitate ignoring them on\n+ * closure-dropping. *)\n let closure_body_elt_bound_args_tydesc = 0;;\n let closure_body_elt_target = 1;;\n-let closure_body_elt_bound_ty_params = 2;;\n-let closure_body_elt_bound_args = 3;;\n+let closure_body_elt_bound_args = 2;;\n+let closure_body_elt_bound_ty_params = 3;;\n \n let tag_elt_discriminant = 0;;\n let tag_elt_variant = 1;;"}, {"sha": "1e568df05c24ae069b69dc2650719e941b31e53b", "filename": "src/boot/me/semant.ml", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f234750d802fde35f6607fd1599f805e490f3dd2/src%2Fboot%2Fme%2Fsemant.ml", "raw_url": "https://github.com/rust-lang/rust/raw/f234750d802fde35f6607fd1599f805e490f3dd2/src%2Fboot%2Fme%2Fsemant.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fme%2Fsemant.ml?ref=f234750d802fde35f6607fd1599f805e490f3dd2", "patch": "@@ -2219,9 +2219,10 @@ let rec closure_box_rty\n       r (Array.init n_ty_params (fun _ -> tydesc))\n   in\n   let bound_args = r (Array.map (slot_referent_type cx) bs) in\n-    (* First tydesc is the one describing bound_args; second tydesc is the one\n-     * to pass to targ when invoking it.  *)\n-    r [| rc; r [| tydesc; targ; ty_param_rtys; bound_args |] |]\n+    (* First tydesc is the one describing bound_args; second tydesc cluster\n+     * are those to pass to targ when invoking it, along with the merged\n+     * bound args. *)\n+    r [| rc; r [| tydesc; targ; bound_args; ty_param_rtys |] |]\n \n and fn_rty (cx:ctxt) (opaque_box_body:bool) : Il.referent_ty =\n   let s t = Il.ScalarTy t in"}, {"sha": "cf1ff7502b327899799d9a85dd2b5d22b88e9d41", "filename": "src/test/run-pass/drop-parametric-closure-with-bound-box.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f234750d802fde35f6607fd1599f805e490f3dd2/src%2Ftest%2Frun-pass%2Fdrop-parametric-closure-with-bound-box.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f234750d802fde35f6607fd1599f805e490f3dd2/src%2Ftest%2Frun-pass%2Fdrop-parametric-closure-with-bound-box.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fdrop-parametric-closure-with-bound-box.rs?ref=f234750d802fde35f6607fd1599f805e490f3dd2", "patch": "@@ -0,0 +1,5 @@\n+fn f[T](@int i, T t) {}\n+\n+fn main() {\n+  auto x = bind f[char](@0xdeafbeef, _);\n+}\n\\ No newline at end of file"}]}