{"sha": "7ab8dda160f246fcf8ca7eac28587f0ecacb42b6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhYjhkZGExNjBmMjQ2ZmNmOGNhN2VhYzI4NTg3ZjBlY2FjYjQyYjY=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2019-04-24T18:50:23Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2019-04-24T18:50:23Z"}, "message": "Fix gnu archives", "tree": {"sha": "147da32eaa781c9ddcdc2c03cd3d1ae9ff1bd06e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/147da32eaa781c9ddcdc2c03cd3d1ae9ff1bd06e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6", "html_url": "https://github.com/rust-lang/rust/commit/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e8db15f662af7fe646a75fbbb3c507037dc55753", "url": "https://api.github.com/repos/rust-lang/rust/commits/e8db15f662af7fe646a75fbbb3c507037dc55753", "html_url": "https://github.com/rust-lang/rust/commit/e8db15f662af7fe646a75fbbb3c507037dc55753"}], "stats": {"total": 27, "additions": 6, "deletions": 21}, "files": [{"sha": "80bc1c90a47204c3c0e6e3c640114159d5686940", "filename": "Cargo.lock", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=7ab8dda160f246fcf8ca7eac28587f0ecacb42b6", "patch": "@@ -19,7 +19,7 @@ dependencies = [\n [[package]]\n name = \"ar\"\n version = \"0.6.2\"\n-source = \"git+https://github.com/mdsteele/rust-ar.git#1cfa68dcecaa063510758e8bdced7115a3393616\"\n+source = \"git+https://github.com/bjorn3/rust-ar.git?branch=non_multiple_of_two_identifiers_gnu_format#efa2308b9ded41f4977d4fed98dac7af4d9075cf\"\n dependencies = [\n  \"byteorder 1.3.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -582,7 +582,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n name = \"rustc_codegen_cranelift\"\n version = \"0.1.0\"\n dependencies = [\n- \"ar 0.6.2 (git+https://github.com/mdsteele/rust-ar.git)\",\n+ \"ar 0.6.2 (git+https://github.com/bjorn3/rust-ar.git?branch=non_multiple_of_two_identifiers_gnu_format)\",\n  \"bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"byteorder 1.3.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cranelift 0.30.0 (git+https://github.com/CraneStation/cranelift.git)\",\n@@ -843,7 +843,7 @@ dependencies = [\n [metadata]\n \"checksum aho-corasick 0.7.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e6f484ae0c99fec2e858eb6134949117399f222608d84cadb3f58c1f97c2364c\"\n \"checksum ansi_term 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ee49baf6cb617b853aa8d93bf420db2383fab46d314482ca2803b40d5fde979b\"\n-\"checksum ar 0.6.2 (git+https://github.com/mdsteele/rust-ar.git)\" = \"<none>\"\n+\"checksum ar 0.6.2 (git+https://github.com/bjorn3/rust-ar.git?branch=non_multiple_of_two_identifiers_gnu_format)\" = \"<none>\"\n \"checksum arrayvec 0.4.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"92c7fb76bc8826a8b33b4ee5bb07a247a81e76764ab4d55e8f73e3a4d8808c71\"\n \"checksum atty 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9a7d5b8723950951411ee34d271d99dddcc2035a16ab25310ea2c8cfd4369652\"\n \"checksum autocfg 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a6d640bee2da49f60a4068a7fae53acde8982514ab7bae8b8cea9e88cbcfd799\""}, {"sha": "c5565699cdedb2f76c9400698ea4a25bceb1f92d", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=7ab8dda160f246fcf8ca7eac28587f0ecacb42b6", "patch": "@@ -39,7 +39,7 @@ indexmap = \"1.0.2\"\n #gimli = { path = \"../\" }\n \n [patch.crates-io]\n-ar = { git = \"https://github.com/mdsteele/rust-ar.git\" }\n+ar = { git = \"https://github.com/bjorn3/rust-ar.git\", branch = \"non_multiple_of_two_identifiers_gnu_format\" }\n \n [profile.dev.overrides.\"*\"]\n opt-level = 3"}, {"sha": "2adb80da8794cc554ebfdb9965e8855992bf3a37", "filename": "src/archive.rs", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6/src%2Farchive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ab8dda160f246fcf8ca7eac28587f0ecacb42b6/src%2Farchive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Farchive.rs?ref=7ab8dda160f246fcf8ca7eac28587f0ecacb42b6", "patch": "@@ -36,7 +36,7 @@ impl<'a> ArchiveBuilder<'a> for ArArchiveBuilder<'a> {\n             dst: output.to_path_buf(),\n             src: input.map(|p| p.to_path_buf()),\n             lib_search_paths: archive_search_paths(sess),\n-            is_like_osx: true, //sess.target.target.options.is_like_osx,\n+            is_like_osx: sess.target.target.options.is_like_osx,\n         };\n \n         let (src_archives, entries) = if let Some(src) = &config.src {\n@@ -147,23 +147,8 @@ impl<'a> ArchiveBuilder<'a> for ArArchiveBuilder<'a> {\n                     let entry = self.src_archives[archive_index].jump_to_entry(entry_index).unwrap();\n                     let orig_header = entry.header();\n \n-                    let orig_filename = orig_header.identifier().to_vec();\n-\n-                    use std::collections::hash_map::DefaultHasher;\n-                    use std::hash::{Hash, Hasher};\n-                    let mut hasher = DefaultHasher::new();\n-                    orig_filename.hash(&mut hasher);\n-                    let mut filename = hasher.finish().to_le_bytes()[0..6].to_vec();\n-                    filename.extend(&orig_filename[orig_filename.len() - 9..]);\n-\n-                    assert!(\n-                        filename.len() <= 16,\n-                        \"Filenames bigger than 16 bytes are not yet supported. Filename was: \\\"{}\\\"\",\n-                        String::from_utf8(filename).unwrap_or_else(|e| e.to_string()),\n-                    );\n-\n                     let mut header =\n-                        ar::Header::new(filename, orig_header.size());\n+                        ar::Header::new(orig_header.identifier().to_vec(), orig_header.size());\n                     header.set_mtime(orig_header.mtime());\n                     header.set_uid(orig_header.uid());\n                     header.set_gid(orig_header.gid());"}]}