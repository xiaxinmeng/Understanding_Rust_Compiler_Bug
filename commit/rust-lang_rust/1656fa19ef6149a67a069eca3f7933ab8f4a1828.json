{"sha": "1656fa19ef6149a67a069eca3f7933ab8f4a1828", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2NTZmYTE5ZWY2MTQ5YTY3YTA2OWVjYTNmNzkzM2FiOGY0YTE4Mjg=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-06-27T18:17:05Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-06-27T18:32:06Z"}, "message": "Implement move for scalar values\n\nBefore, something like:\n\nlet int y = 42;\nlet int x;\nx <- y;\n\nwould cause an LLVM assertion failure. Fixed it.", "tree": {"sha": "dcc99a07e5d5d6ff69c365d403c0668e03666b9d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dcc99a07e5d5d6ff69c365d403c0668e03666b9d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1656fa19ef6149a67a069eca3f7933ab8f4a1828", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1656fa19ef6149a67a069eca3f7933ab8f4a1828", "html_url": "https://github.com/rust-lang/rust/commit/1656fa19ef6149a67a069eca3f7933ab8f4a1828", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1656fa19ef6149a67a069eca3f7933ab8f4a1828/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc9fa31618207ae71d3db9cc6eef505645cdc893", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc9fa31618207ae71d3db9cc6eef505645cdc893", "html_url": "https://github.com/rust-lang/rust/commit/bc9fa31618207ae71d3db9cc6eef505645cdc893"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "f3c37ea01e746f58469019b01abe8c68f15799c1", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1656fa19ef6149a67a069eca3f7933ab8f4a1828/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1656fa19ef6149a67a069eca3f7933ab8f4a1828/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=1656fa19ef6149a67a069eca3f7933ab8f4a1828", "patch": "@@ -3107,7 +3107,8 @@ fn move_val(@block_ctxt cx, copy_action action, ValueRef dst, ValueRef src,\n             &ty::t t) -> result {\n     if (ty::type_is_scalar(cx.fcx.lcx.ccx.tcx, t) ||\n             ty::type_is_native(cx.fcx.lcx.ccx.tcx, t)) {\n-        ret rslt(cx, cx.build.Store(src, dst));\n+        auto r = rslt(cx, cx.build.Store(cx.build.Load(src), dst));\n+        ret zero_alloca(r.bcx, src, t);\n     } else if (ty::type_is_nil(cx.fcx.lcx.ccx.tcx, t) ||\n                    ty::type_is_bot(cx.fcx.lcx.ccx.tcx, t)) {\n         ret rslt(cx, C_nil());\n@@ -5798,6 +5799,7 @@ fn trans_expr_out(&@block_ctxt cx, &@ast::expr e, out_method output) ->\n             auto move_res =\n                 move_val(rhs_res.res.bcx, DROP_EXISTING, lhs_res.res.val,\n                          rhs_res.res.val, t);\n+            log_err \"returning move_res\";\n             ret rslt(move_res.bcx, C_nil());\n         }\n         case (ast::expr_assign(?dst, ?src)) {"}, {"sha": "bc96c7a42507a719d45bbdbdd7ad73dc634e3b65", "filename": "src/test/run-pass/move-scalar.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1656fa19ef6149a67a069eca3f7933ab8f4a1828/src%2Ftest%2Frun-pass%2Fmove-scalar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1656fa19ef6149a67a069eca3f7933ab8f4a1828/src%2Ftest%2Frun-pass%2Fmove-scalar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmove-scalar.rs?ref=1656fa19ef6149a67a069eca3f7933ab8f4a1828", "patch": "@@ -0,0 +1,7 @@\n+fn main() {\n+\n+  let int y = 42;\n+  let int x;\n+  x <- y;\n+  assert (x == 42);\n+}\n\\ No newline at end of file"}]}