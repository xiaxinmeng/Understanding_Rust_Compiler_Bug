{"sha": "89edd96be86fd65d63f63a208062c8baf86e7d7c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5ZWRkOTZiZTg2ZmQ2NWQ2M2Y2M2EyMDgwNjJjOGJhZjg2ZTdkN2M=", "commit": {"author": {"name": "James Miller", "email": "james@aatch.net", "date": "2016-04-16T07:45:28Z"}, "committer": {"name": "James Miller", "email": "james@aatch.net", "date": "2016-04-28T01:18:51Z"}, "message": "Fix translation of `Assign`/`AssignOp` as rvalues\n\nIn code like `let x = y = z;`, `y = z` goes through `as_rvalue`, which\ndidn't handle it. Now it translates the assignment and produces `()`\ndirectly.", "tree": {"sha": "a61f2553ec431a3d3b594d98ae95c9828b32eee5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a61f2553ec431a3d3b594d98ae95c9828b32eee5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/89edd96be86fd65d63f63a208062c8baf86e7d7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/89edd96be86fd65d63f63a208062c8baf86e7d7c", "html_url": "https://github.com/rust-lang/rust/commit/89edd96be86fd65d63f63a208062c8baf86e7d7c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/89edd96be86fd65d63f63a208062c8baf86e7d7c/comments", "author": {"login": "Aatch", "id": 342416, "node_id": "MDQ6VXNlcjM0MjQxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aatch", "html_url": "https://github.com/Aatch", "followers_url": "https://api.github.com/users/Aatch/followers", "following_url": "https://api.github.com/users/Aatch/following{/other_user}", "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions", "organizations_url": "https://api.github.com/users/Aatch/orgs", "repos_url": "https://api.github.com/users/Aatch/repos", "events_url": "https://api.github.com/users/Aatch/events{/privacy}", "received_events_url": "https://api.github.com/users/Aatch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aatch", "id": 342416, "node_id": "MDQ6VXNlcjM0MjQxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aatch", "html_url": "https://github.com/Aatch", "followers_url": "https://api.github.com/users/Aatch/followers", "following_url": "https://api.github.com/users/Aatch/following{/other_user}", "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions", "organizations_url": "https://api.github.com/users/Aatch/orgs", "repos_url": "https://api.github.com/users/Aatch/repos", "events_url": "https://api.github.com/users/Aatch/events{/privacy}", "received_events_url": "https://api.github.com/users/Aatch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "869172305f66ba11565c90f9276328c479d5b082", "url": "https://api.github.com/repos/rust-lang/rust/commits/869172305f66ba11565c90f9276328c479d5b082", "html_url": "https://github.com/rust-lang/rust/commit/869172305f66ba11565c90f9276328c479d5b082"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "8992381135ea873d0a379e1218ba180813467104", "filename": "src/librustc_mir/build/expr/as_rvalue.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/89edd96be86fd65d63f63a208062c8baf86e7d7c/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89edd96be86fd65d63f63a208062c8baf86e7d7c/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs?ref=89edd96be86fd65d63f63a208062c8baf86e7d7c", "patch": "@@ -189,6 +189,11 @@ impl<'a,'tcx> Builder<'a,'tcx> {\n                 block.and(Rvalue::Aggregate(AggregateKind::Adt(adt_def, variant_index, substs),\n                                             fields))\n             }\n+            ExprKind::Assign { .. } |\n+            ExprKind::AssignOp { .. } => {\n+                block = unpack!(this.stmt_expr(block, expr));\n+                block.and(this.unit_rvalue())\n+            }\n             ExprKind::Literal { .. } |\n             ExprKind::Block { .. } |\n             ExprKind::Match { .. } |\n@@ -201,8 +206,6 @@ impl<'a,'tcx> Builder<'a,'tcx> {\n             ExprKind::Index { .. } |\n             ExprKind::VarRef { .. } |\n             ExprKind::SelfRef |\n-            ExprKind::Assign { .. } |\n-            ExprKind::AssignOp { .. } |\n             ExprKind::Break { .. } |\n             ExprKind::Continue { .. } |\n             ExprKind::Return { .. } |"}, {"sha": "5daaf37d878144a58c574496a2c53b0eacdd8eb9", "filename": "src/librustc_mir/build/misc.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/89edd96be86fd65d63f63a208062c8baf86e7d7c/src%2Flibrustc_mir%2Fbuild%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89edd96be86fd65d63f63a208062c8baf86e7d7c/src%2Flibrustc_mir%2Fbuild%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fmisc.rs?ref=89edd96be86fd65d63f63a208062c8baf86e7d7c", "patch": "@@ -46,6 +46,10 @@ impl<'a,'tcx> Builder<'a,'tcx> {\n         Operand::Constant(constant)\n     }\n \n+    pub fn unit_rvalue(&mut self) -> Rvalue<'tcx> {\n+        Rvalue::Aggregate(AggregateKind::Tuple, vec![])\n+    }\n+\n     pub fn push_usize(&mut self,\n                       block: BasicBlock,\n                       scope_id: ScopeId,"}]}