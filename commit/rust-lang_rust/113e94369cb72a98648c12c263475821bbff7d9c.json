{"sha": "113e94369cb72a98648c12c263475821bbff7d9c", "node_id": "C_kwDOAAsO6NoAKDExM2U5NDM2OWNiNzJhOTg2NDhjMTJjMjYzNDc1ODIxYmJmZjdkOWM", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-10-03T13:26:29Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-10-10T13:20:16Z"}, "message": "query_system: finish migration\n\nUsing eager translation, migrate the remaining repeated cycle stack\ndiagnostic.\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "390ed56994dd90cdd349f867eeea4270967c06bb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/390ed56994dd90cdd349f867eeea4270967c06bb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/113e94369cb72a98648c12c263475821bbff7d9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/113e94369cb72a98648c12c263475821bbff7d9c", "html_url": "https://github.com/rust-lang/rust/commit/113e94369cb72a98648c12c263475821bbff7d9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/113e94369cb72a98648c12c263475821bbff7d9c/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "291a4736d9300a9be79a5f105c54a06a2a4f1d1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/291a4736d9300a9be79a5f105c54a06a2a4f1d1b", "html_url": "https://github.com/rust-lang/rust/commit/291a4736d9300a9be79a5f105c54a06a2a4f1d1b"}], "stats": {"total": 19, "additions": 7, "deletions": 12}, "files": [{"sha": "870e824039cb6a86abe94b83344c74dd327dbc1c", "filename": "compiler/rustc_error_messages/locales/en-US/query_system.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/113e94369cb72a98648c12c263475821bbff7d9c/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fquery_system.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/113e94369cb72a98648c12c263475821bbff7d9c/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fquery_system.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fquery_system.ftl?ref=113e94369cb72a98648c12c263475821bbff7d9c", "patch": "@@ -12,6 +12,8 @@ query_system_cycle_usage = cycle used when {$usage}\n \n query_system_cycle_stack_single = ...which immediately requires {$stack_bottom} again\n \n+query_system_cycle_stack_middle = ...which requires {$desc}...\n+\n query_system_cycle_stack_multiple = ...which again requires {$stack_bottom}, completing the cycle\n \n query_system_cycle_recursive_ty_alias = type aliases cannot be recursive"}, {"sha": "1e74e0e299099728c5997c1621cd51b085679fb3", "filename": "compiler/rustc_query_system/src/error.rs", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/113e94369cb72a98648c12c263475821bbff7d9c/compiler%2Frustc_query_system%2Fsrc%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/113e94369cb72a98648c12c263475821bbff7d9c/compiler%2Frustc_query_system%2Fsrc%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Ferror.rs?ref=113e94369cb72a98648c12c263475821bbff7d9c", "patch": "@@ -1,22 +1,15 @@\n-use rustc_errors::{AddToDiagnostic, Diagnostic, SubdiagnosticMessage};\n use rustc_macros::{Diagnostic, Subdiagnostic};\n use rustc_session::Limit;\n use rustc_span::{Span, Symbol};\n \n+#[derive(Subdiagnostic)]\n+#[note(query_system::cycle_stack_middle)]\n pub struct CycleStack {\n+    #[primary_span]\n     pub span: Span,\n     pub desc: String,\n }\n \n-impl AddToDiagnostic for CycleStack {\n-    fn add_to_diagnostic_with<F>(self, diag: &mut Diagnostic, _: F)\n-    where\n-        F: Fn(&mut Diagnostic, SubdiagnosticMessage) -> SubdiagnosticMessage,\n-    {\n-        diag.span_note(self.span, &format!(\"...which requires {}...\", self.desc));\n-    }\n-}\n-\n #[derive(Copy, Clone)]\n pub enum HandleCycleError {\n     Error,\n@@ -56,7 +49,7 @@ pub struct Cycle {\n     #[primary_span]\n     pub span: Span,\n     pub stack_bottom: String,\n-    #[subdiagnostic]\n+    #[subdiagnostic(eager)]\n     pub cycle_stack: Vec<CycleStack>,\n     #[subdiagnostic]\n     pub stack_count: StackCount,"}, {"sha": "f47760e9ae6c8aa5818c875f8396ce4a6ff43b1d", "filename": "compiler/rustc_query_system/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/113e94369cb72a98648c12c263475821bbff7d9c/compiler%2Frustc_query_system%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/113e94369cb72a98648c12c263475821bbff7d9c/compiler%2Frustc_query_system%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Flib.rs?ref=113e94369cb72a98648c12c263475821bbff7d9c", "patch": "@@ -4,7 +4,7 @@\n #![feature(min_specialization)]\n #![feature(extern_types)]\n #![allow(rustc::potential_query_instability)]\n-// #![deny(rustc::untranslatable_diagnostic)]\n+#![deny(rustc::untranslatable_diagnostic)]\n #![deny(rustc::diagnostic_outside_of_impl)]\n \n #[macro_use]"}]}