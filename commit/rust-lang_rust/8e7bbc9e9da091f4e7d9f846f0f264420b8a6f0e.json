{"sha": "8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlN2JiYzllOWRhMDkxZjRlN2Q5Zjg0NmYwZjI2NDQyMGI4YTZmMGU=", "commit": {"author": {"name": "asquared31415", "email": "34665709+asquared31415@users.noreply.github.com", "date": "2021-07-21T22:01:05Z"}, "committer": {"name": "asquared31415", "email": "34665709+asquared31415@users.noreply.github.com", "date": "2021-08-04T17:38:17Z"}, "message": "Handle leading colons properly", "tree": {"sha": "3a3341721a45a6148ad8be850d015b7dd3566aba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3a3341721a45a6148ad8be850d015b7dd3566aba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e", "html_url": "https://github.com/rust-lang/rust/commit/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e/comments", "author": {"login": "asquared31415", "id": 34665709, "node_id": "MDQ6VXNlcjM0NjY1NzA5", "avatar_url": "https://avatars.githubusercontent.com/u/34665709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asquared31415", "html_url": "https://github.com/asquared31415", "followers_url": "https://api.github.com/users/asquared31415/followers", "following_url": "https://api.github.com/users/asquared31415/following{/other_user}", "gists_url": "https://api.github.com/users/asquared31415/gists{/gist_id}", "starred_url": "https://api.github.com/users/asquared31415/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asquared31415/subscriptions", "organizations_url": "https://api.github.com/users/asquared31415/orgs", "repos_url": "https://api.github.com/users/asquared31415/repos", "events_url": "https://api.github.com/users/asquared31415/events{/privacy}", "received_events_url": "https://api.github.com/users/asquared31415/received_events", "type": "User", "site_admin": false}, "committer": {"login": "asquared31415", "id": 34665709, "node_id": "MDQ6VXNlcjM0NjY1NzA5", "avatar_url": "https://avatars.githubusercontent.com/u/34665709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asquared31415", "html_url": "https://github.com/asquared31415", "followers_url": "https://api.github.com/users/asquared31415/followers", "following_url": "https://api.github.com/users/asquared31415/following{/other_user}", "gists_url": "https://api.github.com/users/asquared31415/gists{/gist_id}", "starred_url": "https://api.github.com/users/asquared31415/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asquared31415/subscriptions", "organizations_url": "https://api.github.com/users/asquared31415/orgs", "repos_url": "https://api.github.com/users/asquared31415/repos", "events_url": "https://api.github.com/users/asquared31415/events{/privacy}", "received_events_url": "https://api.github.com/users/asquared31415/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6f45f62ded05f659eb436edd25c3151684b6e0f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/6f45f62ded05f659eb436edd25c3151684b6e0f0", "html_url": "https://github.com/rust-lang/rust/commit/6f45f62ded05f659eb436edd25c3151684b6e0f0"}], "stats": {"total": 79, "additions": 46, "deletions": 33}, "files": [{"sha": "35dcd08951baab17702692575edefc355e9b0980", "filename": "compiler/rustc_builtin_macros/src/asm.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs?ref=8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e", "patch": "@@ -511,6 +511,9 @@ fn expand_preparsed_asm(\n                             // If we encounter a non-label, there cannot be any further labels, so stop checking\n                             break;\n                         }\n+                    } else {\n+                        // Empty string means a leading ':' in this section, which is not a label\n+                        break;\n                     }\n \n                     start_idx = idx + 1;"}, {"sha": "db7d9a17b051a36ec4abf6183398763597757daa", "filename": "src/test/ui/asm/named_asm_labels.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e/src%2Ftest%2Fui%2Fasm%2Fnamed_asm_labels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e/src%2Ftest%2Fui%2Fasm%2Fnamed_asm_labels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnamed_asm_labels.rs?ref=8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e", "patch": "@@ -1,5 +1,10 @@\n+// only-x86_64\n+\n #![feature(asm, global_asm)]\n \n+#[no_mangle]\n+pub static FOO: usize = 42;\n+\n fn main() {\n     unsafe {\n         // Basic usage\n@@ -104,6 +109,11 @@ fn main() {\n             \"\n         );\n         //~^^^^ ERROR do not use named labels\n+\n+        // Tests usage of colons in non-label positions\n+        asm!(\":lo12:FOO\"); // this is apparently valid aarch64\n+        // is there an example that is valid x86 for this test?\n+        asm!(\":bbb nop\");\n     }\n }\n "}, {"sha": "42641db603cf046ea9f9ff3586ee309e93db17da", "filename": "src/test/ui/asm/named_asm_labels.stderr", "status": "modified", "additions": 33, "deletions": 33, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e/src%2Ftest%2Fui%2Fasm%2Fnamed_asm_labels.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e/src%2Ftest%2Fui%2Fasm%2Fnamed_asm_labels.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fnamed_asm_labels.stderr?ref=8e7bbc9e9da091f4e7d9f846f0f264420b8a6f0e", "patch": "@@ -1,5 +1,5 @@\n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:6:15\n+  --> $DIR/named_asm_labels.rs:11:15\n    |\n LL |         asm!(\"bar: nop\");\n    |               ^^^\n@@ -9,7 +9,7 @@ LL |         asm!(\"bar: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:9:15\n+  --> $DIR/named_asm_labels.rs:14:15\n    |\n LL |         asm!(\"abcd:\");\n    |               ^^^^\n@@ -18,7 +18,7 @@ LL |         asm!(\"abcd:\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:12:15\n+  --> $DIR/named_asm_labels.rs:17:15\n    |\n LL |         asm!(\"foo: bar1: nop\");\n    |               ^^^\n@@ -27,7 +27,7 @@ LL |         asm!(\"foo: bar1: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:12:20\n+  --> $DIR/named_asm_labels.rs:17:20\n    |\n LL |         asm!(\"foo: bar1: nop\");\n    |                    ^^^^\n@@ -36,7 +36,7 @@ LL |         asm!(\"foo: bar1: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:17:15\n+  --> $DIR/named_asm_labels.rs:22:15\n    |\n LL |         asm!(\"foo1: nop\", \"nop\");\n    |               ^^^^\n@@ -45,7 +45,7 @@ LL |         asm!(\"foo1: nop\", \"nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:18:15\n+  --> $DIR/named_asm_labels.rs:23:15\n    |\n LL |         asm!(\"foo2: foo3: nop\", \"nop\");\n    |               ^^^^\n@@ -54,7 +54,7 @@ LL |         asm!(\"foo2: foo3: nop\", \"nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:18:21\n+  --> $DIR/named_asm_labels.rs:23:21\n    |\n LL |         asm!(\"foo2: foo3: nop\", \"nop\");\n    |                     ^^^^\n@@ -63,7 +63,7 @@ LL |         asm!(\"foo2: foo3: nop\", \"nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:21:22\n+  --> $DIR/named_asm_labels.rs:26:22\n    |\n LL |         asm!(\"nop\", \"foo4: nop\");\n    |                      ^^^^\n@@ -72,7 +72,7 @@ LL |         asm!(\"nop\", \"foo4: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:22:15\n+  --> $DIR/named_asm_labels.rs:27:15\n    |\n LL |         asm!(\"foo5: nop\", \"foo6: nop\");\n    |               ^^^^\n@@ -81,7 +81,7 @@ LL |         asm!(\"foo5: nop\", \"foo6: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:22:28\n+  --> $DIR/named_asm_labels.rs:27:28\n    |\n LL |         asm!(\"foo5: nop\", \"foo6: nop\");\n    |                            ^^^^\n@@ -90,7 +90,7 @@ LL |         asm!(\"foo5: nop\", \"foo6: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:27:15\n+  --> $DIR/named_asm_labels.rs:32:15\n    |\n LL |         asm!(\"foo7: nop; foo8: nop\");\n    |               ^^^^\n@@ -99,7 +99,7 @@ LL |         asm!(\"foo7: nop; foo8: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:27:26\n+  --> $DIR/named_asm_labels.rs:32:26\n    |\n LL |         asm!(\"foo7: nop; foo8: nop\");\n    |                          ^^^^\n@@ -108,7 +108,7 @@ LL |         asm!(\"foo7: nop; foo8: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:30:15\n+  --> $DIR/named_asm_labels.rs:35:15\n    |\n LL |         asm!(\"foo9: nop; nop\");\n    |               ^^^^\n@@ -117,7 +117,7 @@ LL |         asm!(\"foo9: nop; nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:31:20\n+  --> $DIR/named_asm_labels.rs:36:20\n    |\n LL |         asm!(\"nop; foo10: nop\");\n    |                    ^^^^^\n@@ -126,7 +126,7 @@ LL |         asm!(\"nop; foo10: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:34:15\n+  --> $DIR/named_asm_labels.rs:39:15\n    |\n LL |         asm!(\"bar2: nop\\n bar3: nop\");\n    |               ^^^^\n@@ -135,7 +135,7 @@ LL |         asm!(\"bar2: nop\\n bar3: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:34:27\n+  --> $DIR/named_asm_labels.rs:39:27\n    |\n LL |         asm!(\"bar2: nop\\n bar3: nop\");\n    |                           ^^^^\n@@ -144,7 +144,7 @@ LL |         asm!(\"bar2: nop\\n bar3: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:37:15\n+  --> $DIR/named_asm_labels.rs:42:15\n    |\n LL |         asm!(\"bar4: nop\\n nop\");\n    |               ^^^^\n@@ -153,7 +153,7 @@ LL |         asm!(\"bar4: nop\\n nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:38:21\n+  --> $DIR/named_asm_labels.rs:43:21\n    |\n LL |         asm!(\"nop\\n bar5: nop\");\n    |                     ^^^^\n@@ -162,7 +162,7 @@ LL |         asm!(\"nop\\n bar5: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:39:21\n+  --> $DIR/named_asm_labels.rs:44:21\n    |\n LL |         asm!(\"nop\\n bar6: bar7: nop\");\n    |                     ^^^^\n@@ -171,7 +171,7 @@ LL |         asm!(\"nop\\n bar6: bar7: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:39:27\n+  --> $DIR/named_asm_labels.rs:44:27\n    |\n LL |         asm!(\"nop\\n bar6: bar7: nop\");\n    |                           ^^^^\n@@ -180,7 +180,7 @@ LL |         asm!(\"nop\\n bar6: bar7: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:46:13\n+  --> $DIR/named_asm_labels.rs:51:13\n    |\n LL |             blah2: nop\n    |             ^^^^^\n@@ -189,7 +189,7 @@ LL |             blah2: nop\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:47:13\n+  --> $DIR/named_asm_labels.rs:52:13\n    |\n LL |             blah3: nop\n    |             ^^^^^\n@@ -198,7 +198,7 @@ LL |             blah3: nop\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:55:19\n+  --> $DIR/named_asm_labels.rs:60:19\n    |\n LL |             nop ; blah4: nop\n    |                   ^^^^^\n@@ -207,7 +207,7 @@ LL |             nop ; blah4: nop\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:69:15\n+  --> $DIR/named_asm_labels.rs:74:15\n    |\n LL |         asm!(\"blah1: 2bar: nop\");\n    |               ^^^^^\n@@ -216,7 +216,7 @@ LL |         asm!(\"blah1: 2bar: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:72:15\n+  --> $DIR/named_asm_labels.rs:77:15\n    |\n LL |         asm!(\"def: def: nop\");\n    |               ^^^\n@@ -225,7 +225,7 @@ LL |         asm!(\"def: def: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:73:15\n+  --> $DIR/named_asm_labels.rs:78:15\n    |\n LL |         asm!(\"def: nop\\ndef: nop\");\n    |               ^^^\n@@ -234,7 +234,7 @@ LL |         asm!(\"def: nop\\ndef: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:74:15\n+  --> $DIR/named_asm_labels.rs:79:15\n    |\n LL |         asm!(\"def: nop; def: nop\");\n    |               ^^^\n@@ -243,7 +243,7 @@ LL |         asm!(\"def: nop; def: nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:82:15\n+  --> $DIR/named_asm_labels.rs:87:15\n    |\n LL |         asm!(\"fooo\\u{003A} nop\");\n    |               ^^^^^^^^^^^^^^^^\n@@ -252,7 +252,7 @@ LL |         asm!(\"fooo\\u{003A} nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:83:15\n+  --> $DIR/named_asm_labels.rs:88:15\n    |\n LL |         asm!(\"foooo\\x3A nop\");\n    |               ^^^^^^^^^^^^^\n@@ -261,7 +261,7 @@ LL |         asm!(\"foooo\\x3A nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:86:15\n+  --> $DIR/named_asm_labels.rs:91:15\n    |\n LL |         asm!(\"fooooo:\\u{000A} nop\");\n    |               ^^^^^^\n@@ -270,7 +270,7 @@ LL |         asm!(\"fooooo:\\u{000A} nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:87:15\n+  --> $DIR/named_asm_labels.rs:92:15\n    |\n LL |         asm!(\"foooooo:\\x0A nop\");\n    |               ^^^^^^^\n@@ -279,7 +279,7 @@ LL |         asm!(\"foooooo:\\x0A nop\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:91:14\n+  --> $DIR/named_asm_labels.rs:96:14\n    |\n LL |         asm!(\"\\x41\\x42\\x43\\x3A\\x20\\x6E\\x6F\\x70\");\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -288,7 +288,7 @@ LL |         asm!(\"\\x41\\x42\\x43\\x3A\\x20\\x6E\\x6F\\x70\");\n    = note: See the asm section of the unstable book <https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels> for more information\n \n error: do not use named labels in inline assembly\n-  --> $DIR/named_asm_labels.rs:102:13\n+  --> $DIR/named_asm_labels.rs:107:13\n    |\n LL |             ab: nop // ab: does foo\n    |             ^^"}]}