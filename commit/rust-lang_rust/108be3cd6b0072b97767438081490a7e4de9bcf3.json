{"sha": "108be3cd6b0072b97767438081490a7e4de9bcf3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEwOGJlM2NkNmIwMDcyYjk3NzY3NDM4MDgxNDkwYTdlNGRlOWJjZjM=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-09-18T08:21:36Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-09-18T08:21:36Z"}, "message": "Rollup merge of #54205 - GuillaumeGomez:treat-err-as-bug, r=QuietMisdreavus\n\nAdd treat-err-as-bug flag in rustdoc\n\ncc @nikomatsakis\nr? @QuietMisdreavus", "tree": {"sha": "e791e5a6e561c252a1b9ceb7565c7c430115166b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e791e5a6e561c252a1b9ceb7565c7c430115166b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/108be3cd6b0072b97767438081490a7e4de9bcf3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJboLWQCRBK7hj4Ov3rIwAAdHIIAJu0ZNgUO50mPsfi+d3ZDvSx\n8ddcbFmuoRenz+8thx4ZgBfDMsb9JPojBN7skWI6P7xAokNA7SrMv2lhd6Bf3dAv\nsHDwYxFI8PBuiTFOOcliBNWYX9EkFqYlq8EpSILE40LZfSU14yJVdQHkJmNJfBJn\nWTD1W2VpJEwcN3UWTRju15t7Fqn/jKZmmYEHQZb96jlzsxB9ASGlJUJdSHg9wjCL\nzHVjOt2KILOMJ9D4K3PYQ3vYrPfiwlfdOC7Jk/3WhtL+MMi+Jfq2k7xX+AIfbEi4\nkBgfVNu6XmaC1mpQa9GixGR9iGA9Y/+Y/sVm1BPeiUWreAoN4BOqxxvX9D73+GI=\n=GmD6\n-----END PGP SIGNATURE-----\n", "payload": "tree e791e5a6e561c252a1b9ceb7565c7c430115166b\nparent 6aed133ebde9f3e9e9ad779a02092cdf59fbd986\nparent 818938f3442391888242e630a367d6394b59e096\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1537258896 +0200\ncommitter GitHub <noreply@github.com> 1537258896 +0200\n\nRollup merge of #54205 - GuillaumeGomez:treat-err-as-bug, r=QuietMisdreavus\n\nAdd treat-err-as-bug flag in rustdoc\n\ncc @nikomatsakis\nr? @QuietMisdreavus\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/108be3cd6b0072b97767438081490a7e4de9bcf3", "html_url": "https://github.com/rust-lang/rust/commit/108be3cd6b0072b97767438081490a7e4de9bcf3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/108be3cd6b0072b97767438081490a7e4de9bcf3/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6aed133ebde9f3e9e9ad779a02092cdf59fbd986", "url": "https://api.github.com/repos/rust-lang/rust/commits/6aed133ebde9f3e9e9ad779a02092cdf59fbd986", "html_url": "https://github.com/rust-lang/rust/commit/6aed133ebde9f3e9e9ad779a02092cdf59fbd986"}, {"sha": "818938f3442391888242e630a367d6394b59e096", "url": "https://api.github.com/repos/rust-lang/rust/commits/818938f3442391888242e630a367d6394b59e096", "html_url": "https://github.com/rust-lang/rust/commit/818938f3442391888242e630a367d6394b59e096"}], "stats": {"total": 32, "additions": 21, "deletions": 11}, "files": [{"sha": "2feeecb388f38d0976be7f8d641930ceab98bd6e", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/108be3cd6b0072b97767438081490a7e4de9bcf3/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/108be3cd6b0072b97767438081490a7e4de9bcf3/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=108be3cd6b0072b97767438081490a7e4de9bcf3", "patch": "@@ -260,9 +260,10 @@ impl DocAccessLevels for AccessLevels<DefId> {\n ///\n /// If the given `error_format` is `ErrorOutputType::Json` and no `SourceMap` is given, a new one\n /// will be created for the handler.\n-pub fn new_handler(error_format: ErrorOutputType, source_map: Option<Lrc<source_map::SourceMap>>)\n-    -> errors::Handler\n-{\n+pub fn new_handler(error_format: ErrorOutputType,\n+                   source_map: Option<Lrc<source_map::SourceMap>>,\n+                   treat_err_as_bug: bool,\n+) -> errors::Handler {\n     // rustdoc doesn't override (or allow to override) anything from this that is relevant here, so\n     // stick to the defaults\n     let sessopts = Options::default();\n@@ -299,7 +300,7 @@ pub fn new_handler(error_format: ErrorOutputType, source_map: Option<Lrc<source_\n         emitter,\n         errors::HandlerFlags {\n             can_emit_warnings: true,\n-            treat_err_as_bug: false,\n+            treat_err_as_bug,\n             report_delayed_bugs: false,\n             external_macro_backtrace: false,\n             ..Default::default()\n@@ -323,9 +324,9 @@ pub fn run_core(search_paths: SearchPaths,\n                 lint_cap: Option<lint::Level>,\n                 describe_lints: bool,\n                 mut manual_passes: Vec<String>,\n-                mut default_passes: passes::DefaultPassOption)\n-    -> (clean::Crate, RenderInfo, Vec<String>)\n-{\n+                mut default_passes: passes::DefaultPassOption,\n+                treat_err_as_bug: bool,\n+) -> (clean::Crate, RenderInfo, Vec<String>) {\n     // Parse, resolve, and typecheck the given crate.\n \n     let cpath = match input {\n@@ -388,7 +389,9 @@ pub fn run_core(search_paths: SearchPaths,\n     };\n     driver::spawn_thread_pool(sessopts, move |sessopts| {\n         let source_map = Lrc::new(source_map::SourceMap::new(sessopts.file_path_mapping()));\n-        let diagnostic_handler = new_handler(error_format, Some(source_map.clone()));\n+        let diagnostic_handler = new_handler(error_format,\n+                                             Some(source_map.clone()),\n+                                             treat_err_as_bug);\n \n         let mut sess = session::build_session_(\n             sessopts, cpath, diagnostic_handler, source_map,"}, {"sha": "5f373a635dd7a671a53402b4c5e677218a22e176", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/108be3cd6b0072b97767438081490a7e4de9bcf3/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/108be3cd6b0072b97767438081490a7e4de9bcf3/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=108be3cd6b0072b97767438081490a7e4de9bcf3", "patch": "@@ -404,8 +404,11 @@ fn main_args(args: &[String]) -> isize {\n                                   `short` (instead was `{}`)\", arg));\n         }\n     };\n+    let treat_err_as_bug = matches.opt_strs(\"Z\").iter().any(|x| {\n+        *x == \"treat-err-as-bug\"\n+    });\n \n-    let diag = core::new_handler(error_format, None);\n+    let diag = core::new_handler(error_format, None, treat_err_as_bug);\n \n     // check for deprecated options\n     check_deprecated_options(&matches, &diag);\n@@ -560,7 +563,7 @@ fn main_args(args: &[String]) -> isize {\n     let res = acquire_input(PathBuf::from(input), externs, edition, cg, &matches, error_format,\n                             move |out| {\n         let Output { krate, passes, renderinfo } = out;\n-        let diag = core::new_handler(error_format, None);\n+        let diag = core::new_handler(error_format, None, treat_err_as_bug);\n         info!(\"going to format\");\n         match output_format.as_ref().map(|s| &**s) {\n             Some(\"html\") | None => {\n@@ -694,6 +697,9 @@ where R: 'static + Send,\n     let force_unstable_if_unmarked = matches.opt_strs(\"Z\").iter().any(|x| {\n         *x == \"force-unstable-if-unmarked\"\n     });\n+    let treat_err_as_bug = matches.opt_strs(\"Z\").iter().any(|x| {\n+        *x == \"treat-err-as-bug\"\n+    });\n \n     let (lint_opts, describe_lints, lint_cap) = get_cmd_lint_options(matches, error_format);\n \n@@ -706,7 +712,8 @@ where R: 'static + Send,\n             core::run_core(paths, cfgs, externs, Input::File(cratefile), triple, maybe_sysroot,\n                            display_warnings, crate_name.clone(),\n                            force_unstable_if_unmarked, edition, cg, error_format,\n-                           lint_opts, lint_cap, describe_lints, manual_passes, default_passes);\n+                           lint_opts, lint_cap, describe_lints, manual_passes, default_passes,\n+                           treat_err_as_bug);\n \n         info!(\"finished with rustc\");\n "}]}