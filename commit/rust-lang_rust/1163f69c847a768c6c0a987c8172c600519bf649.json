{"sha": "1163f69c847a768c6c0a987c8172c600519bf649", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExNjNmNjljODQ3YTc2OGM2YzBhOTg3YzgxNzJjNjAwNTE5YmY2NDk=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-03-29T01:15:35Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-03-29T01:15:35Z"}, "message": "rustc: fix linkage of internal static nodes.", "tree": {"sha": "558a9a7dfed300c24b5b648c62ce4f159b98c491", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/558a9a7dfed300c24b5b648c62ce4f159b98c491"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1163f69c847a768c6c0a987c8172c600519bf649", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1163f69c847a768c6c0a987c8172c600519bf649", "html_url": "https://github.com/rust-lang/rust/commit/1163f69c847a768c6c0a987c8172c600519bf649", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1163f69c847a768c6c0a987c8172c600519bf649/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "943d7adedc2401b54e103ea3635d0e50b1822d5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/943d7adedc2401b54e103ea3635d0e50b1822d5a", "html_url": "https://github.com/rust-lang/rust/commit/943d7adedc2401b54e103ea3635d0e50b1822d5a"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "04b641ed3036c0286a5ec9fa4ad38a4867282bb4", "filename": "src/librustc/middle/trans/consts.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1163f69c847a768c6c0a987c8172c600519bf649/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163f69c847a768c6c0a987c8172c600519bf649/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs?ref=1163f69c847a768c6c0a987c8172c600519bf649", "patch": "@@ -11,7 +11,8 @@\n use core::prelude::*;\n \n use back::abi;\n-use lib::llvm::{llvm, ValueRef, TypeRef, Bool, True, False};\n+use lib::llvm::{llvm, SetLinkage, InternalLinkage, PrivateLinkage,\n+                ValueRef, TypeRef, Bool, True, False};\n use metadata::csearch;\n use middle::const_eval;\n use middle::trans::adt;\n@@ -104,6 +105,7 @@ fn const_addr_of(cx: @CrateContext, cv: ValueRef) -> ValueRef {\n         };\n         llvm::LLVMSetInitializer(gv, cv);\n         llvm::LLVMSetGlobalConstant(gv, True);\n+        SetLinkage(gv, PrivateLinkage);\n         gv\n     }\n }\n@@ -483,6 +485,7 @@ fn const_expr_unadjusted(cx: @CrateContext, e: @ast::expr) -> ValueRef {\n                 };\n                 llvm::LLVMSetInitializer(gv, cv);\n                 llvm::LLVMSetGlobalConstant(gv, True);\n+                SetLinkage(gv, PrivateLinkage);\n                 let p = const_ptrcast(cx, gv, llunitty);\n                 C_struct(~[p, sz])\n               }"}]}