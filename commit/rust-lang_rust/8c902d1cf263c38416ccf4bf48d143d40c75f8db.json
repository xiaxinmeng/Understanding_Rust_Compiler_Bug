{"sha": "8c902d1cf263c38416ccf4bf48d143d40c75f8db", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjOTAyZDFjZjI2M2MzODQxNmNjZjRiZjQ4ZDE0M2Q0MGM3NWY4ZGI=", "commit": {"author": {"name": "Owen Sanchez", "email": "pengowen816@gmail.com", "date": "2018-10-16T04:12:59Z"}, "committer": {"name": "Owen Sanchez", "email": "pengowen816@gmail.com", "date": "2018-10-16T19:38:23Z"}, "message": "Simplify manual_memcpy suggestion in some cases", "tree": {"sha": "c4147869f89e4547eb1e611c5014bbe9a041149d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c4147869f89e4547eb1e611c5014bbe9a041149d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8c902d1cf263c38416ccf4bf48d143d40c75f8db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8c902d1cf263c38416ccf4bf48d143d40c75f8db", "html_url": "https://github.com/rust-lang/rust/commit/8c902d1cf263c38416ccf4bf48d143d40c75f8db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8c902d1cf263c38416ccf4bf48d143d40c75f8db/comments", "author": {"login": "pengowen123", "id": 12902948, "node_id": "MDQ6VXNlcjEyOTAyOTQ4", "avatar_url": "https://avatars.githubusercontent.com/u/12902948?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pengowen123", "html_url": "https://github.com/pengowen123", "followers_url": "https://api.github.com/users/pengowen123/followers", "following_url": "https://api.github.com/users/pengowen123/following{/other_user}", "gists_url": "https://api.github.com/users/pengowen123/gists{/gist_id}", "starred_url": "https://api.github.com/users/pengowen123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pengowen123/subscriptions", "organizations_url": "https://api.github.com/users/pengowen123/orgs", "repos_url": "https://api.github.com/users/pengowen123/repos", "events_url": "https://api.github.com/users/pengowen123/events{/privacy}", "received_events_url": "https://api.github.com/users/pengowen123/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pengowen123", "id": 12902948, "node_id": "MDQ6VXNlcjEyOTAyOTQ4", "avatar_url": "https://avatars.githubusercontent.com/u/12902948?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pengowen123", "html_url": "https://github.com/pengowen123", "followers_url": "https://api.github.com/users/pengowen123/followers", "following_url": "https://api.github.com/users/pengowen123/following{/other_user}", "gists_url": "https://api.github.com/users/pengowen123/gists{/gist_id}", "starred_url": "https://api.github.com/users/pengowen123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pengowen123/subscriptions", "organizations_url": "https://api.github.com/users/pengowen123/orgs", "repos_url": "https://api.github.com/users/pengowen123/repos", "events_url": "https://api.github.com/users/pengowen123/events{/privacy}", "received_events_url": "https://api.github.com/users/pengowen123/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f4b13bc1bbd43ed21878c21291dddde7e4b9028", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f4b13bc1bbd43ed21878c21291dddde7e4b9028", "html_url": "https://github.com/rust-lang/rust/commit/0f4b13bc1bbd43ed21878c21291dddde7e4b9028"}], "stats": {"total": 55, "additions": 46, "deletions": 9}, "files": [{"sha": "4c505ababf14526a84ec535d39e11ad5e98f1446", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/8c902d1cf263c38416ccf4bf48d143d40c75f8db/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c902d1cf263c38416ccf4bf48d143d40c75f8db/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=8c902d1cf263c38416ccf4bf48d143d40c75f8db", "patch": "@@ -950,8 +950,20 @@ fn detect_manual_memcpy<'a, 'tcx>(\n                     (\"0\", _, x, false) | (x, false, \"0\", false) => x.into(),\n                     (\"0\", _, x, true) | (x, false, \"0\", true) => format!(\"-{}\", x),\n                     (x, false, y, false) => format!(\"({} + {})\", x, y),\n-                    (x, false, y, true) => format!(\"({} - {})\", x, y),\n-                    (x, true, y, false) => format!(\"({} - {})\", y, x),\n+                    (x, false, y, true) => {\n+                        if x == y {\n+                            \"0\".into()\n+                        } else {\n+                            format!(\"({} - {})\", x, y)\n+                        }\n+                    },\n+                    (x, true, y, false) => {\n+                        if x == y {\n+                            \"0\".into()\n+                        } else {\n+                            format!(\"({} - {})\", y, x)\n+                        }\n+                    },\n                     (x, true, y, true) => format!(\"-({} + {})\", x, y),\n                 }\n             };"}, {"sha": "f80270d9fe8f71514a37fa4afe7cd91505460932", "filename": "tests/ui/for_loop.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8c902d1cf263c38416ccf4bf48d143d40c75f8db/tests%2Fui%2Ffor_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c902d1cf263c38416ccf4bf48d143d40c75f8db/tests%2Fui%2Ffor_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.rs?ref=8c902d1cf263c38416ccf4bf48d143d40c75f8db", "patch": "@@ -550,6 +550,19 @@ pub fn manual_copy(src: &[i32], dst: &mut [i32], dst2: &mut [i32]) {\n     for i in 0..10 {\n         dst_vec[i] = src[i];\n     }\n+\n+    // Simplify suggestion (issue #3004)\n+    let src = [0, 1, 2, 3, 4];\n+    let mut dst = [0, 0, 0, 0, 0, 0];\n+    let from = 1;\n+\n+    for i in from..from + src.len() {\n+        dst[i] = src[i - from];\n+    }\n+\n+    for i in from..from + 3 {\n+        dst[i] = src[i - from];\n+    }\n }\n \n #[warn(clippy::needless_range_loop)]"}, {"sha": "331763357832610dad9e6ba4706c4aa4560de589", "filename": "tests/ui/for_loop.stderr", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/8c902d1cf263c38416ccf4bf48d143d40c75f8db/tests%2Fui%2Ffor_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8c902d1cf263c38416ccf4bf48d143d40c75f8db/tests%2Fui%2Ffor_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.stderr?ref=8c902d1cf263c38416ccf4bf48d143d40c75f8db", "patch": "@@ -482,22 +482,34 @@ error: it looks like you're manually copying between slices\n     |              ^^^^^^^^^^^^^^^^ help: try replacing the loop by: `dst_vec[..src_vec.len()].clone_from_slice(&src_vec[..])`\n \n error: it looks like you're manually copying between slices\n-   --> $DIR/for_loop.rs:557:14\n+   --> $DIR/for_loop.rs:559:14\n     |\n-557 |     for i in 0..src.len() {\n+559 |     for i in from..from + src.len() {\n+    |              ^^^^^^^^^^^^^^^^^^^^^^ help: try replacing the loop by: `dst[from..from + src.len()].clone_from_slice(&src[0..(from + src.len() - from)])`\n+\n+error: it looks like you're manually copying between slices\n+   --> $DIR/for_loop.rs:563:14\n+    |\n+563 |     for i in from..from + 3 {\n+    |              ^^^^^^^^^^^^^^ help: try replacing the loop by: `dst[from..from + 3].clone_from_slice(&src[0..(from + 3 - from)])`\n+\n+error: it looks like you're manually copying between slices\n+   --> $DIR/for_loop.rs:570:14\n+    |\n+570 |     for i in 0..src.len() {\n     |              ^^^^^^^^^^^^ help: try replacing the loop by: `dst[..src.len()].clone_from_slice(&src[..])`\n \n error: the variable `count` is used as a loop counter. Consider using `for (count, item) in text.chars().enumerate()` or similar iterators\n-   --> $DIR/for_loop.rs:618:19\n+   --> $DIR/for_loop.rs:631:19\n     |\n-618 |         for ch in text.chars() {\n+631 |         for ch in text.chars() {\n     |                   ^^^^^^^^^^^^\n \n error: the variable `count` is used as a loop counter. Consider using `for (count, item) in text.chars().enumerate()` or similar iterators\n-   --> $DIR/for_loop.rs:629:19\n+   --> $DIR/for_loop.rs:642:19\n     |\n-629 |         for ch in text.chars() {\n+642 |         for ch in text.chars() {\n     |                   ^^^^^^^^^^^^\n \n-error: aborting due to 61 previous errors\n+error: aborting due to 63 previous errors\n "}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "tests/ui/for_loop.stdout", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/8c902d1cf263c38416ccf4bf48d143d40c75f8db/tests%2Fui%2Ffor_loop.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/8c902d1cf263c38416ccf4bf48d143d40c75f8db/tests%2Fui%2Ffor_loop.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.stdout?ref=8c902d1cf263c38416ccf4bf48d143d40c75f8db"}]}