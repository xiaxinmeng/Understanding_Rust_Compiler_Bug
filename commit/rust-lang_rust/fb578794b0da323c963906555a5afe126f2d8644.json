{"sha": "fb578794b0da323c963906555a5afe126f2d8644", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiNTc4Nzk0YjBkYTMyM2M5NjM5MDY1NTVhNWFmZTEyNmYyZDg2NDQ=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-12-01T14:34:04Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2019-05-23T16:51:49Z"}, "message": "Update privacy_access_levels", "tree": {"sha": "a06216624d6ffc1bb042f04ff6feee8d41f6992b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a06216624d6ffc1bb042f04ff6feee8d41f6992b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb578794b0da323c963906555a5afe126f2d8644", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb578794b0da323c963906555a5afe126f2d8644", "html_url": "https://github.com/rust-lang/rust/commit/fb578794b0da323c963906555a5afe126f2d8644", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb578794b0da323c963906555a5afe126f2d8644/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5751fcc3b129a31981e9e24ee0ad063b9c7574ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/5751fcc3b129a31981e9e24ee0ad063b9c7574ff", "html_url": "https://github.com/rust-lang/rust/commit/5751fcc3b129a31981e9e24ee0ad063b9c7574ff"}], "stats": {"total": 11, "additions": 5, "deletions": 6}, "files": [{"sha": "a31c57c1f6809e50459b6e2d7bd6c58a3e19b1a9", "filename": "src/librustc/arena.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc%2Farena.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc%2Farena.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Farena.rs?ref=fb578794b0da323c963906555a5afe126f2d8644", "patch": "@@ -82,6 +82,7 @@ macro_rules! arena_types {\n             [few] stability_index: rustc::middle::stability::Index<'tcx>,\n             [few] features: syntax::feature_gate::Features,\n             [few] all_traits: Vec<rustc::hir::def_id::DefId>,\n+            [few] privacy_access_levels: rustc::middle::privacy::AccessLevels,\n         ], $tcx);\n     )\n }"}, {"sha": "6114f9da59480b080e08ca1d19f30c313df8fdfd", "filename": "src/librustc/query/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fquery%2Fmod.rs?ref=fb578794b0da323c963906555a5afe126f2d8644", "patch": "@@ -437,7 +437,7 @@ rustc_queries! {\n         query check_match(_: DefId) -> () {}\n \n         /// Performs part of the privacy check and computes \"access levels\".\n-        query privacy_access_levels(_: CrateNum) -> Lrc<AccessLevels> {\n+        query privacy_access_levels(_: CrateNum) -> &'tcx AccessLevels {\n             eval_always\n             desc { \"privacy access levels\" }\n         }"}, {"sha": "65b6a89aa0b4d4225cd98e14e44144f42d73feb3", "filename": "src/librustc_privacy/lib.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc_privacy%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc_privacy%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_privacy%2Flib.rs?ref=fb578794b0da323c963906555a5afe126f2d8644", "patch": "@@ -24,7 +24,6 @@ use rustc::ty::query::Providers;\n use rustc::ty::subst::InternalSubsts;\n use rustc::util::nodemap::HirIdSet;\n use rustc_data_structures::fx::FxHashSet;\n-use rustc_data_structures::sync::Lrc;\n use syntax::ast::Ident;\n use syntax::attr;\n use syntax::symbol::{kw, sym};\n@@ -1851,7 +1850,7 @@ fn check_mod_privacy<'tcx>(tcx: TyCtxt<'_, 'tcx, 'tcx>, module_def_id: DefId) {\n fn privacy_access_levels<'tcx>(\n     tcx: TyCtxt<'_, 'tcx, 'tcx>,\n     krate: CrateNum,\n-) -> Lrc<AccessLevels> {\n+) -> &'tcx AccessLevels {\n     assert_eq!(krate, LOCAL_CRATE);\n \n     // Build up a set of all exported items in the AST. This is a set of all\n@@ -1872,7 +1871,7 @@ fn privacy_access_levels<'tcx>(\n     }\n     visitor.update(hir::CRATE_HIR_ID, Some(AccessLevel::Public));\n \n-    Lrc::new(visitor.access_levels)\n+    tcx.arena.alloc(visitor.access_levels)\n }\n \n fn check_private_in_public<'tcx>(tcx: TyCtxt<'_, 'tcx, 'tcx>, krate: CrateNum) {"}, {"sha": "45ace5b37665a86eb17268812150f6de755b9e93", "filename": "src/librustc_save_analysis/lib.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc_save_analysis%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb578794b0da323c963906555a5afe126f2d8644/src%2Flibrustc_save_analysis%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Flib.rs?ref=fb578794b0da323c963906555a5afe126f2d8644", "patch": "@@ -24,7 +24,6 @@ use rustc::session::config::{CrateType, Input, OutputType};\n use rustc::ty::{self, DefIdTree, TyCtxt};\n use rustc::{bug, span_bug};\n use rustc_codegen_utils::link::{filename_for_metadata, out_filename};\n-use rustc_data_structures::sync::Lrc;\n \n use std::cell::Cell;\n use std::default::Default;\n@@ -1120,7 +1119,7 @@ pub fn process_crate<'l, 'tcx, H: SaveHandler>(\n         // fallback in case the access levels couldn't have been correctly computed.\n         let access_levels = match tcx.sess.compile_status() {\n             Ok(..) => tcx.privacy_access_levels(LOCAL_CRATE),\n-            Err(..) => Lrc::new(AccessLevels::default()),\n+            Err(..) => tcx.arena.alloc(AccessLevels::default()),\n         };\n \n         let save_ctxt = SaveContext {"}]}