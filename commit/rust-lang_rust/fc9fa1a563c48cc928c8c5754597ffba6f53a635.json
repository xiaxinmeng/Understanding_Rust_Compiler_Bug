{"sha": "fc9fa1a563c48cc928c8c5754597ffba6f53a635", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjOWZhMWE1NjNjNDhjYzkyOGM4YzU3NTQ1OTdmZmJhNmY1M2E2MzU=", "commit": {"author": {"name": "Brian Brooks", "email": "brooks.brian@gmail.com", "date": "2015-02-21T22:26:29Z"}, "committer": {"name": "Brian Brooks", "email": "brooks.brian@gmail.com", "date": "2015-02-21T22:26:29Z"}, "message": "Resolve barriers to changing column!() / line!() return type to u32 in #19284 . Address review comments in #21769 .", "tree": {"sha": "c8b6dce437b1f392a9508ffa32b4538c553794b7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c8b6dce437b1f392a9508ffa32b4538c553794b7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc9fa1a563c48cc928c8c5754597ffba6f53a635", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc9fa1a563c48cc928c8c5754597ffba6f53a635", "html_url": "https://github.com/rust-lang/rust/commit/fc9fa1a563c48cc928c8c5754597ffba6f53a635", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc9fa1a563c48cc928c8c5754597ffba6f53a635/comments", "author": {"login": "brooksbp", "id": 130974, "node_id": "MDQ6VXNlcjEzMDk3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/130974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brooksbp", "html_url": "https://github.com/brooksbp", "followers_url": "https://api.github.com/users/brooksbp/followers", "following_url": "https://api.github.com/users/brooksbp/following{/other_user}", "gists_url": "https://api.github.com/users/brooksbp/gists{/gist_id}", "starred_url": "https://api.github.com/users/brooksbp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brooksbp/subscriptions", "organizations_url": "https://api.github.com/users/brooksbp/orgs", "repos_url": "https://api.github.com/users/brooksbp/repos", "events_url": "https://api.github.com/users/brooksbp/events{/privacy}", "received_events_url": "https://api.github.com/users/brooksbp/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brooksbp", "id": 130974, "node_id": "MDQ6VXNlcjEzMDk3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/130974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brooksbp", "html_url": "https://github.com/brooksbp", "followers_url": "https://api.github.com/users/brooksbp/followers", "following_url": "https://api.github.com/users/brooksbp/following{/other_user}", "gists_url": "https://api.github.com/users/brooksbp/gists{/gist_id}", "starred_url": "https://api.github.com/users/brooksbp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brooksbp/subscriptions", "organizations_url": "https://api.github.com/users/brooksbp/orgs", "repos_url": "https://api.github.com/users/brooksbp/repos", "events_url": "https://api.github.com/users/brooksbp/events{/privacy}", "received_events_url": "https://api.github.com/users/brooksbp/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1212fd8abc7602f6c506c936908a799c76549a14", "url": "https://api.github.com/repos/rust-lang/rust/commits/1212fd8abc7602f6c506c936908a799c76549a14", "html_url": "https://github.com/rust-lang/rust/commit/1212fd8abc7602f6c506c936908a799c76549a14"}], "stats": {"total": 79, "additions": 64, "deletions": 15}, "files": [{"sha": "92d50821592c62b0aa99e618a30995bb50e9441c", "filename": "src/libcore/macros.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibcore%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibcore%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmacros.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -15,16 +15,21 @@ macro_rules! panic {\n         panic!(\"explicit panic\")\n     );\n     ($msg:expr) => ({\n-        static _MSG_FILE_LINE: (&'static str, &'static str, usize) =\n-            ($msg, file!(), line!() as usize);\n+        #[cfg(stage0)]\n+        static _MSG_FILE_LINE: (&'static str, &'static str, usize) = ($msg, file!(), line!());\n+        #[cfg(not(stage0))]\n+        static _MSG_FILE_LINE: (&'static str, &'static str, u32) = ($msg, file!(), line!());\n         ::core::panicking::panic(&_MSG_FILE_LINE)\n     });\n     ($fmt:expr, $($arg:tt)*) => ({\n         // The leading _'s are to avoid dead code warnings if this is\n         // used inside a dead function. Just `#[allow(dead_code)]` is\n         // insufficient, since the user may have\n         // `#[forbid(dead_code)]` and which cannot be overridden.\n-        static _FILE_LINE: (&'static str, usize) = (file!(), line!() as usize);\n+        #[cfg(stage0)]\n+        static _FILE_LINE: (&'static str, usize) = (file!(), line!());\n+        #[cfg(not(stage0))]\n+        static _FILE_LINE: (&'static str, u32) = (file!(), line!());\n         ::core::panicking::panic_fmt(format_args!($fmt, $($arg)*), &_FILE_LINE)\n     });\n }"}, {"sha": "168dcf4978c4634f9e81993a46047ab2778db618", "filename": "src/libcore/panicking.rs", "status": "modified", "additions": 34, "deletions": 5, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibcore%2Fpanicking.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibcore%2Fpanicking.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fpanicking.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -34,26 +34,55 @@ use fmt;\n \n #[cold] #[inline(never)] // this is the slow path, always\n #[lang=\"panic\"]\n-pub fn panic(expr_file_line: &(&'static str, &'static str, uint)) -> ! {\n+#[cfg(stage0)]\n+pub fn panic(expr_file_line: &(&'static str, &'static str, usize)) -> ! {\n+    let (expr, file, line) = *expr_file_line;\n+    panic_fmt(format_args!(\"{}\", expr), &(file, line))\n+}\n+#[cold] #[inline(never)] // this is the slow path, always\n+#[lang=\"panic\"]\n+#[cfg(not(stage0))]\n+pub fn panic(expr_file_line: &(&'static str, &'static str, u32)) -> ! {\n     let (expr, file, line) = *expr_file_line;\n     panic_fmt(format_args!(\"{}\", expr), &(file, line))\n }\n \n #[cold] #[inline(never)]\n #[lang=\"panic_bounds_check\"]\n-fn panic_bounds_check(file_line: &(&'static str, uint),\n-                     index: uint, len: uint) -> ! {\n+#[cfg(stage0)]\n+fn panic_bounds_check(file_line: &(&'static str, usize),\n+                     index: usize, len: usize) -> ! {\n+    panic_fmt(format_args!(\"index out of bounds: the len is {} but the index is {}\",\n+                           len, index), file_line)\n+}\n+#[cold] #[inline(never)]\n+#[lang=\"panic_bounds_check\"]\n+#[cfg(not(stage0))]\n+fn panic_bounds_check(file_line: &(&'static str, u32),\n+                     index: usize, len: usize) -> ! {\n     panic_fmt(format_args!(\"index out of bounds: the len is {} but the index is {}\",\n                            len, index), file_line)\n }\n \n #[cold] #[inline(never)]\n-pub fn panic_fmt(fmt: fmt::Arguments, file_line: &(&'static str, uint)) -> ! {\n+#[cfg(stage0)]\n+pub fn panic_fmt(fmt: fmt::Arguments, file_line: &(&'static str, usize)) -> ! {\n+    #[allow(improper_ctypes)]\n+    extern {\n+        #[lang = \"panic_fmt\"]\n+        fn panic_impl(fmt: fmt::Arguments, file: &'static str, line: uint) -> !;\n+    }\n+    let (file, line) = *file_line;\n+    unsafe { panic_impl(fmt, file, line as uint) }\n+}\n+#[cold] #[inline(never)]\n+#[cfg(not(stage0))]\n+pub fn panic_fmt(fmt: fmt::Arguments, file_line: &(&'static str, u32)) -> ! {\n     #[allow(improper_ctypes)]\n     extern {\n         #[lang = \"panic_fmt\"]\n         fn panic_impl(fmt: fmt::Arguments, file: &'static str, line: uint) -> !;\n     }\n     let (file, line) = *file_line;\n-    unsafe { panic_impl(fmt, file, line) }\n+    unsafe { panic_impl(fmt, file, line as uint) }\n }"}, {"sha": "5c008d35cb3ffd7c5ece77706478654aae584c9d", "filename": "src/liblog/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Fliblog%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Fliblog%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliblog%2Flib.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -342,15 +342,15 @@ pub struct LogRecord<'a> {\n     pub file: &'a str,\n \n     /// The line number of where the LogRecord originated.\n-    pub line: uint,\n+    pub line: u32,\n }\n \n #[doc(hidden)]\n #[derive(Copy)]\n pub struct LogLocation {\n     pub module_path: &'static str,\n     pub file: &'static str,\n-    pub line: uint,\n+    pub line: u32,\n }\n \n /// Tests whether a given module's name is enabled for a particular level of"}, {"sha": "b1d292ebaa8830b7fb58a40caa63794dd424f107", "filename": "src/liblog/macros.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Fliblog%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Fliblog%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliblog%2Fmacros.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -50,8 +50,15 @@\n #[macro_export]\n macro_rules! log {\n     ($lvl:expr, $($arg:tt)+) => ({\n+        #[cfg(stage0)]\n         static LOC: ::log::LogLocation = ::log::LogLocation {\n-            line: line!() as usize,\n+            line: line!() as u32,\n+            file: file!(),\n+            module_path: module_path!(),\n+        };\n+        #[cfg(not(stage0))]\n+        static LOC: ::log::LogLocation = ::log::LogLocation {\n+            line: line!(),\n             file: file!(),\n             module_path: module_path!(),\n         };"}, {"sha": "a757aa9452d8aab1e4c5daaf631e4139cd5b9b75", "filename": "src/librustc_trans/trans/common.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibrustc_trans%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibrustc_trans%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fcommon.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -774,6 +774,10 @@ pub fn C_i32(ccx: &CrateContext, i: i32) -> ValueRef {\n     C_integral(Type::i32(ccx), i as u64, true)\n }\n \n+pub fn C_u32(ccx: &CrateContext, i: u32) -> ValueRef {\n+    C_integral(Type::i32(ccx), i as u64, false)\n+}\n+\n pub fn C_u64(ccx: &CrateContext, i: u64) -> ValueRef {\n     C_integral(Type::i64(ccx), i, false)\n }"}, {"sha": "631aa324f6ce28c9c1c34b9f279b6ba6598adb17", "filename": "src/librustc_trans/trans/controlflow.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibrustc_trans%2Ftrans%2Fcontrolflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibrustc_trans%2Ftrans%2Fcontrolflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fcontrolflow.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -370,7 +370,7 @@ pub fn trans_fail<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n     let loc = bcx.sess().codemap().lookup_char_pos(call_info.span.lo);\n     let filename = token::intern_and_get_ident(&loc.file.name[]);\n     let filename = C_str_slice(ccx, filename);\n-    let line = C_uint(ccx, loc.line);\n+    let line = C_u32(ccx, loc.line as u32);\n     let expr_file_line_const = C_struct(ccx, &[v_str, filename, line], false);\n     let expr_file_line = consts::addr_of(ccx, expr_file_line_const,\n                                          \"panic_loc\", call_info.id);\n@@ -399,7 +399,7 @@ pub fn trans_fail_bounds_check<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n \n     // Invoke the lang item\n     let filename = C_str_slice(ccx,  filename);\n-    let line = C_uint(ccx, loc.line);\n+    let line = C_u32(ccx, loc.line as u32);\n     let file_line_const = C_struct(ccx, &[filename, line], false);\n     let file_line = consts::addr_of(ccx, file_line_const,\n                                     \"panic_bounds_check_loc\", call_info.id);"}, {"sha": "7ba045f0eb034fc5b56f2470b4b45c544515261f", "filename": "src/libsyntax/ext/build.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibsyntax%2Fext%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Flibsyntax%2Fext%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbuild.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -147,6 +147,7 @@ pub trait AstBuilder {\n \n     fn expr_usize(&self, span: Span, i: usize) -> P<ast::Expr>;\n     fn expr_int(&self, sp: Span, i: isize) -> P<ast::Expr>;\n+    fn expr_u8(&self, sp: Span, u: u8) -> P<ast::Expr>;\n     fn expr_u32(&self, sp: Span, u: u32) -> P<ast::Expr>;\n     fn expr_bool(&self, sp: Span, value: bool) -> P<ast::Expr>;\n \n@@ -701,6 +702,9 @@ impl<'a> AstBuilder for ExtCtxt<'a> {\n         self.expr_lit(sp, ast::LitInt(i as u64, ast::SignedIntLit(ast::TyIs(false),\n                                                                   ast::Sign::new(i))))\n     }\n+    fn expr_u8(&self, sp: Span, u: u8) -> P<ast::Expr> {\n+        self.expr_lit(sp, ast::LitInt(u as u64, ast::UnsignedIntLit(ast::TyU8)))\n+    }\n     fn expr_u32(&self, sp: Span, u: u32) -> P<ast::Expr> {\n         self.expr_lit(sp, ast::LitInt(u as u64, ast::UnsignedIntLit(ast::TyU32)))\n     }"}, {"sha": "61d6d3fdd3b717dd08c9753588096038b02033ca", "filename": "src/test/run-pass/syntax-extension-source-utils-files/includeme.fragment", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Ftest%2Frun-pass%2Fsyntax-extension-source-utils-files%2Fincludeme.fragment", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Ftest%2Frun-pass%2Fsyntax-extension-source-utils-files%2Fincludeme.fragment", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsyntax-extension-source-utils-files%2Fincludeme.fragment?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -2,6 +2,6 @@\n \n {\n     assert!(file!().ends_with(\"includeme.fragment\"));\n-    assert!(line!() == 5_u32);\n+    assert!(line!() == 5u32);\n     format!(\"victory robot {}\", line!())\n }"}, {"sha": "ddd8cd8be3d5c00f84287e96521660282eeff7be", "filename": "src/test/run-pass/syntax-extension-source-utils.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Ftest%2Frun-pass%2Fsyntax-extension-source-utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc9fa1a563c48cc928c8c5754597ffba6f53a635/src%2Ftest%2Frun-pass%2Fsyntax-extension-source-utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsyntax-extension-source-utils.rs?ref=fc9fa1a563c48cc928c8c5754597ffba6f53a635", "patch": "@@ -23,7 +23,7 @@ macro_rules! indirect_line { () => ( line!() ) }\n \n pub fn main() {\n     assert_eq!(line!(), 25);\n-    assert!((column!() == 4_u32));\n+    assert!((column!() == 4u32));\n     assert_eq!(indirect_line!(), 27);\n     assert!((file!().ends_with(\"syntax-extension-source-utils.rs\")));\n     assert_eq!(stringify!((2*3) + 5).to_string(), \"( 2 * 3 ) + 5\".to_string());"}]}