{"sha": "917fdb11e45c5b2d0b43566d3736fc34ad917294", "node_id": "C_kwDOAAsO6NoAKDkxN2ZkYjExZTQ1YzViMmQwYjQzNTY2ZDM3MzZmYzM0YWQ5MTcyOTQ", "commit": {"author": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-11-27T19:32:23Z"}, "committer": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-11-27T19:32:50Z"}, "message": "Rewrite comment when handling special case for `ProjectionKind::Deref`", "tree": {"sha": "117d56c09834e8c5323db36f7d5e84374a5f654f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/117d56c09834e8c5323db36f7d5e84374a5f654f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/917fdb11e45c5b2d0b43566d3736fc34ad917294", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/917fdb11e45c5b2d0b43566d3736fc34ad917294", "html_url": "https://github.com/rust-lang/rust/commit/917fdb11e45c5b2d0b43566d3736fc34ad917294", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/917fdb11e45c5b2d0b43566d3736fc34ad917294/comments", "author": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5ce7ff6d94000bab267324db2aa11341265291e", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5ce7ff6d94000bab267324db2aa11341265291e", "html_url": "https://github.com/rust-lang/rust/commit/c5ce7ff6d94000bab267324db2aa11341265291e"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "e1d0920590b456cd1b6edec95faa16df90369eb4", "filename": "clippy_utils/src/sugg.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/917fdb11e45c5b2d0b43566d3736fc34ad917294/clippy_utils%2Fsrc%2Fsugg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/917fdb11e45c5b2d0b43566d3736fc34ad917294/clippy_utils%2Fsrc%2Fsugg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fsugg.rs?ref=917fdb11e45c5b2d0b43566d3736fc34ad917294", "patch": "@@ -937,10 +937,11 @@ impl<'tcx> Delegate<'tcx> for DerefDelegate<'_, 'tcx> {\n                         // note: unable to trigger `Subslice` kind in tests\n                         ProjectionKind::Subslice => (),\n                         ProjectionKind::Deref => {\n-                            // explicit deref for arrays should be avoided in the suggestion\n-                            // i.e.: `|sub| *sub[1..4].len() == 3` is not expected\n+                            // Explicit derefs are typically handled later on, but\n+                            // some items do not need explicit deref, such as array accesses,\n+                            // so we mark them as already processed\n+                            // i.e.: don't suggest `*sub[1..4].len()` for `|sub| sub[1..4].len() == 3`\n                             if let ty::Ref(_, inner, _) = cmt.place.ty_before_projection(i).kind() {\n-                                // dereferencing an array (i.e.: `|sub| sub[1..4].len() == 3`)\n                                 if matches!(inner.kind(), ty::Ref(_, innermost, _) if innermost.is_array()) {\n                                     projections_handled = true;\n                                 }"}]}