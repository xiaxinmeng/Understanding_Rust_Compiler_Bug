{"sha": "4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhMjkzYTM5OTBhMGMxYmYxNzBkMzFkMWQ5YmNiYzc5Y2VmOGE1Yjg=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-09-24T21:53:28Z"}, "committer": {"name": "Keith Yeung", "email": "kungfukeith11@gmail.com", "date": "2018-09-29T17:34:35Z"}, "message": "avoid infinite loop in MIR lowering", "tree": {"sha": "e4973bd00db16d5289793cd3b7ec3621bdc32ca9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4973bd00db16d5289793cd3b7ec3621bdc32ca9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8", "html_url": "https://github.com/rust-lang/rust/commit/4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "KiChjang", "id": 3248587, "node_id": "MDQ6VXNlcjMyNDg1ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3248587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KiChjang", "html_url": "https://github.com/KiChjang", "followers_url": "https://api.github.com/users/KiChjang/followers", "following_url": "https://api.github.com/users/KiChjang/following{/other_user}", "gists_url": "https://api.github.com/users/KiChjang/gists{/gist_id}", "starred_url": "https://api.github.com/users/KiChjang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KiChjang/subscriptions", "organizations_url": "https://api.github.com/users/KiChjang/orgs", "repos_url": "https://api.github.com/users/KiChjang/repos", "events_url": "https://api.github.com/users/KiChjang/events{/privacy}", "received_events_url": "https://api.github.com/users/KiChjang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fba9d14779552c665c5431f0c993c0780c00adca", "url": "https://api.github.com/repos/rust-lang/rust/commits/fba9d14779552c665c5431f0c993c0780c00adca", "html_url": "https://github.com/rust-lang/rust/commit/fba9d14779552c665c5431f0c993c0780c00adca"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "9ea3805fdc65210dbae7a0f87ede997f4afe9992", "filename": "src/librustc_mir/build/expr/into.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Finto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Finto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Finto.rs?ref=4a293a3990a0c1bf170d31d1d9bcbc79cef8a5b8", "patch": "@@ -345,7 +345,11 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n             }\n \n             // Avoid creating a temporary\n-            ExprKind::VarRef { .. } | ExprKind::SelfRef | ExprKind::StaticRef { .. } => {\n+            ExprKind::VarRef { .. } |\n+            ExprKind::SelfRef |\n+            ExprKind::StaticRef { .. } |\n+            ExprKind::PlaceTypeAscription { .. } |\n+            ExprKind::ValueTypeAscription { .. } => {\n                 debug_assert!(Category::of(&expr.kind) == Some(Category::Place));\n \n                 let place = unpack!(block = this.as_place(block, expr));\n@@ -391,11 +395,16 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n             | ExprKind::Adt { .. }\n             | ExprKind::Closure { .. }\n             | ExprKind::Literal { .. }\n-            | ExprKind::Yield { .. }\n-            | ExprKind::PlaceTypeAscription { .. }\n-            | ExprKind::ValueTypeAscription { .. } => {\n+            | ExprKind::Yield { .. } => {\n                 debug_assert!(match Category::of(&expr.kind).unwrap() {\n+                    // should be handled above\n                     Category::Rvalue(RvalueFunc::Into) => false,\n+\n+                    // must be handled above or else we get an\n+                    // infinite loop in the builder; see\n+                    // e.g. `ExprKind::VarRef` above\n+                    Category::Place => false,\n+\n                     _ => true,\n                 });\n "}]}