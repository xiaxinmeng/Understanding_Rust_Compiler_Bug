{"sha": "edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkZDlkYmNkYmJjMDIyYzNlYjc0ZmNmNzgwMGViNjc4MWMzYjNlNzY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-11-16T08:31:59Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-11-16T08:31:59Z"}, "message": "Auto merge of #45985 - arielb1:unsafe-dedup, r=eddyb\n\ncheck_unsafety: fix unused unsafe block duplication\n\nThe duplicate error message is later removed by error message\ndeduplication, but it still appears on beta and is still a bug.\n\nr? @eddyb", "tree": {"sha": "acc9c18757be25ee469676b77fe7df726629efe6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/acc9c18757be25ee469676b77fe7df726629efe6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76", "html_url": "https://github.com/rust-lang/rust/commit/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1410d5604042b739f02f9ec0f2a6c5125c797d52", "url": "https://api.github.com/repos/rust-lang/rust/commits/1410d5604042b739f02f9ec0f2a6c5125c797d52", "html_url": "https://github.com/rust-lang/rust/commit/1410d5604042b739f02f9ec0f2a6c5125c797d52"}, {"sha": "c0f7cce96e1bf2122ce00afb735a9feb493638ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0f7cce96e1bf2122ce00afb735a9feb493638ca", "html_url": "https://github.com/rust-lang/rust/commit/c0f7cce96e1bf2122ce00afb735a9feb493638ca"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "7a3cb6f312b9eeb9cf69e6415d6d2efc710dbba7", "filename": "src/librustc_mir/transform/check_unsafety.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76/src%2Flibrustc_mir%2Ftransform%2Fcheck_unsafety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76/src%2Flibrustc_mir%2Ftransform%2Fcheck_unsafety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_unsafety.rs?ref=edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76", "patch": "@@ -127,7 +127,6 @@ impl<'a, 'tcx> Visitor<'tcx> for UnsafetyChecker<'a, 'tcx> {\n                     let UnsafetyCheckResult {\n                         violations, unsafe_blocks\n                     } = self.tcx.unsafety_check_result(def_id);\n-                    self.inherited_blocks.extend(unsafe_blocks.iter().cloned());\n                     self.register_violations(&violations, &unsafe_blocks);\n                 }\n             }"}, {"sha": "be6b1e30a59da48015c8abdee5c22b2d47bdef32", "filename": "src/test/ui/issue-45107-unnecessary-unsafe-in-closure.stderr", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76/src%2Ftest%2Fui%2Fissue-45107-unnecessary-unsafe-in-closure.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76/src%2Ftest%2Fui%2Fissue-45107-unnecessary-unsafe-in-closure.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-45107-unnecessary-unsafe-in-closure.stderr?ref=edd9dbcdbbc022c3eb74fcf7800eb6781c3b3e76", "patch": "@@ -36,15 +36,16 @@ error: unnecessary `unsafe` block\n    | |_________________^ unnecessary `unsafe` block\n    |\n note: because it's nested under this `unsafe` block\n-  --> $DIR/issue-45107-unnecessary-unsafe-in-closure.rs:17:13\n+  --> $DIR/issue-45107-unnecessary-unsafe-in-closure.rs:15:5\n    |\n-17 | /             unsafe {\n+15 | /     unsafe {\n+16 | |         let f = |v: &mut Vec<_>| {\n+17 | |             unsafe {\n 18 | |                 v.set_len(24);\n-19 | |                 |w: &mut Vec<u32>| { unsafe {\n-20 | |                     w.set_len(32);\n-21 | |                 } };\n-22 | |             }\n-   | |_____________^\n+...  |\n+29 | |         f(&mut v);\n+30 | |     }\n+   | |_____^\n \n error: unnecessary `unsafe` block\n   --> $DIR/issue-45107-unnecessary-unsafe-in-closure.rs:23:34\n@@ -67,5 +68,5 @@ note: because it's nested under this `unsafe` block\n 30 | |     }\n    | |_____^\n \n-error: aborting due to 6 previous errors\n+error: aborting due to 3 previous errors\n "}]}