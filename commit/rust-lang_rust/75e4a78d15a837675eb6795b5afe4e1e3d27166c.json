{"sha": "75e4a78d15a837675eb6795b5afe4e1e3d27166c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1ZTRhNzhkMTVhODM3Njc1ZWI2Nzk1YjVhZmU0ZTFlM2QyNzE2NmM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-27T21:20:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-27T21:20:11Z"}, "message": "Auto merge of #26216 - azerupi:doc-experiments, r=steveklabnik\n\nSo I have tried to improve the rustbook engine:\r\n\r\n- The sidebar now looks a lot more like gitbook (I thinks it cleaner)\r\n- Added the Open Sans font, in my opinion more readable for prolonged periods of time\r\n- Changed the style for code blocks a little\r\n\r\nI encountered 1 problem. In `build.rs` I added this google font url (I commented out the non-relevant parts for clarity) \r\n\r\n```rust\r\nlet rustdoc_args: &[String] = &[\r\n    //\"\".to_string(),\r\n    //preprocessed_path.display().to_string(),\r\n    //format!(\"-o{}\", out_path.display()),\r\n    //format!(\"--html-before-content={}\", prelude.display()),\r\n    //format!(\"--html-after-content={}\", postlude.display()),\r\n    //format!(\"--markdown-playground-url=http://play.rust-lang.org\"),\r\n    //format!(\"--markdown-css={}\", item.path_to_root.join(\"rust-book.css\").display()),\r\n    format!(\"--markdown-css=http://fonts.googleapis.com/css?family&#61;Open+Sans:400italic,700italic,400,700\"),\r\n    //\"--markdown-no-toc\".to_string(),\r\n];\r\n``` \r\nAs you can see, I had to escape `=` with `&#61;` because the string would get truncated if I didn't. Is that normal behaviour? Is that for security measures? If it is, isn't it a little weak if you can circumvent it by escaped characters? I don't know the reason behind, but I thought it was at least worth mentioning :)\r\n\r\nTake your time for this PR, I still want to add multiple improvements:\r\n\r\n- Like gitbook, possibility to change font by user\r\n- Put `css` and `js` in their respective files (not hardcoded in rust)\r\n- button to hide sidebar\r\n- ...\r\n\r\nSo I'm not in a hurry to get this merged ;) But if you think it's good enough to be merged, go ahead. I will make another PR when I have other improvements.\r\n\r\nIn the image below is a screen of the improvements\r\n\r\n![rustbook](https://cloud.githubusercontent.com/assets/7647338/8105345/bf545c74-1038-11e5-962e-b04ebfaf8257.png)", "tree": {"sha": "ef9d732963978c49af8e5ab6815f2e4da103226b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef9d732963978c49af8e5ab6815f2e4da103226b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75e4a78d15a837675eb6795b5afe4e1e3d27166c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75e4a78d15a837675eb6795b5afe4e1e3d27166c", "html_url": "https://github.com/rust-lang/rust/commit/75e4a78d15a837675eb6795b5afe4e1e3d27166c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75e4a78d15a837675eb6795b5afe4e1e3d27166c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3e6b03c2d87a1f54bfde2ea82b1f85aa4df04909", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e6b03c2d87a1f54bfde2ea82b1f85aa4df04909", "html_url": "https://github.com/rust-lang/rust/commit/3e6b03c2d87a1f54bfde2ea82b1f85aa4df04909"}, {"sha": "f6e9240a99e86d2c799dc29f179dd2870e51f71d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6e9240a99e86d2c799dc29f179dd2870e51f71d", "html_url": "https://github.com/rust-lang/rust/commit/f6e9240a99e86d2c799dc29f179dd2870e51f71d"}], "stats": {"total": 225, "additions": 135, "deletions": 90}, "files": [{"sha": "3ac71c167cd0e53db464ee0366015ba1eaae5ca0", "filename": "src/rustbook/build.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustbook%2Fbuild.rs?ref=75e4a78d15a837675eb6795b5afe4e1e3d27166c", "patch": "@@ -22,7 +22,7 @@ use term::Term;\n use error::{err, CliResult, CommandResult};\n use book;\n use book::{Book, BookItem};\n-use css;\n+\n use javascript;\n \n use rustdoc;\n@@ -195,9 +195,16 @@ impl Subcommand for Build {\n         }\n         try!(fs::create_dir(&tgt));\n \n-        try!(File::create(&tgt.join(\"rust-book.css\")).and_then(|mut f| {\n-            f.write_all(css::STYLE.as_bytes())\n-        }));\n+        // Copy static files\n+        let css = include_bytes!(\"static/rustbook.css\");\n+        let js = include_bytes!(\"static/rustbook.js\");\n+\n+        let mut css_file = try!(File::create(tgt.join(\"rust-book.css\")));\n+        try!(css_file.write_all(css));\n+\n+        let mut js_file = try!(File::create(tgt.join(\"rust-book.js\")));\n+        try!(js_file.write_all(js));\n+\n \n         let mut summary = try!(File::open(&src.join(\"SUMMARY.md\")));\n         match book::parse_summary(&mut summary, &src) {"}, {"sha": "beddc23fe2bdd2a82e6c586118121ad4494b3fd4", "filename": "src/rustbook/javascript.rs", "status": "modified", "additions": 1, "deletions": 62, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fjavascript.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fjavascript.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustbook%2Fjavascript.rs?ref=75e4a78d15a837675eb6795b5afe4e1e3d27166c", "patch": "@@ -11,67 +11,6 @@\n // The rust-book JavaScript in string form.\n \n pub static JAVASCRIPT: &'static str = r#\"\n-<script type=\"text/javascript\">\n-document.addEventListener(\"DOMContentLoaded\", function(event) {\n-  document.getElementById(\"toggle-nav\").onclick = toggleNav;\n-  function toggleNav() {\n-    var toc = document.getElementById(\"toc\");\n-    var pagewrapper = document.getElementById(\"page-wrapper\");\n-    toggleClass(toc, \"mobile-hidden\");\n-    toggleClass(pagewrapper, \"mobile-hidden\");\n-  };\n-\n-  function toggleClass(el, className) {\n-     // from http://youmightnotneedjquery.com/\n-     if (el.classList) {\n-       el.classList.toggle(className);\n-     } else {\n-       var classes = el.className.split(' ');\n-       var existingIndex = classes.indexOf(className);\n-\n-       if (existingIndex >= 0) {\n-         classes.splice(existingIndex, 1);\n-       } else {\n-         classes.push(className);\n-       }\n-\n-       el.className = classes.join(' ');\n-     }\n-  }\n-\n-  // The below code is used to add prev and next navigation links to the bottom\n-  // of each of the sections.\n-  // It works by extracting the current page based on the url and iterates over\n-  // the menu links until it finds the menu item for the current page. We then\n-  // create a copy of the preceding and following menu links and add the\n-  // correct css class and insert them into the bottom of the page.\n-  var toc = document.getElementById('toc').getElementsByTagName('a');\n-  var href = document.location.pathname.split('/').pop();\n-  if (href === 'index.html' || href === '') {\n-    href = 'README.html';\n-  }\n-\n-  for (var i = 0; i < toc.length; i++) {\n-    if (toc[i].attributes['href'].value.split('/').pop() === href) {\n-      var nav = document.createElement('p');\n-      if (i > 0) {\n-        var prevNode = toc[i-1].cloneNode(true);\n-        prevNode.className = 'left';\n-        prevNode.setAttribute('rel', 'prev');\n-        nav.appendChild(prevNode);\n-      }\n-      if (i < toc.length - 1) {\n-        var nextNode = toc[i+1].cloneNode(true);\n-        nextNode.className = 'right';\n-        nextNode.setAttribute('rel', 'next');\n-        nav.appendChild(nextNode);\n-      }\n-      document.getElementById('page').appendChild(nav);\n-      break;\n-    }\n-  }\n-\n-});\n-</script>\n+<script type=\"text/javascript\" src=\"rust-book.js\"></script>\n <script type=\"text/javascript\" src=\"playpen.js\"></script>\n \"#;"}, {"sha": "81f8c8c40fdff7a23c220e54f320793aaae327d4", "filename": "src/rustbook/main.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustbook%2Fmain.rs?ref=75e4a78d15a837675eb6795b5afe4e1e3d27166c", "patch": "@@ -35,7 +35,6 @@ mod build;\n mod serve;\n mod test;\n \n-mod css;\n mod javascript;\n \n static EXIT_STATUS: AtomicIsize = ATOMIC_ISIZE_INIT;"}, {"sha": "3e0537c5551f66d406f1616ac5fca22eff883085", "filename": "src/rustbook/static/rustbook.css", "status": "renamed", "additions": 50, "deletions": 23, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fstatic%2Frustbook.css", "raw_url": "https://github.com/rust-lang/rust/raw/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fstatic%2Frustbook.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustbook%2Fstatic%2Frustbook.css?ref=75e4a78d15a837675eb6795b5afe4e1e3d27166c", "patch": "@@ -1,20 +1,28 @@\n-// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-// The rust-book CSS in string form.\n-\n-pub static STYLE: &'static str = r#\"\n+/**\n+ * Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+ * file at the top-level directory of this distribution and at\n+ * http://rust-lang.org/COPYRIGHT.\n+ *\n+ * Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+ * http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+ * <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+ * option. This file may not be copied, modified, or distributed\n+ * except according to those terms.\n+ */\n+\n @import url(\"../rust.css\");\n \n body {\n     max-width:none;\n+    font: 16px/1.4 'Source Serif Pro', Georgia, Times, 'Times New Roman', serif;\n+    line-height: 1.6;\n+    color: #333;\n+}\n+\n+h1, h2, h3, h4, h5, h6 {\n+    font-family: 'Open Sans', 'Fira Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;\n+    font-weight: bold;\n+    color: #333;\n }\n \n @media only screen {\n@@ -23,20 +31,21 @@ body {\n         left: 0px;\n         top: 0px;\n         bottom: 0px;\n-        width: 250px;\n+        width: 300px;\n         overflow-y: auto;\n         border-right: 1px solid rgba(0, 0, 0, 0.07);\n         padding: 10px 10px;\n-        font-size: 16px;\n-        background: none repeat scroll 0% 0% #FFF;\n+        font-size: 14px;\n         box-sizing: border-box;\n         -webkit-overflow-scrolling: touch;\n+        background-color: #fafafa;\n+        color: #364149;\n     }\n \n     #page-wrapper {\n         position: absolute;\n         overflow-y: auto;\n-        left: 260px;\n+        left: 310px;\n         right: 0px;\n         top: 0px;\n         bottom: 0px;\n@@ -47,7 +56,7 @@ body {\n }\n \n @media only print {\n-    #toc, #nav {\n+    #toc, #nav, #menu-bar {\n         display: none;\n     }\n }\n@@ -84,7 +93,7 @@ body {\n .section {\n     list-style: none outside none;\n     padding-left: 20px;\n-    line-height: 30px;\n+    line-height: 40px;\n }\n \n .section li {\n@@ -94,12 +103,17 @@ body {\n }\n \n .chapter li a {\n-    color: #000000;\n+    color: #333;\n+    padding: 5px 0;\n }\n \n .chapter li a.active {\n-    text-decoration: underline;\n-    font-weight: bold;\n+    color: #008cff;\n+}\n+\n+.chapter li a:hover {\n+    color: #008cff;\n+    text-decoration: none;\n }\n \n #toggle-nav {\n@@ -138,11 +152,24 @@ body {\n     padding: 0;\n }\n \n+pre {\n+    padding: 16px;\n+    overflow: auto;\n+    font-size: 85%;\n+    line-height: 1.45;\n+    background-color: #f7f7f7;\n+    border: 0;\n+    border-radius: 3px;\n+}\n+\n+.nav-previous-next {\n+    margin-top: 60px;\n+}\n+\n .left {\n     float: left;\n }\n \n .right {\n     float: right;\n }\n-\"#;", "previous_filename": "src/rustbook/css.rs"}, {"sha": "fdefab2875926be6c7908f4377c71cbee5bbe7a0", "filename": "src/rustbook/static/rustbook.js", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fstatic%2Frustbook.js", "raw_url": "https://github.com/rust-lang/rust/raw/75e4a78d15a837675eb6795b5afe4e1e3d27166c/src%2Frustbook%2Fstatic%2Frustbook.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustbook%2Fstatic%2Frustbook.js?ref=75e4a78d15a837675eb6795b5afe4e1e3d27166c", "patch": "@@ -0,0 +1,73 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+\n+document.addEventListener(\"DOMContentLoaded\", function(event) {\n+\n+  document.getElementById(\"toggle-nav\").onclick = toggleNav;\n+\n+  function toggleNav() {\n+    var toc = document.getElementById(\"toc\");\n+    var pagewrapper = document.getElementById(\"page-wrapper\");\n+    toggleClass(toc, \"mobile-hidden\");\n+    toggleClass(pagewrapper, \"mobile-hidden\");\n+  }\n+\n+  function toggleClass(el, className) {\n+     // from http://youmightnotneedjquery.com/\n+     if (el.classList) {\n+       el.classList.toggle(className);\n+     } else {\n+       var classes = el.className.split(' ');\n+       var existingIndex = classes.indexOf(className);\n+\n+       if (existingIndex >= 0) {\n+         classes.splice(existingIndex, 1);\n+       } else {\n+         classes.push(className);\n+       }\n+\n+       el.className = classes.join(' ');\n+     }\n+  }\n+\n+  // The below code is used to add prev and next navigation links to the bottom\n+  // of each of the sections.\n+  // It works by extracting the current page based on the url and iterates over\n+  // the menu links until it finds the menu item for the current page. We then\n+  // create a copy of the preceding and following menu links and add the\n+  // correct css class and insert them into the bottom of the page.\n+  var toc = document.getElementById('toc').getElementsByTagName('a');\n+  var href = document.location.pathname.split('/').pop();\n+  if (href === 'index.html' || href === '') {\n+    href = 'README.html';\n+  }\n+\n+  for (var i = 0; i < toc.length; i++) {\n+    if (toc[i].attributes.href.value.split('/').pop() === href) {\n+      var nav = document.createElement('p');\n+      if (i > 0) {\n+        var prevNode = toc[i-1].cloneNode(true);\n+        prevNode.className = 'left';\n+        prevNode.setAttribute('rel', 'prev');\n+        nav.appendChild(prevNode);\n+      }\n+      if (i < toc.length - 1) {\n+        var nextNode = toc[i+1].cloneNode(true);\n+        nextNode.className = 'right';\n+        nextNode.setAttribute('rel', 'next');\n+        nav.appendChild(nextNode);\n+      }\n+      document.getElementById('page').appendChild(nav);\n+      break;\n+    }\n+  }\n+\n+});"}]}