{"sha": "b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI4YWU0YzVlMzZkNWNlMzZiZjI1NWRiYWE2NmY2NDQ1MGIyMWVmYTU=", "commit": {"author": {"name": "Antoine Martin", "email": "antoine97.martin@gmail.com", "date": "2020-10-13T15:58:56Z"}, "committer": {"name": "Antoine Martin", "email": "antoine97.martin@gmail.com", "date": "2020-10-13T16:08:02Z"}, "message": "Handle included config in bootstrap.py", "tree": {"sha": "fe2cfe37782a8b4430a895c5dc2ae6cd1733ffbc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe2cfe37782a8b4430a895c5dc2ae6cd1733ffbc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5", "html_url": "https://github.com/rust-lang/rust/commit/b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5/comments", "author": {"login": "alarsyo", "id": 15170378, "node_id": "MDQ6VXNlcjE1MTcwMzc4", "avatar_url": "https://avatars.githubusercontent.com/u/15170378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alarsyo", "html_url": "https://github.com/alarsyo", "followers_url": "https://api.github.com/users/alarsyo/followers", "following_url": "https://api.github.com/users/alarsyo/following{/other_user}", "gists_url": "https://api.github.com/users/alarsyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/alarsyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alarsyo/subscriptions", "organizations_url": "https://api.github.com/users/alarsyo/orgs", "repos_url": "https://api.github.com/users/alarsyo/repos", "events_url": "https://api.github.com/users/alarsyo/events{/privacy}", "received_events_url": "https://api.github.com/users/alarsyo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alarsyo", "id": 15170378, "node_id": "MDQ6VXNlcjE1MTcwMzc4", "avatar_url": "https://avatars.githubusercontent.com/u/15170378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alarsyo", "html_url": "https://github.com/alarsyo", "followers_url": "https://api.github.com/users/alarsyo/followers", "following_url": "https://api.github.com/users/alarsyo/following{/other_user}", "gists_url": "https://api.github.com/users/alarsyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/alarsyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alarsyo/subscriptions", "organizations_url": "https://api.github.com/users/alarsyo/orgs", "repos_url": "https://api.github.com/users/alarsyo/repos", "events_url": "https://api.github.com/users/alarsyo/events{/privacy}", "received_events_url": "https://api.github.com/users/alarsyo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ab614b0f010e68b74b8f8a6ce26d53302fb4f14a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab614b0f010e68b74b8f8a6ce26d53302fb4f14a", "html_url": "https://github.com/rust-lang/rust/commit/ab614b0f010e68b74b8f8a6ce26d53302fb4f14a"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "ce37adeb28c93383ada9571ae9d72a8dba1c6732", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=b8ae4c5e36d5ce36bf255dbaa66f64450b21efa5", "patch": "@@ -1004,6 +1004,16 @@ def bootstrap(help_triggered):\n         with open(toml_path) as config:\n             build.config_toml = config.read()\n \n+    profile = build.get_toml('profile')\n+    if profile is not None:\n+        include_file = 'config.{}.toml'.format(profile)\n+        include_dir = os.path.join(build.rust_root, 'src', 'bootstrap', 'defaults')\n+        include_path = os.path.join(include_dir, include_file)\n+        # HACK: This works because `build.get_toml()` returns the first match it finds for a\n+        # specific key, so appending our defaults at the end allows the user to override them\n+        with open(include_path) as included_toml:\n+            build.config_toml += os.linesep + included_toml.read()\n+\n     config_verbose = build.get_toml('verbose', 'build')\n     if config_verbose is not None:\n         build.verbose = max(build.verbose, int(config_verbose))"}]}