{"sha": "b1719530f44e3c8ec903f76020a52bd8764d5d10", "node_id": "C_kwDOAAsO6NoAKGIxNzE5NTMwZjQ0ZTNjOGVjOTAzZjc2MDIwYTUyYmQ4NzY0ZDVkMTA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-04T15:10:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-04T15:10:04Z"}, "message": "Auto merge of #108692 - nnethercote:dont-call-temporary_scope-twice, r=cjgillot\n\nDon't call `temporary_scope` twice.\n\n`mirror_expr_inner` calls `temporary_scope`. It then calls `make_mirror_unadjusted` which makes an identical call to `temporary_scope`.\n\nThis commit changes the `mirror_expr_inner` to get the `temp_lifetime` out of the expression produced by `make_mirror_unadjusted`, similar to how it currently gets the type.\n\nr? `@cjgillot`", "tree": {"sha": "50d45b3536f52f037a0defb5f82664d13c8cacd8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/50d45b3536f52f037a0defb5f82664d13c8cacd8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b1719530f44e3c8ec903f76020a52bd8764d5d10", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b1719530f44e3c8ec903f76020a52bd8764d5d10", "html_url": "https://github.com/rust-lang/rust/commit/b1719530f44e3c8ec903f76020a52bd8764d5d10", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b1719530f44e3c8ec903f76020a52bd8764d5d10/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "276b75a843af8822ffe4e395266d9445679a57a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/276b75a843af8822ffe4e395266d9445679a57a4", "html_url": "https://github.com/rust-lang/rust/commit/276b75a843af8822ffe4e395266d9445679a57a4"}, {"sha": "6b9c4125a589fb9a6eb30e5ec9a66734d571ab86", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86", "html_url": "https://github.com/rust-lang/rust/commit/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86"}], "stats": {"total": 6, "additions": 2, "deletions": 4}, "files": [{"sha": "9086412c09a1cc34935f6192be9ce90628edfe69", "filename": "compiler/rustc_mir_build/src/thir/cx/expr.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b1719530f44e3c8ec903f76020a52bd8764d5d10/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1719530f44e3c8ec903f76020a52bd8764d5d10/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs?ref=b1719530f44e3c8ec903f76020a52bd8764d5d10", "patch": "@@ -34,8 +34,6 @@ impl<'tcx> Cx<'tcx> {\n \n     #[instrument(level = \"trace\", skip(self, hir_expr))]\n     pub(super) fn mirror_expr_inner(&mut self, hir_expr: &'tcx hir::Expr<'tcx>) -> ExprId {\n-        let temp_lifetime =\n-            self.rvalue_scopes.temporary_scope(self.region_scope_tree, hir_expr.hir_id.local_id);\n         let expr_scope =\n             region::Scope { id: hir_expr.hir_id.local_id, data: region::ScopeData::Node };\n \n@@ -68,7 +66,7 @@ impl<'tcx> Cx<'tcx> {\n \n         // Next, wrap this up in the expr's scope.\n         expr = Expr {\n-            temp_lifetime,\n+            temp_lifetime: expr.temp_lifetime,\n             ty: expr.ty,\n             span: hir_expr.span,\n             kind: ExprKind::Scope {\n@@ -83,7 +81,7 @@ impl<'tcx> Cx<'tcx> {\n             self.region_scope_tree.opt_destruction_scope(hir_expr.hir_id.local_id)\n         {\n             expr = Expr {\n-                temp_lifetime,\n+                temp_lifetime: expr.temp_lifetime,\n                 ty: expr.ty,\n                 span: hir_expr.span,\n                 kind: ExprKind::Scope {"}]}