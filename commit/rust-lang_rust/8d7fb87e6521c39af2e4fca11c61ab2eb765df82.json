{"sha": "8d7fb87e6521c39af2e4fca11c61ab2eb765df82", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkN2ZiODdlNjUyMWMzOWFmMmU0ZmNhMTFjNjFhYjJlYjc2NWRmODI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-07-29T17:37:36Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-07-29T17:53:47Z"}, "message": "std: Fix a failing `fs` test on Windows\n\nIn testing 4-core machines on Azure the `realpath_works_tricky` test in\nthe standard library is failing with \"The directory name is invalid\". In\nattempting to debug this test I was able to reproduce the failure\nlocally on my machine, and after inspecing the test it I believe is\nexploiting Unix-specific behavior that seems to only sometimes work on\nWindows. Specifically the test basically executes:\n\n    mkdir -p a/b\n    mkdir -p a/d\n    touch a/f\n    ln -s a/b/c ../d/e\n    ln -s a/d/e ../f\n\nand then asserts that `canonicalize(\"a/b/c\")` and\n`canonicalize(\"a/d/e\")` are equivalent to `a/f`. On Windows however the\nfirst symlink is a \"directory symlink\" and the second is a file symlink.\nIn both cases, though, they're pointing to files. This means that for\nwhatever reason locally and on the 4-core environment the call to\n`canonicalize` is failing. On Azure today it seems to be passing, and\nI'm not entirely sure why. I'm sort of presuming that there's some sort\nof internals going on here where there's some global Windows setting\nwhich makes symlinks behavior more unix-like and ignore the directory\nhint.\n\nIn any case this should keep the test working and also fixes the test\nlocally for me.", "tree": {"sha": "3031e4e207599be644c716a35a932ee713255edd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3031e4e207599be644c716a35a932ee713255edd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8d7fb87e6521c39af2e4fca11c61ab2eb765df82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8d7fb87e6521c39af2e4fca11c61ab2eb765df82", "html_url": "https://github.com/rust-lang/rust/commit/8d7fb87e6521c39af2e4fca11c61ab2eb765df82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8d7fb87e6521c39af2e4fca11c61ab2eb765df82/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04b88a9eba8abbac87eddcb2998beea09589c2c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/04b88a9eba8abbac87eddcb2998beea09589c2c9", "html_url": "https://github.com/rust-lang/rust/commit/04b88a9eba8abbac87eddcb2998beea09589c2c9"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "f7c32a5c20d3d0aacd8562170fc7a8749806730f", "filename": "src/libstd/fs.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8d7fb87e6521c39af2e4fca11c61ab2eb765df82/src%2Flibstd%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d7fb87e6521c39af2e4fca11c61ab2eb765df82/src%2Flibstd%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ffs.rs?ref=8d7fb87e6521c39af2e4fca11c61ab2eb765df82", "patch": "@@ -3316,11 +3316,11 @@ mod tests {\n         fs::create_dir_all(&d).unwrap();\n         File::create(&f).unwrap();\n         if cfg!(not(windows)) {\n-            symlink_dir(\"../d/e\", &c).unwrap();\n+            symlink_file(\"../d/e\", &c).unwrap();\n             symlink_file(\"../f\", &e).unwrap();\n         }\n         if cfg!(windows) {\n-            symlink_dir(r\"..\\d\\e\", &c).unwrap();\n+            symlink_file(r\"..\\d\\e\", &c).unwrap();\n             symlink_file(r\"..\\f\", &e).unwrap();\n         }\n "}]}