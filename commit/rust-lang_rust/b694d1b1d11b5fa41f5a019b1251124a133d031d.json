{"sha": "b694d1b1d11b5fa41f5a019b1251124a133d031d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2OTRkMWIxZDExYjVmYTQxZjVhMDE5YjEyNTExMjRhMTMzZDAzMWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-01-27T01:30:28Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-01-27T01:30:28Z"}, "message": "Auto merge of #30487 - jonas-schievink:more-attrs-lint-fixes, r=alexcrichton\n\n`LateContext` already does this, looks like this was just forgotten in #29850.\n\nFound while investigating #30326 (but doesn't fix it)", "tree": {"sha": "ec86ff617dd15371d0bb75f27be4e36742515ecb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ec86ff617dd15371d0bb75f27be4e36742515ecb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b694d1b1d11b5fa41f5a019b1251124a133d031d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b694d1b1d11b5fa41f5a019b1251124a133d031d", "html_url": "https://github.com/rust-lang/rust/commit/b694d1b1d11b5fa41f5a019b1251124a133d031d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b694d1b1d11b5fa41f5a019b1251124a133d031d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b615854f00ba17ad704155e1d3196c17a6edb62", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b615854f00ba17ad704155e1d3196c17a6edb62", "html_url": "https://github.com/rust-lang/rust/commit/4b615854f00ba17ad704155e1d3196c17a6edb62"}, {"sha": "5133b2619e07b8d79f8894dbb9c3e47184037ce2", "url": "https://api.github.com/repos/rust-lang/rust/commits/5133b2619e07b8d79f8894dbb9c3e47184037ce2", "html_url": "https://github.com/rust-lang/rust/commit/5133b2619e07b8d79f8894dbb9c3e47184037ce2"}], "stats": {"total": 36, "additions": 31, "deletions": 5}, "files": [{"sha": "55782041be68712aa804847461db3f0400572064", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b694d1b1d11b5fa41f5a019b1251124a133d031d/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b694d1b1d11b5fa41f5a019b1251124a133d031d/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=b694d1b1d11b5fa41f5a019b1251124a133d031d", "patch": "@@ -735,7 +735,7 @@ impl<'a> LintContext for EarlyContext<'a> {\n     }\n \n     fn enter_attrs(&mut self, attrs: &[ast::Attribute]) {\n-        debug!(\"early context: exit_attrs({:?})\", attrs);\n+        debug!(\"early context: enter_attrs({:?})\", attrs);\n         run_lints!(self, enter_lint_attrs, early_passes, attrs);\n     }\n \n@@ -934,8 +934,10 @@ impl<'a, 'v> ast_visit::Visitor<'v> for EarlyContext<'a> {\n     }\n \n     fn visit_expr(&mut self, e: &ast::Expr) {\n-        run_lints!(self, check_expr, early_passes, e);\n-        ast_visit::walk_expr(self, e);\n+        self.with_lint_attrs(e.attrs.as_attr_slice(), |cx| {\n+            run_lints!(cx, check_expr, early_passes, e);\n+            ast_visit::walk_expr(cx, e);\n+        })\n     }\n \n     fn visit_stmt(&mut self, s: &ast::Stmt) {\n@@ -990,8 +992,10 @@ impl<'a, 'v> ast_visit::Visitor<'v> for EarlyContext<'a> {\n     }\n \n     fn visit_local(&mut self, l: &ast::Local) {\n-        run_lints!(self, check_local, early_passes, l);\n-        ast_visit::walk_local(self, l);\n+        self.with_lint_attrs(l.attrs.as_attr_slice(), |cx| {\n+            run_lints!(cx, check_local, early_passes, l);\n+            ast_visit::walk_local(cx, l);\n+        })\n     }\n \n     fn visit_block(&mut self, b: &ast::Block) {"}, {"sha": "16c7176a68db46034057b16a6260ce89917a8bc1", "filename": "src/test/run-pass/lint-expr-stmt-attrs-for-early-lints.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/b694d1b1d11b5fa41f5a019b1251124a133d031d/src%2Ftest%2Frun-pass%2Flint-expr-stmt-attrs-for-early-lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b694d1b1d11b5fa41f5a019b1251124a133d031d/src%2Ftest%2Frun-pass%2Flint-expr-stmt-attrs-for-early-lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flint-expr-stmt-attrs-for-early-lints.rs?ref=b694d1b1d11b5fa41f5a019b1251124a133d031d", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(stmt_expr_attributes)]\n+#![deny(unused_parens)]\n+\n+// Tests that lint attributes on statements/expressions are\n+// correctly applied to non-builtin early (AST) lints\n+\n+fn main() {\n+    #[allow(unused_parens)]\n+    {\n+        let _ = (9);\n+    }\n+}"}]}