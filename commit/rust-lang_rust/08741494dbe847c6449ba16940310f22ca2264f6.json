{"sha": "08741494dbe847c6449ba16940310f22ca2264f6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4NzQxNDk0ZGJlODQ3YzY0NDliYTE2OTQwMzEwZjIyY2EyMjY0ZjY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-20T19:16:35Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-20T20:59:03Z"}, "message": "Rollup merge of #38388 - redox-os:config_toml_prefix, r=alexcrichton\n\nAdd prefix to config.toml\n\nThis allows `rustbuild` to be used to install to a prefix.\n```toml\n[build]\nprefix = \"/path/to/install\"\n```\nFor example, the following `config.toml` will cause `x.py dist --install` to install to `/path/to/install`", "tree": {"sha": "1899041170d55d86ef0b01b29990133dd264e55c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1899041170d55d86ef0b01b29990133dd264e55c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/08741494dbe847c6449ba16940310f22ca2264f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/08741494dbe847c6449ba16940310f22ca2264f6", "html_url": "https://github.com/rust-lang/rust/commit/08741494dbe847c6449ba16940310f22ca2264f6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/08741494dbe847c6449ba16940310f22ca2264f6/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "adfafffce8fda1c91c302a979bed7c71d3cb15aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/adfafffce8fda1c91c302a979bed7c71d3cb15aa", "html_url": "https://github.com/rust-lang/rust/commit/adfafffce8fda1c91c302a979bed7c71d3cb15aa"}, {"sha": "228e495e7f7fb89ca4047847a5118c5e224a0958", "url": "https://api.github.com/repos/rust-lang/rust/commits/228e495e7f7fb89ca4047847a5118c5e224a0958", "html_url": "https://github.com/rust-lang/rust/commit/228e495e7f7fb89ca4047847a5118c5e224a0958"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "6b86e537b7d22098e8e2b2e47e1a77e8a04acd2f", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/08741494dbe847c6449ba16940310f22ca2264f6/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08741494dbe847c6449ba16940310f22ca2264f6/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=08741494dbe847c6449ba16940310f22ca2264f6", "patch": "@@ -113,6 +113,7 @@ pub struct Target {\n #[derive(RustcDecodable, Default)]\n struct TomlConfig {\n     build: Option<Build>,\n+    install: Option<Install>,\n     llvm: Option<Llvm>,\n     rust: Option<Rust>,\n     target: Option<HashMap<String, TomlTarget>>,\n@@ -135,6 +136,12 @@ struct Build {\n     python: Option<String>,\n }\n \n+/// TOML representation of various global install decisions.\n+#[derive(RustcDecodable, Default, Clone)]\n+struct Install {\n+    prefix: Option<String>,\n+}\n+\n /// TOML representation of how the LLVM build is configured.\n #[derive(RustcDecodable, Default)]\n struct Llvm {\n@@ -258,6 +265,10 @@ impl Config {\n         set(&mut config.submodules, build.submodules);\n         set(&mut config.vendor, build.vendor);\n \n+        if let Some(ref install) = toml.install {\n+            config.prefix = install.prefix.clone();\n+        }\n+\n         if let Some(ref llvm) = toml.llvm {\n             match llvm.ccache {\n                 Some(StringOrBool::String(ref s)) => {\n@@ -275,6 +286,7 @@ impl Config {\n             set(&mut config.llvm_version_check, llvm.version_check);\n             set(&mut config.llvm_static_stdcpp, llvm.static_libstdcpp);\n         }\n+\n         if let Some(ref rust) = toml.rust {\n             set(&mut config.rust_debug_assertions, rust.debug_assertions);\n             set(&mut config.rust_debuginfo, rust.debuginfo);"}, {"sha": "5fc095137c793e0101d102ae64b22790ed3a29bd", "filename": "src/bootstrap/config.toml.example", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/08741494dbe847c6449ba16940310f22ca2264f6/src%2Fbootstrap%2Fconfig.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/08741494dbe847c6449ba16940310f22ca2264f6/src%2Fbootstrap%2Fconfig.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.toml.example?ref=08741494dbe847c6449ba16940310f22ca2264f6", "patch": "@@ -100,6 +100,14 @@\n # Indicate whether the vendored sources are used for Rust dependencies or not\n #vendor = false\n \n+# =============================================================================\n+# General install configuration options\n+# =============================================================================\n+[install]\n+\n+# Instead of installing to /usr/local, install to this path instead.\n+#prefix = \"/path/to/install\"\n+\n # =============================================================================\n # Options for compiling Rust code itself\n # ============================================================================="}]}