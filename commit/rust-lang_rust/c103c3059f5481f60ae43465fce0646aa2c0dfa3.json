{"sha": "c103c3059f5481f60ae43465fce0646aa2c0dfa3", "node_id": "C_kwDOAAsO6NoAKGMxMDNjMzA1OWY1NDgxZjYwYWU0MzQ2NWZjZTA2NDZhYTJjMGRmYTM", "commit": {"author": {"name": "Nathan Stocks", "email": "cleancut@github.com", "date": "2022-09-22T04:49:30Z"}, "committer": {"name": "Nathan Stocks", "email": "cleancut@github.com", "date": "2022-10-07T19:19:27Z"}, "message": "migrate the rest of weak_lang_items.rs to translateable diagnostics", "tree": {"sha": "4895cafdd8388c79a141572c4946c58d255ce2f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4895cafdd8388c79a141572c4946c58d255ce2f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c103c3059f5481f60ae43465fce0646aa2c0dfa3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c103c3059f5481f60ae43465fce0646aa2c0dfa3", "html_url": "https://github.com/rust-lang/rust/commit/c103c3059f5481f60ae43465fce0646aa2c0dfa3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c103c3059f5481f60ae43465fce0646aa2c0dfa3/comments", "author": {"login": "CleanCut", "id": 5838512, "node_id": "MDQ6VXNlcjU4Mzg1MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5838512?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CleanCut", "html_url": "https://github.com/CleanCut", "followers_url": "https://api.github.com/users/CleanCut/followers", "following_url": "https://api.github.com/users/CleanCut/following{/other_user}", "gists_url": "https://api.github.com/users/CleanCut/gists{/gist_id}", "starred_url": "https://api.github.com/users/CleanCut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CleanCut/subscriptions", "organizations_url": "https://api.github.com/users/CleanCut/orgs", "repos_url": "https://api.github.com/users/CleanCut/repos", "events_url": "https://api.github.com/users/CleanCut/events{/privacy}", "received_events_url": "https://api.github.com/users/CleanCut/received_events", "type": "User", "site_admin": true}, "committer": {"login": "CleanCut", "id": 5838512, "node_id": "MDQ6VXNlcjU4Mzg1MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5838512?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CleanCut", "html_url": "https://github.com/CleanCut", "followers_url": "https://api.github.com/users/CleanCut/followers", "following_url": "https://api.github.com/users/CleanCut/following{/other_user}", "gists_url": "https://api.github.com/users/CleanCut/gists{/gist_id}", "starred_url": "https://api.github.com/users/CleanCut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CleanCut/subscriptions", "organizations_url": "https://api.github.com/users/CleanCut/orgs", "repos_url": "https://api.github.com/users/CleanCut/repos", "events_url": "https://api.github.com/users/CleanCut/events{/privacy}", "received_events_url": "https://api.github.com/users/CleanCut/received_events", "type": "User", "site_admin": true}, "parents": [{"sha": "1222541cfd69386d0383c37042d8bbfd9f2ad0a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/1222541cfd69386d0383c37042d8bbfd9f2ad0a3", "html_url": "https://github.com/rust-lang/rust/commit/1222541cfd69386d0383c37042d8bbfd9f2ad0a3"}], "stats": {"total": 35, "additions": 15, "deletions": 20}, "files": [{"sha": "7dddc6e10b655a59c858d97ccba979021cde09b5", "filename": "compiler/rustc_error_messages/locales/en-US/passes.ftl", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c103c3059f5481f60ae43465fce0646aa2c0dfa3/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fpasses.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/c103c3059f5481f60ae43465fce0646aa2c0dfa3/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fpasses.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fpasses.ftl?ref=c103c3059f5481f60ae43465fce0646aa2c0dfa3", "patch": "@@ -358,6 +358,9 @@ passes_deprecated_annotation_has_no_effect =\n     this `#[deprecated]` annotation has no effect\n     .suggestion = remove the unnecessary deprecation attribute\n     \n+passes_unknown_external_lang_item =\n+    unknown external lang item: `{$lang_item}`\n+\n passes_missing_panic_handler =\n     `#[panic_handler]` function required, but not found\n \n@@ -384,6 +387,3 @@ passes_local_duplicate_lang_item =\n passes_invalid_attr_at_crate_level =\n     `{$name}` attribute cannot be used at crate level\n     .suggestion = perhaps you meant to use an outer attribute\n-\n-passes_deprecated_annotation_has_no_effect = this `#[deprecated]` annotation has no effect\n-    .suggestion = remove the unnecessary deprecation attribute"}, {"sha": "0fabbb206cf92174de68aeb6a69fa25e9b258821", "filename": "compiler/rustc_passes/src/errors.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c103c3059f5481f60ae43465fce0646aa2c0dfa3/compiler%2Frustc_passes%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c103c3059f5481f60ae43465fce0646aa2c0dfa3/compiler%2Frustc_passes%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Ferrors.rs?ref=c103c3059f5481f60ae43465fce0646aa2c0dfa3", "patch": "@@ -678,6 +678,14 @@ pub struct DeprecatedAnnotationHasNoEffect {\n     pub span: Span,\n }\n \n+#[derive(Diagnostic)]\n+#[diag(passes::unknown_external_lang_item, code = \"E0264\")]\n+pub struct UnknownExternLangItem {\n+    #[primary_span]\n+    pub span: Span,\n+    pub lang_item: Symbol,\n+}\n+\n #[derive(Diagnostic)]\n #[diag(passes::missing_panic_handler)]\n pub struct MissingPanicHandler;\n@@ -744,10 +752,3 @@ impl IntoDiagnostic<'_> for InvalidAttrAtCrateLevel {\n         diag\n     }\n }\n-\n-#[derive(LintDiagnostic)]\n-#[diag(passes::deprecated_annotation_has_no_effect)]\n-pub struct DeprecatedAnnotationHasNoEffect {\n-    #[suggestion(applicability = \"machine-applicable\", code = \"\")]\n-    pub span: Span,\n-}"}, {"sha": "0d2745fb5f40fd5dec7bc7f80ebc1b236e3d718a", "filename": "compiler/rustc_passes/src/weak_lang_items.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c103c3059f5481f60ae43465fce0646aa2c0dfa3/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c103c3059f5481f60ae43465fce0646aa2c0dfa3/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs?ref=c103c3059f5481f60ae43465fce0646aa2c0dfa3", "patch": "@@ -1,14 +1,15 @@\n //! Validity checking for weak lang items\n \n use rustc_data_structures::fx::FxHashSet;\n-use rustc_errors::struct_span_err;\n use rustc_hir::lang_items::{self, LangItem};\n use rustc_hir::weak_lang_items::WEAK_ITEMS_REFS;\n use rustc_middle::middle::lang_items::required;\n use rustc_middle::ty::TyCtxt;\n use rustc_session::config::CrateType;\n \n-use crate::errors::{MissingAllocErrorHandler, MissingLangItem, MissingPanicHandler};\n+use crate::errors::{\n+    MissingAllocErrorHandler, MissingLangItem, MissingPanicHandler, UnknownExternLangItem,\n+};\n \n /// Checks the crate for usage of weak lang items, returning a vector of all the\n /// language items required by this crate, but not defined yet.\n@@ -33,14 +34,7 @@ pub fn check_crate<'tcx>(tcx: TyCtxt<'tcx>, items: &mut lang_items::LanguageItem\n                 }\n             } else {\n                 let span = tcx.def_span(id.def_id);\n-                struct_span_err!(\n-                    tcx.sess,\n-                    span,\n-                    E0264,\n-                    \"unknown external lang item: `{}`\",\n-                    lang_item\n-                )\n-                .emit();\n+                tcx.sess.emit_err(UnknownExternLangItem { span, lang_item });\n             }\n         }\n     }"}]}