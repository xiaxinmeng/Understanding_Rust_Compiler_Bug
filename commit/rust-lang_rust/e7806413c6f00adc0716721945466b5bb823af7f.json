{"sha": "e7806413c6f00adc0716721945466b5bb823af7f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3ODA2NDEzYzZmMDBhZGMwNzE2NzIxOTQ1NDY2YjViYjgyM2FmN2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-03-15T06:18:28Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-03-15T06:18:28Z"}, "message": "Auto merge of #3883 - daxpedda:missing_docs_in_private_items, r=phansch\n\nAdd `doc(include = ...)` detection to `missing_docs_in_private_items`\n\nThe whole `missing documentation in crate` part doesn't have any tests. If I should add test cases tell me.", "tree": {"sha": "97c2a6ce48b6233011e99c6b46e22bdb1373a577", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/97c2a6ce48b6233011e99c6b46e22bdb1373a577"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7806413c6f00adc0716721945466b5bb823af7f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7806413c6f00adc0716721945466b5bb823af7f", "html_url": "https://github.com/rust-lang/rust/commit/e7806413c6f00adc0716721945466b5bb823af7f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7806413c6f00adc0716721945466b5bb823af7f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb41b16423d5a99f02f62a6a1340499dd4e05f70", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb41b16423d5a99f02f62a6a1340499dd4e05f70", "html_url": "https://github.com/rust-lang/rust/commit/bb41b16423d5a99f02f62a6a1340499dd4e05f70"}, {"sha": "9061fd31997a72e9ec75cdafeeae719988b16b6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/9061fd31997a72e9ec75cdafeeae719988b16b6d", "html_url": "https://github.com/rust-lang/rust/commit/9061fd31997a72e9ec75cdafeeae719988b16b6d"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "f5dab6d1feda73abebd17319c5d634f6b8f36c50", "filename": "clippy_lints/src/missing_doc.rs", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e7806413c6f00adc0716721945466b5bb823af7f/clippy_lints%2Fsrc%2Fmissing_doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7806413c6f00adc0716721945466b5bb823af7f/clippy_lints%2Fsrc%2Fmissing_doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_doc.rs?ref=e7806413c6f00adc0716721945466b5bb823af7f", "patch": "@@ -6,11 +6,12 @@\n //\n \n use crate::utils::{in_macro, span_lint};\n+use if_chain::if_chain;\n use rustc::hir;\n use rustc::lint::{LateContext, LateLintPass, LintArray, LintContext, LintPass};\n use rustc::ty;\n use rustc::{declare_tool_lint, lint_array};\n-use syntax::ast;\n+use syntax::ast::{self, MetaItem, MetaItemKind};\n use syntax::attr;\n use syntax::source_map::Span;\n \n@@ -52,6 +53,20 @@ impl MissingDoc {\n         *self.doc_hidden_stack.last().expect(\"empty doc_hidden_stack\")\n     }\n \n+    fn has_include(meta: Option<MetaItem>) -> bool {\n+        if_chain! {\n+            if let Some(meta) = meta;\n+            if let MetaItemKind::List(list) = meta.node;\n+            if let Some(meta) = list.get(0);\n+            if let Some(name) = meta.name();\n+            then {\n+                name == \"include\"\n+            } else {\n+                false\n+            }\n+        }\n+    }\n+\n     fn check_missing_docs_attrs(\n         &self,\n         cx: &LateContext<'_, '_>,\n@@ -74,7 +89,9 @@ impl MissingDoc {\n             return;\n         }\n \n-        let has_doc = attrs.iter().any(|a| a.is_value_str() && a.name() == \"doc\");\n+        let has_doc = attrs\n+            .iter()\n+            .any(|a| a.name() == \"doc\" && (a.is_value_str() || Self::has_include(a.meta())));\n         if !has_doc {\n             span_lint(\n                 cx,"}, {"sha": "51fd57df8df1da962322d50dc6edcf85726e9661", "filename": "tests/ui/missing-doc-crate-missing.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate-missing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate-missing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing-doc-crate-missing.rs?ref=e7806413c6f00adc0716721945466b5bb823af7f", "patch": "@@ -0,0 +1,3 @@\n+#![warn(clippy::missing_docs_in_private_items)]\n+\n+fn main() {}"}, {"sha": "da46f9886366c821f2f5feb90555f90e728be166", "filename": "tests/ui/missing-doc-crate-missing.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate-missing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate-missing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing-doc-crate-missing.stderr?ref=e7806413c6f00adc0716721945466b5bb823af7f", "patch": "@@ -0,0 +1,12 @@\n+error: missing documentation for crate\n+  --> $DIR/missing-doc-crate-missing.rs:1:1\n+   |\n+LL | / #![warn(clippy::missing_docs_in_private_items)]\n+LL | |\n+LL | | fn main() {}\n+   | |____________^\n+   |\n+   = note: `-D clippy::missing-docs-in-private-items` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}, {"sha": "04711f864886b06aab41b07bef741e9a2e84271d", "filename": "tests/ui/missing-doc-crate.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing-doc-crate.rs?ref=e7806413c6f00adc0716721945466b5bb823af7f", "patch": "@@ -0,0 +1,5 @@\n+#![warn(clippy::missing_docs_in_private_items)]\n+#![feature(external_doc)]\n+#![doc(include = \"../../README.md\")]\n+\n+fn main() {}"}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "tests/ui/missing-doc-crate.stderr", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e7806413c6f00adc0716721945466b5bb823af7f/tests%2Fui%2Fmissing-doc-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing-doc-crate.stderr?ref=e7806413c6f00adc0716721945466b5bb823af7f"}]}