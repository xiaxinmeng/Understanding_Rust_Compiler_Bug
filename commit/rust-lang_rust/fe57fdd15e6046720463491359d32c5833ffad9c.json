{"sha": "fe57fdd15e6046720463491359d32c5833ffad9c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlNTdmZGQxNWU2MDQ2NzIwNDYzNDkxMzU5ZDMyYzU4MzNmZmFkOWM=", "commit": {"author": {"name": "Beno\u00eet CORTIER", "email": "benoit.cortier@fried-world.eu", "date": "2017-07-01T10:02:00Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2017-08-21T12:00:59Z"}, "message": "Improve needless_borrowed_ref and update its stderr.", "tree": {"sha": "4a760791e1f53f8fb23cc27d3e69f13e030cbd97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a760791e1f53f8fb23cc27d3e69f13e030cbd97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe57fdd15e6046720463491359d32c5833ffad9c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEYFTdM4NKd7XQft77pp+NIls619kFAlmay3sACgkQpp+NIls6\n19nFiQ/+PYbxaUPniP7bbN+D2DPXuVhJra8fqqxhBJ+gjI902K5gI36Rzirf5YQ0\npp77o4JWTHiKQeC/AFvwEB1wI0ZmlWdsILwmBNZlinSH6gPEkHhVikyj8AK/a2fg\n57lm1jSFLZIiEj+fJ0e3777pqkmywmpPtnvhiqhR9WxcCPXVJgHNBHeJbC2/2XoK\nSp+ETrhx//HMS5+fFbQe6o7STG3WH/kmu/ifpOQ+kei6X+OazQ73+OFktHqzAslj\ny+x1jpZknx3VyOMn+a2PrH39qchwcVR+TO9hjFFrqxL3Pfgs9f7nqHW1GL3G8Wih\nZmOT6kgH0KI4Ns/5ZmH3BW3gDoKjLZn4V5E8XjcHKGyrrBm4mJQrJ9snOOPwCDQx\nFofgHwFdEwU/4/prLDdgxZIpq7jIr/2cMMFWtxmjNdi32UhkN7J4lI6vHlVST96p\nuqvlkBuKKWSbu7DLuH78yHVotKsGBqdhKX8vxUDBdx2qll4k4K3AJ1tbOfCGeQie\n6gL8lozqRhh9il2TU6Jx5MME6LS+gOOb70aCvjxvUvIx/5NfyR0VchWsM300bPXd\nUb2bhHlI+nzCfjVZvTaBPd9L8sNS+UjxbQue7L/w6emuUGK/MfxlmToFV+mhXK7N\nHcoFGH6Y8fG1py6d3281mhx8M0Y2ueeBoxH6qfEg2s7rYSQUtLE=\n=3y4y\n-----END PGP SIGNATURE-----", "payload": "tree 4a760791e1f53f8fb23cc27d3e69f13e030cbd97\nparent 60ca61ee660c156e0ff3fe0ee12a8156b5a425fd\nauthor Beno\u00eet CORTIER <benoit.cortier@fried-world.eu> 1498903320 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1503316859 +0200\n\nImprove needless_borrowed_ref and update its stderr.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe57fdd15e6046720463491359d32c5833ffad9c", "html_url": "https://github.com/rust-lang/rust/commit/fe57fdd15e6046720463491359d32c5833ffad9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe57fdd15e6046720463491359d32c5833ffad9c/comments", "author": {"login": "CBenoit", "id": 3809077, "node_id": "MDQ6VXNlcjM4MDkwNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/3809077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CBenoit", "html_url": "https://github.com/CBenoit", "followers_url": "https://api.github.com/users/CBenoit/followers", "following_url": "https://api.github.com/users/CBenoit/following{/other_user}", "gists_url": "https://api.github.com/users/CBenoit/gists{/gist_id}", "starred_url": "https://api.github.com/users/CBenoit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CBenoit/subscriptions", "organizations_url": "https://api.github.com/users/CBenoit/orgs", "repos_url": "https://api.github.com/users/CBenoit/repos", "events_url": "https://api.github.com/users/CBenoit/events{/privacy}", "received_events_url": "https://api.github.com/users/CBenoit/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60ca61ee660c156e0ff3fe0ee12a8156b5a425fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/60ca61ee660c156e0ff3fe0ee12a8156b5a425fd", "html_url": "https://github.com/rust-lang/rust/commit/60ca61ee660c156e0ff3fe0ee12a8156b5a425fd"}], "stats": {"total": 64, "additions": 54, "deletions": 10}, "files": [{"sha": "4e9986561bc1b0ccf4cdf2d62b01516fdf35e2ff", "filename": "clippy_tests/examples/needless_borrowed_ref.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/fe57fdd15e6046720463491359d32c5833ffad9c/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe57fdd15e6046720463491359d32c5833ffad9c/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.rs?ref=fe57fdd15e6046720463491359d32c5833ffad9c", "patch": "@@ -8,13 +8,24 @@ fn main() {\n     let _ = v.iter_mut().filter(|&ref a| a.is_empty());\n     //                            ^ should be linted\n \n-    let mut var = 5;\n-    let thingy = Some(&mut var);\n-    if let Some(&mut ref v) = thingy {\n+    let var = 3;\n+    let thingy = Some(&var);\n+    if let Some(&ref v) = thingy {\n+        //          ^ should be linted\n+    }\n+\n+    let mut var2 = 5;\n+    let thingy2 = Some(&mut var2);\n+    if let Some(&mut ref mut v) = thingy2 {\n+        //          ^ should *not* be linted\n+        // v is borrowed as mutable.\n+        *v = 10;\n+    }\n+    if let Some(&mut ref v) = thingy2 {\n         //          ^ should *not* be linted\n-        // here, var is borrowed as immutable.\n+        // here, v is borrowed as immutable.\n         // can't do that:\n-        //*v = 10;\n+        //*v = 15;\n     }\n }\n "}, {"sha": "a9befd5767c2ab564b0017714da9d2a431a57374", "filename": "clippy_tests/examples/needless_borrowed_ref.stderr", "status": "modified", "additions": 38, "deletions": 5, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/fe57fdd15e6046720463491359d32c5833ffad9c/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fe57fdd15e6046720463491359d32c5833ffad9c/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.stderr?ref=fe57fdd15e6046720463491359d32c5833ffad9c", "patch": "@@ -1,8 +1,41 @@\n-warning: this pattern takes a reference on something that is being de-referenced\n- --> needless_borrowed_ref.rs:7:35\n+error: this pattern takes a reference on something that is being de-referenced\n+ --> examples/needless_borrowed_ref.rs:8:34\n   |\n-7 |     let _ = v.iter_mut().filter(|&ref a| a.is_empty());\n-  |                                   ^^^^^\n+8 |     let _ = v.iter_mut().filter(|&ref a| a.is_empty());\n+  |                                  ^^^^^^ help: try removing the `&ref` part and just keep `a`\n   |\n-  = note: #[warn(needless_borrowed_reference)] on by default\n+  = note: `-D needless-borrowed-reference` implied by `-D warnings`\n   = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n+\n+error: this pattern takes a reference on something that is being de-referenced\n+  --> examples/needless_borrowed_ref.rs:13:17\n+   |\n+13 |     if let Some(&ref v) = thingy {\n+   |                 ^^^^^^ help: try removing the `&ref` part and just keep `v`\n+   |\n+   = note: `-D needless-borrowed-reference` implied by `-D warnings`\n+   = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n+\n+error: this pattern takes a reference on something that is being de-referenced\n+  --> examples/needless_borrowed_ref.rs:42:27\n+   |\n+42 |         (&Animal::Cat(v), &ref k) | (&ref k, &Animal::Cat(v)) => (), // lifetime mismatch error if there is no '&ref'\n+   |                           ^^^^^^ help: try removing the `&ref` part and just keep `k`\n+   |\n+   = note: `-D needless-borrowed-reference` implied by `-D warnings`\n+   = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n+\n+error: this pattern takes a reference on something that is being de-referenced\n+  --> examples/needless_borrowed_ref.rs:42:38\n+   |\n+42 |         (&Animal::Cat(v), &ref k) | (&ref k, &Animal::Cat(v)) => (), // lifetime mismatch error if there is no '&ref'\n+   |                                      ^^^^^^ help: try removing the `&ref` part and just keep `k`\n+   |\n+   = note: `-D needless-borrowed-reference` implied by `-D warnings`\n+   = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n+\n+error: aborting due to previous error(s)\n+\n+error: Could not compile `clippy_tests`.\n+\n+To learn more, run the command again with --verbose."}]}