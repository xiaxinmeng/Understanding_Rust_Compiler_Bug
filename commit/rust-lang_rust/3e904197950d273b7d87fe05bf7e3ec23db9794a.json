{"sha": "3e904197950d273b7d87fe05bf7e3ec23db9794a", "node_id": "C_kwDOAAsO6NoAKDNlOTA0MTk3OTUwZDI3M2I3ZDg3ZmUwNWJmN2UzZWMyM2RiOTc5NGE", "commit": {"author": {"name": "bogon-right", "email": "bogon-right@bytedance.com", "date": "2022-10-16T20:03:23Z"}, "committer": {"name": "bogon-right", "email": "bogon-right@bytedance.com", "date": "2022-10-16T20:03:23Z"}, "message": "Add tests for autoderef on block tail", "tree": {"sha": "b13ed132e5c7173e2adaf90405332eaeb5ad2d7a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b13ed132e5c7173e2adaf90405332eaeb5ad2d7a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e904197950d273b7d87fe05bf7e3ec23db9794a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e904197950d273b7d87fe05bf7e3ec23db9794a", "html_url": "https://github.com/rust-lang/rust/commit/3e904197950d273b7d87fe05bf7e3ec23db9794a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e904197950d273b7d87fe05bf7e3ec23db9794a/comments", "author": null, "committer": null, "parents": [{"sha": "8be3ce9056d17f822704b8994f60668adf180fe8", "url": "https://api.github.com/repos/rust-lang/rust/commits/8be3ce9056d17f822704b8994f60668adf180fe8", "html_url": "https://github.com/rust-lang/rust/commit/8be3ce9056d17f822704b8994f60668adf180fe8"}], "stats": {"total": 149, "additions": 149, "deletions": 0}, "files": [{"sha": "01c8ab5a839fa70eac51a72fc89654287a9cec84", "filename": "src/test/ui/coercion/coerce-block-tail-26978.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.rs?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,11 @@\n+// check-fail\n+fn f(_: &i32) {}\n+\n+fn main() {\n+    let x = Box::new(1i32);\n+\n+    f(&x);\n+    f(&(x));\n+    f(&{x});\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "384debd487c5156bcf9b3255d40878105e3940ca", "filename": "src/test/ui/coercion/coerce-block-tail-26978.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.stderr?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,16 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-26978.rs:9:9\n+   |\n+LL |     f(&{x});\n+   |         ^ expected `i32`, found struct `Box`\n+   |\n+   = note: expected type `i32`\n+            found struct `Box<i32>`\n+help: consider unboxing the value\n+   |\n+LL |     f(&{*x});\n+   |         +\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "79b5b33233b314b063548c9b1eee7b5ce91c9dc2", "filename": "src/test/ui/coercion/coerce-block-tail-57749.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.rs?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,35 @@\n+// check-fail\n+use std::ops::Deref;\n+\n+fn main() {\n+    fn save(who: &str) {\n+        println!(\"I'll save you, {}!\", who);\n+    }\n+\n+    struct Madoka;\n+\n+    impl Deref for Madoka {\n+        type Target = str;\n+        fn deref(&self) -> &Self::Target {\n+            \"Madoka\"\n+        }\n+    }\n+\n+    save(&{ Madoka });\n+\n+    fn reset(how: &u32) {\n+        println!(\"Reset {} times\", how);\n+    }\n+\n+    struct Homura;\n+\n+    impl Deref for Homura {\n+        type Target = u32;\n+        fn deref(&self) -> &Self::Target {\n+            &42\n+        }\n+    }\n+\n+    reset(&{ Homura });\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "d5660c81dbd3e67256825cf826ecde848fb254ef", "filename": "src/test/ui/coercion/coerce-block-tail-57749.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.stderr?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,14 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-57749.rs:33:14\n+   |\n+LL |     reset(&{ Homura });\n+   |              ^^^^^^ expected `u32`, found struct `Homura`\n+   |\n+help: consider dereferencing the type\n+   |\n+LL |     reset(&{ *Homura });\n+   |              +\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "18c8ae3bbbad472895cdd80ddb394249b9338d8e", "filename": "src/test/ui/coercion/coerce-block-tail-83783.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.rs?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,13 @@\n+// check-fail\n+// edition:2018\n+fn _consume_reference<T: ?Sized>(_: &T) {}\n+\n+async fn _foo() {\n+    _consume_reference::<i32>(&Box::new(7_i32));\n+    _consume_reference::<i32>(&async { Box::new(7_i32) }.await);\n+    //~^ ERROR mismatched types\n+    _consume_reference::<[i32]>(&vec![7_i32]);\n+    _consume_reference::<[i32]>(&async { vec![7_i32] }.await);\n+}\n+\n+fn main() { }"}, {"sha": "5f53606ce2225d42330518a1ac5e6f305a8841bb", "filename": "src/test/ui/coercion/coerce-block-tail-83783.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.stderr?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,12 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-83783.rs:7:32\n+   |\n+LL |     _consume_reference::<i32>(&async { Box::new(7_i32) }.await);\n+   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `i32`, found struct `Box`\n+   |\n+   = note: expected type `i32`\n+            found struct `Box<i32>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "77fdf99983332eaa00261ed5512d238f0ff6c567", "filename": "src/test/ui/coercion/coerce-block-tail-83850.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.rs?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,7 @@\n+// check-fail\n+fn f(_: &[i32]) {}\n+\n+fn main() {\n+    f(&Box::new([1, 2]));\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "bbf6075437043532384ae1ccb7c9b542bf7159bc", "filename": "src/test/ui/coercion/coerce-block-tail-83850.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.stderr?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,19 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-83850.rs:5:7\n+   |\n+LL |     f(&Box::new([1, 2]));\n+   |     - ^^^^^^^^^^^^^^^^^ expected slice `[i32]`, found struct `Box`\n+   |     |\n+   |     arguments to this function are incorrect\n+   |\n+   = note: expected reference `&[i32]`\n+              found reference `&Box<[{integer}; 2]>`\n+note: function defined here\n+  --> $DIR/coerce-block-tail-83850.rs:2:4\n+   |\n+LL | fn f(_: &[i32]) {}\n+   |    ^ ---------\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "dcbcd3762862f75349bd1f75e61812ce54fe4498", "filename": "src/test/ui/coercion/coerce-block-tail.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.rs?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,6 @@\n+// check-fail\n+fn main() {\n+    let _: &str = & { String::from(\"hahah\")};\n+    let _: &i32 = & { Box::new(1i32) };\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "318cf75867b4b47d7a8dd4d5c517db5a1b6b12f5", "filename": "src/test/ui/coercion/coerce-block-tail.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3e904197950d273b7d87fe05bf7e3ec23db9794a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.stderr?ref=3e904197950d273b7d87fe05bf7e3ec23db9794a", "patch": "@@ -0,0 +1,16 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail.rs:4:23\n+   |\n+LL |     let _: &i32 = & { Box::new(1i32) };\n+   |                       ^^^^^^^^^^^^^^ expected `i32`, found struct `Box`\n+   |\n+   = note: expected type `i32`\n+            found struct `Box<i32>`\n+help: consider unboxing the value\n+   |\n+LL |     let _: &i32 = & { *Box::new(1i32) };\n+   |                       +\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}