{"sha": "b9185943697bd5bb503c334576ddab05328f2e00", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5MTg1OTQzNjk3YmQ1YmI1MDNjMzM0NTc2ZGRhYjA1MzI4ZjJlMDA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-21T05:43:43Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-06-23T15:24:45Z"}, "message": "Fix fallout from rust-lang/rust PR 60861.", "tree": {"sha": "390db15c18e77bb8df6f9b6be63e01437b121257", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/390db15c18e77bb8df6f9b6be63e01437b121257"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9185943697bd5bb503c334576ddab05328f2e00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9185943697bd5bb503c334576ddab05328f2e00", "html_url": "https://github.com/rust-lang/rust/commit/b9185943697bd5bb503c334576ddab05328f2e00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9185943697bd5bb503c334576ddab05328f2e00/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5d1ecd4747d73e0c8a62b82b97cb6d5f83db45f", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5d1ecd4747d73e0c8a62b82b97cb6d5f83db45f", "html_url": "https://github.com/rust-lang/rust/commit/c5d1ecd4747d73e0c8a62b82b97cb6d5f83db45f"}], "stats": {"total": 70, "additions": 32, "deletions": 38}, "files": [{"sha": "12c83873641cad31149a67146b8a6e4bebd5a15c", "filename": "clippy_lints/src/collapsible_if.rs", "status": "modified", "additions": 23, "deletions": 26, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Fcollapsible_if.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Fcollapsible_if.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcollapsible_if.rs?ref=b9185943697bd5bb503c334576ddab05328f2e00", "patch": "@@ -84,18 +84,14 @@ impl EarlyLintPass for CollapsibleIf {\n }\n \n fn check_if(cx: &EarlyContext<'_>, expr: &ast::Expr) {\n-    match expr.node {\n-        ast::ExprKind::If(ref check, ref then, ref else_) => {\n-            if let Some(ref else_) = *else_ {\n-                check_collapsible_maybe_if_let(cx, else_);\n-            } else {\n-                check_collapsible_no_if_let(cx, expr, check, then);\n-            }\n-        },\n-        ast::ExprKind::IfLet(_, _, _, Some(ref else_)) => {\n+    if let ast::ExprKind::If(check, then, else_) = &expr.node {\n+        if let Some(else_) = else_ {\n             check_collapsible_maybe_if_let(cx, else_);\n-        },\n-        _ => (),\n+        } else if let ast::ExprKind::Let(..) = check.node {\n+            // Prevent triggering on `if let a = b { if c { .. } }`.\n+        } else {\n+            check_collapsible_no_if_let(cx, expr, check, then);\n+        }\n     }\n }\n \n@@ -113,22 +109,18 @@ fn check_collapsible_maybe_if_let(cx: &EarlyContext<'_>, else_: &ast::Expr) {\n         if !block_starts_with_comment(cx, block);\n         if let Some(else_) = expr_block(block);\n         if !in_macro_or_desugar(else_.span);\n+        if let ast::ExprKind::If(..) = else_.node;\n         then {\n-            match else_.node {\n-                ast::ExprKind::If(..) | ast::ExprKind::IfLet(..) => {\n-                    let mut applicability = Applicability::MachineApplicable;\n-                    span_lint_and_sugg(\n-                        cx,\n-                        COLLAPSIBLE_IF,\n-                        block.span,\n-                        \"this `else { if .. }` block can be collapsed\",\n-                        \"try\",\n-                        snippet_block_with_applicability(cx, else_.span, \"..\", &mut applicability).into_owned(),\n-                        applicability,\n-                    );\n-                }\n-                _ => (),\n-            }\n+            let mut applicability = Applicability::MachineApplicable;\n+            span_lint_and_sugg(\n+                cx,\n+                COLLAPSIBLE_IF,\n+                block.span,\n+                \"this `else { if .. }` block can be collapsed\",\n+                \"try\",\n+                snippet_block_with_applicability(cx, else_.span, \"..\", &mut applicability).into_owned(),\n+                applicability,\n+            );\n         }\n     }\n }\n@@ -139,6 +131,11 @@ fn check_collapsible_no_if_let(cx: &EarlyContext<'_>, expr: &ast::Expr, check: &\n         if let Some(inner) = expr_block(then);\n         if let ast::ExprKind::If(ref check_inner, ref content, None) = inner.node;\n         then {\n+            if let ast::ExprKind::Let(..) = check_inner.node {\n+                // Prevent triggering on `if c { if let a = b { .. } }`.\n+                return;\n+            }\n+\n             if expr.span.ctxt() != inner.span.ctxt() {\n                 return;\n             }"}, {"sha": "9738a1c4c736a0c1594cf083f563708d4d00ba6d", "filename": "clippy_lints/src/formatting.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fformatting.rs?ref=b9185943697bd5bb503c334576ddab05328f2e00", "patch": "@@ -245,12 +245,10 @@ fn is_block(expr: &ast::Expr) -> bool {\n     }\n }\n \n-/// Match `if` or `if let` expressions and return the `then` and `else` block.\n+/// Match `if` expressions and return the `then` and `else` block.\n fn unsugar_if(expr: &ast::Expr) -> Option<(&P<ast::Block>, &Option<P<ast::Expr>>)> {\n     match expr.node {\n-        ast::ExprKind::If(_, ref then, ref else_) | ast::ExprKind::IfLet(_, _, ref then, ref else_) => {\n-            Some((then, else_))\n-        },\n+        ast::ExprKind::If(_, ref then, ref else_) => Some((then, else_)),\n         _ => None,\n     }\n }"}, {"sha": "2ab5940875b357ec1e3b6ac8a1a9525456d6fe18", "filename": "clippy_lints/src/needless_continue.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Fneedless_continue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Fneedless_continue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_continue.rs?ref=b9185943697bd5bb503c334576ddab05328f2e00", "patch": "@@ -209,12 +209,12 @@ fn with_loop_block<F>(expr: &ast::Expr, mut func: F)\n where\n     F: FnMut(&ast::Block, Option<&ast::Label>),\n {\n-    match expr.node {\n-        ast::ExprKind::While(_, ref loop_block, ref label)\n-        | ast::ExprKind::WhileLet(_, _, ref loop_block, ref label)\n-        | ast::ExprKind::ForLoop(_, _, ref loop_block, ref label)\n-        | ast::ExprKind::Loop(ref loop_block, ref label) => func(loop_block, label.as_ref()),\n-        _ => {},\n+    if let ast::ExprKind::While(_, loop_block, label)\n+        | ast::ExprKind::ForLoop(_, _, loop_block, label)\n+        | ast::ExprKind::Loop(loop_block, label)\n+        = &expr.node\n+    {\n+        func(loop_block, label.as_ref());\n     }\n }\n "}, {"sha": "a9643a74085ec519830fd91dad5a63b46bc79e4c", "filename": "clippy_lints/src/utils/sugg.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Futils%2Fsugg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9185943697bd5bb503c334576ddab05328f2e00/clippy_lints%2Fsrc%2Futils%2Fsugg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fsugg.rs?ref=b9185943697bd5bb503c334576ddab05328f2e00", "patch": "@@ -135,7 +135,7 @@ impl<'a> Sugg<'a> {\n             | ast::ExprKind::Box(..)\n             | ast::ExprKind::Closure(..)\n             | ast::ExprKind::If(..)\n-            | ast::ExprKind::IfLet(..)\n+            | ast::ExprKind::Let(..)\n             | ast::ExprKind::Unary(..)\n             | ast::ExprKind::Match(..) => Sugg::MaybeParen(snippet),\n             ast::ExprKind::Async(..)\n@@ -162,7 +162,6 @@ impl<'a> Sugg<'a> {\n             | ast::ExprKind::Tup(..)\n             | ast::ExprKind::Array(..)\n             | ast::ExprKind::While(..)\n-            | ast::ExprKind::WhileLet(..)\n             | ast::ExprKind::Await(..)\n             | ast::ExprKind::Err => Sugg::NonParen(snippet),\n             ast::ExprKind::Range(.., RangeLimits::HalfOpen) => Sugg::BinOp(AssocOp::DotDot, snippet),"}]}