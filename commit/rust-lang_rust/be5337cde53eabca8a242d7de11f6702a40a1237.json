{"sha": "be5337cde53eabca8a242d7de11f6702a40a1237", "node_id": "C_kwDOAAsO6NoAKGJlNTMzN2NkZTUzZWFiY2E4YTI0MmQ3ZGUxMWY2NzAyYTQwYTEyMzc", "commit": {"author": {"name": "beetrees", "email": "b@beetr.ee", "date": "2022-06-21T19:20:00Z"}, "committer": {"name": "beetrees", "email": "b@beetr.ee", "date": "2022-06-21T19:20:00Z"}, "message": "Migrate `builtin-macros-expected-one-cfg-pattern` to `SessionDiagnostic`", "tree": {"sha": "2299efffddaa26d2ad1398f7ffc1c8ccbbb0a0d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2299efffddaa26d2ad1398f7ffc1c8ccbbb0a0d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be5337cde53eabca8a242d7de11f6702a40a1237", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQT9oej+Slbzs/bk2IuHkb11QZHr1gUCYrIZ4AAKCRCHkb11QZHr\n1rjwAP9cObSHrAf2Ml7g6dMv6P6+gkTDT5NI9R7IiN/7WNSL5gEA+S4/nzePnpb1\ntTkFaXvRksPyoSLq3/QzWZgvPiNvlA8=\n=5JNR\n-----END PGP SIGNATURE-----", "payload": "tree 2299efffddaa26d2ad1398f7ffc1c8ccbbb0a0d4\nparent 6264ffbfef035448661222ec9baf4648b1d9cb77\nauthor beetrees <b@beetr.ee> 1655839200 +0100\ncommitter beetrees <b@beetr.ee> 1655839200 +0100\n\nMigrate `builtin-macros-expected-one-cfg-pattern` to `SessionDiagnostic`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be5337cde53eabca8a242d7de11f6702a40a1237", "html_url": "https://github.com/rust-lang/rust/commit/be5337cde53eabca8a242d7de11f6702a40a1237", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be5337cde53eabca8a242d7de11f6702a40a1237/comments", "author": {"login": "beetrees", "id": 107947675, "node_id": "U_kgDOBm8mmw", "avatar_url": "https://avatars.githubusercontent.com/u/107947675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beetrees", "html_url": "https://github.com/beetrees", "followers_url": "https://api.github.com/users/beetrees/followers", "following_url": "https://api.github.com/users/beetrees/following{/other_user}", "gists_url": "https://api.github.com/users/beetrees/gists{/gist_id}", "starred_url": "https://api.github.com/users/beetrees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beetrees/subscriptions", "organizations_url": "https://api.github.com/users/beetrees/orgs", "repos_url": "https://api.github.com/users/beetrees/repos", "events_url": "https://api.github.com/users/beetrees/events{/privacy}", "received_events_url": "https://api.github.com/users/beetrees/received_events", "type": "User", "site_admin": false}, "committer": {"login": "beetrees", "id": 107947675, "node_id": "U_kgDOBm8mmw", "avatar_url": "https://avatars.githubusercontent.com/u/107947675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beetrees", "html_url": "https://github.com/beetrees", "followers_url": "https://api.github.com/users/beetrees/followers", "following_url": "https://api.github.com/users/beetrees/following{/other_user}", "gists_url": "https://api.github.com/users/beetrees/gists{/gist_id}", "starred_url": "https://api.github.com/users/beetrees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beetrees/subscriptions", "organizations_url": "https://api.github.com/users/beetrees/orgs", "repos_url": "https://api.github.com/users/beetrees/repos", "events_url": "https://api.github.com/users/beetrees/events{/privacy}", "received_events_url": "https://api.github.com/users/beetrees/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6264ffbfef035448661222ec9baf4648b1d9cb77", "url": "https://api.github.com/repos/rust-lang/rust/commits/6264ffbfef035448661222ec9baf4648b1d9cb77", "html_url": "https://github.com/rust-lang/rust/commit/6264ffbfef035448661222ec9baf4648b1d9cb77"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "c75d83bd0a0e360a0611d156bb41a6e06ba6089d", "filename": "compiler/rustc_builtin_macros/src/cfg.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/be5337cde53eabca8a242d7de11f6702a40a1237/compiler%2Frustc_builtin_macros%2Fsrc%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be5337cde53eabca8a242d7de11f6702a40a1237/compiler%2Frustc_builtin_macros%2Fsrc%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fcfg.rs?ref=be5337cde53eabca8a242d7de11f6702a40a1237", "patch": "@@ -43,6 +43,13 @@ struct RequiresCfgPattern {\n     span: Span,\n }\n \n+#[derive(SessionDiagnostic)]\n+#[error(slug = \"builtin-macros-expected-one-cfg-pattern\")]\n+struct OneCfgPattern {\n+    #[primary_span]\n+    span: Span,\n+}\n+\n fn parse_cfg<'a>(cx: &mut ExtCtxt<'a>, span: Span, tts: TokenStream) -> PResult<'a, ast::MetaItem> {\n     let mut p = cx.new_parser_from_tts(tts);\n \n@@ -55,7 +62,7 @@ fn parse_cfg<'a>(cx: &mut ExtCtxt<'a>, span: Span, tts: TokenStream) -> PResult<\n     let _ = p.eat(&token::Comma);\n \n     if !p.eat(&token::Eof) {\n-        return Err(cx.struct_span_err(span, \"expected 1 cfg-pattern\"));\n+        return Err(cx.create_err(OneCfgPattern { span }));\n     }\n \n     Ok(cfg)"}, {"sha": "1d3e33c81851f5cb84b1132f51fdda2a535f81ad", "filename": "compiler/rustc_error_messages/locales/en-US/builtin_macros.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/be5337cde53eabca8a242d7de11f6702a40a1237/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fbuiltin_macros.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/be5337cde53eabca8a242d7de11f6702a40a1237/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fbuiltin_macros.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fbuiltin_macros.ftl?ref=be5337cde53eabca8a242d7de11f6702a40a1237", "patch": "@@ -1,3 +1,5 @@\n builtin-macros-requires-cfg-pattern =\n     macro requires a cfg-pattern as an argument\n     .label = cfg-pattern required\n+\n+builtin-macros-expected-one-cfg-pattern = expected 1 cfg-pattern"}]}