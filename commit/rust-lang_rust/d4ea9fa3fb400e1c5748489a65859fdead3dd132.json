{"sha": "d4ea9fa3fb400e1c5748489a65859fdead3dd132", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ0ZWE5ZmEzZmI0MDBlMWM1NzQ4NDg5YTY1ODU5ZmRlYWQzZGQxMzI=", "commit": {"author": {"name": "Denis Merigoux", "email": "denis.merigoux@gmail.com", "date": "2021-06-01T12:10:14Z"}, "committer": {"name": "Denis Merigoux", "email": "denis.merigoux@gmail.com", "date": "2021-06-03T07:27:41Z"}, "message": "Restore the num_def_ids_untracked public function giving the total number of exported symbols for each crate\n\nRestored underlying num_def_ids_method\n\nUpdate compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs\n\nChanged name to fit with naming convention\n\nCo-authored-by: bjorn3 <bjorn3@users.noreply.github.com>\n\nUpdate compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs\n\nReplace regular doc with Rustdoc comment\n\nCo-authored-by: Joshua Nelson <jyn514@gmail.com>\n\nClarifies third-party use of num_def_ids_untracked", "tree": {"sha": "a4ec8014ae889f4e922e201aad15386a7fd0647b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a4ec8014ae889f4e922e201aad15386a7fd0647b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d4ea9fa3fb400e1c5748489a65859fdead3dd132", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJguIRyAAoJEO6Z3Po2XD7jFkYIAKPNjKDKAax994URd5juqwJq\nqo4wR3xBesxbRzOYpAalJdsRY4ZY/RdD5gbZHI9b57rpcD+7XOm8wswV3yv6HHkj\nt1gUpc+R3iJJzMSSw3m/2u2lPzKaV+tbRcQrWaWRM4H29S/ILs91p7byPlDKmGNO\nTooJol6DqI3723MSYmlz/wwlG8zMVFVALkQPxtnjp6/3FqrcF4zv+iJbLyRwJ05z\nZstKj5/wm7vq0frwuI0wV/iumA1o7gejKR16TswBlfd3SVDwfP6legcs0UpTQqCO\nx+ju5NLiHkMyxARt55hcCJuAz8TK2dRlUrwy55WCL4yaO6oMqaGqEbvYeRCsLkU=\n=+Sdu\n-----END PGP SIGNATURE-----", "payload": "tree a4ec8014ae889f4e922e201aad15386a7fd0647b\nparent c4f186f0ea443db4aacdd90a2515632c20ccd3fe\nauthor Denis Merigoux <denis.merigoux@gmail.com> 1622549414 +0200\ncommitter Denis Merigoux <denis.merigoux@gmail.com> 1622705261 +0200\n\nRestore the num_def_ids_untracked public function giving the total number of exported symbols for each crate\n\nRestored underlying num_def_ids_method\n\nUpdate compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs\n\nChanged name to fit with naming convention\n\nCo-authored-by: bjorn3 <bjorn3@users.noreply.github.com>\n\nUpdate compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs\n\nReplace regular doc with Rustdoc comment\n\nCo-authored-by: Joshua Nelson <jyn514@gmail.com>\n\nClarifies third-party use of num_def_ids_untracked\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d4ea9fa3fb400e1c5748489a65859fdead3dd132", "html_url": "https://github.com/rust-lang/rust/commit/d4ea9fa3fb400e1c5748489a65859fdead3dd132", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d4ea9fa3fb400e1c5748489a65859fdead3dd132/comments", "author": {"login": "denismerigoux", "id": 1766128, "node_id": "MDQ6VXNlcjE3NjYxMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/1766128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/denismerigoux", "html_url": "https://github.com/denismerigoux", "followers_url": "https://api.github.com/users/denismerigoux/followers", "following_url": "https://api.github.com/users/denismerigoux/following{/other_user}", "gists_url": "https://api.github.com/users/denismerigoux/gists{/gist_id}", "starred_url": "https://api.github.com/users/denismerigoux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/denismerigoux/subscriptions", "organizations_url": "https://api.github.com/users/denismerigoux/orgs", "repos_url": "https://api.github.com/users/denismerigoux/repos", "events_url": "https://api.github.com/users/denismerigoux/events{/privacy}", "received_events_url": "https://api.github.com/users/denismerigoux/received_events", "type": "User", "site_admin": false}, "committer": {"login": "denismerigoux", "id": 1766128, "node_id": "MDQ6VXNlcjE3NjYxMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/1766128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/denismerigoux", "html_url": "https://github.com/denismerigoux", "followers_url": "https://api.github.com/users/denismerigoux/followers", "following_url": "https://api.github.com/users/denismerigoux/following{/other_user}", "gists_url": "https://api.github.com/users/denismerigoux/gists{/gist_id}", "starred_url": "https://api.github.com/users/denismerigoux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/denismerigoux/subscriptions", "organizations_url": "https://api.github.com/users/denismerigoux/orgs", "repos_url": "https://api.github.com/users/denismerigoux/repos", "events_url": "https://api.github.com/users/denismerigoux/events{/privacy}", "received_events_url": "https://api.github.com/users/denismerigoux/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4f186f0ea443db4aacdd90a2515632c20ccd3fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4f186f0ea443db4aacdd90a2515632c20ccd3fe", "html_url": "https://github.com/rust-lang/rust/commit/c4f186f0ea443db4aacdd90a2515632c20ccd3fe"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "59fec58f0a1b3037a65f22b28697825be7c8a0ef", "filename": "compiler/rustc_metadata/src/rmeta/decoder.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d4ea9fa3fb400e1c5748489a65859fdead3dd132/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4ea9fa3fb400e1c5748489a65859fdead3dd132/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs?ref=d4ea9fa3fb400e1c5748489a65859fdead3dd132", "patch": "@@ -1931,6 +1931,10 @@ impl CrateMetadata {\n         self.root.hash\n     }\n \n+    fn num_def_ids(&self) -> usize {\n+        self.root.tables.def_keys.size()\n+    }\n+\n     fn local_def_id(&self, index: DefIndex) -> DefId {\n         DefId { krate: self.cnum, index }\n     }"}, {"sha": "c1e12bb7a49cb426d7913ea2e9cefbd7307a996d", "filename": "compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d4ea9fa3fb400e1c5748489a65859fdead3dd132/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4ea9fa3fb400e1c5748489a65859fdead3dd132/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=d4ea9fa3fb400e1c5748489a65859fdead3dd132", "patch": "@@ -454,6 +454,13 @@ impl CStore {\n         self.get_crate_data(def_id.krate).module_expansion(def_id.index, sess)\n     }\n \n+    /// Only public-facing way to traverse all the definitions in a non-local crate.\n+    /// Critically useful for this third-party project: <https://github.com/hacspec/hacspec>.\n+    /// See <https://github.com/rust-lang/rust/pull/85889> for context.\n+    pub fn num_def_ids_untracked(&self, cnum: CrateNum) -> usize {\n+        self.get_crate_data(cnum).num_def_ids()\n+    }\n+\n     pub fn item_attrs(&self, def_id: DefId, sess: &Session) -> Vec<ast::Attribute> {\n         self.get_crate_data(def_id.krate).get_item_attrs(def_id.index, sess).collect()\n     }"}]}