{"sha": "be83a12ff7bcc9c620bab8297654f6e006b50d6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlODNhMTJmZjdiY2M5YzYyMGJhYjgyOTc2NTRmNmUwMDZiNTBkNmQ=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-06-06T23:01:12Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-06-06T23:01:12Z"}, "message": "Add some testcases for bug #2470.", "tree": {"sha": "8ce21513cab2927a8f66a47242ceadee1b13b7c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8ce21513cab2927a8f66a47242ceadee1b13b7c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be83a12ff7bcc9c620bab8297654f6e006b50d6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be83a12ff7bcc9c620bab8297654f6e006b50d6d", "html_url": "https://github.com/rust-lang/rust/commit/be83a12ff7bcc9c620bab8297654f6e006b50d6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be83a12ff7bcc9c620bab8297654f6e006b50d6d/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5d7b3b921ffe7d4a1a600206c213fc92826639c", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5d7b3b921ffe7d4a1a600206c213fc92826639c", "html_url": "https://github.com/rust-lang/rust/commit/d5d7b3b921ffe7d4a1a600206c213fc92826639c"}], "stats": {"total": 69, "additions": 69, "deletions": 0}, "files": [{"sha": "215fd53ce5edddbdd905c3a792d68ec82fc7d90c", "filename": "src/test/run-fail/bug-2470-bounds-check-overflow-2.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/be83a12ff7bcc9c620bab8297654f6e006b50d6d/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be83a12ff7bcc9c620bab8297654f6e006b50d6d/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow-2.rs?ref=be83a12ff7bcc9c620bab8297654f6e006b50d6d", "patch": "@@ -0,0 +1,17 @@\n+// xfail-test\n+// error-pattern:bounds check\n+\n+fn main() {\n+    let x = [1u,2u,3u];\n+\n+    // This should cause a bounds-check failure, but may not if we do our\n+    // bounds checking by comparing a scaled index value to the vector's\n+    // length (in bytes), because the scaling of the index will cause it to\n+    // wrap around to a small number.\n+\n+    let idx = uint::max_value & !(uint::max_value >> 1u);\n+    #error(\"ov2 idx = 0x%x\", idx);\n+\n+    // This should fail.\n+    #error(\"ov2 0x%x\",  x[idx]);\n+}\n\\ No newline at end of file"}, {"sha": "26737f8a9fab81032f4b13f235da952ee070784e", "filename": "src/test/run-fail/bug-2470-bounds-check-overflow-3.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/be83a12ff7bcc9c620bab8297654f6e006b50d6d/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be83a12ff7bcc9c620bab8297654f6e006b50d6d/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow-3.rs?ref=be83a12ff7bcc9c620bab8297654f6e006b50d6d", "patch": "@@ -0,0 +1,28 @@\n+// xfail-test\n+// error-pattern:bounds check\n+\n+#[cfg(target_arch=\"x86\")]\n+fn main() {\n+    let x = [1u,2u,3u];\n+\n+    // This should cause a bounds-check failure, but may not if we do our\n+    // bounds checking by truncating the index value to the size of the\n+    // machine word, losing relevant bits of the index value.\n+\n+    // This test is only meaningful on 32-bit hosts.\n+\n+    let idx = u64::max_value & !(u64::max_value >> 1u);\n+    #error(\"ov3 idx = 0x%8.8x%8.8x\",\n+           (idx >> 32) as uint,\n+           idx as uint);\n+\n+    // This should fail.\n+    #error(\"ov3 0x%x\",  x[idx]);\n+}\n+\n+#[cfg(target_arch=\"x86_64\")]\n+fn main() {\n+    // This version just fails anyways, for symmetry on 64-bit hosts.\n+    let x = [1u,2u,3u];\n+    #error(\"ov3 0x%x\",  x[200]);\n+}"}, {"sha": "84bd9ab5c76eeed25723afb5d5dfac8c9f7a1760", "filename": "src/test/run-fail/bug-2470-bounds-check-overflow.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/be83a12ff7bcc9c620bab8297654f6e006b50d6d/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be83a12ff7bcc9c620bab8297654f6e006b50d6d/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fbug-2470-bounds-check-overflow.rs?ref=be83a12ff7bcc9c620bab8297654f6e006b50d6d", "patch": "@@ -0,0 +1,24 @@\n+// error-pattern:bounds check\n+\n+fn main() {\n+\n+    // This should cause a bounds-check failure, but may not if we do our\n+    // bounds checking by comparing the scaled index to the vector's\n+    // address-bounds, since we've scaled the index to wrap around to the\n+    // address of the 0th cell in the array (even though the index is\n+    // huge).\n+\n+    let x = [1u,2u,3u];\n+    vec::unpack_slice(x) {|p, _len|\n+        let base = p as uint;                     // base = 0x1230 say\n+        let idx = base / sys::size_of::<uint>();  // idx  = 0x0246 say\n+        #error(\"ov1 base = 0x%x\", base);\n+        #error(\"ov1 idx = 0x%x\", idx);\n+        #error(\"ov1 sizeof::<uint>() = 0x%x\", sys::size_of::<uint>());\n+        #error(\"ov1 idx * sizeof::<uint>() = 0x%x\",\n+               idx * sys::size_of::<uint>());\n+\n+        // This should fail.\n+        #error(\"ov1 0x%x\",  x[idx]);\n+    }\n+}\n\\ No newline at end of file"}]}