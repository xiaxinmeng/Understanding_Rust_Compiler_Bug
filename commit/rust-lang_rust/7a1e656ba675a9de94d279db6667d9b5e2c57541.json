{"sha": "7a1e656ba675a9de94d279db6667d9b5e2c57541", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhMWU2NTZiYTY3NWE5ZGU5NGQyNzlkYjY2NjdkOWI1ZTJjNTc1NDE=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-07-26T22:38:48Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-07-26T22:41:43Z"}, "message": "Tidy up fuzzer logic a bit.", "tree": {"sha": "83bf030908d6d59061a3e34042980d29f077bf90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83bf030908d6d59061a3e34042980d29f077bf90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7a1e656ba675a9de94d279db6667d9b5e2c57541", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7a1e656ba675a9de94d279db6667d9b5e2c57541", "html_url": "https://github.com/rust-lang/rust/commit/7a1e656ba675a9de94d279db6667d9b5e2c57541", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7a1e656ba675a9de94d279db6667d9b5e2c57541/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba626779de957ac5d21bd23cb95febf75354a14f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba626779de957ac5d21bd23cb95febf75354a14f", "html_url": "https://github.com/rust-lang/rust/commit/ba626779de957ac5d21bd23cb95febf75354a14f"}], "stats": {"total": 37, "additions": 24, "deletions": 13}, "files": [{"sha": "390da304f645d9bdf5a990b229f3a40ea8bf506b", "filename": "src/fuzzer/fuzzer.rs", "status": "modified", "additions": 24, "deletions": 13, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/7a1e656ba675a9de94d279db6667d9b5e2c57541/src%2Ffuzzer%2Ffuzzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7a1e656ba675a9de94d279db6667d9b5e2c57541/src%2Ffuzzer%2Ffuzzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ffuzzer%2Ffuzzer.rs?ref=7a1e656ba675a9de94d279db6667d9b5e2c57541", "patch": "@@ -204,6 +204,8 @@ fn file_is_confusing(&str filename) -> bool {\n \n         \"block-expr-precedence.rs\",  // https://github.com/graydon/rust/issues/674\n \n+        \"nil-pattern.rs\",            // something to do with () as a lone pattern\n+\n         \"syntax-extension-fmt.rs\"    // an issue where -2147483648 gains an\n                                      // extra negative sign each time through,\n                                      // which i can't reproduce using \"rustc\n@@ -228,8 +230,11 @@ fn check_roundtrip_convergence(&str code) {\n     while (i < 10) {\n         old = new;\n         new = parse_and_print(old);\n+        if content_is_confusing(new) {\n+            ret;\n+        }\n         i += 1;\n-        log_err #fmt(\"cycle %d\", i);\n+        log #fmt(\"cycle %d\", i);\n     }\n \n     if old != new {\n@@ -239,19 +244,13 @@ fn check_roundtrip_convergence(&str code) {\n         fail \"Mismatch\";\n     }\n }\n+    \n+fn check_convergence(&str[] files) {\n+    \n+    log_err #fmt(\"pp convergence tests: %u files\", ivec::len(files));\n+    for (str file in files)  {\n \n-fn main(vec[str] args) {\n-    if (vec::len(args) != 2u) {\n-        log_err #fmt(\"usage: %s <testdir>\", args.(0));\n-        ret;\n-    }\n-    auto files = ~[];\n-    auto root = args.(1);\n-    find_rust_files(files, root); // not using time here because that currently screws with passing-a-mutable-array\n-    log_err #fmt(\"%u files\", ivec::len(files));\n-\n-    for (str file in files) {\n-        log_err \"=== \" + file + \" ===\";\n+        log_err #fmt(\"pp converge: %s\", file);\n         if ! file_is_confusing(file) {\n             auto s = read_whole_file(file);\n             if ! content_is_confusing(s) {\n@@ -263,6 +262,18 @@ fn main(vec[str] args) {\n         // Currently hits https://github.com/graydon/rust/issues/675\n         //pp_variants(*crate, cm, file);\n     }\n+    }\n+\n+fn main(vec[str] args) {\n+    if (vec::len(args) != 2u) {\n+        log_err #fmt(\"usage: %s <testdir>\", args.(0));\n+        ret;\n+    }\n+    auto files = ~[];\n+    auto root = args.(1);\n+\n+    find_rust_files(files, root);\n+    check_convergence(files);\n }\n \n // Local Variables:"}]}