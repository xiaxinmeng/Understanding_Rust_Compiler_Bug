{"sha": "a6b8097586efe41b58e15ddb203f63f54a42aa71", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2YjgwOTc1ODZlZmU0MWI1OGUxNWRkYjIwM2Y2M2Y1NGE0MmFhNzE=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-04-13T22:39:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-04-13T22:39:50Z"}, "message": "Rollup merge of #59911 - pnkfelix:revert-pr-59401-to-fix-emit-stack-sizes-gc-sections-ld-gold-bug, r=alexcrichton\n\nRevert \"compile crates under test w/ -Zemit-stack-sizes\"\n\nRevert PR #59401 to fix issue #59652 (a stable-to-beta regression).\n\nThis is result of squashing two revert commits:\n\nRevert \"compile all crates under test w/ -Zemit-stack-sizes\"\n\nThis reverts commit 7d365cf27f4249fc9b61ba8abfc813abe43f1cb7.\n\nRevert \"bootstrap: build compiler-builtins with -Z emit-stack-sizes\"\n\nThis reverts commit 8b8488ce8fc047282e7159343f30609417f9fa39.\n\n----\n\n(My intention is that someone can re-add this code again later, either after the `ld.gold` issue itself is fixed, or with safe-guards to check whether `ld.gold` is in use and then issuing warnings about the problems here when they arise.)", "tree": {"sha": "9365508f3d5eb9631ba0740bdedba715e355814a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9365508f3d5eb9631ba0740bdedba715e355814a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a6b8097586efe41b58e15ddb203f63f54a42aa71", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcsmU2CRBK7hj4Ov3rIwAAdHIIAHN1Vvz/pc8ixAgwuArBqtRb\nzyGKiNE5rOH6GEP8K5UFl11Dfh3kS/gyR1564MgXpHlJKzioh7qFHWoPvjujm2gI\nHwnzTaqc0KKyEFH26OvdXAY3xld+LjLQjQrYcrfzccnsSsivqUHYkZTvzOFr62MT\ndvu4j/oiN1w9Oyue74BsvGyuXYjqO5ChVH57xj3XQ0XZQu7bY93wHRh7aQhts/hY\nsbnFUV1Wtd8vRpi1HPvR2W0IIeEVEbEUZmUkrxiUoxBYPpruOtnEHFdW4hwqF0Tx\nTo508XBGu3xT/RkgY5NLZBLtFAtIH31BfBX1Vio6Lf05yOTm5ZWoah8OqqBBYng=\n=Shwf\n-----END PGP SIGNATURE-----\n", "payload": "tree 9365508f3d5eb9631ba0740bdedba715e355814a\nparent 426ab8e018f2ce2559c1898cb53853b1b00c7cc9\nparent 633fc9eef0d26a1c9b59fad8e807632f234a8aae\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1555195190 +0200\ncommitter GitHub <noreply@github.com> 1555195190 +0200\n\nRollup merge of #59911 - pnkfelix:revert-pr-59401-to-fix-emit-stack-sizes-gc-sections-ld-gold-bug, r=alexcrichton\n\nRevert \"compile crates under test w/ -Zemit-stack-sizes\"\n\nRevert PR #59401 to fix issue #59652 (a stable-to-beta regression).\n\nThis is result of squashing two revert commits:\n\nRevert \"compile all crates under test w/ -Zemit-stack-sizes\"\n\nThis reverts commit 7d365cf27f4249fc9b61ba8abfc813abe43f1cb7.\n\nRevert \"bootstrap: build compiler-builtins with -Z emit-stack-sizes\"\n\nThis reverts commit 8b8488ce8fc047282e7159343f30609417f9fa39.\n\n----\n\n(My intention is that someone can re-add this code again later, either after the `ld.gold` issue itself is fixed, or with safe-guards to check whether `ld.gold` is in use and then issuing warnings about the problems here when they arise.)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a6b8097586efe41b58e15ddb203f63f54a42aa71", "html_url": "https://github.com/rust-lang/rust/commit/a6b8097586efe41b58e15ddb203f63f54a42aa71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a6b8097586efe41b58e15ddb203f63f54a42aa71/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "426ab8e018f2ce2559c1898cb53853b1b00c7cc9", "url": "https://api.github.com/repos/rust-lang/rust/commits/426ab8e018f2ce2559c1898cb53853b1b00c7cc9", "html_url": "https://github.com/rust-lang/rust/commit/426ab8e018f2ce2559c1898cb53853b1b00c7cc9"}, {"sha": "633fc9eef0d26a1c9b59fad8e807632f234a8aae", "url": "https://api.github.com/repos/rust-lang/rust/commits/633fc9eef0d26a1c9b59fad8e807632f234a8aae", "html_url": "https://github.com/rust-lang/rust/commit/633fc9eef0d26a1c9b59fad8e807632f234a8aae"}], "stats": {"total": 31, "additions": 0, "deletions": 31}, "files": [{"sha": "a76584093fc760acd40ba40dee4574a9e58973d7", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 0, "deletions": 27, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/a6b8097586efe41b58e15ddb203f63f54a42aa71/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6b8097586efe41b58e15ddb203f63f54a42aa71/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=a6b8097586efe41b58e15ddb203f63f54a42aa71", "patch": "@@ -187,33 +187,6 @@ fn main() {\n             cmd.arg(\"-C\").arg(format!(\"debug-assertions={}\", debug_assertions));\n         }\n \n-        // Build all crates in the `std` facade with `-Z emit-stack-sizes` to add stack usage\n-        // information.\n-        //\n-        // When you use this `-Z` flag with Cargo you get stack usage information on all crates\n-        // compiled from source, and when you are using LTO you also get information on pre-compiled\n-        // crates like `core` and `std`, even if they were not compiled with `-Z emit-stack-sizes`.\n-        // However, there's an exception: `compiler_builtins`. This crate is special and doesn't\n-        // participate in LTO because it's always linked as a separate object file. For this reason\n-        // it's impossible to get stack usage information about `compiler-builtins` using\n-        // `RUSTFLAGS` + Cargo, or `cargo rustc`.\n-        //\n-        // To make the stack usage information of all crates under the `std` facade available to\n-        // Cargo based stack usage analysis tools, in both LTO and non-LTO mode, we compile them\n-        // with the `-Z emit-stack-sizes` flag. The `RUSTC_EMIT_STACK_SIZES` var helps us apply this\n-        // flag only to the crates in the `std` facade. The `-Z` flag is known to currently work\n-        // with targets that produce ELF files so we limit its use flag to those targets.\n-        //\n-        // NOTE(japaric) if this ever causes problem with an LLVM upgrade or any PR feel free to\n-        // remove it or comment it out\n-        if env::var_os(\"RUSTC_EMIT_STACK_SIZES\").is_some()\n-            && (target.contains(\"-linux-\")\n-                || target.contains(\"-none-eabi\")\n-                || target.ends_with(\"-none-elf\"))\n-        {\n-            cmd.arg(\"-Zemit-stack-sizes\");\n-        }\n-\n         if let Ok(s) = env::var(\"RUSTC_CODEGEN_UNITS\") {\n             cmd.arg(\"-C\").arg(format!(\"codegen-units={}\", s));\n         }"}, {"sha": "66443d472d334718ce0b8bd3d8a05dcf4738139f", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a6b8097586efe41b58e15ddb203f63f54a42aa71/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6b8097586efe41b58e15ddb203f63f54a42aa71/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=a6b8097586efe41b58e15ddb203f63f54a42aa71", "patch": "@@ -97,8 +97,6 @@ impl Step for Std {\n         let _folder = builder.fold_output(|| format!(\"stage{}-std\", compiler.stage));\n         builder.info(&format!(\"Building stage{} std artifacts ({} -> {})\", compiler.stage,\n                 &compiler.host, target));\n-        // compile with `-Z emit-stack-sizes`; see bootstrap/src/rustc.rs for more details\n-        cargo.env(\"RUSTC_EMIT_STACK_SIZES\", \"1\");\n         run_cargo(builder,\n                   &mut cargo,\n                   &libstd_stamp(builder, compiler, target),\n@@ -397,8 +395,6 @@ impl Step for Test {\n         let _folder = builder.fold_output(|| format!(\"stage{}-test\", compiler.stage));\n         builder.info(&format!(\"Building stage{} test artifacts ({} -> {})\", compiler.stage,\n                 &compiler.host, target));\n-        // compile with `-Z emit-stack-sizes`; see bootstrap/src/rustc.rs for more details\n-        cargo.env(\"RUSTC_EMIT_STACK_SIZES\", \"1\");\n         run_cargo(builder,\n                   &mut cargo,\n                   &libtest_stamp(builder, compiler, target),"}]}