{"sha": "5d170f0a3c3591b000a0400e7029fc8622144be2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVkMTcwZjBhM2MzNTkxYjAwMGEwNDAwZTcwMjlmYzg2MjIxNDRiZTI=", "commit": {"author": {"name": "Michael Hewson", "email": "michael@michaelhewson.ca", "date": "2017-11-09T14:56:14Z"}, "committer": {"name": "Michael Hewson", "email": "michael@michaelhewson.ca", "date": "2017-11-09T14:56:14Z"}, "message": "add a comment explaining the bugfix to infer::region_inference::add_constraint", "tree": {"sha": "9bb8929e7cc0c85fe660fb2bd062b847d4d32b35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9bb8929e7cc0c85fe660fb2bd062b847d4d32b35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5d170f0a3c3591b000a0400e7029fc8622144be2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5d170f0a3c3591b000a0400e7029fc8622144be2", "html_url": "https://github.com/rust-lang/rust/commit/5d170f0a3c3591b000a0400e7029fc8622144be2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5d170f0a3c3591b000a0400e7029fc8622144be2/comments", "author": {"login": "mikeyhew", "id": 6751033, "node_id": "MDQ6VXNlcjY3NTEwMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/6751033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikeyhew", "html_url": "https://github.com/mikeyhew", "followers_url": "https://api.github.com/users/mikeyhew/followers", "following_url": "https://api.github.com/users/mikeyhew/following{/other_user}", "gists_url": "https://api.github.com/users/mikeyhew/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikeyhew/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikeyhew/subscriptions", "organizations_url": "https://api.github.com/users/mikeyhew/orgs", "repos_url": "https://api.github.com/users/mikeyhew/repos", "events_url": "https://api.github.com/users/mikeyhew/events{/privacy}", "received_events_url": "https://api.github.com/users/mikeyhew/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mikeyhew", "id": 6751033, "node_id": "MDQ6VXNlcjY3NTEwMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/6751033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikeyhew", "html_url": "https://github.com/mikeyhew", "followers_url": "https://api.github.com/users/mikeyhew/followers", "following_url": "https://api.github.com/users/mikeyhew/following{/other_user}", "gists_url": "https://api.github.com/users/mikeyhew/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikeyhew/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikeyhew/subscriptions", "organizations_url": "https://api.github.com/users/mikeyhew/orgs", "repos_url": "https://api.github.com/users/mikeyhew/repos", "events_url": "https://api.github.com/users/mikeyhew/events{/privacy}", "received_events_url": "https://api.github.com/users/mikeyhew/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c046fda312b5a23dd2c531967b6ce241c9cf3d63", "url": "https://api.github.com/repos/rust-lang/rust/commits/c046fda312b5a23dd2c531967b6ce241c9cf3d63", "html_url": "https://github.com/rust-lang/rust/commit/c046fda312b5a23dd2c531967b6ce241c9cf3d63"}], "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "4c8a72512f1d0d868579a4c7f384adbbecaaf301", "filename": "src/librustc/infer/region_inference/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5d170f0a3c3591b000a0400e7029fc8622144be2/src%2Flibrustc%2Finfer%2Fregion_inference%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d170f0a3c3591b000a0400e7029fc8622144be2/src%2Flibrustc%2Finfer%2Fregion_inference%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fregion_inference%2Fmod.rs?ref=5d170f0a3c3591b000a0400e7029fc8622144be2", "patch": "@@ -633,6 +633,9 @@ impl<'a, 'gcx, 'tcx> RegionVarBindings<'a, 'gcx, 'tcx> {\n \n         debug!(\"RegionVarBindings: add_constraint({:?})\", constraint);\n \n+        // never overwrite an existing (constraint, origin) - only insert one if it isn't\n+        // present in the map yet. This prevents origins from outside the snapshot being\n+        // replaced with \"less informative\" origins e.g. during calls to `can_eq`\n         self.constraints.borrow_mut().entry(constraint).or_insert_with(|| {\n             if self.in_snapshot() {\n                 self.undo_log.borrow_mut().push(AddConstraint(constraint));"}]}