{"sha": "6e03a306ac44c6670064c68197df8813fe1cac06", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlMDNhMzA2YWM0NGM2NjcwMDY0YzY4MTk3ZGY4ODEzZmUxY2FjMDY=", "commit": {"author": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2021-04-18T00:46:13Z"}, "committer": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2021-05-20T13:03:31Z"}, "message": "Remove fix for rustc bug from `needless_borrow`\nThe spans given for derived traits used to not indicate they were from a macro expansion.", "tree": {"sha": "d7445d394868e36b2e1911466d25397673525c88", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d7445d394868e36b2e1911466d25397673525c88"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6e03a306ac44c6670064c68197df8813fe1cac06", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nComment: Created with Krypton\n\niF4EABYKAAYFAmCmXjMACgkQ2lnoZDo37QYRWgD/b/jARwKEXWIUT5fIGj00ZgLs\n25HSaurMtQuSZ05mzxcA+gJ5ru+vYIhVvSabKFVg9SeiJ6Ox5W2UC2bm7DSyiZ0B\n=6aCG\n-----END PGP SIGNATURE-----", "payload": "tree d7445d394868e36b2e1911466d25397673525c88\nparent 60826e77c3753e2d9d4b37228d2395dc7c171baf\nauthor Jason Newcomb <jsnewcomb@pm.me> 1618706773 -0400\ncommitter Jason Newcomb <jsnewcomb@pm.me> 1621515811 -0400\n\nRemove fix for rustc bug from `needless_borrow`\nThe spans given for derived traits used to not indicate they were from a macro expansion.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6e03a306ac44c6670064c68197df8813fe1cac06", "html_url": "https://github.com/rust-lang/rust/commit/6e03a306ac44c6670064c68197df8813fe1cac06", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6e03a306ac44c6670064c68197df8813fe1cac06/comments", "author": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60826e77c3753e2d9d4b37228d2395dc7c171baf", "url": "https://api.github.com/repos/rust-lang/rust/commits/60826e77c3753e2d9d4b37228d2395dc7c171baf", "html_url": "https://github.com/rust-lang/rust/commit/60826e77c3753e2d9d4b37228d2395dc7c171baf"}], "stats": {"total": 30, "additions": 5, "deletions": 25}, "files": [{"sha": "5cd7d5f14e35a8a425a1188205ca87e2d10aad24", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6e03a306ac44c6670064c68197df8813fe1cac06/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e03a306ac44c6670064c68197df8813fe1cac06/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=6e03a306ac44c6670064c68197df8813fe1cac06", "patch": "@@ -1890,7 +1890,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(|| box zero_div_zero::ZeroDiv);\n     store.register_late_pass(|| box mutex_atomic::Mutex);\n     store.register_late_pass(|| box needless_update::NeedlessUpdate);\n-    store.register_late_pass(|| box needless_borrow::NeedlessBorrow::default());\n+    store.register_late_pass(|| box needless_borrow::NeedlessBorrow);\n     store.register_late_pass(|| box needless_borrowed_ref::NeedlessBorrowedRef);\n     store.register_late_pass(|| box no_effect::NoEffect);\n     store.register_late_pass(|| box temporary_assignment::TemporaryAssignment);"}, {"sha": "3adbbfb8e89647b0ef43062f5ef37b9ef38ce03f", "filename": "clippy_lints/src/needless_borrow.rs", "status": "modified", "additions": 4, "deletions": 24, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/6e03a306ac44c6670064c68197df8813fe1cac06/clippy_lints%2Fsrc%2Fneedless_borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e03a306ac44c6670064c68197df8813fe1cac06/clippy_lints%2Fsrc%2Fneedless_borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_borrow.rs?ref=6e03a306ac44c6670064c68197df8813fe1cac06", "patch": "@@ -3,16 +3,14 @@\n //! This lint is **warn** by default\n \n use clippy_utils::diagnostics::span_lint_and_then;\n-use clippy_utils::is_automatically_derived;\n use clippy_utils::source::snippet_opt;\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n-use rustc_hir::{BindingAnnotation, BorrowKind, Expr, ExprKind, Item, Mutability, Pat, PatKind};\n+use rustc_hir::{BindingAnnotation, BorrowKind, Expr, ExprKind, Mutability, Pat, PatKind};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_middle::ty;\n use rustc_middle::ty::adjustment::{Adjust, Adjustment};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n-use rustc_span::def_id::LocalDefId;\n \n declare_clippy_lint! {\n     /// **What it does:** Checks for address of operations (`&`) that are going to\n@@ -37,15 +35,13 @@ declare_clippy_lint! {\n }\n \n #[derive(Default)]\n-pub struct NeedlessBorrow {\n-    derived_item: Option<LocalDefId>,\n-}\n+pub struct NeedlessBorrow;\n \n impl_lint_pass!(NeedlessBorrow => [NEEDLESS_BORROW]);\n \n impl<'tcx> LateLintPass<'tcx> for NeedlessBorrow {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, e: &'tcx Expr<'_>) {\n-        if e.span.from_expansion() || self.derived_item.is_some() {\n+        if e.span.from_expansion() {\n             return;\n         }\n         if let ExprKind::AddrOf(BorrowKind::Ref, Mutability::Not, inner) = e.kind {\n@@ -86,7 +82,7 @@ impl<'tcx> LateLintPass<'tcx> for NeedlessBorrow {\n         }\n     }\n     fn check_pat(&mut self, cx: &LateContext<'tcx>, pat: &'tcx Pat<'_>) {\n-        if pat.span.from_expansion() || self.derived_item.is_some() {\n+        if pat.span.from_expansion() {\n             return;\n         }\n         if_chain! {\n@@ -116,20 +112,4 @@ impl<'tcx> LateLintPass<'tcx> for NeedlessBorrow {\n             }\n         }\n     }\n-\n-    fn check_item(&mut self, cx: &LateContext<'tcx>, item: &'tcx Item<'_>) {\n-        let attrs = cx.tcx.hir().attrs(item.hir_id());\n-        if is_automatically_derived(attrs) {\n-            debug_assert!(self.derived_item.is_none());\n-            self.derived_item = Some(item.def_id);\n-        }\n-    }\n-\n-    fn check_item_post(&mut self, _: &LateContext<'tcx>, item: &'tcx Item<'_>) {\n-        if let Some(id) = self.derived_item {\n-            if item.def_id == id {\n-                self.derived_item = None;\n-            }\n-        }\n-    }\n }"}]}