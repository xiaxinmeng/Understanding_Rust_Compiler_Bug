{"sha": "a92e21c21542dbc6fe0511b461008471d92b2e85", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5MmUyMWMyMTU0MmRiYzZmZTA1MTFiNDYxMDA4NDcxZDkyYjJlODU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-12-22T16:07:34Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-12-22T18:11:47Z"}, "message": "Rollup merge of #56909 - dlrobertson:fix_56762, r=estebank\n\nstatic eval: Do not ICE on layout size overflow\n\nLayout size overflow and typeck eval errors are reported. Trigger a bug\nonly when the eval error is strictly labeled as TooGeneric.\n\nFixes: #56762", "tree": {"sha": "0ae2d8650ea5442874519ed4af563bb9579c6b16", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ae2d8650ea5442874519ed4af563bb9579c6b16"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a92e21c21542dbc6fe0511b461008471d92b2e85", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlwefmMACgkQ/vbIBR0O\nATxJfQ//SGc8LH3vqmGK81UfV+FY4ItbPeQF5VBsYs0VWAvIuv0UVykL0US6o+Qu\nIdK54trB2SumoLKl+HbipvbwU6jxTauvnUcXp9MW+hNBAaV5y3R7L4tRFg7gLhrg\nzbrxuI6uFBmMFN8my4pW7bBXKMOoI4nh7wlVBQ3VSEBzRYuLbOhPfqPAmoMiX4Pd\nQsEIHaX7+NvIOaG8ABggIvMb5PotgqQGVI+EjIR3ne6eSKtmEK7/DYGA7yPNZSUW\ntxPmPUOlkW6KOA7xIX/tji89HLRjKdgDloyEOIGGf67CKDGR3qJWtvqozowZx/ek\nX3IE8SKZfZlunM26E1vkEbozEeg7HhjeAcAMVUPx0rhWIZ92E36S//HihWMAXkS7\nZ46xyhDshq16/sT1QwSkgarng9quuqnf4DiXvqqUpjRgl+D3gG2V0FTJNEkdgCUY\nXyMYRJqSGdRtPzJKnib4lwAMlHnlqoDrhIi75HjGUDEdkxy84+ySgw27t0UrPPqy\nLMQQWtzOYdE29FR8/p1n/Zz54ALlVY4gUNRI34/no+ruBfVwpb0XQpqlsRSS+6F4\nsj3isE2g53TvVWTdMGrLgYjtm1pCIUsXgQ64qcZ8CscGuQO3RIwr+ePDhuPfIgb+\nWPmEgGKqbWw+MV1YjsbFUi486Rqh/3TqTKlg7lYBz6DWQpTS06k=\n=4He7\n-----END PGP SIGNATURE-----", "payload": "tree 0ae2d8650ea5442874519ed4af563bb9579c6b16\nparent 2d6927e9ee8238066bf78b0b42c755ed8aff5d4b\nparent e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4\nauthor kennytm <kennytm@gmail.com> 1545494854 +0800\ncommitter kennytm <kennytm@gmail.com> 1545502307 +0800\n\nRollup merge of #56909 - dlrobertson:fix_56762, r=estebank\n\nstatic eval: Do not ICE on layout size overflow\n\nLayout size overflow and typeck eval errors are reported. Trigger a bug\nonly when the eval error is strictly labeled as TooGeneric.\n\nFixes: #56762\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a92e21c21542dbc6fe0511b461008471d92b2e85", "html_url": "https://github.com/rust-lang/rust/commit/a92e21c21542dbc6fe0511b461008471d92b2e85", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a92e21c21542dbc6fe0511b461008471d92b2e85/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d6927e9ee8238066bf78b0b42c755ed8aff5d4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d6927e9ee8238066bf78b0b42c755ed8aff5d4b", "html_url": "https://github.com/rust-lang/rust/commit/2d6927e9ee8238066bf78b0b42c755ed8aff5d4b"}, {"sha": "e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "html_url": "https://github.com/rust-lang/rust/commit/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "d5bc83aba7b990d7298833cb35ea6fd8c3bc806a", "filename": "src/librustc_mir/const_eval.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a92e21c21542dbc6fe0511b461008471d92b2e85/src%2Flibrustc_mir%2Fconst_eval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a92e21c21542dbc6fe0511b461008471d92b2e85/src%2Flibrustc_mir%2Fconst_eval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fconst_eval.rs?ref=a92e21c21542dbc6fe0511b461008471d92b2e85", "patch": "@@ -692,12 +692,16 @@ pub fn const_eval_raw_provider<'a, 'tcx>(\n         let err = error_to_const_error(&ecx, error);\n         // errors in statics are always emitted as fatal errors\n         if tcx.is_static(def_id).is_some() {\n-            let err = err.report_as_error(ecx.tcx, \"could not evaluate static initializer\");\n-            // check that a static never produces `TooGeneric`\n+            let reported_err = err.report_as_error(ecx.tcx,\n+                                                   \"could not evaluate static initializer\");\n+            // Ensure that if the above error was either `TooGeneric` or `Reported`\n+            // an error must be reported.\n             if tcx.sess.err_count() == 0 {\n-                span_bug!(ecx.tcx.span, \"static eval failure didn't emit an error: {:#?}\", err);\n+                tcx.sess.delay_span_bug(err.span,\n+                                        &format!(\"static eval failure did not emit an error: {:#?}\",\n+                                                 reported_err));\n             }\n-            err\n+            reported_err\n         } else if def_id.is_local() {\n             // constant defined in this crate, we can figure out a lint level!\n             match tcx.describe_def(def_id) {"}, {"sha": "97b66b2c7c9236c250b18ec88c0e0f9fac57867f", "filename": "src/test/ui/issues/issue-56762.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a92e21c21542dbc6fe0511b461008471d92b2e85/src%2Ftest%2Fui%2Fissues%2Fissue-56762.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a92e21c21542dbc6fe0511b461008471d92b2e85/src%2Ftest%2Fui%2Fissues%2Fissue-56762.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-56762.rs?ref=a92e21c21542dbc6fe0511b461008471d92b2e85", "patch": "@@ -0,0 +1,18 @@\n+// only-x86_64\n+const HUGE_SIZE: usize = !0usize / 8;\n+\n+\n+pub struct TooBigArray {\n+    arr: [u8; HUGE_SIZE],\n+}\n+\n+impl TooBigArray {\n+    pub const fn new() -> Self {\n+        TooBigArray { arr: [0x00; HUGE_SIZE], }\n+    }\n+}\n+\n+static MY_TOO_BIG_ARRAY_1: TooBigArray = TooBigArray::new();\n+static MY_TOO_BIG_ARRAY_2: [u8; HUGE_SIZE] = [0x00; HUGE_SIZE];\n+\n+fn main() { }"}, {"sha": "83d5dc62e61618ce10a19e370df78706992692f5", "filename": "src/test/ui/issues/issue-56762.stderr", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a92e21c21542dbc6fe0511b461008471d92b2e85/src%2Ftest%2Fui%2Fissues%2Fissue-56762.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a92e21c21542dbc6fe0511b461008471d92b2e85/src%2Ftest%2Fui%2Fissues%2Fissue-56762.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-56762.stderr?ref=a92e21c21542dbc6fe0511b461008471d92b2e85", "patch": "@@ -0,0 +1,4 @@\n+error: the type `[u8; 2305843009213693951]` is too big for the current architecture\n+\n+error: aborting due to previous error\n+"}]}