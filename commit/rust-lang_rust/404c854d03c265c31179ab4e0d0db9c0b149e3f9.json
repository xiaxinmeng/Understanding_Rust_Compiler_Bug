{"sha": "404c854d03c265c31179ab4e0d0db9c0b149e3f9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwNGM4NTRkMDNjMjY1YzMxMTc5YWI0ZTBkMGRiOWMwYjE0OWUzZjk=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-06-18T23:52:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-06-18T23:52:04Z"}, "message": "Rollup merge of #61839 - alexcrichton:pr-and-master-builds, r=pietroalbini\n\nci: Add a script for generating CPU usage graphs\n\nThis commit checks in a script which generates CPU usage graphs over\ntime, expanding on the previous comment that was include in the\ncollection file.\n\nSome example graphs from the [latest build](https://dev.azure.com/rust-lang/rust/_build/results?buildId=717) look like:\n\n![dist-x86_64-apple](https://user-images.githubusercontent.com/64996/59520676-16c5b000-8e90-11e9-9188-27001911f270.png)\n\n![x86_64-msvc-1](https://user-images.githubusercontent.com/64996/59520677-175e4680-8e90-11e9-8568-4b564807324e.png)\n\n![x86_64-mingw-1](https://user-images.githubusercontent.com/64996/59520680-175e4680-8e90-11e9-939d-a73c7224582f.png)\n\n![test-various](https://user-images.githubusercontent.com/64996/59520682-175e4680-8e90-11e9-9980-900ed4eeb8f4.png)", "tree": {"sha": "33d2ec01a813d55e2cd408f9cdb152775ff285dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33d2ec01a813d55e2cd408f9cdb152775ff285dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/404c854d03c265c31179ab4e0d0db9c0b149e3f9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdCXkkCRBK7hj4Ov3rIwAAdHIIAJlw8kv2J36RL9cIGCX8XW+f\nw2jvvSIIh0QnDgSt9rFuppNIJwPogXuqbT6OAC5+Q3k9cnt+FqkoBNhizwx2Y7hc\nXn0TgqoYiGrEGF3W17dyveYcaQ6fkZ72MZSeNF685Ekxw5xNOHihsiTesrmTeM6y\nZ84oXV6Mk0PvtM0+3MgB6y5NI7ixsfYDEHlaW0FfDoOvyn4J+LkiK2y3XQmzWKqF\nm3sjt8LPC6XWaHXoeyPSDf5fQJi4SWEnmabAKUVl1JSrmPu8N969B3KlQBGIIjQR\nzDflYecgGcSrxsNzwxZrwXeCtCbmt0gTMIIHoh9uUOI/bnyVHSv8Y2RqXri7W3I=\n=QoXk\n-----END PGP SIGNATURE-----\n", "payload": "tree 33d2ec01a813d55e2cd408f9cdb152775ff285dd\nparent e416932bab05b70da73f0d7d9f6b751c433324fd\nparent 831ddf700d91b50ac8e3beffe35d7ee5f5dd5218\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1560901924 +0200\ncommitter GitHub <noreply@github.com> 1560901924 +0200\n\nRollup merge of #61839 - alexcrichton:pr-and-master-builds, r=pietroalbini\n\nci: Add a script for generating CPU usage graphs\n\nThis commit checks in a script which generates CPU usage graphs over\ntime, expanding on the previous comment that was include in the\ncollection file.\n\nSome example graphs from the [latest build](https://dev.azure.com/rust-lang/rust/_build/results?buildId=717) look like:\n\n![dist-x86_64-apple](https://user-images.githubusercontent.com/64996/59520676-16c5b000-8e90-11e9-9188-27001911f270.png)\n\n![x86_64-msvc-1](https://user-images.githubusercontent.com/64996/59520677-175e4680-8e90-11e9-8568-4b564807324e.png)\n\n![x86_64-mingw-1](https://user-images.githubusercontent.com/64996/59520680-175e4680-8e90-11e9-939d-a73c7224582f.png)\n\n![test-various](https://user-images.githubusercontent.com/64996/59520682-175e4680-8e90-11e9-9980-900ed4eeb8f4.png)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/404c854d03c265c31179ab4e0d0db9c0b149e3f9", "html_url": "https://github.com/rust-lang/rust/commit/404c854d03c265c31179ab4e0d0db9c0b149e3f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/404c854d03c265c31179ab4e0d0db9c0b149e3f9/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e416932bab05b70da73f0d7d9f6b751c433324fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/e416932bab05b70da73f0d7d9f6b751c433324fd", "html_url": "https://github.com/rust-lang/rust/commit/e416932bab05b70da73f0d7d9f6b751c433324fd"}, {"sha": "831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "url": "https://api.github.com/repos/rust-lang/rust/commits/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "html_url": "https://github.com/rust-lang/rust/commit/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218"}], "stats": {"total": 68, "additions": 51, "deletions": 17}, "files": [{"sha": "daf21670b33391d49cbe9f26d6c7fd7b347f6943", "filename": "src/ci/cpu-usage-over-time.py", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/404c854d03c265c31179ab4e0d0db9c0b149e3f9/src%2Fci%2Fcpu-usage-over-time.py", "raw_url": "https://github.com/rust-lang/rust/raw/404c854d03c265c31179ab4e0d0db9c0b149e3f9/src%2Fci%2Fcpu-usage-over-time.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fcpu-usage-over-time.py?ref=404c854d03c265c31179ab4e0d0db9c0b149e3f9", "patch": "@@ -30,23 +30,8 @@\n # the second column is always zero.\n #\n # Once you've downloaded a file there's various ways to plot it and visualize\n-# it. For command line usage you can use a script like so:\n-#\n-#      set timefmt '%Y-%m-%dT%H:%M:%S'\n-#      set xdata time\n-#      set ylabel \"Idle CPU %\"\n-#      set xlabel \"Time\"\n-#      set datafile sep ','\n-#      set term png\n-#      set output \"printme.png\"\n-#      set grid\n-#      builder = \"i686-apple\"\n-#      plot \"cpu-\".builder.\".csv\" using 1:2 with lines title builder\n-#\n-# Executed as `gnuplot < ./foo.plot` it will generate a graph called\n-# `printme.png` which you can then open up. If you know how to improve this\n-# script or the viewing process that would be much appreciated :) (or even if\n-# you know how to automate it!)\n+# it. For command line usage you use the `src/etc/cpu-usage-over-time-plot.sh`\n+# script in this repository.\n \n import datetime\n import sys"}, {"sha": "724a21c3fc2697838c3336ca04ecc62955d1b828", "filename": "src/etc/cpu-usage-over-time-plot.sh", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/404c854d03c265c31179ab4e0d0db9c0b149e3f9/src%2Fetc%2Fcpu-usage-over-time-plot.sh", "raw_url": "https://github.com/rust-lang/rust/raw/404c854d03c265c31179ab4e0d0db9c0b149e3f9/src%2Fetc%2Fcpu-usage-over-time-plot.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fcpu-usage-over-time-plot.sh?ref=404c854d03c265c31179ab4e0d0db9c0b149e3f9", "patch": "@@ -0,0 +1,49 @@\n+#!/bin/bash\n+\n+# A small script to help visualizing CPU usage over time data collected on CI\n+# using `gnuplot`.\n+#\n+# This script is expected to be called with two arguments. The first is the full\n+# commit SHA of the build you're interested in, and the second is the name of\n+# the builder. For example:\n+#\n+#  ./src/etc/cpu-usage-over-time-plot.sh e699ea096fcc2fc9ce8e8bcf884e11496a31cc9f i686-mingw-1\n+#\n+# That will generate `$builder.png` in the current directory which you can open\n+# up to see a hopefully pretty graph.\n+#\n+# Improvements to this script are greatly appreciated!\n+\n+set -ex\n+\n+bucket=rust-lang-ci-evalazure\n+commit=$1\n+builder=$2\n+\n+curl -O https://$bucket.s3.amazonaws.com/rustc-builds/$commit/cpu-$builder.csv\n+\n+gnuplot <<-EOF\n+reset\n+set timefmt '%Y-%m-%dT%H:%M:%S'\n+set xdata time\n+set ylabel \"CPU Usage %\"\n+set xlabel \"Time\"\n+set datafile sep ','\n+set term png size 3000,1000\n+set output \"$builder.png\"\n+set grid\n+\n+f(x) = mean_y\n+fit f(x) 'cpu-$builder.csv' using 1:(100-\\$2) via mean_y\n+\n+set label 1 gprintf(\"Average = %g%%\", mean_y) center font \",18\"\n+set label 1 at graph 0.50, 0.25\n+set xtics rotate by 45 offset -2,-2.4 300\n+set ytics 10\n+set boxwidth 0.5\n+\n+plot \\\\\n+   mean_y with lines linetype 1 linecolor rgb \"#ff0000\" title \"average\", \\\\\n+   \"cpu-$builder.csv\" using 1:(100-\\$2) with points pointtype 7 pointsize 0.4 title \"$builder\", \\\\\n+   \"\" using 1:(100-\\$2) smooth bezier linewidth 3 title \"bezier\"\n+EOF"}]}