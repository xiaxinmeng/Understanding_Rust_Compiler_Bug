{"sha": "6b6cc5d5764e83a122f24d966a59a60cee871633", "node_id": "C_kwDOAAsO6NoAKDZiNmNjNWQ1NzY0ZTgzYTEyMmYyNGQ5NjZhNTlhNjBjZWU4NzE2MzM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-14T21:15:22Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-14T21:15:22Z"}, "message": "Auto merge of #91728 - Amanieu:stable_asm, r=joshtriplett\n\nStabilize asm! and global_asm!\n\nTracking issue: #72016\n\nIt's been almost 2 years since the original [RFC](https://github.com/rust-lang/rfcs/pull/2850) was posted and we're finally ready to stabilize this feature!\n\nThe main changes in this PR are:\n- Removing `asm!` and `global_asm!` from the prelude as per the decision in #87228.\n- Stabilizing the `asm` and `global_asm` features.\n- Removing the unstable book pages for `asm` and `global_asm`. The contents are moved to the [reference](https://github.com/rust-lang/reference/pull/1105) and [rust by example](https://github.com/rust-lang/rust-by-example/pull/1483).\n  - All links to these pages have been removed to satisfy the link checker. In a later PR these will be replaced with links to the reference or rust by example.\n- Removing the automatic suggestion for using `llvm_asm!` instead of `asm!` if you're still using the old syntax, since it doesn't work anymore with `asm!` no longer being in the prelude. This only affects code that predates the old LLVM-style `asm!` being renamed to `llvm_asm!`.\n- Updating `stdarch` and `compiler-builtins`.\n- Updating all the tests.\n\nr? `@joshtriplett`", "tree": {"sha": "7b873408e3f6b2d065dd0b89e2a87c79dac51858", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7b873408e3f6b2d065dd0b89e2a87c79dac51858"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b6cc5d5764e83a122f24d966a59a60cee871633", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b6cc5d5764e83a122f24d966a59a60cee871633", "html_url": "https://github.com/rust-lang/rust/commit/6b6cc5d5764e83a122f24d966a59a60cee871633", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b6cc5d5764e83a122f24d966a59a60cee871633/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41c48bd390c6aa43d9567bc11710d67ab41930fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/41c48bd390c6aa43d9567bc11710d67ab41930fc", "html_url": "https://github.com/rust-lang/rust/commit/41c48bd390c6aa43d9567bc11710d67ab41930fc"}, {"sha": "e1139cf570a7156ef53441db256a2350ef2b5b89", "url": "https://api.github.com/repos/rust-lang/rust/commits/e1139cf570a7156ef53441db256a2350ef2b5b89", "html_url": "https://github.com/rust-lang/rust/commit/e1139cf570a7156ef53441db256a2350ef2b5b89"}], "stats": {"total": 65, "additions": 33, "deletions": 32}, "files": [{"sha": "0220bf3331f5b0664b66d2a56a884353f5c23b96", "filename": "tests/ui/asm_syntax.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fasm_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fasm_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasm_syntax.rs?ref=6b6cc5d5764e83a122f24d966a59a60cee871633", "patch": "@@ -1,11 +1,10 @@\n // only-x86_64\n // ignore-aarch64\n \n-#![feature(asm)]\n-\n #[warn(clippy::inline_asm_x86_intel_syntax)]\n mod warn_intel {\n     pub(super) unsafe fn use_asm() {\n+        use std::arch::asm;\n         asm!(\"\");\n         asm!(\"\", options());\n         asm!(\"\", options(nostack));\n@@ -17,6 +16,7 @@ mod warn_intel {\n #[warn(clippy::inline_asm_x86_att_syntax)]\n mod warn_att {\n     pub(super) unsafe fn use_asm() {\n+        use std::arch::asm;\n         asm!(\"\");\n         asm!(\"\", options());\n         asm!(\"\", options(nostack));"}, {"sha": "e9b150121aa31edb0ea54af01c7831cb3039858b", "filename": "tests/ui/asm_syntax.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fasm_syntax.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fasm_syntax.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasm_syntax.stderr?ref=6b6cc5d5764e83a122f24d966a59a60cee871633", "patch": "@@ -1,5 +1,5 @@\n error: Intel x86 assembly syntax used\n-  --> $DIR/asm_syntax.rs:9:9\n+  --> $DIR/asm_syntax.rs:8:9\n    |\n LL |         asm!(\"\");\n    |         ^^^^^^^^\n@@ -8,15 +8,15 @@ LL |         asm!(\"\");\n    = help: use AT&T x86 assembly syntax\n \n error: Intel x86 assembly syntax used\n-  --> $DIR/asm_syntax.rs:10:9\n+  --> $DIR/asm_syntax.rs:9:9\n    |\n LL |         asm!(\"\", options());\n    |         ^^^^^^^^^^^^^^^^^^^\n    |\n    = help: use AT&T x86 assembly syntax\n \n error: Intel x86 assembly syntax used\n-  --> $DIR/asm_syntax.rs:11:9\n+  --> $DIR/asm_syntax.rs:10:9\n    |\n LL |         asm!(\"\", options(nostack));\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^"}, {"sha": "e43635abcd112fcebf173130d56aaab75e474876", "filename": "tests/ui/entry.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fentry.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fentry.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fentry.fixed?ref=6b6cc5d5764e83a122f24d966a59a60cee871633", "patch": "@@ -2,8 +2,8 @@\n \n #![allow(unused, clippy::needless_pass_by_value, clippy::collapsible_if)]\n #![warn(clippy::map_entry)]\n-#![feature(asm)]\n \n+use std::arch::asm;\n use std::collections::HashMap;\n use std::hash::Hash;\n "}, {"sha": "d999b3b7dc80d8125ed5ce1fe56fe92c3cc59dd5", "filename": "tests/ui/entry.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fentry.rs?ref=6b6cc5d5764e83a122f24d966a59a60cee871633", "patch": "@@ -2,8 +2,8 @@\n \n #![allow(unused, clippy::needless_pass_by_value, clippy::collapsible_if)]\n #![warn(clippy::map_entry)]\n-#![feature(asm)]\n \n+use std::arch::asm;\n use std::collections::HashMap;\n use std::hash::Hash;\n "}, {"sha": "6e2e710e21c84026b5e15c10e64fe9bbeef430af", "filename": "tests/ui/missing-doc.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fmissing-doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fmissing-doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing-doc.rs?ref=6b6cc5d5764e83a122f24d966a59a60cee871633", "patch": "@@ -2,10 +2,11 @@\n // When denying at the crate level, be sure to not get random warnings from the\n // injected intrinsics by the compiler.\n #![allow(dead_code)]\n-#![feature(global_asm)]\n //! Some garbage docs for the crate here\n #![doc = \"More garbage\"]\n \n+use std::arch::global_asm;\n+\n type Typedef = String;\n pub type PubTypedef = String;\n "}, {"sha": "a876dc078ebff96f25c8e34efad90156b896a70a", "filename": "tests/ui/missing-doc.stderr", "status": "modified", "additions": 24, "deletions": 24, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fmissing-doc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b6cc5d5764e83a122f24d966a59a60cee871633/tests%2Fui%2Fmissing-doc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing-doc.stderr?ref=6b6cc5d5764e83a122f24d966a59a60cee871633", "patch": "@@ -1,43 +1,43 @@\n error: missing documentation for a type alias\n-  --> $DIR/missing-doc.rs:9:1\n+  --> $DIR/missing-doc.rs:10:1\n    |\n LL | type Typedef = String;\n    | ^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: `-D clippy::missing-docs-in-private-items` implied by `-D warnings`\n \n error: missing documentation for a type alias\n-  --> $DIR/missing-doc.rs:10:1\n+  --> $DIR/missing-doc.rs:11:1\n    |\n LL | pub type PubTypedef = String;\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a module\n-  --> $DIR/missing-doc.rs:12:1\n+  --> $DIR/missing-doc.rs:13:1\n    |\n LL | mod module_no_dox {}\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a module\n-  --> $DIR/missing-doc.rs:13:1\n+  --> $DIR/missing-doc.rs:14:1\n    |\n LL | pub mod pub_module_no_dox {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/missing-doc.rs:17:1\n+  --> $DIR/missing-doc.rs:18:1\n    |\n LL | pub fn foo2() {}\n    | ^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/missing-doc.rs:18:1\n+  --> $DIR/missing-doc.rs:19:1\n    |\n LL | fn foo3() {}\n    | ^^^^^^^^^^^^\n \n error: missing documentation for an enum\n-  --> $DIR/missing-doc.rs:32:1\n+  --> $DIR/missing-doc.rs:33:1\n    |\n LL | / enum Baz {\n LL | |     BazA { a: isize, b: isize },\n@@ -46,75 +46,75 @@ LL | | }\n    | |_^\n \n error: missing documentation for a variant\n-  --> $DIR/missing-doc.rs:33:5\n+  --> $DIR/missing-doc.rs:34:5\n    |\n LL |     BazA { a: isize, b: isize },\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a struct field\n-  --> $DIR/missing-doc.rs:33:12\n+  --> $DIR/missing-doc.rs:34:12\n    |\n LL |     BazA { a: isize, b: isize },\n    |            ^^^^^^^^\n \n error: missing documentation for a struct field\n-  --> $DIR/missing-doc.rs:33:22\n+  --> $DIR/missing-doc.rs:34:22\n    |\n LL |     BazA { a: isize, b: isize },\n    |                      ^^^^^^^^\n \n error: missing documentation for a variant\n-  --> $DIR/missing-doc.rs:34:5\n+  --> $DIR/missing-doc.rs:35:5\n    |\n LL |     BarB,\n    |     ^^^^\n \n error: missing documentation for an enum\n-  --> $DIR/missing-doc.rs:37:1\n+  --> $DIR/missing-doc.rs:38:1\n    |\n LL | / pub enum PubBaz {\n LL | |     PubBazA { a: isize },\n LL | | }\n    | |_^\n \n error: missing documentation for a variant\n-  --> $DIR/missing-doc.rs:38:5\n+  --> $DIR/missing-doc.rs:39:5\n    |\n LL |     PubBazA { a: isize },\n    |     ^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a struct field\n-  --> $DIR/missing-doc.rs:38:15\n+  --> $DIR/missing-doc.rs:39:15\n    |\n LL |     PubBazA { a: isize },\n    |               ^^^^^^^^\n \n error: missing documentation for a constant\n-  --> $DIR/missing-doc.rs:58:1\n+  --> $DIR/missing-doc.rs:59:1\n    |\n LL | const FOO: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a constant\n-  --> $DIR/missing-doc.rs:65:1\n+  --> $DIR/missing-doc.rs:66:1\n    |\n LL | pub const FOO4: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a static\n-  --> $DIR/missing-doc.rs:67:1\n+  --> $DIR/missing-doc.rs:68:1\n    |\n LL | static BAR: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a static\n-  --> $DIR/missing-doc.rs:74:1\n+  --> $DIR/missing-doc.rs:75:1\n    |\n LL | pub static BAR4: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a module\n-  --> $DIR/missing-doc.rs:76:1\n+  --> $DIR/missing-doc.rs:77:1\n    |\n LL | / mod internal_impl {\n LL | |     /// dox\n@@ -126,31 +126,31 @@ LL | | }\n    | |_^\n \n error: missing documentation for a function\n-  --> $DIR/missing-doc.rs:79:5\n+  --> $DIR/missing-doc.rs:80:5\n    |\n LL |     pub fn undocumented1() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/missing-doc.rs:80:5\n+  --> $DIR/missing-doc.rs:81:5\n    |\n LL |     pub fn undocumented2() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/missing-doc.rs:81:5\n+  --> $DIR/missing-doc.rs:82:5\n    |\n LL |     fn undocumented3() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/missing-doc.rs:86:9\n+  --> $DIR/missing-doc.rs:87:9\n    |\n LL |         pub fn also_undocumented1() {}\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/missing-doc.rs:87:9\n+  --> $DIR/missing-doc.rs:88:9\n    |\n LL |         fn also_undocumented2() {}\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^"}]}