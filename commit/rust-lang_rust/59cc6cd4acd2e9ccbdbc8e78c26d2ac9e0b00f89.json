{"sha": "59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89", "node_id": "C_kwDOAAsO6NoAKDU5Y2M2Y2Q0YWNkMmU5Y2NiZGJjOGU3OGMyNmQyYWM5ZTBiMDBmODk", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-12-03T09:23:03Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-12-03T09:23:03Z"}, "message": "Remove useless filter in unused extern crate check.", "tree": {"sha": "87751554430b23a2fa06411b147388a129e164dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87751554430b23a2fa06411b147388a129e164dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89", "html_url": "https://github.com/rust-lang/rust/commit/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "24f2704e96c9d3a4f887d2d0a7d79ecffd79bd65", "url": "https://api.github.com/repos/rust-lang/rust/commits/24f2704e96c9d3a4f887d2d0a7d79ecffd79bd65", "html_url": "https://github.com/rust-lang/rust/commit/24f2704e96c9d3a4f887d2d0a7d79ecffd79bd65"}], "stats": {"total": 41, "additions": 22, "deletions": 19}, "files": [{"sha": "5749b04783ce4ff8c7608e83771a3754471fffe4", "filename": "compiler/rustc_hir_analysis/src/check_unused.rs", "status": "modified", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck_unused.rs?ref=59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89", "patch": "@@ -56,25 +56,6 @@ fn unused_crates_lint(tcx: TyCtxt<'_>) {\n     let unused_extern_crates: FxHashMap<LocalDefId, Span> = tcx\n         .maybe_unused_extern_crates(())\n         .iter()\n-        .filter(|&&(def_id, _)| {\n-            // The `def_id` here actually was calculated during resolution (at least\n-            // at the time of this writing) and is being shipped to us via a side\n-            // channel of the tcx. There may have been extra expansion phases,\n-            // however, which ended up removing the `def_id` *after* expansion.\n-            //\n-            // As a result we need to verify that `def_id` is indeed still valid for\n-            // our AST and actually present in the HIR map. If it's not there then\n-            // there's safely nothing to warn about, and otherwise we carry on with\n-            // our execution.\n-            //\n-            // Note that if we carry through to the `extern_mod_stmt_cnum` query\n-            // below it'll cause a panic because `def_id` is actually bogus at this\n-            // point in time otherwise.\n-            if tcx.hir().find(tcx.hir().local_def_id_to_hir_id(def_id)).is_none() {\n-                return false;\n-            }\n-            true\n-        })\n         .filter(|&&(def_id, _)| {\n             tcx.extern_mod_stmt_cnum(def_id).map_or(true, |cnum| {\n                 !tcx.is_compiler_builtins(cnum)"}, {"sha": "70dcd5413f1ee0b2a445e4cedd3058f9326b881f", "filename": "src/test/ui/attributes/unused-item-in-attr.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89/src%2Ftest%2Fui%2Fattributes%2Funused-item-in-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89/src%2Ftest%2Fui%2Fattributes%2Funused-item-in-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Funused-item-in-attr.rs?ref=59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89", "patch": "@@ -0,0 +1,6 @@\n+#[w = { extern crate alloc; }]\n+//~^ ERROR unexpected expression: `{\n+//~| ERROR cannot find attribute `w` in this scope\n+fn f() {}\n+\n+fn main() {}"}, {"sha": "92a8f58582136a05f808b34a53f3d5d0b1d7a89d", "filename": "src/test/ui/attributes/unused-item-in-attr.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89/src%2Ftest%2Fui%2Fattributes%2Funused-item-in-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89/src%2Ftest%2Fui%2Fattributes%2Funused-item-in-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Funused-item-in-attr.stderr?ref=59cc6cd4acd2e9ccbdbc8e78c26d2ac9e0b00f89", "patch": "@@ -0,0 +1,16 @@\n+error: unexpected expression: `{\n+           extern crate alloc;\n+       }`\n+  --> $DIR/unused-item-in-attr.rs:1:7\n+   |\n+LL | #[w = { extern crate alloc; }]\n+   |       ^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cannot find attribute `w` in this scope\n+  --> $DIR/unused-item-in-attr.rs:1:3\n+   |\n+LL | #[w = { extern crate alloc; }]\n+   |   ^\n+\n+error: aborting due to 2 previous errors\n+"}]}