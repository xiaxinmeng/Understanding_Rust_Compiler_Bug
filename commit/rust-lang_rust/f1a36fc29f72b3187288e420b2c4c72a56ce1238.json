{"sha": "f1a36fc29f72b3187288e420b2c4c72a56ce1238", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxYTM2ZmMyOWY3MmIzMTg3Mjg4ZTQyMGIyYzRjNzJhNTZjZTEyMzg=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-05T23:07:24Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-06T04:56:24Z"}, "message": "Rollup merge of #52080 - oli-obk:dep_dedup_diagnostics, r=kennytm\n\nImprove dependency deduplication diagnostics\n\nr? @kennytm\n\nthis is obviously hard to test :laughing:\n\ncc #52072", "tree": {"sha": "161d1349785fd470c37f45415d8830096415b1de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/161d1349785fd470c37f45415d8830096415b1de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1a36fc29f72b3187288e420b2c4c72a56ce1238", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAls+9nkACgkQ/vbIBR0O\nATxIrg//UoSS9b6dQBCgCusiye1PBed0An9zOsRQMGugqdim3TayUgw5fTA39VgL\nppg51JdgTbXGEHwDFLWhlH1289EGcUsTTXYancJzRN3p4xxnaZBJEyUy5kX+q442\nR0PKpRHgMiS7F+h4tToQ4dY7u2siIiKloMf0FMy0ub8mHdCYkwo4VIPCfwpXc594\nUD2dkNedUaH+sOpKJNp4I8mg/mNQotI233BJNdR1L3ota+3TmXIXveyMBLXxLzkw\n0f6hp4PIB0whJFPVhrLNokEeRasECYn8cEhsDwNDjaxJCTl61bbb0DAMxhhk+ZoH\nn08xokwIllVsnARxiit7hLGYi9juAEvNh/Xuz8VwF+yeFx6uIHWY1QGvRaEy4aHE\nbGWSkLBkmxRK3DiZ71EH4YPt4yg1DVI1GXw3659W3ROXigeEFmthbp+rNEQ7Nu3l\n76OzS9bp0PpiH6z1v/Wf7lqngcxvi1yjwKvBS11mG532yndKImPdNxcgravSwDoz\ndoVpJp6NyTzbu98O9B6pmLmJIuBxX2rM+78W892VfePsTL2offtw8+1TCkegIdkE\n83bjczJCiurD7l2cExLgC34Dfj23QDOQFZk5a22RR98Sr1Z3Xzku6yH7NGt/lfcM\n3MnkG+RwGeh1xy3xTrnxoebrQNvCGcAz87UanbggpME1PZhK0yY=\n=rNua\n-----END PGP SIGNATURE-----", "payload": "tree 161d1349785fd470c37f45415d8830096415b1de\nparent 596d1a782d6debf0185c9908d3fa064fc7811a85\nparent f352e98ddc17a992d724053e89479e0fbf080343\nauthor kennytm <kennytm@gmail.com> 1530832044 +0800\ncommitter kennytm <kennytm@gmail.com> 1530852984 +0800\n\nRollup merge of #52080 - oli-obk:dep_dedup_diagnostics, r=kennytm\n\nImprove dependency deduplication diagnostics\n\nr? @kennytm\n\nthis is obviously hard to test :laughing:\n\ncc #52072\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1a36fc29f72b3187288e420b2c4c72a56ce1238", "html_url": "https://github.com/rust-lang/rust/commit/f1a36fc29f72b3187288e420b2c4c72a56ce1238", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1a36fc29f72b3187288e420b2c4c72a56ce1238/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "596d1a782d6debf0185c9908d3fa064fc7811a85", "url": "https://api.github.com/repos/rust-lang/rust/commits/596d1a782d6debf0185c9908d3fa064fc7811a85", "html_url": "https://github.com/rust-lang/rust/commit/596d1a782d6debf0185c9908d3fa064fc7811a85"}, {"sha": "f352e98ddc17a992d724053e89479e0fbf080343", "url": "https://api.github.com/repos/rust-lang/rust/commits/f352e98ddc17a992d724053e89479e0fbf080343", "html_url": "https://github.com/rust-lang/rust/commit/f352e98ddc17a992d724053e89479e0fbf080343"}], "stats": {"total": 29, "additions": 23, "deletions": 6}, "files": [{"sha": "168cbde7e0d1357c44cdb736dc84565867805707", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f1a36fc29f72b3187288e420b2c4c72a56ce1238/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1a36fc29f72b3187288e420b2c4c72a56ce1238/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=f1a36fc29f72b3187288e420b2c4c72a56ce1238", "patch": "@@ -115,6 +115,7 @@\n \n #![deny(warnings)]\n #![feature(core_intrinsics)]\n+#![feature(drain_filter)]\n \n #[macro_use]\n extern crate build_helper;"}, {"sha": "b3d7b9a91ecfe34e4ffecfbbc222cb11df095369", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 22, "deletions": 6, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/f1a36fc29f72b3187288e420b2c4c72a56ce1238/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1a36fc29f72b3187288e420b2c4c72a56ce1238/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=f1a36fc29f72b3187288e420b2c4c72a56ce1238", "patch": "@@ -13,6 +13,7 @@ use std::env;\n use std::iter;\n use std::path::PathBuf;\n use std::process::{Command, exit};\n+use std::collections::HashSet;\n \n use Mode;\n use Compiler;\n@@ -122,8 +123,13 @@ impl Step for ToolBuild {\n         let mut duplicates = Vec::new();\n         let is_expected = compile::stream_cargo(builder, &mut cargo, &mut |msg| {\n             // Only care about big things like the RLS/Cargo for now\n-            if tool != \"rls\" && tool != \"cargo\" && tool != \"clippy-driver\" {\n-                return\n+            match tool {\n+                | \"rls\"\n+                | \"cargo\"\n+                | \"clippy-driver\"\n+                => {}\n+\n+                _ => return,\n             }\n             let (id, features, filenames) = match msg {\n                 compile::CargoMessage::CompilerArtifact {\n@@ -182,12 +188,22 @@ impl Step for ToolBuild {\n                       typically means that something was recompiled because \\\n                       a transitive dependency has different features activated \\\n                       than in a previous build:\\n\");\n+            println!(\"the following dependencies are duplicated although they \\\n+                      have the same features enabled:\");\n+            for (id, cur, prev) in duplicates.drain_filter(|(_, cur, prev)| cur.2 == prev.2) {\n+                println!(\"  {}\", id);\n+                // same features\n+                println!(\"    `{}` ({:?})\\n    `{}` ({:?})\", cur.0, cur.1, prev.0, prev.1);\n+            }\n+            println!(\"the following dependencies have different features:\");\n             for (id, cur, prev) in duplicates {\n                 println!(\"  {}\", id);\n-                println!(\"    `{}` enabled features {:?} at {:?}\",\n-                         cur.0, cur.2, cur.1);\n-                println!(\"    `{}` enabled features {:?} at {:?}\",\n-                         prev.0, prev.2, prev.1);\n+                let cur_features: HashSet<_> = cur.2.into_iter().collect();\n+                let prev_features: HashSet<_> = prev.2.into_iter().collect();\n+                println!(\"    `{}` additionally enabled features {:?} at {:?}\",\n+                         cur.0, &cur_features - &prev_features, cur.1);\n+                println!(\"    `{}` additionally enabled features {:?} at {:?}\",\n+                         prev.0, &prev_features - &cur_features, prev.1);\n             }\n             println!(\"\");\n             panic!(\"tools should not compile multiple copies of the same crate\");"}]}