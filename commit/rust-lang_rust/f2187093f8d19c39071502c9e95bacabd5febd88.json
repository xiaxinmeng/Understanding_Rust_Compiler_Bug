{"sha": "f2187093f8d19c39071502c9e95bacabd5febd88", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyMTg3MDkzZjhkMTljMzkwNzE1MDJjOWU5NWJhY2FiZDVmZWJkODg=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2017-02-23T15:49:54Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2017-03-04T18:38:26Z"}, "message": "Add/remove `rerun-if-changed` when necessary", "tree": {"sha": "4efd7d05f0d84e92697647dfab27e2dfffabe9e7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4efd7d05f0d84e92697647dfab27e2dfffabe9e7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2187093f8d19c39071502c9e95bacabd5febd88", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2187093f8d19c39071502c9e95bacabd5febd88", "html_url": "https://github.com/rust-lang/rust/commit/f2187093f8d19c39071502c9e95bacabd5febd88", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2187093f8d19c39071502c9e95bacabd5febd88/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83cbaf5e66752018e5bf0207b2b34f0e6be4227e", "url": "https://api.github.com/repos/rust-lang/rust/commits/83cbaf5e66752018e5bf0207b2b34f0e6be4227e", "html_url": "https://github.com/rust-lang/rust/commit/83cbaf5e66752018e5bf0207b2b34f0e6be4227e"}], "stats": {"total": 29, "additions": 13, "deletions": 16}, "files": [{"sha": "e7fa572fa3ad3cbef32c86a2ad46200bdcef9c53", "filename": "src/Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -221,6 +221,7 @@ dependencies = [\n name = \"compiler_builtins\"\n version = \"0.0.0\"\n dependencies = [\n+ \"build_helper 0.1.0\",\n  \"core 0.0.0\",\n  \"gcc 0.3.43 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]"}, {"sha": "cd2e8e4ec20fa1f9f1157c433bebc6a2567ba416", "filename": "src/liballoc_jemalloc/build.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Fliballoc_jemalloc%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Fliballoc_jemalloc%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_jemalloc%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -21,8 +21,6 @@ use std::process::Command;\n use build_helper::{run, rerun_if_changed_anything_in_dir, up_to_date};\n \n fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-\n     // FIXME: This is a hack to support building targets that don't\n     // support jemalloc alongside hosts that do. The jemalloc build is\n     // controlled by a feature of the std crate, and if that feature"}, {"sha": "3f844b3f09e3a28648d4c3b76b30e3a9cb1f3c59", "filename": "src/libcompiler_builtins/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibcompiler_builtins%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibcompiler_builtins%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcompiler_builtins%2FCargo.toml?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -15,4 +15,5 @@ doc = false\n core = { path = \"../libcore\" }\n \n [build-dependencies]\n+build_helper = { path = \"../build_helper\" }\n gcc = \"0.3.27\""}, {"sha": "564404ca71d613cc5e495bb373dcad51d81858ae", "filename": "src/libcompiler_builtins/build.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibcompiler_builtins%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibcompiler_builtins%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcompiler_builtins%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -33,6 +33,7 @@\n //! error (if any) and then we just add it to the list. Overall, that cost is\n //! far far less than working with compiler-rt's build system over time.\n \n+extern crate build_helper;\n extern crate gcc;\n \n use std::collections::BTreeMap;\n@@ -404,5 +405,8 @@ fn main() {\n         cfg.file(Path::new(\"../compiler-rt/lib/builtins\").join(src));\n     }\n \n+    // Can't reuse `sources` list becuse it doesn't contain header files.\n+    build_helper::rerun_if_changed_anything_in_dir(Path::new(\"../compiler-rt\"));\n+\n     cfg.compile(\"libcompiler-rt.a\");\n }"}, {"sha": "78d2ef1e37d2ac16111f4a71a1ea33bf926bfd1a", "filename": "src/libflate/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibflate%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibflate%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibflate%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -11,6 +11,7 @@\n extern crate gcc;\n \n fn main() {\n+    println!(\"cargo:rerun-if-changed=../rt/miniz.c\");\n     gcc::Config::new()\n         .file(\"../rt/miniz.c\")\n         .compile(\"libminiz.a\");"}, {"sha": "3e95e0dbebefa452f908c2bef3181cd23d0f4a40", "filename": "src/librustc_asan/build.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_asan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_asan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_asan%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -34,6 +34,4 @@ fn main() {\n                 .unwrap())\n             .join(\"../compiler-rt\"));\n     }\n-\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n }"}, {"sha": "b74bccb70593f7517e5d5a5838a78b11300359f1", "filename": "src/librustc_llvm/build.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -144,9 +144,7 @@ fn main() {\n         cfg.flag(\"-DLLVM_RUSTLLVM\");\n     }\n \n-    println!(\"cargo:rerun-if-changed=../rustllvm/PassWrapper.cpp\");\n-    println!(\"cargo:rerun-if-changed=../rustllvm/RustWrapper.cpp\");\n-    println!(\"cargo:rerun-if-changed=../rustllvm/ArchiveWrapper.cpp\");\n+    build_helper::rerun_if_changed_anything_in_dir(Path::new(\"../rustllvm\"));\n     cfg.file(\"../rustllvm/PassWrapper.cpp\")\n        .file(\"../rustllvm/RustWrapper.cpp\")\n        .file(\"../rustllvm/ArchiveWrapper.cpp\")"}, {"sha": "ec968f51184fe2ecf4630a1e243c02c652cfde0d", "filename": "src/librustc_lsan/build.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_lsan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_lsan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lsan%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -34,6 +34,4 @@ fn main() {\n                 .unwrap())\n             .join(\"../compiler-rt\"));\n     }\n-\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n }"}, {"sha": "466fa641deabb4f3b1328acd6173447578fba351", "filename": "src/librustc_msan/build.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_msan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_msan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_msan%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -34,6 +34,4 @@ fn main() {\n                 .unwrap())\n             .join(\"../compiler-rt\"));\n     }\n-\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n }"}, {"sha": "95ce237b267354d80849e39851b7f6a825312f55", "filename": "src/librustc_tsan/build.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_tsan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustc_tsan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_tsan%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -34,6 +34,4 @@ fn main() {\n                 .unwrap())\n             .join(\"../compiler-rt\"));\n     }\n-\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n }"}, {"sha": "9fa6406c1d8b69d14175484997cf569f76eec5f1", "filename": "src/librustdoc/build.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustdoc%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibrustdoc%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -8,9 +8,12 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+extern crate build_helper;\n extern crate gcc;\n \n fn main() {\n+    let src_dir = std::path::Path::new(\"../rt/hoedown/src\");\n+    build_helper::rerun_if_changed_anything_in_dir(src_dir);\n     let mut cfg = gcc::Config::new();\n     cfg.file(\"../rt/hoedown/src/autolink.c\")\n        .file(\"../rt/hoedown/src/buffer.c\")\n@@ -21,6 +24,6 @@ fn main() {\n        .file(\"../rt/hoedown/src/html_smartypants.c\")\n        .file(\"../rt/hoedown/src/stack.c\")\n        .file(\"../rt/hoedown/src/version.c\")\n-       .include(\"../rt/hoedown/src\")\n+       .include(src_dir)\n        .compile(\"libhoedown.a\");\n }"}, {"sha": "834e3d092112af94f7031a0a3d07e35de6ec4161", "filename": "src/libstd/build.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibstd%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibstd%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -21,8 +21,6 @@ use std::process::Command;\n use build_helper::{run, rerun_if_changed_anything_in_dir, up_to_date};\n \n fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-\n     let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n     let host = env::var(\"HOST\").expect(\"HOST was not set\");\n     if cfg!(feature = \"backtrace\") && !target.contains(\"apple\") && !target.contains(\"msvc\") &&"}, {"sha": "ed3d5212bf25677a3372f0764927a7ce02d767e0", "filename": "src/libunwind/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibunwind%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2187093f8d19c39071502c9e95bacabd5febd88/src%2Flibunwind%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2Fbuild.rs?ref=f2187093f8d19c39071502c9e95bacabd5febd88", "patch": "@@ -11,6 +11,7 @@\n use std::env;\n \n fn main() {\n+    println!(\"cargo:rerun-if-changed=build.rs\");\n     let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n \n     if target.contains(\"linux\") {"}]}