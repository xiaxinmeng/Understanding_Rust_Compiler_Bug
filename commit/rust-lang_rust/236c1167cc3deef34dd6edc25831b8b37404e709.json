{"sha": "236c1167cc3deef34dd6edc25831b8b37404e709", "node_id": "C_kwDOAAsO6NoAKDIzNmMxMTY3Y2MzZGVlZjM0ZGQ2ZWRjMjU4MzFiOGIzNzQwNGU3MDk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-08T07:38:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-08T07:38:13Z"}, "message": "Auto merge of #13581 - Veykril:unit-struct-compl, r=Veykril\n\nfix: Fix item completions not working properly after unit structs and outline modules\n\nFixes https://github.com/rust-lang/rust-analyzer/issues/13578", "tree": {"sha": "853bf176b8077121ac92fea1518e0ce9fd0a197a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/853bf176b8077121ac92fea1518e0ce9fd0a197a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/236c1167cc3deef34dd6edc25831b8b37404e709", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/236c1167cc3deef34dd6edc25831b8b37404e709", "html_url": "https://github.com/rust-lang/rust/commit/236c1167cc3deef34dd6edc25831b8b37404e709", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/236c1167cc3deef34dd6edc25831b8b37404e709/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8b1951ee8642e6fd8453ca437a081d2eb254d1c", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8b1951ee8642e6fd8453ca437a081d2eb254d1c", "html_url": "https://github.com/rust-lang/rust/commit/b8b1951ee8642e6fd8453ca437a081d2eb254d1c"}, {"sha": "90e2db81269f285cd1a0232e35cfd4519e8ce5f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/90e2db81269f285cd1a0232e35cfd4519e8ce5f3", "html_url": "https://github.com/rust-lang/rust/commit/90e2db81269f285cd1a0232e35cfd4519e8ce5f3"}], "stats": {"total": 40, "additions": 38, "deletions": 2}, "files": [{"sha": "c142a7305f9e94ac6e68ae2d02be21d36ffb5c3a", "filename": "crates/ide-completion/src/context/analysis.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/236c1167cc3deef34dd6edc25831b8b37404e709/crates%2Fide-completion%2Fsrc%2Fcontext%2Fanalysis.rs", "raw_url": "https://github.com/rust-lang/rust/raw/236c1167cc3deef34dd6edc25831b8b37404e709/crates%2Fide-completion%2Fsrc%2Fcontext%2Fanalysis.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Fcontext%2Fanalysis.rs?ref=236c1167cc3deef34dd6edc25831b8b37404e709", "patch": "@@ -681,9 +681,13 @@ fn classify_name_ref(\n                     ast::Item::ExternBlock(it) => it.extern_item_list().is_none(),\n                     ast::Item::Fn(it) => it.body().is_none(),\n                     ast::Item::Impl(it) => it.assoc_item_list().is_none(),\n-                    ast::Item::Module(it) => it.item_list().is_none(),\n+                    ast::Item::Module(it) => {\n+                        it.item_list().is_none() && it.semicolon_token().is_none()\n+                    }\n                     ast::Item::Static(it) => it.body().is_none(),\n-                    ast::Item::Struct(it) => it.field_list().is_none(),\n+                    ast::Item::Struct(it) => {\n+                        it.field_list().is_none() && it.semicolon_token().is_none()\n+                    }\n                     ast::Item::Trait(it) => it.assoc_item_list().is_none(),\n                     ast::Item::TypeAlias(it) => it.ty().is_none(),\n                     ast::Item::Union(it) => it.record_field_list().is_none(),"}, {"sha": "8ed6cb3cf867ef851c417b4c3316189327b90c88", "filename": "crates/ide-completion/src/tests/item_list.rs", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/236c1167cc3deef34dd6edc25831b8b37404e709/crates%2Fide-completion%2Fsrc%2Ftests%2Fitem_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/236c1167cc3deef34dd6edc25831b8b37404e709/crates%2Fide-completion%2Fsrc%2Ftests%2Fitem_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Fitem_list.rs?ref=236c1167cc3deef34dd6edc25831b8b37404e709", "patch": "@@ -245,3 +245,35 @@ impl Test for () {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn after_unit_struct() {\n+    check(\n+        r#\"struct S; f$0\"#,\n+        expect![[r#\"\n+            ma makro!(\u2026)           macro_rules! makro\n+            md module\n+            kw const\n+            kw crate::\n+            kw enum\n+            kw extern\n+            kw fn\n+            kw impl\n+            kw mod\n+            kw pub\n+            kw pub(crate)\n+            kw pub(super)\n+            kw self::\n+            kw static\n+            kw struct\n+            kw trait\n+            kw type\n+            kw union\n+            kw unsafe\n+            kw use\n+            sn macro_rules\n+            sn tfn (Test function)\n+            sn tmod (Test module)\n+        \"#]],\n+    );\n+}"}]}