{"sha": "e35418ceb9b07bd596cc09144f4f4df13432a712", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzNTQxOGNlYjliMDdiZDU5NmNjMDkxNDRmNGY0ZGYxMzQzMmE3MTI=", "commit": {"author": {"name": "vsrs", "email": "vit@conrlab.com", "date": "2020-06-03T13:39:32Z"}, "committer": {"name": "vsrs", "email": "vit@conrlab.com", "date": "2020-06-05T12:00:31Z"}, "message": "Apply suggestions from @kjeremy  review", "tree": {"sha": "c7936f3f1db7082e5585e83160fac76b6f91095f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7936f3f1db7082e5585e83160fac76b6f91095f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e35418ceb9b07bd596cc09144f4f4df13432a712", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e35418ceb9b07bd596cc09144f4f4df13432a712", "html_url": "https://github.com/rust-lang/rust/commit/e35418ceb9b07bd596cc09144f4f4df13432a712", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e35418ceb9b07bd596cc09144f4f4df13432a712/comments", "author": {"login": "vsrs", "id": 62505555, "node_id": "MDQ6VXNlcjYyNTA1NTU1", "avatar_url": "https://avatars.githubusercontent.com/u/62505555?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vsrs", "html_url": "https://github.com/vsrs", "followers_url": "https://api.github.com/users/vsrs/followers", "following_url": "https://api.github.com/users/vsrs/following{/other_user}", "gists_url": "https://api.github.com/users/vsrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/vsrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vsrs/subscriptions", "organizations_url": "https://api.github.com/users/vsrs/orgs", "repos_url": "https://api.github.com/users/vsrs/repos", "events_url": "https://api.github.com/users/vsrs/events{/privacy}", "received_events_url": "https://api.github.com/users/vsrs/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vsrs", "id": 62505555, "node_id": "MDQ6VXNlcjYyNTA1NTU1", "avatar_url": "https://avatars.githubusercontent.com/u/62505555?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vsrs", "html_url": "https://github.com/vsrs", "followers_url": "https://api.github.com/users/vsrs/followers", "following_url": "https://api.github.com/users/vsrs/following{/other_user}", "gists_url": "https://api.github.com/users/vsrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/vsrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vsrs/subscriptions", "organizations_url": "https://api.github.com/users/vsrs/orgs", "repos_url": "https://api.github.com/users/vsrs/repos", "events_url": "https://api.github.com/users/vsrs/events{/privacy}", "received_events_url": "https://api.github.com/users/vsrs/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "92cfc0f2a1edd4e825d4dea96d4f96dcea513629", "url": "https://api.github.com/repos/rust-lang/rust/commits/92cfc0f2a1edd4e825d4dea96d4f96dcea513629", "html_url": "https://github.com/rust-lang/rust/commit/92cfc0f2a1edd4e825d4dea96d4f96dcea513629"}], "stats": {"total": 37, "additions": 18, "deletions": 19}, "files": [{"sha": "75ea48892c8bf7327c1d51fc872bfca88cb901f1", "filename": "crates/rust-analyzer/src/lsp_ext.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e35418ceb9b07bd596cc09144f4f4df13432a712/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e35418ceb9b07bd596cc09144f4f4df13432a712/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs?ref=e35418ceb9b07bd596cc09144f4f4df13432a712", "patch": "@@ -271,26 +271,24 @@ impl Request for HoverRequest {\n \n #[derive(Debug, PartialEq, Clone, Deserialize, Serialize)]\n pub struct Hover {\n-    pub contents: lsp_types::HoverContents,\n-    #[serde(skip_serializing_if = \"Option::is_none\")]\n-    pub range: Option<Range>,\n+    #[serde(flatten)]\n+    pub hover: lsp_types::Hover,\n     #[serde(skip_serializing_if = \"Option::is_none\")]\n     pub actions: Option<Vec<CommandLinkGroup>>,\n }\n \n-#[derive(Debug, PartialEq, Eq, Clone, Default, Deserialize, Serialize)]\n+#[derive(Debug, PartialEq, Clone, Default, Deserialize, Serialize)]\n pub struct CommandLinkGroup {\n+    #[serde(skip_serializing_if = \"Option::is_none\")]\n     pub title: Option<String>,\n     pub commands: Vec<CommandLink>,\n }\n \n // LSP v3.15 Command does not have a `tooltip` field, vscode supports one.\n-#[derive(Debug, PartialEq, Eq, Clone, Default, Deserialize, Serialize)]\n+#[derive(Debug, PartialEq, Clone, Default, Deserialize, Serialize)]\n pub struct CommandLink {\n-    pub title: String,\n-    pub command: String,\n+    #[serde(flatten)]\n+    pub command: lsp_types::Command,\n     #[serde(skip_serializing_if = \"Option::is_none\")]\n     pub tooltip: Option<String>,\n-    #[serde(skip_serializing_if = \"Option::is_none\")]\n-    pub arguments: Option<Vec<serde_json::Value>>,\n }"}, {"sha": "894df5837c3d40eea2cb1441eb118356e93fa02d", "filename": "crates/rust-analyzer/src/main_loop/handlers.rs", "status": "modified", "additions": 11, "deletions": 10, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e35418ceb9b07bd596cc09144f4f4df13432a712/crates%2Frust-analyzer%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e35418ceb9b07bd596cc09144f4f4df13432a712/crates%2Frust-analyzer%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=e35418ceb9b07bd596cc09144f4f4df13432a712", "patch": "@@ -547,15 +547,18 @@ pub fn handle_hover(\n     };\n     let line_index = snap.analysis.file_line_index(position.file_id)?;\n     let range = to_proto::range(&line_index, info.range);\n-    let res = lsp_ext::Hover {\n-        contents: HoverContents::Markup(MarkupContent {\n-            kind: MarkupKind::Markdown,\n-            value: crate::markdown::format_docs(&info.info.to_markup()),\n-        }),\n-        range: Some(range),\n+    let hover = lsp_ext::Hover {\n+        hover: lsp_types::Hover {\n+            contents: HoverContents::Markup(MarkupContent {\n+                kind: MarkupKind::Markdown,\n+                value: crate::markdown::format_docs(&info.info.to_markup()),\n+            }),\n+            range: Some(range),\n+        },\n         actions: Some(prepare_hover_actions(&snap, info.info.actions())),\n     };\n-    Ok(Some(res))\n+\n+    Ok(Some(hover))\n }\n \n pub fn handle_prepare_rename(\n@@ -1169,9 +1172,7 @@ fn show_references_command(\n fn to_command_link(command: Command, tooltip: String) -> lsp_ext::CommandLink {\n     lsp_ext::CommandLink {\n         tooltip: Some(tooltip),\n-        title: command.title,\n-        command: command.command,\n-        arguments: command.arguments,\n+        command,\n     }\n }\n "}]}