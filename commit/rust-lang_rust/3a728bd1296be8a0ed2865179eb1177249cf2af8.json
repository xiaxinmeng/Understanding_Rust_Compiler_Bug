{"sha": "3a728bd1296be8a0ed2865179eb1177249cf2af8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhNzI4YmQxMjk2YmU4YTBlZDI4NjUxNzllYjExNzcyNDljZjJhZjg=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-11-24T12:17:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-24T12:17:41Z"}, "message": "Rollup merge of #79346 - tmiasko:more-names, r=jonas-schievink\n\nAllow using `-Z fewer-names=no` to retain value names\n\nChange `-Z fewer-names` into an optional boolean flag and allow using it\nto either discard value names when true or retain them when false,\nregardless of other settings.", "tree": {"sha": "9cb7be666c3ced9cdda05d190e1e182a7ed0af3a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9cb7be666c3ced9cdda05d190e1e182a7ed0af3a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a728bd1296be8a0ed2865179eb1177249cf2af8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfvPnmCRBK7hj4Ov3rIwAAdHIIABWX483j//vWpRaz8aHGuI3Q\ntcfBKqVfnNvh70QxwKFQNG1xwQ3RR5TLTRfdKG4BPZtYAlTGzZaEQ1OZq+90bM0P\nGuu9I6Zl1ZwC6GATiCR5XuopE6IJ+tPzEd2+TBhGR3/bgnPaZPU9eAIzuf/NkmsH\nVkJ8bdoAfjWVzIIbULjYrfpws63xllNfMNTEr/3p+4ISX+Ku1OfjmAR7TVs8m0rB\nPRF5PWDR4ae2+JT0PKBJlaNvtjFw4c60imd5dugaFa1zFQ58ulFFtzNeZAnV1pck\nnhW12hte2PaoqroFEkKjzFhGBRztvelSqh1kcgBB2/LxEwXYxqPf56mGQtFPWAs=\n=pK2G\n-----END PGP SIGNATURE-----\n", "payload": "tree 9cb7be666c3ced9cdda05d190e1e182a7ed0af3a\nparent 3f36f92a96d4b1d9b685d23b71bb77ebbe64a08a\nparent fafe3cd68290b7440e1ea66fca8438363a431274\nauthor Jonas Schievink <jonasschievink@gmail.com> 1606220261 +0100\ncommitter GitHub <noreply@github.com> 1606220261 +0100\n\nRollup merge of #79346 - tmiasko:more-names, r=jonas-schievink\n\nAllow using `-Z fewer-names=no` to retain value names\n\nChange `-Z fewer-names` into an optional boolean flag and allow using it\nto either discard value names when true or retain them when false,\nregardless of other settings.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a728bd1296be8a0ed2865179eb1177249cf2af8", "html_url": "https://github.com/rust-lang/rust/commit/3a728bd1296be8a0ed2865179eb1177249cf2af8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a728bd1296be8a0ed2865179eb1177249cf2af8/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f36f92a96d4b1d9b685d23b71bb77ebbe64a08a", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f36f92a96d4b1d9b685d23b71bb77ebbe64a08a", "html_url": "https://github.com/rust-lang/rust/commit/3f36f92a96d4b1d9b685d23b71bb77ebbe64a08a"}, {"sha": "fafe3cd68290b7440e1ea66fca8438363a431274", "url": "https://api.github.com/repos/rust-lang/rust/commits/fafe3cd68290b7440e1ea66fca8438363a431274", "html_url": "https://github.com/rust-lang/rust/commit/fafe3cd68290b7440e1ea66fca8438363a431274"}], "stats": {"total": 39, "additions": 31, "deletions": 8}, "files": [{"sha": "01d5ed2f34abff0e22390583759df55c1937be40", "filename": "compiler/rustc_interface/src/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3a728bd1296be8a0ed2865179eb1177249cf2af8/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a728bd1296be8a0ed2865179eb1177249cf2af8/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Ftests.rs?ref=3a728bd1296be8a0ed2865179eb1177249cf2af8", "patch": "@@ -547,7 +547,7 @@ fn test_debugging_options_tracking_hash() {\n     tracked!(debug_macros, true);\n     tracked!(dep_info_omit_d_target, true);\n     tracked!(dual_proc_macros, true);\n-    tracked!(fewer_names, true);\n+    tracked!(fewer_names, Some(true));\n     tracked!(force_overflow_checks, Some(true));\n     tracked!(force_unstable_if_unmarked, true);\n     tracked!(fuel, Some((\"abc\".to_string(), 99)));"}, {"sha": "ba083140f5140a2483e8d101684b39847bd15274", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3a728bd1296be8a0ed2865179eb1177249cf2af8/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a728bd1296be8a0ed2865179eb1177249cf2af8/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=3a728bd1296be8a0ed2865179eb1177249cf2af8", "patch": "@@ -900,7 +900,7 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"emits a future-incompatibility report for lints (RFC 2834)\"),\n     emit_stack_sizes: bool = (false, parse_bool, [UNTRACKED],\n         \"emit a section containing stack size metadata (default: no)\"),\n-    fewer_names: bool = (false, parse_bool, [TRACKED],\n+    fewer_names: Option<bool> = (None, parse_opt_bool, [TRACKED],\n         \"reduce memory use by retaining fewer names within compilation artifacts (LLVM-IR) \\\n         (default: no)\"),\n     force_overflow_checks: Option<bool> = (None, parse_opt_bool, [TRACKED],"}, {"sha": "5dddf0eb72ea641dfebe7913798f11d65baacb4e", "filename": "compiler/rustc_session/src/session.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/3a728bd1296be8a0ed2865179eb1177249cf2af8/compiler%2Frustc_session%2Fsrc%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a728bd1296be8a0ed2865179eb1177249cf2af8/compiler%2Frustc_session%2Fsrc%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fsession.rs?ref=3a728bd1296be8a0ed2865179eb1177249cf2af8", "patch": "@@ -734,12 +734,15 @@ impl Session {\n         self.opts.cg.panic.unwrap_or(self.target.panic_strategy)\n     }\n     pub fn fewer_names(&self) -> bool {\n-        let more_names = self.opts.output_types.contains_key(&OutputType::LlvmAssembly)\n-            || self.opts.output_types.contains_key(&OutputType::Bitcode)\n-            // AddressSanitizer and MemorySanitizer use alloca name when reporting an issue.\n-            || self.opts.debugging_opts.sanitizer.intersects(SanitizerSet::ADDRESS | SanitizerSet::MEMORY);\n-\n-        self.opts.debugging_opts.fewer_names || !more_names\n+        if let Some(fewer_names) = self.opts.debugging_opts.fewer_names {\n+            fewer_names\n+        } else {\n+            let more_names = self.opts.output_types.contains_key(&OutputType::LlvmAssembly)\n+                || self.opts.output_types.contains_key(&OutputType::Bitcode)\n+                // AddressSanitizer and MemorySanitizer use alloca name when reporting an issue.\n+                || self.opts.debugging_opts.sanitizer.intersects(SanitizerSet::ADDRESS | SanitizerSet::MEMORY);\n+            !more_names\n+        }\n     }\n \n     pub fn unstable_options(&self) -> bool {"}, {"sha": "53a926d49efe742eb193549275905209dac349bb", "filename": "src/test/codegen/fewer-names.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3a728bd1296be8a0ed2865179eb1177249cf2af8/src%2Ftest%2Fcodegen%2Ffewer-names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a728bd1296be8a0ed2865179eb1177249cf2af8/src%2Ftest%2Fcodegen%2Ffewer-names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Ffewer-names.rs?ref=3a728bd1296be8a0ed2865179eb1177249cf2af8", "patch": "@@ -0,0 +1,20 @@\n+// no-system-llvm\n+// compile-flags: -Coverflow-checks=no -O\n+// revisions: YES NO\n+// [YES]compile-flags: -Zfewer-names=yes\n+// [NO] compile-flags: -Zfewer-names=no\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn sum(x: u32, y: u32) -> u32 {\n+// YES-LABEL: define i32 @sum(i32 %0, i32 %1)\n+// YES-NEXT:    %3 = add i32 %1, %0\n+// YES-NEXT:    ret i32 %3\n+\n+// NO-LABEL: define i32 @sum(i32 %x, i32 %y)\n+// NO-NEXT:  start:\n+// NO-NEXT:    %z = add i32 %y, %x\n+// NO-NEXT:    ret i32 %z\n+    let z = x + y;\n+    z\n+}"}]}