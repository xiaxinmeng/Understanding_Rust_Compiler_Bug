{"sha": "4873271955dde6d0d4a1e47851b3babf3577005d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4NzMyNzE5NTVkZGU2ZDBkNGExZTQ3ODUxYjNiYWJmMzU3NzAwNWQ=", "commit": {"author": {"name": "Joshua M. Clulow", "email": "jmc@oxide.computer", "date": "2021-04-16T03:52:30Z"}, "committer": {"name": "Joshua M. Clulow", "email": "jmc@oxide.computer", "date": "2021-04-16T18:28:41Z"}, "message": "bootstrap: use bash on illumos to run install scripts\n\nThe default illumos shell (\"sh\" in the default PATH) is ksh93, rather\nthan bash, and does not support constructs like \"local\" that came from\nbash.  The bootstrap function for invoking \"install.sh\" scripts should\nuse \"bash\" explicitly there to avoid issues.", "tree": {"sha": "117a8f54cd7f3cd1eafec365fe9bb5491bcab3d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/117a8f54cd7f3cd1eafec365fe9bb5491bcab3d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4873271955dde6d0d4a1e47851b3babf3577005d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4873271955dde6d0d4a1e47851b3babf3577005d", "html_url": "https://github.com/rust-lang/rust/commit/4873271955dde6d0d4a1e47851b3babf3577005d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4873271955dde6d0d4a1e47851b3babf3577005d/comments", "author": {"login": "jclulow", "id": 304070, "node_id": "MDQ6VXNlcjMwNDA3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/304070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jclulow", "html_url": "https://github.com/jclulow", "followers_url": "https://api.github.com/users/jclulow/followers", "following_url": "https://api.github.com/users/jclulow/following{/other_user}", "gists_url": "https://api.github.com/users/jclulow/gists{/gist_id}", "starred_url": "https://api.github.com/users/jclulow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jclulow/subscriptions", "organizations_url": "https://api.github.com/users/jclulow/orgs", "repos_url": "https://api.github.com/users/jclulow/repos", "events_url": "https://api.github.com/users/jclulow/events{/privacy}", "received_events_url": "https://api.github.com/users/jclulow/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jclulow", "id": 304070, "node_id": "MDQ6VXNlcjMwNDA3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/304070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jclulow", "html_url": "https://github.com/jclulow", "followers_url": "https://api.github.com/users/jclulow/followers", "following_url": "https://api.github.com/users/jclulow/following{/other_user}", "gists_url": "https://api.github.com/users/jclulow/gists{/gist_id}", "starred_url": "https://api.github.com/users/jclulow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jclulow/subscriptions", "organizations_url": "https://api.github.com/users/jclulow/orgs", "repos_url": "https://api.github.com/users/jclulow/repos", "events_url": "https://api.github.com/users/jclulow/events{/privacy}", "received_events_url": "https://api.github.com/users/jclulow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2faef12b656d40522ca3b4a53b36299b4364e717", "url": "https://api.github.com/repos/rust-lang/rust/commits/2faef12b656d40522ca3b4a53b36299b4364e717", "html_url": "https://github.com/rust-lang/rust/commit/2faef12b656d40522ca3b4a53b36299b4364e717"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "13ee909afd5e408897a32d1a23395dd0efe5629e", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4873271955dde6d0d4a1e47851b3babf3577005d/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4873271955dde6d0d4a1e47851b3babf3577005d/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=4873271955dde6d0d4a1e47851b3babf3577005d", "patch": "@@ -17,6 +17,11 @@ use crate::Compiler;\n use crate::builder::{Builder, RunConfig, ShouldRun, Step};\n use crate::config::{Config, TargetSelection};\n \n+#[cfg(target_os = \"illumos\")]\n+const SHELL: &str = \"bash\";\n+#[cfg(not(target_os = \"illumos\"))]\n+const SHELL: &str = \"sh\";\n+\n fn install_sh(\n     builder: &Builder<'_>,\n     package: &str,\n@@ -37,7 +42,7 @@ fn install_sh(\n     let empty_dir = builder.out.join(\"tmp/empty_dir\");\n     t!(fs::create_dir_all(&empty_dir));\n \n-    let mut cmd = Command::new(\"sh\");\n+    let mut cmd = Command::new(SHELL);\n     cmd.current_dir(&empty_dir)\n         .arg(sanitize_sh(&tarball.decompressed_output().join(\"install.sh\")))\n         .arg(format!(\"--prefix={}\", prepare_dir(prefix)))"}]}