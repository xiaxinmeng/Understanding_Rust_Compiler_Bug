{"sha": "1f82a9f89e3c0388442835df632b56ccea08a971", "node_id": "C_kwDOAAsO6NoAKDFmODJhOWY4OWUzYzAzODg0NDI4MzVkZjYzMmI1NmNjZWEwOGE5NzE", "commit": {"author": {"name": "Jannis Christopher K\u00f6hl", "email": "mail@koehl.dev", "date": "2022-10-24T22:56:51Z"}, "committer": {"name": "Jannis Christopher K\u00f6hl", "email": "mail@koehl.dev", "date": "2022-11-07T09:35:25Z"}, "message": "Move HasTop and HasBottom into lattice.rs", "tree": {"sha": "f01da01ab1a395307a6cd54a407d00d3fb524bb9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f01da01ab1a395307a6cd54a407d00d3fb524bb9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1f82a9f89e3c0388442835df632b56ccea08a971", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1f82a9f89e3c0388442835df632b56ccea08a971", "html_url": "https://github.com/rust-lang/rust/commit/1f82a9f89e3c0388442835df632b56ccea08a971", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1f82a9f89e3c0388442835df632b56ccea08a971/comments", "author": {"login": "jachris", "id": 30163784, "node_id": "MDQ6VXNlcjMwMTYzNzg0", "avatar_url": "https://avatars.githubusercontent.com/u/30163784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jachris", "html_url": "https://github.com/jachris", "followers_url": "https://api.github.com/users/jachris/followers", "following_url": "https://api.github.com/users/jachris/following{/other_user}", "gists_url": "https://api.github.com/users/jachris/gists{/gist_id}", "starred_url": "https://api.github.com/users/jachris/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jachris/subscriptions", "organizations_url": "https://api.github.com/users/jachris/orgs", "repos_url": "https://api.github.com/users/jachris/repos", "events_url": "https://api.github.com/users/jachris/events{/privacy}", "received_events_url": "https://api.github.com/users/jachris/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jachris", "id": 30163784, "node_id": "MDQ6VXNlcjMwMTYzNzg0", "avatar_url": "https://avatars.githubusercontent.com/u/30163784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jachris", "html_url": "https://github.com/jachris", "followers_url": "https://api.github.com/users/jachris/followers", "following_url": "https://api.github.com/users/jachris/following{/other_user}", "gists_url": "https://api.github.com/users/jachris/gists{/gist_id}", "starred_url": "https://api.github.com/users/jachris/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jachris/subscriptions", "organizations_url": "https://api.github.com/users/jachris/orgs", "repos_url": "https://api.github.com/users/jachris/repos", "events_url": "https://api.github.com/users/jachris/events{/privacy}", "received_events_url": "https://api.github.com/users/jachris/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f29533b4e031771dae471bff534e3cc03ab48cd4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f29533b4e031771dae471bff534e3cc03ab48cd4", "html_url": "https://github.com/rust-lang/rust/commit/f29533b4e031771dae471bff534e3cc03ab48cd4"}], "stats": {"total": 69, "additions": 42, "deletions": 27}, "files": [{"sha": "f0e75c53ea15c93e9fa6c7fcd46843c25a191f26", "filename": "compiler/rustc_mir_dataflow/src/framework/lattice.rs", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/1f82a9f89e3c0388442835df632b56ccea08a971/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Flattice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f82a9f89e3c0388442835df632b56ccea08a971/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Flattice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Flattice.rs?ref=1f82a9f89e3c0388442835df632b56ccea08a971", "patch": "@@ -73,6 +73,16 @@ pub trait MeetSemiLattice: Eq {\n     fn meet(&mut self, other: &Self) -> bool;\n }\n \n+/// A set that has a \"bottom\" element, which is less than or equal to any other element.\n+pub trait HasBottom {\n+    fn bottom() -> Self;\n+}\n+\n+/// A set that has a \"top\" element, which is greater than or equal to any other element.\n+pub trait HasTop {\n+    fn top() -> Self;\n+}\n+\n /// A `bool` is a \"two-point\" lattice with `true` as the top element and `false` as the bottom:\n ///\n /// ```text\n@@ -102,6 +112,18 @@ impl MeetSemiLattice for bool {\n     }\n }\n \n+impl HasBottom for bool {\n+    fn bottom() -> Self {\n+        false\n+    }\n+}\n+\n+impl HasTop for bool {\n+    fn top() -> Self {\n+        true\n+    }\n+}\n+\n /// A tuple (or list) of lattices is itself a lattice whose least upper bound is the concatenation\n /// of the least upper bounds of each element of the tuple (or list).\n ///\n@@ -250,3 +272,15 @@ impl<T: Clone + Eq> MeetSemiLattice for FlatSet<T> {\n         true\n     }\n }\n+\n+impl<T> HasBottom for FlatSet<T> {\n+    fn bottom() -> Self {\n+        Self::Bottom\n+    }\n+}\n+\n+impl<T> HasTop for FlatSet<T> {\n+    fn top() -> Self {\n+        Self::Top\n+    }\n+}"}, {"sha": "a3194ebc30cfcb87a1ba8501488c60eaeeb492bc", "filename": "compiler/rustc_mir_dataflow/src/value_analysis.rs", "status": "modified", "additions": 7, "deletions": 26, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/1f82a9f89e3c0388442835df632b56ccea08a971/compiler%2Frustc_mir_dataflow%2Fsrc%2Fvalue_analysis.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f82a9f89e3c0388442835df632b56ccea08a971/compiler%2Frustc_mir_dataflow%2Fsrc%2Fvalue_analysis.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fvalue_analysis.rs?ref=1f82a9f89e3c0388442835df632b56ccea08a971", "patch": "@@ -56,9 +56,10 @@ use rustc_middle::ty::{self, Ty, TyCtxt};\n use rustc_span::DUMMY_SP;\n use rustc_target::abi::VariantIdx;\n \n+use crate::lattice::{HasBottom, HasTop};\n use crate::{\n-    fmt::DebugWithContext, lattice::FlatSet, Analysis, AnalysisDomain, CallReturnPlaces,\n-    JoinSemiLattice, SwitchIntEdgeEffects,\n+    fmt::DebugWithContext, Analysis, AnalysisDomain, CallReturnPlaces, JoinSemiLattice,\n+    SwitchIntEdgeEffects,\n };\n \n pub trait ValueAnalysis<'tcx> {\n@@ -846,8 +847,8 @@ pub enum ValueOrPlace<V> {\n     Place(PlaceIndex),\n }\n \n-impl<V: HasTop> HasTop for ValueOrPlace<V> {\n-    fn top() -> Self {\n+impl<V: HasTop> ValueOrPlace<V> {\n+    pub fn top() -> Self {\n         ValueOrPlace::Value(V::top())\n     }\n }\n@@ -859,8 +860,8 @@ pub enum ValueOrPlaceOrRef<V> {\n     Ref(PlaceIndex),\n }\n \n-impl<V: HasTop> HasTop for ValueOrPlaceOrRef<V> {\n-    fn top() -> Self {\n+impl<V: HasTop> ValueOrPlaceOrRef<V> {\n+    pub fn top() -> Self {\n         ValueOrPlaceOrRef::Value(V::top())\n     }\n }\n@@ -874,26 +875,6 @@ impl<V> From<ValueOrPlace<V>> for ValueOrPlaceOrRef<V> {\n     }\n }\n \n-pub trait HasBottom {\n-    fn bottom() -> Self;\n-}\n-\n-pub trait HasTop {\n-    fn top() -> Self;\n-}\n-\n-impl<V> HasBottom for FlatSet<V> {\n-    fn bottom() -> Self {\n-        Self::Bottom\n-    }\n-}\n-\n-impl<V> HasTop for FlatSet<V> {\n-    fn top() -> Self {\n-        Self::Top\n-    }\n-}\n-\n /// The set of projection elements that can be used by a tracked place.\n ///\n /// For now, downcast is not allowed due to aliasing between variants (see #101168)."}, {"sha": "93f7ddbee798e1626f3ea6ef7f29eb79c39f8787", "filename": "compiler/rustc_mir_transform/src/dataflow_const_prop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1f82a9f89e3c0388442835df632b56ccea08a971/compiler%2Frustc_mir_transform%2Fsrc%2Fdataflow_const_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f82a9f89e3c0388442835df632b56ccea08a971/compiler%2Frustc_mir_transform%2Fsrc%2Fdataflow_const_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fdataflow_const_prop.rs?ref=1f82a9f89e3c0388442835df632b56ccea08a971", "patch": "@@ -8,7 +8,7 @@ use rustc_middle::mir::visit::{MutVisitor, Visitor};\n use rustc_middle::mir::*;\n use rustc_middle::ty::{self, Ty, TyCtxt};\n use rustc_mir_dataflow::value_analysis::{\n-    HasTop, Map, State, TrackElem, ValueAnalysis, ValueOrPlace, ValueOrPlaceOrRef,\n+    Map, State, TrackElem, ValueAnalysis, ValueOrPlace, ValueOrPlaceOrRef,\n };\n use rustc_mir_dataflow::{lattice::FlatSet, Analysis, ResultsVisitor, SwitchIntEdgeEffects};\n use rustc_span::DUMMY_SP;"}]}