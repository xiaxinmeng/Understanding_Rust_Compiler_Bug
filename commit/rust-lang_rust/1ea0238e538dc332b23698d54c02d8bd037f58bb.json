{"sha": "1ea0238e538dc332b23698d54c02d8bd037f58bb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlYTAyMzhlNTM4ZGMzMzJiMjM2OThkNTRjMDJkOGJkMDM3ZjU4YmI=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-04-05T10:45:19Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-04-05T10:45:19Z"}, "message": "Add classify_literal and undo expose next_token", "tree": {"sha": "824ba6536a7f6f5ba9d8211b81dcb8dbce5c6854", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/824ba6536a7f6f5ba9d8211b81dcb8dbce5c6854"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ea0238e538dc332b23698d54c02d8bd037f58bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ea0238e538dc332b23698d54c02d8bd037f58bb", "html_url": "https://github.com/rust-lang/rust/commit/1ea0238e538dc332b23698d54c02d8bd037f58bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ea0238e538dc332b23698d54c02d8bd037f58bb/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ab78d60561ed701b29d3065061cbc3175e20c4a", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ab78d60561ed701b29d3065061cbc3175e20c4a", "html_url": "https://github.com/rust-lang/rust/commit/1ab78d60561ed701b29d3065061cbc3175e20c4a"}], "stats": {"total": 23, "additions": 15, "deletions": 8}, "files": [{"sha": "38f0049ed7d794d431e2d64713c563ce9fd4db1b", "filename": "crates/ra_mbe/src/lib.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_mbe%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_mbe%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Flib.rs?ref=1ea0238e538dc332b23698d54c02d8bd037f58bb", "patch": "@@ -343,16 +343,14 @@ SOURCE_FILE@[0; 40)\n             if let tt::TokenTree::Subtree(subtree) = tt {\n                 return &subtree;\n             }\n-            assert!(false, \"It is not a subtree\");\n-            unreachable!();\n+            unreachable!(\"It is not a subtree\");\n         }\n \n         fn to_literal(tt: &tt::TokenTree) -> &tt::Literal {\n             if let tt::TokenTree::Leaf(tt::Leaf::Literal(lit)) = tt {\n                 return lit;\n             }\n-            assert!(false, \"It is not a literal\");\n-            unreachable!();\n+            unreachable!(\"It is not a literal\");\n         }\n \n         let rules = create_rules("}, {"sha": "9664280b55f3620252c0004c9f5bd945e0165faa", "filename": "crates/ra_mbe/src/syntax_bridge.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_mbe%2Fsrc%2Fsyntax_bridge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_mbe%2Fsrc%2Fsyntax_bridge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fsyntax_bridge.rs?ref=1ea0238e538dc332b23698d54c02d8bd037f58bb", "patch": "@@ -1,7 +1,7 @@\n use ra_parser::{TokenSource, TreeSink, ParseError};\n use ra_syntax::{\n     AstNode, SyntaxNode, TextRange, SyntaxKind, SmolStr, SyntaxTreeBuilder, TreeArc, SyntaxElement,\n-    ast, SyntaxKind::*, TextUnit, next_token\n+    ast, SyntaxKind::*, TextUnit, classify_literal\n };\n \n /// Maps `tt::TokenId` to the relative range of the original token.\n@@ -189,7 +189,7 @@ impl TtTokenSource {\n     {\n         let tok = match token {\n             tt::Leaf::Literal(l) => TtToken {\n-                kind: next_token(&l.text).kind,\n+                kind: classify_literal(&l.text).unwrap().kind,\n                 is_joint_to_next: false,\n                 text: l.text.clone(),\n             },"}, {"sha": "c56bc9f16828ed5e363421dbaff17cfb04ca57ee", "filename": "crates/ra_syntax/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_syntax%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_syntax%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Flib.rs?ref=1ea0238e538dc332b23698d54c02d8bd037f58bb", "patch": "@@ -40,7 +40,7 @@ pub use crate::{\n     syntax_text::SyntaxText,\n     syntax_node::{Direction,  SyntaxNode, WalkEvent, TreeArc, SyntaxTreeBuilder, SyntaxElement, SyntaxToken},\n     ptr::{SyntaxNodePtr, AstPtr},\n-    parsing::{tokenize, next_token, Token},\n+    parsing::{tokenize, classify_literal, Token},\n };\n \n use ra_text_edit::AtomTextEdit;"}, {"sha": "15d69c5ab03c41740d9e4ed19e1d3382fd677361", "filename": "crates/ra_syntax/src/parsing.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_syntax%2Fsrc%2Fparsing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_syntax%2Fsrc%2Fparsing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fparsing.rs?ref=1ea0238e538dc332b23698d54c02d8bd037f58bb", "patch": "@@ -11,7 +11,7 @@ use crate::{\n     syntax_node::GreenNode,\n };\n \n-pub use self::lexer::{tokenize, next_token, Token};\n+pub use self::lexer::{tokenize, classify_literal, Token};\n \n pub(crate) use self::reparsing::incremental_reparse;\n "}, {"sha": "e75f3aae0e2fc2e071855c55e864809bd61adcdf", "filename": "crates/ra_syntax/src/parsing/lexer.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_syntax%2Fsrc%2Fparsing%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ea0238e538dc332b23698d54c02d8bd037f58bb/crates%2Fra_syntax%2Fsrc%2Fparsing%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fparsing%2Flexer.rs?ref=1ea0238e538dc332b23698d54c02d8bd037f58bb", "patch": "@@ -214,3 +214,12 @@ fn scan_literal_suffix(ptr: &mut Ptr) {\n     }\n     ptr.bump_while(is_ident_continue);\n }\n+\n+pub fn classify_literal(text: &str) -> Option<Token> {\n+    let tkn = next_token(text);\n+    if tkn.kind.is_literal() || tkn.len.to_usize() != text.len() {\n+        return None;\n+    }\n+\n+    Some(tkn)\n+}"}]}