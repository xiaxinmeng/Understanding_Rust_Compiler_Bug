{"sha": "8f47954742364b452716daff72bba976e18288e5", "node_id": "C_kwDOAAsO6NoAKDhmNDc5NTQ3NDIzNjRiNDUyNzE2ZGFmZjcyYmJhOTc2ZTE4Mjg4ZTU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-02-02T16:14:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-02-02T16:14:05Z"}, "message": "Rollup merge of #106919 - compiler-errors:underscore-typo-in-field-pat, r=jackh726\n\nRecover `_` as `..` in field pattern", "tree": {"sha": "7e63fbd9a88c6bb7a6322f783a1afe2f711b7932", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e63fbd9a88c6bb7a6322f783a1afe2f711b7932"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f47954742364b452716daff72bba976e18288e5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj2+FNCRBK7hj4Ov3rIwAAaFIIAK9z8bMoVWaFa9hXeGrZT6pI\nFaAKQJkmfX8qLkUuFS0Ekzu2kIcQkogwQEhoK7D99Hri7kfRzlyxvi70NJAu2Wpd\nZdl4VfW52wC5yTvdF0bn8Ix6/LSXov/66Y+HDKqHWtV4cK8iBF0f6PZDSs2OdEp/\nqIJmjNcN47DmndM6bLDszwRw4hp/3rMY7pauAwevJmTN4/VLYq5KZyP0EcO7dNWQ\npMKVTuO61gNI5W/5w08+ib558/UPTKFOTHNws9309ilKfvZ1mamYQgTjRxjLjxsO\nhpeq65P08j9nLSMjEyIk9oUhHwFsBoNIdvgnYCII9HdBF/q4v+aVXNpqcFWRAxM=\n=ZuBS\n-----END PGP SIGNATURE-----\n", "payload": "tree 7e63fbd9a88c6bb7a6322f783a1afe2f711b7932\nparent 97872b792c9dd6a9bc5c3f4e62a0bd5958b09cdc\nparent 9dd5d3e8e421193be34fa822ab485de115174421\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1675354445 +0100\ncommitter GitHub <noreply@github.com> 1675354445 +0100\n\nRollup merge of #106919 - compiler-errors:underscore-typo-in-field-pat, r=jackh726\n\nRecover `_` as `..` in field pattern\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f47954742364b452716daff72bba976e18288e5", "html_url": "https://github.com/rust-lang/rust/commit/8f47954742364b452716daff72bba976e18288e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f47954742364b452716daff72bba976e18288e5/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97872b792c9dd6a9bc5c3f4e62a0bd5958b09cdc", "url": "https://api.github.com/repos/rust-lang/rust/commits/97872b792c9dd6a9bc5c3f4e62a0bd5958b09cdc", "html_url": "https://github.com/rust-lang/rust/commit/97872b792c9dd6a9bc5c3f4e62a0bd5958b09cdc"}, {"sha": "9dd5d3e8e421193be34fa822ab485de115174421", "url": "https://api.github.com/repos/rust-lang/rust/commits/9dd5d3e8e421193be34fa822ab485de115174421", "html_url": "https://github.com/rust-lang/rust/commit/9dd5d3e8e421193be34fa822ab485de115174421"}], "stats": {"total": 74, "additions": 42, "deletions": 32}, "files": [{"sha": "6752f05b044ee211bbfcf78d7d84e80885b9a1ce", "filename": "compiler/rustc_error_messages/locales/en-US/parse.ftl", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparse.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparse.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparse.ftl?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -535,8 +535,8 @@ parse_dot_dot_dot_range_to_pattern_not_allowed = range-to patterns with `...` ar\n \n parse_enum_pattern_instead_of_identifier = expected identifier, found enum pattern\n \n-parse_dot_dot_dot_for_remaining_fields = expected field pattern, found `...`\n-    .suggestion = to omit remaining fields, use one fewer `.`\n+parse_dot_dot_dot_for_remaining_fields = expected field pattern, found `{$token_str}`\n+    .suggestion = to omit remaining fields, use `..`\n \n parse_expected_comma_after_pattern_field = expected `,`\n "}, {"sha": "20da8ce5b6e76a0965874007c86cf4b60f615dba", "filename": "compiler/rustc_parse/src/errors.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/compiler%2Frustc_parse%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/compiler%2Frustc_parse%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Ferrors.rs?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -1,3 +1,5 @@\n+use std::borrow::Cow;\n+\n use rustc_ast::token::Token;\n use rustc_ast::{Path, Visibility};\n use rustc_errors::{fluent, AddToDiagnostic, Applicability, EmissionGuarantee, IntoDiagnostic};\n@@ -1802,8 +1804,9 @@ pub(crate) struct EnumPatternInsteadOfIdentifier {\n #[diag(parse_dot_dot_dot_for_remaining_fields)]\n pub(crate) struct DotDotDotForRemainingFields {\n     #[primary_span]\n-    #[suggestion(code = \"..\", applicability = \"machine-applicable\")]\n+    #[suggestion(code = \"..\", style = \"verbose\", applicability = \"machine-applicable\")]\n     pub span: Span,\n+    pub token_str: Cow<'static, str>,\n }\n \n #[derive(Diagnostic)]"}, {"sha": "0e8b549b438a92d64ba594a3e8911acea3026c39", "filename": "compiler/rustc_parse/src/parser/pat.rs", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -962,12 +962,15 @@ impl<'a> Parser<'a> {\n             }\n             ate_comma = false;\n \n-            if self.check(&token::DotDot) || self.token == token::DotDotDot {\n+            if self.check(&token::DotDot)\n+                || self.check_noexpect(&token::DotDotDot)\n+                || self.check_keyword(kw::Underscore)\n+            {\n                 etc = true;\n                 let mut etc_sp = self.token.span;\n \n-                self.recover_one_fewer_dotdot();\n-                self.bump(); // `..` || `...`\n+                self.recover_bad_dot_dot();\n+                self.bump(); // `..` || `...` || `_`\n \n                 if self.token == token::CloseDelim(Delimiter::Brace) {\n                     etc_span = Some(etc_sp);\n@@ -1060,14 +1063,15 @@ impl<'a> Parser<'a> {\n         Ok((fields, etc))\n     }\n \n-    /// Recover on `...` as if it were `..` to avoid further errors.\n+    /// Recover on `...` or `_` as if it were `..` to avoid further errors.\n     /// See issue #46718.\n-    fn recover_one_fewer_dotdot(&self) {\n-        if self.token != token::DotDotDot {\n+    fn recover_bad_dot_dot(&self) {\n+        if self.token == token::DotDot {\n             return;\n         }\n \n-        self.sess.emit_err(DotDotDotForRemainingFields { span: self.token.span });\n+        let token_str = pprust::token_to_string(&self.token);\n+        self.sess.emit_err(DotDotDotForRemainingFields { span: self.token.span, token_str });\n     }\n \n     fn parse_pat_field(&mut self, lo: Span, attrs: AttrVec) -> PResult<'a, PatField> {"}, {"sha": "589b2c3784926dc5a35ef647a26f02be58708b96", "filename": "tests/ui/did_you_mean/issue-46718-struct-pattern-dotdotdot.stderr", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fdid_you_mean%2Fissue-46718-struct-pattern-dotdotdot.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fdid_you_mean%2Fissue-46718-struct-pattern-dotdotdot.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdid_you_mean%2Fissue-46718-struct-pattern-dotdotdot.stderr?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -2,7 +2,12 @@ error: expected field pattern, found `...`\n   --> $DIR/issue-46718-struct-pattern-dotdotdot.rs:11:55\n    |\n LL |             PersonalityInventory { expressivity: exp, ... } => exp\n-   |                                                       ^^^ help: to omit remaining fields, use one fewer `.`: `..`\n+   |                                                       ^^^\n+   |\n+help: to omit remaining fields, use `..`\n+   |\n+LL |             PersonalityInventory { expressivity: exp, .. } => exp\n+   |                                                       ~~\n \n error: aborting due to previous error\n "}, {"sha": "ba8174a823b2a30991c0179edbc664a6c8f4e202", "filename": "tests/ui/parser/issue-102806.stderr", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fparser%2Fissue-102806.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fparser%2Fissue-102806.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissue-102806.stderr?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -32,7 +32,12 @@ error: expected field pattern, found `...`\n   --> $DIR/issue-102806.rs:21:22\n    |\n LL |     let V3 { z: val, ... } = v;\n-   |                      ^^^ help: to omit remaining fields, use one fewer `.`: `..`\n+   |                      ^^^\n+   |\n+help: to omit remaining fields, use `..`\n+   |\n+LL |     let V3 { z: val, .. } = v;\n+   |                      ~~\n \n error[E0063]: missing fields `x` and `y` in initializer of `V3`\n   --> $DIR/issue-102806.rs:17:13"}, {"sha": "e0dc356d5467bb996d9c9db592bf4dc0859e411d", "filename": "tests/ui/parser/issues/issue-63135.stderr", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fparser%2Fissues%2Fissue-63135.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fparser%2Fissues%2Fissue-63135.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissues%2Fissue-63135.stderr?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -20,7 +20,12 @@ error: expected field pattern, found `...`\n   --> $DIR/issue-63135.rs:3:8\n    |\n LL | fn i(n{...,f #\n-   |        ^^^ help: to omit remaining fields, use one fewer `.`: `..`\n+   |        ^^^\n+   |\n+help: to omit remaining fields, use `..`\n+   |\n+LL | fn i(n{..,f #\n+   |        ~~\n \n error: expected `}`, found `,`\n   --> $DIR/issue-63135.rs:3:11"}, {"sha": "b569993c6143edeff75e58bcf35395ba12bcee61", "filename": "tests/ui/structs-enums/struct-enum-ignoring-field-with-underscore.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fstructs-enums%2Fstruct-enum-ignoring-field-with-underscore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fstructs-enums%2Fstruct-enum-ignoring-field-with-underscore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstructs-enums%2Fstruct-enum-ignoring-field-with-underscore.rs?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -7,6 +7,5 @@ fn main() {\n     let foo = Some(Foo::Other);\n \n     if let Some(Foo::Bar {_}) = foo {}\n-    //~^ ERROR expected identifier, found reserved identifier `_`\n-    //~| ERROR pattern does not mention field `bar` [E0027]\n+    //~^ ERROR expected field pattern, found `_`\n }"}, {"sha": "2f3a150e5cba92566aadd814edcbad3e2fb000a4", "filename": "tests/ui/structs-enums/struct-enum-ignoring-field-with-underscore.stderr", "status": "modified", "additions": 6, "deletions": 17, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fstructs-enums%2Fstruct-enum-ignoring-field-with-underscore.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8f47954742364b452716daff72bba976e18288e5/tests%2Fui%2Fstructs-enums%2Fstruct-enum-ignoring-field-with-underscore.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstructs-enums%2Fstruct-enum-ignoring-field-with-underscore.stderr?ref=8f47954742364b452716daff72bba976e18288e5", "patch": "@@ -1,24 +1,13 @@\n-error: expected identifier, found reserved identifier `_`\n+error: expected field pattern, found `_`\n   --> $DIR/struct-enum-ignoring-field-with-underscore.rs:9:27\n    |\n LL |     if let Some(Foo::Bar {_}) = foo {}\n-   |                           ^ expected identifier, found reserved identifier\n-\n-error[E0027]: pattern does not mention field `bar`\n-  --> $DIR/struct-enum-ignoring-field-with-underscore.rs:9:17\n-   |\n-LL |     if let Some(Foo::Bar {_}) = foo {}\n-   |                 ^^^^^^^^^^^^ missing field `bar`\n-   |\n-help: include the missing field in the pattern\n+   |                           ^\n    |\n-LL |     if let Some(Foo::Bar {_, bar }) = foo {}\n-   |                            ~~~~~~~\n-help: if you don't care about this missing field, you can explicitly ignore it\n+help: to omit remaining fields, use `..`\n    |\n-LL |     if let Some(Foo::Bar {_, .. }) = foo {}\n-   |                            ~~~~~~\n+LL |     if let Some(Foo::Bar {..}) = foo {}\n+   |                           ~~\n \n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0027`."}]}