{"sha": "9499d2cce3bebef96d8ae64442602f87726a875a", "node_id": "C_kwDOAAsO6NoAKDk0OTlkMmNjZTNiZWJlZjk2ZDhhZTY0NDQyNjAyZjg3NzI2YTg3NWE", "commit": {"author": {"name": "Will Crichton", "email": "wcrichto@cs.stanford.edu", "date": "2022-12-07T18:24:16Z"}, "committer": {"name": "Will Crichton", "email": "wcrichto@cs.stanford.edu", "date": "2022-12-07T18:42:09Z"}, "message": "Improve calculation of scraped example minimized height", "tree": {"sha": "b4ffbfdb3873f76cb44e8dd69e06b3bc51919632", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4ffbfdb3873f76cb44e8dd69e06b3bc51919632"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9499d2cce3bebef96d8ae64442602f87726a875a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9499d2cce3bebef96d8ae64442602f87726a875a", "html_url": "https://github.com/rust-lang/rust/commit/9499d2cce3bebef96d8ae64442602f87726a875a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9499d2cce3bebef96d8ae64442602f87726a875a/comments", "author": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a459384ad02d120f1d1cc81166f95262c1d4fac", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a459384ad02d120f1d1cc81166f95262c1d4fac", "html_url": "https://github.com/rust-lang/rust/commit/8a459384ad02d120f1d1cc81166f95262c1d4fac"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "afed3da9e91d2538e5050e39acd1b4289dbf3f1b", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9499d2cce3bebef96d8ae64442602f87726a875a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/9499d2cce3bebef96d8ae64442602f87726a875a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=9499d2cce3bebef96d8ae64442602f87726a875a", "patch": "@@ -1931,18 +1931,24 @@ in storage.js\n }\n \n .scraped-example:not(.expanded) .code-wrapper {\n-\tmax-height: 120px;\n+\t/* scrape-examples.js has a constant DEFAULT_MAX_LINES (call it N) for the number\n+\t * of lines shown in the un-expanded example code viewer. This pre needs to have\n+\t * a max-height equal to line-height * N. The line-height is currently 1.5em,\n+\t * and we include additional 10px for padding. */\n+\t max-height: calc(1.5em * 5 + 10px);\n }\n \n .scraped-example:not(.expanded) .code-wrapper pre {\n \toverflow-y: hidden;\n-\tmax-height: 120px;\n \tpadding-bottom: 0;\n+\t/* See above comment, should be the same max-height. */\n+\tmax-height: calc(1.5em * 5 + 10px);\n }\n \n .more-scraped-examples .scraped-example:not(.expanded) .code-wrapper,\n .more-scraped-examples .scraped-example:not(.expanded) .code-wrapper pre {\n-\tmax-height: 240px;\n+\t/* See above comment, except this height is based on HIDDEN_MAX_LINES. */\n+\tmax-height: calc(1.5em * 10 + 10px);\n }\n \n .scraped-example .code-wrapper .next,"}, {"sha": "7a3a9c5f3400190fb62ec8ea3ee904171a06d048", "filename": "src/librustdoc/html/static/js/scrape-examples.js", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9499d2cce3bebef96d8ae64442602f87726a875a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fscrape-examples.js", "raw_url": "https://github.com/rust-lang/rust/raw/9499d2cce3bebef96d8ae64442602f87726a875a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fscrape-examples.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fscrape-examples.js?ref=9499d2cce3bebef96d8ae64442602f87726a875a", "patch": "@@ -6,6 +6,8 @@\n     // Number of lines shown when code viewer is not expanded.\n     // DEFAULT is the first example shown by default, while HIDDEN is\n     // the examples hidden beneath the \"More examples\" toggle.\n+    //\n+    // NOTE: these values MUST be synchronized with certain rules in rustdoc.css!\n     const DEFAULT_MAX_LINES = 5;\n     const HIDDEN_MAX_LINES = 10;\n \n@@ -24,8 +26,10 @@\n         } else {\n             const wrapper = elt.querySelector(\".code-wrapper\");\n             const halfHeight = wrapper.offsetHeight / 2;\n-            const offsetMid = (lines.children[loc[0]].offsetTop\n-                             + lines.children[loc[1]].offsetTop) / 2;\n+            const offsetTop = lines.children[loc[0]].offsetTop;\n+            const lastLine = lines.children[loc[1]];\n+            const offsetBot = lastLine.offsetTop + lastLine.offsetHeight;\n+            const offsetMid = (offsetTop + offsetBot) / 2;\n             scrollOffset = offsetMid - halfHeight;\n         }\n "}]}