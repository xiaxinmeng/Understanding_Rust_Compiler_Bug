{"sha": "d460b7c9d1c64d394c8078259887e027c4e322c1", "node_id": "C_kwDOAAsO6NoAKGQ0NjBiN2M5ZDFjNjRkMzk0YzgwNzgyNTk4ODdlMDI3YzRlMzIyYzE", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-03-05T23:17:40Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-03-05T23:17:40Z"}, "message": "Fix extern crate self having self unresolved", "tree": {"sha": "19fd309be0552a1aaf70c1657a2f7aa89aba2b88", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/19fd309be0552a1aaf70c1657a2f7aa89aba2b88"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d460b7c9d1c64d394c8078259887e027c4e322c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d460b7c9d1c64d394c8078259887e027c4e322c1", "html_url": "https://github.com/rust-lang/rust/commit/d460b7c9d1c64d394c8078259887e027c4e322c1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d460b7c9d1c64d394c8078259887e027c4e322c1/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e5bb661b7a4bae12ad0c63aca5279e008947fc41", "url": "https://api.github.com/repos/rust-lang/rust/commits/e5bb661b7a4bae12ad0c63aca5279e008947fc41", "html_url": "https://github.com/rust-lang/rust/commit/e5bb661b7a4bae12ad0c63aca5279e008947fc41"}], "stats": {"total": 22, "additions": 13, "deletions": 9}, "files": [{"sha": "80205f7fbc4adf1e9c26fa5a0a4b509333394aff", "filename": "crates/hir/src/semantics.rs", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/d460b7c9d1c64d394c8078259887e027c4e322c1/crates%2Fhir%2Fsrc%2Fsemantics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d460b7c9d1c64d394c8078259887e027c4e322c1/crates%2Fhir%2Fsrc%2Fsemantics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsemantics.rs?ref=d460b7c9d1c64d394c8078259887e027c4e322c1", "patch": "@@ -10,7 +10,10 @@ use hir_def::{\n     resolver::{self, HasResolver, Resolver, TypeNs},\n     AsMacroCall, FunctionId, TraitId, VariantId,\n };\n-use hir_expand::{name::AsName, ExpansionInfo, MacroCallId};\n+use hir_expand::{\n+    name::{known, AsName},\n+    ExpansionInfo, MacroCallId,\n+};\n use hir_ty::Interner;\n use itertools::Itertools;\n use rustc_hash::{FxHashMap, FxHashSet};\n@@ -910,13 +913,14 @@ impl<'db> SemanticsImpl<'db> {\n \n     fn resolve_extern_crate(&self, extern_crate: &ast::ExternCrate) -> Option<Crate> {\n         let krate = self.scope(extern_crate.syntax()).krate()?;\n-        krate.dependencies(self.db).into_iter().find_map(|dep| {\n-            if dep.name == extern_crate.name_ref()?.as_name() {\n-                Some(dep.krate)\n-            } else {\n-                None\n-            }\n-        })\n+        let name = extern_crate.name_ref()?.as_name();\n+        if name == known::SELF_PARAM {\n+            return Some(krate);\n+        }\n+        krate\n+            .dependencies(self.db)\n+            .into_iter()\n+            .find_map(|dep| (dep.name == name).then(|| dep.krate))\n     }\n \n     fn resolve_variant(&self, record_lit: ast::RecordExpr) -> Option<VariantId> {"}, {"sha": "ded76d3ca315a7194eeb5a3434944f4bb580c65e", "filename": "crates/ide/src/syntax_highlighting/test_data/highlight_keywords.html", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d460b7c9d1c64d394c8078259887e027c4e322c1/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_keywords.html", "raw_url": "https://github.com/rust-lang/rust/raw/d460b7c9d1c64d394c8078259887e027c4e322c1/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_keywords.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_keywords.html?ref=d460b7c9d1c64d394c8078259887e027c4e322c1", "patch": "@@ -41,7 +41,7 @@\n \n .unresolved_reference { color: #FC5555; text-decoration: wavy underline; }\n </style>\n-<pre><code><span class=\"keyword\">extern</span> <span class=\"keyword\">crate</span> <span class=\"unresolved_reference\">self</span><span class=\"semicolon\">;</span>\n+<pre><code><span class=\"keyword\">extern</span> <span class=\"keyword\">crate</span> <span class=\"self_keyword crate_root\">self</span><span class=\"semicolon\">;</span>\n \n <span class=\"keyword\">use</span> <span class=\"keyword crate_root\">crate</span><span class=\"semicolon\">;</span>\n <span class=\"keyword\">use</span> <span class=\"self_keyword crate_root\">self</span><span class=\"semicolon\">;</span>"}]}