{"sha": "24fbf88230f37d63bb236569d6a9600ad9560f6f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0ZmJmODgyMzBmMzdkNjNiYjIzNjU2OWQ2YTk2MDBhZDk1NjBmNmY=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-10-01T23:43:45Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-10-01T23:49:39Z"}, "message": "In lint, don't complain about infer mode if legacy modes aren't enabled", "tree": {"sha": "3949f3e0c86801f9ac3a2859bde9ce519f46d4af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3949f3e0c86801f9ac3a2859bde9ce519f46d4af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/24fbf88230f37d63bb236569d6a9600ad9560f6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/24fbf88230f37d63bb236569d6a9600ad9560f6f", "html_url": "https://github.com/rust-lang/rust/commit/24fbf88230f37d63bb236569d6a9600ad9560f6f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/24fbf88230f37d63bb236569d6a9600ad9560f6f/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e480e19694b234ba3eca20748947a4e47e805341", "url": "https://api.github.com/repos/rust-lang/rust/commits/e480e19694b234ba3eca20748947a4e47e805341", "html_url": "https://github.com/rust-lang/rust/commit/e480e19694b234ba3eca20748947a4e47e805341"}], "stats": {"total": 21, "additions": 12, "deletions": 9}, "files": [{"sha": "bba2430d95ea91061152010b1f6522b61e323d24", "filename": "src/rustc/middle/lint.rs", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/24fbf88230f37d63bb236569d6a9600ad9560f6f/src%2Frustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24fbf88230f37d63bb236569d6a9600ad9560f6f/src%2Frustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Flint.rs?ref=24fbf88230f37d63bb236569d6a9600ad9560f6f", "patch": "@@ -683,7 +683,8 @@ fn check_fn_deprecated_modes(tcx: ty::ctxt, fn_ty: ty::t, decl: ast::fn_decl,\n                        mode_to_str(arg_ast.mode));\n                 match arg_ast.mode {\n                     ast::expl(ast::by_copy) => {\n-                        /* always allow by-copy */\n+                        // This should warn, but we can't yet\n+                        // since it's still used. -- tjc\n                     }\n \n                     ast::expl(_) => {\n@@ -694,14 +695,16 @@ fn check_fn_deprecated_modes(tcx: ty::ctxt, fn_ty: ty::t, decl: ast::fn_decl,\n                     }\n \n                     ast::infer(_) => {\n-                        let kind = ty::type_kind(tcx, arg_ty.ty);\n-                        if !ty::kind_is_safe_for_default_mode(kind) {\n-                            tcx.sess.span_lint(\n-                                deprecated_mode, id, id,\n-                                span,\n-                                fmt!(\"argument %d uses the default mode \\\n-                                      but shouldn't\",\n-                                     counter));\n+                        if tcx.legacy_modes {\n+                            let kind = ty::type_kind(tcx, arg_ty.ty);\n+                            if !ty::kind_is_safe_for_default_mode(kind) {\n+                                tcx.sess.span_lint(\n+                                    deprecated_mode, id, id,\n+                                    span,\n+                                    fmt!(\"argument %d uses the default mode \\\n+                                          but shouldn't\",\n+                                         counter));\n+                            }\n                         }\n                     }\n                 }"}]}