{"sha": "0008e0d502fab4aee5909d23ac277701727903e8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwMDhlMGQ1MDJmYWI0YWVlNTkwOWQyM2FjMjc3NzAxNzI3OTAzZTg=", "commit": {"author": {"name": "Lyndon Brown", "email": "jnqnfe@gmail.com", "date": "2018-11-10T06:17:36Z"}, "committer": {"name": "Lyndon Brown", "email": "jnqnfe@gmail.com", "date": "2018-12-12T18:13:40Z"}, "message": "use actual invalid string in OsStr::to_string_lossy example", "tree": {"sha": "a25e55eee98c6190def755168d60a150aaff8ef3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a25e55eee98c6190def755168d60a150aaff8ef3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0008e0d502fab4aee5909d23ac277701727903e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0008e0d502fab4aee5909d23ac277701727903e8", "html_url": "https://github.com/rust-lang/rust/commit/0008e0d502fab4aee5909d23ac277701727903e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0008e0d502fab4aee5909d23ac277701727903e8/comments", "author": {"login": "jnqnfe", "id": 33935229, "node_id": "MDQ6VXNlcjMzOTM1MjI5", "avatar_url": "https://avatars.githubusercontent.com/u/33935229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jnqnfe", "html_url": "https://github.com/jnqnfe", "followers_url": "https://api.github.com/users/jnqnfe/followers", "following_url": "https://api.github.com/users/jnqnfe/following{/other_user}", "gists_url": "https://api.github.com/users/jnqnfe/gists{/gist_id}", "starred_url": "https://api.github.com/users/jnqnfe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jnqnfe/subscriptions", "organizations_url": "https://api.github.com/users/jnqnfe/orgs", "repos_url": "https://api.github.com/users/jnqnfe/repos", "events_url": "https://api.github.com/users/jnqnfe/events{/privacy}", "received_events_url": "https://api.github.com/users/jnqnfe/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jnqnfe", "id": 33935229, "node_id": "MDQ6VXNlcjMzOTM1MjI5", "avatar_url": "https://avatars.githubusercontent.com/u/33935229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jnqnfe", "html_url": "https://github.com/jnqnfe", "followers_url": "https://api.github.com/users/jnqnfe/followers", "following_url": "https://api.github.com/users/jnqnfe/following{/other_user}", "gists_url": "https://api.github.com/users/jnqnfe/gists{/gist_id}", "starred_url": "https://api.github.com/users/jnqnfe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jnqnfe/subscriptions", "organizations_url": "https://api.github.com/users/jnqnfe/orgs", "repos_url": "https://api.github.com/users/jnqnfe/repos", "events_url": "https://api.github.com/users/jnqnfe/events{/privacy}", "received_events_url": "https://api.github.com/users/jnqnfe/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bd47d6825bf4090517549d33cfef10d3300b4a75", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd47d6825bf4090517549d33cfef10d3300b4a75", "html_url": "https://github.com/rust-lang/rust/commit/bd47d6825bf4090517549d33cfef10d3300b4a75"}], "stats": {"total": 41, "additions": 33, "deletions": 8}, "files": [{"sha": "766142fb57f8cc2c0b474c97d5ef7f564b2b54f5", "filename": "src/libstd/ffi/os_str.rs", "status": "modified", "additions": 33, "deletions": 8, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/0008e0d502fab4aee5909d23ac277701727903e8/src%2Flibstd%2Fffi%2Fos_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0008e0d502fab4aee5909d23ac277701727903e8/src%2Flibstd%2Fffi%2Fos_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fffi%2Fos_str.rs?ref=0008e0d502fab4aee5909d23ac277701727903e8", "patch": "@@ -536,17 +536,42 @@ impl OsStr {\n     ///\n     /// # Examples\n     ///\n-    /// Calling `to_string_lossy` on an `OsStr` with valid unicode:\n+    /// Calling `to_string_lossy` on an `OsStr` with invalid unicode:\n     ///\n     /// ```\n-    /// use std::ffi::OsStr;\n-    ///\n-    /// let os_str = OsStr::new(\"foo\");\n-    /// assert_eq!(os_str.to_string_lossy(), \"foo\");\n+    /// // Note, due to differences in how Unix and Windows represent strings,\n+    /// // we are forced to complicate this example, setting up example `OsStr`s\n+    /// // with different source data and via different platform extensions.\n+    /// // Understand that in reality you could end up with such example invalid\n+    /// // sequences simply through collecting user command line arguments, for\n+    /// // example.\n+    ///\n+    /// #[cfg(any(unix, target_os = \"redox\"))] {\n+    ///     use std::ffi::OsStr;\n+    ///     use std::os::unix::ffi::OsStrExt;\n+    ///\n+    ///     // Here, the values 0x66 and 0x6f correspond to 'f' and 'o'\n+    ///     // respectively. The value 0x80 is a lone continuation byte, invalid\n+    ///     // in a UTF-8 sequence.\n+    ///     let source = [0x66, 0x6f, 0x80, 0x6f];\n+    ///     let os_str = OsStr::from_bytes(&source[..]);\n+    ///\n+    ///     assert_eq!(os_str.to_string_lossy(), \"fo\ufffdo\");\n+    /// }\n+    /// #[cfg(windows)] {\n+    ///     use std::ffi::OsString;\n+    ///     use std::os::windows::prelude::*;\n+    ///\n+    ///     // Here the values 0x0066 and 0x006f correspond to 'f' and 'o'\n+    ///     // respectively. The value 0xD800 is a lone surrogate half, invalid\n+    ///     // in a UTF-16 sequence.\n+    ///     let source = [0x0066, 0x006f, 0xD800, 0x006f];\n+    ///     let os_string = OsString::from_wide(&source[..]);\n+    ///     let os_str = os_string.as_os_str();\n+    ///\n+    ///     assert_eq!(os_str.to_string_lossy(), \"fo\ufffdo\");\n+    /// }\n     /// ```\n-    ///\n-    /// Had `os_str` contained invalid unicode, the `to_string_lossy` call might\n-    /// have returned `\"fo\ufffd\"`.\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     pub fn to_string_lossy(&self) -> Cow<str> {\n         self.inner.to_string_lossy()"}]}