{"sha": "1fdbf81181356854b692fe0407bac75aba6ea942", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFmZGJmODExODEzNTY4NTRiNjkyZmUwNDA3YmFjNzVhYmE2ZWE5NDI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-14T08:18:08Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-14T08:18:08Z"}, "message": "Consolidate hir diagnostics code in one place", "tree": {"sha": "8118892265a4be2ff71da372061fbffc3c9ffb3d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8118892265a4be2ff71da372061fbffc3c9ffb3d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1fdbf81181356854b692fe0407bac75aba6ea942", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1fdbf81181356854b692fe0407bac75aba6ea942", "html_url": "https://github.com/rust-lang/rust/commit/1fdbf81181356854b692fe0407bac75aba6ea942", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1fdbf81181356854b692fe0407bac75aba6ea942/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6f35401219e32c7d62e106a45637e7f5304723c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6f35401219e32c7d62e106a45637e7f5304723c", "html_url": "https://github.com/rust-lang/rust/commit/c6f35401219e32c7d62e106a45637e7f5304723c"}], "stats": {"total": 37, "additions": 18, "deletions": 19}, "files": [{"sha": "dbda25d1d90a4b20ad2832a4a22d3c213731a0cc", "filename": "crates/ra_hir/src/code_model.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "patch": "@@ -24,12 +24,10 @@ use hir_expand::{\n };\n use hir_ty::{\n     autoderef,\n+    diagnostics::{expr::ExprValidator, unsafe_check::UnsafeValidator},\n     display::{HirDisplayError, HirFormatter},\n-    expr::ExprValidator,\n-    method_resolution,\n-    unsafe_validation::UnsafeValidator,\n-    ApplicationTy, Canonical, GenericPredicate, InEnvironment, Substs, TraitEnvironment, Ty,\n-    TyDefId, TypeCtor,\n+    method_resolution, ApplicationTy, Canonical, GenericPredicate, InEnvironment, Substs,\n+    TraitEnvironment, Ty, TyDefId, TypeCtor,\n };\n use ra_db::{CrateId, Edition, FileId};\n use ra_prof::profile;"}, {"sha": "bfa543e5b6af126dcc1446de6b7558fd93c36602", "filename": "crates/ra_hir/src/source_analyzer.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir%2Fsrc%2Fsource_analyzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir%2Fsrc%2Fsource_analyzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fsource_analyzer.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "patch": "@@ -18,7 +18,7 @@ use hir_def::{\n };\n use hir_expand::{hygiene::Hygiene, name::AsName, HirFileId, InFile};\n use hir_ty::{\n-    expr::{record_literal_missing_fields, record_pattern_missing_fields},\n+    diagnostics::expr::{record_literal_missing_fields, record_pattern_missing_fields},\n     InferenceResult, Substs, Ty,\n };\n use ra_syntax::{"}, {"sha": "07c7729b3a8aadbd9ddd51f00ec36cdf56ad4364", "filename": "crates/ra_hir_ty/src/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "patch": "@@ -1,4 +1,7 @@\n //! FIXME: write short doc here\n+pub mod expr;\n+mod match_check;\n+pub mod unsafe_check;\n \n use std::any::Any;\n "}, {"sha": "51c97f801405dd561bbb70c0e5f536c3e31965eb", "filename": "crates/ra_hir_ty/src/diagnostics/expr.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Fexpr.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "patch": "@@ -10,9 +10,9 @@ use rustc_hash::FxHashSet;\n use crate::{\n     db::HirDatabase,\n     diagnostics::{\n+        match_check::{is_useful, MatchCheckCtx, Matrix, PatStack, Usefulness},\n         MismatchedArgCount, MissingFields, MissingMatchArms, MissingOkInTailExpr, MissingPatFields,\n     },\n-    match_checking::{is_useful, MatchCheckCtx, Matrix, PatStack, Usefulness},\n     utils::variant_data,\n     ApplicationTy, InferenceResult, Ty, TypeCtor,\n };", "previous_filename": "crates/ra_hir_ty/src/expr.rs"}, {"sha": "722c0e9eead5dff7f4677876a1c0931c21615179", "filename": "crates/ra_hir_ty/src/diagnostics/match_check.rs", "status": "renamed", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Fmatch_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Fmatch_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Fmatch_check.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "patch": "@@ -218,15 +218,16 @@\n //!   ```\n use std::sync::Arc;\n \n-use smallvec::{smallvec, SmallVec};\n-\n-use crate::{\n-    db::HirDatabase,\n-    expr::{Body, Expr, Literal, Pat, PatId},\n-    ApplicationTy, InferenceResult, Ty, TypeCtor,\n+use hir_def::{\n+    adt::VariantData,\n+    body::Body,\n+    expr::{Expr, Literal, Pat, PatId},\n+    AdtId, EnumVariantId, VariantId,\n };\n-use hir_def::{adt::VariantData, AdtId, EnumVariantId, VariantId};\n use ra_arena::Idx;\n+use smallvec::{smallvec, SmallVec};\n+\n+use crate::{db::HirDatabase, ApplicationTy, InferenceResult, Ty, TypeCtor};\n \n #[derive(Debug, Clone, Copy)]\n /// Either a pattern from the source code being analyzed, represented as", "previous_filename": "crates/ra_hir_ty/src/match_checking.rs"}, {"sha": "c512c4f8e9cb0204b161493186af0c88ef3f066c", "filename": "crates/ra_hir_ty/src/diagnostics/unsafe_check.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Funsafe_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Funsafe_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Fdiagnostics%2Funsafe_check.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "previous_filename": "crates/ra_hir_ty/src/unsafe_validation.rs"}, {"sha": "d54568e67a1588c37433027b3dc5b9cfcf538951", "filename": "crates/ra_hir_ty/src/lib.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Flib.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "patch": "@@ -12,15 +12,12 @@ pub mod traits;\n pub mod method_resolution;\n mod op;\n mod lower;\n-mod match_checking;\n pub(crate) mod infer;\n pub(crate) mod utils;\n \n pub mod display;\n pub mod db;\n pub mod diagnostics;\n-pub mod expr;\n-pub mod unsafe_validation;\n \n #[cfg(test)]\n mod tests;"}, {"sha": "519f43c4e323b623f4eb92c56826b392d7ae6227", "filename": "crates/ra_hir_ty/src/test_db.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Ftest_db.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fdbf81181356854b692fe0407bac75aba6ea942/crates%2Fra_hir_ty%2Fsrc%2Ftest_db.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftest_db.rs?ref=1fdbf81181356854b692fe0407bac75aba6ea942", "patch": "@@ -14,8 +14,8 @@ use stdx::format_to;\n use test_utils::extract_annotations;\n \n use crate::{\n-    db::HirDatabase, diagnostics::Diagnostic, expr::ExprValidator,\n-    unsafe_validation::UnsafeValidator,\n+    db::HirDatabase,\n+    diagnostics::{expr::ExprValidator, unsafe_check::UnsafeValidator, Diagnostic},\n };\n \n #[salsa::database("}]}