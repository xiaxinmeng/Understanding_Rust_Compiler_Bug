{"sha": "db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiOGRkYmY1NzBmYTdkOGRmNWQ3MWIxOWI0NGE3NzFjODBjNjg5YmE=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-12-05T16:31:31Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-12-05T16:31:31Z"}, "message": "Move tooltips messages to CSS instead of inside HTML", "tree": {"sha": "3d198a0000c0c751e2e02558fc0d209cc229494e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d198a0000c0c751e2e02558fc0d209cc229494e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "html_url": "https://github.com/rust-lang/rust/commit/db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7cff213e937c1bb301be807ce04fcf6092b9163", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7cff213e937c1bb301be807ce04fcf6092b9163", "html_url": "https://github.com/rust-lang/rust/commit/c7cff213e937c1bb301be807ce04fcf6092b9163"}], "stats": {"total": 112, "additions": 47, "deletions": 65}, "files": [{"sha": "47d2707e40dfc493d7e70eea174f84a40a9875bf", "filename": "src/librustdoc/html/highlight.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs?ref=db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "patch": "@@ -11,6 +11,7 @@ use std::fmt::{Display, Write};\n use std::iter::Peekable;\n \n use rustc_lexer::{LiteralKind, TokenKind};\n+use rustc_span::edition::Edition;\n use rustc_span::symbol::Ident;\n use rustc_span::with_default_session_globals;\n \n@@ -19,16 +20,20 @@ crate fn render_with_highlighting(\n     src: String,\n     class: Option<&str>,\n     playground_button: Option<&str>,\n-    tooltip: Option<(&str, &str)>,\n+    tooltip: Option<(Option<Edition>, &str)>,\n ) -> String {\n     debug!(\"highlighting: ================\\n{}\\n==============\", src);\n     let mut out = String::with_capacity(src.len());\n-    if let Some((tooltip, class)) = tooltip {\n+    if let Some((edition_info, class)) = tooltip {\n         write!(\n             out,\n-            \"<div class='information'><div class='tooltip {}'>\u24d8<span \\\n-                  class='tooltiptext'>{}</span></div></div>\",\n-            class, tooltip\n+            \"<div class='information'><div class='tooltip {}'{}>\u24d8</div></div>\",\n+            class,\n+            if let Some(edition_info) = edition_info {\n+                format!(\" edition=\\\"{}\\\"\", edition_info)\n+            } else {\n+                String::new()\n+            },\n         )\n         .unwrap();\n     }"}, {"sha": "6229a479b4d09171b87a982315c2de492aaac2a5", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 14, "deletions": 47, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "patch": "@@ -286,60 +286,27 @@ impl<'a, I: Iterator<Item = Event<'a>>> Iterator for CodeBlocks<'_, 'a, I> {\n         });\n \n         let tooltip = if ignore != Ignore::None {\n-            Some((\"This example is not tested\".to_owned(), \"ignore\"))\n+            Some((None, \"ignore\"))\n         } else if compile_fail {\n-            Some((\"This example deliberately fails to compile\".to_owned(), \"compile_fail\"))\n+            Some((None, \"compile_fail\"))\n         } else if should_panic {\n-            Some((\"This example panics\".to_owned(), \"should_panic\"))\n+            Some((None, \"should_panic\"))\n         } else if explicit_edition {\n-            Some((format!(\"This code runs with edition {}\", edition), \"edition\"))\n+            Some((Some(edition), \"edition\"))\n         } else {\n             None\n         };\n \n-        if let Some((s1, s2)) = tooltip {\n-            s.push_str(&highlight::render_with_highlighting(\n-                text,\n-                Some(&format!(\n-                    \"rust-example-rendered{}\",\n-                    if ignore != Ignore::None {\n-                        \" ignore\"\n-                    } else if compile_fail {\n-                        \" compile_fail\"\n-                    } else if should_panic {\n-                        \" should_panic\"\n-                    } else if explicit_edition {\n-                        \" edition \"\n-                    } else {\n-                        \"\"\n-                    }\n-                )),\n-                playground_button.as_deref(),\n-                Some((s1.as_str(), s2)),\n-            ));\n-            Some(Event::Html(s.into()))\n-        } else {\n-            s.push_str(&highlight::render_with_highlighting(\n-                text,\n-                Some(&format!(\n-                    \"rust-example-rendered{}\",\n-                    if ignore != Ignore::None {\n-                        \" ignore\"\n-                    } else if compile_fail {\n-                        \" compile_fail\"\n-                    } else if should_panic {\n-                        \" should_panic\"\n-                    } else if explicit_edition {\n-                        \" edition \"\n-                    } else {\n-                        \"\"\n-                    }\n-                )),\n-                playground_button.as_deref(),\n-                None,\n-            ));\n-            Some(Event::Html(s.into()))\n-        }\n+        s.push_str(&highlight::render_with_highlighting(\n+            text,\n+            Some(&format!(\n+                \"rust-example-rendered{}\",\n+                if let Some((_, class)) = tooltip { format!(\" {}\", class) } else { String::new() }\n+            )),\n+            playground_button.as_deref(),\n+            tooltip,\n+        ));\n+        Some(Event::Html(s.into()))\n     }\n }\n "}, {"sha": "afc4308b68f93a5de2d1597a3f244b652907e595", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 17, "deletions": 7, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "patch": "@@ -1079,30 +1079,40 @@ h3 > .collapse-toggle, h4 > .collapse-toggle {\n \tcursor: pointer;\n }\n \n-.tooltip .tooltiptext {\n-\twidth: 120px;\n+.tooltip::after {\n \tdisplay: none;\n \ttext-align: center;\n \tpadding: 5px 3px 3px 3px;\n \tborder-radius: 6px;\n \tmargin-left: 5px;\n-\ttop: -5px;\n-\tleft: 105%;\n-\tz-index: 10;\n \tfont-size: 16px;\n }\n \n-.tooltip .tooltiptext::after {\n+.tooltip.ignore::after {\n+\tcontent: \"This example is not tested\";\n+}\n+.tooltip.compile_fail::after {\n+\tcontent: \"This example deliberately fails to compile\";\n+}\n+.tooltip.should_panic::after {\n+\tcontent: \"This example panics\";\n+}\n+.tooltip.edition::after {\n+\tcontent: \"This code runs with edition \" attr(edition);\n+}\n+\n+.tooltip::before {\n \tcontent: \" \";\n \tposition: absolute;\n \ttop: 50%;\n \tleft: 16px;\n \tmargin-top: -5px;\n \tborder-width: 5px;\n \tborder-style: solid;\n+\tdisplay: none;\n }\n \n-.tooltip:hover .tooltiptext {\n+.tooltip:hover::before, .tooltip:hover::after {\n \tdisplay: inline;\n }\n "}, {"sha": "9c71fbb7f03a46a55334a7351e2e3c8bfed7ef2c", "filename": "src/librustdoc/html/static/themes/ayu.css", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css?ref=db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "patch": "@@ -388,13 +388,13 @@ pre.ignore:hover, .information:hover + pre.ignore {\n \tcolor: #39AFD7;\n }\n \n-.tooltip .tooltiptext {\n+.tooltip::after {\n \tbackground-color: #314559;\n \tcolor: #c5c5c5;\n \tborder: 1px solid #5c6773;\n }\n \n-.tooltip .tooltiptext::after {\n+.tooltip::before {\n \tborder-color: transparent #314559 transparent transparent;\n }\n "}, {"sha": "eb25272ea3bbc7fb4c3169071e4c6d77f453ec79", "filename": "src/librustdoc/html/static/themes/dark.css", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css?ref=db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "patch": "@@ -337,13 +337,13 @@ pre.ignore:hover, .information:hover + pre.ignore {\n \tcolor: #0089ff;\n }\n \n-.tooltip .tooltiptext {\n+.tooltip::after {\n \tbackground-color: #000;\n \tcolor: #fff;\n \tborder-color: #000;\n }\n \n-.tooltip .tooltiptext::after {\n+.tooltip::before {\n \tborder-color: transparent black transparent transparent;\n }\n "}, {"sha": "20e3c0a40929ab2a6e56972b813d28056a26a5b2", "filename": "src/librustdoc/html/static/themes/light.css", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/db8ddbf570fa7d8df5d71b19b44a771c80c689ba/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css?ref=db8ddbf570fa7d8df5d71b19b44a771c80c689ba", "patch": "@@ -329,12 +329,12 @@ pre.ignore:hover, .information:hover + pre.ignore {\n \tcolor: #0089ff;\n }\n \n-.tooltip .tooltiptext {\n+.tooltip::after {\n \tbackground-color: #000;\n \tcolor: #fff;\n }\n \n-.tooltip .tooltiptext::after {\n+.tooltip::before {\n \tborder-color: transparent black transparent transparent;\n }\n "}]}