{"sha": "2c66c296dba34b1f5674578d85057250576d32ff", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjNjZjMjk2ZGJhMzRiMWY1Njc0NTc4ZDg1MDU3MjUwNTc2ZDMyZmY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-09-09T14:38:17Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-09-09T19:07:11Z"}, "message": "rollup merge of #17052 : pcwalton/feature-gate-subslices", "tree": {"sha": "27162ce254eefd364d3849e1a2ea1fec81f723e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/27162ce254eefd364d3849e1a2ea1fec81f723e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2c66c296dba34b1f5674578d85057250576d32ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2c66c296dba34b1f5674578d85057250576d32ff", "html_url": "https://github.com/rust-lang/rust/commit/2c66c296dba34b1f5674578d85057250576d32ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2c66c296dba34b1f5674578d85057250576d32ff/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb3c67a65c6ed2acf95e8eb658d4072ec32227ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/fb3c67a65c6ed2acf95e8eb658d4072ec32227ff", "html_url": "https://github.com/rust-lang/rust/commit/fb3c67a65c6ed2acf95e8eb658d4072ec32227ff"}, {"sha": "22179f49e573edf3616895419f1acd8b93be9cb9", "url": "https://api.github.com/repos/rust-lang/rust/commits/22179f49e573edf3616895419f1acd8b93be9cb9", "html_url": "https://github.com/rust-lang/rust/commit/22179f49e573edf3616895419f1acd8b93be9cb9"}], "stats": {"total": 63, "additions": 57, "deletions": 6}, "files": [{"sha": "552ff716e8134526090cad166ae0cdb70a260f79", "filename": "src/doc/rust.md", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Fdoc%2Frust.md", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Fdoc%2Frust.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frust.md?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -3290,13 +3290,15 @@ between `_` and `..` is that the pattern `C(_)` is only type-correct if `C` has\n exactly one argument, while the pattern `C(..)` is type-correct for any enum\n variant `C`, regardless of how many arguments `C` has.\n \n-Used inside a vector pattern, `..` stands for any number of elements. This\n-wildcard can be used at most once for a given vector, which implies that it\n-cannot be used to specifically match elements that are at an unknown distance\n-from both ends of a vector, like `[.., 42, ..]`. If followed by a variable name,\n-it will bind the corresponding slice to the variable. Example:\n+Used inside a vector pattern, `..` stands for any number of elements, when the\n+`advanced_slice_patterns` feature gate is turned on. This wildcard can be used\n+at most once for a given vector, which implies that it cannot be used to\n+specifically match elements that are at an unknown distance from both ends of a\n+vector, like `[.., 42, ..]`.  If followed by a variable name, it will bind the\n+corresponding slice to the variable.  Example:\n \n ~~~~\n+# #![feature(advanced_slice_patterns)]\n fn is_symmetric(list: &[uint]) -> bool {\n     match list {\n         [] | [_]                   => true,"}, {"sha": "c83b81660d58fb296231cd22d37bb74673c6512b", "filename": "src/librustc/front/feature_gate.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Flibrustc%2Ffront%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Flibrustc%2Ffront%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ffront%2Ffeature_gate.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -69,6 +69,7 @@ static KNOWN_FEATURES: &'static [(&'static str, Status)] = &[\n     (\"rustc_diagnostic_macros\", Active),\n     (\"unboxed_closures\", Active),\n     (\"import_shadowing\", Active),\n+    (\"advanced_slice_patterns\", Active),\n \n     // if you change this list without updating src/doc/rust.md, cmr will be sad\n \n@@ -364,6 +365,20 @@ impl<'a> Visitor<()> for Context<'a> {\n         }\n     }\n \n+    fn visit_pat(&mut self, pattern: &ast::Pat, (): ()) {\n+        match pattern.node {\n+            ast::PatVec(_, Some(_), ref last) if !last.is_empty() => {\n+                self.gate_feature(\"advanced_slice_patterns\",\n+                                  pattern.span,\n+                                  \"multiple-element slice matches anywhere \\\n+                                   but at the end of a slice (e.g. \\\n+                                   `[0, ..xs, 0]` are experimental\")\n+            }\n+            _ => {}\n+        }\n+        visit::walk_pat(self, pattern, ())\n+    }\n+\n     fn visit_fn(&mut self,\n                 fn_kind: &visit::FnKind,\n                 fn_decl: &ast::FnDecl,"}, {"sha": "62f4f4aaede29de61f5a1e64c9bdb4ed91254917", "filename": "src/test/compile-fail/borrowck-vec-pattern-element-loan.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Fborrowck-vec-pattern-element-loan.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Fborrowck-vec-pattern-element-loan.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fborrowck-vec-pattern-element-loan.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n+\n fn a<'a>() -> &'a [int] {\n     let vec = vec!(1, 2, 3, 4);\n     let vec: &[int] = vec.as_slice(); //~ ERROR does not live long enough"}, {"sha": "51e3c612c717143fa66359be2930f4289bda87b4", "filename": "src/test/compile-fail/borrowck-vec-pattern-nesting.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Fborrowck-vec-pattern-nesting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Fborrowck-vec-pattern-nesting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fborrowck-vec-pattern-nesting.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n \n fn a() {\n     let mut vec = [box 1i, box 2, box 3];"}, {"sha": "c6753baf0571e1f2d67fbb5246275aff6c9dd1e2", "filename": "src/test/compile-fail/feature-gate-advanced-slice-features.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Ffeature-gate-advanced-slice-features.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Ffeature-gate-advanced-slice-features.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ffeature-gate-advanced-slice-features.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let x = [ 1i, 2, 3, 4, 5 ];\n+    match x {\n+        [ ..xs, 4, 5 ] => {}    //~ ERROR multiple-element slice matches\n+        [ 1, ..xs, 5 ] => {}    //~ ERROR multiple-element slice matches\n+        [ 1, 2, ..xs ] => {}    // OK without feature gate\n+    }\n+}\n+"}, {"sha": "7b52e7774d47119813797ed6d206b73c8833d6d0", "filename": "src/test/compile-fail/non-exhaustive-pattern-witness.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Fnon-exhaustive-pattern-witness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Fcompile-fail%2Fnon-exhaustive-pattern-witness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fnon-exhaustive-pattern-witness.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(struct_variant)]\n+#![feature(advanced_slice_patterns, struct_variant)]\n \n struct Foo {\n     first: bool,"}, {"sha": "1c87b6dad8970abffcbdd4f03cbd4b9df2bdb98a", "filename": "src/test/run-pass/ignore-all-the-things.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fignore-all-the-things.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fignore-all-the-things.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fignore-all-the-things.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n+\n struct Foo(int, int, int, int);\n struct Bar{a: int, b: int, c: int, d: int}\n "}, {"sha": "f45b988b8363b3fb0d7c07b216be3ef758aa62f0", "filename": "src/test/run-pass/issue-7784.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fissue-7784.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fissue-7784.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-7784.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n+\n fn foo<T: Add<T, T> + Clone>([x, y, z]: [T, ..3]) -> (T, T, T) {\n     (x.clone(), x.clone() + y.clone(), x + y + z)\n }"}, {"sha": "ae4fd1f1993b7227ebcded4fa9c28e999972dacb", "filename": "src/test/run-pass/match-vec-alternatives.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fmatch-vec-alternatives.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fmatch-vec-alternatives.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmatch-vec-alternatives.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n+\n fn match_vecs<'a, T>(l1: &'a [T], l2: &'a [T]) -> &'static str {\n     match (l1, l2) {\n         ([], []) => \"both empty\","}, {"sha": "a1a14823ff5955b5923d6d6021bd4c7d903c3959", "filename": "src/test/run-pass/vec-matching-fixed.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fvec-matching-fixed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fvec-matching-fixed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fvec-matching-fixed.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n+\n fn a() {\n     let x = [1i, 2, 3];\n     match x {"}, {"sha": "3a55b4b68a9d3b8b3dba5d20e2937e38fd9b11d6", "filename": "src/test/run-pass/vec-matching-fold.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fvec-matching-fold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fvec-matching-fold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fvec-matching-fold.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n+\n fn foldl<T,U:Clone>(values: &[T],\n                     initial: U,\n                     function: |partial: U, element: &T| -> U)"}, {"sha": "89d4e3743e367abeb27656a352fdf1cebdf6666c", "filename": "src/test/run-pass/vec-matching.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fvec-matching.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c66c296dba34b1f5674578d85057250576d32ff/src%2Ftest%2Frun-pass%2Fvec-matching.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fvec-matching.rs?ref=2c66c296dba34b1f5674578d85057250576d32ff", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(advanced_slice_patterns)]\n+\n fn a() {\n     let x = [1i];\n     match x {"}]}