{"sha": "1e5266260aad92973caeede3500f848c277f84e2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlNTI2NjI2MGFhZDkyOTczY2FlZWRlMzUwMGY4NDhjMjc3Zjg0ZTI=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2012-02-22T12:35:17Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2012-02-22T12:35:17Z"}, "message": "Take move captures in account in mutability checker\n\nCloses #1461", "tree": {"sha": "e9a7f8e48192c659cdcb5d9953e92604e4c84a16", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9a7f8e48192c659cdcb5d9953e92604e4c84a16"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e5266260aad92973caeede3500f848c277f84e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e5266260aad92973caeede3500f848c277f84e2", "html_url": "https://github.com/rust-lang/rust/commit/1e5266260aad92973caeede3500f848c277f84e2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e5266260aad92973caeede3500f848c277f84e2/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8015e6d52b7eeea47f9e61c6ac42487935474ca4", "url": "https://api.github.com/repos/rust-lang/rust/commits/8015e6d52b7eeea47f9e61c6ac42487935474ca4", "html_url": "https://github.com/rust-lang/rust/commit/8015e6d52b7eeea47f9e61c6ac42487935474ca4"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "b490387424d2433715ad9e8dfb4a7971b9f97ca1", "filename": "src/comp/middle/mutbl.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1e5266260aad92973caeede3500f848c277f84e2/src%2Fcomp%2Fmiddle%2Fmutbl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e5266260aad92973caeede3500f848c277f84e2/src%2Fcomp%2Fmiddle%2Fmutbl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fmutbl.rs?ref=1e5266260aad92973caeede3500f848c277f84e2", "patch": "@@ -172,6 +172,16 @@ fn visit_expr(cx: @ctx, ex: @expr, &&e: (), v: visit::vt<()>) {\n       expr_assign(dest, src) | expr_assign_op(_, dest, src) {\n         check_lval(cx, dest, msg_assign);\n       }\n+      expr_fn(_, _, _, cap) {\n+        for moved in cap.moves {\n+            let def = cx.tcx.def_map.get(moved.id);\n+            alt is_immutable_def(cx, def) {\n+              some(name) { mk_err(cx, moved.span, msg_move_out, moved.name); }\n+              _ { }\n+            }\n+            cx.mutbl_map.insert(ast_util::def_id_of_def(def).node, ());\n+        }\n+      }\n       _ { }\n     }\n     visit::visit_expr(ex, e, v);"}, {"sha": "3f7274deae402f9b181090f77274beb0bd8b9855", "filename": "src/comp/middle/trans/closure.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e5266260aad92973caeede3500f848c277f84e2/src%2Fcomp%2Fmiddle%2Ftrans%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e5266260aad92973caeede3500f848c277f84e2/src%2Fcomp%2Fmiddle%2Ftrans%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans%2Fclosure.rs?ref=1e5266260aad92973caeede3500f848c277f84e2", "patch": "@@ -376,7 +376,9 @@ fn build_closure(bcx0: block,\n             env_vals += [env_move(lv.val, ty, lv.kind)];\n           }\n           capture::cap_drop {\n+            assert lv.kind == owned;\n             bcx = drop_ty(bcx, lv.val, ty);\n+            bcx = zero_alloca(bcx, lv.val, ty);\n           }\n         }\n     }"}, {"sha": "d6fa0e533d5a4637d6f22741356fdefdd4cb3722", "filename": "src/test/run-pass/unused-move-capture.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1e5266260aad92973caeede3500f848c277f84e2/src%2Ftest%2Frun-pass%2Funused-move-capture.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e5266260aad92973caeede3500f848c277f84e2/src%2Ftest%2Frun-pass%2Funused-move-capture.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Funused-move-capture.rs?ref=1e5266260aad92973caeede3500f848c277f84e2", "patch": "@@ -0,0 +1,5 @@\n+fn main() {\n+    let x = ~1;\n+    let lam_move = fn@[move x]() { };\n+    lam_move();\n+}"}]}