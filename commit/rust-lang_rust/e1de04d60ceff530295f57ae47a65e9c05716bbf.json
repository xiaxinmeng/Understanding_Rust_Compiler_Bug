{"sha": "e1de04d60ceff530295f57ae47a65e9c05716bbf", "node_id": "C_kwDOAAsO6NoAKGUxZGUwNGQ2MGNlZmY1MzAyOTVmNTdhZTQ3YTY1ZTljMDU3MTZiYmY", "commit": {"author": {"name": "yue4u", "email": "github@yue.coffee", "date": "2022-11-26T16:53:45Z"}, "committer": {"name": "yue4u", "email": "github@yue.coffee", "date": "2022-11-26T16:53:45Z"}, "message": "fix: only special casing 3 colon in a row", "tree": {"sha": "49b11871ec89d8233c9390e5cf14b43c842cb380", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/49b11871ec89d8233c9390e5cf14b43c842cb380"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1de04d60ceff530295f57ae47a65e9c05716bbf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1de04d60ceff530295f57ae47a65e9c05716bbf", "html_url": "https://github.com/rust-lang/rust/commit/e1de04d60ceff530295f57ae47a65e9c05716bbf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1de04d60ceff530295f57ae47a65e9c05716bbf/comments", "author": {"login": "yue4u", "id": 26110087, "node_id": "MDQ6VXNlcjI2MTEwMDg3", "avatar_url": "https://avatars.githubusercontent.com/u/26110087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yue4u", "html_url": "https://github.com/yue4u", "followers_url": "https://api.github.com/users/yue4u/followers", "following_url": "https://api.github.com/users/yue4u/following{/other_user}", "gists_url": "https://api.github.com/users/yue4u/gists{/gist_id}", "starred_url": "https://api.github.com/users/yue4u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yue4u/subscriptions", "organizations_url": "https://api.github.com/users/yue4u/orgs", "repos_url": "https://api.github.com/users/yue4u/repos", "events_url": "https://api.github.com/users/yue4u/events{/privacy}", "received_events_url": "https://api.github.com/users/yue4u/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yue4u", "id": 26110087, "node_id": "MDQ6VXNlcjI2MTEwMDg3", "avatar_url": "https://avatars.githubusercontent.com/u/26110087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yue4u", "html_url": "https://github.com/yue4u", "followers_url": "https://api.github.com/users/yue4u/followers", "following_url": "https://api.github.com/users/yue4u/following{/other_user}", "gists_url": "https://api.github.com/users/yue4u/gists{/gist_id}", "starred_url": "https://api.github.com/users/yue4u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yue4u/subscriptions", "organizations_url": "https://api.github.com/users/yue4u/orgs", "repos_url": "https://api.github.com/users/yue4u/repos", "events_url": "https://api.github.com/users/yue4u/events{/privacy}", "received_events_url": "https://api.github.com/users/yue4u/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a568f7f9571c2c93fd8e60712878736d942c787", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a568f7f9571c2c93fd8e60712878736d942c787", "html_url": "https://github.com/rust-lang/rust/commit/7a568f7f9571c2c93fd8e60712878736d942c787"}], "stats": {"total": 30, "additions": 4, "deletions": 26}, "files": [{"sha": "0e3b677f2d67704699bff1bccb8a66ee515f8d7d", "filename": "crates/ide-completion/src/context.rs", "status": "modified", "additions": 3, "deletions": 19, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/e1de04d60ceff530295f57ae47a65e9c05716bbf/crates%2Fide-completion%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1de04d60ceff530295f57ae47a65e9c05716bbf/crates%2Fide-completion%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Fcontext.rs?ref=e1de04d60ceff530295f57ae47a65e9c05716bbf", "patch": "@@ -581,7 +581,9 @@ impl<'a> CompletionContext<'a> {\n                     return None;\n                 }\n \n-                if !is_prev_token_valid_path_start_or_segment(&prev_token) {\n+                // has 3 colon in a row\n+                // special casing this as per discussion in https://github.com/rust-lang/rust-analyzer/pull/13611#discussion_r1031845205\n+                if prev_token.prev_token().map(|t| t.kind() == T![:]).unwrap_or(false) {\n                     return None;\n                 }\n             }\n@@ -637,24 +639,6 @@ impl<'a> CompletionContext<'a> {\n     }\n }\n \n-fn is_prev_token_valid_path_start_or_segment(token: &SyntaxToken) -> bool {\n-    if let Some(prev_token) = token.prev_token() {\n-        // token before coloncolon is invalid\n-        if !matches!(\n-            prev_token.kind(),\n-            // trival\n-            WHITESPACE | COMMENT\n-            // PathIdentSegment\n-            | IDENT | T![super] | T![self] | T![Self] | T![crate]\n-            // QualifiedPath\n-            | T![>]\n-        ) {\n-            return false;\n-        }\n-    }\n-    true\n-}\n-\n const OP_TRAIT_LANG_NAMES: &[&str] = &[\n     \"add_assign\",\n     \"add\","}, {"sha": "0e59f4ec54164156902a0df5b40c5b2c964b8695", "filename": "crates/ide-completion/src/tests/special.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e1de04d60ceff530295f57ae47a65e9c05716bbf/crates%2Fide-completion%2Fsrc%2Ftests%2Fspecial.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1de04d60ceff530295f57ae47a65e9c05716bbf/crates%2Fide-completion%2Fsrc%2Ftests%2Fspecial.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Fspecial.rs?ref=e1de04d60ceff530295f57ae47a65e9c05716bbf", "patch": "@@ -967,16 +967,10 @@ fn foo { crate:$0 }\n }\n \n #[test]\n-fn no_completions_in_invalid_path() {\n+fn no_completions_in_after_tripple_colon() {\n     check(\n         r#\"\n fn foo { crate:::$0 }\n-\"#,\n-        expect![\"\"],\n-    );\n-    check(\n-        r#\"\n-fn foo { crate::::$0 }\n \"#,\n         expect![\"\"],\n     );"}]}