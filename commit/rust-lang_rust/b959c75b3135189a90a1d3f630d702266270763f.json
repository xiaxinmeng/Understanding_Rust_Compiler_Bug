{"sha": "b959c75b3135189a90a1d3f630d702266270763f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5NTljNzViMzEzNTE4OWE5MGExZDNmNjMwZDcwMjI2NjI3MDc2M2Y=", "commit": {"author": {"name": "Camelid", "email": "camelidcamel@gmail.com", "date": "2020-12-26T00:16:40Z"}, "committer": {"name": "Camelid", "email": "camelidcamel@gmail.com", "date": "2020-12-26T00:20:08Z"}, "message": "Prefer `pub(crate)` over no modifier", "tree": {"sha": "c04b5cdc5bb25e18572c0e6fc63b1aa8704f299f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c04b5cdc5bb25e18572c0e6fc63b1aa8704f299f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b959c75b3135189a90a1d3f630d702266270763f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b959c75b3135189a90a1d3f630d702266270763f", "html_url": "https://github.com/rust-lang/rust/commit/b959c75b3135189a90a1d3f630d702266270763f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b959c75b3135189a90a1d3f630d702266270763f/comments", "author": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "00652e429aaa2250f2561a457e46387bb5b16737", "url": "https://api.github.com/repos/rust-lang/rust/commits/00652e429aaa2250f2561a457e46387bb5b16737", "html_url": "https://github.com/rust-lang/rust/commit/00652e429aaa2250f2561a457e46387bb5b16737"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "90f4aaefc9bc10694fbbd4286ef9eb82a1960d54", "filename": "src/librustdoc/html/format.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b959c75b3135189a90a1d3f630d702266270763f/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b959c75b3135189a90a1d3f630d702266270763f/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fformat.rs?ref=b959c75b3135189a90a1d3f630d702266270763f", "patch": "@@ -1099,12 +1099,12 @@ impl clean::Visibility {\n             clean::Visibility::Restricted(vis_did) => {\n                 let parent_module = find_closest_parent_module(tcx, item_did);\n \n-                if parent_module == Some(vis_did) {\n+                if vis_did.index == CRATE_DEF_INDEX {\n+                    write!(f, \"pub(crate) \")\n+                } else if parent_module == Some(vis_did) {\n                     // `pub(in foo)` where `foo` is the parent module\n                     // is the same as no visibility modifier\n                     Ok(())\n-                } else if vis_did.index == CRATE_DEF_INDEX {\n-                    write!(f, \"pub(crate) \")\n                 } else if parent_module\n                     .map(|parent| find_closest_parent_module(tcx, parent))\n                     .flatten()"}, {"sha": "4e1279e34d93328d9ad2621230ef3151ce9f79f9", "filename": "src/test/rustdoc/decl_macro_priv.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b959c75b3135189a90a1d3f630d702266270763f/src%2Ftest%2Frustdoc%2Fdecl_macro_priv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b959c75b3135189a90a1d3f630d702266270763f/src%2Ftest%2Frustdoc%2Fdecl_macro_priv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fdecl_macro_priv.rs?ref=b959c75b3135189a90a1d3f630d702266270763f", "patch": "@@ -2,7 +2,7 @@\n \n #![feature(decl_macro)]\n \n-// @has decl_macro_priv/macro.crate_macro.html //pre 'macro crate_macro() {'\n+// @has decl_macro_priv/macro.crate_macro.html //pre 'pub(crate) macro crate_macro() {'\n // @has - //pre '...'\n // @has - //pre '}'\n pub(crate) macro crate_macro() {}"}, {"sha": "f828e642abdcad6ce3c896de07fbd9d2b1054c27", "filename": "src/test/rustdoc/pub-restricted.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b959c75b3135189a90a1d3f630d702266270763f/src%2Ftest%2Frustdoc%2Fpub-restricted.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b959c75b3135189a90a1d3f630d702266270763f/src%2Ftest%2Frustdoc%2Fpub-restricted.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fpub-restricted.rs?ref=b959c75b3135189a90a1d3f630d702266270763f", "patch": "@@ -6,13 +6,13 @@\n \n // @has 'foo/struct.FooPublic.html' '//pre' 'pub struct FooPublic'\n pub struct FooPublic;\n-// @has 'foo/struct.FooJustCrate.html' '//pre' 'struct FooJustCrate'\n+// @has 'foo/struct.FooJustCrate.html' '//pre' 'pub(crate) struct FooJustCrate'\n crate struct FooJustCrate;\n-// @has 'foo/struct.FooPubCrate.html' '//pre' 'struct FooPubCrate'\n+// @has 'foo/struct.FooPubCrate.html' '//pre' 'pub(crate) struct FooPubCrate'\n pub(crate) struct FooPubCrate;\n-// @has 'foo/struct.FooSelf.html' '//pre' 'struct FooSelf'\n+// @has 'foo/struct.FooSelf.html' '//pre' 'pub(crate) struct FooSelf'\n pub(self) struct FooSelf;\n-// @has 'foo/struct.FooInSelf.html' '//pre' 'struct FooInSelf'\n+// @has 'foo/struct.FooInSelf.html' '//pre' 'pub(crate) struct FooInSelf'\n pub(in self) struct FooInSelf;\n mod a {\n     // @has 'foo/a/struct.FooASuper.html' '//pre' 'pub(crate) struct FooASuper'"}]}