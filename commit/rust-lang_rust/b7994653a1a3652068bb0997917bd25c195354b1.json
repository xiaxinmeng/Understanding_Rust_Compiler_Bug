{"sha": "b7994653a1a3652068bb0997917bd25c195354b1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3OTk0NjUzYTFhMzY1MjA2OGJiMDk5NzkxN2JkMjVjMTk1MzU0YjE=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-10-23T08:14:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-23T08:14:39Z"}, "message": "Rollup merge of #65678 - JohnTitor:add-e0728-explanation, r=GuilliaumeGomez\n\nAdd long error explanation for E0728\n\nPart of #61137\n\nr? @GuillaumeGomez", "tree": {"sha": "fd6fe99d4b657e4b71878b772dc02977a3b7cf77", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd6fe99d4b657e4b71878b772dc02977a3b7cf77"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7994653a1a3652068bb0997917bd25c195354b1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdsAvvCRBK7hj4Ov3rIwAAdHIIAK6kNHY/hiUVWWNkI0T8LP7d\nQXaSxH5laFwbk2VStwSSKEPwxgZvFVXBJp1GGaecBKpZdvVojmCD5ZFobUSSu5Wl\n2Wrjc/HhMgkbi6uxvfpMNqYiP8FnODPZVpRSTHy+h1jVqqr+4UJYTdNlsisVsT4m\nYSrLuxYA2kXCeXz4GcZ8ZR1yiV3FKXgW15kDLWTNQxPHYFMq4Fl0ivSTfpLdwpZC\nYtvpzzSIbzBuMx9xHl2QWm20m823Zj9q9z6THE4hqA5rk6P79BSfwA8qvXjxqkvx\n+b7ybjIMwQtGRFb5bg0zWArmnulyC4EtGxkUonKRrR4WVNRj4ti5lznIeHWg4s0=\n=8lVp\n-----END PGP SIGNATURE-----\n", "payload": "tree fd6fe99d4b657e4b71878b772dc02977a3b7cf77\nparent 88e3ae2eb4f3391fcecd3e53405b08df83e2fe28\nparent a1f65895a071885141061590e24022eacec6e858\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1571818479 +0900\ncommitter GitHub <noreply@github.com> 1571818479 +0900\n\nRollup merge of #65678 - JohnTitor:add-e0728-explanation, r=GuilliaumeGomez\n\nAdd long error explanation for E0728\n\nPart of #61137\n\nr? @GuillaumeGomez\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7994653a1a3652068bb0997917bd25c195354b1", "html_url": "https://github.com/rust-lang/rust/commit/b7994653a1a3652068bb0997917bd25c195354b1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7994653a1a3652068bb0997917bd25c195354b1/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "88e3ae2eb4f3391fcecd3e53405b08df83e2fe28", "url": "https://api.github.com/repos/rust-lang/rust/commits/88e3ae2eb4f3391fcecd3e53405b08df83e2fe28", "html_url": "https://github.com/rust-lang/rust/commit/88e3ae2eb4f3391fcecd3e53405b08df83e2fe28"}, {"sha": "a1f65895a071885141061590e24022eacec6e858", "url": "https://api.github.com/repos/rust-lang/rust/commits/a1f65895a071885141061590e24022eacec6e858", "html_url": "https://github.com/rust-lang/rust/commit/a1f65895a071885141061590e24022eacec6e858"}], "stats": {"total": 93, "additions": 88, "deletions": 5}, "files": [{"sha": "122ae4a6cf66f6a65a20ad8ae900eb0ed800c82b", "filename": "src/librustc/error_codes.rs", "status": "modified", "additions": 80, "deletions": 3, "changes": 83, "blob_url": "https://github.com/rust-lang/rust/blob/b7994653a1a3652068bb0997917bd25c195354b1/src%2Flibrustc%2Ferror_codes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7994653a1a3652068bb0997917bd25c195354b1/src%2Flibrustc%2Ferror_codes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ferror_codes.rs?ref=b7994653a1a3652068bb0997917bd25c195354b1", "patch": "@@ -2045,8 +2045,8 @@ so that a generator can then be constructed:\n async fn bar<T>() -> () {}\n \n async fn foo() {\n-  bar::<String>().await;\n-  //   ^^^^^^^^ specify type explicitly\n+    bar::<String>().await;\n+    //   ^^^^^^^^ specify type explicitly\n }\n ```\n \"##,\n@@ -2126,6 +2126,84 @@ static X: u32 = 42;\n ```\n \"##,\n \n+E0728: r##\"\n+[`await`] has been used outside [`async`] function or block.\n+\n+Erroneous code examples:\n+\n+```edition2018,compile_fail,E0728\n+# use std::pin::Pin;\n+# use std::future::Future;\n+# use std::task::{Context, Poll};\n+#\n+# struct WakeOnceThenComplete(bool);\n+#\n+# fn wake_and_yield_once() -> WakeOnceThenComplete {\n+#     WakeOnceThenComplete(false)\n+# }\n+#\n+# impl Future for WakeOnceThenComplete {\n+#     type Output = ();\n+#     fn poll(mut self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<()> {\n+#         if self.0 {\n+#             Poll::Ready(())\n+#         } else {\n+#             cx.waker().wake_by_ref();\n+#             self.0 = true;\n+#             Poll::Pending\n+#         }\n+#     }\n+# }\n+#\n+fn foo() {\n+    wake_and_yield_once().await // `await` is used outside `async` context\n+}\n+```\n+\n+[`await`] is used to suspend the current computation until the given\n+future is ready to produce a value. So it is legal only within\n+an [`async`] context, like an `async fn` or an `async` block.\n+\n+```edition2018\n+# use std::pin::Pin;\n+# use std::future::Future;\n+# use std::task::{Context, Poll};\n+#\n+# struct WakeOnceThenComplete(bool);\n+#\n+# fn wake_and_yield_once() -> WakeOnceThenComplete {\n+#     WakeOnceThenComplete(false)\n+# }\n+#\n+# impl Future for WakeOnceThenComplete {\n+#     type Output = ();\n+#     fn poll(mut self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<()> {\n+#         if self.0 {\n+#             Poll::Ready(())\n+#         } else {\n+#             cx.waker().wake_by_ref();\n+#             self.0 = true;\n+#             Poll::Pending\n+#         }\n+#     }\n+# }\n+#\n+async fn foo() {\n+    wake_and_yield_once().await // `await` is used within `async` function\n+}\n+\n+fn bar(x: u8) -> impl Future<Output = u8> {\n+    async move {\n+        wake_and_yield_once().await; // `await` is used within `async` block\n+        x\n+    }\n+}\n+```\n+\n+[`async`]: https://doc.rust-lang.org/std/keyword.async.html\n+[`await`]: https://doc.rust-lang.org/std/keyword.await.html\n+\"##,\n+\n E0734: r##\"\n A stability attribute has been used outside of the standard library.\n \n@@ -2218,6 +2296,5 @@ See [RFC 2091] for details on this and other limitations.\n //  E0702, // replaced with a generic attribute input check\n     E0726, // non-explicit (not `'_`) elided lifetime in unsupported position\n     E0727, // `async` generators are not yet supported\n-    E0728, // `await` must be in an `async` function or block\n     E0739, // invalid track_caller application/syntax\n }"}, {"sha": "4b5e2d59e38c999e6c89eed59fddcd429b92e13e", "filename": "src/test/ui/async-await/await-keyword/incorrect-syntax-suggestions.stderr", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fawait-keyword%2Fincorrect-syntax-suggestions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fawait-keyword%2Fincorrect-syntax-suggestions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fawait-keyword%2Fincorrect-syntax-suggestions.stderr?ref=b7994653a1a3652068bb0997917bd25c195354b1", "patch": "@@ -244,4 +244,5 @@ LL |     let _ = await bar()?;\n \n error: aborting due to 35 previous errors\n \n-For more information about this error, try `rustc --explain E0277`.\n+Some errors have detailed explanations: E0277, E0728.\n+For more information about an error, try `rustc --explain E0277`."}, {"sha": "5b9adb253d968450ede33800bd85b3b46da05510", "filename": "src/test/ui/async-await/issues/issue-51719.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-51719.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-51719.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-51719.stderr?ref=b7994653a1a3652068bb0997917bd25c195354b1", "patch": "@@ -8,3 +8,4 @@ LL |     let _gen = || foo().await;\n \n error: aborting due to previous error\n \n+For more information about this error, try `rustc --explain E0728`."}, {"sha": "f120bd119c540296f25ba3ae4fb1878d34567d62", "filename": "src/test/ui/async-await/issues/issue-51751.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-51751.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-51751.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-51751.stderr?ref=b7994653a1a3652068bb0997917bd25c195354b1", "patch": "@@ -9,3 +9,4 @@ LL |     let finished = result.await;\n \n error: aborting due to previous error\n \n+For more information about this error, try `rustc --explain E0728`."}, {"sha": "538430290d299ba4c9681ff5ec7d25bffa4b81e8", "filename": "src/test/ui/async-await/issues/issue-62009-1.stderr", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62009-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62009-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62009-1.stderr?ref=b7994653a1a3652068bb0997917bd25c195354b1", "patch": "@@ -40,4 +40,5 @@ LL |     F: Future\n \n error: aborting due to 4 previous errors\n \n-For more information about this error, try `rustc --explain E0277`.\n+Some errors have detailed explanations: E0277, E0728.\n+For more information about an error, try `rustc --explain E0277`."}, {"sha": "47b74b5574fea57e240acefd77849261fbf64adf", "filename": "src/test/ui/async-await/issues/issue-62009-2.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62009-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62009-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62009-2.stderr?ref=b7994653a1a3652068bb0997917bd25c195354b1", "patch": "@@ -8,3 +8,4 @@ LL |     (async || 2333)().await;\n \n error: aborting due to previous error\n \n+For more information about this error, try `rustc --explain E0728`."}, {"sha": "f826a86f089853d4ea27609aae7a8254efd2ecc0", "filename": "src/test/ui/async-await/issues/non-async-enclosing-span.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fnon-async-enclosing-span.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7994653a1a3652068bb0997917bd25c195354b1/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fnon-async-enclosing-span.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fnon-async-enclosing-span.stderr?ref=b7994653a1a3652068bb0997917bd25c195354b1", "patch": "@@ -9,3 +9,4 @@ LL |     let y = do_the_thing().await;\n \n error: aborting due to previous error\n \n+For more information about this error, try `rustc --explain E0728`."}]}