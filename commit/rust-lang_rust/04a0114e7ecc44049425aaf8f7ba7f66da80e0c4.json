{"sha": "04a0114e7ecc44049425aaf8f7ba7f66da80e0c4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0YTAxMTRlN2VjYzQ0MDQ5NDI1YWFmOGY3YmE3ZjY2ZGE4MGUwYzQ=", "commit": {"author": {"name": "Adam Reichold", "email": "adam.reichold@t-online.de", "date": "2020-08-01T14:06:00Z"}, "committer": {"name": "Adam Reichold", "email": "adam.reichold@t-online.de", "date": "2020-08-05T14:57:02Z"}, "message": "Rely only on POSIX semantics for I/O vector count\n\nAll #[cfg(unix)] platforms follow the POSIX standard and define _SC_IOV_MAX so\nthat we rely purely on POSIX semantics to determine the limits on I/O vector\ncount.", "tree": {"sha": "210155908e4a231d31fd9809b3c009770cbe02d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/210155908e4a231d31fd9809b3c009770cbe02d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04a0114e7ecc44049425aaf8f7ba7f66da80e0c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04a0114e7ecc44049425aaf8f7ba7f66da80e0c4", "html_url": "https://github.com/rust-lang/rust/commit/04a0114e7ecc44049425aaf8f7ba7f66da80e0c4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04a0114e7ecc44049425aaf8f7ba7f66da80e0c4/comments", "author": {"login": "adamreichold", "id": 12997846, "node_id": "MDQ6VXNlcjEyOTk3ODQ2", "avatar_url": "https://avatars.githubusercontent.com/u/12997846?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamreichold", "html_url": "https://github.com/adamreichold", "followers_url": "https://api.github.com/users/adamreichold/followers", "following_url": "https://api.github.com/users/adamreichold/following{/other_user}", "gists_url": "https://api.github.com/users/adamreichold/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamreichold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamreichold/subscriptions", "organizations_url": "https://api.github.com/users/adamreichold/orgs", "repos_url": "https://api.github.com/users/adamreichold/repos", "events_url": "https://api.github.com/users/adamreichold/events{/privacy}", "received_events_url": "https://api.github.com/users/adamreichold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "adamreichold", "id": 12997846, "node_id": "MDQ6VXNlcjEyOTk3ODQ2", "avatar_url": "https://avatars.githubusercontent.com/u/12997846?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamreichold", "html_url": "https://github.com/adamreichold", "followers_url": "https://api.github.com/users/adamreichold/followers", "following_url": "https://api.github.com/users/adamreichold/following{/other_user}", "gists_url": "https://api.github.com/users/adamreichold/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamreichold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamreichold/subscriptions", "organizations_url": "https://api.github.com/users/adamreichold/orgs", "repos_url": "https://api.github.com/users/adamreichold/repos", "events_url": "https://api.github.com/users/adamreichold/events{/privacy}", "received_events_url": "https://api.github.com/users/adamreichold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "87edccf0f048d566596495650188eea15cdf62d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/87edccf0f048d566596495650188eea15cdf62d6", "html_url": "https://github.com/rust-lang/rust/commit/87edccf0f048d566596495650188eea15cdf62d6"}], "stats": {"total": 20, "additions": 3, "deletions": 17}, "files": [{"sha": "6b8f3ea172d0ed7b93bc07d6122487fcb9af9bbf", "filename": "library/std/src/sys/unix/fd.rs", "status": "modified", "additions": 3, "deletions": 17, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/04a0114e7ecc44049425aaf8f7ba7f66da80e0c4/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffd.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04a0114e7ecc44049425aaf8f7ba7f66da80e0c4/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffd.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffd.rs?ref=04a0114e7ecc44049425aaf8f7ba7f66da80e0c4", "patch": "@@ -27,35 +27,21 @@ const READ_LIMIT: usize = c_int::MAX as usize - 1;\n #[cfg(not(target_os = \"macos\"))]\n const READ_LIMIT: usize = libc::ssize_t::MAX as usize;\n \n-#[cfg(any(target_os = \"linux\", target_os = \"macos\"))]\n fn max_iov() -> usize {\n     static LIM: AtomicUsize = AtomicUsize::new(0);\n \n     let mut lim = LIM.load(Ordering::Relaxed);\n     if lim == 0 {\n-        let ret = unsafe {\n-            libc::sysconf(\n-                #[cfg(target_os = \"linux\")]\n-                libc::_SC_IOV_MAX,\n-                #[cfg(target_os = \"macos\")]\n-                libc::_SC_UIO_MAXIOV,\n-            )\n-        };\n+        let ret = unsafe { libc::sysconf(libc::_SC_IOV_MAX) };\n \n-        // 1024 is the default value on modern Linux systems\n-        // and hopefully more useful than `c_int::MAX`.\n-        lim = if ret > 0 { ret as usize } else { 1024 };\n+        // 16 is the minimum value required by POSIX.\n+        lim = if ret > 0 { ret as usize } else { 16 };\n         LIM.store(lim, Ordering::Relaxed);\n     }\n \n     lim\n }\n \n-#[cfg(not(any(target_os = \"linux\", target_os = \"macos\")))]\n-fn max_iov() -> usize {\n-    c_int::MAX as usize\n-}\n-\n impl FileDesc {\n     pub fn new(fd: c_int) -> FileDesc {\n         FileDesc { fd }"}]}