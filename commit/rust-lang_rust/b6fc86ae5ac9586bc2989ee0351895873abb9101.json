{"sha": "b6fc86ae5ac9586bc2989ee0351895873abb9101", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2ZmM4NmFlNWFjOTU4NmJjMjk4OWVlMDM1MTg5NTg3M2FiYjkxMDE=", "commit": {"author": {"name": "Lindsey Kuper", "email": "lkuper@mozilla.com", "date": "2011-07-18T22:52:05Z"}, "committer": {"name": "Lindsey Kuper", "email": "lkuper@mozilla.com", "date": "2011-07-18T22:58:36Z"}, "message": "Sane error message for self-call in non-obj context.  Closes #707.", "tree": {"sha": "a0158be66d569905da8733b86d815bddea297244", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0158be66d569905da8733b86d815bddea297244"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6fc86ae5ac9586bc2989ee0351895873abb9101", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6fc86ae5ac9586bc2989ee0351895873abb9101", "html_url": "https://github.com/rust-lang/rust/commit/b6fc86ae5ac9586bc2989ee0351895873abb9101", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6fc86ae5ac9586bc2989ee0351895873abb9101/comments", "author": {"login": "lkuper", "id": 535218, "node_id": "MDQ6VXNlcjUzNTIxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/535218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lkuper", "html_url": "https://github.com/lkuper", "followers_url": "https://api.github.com/users/lkuper/followers", "following_url": "https://api.github.com/users/lkuper/following{/other_user}", "gists_url": "https://api.github.com/users/lkuper/gists{/gist_id}", "starred_url": "https://api.github.com/users/lkuper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lkuper/subscriptions", "organizations_url": "https://api.github.com/users/lkuper/orgs", "repos_url": "https://api.github.com/users/lkuper/repos", "events_url": "https://api.github.com/users/lkuper/events{/privacy}", "received_events_url": "https://api.github.com/users/lkuper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lkuper", "id": 535218, "node_id": "MDQ6VXNlcjUzNTIxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/535218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lkuper", "html_url": "https://github.com/lkuper", "followers_url": "https://api.github.com/users/lkuper/followers", "following_url": "https://api.github.com/users/lkuper/following{/other_user}", "gists_url": "https://api.github.com/users/lkuper/gists{/gist_id}", "starred_url": "https://api.github.com/users/lkuper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lkuper/subscriptions", "organizations_url": "https://api.github.com/users/lkuper/orgs", "repos_url": "https://api.github.com/users/lkuper/repos", "events_url": "https://api.github.com/users/lkuper/events{/privacy}", "received_events_url": "https://api.github.com/users/lkuper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46b0aa5c5cf92804219766e3254fc89a3fc583b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/46b0aa5c5cf92804219766e3254fc89a3fc583b0", "html_url": "https://github.com/rust-lang/rust/commit/46b0aa5c5cf92804219766e3254fc89a3fc583b0"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "a8450c30ee649ca3234ac4df6a38ccf37956bd96", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b6fc86ae5ac9586bc2989ee0351895873abb9101/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6fc86ae5ac9586bc2989ee0351895873abb9101/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=b6fc86ae5ac9586bc2989ee0351895873abb9101", "patch": "@@ -2092,7 +2092,7 @@ fn check_expr(&@fn_ctxt fcx, &@ast::expr expr) {\n         }\n         case (ast::expr_self_method(?ident)) {\n             auto t = ty::mk_nil(fcx.ccx.tcx);\n-            let ty::t this_obj_ty;\n+            let ty::t this_obj_ty = ty::mk_nil(fcx.ccx.tcx);\n             let option::t[obj_info] this_obj_info = get_obj_info(fcx.ccx);\n             alt (this_obj_info) {\n                 case (\n@@ -2106,7 +2106,12 @@ fn check_expr(&@fn_ctxt fcx, &@ast::expr expr) {\n                         ty::lookup_item_type(fcx.ccx.tcx,\n                                              local_def(obj_info.this_obj))._1;\n                 }\n-                case (none) { fail; }\n+                case (none) {\n+                    // Shouldn't happen.\n+                    fcx.ccx.tcx.sess.span_err(expr.span,\n+                                              \"self-call in non-object \\\n+                                               context\");\n+                }\n             }\n             // Grab this method's type out of the current object type.\n "}, {"sha": "816c8ad698f3cd4835f657db037c47bae87f2d17", "filename": "src/test/compile-fail/self-call-non-obj.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b6fc86ae5ac9586bc2989ee0351895873abb9101/src%2Ftest%2Fcompile-fail%2Fself-call-non-obj.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6fc86ae5ac9586bc2989ee0351895873abb9101/src%2Ftest%2Fcompile-fail%2Fself-call-non-obj.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fself-call-non-obj.rs?ref=b6fc86ae5ac9586bc2989ee0351895873abb9101", "patch": "@@ -0,0 +1,14 @@\n+//xfail-stage0\n+\n+// error-pattern:self-call in non-object context\n+\n+// Fix for issue #707.\n+fn main() {\n+\n+    fn foo() -> int {\n+        ret 3();\n+    }\n+\n+    self.foo();\n+\n+}"}]}