{"sha": "d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb", "node_id": "C_kwDOAAsO6NoAKGQ4NGI1ZjliM2QxOGNkNmY2YzI3M2M0ZmU2YWIwOWRiYTFlZGQ2ZmI", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-04-18T18:55:17Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-04-18T18:55:17Z"}, "message": "Use a diagnostic item instead of filtering for Index::Output", "tree": {"sha": "4c356f34902f692e7d07daf6babd62dbab83a7b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c356f34902f692e7d07daf6babd62dbab83a7b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb", "html_url": "https://github.com/rust-lang/rust/commit/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "770c303c005261aa997e6a3a1b762c2831768365", "url": "https://api.github.com/repos/rust-lang/rust/commits/770c303c005261aa997e6a3a1b762c2831768365", "html_url": "https://github.com/rust-lang/rust/commit/770c303c005261aa997e6a3a1b762c2831768365"}], "stats": {"total": 13, "additions": 4, "deletions": 9}, "files": [{"sha": "0c0a7515d9c3bfb0a20bf076356b0dd409a33262", "filename": "compiler/rustc_hir_typeck/src/expr.rs", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs?ref=d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb", "patch": "@@ -2871,6 +2871,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         base_ty: Ty<'tcx>,\n     ) -> Option<(ErrorGuaranteed, Ty<'tcx>, Ty<'tcx>)> {\n         let index_trait_def_id = self.tcx.lang_items().index_trait()?;\n+        let index_trait_output_def_id = self.tcx.get_diagnostic_item(sym::IndexOutput)?;\n \n         let mut relevant_impls = vec![];\n         self.tcx.for_each_relevant_impl(index_trait_def_id, base_ty, |impl_def_id| {\n@@ -2917,15 +2918,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             let element_ty = ocx.normalize(\n                 &cause,\n                 self.param_env,\n-                self.tcx.mk_projection(\n-                    self.tcx\n-                        .associated_items(index_trait_def_id)\n-                        .filter_by_name_unhygienic(sym::Output)\n-                        .next()\n-                        .unwrap()\n-                        .def_id,\n-                    impl_trait_ref.substs,\n-                ),\n+                self.tcx.mk_projection(index_trait_output_def_id, impl_trait_ref.substs),\n             );\n \n             let errors = ocx.select_where_possible();"}, {"sha": "d6ee7ac34aaca594650508f57f810e63ff6725bc", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb", "patch": "@@ -204,6 +204,7 @@ symbols! {\n         HashSet,\n         Hasher,\n         Implied,\n+        IndexOutput,\n         Input,\n         Into,\n         IntoDiagnostic,"}, {"sha": "f3754484f6a0609e53a6aedad5a0351e40e38ec9", "filename": "library/core/src/ops/index.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb/library%2Fcore%2Fsrc%2Fops%2Findex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb/library%2Fcore%2Fsrc%2Fops%2Findex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fops%2Findex.rs?ref=d84b5f9b3d18cd6f6c273c4fe6ab09dba1edd6fb", "patch": "@@ -59,6 +59,7 @@\n pub trait Index<Idx: ?Sized> {\n     /// The returned type after indexing.\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_diagnostic_item = \"IndexOutput\"]\n     type Output: ?Sized;\n \n     /// Performs the indexing (`container[index]`) operation."}]}