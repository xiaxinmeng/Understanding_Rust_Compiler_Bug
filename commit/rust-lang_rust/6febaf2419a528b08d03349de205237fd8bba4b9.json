{"sha": "6febaf2419a528b08d03349de205237fd8bba4b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmZWJhZjI0MTlhNTI4YjA4ZDAzMzQ5ZGUyMDUyMzdmZDhiYmE0Yjk=", "commit": {"author": {"name": "Anthony Ramine", "email": "nox@nox.paris", "date": "2020-10-26T19:55:07Z"}, "committer": {"name": "Anthony Ramine", "email": "nox@nox.paris", "date": "2020-10-31T16:16:56Z"}, "message": "Implement -Z relax-elf-relocations=yes|no\n\nThis lets rustc users tweak whether the linker should relax ELF relocations,\nnamely whether it should emit R_X86_64_GOTPCRELX relocations instead of\nR_X86_64_GOTPCREL, as the former is allowed by the ABI to be further\noptimised. The default value is whatever the target defines.", "tree": {"sha": "c35aeb574d6a9046ad9607a57b435c1cdd209152", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c35aeb574d6a9046ad9607a57b435c1cdd209152"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6febaf2419a528b08d03349de205237fd8bba4b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6febaf2419a528b08d03349de205237fd8bba4b9", "html_url": "https://github.com/rust-lang/rust/commit/6febaf2419a528b08d03349de205237fd8bba4b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6febaf2419a528b08d03349de205237fd8bba4b9/comments", "author": {"login": "nox", "id": 123095, "node_id": "MDQ6VXNlcjEyMzA5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/123095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nox", "html_url": "https://github.com/nox", "followers_url": "https://api.github.com/users/nox/followers", "following_url": "https://api.github.com/users/nox/following{/other_user}", "gists_url": "https://api.github.com/users/nox/gists{/gist_id}", "starred_url": "https://api.github.com/users/nox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nox/subscriptions", "organizations_url": "https://api.github.com/users/nox/orgs", "repos_url": "https://api.github.com/users/nox/repos", "events_url": "https://api.github.com/users/nox/events{/privacy}", "received_events_url": "https://api.github.com/users/nox/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nox", "id": 123095, "node_id": "MDQ6VXNlcjEyMzA5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/123095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nox", "html_url": "https://github.com/nox", "followers_url": "https://api.github.com/users/nox/followers", "following_url": "https://api.github.com/users/nox/following{/other_user}", "gists_url": "https://api.github.com/users/nox/gists{/gist_id}", "starred_url": "https://api.github.com/users/nox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nox/subscriptions", "organizations_url": "https://api.github.com/users/nox/orgs", "repos_url": "https://api.github.com/users/nox/repos", "events_url": "https://api.github.com/users/nox/events{/privacy}", "received_events_url": "https://api.github.com/users/nox/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3478d7c3607ffbba629af2265c01002771e48c18", "url": "https://api.github.com/repos/rust-lang/rust/commits/3478d7c3607ffbba629af2265c01002771e48c18", "html_url": "https://github.com/rust-lang/rust/commit/3478d7c3607ffbba629af2265c01002771e48c18"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "f13c2d312dfcca3a6ddec6425866ddbb81c9fcd5", "filename": "compiler/rustc_codegen_llvm/src/back/write.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6febaf2419a528b08d03349de205237fd8bba4b9/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6febaf2419a528b08d03349de205237fd8bba4b9/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Fwrite.rs?ref=6febaf2419a528b08d03349de205237fd8bba4b9", "patch": "@@ -156,7 +156,11 @@ pub fn target_machine_factory(\n     let emit_stack_size_section = sess.opts.debugging_opts.emit_stack_sizes;\n \n     let asm_comments = sess.asm_comments();\n-    let relax_elf_relocations = sess.target.options.relax_elf_relocations;\n+    let relax_elf_relocations = sess\n+        .opts\n+        .debugging_opts\n+        .relax_elf_relocations\n+        .unwrap_or(sess.target.options.relax_elf_relocations);\n \n     let use_init_array = !sess\n         .opts"}, {"sha": "046e451cd835a083f0eabfe292024beff6df7e83", "filename": "compiler/rustc_interface/src/tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6febaf2419a528b08d03349de205237fd8bba4b9/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6febaf2419a528b08d03349de205237fd8bba4b9/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Ftests.rs?ref=6febaf2419a528b08d03349de205237fd8bba4b9", "patch": "@@ -573,6 +573,7 @@ fn test_debugging_options_tracking_hash() {\n     tracked!(print_fuel, Some(\"abc\".to_string()));\n     tracked!(profile, true);\n     tracked!(profile_emit, Some(PathBuf::from(\"abc\")));\n+    tracked!(relax_elf_relocations, Some(true));\n     tracked!(relro_level, Some(RelroLevel::Full));\n     tracked!(report_delayed_bugs, true);\n     tracked!(run_dsymutil, false);"}, {"sha": "c3ec17bc4efa313ac0ed84a0ff37a118a95fc4fb", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6febaf2419a528b08d03349de205237fd8bba4b9/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6febaf2419a528b08d03349de205237fd8bba4b9/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=6febaf2419a528b08d03349de205237fd8bba4b9", "patch": "@@ -1030,6 +1030,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"enable queries of the dependency graph for regression testing (default: no)\"),\n     query_stats: bool = (false, parse_bool, [UNTRACKED],\n         \"print some statistics about the query system (default: no)\"),\n+    relax_elf_relocations: Option<bool> = (None, parse_opt_bool, [TRACKED],\n+        \"whether ELF relocations can be relaxed\"),\n     relro_level: Option<RelroLevel> = (None, parse_relro_level, [TRACKED],\n         \"choose which RELRO level to use\"),\n     report_delayed_bugs: bool = (false, parse_bool, [TRACKED],"}]}