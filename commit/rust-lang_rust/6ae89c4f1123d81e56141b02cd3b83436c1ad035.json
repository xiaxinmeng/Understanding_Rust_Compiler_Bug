{"sha": "6ae89c4f1123d81e56141b02cd3b83436c1ad035", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhZTg5YzRmMTEyM2Q4MWU1NjE0MWIwMmNkM2I4MzQzNmMxYWQwMzU=", "commit": {"author": {"name": "Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-10-16T08:45:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-16T08:45:55Z"}, "message": "Merge pull request #3321 from 0ndorio/fix/1123_false_positive_on_boxed_local\n\nAvoid linting `boxed_local` on trait implementations.", "tree": {"sha": "ecb8035614db34c2821eea8897b6b744fc2382b5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecb8035614db34c2821eea8897b6b744fc2382b5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ae89c4f1123d81e56141b02cd3b83436c1ad035", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbxaVDCRBK7hj4Ov3rIwAAdHIIADicef4LM00b7Uab5YlzTMIy\nkd5hgPb2idmvUPHiUK0kZ3uxf+c+JqOdfkk7ZAvnlZ4UPq0jqSBo4WV77sRGNvnG\n7yF+CMnQ2f+IBKyoC6GdDpDF0nQp8TwKKE6yaKmJlXFym2geAOglj5Zq04Jzw638\n5crIhoZsakOpyDAMf3RQt1j0+M0p3fvy9yqj6qvUk2pdUcyEzhvWVmRzGKF9UbZG\nqIoIFoOdjJjHFr+GZ0OQT0zZgYA6xxa36pmuWxYwxV2wvQA2yAZdlAG4SIdL2kOI\nJ9jYNNdnbn1Llw7ew0Zvc3Vzi6Jmo3Nw2vo04cJa2EBDwSP8Q1D+3RqU1Mh6KH0=\n=6/LC\n-----END PGP SIGNATURE-----\n", "payload": "tree ecb8035614db34c2821eea8897b6b744fc2382b5\nparent eb683e6070f1a402d06e365432c5b9a675b96493\nparent 2d8b4f3d5cb771a67f119f3903dd4aca1e4c9136\nauthor Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer <github35764891676564198441@oli-obk.de> 1539679555 +0200\ncommitter GitHub <noreply@github.com> 1539679555 +0200\n\nMerge pull request #3321 from 0ndorio/fix/1123_false_positive_on_boxed_local\n\nAvoid linting `boxed_local` on trait implementations."}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ae89c4f1123d81e56141b02cd3b83436c1ad035", "html_url": "https://github.com/rust-lang/rust/commit/6ae89c4f1123d81e56141b02cd3b83436c1ad035", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ae89c4f1123d81e56141b02cd3b83436c1ad035/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb683e6070f1a402d06e365432c5b9a675b96493", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb683e6070f1a402d06e365432c5b9a675b96493", "html_url": "https://github.com/rust-lang/rust/commit/eb683e6070f1a402d06e365432c5b9a675b96493"}, {"sha": "2d8b4f3d5cb771a67f119f3903dd4aca1e4c9136", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d8b4f3d5cb771a67f119f3903dd4aca1e4c9136", "html_url": "https://github.com/rust-lang/rust/commit/2d8b4f3d5cb771a67f119f3903dd4aca1e4c9136"}], "stats": {"total": 63, "additions": 56, "deletions": 7}, "files": [{"sha": "b7646dd6fdf3e08077d3e71359eb201a5ed4a489", "filename": "clippy_lints/src/escape.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6ae89c4f1123d81e56141b02cd3b83436c1ad035/clippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ae89c4f1123d81e56141b02cd3b83436c1ad035/clippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fescape.rs?ref=6ae89c4f1123d81e56141b02cd3b83436c1ad035", "patch": "@@ -65,6 +65,7 @@ impl LintPass for Pass {\n }\n \n impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n+\n     fn check_fn(\n         &mut self,\n         cx: &LateContext<'a, 'tcx>,\n@@ -74,13 +75,23 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n         _: Span,\n         node_id: NodeId,\n     ) {\n-        let fn_def_id = cx.tcx.hir.local_def_id(node_id);\n+        // If the method is an impl for a trait, don't warn\n+        let parent_id = cx.tcx.hir.get_parent(node_id);\n+        let parent_node = cx.tcx.hir.find(parent_id);\n+\n+        if let Some(Node::Item(item)) = parent_node {\n+            if let ItemKind::Impl(_, _, _, _, Some(..), _, _) = item.node {\n+                return;\n+            }\n+        }\n+\n         let mut v = EscapeDelegate {\n             cx,\n             set: NodeSet(),\n             too_large_for_stack: self.too_large_for_stack,\n         };\n \n+        let fn_def_id = cx.tcx.hir.local_def_id(node_id);\n         let region_scope_tree = &cx.tcx.region_scope_tree(fn_def_id);\n         ExprUseVisitor::new(&mut v, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None).consume_body(body);\n "}, {"sha": "b35071546e7620761ddef16b5cb5d302388b1387", "filename": "tests/ui/escape_analysis.rs", "status": "modified", "additions": 28, "deletions": 6, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/6ae89c4f1123d81e56141b02cd3b83436c1ad035/tests%2Fui%2Fescape_analysis.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ae89c4f1123d81e56141b02cd3b83436c1ad035/tests%2Fui%2Fescape_analysis.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fescape_analysis.rs?ref=6ae89c4f1123d81e56141b02cd3b83436c1ad035", "patch": "@@ -7,12 +7,10 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-\n #![feature(box_syntax)]\n \n-#![allow(warnings, clippy)]\n-\n-#![warn(boxed_local)]\n+#![allow(clippy::borrowed_box, clippy::needless_pass_by_value, clippy::unused_unit)]\n+#![warn(clippy::boxed_local)]\n \n #[derive(Clone)]\n struct A;\n@@ -70,8 +68,7 @@ fn warn_pass() {\n }\n \n fn nowarn_return() -> Box<A> {\n-    let fx = box A;\n-    fx // moved out, \"escapes\"\n+    box A // moved out, \"escapes\"\n }\n \n fn nowarn_move() {\n@@ -139,3 +136,28 @@ pub struct PeekableSeekable<I: Foo> {\n \n pub fn new(_needs_name: Box<PeekableSeekable<&()>>) -> () {\n }\n+\n+/// Regression for #916, #1123\n+///\n+/// This shouldn't warn for `boxed_local`as the implementation of a trait\n+/// can't change much about the trait definition.\n+trait BoxedAction {\n+    fn do_sth(self: Box<Self>);\n+}\n+\n+impl BoxedAction for u64 {\n+    fn do_sth(self: Box<Self>) {\n+        println!(\"{}\", *self)\n+    }\n+}\n+\n+/// Regression for #1478\n+///\n+/// This shouldn't warn for `boxed_local`as self itself is a box type.\n+trait MyTrait {\n+    fn do_sth(self);\n+}\n+\n+impl<T> MyTrait for Box<T> {\n+    fn do_sth(self) {}\n+}"}, {"sha": "25ba413b75a5fb6cb0a49261e4c3ed2a6623dc94", "filename": "tests/ui/escape_analysis.stderr", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/6ae89c4f1123d81e56141b02cd3b83436c1ad035/tests%2Fui%2Fescape_analysis.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6ae89c4f1123d81e56141b02cd3b83436c1ad035/tests%2Fui%2Fescape_analysis.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fescape_analysis.stderr?ref=6ae89c4f1123d81e56141b02cd3b83436c1ad035", "patch": "@@ -0,0 +1,16 @@\n+error: local variable doesn't need to be boxed here\n+  --> $DIR/escape_analysis.rs:45:13\n+   |\n+45 | fn warn_arg(x: Box<A>) {\n+   |             ^\n+   |\n+   = note: `-D clippy::boxed-local` implied by `-D warnings`\n+\n+error: local variable doesn't need to be boxed here\n+   --> $DIR/escape_analysis.rs:137:12\n+    |\n+137 | pub fn new(_needs_name: Box<PeekableSeekable<&()>>) -> () {\n+    |            ^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}]}