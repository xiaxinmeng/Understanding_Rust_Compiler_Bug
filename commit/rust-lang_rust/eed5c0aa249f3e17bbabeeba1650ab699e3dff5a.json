{"sha": "eed5c0aa249f3e17bbabeeba1650ab699e3dff5a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlZDVjMGFhMjQ5ZjNlMTdiYmFiZWViYTE2NTBhYjY5OWUzZGZmNWE=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-06-25T23:54:03Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-06-25T23:54:03Z"}, "message": "Add rust_task::gc(size_t args) method that drops us back into the GC glue.", "tree": {"sha": "0bf4084dcf90be6a889c8283fe6c3dbf775f3491", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0bf4084dcf90be6a889c8283fe6c3dbf775f3491"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a", "html_url": "https://github.com/rust-lang/rust/commit/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67d1f0a9aafaa7dcd63b86032127ab660e630c46", "url": "https://api.github.com/repos/rust-lang/rust/commits/67d1f0a9aafaa7dcd63b86032127ab660e630c46", "html_url": "https://github.com/rust-lang/rust/commit/67d1f0a9aafaa7dcd63b86032127ab660e630c46"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "369782708df6b1598b5a92b9320f33d3e4bdd2b6", "filename": "src/rt/rust_crate.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a/src%2Frt%2Frust_crate.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a/src%2Frt%2Frust_crate.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_crate.cpp?ref=eed5c0aa249f3e17bbabeeba1650ab699e3dff5a", "patch": "@@ -26,6 +26,11 @@ rust_crate::get_unwind_glue() const {\n   return ((uintptr_t)this + unwind_glue_off);\n }\n \n+uintptr_t\n+rust_crate::get_gc_glue() const {\n+  return ((uintptr_t)this + gc_glue_off);\n+}\n+\n uintptr_t\n rust_crate::get_yield_glue() const {\n   return ((uintptr_t)this + yield_glue_off);"}, {"sha": "7f70301265dd031d252088d013d200b0ad6dcaab", "filename": "src/rt/rust_internal.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a/src%2Frt%2Frust_internal.h", "raw_url": "https://github.com/rust-lang/rust/raw/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a/src%2Frt%2Frust_internal.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_internal.h?ref=eed5c0aa249f3e17bbabeeba1650ab699e3dff5a", "patch": "@@ -660,6 +660,9 @@ rust_task : public rc_base<rust_task>,\n     // Fail self, assuming caller-on-stack is this task.\n     void fail(size_t nargs);\n \n+    // Run the gc glue on the task stack.\n+    void gc(size_t nargs);\n+\n     // Notify tasks waiting for us that we are about to die.\n     void notify_waiting_tasks();\n "}, {"sha": "3f85f51ac7b1a690d5e99c12acfbf024bba81735", "filename": "src/rt/rust_task.cpp", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a/src%2Frt%2Frust_task.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/eed5c0aa249f3e17bbabeeba1650ab699e3dff5a/src%2Frt%2Frust_task.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_task.cpp?ref=eed5c0aa249f3e17bbabeeba1650ab699e3dff5a", "patch": "@@ -345,6 +345,14 @@ rust_task::fail(size_t nargs) {\n     }\n }\n \n+void\n+rust_task::gc(size_t nargs)\n+{\n+    dom->log(rust_log::TASK|rust_log::MEM,\n+             \"task 0x%\" PRIxPTR \" garbage collecting\", this);\n+    run_after_return(nargs, dom->root_crate->get_gc_glue());\n+}\n+\n void\n rust_task::notify_waiting_tasks()\n {"}]}