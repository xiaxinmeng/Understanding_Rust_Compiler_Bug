{"sha": "efec7cde9339068f7289853a112da51025c2ef65", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmZWM3Y2RlOTMzOTA2OGY3Mjg5ODUzYTExMmRhNTEwMjVjMmVmNjU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-21T15:40:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-21T15:40:48Z"}, "message": "Auto merge of #75694 - RalfJung:miri-align-to, r=nagisa\n\nenable align_to tests in Miri\n\nWith https://github.com/rust-lang/miri/issues/1074 resolved, we can enable these tests in Miri.\n\nI also tweaked the test sized to get reasonable execution times with decent test coverage.", "tree": {"sha": "ed4c2ba6b18e0ed52c8ac00a30462b0504af085e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed4c2ba6b18e0ed52c8ac00a30462b0504af085e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/efec7cde9339068f7289853a112da51025c2ef65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/efec7cde9339068f7289853a112da51025c2ef65", "html_url": "https://github.com/rust-lang/rust/commit/efec7cde9339068f7289853a112da51025c2ef65", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/efec7cde9339068f7289853a112da51025c2ef65/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "521db88cd9f55ffaeda43df8c10387f74396fe67", "url": "https://api.github.com/repos/rust-lang/rust/commits/521db88cd9f55ffaeda43df8c10387f74396fe67", "html_url": "https://github.com/rust-lang/rust/commit/521db88cd9f55ffaeda43df8c10387f74396fe67"}, {"sha": "6a06bfc2520e94d1220e7828964034617a2ba922", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a06bfc2520e94d1220e7828964034617a2ba922", "html_url": "https://github.com/rust-lang/rust/commit/6a06bfc2520e94d1220e7828964034617a2ba922"}], "stats": {"total": 17, "additions": 6, "deletions": 11}, "files": [{"sha": "0b97508394789d9628e1a1d4866f29c8fb8502cb", "filename": "library/core/tests/ascii.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/efec7cde9339068f7289853a112da51025c2ef65/library%2Fcore%2Ftests%2Fascii.rs", "raw_url": "https://github.com/rust-lang/rust/raw/efec7cde9339068f7289853a112da51025c2ef65/library%2Fcore%2Ftests%2Fascii.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fascii.rs?ref=efec7cde9339068f7289853a112da51025c2ef65", "patch": "@@ -361,10 +361,8 @@ fn test_is_ascii_align_size_thoroughly() {\n         repeat(b0).take(l).chain(repeat(b1).take(l)).collect()\n     }\n \n-    // Miri is too slow for much of this, and in miri `align_offset` always\n-    // returns `usize::max_value()` anyway (at the moment), so we just test\n-    // lightly.\n-    let iter = if cfg!(miri) { 0..5 } else { 0..100 };\n+    // Miri is too slow\n+    let iter = if cfg!(miri) { 0..20 } else { 0..100 };\n \n     for i in iter {\n         #[cfg(not(miri))]\n@@ -379,7 +377,7 @@ fn test_is_ascii_align_size_thoroughly() {\n         ];\n \n         #[cfg(miri)]\n-        let cases = &[repeat_concat(b'a', 0x80u8, i)];\n+        let cases = &[b\"a\".repeat(i), b\"\\x80\".repeat(i), repeat_concat(b'a', 0x80u8, i)];\n \n         for case in cases {\n             for pos in 0..=case.len() {"}, {"sha": "bf977c141cbf861e0f0e64dff04beea4c5aa54c7", "filename": "library/core/tests/ptr.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/efec7cde9339068f7289853a112da51025c2ef65/library%2Fcore%2Ftests%2Fptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/efec7cde9339068f7289853a112da51025c2ef65/library%2Fcore%2Ftests%2Fptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fptr.rs?ref=efec7cde9339068f7289853a112da51025c2ef65", "patch": "@@ -300,7 +300,6 @@ fn write_unaligned_drop() {\n }\n \n #[test]\n-#[cfg_attr(miri, ignore)] // Miri does not compute a maximal `mid` for `align_offset`\n fn align_offset_zst() {\n     // For pointers of stride = 0, the pointer is already aligned or it cannot be aligned at\n     // all, because no amount of elements will align the pointer.\n@@ -315,7 +314,6 @@ fn align_offset_zst() {\n }\n \n #[test]\n-#[cfg_attr(miri, ignore)] // Miri does not compute a maximal `mid` for `align_offset`\n fn align_offset_stride1() {\n     // For pointers of stride = 1, the pointer can always be aligned. The offset is equal to\n     // number of bytes.\n@@ -337,7 +335,6 @@ fn align_offset_stride1() {\n }\n \n #[test]\n-#[cfg_attr(miri, ignore)] // Miri is too slow\n fn align_offset_weird_strides() {\n     #[repr(packed)]\n     struct A3(u16, u8);\n@@ -384,7 +381,9 @@ fn align_offset_weird_strides() {\n     // implementation\n     let mut align = 1;\n     let mut x = false;\n-    while align < 1024 {\n+    // Miri is too slow\n+    let limit = if cfg!(miri) { 32 } else { 1024 };\n+    while align < limit {\n         for ptr in 1usize..4 * align {\n             unsafe {\n                 x |= test_weird_stride::<A3>(ptr as *const A3, align);"}, {"sha": "5650c98f9c7407ef5ac32e7aef5ce823b9c3d351", "filename": "library/core/tests/slice.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/efec7cde9339068f7289853a112da51025c2ef65/library%2Fcore%2Ftests%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/efec7cde9339068f7289853a112da51025c2ef65/library%2Fcore%2Ftests%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fslice.rs?ref=efec7cde9339068f7289853a112da51025c2ef65", "patch": "@@ -1630,7 +1630,6 @@ pub mod memchr {\n }\n \n #[test]\n-#[cfg_attr(miri, ignore)] // Miri does not compute a maximal `mid` for `align_offset`\n fn test_align_to_simple() {\n     let bytes = [1u8, 2, 3, 4, 5, 6, 7];\n     let (prefix, aligned, suffix) = unsafe { bytes.align_to::<u16>() };\n@@ -1660,7 +1659,6 @@ fn test_align_to_zst() {\n }\n \n #[test]\n-#[cfg_attr(miri, ignore)] // Miri does not compute a maximal `mid` for `align_offset`\n fn test_align_to_non_trivial() {\n     #[repr(align(8))]\n     struct U64(u64, u64);"}]}