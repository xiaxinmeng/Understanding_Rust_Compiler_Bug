{"sha": "d493dccef7ae1d2ca739fe828bf9556b44dc460a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ0OTNkY2NlZjdhZTFkMmNhNzM5ZmU4MjhiZjk1NTZiNDRkYzQ2MGE=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-01-24T19:47:54Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-01-24T19:48:17Z"}, "message": "Apply `resolve_vars_if_possible` to returned types for more accurate suggestions", "tree": {"sha": "350d4814d8a6c05ddca9661f3a1097043be41705", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/350d4814d8a6c05ddca9661f3a1097043be41705"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d493dccef7ae1d2ca739fe828bf9556b44dc460a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d493dccef7ae1d2ca739fe828bf9556b44dc460a", "html_url": "https://github.com/rust-lang/rust/commit/d493dccef7ae1d2ca739fe828bf9556b44dc460a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d493dccef7ae1d2ca739fe828bf9556b44dc460a/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34d51b33787c9b2f59cb3283c8b57a290ab86437", "url": "https://api.github.com/repos/rust-lang/rust/commits/34d51b33787c9b2f59cb3283c8b57a290ab86437", "html_url": "https://github.com/rust-lang/rust/commit/34d51b33787c9b2f59cb3283c8b57a290ab86437"}], "stats": {"total": 20, "additions": 12, "deletions": 8}, "files": [{"sha": "cc2c97096e966d092b0bf3e5f067f4a9e9652cca", "filename": "src/librustc/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d493dccef7ae1d2ca739fe828bf9556b44dc460a/src%2Flibrustc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d493dccef7ae1d2ca739fe828bf9556b44dc460a/src%2Flibrustc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=d493dccef7ae1d2ca739fe828bf9556b44dc460a", "patch": "@@ -605,11 +605,15 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n \n         let tables = self.in_progress_tables.map(|t| t.borrow()).unwrap();\n \n-        let mut ret_types =\n-            visitor.returns.iter().filter_map(|expr| tables.node_type_opt(expr.hir_id));\n+        let mut ret_types = visitor\n+            .returns\n+            .iter()\n+            .filter_map(|expr| tables.node_type_opt(expr.hir_id))\n+            .map(|ty| self.resolve_vars_if_possible(&ty));\n         let (last_ty, all_returns_have_same_type) = ret_types.clone().fold(\n             (None, true),\n             |(last_ty, mut same): (std::option::Option<Ty<'_>>, bool), ty| {\n+                let ty = self.resolve_vars_if_possible(&ty);\n                 same &= last_ty.map_or(true, |last_ty| last_ty == ty) && ty.kind != ty::Error;\n                 (Some(ty), same)\n             },"}, {"sha": "08bab5734fd7a0a3c01d0d7bfb9969da8a2c20e7", "filename": "src/test/ui/impl-trait/dyn-trait-return-should-be-impl-trait.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d493dccef7ae1d2ca739fe828bf9556b44dc460a/src%2Ftest%2Fui%2Fimpl-trait%2Fdyn-trait-return-should-be-impl-trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d493dccef7ae1d2ca739fe828bf9556b44dc460a/src%2Ftest%2Fui%2Fimpl-trait%2Fdyn-trait-return-should-be-impl-trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fdyn-trait-return-should-be-impl-trait.rs?ref=d493dccef7ae1d2ca739fe828bf9556b44dc460a", "patch": "@@ -59,15 +59,15 @@ fn baw() -> Box<dyn Trait> {\n // Suggest using `impl Trait`\n fn bat() -> dyn Trait { //~ ERROR E0746\n     if true {\n-        return 0u32;\n+        return 0;\n     }\n-    42u32\n+    42\n }\n fn bay() -> dyn Trait { //~ ERROR E0746\n     if true {\n-        0u32\n+        0\n     } else {\n-        42u32\n+        42\n     }\n }\n "}, {"sha": "664a897c593fc90f252dc951c3b50bcec23f4c7f", "filename": "src/test/ui/impl-trait/dyn-trait-return-should-be-impl-trait.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d493dccef7ae1d2ca739fe828bf9556b44dc460a/src%2Ftest%2Fui%2Fimpl-trait%2Fdyn-trait-return-should-be-impl-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d493dccef7ae1d2ca739fe828bf9556b44dc460a/src%2Ftest%2Fui%2Fimpl-trait%2Fdyn-trait-return-should-be-impl-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fdyn-trait-return-should-be-impl-trait.stderr?ref=d493dccef7ae1d2ca739fe828bf9556b44dc460a", "patch": "@@ -249,7 +249,7 @@ LL | fn bat() -> dyn Trait {\n    |             ^^^^^^^^^ doesn't have a size known at compile-time\n    |\n    = note: for information on `impl Trait`, see <https://doc.rust-lang.org/book/ch10-02-traits.html#returning-types-that-implement-traits>\n-help: return `impl Trait` instead, as all return paths are of type `u32`, which implements `Trait`\n+help: return `impl Trait` instead, as all return paths are of type `{integer}`, which implements `Trait`\n    |\n LL | fn bat() -> impl Trait {\n    |             ^^^^^^^^^^\n@@ -261,7 +261,7 @@ LL | fn bay() -> dyn Trait {\n    |             ^^^^^^^^^ doesn't have a size known at compile-time\n    |\n    = note: for information on `impl Trait`, see <https://doc.rust-lang.org/book/ch10-02-traits.html#returning-types-that-implement-traits>\n-help: return `impl Trait` instead, as all return paths are of type `u32`, which implements `Trait`\n+help: return `impl Trait` instead, as all return paths are of type `{integer}`, which implements `Trait`\n    |\n LL | fn bay() -> impl Trait {\n    |             ^^^^^^^^^^"}]}