{"sha": "3f499489f79d05f8cc31b72055155e91bc78fddc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmNDk5NDg5Zjc5ZDA1ZjhjYzMxYjcyMDU1MTU1ZTkxYmM3OGZkZGM=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-02-01T15:41:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-02-01T15:41:55Z"}, "message": "Merge #2964\n\n2964: Improve responsiveness of the cargo check status label r=matklad a=lnicola\n\nThis is still not ideal because the label displays the crate that was just checked, not the one that's currently being checked. But it should give the impression of being faster.\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "170c625c712b602c912ffb516ffdc9594818f547", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/170c625c712b602c912ffb516ffdc9594818f547"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3f499489f79d05f8cc31b72055155e91bc78fddc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeNZxDCRBK7hj4Ov3rIwAAdHIIADQ8dgfiyyalxJqT4ewsNbtQ\nwP0+7txN4xCAGU/qdG/yDTE3c9cmjYoQnomTl6AFdtlyXjdCJbQZzt8LlxOrIqBW\nw+CcJ8I1/ShHl6WHFyn7UR5t9VZWIOKyC9cdIW041ANtYbtb2/y4TP6ZFOtA0mui\nIpq9fge0U2Ef6orHLpYWwyVGXzdm/7ifTz9VCgQ+tJxkjrreE6tBNpMxr9Db4Yjl\nXTEeYe8aVi/CrGEN8NAHYkgArv5K0IHz8Us29TgEl4theZQfyKzdAyKO4EXT0Irv\nr1gSGNL+qUCbZ+h0JxGLVKLjOwgkgCG2e/0xWFAuO7fHlGlKIiFjhdDt85GqmMY=\n=vnY+\n-----END PGP SIGNATURE-----\n", "payload": "tree 170c625c712b602c912ffb516ffdc9594818f547\nparent eba599d9863553d0f7d9d93f4c9050943da171cc\nparent d4d72e8b9b3cc8b9ce72444a11e16cfa606a7f59\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1580571715 +0000\ncommitter GitHub <noreply@github.com> 1580571715 +0000\n\nMerge #2964\n\n2964: Improve responsiveness of the cargo check status label r=matklad a=lnicola\n\nThis is still not ideal because the label displays the crate that was just checked, not the one that's currently being checked. But it should give the impression of being faster.\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3f499489f79d05f8cc31b72055155e91bc78fddc", "html_url": "https://github.com/rust-lang/rust/commit/3f499489f79d05f8cc31b72055155e91bc78fddc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3f499489f79d05f8cc31b72055155e91bc78fddc/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eba599d9863553d0f7d9d93f4c9050943da171cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/eba599d9863553d0f7d9d93f4c9050943da171cc", "html_url": "https://github.com/rust-lang/rust/commit/eba599d9863553d0f7d9d93f4c9050943da171cc"}, {"sha": "d4d72e8b9b3cc8b9ce72444a11e16cfa606a7f59", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4d72e8b9b3cc8b9ce72444a11e16cfa606a7f59", "html_url": "https://github.com/rust-lang/rust/commit/d4d72e8b9b3cc8b9ce72444a11e16cfa606a7f59"}], "stats": {"total": 22, "additions": 14, "deletions": 8}, "files": [{"sha": "7345bc3f50998b118f6bb1ceeb4f3e300ab9b4c0", "filename": "editors/code/src/status_display.ts", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/3f499489f79d05f8cc31b72055155e91bc78fddc/editors%2Fcode%2Fsrc%2Fstatus_display.ts", "raw_url": "https://github.com/rust-lang/rust/raw/3f499489f79d05f8cc31b72055155e91bc78fddc/editors%2Fcode%2Fsrc%2Fstatus_display.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fstatus_display.ts?ref=3f499489f79d05f8cc31b72055155e91bc78fddc", "patch": "@@ -17,7 +17,7 @@ export function activateStatusDisplay(ctx: Ctx) {\n class StatusDisplay implements vscode.Disposable {\n     packageName?: string;\n \n-    private i = 0;\n+    private i: number = 0;\n     private statusBarItem: vscode.StatusBarItem;\n     private command: string;\n     private timer?: NodeJS.Timeout;\n@@ -37,11 +37,8 @@ class StatusDisplay implements vscode.Disposable {\n         this.timer =\n             this.timer ||\n             setInterval(() => {\n-                if (this.packageName) {\n-                    this.statusBarItem!.text = `${this.frame()} cargo ${this.command} [${this.packageName}]`;\n-                } else {\n-                    this.statusBarItem!.text = `${this.frame()} cargo ${this.command}`;\n-                }\n+                this.tick();\n+                this.refreshLabel();\n             }, 300);\n \n         this.statusBarItem.show();\n@@ -65,6 +62,14 @@ class StatusDisplay implements vscode.Disposable {\n         this.statusBarItem.dispose();\n     }\n \n+    refreshLabel() {\n+        if (this.packageName) {\n+            this.statusBarItem!.text = `${spinnerFrames[this.i]} cargo ${this.command} [${this.packageName}]`;\n+        } else {\n+            this.statusBarItem!.text = `${spinnerFrames[this.i]} cargo ${this.command}`;\n+        }\n+    }\n+\n     handleProgressNotification(params: WorkDoneProgressBegin | WorkDoneProgressReport | WorkDoneProgressEnd) {\n         switch (params.kind) {\n             case 'begin':\n@@ -74,6 +79,7 @@ class StatusDisplay implements vscode.Disposable {\n             case 'report':\n                 if (params.message) {\n                     this.packageName = params.message;\n+                    this.refreshLabel();\n                 }\n                 break;\n \n@@ -83,7 +89,7 @@ class StatusDisplay implements vscode.Disposable {\n         }\n     }\n \n-    private frame() {\n-        return spinnerFrames[(this.i = ++this.i % spinnerFrames.length)];\n+    private tick() {\n+        this.i = (this.i + 1) % spinnerFrames.length;\n     }\n }"}]}