{"sha": "7def3f0c82a95ee9147c969e94665418bf77468c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkZWYzZjBjODJhOTVlZTkxNDdjOTY5ZTk0NjY1NDE4YmY3NzQ2OGM=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-10T12:00:29Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-10T12:06:43Z"}, "message": "Retry when downloading the Docker cache.\n\nPrevent spuriously needing to rebuild the docker image when the network\nwas down.\n\nAlso, adjusted the retry function to insert a sleep between retries,\nbecause retrying immediately will often just hit the same issue.", "tree": {"sha": "cac53fdd3ab5a864f879f2dfda04f2155025c212", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cac53fdd3ab5a864f879f2dfda04f2155025c212"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7def3f0c82a95ee9147c969e94665418bf77468c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlr0NdMACgkQ/vbIBR0O\nATxAuBAAjhCbcNzc0ohmgtV68NBwhdo80ZPYDU95cgv3wfxMFip0L2ZfSGHVUL1x\n7Te1xtF1Avr/RLHb0seP3qAASs5QPaJhtd8w3ZNPgWwG8tHyTdWv9780/DOzlc6b\nrTMsD9bcDWPsD9jYcRa6BxzbLgB4D2NBnCzGCy8uQE9wrd6WA8G/JaPWzbQhvu6+\n3Jwk8qEopUo+bRrUZlIimI2u220ORpqGaty7/JXAZtHLCwlgyZjFL1mT4iOmDOa+\nO2nqZcyTdV7FOL3M1/4ObKOqFNqxapo6BtKNGJICB4vz6GgoJDNje+EE+sITc7di\nyrF0AZP3QDH14TX5tC0TGR0kZvexnO/Vhj5y6HhTGUXYN1ye0QAseF+OOTn1z0xi\nTGjcYrQmbADwVOj9P+65hJ3tcS5OcZqS3oFvdHwe0KNKJ1BI0dmW/MOB92Dc9LB1\nwZjroedtxeUuLv/3/9gmKndMfRU+4i+qoWJ/OhEwXuKM6i61P2Ilt2RIs2yT7dUg\nCXB6JX8N0El6YLTL1Fu5dmvq4ZAL2EcShBJg49TlQbOAeNdK2JHZUqfzcXLrGSrM\n1n7Kp+90Ip3hh9qFNfZdqzAbGcWbqKHewIsoSK8EJB+0cwAhG/oF2XG0a+tsdgCw\n7fgu5Ij7kW+ko1EWD/x+B+6CDIQueHsYv7/ueFNQEn7ktBn0H78=\n=hHgW\n-----END PGP SIGNATURE-----", "payload": "tree cac53fdd3ab5a864f879f2dfda04f2155025c212\nparent 95d0b9e96795aea20ac4a1fad9251982714d3c55\nauthor kennytm <kennytm@gmail.com> 1525953629 +0800\ncommitter kennytm <kennytm@gmail.com> 1525954003 +0800\n\nRetry when downloading the Docker cache.\n\nPrevent spuriously needing to rebuild the docker image when the network\nwas down.\n\nAlso, adjusted the retry function to insert a sleep between retries,\nbecause retrying immediately will often just hit the same issue.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7def3f0c82a95ee9147c969e94665418bf77468c", "html_url": "https://github.com/rust-lang/rust/commit/7def3f0c82a95ee9147c969e94665418bf77468c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7def3f0c82a95ee9147c969e94665418bf77468c/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "95d0b9e96795aea20ac4a1fad9251982714d3c55", "url": "https://api.github.com/repos/rust-lang/rust/commits/95d0b9e96795aea20ac4a1fad9251982714d3c55", "html_url": "https://github.com/rust-lang/rust/commit/95d0b9e96795aea20ac4a1fad9251982714d3c55"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "3465e386cd925c90c188a7cd27cd009c368c8beb", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7def3f0c82a95ee9147c969e94665418bf77468c/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/7def3f0c82a95ee9147c969e94665418bf77468c/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=7def3f0c82a95ee9147c969e94665418bf77468c", "patch": "@@ -36,8 +36,10 @@ if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n       s3url=\"s3://$SCCACHE_BUCKET/docker/$cksum\"\n       url=\"https://s3-us-west-1.amazonaws.com/$SCCACHE_BUCKET/docker/$cksum\"\n       echo \"Attempting to download $s3url\"\n+      rm -f /tmp/rustci_docker_cache\n       set +e\n-      loaded_images=$(curl $url | docker load | sed 's/.* sha/sha/')\n+      retry curl -f -L -C - -o /tmp/rustci_docker_cache \"$url\"\n+      loaded_images=$(docker load -i /tmp/rustci_docker_cache | sed 's/.* sha/sha/')\n       set -e\n       echo \"Downloaded containers:\\n$loaded_images\"\n     fi"}, {"sha": "bb6945f0fd6bbb5b542778b466c532e8d3682c23", "filename": "src/ci/shared.sh", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7def3f0c82a95ee9147c969e94665418bf77468c/src%2Fci%2Fshared.sh", "raw_url": "https://github.com/rust-lang/rust/raw/7def3f0c82a95ee9147c969e94665418bf77468c/src%2Fci%2Fshared.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fshared.sh?ref=7def3f0c82a95ee9147c969e94665418bf77468c", "patch": "@@ -21,11 +21,12 @@ function retry {\n   while true; do\n     \"$@\" && break || {\n       if [[ $n -lt $max ]]; then\n+        sleep $n  # don't retry immediately\n         ((n++))\n         echo \"Command failed. Attempt $n/$max:\"\n       else\n         echo \"The command has failed after $n attempts.\"\n-        exit 1\n+        return 1\n       fi\n     }\n   done"}]}