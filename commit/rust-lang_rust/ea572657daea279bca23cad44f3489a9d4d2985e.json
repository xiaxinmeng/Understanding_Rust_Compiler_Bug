{"sha": "ea572657daea279bca23cad44f3489a9d4d2985e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhNTcyNjU3ZGFlYTI3OWJjYTIzY2FkNDRmMzQ4OWE5ZDRkMjk4NWU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-11-04T05:49:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-11-04T05:49:28Z"}, "message": "Rollup merge of #45639 - LaurentMazare:master, r=petrochenkov\n\nAdd a nicer error message for missing  in for loop, fixes #40782.\n\nAs suggested by @estebank in issue #40782, this works in the same way as #42578: if the in keyword is missing, we continue parsing the expression and if this works correctly an adapted error message is produced. Otherwise we return the old error.\n\nA specific test case has also been added.\nThis is my first PR on rust-lang/rust so any feedback is very welcome.", "tree": {"sha": "e147ed0726ced6d25c7230544465fefc294c7983", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e147ed0726ced6d25c7230544465fefc294c7983"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea572657daea279bca23cad44f3489a9d4d2985e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea572657daea279bca23cad44f3489a9d4d2985e", "html_url": "https://github.com/rust-lang/rust/commit/ea572657daea279bca23cad44f3489a9d4d2985e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea572657daea279bca23cad44f3489a9d4d2985e/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae512c4144a8cb2de048ff91895357d9fb5199c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae512c4144a8cb2de048ff91895357d9fb5199c3", "html_url": "https://github.com/rust-lang/rust/commit/ae512c4144a8cb2de048ff91895357d9fb5199c3"}, {"sha": "ed20f3b5c0ae32802450c77da5c94c239c3a3500", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed20f3b5c0ae32802450c77da5c94c239c3a3500", "html_url": "https://github.com/rust-lang/rust/commit/ed20f3b5c0ae32802450c77da5c94c239c3a3500"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "424f46840ad14ec5717cea439e0932bc998ced42", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ea572657daea279bca23cad44f3489a9d4d2985e/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea572657daea279bca23cad44f3489a9d4d2985e/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=ea572657daea279bca23cad44f3489a9d4d2985e", "patch": "@@ -3154,7 +3154,13 @@ impl<'a> Parser<'a> {\n         // Parse: `for <src_pat> in <src_expr> <src_loop_block>`\n \n         let pat = self.parse_pat()?;\n-        self.expect_keyword(keywords::In)?;\n+        if !self.eat_keyword(keywords::In) {\n+            let in_span = self.prev_span.between(self.span);\n+            let mut err = self.sess.span_diagnostic\n+                .struct_span_err(in_span, \"missing `in` in `for` loop\");\n+            err.span_suggestion_short(in_span, \"try adding `in` here\", \" in \".into());\n+            err.emit();\n+        }\n         let expr = self.parse_expr_res(Restrictions::NO_STRUCT_LITERAL, None)?;\n         let (iattrs, loop_block) = self.parse_inner_attrs_and_block()?;\n         attrs.extend(iattrs);"}, {"sha": "56ee225105f8922793c92443d0421733d2372e44", "filename": "src/test/ui/issue-40782.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ea572657daea279bca23cad44f3489a9d4d2985e/src%2Ftest%2Fui%2Fissue-40782.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea572657daea279bca23cad44f3489a9d4d2985e/src%2Ftest%2Fui%2Fissue-40782.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-40782.rs?ref=ea572657daea279bca23cad44f3489a9d4d2985e", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    for i 0..2 {\n+    }\n+}\n+"}, {"sha": "0d49eebbdbfc94b130a664d4401355b1d59118cc", "filename": "src/test/ui/issue-40782.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ea572657daea279bca23cad44f3489a9d4d2985e/src%2Ftest%2Fui%2Fissue-40782.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ea572657daea279bca23cad44f3489a9d4d2985e/src%2Ftest%2Fui%2Fissue-40782.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-40782.stderr?ref=ea572657daea279bca23cad44f3489a9d4d2985e", "patch": "@@ -0,0 +1,8 @@\n+error: missing `in` in `for` loop\n+  --> $DIR/issue-40782.rs:12:10\n+   |\n+12 |     for i 0..2 {\n+   |          ^ help: try adding `in` here\n+\n+error: aborting due to previous error\n+"}]}