{"sha": "aafb0f1f8dd4c57d258374ac554b3162c497847d", "node_id": "C_kwDOAAsO6NoAKGFhZmIwZjFmOGRkNGM1N2QyNTgzNzRhYzU1NGIzMTYyYzQ5Nzg0N2Q", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2023-01-13T14:03:37Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2023-01-13T14:03:37Z"}, "message": "Use smallvec for inlay-hint parts", "tree": {"sha": "3014951be948856236d270aa38e5aa9b01950897", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3014951be948856236d270aa38e5aa9b01950897"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aafb0f1f8dd4c57d258374ac554b3162c497847d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aafb0f1f8dd4c57d258374ac554b3162c497847d", "html_url": "https://github.com/rust-lang/rust/commit/aafb0f1f8dd4c57d258374ac554b3162c497847d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aafb0f1f8dd4c57d258374ac554b3162c497847d/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a119352adab65d0cab25c13ae0fd7676bed7100f", "url": "https://api.github.com/repos/rust-lang/rust/commits/a119352adab65d0cab25c13ae0fd7676bed7100f", "html_url": "https://github.com/rust-lang/rust/commit/a119352adab65d0cab25c13ae0fd7676bed7100f"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "13d8d40ddd37509d8223b92a993e3d445b2122ba", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/aafb0f1f8dd4c57d258374ac554b3162c497847d/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/aafb0f1f8dd4c57d258374ac554b3162c497847d/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=aafb0f1f8dd4c57d258374ac554b3162c497847d", "patch": "@@ -645,6 +645,7 @@ dependencies = [\n  \"profile\",\n  \"pulldown-cmark\",\n  \"pulldown-cmark-to-cmark\",\n+ \"smallvec\",\n  \"stdx\",\n  \"syntax\",\n  \"test-utils\","}, {"sha": "397383bc3a0b2f7fd9b3dbf364140cd9791629f0", "filename": "crates/ide/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/aafb0f1f8dd4c57d258374ac554b3162c497847d/crates%2Fide%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/aafb0f1f8dd4c57d258374ac554b3162c497847d/crates%2Fide%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2FCargo.toml?ref=aafb0f1f8dd4c57d258374ac554b3162c497847d", "patch": "@@ -20,6 +20,7 @@ pulldown-cmark-to-cmark = \"10.0.4\"\n pulldown-cmark = { version = \"0.9.1\", default-features = false }\n url = \"2.3.1\"\n dot = \"0.1.4\"\n+smallvec = \"1.10.0\"\n \n stdx = { path = \"../stdx\", version = \"0.0.0\" }\n syntax = { path = \"../syntax\", version = \"0.0.0\" }"}, {"sha": "f4a9d7b653a296f9d5440dc6e0e5e22966707dff", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/aafb0f1f8dd4c57d258374ac554b3162c497847d/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aafb0f1f8dd4c57d258374ac554b3162c497847d/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=aafb0f1f8dd4c57d258374ac554b3162c497847d", "patch": "@@ -7,6 +7,7 @@ use either::Either;\n use hir::{known, HasVisibility, HirDisplay, HirWrite, ModuleDef, ModuleDefId, Semantics};\n use ide_db::{base_db::FileRange, famous_defs::FamousDefs, RootDatabase};\n use itertools::Itertools;\n+use smallvec::{smallvec, SmallVec};\n use stdx::never;\n use syntax::{\n     ast::{self, AstNode},\n@@ -83,7 +84,7 @@ pub enum AdjustmentHintsMode {\n     PreferPostfix,\n }\n \n-#[derive(Clone, Debug, PartialEq, Eq)]\n+#[derive(Copy, Clone, Debug, PartialEq, Eq)]\n pub enum InlayKind {\n     BindingModeHint,\n     ChainingHint,\n@@ -102,9 +103,15 @@ pub enum InlayKind {\n \n #[derive(Debug)]\n pub struct InlayHint {\n+    /// The text range this inlay hint applies to.\n     pub range: TextRange,\n+    /// The kind of this inlay hint. This is used to determine side and padding of the hint for\n+    /// rendering purposes.\n     pub kind: InlayKind,\n+    /// The actual label to show in the inlay hint.\n     pub label: InlayHintLabel,\n+    /// The tooltip to show when hovering over the inlay hint, this may invoke other actions like\n+    /// hover requests to show.\n     pub tooltip: Option<InlayTooltip>,\n }\n \n@@ -117,7 +124,7 @@ pub enum InlayTooltip {\n \n #[derive(Default)]\n pub struct InlayHintLabel {\n-    pub parts: Vec<InlayHintLabelPart>,\n+    pub parts: SmallVec<[InlayHintLabelPart; 1]>,\n }\n \n impl InlayHintLabel {\n@@ -145,13 +152,13 @@ impl InlayHintLabel {\n \n impl From<String> for InlayHintLabel {\n     fn from(s: String) -> Self {\n-        Self { parts: vec![InlayHintLabelPart { text: s, linked_location: None }] }\n+        Self { parts: smallvec![InlayHintLabelPart { text: s, linked_location: None }] }\n     }\n }\n \n impl From<&str> for InlayHintLabel {\n     fn from(s: &str) -> Self {\n-        Self { parts: vec![InlayHintLabelPart { text: s.into(), linked_location: None }] }\n+        Self { parts: smallvec![InlayHintLabelPart { text: s.into(), linked_location: None }] }\n     }\n }\n "}, {"sha": "12abefc140d5227d89e113fe79305ffbaa179a9e", "filename": "crates/ide/src/inlay_hints/closing_brace.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/aafb0f1f8dd4c57d258374ac554b3162c497847d/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosing_brace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aafb0f1f8dd4c57d258374ac554b3162c497847d/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosing_brace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosing_brace.rs?ref=aafb0f1f8dd4c57d258374ac554b3162c497847d", "patch": "@@ -5,6 +5,7 @@\n //! ```\n use hir::{HirDisplay, Semantics};\n use ide_db::{base_db::FileRange, RootDatabase};\n+use smallvec::smallvec;\n use syntax::{\n     ast::{self, AstNode, HasName},\n     match_ast, SyntaxKind, SyntaxNode, T,\n@@ -116,7 +117,9 @@ pub(super) fn hints(\n     acc.push(InlayHint {\n         range: closing_token.text_range(),\n         kind: InlayKind::ClosingBraceHint,\n-        label: InlayHintLabel { parts: vec![InlayHintLabelPart { text: label, linked_location }] },\n+        label: InlayHintLabel {\n+            parts: smallvec![InlayHintLabelPart { text: label, linked_location }],\n+        },\n         tooltip: None, // provided by label part location\n     });\n "}]}