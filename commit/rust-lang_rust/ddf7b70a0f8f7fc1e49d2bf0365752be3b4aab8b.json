{"sha": "ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b", "node_id": "C_kwDOAAsO6NoAKGRkZjdiNzBhMGY4ZjdmYzFlNDlkMmJmMDM2NTc1MmJlM2I0YWFiOGI", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-01-30T21:46:05Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-01-30T21:47:16Z"}, "message": "Fix cfg_attr invalidating derive identifier IDE functionality", "tree": {"sha": "f9f387ca6d71551eecda7ca359be7322456f249b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f9f387ca6d71551eecda7ca359be7322456f249b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b", "html_url": "https://github.com/rust-lang/rust/commit/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc04cfc982b0321b55d54937709c01ca242eb5ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc04cfc982b0321b55d54937709c01ca242eb5ff", "html_url": "https://github.com/rust-lang/rust/commit/cc04cfc982b0321b55d54937709c01ca242eb5ff"}], "stats": {"total": 29, "additions": 14, "deletions": 15}, "files": [{"sha": "eefc12570d7590243460b2f59c098267996cc974", "filename": "crates/hir/src/semantics.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b/crates%2Fhir%2Fsrc%2Fsemantics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b/crates%2Fhir%2Fsrc%2Fsemantics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsemantics.rs?ref=ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b", "patch": "@@ -364,9 +364,6 @@ impl<'db, DB: HirDatabase> Semantics<'db, DB> {\n         self.imp.resolve_derive_ident(derive, ident)\n     }\n \n-    // FIXME: use this instead?\n-    // pub fn resolve_name_ref(&self, name_ref: &ast::NameRef) -> Option<???>;\n-\n     pub fn record_literal_missing_fields(&self, literal: &ast::RecordExpr) -> Vec<(Field, Type)> {\n         self.imp.record_literal_missing_fields(literal)\n     }\n@@ -931,7 +928,6 @@ impl<'db> SemanticsImpl<'db> {\n                 file.with_value(derive.clone()),\n             )?;\n             let attrs = adt_def.attrs(self.db);\n-            // FIXME: https://github.com/rust-analyzer/rust-analyzer/issues/11298\n             let mut derive_paths = attrs.get(attr_id)?.parse_path_comma_token_tree()?;\n \n             let derive_idx = tt"}, {"sha": "0a8fb2e47a8fee80bf74d842dc5ce974051dc94d", "filename": "crates/hir_def/src/attr.rs", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b/crates%2Fhir_def%2Fsrc%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b/crates%2Fhir_def%2Fsrc%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fattr.rs?ref=ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b", "patch": "@@ -73,8 +73,8 @@ impl ops::Deref for RawAttrs {\n     }\n }\n impl Attrs {\n-    pub fn get(&self, AttrId { ast_index, .. }: AttrId) -> Option<&Attr> {\n-        (**self).get(ast_index as usize)\n+    pub fn get(&self, id: AttrId) -> Option<&Attr> {\n+        (**self).iter().find(|attr| attr.id == id)\n     }\n }\n \n@@ -89,14 +89,6 @@ impl ops::Deref for Attrs {\n     }\n }\n \n-impl ops::Index<AttrId> for Attrs {\n-    type Output = Attr;\n-\n-    fn index(&self, AttrId { ast_index, .. }: AttrId) -> &Self::Output {\n-        &(**self)[ast_index as usize]\n-    }\n-}\n-\n impl ops::Deref for AttrsWithOwner {\n     type Target = Attrs;\n \n@@ -110,7 +102,7 @@ impl RawAttrs {\n \n     pub(crate) fn new(db: &dyn DefDatabase, owner: &dyn ast::HasAttrs, hygiene: &Hygiene) -> Self {\n         let entries = collect_attrs(owner)\n-            .flat_map(|(id, attr)| match attr {\n+            .filter_map(|(id, attr)| match attr {\n                 Either::Left(attr) => {\n                     attr.meta().and_then(|meta| Attr::from_src(db, meta, hygiene, id))\n                 }"}, {"sha": "e599efc5e2d7972f36f3d72b33bdcd17792b068f", "filename": "crates/ide/src/goto_definition.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fgoto_definition.rs?ref=ddf7b70a0f8f7fc1e49d2bf0365752be3b4aab8b", "patch": "@@ -1364,10 +1364,21 @@ impl Twait for Stwuct {\n     fn goto_def_derive_input() {\n         check(\n             r#\"\n+        //- minicore:derive\n+        #[rustc_builtin_macro]\n+        pub macro Copy {}\n+               // ^^^^\n+        #[derive(Copy$0)]\n+        struct Foo;\n+                    \"#,\n+        );\n+        check(\n+            r#\"\n //- minicore:derive\n #[rustc_builtin_macro]\n pub macro Copy {}\n        // ^^^^\n+#[cfg_attr(feature = \"false\", derive)]\n #[derive(Copy$0)]\n struct Foo;\n             \"#,"}]}