{"sha": "262029eca94ff4ec74d985b65d644f62fd593e5d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2MjAyOWVjYTk0ZmY0ZWM3NGQ5ODViNjVkNjQ0ZjYyZmQ1OTNlNWQ=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-11-16T03:02:18Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-11-16T03:02:18Z"}, "message": "Fix a bug where the rustfmt tarball was not being produced", "tree": {"sha": "2f2125f2259e3db5abde0a727c0547e231ee7562", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f2125f2259e3db5abde0a727c0547e231ee7562"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/262029eca94ff4ec74d985b65d644f62fd593e5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/262029eca94ff4ec74d985b65d644f62fd593e5d", "html_url": "https://github.com/rust-lang/rust/commit/262029eca94ff4ec74d985b65d644f62fd593e5d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/262029eca94ff4ec74d985b65d644f62fd593e5d/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff0f5de3b3220e1276bfc9a70ce1787ca7a45388", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff0f5de3b3220e1276bfc9a70ce1787ca7a45388", "html_url": "https://github.com/rust-lang/rust/commit/ff0f5de3b3220e1276bfc9a70ce1787ca7a45388"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "7bf385301fab52acc0cd1fd87c5f6cb79b60cbfb", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/262029eca94ff4ec74d985b65d644f62fd593e5d/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/262029eca94ff4ec74d985b65d644f62fd593e5d/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=262029eca94ff4ec74d985b65d644f62fd593e5d", "patch": "@@ -1159,8 +1159,6 @@ impl Step for Rustfmt {\n         t!(fs::create_dir_all(&image));\n \n         // Prepare the image directory\n-        // We expect RLS to build, because we've exited this step above if tool\n-        // state for RLS isn't testing.\n         let rustfmt = builder.ensure(tool::Rustfmt {\n             compiler: builder.compiler(stage, build.build),\n             target\n@@ -1262,6 +1260,7 @@ impl Step for Extended {\n             compiler: builder.compiler(stage, target),\n         });\n         let cargo_installer = builder.ensure(Cargo { stage, target });\n+        let rustfmt_installer = builder.ensure(Rustfmt { stage, target });\n         let rls_installer = builder.ensure(Rls { stage, target });\n         let mingw_installer = builder.ensure(Mingw { host: target });\n         let analysis_installer = builder.ensure(Analysis {\n@@ -1299,6 +1298,7 @@ impl Step for Extended {\n         tarballs.push(rustc_installer);\n         tarballs.push(cargo_installer);\n         tarballs.extend(rls_installer.clone());\n+        tarballs.extend(rustfmt_installer.clone());\n         tarballs.push(analysis_installer);\n         tarballs.push(std_installer);\n         if build.config.docs {\n@@ -1366,6 +1366,9 @@ impl Step for Extended {\n             if rls_installer.is_none() {\n                 contents = filter(&contents, \"rls\");\n             }\n+            if rustfmt_installer.is_none() {\n+                contents = filter(&contents, \"rustfmt\");\n+            }\n             let ret = tmp.join(p.file_name().unwrap());\n             t!(t!(File::create(&ret)).write_all(contents.as_bytes()));\n             return ret"}]}