{"sha": "736d88b5499e771ed7ca9ff2e874ea2f11503285", "node_id": "C_kwDOAAsO6NoAKDczNmQ4OGI1NDk5ZTc3MWVkN2NhOWZmMmU4NzRlYTJmMTE1MDMyODU", "commit": {"author": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2022-09-20T15:06:49Z"}, "committer": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2022-09-20T15:06:49Z"}, "message": "[arithmetic_side_effects] Add more tests", "tree": {"sha": "c34d819ba7e5a336ecf2d85aa2057495c0f844d3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c34d819ba7e5a336ecf2d85aa2057495c0f844d3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/736d88b5499e771ed7ca9ff2e874ea2f11503285", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/736d88b5499e771ed7ca9ff2e874ea2f11503285", "html_url": "https://github.com/rust-lang/rust/commit/736d88b5499e771ed7ca9ff2e874ea2f11503285", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/736d88b5499e771ed7ca9ff2e874ea2f11503285/comments", "author": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "committer": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c3c6a2de666525e8c32dbc90072a065143c5450", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c3c6a2de666525e8c32dbc90072a065143c5450", "html_url": "https://github.com/rust-lang/rust/commit/5c3c6a2de666525e8c32dbc90072a065143c5450"}], "stats": {"total": 82, "additions": 65, "deletions": 17}, "files": [{"sha": "dd24f5aa592b3b17094f9d395ba58430bc9ccccd", "filename": "tests/ui/arithmetic_side_effects.rs", "status": "modified", "additions": 45, "deletions": 3, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/736d88b5499e771ed7ca9ff2e874ea2f11503285/tests%2Fui%2Farithmetic_side_effects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/736d88b5499e771ed7ca9ff2e874ea2f11503285/tests%2Fui%2Farithmetic_side_effects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic_side_effects.rs?ref=736d88b5499e771ed7ca9ff2e874ea2f11503285", "patch": "@@ -11,6 +11,39 @@\n \n use core::num::{Saturating, Wrapping};\n \n+pub fn association_with_structures_should_not_trigger_the_lint() {\n+    enum Foo {\n+        Bar = -2,\n+    }\n+\n+    impl Trait for Foo {\n+        const ASSOC: i32 = {\n+            let _: [i32; 1 + 1];\n+            fn foo() {}\n+            1 + 1\n+        };\n+    }\n+\n+    struct Baz([i32; 1 + 1]);\n+\n+    trait Trait {\n+        const ASSOC: i32 = 1 + 1;\n+    }\n+\n+    type Alias = [i32; 1 + 1];\n+\n+    union Qux {\n+        field: [i32; 1 + 1],\n+    }\n+\n+    let _: [i32; 1 + 1] = [0, 0];\n+\n+    let _: [i32; 1 + 1] = {\n+        let a: [i32; 1 + 1] = [0, 0];\n+        a\n+    };\n+}\n+\n pub fn hard_coded_allowed() {\n     let _ = 1f32 + 1f32;\n     let _ = 1f64 + 1f64;\n@@ -33,7 +66,7 @@ pub fn hard_coded_allowed() {\n }\n \n #[rustfmt::skip]\n-pub fn non_overflowing_const_ops() {\n+pub fn const_ops_should_not_trigger_the_lint() {\n     const _: i32 = { let mut n = 1; n += 1; n };\n     let _ = const { let mut n = 1; n += 1; n };\n \n@@ -45,9 +78,12 @@ pub fn non_overflowing_const_ops() {\n \n     const _: i32 = 1 + 1;\n     let _ = const { 1 + 1 };\n+\n+    const _: i32 = { let mut n = -1; n = -(-1); n = -n; n };\n+    let _ = const { let mut n = -1; n = -(-1); n = -n; n };\n }\n \n-pub fn non_overflowing_runtime_ops() {\n+pub fn non_overflowing_runtime_ops_or_ops_already_handled_by_the_compiler() {\n     let mut _n = i32::MAX;\n \n     // Assign\n@@ -70,9 +106,12 @@ pub fn non_overflowing_runtime_ops() {\n     _n = _n * 1;\n     _n = 1 * _n;\n     _n = 23 + 85;\n+\n+    // Unary\n+    _n = -1;\n+    _n = -(-1);\n }\n \n-#[rustfmt::skip]\n pub fn overflowing_runtime_ops() {\n     let mut _n = i32::MAX;\n \n@@ -92,6 +131,9 @@ pub fn overflowing_runtime_ops() {\n     _n = _n % 0;\n     _n = _n * 2;\n     _n = 2 * _n;\n+\n+    // Unary\n+    _n = -_n;\n }\n \n fn main() {}"}, {"sha": "a2a856efbffc02f8765e34edd2a67d752ece3bf8", "filename": "tests/ui/arithmetic_side_effects.stderr", "status": "modified", "additions": 20, "deletions": 14, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/736d88b5499e771ed7ca9ff2e874ea2f11503285/tests%2Fui%2Farithmetic_side_effects.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/736d88b5499e771ed7ca9ff2e874ea2f11503285/tests%2Fui%2Farithmetic_side_effects.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic_side_effects.stderr?ref=736d88b5499e771ed7ca9ff2e874ea2f11503285", "patch": "@@ -1,82 +1,88 @@\n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:80:5\n+  --> $DIR/arithmetic_side_effects.rs:119:5\n    |\n LL |     _n += 1;\n    |     ^^^^^^^\n    |\n    = note: `-D clippy::arithmetic-side-effects` implied by `-D warnings`\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:81:5\n+  --> $DIR/arithmetic_side_effects.rs:120:5\n    |\n LL |     _n -= 1;\n    |     ^^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:82:5\n+  --> $DIR/arithmetic_side_effects.rs:121:5\n    |\n LL |     _n /= 0;\n    |     ^^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:83:5\n+  --> $DIR/arithmetic_side_effects.rs:122:5\n    |\n LL |     _n %= 0;\n    |     ^^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:84:5\n+  --> $DIR/arithmetic_side_effects.rs:123:5\n    |\n LL |     _n *= 2;\n    |     ^^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:87:10\n+  --> $DIR/arithmetic_side_effects.rs:126:10\n    |\n LL |     _n = _n + 1;\n    |          ^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:88:10\n+  --> $DIR/arithmetic_side_effects.rs:127:10\n    |\n LL |     _n = 1 + _n;\n    |          ^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:89:10\n+  --> $DIR/arithmetic_side_effects.rs:128:10\n    |\n LL |     _n = _n - 1;\n    |          ^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:90:10\n+  --> $DIR/arithmetic_side_effects.rs:129:10\n    |\n LL |     _n = 1 - _n;\n    |          ^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:91:10\n+  --> $DIR/arithmetic_side_effects.rs:130:10\n    |\n LL |     _n = _n / 0;\n    |          ^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:92:10\n+  --> $DIR/arithmetic_side_effects.rs:131:10\n    |\n LL |     _n = _n % 0;\n    |          ^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:93:10\n+  --> $DIR/arithmetic_side_effects.rs:132:10\n    |\n LL |     _n = _n * 2;\n    |          ^^^^^^\n \n error: arithmetic operation that can potentially result in unexpected side-effects\n-  --> $DIR/arithmetic_side_effects.rs:94:10\n+  --> $DIR/arithmetic_side_effects.rs:133:10\n    |\n LL |     _n = 2 * _n;\n    |          ^^^^^^\n \n-error: aborting due to 13 previous errors\n+error: arithmetic operation that can potentially result in unexpected side-effects\n+  --> $DIR/arithmetic_side_effects.rs:136:10\n+   |\n+LL |     _n = -_n;\n+   |          ^^^\n+\n+error: aborting due to 14 previous errors\n "}]}