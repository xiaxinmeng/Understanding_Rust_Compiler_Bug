{"sha": "d13547a1c61b940c1ca20159ad3b24b160c90ac7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxMzU0N2ExYzYxYjk0MGMxY2EyMDE1OWFkM2IyNGIxNjBjOTBhYzc=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-04-07T11:52:33Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-04-07T11:52:33Z"}, "message": "ci: pin android emulator to 28.0.23", "tree": {"sha": "500b160c3e9cd07d9b1aa1710691dda7a15ddc56", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/500b160c3e9cd07d9b1aa1710691dda7a15ddc56"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d13547a1c61b940c1ca20159ad3b24b160c90ac7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAlyp5LAACgkQPgar6Auq\n8ZxDPw/+J8rxZ6Gi68M3WjUi9ZXgcFA81SKbTtMoouO1BXa7fKK4brqBzrOubvQc\nwQkVZ8NXpnnPdhZ9fXI88kQUZMPI/Vxo9ZIuiVkJei/An2qkxg+Bk0p1wrRH0b4D\nX/dVI3YWXVL8L5y9cP7eJQ+UfXvZM4t2uneKXz3brnImx006NUYygJgxIg2vSIs1\nVPuscayd7f9ZKdANZHj/KBdSb6lNdJP3fbfyd+r7PGff1J+kqccAZXbsuQ4ZFdV+\nG2WJ6kqbNdIM+aLXHDy8/u+e+05lGusGb0OWqJBvDc0kR0NDrvquwJ/oZgXilFNZ\n8aMczZZcMYJ289nI0BmA38GnJit9GqhwRKZouoE6JfDZE4MkY0y7ChGdUjtvfQrj\nt/cecIGuIxi2tARniyErYHsKcQfH1TjFyFmlyLtTFUho7PhPSlbPjct7BFUkzQZD\nA0mpkjrkFo+hl+6lpwQ9PFVx8SXxCER9SgjMg9KOmh7X2ZF+gARJZy3D8FWR/qbi\n1bV/WunjtCTTnyV7yKoRQh1fQoXedkfJI2BT6vCnzUsWsu43SOEn7DV82dJpY8mD\n5CLNZfsP9an/+6W0OLwmildHhNP+GCR5iVGctK6wGE6de7IQpGlJKVbr51kLH/Uq\nUQbS1Tk3Mpn0lbxBT3E4Tc3jlsBUMEXOzzKTST0cElR/a7iajw0=\n=dTXP\n-----END PGP SIGNATURE-----", "payload": "tree 500b160c3e9cd07d9b1aa1710691dda7a15ddc56\nparent acd8dd6a50d505057a7d7ad8d0d7a4c2bd274200\nauthor Pietro Albini <pietro@pietroalbini.org> 1554637953 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1554637953 +0200\n\nci: pin android emulator to 28.0.23\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d13547a1c61b940c1ca20159ad3b24b160c90ac7", "html_url": "https://github.com/rust-lang/rust/commit/d13547a1c61b940c1ca20159ad3b24b160c90ac7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d13547a1c61b940c1ca20159ad3b24b160c90ac7/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acd8dd6a50d505057a7d7ad8d0d7a4c2bd274200", "url": "https://api.github.com/repos/rust-lang/rust/commits/acd8dd6a50d505057a7d7ad8d0d7a4c2bd274200", "html_url": "https://github.com/rust-lang/rust/commit/acd8dd6a50d505057a7d7ad8d0d7a4c2bd274200"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "bbf700ae2339fe9a90e4e64524ab5a00d2a9a5f9", "filename": "src/ci/docker/arm-android/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d13547a1c61b940c1ca20159ad3b24b160c90ac7/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d13547a1c61b940c1ca20159ad3b24b160c90ac7/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2FDockerfile?ref=d13547a1c61b940c1ca20159ad3b24b160c90ac7", "patch": "@@ -23,7 +23,7 @@ RUN dpkg --add-architecture i386 && \\\n \n COPY scripts/android-sdk.sh /scripts/\n RUN . /scripts/android-sdk.sh && \\\n-    download_and_create_avd 4333796 armeabi-v7a 18\n+    download_and_create_avd 4333796 armeabi-v7a 18 5264690\n \n ENV PATH=$PATH:/android/sdk/emulator\n ENV PATH=$PATH:/android/sdk/tools"}, {"sha": "e78e3795c046adde1f55f974e8c7db42163fbc94", "filename": "src/ci/docker/scripts/android-sdk.sh", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/d13547a1c61b940c1ca20159ad3b24b160c90ac7/src%2Fci%2Fdocker%2Fscripts%2Fandroid-sdk.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d13547a1c61b940c1ca20159ad3b24b160c90ac7/src%2Fci%2Fdocker%2Fscripts%2Fandroid-sdk.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fandroid-sdk.sh?ref=d13547a1c61b940c1ca20159ad3b24b160c90ac7", "patch": "@@ -20,11 +20,19 @@ download_sysimage() {\n     # The output from sdkmanager is so noisy that it will occupy all of the 4 MB\n     # log extremely quickly. Thus we must silence all output.\n     yes | sdkmanager --licenses > /dev/null\n-    yes | sdkmanager platform-tools emulator \\\n+    yes | sdkmanager platform-tools \\\n         \"platforms;android-$api\" \\\n         \"system-images;android-$api;default;$abi\" > /dev/null\n }\n \n+download_emulator() {\n+    # Download a pinned version of the emulator since upgrades can cause issues\n+    curl -fo emulator.zip \"https://dl.google.com/android/repository/emulator-linux-$1.zip\"\n+    rm -rf \"${ANDROID_HOME}/emulator\"\n+    unzip -q emulator.zip -d \"${ANDROID_HOME}\"\n+    rm -f emulator.zip\n+}\n+\n create_avd() {\n     abi=$1\n     api=$2\n@@ -40,11 +48,12 @@ download_and_create_avd() {\n     download_sdk $1\n     download_sysimage $2 $3\n     create_avd $2 $3\n+    download_emulator $4\n }\n \n # Usage:\n #\n-#       setup_android_sdk 4333796 armeabi-v7a 18\n+#       download_and_create_avd 4333796 armeabi-v7a 18 5264690\n #\n # 4333796 =>\n #   SDK tool version.\n@@ -53,3 +62,6 @@ download_and_create_avd() {\n #   System image ABI\n # 18 =>\n #   Android API Level (18 = Android 4.3 = Jelly Bean MR2)\n+# 5264690 =>\n+#   Android Emulator version.\n+#   Copy from the \"build_id\" in the `/android/sdk/emulator/emulator -version` output"}]}