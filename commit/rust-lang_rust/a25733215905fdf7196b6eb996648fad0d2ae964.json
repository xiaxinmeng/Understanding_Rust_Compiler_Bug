{"sha": "a25733215905fdf7196b6eb996648fad0d2ae964", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyNTczMzIxNTkwNWZkZjcxOTZiNmViOTk2NjQ4ZmFkMGQyYWU5NjQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-11-03T18:32:53Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-11-03T18:32:53Z"}, "message": "Ensure --exclude is checked against PathSet::Suite\n\nFix the recent spurious 3 hour timeouts.", "tree": {"sha": "cccc66ebcb8d23f214bab627e41a20f7e769383d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cccc66ebcb8d23f214bab627e41a20f7e769383d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a25733215905fdf7196b6eb996648fad0d2ae964", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlvd6dUACgkQ/vbIBR0O\nATzzzBAAtYp/3QnNLh6bi0aU353lzX5xUfHezWK533pRVAIEj6pMdD7kcN9yPC7o\n+kwUvfpguXNwL8C7Be8nQH0TVIcaKcCfEecA2fT3bwBxnutGzpKXOvhr/vKP79Oa\nnASOHku2KQsQGSEJ8tqBA4hOa8a/G6jmVP15Cow6faLkYogrseIokEel5hfBjE73\nD21yy3sD0NsGwILbUv9pRgdI0IIcE/3eMUqS5jEszBK3QZC9p3KrPYxSPLL1cfJ4\nqPXwuY7wKFdM4K7wlmQFiX3hKlpGc3kktnqEngyivWDAr/dEzzkFdp3i/76XH7Uc\nykDLAZ4TdIwdfYs3wofXN6RI/tJFQiWktbjZcBmipzxbGoB36+wDJdcgmZ/6drcW\nBXVqXiN/8EEi6kEjkT3FyHi6hRCBGMcqSdYlEcQWac5/LnADeB9a4fWIWALx4Fkm\nVjtxmonwVe9Fj69hJoLG3t9U/LC3zi3h6asyCTehBJPtaAbOkMRHtHZp97Uc2SFm\nrEBnZP8paz6VVLq6XnzffhmMQ3f0MTgELghuWMUBYvnxRIEYi3IJf0Vdk+9QRR9/\nMTuwVPlyAGSlTsux/rMzbbAR07HahqKO0Wf8foD12NFaUt4jPAZ+bPZWKD6Xwjre\nvcHoCdEPCpMsfiaPlNxLMm0JPQrXMAbsM0FW3yrPX0LWd8y/Ls8=\n=GaUU\n-----END PGP SIGNATURE-----", "payload": "tree cccc66ebcb8d23f214bab627e41a20f7e769383d\nparent 3d28ee3e34d100534062d0bc690779ed9b6927fe\nauthor kennytm <kennytm@gmail.com> 1541269973 +0800\ncommitter kennytm <kennytm@gmail.com> 1541269973 +0800\n\nEnsure --exclude is checked against PathSet::Suite\n\nFix the recent spurious 3 hour timeouts.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a25733215905fdf7196b6eb996648fad0d2ae964", "html_url": "https://github.com/rust-lang/rust/commit/a25733215905fdf7196b6eb996648fad0d2ae964", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a25733215905fdf7196b6eb996648fad0d2ae964/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3d28ee3e34d100534062d0bc690779ed9b6927fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d28ee3e34d100534062d0bc690779ed9b6927fe", "html_url": "https://github.com/rust-lang/rust/commit/3d28ee3e34d100534062d0bc690779ed9b6927fe"}], "stats": {"total": 39, "additions": 37, "deletions": 2}, "files": [{"sha": "900f336ef8cdc1dd06f8c9bc1dd42c7f225ecf6e", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 32, "deletions": 2, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/a25733215905fdf7196b6eb996648fad0d2ae964/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a25733215905fdf7196b6eb996648fad0d2ae964/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=a25733215905fdf7196b6eb996648fad0d2ae964", "patch": "@@ -130,7 +130,7 @@ impl PathSet {\n     fn has(&self, needle: &Path) -> bool {\n         match self {\n             PathSet::Set(set) => set.iter().any(|p| p.ends_with(needle)),\n-            PathSet::Suite(_) => false,\n+            PathSet::Suite(suite) => suite.ends_with(needle),\n         }\n     }\n \n@@ -1849,7 +1849,7 @@ mod __test {\n         );\n \n         // Ensure we don't build any compiler artifacts.\n-        assert!(builder.cache.all::<compile::Rustc>().is_empty());\n+        assert!(!builder.cache.contains::<compile::Rustc>());\n         assert_eq!(\n             first(builder.cache.all::<test::Crate>()),\n             &[test::Crate {\n@@ -1861,4 +1861,34 @@ mod __test {\n             },]\n         );\n     }\n+\n+    #[test]\n+    fn test_exclude() {\n+        let mut config = configure(&[], &[]);\n+        config.exclude = vec![\n+            \"src/test/run-pass\".into(),\n+            \"src/tools/tidy\".into(),\n+        ];\n+        config.cmd = Subcommand::Test {\n+            paths: Vec::new(),\n+            test_args: Vec::new(),\n+            rustc_args: Vec::new(),\n+            fail_fast: true,\n+            doc_tests: DocTests::No,\n+            bless: false,\n+            compare_mode: None,\n+        };\n+\n+        let build = Build::new(config);\n+        let builder = Builder::new(&build);\n+        builder.run_step_descriptions(&Builder::get_step_descriptions(Kind::Test), &[]);\n+\n+        // Ensure we have really excluded run-pass & tidy\n+        assert!(!builder.cache.contains::<test::RunPass>());\n+        assert!(!builder.cache.contains::<test::Tidy>());\n+\n+        // Ensure other tests are not affected.\n+        assert!(builder.cache.contains::<test::RunPassFullDeps>());\n+        assert!(builder.cache.contains::<test::RustdocUi>());\n+    }\n }"}, {"sha": "0b561a3523f2b483460d8549b75f4913d7a6bcd0", "filename": "src/bootstrap/cache.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a25733215905fdf7196b6eb996648fad0d2ae964/src%2Fbootstrap%2Fcache.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a25733215905fdf7196b6eb996648fad0d2ae964/src%2Fbootstrap%2Fcache.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcache.rs?ref=a25733215905fdf7196b6eb996648fad0d2ae964", "patch": "@@ -286,4 +286,9 @@ impl Cache {\n         v.sort_by_key(|&(a, _)| a);\n         v\n     }\n+\n+    #[cfg(test)]\n+    pub fn contains<S: Step>(&self) -> bool {\n+        self.0.borrow().contains_key(&TypeId::of::<S>())\n+    }\n }"}]}