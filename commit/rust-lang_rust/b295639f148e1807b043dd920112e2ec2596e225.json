{"sha": "b295639f148e1807b043dd920112e2ec2596e225", "node_id": "C_kwDOAAsO6NoAKGIyOTU2MzlmMTQ4ZTE4MDdiMDQzZGQ5MjAxMTJlMmVjMjU5NmUyMjU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-18T03:10:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-18T03:10:46Z"}, "message": "Rollup merge of #100643 - TaKO8Ki:point-at-type-parameter-shadowing-another-type, r=estebank\n\nPoint at a type parameter shadowing another type\n\nThis patch fixes a part of #97459.", "tree": {"sha": "fd900c7ae33249d0e8201baadaba52c9a5a54027", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd900c7ae33249d0e8201baadaba52c9a5a54027"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b295639f148e1807b043dd920112e2ec2596e225", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi/a22CRBK7hj4Ov3rIwAAMK4IAKpNKGlT9XnWmX4Rl/vyVHoR\nts6QKU6nAymnmQu4Ky0VHMsMj/vqJZFHya3wjh8JQlEMxM3sBjQTAkycPneMEo4A\nheDuUBYi8x24ZaECqPaOyPBeyzKbHfXSt2J4BG4KMkIA2ZidFMvbLEDI7dtHi4HY\nHp1fqemUTJxXRqP4h+RT9SQ1hyHrd7jmTuSExpnUzAAl8zX8ta2kk1ynHCgZL0w1\nw1BMVAKLRffibfybU1V9RQujhRbj0zZjYB0fovTnQtMEpGhM8tMhYjJ3/A29lKEh\nZXYVYERR3x3Eh44+1KKdEWllQKKT5ijUqa7r4VkO16DS9hC4FGGYZcFVe+9Tt7g=\n=xHYY\n-----END PGP SIGNATURE-----\n", "payload": "tree fd900c7ae33249d0e8201baadaba52c9a5a54027\nparent 795e55f1e1ae0294d671a94c7d5ecfc9f13e1ad5\nparent 5a848c701b98bf99b7dd480dc95bf1227b134e55\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1660792246 +0200\ncommitter GitHub <noreply@github.com> 1660792246 +0200\n\nRollup merge of #100643 - TaKO8Ki:point-at-type-parameter-shadowing-another-type, r=estebank\n\nPoint at a type parameter shadowing another type\n\nThis patch fixes a part of #97459.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b295639f148e1807b043dd920112e2ec2596e225", "html_url": "https://github.com/rust-lang/rust/commit/b295639f148e1807b043dd920112e2ec2596e225", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b295639f148e1807b043dd920112e2ec2596e225/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "795e55f1e1ae0294d671a94c7d5ecfc9f13e1ad5", "url": "https://api.github.com/repos/rust-lang/rust/commits/795e55f1e1ae0294d671a94c7d5ecfc9f13e1ad5", "html_url": "https://github.com/rust-lang/rust/commit/795e55f1e1ae0294d671a94c7d5ecfc9f13e1ad5"}, {"sha": "5a848c701b98bf99b7dd480dc95bf1227b134e55", "url": "https://api.github.com/repos/rust-lang/rust/commits/5a848c701b98bf99b7dd480dc95bf1227b134e55", "html_url": "https://github.com/rust-lang/rust/commit/5a848c701b98bf99b7dd480dc95bf1227b134e55"}], "stats": {"total": 57, "additions": 54, "deletions": 3}, "files": [{"sha": "4175527da470c5298104336c28e2707f96b3d28e", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b295639f148e1807b043dd920112e2ec2596e225/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b295639f148e1807b043dd920112e2ec2596e225/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=b295639f148e1807b043dd920112e2ec2596e225", "patch": "@@ -161,6 +161,7 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n             msg: String,\n             fallback_label: String,\n             span: Span,\n+            span_label: Option<(Span, &'a str)>,\n             could_be_expr: bool,\n             suggestion: Option<(Span, &'a str, String)>,\n         }\n@@ -172,6 +173,12 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                 msg: format!(\"expected {}, found {} `{}`\", expected, res.descr(), path_str),\n                 fallback_label: format!(\"not a {expected}\"),\n                 span,\n+                span_label: match res {\n+                    Res::Def(kind, def_id) if kind == DefKind::TyParam => {\n+                        self.def_span(def_id).map(|span| (span, \"found this type pararmeter\"))\n+                    }\n+                    _ => None,\n+                },\n                 could_be_expr: match res {\n                     Res::Def(DefKind::Fn, _) => {\n                         // Verify whether this is a fn call or an Fn used as a type.\n@@ -251,6 +258,7 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                     format!(\"not found in {mod_str}\")\n                 },\n                 span: item_span,\n+                span_label: None,\n                 could_be_expr: false,\n                 suggestion,\n             }\n@@ -262,6 +270,10 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n \n         self.suggest_swapping_misplaced_self_ty_and_trait(&mut err, source, res, base_error.span);\n \n+        if let Some((span, label)) = base_error.span_label {\n+            err.span_label(span, label);\n+        }\n+\n         if let Some(sugg) = base_error.suggestion {\n             err.span_suggestion_verbose(sugg.0, sugg.1, sugg.2, Applicability::MaybeIncorrect);\n         }"}, {"sha": "5ad457d547a69bdd3c3427bda54bcaa7091bd182", "filename": "src/test/ui/const-generics/generic_const_exprs/issue-69654.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-69654.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-69654.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-69654.stderr?ref=b295639f148e1807b043dd920112e2ec2596e225", "patch": "@@ -2,7 +2,9 @@ error[E0423]: expected value, found type parameter `T`\n   --> $DIR/issue-69654.rs:5:25\n    |\n LL | impl<T> Bar<T> for [u8; T] {}\n-   |                         ^ not a value\n+   |      -                  ^ not a value\n+   |      |\n+   |      found this type pararmeter\n \n error[E0599]: the function or associated item `foo` exists for struct `Foo<_>`, but its trait bounds were not satisfied\n   --> $DIR/issue-69654.rs:17:10"}, {"sha": "ad11f72a31d37735c9131e087a3b424353e46b63", "filename": "src/test/ui/lexical-scopes.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Flexical-scopes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Flexical-scopes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flexical-scopes.stderr?ref=b295639f148e1807b043dd920112e2ec2596e225", "patch": "@@ -1,6 +1,8 @@\n error[E0574]: expected struct, variant or union type, found type parameter `T`\n   --> $DIR/lexical-scopes.rs:3:13\n    |\n+LL | fn f<T>() {\n+   |      - found this type pararmeter\n LL |     let t = T { i: 0 };\n    |             ^ not a struct, variant or union type\n "}, {"sha": "bd496875e80b948711613fd4661f344028e45700", "filename": "src/test/ui/resolve/point-at-type-parameter-shadowing-another-type.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fresolve%2Fpoint-at-type-parameter-shadowing-another-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fresolve%2Fpoint-at-type-parameter-shadowing-another-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fpoint-at-type-parameter-shadowing-another-type.rs?ref=b295639f148e1807b043dd920112e2ec2596e225", "patch": "@@ -0,0 +1,21 @@\n+trait Foo<T> {\n+    fn foo(&self, name: T) -> usize;\n+}\n+\n+struct Bar {\n+    baz: Baz,\n+}\n+\n+struct Baz {\n+    num: usize,\n+}\n+\n+impl<Baz> Foo<Baz> for Bar {\n+    fn foo(&self, _name: Baz) -> usize {\n+        match self.baz {\n+            Baz { num } => num, //~ ERROR expected struct, variant or union type, found type parameter `Baz`\n+        }\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "d9c404e94acb4dfd2e6486c32460f1ca0f604560", "filename": "src/test/ui/resolve/point-at-type-parameter-shadowing-another-type.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fresolve%2Fpoint-at-type-parameter-shadowing-another-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fresolve%2Fpoint-at-type-parameter-shadowing-another-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fpoint-at-type-parameter-shadowing-another-type.stderr?ref=b295639f148e1807b043dd920112e2ec2596e225", "patch": "@@ -0,0 +1,12 @@\n+error[E0574]: expected struct, variant or union type, found type parameter `Baz`\n+  --> $DIR/point-at-type-parameter-shadowing-another-type.rs:16:13\n+   |\n+LL | impl<Baz> Foo<Baz> for Bar {\n+   |      --- found this type pararmeter\n+...\n+LL |             Baz { num } => num,\n+   |             ^^^ not a struct, variant or union type\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0574`."}, {"sha": "ea9c4c82c361068f0b91a7c6900cf1434e2f4ef5", "filename": "src/test/ui/span/issue-35987.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fspan%2Fissue-35987.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftest%2Fui%2Fspan%2Fissue-35987.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-35987.stderr?ref=b295639f148e1807b043dd920112e2ec2596e225", "patch": "@@ -2,7 +2,9 @@ error[E0404]: expected trait, found type parameter `Add`\n   --> $DIR/issue-35987.rs:5:21\n    |\n LL | impl<T: Clone, Add> Add for Foo<T> {\n-   |                     ^^^ not a trait\n+   |                ---  ^^^ not a trait\n+   |                |\n+   |                found this type pararmeter\n    |\n help: consider importing this trait instead\n    |"}, {"sha": "764893daa12ad88affa9438271f46ceacc5e3561", "filename": "src/tools/rust-analyzer/bench_data/glorious_old_parser", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftools%2Frust-analyzer%2Fbench_data%2Fglorious_old_parser", "raw_url": "https://github.com/rust-lang/rust/raw/b295639f148e1807b043dd920112e2ec2596e225/src%2Ftools%2Frust-analyzer%2Fbench_data%2Fglorious_old_parser", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frust-analyzer%2Fbench_data%2Fglorious_old_parser?ref=b295639f148e1807b043dd920112e2ec2596e225", "patch": "@@ -1988,7 +1988,7 @@ impl<'a> Parser<'a> {\n                     err.span_suggestion(\n                         span,\n                         \"declare the type after the parameter binding\",\n-                        String::from(\"<identifier>: <type>\"),\n+                        \"<identifier>: <type>\",\n                         Applicability::HasPlaceholders,\n                     );\n                 } else if require_name && is_trait_item {"}]}