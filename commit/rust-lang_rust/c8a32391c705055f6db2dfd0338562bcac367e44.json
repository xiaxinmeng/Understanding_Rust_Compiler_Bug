{"sha": "c8a32391c705055f6db2dfd0338562bcac367e44", "node_id": "C_kwDOAAsO6NoAKGM4YTMyMzkxYzcwNTA1NWY2ZGIyZGZkMDMzODU2MmJjYWMzNjdlNDQ", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-04-22T01:33:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-22T01:33:59Z"}, "message": "Rollup merge of #110659 - notriddle:notriddle/js-cleanup-20230421, r=GuillaumeGomez\n\nrustdoc: clean up JS\n\n* use `Set` for ignored crates in cross-crate trait impl JS, instead of `indexOf` string manipulation\n* lift constant `window.location.split` code out of a loop in source code sidebar builder\n* remove redundant history manipulation from search page exit", "tree": {"sha": "222ba5cb8dad3e0b1362f90ac5d0d22c457c807b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/222ba5cb8dad3e0b1362f90ac5d0d22c457c807b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c8a32391c705055f6db2dfd0338562bcac367e44", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkQzmHCRBK7hj4Ov3rIwAAVhQIACCz3C0VDu5TEvqi1ORZgYhE\nPmA9sA/1asEoXnHwOt0FAWt2EmucBAkl3JUNPmllGJaJPB059KX8Z3sPhjcSvO9g\np8LY9QuX9dmNSBxbgVPszXczfeku7vz5PS4XjAxcuqMoO2JJxmiwYPrdi1/CCQfA\nXQVz99Z6n6M05yx5uzIAs+4jLpLeCXw/o7lCIKOwEz/mwjBMqH0Uq73E0+120c7a\njRGza6BDFGLxBeaADY71jAv47efUQbl51HuMmsY4YOii/JEwKQqyAA0LmdY23X0S\nbJ+t+242iPFpWGcLZtHVX4ZoUUfS/NUwo2nKmGu/2EHoceX7AUXKyaCjeQYpVAA=\n=ZT2Z\n-----END PGP SIGNATURE-----\n", "payload": "tree 222ba5cb8dad3e0b1362f90ac5d0d22c457c807b\nparent 617ecd2a7a9906eccd93c04d27636f0934988af7\nparent 0cd387415558729c72962bf8f47d229f0b93ce50\nauthor Yuki Okushi <jtitor@2k36.org> 1682127239 +0900\ncommitter GitHub <noreply@github.com> 1682127239 +0900\n\nRollup merge of #110659 - notriddle:notriddle/js-cleanup-20230421, r=GuillaumeGomez\n\nrustdoc: clean up JS\n\n* use `Set` for ignored crates in cross-crate trait impl JS, instead of `indexOf` string manipulation\n* lift constant `window.location.split` code out of a loop in source code sidebar builder\n* remove redundant history manipulation from search page exit\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c8a32391c705055f6db2dfd0338562bcac367e44", "html_url": "https://github.com/rust-lang/rust/commit/c8a32391c705055f6db2dfd0338562bcac367e44", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c8a32391c705055f6db2dfd0338562bcac367e44/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "617ecd2a7a9906eccd93c04d27636f0934988af7", "url": "https://api.github.com/repos/rust-lang/rust/commits/617ecd2a7a9906eccd93c04d27636f0934988af7", "html_url": "https://github.com/rust-lang/rust/commit/617ecd2a7a9906eccd93c04d27636f0934988af7"}, {"sha": "0cd387415558729c72962bf8f47d229f0b93ce50", "url": "https://api.github.com/repos/rust-lang/rust/commits/0cd387415558729c72962bf8f47d229f0b93ce50", "html_url": "https://github.com/rust-lang/rust/commit/0cd387415558729c72962bf8f47d229f0b93ce50"}], "stats": {"total": 17, "additions": 6, "deletions": 11}, "files": [{"sha": "bccf675c14b5ed9162d58845c52fc2eda9e87a1f", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c8a32391c705055f6db2dfd0338562bcac367e44/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/c8a32391c705055f6db2dfd0338562bcac367e44/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=c8a32391c705055f6db2dfd0338562bcac367e44", "patch": "@@ -375,10 +375,7 @@ function preLoadCss(cssUrl) {\n \n     function handleEscape(ev) {\n         searchState.clearInputTimeout();\n-        switchDisplayedElement(null);\n-        if (browserSupportsHistoryApi()) {\n-            history.replaceState(null, \"\", getNakedUrl() + window.location.hash);\n-        }\n+        searchState.hideResults();\n         ev.preventDefault();\n         searchState.defocus();\n         window.hideAllModals(true); // true = reset focus for tooltips\n@@ -533,9 +530,11 @@ function preLoadCss(cssUrl) {\n         // ignored are included in the attribute `data-ignore-extern-crates`.\n         const script = document\n             .querySelector(\"script[data-ignore-extern-crates]\");\n-        const ignoreExternCrates = script ? script.getAttribute(\"data-ignore-extern-crates\") : \"\";\n+        const ignoreExternCrates = new Set(\n+            (script ? script.getAttribute(\"data-ignore-extern-crates\") : \"\").split(\",\")\n+        );\n         for (const lib of libs) {\n-            if (lib === window.currentCrate || ignoreExternCrates.indexOf(lib) !== -1) {\n+            if (lib === window.currentCrate || ignoreExternCrates.has(lib)) {\n                 continue;\n             }\n             const structs = imp[lib];"}, {"sha": "3dc4f2149b8b91e26b8aad247b8287e1c822b889", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c8a32391c705055f6db2dfd0338562bcac367e44/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/c8a32391c705055f6db2dfd0338562bcac367e44/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=c8a32391c705055f6db2dfd0338562bcac367e44", "patch": "@@ -2412,10 +2412,6 @@ function initSearch(rawSearchIndex) {\n         const searchAfter500ms = () => {\n             searchState.clearInputTimeout();\n             if (searchState.input.value.length === 0) {\n-                if (browserSupportsHistoryApi()) {\n-                    history.replaceState(null, window.currentCrate + \" - Rust\",\n-                        getNakedUrl() + window.location.hash);\n-                }\n                 searchState.hideResults();\n             } else {\n                 searchState.timeout = setTimeout(search, 500);"}, {"sha": "d999f3b36fd8225ad6cc05b0a36996bdf7701fb7", "filename": "src/librustdoc/html/static/js/source-script.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c8a32391c705055f6db2dfd0338562bcac367e44/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/c8a32391c705055f6db2dfd0338562bcac367e44/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js?ref=c8a32391c705055f6db2dfd0338562bcac367e44", "patch": "@@ -52,12 +52,12 @@ function createDirEntry(elem, parent, fullPath, hasFoundFile) {\n     const files = document.createElement(\"div\");\n     files.className = \"files\";\n     if (elem[FILES_OFFSET]) {\n+        const w = window.location.href.split(\"#\")[0];\n         for (const file_text of elem[FILES_OFFSET]) {\n             const file = document.createElement(\"a\");\n             file.innerText = file_text;\n             file.href = rootPath + \"src/\" + fullPath + file_text + \".html\";\n             file.addEventListener(\"click\", closeSidebarIfMobile);\n-            const w = window.location.href.split(\"#\")[0];\n             if (!hasFoundFile && w === file.href) {\n                 file.className = \"selected\";\n                 dirEntry.open = true;"}]}