{"sha": "e304fb43a3533d9ed79be91e217270747ca50edf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMDRmYjQzYTM1MzNkOWVkNzliZTkxZTIxNzI3MDc0N2NhNTBlZGY=", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2016-01-02T22:50:50Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2016-01-11T10:38:36Z"}, "message": "Replace no_elf_tls with target_thread_local", "tree": {"sha": "7301ab8a0ba5a700a216d2dfd2f448e4024a868e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7301ab8a0ba5a700a216d2dfd2f448e4024a868e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e304fb43a3533d9ed79be91e217270747ca50edf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e304fb43a3533d9ed79be91e217270747ca50edf", "html_url": "https://github.com/rust-lang/rust/commit/e304fb43a3533d9ed79be91e217270747ca50edf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e304fb43a3533d9ed79be91e217270747ca50edf/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5446139387fe21928dfbd3145aade01cf26829d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/5446139387fe21928dfbd3145aade01cf26829d4", "html_url": "https://github.com/rust-lang/rust/commit/5446139387fe21928dfbd3145aade01cf26829d4"}], "stats": {"total": 50, "additions": 5, "deletions": 45}, "files": [{"sha": "7542d91ce6d50afdd9edf90c2660544c16a777e8", "filename": "mk/crates.mk", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e304fb43a3533d9ed79be91e217270747ca50edf/mk%2Fcrates.mk", "raw_url": "https://github.com/rust-lang/rust/raw/e304fb43a3533d9ed79be91e217270747ca50edf/mk%2Fcrates.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcrates.mk?ref=e304fb43a3533d9ed79be91e217270747ca50edf", "patch": "@@ -175,9 +175,5 @@ endef\n \n $(foreach crate,$(TOOLS),$(eval $(call RUST_TOOL,$(crate))))\n \n-ifdef CFG_DISABLE_ELF_TLS\n-RUSTFLAGS_std := --cfg no_elf_tls\n-endif\n-\n CRATEFILE_libc := $(SREL)src/liblibc/src/lib.rs\n RUSTFLAGS_libc := --cfg stdbuild"}, {"sha": "51abab6609a86c52997e73b576723a21a4204833", "filename": "src/librustc_back/target/aarch64_unknown_linux_gnu.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibrustc_back%2Ftarget%2Faarch64_unknown_linux_gnu.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibrustc_back%2Ftarget%2Faarch64_unknown_linux_gnu.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Faarch64_unknown_linux_gnu.rs?ref=e304fb43a3533d9ed79be91e217270747ca50edf", "patch": "@@ -11,8 +11,7 @@\n use target::Target;\n \n pub fn target() -> Target {\n-    let mut base = super::linux_base::opts();\n-    base.has_elf_tls = false;\n+    let base = super::linux_base::opts();\n     Target {\n         llvm_target: \"aarch64-unknown-linux-gnu\".to_string(),\n         target_endian: \"little\".to_string(),"}, {"sha": "9791520e9339bbd8ad6908b74e70256abbf83673", "filename": "src/librustc_back/target/android_base.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibrustc_back%2Ftarget%2Fandroid_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibrustc_back%2Ftarget%2Fandroid_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fandroid_base.rs?ref=e304fb43a3533d9ed79be91e217270747ca50edf", "patch": "@@ -17,5 +17,6 @@ pub fn opts() -> TargetOptions {\n     base.pre_link_args.push(\"-Wl,--allow-multiple-definition\".to_string());\n     base.is_like_android = true;\n     base.position_independent_executables = true;\n+    base.has_elf_tls = false;\n     base\n }"}, {"sha": "732f1a353a8bd719c1f363e5fec3c02c9837765d", "filename": "src/librustc_back/target/arm_linux_androideabi.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibrustc_back%2Ftarget%2Farm_linux_androideabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibrustc_back%2Ftarget%2Farm_linux_androideabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Farm_linux_androideabi.rs?ref=e304fb43a3533d9ed79be91e217270747ca50edf", "patch": "@@ -13,7 +13,6 @@ use target::Target;\n pub fn target() -> Target {\n     let mut base = super::android_base::opts();\n     base.features = \"+v7\".to_string();\n-    base.has_elf_tls = false;\n \n     Target {\n         llvm_target: \"arm-linux-androideabi\".to_string(),"}, {"sha": "dc0bc6dfe024559ed6586ac04001950e4b732035", "filename": "src/libstd/thread/scoped_tls.rs", "status": "modified", "additions": 3, "deletions": 38, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibstd%2Fthread%2Fscoped_tls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e304fb43a3533d9ed79be91e217270747ca50edf/src%2Flibstd%2Fthread%2Fscoped_tls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fthread%2Fscoped_tls.rs?ref=e304fb43a3533d9ed79be91e217270747ca50edf", "patch": "@@ -87,32 +87,9 @@ macro_rules! scoped_thread_local {\n            issue = \"0\")]\n #[macro_export]\n #[allow_internal_unstable]\n-#[cfg(no_elf_tls)]\n macro_rules! __scoped_thread_local_inner {\n     ($t:ty) => {{\n-        static _KEY: $crate::thread::__ScopedKeyInner<$t> =\n-            $crate::thread::__ScopedKeyInner::new();\n-        fn _getit() -> &'static $crate::thread::__ScopedKeyInner<$t> { &_KEY }\n-        $crate::thread::ScopedKey::new(_getit)\n-    }}\n-}\n-\n-#[doc(hidden)]\n-#[unstable(feature = \"thread_local_internals\",\n-           reason = \"should not be necessary\",\n-           issue = \"0\")]\n-#[macro_export]\n-#[allow_internal_unstable]\n-#[cfg(not(no_elf_tls))]\n-macro_rules! __scoped_thread_local_inner {\n-    ($t:ty) => {{\n-        #[cfg_attr(not(any(windows,\n-                           target_os = \"android\",\n-                           target_os = \"ios\",\n-                           target_os = \"netbsd\",\n-                           target_os = \"openbsd\",\n-                           target_arch = \"aarch64\")),\n-                   thread_local)]\n+        #[cfg_attr(target_thread_local, thread_local)]\n         static _KEY: $crate::thread::__ScopedKeyInner<$t> =\n             $crate::thread::__ScopedKeyInner::new();\n         fn _getit() -> &'static $crate::thread::__ScopedKeyInner<$t> { &_KEY }\n@@ -221,13 +198,7 @@ impl<T> ScopedKey<T> {\n     }\n }\n \n-#[cfg(not(any(windows,\n-              target_os = \"android\",\n-              target_os = \"ios\",\n-              target_os = \"netbsd\",\n-              target_os = \"openbsd\",\n-              target_arch = \"aarch64\",\n-              no_elf_tls)))]\n+#[cfg(target_thread_local)]\n #[doc(hidden)]\n mod imp {\n     use cell::Cell;\n@@ -246,13 +217,7 @@ mod imp {\n     }\n }\n \n-#[cfg(any(windows,\n-          target_os = \"android\",\n-          target_os = \"ios\",\n-          target_os = \"netbsd\",\n-          target_os = \"openbsd\",\n-          target_arch = \"aarch64\",\n-          no_elf_tls))]\n+#[cfg(not(target_thread_local))]\n #[doc(hidden)]\n mod imp {\n     use cell::Cell;"}]}