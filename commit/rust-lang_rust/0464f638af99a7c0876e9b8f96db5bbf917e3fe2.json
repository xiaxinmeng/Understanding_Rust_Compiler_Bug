{"sha": "0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0NjRmNjM4YWY5OWE3YzA4NzZlOWI4Zjk2ZGI1YmJmOTE3ZTNmZTI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-03-18T11:03:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-03-18T11:03:49Z"}, "message": "Auto merge of #77566 - Marwes:smaller_hashmap, r=Amanieu\n\nfeat: Update hashbrown to instantiate less llvm IR\n\nIncludes https://github.com/rust-lang/hashbrown/pull/204 and https://github.com/rust-lang/hashbrown/pull/205 (not yet merged) which both serve to reduce the amount of IR generated for hashmaps.\n\nInspired by the llvm-lines data gathered in https://github.com/rust-lang/rust/pull/76680 (cc `@Julian-Wollersberger)`", "tree": {"sha": "89a7a6b48e1038e4eba84d806ea1684c15e02412", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/89a7a6b48e1038e4eba84d806ea1684c15e02412"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "html_url": "https://github.com/rust-lang/rust/commit/0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "895a8e71b1a9fc42631f81b071bc855f7fb3e9a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/895a8e71b1a9fc42631f81b071bc855f7fb3e9a4", "html_url": "https://github.com/rust-lang/rust/commit/895a8e71b1a9fc42631f81b071bc855f7fb3e9a4"}, {"sha": "81c9a0201869009e7a443d5bd0a00c5134ba8a41", "url": "https://api.github.com/repos/rust-lang/rust/commits/81c9a0201869009e7a443d5bd0a00c5134ba8a41", "html_url": "https://github.com/rust-lang/rust/commit/81c9a0201869009e7a443d5bd0a00c5134ba8a41"}], "stats": {"total": 61, "additions": 34, "deletions": 27}, "files": [{"sha": "fd6fffe980bc5ade22cd887921e1954b6f99cbec", "filename": "Cargo.lock", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "patch": "@@ -1507,9 +1507,15 @@ dependencies = [\n \n [[package]]\n name = \"hashbrown\"\n-version = \"0.9.0\"\n+version = \"0.9.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"d7afe4a420e3fe79967a00898cc1f4db7c8a49a9333a29f8a4bd76a253d5cd04\"\n+\n+[[package]]\n+name = \"hashbrown\"\n+version = \"0.11.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"00d63df3d41950fb462ed38308eea019113ad1508da725bbedcd0fa5a85ef5f7\"\n+checksum = \"362385356d610bd1e5a408ddf8d022041774b683f345a1d2cfcb4f60f8ae2db5\"\n dependencies = [\n  \"compiler_builtins\",\n  \"rustc-std-workspace-alloc\",\n@@ -1653,7 +1659,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"55e2e4c765aa53a0424761bf9f41aa7a6ac1efa87238f59560640e27fca028f2\"\n dependencies = [\n  \"autocfg\",\n- \"hashbrown\",\n+ \"hashbrown 0.9.1\",\n ]\n \n [[package]]\n@@ -2351,9 +2357,9 @@ dependencies = [\n \n [[package]]\n name = \"once_cell\"\n-version = \"1.4.1\"\n+version = \"1.7.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"260e51e7efe62b592207e9e13a68e43692a7a279171d6ba57abd208bf23645ad\"\n+checksum = \"af8b08b04175473088b46763e51ee54da5f9a164bc162f615b91bc179dbf15a3\"\n \n [[package]]\n name = \"opaque-debug\"\n@@ -4987,7 +4993,7 @@ dependencies = [\n  \"core\",\n  \"dlmalloc\",\n  \"fortanix-sgx-abi\",\n- \"hashbrown\",\n+ \"hashbrown 0.11.0\",\n  \"hermit-abi\",\n  \"libc\",\n  \"miniz_oxide\","}, {"sha": "22ca7ed09b42a92f852367a6855c66921d97d6f2", "filename": "library/std/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/library%2Fstd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/library%2Fstd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2FCargo.toml?ref=0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "patch": "@@ -20,7 +20,7 @@ libc = { version = \"0.2.88\", default-features = false, features = ['rustc-dep-of\n compiler_builtins = { version = \"0.1.39\" }\n profiler_builtins = { path = \"../profiler_builtins\", optional = true }\n unwind = { path = \"../unwind\" }\n-hashbrown = { version = \"0.9.0\", default-features = false, features = ['rustc-dep-of-std'] }\n+hashbrown = { version = \"0.11\", default-features = false, features = ['rustc-dep-of-std'] }\n \n # Dependencies of the `backtrace` crate\n addr2line = { version = \"0.14.0\", optional = true, default-features = false }"}, {"sha": "f0ce13b269c59ae2163971a523ae04ba9088b355", "filename": "src/etc/gdb_providers.py", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/src%2Fetc%2Fgdb_providers.py", "raw_url": "https://github.com/rust-lang/rust/raw/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/src%2Fetc%2Fgdb_providers.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_providers.py?ref=0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "patch": "@@ -349,17 +349,18 @@ def __init__(self, valobj, show_values=True):\n         self.show_values = show_values\n \n         table = self.table()\n-        capacity = int(table[\"bucket_mask\"]) + 1\n-        ctrl = table[\"ctrl\"][\"pointer\"]\n+        table_inner = table[\"table\"]\n+        capacity = int(table_inner[\"bucket_mask\"]) + 1\n+        ctrl = table_inner[\"ctrl\"][\"pointer\"]\n \n-        self.size = int(table[\"items\"])\n+        self.size = int(table_inner[\"items\"])\n         self.pair_type = table.type.template_argument(0).strip_typedefs()\n \n-        self.new_layout = not table.type.has_key(\"data\")\n+        self.new_layout = not table_inner.type.has_key(\"data\")\n         if self.new_layout:\n             self.data_ptr = ctrl.cast(self.pair_type.pointer())\n         else:\n-            self.data_ptr = table[\"data\"][\"pointer\"]\n+            self.data_ptr = table_inner[\"data\"][\"pointer\"]\n \n         self.valid_indices = []\n         for idx in range(capacity):"}, {"sha": "702f2e82e4e2c8a7be3248190043ca119fb4bef0", "filename": "src/etc/lldb_providers.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/src%2Fetc%2Flldb_providers.py", "raw_url": "https://github.com/rust-lang/rust/raw/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/src%2Fetc%2Flldb_providers.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Flldb_providers.py?ref=0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "patch": "@@ -563,7 +563,7 @@ def table(self):\n             # HashSet wraps either std HashMap or hashbrown::HashSet, which both\n             # wrap hashbrown::HashMap, so either way we \"unwrap\" twice.\n             hashbrown_hashmap = self.valobj.GetChildAtIndex(0).GetChildAtIndex(0)\n-        return hashbrown_hashmap.GetChildMemberWithName(\"table\")\n+        return hashbrown_hashmap.GetChildMemberWithName(\"table\").GetChildMemberWithName(\"table\")\n \n     def has_children(self):\n         # type: () -> bool"}, {"sha": "2c05f9d7c12e5c095a2dad6656f85267de9195e3", "filename": "src/etc/natvis/libstd.natvis", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/src%2Fetc%2Fnatvis%2Flibstd.natvis", "raw_url": "https://github.com/rust-lang/rust/raw/0464f638af99a7c0876e9b8f96db5bbf917e3fe2/src%2Fetc%2Fnatvis%2Flibstd.natvis", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fnatvis%2Flibstd.natvis?ref=0464f638af99a7c0876e9b8f96db5bbf917e3fe2", "patch": "@@ -26,22 +26,22 @@\n   -->\n \n   <Type Name=\"std::collections::hash::map::HashMap&lt;*,*,*&gt;\">\n-    <DisplayString>{{ len={base.table.items} }}</DisplayString>\n+    <DisplayString>{{ len={base.table.table.items} }}</DisplayString>\n     <Expand>\n-      <Item Name=\"[len]\">base.table.items</Item>\n-      <Item Name=\"[capacity]\">base.table.items + base.table.growth_left</Item>\n+      <Item Name=\"[len]\">base.table.table.items</Item>\n+      <Item Name=\"[capacity]\">base.table.table.items + base.table.table.growth_left</Item>\n       <Item Name=\"[state]\">base.hash_builder</Item>\n \n       <CustomListItems>\n         <Variable Name=\"i\" InitialValue=\"0\" />\n-        <Variable Name=\"n\" InitialValue=\"base.table.items\" />\n-        <Size>base.table.items</Size>\n+        <Variable Name=\"n\" InitialValue=\"base.table.table.items\" />\n+        <Size>base.table.table.items</Size>\n         <Loop>\n           <Break Condition=\"n == 0\" />\n-          <If Condition=\"(base.table.ctrl.pointer[i] &amp; 0x80) == 0\">\n+          <If Condition=\"(base.table.table.ctrl.pointer[i] &amp; 0x80) == 0\">\n             <!-- Bucket is populated -->\n             <Exec>n--</Exec>\n-            <Item Name=\"{((tuple&lt;$T1, $T2&gt;*)base.table.ctrl.pointer)[-(i + 1)].__0}\">((tuple&lt;$T1, $T2&gt;*)base.table.ctrl.pointer)[-(i + 1)].__1</Item>\n+            <Item Name=\"{((tuple&lt;$T1, $T2&gt;*)base.table.table.ctrl.pointer)[-(i + 1)].__0}\">((tuple&lt;$T1, $T2&gt;*)base.table.table.ctrl.pointer)[-(i + 1)].__1</Item>\n           </If>\n           <Exec>i++</Exec>\n         </Loop>\n@@ -50,22 +50,22 @@\n   </Type>\n \n   <Type Name=\"std::collections::hash::set::HashSet&lt;*,*&gt;\">\n-    <DisplayString>{{ len={base.map.table.items} }}</DisplayString>\n+    <DisplayString>{{ len={base.map.table.table.items} }}</DisplayString>\n     <Expand>\n-      <Item Name=\"[len]\">base.map.table.items</Item>\n-      <Item Name=\"[capacity]\">base.map.table.items + base.map.table.growth_left</Item>\n+      <Item Name=\"[len]\">base.map.table.table.items</Item>\n+      <Item Name=\"[capacity]\">base.map.table.table.items + base.map.table.table.growth_left</Item>\n       <Item Name=\"[state]\">base.map.hash_builder</Item>\n \n       <CustomListItems>\n         <Variable Name=\"i\" InitialValue=\"0\" />\n-        <Variable Name=\"n\" InitialValue=\"base.map.table.items\" />\n-        <Size>base.map.table.items</Size>\n+        <Variable Name=\"n\" InitialValue=\"base.map.table.table.items\" />\n+        <Size>base.map.table.table.items</Size>\n         <Loop>\n           <Break Condition=\"n == 0\" />\n-          <If Condition=\"(base.map.table.ctrl.pointer[i] &amp; 0x80) == 0\">\n+          <If Condition=\"(base.map.table.table.ctrl.pointer[i] &amp; 0x80) == 0\">\n             <!-- Bucket is populated -->\n             <Exec>n--</Exec>\n-            <Item>(($T1*)base.map.table.ctrl.pointer)[-(i + 1)]</Item>\n+            <Item>(($T1*)base.map.table.table.ctrl.pointer)[-(i + 1)]</Item>\n           </If>\n           <Exec>i++</Exec>\n         </Loop>"}]}