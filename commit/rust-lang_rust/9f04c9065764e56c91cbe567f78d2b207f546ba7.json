{"sha": "9f04c9065764e56c91cbe567f78d2b207f546ba7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmMDRjOTA2NTc2NGU1NmM5MWNiZTU2N2Y3OGQyYjIwN2Y1NDZiYTc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-15T22:51:44Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-15T22:51:44Z"}, "message": "Auto merge of #76755 - pietroalbini:gha-macos, r=Mark-Simulacrum\n\nGate macOS on both Azure and GHA\n\nAs discussed in the previous infrastructure team meeting, this PR gates macOS builds on both GHA and Azure. Once this is merged we'll wait a week or two to see if there is a troublesome rate of spurious failures, and if not we'll remove the builds on the Azure side.\n\nr? `@Mark-Simulacrum`\ncc #71988", "tree": {"sha": "7e5b1caa44beb0bf4ec5ab0f3710558b30ee81c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e5b1caa44beb0bf4ec5ab0f3710558b30ee81c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f04c9065764e56c91cbe567f78d2b207f546ba7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f04c9065764e56c91cbe567f78d2b207f546ba7", "html_url": "https://github.com/rust-lang/rust/commit/9f04c9065764e56c91cbe567f78d2b207f546ba7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f04c9065764e56c91cbe567f78d2b207f546ba7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6af1bdda54abc9e919fc1137411dfc4311e05649", "url": "https://api.github.com/repos/rust-lang/rust/commits/6af1bdda54abc9e919fc1137411dfc4311e05649", "html_url": "https://github.com/rust-lang/rust/commit/6af1bdda54abc9e919fc1137411dfc4311e05649"}, {"sha": "9bf1f27f5895295cdbbbb457b957a3e3ec2b7a2e", "url": "https://api.github.com/repos/rust-lang/rust/commits/9bf1f27f5895295cdbbbb457b957a3e3ec2b7a2e", "html_url": "https://github.com/rust-lang/rust/commit/9bf1f27f5895295cdbbbb457b957a3e3ec2b7a2e"}], "stats": {"total": 222, "additions": 135, "deletions": 87}, "files": [{"sha": "50ae8c313d6fcb152fb0e3f600296f23062050a2", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 62, "deletions": 36, "changes": 98, "blob_url": "https://github.com/rust-lang/rust/blob/9f04c9065764e56c91cbe567f78d2b207f546ba7/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/9f04c9065764e56c91cbe567f78d2b207f546ba7/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=9f04c9065764e56c91cbe567f78d2b207f546ba7", "patch": "@@ -76,7 +76,7 @@ jobs:\n         uses: rust-lang/simpleinfra/github-actions/cancel-outdated-builds@master\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n-        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try' && !env.RUST_CI_TEMP_SKIP_CANCEL_OUTDATED\"\n+        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n       - name: collect CPU statistics\n         run: src/ci/scripts/collect-cpu-stats.sh\n         if: success() && !env.SKIP_JOB\n@@ -180,7 +180,7 @@ jobs:\n         uses: rust-lang/simpleinfra/github-actions/cancel-outdated-builds@master\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n-        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try' && !env.RUST_CI_TEMP_SKIP_CANCEL_OUTDATED\"\n+        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n       - name: collect CPU statistics\n         run: src/ci/scripts/collect-cpu-stats.sh\n         if: success() && !env.SKIP_JOB\n@@ -375,6 +375,64 @@ jobs:\n             env:\n               DEPLOY_TOOLSTATES_JSON: toolstates-linux.json\n             os: ubuntu-latest-xl\n+          - name: dist-x86_64-apple\n+            env:\n+              SCRIPT: \"./x.py dist\"\n+              RUST_CONFIGURE_ARGS: \"--host=x86_64-apple-darwin --target=aarch64-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+              DIST_REQUIRE_ALL_TOOLS: 1\n+            os: macos-latest\n+          - name: dist-x86_64-apple-alt\n+            env:\n+              SCRIPT: \"./x.py dist\"\n+              RUST_CONFIGURE_ARGS: \"--enable-extended --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            os: macos-latest\n+          - name: x86_64-apple\n+            env:\n+              SCRIPT: \"./x.py --stage 2 test\"\n+              RUST_CONFIGURE_ARGS: \"--build=x86_64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.8\n+              MACOSX_STD_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            os: macos-latest\n+          - name: dist-x86_64-apple\n+            env:\n+              SCRIPT: \"./x.py dist\"\n+              RUST_CONFIGURE_ARGS: \"--host=x86_64-apple-darwin --target=aarch64-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+              DIST_REQUIRE_ALL_TOOLS: 1\n+            os: macos-latest\n+          - name: dist-x86_64-apple-alt\n+            env:\n+              SCRIPT: \"./x.py dist\"\n+              RUST_CONFIGURE_ARGS: \"--enable-extended --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            os: macos-latest\n+          - name: x86_64-apple\n+            env:\n+              SCRIPT: \"./x.py --stage 2 test\"\n+              RUST_CONFIGURE_ARGS: \"--build=x86_64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.8\n+              MACOSX_STD_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            os: macos-latest\n           - name: x86_64-msvc-1\n             env:\n               RUST_CONFIGURE_ARGS: \"--build=x86_64-pc-windows-msvc --enable-profiler\"\n@@ -499,7 +557,7 @@ jobs:\n         uses: rust-lang/simpleinfra/github-actions/cancel-outdated-builds@master\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n-        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try' && !env.RUST_CI_TEMP_SKIP_CANCEL_OUTDATED\"\n+        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n       - name: collect CPU statistics\n         run: src/ci/scripts/collect-cpu-stats.sh\n         if: success() && !env.SKIP_JOB\n@@ -580,38 +638,6 @@ jobs:\n               - self-hosted\n               - ARM64\n               - linux\n-          - name: dist-x86_64-apple\n-            env:\n-              SCRIPT: \"./x.py dist\"\n-              RUST_CONFIGURE_ARGS: \"--host=x86_64-apple-darwin --target=aarch64-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n-              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-              MACOSX_DEPLOYMENT_TARGET: 10.7\n-              NO_LLVM_ASSERTIONS: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-              DIST_REQUIRE_ALL_TOOLS: 1\n-              RUST_CI_TEMP_SKIP_CANCEL_OUTDATED: 1\n-            os: macos-latest\n-          - name: dist-x86_64-apple-alt\n-            env:\n-              SCRIPT: \"./x.py dist\"\n-              RUST_CONFIGURE_ARGS: \"--enable-extended --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n-              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-              MACOSX_DEPLOYMENT_TARGET: 10.7\n-              NO_LLVM_ASSERTIONS: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-              RUST_CI_TEMP_SKIP_CANCEL_OUTDATED: 1\n-            os: macos-latest\n-          - name: x86_64-apple\n-            env:\n-              SCRIPT: \"./x.py --stage 2 test\"\n-              RUST_CONFIGURE_ARGS: \"--build=x86_64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n-              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-              MACOSX_DEPLOYMENT_TARGET: 10.8\n-              MACOSX_STD_DEPLOYMENT_TARGET: 10.7\n-              NO_LLVM_ASSERTIONS: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-              RUST_CI_TEMP_SKIP_CANCEL_OUTDATED: 1\n-            os: macos-latest\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n     steps:\n@@ -638,7 +664,7 @@ jobs:\n         uses: rust-lang/simpleinfra/github-actions/cancel-outdated-builds@master\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n-        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try' && !env.RUST_CI_TEMP_SKIP_CANCEL_OUTDATED\"\n+        if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n       - name: collect CPU statistics\n         run: src/ci/scripts/collect-cpu-stats.sh\n         if: success() && !env.SKIP_JOB"}, {"sha": "f8d3bc8e8e5881be92e5346c6a682cfe260db10e", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 73, "deletions": 51, "changes": 124, "blob_url": "https://github.com/rust-lang/rust/blob/9f04c9065764e56c91cbe567f78d2b207f546ba7/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/9f04c9065764e56c91cbe567f78d2b207f546ba7/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=9f04c9065764e56c91cbe567f78d2b207f546ba7", "patch": "@@ -130,9 +130,7 @@ x--expand-yaml-anchors--remove:\n         uses: rust-lang/simpleinfra/github-actions/cancel-outdated-builds@master\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n-        # TODO: remove the condition on RUST_CI_TEMP_SKIP_CANCEL_OUTDATED once\n-        # we remove the `auto-fallible` job.\n-        if: success() && !env.SKIP_JOB && github.ref != 'refs/heads/try' && !env.RUST_CI_TEMP_SKIP_CANCEL_OUTDATED\n+        if: success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\n         <<: *step\n \n       - name: collect CPU statistics\n@@ -434,6 +432,78 @@ jobs:\n               DEPLOY_TOOLSTATES_JSON: toolstates-linux.json\n             <<: *job-linux-xl\n \n+          ####################\n+          #  macOS Builders  #\n+          ####################\n+\n+          - name: dist-x86_64-apple\n+            env:\n+              SCRIPT: ./x.py dist\n+              RUST_CONFIGURE_ARGS: --host=x86_64-apple-darwin --target=aarch64-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+              DIST_REQUIRE_ALL_TOOLS: 1\n+            <<: *job-macos-xl\n+\n+          - name: dist-x86_64-apple-alt\n+            env:\n+              SCRIPT: ./x.py dist\n+              RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            <<: *job-macos-xl\n+\n+          - name: x86_64-apple\n+            env:\n+              SCRIPT: ./x.py --stage 2 test\n+              RUST_CONFIGURE_ARGS: --build=x86_64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.8\n+              MACOSX_STD_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            <<: *job-macos-xl\n+\n+          ####################\n+          #  macOS Builders  #\n+          ####################\n+\n+          - name: dist-x86_64-apple\n+            env:\n+              SCRIPT: ./x.py dist\n+              RUST_CONFIGURE_ARGS: --host=x86_64-apple-darwin --target=aarch64-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+              DIST_REQUIRE_ALL_TOOLS: 1\n+            <<: *job-macos-xl\n+\n+          - name: dist-x86_64-apple-alt\n+            env:\n+              SCRIPT: ./x.py dist\n+              RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            <<: *job-macos-xl\n+\n+          - name: x86_64-apple\n+            env:\n+              SCRIPT: ./x.py --stage 2 test\n+              RUST_CONFIGURE_ARGS: --build=x86_64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.8\n+              MACOSX_STD_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+            <<: *job-macos-xl\n+\n           ######################\n           #  Windows Builders  #\n           ######################\n@@ -600,54 +670,6 @@ jobs:\n           - name: aarch64-gnu\n             <<: *job-aarch64-linux\n \n-          ####################\n-          #  macOS Builders  #\n-          ####################\n-\n-          - name: dist-x86_64-apple\n-            env:\n-              SCRIPT: ./x.py dist\n-              RUST_CONFIGURE_ARGS: --host=x86_64-apple-darwin --target=aarch64-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n-              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-              MACOSX_DEPLOYMENT_TARGET: 10.7\n-              NO_LLVM_ASSERTIONS: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-              DIST_REQUIRE_ALL_TOOLS: 1\n-\n-              # TODO: remove once we move this job away from auto-fallible.\n-              # Also, remove the variable from the cancel-outdated-builds step\n-              RUST_CI_TEMP_SKIP_CANCEL_OUTDATED: 1\n-            <<: *job-macos-xl\n-\n-          - name: dist-x86_64-apple-alt\n-            env:\n-              SCRIPT: ./x.py dist\n-              RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n-              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-              MACOSX_DEPLOYMENT_TARGET: 10.7\n-              NO_LLVM_ASSERTIONS: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-\n-              # TODO: remove once we move this job away from auto-fallible.\n-              # Also, remove the variable from the cancel-outdated-builds step\n-              RUST_CI_TEMP_SKIP_CANCEL_OUTDATED: 1\n-            <<: *job-macos-xl\n-\n-          - name: x86_64-apple\n-            env:\n-              SCRIPT: ./x.py --stage 2 test\n-              RUST_CONFIGURE_ARGS: --build=x86_64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n-              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-              MACOSX_DEPLOYMENT_TARGET: 10.8\n-              MACOSX_STD_DEPLOYMENT_TARGET: 10.7\n-              NO_LLVM_ASSERTIONS: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-\n-              # TODO: remove once we move this job away from auto-fallible.\n-              # Also, remove the variable from the cancel-outdated-builds step\n-              RUST_CI_TEMP_SKIP_CANCEL_OUTDATED: 1\n-            <<: *job-macos-xl\n-\n   master:\n     name: master\n     runs-on: ubuntu-latest"}]}