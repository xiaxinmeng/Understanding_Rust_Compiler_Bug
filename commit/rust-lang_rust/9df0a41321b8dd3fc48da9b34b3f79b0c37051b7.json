{"sha": "9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkZjBhNDEzMjFiOGRkM2ZjNDhkYTliMzRiM2Y3OWIwYzM3MDUxYjc=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2018-05-28T18:30:02Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2018-05-30T17:03:31Z"}, "message": "Add polonius compare mode", "tree": {"sha": "56a1a5bd485370000fc0be0571b47fa6d1208e18", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/56a1a5bd485370000fc0be0571b47fa6d1208e18"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmNHc6jmXzkUyxd4xiMlBzaHUZDIFAlsO2WMACgkQiMlBzaHU\nZDJTkxAAjw9u8t4EoaozGg2VS4Z5PZyOxrUOFlrWZakRkfLI5sR7TUP5/MbzJc0F\nVHYmu24EAcxkQHq+VkgNToWBx9SctihmhzpTqn5QRofaSiif3yzklD93PjRfku20\nbAdAhSUef7GvfklGT0QibL/fSo3l6jKrKUwh4CoB+O6l9yhh0xmFUjARVw86LH3f\nCdHUH6jRAxxCTZcFw440In1c5kIbugukgU5vgHYQR5O6BdNYq/C4SJbmb2KtA5z7\nnbihiSSgOeq++zwUELC+wbOVYPwk/BRUc90uaJBsR1ytdRTHATbxwome1msRJXp2\nu+ITujCSMLYFtRSMM7E7FVeULpFEwAOebWE8h7VKDi/cY6nC/Ga71oMAHb9qrXp/\nQmUL7FFhushEcPkt2LtwexfIc2b9JTQrH7KbBwJN9a5+9BBKUNohyp4w8Yy+rBxn\nPrcbxjGPA+fqEGh6SVW9+pCTU/ATqXOR9JoJIeJUIN9Okcj1Ukf0NZACZ3PwpPGf\nQdqLRpbPlnO6nK2XbpnyyZVI79A60e85RhE7P1dbij1bTHRIGaNoFA4nKiigNeAc\nO4fMpXY4cwjW/9CjYOCQr8vk1UvO1OUr0FVVu91ma1Hu5CEs5uckroG2dlEJGYlZ\nIWAiOjaRhGTtVYTwFuvfPn3C97Kc13bE+L8iXme2JF/0CaaVE2U=\n=u+AS\n-----END PGP SIGNATURE-----", "payload": "tree 56a1a5bd485370000fc0be0571b47fa6d1208e18\nparent 74d09399c1289a20b1c258153f005f2604f9ec46\nauthor Santiago Pastorino <spastorino@gmail.com> 1527532202 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1527699811 -0300\n\nAdd polonius compare mode\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "html_url": "https://github.com/rust-lang/rust/commit/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "74d09399c1289a20b1c258153f005f2604f9ec46", "url": "https://api.github.com/repos/rust-lang/rust/commits/74d09399c1289a20b1c258153f005f2604f9ec46", "html_url": "https://github.com/rust-lang/rust/commit/74d09399c1289a20b1c258153f005f2604f9ec46"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "951a72fec6891209c5b7988aef31c8d63305a318", "filename": "src/tools/compiletest/src/common.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs?ref=9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "patch": "@@ -99,18 +99,21 @@ impl fmt::Display for Mode {\n #[derive(Clone, PartialEq)]\n pub enum CompareMode {\n     Nll,\n+    Polonius,\n }\n \n impl CompareMode {\n     pub(crate) fn to_str(&self) -> &'static str {\n         match *self {\n             CompareMode::Nll => \"nll\",\n+            CompareMode::Polonius => \"polonius\",\n         }\n     }\n \n     pub fn parse(s: String) -> CompareMode {\n         match s.as_str() {\n             \"nll\" => CompareMode::Nll,\n+            \"polonius\" => CompareMode::Polonius,\n             x => panic!(\"unknown --compare-mode option: {}\", x),\n         }\n     }"}, {"sha": "f1e0c2bea0e4043196b79b0211bbd3cd908e7e42", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "patch": "@@ -1729,6 +1729,9 @@ impl<'test> TestCx<'test> {\n             Some(CompareMode::Nll) => {\n                 rustc.args(&[\"-Zborrowck=mir\", \"-Ztwo-phase-borrows\"]);\n             }\n+            Some(CompareMode::Polonius) => {\n+                rustc.args(&[\"-Zpolonius\", \"-Zborrowck=mir\", \"-Ztwo-phase-borrows\"]);\n+            }\n             None => {}\n         }\n \n@@ -2898,8 +2901,14 @@ impl<'test> TestCx<'test> {\n             &self.config.compare_mode,\n             kind,\n         );\n-        if !path.exists() && self.config.compare_mode.is_some() {\n-            // fallback!\n+\n+        if !path.exists() {\n+            if let Some(CompareMode::Polonius) = self.config.compare_mode {\n+                path = expected_output_path(&self.testpaths, self.revision, &Some(CompareMode::Nll), kind);\n+            }\n+        }\n+\n+        if !path.exists() {\n             path = expected_output_path(&self.testpaths, self.revision, &None, kind);\n         }\n "}]}