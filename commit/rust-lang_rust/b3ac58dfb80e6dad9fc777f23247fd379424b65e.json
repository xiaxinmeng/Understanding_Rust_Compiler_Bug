{"sha": "b3ac58dfb80e6dad9fc777f23247fd379424b65e", "node_id": "C_kwDOAAsO6NoAKGIzYWM1OGRmYjgwZTZkYWQ5ZmM3NzdmMjMyNDdmZDM3OTQyNGI2NWU", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-08-09T16:08:05Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-08-09T16:08:05Z"}, "message": "Add some more `cov_mark`s", "tree": {"sha": "dbbe5108cff435d141cd3b7cca9eea69c4c07333", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dbbe5108cff435d141cd3b7cca9eea69c4c07333"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3ac58dfb80e6dad9fc777f23247fd379424b65e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3ac58dfb80e6dad9fc777f23247fd379424b65e", "html_url": "https://github.com/rust-lang/rust/commit/b3ac58dfb80e6dad9fc777f23247fd379424b65e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3ac58dfb80e6dad9fc777f23247fd379424b65e/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c9359b072098403eb0b37a1b0822bb7b4f3b8ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c9359b072098403eb0b37a1b0822bb7b4f3b8ba", "html_url": "https://github.com/rust-lang/rust/commit/8c9359b072098403eb0b37a1b0822bb7b4f3b8ba"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "4d66af9e8d5b8b0933b785d685d55114caf91bfe", "filename": "crates/ide-completion/src/completions/expr.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b3ac58dfb80e6dad9fc777f23247fd379424b65e/crates%2Fide-completion%2Fsrc%2Fcompletions%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3ac58dfb80e6dad9fc777f23247fd379424b65e/crates%2Fide-completion%2Fsrc%2Fcompletions%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Fcompletions%2Fexpr.rs?ref=b3ac58dfb80e6dad9fc777f23247fd379424b65e", "patch": "@@ -231,7 +231,9 @@ pub(crate) fn complete_expr_path(\n                             cov_mark::hit!(functional_update);\n                             let missing_fields =\n                                 ctx.sema.record_literal_missing_fields(record_expr);\n-                            add_default_update(acc, ctx, ty, &missing_fields);\n+                            if !missing_fields.is_empty() {\n+                                add_default_update(acc, ctx, ty);\n+                            }\n                         }\n                     };\n                 }"}, {"sha": "bfb98b9f2777fbfecaba4208c7be17a3ff7a4008", "filename": "crates/ide-completion/src/completions/record.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b3ac58dfb80e6dad9fc777f23247fd379424b65e/crates%2Fide-completion%2Fsrc%2Fcompletions%2Frecord.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3ac58dfb80e6dad9fc777f23247fd379424b65e/crates%2Fide-completion%2Fsrc%2Fcompletions%2Frecord.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Fcompletions%2Frecord.rs?ref=b3ac58dfb80e6dad9fc777f23247fd379424b65e", "patch": "@@ -59,7 +59,11 @@ pub(crate) fn complete_record_expr_fields(\n         }\n         _ => {\n             let missing_fields = ctx.sema.record_literal_missing_fields(record_expr);\n-            add_default_update(acc, ctx, ty, &missing_fields);\n+\n+            if !missing_fields.is_empty() {\n+                cov_mark::hit!(functional_update_field);\n+                add_default_update(acc, ctx, ty);\n+            }\n             if dot_prefix {\n                 cov_mark::hit!(functional_update_one_dot);\n                 let mut item =\n@@ -78,14 +82,14 @@ pub(crate) fn add_default_update(\n     acc: &mut Completions,\n     ctx: &CompletionContext<'_>,\n     ty: Option<hir::TypeInfo>,\n-    missing_fields: &[(hir::Field, hir::Type)],\n ) {\n     let default_trait = ctx.famous_defs().core_default_Default();\n-    let impl_default_trait = default_trait\n+    let impls_default_trait = default_trait\n         .zip(ty.as_ref())\n         .map_or(false, |(default_trait, ty)| ty.original.impls_trait(ctx.db, default_trait, &[]));\n-    if impl_default_trait && !missing_fields.is_empty() {\n+    if impls_default_trait {\n         // FIXME: This should make use of scope_def like completions so we get all the other goodies\n+        // that is we should handle this like actually completing the default function\n         let completion_text = \"..Default::default()\";\n         let mut item = CompletionItem::new(SymbolKind::Field, ctx.source_range(), completion_text);\n         let completion_text ="}, {"sha": "328faaa060f04a6825a658a418f111f2cd9c8858", "filename": "crates/ide-completion/src/tests/record.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b3ac58dfb80e6dad9fc777f23247fd379424b65e/crates%2Fide-completion%2Fsrc%2Ftests%2Frecord.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3ac58dfb80e6dad9fc777f23247fd379424b65e/crates%2Fide-completion%2Fsrc%2Ftests%2Frecord.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Frecord.rs?ref=b3ac58dfb80e6dad9fc777f23247fd379424b65e", "patch": "@@ -156,6 +156,7 @@ fn main() {\n \n #[test]\n fn functional_update_no_dot() {\n+    cov_mark::check!(functional_update_field);\n     // FIXME: This should filter out all completions that do not have the type `Foo`\n     check(\n         r#\""}]}