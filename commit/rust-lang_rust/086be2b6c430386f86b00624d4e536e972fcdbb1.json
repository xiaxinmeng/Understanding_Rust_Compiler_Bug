{"sha": "086be2b6c430386f86b00624d4e536e972fcdbb1", "node_id": "C_kwDOAAsO6NoAKDA4NmJlMmI2YzQzMDM4NmY4NmIwMDYyNGQ0ZTUzNmU5NzJmY2RiYjE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-01-25T22:06:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-25T22:06:04Z"}, "message": "Rollup merge of #93303 - compiler-errors:issue-93282, r=wesleywiser\n\nFix ICE when parsing bad turbofish with lifetime argument\n\nGeneralize conditions where we suggest adding the turbofish operator, so we don't ICE during code like\n\n```rust\nfn foo() {\n  A<'a,>\n}\n```\n\nbut instead suggest adding a turbofish.\n\nFixes #93282", "tree": {"sha": "ff1327687a5b2cfaf76fd3a7990072a9fb6c8365", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ff1327687a5b2cfaf76fd3a7990072a9fb6c8365"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/086be2b6c430386f86b00624d4e536e972fcdbb1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh8HRNCRBK7hj4Ov3rIwAAJjQIAC4DsYANKI49AoH7ptO6OtZR\npdfgA1QAgixYM+OD+WgdF49JVMMLqGR5zlhdMFQBx38Z9a9wUdqmre8T3m92Zfwj\nLxZa6MoZOmjtAAQCiZWndLCHOd/9mKykFiYedzWX4v6w6Lm5n3TkkvfjhQ7K9sQw\nbrF3NhMVOnhz5G8Rrs1FFzrXfOSoa+3JM5fytbJdmdiJB3CL/IA6LSsmI9hBfbcj\n2rwm7bUdVwehCsXvOwwIFpZ7pXZLwljd3Svp+kEvSdjDy+TGonqkPictmfnZKDpj\nSKFaBYRgEpetXfe9KgZI40OpNmQS2e4bLmTI/2+VzoFUwssSfBfysOeDosZ0PSo=\n=4Wlo\n-----END PGP SIGNATURE-----\n", "payload": "tree ff1327687a5b2cfaf76fd3a7990072a9fb6c8365\nparent 04f915b33258c98fe8a5061369a7d924e3d2328a\nparent 37bed05986db600d6d8028af981632138dd7c7b2\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1643148364 +0100\ncommitter GitHub <noreply@github.com> 1643148364 +0100\n\nRollup merge of #93303 - compiler-errors:issue-93282, r=wesleywiser\n\nFix ICE when parsing bad turbofish with lifetime argument\n\nGeneralize conditions where we suggest adding the turbofish operator, so we don't ICE during code like\n\n```rust\nfn foo() {\n  A<'a,>\n}\n```\n\nbut instead suggest adding a turbofish.\n\nFixes #93282\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/086be2b6c430386f86b00624d4e536e972fcdbb1", "html_url": "https://github.com/rust-lang/rust/commit/086be2b6c430386f86b00624d4e536e972fcdbb1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/086be2b6c430386f86b00624d4e536e972fcdbb1/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04f915b33258c98fe8a5061369a7d924e3d2328a", "url": "https://api.github.com/repos/rust-lang/rust/commits/04f915b33258c98fe8a5061369a7d924e3d2328a", "html_url": "https://github.com/rust-lang/rust/commit/04f915b33258c98fe8a5061369a7d924e3d2328a"}, {"sha": "37bed05986db600d6d8028af981632138dd7c7b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/37bed05986db600d6d8028af981632138dd7c7b2", "html_url": "https://github.com/rust-lang/rust/commit/37bed05986db600d6d8028af981632138dd7c7b2"}], "stats": {"total": 49, "additions": 30, "deletions": 19}, "files": [{"sha": "17bac362ec81ff75bc7c51346bd3def318897a63", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 12, "deletions": 18, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/086be2b6c430386f86b00624d4e536e972fcdbb1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/086be2b6c430386f86b00624d4e536e972fcdbb1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=086be2b6c430386f86b00624d4e536e972fcdbb1", "patch": "@@ -731,28 +731,22 @@ impl<'a> Parser<'a> {\n                     match x {\n                         Ok((_, _, false)) => {\n                             if self.eat(&token::Gt) {\n-                                let turbo_err = e.span_suggestion_verbose(\n+                                e.span_suggestion_verbose(\n                                     binop.span.shrink_to_lo(),\n                                     TURBOFISH_SUGGESTION_STR,\n                                     \"::\".to_string(),\n                                     Applicability::MaybeIncorrect,\n-                                );\n-                                if self.check(&TokenKind::Semi) {\n-                                    turbo_err.emit();\n-                                    *expr = self.mk_expr_err(expr.span);\n-                                    return Ok(());\n-                                } else {\n-                                    match self.parse_expr() {\n-                                        Ok(_) => {\n-                                            turbo_err.emit();\n-                                            *expr = self\n-                                                .mk_expr_err(expr.span.to(self.prev_token.span));\n-                                            return Ok(());\n-                                        }\n-                                        Err(mut err) => {\n-                                            turbo_err.cancel();\n-                                            err.cancel();\n-                                        }\n+                                )\n+                                .emit();\n+                                match self.parse_expr() {\n+                                    Ok(_) => {\n+                                        *expr =\n+                                            self.mk_expr_err(expr.span.to(self.prev_token.span));\n+                                        return Ok(());\n+                                    }\n+                                    Err(mut err) => {\n+                                        *expr = self.mk_expr_err(expr.span);\n+                                        err.cancel();\n                                     }\n                                 }\n                             }"}, {"sha": "693dd0051dad1f0a2feca51c91bed786dfb53bfe", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/086be2b6c430386f86b00624d4e536e972fcdbb1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/086be2b6c430386f86b00624d4e536e972fcdbb1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=086be2b6c430386f86b00624d4e536e972fcdbb1", "patch": "@@ -1458,7 +1458,7 @@ impl<'a> Parser<'a> {\n             self.parse_block_expr(label, lo, BlockCheckMode::Default, attrs)\n         } else if !ate_colon && (self.check(&TokenKind::Comma) || self.check(&TokenKind::Gt)) {\n             // We're probably inside of a `Path<'a>` that needs a turbofish, so suppress the\n-            // \"must be followed by a colon\" error.\n+            // \"must be followed by a colon\" error, and the \"expected one of\" error.\n             self.diagnostic().delay_span_bug(lo, \"this label wasn't parsed correctly\");\n             consume_colon = false;\n             Ok(self.mk_expr_err(lo))"}, {"sha": "7be8b25363e09e750e294c98fe61bc5b40e0c364", "filename": "src/test/ui/parser/issues/issue-93282.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/086be2b6c430386f86b00624d4e536e972fcdbb1/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.rs", "raw_url": "https://github.com/rust-lang/rust/raw/086be2b6c430386f86b00624d4e536e972fcdbb1/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.rs?ref=086be2b6c430386f86b00624d4e536e972fcdbb1", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    f<'a,>\n+    //~^ ERROR expected\n+}"}, {"sha": "20e6c3ed8a8d5d7a45e053c8717a1d46040ff76a", "filename": "src/test/ui/parser/issues/issue-93282.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/086be2b6c430386f86b00624d4e536e972fcdbb1/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/086be2b6c430386f86b00624d4e536e972fcdbb1/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.stderr?ref=086be2b6c430386f86b00624d4e536e972fcdbb1", "patch": "@@ -0,0 +1,13 @@\n+error: expected one of `.`, `:`, `;`, `?`, `for`, `loop`, `while`, `{`, `}`, or an operator, found `,`\n+  --> $DIR/issue-93282.rs:2:9\n+   |\n+LL |     f<'a,>\n+   |         ^ expected one of 10 possible tokens\n+   |\n+help: use `::<...>` instead of `<...>` to specify lifetime, type, or const arguments\n+   |\n+LL |     f::<'a,>\n+   |      ++\n+\n+error: aborting due to previous error\n+"}]}