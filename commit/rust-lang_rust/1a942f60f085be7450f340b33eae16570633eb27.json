{"sha": "1a942f60f085be7450f340b33eae16570633eb27", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhOTQyZjYwZjA4NWJlNzQ1MGYzNDBiMzNlYWUxNjU3MDYzM2ViMjc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-06-15T00:11:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-06-15T00:11:05Z"}, "message": "Auto merge of #34245 - ollie27:rustdoc_redirect_rename, r=alexcrichton\n\nrustdoc: Fix redirect pages for renamed reexports\n\nWe need to use the name of the target not the name of the current item\nwhen creating the link.\n\nAn example in `std` is [`std::sys::ext`](https://doc.rust-lang.org/nightly/std/sys/ext/index.html).", "tree": {"sha": "d53534222a926991387bceab02e491df4443f743", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d53534222a926991387bceab02e491df4443f743"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a942f60f085be7450f340b33eae16570633eb27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a942f60f085be7450f340b33eae16570633eb27", "html_url": "https://github.com/rust-lang/rust/commit/1a942f60f085be7450f340b33eae16570633eb27", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a942f60f085be7450f340b33eae16570633eb27/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b4511755cfe63a46f2db8c72145e07f94911c08", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b4511755cfe63a46f2db8c72145e07f94911c08", "html_url": "https://github.com/rust-lang/rust/commit/6b4511755cfe63a46f2db8c72145e07f94911c08"}, {"sha": "0c742d263cd5da7b82ef63ced70622f9ee8ebb88", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c742d263cd5da7b82ef63ced70622f9ee8ebb88", "html_url": "https://github.com/rust-lang/rust/commit/0c742d263cd5da7b82ef63ced70622f9ee8ebb88"}], "stats": {"total": 54, "additions": 42, "deletions": 12}, "files": [{"sha": "f7cc45a93b297dc465395bc02a7b6e3247639732", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 10, "deletions": 12, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/1a942f60f085be7450f340b33eae16570633eb27/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a942f60f085be7450f340b33eae16570633eb27/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=1a942f60f085be7450f340b33eae16570633eb27", "patch": "@@ -1343,12 +1343,12 @@ impl Context {\n             } else {\n                 let mut url = repeat(\"../\").take(cx.current.len())\n                                            .collect::<String>();\n-                if let Some(&(ref names, _)) = cache().paths.get(&it.def_id) {\n+                if let Some(&(ref names, ty)) = cache().paths.get(&it.def_id) {\n                     for name in &names[..names.len() - 1] {\n                         url.push_str(name);\n                         url.push_str(\"/\");\n                     }\n-                    url.push_str(&item_path(it));\n+                    url.push_str(&item_path(ty, names.last().unwrap()));\n                     layout::redirect(writer, &url)?;\n                 }\n             }\n@@ -1409,7 +1409,8 @@ impl Context {\n             render(&mut buf, self, &item, true).unwrap();\n             // buf will be empty if the item is stripped and there is no redirect for it\n             if !buf.is_empty() {\n-                let joint_dst = self.dst.join(&item_path(&item));\n+                let joint_dst = self.dst.join(&item_path(shortty(&item),\n+                                                         item.name.as_ref().unwrap()));\n                 try_err!(fs::create_dir_all(&self.dst), &self.dst);\n                 let mut dst = try_err!(File::create(&joint_dst), &joint_dst);\n                 try_err!(dst.write_all(&buf), &joint_dst);\n@@ -1531,7 +1532,7 @@ impl<'a> Item<'a> {\n             Some(format!(\"{root}{path}/{file}?gotosrc={goto}\",\n                          root = root,\n                          path = path[..path.len() - 1].join(\"/\"),\n-                         file = item_path(self.item),\n+                         file = item_path(shortty(self.item), self.item.name.as_ref().unwrap()),\n                          goto = self.item.def_id.index.as_usize()))\n         }\n     }\n@@ -1623,13 +1624,10 @@ impl<'a> fmt::Display for Item<'a> {\n     }\n }\n \n-fn item_path(item: &clean::Item) -> String {\n-    if item.is_mod() {\n-        format!(\"{}/index.html\", item.name.as_ref().unwrap())\n-    } else {\n-        format!(\"{}.{}.html\",\n-                shortty(item).to_static_str(),\n-                *item.name.as_ref().unwrap())\n+fn item_path(ty: ItemType, name: &str) -> String {\n+    match ty {\n+        ItemType::Module => format!(\"{}/index.html\", name),\n+        _ => format!(\"{}.{}.html\", ty.to_static_str(), name),\n     }\n }\n \n@@ -1821,7 +1819,7 @@ fn item_module(w: &mut fmt::Formatter, cx: &Context,\n                        docs = shorter(Some(&Markdown(doc_value).to_string())),\n                        class = shortty(myitem),\n                        stab = myitem.stability_class(),\n-                       href = item_path(myitem),\n+                       href = item_path(shortty(myitem), myitem.name.as_ref().unwrap()),\n                        title = full_path(cx, myitem))?;\n             }\n         }"}, {"sha": "b7c702dcc1fc599956f69cf543aa51ca2c9245b2", "filename": "src/test/rustdoc/redirect-rename.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/1a942f60f085be7450f340b33eae16570633eb27/src%2Ftest%2Frustdoc%2Fredirect-rename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a942f60f085be7450f340b33eae16570633eb27/src%2Ftest%2Frustdoc%2Fredirect-rename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fredirect-rename.rs?ref=1a942f60f085be7450f340b33eae16570633eb27", "patch": "@@ -0,0 +1,32 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_name = \"foo\"]\n+\n+mod hidden {\n+    // @has foo/hidden/struct.Foo.html\n+    // @has - '//p/a' '../../foo/struct.FooBar.html'\n+    pub struct Foo {}\n+\n+    // @has foo/hidden/bar/index.html\n+    // @has - '//p/a' '../../foo/baz/index.html'\n+    pub mod bar {\n+        // @has foo/hidden/bar/struct.Thing.html\n+        // @has - '//p/a' '../../foo/baz/struct.Thing.html'\n+        pub struct Thing {}\n+    }\n+}\n+\n+// @has foo/struct.FooBar.html\n+pub use hidden::Foo as FooBar;\n+\n+// @has foo/baz/index.html\n+// @has foo/baz/struct.Thing.html\n+pub use hidden::bar as baz;"}]}