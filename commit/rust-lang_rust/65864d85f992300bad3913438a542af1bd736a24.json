{"sha": "65864d85f992300bad3913438a542af1bd736a24", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1ODY0ZDg1Zjk5MjMwMGJhZDM5MTM0MzhhNTQyYWYxYmQ3MzZhMjQ=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-19T18:47:56Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-30T20:23:50Z"}, "message": "Rename FnScopes -> ExprScopes\n\nThe reason for this is that it describes scopes for any body expression, not\njust that of a function. It did not actually refer to functions at all anymore.", "tree": {"sha": "c2030da2bcd55fc1033a2c0602b7a9349c2dd702", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2030da2bcd55fc1033a2c0602b7a9349c2dd702"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/65864d85f992300bad3913438a542af1bd736a24", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/65864d85f992300bad3913438a542af1bd736a24", "html_url": "https://github.com/rust-lang/rust/commit/65864d85f992300bad3913438a542af1bd736a24", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/65864d85f992300bad3913438a542af1bd736a24/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c65e6cdcb3d603ce7c0943785f7140662022c54a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c65e6cdcb3d603ce7c0943785f7140662022c54a", "html_url": "https://github.com/rust-lang/rust/commit/c65e6cdcb3d603ce7c0943785f7140662022c54a"}], "stats": {"total": 52, "additions": 26, "deletions": 26}, "files": [{"sha": "9405aa8ad63b0123c2a6a46802bca64eafd80c82", "filename": "crates/ra_hir/src/code_model_api.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -396,7 +396,7 @@ pub struct Function {\n     pub(crate) id: FunctionId,\n }\n \n-pub use crate::code_model_impl::function::ScopeEntryWithSyntax;\n+pub use crate::expr::ScopeEntryWithSyntax;\n \n /// The declared signature of a function.\n #[derive(Debug, Clone, PartialEq, Eq)]\n@@ -447,7 +447,7 @@ impl Function {\n     }\n \n     pub fn scopes(&self, db: &impl HirDatabase) -> ScopesWithSyntaxMapping {\n-        let scopes = db.fn_scopes(*self);\n+        let scopes = db.expr_scopes(*self);\n         let syntax_mapping = db.body_syntax_mapping(*self);\n         ScopesWithSyntaxMapping {\n             scopes,"}, {"sha": "42264399610cdef8259cb27730ce9e034b01e6f9", "filename": "crates/ra_hir/src/code_model_impl/function.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fcode_model_impl%2Ffunction.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fcode_model_impl%2Ffunction.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model_impl%2Ffunction.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -1,5 +1,3 @@\n-mod scope;\n-\n use std::sync::Arc;\n \n use ra_syntax::ast::{self, NameOwner};\n@@ -11,8 +9,6 @@ use crate::{\n     impl_block::ImplBlock,\n };\n \n-pub use self::scope::{FnScopes, ScopesWithSyntaxMapping, ScopeEntryWithSyntax};\n-\n impl Function {\n     pub(crate) fn body(&self, db: &impl HirDatabase) -> Arc<Body> {\n         db.body_hir(*self)"}, {"sha": "ddd4b2687cdfd6b717d4a906dc98f19ef945250e", "filename": "crates/ra_hir/src/db.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fdb.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -7,7 +7,7 @@ use crate::{\n     MacroCallId, HirFileId,\n     SourceFileItems, SourceItemId, Crate, Module, HirInterner,\n     query_definitions,\n-    Function, FnSignature, FnScopes,\n+    Function, FnSignature, ExprScopes,\n     Struct, Enum, StructField,\n     macros::MacroExpansion,\n     module_tree::ModuleTree,\n@@ -27,8 +27,8 @@ pub trait HirDatabase: SourceDatabase + AsRef<HirInterner> {\n     #[salsa::invoke(crate::macros::expand_macro_invocation)]\n     fn expand_macro_invocation(&self, invoc: MacroCallId) -> Option<Arc<MacroExpansion>>;\n \n-    #[salsa::invoke(query_definitions::fn_scopes)]\n-    fn fn_scopes(&self, func: Function) -> Arc<FnScopes>;\n+    #[salsa::invoke(query_definitions::expr_scopes)]\n+    fn expr_scopes(&self, func: Function) -> Arc<ExprScopes>;\n \n     #[salsa::invoke(crate::adt::StructData::struct_data_query)]\n     fn struct_data(&self, s: Struct) -> Arc<StructData>;"}, {"sha": "83e913e4ac26d687f06c5574b61c8e4d14fb53d2", "filename": "crates/ra_hir/src/expr.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fexpr.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -16,6 +16,10 @@ use crate::{\n };\n use crate::ty::primitive::{UintTy, UncertainIntTy, UncertainFloatTy};\n \n+pub use self::scope::{ExprScopes, ScopesWithSyntaxMapping, ScopeEntryWithSyntax};\n+\n+mod scope;\n+\n #[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]\n pub struct ExprId(RawId);\n impl_arena_id!(ExprId);"}, {"sha": "17a1efed2a7d8f79f72369085c3bf4fd290e1bb0", "filename": "crates/ra_hir/src/expr/scope.rs", "status": "renamed", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fexpr%2Fscope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fexpr%2Fscope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fexpr%2Fscope.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -16,7 +16,7 @@ pub struct ScopeId(RawId);\n impl_arena_id!(ScopeId);\n \n #[derive(Debug, PartialEq, Eq)]\n-pub struct FnScopes {\n+pub struct ExprScopes {\n     body: Arc<Body>,\n     scopes: Arena<ScopeId, ScopeData>,\n     scope_for: FxHashMap<ExprId, ScopeId>,\n@@ -34,9 +34,9 @@ pub struct ScopeData {\n     entries: Vec<ScopeEntry>,\n }\n \n-impl FnScopes {\n-    pub(crate) fn new(body: Arc<Body>) -> FnScopes {\n-        let mut scopes = FnScopes {\n+impl ExprScopes {\n+    pub(crate) fn new(body: Arc<Body>) -> ExprScopes {\n+        let mut scopes = ExprScopes {\n             body: body.clone(),\n             scopes: Arena::default(),\n             scope_for: FxHashMap::default(),\n@@ -119,7 +119,7 @@ impl FnScopes {\n #[derive(Debug, Clone, PartialEq, Eq)]\n pub struct ScopesWithSyntaxMapping {\n     pub syntax_mapping: Arc<BodySyntaxMapping>,\n-    pub scopes: Arc<FnScopes>,\n+    pub scopes: Arc<ExprScopes>,\n }\n \n #[derive(Debug, Clone, PartialEq, Eq)]\n@@ -249,7 +249,7 @@ fn compute_block_scopes(\n     statements: &[Statement],\n     tail: Option<ExprId>,\n     body: &Body,\n-    scopes: &mut FnScopes,\n+    scopes: &mut ExprScopes,\n     mut scope: ScopeId,\n ) {\n     for stmt in statements {\n@@ -275,7 +275,7 @@ fn compute_block_scopes(\n     }\n }\n \n-fn compute_expr_scopes(expr: ExprId, body: &Body, scopes: &mut FnScopes, scope: ScopeId) {\n+fn compute_expr_scopes(expr: ExprId, body: &Body, scopes: &mut ExprScopes, scope: ScopeId) {\n     scopes.set_scope(expr, scope);\n     match &body[expr] {\n         Expr::Block { statements, tail } => {\n@@ -344,7 +344,7 @@ mod tests {\n         let marker: &ast::PathExpr = find_node_at_offset(file.syntax(), off).unwrap();\n         let fn_def: &ast::FnDef = find_node_at_offset(file.syntax(), off).unwrap();\n         let body_hir = expr::collect_fn_body_syntax(fn_def);\n-        let scopes = FnScopes::new(Arc::clone(body_hir.body()));\n+        let scopes = ExprScopes::new(Arc::clone(body_hir.body()));\n         let scopes = ScopesWithSyntaxMapping {\n             scopes: Arc::new(scopes),\n             syntax_mapping: Arc::new(body_hir),\n@@ -444,7 +444,7 @@ mod tests {\n         let name_ref: &ast::NameRef = find_node_at_offset(file.syntax(), off).unwrap();\n \n         let body_hir = expr::collect_fn_body_syntax(fn_def);\n-        let scopes = FnScopes::new(Arc::clone(body_hir.body()));\n+        let scopes = ExprScopes::new(Arc::clone(body_hir.body()));\n         let scopes = ScopesWithSyntaxMapping {\n             scopes: Arc::new(scopes),\n             syntax_mapping: Arc::new(body_hir),", "previous_filename": "crates/ra_hir/src/code_model_impl/function/scope.rs"}, {"sha": "0b9ee63bf16c2eb30692cb47d0889525da943d3f", "filename": "crates/ra_hir/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Flib.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -57,9 +57,9 @@ pub use self::{\n     nameres::{ItemMap, PerNs, Namespace, Resolution},\n     ty::Ty,\n     impl_block::{ImplBlock, ImplItem},\n-    code_model_impl::function::{FnScopes, ScopesWithSyntaxMapping},\n     docs::{Docs, Documentation},\n     adt::AdtDef,\n+    expr::{ExprScopes, ScopesWithSyntaxMapping},\n };\n \n pub use self::code_model_api::{"}, {"sha": "1b61d449e80621e8c9a6e2fa9efd0e3dc4b00d34", "filename": "crates/ra_hir/src/query_definitions.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fquery_definitions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fquery_definitions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fquery_definitions.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -4,13 +4,13 @@ use ra_syntax::{SyntaxNode, TreeArc};\n \n use crate::{\n     SourceFileItems, SourceItemId, HirFileId,\n-    Function, FnScopes,\n+    Function, ExprScopes,\n     db::HirDatabase,\n };\n \n-pub(super) fn fn_scopes(db: &impl HirDatabase, func: Function) -> Arc<FnScopes> {\n+pub(super) fn expr_scopes(db: &impl HirDatabase, func: Function) -> Arc<ExprScopes> {\n     let body = db.body_hir(func);\n-    let res = FnScopes::new(body);\n+    let res = ExprScopes::new(body);\n     Arc::new(res)\n }\n "}, {"sha": "0472414a672db48514d957747a268b9c79c257a8", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65864d85f992300bad3913438a542af1bd736a24/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=65864d85f992300bad3913438a542af1bd736a24", "patch": "@@ -34,7 +34,7 @@ use test_utils::tested_by;\n \n use crate::{\n     Module, Function, Struct, StructField, Enum, EnumVariant, Path, Name, ImplBlock,\n-    FnSignature, FnScopes, ModuleDef, AdtDef,\n+    FnSignature, ExprScopes, ModuleDef, AdtDef,\n     db::HirDatabase,\n     type_ref::{TypeRef, Mutability},\n     name::KnownName,\n@@ -814,7 +814,7 @@ impl Index<PatId> for InferenceResult {\n struct InferenceContext<'a, D: HirDatabase> {\n     db: &'a D,\n     body: Arc<Body>,\n-    scopes: Arc<FnScopes>,\n+    scopes: Arc<ExprScopes>,\n     module: Module,\n     impl_block: Option<ImplBlock>,\n     var_unification_table: InPlaceUnificationTable<TypeVarId>,\n@@ -908,7 +908,7 @@ impl<'a, D: HirDatabase> InferenceContext<'a, D> {\n     fn new(\n         db: &'a D,\n         body: Arc<Body>,\n-        scopes: Arc<FnScopes>,\n+        scopes: Arc<ExprScopes>,\n         module: Module,\n         impl_block: Option<ImplBlock>,\n     ) -> Self {\n@@ -1720,7 +1720,7 @@ impl<'a, D: HirDatabase> InferenceContext<'a, D> {\n pub fn infer(db: &impl HirDatabase, func: Function) -> Arc<InferenceResult> {\n     db.check_canceled();\n     let body = func.body(db);\n-    let scopes = db.fn_scopes(func);\n+    let scopes = db.expr_scopes(func);\n     let module = func.module(db);\n     let impl_block = func.impl_block(db);\n     let mut ctx = InferenceContext::new(db, body, scopes, module, impl_block);"}]}