{"sha": "d21741843c4c4af2d6fed4fc1d9824fbfd960579", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyMTc0MTg0M2M0YzRhZjJkNmZlZDRmYzFkOTgyNGZiZmQ5NjA1Nzk=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-18T02:10:24Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-18T02:10:24Z"}, "message": "rustc: Make check_block not rebuild the AST", "tree": {"sha": "db18194d11025262934a707b6d1d10464c2b8529", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db18194d11025262934a707b6d1d10464c2b8529"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d21741843c4c4af2d6fed4fc1d9824fbfd960579", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d21741843c4c4af2d6fed4fc1d9824fbfd960579", "html_url": "https://github.com/rust-lang/rust/commit/d21741843c4c4af2d6fed4fc1d9824fbfd960579", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d21741843c4c4af2d6fed4fc1d9824fbfd960579/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "10503a4a02f54f0b6bc01a220240a030e079c3c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/10503a4a02f54f0b6bc01a220240a030e079c3c4", "html_url": "https://github.com/rust-lang/rust/commit/10503a4a02f54f0b6bc01a220240a030e079c3c4"}], "stats": {"total": 18, "additions": 5, "deletions": 13}, "files": [{"sha": "c1851ff156377b9f0f37f7c2381b9635455f7bb1", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 5, "deletions": 13, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d21741843c4c4af2d6fed4fc1d9824fbfd960579/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d21741843c4c4af2d6fed4fc1d9824fbfd960579/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=d21741843c4c4af2d6fed4fc1d9824fbfd960579", "patch": "@@ -2646,11 +2646,8 @@ fn check_stmt(&@fn_ctxt fcx, &@ast::stmt stmt) -> @ast::stmt {\n     fail;\n }\n \n-fn check_block(&@fn_ctxt fcx, &ast::block block) -> ast::block {\n-    let vec[@ast::stmt] stmts = [];\n-    for (@ast::stmt s in block.node.stmts) {\n-        vec::push[@ast::stmt](stmts, check_stmt(fcx, s));\n-    }\n+fn check_block(&@fn_ctxt fcx, &ast::block block) {\n+    for (@ast::stmt s in block.node.stmts) { check_stmt(fcx, s); }\n \n     alt (block.node.expr) {\n         case (none[@ast::expr]) { /* empty */ }\n@@ -2661,11 +2658,7 @@ fn check_block(&@fn_ctxt fcx, &ast::block block) -> ast::block {\n         }\n     }\n \n-    auto new_ann = plain_ann(block.node.a.id, fcx.ccx.tcx);\n     write_nil_type(fcx.ccx.tcx, fcx.ccx.node_types, block.node.a.id);\n-\n-    ret fold::respan(block.span,\n-                     rec(stmts=stmts, expr=block.node.expr, a=new_ann));\n }\n \n fn check_const(&@crate_ctxt ccx, &span sp, &ast::ident ident, &@ast::ty t,\n@@ -2710,7 +2703,7 @@ fn check_fn(&@crate_ctxt ccx, &ast::fn_decl decl, ast::proto proto,\n                             ccx = ccx);\n \n     // TODO: Make sure the type of the block agrees with the function type.\n-    auto block_t = check_block(fcx, body);\n+    check_block(fcx, body);\n     alt (decl.purity) {\n         case (ast::pure_fn) {\n             // per the previous comment, this just checks that the declared\n@@ -2722,10 +2715,9 @@ fn check_fn(&@crate_ctxt ccx, &ast::fn_decl decl, ast::proto proto,\n         case (_) {}\n     }\n \n-    writeback::resolve_local_types_in_block(fcx, block_t);\n+    writeback::resolve_local_types_in_block(fcx, body);\n \n-    auto fn_t = rec(decl=decl, proto=proto, body=block_t);\n-    ret fn_t;\n+    ret rec(decl=decl, proto=proto, body=body);\n }\n \n fn check_item_fn(&@crate_ctxt ccx, &span sp, &ast::ident ident, &ast::_fn f,"}]}