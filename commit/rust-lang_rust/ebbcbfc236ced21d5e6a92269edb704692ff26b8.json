{"sha": "ebbcbfc236ced21d5e6a92269edb704692ff26b8", "node_id": "C_kwDOAAsO6NoAKGViYmNiZmMyMzZjZWQyMWQ1ZTZhOTIyNjllZGI3MDQ2OTJmZjI2Yjg", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-27T18:28:12Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-27T18:28:12Z"}, "message": "Auto merge of #96790 - lqd:update_jemalloc, r=Mark-Simulacrum\n\nUpdate jemalloc to v5.3\n\nNow that `jemalloc` version 5.3 has been released, this PR updates `tikv-jemalloc-sys` to the corresponding release.\n\nThe crates.io publishing issue seems to have been resolved for the `jemalloc-sys` package, and version 5.3.0 is now also available under the historical name (and should become the preferred crate to be used). Therefore, this PR also switches back to using `jemalloc-sys` instead of  `tikv-jemalloc-sys`.", "tree": {"sha": "cb5d8bb6964d8d71b778e1ec1b66010612d3c534", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb5d8bb6964d8d71b778e1ec1b66010612d3c534"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebbcbfc236ced21d5e6a92269edb704692ff26b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebbcbfc236ced21d5e6a92269edb704692ff26b8", "html_url": "https://github.com/rust-lang/rust/commit/ebbcbfc236ced21d5e6a92269edb704692ff26b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebbcbfc236ced21d5e6a92269edb704692ff26b8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "56fd680cf9226ab424f88d4e3b43c5e088d17f19", "url": "https://api.github.com/repos/rust-lang/rust/commits/56fd680cf9226ab424f88d4e3b43c5e088d17f19", "html_url": "https://github.com/rust-lang/rust/commit/56fd680cf9226ab424f88d4e3b43c5e088d17f19"}, {"sha": "adab1350e76dea8a8af4d062fcad518980673643", "url": "https://api.github.com/repos/rust-lang/rust/commits/adab1350e76dea8a8af4d062fcad518980673643", "html_url": "https://github.com/rust-lang/rust/commit/adab1350e76dea8a8af4d062fcad518980673643"}], "stats": {"total": 38, "additions": 17, "deletions": 21}, "files": [{"sha": "538e88355ef0363374a29809efd14a551bd35937", "filename": "Cargo.lock", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/ebbcbfc236ced21d5e6a92269edb704692ff26b8/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/ebbcbfc236ced21d5e6a92269edb704692ff26b8/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=ebbcbfc236ced21d5e6a92269edb704692ff26b8", "patch": "@@ -1897,6 +1897,17 @@ version = \"0.4.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"dc6f3ad7b9d11a0c00842ff8de1b60ee58661048eb8049ed33c73594f359d7e6\"\n \n+[[package]]\n+name = \"jemalloc-sys\"\n+version = \"0.5.0+5.3.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"f655c3ecfa6b0d03634595b4b54551d4bd5ac208b9e0124873949a7ab168f70b\"\n+dependencies = [\n+ \"cc\",\n+ \"fs_extra\",\n+ \"libc\",\n+]\n+\n [[package]]\n name = \"jobserver\"\n version = \"0.1.24\"\n@@ -3360,9 +3371,9 @@ checksum = \"08d43f7aa6b08d49f382cde6a7982047c3426db949b1424bc4b7ec9ae12c6ce2\"\n name = \"rustc-main\"\n version = \"0.0.0\"\n dependencies = [\n+ \"jemalloc-sys\",\n  \"rustc_codegen_ssa\",\n  \"rustc_driver\",\n- \"tikv-jemalloc-sys\",\n ]\n \n [[package]]\n@@ -5234,17 +5245,6 @@ dependencies = [\n name = \"tier-check\"\n version = \"0.1.0\"\n \n-[[package]]\n-name = \"tikv-jemalloc-sys\"\n-version = \"0.4.1+5.2.1-patched\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"8a26331b05179d4cb505c8d6814a7e18d298972f0a551b0e3cefccff927f86d3\"\n-dependencies = [\n- \"cc\",\n- \"fs_extra\",\n- \"libc\",\n-]\n-\n [[package]]\n name = \"time\"\n version = \"0.1.43\""}, {"sha": "5e0bb1a7f95d1a5247f18da2e04cb1d53e7ea83b", "filename": "compiler/rustc/Cargo.toml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ebbcbfc236ced21d5e6a92269edb704692ff26b8/compiler%2Frustc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ebbcbfc236ced21d5e6a92269edb704692ff26b8/compiler%2Frustc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc%2FCargo.toml?ref=ebbcbfc236ced21d5e6a92269edb704692ff26b8", "patch": "@@ -10,13 +10,13 @@ rustc_driver = { path = \"../rustc_driver\" }\n # crate is intended to be used by codegen backends, which may not be in-tree.\n rustc_codegen_ssa = { path = \"../rustc_codegen_ssa\" }\n \n-[dependencies.tikv-jemalloc-sys]\n-version = '0.4.0'\n+[dependencies.jemalloc-sys]\n+version = \"0.5.0\"\n optional = true\n features = ['unprefixed_malloc_on_supported_platforms']\n \n [features]\n-jemalloc = ['tikv-jemalloc-sys']\n+jemalloc = ['jemalloc-sys']\n llvm = ['rustc_driver/llvm']\n max_level_info = ['rustc_driver/max_level_info']\n rustc_use_parallel_compiler = ['rustc_driver/rustc_use_parallel_compiler']"}, {"sha": "0de1a78191353c98d6957aa2147a5f6a2656bc71", "filename": "compiler/rustc/src/main.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ebbcbfc236ced21d5e6a92269edb704692ff26b8/compiler%2Frustc%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebbcbfc236ced21d5e6a92269edb704692ff26b8/compiler%2Frustc%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc%2Fsrc%2Fmain.rs?ref=ebbcbfc236ced21d5e6a92269edb704692ff26b8", "patch": "@@ -22,12 +22,10 @@\n // The two crates we link to here, `std` and `rustc_driver`, are both dynamic\n // libraries. So we must reference jemalloc symbols one way or another, because\n // this file is the only object code in the rustc executable.\n-#[cfg(feature = \"tikv-jemalloc-sys\")]\n-use tikv_jemalloc_sys as jemalloc_sys;\n \n fn main() {\n     // See the comment at the top of this file for an explanation of this.\n-    #[cfg(feature = \"tikv-jemalloc-sys\")]\n+    #[cfg(feature = \"jemalloc-sys\")]\n     {\n         use std::os::raw::{c_int, c_void};\n "}, {"sha": "8b3edfd2135a42fa61484981e2d222b26a64a48e", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ebbcbfc236ced21d5e6a92269edb704692ff26b8/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebbcbfc236ced21d5e6a92269edb704692ff26b8/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=ebbcbfc236ced21d5e6a92269edb704692ff26b8", "patch": "@@ -70,9 +70,7 @@ extern crate test;\n // See docs in https://github.com/rust-lang/rust/blob/master/compiler/rustc/src/main.rs\n // about jemalloc.\n #[cfg(feature = \"jemalloc\")]\n-extern crate tikv_jemalloc_sys;\n-#[cfg(feature = \"jemalloc\")]\n-use tikv_jemalloc_sys as jemalloc_sys;\n+extern crate jemalloc_sys;\n \n use std::default::Default;\n use std::env::{self, VarError};"}]}