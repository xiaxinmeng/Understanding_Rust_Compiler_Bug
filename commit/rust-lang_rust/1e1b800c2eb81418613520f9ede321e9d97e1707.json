{"sha": "1e1b800c2eb81418613520f9ede321e9d97e1707", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlMWI4MDBjMmViODE0MTg2MTM1MjBmOWVkZTMyMWU5ZDk3ZTE3MDc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-12T17:56:17Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-13T14:11:02Z"}, "message": "Enabled core dump on Linux, and print stack trace on failure.", "tree": {"sha": "b42d0e0f9bbe7ef41af9d0519f9042237781560d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b42d0e0f9bbe7ef41af9d0519f9042237781560d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e1b800c2eb81418613520f9ede321e9d97e1707", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAltIsvYACgkQ/vbIBR0O\nATyVpw//QEOWjzXtxV4K4RbBEe+TtF6yne3cvnFlhgGwI0MeGqmvU96LUlTnwzwU\nQOuncTZvv2afzQoVcYURTu4inPXQ0OucknxWcya+AYpI4wHYTCNPPE+x0vfinWxK\nnAV1CGTN/+1t0TdWdKslcN8ngTG3YVe3/mSyXGXtmBpf1MUP/vuL70EfHMlCI7a5\ntU4fUysDQaUlmciBPZIGpDp5XZNXQ71EdcFa6rfUhMhLFkv8DrZQTDSrkUiRfRwz\ntoOds2rlUvTid4e5kpHBoFx8k1qirYD28jbKh8jdVsmdUsjMptwm5DrSC0rQfCas\nss8yQxVt7SJ4qI5mEVyfMe3ososixZUPANOoapkpqT9ZwtQKd7sZmFk7bIboKADZ\ni1G3NW7uOghkIGEvtzo6S4kH5GocXYPqyZQmoTr0DX9pqkWbPEbbUtCeVQ1Ar1/L\n3KCmhmjJSo1sJ40RglnqessbVSVtCzuYGXxXeUTpugYOMb2mGG2ZOJNHeZ4/3gcF\nhaILYfuNLa2RNc9p7mJya8KA238F+jKddnSYfs/hNHwMeiAbCJFbhSn/GRBsW1Cz\n9s5gAcqeMv8ADXVYmbry+vqx5YvdvB/91VwFAirlJSDSugWV0zxsFcHKqR1CL2sY\neKJReFU08nmwYAAkN21P9KDqt5sgr2mRA8o1ecKUwuwn5STDNTo=\n=Ffvn\n-----END PGP SIGNATURE-----", "payload": "tree b42d0e0f9bbe7ef41af9d0519f9042237781560d\nparent 7db82ccd765cbfe55c3d8a2c434bc6f9b986843d\nauthor kennytm <kennytm@gmail.com> 1531418177 +0800\ncommitter kennytm <kennytm@gmail.com> 1531491062 +0800\n\nEnabled core dump on Linux, and print stack trace on failure.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e1b800c2eb81418613520f9ede321e9d97e1707", "html_url": "https://github.com/rust-lang/rust/commit/1e1b800c2eb81418613520f9ede321e9d97e1707", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e1b800c2eb81418613520f9ede321e9d97e1707/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7db82ccd765cbfe55c3d8a2c434bc6f9b986843d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7db82ccd765cbfe55c3d8a2c434bc6f9b986843d", "html_url": "https://github.com/rust-lang/rust/commit/7db82ccd765cbfe55c3d8a2c434bc6f9b986843d"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "0228fdc994dd769b5512c55a074dafd2dcffddd1", "filename": ".travis.yml", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/1e1b800c2eb81418613520f9ede321e9d97e1707/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/1e1b800c2eb81418613520f9ede321e9d97e1707/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=1e1b800c2eb81418613520f9ede321e9d97e1707", "patch": "@@ -3,6 +3,10 @@ sudo: required\n dist: trusty\n services:\n   - docker\n+addons:\n+  apt:\n+    packages:\n+      - gdb\n \n git:\n   depth: 2\n@@ -249,6 +253,8 @@ before_script:\n           export RUN_SCRIPT=\"$RUN_SCRIPT && src/ci/run.sh\";\n       else\n           export RUN_SCRIPT=\"$RUN_SCRIPT && src/ci/docker/run.sh $IMAGE\";\n+          # Enable core dump on Linux.\n+          sudo sh -c 'echo \"/checkout/obj/cores/core.%p.%E\" > /proc/sys/kernel/core_pattern';\n       fi\n \n # Log time information from this machine and an external machine for insight into possible\n@@ -274,6 +280,8 @@ after_failure:\n \n   # Random attempt at debugging currently. Just poking around in here to see if\n   # anything shows up.\n+\n+  # Dump backtrace for macOS\n   - ls -lat $HOME/Library/Logs/DiagnosticReports/\n   - find $HOME/Library/Logs/DiagnosticReports\n       -type f\n@@ -284,8 +292,24 @@ after_failure:\n       -exec head -750 {} \\;\n       -exec echo travis_fold\":\"end:crashlog \\; || true\n \n+  # Dump backtrace for Linux\n+  - ln -s . checkout &&\n+    for CORE in obj/cores/core.*; do\n+      EXE=$(echo $CORE | sed 's|obj/cores/core\\.[0-9]*\\.!checkout!\\(.*\\)|\\1|;y|!|/|');\n+      if [ -f \"$EXE\" ]; then\n+        printf travis_fold\":start:crashlog\\n\\033[31;1m%s\\033[0m\\n\" \"$CORE\";\n+        gdb -q -c \"$CORE\" \"$EXE\"\n+          -iex 'set auto-load off'\n+          -iex 'dir src/'\n+          -iex 'set sysroot .'\n+          -ex bt\n+          -ex q;\n+        echo travis_fold\":\"end:crashlog;\n+      fi;\n+    done || true\n+\n   # see #50887\n-  - head -30 ./obj/build/x86_64-unknown-linux-gnu/native/asan/build/lib/asan/clang_rt.asan-dynamic-i386.vers || true\n+  - cat ./obj/build/x86_64-unknown-linux-gnu/native/asan/build/lib/asan/clang_rt.asan-dynamic-i386.vers || true\n \n   # attempt to debug anything killed by the oom killer on linux, just to see if\n   # it happened"}, {"sha": "931c28f1ca98e95f3bd944c2123ba91156e0fe8d", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1e1b800c2eb81418613520f9ede321e9d97e1707/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1e1b800c2eb81418613520f9ede321e9d97e1707/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=1e1b800c2eb81418613520f9ede321e9d97e1707", "patch": "@@ -99,6 +99,7 @@ objdir=$root_dir/obj\n \n mkdir -p $HOME/.cargo\n mkdir -p $objdir/tmp\n+mkdir $objdir/cores\n \n args=\n if [ \"$SCCACHE_BUCKET\" != \"\" ]; then"}, {"sha": "09a0cf3541d8dde8f7dc524db62af022933b2e5b", "filename": "src/ci/run.sh", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1e1b800c2eb81418613520f9ede321e9d97e1707/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1e1b800c2eb81418613520f9ede321e9d97e1707/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=1e1b800c2eb81418613520f9ede321e9d97e1707", "patch": "@@ -24,6 +24,11 @@ if [ \"$NO_CHANGE_USER\" = \"\" ]; then\n   fi\n fi\n \n+# only enable core dump on Linux\n+if [ -f /proc/sys/kernel/core_pattern ]; then\n+  ulimit -c unlimited\n+fi\n+\n ci_dir=`cd $(dirname $0) && pwd`\n source \"$ci_dir/shared.sh\"\n "}]}