{"sha": "4f9cd749261cf95f48a9473a2b44a5cfcd27e10f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmOWNkNzQ5MjYxY2Y5NWY0OGE5NDczYTJiNDRhNWNmY2QyN2UxMGY=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-08-17T23:51:09Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-08-18T00:13:58Z"}, "message": "Resolve true and false as booleans", "tree": {"sha": "7d7205f69b750c18d47574e2c004a6f699cab720", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d7205f69b750c18d47574e2c004a6f699cab720"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f", "html_url": "https://github.com/rust-lang/rust/commit/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f032cba02e53a8538f3c1cd431edc01a9fa1b3f8", "url": "https://api.github.com/repos/rust-lang/rust/commits/f032cba02e53a8538f3c1cd431edc01a9fa1b3f8", "html_url": "https://github.com/rust-lang/rust/commit/f032cba02e53a8538f3c1cd431edc01a9fa1b3f8"}], "stats": {"total": 35, "additions": 28, "deletions": 7}, "files": [{"sha": "8df089b6d81e5f83b57a238ec74fb4a3d951e290", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=4f9cd749261cf95f48a9473a2b44a5cfcd27e10f", "patch": "@@ -222,11 +222,11 @@ impl<'a, 'tcx> LinkCollector<'a, 'tcx> {\n                             disambiguator,\n                             None | Some(Disambiguator::Namespace(Namespace::TypeNS))\n                         ) {\n-                            if let Some(prim) = is_primitive(path_str, ns) {\n+                            if let Some((path, prim)) = is_primitive(path_str, ns) {\n                                 if extra_fragment.is_some() {\n                                     return Err(ErrorKind::AnchorFailure(AnchorFailure::Primitive));\n                                 }\n-                                return Ok((prim, Some(path_str.to_owned())));\n+                                return Ok((prim, Some(path.to_owned())));\n                             }\n                         }\n                         return Ok((res, extra_fragment.clone()));\n@@ -239,11 +239,11 @@ impl<'a, 'tcx> LinkCollector<'a, 'tcx> {\n                 if value != (ns == ValueNS) {\n                     return Err(ErrorKind::ResolutionFailure);\n                 }\n-            } else if let Some(prim) = is_primitive(path_str, ns) {\n+            } else if let Some((path, prim)) = is_primitive(path_str, ns) {\n                 if extra_fragment.is_some() {\n                     return Err(ErrorKind::AnchorFailure(AnchorFailure::Primitive));\n                 }\n-                return Ok((prim, Some(path_str.to_owned())));\n+                return Ok((prim, Some(path.to_owned())));\n             } else {\n                 // If resolution failed, it may still be a method\n                 // because methods are not handled by the resolver\n@@ -269,7 +269,7 @@ impl<'a, 'tcx> LinkCollector<'a, 'tcx> {\n                 })\n                 .ok_or(ErrorKind::ResolutionFailure)?;\n \n-            if let Some(prim) = is_primitive(&path, TypeNS) {\n+            if let Some((path, prim)) = is_primitive(&path, TypeNS) {\n                 let did = primitive_impl(cx, &path).ok_or(ErrorKind::ResolutionFailure)?;\n                 return cx\n                     .tcx\n@@ -1220,11 +1220,22 @@ const PRIMITIVES: &[(&str, Res)] = &[\n     (\"f64\", Res::PrimTy(hir::PrimTy::Float(rustc_ast::ast::FloatTy::F64))),\n     (\"str\", Res::PrimTy(hir::PrimTy::Str)),\n     (\"bool\", Res::PrimTy(hir::PrimTy::Bool)),\n+    (\"true\", Res::PrimTy(hir::PrimTy::Bool)),\n+    (\"false\", Res::PrimTy(hir::PrimTy::Bool)),\n     (\"char\", Res::PrimTy(hir::PrimTy::Char)),\n ];\n \n-fn is_primitive(path_str: &str, ns: Namespace) -> Option<Res> {\n-    if ns == TypeNS { PRIMITIVES.iter().find(|x| x.0 == path_str).map(|x| x.1) } else { None }\n+fn is_primitive(path_str: &str, ns: Namespace) -> Option<(&'static str, Res)> {\n+    if ns == TypeNS {\n+        PRIMITIVES\n+            .iter()\n+            .filter(|x| x.0 == path_str)\n+            .copied()\n+            .map(|x| if x.0 == \"true\" || x.0 == \"false\" { (\"bool\", x.1) } else { x })\n+            .next()\n+    } else {\n+        None\n+    }\n }\n \n fn primitive_impl(cx: &DocContext<'_>, path_str: &str) -> Option<DefId> {"}, {"sha": "7b21e9341474032b84064337a3d4280ea20b5752", "filename": "src/test/rustdoc/intra-doc-link-true-false.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f/src%2Ftest%2Frustdoc%2Fintra-doc-link-true-false.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f9cd749261cf95f48a9473a2b44a5cfcd27e10f/src%2Ftest%2Frustdoc%2Fintra-doc-link-true-false.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fintra-doc-link-true-false.rs?ref=4f9cd749261cf95f48a9473a2b44a5cfcd27e10f", "patch": "@@ -0,0 +1,10 @@\n+#![deny(broken_intra_doc_links)]\n+#![crate_name = \"foo\"]\n+\n+// ignore-tidy-linelength\n+\n+// @has foo/index.html\n+// @has - '//*[@id=\"main\"]//a[@href=\"https://doc.rust-lang.org/nightly/std/primitive.bool.html\"]' 'true'\n+// @has - '//*[@id=\"main\"]//a[@href=\"https://doc.rust-lang.org/nightly/std/primitive.bool.html\"]' 'false'\n+\n+//! A `bool` is either [`true`] or [`false`]."}]}