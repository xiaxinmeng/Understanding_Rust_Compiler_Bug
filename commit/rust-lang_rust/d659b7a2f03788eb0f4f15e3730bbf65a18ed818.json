{"sha": "d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2NTliN2EyZjAzNzg4ZWIwZjRmMTVlMzczMGJiZjY1YTE4ZWQ4MTg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-11-27T18:45:42Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-11-27T18:45:42Z"}, "message": "start descriptors -> hir rename", "tree": {"sha": "c7112f1e0785606ab67b3df8d7a8b411909f54e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7112f1e0785606ab67b3df8d7a8b411909f54e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "html_url": "https://github.com/rust-lang/rust/commit/d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f08341aa486ea59cb488635f19e960523568fb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f08341aa486ea59cb488635f19e960523568fb8", "html_url": "https://github.com/rust-lang/rust/commit/9f08341aa486ea59cb488635f19e960523568fb8"}], "stats": {"total": 61, "additions": 34, "deletions": 27}, "files": [{"sha": "1eb804c855fc2bc118172966a34052a404dff069", "filename": "crates/ra_analysis/src/completion/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fmod.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -11,7 +11,7 @@ use rustc_hash::{FxHashMap};\n \n use crate::{\n     db::{self, SyntaxDatabase},\n-    descriptors::{\n+    hir::{\n         module::{ModuleDescriptor}\n     },\n     Cancelable, FilePosition"}, {"sha": "ac6ef1d4a7ae8c6782ea05a36748e70ec6724a0f", "filename": "crates/ra_analysis/src/completion/reference_completion.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Freference_completion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Freference_completion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Freference_completion.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -10,7 +10,7 @@ use ra_syntax::{\n use crate::{\n     db::RootDatabase,\n     completion::CompletionItem,\n-    descriptors::{\n+    hir::{\n         module::{ModuleDescriptor},\n         function::FnScopes,\n         Def,"}, {"sha": "fa59b8b3eace16fbc9859adc92190149e994fe75", "filename": "crates/ra_analysis/src/db.rs", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fdb.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -7,7 +7,7 @@ use salsa::{self, Database};\n \n use crate::{\n     db,\n-    descriptors,\n+    hir,\n     symbol_index::SymbolIndex,\n     syntax_ptr::SyntaxPtr,\n     loc2id::{IdMaps, IdDatabase},\n@@ -122,15 +122,15 @@ salsa::database_storage! {\n             fn file_symbols() for FileSymbolsQuery;\n             fn resolve_syntax_ptr() for ResolveSyntaxPtrQuery;\n         }\n-        impl descriptors::DescriptorDatabase {\n-            fn module_tree() for descriptors::ModuleTreeQuery;\n-            fn fn_scopes() for descriptors::FnScopesQuery;\n-            fn _file_items() for descriptors::FileItemsQuery;\n-            fn _file_item() for descriptors::FileItemQuery;\n-            fn _input_module_items() for descriptors::InputModuleItemsQuery;\n-            fn _item_map() for descriptors::ItemMapQuery;\n-            fn _fn_syntax() for descriptors::FnSyntaxQuery;\n-            fn _submodules() for descriptors::SubmodulesQuery;\n+        impl hir::DescriptorDatabase {\n+            fn module_tree() for hir::ModuleTreeQuery;\n+            fn fn_scopes() for hir::FnScopesQuery;\n+            fn _file_items() for hir::FileItemsQuery;\n+            fn _file_item() for hir::FileItemQuery;\n+            fn _input_module_items() for hir::InputModuleItemsQuery;\n+            fn _item_map() for hir::ItemMapQuery;\n+            fn _fn_syntax() for hir::FnSyntaxQuery;\n+            fn _submodules() for hir::SubmodulesQuery;\n         }\n     }\n }"}, {"sha": "cd573a47f3e9785439af1ce5fe5f7d31d81bf168", "filename": "crates/ra_analysis/src/hir/function/imp.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fimp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fimp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fimp.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -2,7 +2,7 @@ use std::sync::Arc;\n \n use ra_syntax::ast::{AstNode, FnDef, FnDefNode};\n \n-use crate::descriptors::{\n+use crate::hir::{\n     function::{FnId, FnScopes},\n     DescriptorDatabase,\n };", "previous_filename": "crates/ra_analysis/src/descriptors/function/imp.rs"}, {"sha": "86eee5e93c2c8dc5af9e6ba06499bd5230f42fa0", "filename": "crates/ra_analysis/src/hir/function/mod.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fmod.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "previous_filename": "crates/ra_analysis/src/descriptors/function/mod.rs"}, {"sha": "5307a0a8e1b78b627a9c058ac41f0e33e8e28f08", "filename": "crates/ra_analysis/src/hir/function/scope.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fscope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fscope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fscope.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "previous_filename": "crates/ra_analysis/src/descriptors/function/scope.rs"}, {"sha": "6bee2b5c415ce1fbdfd4a7f3d65eb3fd2e088c3e", "filename": "crates/ra_analysis/src/hir/mod.rs", "status": "renamed", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmod.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -1,3 +1,10 @@\n+//! HIR (previsouly known as descriptors) provides a high-level OO acess to Rust\n+//! code.\n+//!\n+//! The principal difference between HIR and syntax trees is that HIR is bound\n+//! to a particular crate instance. That is, it has cfg flags and features\n+//! applied. So, there relation between syntax and HIR is many-to-one.\n+\n pub(crate) mod function;\n pub(crate) mod module;\n mod path;\n@@ -12,8 +19,8 @@ use ra_syntax::{\n use crate::{\n     FileId,\n     db::SyntaxDatabase,\n-    descriptors::function::{resolve_local_name, FnId, FnScopes},\n-    descriptors::module::{\n+    hir::function::{resolve_local_name, FnId, FnScopes},\n+    hir::module::{\n         ModuleId, ModuleTree, ModuleSource, ModuleDescriptor,\n         nameres::{ItemMap, InputModuleItems, FileItems}\n     },", "previous_filename": "crates/ra_analysis/src/descriptors/mod.rs"}, {"sha": "d8539ed856d5b451bd2dca8fe6e2a5a1d687ab50", "filename": "crates/ra_analysis/src/hir/module/imp.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fimp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fimp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fimp.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -9,7 +9,7 @@ use rustc_hash::{FxHashMap, FxHashSet};\n \n use crate::{\n     db,\n-    descriptors::DescriptorDatabase,\n+    hir::DescriptorDatabase,\n     input::{SourceRoot, SourceRootId},\n     Cancelable, FileId, FileResolverImp,\n };", "previous_filename": "crates/ra_analysis/src/descriptors/module/imp.rs"}, {"sha": "f374a079f0e968461ab528fbdb98b797492c992c", "filename": "crates/ra_analysis/src/hir/module/mod.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fmod.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -14,7 +14,7 @@ use relative_path::RelativePathBuf;\n \n use crate::{\n     db::SyntaxDatabase, syntax_ptr::SyntaxPtr, FileId, FilePosition, Cancelable,\n-    descriptors::{Path, PathKind, DescriptorDatabase},\n+    hir::{Path, PathKind, DescriptorDatabase},\n     input::SourceRootId,\n     arena::{Arena, Id},\n     loc2id::{DefLoc, DefId},", "previous_filename": "crates/ra_analysis/src/descriptors/module/mod.rs"}, {"sha": "1ec85fbf25a7bb9bf0c8dc7085f992f4e926e486", "filename": "crates/ra_analysis/src/hir/module/nameres.rs", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fnameres.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fnameres.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Fmodule%2Fnameres.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -31,7 +31,7 @@ use ra_syntax::{\n use crate::{\n     Cancelable, FileId,\n     loc2id::{DefId, DefLoc},\n-    descriptors::{\n+    hir::{\n         Path, PathKind,\n         DescriptorDatabase,\n         module::{ModuleId, ModuleTree, ModuleSourceNode},\n@@ -447,7 +447,7 @@ mod tests {\n     use crate::{\n         AnalysisChange,\n         mock_analysis::{MockAnalysis, analysis_and_position},\n-        descriptors::{DescriptorDatabase, module::ModuleDescriptor},\n+        hir::{DescriptorDatabase, module::ModuleDescriptor},\n         input::FilesDatabase,\n };\n     use super::*;", "previous_filename": "crates/ra_analysis/src/descriptors/module/nameres.rs"}, {"sha": "8279daf4bf6e0a27a549f57c1d3cbbf0895d35f1", "filename": "crates/ra_analysis/src/hir/path.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fhir%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Fpath.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "previous_filename": "crates/ra_analysis/src/descriptors/path.rs"}, {"sha": "8d60f9af7e3aa1c042b15af5b959a41cc10b26bb", "filename": "crates/ra_analysis/src/imp.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fimp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Fimp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fimp.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -19,7 +19,7 @@ use salsa::{Database, ParallelDatabase};\n use crate::{\n     completion::{completions, CompletionItem},\n     db::{self, FileSyntaxQuery, SyntaxDatabase},\n-    descriptors::{\n+    hir::{\n         function::{FnDescriptor, FnId},\n         module::{ModuleDescriptor, Problem},\n         DeclarationDescriptor, DescriptorDatabase,\n@@ -589,7 +589,7 @@ fn resolve_local_name(\n     let fn_def = name_ref.syntax().ancestors().find_map(ast::FnDef::cast)?;\n     let fn_id = FnId::get(db, file_id, fn_def);\n     let scopes = db.fn_scopes(fn_id);\n-    let scope_entry = crate::descriptors::function::resolve_local_name(name_ref, &scopes)?;\n+    let scope_entry = crate::hir::function::resolve_local_name(name_ref, &scopes)?;\n     let syntax = db.resolve_syntax_ptr(scope_entry.ptr().into_global(file_id));\n     Some((scope_entry.name().clone(), syntax.range()))\n }"}, {"sha": "4659eb523a1b4b9f46da2aa456dfcb5960d8185e", "filename": "crates/ra_analysis/src/lib.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Flib.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -19,14 +19,14 @@ macro_rules! ctry {\n }\n \n mod arena;\n+mod syntax_ptr;\n+mod input;\n mod db;\n mod loc2id;\n-mod input;\n mod imp;\n mod completion;\n-mod descriptors;\n+mod hir;\n mod symbol_index;\n-mod syntax_ptr;\n pub mod mock_analysis;\n \n use std::{fmt, sync::Arc};\n@@ -42,7 +42,7 @@ use crate::{\n \n pub use crate::{\n     completion::CompletionItem,\n-    descriptors::function::FnDescriptor,\n+    hir::function::FnDescriptor,\n     input::{CrateGraph, CrateId, FileId, FileResolver},\n };\n pub use ra_editor::{"}, {"sha": "d42af4e0a0db25761907ad02f1eeae0d7032eac2", "filename": "crates/ra_analysis/src/loc2id.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Floc2id.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d659b7a2f03788eb0f4f15e3730bbf65a18ed818/crates%2Fra_analysis%2Fsrc%2Floc2id.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Floc2id.rs?ref=d659b7a2f03788eb0f4f15e3730bbf65a18ed818", "patch": "@@ -9,8 +9,8 @@ use rustc_hash::FxHashMap;\n \n use crate::{\n     FileId,\n-    descriptors::FileItemId,\n-    descriptors::module::ModuleId,\n+    hir::FileItemId,\n+    hir::module::ModuleId,\n     syntax_ptr::SyntaxPtr,\n     input::SourceRootId,\n };"}]}