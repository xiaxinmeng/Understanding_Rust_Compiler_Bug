{"sha": "8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjODZmOGZmOGM3Y2JiZjBlODdmMGM3ZmUyMmU1NTk2YTQ3NzhiZmM=", "commit": {"author": {"name": "petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2015-05-30T16:22:12Z"}, "committer": {"name": "petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2015-05-30T16:22:12Z"}, "message": "Warn if the test suite is run on Windows in console with non-UTF-8 code page", "tree": {"sha": "351e7a689db7a145dd677089154e3bcd58c7bdc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/351e7a689db7a145dd677089154e3bcd58c7bdc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc", "html_url": "https://github.com/rust-lang/rust/commit/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a97b3ff16ffb7370642b674ce154a827bf69b8d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/a97b3ff16ffb7370642b674ce154a827bf69b8d8", "html_url": "https://github.com/rust-lang/rust/commit/a97b3ff16ffb7370642b674ce154a827bf69b8d8"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "fa35bd383b28424bba628ef42363ee154aeb1161", "filename": "mk/tests.mk", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc", "patch": "@@ -172,23 +172,24 @@ check: check-sanitycheck cleantmptestlogs cleantestlibs all check-stage2 tidy\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # As above but don't bother running tidy.\n-check-notidy: cleantmptestlogs cleantestlibs all check-stage2\n+check-notidy: check-sanitycheck cleantmptestlogs cleantestlibs all check-stage2\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # A slightly smaller set of tests for smoke testing.\n-check-lite: cleantestlibs cleantmptestlogs \\\n+check-lite: check-sanitycheck cleantestlibs cleantmptestlogs \\\n \t$(foreach crate,$(TEST_TARGET_CRATES),check-stage2-$(crate)) \\\n \tcheck-stage2-rpass check-stage2-rpass-valgrind \\\n \tcheck-stage2-rfail check-stage2-cfail check-stage2-pfail check-stage2-rmake\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # Only check the 'reference' tests: rpass/cfail/rfail/rmake.\n-check-ref: cleantestlibs cleantmptestlogs check-stage2-rpass check-stage2-rpass-valgrind \\\n-\tcheck-stage2-rfail check-stage2-cfail check-stage2-pfail check-stage2-rmake\n+check-ref: check-sanitycheck cleantestlibs cleantmptestlogs check-stage2-rpass \\\n+\tcheck-stage2-rpass-valgrind check-stage2-rfail check-stage2-cfail check-stage2-pfail \\\n+\tcheck-stage2-rmake\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # Only check the docs.\n-check-docs: cleantestlibs cleantmptestlogs check-stage2-docs\n+check-docs: check-sanitycheck cleantestlibs cleantmptestlogs check-stage2-docs\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # Some less critical tests that are not prone to breakage."}, {"sha": "b3dc290e36b1ff5335a78f470b98f6c70b133b9c", "filename": "src/etc/check-sanitycheck.py", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc/src%2Fetc%2Fcheck-sanitycheck.py", "raw_url": "https://github.com/rust-lang/rust/raw/8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc/src%2Fetc%2Fcheck-sanitycheck.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fcheck-sanitycheck.py?ref=8c86f8ff8c7cbbf0e87f0c7fe22e5596a4778bfc", "patch": "@@ -11,6 +11,7 @@\n # except according to those terms.\n \n import os\n+import subprocess\n import sys\n import functools\n \n@@ -45,8 +46,14 @@ def check_rlimit_core():\n set ALLOW_NONZERO_RLIMIT_CORE to ignore this warning\n \"\"\" % (soft))\n \n+@only_on(('windows'))\n+def check_console_code_page():\n+    if \"65001\" not in subprocess.check_output(['cmd', '/c', 'chcp']):\n+        sys.stderr.write('Warning: the console output code page is not UTF-8, \\\n+some tests may fail. Use `cmd /c \"chcp 65001\"` to setup UTF-8 code page.\\n')\n \n def main():\n+    check_console_code_page()\n     check_rlimit_core()\n \n if __name__ == '__main__':"}]}