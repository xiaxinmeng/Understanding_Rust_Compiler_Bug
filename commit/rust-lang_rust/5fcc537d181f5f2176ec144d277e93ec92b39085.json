{"sha": "5fcc537d181f5f2176ec144d277e93ec92b39085", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmY2M1MzdkMTgxZjVmMjE3NmVjMTQ0ZDI3N2U5M2VjOTJiMzkwODU=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-12-25T18:07:28Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-01-08T17:02:04Z"}, "message": "Make DepConstructor a module.", "tree": {"sha": "e50c5a33d4f1310c662ae34243ab8f3db401a7da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e50c5a33d4f1310c662ae34243ab8f3db401a7da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5fcc537d181f5f2176ec144d277e93ec92b39085", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5fcc537d181f5f2176ec144d277e93ec92b39085", "html_url": "https://github.com/rust-lang/rust/commit/5fcc537d181f5f2176ec144d277e93ec92b39085", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5fcc537d181f5f2176ec144d277e93ec92b39085/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "921b2841671baba79b23d17cf37170667c59fdd2", "url": "https://api.github.com/repos/rust-lang/rust/commits/921b2841671baba79b23d17cf37170667c59fdd2", "html_url": "https://github.com/rust-lang/rust/commit/921b2841671baba79b23d17cf37170667c59fdd2"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "c4379670f990655e02f1d82a43ebc96e65f9e2b8", "filename": "compiler/rustc_middle/src/dep_graph/dep_node.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5fcc537d181f5f2176ec144d277e93ec92b39085/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5fcc537d181f5f2176ec144d277e93ec92b39085/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs?ref=5fcc537d181f5f2176ec144d277e93ec92b39085", "patch": "@@ -29,8 +29,8 @@\n //!   contained no `DefId` for thing that had been removed.\n //!\n //! `DepNode` definition happens in the `define_dep_nodes!()` macro. This macro\n-//! defines the `DepKind` enum and a corresponding `DepConstructor` enum. The\n-//! `DepConstructor` enum links a `DepKind` to the parameters that are needed at\n+//! defines the `DepKind` enum and a corresponding `dep_constructor` module. The\n+//! `dep_constructor` module links a `DepKind` to the parameters that are needed at\n //! runtime in order to construct a valid `DepNode` fingerprint.\n //!\n //! Because the macro sees what parameters a given `DepKind` requires, it can\n@@ -44,7 +44,7 @@\n //!   `DefId` it was computed from. In other cases, too much information gets\n //!   lost during fingerprint computation.\n //!\n-//! The `DepConstructor` enum, together with `DepNode::new()`, ensures that only\n+//! The `dep_constructor` module, together with `DepNode::new()`, ensures that only\n //! valid `DepNode` instances can be constructed. For example, the API does not\n //! allow for constructing parameterless `DepNode`s with anything other\n //! than a zeroed out fingerprint. More generally speaking, it relieves the\n@@ -331,10 +331,10 @@ macro_rules! define_dep_nodes {\n             $($variant),*\n         }\n \n-        pub struct DepConstructor;\n-\n         #[allow(non_camel_case_types)]\n-        impl DepConstructor {\n+        pub mod dep_constructor {\n+            use super::*;\n+\n             $(\n                 #[inline(always)]\n                 #[allow(unreachable_code, non_snake_case)]"}, {"sha": "22e9cc1cd3ee42e702d12baa622e59bfe06238c7", "filename": "compiler/rustc_middle/src/dep_graph/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5fcc537d181f5f2176ec144d277e93ec92b39085/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5fcc537d181f5f2176ec144d277e93ec92b39085/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fmod.rs?ref=5fcc537d181f5f2176ec144d277e93ec92b39085", "patch": "@@ -13,7 +13,7 @@ pub use rustc_query_system::dep_graph::{\n     WorkProduct, WorkProductId,\n };\n \n-pub use dep_node::{label_strs, DepConstructor, DepKind, DepNode, DepNodeExt};\n+pub use dep_node::{dep_constructor, label_strs, DepKind, DepNode, DepNodeExt};\n \n pub type DepGraph = rustc_query_system::dep_graph::DepGraph<DepKind>;\n pub type TaskDeps = rustc_query_system::dep_graph::TaskDeps<DepKind>;"}, {"sha": "f810f6a56a5207cc4d8fac2e957f48288a437397", "filename": "compiler/rustc_middle/src/mir/mono.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5fcc537d181f5f2176ec144d277e93ec92b39085/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmono.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5fcc537d181f5f2176ec144d277e93ec92b39085/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmono.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmono.rs?ref=5fcc537d181f5f2176ec144d277e93ec92b39085", "patch": "@@ -1,4 +1,4 @@\n-use crate::dep_graph::{DepConstructor, DepNode, WorkProduct, WorkProductId};\n+use crate::dep_graph::{dep_constructor, DepNode, WorkProduct, WorkProductId};\n use crate::ich::{NodeIdHashingMode, StableHashingContext};\n use crate::ty::{subst::InternalSubsts, Instance, InstanceDef, SymbolName, TyCtxt};\n use rustc_attr::InlineAttr;\n@@ -362,7 +362,7 @@ impl<'tcx> CodegenUnit<'tcx> {\n     }\n \n     pub fn codegen_dep_node(&self, tcx: TyCtxt<'tcx>) -> DepNode {\n-        DepConstructor::CompileCodegenUnit(tcx, self.name())\n+        dep_constructor::CompileCodegenUnit(tcx, self.name())\n     }\n }\n "}]}