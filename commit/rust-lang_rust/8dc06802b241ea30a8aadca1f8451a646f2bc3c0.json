{"sha": "8dc06802b241ea30a8aadca1f8451a646f2bc3c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkYzA2ODAyYjI0MWVhMzBhOGFhZGNhMWY4NDUxYTY0NmYyYmMzYzA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-02-06T06:46:33Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-02-06T06:46:33Z"}, "message": "auto merge of #12054 : alexcrichton/rust/less-flaky-udp, r=brson\n\nI have a hunch this just deadlocked the windows bots. Due to UDP being a lossy\r\nprotocol, I don't think we can guarantee that the server can receive both\r\npackets, so just listen for one of them.", "tree": {"sha": "36637b8b21209a35a856c32a5c7b789c0dd7e4e5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36637b8b21209a35a856c32a5c7b789c0dd7e4e5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8dc06802b241ea30a8aadca1f8451a646f2bc3c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8dc06802b241ea30a8aadca1f8451a646f2bc3c0", "html_url": "https://github.com/rust-lang/rust/commit/8dc06802b241ea30a8aadca1f8451a646f2bc3c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8dc06802b241ea30a8aadca1f8451a646f2bc3c0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9a672f98e5a7bef086cb56420b095daeeb7ef1ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/9a672f98e5a7bef086cb56420b095daeeb7ef1ea", "html_url": "https://github.com/rust-lang/rust/commit/9a672f98e5a7bef086cb56420b095daeeb7ef1ea"}, {"sha": "7b81cc09c14920f3a39362a22ed3a747eb2d8527", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b81cc09c14920f3a39362a22ed3a747eb2d8527", "html_url": "https://github.com/rust-lang/rust/commit/7b81cc09c14920f3a39362a22ed3a747eb2d8527"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "ae99101e17963196dfc91629c7f64410b8c8c378", "filename": "src/libstd/io/net/udp.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/8dc06802b241ea30a8aadca1f8451a646f2bc3c0/src%2Flibstd%2Fio%2Fnet%2Fudp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8dc06802b241ea30a8aadca1f8451a646f2bc3c0/src%2Flibstd%2Fio%2Fnet%2Fudp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fnet%2Fudp.rs?ref=8dc06802b241ea30a8aadca1f8451a646f2bc3c0", "patch": "@@ -335,17 +335,18 @@ mod test {\n         let sock2 = UdpSocket::bind(addr2).unwrap();\n \n         let (p, c) = SharedChan::new();\n+        let (serv_port, serv_chan) = Chan::new();\n \n         spawn(proc() {\n             let mut sock2 = sock2;\n             let mut buf = [0, 1];\n \n-            for _ in p.iter() {\n-                match sock2.recvfrom(buf) {\n-                    Ok(..) => {}\n-                    Err(e) => fail!(\"failed receive: {}\", e),\n-                }\n+            p.recv();\n+            match sock2.recvfrom(buf) {\n+                Ok(..) => {}\n+                Err(e) => fail!(\"failed receive: {}\", e),\n             }\n+            serv_chan.send(());\n         });\n \n         let sock3 = sock1.clone();\n@@ -355,16 +356,18 @@ mod test {\n         spawn(proc() {\n             let mut sock3 = sock3;\n             match sock3.sendto([1], addr2) {\n-                Ok(..) => c2.send(()),\n+                Ok(..) => { let _ = c2.try_send(()); }\n                 Err(..) => {}\n             }\n             done.send(());\n         });\n         match sock1.sendto([2], addr2) {\n-            Ok(..) => c.send(()),\n+            Ok(..) => { let _ = c.try_send(()); }\n             Err(..) => {}\n         }\n+        drop(c);\n \n         p.recv();\n+        serv_port.recv();\n     })\n }"}]}