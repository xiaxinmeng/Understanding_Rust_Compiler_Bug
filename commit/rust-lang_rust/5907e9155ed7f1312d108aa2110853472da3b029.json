{"sha": "5907e9155ed7f1312d108aa2110853472da3b029", "node_id": "C_kwDOAAsO6NoAKDU5MDdlOTE1NWVkN2YxMzEyZDEwOGFhMjExMDg1MzQ3MmRhM2IwMjk", "commit": {"author": {"name": "ozkanonur", "email": "work@onurozkan.dev", "date": "2022-11-19T23:40:31Z"}, "committer": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2022-11-21T19:02:20Z"}, "message": "pass clippy sysroot env if given r=ozkanonur\n\nSigned-off-by: ozkanonur <work@onurozkan.dev>", "tree": {"sha": "92537843053c3a09b5d5c8cf02e33558bbf50a58", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/92537843053c3a09b5d5c8cf02e33558bbf50a58"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5907e9155ed7f1312d108aa2110853472da3b029", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmN7yzwACgkQHKDfKvWd\naKV3DhAAn8pNlmIMduLRxdZw+zuaop0mBgkWHxNc8x7q1S281ofaYpERYFmyRxJJ\nZDwbTxGxp/1u+XlWnbTa67BnOWe36U5KbrPpeVmfqKsBuRMfI3xLcZ/LtXrhqe4b\n+kNZjrayLgxd7qr67CBB9+DhqerhIOW3K4hJqCWDdlACHSVlLvLc1vzEkQe2uYa+\nvVRHLceBkHYuN8zZzXQOvgpDO4S+XIaCgLvj/0vDlrzKyt8C+S0+1sQj3x5L9FKQ\nhSAV+gYm0pLoLk3crbUdB4/ZQrOhEOFTU/gwuc9j/txIXvxFpIOkxISue2AJrRjL\nmY7rnv/LESO1U/NoVkpCgni/YBHZfvk5h0Jw9weNcPtGS1u/+gaw+FPUGot6OtDo\nUZ+zWhopFTrtawXKeickxPMk5qrDKENGGOfnMbjs8FvMNg87JimC7HtWMWEjM6Cm\nf/cgCe2Lgv4AVNNBAQZARQXgyRuKRnCoZ1L83jIgr7g7zY9y94PH4LGekOFmsJIj\nz77A95yDWN7n4yf05G4aTSLhCpQUyqpeHzb3JQxTIDhqZB8nFHALSG7szu7KYf9W\nkKwVTjg1TkaQE9lDOC5uHyWT1miWyAdYKlc/w3KzU+XwoVo6zZ+pLkoO0oLJGwL3\nfmvOR/IhFKRITW5Z0bJZo43AiZU8xfsEsVSuldcJrcqkaN/ym98=\n=zQAV\n-----END PGP SIGNATURE-----", "payload": "tree 92537843053c3a09b5d5c8cf02e33558bbf50a58\nparent 661f13ce3b34dd2eb5bd0422ab464d41b725fc47\nauthor ozkanonur <work@onurozkan.dev> 1668901231 +0300\ncommitter Philipp Krones <hello@philkrones.com> 1669057340 +0100\n\npass clippy sysroot env if given r=ozkanonur\n\nSigned-off-by: ozkanonur <work@onurozkan.dev>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5907e9155ed7f1312d108aa2110853472da3b029", "html_url": "https://github.com/rust-lang/rust/commit/5907e9155ed7f1312d108aa2110853472da3b029", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5907e9155ed7f1312d108aa2110853472da3b029/comments", "author": {"login": "ozkanonur", "id": 39852038, "node_id": "MDQ6VXNlcjM5ODUyMDM4", "avatar_url": "https://avatars.githubusercontent.com/u/39852038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ozkanonur", "html_url": "https://github.com/ozkanonur", "followers_url": "https://api.github.com/users/ozkanonur/followers", "following_url": "https://api.github.com/users/ozkanonur/following{/other_user}", "gists_url": "https://api.github.com/users/ozkanonur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ozkanonur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ozkanonur/subscriptions", "organizations_url": "https://api.github.com/users/ozkanonur/orgs", "repos_url": "https://api.github.com/users/ozkanonur/repos", "events_url": "https://api.github.com/users/ozkanonur/events{/privacy}", "received_events_url": "https://api.github.com/users/ozkanonur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "661f13ce3b34dd2eb5bd0422ab464d41b725fc47", "url": "https://api.github.com/repos/rust-lang/rust/commits/661f13ce3b34dd2eb5bd0422ab464d41b725fc47", "html_url": "https://github.com/rust-lang/rust/commit/661f13ce3b34dd2eb5bd0422ab464d41b725fc47"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "ee2a3ad20d3e5b0d77b0819ddd44bd2271c376ec", "filename": "src/driver.rs", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/5907e9155ed7f1312d108aa2110853472da3b029/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5907e9155ed7f1312d108aa2110853472da3b029/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=5907e9155ed7f1312d108aa2110853472da3b029", "patch": "@@ -252,14 +252,24 @@ pub fn main() {\n     exit(rustc_driver::catch_with_exit_code(move || {\n         let mut orig_args: Vec<String> = env::args().collect();\n \n+        let sys_root_env = std::env::var(\"SYSROOT\").ok();\n+        let pass_sysroot_env_if_given = |args: &mut Vec<String>, sys_root_env| {\n+            if let Some(sys_root) = sys_root_env {\n+                args.extend(vec![\"--sysroot\".into(), sys_root]);\n+            };\n+        };\n+\n         // make \"clippy-driver --rustc\" work like a subcommand that passes further args to \"rustc\"\n         // for example `clippy-driver --rustc --version` will print the rustc version that clippy-driver\n         // uses\n         if let Some(pos) = orig_args.iter().position(|arg| arg == \"--rustc\") {\n             orig_args.remove(pos);\n             orig_args[0] = \"rustc\".to_string();\n \n-            return rustc_driver::RunCompiler::new(&orig_args, &mut DefaultCallbacks).run();\n+            let mut args: Vec<String> = orig_args.clone();\n+            pass_sysroot_env_if_given(&mut args, sys_root_env);\n+\n+            return rustc_driver::RunCompiler::new(&args, &mut DefaultCallbacks).run();\n         }\n \n         if orig_args.iter().any(|a| a == \"--version\" || a == \"-V\") {\n@@ -282,6 +292,9 @@ pub fn main() {\n             exit(0);\n         }\n \n+        let mut args: Vec<String> = orig_args.clone();\n+        pass_sysroot_env_if_given(&mut args, sys_root_env);\n+\n         let mut no_deps = false;\n         let clippy_args_var = env::var(\"CLIPPY_ARGS\").ok();\n         let clippy_args = clippy_args_var\n@@ -310,11 +323,10 @@ pub fn main() {\n \n         let clippy_enabled = !cap_lints_allow && (!no_deps || in_primary_package);\n         if clippy_enabled {\n-            let mut args: Vec<String> = orig_args.clone();\n             args.extend(clippy_args);\n             rustc_driver::RunCompiler::new(&args, &mut ClippyCallbacks { clippy_args_var }).run()\n         } else {\n-            rustc_driver::RunCompiler::new(&orig_args, &mut RustcCallbacks { clippy_args_var }).run()\n+            rustc_driver::RunCompiler::new(&args, &mut RustcCallbacks { clippy_args_var }).run()\n         }\n     }))\n }"}]}