{"sha": "cda5becc27cbc7106646fbc40aacea5e7896d954", "node_id": "C_kwDOAAsO6NoAKGNkYTViZWNjMjdjYmM3MTA2NjQ2ZmJjNDBhYWNlYTVlNzg5NmQ5NTQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-23T07:27:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-23T07:27:51Z"}, "message": "Auto merge of #110519 - loongarch-rs:ci, r=Mark-Simulacrum\n\nci: Add support for dist-loongarch64-linux\n\nWe are preparing to promote loongarch64-unknown-linux-gnu to Tier 2, and one of the tasks is to add CI support. We are currently in the process of upgrading the dependencies for the build tools, and before this is completed, we would like to request comments. Thanks\n\n#### Progress\n\n- [x] Update linux-raw-sys to 0.3.2 (rust-lang/cargo#11998)\n- [x] Update openssl-src to 111.25.3+1.1.1t (rust-lang/cargo#12005)\n- [x] bootstrap: Update linux-raw-sys to 0.3.2 (rust-lang/rust#110516)\n- [x] Update linux-raw-sys to 0.3.4 (rust-lang/rust#110518)\n- [x] Update cargo (rust-lang/rust#110834)\n- [x] linux_like: Add missing constants for loongarch64 (rust-lang/libc#3237)\n- [x] Release 0.2.143 (rust-lang/libc#3236)\n- [x] Update libc to 0.2.144 (rust-lang/cargo#12098)\n- [x] Update cargo (rust-lang/rust#111456)\n\nTier 2 with host tools MCP: https://github.com/rust-lang/compiler-team/issues/518", "tree": {"sha": "21bc75c11a3d10a697288f9677833929b09d8243", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/21bc75c11a3d10a697288f9677833929b09d8243"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cda5becc27cbc7106646fbc40aacea5e7896d954", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cda5becc27cbc7106646fbc40aacea5e7896d954", "html_url": "https://github.com/rust-lang/rust/commit/cda5becc27cbc7106646fbc40aacea5e7896d954", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cda5becc27cbc7106646fbc40aacea5e7896d954/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4400d8fce79ab2a610f05479413397464052e9c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/4400d8fce79ab2a610f05479413397464052e9c0", "html_url": "https://github.com/rust-lang/rust/commit/4400d8fce79ab2a610f05479413397464052e9c0"}, {"sha": "5f173e979f7dfa5dd4cd5284ad6894d600ba2c43", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f173e979f7dfa5dd4cd5284ad6894d600ba2c43", "html_url": "https://github.com/rust-lang/rust/commit/5f173e979f7dfa5dd4cd5284ad6894d600ba2c43"}], "stats": {"total": 84, "additions": 84, "deletions": 0}, "files": [{"sha": "b12a0b855e2e7986b75686a6879a5965924f30bf", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cda5becc27cbc7106646fbc40aacea5e7896d954/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/cda5becc27cbc7106646fbc40aacea5e7896d954/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=cda5becc27cbc7106646fbc40aacea5e7896d954", "patch": "@@ -201,6 +201,9 @@ jobs:\n           - name: dist-i686-linux\n             os: ubuntu-20.04-8core-32gb\n             env: {}\n+          - name: dist-loongarch64-linux\n+            os: ubuntu-20.04-8core-32gb\n+            env: {}\n           - name: dist-mips-linux\n             os: ubuntu-20.04-8core-32gb\n             env: {}"}, {"sha": "e799d7c968893432ab50d3f485335a2bb0501ac8", "filename": "src/ci/docker/README.md", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2FREADME.md?ref=cda5becc27cbc7106646fbc40aacea5e7896d954", "patch": "@@ -257,6 +257,22 @@ For targets: `i586-unknown-linux-gnu`\n (\\*) Compressed debug is enabled by default for gas (assembly) on Linux/x86 targets,\n      but that makes our `compiler_builtins` incompatible with binutils < 2.32.\n \n+### `loongarch64-linux-gnu.defconfig`\n+\n+For targets: `loongarch64-unknown-linux-gnu`\n+\n+- Path and misc options > Prefix directory = /x-tools/${CT\\_TARGET}\n+- Path and misc options > Use a mirror = ENABLE\n+- Path and misc options > Base URL = https://ci-mirrors.rust-lang.org/rustc\n+- Target options > Target Architecture = loongarch\n+- Target options > Bitness = 64-bit\n+- Operating System > Target OS = linux\n+- Operating System > Linux kernel version = 5.19.16\n+- Binary utilities > Version of binutils = 2.40\n+- C-library > glibc version = 2.36\n+- C compiler > gcc version = 12.2.0\n+- C compiler > C++ = ENABLE -- to cross compile LLVM\n+\n ### `mips-linux-gnu.defconfig`\n \n For targets: `mips-unknown-linux-gnu`"}, {"sha": "78689c429c2e39fd8f41c6c29e53ac9dc231ff73", "filename": "src/ci/docker/host-x86_64/dist-loongarch64-linux/Dockerfile", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-loongarch64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-loongarch64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-loongarch64-linux%2FDockerfile?ref=cda5becc27cbc7106646fbc40aacea5e7896d954", "patch": "@@ -0,0 +1,30 @@\n+FROM ubuntu:22.04\n+\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+# The latest released version does not support LoongArch.\n+COPY scripts/crosstool-ng-git.sh /scripts/\n+RUN sh /scripts/crosstool-ng-git.sh\n+\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n+WORKDIR /tmp\n+\n+COPY scripts/crosstool-ng-build.sh /scripts/\n+COPY host-x86_64/dist-loongarch64-linux/loongarch64-unknown-linux-gnu.defconfig /tmp/crosstool.defconfig\n+RUN /scripts/crosstool-ng-build.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n+\n+ENV PATH=$PATH:/x-tools/loongarch64-unknown-linux-gnu/bin\n+\n+ENV CC_loongarch64_unknown_linux_gnu=loongarch64-unknown-linux-gnu-gcc \\\n+    AR_loongarch64_unknown_linux_gnu=loongarch64-unknown-linux-gnu-ar \\\n+    CXX_loongarch64_unknown_linux_gnu=loongarch64-unknown-linux-gnu-g++\n+\n+ENV HOSTS=loongarch64-unknown-linux-gnu\n+\n+ENV RUST_CONFIGURE_ARGS --enable-extended --disable-docs\n+ENV SCRIPT python3 ../x.py dist --host $HOSTS --target $HOSTS"}, {"sha": "576f3631cd53f5bccff71de2a5be2e6c42425d0b", "filename": "src/ci/docker/host-x86_64/dist-loongarch64-linux/loongarch64-unknown-linux-gnu.defconfig", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-loongarch64-linux%2Floongarch64-unknown-linux-gnu.defconfig", "raw_url": "https://github.com/rust-lang/rust/raw/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-loongarch64-linux%2Floongarch64-unknown-linux-gnu.defconfig", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-loongarch64-linux%2Floongarch64-unknown-linux-gnu.defconfig?ref=cda5becc27cbc7106646fbc40aacea5e7896d954", "patch": "@@ -0,0 +1,14 @@\n+CT_CONFIG_VERSION=\"4\"\n+CT_EXPERIMENTAL=y\n+CT_PREFIX_DIR=\"/x-tools/${CT_TARGET}\"\n+CT_USE_MIRROR=y\n+CT_MIRROR_BASE_URL=\"https://ci-mirrors.rust-lang.org/rustc\"\n+CT_ARCH_LOONGARCH=y\n+# CT_DEMULTILIB is not set\n+CT_ARCH_USE_MMU=y\n+CT_ARCH_ARCH=\"loongarch64\"\n+CT_KERNEL_LINUX=y\n+CT_LINUX_V_5_19=y\n+CT_GLIBC_V_2_36=y\n+CT_CC_GCC_ENABLE_DEFAULT_PIE=y\n+CT_CC_LANG_CXX=y"}, {"sha": "398362ca52f22115943bd56bb0c921c1f50eedbe", "filename": "src/ci/docker/scripts/cross-apt-packages.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fscripts%2Fcross-apt-packages.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fscripts%2Fcross-apt-packages.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fcross-apt-packages.sh?ref=cda5becc27cbc7106646fbc40aacea5e7896d954", "patch": "@@ -22,6 +22,7 @@ apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install\n   patch \\\n   pkg-config \\\n   python3 \\\n+  rsync \\\n   sudo \\\n   texinfo \\\n   unzip \\"}, {"sha": "449cc476f9ab5035d674f33d50d04d119445c430", "filename": "src/ci/docker/scripts/crosstool-ng-git.sh", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fscripts%2Fcrosstool-ng-git.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fdocker%2Fscripts%2Fcrosstool-ng-git.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fcrosstool-ng-git.sh?ref=cda5becc27cbc7106646fbc40aacea5e7896d954", "patch": "@@ -0,0 +1,17 @@\n+#!/bin/sh\n+set -ex\n+\n+URL=https://github.com/crosstool-ng/crosstool-ng\n+REV=943364711a650d9b9e84c1b42c91cc0265b6ab5c\n+\n+mkdir crosstool-ng\n+cd crosstool-ng\n+git init\n+git fetch --depth=1 ${URL} ${REV}\n+git reset --hard FETCH_HEAD\n+./bootstrap\n+./configure --prefix=/usr/local\n+make -j$(nproc)\n+make install\n+cd ..\n+rm -rf crosstool-ng"}, {"sha": "fd619467fc153a3fe3d0e742c166b0f342556999", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/cda5becc27cbc7106646fbc40aacea5e7896d954/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=cda5becc27cbc7106646fbc40aacea5e7896d954", "patch": "@@ -359,6 +359,9 @@ jobs:\n           - name: dist-i686-linux\n             <<: *job-linux-8c\n \n+          - name: dist-loongarch64-linux\n+            <<: *job-linux-8c\n+\n           - name: dist-mips-linux\n             <<: *job-linux-8c\n "}]}