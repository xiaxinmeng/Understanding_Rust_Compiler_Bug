{"sha": "72ef85d83e3095222dc83e0c03531e5150d074c9", "node_id": "C_kwDOAAsO6NoAKDcyZWY4NWQ4M2UzMDk1MjIyZGM4M2UwYzAzNTMxZTUxNTBkMDc0Yzk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-04-04T13:23:33Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-04-04T14:03:50Z"}, "message": "Don't collect return-position impl traits for documentation", "tree": {"sha": "750903c78ea87def51b5062291b94e246ebbb760", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/750903c78ea87def51b5062291b94e246ebbb760"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/72ef85d83e3095222dc83e0c03531e5150d074c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/72ef85d83e3095222dc83e0c03531e5150d074c9", "html_url": "https://github.com/rust-lang/rust/commit/72ef85d83e3095222dc83e0c03531e5150d074c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/72ef85d83e3095222dc83e0c03531e5150d074c9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c96e40da81165beef4f273f44e96eeef5a1bd30", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c96e40da81165beef4f273f44e96eeef5a1bd30", "html_url": "https://github.com/rust-lang/rust/commit/7c96e40da81165beef4f273f44e96eeef5a1bd30"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "c959bb3701ab561a10b11d8d3f22c2bc11ef0ebb", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/72ef85d83e3095222dc83e0c03531e5150d074c9/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/72ef85d83e3095222dc83e0c03531e5150d074c9/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=72ef85d83e3095222dc83e0c03531e5150d074c9", "patch": "@@ -421,12 +421,20 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n             | hir::ItemKind::Struct(..)\n             | hir::ItemKind::Union(..)\n             | hir::ItemKind::TyAlias(..)\n-            | hir::ItemKind::OpaqueTy(..)\n+            | hir::ItemKind::OpaqueTy(hir::OpaqueTy {\n+                origin: hir::OpaqueTyOrigin::TyAlias, ..\n+            })\n             | hir::ItemKind::Static(..)\n             | hir::ItemKind::Trait(..)\n             | hir::ItemKind::TraitAlias(..) => {\n                 self.add_to_current_mod(item, renamed, import_id);\n             }\n+            hir::ItemKind::OpaqueTy(hir::OpaqueTy {\n+                origin: hir::OpaqueTyOrigin::AsyncFn(_) | hir::OpaqueTyOrigin::FnReturn(_),\n+                ..\n+            }) => {\n+                // return-position impl traits are never nameable, and should never be documented.\n+            }\n             hir::ItemKind::Const(..) => {\n                 // Underscore constants do not correspond to a nameable item and\n                 // so are never useful in documentation."}, {"sha": "a73e84f3fdc4ebee85b2492f42313351c2334b25", "filename": "tests/rustdoc/async-fn-opaque-item.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/72ef85d83e3095222dc83e0c03531e5150d074c9/tests%2Frustdoc%2Fasync-fn-opaque-item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/72ef85d83e3095222dc83e0c03531e5150d074c9/tests%2Frustdoc%2Fasync-fn-opaque-item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fasync-fn-opaque-item.rs?ref=72ef85d83e3095222dc83e0c03531e5150d074c9", "patch": "@@ -0,0 +1,15 @@\n+// compile-flags: --document-private-items --crate-type=lib\n+// edition: 2021\n+\n+// Issue 109931 -- test against accidentally documenting the `impl Future`\n+// that comes from an async fn desugaring.\n+\n+// Check that we don't document an unnamed opaque type\n+// @!has async_fn_opaque_item/opaque..html\n+\n+// Checking there is only a \"Functions\" header and no \"Opaque types\".\n+// @has async_fn_opaque_item/index.html\n+// @count - '//*[@class=\"small-section-header\"]' 1\n+// @has - '//*[@class=\"small-section-header\"]' 'Functions'\n+\n+pub async fn test() {}"}]}