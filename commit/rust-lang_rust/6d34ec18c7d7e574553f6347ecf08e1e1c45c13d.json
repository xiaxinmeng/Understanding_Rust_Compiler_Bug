{"sha": "6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZkMzRlYzE4YzdkN2U1NzQ1NTNmNjM0N2VjZjA4ZTFlMWM0NWMxM2Q=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-21T01:58:16Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-21T01:58:16Z"}, "message": "Auto merge of #55798 - GuillaumeGomez:version-display-associated-const, r=QuietMisdreavus\n\nAdd version display for associated consts\n\nFixes #54030.\n\n<img width=\"1440\" alt=\"screenshot 2018-11-08 at 23 57 29\" src=\"https://user-images.githubusercontent.com/3050060/48232648-99decf00-e3b2-11e8-9f41-6bd12a161c7d.png\">\n\nr? @QuietMisdreavus", "tree": {"sha": "1d26c9a416abbac7828a5a6c6f64c2e75638e580", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d26c9a416abbac7828a5a6c6f64c2e75638e580"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "html_url": "https://github.com/rust-lang/rust/commit/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f7c718926ab697f91730a987829658146540413", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f7c718926ab697f91730a987829658146540413", "html_url": "https://github.com/rust-lang/rust/commit/3f7c718926ab697f91730a987829658146540413"}, {"sha": "ca04c639307e700e4684a46ef71d0781b8f35736", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca04c639307e700e4684a46ef71d0781b8f35736", "html_url": "https://github.com/rust-lang/rust/commit/ca04c639307e700e4684a46ef71d0781b8f35736"}], "stats": {"total": 112, "additions": 79, "deletions": 33}, "files": [{"sha": "fdc4d5d75b3d9d41279342b9bd1fcf6ccade3600", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 50, "deletions": 30, "changes": 80, "blob_url": "https://github.com/rust-lang/rust/blob/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "patch": "@@ -3037,15 +3037,14 @@ fn item_trait(\n         let item_type = m.type_();\n         let id = cx.derive_id(format!(\"{}.{}\", item_type, name));\n         let ns_id = cx.derive_id(format!(\"{}.{}\", name, item_type.name_space()));\n-        write!(w, \"{extra}<h3 id='{id}' class='method'>\\\n-                   <span id='{ns_id}' class='invisible'><code>\",\n+        write!(w, \"{extra}<h3 id='{id}' class='method'><code id='{ns_id}'>\",\n                extra = render_spotlight_traits(m)?,\n                id = id,\n                ns_id = ns_id)?;\n         render_assoc_item(w, m, AssocItemLink::Anchor(Some(&id)), ItemType::Impl)?;\n         write!(w, \"</code>\")?;\n         render_stability_since(w, m, t)?;\n-        write!(w, \"</span></h3>\")?;\n+        write!(w, \"</h3>\")?;\n         document(w, cx, m)?;\n         Ok(())\n     }\n@@ -3237,13 +3236,14 @@ fn assoc_type<W: fmt::Write>(w: &mut W, it: &clean::Item,\n     Ok(())\n }\n \n-fn render_stability_since_raw<'a>(w: &mut fmt::Formatter,\n-                                  ver: Option<&'a str>,\n-                                  containing_ver: Option<&'a str>) -> fmt::Result {\n+fn render_stability_since_raw<'a, T: fmt::Write>(\n+    w: &mut T,\n+    ver: Option<&'a str>,\n+    containing_ver: Option<&'a str>,\n+) -> fmt::Result {\n     if let Some(v) = ver {\n         if containing_ver != ver && v.len() > 0 {\n-            write!(w, \"<div class='since' title='Stable since Rust version {0}'>{0}</div>\",\n-                   v)?\n+            write!(w, \"<div class='since' title='Stable since Rust version {0}'>{0}</div>\", v)?\n         }\n     }\n     Ok(())\n@@ -3373,11 +3373,10 @@ fn item_struct(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n                 let ns_id = cx.derive_id(format!(\"{}.{}\",\n                                               field.name.as_ref().unwrap(),\n                                               ItemType::StructField.name_space()));\n-                write!(w, \"<span id=\\\"{id}\\\" class=\\\"{item_type} small-section-header\\\">\n-                           <a href=\\\"#{id}\\\" class=\\\"anchor field\\\"></a>\n-                           <span id=\\\"{ns_id}\\\" class='invisible'>\n-                           <code>{name}: {ty}</code>\n-                           </span></span>\",\n+                write!(w, \"<span id=\\\"{id}\\\" class=\\\"{item_type} small-section-header\\\">\\\n+                           <a href=\\\"#{id}\\\" class=\\\"anchor field\\\"></a>\\\n+                           <code id=\\\"{ns_id}\\\">{name}: {ty}</code>\\\n+                           </span>\",\n                        item_type = ItemType::StructField,\n                        id = id,\n                        ns_id = ns_id,\n@@ -3509,7 +3508,7 @@ fn item_enum(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n                                           ItemType::Variant.name_space()));\n             write!(w, \"<span id=\\\"{id}\\\" class=\\\"variant small-section-header\\\">\\\n                        <a href=\\\"#{id}\\\" class=\\\"anchor field\\\"></a>\\\n-                       <span id='{ns_id}' class='invisible'><code>{name}\",\n+                       <code id='{ns_id}'>{name}\",\n                    id = id,\n                    ns_id = ns_id,\n                    name = variant.name.as_ref().unwrap())?;\n@@ -3525,7 +3524,7 @@ fn item_enum(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n                     write!(w, \")\")?;\n                 }\n             }\n-            write!(w, \"</code></span></span>\")?;\n+            write!(w, \"</code></span>\")?;\n             document(w, cx, variant)?;\n \n             use clean::{Variant, VariantKind};\n@@ -3552,8 +3551,8 @@ fn item_enum(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n                                                       ItemType::StructField.name_space()));\n                         write!(w, \"<span id=\\\"{id}\\\" class=\\\"variant small-section-header\\\">\\\n                                    <a href=\\\"#{id}\\\" class=\\\"anchor field\\\"></a>\\\n-                                   <span id='{ns_id}' class='invisible'><code>{f}:&nbsp;{t}\\\n-                                   </code></span></span>\",\n+                                   <code id='{ns_id}'>{f}:&nbsp;{t}\\\n+                                   </code></span>\",\n                                id = id,\n                                ns_id = ns_id,\n                                f = field.name.as_ref().unwrap(),\n@@ -3998,7 +3997,7 @@ fn render_impl(w: &mut fmt::Formatter, cx: &Context, i: &Impl, link: AssocItemLi\n                    id, i.inner_impl())?;\n         }\n         write!(w, \"<a href='#{}' class='anchor'></a>\", id)?;\n-        write!(w, \"</span></td><td><span class='out-of-band'>\")?;\n+        write!(w, \"</td><td><span class='out-of-band'>\")?;\n         let since = i.impl_item.stability.as_ref().map(|s| &s.since[..]);\n         if let Some(l) = (Item { item: &i.impl_item, cx: cx }).src_href() {\n             write!(w, \"<div class='ghost'></div>\")?;\n@@ -4008,7 +4007,7 @@ fn render_impl(w: &mut fmt::Formatter, cx: &Context, i: &Impl, link: AssocItemLi\n         } else {\n             render_stability_since_raw(w, since, outer_version)?;\n         }\n-        write!(w, \"</span></td></tr></tbody></table></h3>\")?;\n+        write!(w, \"</span></td></tr></tbody></table></span></h3>\")?;\n         if let Some(ref dox) = cx.shared.maybe_collapsed_doc_value(&i.impl_item) {\n             let mut ids = cx.id_map.borrow_mut();\n             write!(w, \"<div class='docblock'>{}</div>\",\n@@ -4044,52 +4043,73 @@ fn render_impl(w: &mut fmt::Formatter, cx: &Context, i: &Impl, link: AssocItemLi\n                     let ns_id = cx.derive_id(format!(\"{}.{}\", name, item_type.name_space()));\n                     write!(w, \"<h4 id='{}' class=\\\"{}{}\\\">\", id, item_type, extra_class)?;\n                     write!(w, \"{}\", spotlight_decl(decl)?)?;\n-                    write!(w, \"<span id='{}' class='invisible'>\", ns_id)?;\n-                    write!(w, \"<table class='table-display'><tbody><tr><td><code>\")?;\n+                    write!(w, \"<table id='{}' class='table-display'><tbody><tr><td><code>\", ns_id)?;\n                     render_assoc_item(w, item, link.anchor(&id), ItemType::Impl)?;\n                     write!(w, \"</code>\")?;\n                     if let Some(l) = (Item { cx, item }).src_href() {\n-                        write!(w, \"</span></td><td><span class='out-of-band'>\")?;\n+                        write!(w, \"</td><td><span class='out-of-band'>\")?;\n                         write!(w, \"<div class='ghost'></div>\")?;\n                         render_stability_since_raw(w, item.stable_since(), outer_version)?;\n-                        write!(w, \"<a class='srclink' href='{}' title='{}'>[src]</a>\",\n+                        write!(w, \"<a class='srclink' href='{}' title='{}'>[src]</a></span>\",\n                                l, \"goto source code\")?;\n                     } else {\n                         write!(w, \"</td><td>\")?;\n                         render_stability_since_raw(w, item.stable_since(), outer_version)?;\n                     }\n-                    write!(w, \"</td></tr></tbody></table></span></h4>\")?;\n+                    write!(w, \"</td></tr></tbody></table></h4>\")?;\n                 }\n             }\n             clean::TypedefItem(ref tydef, _) => {\n                 let id = cx.derive_id(format!(\"{}.{}\", ItemType::AssociatedType, name));\n                 let ns_id = cx.derive_id(format!(\"{}.{}\", name, item_type.name_space()));\n                 write!(w, \"<h4 id='{}' class=\\\"{}{}\\\">\", id, item_type, extra_class)?;\n-                write!(w, \"<span id='{}' class='invisible'><code>\", ns_id)?;\n+                write!(w, \"<code id='{}'>\", ns_id)?;\n                 assoc_type(w, item, &Vec::new(), Some(&tydef.type_), link.anchor(&id))?;\n-                write!(w, \"</code></span></h4>\\n\")?;\n+                write!(w, \"</code></h4>\")?;\n             }\n             clean::AssociatedConstItem(ref ty, ref default) => {\n+                let mut version = String::new();\n+\n+                render_stability_since_raw(&mut version, item.stable_since(), outer_version)?;\n+\n                 let id = cx.derive_id(format!(\"{}.{}\", item_type, name));\n                 let ns_id = cx.derive_id(format!(\"{}.{}\", name, item_type.name_space()));\n                 write!(w, \"<h4 id='{}' class=\\\"{}{}\\\">\", id, item_type, extra_class)?;\n-                write!(w, \"<span id='{}' class='invisible'><code>\", ns_id)?;\n+                if !version.is_empty() {\n+                    write!(w, \"<table id='{}' class='table-display'><tbody><tr><td><code>\", ns_id)?;\n+                } else {\n+                    write!(w, \"<code id='{}'>\", ns_id)?;\n+                }\n                 assoc_const(w, item, ty, default.as_ref(), link.anchor(&id))?;\n+                if !version.is_empty() {\n+                    write!(w, \"</code>\")?;\n+                }\n                 let src = if let Some(l) = (Item { cx, item }).src_href() {\n+                    if !version.is_empty() {\n+                        write!(w, \"</td><td><span class='out-of-band'>\")?;\n+                        write!(w, \"<div class='ghost'></div>{}\", version)?;\n+                    }\n                     format!(\"<a class='srclink' href='{}' title='{}'>[src]</a>\",\n                             l, \"goto source code\")\n                 } else {\n+                    if !version.is_empty() {\n+                        write!(w, \"</td><td>{}\", version)?;\n+                    }\n                     String::new()\n                 };\n-                write!(w, \"</code>{}</span></h4>\\n\", src)?;\n+                if version.is_empty() {\n+                    write!(w, \"</code>{}</h4>\", src)?;\n+                } else {\n+                    write!(w, \"{}</span></td></tr></tbody></table></h4>\", src)?;\n+                }\n             }\n             clean::AssociatedTypeItem(ref bounds, ref default) => {\n                 let id = cx.derive_id(format!(\"{}.{}\", item_type, name));\n                 let ns_id = cx.derive_id(format!(\"{}.{}\", name, item_type.name_space()));\n                 write!(w, \"<h4 id='{}' class=\\\"{}{}\\\">\", id, item_type, extra_class)?;\n-                write!(w, \"<span id='{}' class='invisible'><code>\", ns_id)?;\n+                write!(w, \"<code id='{}'>\", ns_id)?;\n                 assoc_type(w, item, bounds, default.as_ref(), link.anchor(&id))?;\n-                write!(w, \"</code></span></h4>\\n\")?;\n+                write!(w, \"</code></h4>\")?;\n             }\n             clean::StrippedItem(..) => return Ok(()),\n             _ => panic!(\"can't make docs for trait item with name {:?}\", item.name)"}, {"sha": "7a3682503f7a5eae646e8780eb25ee859e33ba6b", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "patch": "@@ -611,7 +611,7 @@ a {\n \ttext-decoration: underline;\n }\n \n-.invisible > .srclink {\n+.invisible > .srclink, h4 > code + .srclink {\n \tposition: absolute;\n \ttop: 0;\n \tright: 0;"}, {"sha": "2295be2725814dc79fa5f426fe92b4abd24bb5a6", "filename": "src/test/rustdoc/assoc-consts-version.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Ftest%2Frustdoc%2Fassoc-consts-version.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Ftest%2Frustdoc%2Fassoc-consts-version.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fassoc-consts-version.rs?ref=6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// ignore-tidy-linelength\n+\n+#![crate_name = \"foo\"]\n+\n+#![feature(staged_api)]\n+\n+#![stable(since=\"1.1.1\", feature=\"rust1\")]\n+\n+#[stable(since=\"1.1.1\", feature=\"rust1\")]\n+pub struct SomeStruct;\n+\n+impl SomeStruct {\n+    // @has 'foo/struct.SomeStruct.html' '//*[@id=\"SOME_CONST.v\"]//div[@class=\"since\"]' '1.1.2'\n+    #[stable(since=\"1.1.2\", feature=\"rust2\")]\n+    pub const SOME_CONST: usize = 0;\n+}"}, {"sha": "100bf7af0e9b307d0d199892b02fae9d204a1993", "filename": "src/test/rustdoc/assoc-types.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Ftest%2Frustdoc%2Fassoc-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d/src%2Ftest%2Frustdoc%2Fassoc-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fassoc-types.rs?ref=6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "patch": "@@ -15,9 +15,9 @@\n // @has assoc_types/trait.Index.html\n pub trait Index<I: ?Sized> {\n     // @has - '//*[@id=\"associatedtype.Output\"]//code' 'type Output: ?Sized'\n-    // @has - '//*[@id=\"Output.t\"]//code' 'type Output: ?Sized'\n+    // @has - '//code[@id=\"Output.t\"]' 'type Output: ?Sized'\n     type Output: ?Sized;\n-    // @has - '//*[@id=\"index.v\"]//code' 'fn index'\n+    // @has - '//code[@id=\"index.v\"]' 'fn index'\n     // @has - '//*[@id=\"tymethod.index\"]//code' \\\n     //      \"fn index<'a>(&'a self, index: I) -> &'a Self::Output\"\n     // @has - '//*[@id=\"tymethod.index\"]//code//a[@href=\"../assoc_types/trait.Index.html#associatedtype.Output\"]' \\"}]}