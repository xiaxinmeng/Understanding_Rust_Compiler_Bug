{"sha": "9a1d6174c925f54c923599e29b09d6855e6b3a78", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhMWQ2MTc0YzkyNWY1NGM5MjM1OTllMjliMDlkNjg1NWU2YjNhNzg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-06T18:03:37Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-06T18:03:37Z"}, "message": "Auto merge of #81832 - jonas-schievink:rollup-3nw53p0, r=jonas-schievink\n\nRollup of 7 pull requests\n\nSuccessful merges:\n\n - #81402 (tidy: Run tidy style against markdown files.)\n - #81434 (BTree: fix documentation of unstable public members)\n - #81680 (Refactor `PrimitiveTypeTable` for Clippy)\n - #81737 (typeck: Emit structured suggestions for tuple struct syntax)\n - #81738 (Miscellaneous small diagnostics cleanup)\n - #81766 (Enable 'task list' markdown extension)\n - #81812 (Add a test for escaping LLVMisms in inline asm)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "2ca8e1e75d3b3cfc7863479ae00e21ce86f33277", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2ca8e1e75d3b3cfc7863479ae00e21ce86f33277"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a1d6174c925f54c923599e29b09d6855e6b3a78", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a1d6174c925f54c923599e29b09d6855e6b3a78", "html_url": "https://github.com/rust-lang/rust/commit/9a1d6174c925f54c923599e29b09d6855e6b3a78", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a1d6174c925f54c923599e29b09d6855e6b3a78/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37d067f5d71331d909102d142ecc50f577e07ae4", "url": "https://api.github.com/repos/rust-lang/rust/commits/37d067f5d71331d909102d142ecc50f577e07ae4", "html_url": "https://github.com/rust-lang/rust/commit/37d067f5d71331d909102d142ecc50f577e07ae4"}, {"sha": "11e7897eae7aaee59c257e85f12d2cfbcd8ebd97", "url": "https://api.github.com/repos/rust-lang/rust/commits/11e7897eae7aaee59c257e85f12d2cfbcd8ebd97", "html_url": "https://github.com/rust-lang/rust/commit/11e7897eae7aaee59c257e85f12d2cfbcd8ebd97"}], "stats": {"total": 646, "additions": 376, "deletions": 270}, "files": [{"sha": "49d9e3b60b49214955d26d90c9eed6156d4c4f8c", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -2058,6 +2058,28 @@ pub enum PrimTy {\n }\n \n impl PrimTy {\n+    /// All of the primitive types\n+    pub const ALL: [Self; 17] = [\n+        // any changes here should also be reflected in `PrimTy::from_name`\n+        Self::Int(IntTy::I8),\n+        Self::Int(IntTy::I16),\n+        Self::Int(IntTy::I32),\n+        Self::Int(IntTy::I64),\n+        Self::Int(IntTy::I128),\n+        Self::Int(IntTy::Isize),\n+        Self::Uint(UintTy::U8),\n+        Self::Uint(UintTy::U16),\n+        Self::Uint(UintTy::U32),\n+        Self::Uint(UintTy::U64),\n+        Self::Uint(UintTy::U128),\n+        Self::Uint(UintTy::Usize),\n+        Self::Float(FloatTy::F32),\n+        Self::Float(FloatTy::F64),\n+        Self::Bool,\n+        Self::Char,\n+        Self::Str,\n+    ];\n+\n     pub fn name_str(self) -> &'static str {\n         match self {\n             PrimTy::Int(i) => i.name_str(),\n@@ -2079,6 +2101,33 @@ impl PrimTy {\n             PrimTy::Char => sym::char,\n         }\n     }\n+\n+    /// Returns the matching `PrimTy` for a `Symbol` such as \"str\" or \"i32\".\n+    /// Returns `None` if no matching type is found.\n+    pub fn from_name(name: Symbol) -> Option<Self> {\n+        let ty = match name {\n+            // any changes here should also be reflected in `PrimTy::ALL`\n+            sym::i8 => Self::Int(IntTy::I8),\n+            sym::i16 => Self::Int(IntTy::I16),\n+            sym::i32 => Self::Int(IntTy::I32),\n+            sym::i64 => Self::Int(IntTy::I64),\n+            sym::i128 => Self::Int(IntTy::I128),\n+            sym::isize => Self::Int(IntTy::Isize),\n+            sym::u8 => Self::Uint(UintTy::U8),\n+            sym::u16 => Self::Uint(UintTy::U16),\n+            sym::u32 => Self::Uint(UintTy::U32),\n+            sym::u64 => Self::Uint(UintTy::U64),\n+            sym::u128 => Self::Uint(UintTy::U128),\n+            sym::usize => Self::Uint(UintTy::Usize),\n+            sym::f32 => Self::Float(FloatTy::F32),\n+            sym::f64 => Self::Float(FloatTy::F64),\n+            sym::bool => Self::Bool,\n+            sym::char => Self::Char,\n+            sym::str => Self::Str,\n+            _ => return None,\n+        };\n+        Some(ty)\n+    }\n }\n \n #[derive(Debug, HashStable_Generic)]"}, {"sha": "0a7da8c80639c576b44d21ab1ad2a0ff9bbc4faf", "filename": "compiler/rustc_infer/src/infer/lexical_region_resolve/README.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_infer%2Fsrc%2Finfer%2Flexical_region_resolve%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_infer%2Fsrc%2Finfer%2Flexical_region_resolve%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Flexical_region_resolve%2FREADME.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1,4 +1,3 @@\n-\n Lexical Region Resolution was removed in https://github.com/rust-lang/rust/pull/64790.\n \n Rust now uses Non-lexical lifetimes. For more info, please see the [borrowck"}, {"sha": "7493fd68505fea8bb20886b96c878f0515205c4d", "filename": "compiler/rustc_resolve/src/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -9,6 +9,7 @@ use rustc_feature::BUILTIN_ATTRIBUTES;\n use rustc_hir::def::Namespace::{self, *};\n use rustc_hir::def::{self, CtorKind, CtorOf, DefKind, NonMacroAttrKind};\n use rustc_hir::def_id::{DefId, CRATE_DEF_INDEX, LOCAL_CRATE};\n+use rustc_hir::PrimTy;\n use rustc_middle::bug;\n use rustc_middle::ty::{self, DefIdTree};\n use rustc_session::Session;\n@@ -718,10 +719,9 @@ impl<'a> Resolver<'a> {\n                     }\n                 }\n                 Scope::BuiltinTypes => {\n-                    let primitive_types = &this.primitive_type_table.primitive_types;\n-                    suggestions.extend(primitive_types.iter().flat_map(|(name, prim_ty)| {\n+                    suggestions.extend(PrimTy::ALL.iter().filter_map(|prim_ty| {\n                         let res = Res::PrimTy(*prim_ty);\n-                        filter_fn(res).then_some(TypoSuggestion::from_res(*name, res))\n+                        filter_fn(res).then_some(TypoSuggestion::from_res(prim_ty.name(), res))\n                     }))\n                 }\n             }"}, {"sha": "cca40a793dd006cfd2092bb91f97740260f4aa02", "filename": "compiler/rustc_resolve/src/late.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -20,7 +20,7 @@ use rustc_errors::DiagnosticId;\n use rustc_hir::def::Namespace::{self, *};\n use rustc_hir::def::{self, CtorKind, DefKind, PartialRes, PerNS};\n use rustc_hir::def_id::{DefId, CRATE_DEF_INDEX};\n-use rustc_hir::TraitCandidate;\n+use rustc_hir::{PrimTy, TraitCandidate};\n use rustc_middle::{bug, span_bug};\n use rustc_session::lint;\n use rustc_span::symbol::{kw, sym, Ident, Symbol};\n@@ -1927,7 +1927,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n                     self.r.trait_map.insert(id, traits);\n                 }\n \n-                if self.r.primitive_type_table.primitive_types.contains_key(&path[0].ident.name) {\n+                if PrimTy::from_name(path[0].ident.name).is_some() {\n                     let mut std_path = Vec::with_capacity(1 + path.len());\n \n                     std_path.push(Segment::from_ident(Ident::with_dummy_span(sym::std)));\n@@ -2121,13 +2121,9 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n             // The same fallback is used when `a` resolves to nothing.\n             PathResult::Module(ModuleOrUniformRoot::Module(_)) | PathResult::Failed { .. }\n                 if (ns == TypeNS || path.len() > 1)\n-                    && self\n-                        .r\n-                        .primitive_type_table\n-                        .primitive_types\n-                        .contains_key(&path[0].ident.name) =>\n+                    && PrimTy::from_name(path[0].ident.name).is_some() =>\n             {\n-                let prim = self.r.primitive_type_table.primitive_types[&path[0].ident.name];\n+                let prim = PrimTy::from_name(path[0].ident.name).unwrap();\n                 PartialRes::with_unresolved_segments(Res::PrimTy(prim), path.len() - 1)\n             }\n             PathResult::Module(ModuleOrUniformRoot::Module(module)) => {"}, {"sha": "d2a693a568828b4e9f771ba0d5e328c4a9928c82", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1212,8 +1212,8 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n             // Add primitive types to the mix\n             if filter_fn(Res::PrimTy(PrimTy::Bool)) {\n                 names.extend(\n-                    self.r.primitive_type_table.primitive_types.iter().map(|(name, prim_ty)| {\n-                        TypoSuggestion::from_res(*name, Res::PrimTy(*prim_ty))\n+                    PrimTy::ALL.iter().map(|prim_ty| {\n+                        TypoSuggestion::from_res(prim_ty.name(), Res::PrimTy(*prim_ty))\n                     }),\n                 )\n             }"}, {"sha": "2be669a1726a1d7da97609534a7c7f9a0453269c", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 4, "deletions": 43, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -25,7 +25,7 @@ use rustc_arena::{DroplessArena, TypedArena};\n use rustc_ast::node_id::NodeMap;\n use rustc_ast::unwrap_or;\n use rustc_ast::visit::{self, Visitor};\n-use rustc_ast::{self as ast, FloatTy, IntTy, NodeId, UintTy};\n+use rustc_ast::{self as ast, NodeId};\n use rustc_ast::{Crate, CRATE_NODE_ID};\n use rustc_ast::{ItemKind, Path};\n use rustc_ast_lowering::ResolverAstLowering;\n@@ -39,8 +39,7 @@ use rustc_hir::def::Namespace::*;\n use rustc_hir::def::{self, CtorOf, DefKind, NonMacroAttrKind, PartialRes};\n use rustc_hir::def_id::{CrateNum, DefId, DefIdMap, LocalDefId, CRATE_DEF_INDEX};\n use rustc_hir::definitions::{DefKey, DefPathData, Definitions};\n-use rustc_hir::PrimTy::{self, Bool, Char, Float, Int, Str, Uint};\n-use rustc_hir::TraitCandidate;\n+use rustc_hir::{PrimTy, TraitCandidate};\n use rustc_index::vec::IndexVec;\n use rustc_metadata::creader::{CStore, CrateLoader};\n use rustc_middle::hir::exports::ExportMap;\n@@ -834,39 +833,6 @@ impl<'a> NameBinding<'a> {\n     }\n }\n \n-/// Interns the names of the primitive types.\n-///\n-/// All other types are defined somewhere and possibly imported, but the primitive ones need\n-/// special handling, since they have no place of origin.\n-struct PrimitiveTypeTable {\n-    primitive_types: FxHashMap<Symbol, PrimTy>,\n-}\n-\n-impl PrimitiveTypeTable {\n-    fn new() -> PrimitiveTypeTable {\n-        let mut table = FxHashMap::default();\n-\n-        table.insert(sym::bool, Bool);\n-        table.insert(sym::char, Char);\n-        table.insert(sym::f32, Float(FloatTy::F32));\n-        table.insert(sym::f64, Float(FloatTy::F64));\n-        table.insert(sym::isize, Int(IntTy::Isize));\n-        table.insert(sym::i8, Int(IntTy::I8));\n-        table.insert(sym::i16, Int(IntTy::I16));\n-        table.insert(sym::i32, Int(IntTy::I32));\n-        table.insert(sym::i64, Int(IntTy::I64));\n-        table.insert(sym::i128, Int(IntTy::I128));\n-        table.insert(sym::str, Str);\n-        table.insert(sym::usize, Uint(UintTy::Usize));\n-        table.insert(sym::u8, Uint(UintTy::U8));\n-        table.insert(sym::u16, Uint(UintTy::U16));\n-        table.insert(sym::u32, Uint(UintTy::U32));\n-        table.insert(sym::u64, Uint(UintTy::U64));\n-        table.insert(sym::u128, Uint(UintTy::U128));\n-        Self { primitive_types: table }\n-    }\n-}\n-\n #[derive(Debug, Default, Clone)]\n pub struct ExternPreludeEntry<'a> {\n     extern_crate_item: Option<&'a NameBinding<'a>>,\n@@ -912,9 +878,6 @@ pub struct Resolver<'a> {\n     /// \"self-confirming\" import resolutions during import validation.\n     unusable_binding: Option<&'a NameBinding<'a>>,\n \n-    /// The idents for the primitive types.\n-    primitive_type_table: PrimitiveTypeTable,\n-\n     /// Resolutions for nodes that have a single resolution.\n     partial_res_map: NodeMap<PartialRes>,\n     /// Resolutions for import nodes, which have multiple resolutions in different namespaces.\n@@ -1284,8 +1247,6 @@ impl<'a> Resolver<'a> {\n             last_import_segment: false,\n             unusable_binding: None,\n \n-            primitive_type_table: PrimitiveTypeTable::new(),\n-\n             partial_res_map: Default::default(),\n             import_res_map: Default::default(),\n             label_res_map: Default::default(),\n@@ -1994,9 +1955,9 @@ impl<'a> Resolver<'a> {\n         }\n \n         if ns == TypeNS {\n-            if let Some(prim_ty) = self.primitive_type_table.primitive_types.get(&ident.name) {\n+            if let Some(prim_ty) = PrimTy::from_name(ident.name) {\n                 let binding =\n-                    (Res::PrimTy(*prim_ty), ty::Visibility::Public, DUMMY_SP, ExpnId::root())\n+                    (Res::PrimTy(prim_ty), ty::Visibility::Public, DUMMY_SP, ExpnId::root())\n                         .to_name_binding(self.arenas);\n                 return Some(LexicalScopeBinding::Item(binding));\n             }"}, {"sha": "d76db7c645abc25e72d891e8f8937a88ccac4952", "filename": "compiler/rustc_resolve/src/macros.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -21,6 +21,7 @@ use rustc_expand::expand::{AstFragment, Invocation, InvocationKind};\n use rustc_feature::is_builtin_attr_name;\n use rustc_hir::def::{self, DefKind, NonMacroAttrKind};\n use rustc_hir::def_id;\n+use rustc_hir::PrimTy;\n use rustc_middle::middle::stability;\n use rustc_middle::ty;\n use rustc_session::lint::builtin::{SOFT_UNSTABLE, UNUSED_MACROS};\n@@ -796,12 +797,10 @@ impl<'a> Resolver<'a> {\n                         }\n                         result\n                     }\n-                    Scope::BuiltinTypes => {\n-                        match this.primitive_type_table.primitive_types.get(&ident.name).cloned() {\n-                            Some(prim_ty) => ok(Res::PrimTy(prim_ty), DUMMY_SP, this.arenas),\n-                            None => Err(Determinacy::Determined),\n-                        }\n-                    }\n+                    Scope::BuiltinTypes => match PrimTy::from_name(ident.name) {\n+                        Some(prim_ty) => ok(Res::PrimTy(prim_ty), DUMMY_SP, this.arenas),\n+                        None => Err(Determinacy::Determined),\n+                    },\n                 };\n \n                 match result {"}, {"sha": "b1ac02d9fed5a0175ee2c03c9d95fefbc10c2891", "filename": "compiler/rustc_trait_selection/src/traits/const_evaluatable.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -117,7 +117,7 @@ pub fn is_const_evaluatable<'cx, 'tcx>(\n                         {\n                             err.span_help(\n                                 tcx.def_span(def.did),\n-                                &format!(\"try adding a `where` bound using this expression: where [u8; {}]: Sized\", snippet),\n+                                &format!(\"try adding a `where` bound using this expression: `where [u8; {}]: Sized`\", snippet),\n                             );\n                         } else {\n                             err.span_help("}, {"sha": "756281450d723a261ed3e394a640481d7996a331", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1780,7 +1780,7 @@ impl<'a, 'tcx> InferCtxtPrivExt<'tcx> for InferCtxt<'a, 'tcx> {\n                             multispan.push_span_label(\n                                 sp,\n                                 format!(\n-                                    \"...if indirection was used here: `Box<{}>`\",\n+                                    \"...if indirection were used here: `Box<{}>`\",\n                                     param.name.ident(),\n                                 ),\n                             );"}, {"sha": "34bd332951c06ae9a8ac343250cb273d5df8101a", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1103,7 +1103,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                 // This is currently not possible to trigger because E0038 takes precedence, but\n                 // leave it in for completeness in case anything changes in an earlier stage.\n                 err.note(&format!(\n-                    \"if trait `{}` was object safe, you could return a trait object\",\n+                    \"if trait `{}` were object-safe, you could return a trait object\",\n                     trait_obj,\n                 ));\n             }"}, {"sha": "1a11aad1441ee548581d8c8727731097c85c1093", "filename": "compiler/rustc_typeck/src/check/expr.rs", "status": "modified", "additions": 14, "deletions": 9, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1460,28 +1460,33 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         ),\n                     );\n                     err.span_label(field.ident.span, \"field does not exist\");\n-                    err.span_label(\n+                    err.span_suggestion(\n                         ty_span,\n+                        &format!(\n+                            \"`{adt}::{variant}` is a tuple {kind_name}, use the appropriate syntax\",\n+                            adt = ty,\n+                            variant = variant.ident,\n+                        ),\n                         format!(\n-                            \"`{adt}::{variant}` is a tuple {kind_name}, \\\n-                             use the appropriate syntax: `{adt}::{variant}(/* fields */)`\",\n+                            \"{adt}::{variant}(/* fields */)\",\n                             adt = ty,\n                             variant = variant.ident,\n-                            kind_name = kind_name\n                         ),\n+                        Applicability::HasPlaceholders,\n                     );\n                 }\n                 _ => {\n                     err.span_label(variant.ident.span, format!(\"`{adt}` defined here\", adt = ty));\n                     err.span_label(field.ident.span, \"field does not exist\");\n-                    err.span_label(\n+                    err.span_suggestion(\n                         ty_span,\n-                        format!(\n-                            \"`{adt}` is a tuple {kind_name}, \\\n-                                 use the appropriate syntax: `{adt}(/* fields */)`\",\n+                        &format!(\n+                            \"`{adt}` is a tuple {kind_name}, use the appropriate syntax\",\n                             adt = ty,\n-                            kind_name = kind_name\n+                            kind_name = kind_name,\n                         ),\n+                        format!(\"{adt}(/* fields */)\", adt = ty),\n+                        Applicability::HasPlaceholders,\n                     );\n                 }\n             },"}, {"sha": "229127e95d93c95dc486598a69c6382e760f7349", "filename": "compiler/rustc_typeck/src/check/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -838,7 +838,7 @@ fn missing_items_err(\n     // Obtain the level of indentation ending in `sugg_sp`.\n     let indentation = tcx.sess.source_map().span_to_margin(sugg_sp).unwrap_or(0);\n     // Make the whitespace that will make the suggestion have the right indentation.\n-    let padding: String = (0..indentation).map(|_| \" \").collect();\n+    let padding: String = std::iter::repeat(\" \").take(indentation).collect();\n \n     for trait_item in missing_items {\n         let snippet = suggestion_signature(&trait_item, tcx);"}, {"sha": "d5352a877a34482e8bcb49a3ea9b75ec23afb482", "filename": "library/alloc/src/collections/btree/map.rs", "status": "modified", "additions": 17, "deletions": 15, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1151,21 +1151,23 @@ impl<K, V> BTreeMap<K, V> {\n         right\n     }\n \n-    /// Creates an iterator which uses a closure to determine if an element should be removed.\n-    ///\n-    /// If the closure returns true, the element is removed from the map and yielded.\n-    /// If the closure returns false, or panics, the element remains in the map and will not be\n-    /// yielded.\n-    ///\n-    /// Note that `drain_filter` lets you mutate every value in the filter closure, regardless of\n-    /// whether you choose to keep or remove it.\n-    ///\n-    /// If the iterator is only partially consumed or not consumed at all, each of the remaining\n-    /// elements will still be subjected to the closure and removed and dropped if it returns true.\n-    ///\n-    /// It is unspecified how many more elements will be subjected to the closure\n-    /// if a panic occurs in the closure, or a panic occurs while dropping an element,\n-    /// or if the `DrainFilter` value is leaked.\n+    /// Creates an iterator that visits all elements (key-value pairs) in\n+    /// ascending key order and uses a closure to determine if an element should\n+    /// be removed. If the closure returns `true`, the element is removed from\n+    /// the map and yielded. If the closure returns `false`, or panics, the\n+    /// element remains in the map and will not be yielded.\n+    ///\n+    /// The iterator also lets you mutate the value of each element in the\n+    /// closure, regardless of whether you choose to keep or remove it.\n+    ///\n+    /// If the iterator is only partially consumed or not consumed at all, each\n+    /// of the remaining elements is still subjected to the closure, which may\n+    /// change its value and, by returning `true`, have the element removed and\n+    /// dropped.\n+    ///\n+    /// It is unspecified how many more elements will be subjected to the\n+    /// closure if a panic occurs in the closure, or a panic occurs while\n+    /// dropping an element, or if the `DrainFilter` value is leaked.\n     ///\n     /// # Examples\n     ///"}, {"sha": "8072762d8791742a306fa3b45cae5c688bdf4e85", "filename": "library/alloc/src/collections/btree/set.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -679,7 +679,7 @@ impl<T> BTreeSet<T> {\n     /// use std::collections::BTreeSet;\n     ///\n     /// let mut map = BTreeSet::new();\n-    /// assert_eq!(map.first(), None);\n+    /// assert_eq!(map.last(), None);\n     /// map.insert(1);\n     /// assert_eq!(map.last(), Some(&1));\n     /// map.insert(2);"}, {"sha": "70df5170b21c1a2fa370b855021ee04a4f3c7331", "filename": "src/doc/rustc/src/exploit-mitigations.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Fexploit-mitigations.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Fexploit-mitigations.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fexploit-mitigations.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -378,7 +378,7 @@ C library default allocator<sup id=\"fnref:5\" role=\"doc-noteref\"><a\n href=\"#fn:5\" class=\"footnote\">5</a></sup> since version 1.32.0\n (2019-01-17)[39].\n \n-```ignore\n+```rust,no_run\n fn main() {\n     let mut x = Box::new([0; 1024]);\n "}, {"sha": "3e616f226ed76f908ecc8d291e4afeddfcbf0f4b", "filename": "src/doc/rustc/src/lints/levels.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flevels.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flevels.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flevels.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -62,7 +62,7 @@ warning: unused variable: `x`\n A 'deny' lint produces an error if you violate it. For example, this code\n runs into the `exceeding_bitshifts` lint.\n \n-```rust,ignore\n+```rust,no_run\n fn main() {\n     100u8 << 10;\n }\n@@ -232,7 +232,7 @@ pub fn foo() {}\n This is the maximum level for all lints. So for example, if we take our\n code sample from the \"deny\" lint level above:\n \n-```rust,ignore\n+```rust,no_run\n fn main() {\n     100u8 << 10;\n }"}, {"sha": "97aa2caf91508a7ce156e9b6a40d8a4de052b69d", "filename": "src/doc/rustc/src/lints/listing/index.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flisting%2Findex.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flisting%2Findex.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Flints%2Flisting%2Findex.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -2,4 +2,4 @@\n \n This section lists out all of the lints, grouped by their default lint levels.\n \n-You can also see this list by running `rustc -W help`.\n\\ No newline at end of file\n+You can also see this list by running `rustc -W help`."}, {"sha": "39a05cfe20534f2e2efdafeea18b303d9e9b1adf", "filename": "src/doc/rustc/src/what-is-rustc.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Fwhat-is-rustc.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustc%2Fsrc%2Fwhat-is-rustc.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fwhat-is-rustc.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -39,7 +39,7 @@ $ .\\hello.exe # on Windows\n Note that we only ever pass `rustc` the *crate root*, not every file we wish\n to compile. For example, if we had a `main.rs` that looked like this:\n \n-```rust,ignore\n+```rust,ignore (needs-multiple-files)\n mod foo;\n \n fn main() {\n@@ -49,7 +49,7 @@ fn main() {\n \n And a `foo.rs` that had this:\n \n-```rust,ignore\n+```rust,no_run\n pub fn hello() {\n     println!(\"Hello, world!\");\n }"}, {"sha": "abdc2e4025d0ee319f25769542369f9616d10254", "filename": "src/doc/rustdoc/src/advanced-features.md", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -47,16 +47,15 @@ all type errors and name resolution errors with function bodies. Note that this\n work for anything outside a function body: since Rustdoc documents your types, it has to\n know what those types are! For example, this code will work regardless of the platform:\n \n-<!-- `ignore` because doc-tests are run with `rustc`, not `rustdoc` -->\n-```ignore\n+```rust,ignore (platform-specific,rustdoc-specific-behavior)\n pub fn f() {\n     use std::os::windows::ffi::OsStrExt;\n }\n ```\n \n but this will not, because the unknown type is part of the function signature:\n \n-```ignore\n+```rust,ignore (platform-specific,rustdoc-specific-behavior)\n pub fn f() -> std::os::windows::ffi::EncodeWide<'static> {\n     unimplemented!()\n }"}, {"sha": "8e3c62281895486707dbe55f9537f52a469bc802", "filename": "src/doc/rustdoc/src/documentation-tests.md", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fdocumentation-tests.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fdocumentation-tests.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fdocumentation-tests.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -5,12 +5,13 @@ that examples within your documentation are up to date and working.\n \n The basic idea is this:\n \n-```ignore\n+```rust,no_run\n /// # Examples\n ///\n /// ```\n /// let x = 5;\n /// ```\n+# fn f() {}\n ```\n \n The triple backticks start and end code blocks. If this were in a file named `foo.rs`,\n@@ -78,12 +79,13 @@ Sometimes, you need some setup code, or other things that would distract\n from your example, but are important to make the tests work. Consider\n an example block that looks like this:\n \n-```ignore\n+```rust,no_run\n /// ```\n /// /// Some documentation.\n /// # fn foo() {} // this function will be hidden\n /// println!(\"Hello, World!\");\n /// ```\n+# fn f() {}\n ```\n \n It will render like this:\n@@ -196,12 +198,13 @@ When writing an example, it is rarely useful to include a complete error\n handling, as it would add significant amounts of boilerplate code. Instead, you\n may want the following:\n \n-```ignore\n+```rust,no_run\n /// ```\n /// use std::io;\n /// let mut input = String::new();\n /// io::stdin().read_line(&mut input)?;\n /// ```\n+# fn f() {}\n ```\n \n The problem is that `?` returns a `Result<T, E>` and test functions don't\n@@ -210,7 +213,7 @@ return anything, so this will give a mismatched types error.\n You can get around this limitation by manually adding a `main` that returns\n `Result<T, E>`, because `Result<T, E>` implements the `Termination` trait:\n \n-```ignore\n+```rust,no_run\n /// A doc test using ?\n ///\n /// ```\n@@ -222,12 +225,13 @@ You can get around this limitation by manually adding a `main` that returns\n ///     Ok(())\n /// }\n /// ```\n+# fn f() {}\n ```\n \n Together with the `# ` from the section above, you arrive at a solution that\n appears to the reader as the initial idea but works with doc tests:\n \n-```ignore\n+```rust,no_run\n /// ```\n /// use std::io;\n /// # fn main() -> io::Result<()> {\n@@ -236,18 +240,20 @@ appears to the reader as the initial idea but works with doc tests:\n /// # Ok(())\n /// # }\n /// ```\n+# fn f() {}\n ```\n \n As of version 1.34.0, one can also omit the `fn main()`, but you will have to\n disambiguate the error type:\n \n-```ignore\n+```rust,no_run\n /// ```\n /// use std::io;\n /// let mut input = String::new();\n /// io::stdin().read_line(&mut input)?;\n /// # Ok::<(), io::Error>(())\n /// ```\n+# fn f() {}\n ```\n \n This is an unfortunate consequence of the `?` operator adding an implicit\n@@ -417,7 +423,7 @@ Another possible use of `#[cfg(doctest)]` is to test doctests that are included\n without including it in your main documentation. For example, you could write this into your\n `lib.rs` to test your README as part of your doctests:\n \n-```rust,ignore\n+```rust,no_run\n #![feature(external_doc)]\n \n #[doc(include = \"../README.md\")]"}, {"sha": "9938cddc94106d337a58f0d379579b4f05f074d9", "filename": "src/doc/rustdoc/src/how-to-write-documentation.md", "status": "modified", "additions": 37, "deletions": 17, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fhow-to-write-documentation.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fhow-to-write-documentation.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fhow-to-write-documentation.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -7,7 +7,7 @@ implementation detail, or leaves readers with unanswered questions.\n \n There are a few tenets to Rust documentation that can help guide anyone through\n the process of documenting libraries so that everyone has an ample opportunity\n-to use the code.  \n+to use the code.\n \n This chapter covers not only how to write documentation but specifically\n how to write **good** documentation.  It is important to be as clear\n@@ -19,39 +19,39 @@ then it should be documented.\n \n Documenting a crate should begin with front-page documentation.  As an\n example, the [`hashbrown`] crate level documentation summarizes the role of\n-the crate, provides links to explain technical details, and explains why you \n-would want to use the crate.  \n+the crate, provides links to explain technical details, and explains why you\n+would want to use the crate.\n \n-After introducing the crate, it is important that the front-page gives \n+After introducing the crate, it is important that the front-page gives\n an example of how to use the crate in a real world setting.  Stick to the\n library's role in the example, but do so without shortcuts to benefit users who\n-may copy and paste the example to get started. \n+may copy and paste the example to get started.\n \n [`futures`] uses inline comments to explain line by line\n-the complexities of using a [`Future`], because a person's first exposure to \n+the complexities of using a [`Future`], because a person's first exposure to\n rust's [`Future`] may be this example.\n \n-The [`backtrace`] documentation walks through the whole process, explaining \n+The [`backtrace`] documentation walks through the whole process, explaining\n changes made to the `Cargo.toml` file, passing command line arguments to the\n-compiler, and shows a quick example of backtrace in the wild.  \n+compiler, and shows a quick example of backtrace in the wild.\n \n Finally, the front-page can eventually become a comprehensive reference\n how to use a crate, like [`regex`].  In this front page, all\n-requirements are outlined, the edge cases shown, and practical examples \n+requirements are outlined, the edge cases shown, and practical examples\n provided.  The front page goes on to show how to use regular expressions\n then concludes with crate features.\n \n Don't worry about comparing your crate, which is just beginning, to other more\n developed crates.  To get the documentation to something more polished, start\n-incrementally and put in an introduction, example, and features.  Rome was not \n+incrementally and put in an introduction, example, and features.  Rome was not\n built in a day!\n \n The first lines within the `lib.rs` will compose the front-page, and they\n use a different convention than the rest of the rustdocs.  Lines should\n start with `//!` which indicate module-level or crate-level documentation.\n Here's a quick example of the difference:\n \n-```rust,ignore\n+```rust,no_run\n //! Fast and easy queue abstraction.\n //!\n //! Provides an abstraction over a queue.  When the abstraction is used\n@@ -64,13 +64,13 @@ Here's a quick example of the difference:\n /// This module makes it easy.\n pub mod easy {\n \n-    /// Use the abstract function to do this specific thing.\n-    pub fn abstract() {}\n+    /// Use the abstraction function to do this specific thing.\n+    pub fn abstraction() {}\n \n }\n ```\n \n-Ideally, this first line of documentation is a sentence without highly \n+Ideally, this first line of documentation is a sentence without highly\n technical details, but with a good description of where this crate fits\n within the rust ecosystem.  Users should know whether this crate meets their use\n case after reading this line.\n@@ -95,7 +95,7 @@ It is recommended that each item's documentation follows this basic structure:\n \n This basic structure should be straightforward to follow when writing your\n documentation; while you might think that a code example is trivial,\n-the examples are really important because they can help users understand \n+the examples are really important because they can help users understand\n what an item is, how it is used, and for what purpose it exists.\n \n Let's see an example coming from the [standard library] by taking a look at the\n@@ -133,7 +133,7 @@ for argument in env::args() {\n [`args_os`]: ./fn.args_os.html\n ``````\n \n-Everything before the first empty line will be reused to describe the component \n+Everything before the first empty line will be reused to describe the component\n in searches and module overviews.  For example, the function `std::env::args()`\n above will be shown on the [`std::env`] module documentation.  It is good\n practice to keep the summary to one line: concise writing is a goal of good\n@@ -221,11 +221,30 @@ This example will render similarly to this:\n See the specification for the [GitHub Tables extension][tables] for more\n details on the exact syntax supported.\n \n+### Task lists\n+\n+Task lists can be used as a checklist of items that have been completed.\n+Example:\n+\n+```md\n+- [x] Complete task\n+- [ ] IncComplete task\n+```\n+\n+This will render as\n+\n+<ul>\n+    <li><input type=\"checkbox\"></li>\n+    <li><input type=\"checkbox\" checked></li>\n+</ul>\n+\n+See the specification for the [task list extension] for more details.\n+\n [`backtrace`]: https://docs.rs/backtrace/0.3.50/backtrace/\n [commonmark markdown specification]: https://commonmark.org/\n [commonmark quick reference]: https://commonmark.org/help/\n [env::args]: https://doc.rust-lang.org/stable/std/env/fn.args.html\n-[`Future`]: https://doc.rust-lang.org/std/future/trait.Future.html \n+[`Future`]: https://doc.rust-lang.org/std/future/trait.Future.html\n [`futures`]: https://docs.rs/futures/0.3.5/futures/\n [`hashbrown`]: https://docs.rs/hashbrown/0.8.2/hashbrown/\n [`regex`]: https://docs.rs/regex/1.3.9/regex/\n@@ -234,3 +253,4 @@ details on the exact syntax supported.\n [`std::env`]: https://doc.rust-lang.org/stable/std/env/index.html#functions\n [strikethrough]: https://github.github.com/gfm/#strikethrough-extension-\n [tables]: https://github.github.com/gfm/#tables-extension-\n+[task list extension]: https://github.github.com/gfm/#task-list-items-extension-"}, {"sha": "cce3623dc8f4912f1669435bcbf780e112cb5960", "filename": "src/doc/rustdoc/src/lints.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -3,10 +3,11 @@\n `rustdoc` provides lints to help you writing and testing your documentation. You\n can use them like any other lints by doing this:\n \n-```rust,ignore\n+```rust\n #![allow(missing_docs)] // allows the lint, no diagnostics will be reported\n #![warn(missing_docs)] // warn if there are missing docs\n #![deny(missing_docs)] // error if there are missing docs\n+# //! Crate docs.\n ```\n \n Here is the list of the lints provided by `rustdoc`:"}, {"sha": "140b832f19a54a06c056f2d7dab8e67679acd5bc", "filename": "src/doc/rustdoc/src/passes.md", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fpasses.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fpasses.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fpasses.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -32,8 +32,9 @@ Without this pass, these items will remain in the output.\n \n When you write a doc comment like this:\n \n-```rust,ignore\n+```rust,no_run\n /// This is a documentation comment.\n+# fn f() {}\n ```\n \n There's a space between the `///` and that `T`. That spacing isn't intended\n@@ -52,9 +53,10 @@ documentation string.\n \n For example:\n \n-```rust,ignore\n+```rust,no_run\n #[doc = \"This is the first line.\"]\n #[doc = \"This is the second line.\"]\n+# fn f() {}\n ```\n \n Gets collapsed into a single doc string of\n@@ -68,7 +70,7 @@ This is the second line.\n \n This removes documentation for any non-public items, so for example:\n \n-```rust,ignore\n+```rust,no_run\n /// These are private docs.\n struct Private;\n "}, {"sha": "b0e2437392c955fc6fe62670dd9ff576c2550100", "filename": "src/doc/rustdoc/src/references.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Freferences.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Freferences.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Freferences.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -3,15 +3,15 @@\n There are many great `rustdoc` references out there.\n If you know of other great resources, please submit a pull request!\n \n-## Official \n+## Official\n \n - [Learn Rust]\n - [Rust By Example]\n - [Rust Reference]\n - [RFC 1574: More API Documentation Conventions]\n - [RFC 1946: Intra Rustdoc Links]\n \n-## Community \n+## Community\n - [API Guidelines]\n - [Github tagged RFCs]\n - [Github tagged issues]\n@@ -28,4 +28,4 @@ If you know of other great resources, please submit a pull request!\n [RFC 1946: Intra Rustdoc Links]: https://rust-lang.github.io/rfcs/1946-intra-rustdoc-links.html\n [RFC (stalled) front page styleguide]: https://github.com/rust-lang/rfcs/pull/1687\n [Rust By Example]: https://doc.rust-lang.org/stable/rust-by-example/meta/doc.html\n-[Rust Reference]: https://doc.rust-lang.org/stable/reference/comments.html#doc-comments\n\\ No newline at end of file\n+[Rust Reference]: https://doc.rust-lang.org/stable/reference/comments.html#doc-comments"}, {"sha": "52f2a3728fabb5908784e76c7d79bc588dedf979", "filename": "src/doc/rustdoc/src/the-doc-attribute.md", "status": "modified", "additions": 23, "deletions": 15, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fthe-doc-attribute.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fthe-doc-attribute.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fthe-doc-attribute.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -7,9 +7,10 @@ The most basic function of `#[doc]` is to handle the actual documentation\n text. That is, `///` is syntax sugar for `#[doc]`. This means that these two\n are the same:\n \n-```rust,ignore\n+```rust,no_run\n /// This is a doc comment.\n #[doc = \" This is a doc comment.\"]\n+# fn f() {}\n ```\n \n (Note the leading space in the attribute version.)\n@@ -18,16 +19,18 @@ In most cases, `///` is easier to use than `#[doc]`. One case where the latter i\n when generating documentation in macros; the `collapse-docs` pass will combine multiple\n `#[doc]` attributes into a single doc comment, letting you generate code like this:\n \n-```rust,ignore\n+```rust,no_run\n #[doc = \"This is\"]\n #[doc = \" a \"]\n #[doc = \"doc comment\"]\n+# fn f() {}\n ```\n \n Which can feel more flexible. Note that this would generate this:\n \n-```rust,ignore\n+```rust,no_run\n #[doc = \"This is\\n a \\ndoc comment\"]\n+# fn f() {}\n ```\n \n but given that docs are rendered via Markdown, it will remove these newlines.\n@@ -45,7 +48,7 @@ These options control how the docs look at a crate level.\n \n This form of the `doc` attribute lets you control the favicon of your docs.\n \n-```rust,ignore\n+```rust,no_run\n #![doc(html_favicon_url = \"https://example.com/favicon.ico\")]\n ```\n \n@@ -59,7 +62,7 @@ If you don't use this attribute, there will be no favicon.\n This form of the `doc` attribute lets you control the logo in the upper\n left hand side of the docs.\n \n-```rust,ignore\n+```rust,no_run\n #![doc(html_logo_url = \"https://example.com/logo.jpg\")]\n ```\n \n@@ -73,7 +76,7 @@ If you don't use this attribute, there will be no logo.\n This form of the `doc` attribute lets you control where the \"run\" buttons\n on your documentation examples make requests to.\n \n-```rust,ignore\n+```rust,no_run\n #![doc(html_playground_url = \"https://playground.example.com/\")]\n ```\n \n@@ -88,7 +91,7 @@ When a feature is unstable, an issue number for tracking the feature must be\n given. `rustdoc` uses this number, plus the base URL given here, to link to\n the tracking issue.\n \n-```rust,ignore\n+```rust,no_run\n #![doc(issue_tracker_base_url = \"https://github.com/rust-lang/rust/issues/\")]\n ```\n \n@@ -103,7 +106,7 @@ available. If that is not available, then it will use the `html_root_url`\n value in the extern crate if it is available. If that is not available, then\n the extern items will not be linked.\n \n-```rust,ignore\n+```rust,no_run\n #![doc(html_root_url = \"https://docs.rs/serde/1.0\")]\n ```\n \n@@ -112,7 +115,7 @@ the extern items will not be linked.\n By default, `rustdoc` will include the source code of your program, with links\n to it in the docs. But if you include this:\n \n-```rust,ignore\n+```rust,no_run\n #![doc(html_no_source)]\n ```\n \n@@ -123,7 +126,7 @@ it will not.\n By default, `rustdoc` will automatically add a line with `extern crate my_crate;` into each doctest.\n But if you include this:\n \n-```rust,ignore\n+```rust,no_run\n #![doc(test(no_crate_inject))]\n ```\n \n@@ -134,7 +137,7 @@ it will not.\n This form of the `doc` attribute allows you to add arbitrary attributes to all your doctests. For\n example, if you want your doctests to fail if they produce any warnings, you could add this:\n \n-```rust,ignore\n+```rust,no_run\n #![doc(test(attr(deny(warnings))))]\n ```\n \n@@ -148,47 +151,51 @@ they are documented.\n These attributes are used on `use` statements, and control where the documentation shows\n up. For example, consider this Rust code:\n \n-```rust,ignore\n+```rust,no_run\n pub use bar::Bar;\n \n /// bar docs\n pub mod bar {\n     /// the docs for Bar\n     pub struct Bar;\n }\n+# fn main() {}\n ```\n \n The documentation will generate a \"Re-exports\" section, and say `pub use bar::Bar;`, where\n `Bar` is a link to its page.\n \n If we change the `use` line like this:\n \n-```rust,ignore\n+```rust,no_run\n #[doc(inline)]\n pub use bar::Bar;\n+# pub mod bar { pub struct Bar; }\n+# fn main() {}\n ```\n \n Instead, `Bar` will appear in a `Structs` section, just like `Bar` was defined at the\n top level, rather than `pub use`'d.\n \n Let's change our original example, by making `bar` private:\n \n-```rust,ignore\n+```rust,no_run\n pub use bar::Bar;\n \n /// bar docs\n mod bar {\n     /// the docs for Bar\n     pub struct Bar;\n }\n+# fn main() {}\n ```\n \n Here, because `bar` is not public, `Bar` wouldn't have its own page, so there's nowhere\n to link to. `rustdoc` will inline these definitions, and so we end up in the same case\n as the `#[doc(inline)]` above; `Bar` is in a `Structs` section, as if it were defined at\n the top level. If we add the `no_inline` form of the attribute:\n \n-```rust,ignore\n+```rust,no_run\n #[doc(no_inline)]\n pub use bar::Bar;\n \n@@ -197,6 +204,7 @@ mod bar {\n     /// the docs for Bar\n     pub struct Bar;\n }\n+# fn main() {}\n ```\n \n Now we'll have a `Re-exports` line, and `Bar` will not link to anywhere."}, {"sha": "7a444d77c09d18d6ae4a1cd887b93d38294820ce", "filename": "src/doc/rustdoc/src/what-is-rustdoc.md", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fwhat-is-rustdoc.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fwhat-is-rustdoc.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fwhat-is-rustdoc.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -32,7 +32,7 @@ $ rustdoc src/lib.rs\n This will create a new directory, `doc`, with a website inside! In our case,\n the main page is located in `doc/lib/index.html`. If you open that up in\n a web browser, you will see a page with a search bar, and \"Crate lib\" at the\n-top, with no contents. \n+top, with no contents.\n \n ## Configuring rustdoc\n \n@@ -89,18 +89,18 @@ dependency=<path>/docs/target/debug/deps\n You can see this with `cargo doc --verbose`.\n \n It generates the correct `--crate-name` for us, as well as pointing to\n-`src/lib.rs`. But what about those other arguments? \n- - `-o` controls the *o*utput of our docs. Instead of a top-level \n- `doc` directory, notice that Cargo puts generated documentation under \n+`src/lib.rs`. But what about those other arguments?\n+ - `-o` controls the *o*utput of our docs. Instead of a top-level\n+ `doc` directory, notice that Cargo puts generated documentation under\n  `target`. That is the idiomatic place for generated files in Cargo projects.\n- - `-L` flag helps rustdoc find the dependencies your code relies on. \n+ - `-L` flag helps rustdoc find the dependencies your code relies on.\n  If our project used dependencies, we would get documentation for them as well!\n \n ## Outer and inner documentation\n \n The `///` syntax is used to document the item present after it.\n That's why it is called an outer documentation.\n-There is another syntax: `//!`, which is used to document the \n+There is another syntax: `//!`, which is used to document the\n item it is present inside. It is called an inner documentation.\n It is often used when documenting the entire crate,\n because nothing comes before it: it is the root of the crate."}, {"sha": "9683f519be12108150bf78d06f6a756aaa9d63ac", "filename": "src/doc/rustdoc/src/what-to-include.md", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fwhat-to-include.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Frustdoc%2Fsrc%2Fwhat-to-include.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fwhat-to-include.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -38,10 +38,10 @@ warning: 1 warning emitted\n \n As a library author, adding the lint `#![deny(missing_docs)]` is a great way to\n ensure the project does not drift away from being documented well, and\n-`#![warn(missing_docs)]` is a good way to move towards comprehensive \n+`#![warn(missing_docs)]` is a good way to move towards comprehensive\n documentation.  In addition to docs, `#![deny(missing_doc_code_examples)]`\n ensures each function contains a usage example.  In our example above, the\n-warning is resolved by adding crate level documentation. \n+warning is resolved by adding crate level documentation.\n \n There are more lints in the upcoming chapter [Lints][rustdoc-lints].\n \n@@ -58,17 +58,17 @@ users to figure out how to put the `async` code into their own runtime.\n \n It is preferred that `unwrap()` not be used inside an example, and some of the\n error handling components be hidden if they make the example too difficult to\n-follow.  \n+follow.\n \n ``````text\n /// Example\n /// ```rust\n /// let fourtytwo = \"42\".parse::<u32>()?;\n /// println!(\"{} + 10 = {}\", fourtytwo, fourtytwo+10);\n /// ```\n-``````  \n+``````\n \n-When rustdoc wraps that in a main function, it will fail to compile because the \n+When rustdoc wraps that in a main function, it will fail to compile because the\n `ParseIntError` trait is not implemented.  In order to help both your audience\n and your test suite, this example needs some additional code:\n \n@@ -81,17 +81,17 @@ and your test suite, this example needs some additional code:\n /// #     Ok(())\n /// # }\n /// ```\n-``````  \n+``````\n \n The example is the same on the doc page, but has that extra information\n-available to anyone trying to use your crate.  More about tests in the \n-upcoming [Documentation tests] chapter.  \n+available to anyone trying to use your crate.  More about tests in the\n+upcoming [Documentation tests] chapter.\n \n ## What to Exclude\n \n Certain parts of your public interface may be included by default in the output\n of rustdoc.  The attribute `#[doc(hidden)]` can hide implementation details\n-to encourage idiomatic use of the crate.  \n+to encourage idiomatic use of the crate.\n \n For example, an internal `macro!` that makes the crate easier to implement can\n become a footgun for users when it appears in the public documentation.  An\n@@ -101,11 +101,11 @@ detailed in the [API Guidelines].\n ## Customizing the output\n \n It is possible to pass a custom css file to `rustdoc` and style the\n-documentation.  \n+documentation.\n \n ```bash\n rustdoc --extend-css custom.css src/lib.rs\n-``` \n+```\n \n A good example of using this feature to create a dark theme is documented [on\n this blog].  Just remember, dark theme is already included in the rustdoc output\n@@ -122,4 +122,4 @@ Here is an example of a new theme, [Ayu].\n [API Guidelines]: https://rust-lang.github.io/api-guidelines/documentation.html#rustdoc-does-not-show-unhelpful-implementation-details-c-hidden\n [Documentation tests]: documentation-tests.md\n [on this blog]: https://blog.guillaume-gomez.fr/articles/2016-09-16+Generating+doc+with+rustdoc+and+a+custom+theme\n-[rustdoc-lints]: lints.md\n\\ No newline at end of file\n+[rustdoc-lints]: lints.md"}, {"sha": "3c0cd32fae172de49a857845a0560f52b9754d5c", "filename": "src/doc/unstable-book/src/compiler-flags/codegen-backend.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fcodegen-backend.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fcodegen-backend.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fcodegen-backend.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -15,7 +15,7 @@ named `__rustc_codegen_backend` with a signature of `fn() -> Box<dyn rustc_codeg\n See also the [`hotplug_codegen_backend`](https://github.com/rust-lang/rust/tree/master/src/test/run-make-fulldeps/hotplug_codegen_backend) test\n for a full example.\n \n-```rust,ignore\n+```rust,ignore (partial-example)\n use rustc_codegen_ssa::traits::CodegenBackend;\n \n struct MyBackend;"}, {"sha": "08c16d95f4670bce556395f3d8e53b5cbb4dc4ab", "filename": "src/doc/unstable-book/src/compiler-flags/control-flow-guard.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fcontrol-flow-guard.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fcontrol-flow-guard.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fcontrol-flow-guard.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -6,7 +6,7 @@ The tracking issue for this feature is: [#68793](https://github.com/rust-lang/ru\n \n The rustc flag `-Z control-flow-guard` enables the Windows [Control Flow Guard](https://docs.microsoft.com/en-us/windows/win32/secbp/control-flow-guard) (CFG) platform security feature.\n \n-CFG is an exploit mitigation designed to enforce control-flow integrity for software running on supported [Windows platforms (Windows 8.1 onwards)](https://docs.microsoft.com/en-us/windows/win32/secbp/control-flow-guard). Specifically, CFG uses runtime checks to validate the target address of every indirect call/jump before allowing the call to complete. \n+CFG is an exploit mitigation designed to enforce control-flow integrity for software running on supported [Windows platforms (Windows 8.1 onwards)](https://docs.microsoft.com/en-us/windows/win32/secbp/control-flow-guard). Specifically, CFG uses runtime checks to validate the target address of every indirect call/jump before allowing the call to complete.\n \n During compilation, the compiler identifies all indirect calls/jumps and adds CFG checks. It also emits metadata containing the relative addresses of all address-taken functions. At runtime, if the binary is run on a CFG-aware operating system, the loader uses the CFG metadata to generate a bitmap of the address space and marks those addresses that contain valid targets. On each indirect call, the inserted check determines whether the target address is marked in this bitmap. If the target is not valid, the process is terminated.\n \n@@ -35,7 +35,7 @@ The rustc flag `-Z control-flow-guard=nochecks` instructs LLVM to emit the list\n \n ## Control Flow Guard in libraries\n \n-It is strongly recommended to also enable CFG checks for all linked libraries, including the standard library. \n+It is strongly recommended to also enable CFG checks for all linked libraries, including the standard library.\n \n To enable CFG in the standard library, use the [cargo `-Z build-std` functionality][build-std] to recompile the standard library with the same configuration options as the main program.\n "}, {"sha": "71303bfaff20df96b956755ecba4d528d7fcb6f9", "filename": "src/doc/unstable-book/src/compiler-flags/profile.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fprofile.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fprofile.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fprofile.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -22,6 +22,6 @@ Once you've built and run your program, files with the `gcno` (after build) and\n You can parse them with [llvm-cov gcov](https://llvm.org/docs/CommandGuide/llvm-cov.html#llvm-cov-gcov) or [grcov](https://github.com/mozilla/grcov).\n \n Please note that `RUSTFLAGS` by default applies to everything that cargo builds and runs during a build!\n-When the `--target` flag is explicitly passed to cargo, the `RUSTFLAGS` no longer apply to build scripts and procedural macros. \n-For more fine-grained control consider passing a `RUSTC_WRAPPER` program to cargo that only adds the profiling flags to \n+When the `--target` flag is explicitly passed to cargo, the `RUSTFLAGS` no longer apply to build scripts and procedural macros.\n+For more fine-grained control consider passing a `RUSTC_WRAPPER` program to cargo that only adds the profiling flags to\n rustc for the specific crates you want to profile."}, {"sha": "ac0093f77aec22c57ae92a3b34c54293e67077ab", "filename": "src/doc/unstable-book/src/compiler-flags/report-time.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Freport-time.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Freport-time.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Freport-time.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -34,7 +34,7 @@ Available options:\n                 Expected format of environment variable is\n                 `VARIABLE=WARN_TIME,CRITICAL_TIME`.\n                 Not available for --format=terse\n---ensure-time \n+--ensure-time\n                 Treat excess of the test execution time limit as\n                 error.\n                 Threshold values for this option can be configured via"}, {"sha": "8b19e785c6a5bbbf31b5671aa14f41a209e0f3c2", "filename": "src/doc/unstable-book/src/compiler-flags/tls-model.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Ftls-model.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Ftls-model.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Ftls-model.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -11,7 +11,7 @@ Supported values for this option are:\n \n - `global-dynamic` - General Dynamic TLS Model (alternatively called Global Dynamic) is the most\n general option usable in all circumstances, even if the TLS data is defined in a shared library\n-loaded at runtime and is accessed from code outside of that library.  \n+loaded at runtime and is accessed from code outside of that library.\n This is the default for most targets.\n - `local-dynamic` - model usable if the TLS data is only accessed from the shared library or\n executable it is defined in. The TLS data may be in a library loaded after startup (via `dlopen`)."}, {"sha": "f967c11fc4d0895e637e36041bc0271dc3ce7b06", "filename": "src/doc/unstable-book/src/language-features/auto-traits.md", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fauto-traits.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fauto-traits.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fauto-traits.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1,6 +1,6 @@\n # `auto_traits`\n \n-The tracking issue for this feature is [#13231] \n+The tracking issue for this feature is [#13231]\n \n [#13231]: https://github.com/rust-lang/rust/issues/13231\n \n@@ -9,15 +9,15 @@ The tracking issue for this feature is [#13231]\n The `auto_traits` feature gate allows you to define auto traits.\n \n Auto traits, like [`Send`] or [`Sync`] in the standard library, are marker traits\n-that are automatically implemented for every type, unless the type, or a type it contains, \n+that are automatically implemented for every type, unless the type, or a type it contains,\n has explicitly opted out via a negative impl. (Negative impls are separately controlled\n by the `negative_impls` feature.)\n \n [`Send`]: https://doc.rust-lang.org/std/marker/trait.Send.html\n [`Sync`]: https://doc.rust-lang.org/std/marker/trait.Sync.html\n \n-```rust,ignore\n-impl !Trait for Type\n+```rust,ignore (partial-example)\n+impl !Trait for Type {}\n ```\n \n Example:\n@@ -40,7 +40,7 @@ fn must_be_valid<T: Valid>(_t: T) { }\n fn main() {\n     // works\n     must_be_valid( MaybeValid(True) );\n-                \n+\n     // compiler error - trait bound not satisfied\n     // must_be_valid( MaybeValid(False) );\n }\n@@ -80,7 +80,7 @@ where\n \n Explicit impls may be either positive or negative. They take the form:\n \n-```rust,ignore\n+```rust,ignore (partial-example)\n impl<...> AutoTrait for StructName<..> { }\n impl<...> !AutoTrait for StructName<..> { }\n ```\n@@ -104,4 +104,3 @@ Auto traits cannot have any trait items, such as methods or associated types. Th\n ## Supertraits\n \n Auto traits cannot have supertraits. This is for soundness reasons, as the interaction of coinduction with implied bounds is difficult to reconcile.\n-"}, {"sha": "53ecac9314d79fa7b9dcc1551d22ed6119b2cbc2", "filename": "src/doc/unstable-book/src/language-features/custom-test-frameworks.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fcustom-test-frameworks.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fcustom-test-frameworks.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fcustom-test-frameworks.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -30,4 +30,3 @@ const WILL_PASS: i32 = 0;\n #[test_case]\n const WILL_FAIL: i32 = 4;\n ```\n-"}, {"sha": "5f3f1b4dd8a3189a451776ab4e024d86cd553e68", "filename": "src/doc/unstable-book/src/language-features/infer-static-outlives-requirements.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Finfer-static-outlives-requirements.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Finfer-static-outlives-requirements.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Finfer-static-outlives-requirements.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -42,4 +42,3 @@ struct Bar<T: 'static> {\n     x: T,\n }\n ```\n-"}, {"sha": "a0fb4e743d3f29f84cabdf135b1fa2df36174416", "filename": "src/doc/unstable-book/src/language-features/intrinsics.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fintrinsics.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fintrinsics.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fintrinsics.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -27,4 +27,3 @@ extern \"rust-intrinsic\" {\n ```\n \n As with any other FFI functions, these are always `unsafe` to call.\n-"}, {"sha": "d44c841d48c66bc5aa815a21800908dec56ea3db", "filename": "src/doc/unstable-book/src/language-features/lang-items.md", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Flang-items.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Flang-items.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Flang-items.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -15,8 +15,8 @@ For example, `Box` pointers require two lang items, one for allocation\n and one for deallocation. A freestanding program that uses the `Box`\n sugar for dynamic allocations via `malloc` and `free`:\n \n-```rust,ignore\n-#![feature(lang_items, box_syntax, start, libc, core_intrinsics)]\n+```rust,ignore (libc-is-finicky)\n+#![feature(lang_items, box_syntax, start, libc, core_intrinsics, rustc_private)]\n #![no_std]\n use core::intrinsics;\n use core::panic::PanicInfo;\n@@ -105,8 +105,8 @@ or overriding the default shim for the C `main` function with your own.\n The function marked `#[start]` is passed the command line parameters\n in the same format as C:\n \n-```rust,ignore\n-#![feature(lang_items, core_intrinsics)]\n+```rust,ignore (libc-is-finicky)\n+#![feature(lang_items, core_intrinsics, rustc_private)]\n #![feature(start)]\n #![no_std]\n use core::intrinsics;\n@@ -141,8 +141,8 @@ with `#![no_main]` and then create the appropriate symbol with the\n correct ABI and the correct name, which requires overriding the\n compiler's name mangling too:\n \n-```rust,ignore\n-#![feature(lang_items, core_intrinsics)]\n+```rust,ignore (libc-is-finicky)\n+#![feature(lang_items, core_intrinsics, rustc_private)]\n #![feature(start)]\n #![no_std]\n #![no_main]"}, {"sha": "847f25ecab132e7603d110d1aacec26c5eb3e97d", "filename": "src/doc/unstable-book/src/language-features/non-ascii-idents.md", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fnon-ascii-idents.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fnon-ascii-idents.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fnon-ascii-idents.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -19,10 +19,10 @@ const \u03a0: f64 = 3.14f64;\n \n ## Changes to the language reference\n \n-> **<sup>Lexer:<sup>**  \n-> IDENTIFIER :  \n-> &nbsp;&nbsp; &nbsp;&nbsp; XID_start XID_continue<sup>\\*</sup>  \n-> &nbsp;&nbsp; | `_` XID_continue<sup>+</sup>  \n+> **<sup>Lexer:<sup>**\\\n+> IDENTIFIER :\\\n+> &nbsp;&nbsp; &nbsp;&nbsp; XID_start XID_continue<sup>\\*</sup>\\\n+> &nbsp;&nbsp; | `_` XID_continue<sup>+</sup>\n \n An identifier is any nonempty Unicode string of the following form:\n "}, {"sha": "55c31add26d774f87dfec49785fcc5c10314eabd", "filename": "src/doc/unstable-book/src/language-features/or-patterns.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2For-patterns.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2For-patterns.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2For-patterns.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -11,7 +11,7 @@ a pattern, for example, `Some(A(0) | B(1 | 2))` becomes a valid pattern.\n \n ## Examples\n \n-```rust,ignore\n+```rust,no_run\n #![feature(or_patterns)]\n \n pub enum Foo {"}, {"sha": "44308bdfba6c325b964afaaed8afeac12045557a", "filename": "src/doc/unstable-book/src/language-features/plugin.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fplugin.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fplugin.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fplugin.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -38,7 +38,7 @@ additional checks for code style, safety, etc. Now let's write a plugin\n [`lint-plugin-test.rs`](https://github.com/rust-lang/rust/blob/master/src/test/ui-fulldeps/auxiliary/lint-plugin-test.rs)\n that warns about any item named `lintme`.\n \n-```rust,ignore\n+```rust,ignore (requires-stage-2)\n #![feature(plugin_registrar)]\n #![feature(box_syntax, rustc_private)]\n \n@@ -77,7 +77,7 @@ pub fn plugin_registrar(reg: &mut Registry) {\n \n Then code like\n \n-```rust,ignore\n+```rust,ignore (requires-plugin)\n #![feature(plugin)]\n #![plugin(lint_plugin_test)]\n "}, {"sha": "c67b806f06af4ae8cd7934af6739714430d48842", "filename": "src/doc/unstable-book/src/language-features/rustc-attrs.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frustc-attrs.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frustc-attrs.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frustc-attrs.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -18,7 +18,7 @@ Options provided by `#[rustc_layout(...)]` are `debug`, `size`, `align`,\n \n ## Examples\n \n-```rust,ignore\n+```rust,compile_fail\n #![feature(rustc_attrs)]\n \n #[rustc_layout(abi, size)]"}, {"sha": "e4113d72d0914823d1835a8d2a6e8d38d43c11c7", "filename": "src/doc/unstable-book/src/language-features/unboxed-closures.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funboxed-closures.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funboxed-closures.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funboxed-closures.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -9,7 +9,7 @@ See Also: [`fn_traits`](../library-features/fn-traits.md)\n ----\n \n The `unboxed_closures` feature allows you to write functions using the `\"rust-call\"` ABI,\n-required for implementing the [`Fn*`] family of traits. `\"rust-call\"` functions must have \n+required for implementing the [`Fn*`] family of traits. `\"rust-call\"` functions must have\n exactly one (non self) argument, a tuple representing the argument list.\n \n [`Fn*`]: https://doc.rust-lang.org/std/ops/trait.Fn.html"}, {"sha": "d5b01a3d6168e52be8b395935886bf01aa4c74e8", "filename": "src/doc/unstable-book/src/language-features/unsized-locals.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funsized-locals.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funsized-locals.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funsized-locals.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -30,7 +30,7 @@ fn foo(_: dyn Any) {}\n \n The RFC still forbids the following unsized expressions:\n \n-```rust,ignore\n+```rust,compile_fail\n #![feature(unsized_locals)]\n \n use std::any::Any;\n@@ -124,7 +124,7 @@ One of the objectives of this feature is to allow `Box<dyn FnOnce>`.\n \n The RFC also describes an extension to the array literal syntax: `[e; dyn n]`. In the syntax, `n` isn't necessarily a constant expression. The array is dynamically allocated on the stack and has the type of `[T]`, instead of `[T; n]`.\n \n-```rust,ignore\n+```rust,ignore (not-yet-implemented)\n #![feature(unsized_locals)]\n \n fn mergesort<T: Ord>(a: &mut [T]) {"}, {"sha": "310c8d962948a9e8da8fb34145b2d8fed89f5529", "filename": "src/doc/unstable-book/src/language-features/unsized-tuple-coercion.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funsized-tuple-coercion.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funsized-tuple-coercion.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Funsized-tuple-coercion.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -8,7 +8,7 @@ The tracking issue for this feature is: [#42877]\n \n This is a part of [RFC0401]. According to the RFC, there should be an implementation like this:\n \n-```rust,ignore\n+```rust,ignore (partial-example)\n impl<..., T, U: ?Sized> Unsized<(..., U)> for (..., T) where T: Unsized<U> {}\n ```\n "}, {"sha": "c0e23b834d150f7a16898b98b81de05d10dd59db", "filename": "src/doc/unstable-book/src/library-features/asm.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fasm.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fasm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fasm.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -405,7 +405,7 @@ When required, options are specified as the final argument.\n \n The following ABNF specifies the general syntax:\n \n-```ignore\n+```text\n dir_spec := \"in\" / \"out\" / \"lateout\" / \"inout\" / \"inlateout\"\n reg_spec := <register class> / \"<explicit register>\"\n operand_expr := expr / \"_\" / expr \"=>\" expr / expr \"=>\" \"_\""}, {"sha": "73f6cfa21787e1284f5c084f75d54dd5dc9764f7", "filename": "src/doc/unstable-book/src/library-features/concat-idents.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fconcat-idents.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fconcat-idents.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fconcat-idents.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -19,4 +19,4 @@ fn main() {\n     let f = concat_idents!(foo, bar);\n     assert_eq!(f(), 23);\n }\n-```\n\\ No newline at end of file\n+```"}, {"sha": "ce1155a977cd05eb46c79f4a78f62f562d44948f", "filename": "src/doc/unstable-book/src/library-features/global-asm.md", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fglobal-asm.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fglobal-asm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fglobal-asm.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -24,17 +24,18 @@ conventions of the assembler in your toolchain.\n \n A simple usage looks like this:\n \n-```rust,ignore\n-# #![feature(global_asm)]\n-# you also need relevant target_arch cfgs\n+```rust,ignore (requires-external-file)\n+#![feature(global_asm)]\n+# // you also need relevant target_arch cfgs\n global_asm!(include_str!(\"something_neato.s\"));\n ```\n \n And a more complicated usage looks like this:\n \n-```rust,ignore\n-# #![feature(global_asm)]\n-# #![cfg(any(target_arch = \"x86\", target_arch = \"x86_64\"))]\n+```rust,no_run\n+#![feature(global_asm)]\n+# #[cfg(any(target_arch=\"x86\", target_arch=\"x86_64\"))]\n+# mod x86 {\n \n pub mod sally {\n     global_asm!(r#\"\n@@ -64,6 +65,7 @@ pub mod harry {\n     #[no_mangle]\n     pub unsafe extern \"C\" fn quux() {}\n }\n+# }\n ```\n \n You may use `global_asm!` multiple times, anywhere in your crate, in"}, {"sha": "07fc16261d82048798223d6ddfe23eacb115a3fd", "filename": "src/doc/unstable-book/src/library-features/llvm-asm.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fllvm-asm.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fllvm-asm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fllvm-asm.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -10,7 +10,7 @@ For extremely low-level manipulations and performance reasons, one\n might wish to control the CPU directly. Rust supports using inline\n assembly to do this via the `llvm_asm!` macro.\n \n-```rust,ignore\n+```rust,ignore (pseudo-code)\n llvm_asm!(assembly template\n    : output operands\n    : input operands"}, {"sha": "c99584e5fb39777d7b20108a4872fa07faae3fb6", "filename": "src/doc/unstable-book/src/library-features/test.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Ftest.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Ftest.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Ftest.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -9,7 +9,7 @@ most widely used part of the `test` crate are benchmark tests, which can test\n the performance of your code.  Let's make our `src/lib.rs` look like this\n (comments elided):\n \n-```rust,ignore\n+```rust,no_run\n #![feature(test)]\n \n extern crate test;\n@@ -83,7 +83,7 @@ the benchmark is no longer benchmarking what one expects. For example, the\n compiler might recognize that some calculation has no external effects and\n remove it entirely.\n \n-```rust,ignore\n+```rust,no_run\n #![feature(test)]\n \n extern crate test;"}, {"sha": "022640067bd11ed286ecabea3abecb4348fc41f7", "filename": "src/doc/unstable-book/src/library-features/try-trait.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Ftry-trait.md", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Ftry-trait.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Ftry-trait.md?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -16,7 +16,7 @@ macro on `Poll`, among other things.\n \n Here's an example implementation of the trait:\n \n-```rust,ignore\n+```rust,ignore (cannot-reimpl-Try)\n /// A distinct type to represent the `None` value of an `Option`.\n ///\n /// This enables using the `?` operator on `Option`; it's rarely useful alone."}, {"sha": "a81fd55f6f192e5457c2cbb8d50aaecbccba8470", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -48,7 +48,10 @@ mod tests;\n \n /// Options for rendering Markdown in the main body of documentation.\n pub(crate) fn opts() -> Options {\n-    Options::ENABLE_TABLES | Options::ENABLE_FOOTNOTES | Options::ENABLE_STRIKETHROUGH\n+    Options::ENABLE_TABLES\n+        | Options::ENABLE_FOOTNOTES\n+        | Options::ENABLE_STRIKETHROUGH\n+        | Options::ENABLE_TASKLISTS\n }\n \n /// A subset of [`opts()`] used for rendering summaries."}, {"sha": "fe09caa69730936818194fc502e1616631e34965", "filename": "src/test/codegen/asm-sanitize-llvm.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fcodegen%2Fasm-sanitize-llvm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fcodegen%2Fasm-sanitize-llvm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fasm-sanitize-llvm.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -0,0 +1,32 @@\n+// FIXME(nagisa): remove the flags here once all targets support `asm!`.\n+// compile-flags: --target x86_64-unknown-linux-gnu\n+\n+// Verify we sanitize the special tokens for the LLVM inline-assembly, ensuring people won't\n+// inadvertently rely on the LLVM-specific syntax and features.\n+#![no_core]\n+#![feature(no_core, lang_items, rustc_attrs)]\n+#![crate_type = \"rlib\"]\n+\n+#[rustc_builtin_macro]\n+macro_rules! asm {\n+    () => {};\n+}\n+\n+#[lang = \"sized\"]\n+trait Sized {}\n+#[lang = \"copy\"]\n+trait Copy {}\n+\n+pub unsafe fn we_escape_dollar_signs() {\n+    // CHECK: call void asm sideeffect alignstack inteldialect \"banana$$:\"\n+    asm!(\n+        r\"banana$:\",\n+    )\n+}\n+\n+pub unsafe fn we_escape_escapes_too() {\n+    // CHECK: call void asm sideeffect alignstack inteldialect \"banana\\{{(\\\\|5C)}}36:\"\n+    asm!(\n+        r\"banana\\36:\",\n+    )\n+}"}, {"sha": "c2e7dd60f225e1308b282636d30f7a12820744f5", "filename": "src/test/rustdoc/task-lists.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Frustdoc%2Ftask-lists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Frustdoc%2Ftask-lists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ftask-lists.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -0,0 +1,13 @@\n+// ignore-tidy-linelength\n+// FIXME: this doesn't test as much as I'd like; ideally it would have these query too:\n+  // has task_lists/index.html '//li/input[@type=\"checkbox\" and disabled]/following-sibling::text()' 'a'\n+  // has task_lists/index.html '//li/input[@type=\"checkbox\"]/following-sibling::text()' 'b'\n+// Unfortunately that requires LXML, because the built-in xml module doesn't support all of xpath.\n+\n+// @has task_lists/index.html '//ul/li/input[@type=\"checkbox\"]' ''\n+// @has task_lists/index.html '//ul/li/input[@disabled]' ''\n+// @has task_lists/index.html '//ul/li' 'a'\n+// @has task_lists/index.html '//ul/li' 'b'\n+//! This tests 'task list' support, a common markdown extension.\n+//! - [ ] a\n+//! - [x] b"}, {"sha": "1beb5315d1055615ad0a7c49abd1d801422211b8", "filename": "src/test/ui/const-generics/const_evaluatable_checked/cross_crate_predicate.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst-generics%2Fconst_evaluatable_checked%2Fcross_crate_predicate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst-generics%2Fconst_evaluatable_checked%2Fcross_crate_predicate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fconst_evaluatable_checked%2Fcross_crate_predicate.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -4,7 +4,7 @@ error: unconstrained generic constant\n LL |     let _ = const_evaluatable_lib::test1::<T>();\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-help: try adding a `where` bound using this expression: where [u8; std::mem::size_of::<T>() - 1]: Sized\n+help: try adding a `where` bound using this expression: `where [u8; std::mem::size_of::<T>() - 1]: Sized`\n   --> $DIR/auxiliary/const_evaluatable_lib.rs:6:10\n    |\n LL |     [u8; std::mem::size_of::<T>() - 1]: Sized,\n@@ -16,7 +16,7 @@ error: unconstrained generic constant\n LL |     let _ = const_evaluatable_lib::test1::<T>();\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-help: try adding a `where` bound using this expression: where [u8; std::mem::size_of::<T>() - 1]: Sized\n+help: try adding a `where` bound using this expression: `where [u8; std::mem::size_of::<T>() - 1]: Sized`\n   --> $DIR/auxiliary/const_evaluatable_lib.rs:4:27\n    |\n LL | pub fn test1<T>() -> [u8; std::mem::size_of::<T>() - 1]\n@@ -28,7 +28,7 @@ error: unconstrained generic constant\n LL |     let _ = const_evaluatable_lib::test1::<T>();\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-help: try adding a `where` bound using this expression: where [u8; std::mem::size_of::<T>() - 1]: Sized\n+help: try adding a `where` bound using this expression: `where [u8; std::mem::size_of::<T>() - 1]: Sized`\n   --> $DIR/auxiliary/const_evaluatable_lib.rs:6:10\n    |\n LL |     [u8; std::mem::size_of::<T>() - 1]: Sized,\n@@ -40,7 +40,7 @@ error: unconstrained generic constant\n LL |     let _ = const_evaluatable_lib::test1::<T>();\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-help: try adding a `where` bound using this expression: where [u8; std::mem::size_of::<T>() - 1]: Sized\n+help: try adding a `where` bound using this expression: `where [u8; std::mem::size_of::<T>() - 1]: Sized`\n   --> $DIR/auxiliary/const_evaluatable_lib.rs:4:27\n    |\n LL | pub fn test1<T>() -> [u8; std::mem::size_of::<T>() - 1]"}, {"sha": "8cdc9b57750ee35f1a4c0861fe1173d69856948d", "filename": "src/test/ui/const-generics/const_evaluatable_checked/different-fn.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst-generics%2Fconst_evaluatable_checked%2Fdifferent-fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst-generics%2Fconst_evaluatable_checked%2Fdifferent-fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fconst_evaluatable_checked%2Fdifferent-fn.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -4,7 +4,7 @@ error: unconstrained generic constant\n LL |     [0; size_of::<Foo<T>>()]\n    |         ^^^^^^^^^^^^^^^^^^^\n    |\n-help: try adding a `where` bound using this expression: where [u8; size_of::<Foo<T>>()]: Sized\n+help: try adding a `where` bound using this expression: `where [u8; size_of::<Foo<T>>()]: Sized`\n   --> $DIR/different-fn.rs:10:9\n    |\n LL |     [0; size_of::<Foo<T>>()]"}, {"sha": "945105d1a2dc6180c1643418f6adcfc16c81be8f", "filename": "src/test/ui/const_evaluatable/needs_where_clause.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst_evaluatable%2Fneeds_where_clause.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst_evaluatable%2Fneeds_where_clause.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst_evaluatable%2Fneeds_where_clause.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -4,7 +4,7 @@ error: unconstrained generic constant\n LL |   b: [f32; complex_maths::<T>(N)],\n    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-help: try adding a `where` bound using this expression: where [u8; complex_maths::<T>(N)]: Sized\n+help: try adding a `where` bound using this expression: `where [u8; complex_maths::<T>(N)]: Sized`\n   --> $DIR/needs_where_clause.rs:11:12\n    |\n LL |   b: [f32; complex_maths::<T>(N)],"}, {"sha": "84a65f0d1d29bd8bdcda5a688ddc2cfbc2855ed0", "filename": "src/test/ui/const_evaluatable/no_where_clause.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst_evaluatable%2Fno_where_clause.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fconst_evaluatable%2Fno_where_clause.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst_evaluatable%2Fno_where_clause.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -4,7 +4,7 @@ error: unconstrained generic constant\n LL |   b: [f32; complex_maths(N)],\n    |      ^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-help: try adding a `where` bound using this expression: where [u8; complex_maths(N)]: Sized\n+help: try adding a `where` bound using this expression: `where [u8; complex_maths(N)]: Sized`\n   --> $DIR/no_where_clause.rs:10:12\n    |\n LL |   b: [f32; complex_maths(N)],"}, {"sha": "d4b93eb074cfed063bfca773fd53b03cde242c26", "filename": "src/test/ui/issues/issue-18919.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-18919.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-18919.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-18919.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -14,7 +14,7 @@ help: you could relax the implicit `Sized` bound on `T` if it were used through\n LL | enum Option<T> {\n    |             ^ this could be changed to `T: ?Sized`...\n LL |     Some(T),\n-   |          - ...if indirection was used here: `Box<T>`\n+   |          - ...if indirection were used here: `Box<T>`\n \n error: aborting due to previous error\n "}, {"sha": "a3d2583292551a18d7d0c852ae66500a5f58cc5d", "filename": "src/test/ui/issues/issue-23281.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-23281.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-23281.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-23281.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -14,7 +14,7 @@ help: you could relax the implicit `Sized` bound on `T` if it were used through\n LL | struct Vec<T> {\n    |            ^ this could be changed to `T: ?Sized`...\n LL |     t: T,\n-   |        - ...if indirection was used here: `Box<T>`\n+   |        - ...if indirection were used here: `Box<T>`\n \n error: aborting due to previous error\n "}, {"sha": "9be4eb1c7fddba3307fbfb6d71237240ed236bd7", "filename": "src/test/ui/issues/issue-4736.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-4736.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-4736.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-4736.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -7,7 +7,7 @@ LL | struct NonCopyable(());\n LL |     let z = NonCopyable{ p: () };\n    |             -----------  ^ field does not exist\n    |             |\n-   |             `NonCopyable` is a tuple struct, use the appropriate syntax: `NonCopyable(/* fields */)`\n+   |             help: `NonCopyable` is a tuple struct, use the appropriate syntax: `NonCopyable(/* fields */)`\n \n error: aborting due to previous error\n "}, {"sha": "22a660b4167d38186fa7f684591e6a13b4981ca0", "filename": "src/test/ui/issues/issue-80607.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-80607.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fissues%2Fissue-80607.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-80607.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -7,7 +7,7 @@ LL |     V1(i32),\n LL |     Enum::V1 { x }\n    |     --------   ^ field does not exist\n    |     |\n-   |     `Enum::V1` is a tuple variant, use the appropriate syntax: `Enum::V1(/* fields */)`\n+   |     help: `Enum::V1` is a tuple variant, use the appropriate syntax: `Enum::V1(/* fields */)`\n \n error: aborting due to previous error\n "}, {"sha": "13b6cfae4ec476584dd1deaeacbf908b89c6b087", "filename": "src/test/ui/numeric/numeric-fields.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fnumeric%2Fnumeric-fields.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fnumeric%2Fnumeric-fields.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnumeric%2Fnumeric-fields.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -7,7 +7,7 @@ LL | struct S(u8, u16);\n LL |     let s = S{0b1: 10, 0: 11};\n    |             - ^^^ field does not exist\n    |             |\n-   |             `S` is a tuple struct, use the appropriate syntax: `S(/* fields */)`\n+   |             help: `S` is a tuple struct, use the appropriate syntax: `S(/* fields */)`\n \n error[E0026]: struct `S` does not have a field named `0x1`\n   --> $DIR/numeric-fields.rs:7:17"}, {"sha": "9437fbe61cc7e94ca92ea364c2b41335908c5af6", "filename": "src/test/ui/suggestions/adt-param-with-implicit-sized-bound.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fsuggestions%2Fadt-param-with-implicit-sized-bound.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fsuggestions%2Fadt-param-with-implicit-sized-bound.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fadt-param-with-implicit-sized-bound.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -13,7 +13,7 @@ help: you could relax the implicit `Sized` bound on `T` if it were used through\n   --> $DIR/adt-param-with-implicit-sized-bound.rs:18:10\n    |\n LL | struct X<T>(T);\n-   |          ^  - ...if indirection was used here: `Box<T>`\n+   |          ^  - ...if indirection were used here: `Box<T>`\n    |          |\n    |          this could be changed to `T: ?Sized`...\n \n@@ -68,7 +68,7 @@ help: you could relax the implicit `Sized` bound on `T` if it were used through\n LL | struct Struct3<T>{\n    |                ^ this could be changed to `T: ?Sized`...\n LL |     _t: T,\n-   |         - ...if indirection was used here: `Box<T>`\n+   |         - ...if indirection were used here: `Box<T>`\n help: consider further restricting `Self`\n    |\n LL |     fn func3() -> Struct3<Self> where Self: Sized;"}, {"sha": "3057d4789bd81df00f41fec9f7e23a52c24ddc87", "filename": "src/test/ui/unsized/unsized-enum.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsized%2Funsized-enum.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -13,7 +13,7 @@ help: you could relax the implicit `Sized` bound on `U` if it were used through\n   --> $DIR/unsized-enum.rs:4:10\n    |\n LL | enum Foo<U> { FooSome(U), FooNone }\n-   |          ^            - ...if indirection was used here: `Box<U>`\n+   |          ^            - ...if indirection were used here: `Box<U>`\n    |          |\n    |          this could be changed to `U: ?Sized`...\n "}, {"sha": "9d8a1c67734a416adaf1c8c26d593581bcf1c4ad", "filename": "src/test/ui/unsized/unsized-inherent-impl-self-type.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-inherent-impl-self-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-inherent-impl-self-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsized%2Funsized-inherent-impl-self-type.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -13,7 +13,7 @@ help: you could relax the implicit `Sized` bound on `Y` if it were used through\n   --> $DIR/unsized-inherent-impl-self-type.rs:5:11\n    |\n LL | struct S5<Y>(Y);\n-   |           ^  - ...if indirection was used here: `Box<Y>`\n+   |           ^  - ...if indirection were used here: `Box<Y>`\n    |           |\n    |           this could be changed to `Y: ?Sized`...\n "}, {"sha": "6661cf358b3ab07ff5e94412f70a9ec78b845cf1", "filename": "src/test/ui/unsized/unsized-struct.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-struct.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-struct.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsized%2Funsized-struct.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -13,7 +13,7 @@ help: you could relax the implicit `Sized` bound on `T` if it were used through\n   --> $DIR/unsized-struct.rs:4:12\n    |\n LL | struct Foo<T> { data: T }\n-   |            ^          - ...if indirection was used here: `Box<T>`\n+   |            ^          - ...if indirection were used here: `Box<T>`\n    |            |\n    |            this could be changed to `T: ?Sized`...\n "}, {"sha": "d1b590d81330707d17f3db9093871def120d267f", "filename": "src/test/ui/unsized/unsized-trait-impl-self-type.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-trait-impl-self-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Funsized%2Funsized-trait-impl-self-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsized%2Funsized-trait-impl-self-type.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -13,7 +13,7 @@ help: you could relax the implicit `Sized` bound on `Y` if it were used through\n   --> $DIR/unsized-trait-impl-self-type.rs:8:11\n    |\n LL | struct S5<Y>(Y);\n-   |           ^  - ...if indirection was used here: `Box<Y>`\n+   |           ^  - ...if indirection were used here: `Box<Y>`\n    |           |\n    |           this could be changed to `Y: ?Sized`...\n "}, {"sha": "22598e58bd744647d086f15feb3c3c72e60a60b9", "filename": "src/test/ui/wf/wf-fn-where-clause.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fwf%2Fwf-fn-where-clause.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftest%2Fui%2Fwf%2Fwf-fn-where-clause.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fwf-fn-where-clause.stderr?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -28,7 +28,7 @@ help: you could relax the implicit `Sized` bound on `T` if it were used through\n LL | struct Vec<T> {\n    |            ^ this could be changed to `T: ?Sized`...\n LL |     t: T,\n-   |        - ...if indirection was used here: `Box<T>`\n+   |        - ...if indirection were used here: `Box<T>`\n \n error[E0038]: the trait `Copy` cannot be made into an object\n   --> $DIR/wf-fn-where-clause.rs:12:16"}, {"sha": "84a0df92f5b43ae45620a9ef0ca3de550ccb2d5a", "filename": "src/tools/clippy/clippy_lints/src/misc_early.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmisc_early.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmisc_early.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmisc_early.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -1,11 +1,12 @@\n-use crate::utils::{constants, snippet_opt, span_lint, span_lint_and_help, span_lint_and_sugg, span_lint_and_then};\n+use crate::utils::{snippet_opt, span_lint, span_lint_and_help, span_lint_and_sugg, span_lint_and_then};\n use rustc_ast::ast::{\n     BindingMode, Expr, ExprKind, GenericParamKind, Generics, Lit, LitFloatType, LitIntType, LitKind, Mutability,\n     NodeId, Pat, PatKind, UnOp,\n };\n use rustc_ast::visit::FnKind;\n use rustc_data_structures::fx::FxHashMap;\n use rustc_errors::Applicability;\n+use rustc_hir::PrimTy;\n use rustc_lint::{EarlyContext, EarlyLintPass, LintContext};\n use rustc_middle::lint::in_external_macro;\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n@@ -264,13 +265,12 @@ impl EarlyLintPass for MiscEarlyLints {\n     fn check_generics(&mut self, cx: &EarlyContext<'_>, gen: &Generics) {\n         for param in &gen.params {\n             if let GenericParamKind::Type { .. } = param.kind {\n-                let name = param.ident.as_str();\n-                if constants::BUILTIN_TYPES.contains(&&*name) {\n+                if let Some(prim_ty) = PrimTy::from_name(param.ident.name) {\n                     span_lint(\n                         cx,\n                         BUILTIN_TYPE_SHADOW,\n                         param.ident.span,\n-                        &format!(\"this generic shadows the built-in type `{}`\", name),\n+                        &format!(\"this generic shadows the built-in type `{}`\", prim_ty.name()),\n                     );\n                 }\n             }"}, {"sha": "522932f054d894eef06d81b7a53203fc255f9d89", "filename": "src/tools/clippy/clippy_lints/src/utils/constants.rs", "status": "removed", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/37d067f5d71331d909102d142ecc50f577e07ae4/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fconstants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37d067f5d71331d909102d142ecc50f577e07ae4/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fconstants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fconstants.rs?ref=37d067f5d71331d909102d142ecc50f577e07ae4", "patch": "@@ -1,13 +0,0 @@\n-//! This module contains some useful constants.\n-\n-#![deny(clippy::missing_docs_in_private_items)]\n-\n-/// List of the built-in types names.\n-///\n-/// See also [the reference][reference-types] for a list of such types.\n-///\n-/// [reference-types]: https://doc.rust-lang.org/reference/types.html\n-pub const BUILTIN_TYPES: &[&str] = &[\n-    \"i8\", \"u8\", \"i16\", \"u16\", \"i32\", \"u32\", \"i64\", \"u64\", \"i128\", \"u128\", \"isize\", \"usize\", \"f32\", \"f64\", \"bool\",\n-    \"str\", \"char\",\n-];"}, {"sha": "de1538233a8c3c96d19b0e8a9d7bf4c701fdddb5", "filename": "src/tools/clippy/clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -8,7 +8,6 @@ pub mod author;\n pub mod camel_case;\n pub mod comparisons;\n pub mod conf;\n-pub mod constants;\n mod diagnostics;\n pub mod eager_or_lazy;\n pub mod higher;"}, {"sha": "9f68c55ec975c1f4ded226b469c074993cd20c76", "filename": "src/tools/tidy/src/style.rs", "status": "modified", "additions": 47, "deletions": 20, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a1d6174c925f54c923599e29b09d6855e6b3a78/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs?ref=9a1d6174c925f54c923599e29b09d6855e6b3a78", "patch": "@@ -18,6 +18,8 @@\n \n use std::path::Path;\n \n+/// Error code markdown is restricted to 80 columns because they can be\n+/// displayed on the console with --example.\n const ERROR_CODE_COLS: usize = 80;\n const COLS: usize = 100;\n \n@@ -55,9 +57,9 @@ enum LIUState {\n /// Lines of this form are allowed to be overlength, because Markdown\n /// offers no way to split a line in the middle of a URL, and the lengths\n /// of URLs to external references are beyond our control.\n-fn line_is_url(columns: usize, line: &str) -> bool {\n-    // more basic check for error_codes.rs, to avoid complexity in implementing two state machines\n-    if columns == ERROR_CODE_COLS {\n+fn line_is_url(is_error_code: bool, columns: usize, line: &str) -> bool {\n+    // more basic check for markdown, to avoid complexity in implementing two state machines\n+    if is_error_code {\n         return line.starts_with('[') && line.contains(\"]:\") && line.contains(\"http\");\n     }\n \n@@ -93,8 +95,13 @@ fn line_is_url(columns: usize, line: &str) -> bool {\n /// Returns `true` if `line` is allowed to be longer than the normal limit.\n /// Currently there is only one exception, for long URLs, but more\n /// may be added in the future.\n-fn long_line_is_ok(max_columns: usize, line: &str) -> bool {\n-    if line_is_url(max_columns, line) {\n+fn long_line_is_ok(extension: &str, is_error_code: bool, max_columns: usize, line: &str) -> bool {\n+    if extension != \"md\" || is_error_code {\n+        if line_is_url(is_error_code, max_columns, line) {\n+            return true;\n+        }\n+    } else if extension == \"md\" {\n+        // non-error code markdown is allowed to be any length\n         return true;\n     }\n \n@@ -158,8 +165,36 @@ pub fn is_in(full_path: &Path, parent_folder_to_find: &str, folder_to_find: &str\n     }\n }\n \n+fn skip_markdown_path(path: &Path) -> bool {\n+    // These aren't ready for tidy.\n+    const SKIP_MD: &[&str] = &[\n+        \"src/doc/edition-guide\",\n+        \"src/doc/embedded-book\",\n+        \"src/doc/nomicon\",\n+        \"src/doc/reference\",\n+        \"src/doc/rust-by-example\",\n+        \"src/doc/rustc-dev-guide\",\n+    ];\n+    SKIP_MD.iter().any(|p| path.ends_with(p))\n+}\n+\n+fn is_unexplained_ignore(extension: &str, line: &str) -> bool {\n+    if !line.ends_with(\"```ignore\") && !line.ends_with(\"```rust,ignore\") {\n+        return false;\n+    }\n+    if extension == \"md\" && line.trim().starts_with(\"//\") {\n+        // Markdown examples may include doc comments with ignore inside a\n+        // code block.\n+        return false;\n+    }\n+    true\n+}\n+\n pub fn check(path: &Path, bad: &mut bool) {\n-    super::walk(path, &mut super::filter_dirs, &mut |entry, contents| {\n+    fn skip(path: &Path) -> bool {\n+        super::filter_dirs(path) || skip_markdown_path(path)\n+    }\n+    super::walk(path, &mut skip, &mut |entry, contents| {\n         let file = entry.path();\n         let filename = file.file_name().unwrap().to_string_lossy();\n         let extensions = [\".rs\", \".py\", \".js\", \".sh\", \".c\", \".cpp\", \".h\", \".md\", \".css\"];\n@@ -176,13 +211,6 @@ pub fn check(path: &Path, bad: &mut bool) {\n                     a.ends_with(\"src/doc/book\")\n             });\n \n-        if filename.ends_with(\".md\")\n-            && file.parent().unwrap().file_name().unwrap().to_string_lossy() != \"error_codes\"\n-        {\n-            // We don't want to check all \".md\" files (almost of of them aren't compliant\n-            // currently), just the long error code explanation ones.\n-            return;\n-        }\n         if is_style_file && !is_in(file, \"src\", \"librustdoc\") {\n             // We only check CSS files in rustdoc.\n             return;\n@@ -192,11 +220,10 @@ pub fn check(path: &Path, bad: &mut bool) {\n             tidy_error!(bad, \"{}: empty file\", file.display());\n         }\n \n-        let max_columns = if filename == \"error_codes.rs\" || filename.ends_with(\".md\") {\n-            ERROR_CODE_COLS\n-        } else {\n-            COLS\n-        };\n+        let extension = file.extension().unwrap().to_string_lossy();\n+        let is_error_code = extension == \"md\" && is_in(file, \"src\", \"error_codes\");\n+\n+        let max_columns = if is_error_code { ERROR_CODE_COLS } else { COLS };\n \n         let can_contain = contents.contains(\"// ignore-tidy-\")\n             || contents.contains(\"# ignore-tidy-\")\n@@ -227,7 +254,7 @@ pub fn check(path: &Path, bad: &mut bool) {\n             };\n             if !under_rustfmt\n                 && line.chars().count() > max_columns\n-                && !long_line_is_ok(max_columns, line)\n+                && !long_line_is_ok(&extension, is_error_code, max_columns, line)\n             {\n                 suppressible_tidy_err!(\n                     err,\n@@ -280,7 +307,7 @@ pub fn check(path: &Path, bad: &mut bool) {\n                     \"copyright notices attributed to the Rust Project Developers are deprecated\"\n                 );\n             }\n-            if line.ends_with(\"```ignore\") || line.ends_with(\"```rust,ignore\") {\n+            if is_unexplained_ignore(&extension, line) {\n                 err(UNEXPLAINED_IGNORE_DOCTEST_INFO);\n             }\n             if filename.ends_with(\".cpp\") && line.contains(\"llvm_unreachable\") {"}]}