{"sha": "5f402b827726607b04887c7c7b8d8b95cce8f487", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmNDAyYjgyNzcyNjYwN2IwNDg4N2M3YzdiOGQ4Yjk1Y2NlOGY0ODc=", "commit": {"author": {"name": "Bj\u00f6rn Steinbrink", "email": "bsteinbr@gmail.com", "date": "2019-01-10T18:28:42Z"}, "committer": {"name": "Bj\u00f6rn Steinbrink", "email": "bsteinbr@gmail.com", "date": "2019-01-10T20:28:06Z"}, "message": "Add a fast path for identical regions in lub_concrete_regions\n\nIn functions with lots of region constraint, if the fixed point\niteration converges only slowly, a lot of the var/var constraints will\nhave equal regions most of the time. Yet, we still perform the LUB\ncalculation and try to intern the result. Especially the latter incurs\nquite some overhead.\n\nThis reduces the take taken by the item bodies checking pass for the\nunicode_normalization crate by about 75%.", "tree": {"sha": "0862e62ffbc115f2119bdeba949e0a944c176157", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0862e62ffbc115f2119bdeba949e0a944c176157"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f402b827726607b04887c7c7b8d8b95cce8f487", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f402b827726607b04887c7c7b8d8b95cce8f487", "html_url": "https://github.com/rust-lang/rust/commit/5f402b827726607b04887c7c7b8d8b95cce8f487", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f402b827726607b04887c7c7b8d8b95cce8f487/comments", "author": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "07600c939b594b39f560bc969caca2e92498435a", "url": "https://api.github.com/repos/rust-lang/rust/commits/07600c939b594b39f560bc969caca2e92498435a", "html_url": "https://github.com/rust-lang/rust/commit/07600c939b594b39f560bc969caca2e92498435a"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "39ce8cc621b49d9215de6dfe3998085a937eead7", "filename": "src/librustc/infer/lexical_region_resolve/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5f402b827726607b04887c7c7b8d8b95cce8f487/src%2Flibrustc%2Finfer%2Flexical_region_resolve%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f402b827726607b04887c7c7b8d8b95cce8f487/src%2Flibrustc%2Finfer%2Flexical_region_resolve%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Flexical_region_resolve%2Fmod.rs?ref=5f402b827726607b04887c7c7b8d8b95cce8f487", "patch": "@@ -274,6 +274,13 @@ impl<'cx, 'gcx, 'tcx> LexicalResolver<'cx, 'gcx, 'tcx> {\n \n     fn lub_concrete_regions(&self, a: Region<'tcx>, b: Region<'tcx>) -> Region<'tcx> {\n         let tcx = self.tcx();\n+\n+        // Equal scopes can show up quite often, if the fixed point\n+        // iteration converges slowly, skip them\n+        if a == b {\n+            return a;\n+        }\n+\n         match (a, b) {\n             (&ty::ReClosureBound(..), _)\n             | (_, &ty::ReClosureBound(..))"}]}