{"sha": "4fae04968eccb8797000b5a42760005b35504136", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmYWUwNDk2OGVjY2I4Nzk3MDAwYjVhNDI3NjAwMDViMzU1MDQxMzY=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-08-14T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-08-14T20:21:56Z"}, "message": "MatchBranchSimplification: copy discriminant instead of moving it\n\nIt might be necessary to use its value more than once.", "tree": {"sha": "9b958512960a05e7232487fe765e9f84e2c4863e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9b958512960a05e7232487fe765e9f84e2c4863e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4fae04968eccb8797000b5a42760005b35504136", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4fae04968eccb8797000b5a42760005b35504136", "html_url": "https://github.com/rust-lang/rust/commit/4fae04968eccb8797000b5a42760005b35504136", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4fae04968eccb8797000b5a42760005b35504136/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60d7d28948c1a3d5125f12a2254f6edb5077c4c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/60d7d28948c1a3d5125f12a2254f6edb5077c4c9", "html_url": "https://github.com/rust-lang/rust/commit/60d7d28948c1a3d5125f12a2254f6edb5077c4c9"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "cdf181aab02dd3cacb9d0fb6ee17e877c48e80c4", "filename": "src/librustc_mir/transform/match_branches.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4fae04968eccb8797000b5a42760005b35504136/src%2Flibrustc_mir%2Ftransform%2Fmatch_branches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fae04968eccb8797000b5a42760005b35504136/src%2Flibrustc_mir%2Ftransform%2Fmatch_branches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fmatch_branches.rs?ref=4fae04968eccb8797000b5a42760005b35504136", "patch": "@@ -78,7 +78,7 @@ impl<'tcx> MirPass<'tcx> for MatchBranchSimplification {\n                         );\n                         if let Some(c) = c.literal.try_eval_bool(tcx, param_env) {\n                             let op = if c { BinOp::Eq } else { BinOp::Ne };\n-                            *rhs = Rvalue::BinaryOp(op, Operand::Move(discr), const_cmp);\n+                            *rhs = Rvalue::BinaryOp(op, Operand::Copy(discr), const_cmp);\n                         }\n                     }\n                 }"}, {"sha": "9324762fb0803fb790720db8536a8208e6950a75", "filename": "src/test/mir-opt/matches_reduce_branches.foo.MatchBranchSimplification.diff.32bit", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4fae04968eccb8797000b5a42760005b35504136/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.diff.32bit", "raw_url": "https://github.com/rust-lang/rust/raw/4fae04968eccb8797000b5a42760005b35504136/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.diff.32bit", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.diff.32bit?ref=4fae04968eccb8797000b5a42760005b35504136", "patch": "@@ -11,7 +11,7 @@\n           StorageLive(_2);                 // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           _3 = discriminant(_1);           // scope 0 at $DIR/matches_reduce_branches.rs:5:22: 5:26\n -         switchInt(move _3) -> [0_isize: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:5:22: 5:26\n-+         _2 = Eq(move _3, const 0_isize); // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n++         _2 = Eq(_3, const 0_isize);      // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n +                                          // ty::Const\n +                                          // + ty: isize\n +                                          // + val: Value(Scalar(0x00000000))"}, {"sha": "144a71228ad696650d7ba5bc7f187e8c40723046", "filename": "src/test/mir-opt/matches_reduce_branches.foo.MatchBranchSimplification.diff.64bit", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4fae04968eccb8797000b5a42760005b35504136/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.diff.64bit", "raw_url": "https://github.com/rust-lang/rust/raw/4fae04968eccb8797000b5a42760005b35504136/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.diff.64bit", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.diff.64bit?ref=4fae04968eccb8797000b5a42760005b35504136", "patch": "@@ -11,7 +11,7 @@\n           StorageLive(_2);                 // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           _3 = discriminant(_1);           // scope 0 at $DIR/matches_reduce_branches.rs:5:22: 5:26\n -         switchInt(move _3) -> [0_isize: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:5:22: 5:26\n-+         _2 = Eq(move _3, const 0_isize); // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n++         _2 = Eq(_3, const 0_isize);      // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n +                                          // ty::Const\n +                                          // + ty: isize\n +                                          // + val: Value(Scalar(0x0000000000000000))"}]}