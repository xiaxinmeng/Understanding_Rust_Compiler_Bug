{"sha": "c20654ebc318004a98303d2d5d84eee8bf44080c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyMDY1NGViYzMxODAwNGE5ODMwM2QyZDVkODRlZWU4YmY0NDA4MGM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-07T21:24:29Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-07T21:24:29Z"}, "message": "Auto merge of #64358 - cuviper:rustc-rayon-1.2, r=nikomatsakis\n\nRebase rustc-rayon on rayon-1.2\n\nSee also https://github.com/rust-lang/rustc-rayon/pull/3", "tree": {"sha": "7a3da5e5136320c54830e2b3e04d8845b8a70b42", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a3da5e5136320c54830e2b3e04d8845b8a70b42"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c20654ebc318004a98303d2d5d84eee8bf44080c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c20654ebc318004a98303d2d5d84eee8bf44080c", "html_url": "https://github.com/rust-lang/rust/commit/c20654ebc318004a98303d2d5d84eee8bf44080c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c20654ebc318004a98303d2d5d84eee8bf44080c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3c9cece7b6829e6fd7854a1aee6a1619a81a38c", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c", "html_url": "https://github.com/rust-lang/rust/commit/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c"}, {"sha": "29cd7eb6c9d9061d10af6207fd77705eeb4d6549", "url": "https://api.github.com/repos/rust-lang/rust/commits/29cd7eb6c9d9061d10af6207fd77705eeb4d6549", "html_url": "https://github.com/rust-lang/rust/commit/29cd7eb6c9d9061d10af6207fd77705eeb4d6549"}], "stats": {"total": 86, "additions": 61, "deletions": 25}, "files": [{"sha": "2c8aa41df824148f5bd4c2c2d70c937be9fd8287", "filename": "Cargo.lock", "status": "modified", "additions": 49, "deletions": 15, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/c20654ebc318004a98303d2d5d84eee8bf44080c/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/c20654ebc318004a98303d2d5d84eee8bf44080c/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=c20654ebc318004a98303d2d5d84eee8bf44080c", "patch": "@@ -659,6 +659,16 @@ dependencies = [\n  \"crossbeam-utils 0.6.5\",\n ]\n \n+[[package]]\n+name = \"crossbeam-deque\"\n+version = \"0.7.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"b18cd2e169ad86297e6bc0ad9aa679aee9daa4f19e8163860faf7c164e4f5a71\"\n+dependencies = [\n+ \"crossbeam-epoch 0.7.2\",\n+ \"crossbeam-utils 0.6.5\",\n+]\n+\n [[package]]\n name = \"crossbeam-epoch\"\n version = \"0.3.1\"\n@@ -2791,22 +2801,22 @@ dependencies = [\n \n [[package]]\n name = \"rayon\"\n-version = \"1.1.0\"\n+version = \"1.2.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a4b0186e22767d5b9738a05eab7c6ac90b15db17e5b5f9bd87976dd7d89a10a4\"\n+checksum = \"83a27732a533a1be0a0035a111fe76db89ad312f6f0347004c220c57f209a123\"\n dependencies = [\n- \"crossbeam-deque 0.6.3\",\n+ \"crossbeam-deque 0.7.1\",\n  \"either\",\n  \"rayon-core\",\n ]\n \n [[package]]\n name = \"rayon-core\"\n-version = \"1.5.0\"\n+version = \"1.6.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ebbe0df8435ac0c397d467b6cad6d25543d06e8a019ef3f6af3c384597515bd2\"\n+checksum = \"98dcf634205083b17d0861252431eb2acbfb698ab7478a2d20de07954f47ec7b\"\n dependencies = [\n- \"crossbeam-deque 0.6.3\",\n+ \"crossbeam-deque 0.7.1\",\n  \"crossbeam-queue\",\n  \"crossbeam-utils 0.6.5\",\n  \"lazy_static 1.3.0\",\n@@ -3074,8 +3084,8 @@ dependencies = [\n  \"num_cpus\",\n  \"parking_lot 0.9.0\",\n  \"polonius-engine\",\n- \"rustc-rayon\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon 0.3.0\",\n+ \"rustc-rayon-core 0.3.0\",\n  \"rustc_apfloat\",\n  \"rustc_data_structures\",\n  \"rustc_errors\",\n@@ -3123,8 +3133,8 @@ dependencies = [\n  \"rustc-ap-graphviz\",\n  \"rustc-ap-serialize\",\n  \"rustc-hash\",\n- \"rustc-rayon\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon 0.2.0\",\n+ \"rustc-rayon-core 0.2.0\",\n  \"smallvec\",\n  \"stable_deref_trait\",\n ]\n@@ -3263,7 +3273,18 @@ checksum = \"0d2e07e19601f21c59aad953c2632172ba70cb27e685771514ea66e4062b3363\"\n dependencies = [\n  \"crossbeam-deque 0.2.0\",\n  \"either\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon-core 0.2.0\",\n+]\n+\n+[[package]]\n+name = \"rustc-rayon\"\n+version = \"0.3.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"f32767f90d938f1b7199a174ef249ae1924f6e5bbdb9d112fea141e016f25b3a\"\n+dependencies = [\n+ \"crossbeam-deque 0.7.1\",\n+ \"either\",\n+ \"rustc-rayon-core 0.3.0\",\n ]\n \n [[package]]\n@@ -3278,6 +3299,19 @@ dependencies = [\n  \"num_cpus\",\n ]\n \n+[[package]]\n+name = \"rustc-rayon-core\"\n+version = \"0.3.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ea2427831f0053ea3ea73559c8eabd893133a51b251d142bacee53c62a288cb3\"\n+dependencies = [\n+ \"crossbeam-deque 0.7.1\",\n+ \"crossbeam-queue\",\n+ \"crossbeam-utils 0.6.5\",\n+ \"lazy_static 1.3.0\",\n+ \"num_cpus\",\n+]\n+\n [[package]]\n name = \"rustc-serialize\"\n version = \"0.3.24\"\n@@ -3398,8 +3432,8 @@ dependencies = [\n  \"log\",\n  \"parking_lot 0.9.0\",\n  \"rustc-hash\",\n- \"rustc-rayon\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon 0.3.0\",\n+ \"rustc-rayon-core 0.3.0\",\n  \"rustc_index\",\n  \"serialize\",\n  \"smallvec\",\n@@ -3479,7 +3513,7 @@ dependencies = [\n  \"log\",\n  \"once_cell\",\n  \"rustc\",\n- \"rustc-rayon\",\n+ \"rustc-rayon 0.3.0\",\n  \"rustc_codegen_ssa\",\n  \"rustc_codegen_utils\",\n  \"rustc_data_structures\",\n@@ -3758,7 +3792,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"minifier\",\n  \"pulldown-cmark 0.5.3\",\n- \"rustc-rayon\",\n+ \"rustc-rayon 0.3.0\",\n  \"tempfile\",\n ]\n "}, {"sha": "9b3609eca3e621be41054851cd692a9bf2d87ebd", "filename": "src/librustc/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2FCargo.toml?ref=c20654ebc318004a98303d2d5d84eee8bf44080c", "patch": "@@ -18,8 +18,8 @@ jobserver = \"0.1\"\n num_cpus = \"1.0\"\n scoped-tls = \"1.0\"\n log = { version = \"0.4\", features = [\"release_max_level_info\", \"std\"] }\n-rustc-rayon = \"0.2.0\"\n-rustc-rayon-core = \"0.2.0\"\n+rustc-rayon = \"0.3.0\"\n+rustc-rayon-core = \"0.3.0\"\n polonius-engine  = \"0.10.0\"\n rustc_apfloat = { path = \"../librustc_apfloat\" }\n rustc_target = { path = \"../librustc_target\" }"}, {"sha": "065c8436ae06aa54fc5c19e9e727e94cf7873177", "filename": "src/librustc_data_structures/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc_data_structures%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc_data_structures%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2FCargo.toml?ref=c20654ebc318004a98303d2d5d84eee8bf44080c", "patch": "@@ -20,8 +20,8 @@ graphviz = { path = \"../libgraphviz\" }\n cfg-if = \"0.1.2\"\n crossbeam-utils = { version = \"0.6.5\", features = [\"nightly\"] }\n stable_deref_trait = \"1.0.0\"\n-rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n-rayon-core = { version = \"0.2.0\", package = \"rustc-rayon-core\" }\n+rayon = { version = \"0.3.0\", package = \"rustc-rayon\" }\n+rayon-core = { version = \"0.3.0\", package = \"rustc-rayon-core\" }\n rustc-hash = \"1.0.1\"\n smallvec = { version = \"0.6.7\", features = [\"union\", \"may_dangle\"] }\n rustc_index = { path = \"../librustc_index\", package = \"rustc_index\" }"}, {"sha": "bed5febb72ede4421f20f27f589da22fdb0ed39a", "filename": "src/librustc_interface/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc_interface%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc_interface%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2FCargo.toml?ref=c20654ebc318004a98303d2d5d84eee8bf44080c", "patch": "@@ -11,7 +11,7 @@ doctest = false\n \n [dependencies]\n log = \"0.4\"\n-rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n+rayon = { version = \"0.3.0\", package = \"rustc-rayon\" }\n smallvec = { version = \"0.6.7\", features = [\"union\", \"may_dangle\"] }\n syntax = { path = \"../libsyntax\" }\n syntax_ext = { path = \"../libsyntax_ext\" }"}, {"sha": "0c272f0c4563b01b5dbb01125bfdecf7c8c8556b", "filename": "src/librustc_interface/util.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc_interface%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustc_interface%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Futil.rs?ref=c20654ebc318004a98303d2d5d84eee8bf44080c", "patch": "@@ -202,11 +202,12 @@ pub fn spawn_thread_pool<F: FnOnce() -> R + Send, R: Send>(\n     stderr: &Option<Arc<Mutex<Vec<u8>>>>,\n     f: F,\n ) -> R {\n-    use rayon::{ThreadPool, ThreadPoolBuilder};\n+    use rayon::{ThreadBuilder, ThreadPool, ThreadPoolBuilder};\n \n     let gcx_ptr = &Lock::new(0);\n \n     let mut config = ThreadPoolBuilder::new()\n+        .thread_name(|_| \"rustc\".to_string())\n         .acquire_thread_handler(jobserver::acquire_thread)\n         .release_thread_handler(jobserver::release_thread)\n         .num_threads(threads)\n@@ -225,20 +226,20 @@ pub fn spawn_thread_pool<F: FnOnce() -> R + Send, R: Send>(\n                 // the thread local rustc uses. syntax_globals and syntax_pos_globals are\n                 // captured and set on the new threads. ty::tls::with_thread_locals sets up\n                 // thread local callbacks from libsyntax\n-                let main_handler = move |worker: &mut dyn FnMut()| {\n+                let main_handler = move |thread: ThreadBuilder| {\n                     syntax::GLOBALS.set(syntax_globals, || {\n                         syntax_pos::GLOBALS.set(syntax_pos_globals, || {\n                             if let Some(stderr) = stderr {\n                                 io::set_panic(Some(box Sink(stderr.clone())));\n                             }\n                             ty::tls::with_thread_locals(|| {\n-                                ty::tls::GCX_PTR.set(gcx_ptr, || worker())\n+                                ty::tls::GCX_PTR.set(gcx_ptr, || thread.run())\n                             })\n                         })\n                     })\n                 };\n \n-                ThreadPool::scoped_pool(config, main_handler, with_pool).unwrap()\n+                config.build_scoped(main_handler, with_pool).unwrap()\n             })\n         })\n     })"}, {"sha": "e3de7fe20493e8353dbb0f729ab2390a58d47f37", "filename": "src/librustdoc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustdoc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Flibrustdoc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2FCargo.toml?ref=c20654ebc318004a98303d2d5d84eee8bf44080c", "patch": "@@ -11,5 +11,5 @@ path = \"lib.rs\"\n [dependencies]\n pulldown-cmark = { version = \"0.5.3\", default-features = false }\n minifier = \"0.0.33\"\n-rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n+rayon = { version = \"0.3.0\", package = \"rustc-rayon\" }\n tempfile = \"3\""}, {"sha": "8e46ca6cd2990e199e9ad47ab49b09ead44d7334", "filename": "src/tools/tidy/src/deps.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c20654ebc318004a98303d2d5d84eee8bf44080c/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs?ref=c20654ebc318004a98303d2d5d84eee8bf44080c", "patch": "@@ -89,6 +89,7 @@ const WHITELIST: &[Crate<'_>] = &[\n     Crate(\"crc32fast\"),\n     Crate(\"crossbeam-deque\"),\n     Crate(\"crossbeam-epoch\"),\n+    Crate(\"crossbeam-queue\"),\n     Crate(\"crossbeam-utils\"),\n     Crate(\"datafrog\"),\n     Crate(\"dlmalloc\"),"}]}