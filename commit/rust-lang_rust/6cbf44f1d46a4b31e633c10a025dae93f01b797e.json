{"sha": "6cbf44f1d46a4b31e633c10a025dae93f01b797e", "node_id": "C_kwDOAAsO6NoAKDZjYmY0NGYxZDQ2YTRiMzFlNjMzYzEwYTAyNWRhZTkzZjAxYjc5N2U", "commit": {"author": {"name": "cynecx", "email": "me@cynecx.net", "date": "2021-09-04T20:14:09Z"}, "committer": {"name": "cynecx", "email": "me@cynecx.net", "date": "2021-12-03T22:51:49Z"}, "message": "cg_cranelift: check may_unwind flag instead of cleanup", "tree": {"sha": "83f8f773e723b8912811cb0c06caade0de54da47", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83f8f773e723b8912811cb0c06caade0de54da47"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6cbf44f1d46a4b31e633c10a025dae93f01b797e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6cbf44f1d46a4b31e633c10a025dae93f01b797e", "html_url": "https://github.com/rust-lang/rust/commit/6cbf44f1d46a4b31e633c10a025dae93f01b797e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6cbf44f1d46a4b31e633c10a025dae93f01b797e/comments", "author": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "91021de1f67de546b7ef41e03fc787f03ecf2239", "url": "https://api.github.com/repos/rust-lang/rust/commits/91021de1f67de546b7ef41e03fc787f03ecf2239", "html_url": "https://github.com/rust-lang/rust/commit/91021de1f67de546b7ef41e03fc787f03ecf2239"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "371c71de62fbbb421c18707e08b5f83b4524ecc1", "filename": "compiler/rustc_codegen_cranelift/src/base.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6cbf44f1d46a4b31e633c10a025dae93f01b797e/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6cbf44f1d46a4b31e633c10a025dae93f01b797e/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fbase.rs?ref=6cbf44f1d46a4b31e633c10a025dae93f01b797e", "patch": "@@ -1,6 +1,7 @@\n //! Codegen of a single function\n \n use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n+use rustc_ast::InlineAsmOptions;\n use rustc_index::vec::IndexVec;\n use rustc_middle::ty::adjustment::PointerCast;\n use rustc_middle::ty::layout::FnAbiOf;\n@@ -379,9 +380,9 @@ fn codegen_fn_content(fx: &mut FunctionCx<'_, '_, '_>) {\n                 options,\n                 destination,\n                 line_spans: _,\n-                cleanup,\n+                cleanup: _,\n             } => {\n-                if cleanup.is_some() {\n+                if options.contains(InlineAsmOptions::MAY_UNWIND) {\n                     fx.tcx.sess.span_fatal(\n                         source_info.span,\n                         \"cranelift doesn't support unwinding from inline assembly.\","}]}