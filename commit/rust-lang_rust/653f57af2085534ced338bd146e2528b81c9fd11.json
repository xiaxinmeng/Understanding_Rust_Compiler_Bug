{"sha": "653f57af2085534ced338bd146e2528b81c9fd11", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1M2Y1N2FmMjA4NTUzNGNlZDMzOGJkMTQ2ZTI1MjhiODFjOWZkMTE=", "commit": {"author": {"name": "Cameron Zwarich", "email": "zwarich@mozilla.com", "date": "2014-06-07T09:46:35Z"}, "committer": {"name": "Cameron Zwarich", "email": "zwarich@mozilla.com", "date": "2014-06-07T10:03:03Z"}, "message": "Fix bad borrowck tests and move them from run-pass to compile-fail\n\nThe move_after_borrow / fu_move_after_borrow tests in\nrun-pass/borrowck-field-sensitivity.rs are not testing the right thing,\nsince the scope of the borrow is limited to the call to borrow(). When\nfixed, these tests fail and thus should be moved to the corresponding\ncompile-fail test file.", "tree": {"sha": "232edcaaf6bf85cac8c2e906e78090fe89cd0d9c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/232edcaaf6bf85cac8c2e906e78090fe89cd0d9c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/653f57af2085534ced338bd146e2528b81c9fd11", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/653f57af2085534ced338bd146e2528b81c9fd11", "html_url": "https://github.com/rust-lang/rust/commit/653f57af2085534ced338bd146e2528b81c9fd11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/653f57af2085534ced338bd146e2528b81c9fd11/comments", "author": null, "committer": null, "parents": [{"sha": "61c81bf00cc8f8a87940fce3ba7be0bfd66cf04f", "url": "https://api.github.com/repos/rust-lang/rust/commits/61c81bf00cc8f8a87940fce3ba7be0bfd66cf04f", "html_url": "https://github.com/rust-lang/rust/commit/61c81bf00cc8f8a87940fce3ba7be0bfd66cf04f"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "9a0d81e7332087b5a68e348f00b53b260ae056a6", "filename": "src/test/compile-fail/borrowck-field-sensitivity.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/653f57af2085534ced338bd146e2528b81c9fd11/src%2Ftest%2Fcompile-fail%2Fborrowck-field-sensitivity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/653f57af2085534ced338bd146e2528b81c9fd11/src%2Ftest%2Fcompile-fail%2Fborrowck-field-sensitivity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fborrowck-field-sensitivity.rs?ref=653f57af2085534ced338bd146e2528b81c9fd11", "patch": "@@ -84,6 +84,20 @@ fn fu_move_after_fu_move() {\n \n // The following functions aren't yet accepted, but they should be.\n \n+fn move_after_borrow_correct() {\n+    let x = A { a: 1, b: box 2 };\n+    let p = &x.a;\n+    drop(x.b); //~ ERROR cannot move out of `x.b` because it is borrowed\n+    drop(*p);\n+}\n+\n+fn fu_move_after_borrow_correct() {\n+    let x = A { a: 1, b: box 2 };\n+    let p = &x.a;\n+    let _y = A { a: 3, .. x }; //~ ERROR cannot move out of `x.b` because it is borrowed\n+    drop(*p);\n+}\n+\n fn copy_after_field_assign_after_uninit() {\n     let mut x: A;\n     x.a = 1;\n@@ -117,6 +131,9 @@ fn main() {\n     fu_move_after_move();\n     fu_move_after_fu_move();\n \n+    move_after_borrow_correct();\n+    fu_move_after_borrow_correct();\n+\n     copy_after_field_assign_after_uninit();\n     borrow_after_field_assign_after_uninit();\n     move_after_field_assign_after_uninit();"}, {"sha": "2500ec764ebaa2e84437f1043a694bd9fde09cf4", "filename": "src/test/run-pass/borrowck-field-sensitivity.rs", "status": "modified", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/653f57af2085534ced338bd146e2528b81c9fd11/src%2Ftest%2Frun-pass%2Fborrowck-field-sensitivity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/653f57af2085534ced338bd146e2528b81c9fd11/src%2Ftest%2Frun-pass%2Fborrowck-field-sensitivity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fborrowck-field-sensitivity.rs?ref=653f57af2085534ced338bd146e2528b81c9fd11", "patch": "@@ -73,18 +73,6 @@ fn borrow_after_fu_move() {\n     borrow(&x.a);\n }\n \n-fn move_after_borrow() {\n-    let x = A { a: 1, b: box 2 };\n-    borrow(&x.a);\n-    drop(x.b);\n-}\n-\n-fn fu_move_after_borrow() {\n-    let x = A { a: 1, b: box 2 };\n-    borrow(&x.a);\n-    let _y = A { a: 3, .. x };\n-}\n-\n fn mut_borrow_after_mut_borrow() {\n     let mut x = A { a: 1, b: box 2 };\n     let y = &mut x.a;\n@@ -232,8 +220,6 @@ fn main() {\n \n     borrow_after_move();\n     borrow_after_fu_move();\n-    move_after_borrow();\n-    fu_move_after_borrow();\n     mut_borrow_after_mut_borrow();\n \n     move_after_move();"}]}