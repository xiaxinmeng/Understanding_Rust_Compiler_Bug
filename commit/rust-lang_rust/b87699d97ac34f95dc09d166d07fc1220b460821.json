{"sha": "b87699d97ac34f95dc09d166d07fc1220b460821", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI4NzY5OWQ5N2FjMzRmOTVkYzA5ZDE2NmQwN2ZjMTIyMGI0NjA4MjE=", "commit": {"author": {"name": "Marijn Suijten", "email": "marijn@traverseresearch.nl", "date": "2020-11-17T14:33:10Z"}, "committer": {"name": "Marijn Suijten", "email": "marijn@traverseresearch.nl", "date": "2021-01-03T11:05:53Z"}, "message": "ssr: Add tests for raw LetStmt matching", "tree": {"sha": "0ee78ef09ec52ea8a6cc7846679d3a1459b1c300", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ee78ef09ec52ea8a6cc7846679d3a1459b1c300"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b87699d97ac34f95dc09d166d07fc1220b460821", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b87699d97ac34f95dc09d166d07fc1220b460821", "html_url": "https://github.com/rust-lang/rust/commit/b87699d97ac34f95dc09d166d07fc1220b460821", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b87699d97ac34f95dc09d166d07fc1220b460821/comments", "author": {"login": "MarijnS95", "id": 2325264, "node_id": "MDQ6VXNlcjIzMjUyNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2325264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarijnS95", "html_url": "https://github.com/MarijnS95", "followers_url": "https://api.github.com/users/MarijnS95/followers", "following_url": "https://api.github.com/users/MarijnS95/following{/other_user}", "gists_url": "https://api.github.com/users/MarijnS95/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarijnS95/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarijnS95/subscriptions", "organizations_url": "https://api.github.com/users/MarijnS95/orgs", "repos_url": "https://api.github.com/users/MarijnS95/repos", "events_url": "https://api.github.com/users/MarijnS95/events{/privacy}", "received_events_url": "https://api.github.com/users/MarijnS95/received_events", "type": "User", "site_admin": false}, "committer": {"login": "MarijnS95", "id": 2325264, "node_id": "MDQ6VXNlcjIzMjUyNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2325264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarijnS95", "html_url": "https://github.com/MarijnS95", "followers_url": "https://api.github.com/users/MarijnS95/followers", "following_url": "https://api.github.com/users/MarijnS95/following{/other_user}", "gists_url": "https://api.github.com/users/MarijnS95/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarijnS95/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarijnS95/subscriptions", "organizations_url": "https://api.github.com/users/MarijnS95/orgs", "repos_url": "https://api.github.com/users/MarijnS95/repos", "events_url": "https://api.github.com/users/MarijnS95/events{/privacy}", "received_events_url": "https://api.github.com/users/MarijnS95/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42da26e9597443812da5a59b3fa48bdcbf619666", "url": "https://api.github.com/repos/rust-lang/rust/commits/42da26e9597443812da5a59b3fa48bdcbf619666", "html_url": "https://github.com/rust-lang/rust/commit/42da26e9597443812da5a59b3fa48bdcbf619666"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "c4149a849b01d1c945dff3300bcef6edd58b19a7", "filename": "crates/ssr/src/tests.rs", "status": "modified", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/b87699d97ac34f95dc09d166d07fc1220b460821/crates%2Fssr%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b87699d97ac34f95dc09d166d07fc1220b460821/crates%2Fssr%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fssr%2Fsrc%2Ftests.rs?ref=b87699d97ac34f95dc09d166d07fc1220b460821", "patch": "@@ -159,6 +159,50 @@ fn assert_match_failure_reason(pattern: &str, code: &str, snippet: &str, expecte\n     assert_eq!(reasons, vec![expected_reason]);\n }\n \n+#[test]\n+fn ssr_let_stmt_in_macro_match() {\n+    assert_matches(\n+        \"let a = 0\",\n+        r#\"\n+            macro_rules! m1 { ($a:stmt) => {$a}; }\n+            fn f() {m1!{ let a = 0 };}\"#,\n+        // FIXME: Whitespace is not part of the matched block\n+        &[\"leta=0\"],\n+    );\n+}\n+\n+#[test]\n+fn ssr_let_stmt_in_fn_match() {\n+    assert_matches(\"let $a = 10;\", \"fn main() { let x = 10; x }\", &[\"let x = 10;\"]);\n+    assert_matches(\"let $a = $b;\", \"fn main() { let x = 10; x }\", &[\"let x = 10;\"]);\n+}\n+\n+#[test]\n+fn ssr_block_expr_match() {\n+    assert_matches(\"{ let $a = $b; }\", \"fn main() { let x = 10; }\", &[\"{ let x = 10; }\"]);\n+    assert_matches(\"{ let $a = $b; $c }\", \"fn main() { let x = 10; x }\", &[\"{ let x = 10; x }\"]);\n+}\n+\n+#[test]\n+fn ssr_let_stmt_replace() {\n+    // Pattern and template with trailing semicolon\n+    assert_ssr_transform(\n+        \"let $a = $b; ==>> let $a = 11;\",\n+        \"fn main() { let x = 10; x }\",\n+        expect![[\"fn main() { let x = 11; x }\"]],\n+    );\n+}\n+\n+#[test]\n+fn ssr_let_stmt_replace_expr() {\n+    // Trailing semicolon should be dropped from the new expression\n+    assert_ssr_transform(\n+        \"let $a = $b; ==>> $b\",\n+        \"fn main() { let x = 10; }\",\n+        expect![[\"fn main() { 10 }\"]],\n+    );\n+}\n+\n #[test]\n fn ssr_function_to_method() {\n     assert_ssr_transform("}]}