{"sha": "5424140b66bf839d20cbf32bf4604e23b30074c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0MjQxNDBiNjZiZjgzOWQyMGNiZjMyYmY0NjA0ZTIzYjMwMDc0YzU=", "commit": {"author": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2021-02-04T22:39:15Z"}, "committer": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2021-02-06T07:28:12Z"}, "message": "Add SIMD shuffles for SimdType{2,4,8,16,32,64}\n\nThis const generic implementation for certain lane sizes represents\na more limited interface than what LLVM's shufflevector instruction\ncan handle, as normally the length of U can be different from the\nlength of T, but offers an interface that it is expected to be able\nto expand the capabilities of in the future.", "tree": {"sha": "0d80fe7372a2bcfe97eb695914c71a93fd35eb92", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d80fe7372a2bcfe97eb695914c71a93fd35eb92"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5424140b66bf839d20cbf32bf4604e23b30074c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5424140b66bf839d20cbf32bf4604e23b30074c5", "html_url": "https://github.com/rust-lang/rust/commit/5424140b66bf839d20cbf32bf4604e23b30074c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5424140b66bf839d20cbf32bf4604e23b30074c5/comments", "author": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b6b5d71424a6b55c0209117d72af45253ffe8c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b6b5d71424a6b55c0209117d72af45253ffe8c5", "html_url": "https://github.com/rust-lang/rust/commit/9b6b5d71424a6b55c0209117d72af45253ffe8c5"}], "stats": {"total": 65, "additions": 64, "deletions": 1}, "files": [{"sha": "4ea3837634874830f9bab9644c4bb335426082db", "filename": "crates/core_simd/src/intrinsics.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fintrinsics.rs?ref=5424140b66bf839d20cbf32bf4604e23b30074c5", "patch": "@@ -52,4 +52,12 @@ extern \"platform-intrinsic\" {\n     pub(crate) fn simd_le<T, U>(x: T, y: T) -> U;\n     pub(crate) fn simd_gt<T, U>(x: T, y: T) -> U;\n     pub(crate) fn simd_ge<T, U>(x: T, y: T) -> U;\n+\n+    // shufflevector\n+    pub(crate) fn simd_shuffle2<T, U>(x: T, y: T, idx: [u32; 2]) -> U;\n+    pub(crate) fn simd_shuffle4<T, U>(x: T, y: T, idx: [u32; 4]) -> U;\n+    pub(crate) fn simd_shuffle8<T, U>(x: T, y: T, idx: [u32; 8]) -> U;\n+    pub(crate) fn simd_shuffle16<T, U>(x: T, y: T, idx: [u32; 16]) -> U;\n+    pub(crate) fn simd_shuffle32<T, U>(x: T, y: T, idx: [u32; 32]) -> U;\n+    pub(crate) fn simd_shuffle64<T, U>(x: T, y: T, idx: [u32; 64]) -> U;\n }"}, {"sha": "62489e4fbd50b280e732941ac268bb6ac48186ab", "filename": "crates/core_simd/src/lib.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Flib.rs?ref=5424140b66bf839d20cbf32bf4604e23b30074c5", "patch": "@@ -1,10 +1,19 @@\n #![no_std]\n-#![feature(repr_simd, platform_intrinsics, link_llvm_intrinsics, simd_ffi)]\n+#![allow(incomplete_features)]\n+#![feature(\n+    repr_simd,\n+    platform_intrinsics,\n+    link_llvm_intrinsics,\n+    simd_ffi,\n+    const_generics\n+)]\n #![warn(missing_docs)]\n //! Portable SIMD module.\n \n #[macro_use]\n mod macros;\n+#[macro_use]\n+mod permute;\n \n mod fmt;\n mod intrinsics;"}, {"sha": "0abafe71f50da54112a248da629696d33d659b75", "filename": "crates/core_simd/src/macros.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fmacros.rs?ref=5424140b66bf839d20cbf32bf4604e23b30074c5", "patch": "@@ -148,6 +148,8 @@ macro_rules! impl_vector {\n                 Self::splat(value)\n             }\n         }\n+\n+        impl_shuffle_2pow_lanes!{ $name }\n     }\n }\n "}, {"sha": "05a78c3764b89f166a55668063547ea6bce733cf", "filename": "crates/core_simd/src/permute.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Fpermute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Fsrc%2Fpermute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fpermute.rs?ref=5424140b66bf839d20cbf32bf4604e23b30074c5", "patch": "@@ -0,0 +1,29 @@\n+macro_rules! impl_shuffle_lane {\n+    { $name:ident, $fn:ident, $n:literal } => {\n+        impl $name<$n> {\n+            /// A const SIMD shuffle that takes 2 SIMD vectors and produces another vector, using\n+            /// the indices in the const parameter. The first or \"self\" vector will have its lanes\n+            /// indexed from 0, and the second vector will have its first lane indexed at $n.\n+            /// Indices must be in-bounds of either vector at compile time.\n+            ///\n+            /// Some SIMD shuffle instructions can be quite slow, so avoiding them by loading data\n+            /// into the desired patterns in advance is preferred, but shuffles are still faster\n+            /// than storing and reloading from memory.\n+            #[inline]\n+            pub fn shuffle<const IDX: [u32; $n]>(self, second: Self) -> Self {\n+                unsafe { crate::intrinsics::$fn(self, second, IDX) }\n+            }\n+        }\n+    }\n+}\n+\n+macro_rules! impl_shuffle_2pow_lanes {\n+    { $name:ident } => {\n+        impl_shuffle_lane!{ $name, simd_shuffle2, 2 }\n+        impl_shuffle_lane!{ $name, simd_shuffle4, 4 }\n+        impl_shuffle_lane!{ $name, simd_shuffle8, 8 }\n+        impl_shuffle_lane!{ $name, simd_shuffle16, 16 }\n+        impl_shuffle_lane!{ $name, simd_shuffle32, 32 }\n+        impl_shuffle_lane!{ $name, simd_shuffle64, 64 }\n+    }\n+}"}, {"sha": "1c6c391d8d060598301ef4b16b4c508d055093cd", "filename": "crates/core_simd/tests/permute.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Ftests%2Fpermute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5424140b66bf839d20cbf32bf4604e23b30074c5/crates%2Fcore_simd%2Ftests%2Fpermute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Ftests%2Fpermute.rs?ref=5424140b66bf839d20cbf32bf4604e23b30074c5", "patch": "@@ -0,0 +1,15 @@\n+use core_simd::SimdU32;\n+\n+#[cfg(target_arch = \"wasm32\")]\n+use wasm_bindgen_test::*;\n+\n+#[cfg(target_arch = \"wasm32\")]\n+wasm_bindgen_test_configure!(run_in_browser);\n+\n+#[test]\n+#[cfg_attr(target_arch = \"wasm32\", wasm_bindgen_test)]\n+fn simple_shuffle() {\n+    let a = SimdU32::from_array([2, 4, 1, 9]);\n+    let b = a;\n+    assert_eq!(a.shuffle::<{ [3, 1, 4, 6] }>(b).to_array(), [9, 4, 2, 1]);\n+}"}]}