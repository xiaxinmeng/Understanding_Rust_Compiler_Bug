{"sha": "a68988719cf0b1c2a367096ee3df03b92d14757c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2ODk4ODcxOWNmMGIxYzJhMzY3MDk2ZWUzZGYwM2I5MmQxNDc1N2M=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-12-02T00:22:44Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-12-06T22:34:36Z"}, "message": "cleanup", "tree": {"sha": "661b68a0bf11f636cd8f1883cf1c5377818dc6a4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/661b68a0bf11f636cd8f1883cf1c5377818dc6a4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a68988719cf0b1c2a367096ee3df03b92d14757c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a68988719cf0b1c2a367096ee3df03b92d14757c", "html_url": "https://github.com/rust-lang/rust/commit/a68988719cf0b1c2a367096ee3df03b92d14757c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a68988719cf0b1c2a367096ee3df03b92d14757c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34e31830c0da20a7ccc1a83a423437fb2ee073d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/34e31830c0da20a7ccc1a83a423437fb2ee073d3", "html_url": "https://github.com/rust-lang/rust/commit/34e31830c0da20a7ccc1a83a423437fb2ee073d3"}], "stats": {"total": 111, "additions": 46, "deletions": 65}, "files": [{"sha": "1348cd72b9d574fa8c7f4eb79be4677e1c6279ae", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 37, "deletions": 57, "changes": 94, "blob_url": "https://github.com/rust-lang/rust/blob/a68988719cf0b1c2a367096ee3df03b92d14757c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/a68988719cf0b1c2a367096ee3df03b92d14757c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=a68988719cf0b1c2a367096ee3df03b92d14757c", "patch": "@@ -82,8 +82,6 @@ if (!DOMTokenList.prototype.remove) {\n                      \"attr\",\n                      \"derive\"];\n \n-    var start = Date.now();\n-\n     var search_input = document.getElementsByClassName(\"search-input\")[0];\n \n     // On the search screen, so you remain on the last tab you opened.\n@@ -148,7 +146,7 @@ if (!DOMTokenList.prototype.remove) {\n     var TY_PRIMITIVE = itemTypes.indexOf(\"primitive\");\n     var TY_KEYWORD = itemTypes.indexOf(\"keyword\");\n \n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"js-only\")), function(e) {\n+    onEachLazy(document.getElementsByClassName(\"js-only\"), function(e) {\n         removeClass(e, \"js-only\");\n     });\n \n@@ -190,9 +188,8 @@ if (!DOMTokenList.prototype.remove) {\n                     x.scrollIntoView();\n                 }\n             }\n-            onEach(Array.prototype.slice.call(document.getElementsByClassName(\"line-numbers\")),\n-                   function(e) {\n-                onEach(Array.prototype.slice.call(e.getElementsByTagName(\"span\")), function(i_e) {\n+            onEachLazy(document.getElementsByClassName(\"line-numbers\"), function(e) {\n+                onEachLazy(e.getElementsByTagName(\"span\"), function(i_e) {\n                     removeClass(i_e, \"line-highlighted\");\n                 });\n             });\n@@ -1103,7 +1100,7 @@ if (!DOMTokenList.prototype.remove) {\n                     aliases[i].displayPath = pathSplitter(res[0]);\n                     aliases[i].fullPath = aliases[i].displayPath + aliases[i].name;\n                     aliases[i].href = res[1];\n-                    retothers.unshift(aliases[i]);\n+                    ret.others.unshift(aliases[i]);\n                     if (ret.others.length > MAX_RESULTS) {\n                         ret.others.pop();\n                     }\n@@ -1192,16 +1189,16 @@ if (!DOMTokenList.prototype.remove) {\n                 }\n                 clearTimeout(hoverTimeout);\n                 hoverTimeout = setTimeout(function() {\n-                    onEach(document.getElementsByClassName(\"search-results\"), function(e) {\n-                        onEach(e.getElementsByClassName(\"result\"), function(i_e) {\n+                    onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n+                        onEachLazy(e.getElementsByClassName(\"result\"), function(i_e) {\n                             removeClass(i_e, \"highlighted\");\n                         });\n                     });\n                     addClass(el, \"highlighted\");\n                 }, 20);\n             };\n-            onEach(document.getElementsByClassName(\"search-results\"), function(e) {\n-                onEach(e.getElementsByClassName(\"result\"), function(i_e) {\n+            onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n+                onEachLazy(e.getElementsByClassName(\"result\"), function(i_e) {\n                     i_e.onclick = click_func;\n                     i_e.onmouseover = mouseover_func;\n                 });\n@@ -1213,8 +1210,8 @@ if (!DOMTokenList.prototype.remove) {\n                 var actives = [[], [], []];\n                 // \"current\" is used to know which tab we're looking into.\n                 var current = 0;\n-                onEach(document.getElementsByClassName(\"search-results\"), function(e) {\n-                    onEach(e.getElementsByClassName(\"highlighted\"), function(e) {\n+                onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n+                    onEachLazy(e.getElementsByClassName(\"highlighted\"), function(e) {\n                         actives[current].push(e);\n                     });\n                     current += 1;\n@@ -1418,7 +1415,7 @@ if (!DOMTokenList.prototype.remove) {\n                 td_width = tds[0].offsetWidth;\n             }\n             var width = search.offsetWidth - 40 - td_width;\n-            onEach(Array.prototype.slice.call(search.getElementsByClassName(\"desc\")), function(e) {\n+            onEachLazy(search.getElementsByClassName(\"desc\"), function(e) {\n                 e.style.width = width + \"px\";\n             });\n             initSearchNav();\n@@ -1894,9 +1891,7 @@ if (!DOMTokenList.prototype.remove) {\n             });\n             innerToggle.title = \"collapse all docs\";\n             if (fromAutoCollapse !== true) {\n-                onEach(Array.prototype.slice.call(\n-                           document.getElementsByClassName(\"collapse-toggle\")),\n-                       function(e) {\n+                onEachLazy(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n                     collapseDocs(e, \"show\");\n                 });\n             }\n@@ -1908,9 +1903,7 @@ if (!DOMTokenList.prototype.remove) {\n             });\n             innerToggle.title = \"expand all docs\";\n             if (fromAutoCollapse !== true) {\n-                onEach(Array.prototype.slice.call(\n-                           document.getElementsByClassName(\"collapse-toggle\")),\n-                       function(e) {\n+                onEachLazy(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n                     collapseDocs(e, \"hide\", pageId);\n                 });\n             }\n@@ -1984,12 +1977,12 @@ if (!DOMTokenList.prototype.remove) {\n                 }\n                 if (action === \"hide\") {\n                     addClass(relatedDoc, \"hidden-by-usual-hider\");\n-                    onEach(Array.prototype.slice.call(toggle.childNodes), adjustToggle(true));\n+                    onEachLazy(toggle.childNodes, adjustToggle(true));\n                     addClass(toggle.parentNode, \"collapsed\");\n                 } else if (action === \"show\") {\n                     removeClass(relatedDoc, \"hidden-by-usual-hider\");\n                     removeClass(toggle.parentNode, \"collapsed\");\n-                    onEach(Array.prototype.slice.call(toggle.childNodes), adjustToggle(false));\n+                    onEachLazy(toggle.childNodes, adjustToggle(false));\n                 }\n             }\n         } else {\n@@ -2022,13 +2015,13 @@ if (!DOMTokenList.prototype.remove) {\n             if (action === \"show\") {\n                 removeClass(relatedDoc, \"fns-now-collapsed\");\n                 removeClass(docblock, \"hidden-by-usual-hider\");\n-                onEach(Array.prototype.slice.call(toggle.childNodes), adjustToggle(false));\n-                onEach(Array.prototype.slice.call(relatedDoc.childNodes), implHider(false));\n+                onEachLazy(toggle.childNodes, adjustToggle(false));\n+                onEachLazy(relatedDoc.childNodes, implHider(false));\n             } else if (action === \"hide\") {\n                 addClass(relatedDoc, \"fns-now-collapsed\");\n                 addClass(docblock, \"hidden-by-usual-hider\");\n-                onEach(Array.prototype.slice.call(toggle.childNodes), adjustToggle(true));\n-                onEach(Array.prototype.slice.call(relatedDoc.childNodes), implHider(true));\n+                onEachLazy(toggle.childNodes, adjustToggle(true));\n+                onEachLazy(relatedDoc.childNodes, implHider(true));\n             }\n         }\n     }\n@@ -2052,9 +2045,7 @@ if (!DOMTokenList.prototype.remove) {\n             var impl_list = document.getElementById(\"implementations-list\");\n \n             if (impl_list !== null) {\n-                onEach(Array.prototype.slice.call(\n-                           impl_list.getElementsByClassName(\"collapse-toggle\")),\n-                       collapser);\n+                onEachLazy(impl_list.getElementsByClassName(\"collapse-toggle\"), collapser);\n             }\n         }\n     }\n@@ -2104,9 +2095,9 @@ if (!DOMTokenList.prototype.remove) {\n         }\n     };\n \n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"method\")), func);\n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"associatedconstant\")), func);\n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"impl\")), funcImpl);\n+    onEachLazy(document.getElementsByClassName(\"method\"), func);\n+    onEachLazy(document.getElementsByClassName(\"associatedconstant\"), func);\n+    onEachLazy(document.getElementsByClassName(\"impl\"), funcImpl);\n     var impl_call = function() {};\n     if (getCurrentValue(\"rustdoc-method-docs\") !== \"false\") {\n         impl_call = function(e, newToggle, pageId) {\n@@ -2127,8 +2118,7 @@ if (!DOMTokenList.prototype.remove) {\n     function toggleClicked() {\n         if (hasClass(this, \"collapsed\")) {\n             removeClass(this, \"collapsed\");\n-            onEach(Array.prototype.slice.call(this.parentNode.getElementsByClassName(\"hidden\")),\n-                   function(x) {\n+            onEachLazy(this.parentNode.getElementsByClassName(\"hidden\"), function(x) {\n                 if (hasClass(x, \"content\") === false) {\n                     removeClass(x, \"hidden\");\n                     addClass(x, \"x\");\n@@ -2138,8 +2128,7 @@ if (!DOMTokenList.prototype.remove) {\n                              \"</span>] Hide undocumented items\";\n         } else {\n             addClass(this, \"collapsed\");\n-            onEach(Array.prototype.slice.call(this.parentNode.getElementsByClassName(\"x\")),\n-                   function(x) {\n+            onEachLazy(this.parentNode.getElementsByClassName(\"x\"), function(x) {\n                 if (hasClass(x, \"content\") === false) {\n                     addClass(x, \"hidden\");\n                     removeClass(x, \"x\");\n@@ -2149,8 +2138,8 @@ if (!DOMTokenList.prototype.remove) {\n                              \"</span>] Show hidden undocumented items\";\n         }\n     }\n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"impl-items\")), function(e) {\n-        onEach(Array.prototype.slice.call(e.getElementsByClassName(\"associatedconstant\")), func);\n+    onEachLazy(document.getElementsByClassName(\"impl-items\"), function(e) {\n+        onEachLazy(e.getElementsByClassName(\"associatedconstant\"), func);\n         var hiddenElems = e.getElementsByClassName(\"hidden\");\n         var needToggle = false;\n \n@@ -2215,13 +2204,10 @@ if (!DOMTokenList.prototype.remove) {\n \n                 e.style.display = \"none\";\n                 addClass(wrap, \"collapsed\");\n-                onEach(Array.prototype.slice.call(inner_toggle.getElementsByClassName(\"inner\")),\n-                       function(e) {\n+                onEachLazy(inner_toggle.getElementsByClassName(\"inner\"), function(e) {\n                     e.innerHTML = labelForToggleButton(true);\n                 });\n-                onEach(Array.prototype.slice.call(\n-                           inner_toggle.getElementsByClassName(\"toggle-label\")),\n-                       function(e) {\n+                onEachLazy(inner_toggle.getElementsByClassName(\"toggle-label\"), function(e) {\n                     e.style.display = \"inline-block\";\n                     if (extra === true) {\n                         i_e.innerHTML = \" Show \" + e.childNodes[0].innerHTML;\n@@ -2268,28 +2254,24 @@ if (!DOMTokenList.prototype.remove) {\n         }\n     }\n \n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"docblock\")),\n-           buildToggleWrapper);\n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"sub-variant\")),\n-           buildToggleWrapper);\n+    onEachLazy(document.getElementsByClassName(\"docblock\"), buildToggleWrapper);\n+    onEachLazy(document.getElementsByClassName(\"sub-variant\"), buildToggleWrapper);\n \n     // In the search display, allows to switch between tabs.\n     function printTab(nb) {\n         if (nb === 0 || nb === 1 || nb === 2) {\n             currentTab = nb;\n         }\n         var nb_copy = nb;\n-        onEach(Array.prototype.slice.call(document.getElementById(\"titles\").childNodes),\n-               function(elem) {\n+        onEachLazy(document.getElementById(\"titles\").childNodes, function(elem) {\n             if (nb_copy === 0) {\n                 addClass(elem, \"selected\");\n             } else {\n                 removeClass(elem, \"selected\");\n             }\n             nb_copy -= 1;\n         });\n-        onEach(Array.prototype.slice.call(document.getElementById(\"results\").childNodes),\n-               function(elem) {\n+        onEachLazy(document.getElementById(\"results\").childNodes, function(elem) {\n             if (nb === 0) {\n                 elem.style.display = \"\";\n             } else {\n@@ -2320,7 +2302,7 @@ if (!DOMTokenList.prototype.remove) {\n         };\n     }\n     var attributesToggle = createToggleWrapper(createSimpleToggle(false));\n-    onEach(Array.prototype.slice.call(main.getElementsByClassName(\"attributes\")), function(i_e) {\n+    onEachLazy(main.getElementsByClassName(\"attributes\"), function(i_e) {\n         i_e.parentNode.insertBefore(attributesToggle.cloneNode(true), i_e);\n         itemAttributesFunc(i_e);\n     });\n@@ -2340,8 +2322,7 @@ if (!DOMTokenList.prototype.remove) {\n             x.parentNode.insertBefore(node, x);\n         };\n     }\n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"rust-example-rendered\")),\n-           function(e) {\n+    onEachLazy(document.getElementsByClassName(\"rust-example-rendered\"), function(e) {\n         if (hasClass(e, \"compile_fail\")) {\n             e.addEventListener(\"mouseover\", function(event) {\n                 this.parentElement.previousElementSibling.childNodes[0].style.color = \"#f00\";\n@@ -2379,8 +2360,7 @@ if (!DOMTokenList.prototype.remove) {\n         }\n     }\n \n-    onEach(Array.prototype.slice.call(document.getElementsByClassName(\"important-traits\")),\n-           function(e) {\n+    onEachLazy(document.getElementsByClassName(\"important-traits\"), function(e) {\n         e.onclick = function() {\n             showModal(e.lastElementChild.innerHTML);\n         };\n@@ -2435,7 +2415,7 @@ if (!DOMTokenList.prototype.remove) {\n     }\n \n     if (main) {\n-        onEach(Array.prototype.slice.call(main.childNodes), function(e) {\n+        onEachLazy(main.childNodes, function(e) {\n             if (e.tagName === \"H2\" || e.tagName === \"H3\") {\n                 e.nextElementSibling.style.display = \"block\";\n             }"}, {"sha": "d1c377bf95ac87e29c6cd117849992d7c7029cdb", "filename": "src/librustdoc/html/static/storage.js", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a68988719cf0b1c2a367096ee3df03b92d14757c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "raw_url": "https://github.com/rust-lang/rust/raw/a68988719cf0b1c2a367096ee3df03b92d14757c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js?ref=a68988719cf0b1c2a367096ee3df03b92d14757c", "patch": "@@ -19,10 +19,7 @@ var mainTheme = document.getElementById(\"mainThemeStyle\");\n var savedHref = [];\n \n function hasClass(elem, className) {\n-    if (!elem || !elem.classList) {\n-        return false;\n-    }\n-    return elem.classList.contains(className);\n+    return elem && elem.classList && elem.classList.contains(className);\n }\n \n function addClass(elem, className) {\n@@ -40,12 +37,9 @@ function removeClass(elem, className) {\n }\n \n function isHidden(elem) {\n-    return (elem.offsetParent === null);\n+    return elem.offsetParent === null;\n }\n \n-var allcallers = {};\n-var resourcesSuffix=\"\";\n-\n function onEach(arr, func, reversed) {\n     if (arr && arr.length > 0 && func) {\n         var length = arr.length;\n@@ -66,6 +60,13 @@ function onEach(arr, func, reversed) {\n     return false;\n }\n \n+function onEachLazy(lazyArray, func, reversed) {\n+    return onEach(\n+        Array.prototype.slice.call(lazyArray),\n+        func,\n+        reversed);\n+}\n+\n function usableLocalStorage() {\n     // Check if the browser supports localStorage at all:\n     if (typeof(Storage) === \"undefined\") {"}]}