{"sha": "550b17d7cf321c2aebff75d00b1654b55beca53c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1MGIxN2Q3Y2YzMjFjMmFlYmZmNzVkMDBiMTY1NGI1NWJlY2E1M2M=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-02-04T14:07:09Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-02-04T14:07:09Z"}, "message": "Merge #43\n\n43: Ctx r=matklad a=matklad", "tree": {"sha": "a7759795877d2d5fef25915997c2679af0cd3e94", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7759795877d2d5fef25915997c2679af0cd3e94"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/550b17d7cf321c2aebff75d00b1654b55beca53c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/550b17d7cf321c2aebff75d00b1654b55beca53c", "html_url": "https://github.com/rust-lang/rust/commit/550b17d7cf321c2aebff75d00b1654b55beca53c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/550b17d7cf321c2aebff75d00b1654b55beca53c/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "b86e87c8885895e5b3fcec021ee65003d64c4cbe", "url": "https://api.github.com/repos/rust-lang/rust/commits/b86e87c8885895e5b3fcec021ee65003d64c4cbe", "html_url": "https://github.com/rust-lang/rust/commit/b86e87c8885895e5b3fcec021ee65003d64c4cbe"}, {"sha": "351107d0b143e2c3497bd0f424f0d76bc51df0c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/351107d0b143e2c3497bd0f424f0d76bc51df0c0", "html_url": "https://github.com/rust-lang/rust/commit/351107d0b143e2c3497bd0f424f0d76bc51df0c0"}], "stats": {"total": 344, "additions": 261, "deletions": 83}, "files": [{"sha": "e97ef0c2ca5284b4b9405f9bad52487db5270082", "filename": "grammar.ron", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/grammar.ron", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/grammar.ron", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/grammar.ron?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -27,6 +27,11 @@ Grammar(\n         \"mut\",\n         \"unsafe\",\n     ],\n+    contextual_keywords: [\n+        \"auto\",\n+        \"default\",\n+        \"union\",\n+    ],\n     tokens: [\n         \"ERROR\",\n         \"IDENT\","}, {"sha": "e97350c89afaea401a472231f368904483ba3dee", "filename": "src/parser/event.rs", "status": "modified", "additions": 18, "deletions": 11, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Fevent.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Fevent.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparser%2Fevent.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -1,4 +1,4 @@\n-use {File, FileBuilder, Sink, SyntaxKind, Token};\n+use {File, FileBuilder, Sink, SyntaxKind, TextUnit, Token};\n use syntax_kinds::TOMBSTONE;\n use super::is_insignificant;\n \n@@ -120,19 +120,26 @@ pub(super) fn to_file(text: String, tokens: &[Token], events: Vec<Event>) -> Fil\n                 builder.finish_internal()\n             }\n             &Event::Token {\n-                kind: _,\n+                kind,\n                 mut n_raw_tokens,\n-            } => loop {\n-                let token = tokens[idx];\n-                if !is_insignificant(token.kind) {\n-                    n_raw_tokens -= 1;\n+            } => {\n+                // FIXME: currently, we attach whitespace to some random node\n+                // this should be done in a sensible manner instead\n+                loop {\n+                    let token = tokens[idx];\n+                    if !is_insignificant(token.kind) {\n+                        break;\n+                    }\n+                    builder.leaf(token.kind, token.len);\n+                    idx += 1\n                 }\n-                idx += 1;\n-                builder.leaf(token.kind, token.len);\n-                if n_raw_tokens == 0 {\n-                    break;\n+                let mut len = TextUnit::new(0);\n+                for _ in 0..n_raw_tokens {\n+                    len += tokens[idx].len;\n+                    idx += 1;\n                 }\n-            },\n+                builder.leaf(kind, len);\n+            }\n             &Event::Error { ref message } => builder.error().message(message.clone()).emit(),\n         }\n     }"}, {"sha": "37f2ab132e3a09752a0be9c4cc6d86fb59535bdc", "filename": "src/parser/grammar/items/mod.rs", "status": "modified", "additions": 68, "deletions": 14, "changes": 82, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Fgrammar%2Fitems%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Fgrammar%2Fitems%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparser%2Fgrammar%2Fitems%2Fmod.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -81,22 +81,76 @@ fn item(p: &mut Parser) {\n                 CONST_ITEM\n             }\n         },\n-        // TODO: auto trait\n-        // test unsafe_trait\n-        // unsafe trait T {}\n-        UNSAFE_KW if la == TRAIT_KW => {\n+        UNSAFE_KW => {\n             p.bump();\n-            traits::trait_item(p);\n-            TRAIT_ITEM\n-        }\n-        // TODO: default impl\n-        // test unsafe_impl\n-        // unsafe impl Foo {}\n-        UNSAFE_KW if la == IMPL_KW => {\n-            p.bump();\n-            traits::impl_item(p);\n-            IMPL_ITEM\n+            let la = p.nth(1);\n+            match p.current() {\n+                // test unsafe_trait\n+                // unsafe trait T {}\n+                TRAIT_KW => {\n+                    traits::trait_item(p);\n+                    TRAIT_ITEM\n+                }\n+\n+                // test unsafe_auto_trait\n+                // unsafe auto trait T {}\n+                IDENT if p.at_kw(\"auto\") && la == TRAIT_KW => {\n+                    p.bump_remap(AUTO_KW);\n+                    traits::trait_item(p);\n+                    TRAIT_ITEM\n+                }\n+\n+                // test unsafe_impl\n+                // unsafe impl Foo {}\n+                IMPL_KW => {\n+                    traits::impl_item(p);\n+                    IMPL_ITEM\n+                }\n+\n+                // test unsafe_default_impl\n+                // unsafe default impl Foo {}\n+                IDENT if p.at_kw(\"default\") && la == IMPL_KW => {\n+                    p.bump_remap(DEFAULT_KW);\n+                    traits::impl_item(p);\n+                    IMPL_ITEM\n+                }\n+\n+                // test unsafe_extern_fn\n+                // unsafe extern \"C\" fn foo() {}\n+                EXTERN_KW => {\n+                    abi(p);\n+                    if !p.at(FN_KW) {\n+                        item.abandon(p);\n+                        p.error().message(\"expected function\").emit();\n+                        return;\n+                    }\n+                    fn_item(p);\n+                    FN_ITEM\n+                }\n+\n+                // test unsafe_fn\n+                // unsafe fn foo() {}\n+                FN_KW => {\n+                    fn_item(p);\n+                    FN_ITEM\n+                }\n+\n+                t => {\n+                    item.abandon(p);\n+                    let message = \"expected `trait`, `impl` or `fn`\";\n+\n+                    // test unsafe_block_in_mod\n+                    // fn foo(){} unsafe { } fn bar(){}\n+                    if t == L_CURLY {\n+                        error_block(p, message);\n+                    } else {\n+                        p.error().message(message).emit();\n+                    }\n+                    return;\n+                }\n+            }\n         }\n+\n         MOD_KW => {\n             mod_item(p);\n             MOD_ITEM"}, {"sha": "4d74ac1b1cd3e146c4f345aed87bee83e141061a", "filename": "src/parser/input.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Finput.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Finput.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparser%2Finput.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -46,9 +46,7 @@ impl<'t> ParserInput<'t> {\n         if !(idx < self.tokens.len()) {\n             return \"\";\n         }\n-        let start_offset = self.start_offsets[idx];\n-        let end_offset = self.tokens[idx].len;\n-        let range = TextRange::from_to(start_offset, end_offset);\n+        let range = TextRange::from_len(self.start_offsets[idx], self.tokens[idx].len);\n         &self.text[range]\n     }\n }"}, {"sha": "752d532d09ec11c014fc418c40535deb8321cfe7", "filename": "src/parser/parser.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fparser%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparser%2Fparser.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -145,10 +145,26 @@ impl<'t> Parser<'t> {\n         });\n     }\n \n+    pub(crate) fn bump_remap(&mut self, kind: SyntaxKind) {\n+        if self.current() == EOF {\n+            // TODO: panic!?\n+            return;\n+        }\n+        self.pos += 1;\n+        self.event(Event::Token {\n+            kind,\n+            n_raw_tokens: 1,\n+        });\n+    }\n+\n     pub(crate) fn nth(&self, n: u32) -> SyntaxKind {\n         self.inp.kind(self.pos + n)\n     }\n \n+    pub(crate) fn at_kw(&self, t: &str) -> bool {\n+        self.inp.text(self.pos) == t\n+    }\n+\n     pub(crate) fn current(&self) -> SyntaxKind {\n         self.nth(0)\n     }"}, {"sha": "27bc1cafa530c5067872f554bc0f0c367adb28a5", "filename": "src/syntax_kinds.rs", "status": "modified", "additions": 58, "deletions": 52, "changes": 110, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fsyntax_kinds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/src%2Fsyntax_kinds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fsyntax_kinds.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -6,32 +6,6 @@ use tree::SyntaxInfo;\n /// The kind of syntax node, e.g. `IDENT`, `USE_KW`, or `STRUCT_DEF`.\n #[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]\n pub enum SyntaxKind {\n-    USE_KW,\n-    FN_KW,\n-    STRUCT_KW,\n-    ENUM_KW,\n-    TRAIT_KW,\n-    IMPL_KW,\n-    TRUE_KW,\n-    FALSE_KW,\n-    AS_KW,\n-    EXTERN_KW,\n-    CRATE_KW,\n-    MOD_KW,\n-    PUB_KW,\n-    SELF_KW,\n-    SUPER_KW,\n-    IN_KW,\n-    WHERE_KW,\n-    FOR_KW,\n-    LOOP_KW,\n-    WHILE_KW,\n-    IF_KW,\n-    MATCH_KW,\n-    CONST_KW,\n-    STATIC_KW,\n-    MUT_KW,\n-    UNSAFE_KW,\n     ERROR,\n     IDENT,\n     UNDERSCORE,\n@@ -83,6 +57,35 @@ pub enum SyntaxKind {\n     COMMENT,\n     DOC_COMMENT,\n     SHEBANG,\n+    USE_KW,\n+    FN_KW,\n+    STRUCT_KW,\n+    ENUM_KW,\n+    TRAIT_KW,\n+    IMPL_KW,\n+    TRUE_KW,\n+    FALSE_KW,\n+    AS_KW,\n+    EXTERN_KW,\n+    CRATE_KW,\n+    MOD_KW,\n+    PUB_KW,\n+    SELF_KW,\n+    SUPER_KW,\n+    IN_KW,\n+    WHERE_KW,\n+    FOR_KW,\n+    LOOP_KW,\n+    WHILE_KW,\n+    IF_KW,\n+    MATCH_KW,\n+    CONST_KW,\n+    STATIC_KW,\n+    MUT_KW,\n+    UNSAFE_KW,\n+    AUTO_KW,\n+    DEFAULT_KW,\n+    UNION_KW,\n     FILE,\n     STRUCT_ITEM,\n     ENUM_ITEM,\n@@ -123,32 +126,6 @@ pub(crate) use self::SyntaxKind::*;\n impl SyntaxKind {\n     pub(crate) fn info(self) -> &'static SyntaxInfo {\n         match self {\n-            USE_KW => &SyntaxInfo { name: \"USE_KW\" },\n-            FN_KW => &SyntaxInfo { name: \"FN_KW\" },\n-            STRUCT_KW => &SyntaxInfo { name: \"STRUCT_KW\" },\n-            ENUM_KW => &SyntaxInfo { name: \"ENUM_KW\" },\n-            TRAIT_KW => &SyntaxInfo { name: \"TRAIT_KW\" },\n-            IMPL_KW => &SyntaxInfo { name: \"IMPL_KW\" },\n-            TRUE_KW => &SyntaxInfo { name: \"TRUE_KW\" },\n-            FALSE_KW => &SyntaxInfo { name: \"FALSE_KW\" },\n-            AS_KW => &SyntaxInfo { name: \"AS_KW\" },\n-            EXTERN_KW => &SyntaxInfo { name: \"EXTERN_KW\" },\n-            CRATE_KW => &SyntaxInfo { name: \"CRATE_KW\" },\n-            MOD_KW => &SyntaxInfo { name: \"MOD_KW\" },\n-            PUB_KW => &SyntaxInfo { name: \"PUB_KW\" },\n-            SELF_KW => &SyntaxInfo { name: \"SELF_KW\" },\n-            SUPER_KW => &SyntaxInfo { name: \"SUPER_KW\" },\n-            IN_KW => &SyntaxInfo { name: \"IN_KW\" },\n-            WHERE_KW => &SyntaxInfo { name: \"WHERE_KW\" },\n-            FOR_KW => &SyntaxInfo { name: \"FOR_KW\" },\n-            LOOP_KW => &SyntaxInfo { name: \"LOOP_KW\" },\n-            WHILE_KW => &SyntaxInfo { name: \"WHILE_KW\" },\n-            IF_KW => &SyntaxInfo { name: \"IF_KW\" },\n-            MATCH_KW => &SyntaxInfo { name: \"MATCH_KW\" },\n-            CONST_KW => &SyntaxInfo { name: \"CONST_KW\" },\n-            STATIC_KW => &SyntaxInfo { name: \"STATIC_KW\" },\n-            MUT_KW => &SyntaxInfo { name: \"MUT_KW\" },\n-            UNSAFE_KW => &SyntaxInfo { name: \"UNSAFE_KW\" },\n             ERROR => &SyntaxInfo { name: \"ERROR\" },\n             IDENT => &SyntaxInfo { name: \"IDENT\" },\n             UNDERSCORE => &SyntaxInfo { name: \"UNDERSCORE\" },\n@@ -200,6 +177,35 @@ impl SyntaxKind {\n             COMMENT => &SyntaxInfo { name: \"COMMENT\" },\n             DOC_COMMENT => &SyntaxInfo { name: \"DOC_COMMENT\" },\n             SHEBANG => &SyntaxInfo { name: \"SHEBANG\" },\n+            USE_KW => &SyntaxInfo { name: \"USE_KW\" },\n+            FN_KW => &SyntaxInfo { name: \"FN_KW\" },\n+            STRUCT_KW => &SyntaxInfo { name: \"STRUCT_KW\" },\n+            ENUM_KW => &SyntaxInfo { name: \"ENUM_KW\" },\n+            TRAIT_KW => &SyntaxInfo { name: \"TRAIT_KW\" },\n+            IMPL_KW => &SyntaxInfo { name: \"IMPL_KW\" },\n+            TRUE_KW => &SyntaxInfo { name: \"TRUE_KW\" },\n+            FALSE_KW => &SyntaxInfo { name: \"FALSE_KW\" },\n+            AS_KW => &SyntaxInfo { name: \"AS_KW\" },\n+            EXTERN_KW => &SyntaxInfo { name: \"EXTERN_KW\" },\n+            CRATE_KW => &SyntaxInfo { name: \"CRATE_KW\" },\n+            MOD_KW => &SyntaxInfo { name: \"MOD_KW\" },\n+            PUB_KW => &SyntaxInfo { name: \"PUB_KW\" },\n+            SELF_KW => &SyntaxInfo { name: \"SELF_KW\" },\n+            SUPER_KW => &SyntaxInfo { name: \"SUPER_KW\" },\n+            IN_KW => &SyntaxInfo { name: \"IN_KW\" },\n+            WHERE_KW => &SyntaxInfo { name: \"WHERE_KW\" },\n+            FOR_KW => &SyntaxInfo { name: \"FOR_KW\" },\n+            LOOP_KW => &SyntaxInfo { name: \"LOOP_KW\" },\n+            WHILE_KW => &SyntaxInfo { name: \"WHILE_KW\" },\n+            IF_KW => &SyntaxInfo { name: \"IF_KW\" },\n+            MATCH_KW => &SyntaxInfo { name: \"MATCH_KW\" },\n+            CONST_KW => &SyntaxInfo { name: \"CONST_KW\" },\n+            STATIC_KW => &SyntaxInfo { name: \"STATIC_KW\" },\n+            MUT_KW => &SyntaxInfo { name: \"MUT_KW\" },\n+            UNSAFE_KW => &SyntaxInfo { name: \"UNSAFE_KW\" },\n+            AUTO_KW => &SyntaxInfo { name: \"AUTO_KW\" },\n+            DEFAULT_KW => &SyntaxInfo { name: \"DEFAULT_KW\" },\n+            UNION_KW => &SyntaxInfo { name: \"UNION_KW\" },\n             FILE => &SyntaxInfo { name: \"FILE\" },\n             STRUCT_ITEM => &SyntaxInfo { name: \"STRUCT_ITEM\" },\n             ENUM_ITEM => &SyntaxInfo { name: \"ENUM_ITEM\" },"}, {"sha": "03d29f3241db2ba7b0f34d5ca7c8ded348f0d92d", "filename": "tests/data/parser/inline/0009_unsafe_auto_trait.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0009_unsafe_auto_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0009_unsafe_auto_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0009_unsafe_auto_trait.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1 @@\n+unsafe auto trait T {}"}, {"sha": "0a9a1e11747c6c0a8241c22b69a38b2963e8ab94", "filename": "tests/data/parser/inline/0009_unsafe_auto_trait.txt", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0009_unsafe_auto_trait.txt", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0009_unsafe_auto_trait.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0009_unsafe_auto_trait.txt?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1,13 @@\n+FILE@[0; 23)\n+  TRAIT_ITEM@[0; 23)\n+    UNSAFE_KW@[0; 6)\n+    WHITESPACE@[6; 7)\n+    AUTO_KW@[7; 11)\n+    WHITESPACE@[11; 12)\n+    TRAIT_KW@[12; 17)\n+    WHITESPACE@[17; 18)\n+    IDENT@[18; 19) \"T\"\n+    WHITESPACE@[19; 20)\n+    L_CURLY@[20; 21)\n+    R_CURLY@[21; 22)\n+    WHITESPACE@[22; 23)"}, {"sha": "9cd6c57bd89975906e2ee92d871694049450f2b3", "filename": "tests/data/parser/inline/0010_unsafe_default_impl.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0010_unsafe_default_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0010_unsafe_default_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0010_unsafe_default_impl.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1 @@\n+unsafe default impl Foo {}"}, {"sha": "7450381cbc93e28bf88e3b2fe454ce3a294a9133", "filename": "tests/data/parser/inline/0010_unsafe_default_impl.txt", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0010_unsafe_default_impl.txt", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0010_unsafe_default_impl.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0010_unsafe_default_impl.txt?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1,13 @@\n+FILE@[0; 27)\n+  IMPL_ITEM@[0; 27)\n+    UNSAFE_KW@[0; 6)\n+    WHITESPACE@[6; 7)\n+    DEFAULT_KW@[7; 14)\n+    WHITESPACE@[14; 15)\n+    IMPL_KW@[15; 19)\n+    WHITESPACE@[19; 20)\n+    IDENT@[20; 23) \"Foo\"\n+    WHITESPACE@[23; 24)\n+    L_CURLY@[24; 25)\n+    R_CURLY@[25; 26)\n+    WHITESPACE@[26; 27)"}, {"sha": "33cfc4cd7a6c1f2610768fc7b9e95e0239de9bd8", "filename": "tests/data/parser/inline/0011_unsafe_fn.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0011_unsafe_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0011_unsafe_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0011_unsafe_fn.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1 @@\n+unsafe fn foo() {}"}, {"sha": "23eca1d655f95f36eee007231bd5aa47b3accf0f", "filename": "tests/data/parser/inline/0011_unsafe_fn.txt", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0011_unsafe_fn.txt", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0011_unsafe_fn.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0011_unsafe_fn.txt?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1,13 @@\n+FILE@[0; 19)\n+  FN_ITEM@[0; 19)\n+    UNSAFE_KW@[0; 6)\n+    WHITESPACE@[6; 7)\n+    FN_KW@[7; 9)\n+    WHITESPACE@[9; 10)\n+    IDENT@[10; 13) \"foo\"\n+    L_PAREN@[13; 14)\n+    R_PAREN@[14; 15)\n+    WHITESPACE@[15; 16)\n+    L_CURLY@[16; 17)\n+    R_CURLY@[17; 18)\n+    WHITESPACE@[18; 19)"}, {"sha": "1295c2cd22bf5ee8ade672bd4c9df78814a18bcf", "filename": "tests/data/parser/inline/0012_unsafe_extern_fn.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0012_unsafe_extern_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0012_unsafe_extern_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0012_unsafe_extern_fn.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1 @@\n+unsafe extern \"C\" fn foo() {}"}, {"sha": "547cb499d7c3508ee1a3245557b8563b526d2f1a", "filename": "tests/data/parser/inline/0012_unsafe_extern_fn.txt", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0012_unsafe_extern_fn.txt", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0012_unsafe_extern_fn.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0012_unsafe_extern_fn.txt?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1,18 @@\n+FILE@[0; 30)\n+  FN_ITEM@[0; 30)\n+    UNSAFE_KW@[0; 6)\n+    ABI@[6; 18)\n+      WHITESPACE@[6; 7)\n+      EXTERN_KW@[7; 13)\n+      WHITESPACE@[13; 14)\n+      STRING@[14; 17)\n+      WHITESPACE@[17; 18)\n+    FN_KW@[18; 20)\n+    WHITESPACE@[20; 21)\n+    IDENT@[21; 24) \"foo\"\n+    L_PAREN@[24; 25)\n+    R_PAREN@[25; 26)\n+    WHITESPACE@[26; 27)\n+    L_CURLY@[27; 28)\n+    R_CURLY@[28; 29)\n+    WHITESPACE@[29; 30)"}, {"sha": "26141e9049106e64f4615c69344a35332b3e11cb", "filename": "tests/data/parser/inline/0013_unsafe_block_in_mod.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0013_unsafe_block_in_mod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0013_unsafe_block_in_mod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0013_unsafe_block_in_mod.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1 @@\n+fn foo(){} unsafe { } fn bar(){}"}, {"sha": "2e319be735f15de2ee83fef201918883a284b9d4", "filename": "tests/data/parser/inline/0013_unsafe_block_in_mod.txt", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0013_unsafe_block_in_mod.txt", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tests%2Fdata%2Fparser%2Finline%2F0013_unsafe_block_in_mod.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Finline%2F0013_unsafe_block_in_mod.txt?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -0,0 +1,27 @@\n+FILE@[0; 33)\n+  FN_ITEM@[0; 11)\n+    FN_KW@[0; 2)\n+    WHITESPACE@[2; 3)\n+    IDENT@[3; 6) \"foo\"\n+    L_PAREN@[6; 7)\n+    R_PAREN@[7; 8)\n+    L_CURLY@[8; 9)\n+    R_CURLY@[9; 10)\n+    WHITESPACE@[10; 11)\n+  UNSAFE_KW@[11; 17)\n+  ERROR@[17; 22)\n+  err: `expected `trait`, `impl` or `fn``\n+    WHITESPACE@[17; 18)\n+    L_CURLY@[18; 19)\n+    WHITESPACE@[19; 20)\n+    R_CURLY@[20; 21)\n+    WHITESPACE@[21; 22)\n+  FN_ITEM@[22; 33)\n+    FN_KW@[22; 24)\n+    WHITESPACE@[24; 25)\n+    IDENT@[25; 28) \"bar\"\n+    L_PAREN@[28; 29)\n+    R_PAREN@[29; 30)\n+    L_CURLY@[30; 31)\n+    R_CURLY@[31; 32)\n+    WHITESPACE@[32; 33)"}, {"sha": "7cb164316b5864f994152b64aa5e20b650ad8ecf", "filename": "tools/src/bin/gen.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/550b17d7cf321c2aebff75d00b1654b55beca53c/tools%2Fsrc%2Fbin%2Fgen.rs", "raw_url": "https://github.com/rust-lang/rust/raw/550b17d7cf321c2aebff75d00b1654b55beca53c/tools%2Fsrc%2Fbin%2Fgen.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tools%2Fsrc%2Fbin%2Fgen.rs?ref=550b17d7cf321c2aebff75d00b1654b55beca53c", "patch": "@@ -20,6 +20,7 @@ fn main() {\n #[derive(Deserialize)]\n struct Grammar {\n     keywords: Vec<String>,\n+    contextual_keywords: Vec<String>,\n     tokens: Vec<String>,\n     nodes: Vec<String>,\n }\n@@ -38,10 +39,11 @@ impl Grammar {\n         acc.push_str(\"use tree::SyntaxInfo;\\n\");\n         acc.push_str(\"\\n\");\n \n-        let syntax_kinds: Vec<String> = self.keywords\n+        let syntax_kinds: Vec<String> = self.tokens\n             .iter()\n-            .map(|kw| kw_token(kw))\n-            .chain(self.tokens.iter().cloned())\n+            .cloned()\n+            .chain(self.keywords.iter().map(|kw| kw_token(kw)))\n+            .chain(self.contextual_keywords.iter().map(|kw| kw_token(kw)))\n             .chain(self.nodes.iter().cloned())\n             .collect();\n \n@@ -86,6 +88,7 @@ impl Grammar {\n         // fn ident_to_keyword\n         acc.push_str(\"pub(crate) fn ident_to_keyword(ident: &str) -> Option<SyntaxKind> {\\n\");\n         acc.push_str(\"    match ident {\\n\");\n+        // NB: no contextual_keywords here!\n         for kw in self.keywords.iter() {\n             write!(acc, \"        {:?} => Some({}),\\n\", kw, kw_token(kw)).unwrap();\n         }"}]}