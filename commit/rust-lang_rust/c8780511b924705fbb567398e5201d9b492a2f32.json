{"sha": "c8780511b924705fbb567398e5201d9b492a2f32", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4NzgwNTExYjkyNDcwNWZiYjU2NzM5OGU1MjAxZDliNDkyYTJmMzI=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2013-07-26T19:31:53Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2013-07-26T19:31:53Z"}, "message": "rustpkg: Don't assume a non-numeric refspec is a tag\n\nJust pass it directly to git, without prefixing it with tags/", "tree": {"sha": "83fe418ff163311117d8de1ebaf727f81bee3b8a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83fe418ff163311117d8de1ebaf727f81bee3b8a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c8780511b924705fbb567398e5201d9b492a2f32", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c8780511b924705fbb567398e5201d9b492a2f32", "html_url": "https://github.com/rust-lang/rust/commit/c8780511b924705fbb567398e5201d9b492a2f32", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c8780511b924705fbb567398e5201d9b492a2f32/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfac584a03f1e52808dc94aaa95703dd8847ab94", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfac584a03f1e52808dc94aaa95703dd8847ab94", "html_url": "https://github.com/rust-lang/rust/commit/bfac584a03f1e52808dc94aaa95703dd8847ab94"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "e3b796a03bb256baeeb567569c87ad72a7df157b", "filename": "src/librustpkg/source_control.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c8780511b924705fbb567398e5201d9b492a2f32/src%2Flibrustpkg%2Fsource_control.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8780511b924705fbb567398e5201d9b492a2f32/src%2Flibrustpkg%2Fsource_control.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fsource_control.rs?ref=c8780511b924705fbb567398e5201d9b492a2f32", "patch": "@@ -10,7 +10,8 @@\n \n // Utils for working with version control repositories. Just git right now.\n \n-use std::{io, os, run, str};\n+use std::{os, run, str};\n+use std::run::{ProcessOutput, ProcessOptions, Process};\n use version::*;\n \n /// For a local git repo\n@@ -47,7 +48,7 @@ pub fn git_clone_general(source: &str, target: &Path, v: &Version) -> bool {\n     else {\n         match v {\n             &ExactRevision(ref s) | &Tagged(ref s) => {\n-                    let outp = run::process_output_in_cwd(\"git\", [~\"checkout\", fmt!(\"tags/%s\", *s)],\n+                    let outp = process_output_in_cwd(\"git\", [~\"checkout\", fmt!(\"%s\", *s)],\n                                                          target);\n                     if outp.status != 0 {\n                         debug!(str::from_bytes_owned(outp.output.clone()));\n@@ -63,6 +64,12 @@ pub fn git_clone_general(source: &str, target: &Path, v: &Version) -> bool {\n         }\n }\n \n+fn process_output_in_cwd(prog: &str, args: &[~str], cwd: &Path) -> ProcessOutput {\n+    let mut prog = Process::new(prog, args, ProcessOptions{ dir: Some(cwd)\n+                                ,..ProcessOptions::new()});\n+    prog.finish_with_output()\n+}\n+\n pub fn is_git_dir(p: &Path) -> bool {\n     os::path_is_dir(&p.push(\".git\"))\n }"}, {"sha": "594298331b78499b32bf5d79cec6ae2f266b5235", "filename": "src/librustpkg/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c8780511b924705fbb567398e5201d9b492a2f32/src%2Flibrustpkg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8780511b924705fbb567398e5201d9b492a2f32/src%2Flibrustpkg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Ftests.rs?ref=c8780511b924705fbb567398e5201d9b492a2f32", "patch": "@@ -1029,6 +1029,6 @@ fn test_non_numeric_tag() {\n                                 \"test_pkg\", \"testbranch_only\"]);\n     let file2 = repo.push_many([\"mockgithub.com\", \"catamorphism\", \"test_pkg\",\n                                 \"master_only\"]);\n-    assert!(os::path_exists(&file1));'\n+    assert!(os::path_exists(&file1));\n     assert!(!os::path_exists(&file2));\n }"}]}