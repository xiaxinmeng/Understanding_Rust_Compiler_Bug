{"sha": "cdd61396c93f34915d145f0ab5b388138b479a3c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkZDYxMzk2YzkzZjM0OTE1ZDE0NWYwYWI1YjM4ODEzOGI0NzlhM2M=", "commit": {"author": {"name": "Dan Robertson", "email": "danlrobertson89@gmail.com", "date": "2018-05-12T19:04:44Z"}, "committer": {"name": "Dan Robertson", "email": "danlrobertson89@gmail.com", "date": "2018-05-14T01:28:15Z"}, "message": "typeck: Save the index of private fields\n\nSave the index of all fields regardless of their visibility. Problems\ncould occur later when attempting to index fields in error recovery if\nthey are not inserted.", "tree": {"sha": "015902583f63d328e1251b74443788035111eee8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/015902583f63d328e1251b74443788035111eee8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cdd61396c93f34915d145f0ab5b388138b479a3c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF5dO2RaKc5C+SCJ9RcSmUsR+QqUFAlr45nQACgkQRcSmUsR+\nQqXKbRAAuHi2lJ0qT3JlBclLFSgk0u7psrnHZxSixY4pmPi4HBcetHI3HRjil26Q\n0JlqcvqN3JCd8Whg0VGGv0gjLibv8UfO3kX0F4t8erRk9jGFQxMh8GzSoIIQ1B+X\nHIWA0dpWBKpF8oFOk/Ijcbe5hTXqTS9mnEiEmmMFhew4o40IOGONpw9PzP5evC1F\ntC6bo1BYbExG5g1/z4qmhivLxTMGm5E28r/nWrUeTtlSfOtt61yymoLS9KbKLBDF\nwWY8G9+aaLx1jD2JfgI5LhQDrrnUUeOfXS9+qKbU4XqFUjb7Bep9QJTRueWlryQs\nDCnfLovyGwkyJ2QIIsBTxxPwek244IoETPmMxar2QesYgeON/ISP1OqQ2m+nN+/G\nVJs0wF6kPl8METYHM5KN/h55E3FLZiGd0Kl/2fu8wIETwpFLktjothgN78bWNdrH\nWl4vgu1Y4G6JnuYJvheFBdr1xGA0bbHx2vb9aKYnV9PVBMPz55gwA+gnz+x2TlQG\nWVtMZK6lggkKE9AkIVpv96M5IWthQ0l/QoldzfGDvj7Av2V0glOiEwK9mvKPabg+\nOFim7ziLv7OEQP2tRMXoB+0m3fc/VbQzy1gopl1tIOkXDmJ6hTAWEOc0LqFNv5mM\nZGBAQHeQnBR4X82Vl3vDpzSzaJ6mZZnotmu0Q/bOU3Cv/9o+/e8=\n=8zAD\n-----END PGP SIGNATURE-----", "payload": "tree 015902583f63d328e1251b74443788035111eee8\nparent e6db79f2ca07e4e533f4e940462a42f1093e52f3\nauthor Dan Robertson <danlrobertson89@gmail.com> 1526151884 +0000\ncommitter Dan Robertson <danlrobertson89@gmail.com> 1526261295 +0000\n\ntypeck: Save the index of private fields\n\nSave the index of all fields regardless of their visibility. Problems\ncould occur later when attempting to index fields in error recovery if\nthey are not inserted.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cdd61396c93f34915d145f0ab5b388138b479a3c", "html_url": "https://github.com/rust-lang/rust/commit/cdd61396c93f34915d145f0ab5b388138b479a3c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cdd61396c93f34915d145f0ab5b388138b479a3c/comments", "author": {"login": "dlrobertson", "id": 7504153, "node_id": "MDQ6VXNlcjc1MDQxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/7504153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlrobertson", "html_url": "https://github.com/dlrobertson", "followers_url": "https://api.github.com/users/dlrobertson/followers", "following_url": "https://api.github.com/users/dlrobertson/following{/other_user}", "gists_url": "https://api.github.com/users/dlrobertson/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlrobertson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlrobertson/subscriptions", "organizations_url": "https://api.github.com/users/dlrobertson/orgs", "repos_url": "https://api.github.com/users/dlrobertson/repos", "events_url": "https://api.github.com/users/dlrobertson/events{/privacy}", "received_events_url": "https://api.github.com/users/dlrobertson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dlrobertson", "id": 7504153, "node_id": "MDQ6VXNlcjc1MDQxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/7504153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlrobertson", "html_url": "https://github.com/dlrobertson", "followers_url": "https://api.github.com/users/dlrobertson/followers", "following_url": "https://api.github.com/users/dlrobertson/following{/other_user}", "gists_url": "https://api.github.com/users/dlrobertson/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlrobertson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlrobertson/subscriptions", "organizations_url": "https://api.github.com/users/dlrobertson/orgs", "repos_url": "https://api.github.com/users/dlrobertson/repos", "events_url": "https://api.github.com/users/dlrobertson/events{/privacy}", "received_events_url": "https://api.github.com/users/dlrobertson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6db79f2ca07e4e533f4e940462a42f1093e52f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6db79f2ca07e4e533f4e940462a42f1093e52f3", "html_url": "https://github.com/rust-lang/rust/commit/e6db79f2ca07e4e533f4e940462a42f1093e52f3"}], "stats": {"total": 63, "additions": 62, "deletions": 1}, "files": [{"sha": "e38a00bba162e25509254836b7a70521f38775f8", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cdd61396c93f34915d145f0ab5b388138b479a3c/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cdd61396c93f34915d145f0ab5b388138b479a3c/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=cdd61396c93f34915d145f0ab5b388138b479a3c", "patch": "@@ -3081,12 +3081,14 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                     if let Some(index) = fields.iter().position(|f| f.name.to_ident() == ident) {\n                         let field = &fields[index];\n                         let field_ty = self.field_ty(expr.span, field, substs);\n+                        // Save the index of all fields regardless of their visibility in case\n+                        // of error recovery.\n+                        self.write_field_index(expr.id, index);\n                         if field.vis.is_accessible_from(def_scope, self.tcx) {\n                             let adjustments = autoderef.adjust_steps(needs);\n                             self.apply_adjustments(base, adjustments);\n                             autoderef.finalize();\n \n-                            self.write_field_index(expr.id, index);\n                             self.tcx.check_stability(field.did, Some(expr.id), expr.span);\n                             return field_ty;\n                         }"}, {"sha": "7d36517d9704b03b67aca67c1b173edfdc1b00d6", "filename": "src/test/compile-fail-fulldeps/proc-macro/auxiliary/issue_50493.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/cdd61396c93f34915d145f0ab5b388138b479a3c/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fauxiliary%2Fissue_50493.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cdd61396c93f34915d145f0ab5b388138b479a3c/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fauxiliary%2Fissue_50493.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fauxiliary%2Fissue_50493.rs?ref=cdd61396c93f34915d145f0ab5b388138b479a3c", "patch": "@@ -0,0 +1,32 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// force-host\n+// no-prefer-dynamic\n+\n+#![feature(proc_macro, proc_macro_lib)]\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+use proc_macro::TokenStream;\n+\n+#[proc_macro_derive(Derive)]\n+pub fn derive(_: TokenStream) -> TokenStream {\n+    let code = \"\n+        fn one(r: Restricted) {\n+            r.field;\n+        }\n+        fn two(r: Restricted) {\n+            r.field;\n+        }\n+    \";\n+\n+    code.parse().unwrap()\n+}"}, {"sha": "51112f202c8970fee02c728b89247125456983a4", "filename": "src/test/compile-fail-fulldeps/proc-macro/issue-50493.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/cdd61396c93f34915d145f0ab5b388138b479a3c/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fissue-50493.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cdd61396c93f34915d145f0ab5b388138b479a3c/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fissue-50493.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fissue-50493.rs?ref=cdd61396c93f34915d145f0ab5b388138b479a3c", "patch": "@@ -0,0 +1,27 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:issue_50493.rs\n+// ignore-stage1\n+\n+#![feature(proc_macro)]\n+\n+#[macro_use]\n+extern crate issue_50493;\n+\n+#[derive(Derive)] //~ ERROR field `field` of struct `Restricted` is private\n+struct Restricted {\n+    pub(in restricted) field: usize, //~ visibilities can only be restricted to ancestor modules\n+}\n+\n+mod restricted {}\n+\n+fn main() {}\n+"}]}