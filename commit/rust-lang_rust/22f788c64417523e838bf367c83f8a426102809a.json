{"sha": "22f788c64417523e838bf367c83f8a426102809a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyZjc4OGM2NDQxNzUyM2U4MzhiZjM2N2M4M2Y4YTQyNjEwMjgwOWE=", "commit": {"author": {"name": "Josh Driver", "email": "keeperofdakeys@gmail.com", "date": "2016-12-31T05:32:06Z"}, "committer": {"name": "Josh Driver", "email": "keeperofdakeys@gmail.com", "date": "2016-12-31T06:49:23Z"}, "message": "Stop macro calls in structs for proc_macro_derive from panicing", "tree": {"sha": "108a720e81508d25a77606c0ed9118cbb1bebc0e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/108a720e81508d25a77606c0ed9118cbb1bebc0e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/22f788c64417523e838bf367c83f8a426102809a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/22f788c64417523e838bf367c83f8a426102809a", "html_url": "https://github.com/rust-lang/rust/commit/22f788c64417523e838bf367c83f8a426102809a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/22f788c64417523e838bf367c83f8a426102809a/comments", "author": {"login": "keeperofdakeys", "id": 141626, "node_id": "MDQ6VXNlcjE0MTYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/141626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keeperofdakeys", "html_url": "https://github.com/keeperofdakeys", "followers_url": "https://api.github.com/users/keeperofdakeys/followers", "following_url": "https://api.github.com/users/keeperofdakeys/following{/other_user}", "gists_url": "https://api.github.com/users/keeperofdakeys/gists{/gist_id}", "starred_url": "https://api.github.com/users/keeperofdakeys/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keeperofdakeys/subscriptions", "organizations_url": "https://api.github.com/users/keeperofdakeys/orgs", "repos_url": "https://api.github.com/users/keeperofdakeys/repos", "events_url": "https://api.github.com/users/keeperofdakeys/events{/privacy}", "received_events_url": "https://api.github.com/users/keeperofdakeys/received_events", "type": "User", "site_admin": false}, "committer": {"login": "keeperofdakeys", "id": 141626, "node_id": "MDQ6VXNlcjE0MTYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/141626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keeperofdakeys", "html_url": "https://github.com/keeperofdakeys", "followers_url": "https://api.github.com/users/keeperofdakeys/followers", "following_url": "https://api.github.com/users/keeperofdakeys/following{/other_user}", "gists_url": "https://api.github.com/users/keeperofdakeys/gists{/gist_id}", "starred_url": "https://api.github.com/users/keeperofdakeys/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keeperofdakeys/subscriptions", "organizations_url": "https://api.github.com/users/keeperofdakeys/orgs", "repos_url": "https://api.github.com/users/keeperofdakeys/repos", "events_url": "https://api.github.com/users/keeperofdakeys/events{/privacy}", "received_events_url": "https://api.github.com/users/keeperofdakeys/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c9bb42ecc48ffb5a3c8b61e220b11adc3a46384", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c9bb42ecc48ffb5a3c8b61e220b11adc3a46384", "html_url": "https://github.com/rust-lang/rust/commit/6c9bb42ecc48ffb5a3c8b61e220b11adc3a46384"}], "stats": {"total": 63, "additions": 62, "deletions": 1}, "files": [{"sha": "c7e0b2733f099058799d7f64b5dc21add44cfbef", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/22f788c64417523e838bf367c83f8a426102809a/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22f788c64417523e838bf367c83f8a426102809a/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=22f788c64417523e838bf367c83f8a426102809a", "patch": "@@ -29,6 +29,7 @@ use syntax::ext::hygiene::Mark;\n use syntax::ext::tt::macro_rules;\n use syntax::feature_gate::{emit_feature_err, GateIssue};\n use syntax::fold::Folder;\n+use syntax::fold;\n use syntax::ptr::P;\n use syntax::symbol::keywords;\n use syntax::util::lev_distance::find_best_match_for_name;\n@@ -117,6 +118,10 @@ impl<'a> base::Resolver for Resolver<'a> {\n                 }\n                 path\n             }\n+\n+            fn fold_mac(&mut self, mac: ast::Mac) -> ast::Mac {\n+                fold::noop_fold_mac(mac, self)\n+            }\n         }\n \n         EliminateCrateVar(self).fold_item(item).expect_one(\"\")"}, {"sha": "811aea4a9eb7ead1eae2397c32150492b6b39a1e", "filename": "src/libsyntax_ext/deriving/custom.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/22f788c64417523e838bf367c83f8a426102809a/src%2Flibsyntax_ext%2Fderiving%2Fcustom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22f788c64417523e838bf367c83f8a426102809a/src%2Flibsyntax_ext%2Fderiving%2Fcustom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fderiving%2Fcustom.rs?ref=22f788c64417523e838bf367c83f8a426102809a", "patch": "@@ -12,7 +12,7 @@ use std::panic;\n \n use errors::FatalError;\n use proc_macro::{TokenStream, __internal};\n-use syntax::ast::{self, ItemKind, Attribute};\n+use syntax::ast::{self, ItemKind, Attribute, Mac};\n use syntax::attr::{mark_used, mark_known};\n use syntax::codemap::Span;\n use syntax::ext::base::*;\n@@ -28,6 +28,9 @@ impl<'a> Visitor<'a> for MarkAttrs<'a> {\n             mark_known(attr);\n         }\n     }\n+\n+    fn visit_mac(&mut self, _mac: &Mac) {\n+    }\n }\n \n pub struct CustomDerive {"}, {"sha": "a9257cb4c8b789f9c08119172be6baffe4a6f75c", "filename": "src/test/run-pass-fulldeps/proc-macro/auxiliary/derive-nothing.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/22f788c64417523e838bf367c83f8a426102809a/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fauxiliary%2Fderive-nothing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22f788c64417523e838bf367c83f8a426102809a/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fauxiliary%2Fderive-nothing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fauxiliary%2Fderive-nothing.rs?ref=22f788c64417523e838bf367c83f8a426102809a", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+#![feature(proc_macro)]\n+#![feature(proc_macro_lib)]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::TokenStream;\n+\n+#[proc_macro_derive(Nothing)]\n+pub fn nothing(input: TokenStream) -> TokenStream {\n+    \"\".parse().unwrap()\n+}"}, {"sha": "68da011e5a5bbcd079de8b639567b38896bd1432", "filename": "src/test/run-pass-fulldeps/proc-macro/struct-field-macro.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/22f788c64417523e838bf367c83f8a426102809a/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fstruct-field-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22f788c64417523e838bf367c83f8a426102809a/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fstruct-field-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fstruct-field-macro.rs?ref=22f788c64417523e838bf367c83f8a426102809a", "patch": "@@ -0,0 +1,29 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:derive-nothing.rs\n+// ignore-stage1\n+\n+#![feature(proc_macro)]\n+\n+#[macro_use]\n+extern crate derive_nothing;\n+\n+macro_rules! int {\n+    () => { i32 }\n+}\n+\n+#[derive(Nothing)]\n+struct S {\n+    x: int!(),\n+}\n+\n+fn main() {\n+}"}]}