{"sha": "5665308d8cc02d43865db2e2336ed98c9d944a59", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2NjUzMDhkOGNjMDJkNDM4NjVkYjJlMjMzNmVkOThjOWQ5NDRhNTk=", "commit": {"author": {"name": "Haitao Li", "email": "lihaitao@gmail.com", "date": "2011-11-16T15:28:15Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-16T19:35:14Z"}, "message": "tutorial: Update with native module syntax change", "tree": {"sha": "7c70b2e526cd3c02363a6f88b89afab23430c11b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7c70b2e526cd3c02363a6f88b89afab23430c11b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5665308d8cc02d43865db2e2336ed98c9d944a59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5665308d8cc02d43865db2e2336ed98c9d944a59", "html_url": "https://github.com/rust-lang/rust/commit/5665308d8cc02d43865db2e2336ed98c9d944a59", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5665308d8cc02d43865db2e2336ed98c9d944a59/comments", "author": {"login": "lht", "id": 19508, "node_id": "MDQ6VXNlcjE5NTA4", "avatar_url": "https://avatars.githubusercontent.com/u/19508?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lht", "html_url": "https://github.com/lht", "followers_url": "https://api.github.com/users/lht/followers", "following_url": "https://api.github.com/users/lht/following{/other_user}", "gists_url": "https://api.github.com/users/lht/gists{/gist_id}", "starred_url": "https://api.github.com/users/lht/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lht/subscriptions", "organizations_url": "https://api.github.com/users/lht/orgs", "repos_url": "https://api.github.com/users/lht/repos", "events_url": "https://api.github.com/users/lht/events{/privacy}", "received_events_url": "https://api.github.com/users/lht/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "88f29aab27bf56bda4cf7062cb53af0be4b5c251", "url": "https://api.github.com/repos/rust-lang/rust/commits/88f29aab27bf56bda4cf7062cb53af0be4b5c251", "html_url": "https://github.com/rust-lang/rust/commit/88f29aab27bf56bda4cf7062cb53af0be4b5c251"}], "stats": {"total": 31, "additions": 20, "deletions": 11}, "files": [{"sha": "64146b183d30ebc59744de2c80fd097414912dc0", "filename": "doc/tutorial/ffi.md", "status": "modified", "additions": 20, "deletions": 11, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/5665308d8cc02d43865db2e2336ed98c9d944a59/doc%2Ftutorial%2Fffi.md", "raw_url": "https://github.com/rust-lang/rust/raw/5665308d8cc02d43865db2e2336ed98c9d944a59/doc%2Ftutorial%2Fffi.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Ftutorial%2Fffi.md?ref=5665308d8cc02d43865db2e2336ed98c9d944a59", "patch": "@@ -15,7 +15,8 @@ OpenSSL libraries installed, it should 'just work'.\n     use std;\n     import std::{vec, str};\n     \n-    native \"cdecl\" mod crypto {\n+    #[abi = \"cdecl\"]\n+    native mod crypto {\n         fn SHA1(src: *u8, sz: uint, out: *u8) -> *u8;\n     }\n     \n@@ -41,7 +42,8 @@ OpenSSL libraries installed, it should 'just work'.\n Before we can call `SHA1`, we have to declare it. That is what this\n part of the program is responsible for:\n \n-    native \"cdecl\" mod crypto {\n+    #[abi = \"cdecl\"]\n+    native mod crypto {\n         fn SHA1(src: *u8, sz: uint, out: *u8) -> *u8;\n     }\n \n@@ -52,12 +54,17 @@ of functions are available in that library.\n In this case, it'll change the name `crypto` to a shared library name\n in a platform-specific way (`libcrypto.so` on Linux, for example), and\n link that in. If you want the module to have a different name from the\n-actual library, you can say `native \"cdecl\" mod something = \"crypto\" {\n-... }`.\n+actual library, you can use the `\"link_name\"` attribute, like:\n \n-The `\"cdecl\"` word indicates the calling convention to use for\n-functions in this module. Most C libraries use cdecl as their calling\n-convention. You can also specify `\"x86stdcall\"` to use stdcall\n+    #[abi = \"cdecl\"]\n+    #[link_name = \"crypto\"]\n+    native mod something {\n+        fn SHA1(src: *u8, sz: uint, out: *u8) -> *u8;\n+    }\n+\n+The `#[abi = \"cdecl\"]` attribute indicates the calling convention to\n+use for functions in this module. Most C libraries use cdecl as their\n+calling convention. You can also specify `\"x86stdcall\"` to use stdcall\n instead.\n \n FIXME: Mention c-stack variants? Are they going to change?\n@@ -164,7 +171,9 @@ microsecond-resolution timer.\n     use std;\n     type timeval = {mutable tv_sec: u32,\n                     mutable tv_usec: u32};\n-    native \"cdecl\" mod libc = \"\" {\n+    #[abi = \"cdecl\"]\n+    #[link_name = \"\"]\n+    native mod libc {\n         fn gettimeofday(tv: *timeval, tz: *()) -> i32;\n     }\n     fn unix_time_in_microseconds() -> u64 unsafe {\n@@ -173,9 +182,9 @@ microsecond-resolution timer.\n         ret (x.tv_sec as u64) * 1000_000_u64 + (x.tv_usec as u64);\n     }\n \n-The `libc = \"\"` sets the name of the native module to the empty string\n-to prevent the rust compiler from trying to link it. The standard C\n-library is already linked with Rust programs.\n+The `#[link_name = \"\"]` sets the name of the native module to the\n+empty string to prevent the rust compiler from trying to link it.\n+The standard C library is already linked with Rust programs.\n \n A `timeval`, in C, is a struct with two 32-bit integers. Thus, we\n define a record type with the same contents, and declare"}]}