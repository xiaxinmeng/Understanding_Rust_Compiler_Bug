{"sha": "48e3da6d5910d119d4afefd7d06340390db6968d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4ZTNkYTZkNTkxMGQxMTlkNGFmZWZkN2QwNjM0MDM5MGRiNjk2OGQ=", "commit": {"author": {"name": "tyler", "email": "tyler@brainiumstudios.com", "date": "2019-04-27T14:23:31Z"}, "committer": {"name": "tyler", "email": "tyler@brainiumstudios.com", "date": "2019-05-15T14:30:33Z"}, "message": "remove dead code: requires_move_before_drop", "tree": {"sha": "98e467a58632f4ce3711de11281e5f4b9b6a18c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98e467a58632f4ce3711de11281e5f4b9b6a18c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/48e3da6d5910d119d4afefd7d06340390db6968d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/48e3da6d5910d119d4afefd7d06340390db6968d", "html_url": "https://github.com/rust-lang/rust/commit/48e3da6d5910d119d4afefd7d06340390db6968d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/48e3da6d5910d119d4afefd7d06340390db6968d/comments", "author": {"login": "mtak-", "id": 6643140, "node_id": "MDQ6VXNlcjY2NDMxNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/6643140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mtak-", "html_url": "https://github.com/mtak-", "followers_url": "https://api.github.com/users/mtak-/followers", "following_url": "https://api.github.com/users/mtak-/following{/other_user}", "gists_url": "https://api.github.com/users/mtak-/gists{/gist_id}", "starred_url": "https://api.github.com/users/mtak-/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mtak-/subscriptions", "organizations_url": "https://api.github.com/users/mtak-/orgs", "repos_url": "https://api.github.com/users/mtak-/repos", "events_url": "https://api.github.com/users/mtak-/events{/privacy}", "received_events_url": "https://api.github.com/users/mtak-/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mtak-", "id": 6643140, "node_id": "MDQ6VXNlcjY2NDMxNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/6643140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mtak-", "html_url": "https://github.com/mtak-", "followers_url": "https://api.github.com/users/mtak-/followers", "following_url": "https://api.github.com/users/mtak-/following{/other_user}", "gists_url": "https://api.github.com/users/mtak-/gists{/gist_id}", "starred_url": "https://api.github.com/users/mtak-/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mtak-/subscriptions", "organizations_url": "https://api.github.com/users/mtak-/orgs", "repos_url": "https://api.github.com/users/mtak-/repos", "events_url": "https://api.github.com/users/mtak-/events{/privacy}", "received_events_url": "https://api.github.com/users/mtak-/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2951e6fd7fda39948a5c6a9a053f74a8a314a38", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2951e6fd7fda39948a5c6a9a053f74a8a314a38", "html_url": "https://github.com/rust-lang/rust/commit/f2951e6fd7fda39948a5c6a9a053f74a8a314a38"}], "stats": {"total": 27, "additions": 3, "deletions": 24}, "files": [{"sha": "fd278bfe39ac86435b2ad74ece235da44313c5f2", "filename": "src/libstd/sys/redox/fast_thread_local.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fsys%2Fredox%2Ffast_thread_local.rs", "raw_url": "https://github.com/rust-lang/rust/raw/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fsys%2Fredox%2Ffast_thread_local.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Ffast_thread_local.rs?ref=48e3da6d5910d119d4afefd7d06340390db6968d", "patch": "@@ -105,7 +105,3 @@ pub unsafe extern fn destroy_value<T>(ptr: *mut u8) {\n         ptr::drop_in_place((*ptr).inner.get());\n     }\n }\n-\n-pub fn requires_move_before_drop() -> bool {\n-    false\n-}"}, {"sha": "c34c2e6e786ec5bf38b09baa16524ff1a9636dc0", "filename": "src/libstd/sys/unix/fast_thread_local.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fsys%2Funix%2Ffast_thread_local.rs", "raw_url": "https://github.com/rust-lang/rust/raw/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fsys%2Funix%2Ffast_thread_local.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Ffast_thread_local.rs?ref=48e3da6d5910d119d4afefd7d06340390db6968d", "patch": "@@ -82,7 +82,3 @@ pub unsafe fn register_dtor(t: *mut u8, dtor: unsafe extern fn(*mut u8)) {\n         }\n     }\n }\n-\n-pub fn requires_move_before_drop() -> bool {\n-    false\n-}"}, {"sha": "31d0bd1e72ed2056806846c362a4e98b1d3a1307", "filename": "src/libstd/sys/windows/fast_thread_local.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fsys%2Fwindows%2Ffast_thread_local.rs", "raw_url": "https://github.com/rust-lang/rust/raw/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fsys%2Fwindows%2Ffast_thread_local.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Ffast_thread_local.rs?ref=48e3da6d5910d119d4afefd7d06340390db6968d", "patch": "@@ -2,7 +2,3 @@\n #![cfg(target_thread_local)]\n \n pub use crate::sys_common::thread_local::register_dtor_fallback as register_dtor;\n-\n-pub fn requires_move_before_drop() -> bool {\n-    false\n-}"}, {"sha": "0d5e1f2af38a69035951b8dfbe778aa2b4632586", "filename": "src/libstd/thread/local.rs", "status": "modified", "additions": 3, "deletions": 12, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fthread%2Flocal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/48e3da6d5910d119d4afefd7d06340390db6968d/src%2Flibstd%2Fthread%2Flocal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fthread%2Flocal.rs?ref=48e3da6d5910d119d4afefd7d06340390db6968d", "patch": "@@ -344,7 +344,7 @@ pub mod fast {\n     use crate::fmt;\n     use crate::mem;\n     use crate::ptr;\n-    use crate::sys::fast_thread_local::{register_dtor, requires_move_before_drop};\n+    use crate::sys::fast_thread_local::register_dtor;\n \n     pub struct Key<T> {\n         inner: UnsafeCell<Option<T>>,\n@@ -395,17 +395,8 @@ pub mod fast {\n         // destructor as running for this thread so calls to `get` will return\n         // `None`.\n         (*ptr).dtor_running.set(true);\n-\n-        // Some implementations may require us to move the value before we drop\n-        // it as it could get re-initialized in-place during destruction.\n-        //\n-        // Hence, we use `ptr::read` on those platforms (to move to a \"safe\"\n-        // location) instead of drop_in_place.\n-        if requires_move_before_drop() {\n-            ptr::read((*ptr).inner.get());\n-        } else {\n-            ptr::drop_in_place((*ptr).inner.get());\n-        }\n+        \n+        ptr::drop_in_place((*ptr).inner.get());\n     }\n }\n "}]}