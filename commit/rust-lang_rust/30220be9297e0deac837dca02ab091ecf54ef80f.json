{"sha": "30220be9297e0deac837dca02ab091ecf54ef80f", "node_id": "C_kwDOAAsO6NoAKDMwMjIwYmU5Mjk3ZTBkZWFjODM3ZGNhMDJhYjA5MWVjZjU0ZWY4MGY", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-05-06T00:09:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-06T00:09:31Z"}, "message": "Rollup merge of #110780 - notriddle:notriddle/slice-index, r=GuillaumeGomez\n\nrustdoc-search: add slices and arrays to index\n\nThis indexes them as primitives with generics, so `slice<u32>` is how you search for `[u32]`, and `array<u32>` for `[u32; 1]`. A future commit will desugar the square bracket syntax to search both arrays and slices at once.", "tree": {"sha": "702ee0c615e9c75e261b18b4e0c5e05c50daecb2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/702ee0c615e9c75e261b18b4e0c5e05c50daecb2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30220be9297e0deac837dca02ab091ecf54ef80f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkVZq7CRBK7hj4Ov3rIwAAinAIADW8y6fX5K5cKCPSYJrvU/0p\nGVG29K8xPou9N8UrqclqjWUoDm4esYRrp94hf3ZTripTFkQRlIz5A6y0dBT7mDM6\niTmEPmUl+25HbaaHvxiKM+kX3MRCL4v0k7T79V6h/z1KsCFFgjlhWNMgzszHeDIQ\nM03wDBSjKtOFJOMMHYas2J3TL/io3bwaFsSlWSkr7gTayJJuxNj66XjvCvPXUeFZ\nSEA4d+D2Cx8VDbEQGjH/YsGojQHj12GiJf53gZhYQFiJGqcp9hnnSoxR+6KHOdtp\n5FVsysCNHVkTAxLtmX5UyEsPqxbcfxOlSGSIZfaD8LVqW1aNq/IqhEqYU+0DVNU=\n=QmKV\n-----END PGP SIGNATURE-----\n", "payload": "tree 702ee0c615e9c75e261b18b4e0c5e05c50daecb2\nparent 923a5a2ca7c9d8d3f89d186e5d34918dc6522e25\nparent c4e00f7bd525dd480341c1790d10276274eed9a6\nauthor Yuki Okushi <jtitor@2k36.org> 1683331771 +0900\ncommitter GitHub <noreply@github.com> 1683331771 +0900\n\nRollup merge of #110780 - notriddle:notriddle/slice-index, r=GuillaumeGomez\n\nrustdoc-search: add slices and arrays to index\n\nThis indexes them as primitives with generics, so `slice<u32>` is how you search for `[u32]`, and `array<u32>` for `[u32; 1]`. A future commit will desugar the square bracket syntax to search both arrays and slices at once.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30220be9297e0deac837dca02ab091ecf54ef80f", "html_url": "https://github.com/rust-lang/rust/commit/30220be9297e0deac837dca02ab091ecf54ef80f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30220be9297e0deac837dca02ab091ecf54ef80f/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "923a5a2ca7c9d8d3f89d186e5d34918dc6522e25", "url": "https://api.github.com/repos/rust-lang/rust/commits/923a5a2ca7c9d8d3f89d186e5d34918dc6522e25", "html_url": "https://github.com/rust-lang/rust/commit/923a5a2ca7c9d8d3f89d186e5d34918dc6522e25"}, {"sha": "c4e00f7bd525dd480341c1790d10276274eed9a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4e00f7bd525dd480341c1790d10276274eed9a6", "html_url": "https://github.com/rust-lang/rust/commit/c4e00f7bd525dd480341c1790d10276274eed9a6"}], "stats": {"total": 111, "additions": 109, "deletions": 2}, "files": [{"sha": "a3be6dd52690963377ca1a2abea92e9760b296fa", "filename": "src/librustdoc/html/render/search_index.rs", "status": "modified", "additions": 28, "deletions": 2, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/30220be9297e0deac837dca02ab091ecf54ef80f/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30220be9297e0deac837dca02ab091ecf54ef80f/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs?ref=30220be9297e0deac837dca02ab091ecf54ef80f", "patch": "@@ -391,12 +391,14 @@ fn get_index_type_id(clean_type: &clean::Type) -> Option<RenderTypeId> {\n         clean::BorrowedRef { ref type_, .. } | clean::RawPointer(_, ref type_) => {\n             get_index_type_id(type_)\n         }\n+        // The type parameters are converted to generics in `add_generics_and_bounds_as_types`\n+        clean::Slice(_) => Some(RenderTypeId::Primitive(clean::PrimitiveType::Slice)),\n+        clean::Array(_, _) => Some(RenderTypeId::Primitive(clean::PrimitiveType::Array)),\n+        // Not supported yet\n         clean::BareFunction(_)\n         | clean::Generic(_)\n         | clean::ImplTrait(_)\n         | clean::Tuple(_)\n-        | clean::Slice(_)\n-        | clean::Array(_, _)\n         | clean::QPath { .. }\n         | clean::Infer => None,\n     }\n@@ -563,6 +565,30 @@ fn add_generics_and_bounds_as_types<'tcx, 'a>(\n             }\n         }\n         insert_ty(res, arg.clone(), ty_generics);\n+    } else if let Type::Slice(ref ty) = *arg {\n+        let mut ty_generics = Vec::new();\n+        add_generics_and_bounds_as_types(\n+            self_,\n+            generics,\n+            &ty,\n+            tcx,\n+            recurse + 1,\n+            &mut ty_generics,\n+            cache,\n+        );\n+        insert_ty(res, arg.clone(), ty_generics);\n+    } else if let Type::Array(ref ty, _) = *arg {\n+        let mut ty_generics = Vec::new();\n+        add_generics_and_bounds_as_types(\n+            self_,\n+            generics,\n+            &ty,\n+            tcx,\n+            recurse + 1,\n+            &mut ty_generics,\n+            cache,\n+        );\n+        insert_ty(res, arg.clone(), ty_generics);\n     } else {\n         // This is not a type parameter. So for example if we have `T, U: Option<T>`, and we're\n         // looking at `Option`, we enter this \"else\" condition, otherwise if it's `T`, we don't."}, {"sha": "8c21e06dc4e4f913912b7ca87c9641c86057dd79", "filename": "tests/rustdoc-js/slice-array.js", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/30220be9297e0deac837dca02ab091ecf54ef80f/tests%2Frustdoc-js%2Fslice-array.js", "raw_url": "https://github.com/rust-lang/rust/raw/30220be9297e0deac837dca02ab091ecf54ef80f/tests%2Frustdoc-js%2Fslice-array.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-js%2Fslice-array.js?ref=30220be9297e0deac837dca02ab091ecf54ef80f", "patch": "@@ -0,0 +1,65 @@\n+// exact-check\n+\n+const QUERY = [\n+    'R<primitive:slice<P>>',\n+    'primitive:slice<R<P>>',\n+    'R<primitive:slice<Q>>',\n+    'primitive:slice<R<Q>>',\n+    'R<primitive:array<Q>>',\n+    'primitive:array<R<Q>>',\n+    'primitive:array<TraitCat>',\n+    'primitive:array<TraitDog>',\n+];\n+\n+const EXPECTED = [\n+    {\n+        // R<primitive:slice<P>>\n+        'returned': [],\n+        'in_args': [\n+            { 'path': 'slice_array', 'name': 'alpha' },\n+        ],\n+    },\n+    {\n+        // primitive:slice<R<P>>\n+        'returned': [\n+            { 'path': 'slice_array', 'name': 'alef' },\n+        ],\n+        'in_args': [],\n+    },\n+    {\n+        // R<primitive:slice<Q>>\n+        'returned': [],\n+        'in_args': [],\n+    },\n+    {\n+        // primitive:slice<R<Q>>\n+        'returned': [],\n+        'in_args': [],\n+    },\n+    {\n+        // R<primitive:array<Q>>\n+        'returned': [\n+            { 'path': 'slice_array', 'name': 'bet' },\n+        ],\n+        'in_args': [],\n+    },\n+    {\n+        // primitive:array<R<Q>>\n+        'returned': [],\n+        'in_args': [\n+            { 'path': 'slice_array', 'name': 'beta' },\n+        ],\n+    },\n+    {\n+        // primitive::array<TraitCat>\n+        'in_args': [\n+            { 'path': 'slice_array', 'name': 'gamma' },\n+        ],\n+    },\n+    {\n+        // primitive::array<TraitDog>\n+        'in_args': [\n+            { 'path': 'slice_array', 'name': 'gamma' },\n+        ],\n+    },\n+];"}, {"sha": "2523b21cfaa5099acb43a028cce4cde3d9df11a8", "filename": "tests/rustdoc-js/slice-array.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/30220be9297e0deac837dca02ab091ecf54ef80f/tests%2Frustdoc-js%2Fslice-array.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30220be9297e0deac837dca02ab091ecf54ef80f/tests%2Frustdoc-js%2Fslice-array.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-js%2Fslice-array.rs?ref=30220be9297e0deac837dca02ab091ecf54ef80f", "patch": "@@ -0,0 +1,16 @@\n+pub struct P;\n+pub struct Q;\n+pub struct R<T>(T);\n+\n+// returns test\n+pub fn alef() -> &'static [R<P>] { loop {} }\n+pub fn bet() -> R<[Q; 32]> { loop {} }\n+\n+// in_args test\n+pub fn alpha(_x: R<&'static [P]>) { loop {} }\n+pub fn beta(_x: [R<Q>; 32]) { loop {} }\n+\n+pub trait TraitCat {}\n+pub trait TraitDog {}\n+\n+pub fn gamma<T: TraitCat + TraitDog>(t: [T; 32]) {}"}]}