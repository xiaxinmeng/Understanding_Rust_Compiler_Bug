{"sha": "29f4aa753fdf8a48523fbb51ddd2d21546b281a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5ZjRhYTc1M2ZkZjhhNDg1MjNmYmI1MWRkZDJkMjE1NDZiMjgxYTk=", "commit": {"author": {"name": "Oli Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2021-03-04T15:44:20Z"}, "committer": {"name": "Oli Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2021-03-04T15:45:31Z"}, "message": "Fixes -Zpolymorphize for src/test/ui/const-generics/auxiliary/crayte.rs", "tree": {"sha": "b98496d2dbbae43b11ccf6b137e0bdedef4b7ffb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b98496d2dbbae43b11ccf6b137e0bdedef4b7ffb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29f4aa753fdf8a48523fbb51ddd2d21546b281a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29f4aa753fdf8a48523fbb51ddd2d21546b281a9", "html_url": "https://github.com/rust-lang/rust/commit/29f4aa753fdf8a48523fbb51ddd2d21546b281a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29f4aa753fdf8a48523fbb51ddd2d21546b281a9/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67a61b9a013531bd0b03c8ddf1fd8922d4b7d252", "url": "https://api.github.com/repos/rust-lang/rust/commits/67a61b9a013531bd0b03c8ddf1fd8922d4b7d252", "html_url": "https://github.com/rust-lang/rust/commit/67a61b9a013531bd0b03c8ddf1fd8922d4b7d252"}], "stats": {"total": 48, "additions": 39, "deletions": 9}, "files": [{"sha": "05b0e3a7dab954ba1114ff6a80736ae90c26ac4d", "filename": "compiler/rustc_mir/src/monomorphize/polymorphize.rs", "status": "modified", "additions": 39, "deletions": 9, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/29f4aa753fdf8a48523fbb51ddd2d21546b281a9/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fpolymorphize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29f4aa753fdf8a48523fbb51ddd2d21546b281a9/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fpolymorphize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fpolymorphize.rs?ref=29f4aa753fdf8a48523fbb51ddd2d21546b281a9", "patch": "@@ -107,18 +107,48 @@ fn mark_used_by_default_parameters<'tcx>(\n     generics: &'tcx ty::Generics,\n     unused_parameters: &mut FiniteBitSet<u32>,\n ) {\n-    if !tcx.is_trait(def_id) && (tcx.is_closure(def_id) || tcx.type_of(def_id).is_generator()) {\n-        for param in &generics.params {\n-            debug!(?param, \"(closure/gen)\");\n-            unused_parameters.clear(param.index);\n-        }\n-    } else {\n-        for param in &generics.params {\n-            debug!(?param, \"(other)\");\n-            if let ty::GenericParamDefKind::Lifetime = param.kind {\n+    match tcx.def_kind(def_id) {\n+        DefKind::Closure | DefKind::Generator => {\n+            for param in &generics.params {\n+                debug!(?param, \"(closure/gen)\");\n                 unused_parameters.clear(param.index);\n             }\n         }\n+        DefKind::Mod\n+        | DefKind::Struct\n+        | DefKind::Union\n+        | DefKind::Enum\n+        | DefKind::Variant\n+        | DefKind::Trait\n+        | DefKind::TyAlias\n+        | DefKind::ForeignTy\n+        | DefKind::TraitAlias\n+        | DefKind::AssocTy\n+        | DefKind::TyParam\n+        | DefKind::Fn\n+        | DefKind::Const\n+        | DefKind::ConstParam\n+        | DefKind::Static\n+        | DefKind::Ctor(_, _)\n+        | DefKind::AssocFn\n+        | DefKind::AssocConst\n+        | DefKind::Macro(_)\n+        | DefKind::ExternCrate\n+        | DefKind::Use\n+        | DefKind::ForeignMod\n+        | DefKind::AnonConst\n+        | DefKind::OpaqueTy\n+        | DefKind::Field\n+        | DefKind::LifetimeParam\n+        | DefKind::GlobalAsm\n+        | DefKind::Impl => {\n+            for param in &generics.params {\n+                debug!(?param, \"(other)\");\n+                if let ty::GenericParamDefKind::Lifetime = param.kind {\n+                    unused_parameters.clear(param.index);\n+                }\n+            }\n+        }\n     }\n \n     if let Some(parent) = generics.parent {"}]}