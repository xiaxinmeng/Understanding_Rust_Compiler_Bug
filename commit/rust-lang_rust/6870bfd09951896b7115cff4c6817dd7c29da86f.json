{"sha": "6870bfd09951896b7115cff4c6817dd7c29da86f", "node_id": "C_kwDOAAsO6NoAKDY4NzBiZmQwOTk1MTg5NmI3MTE1Y2ZmNGM2ODE3ZGQ3YzI5ZGE4NmY", "commit": {"author": {"name": "TJ DeVries", "email": "devries.timothyj@gmail.com", "date": "2021-12-02T05:04:03Z"}, "committer": {"name": "TJ DeVries", "email": "devries.timothyj@gmail.com", "date": "2021-12-02T05:04:03Z"}, "message": "fixup: include more information for impls", "tree": {"sha": "d012ce5759ad17914804d657cfe6ae9f210e7ca1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d012ce5759ad17914804d657cfe6ae9f210e7ca1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6870bfd09951896b7115cff4c6817dd7c29da86f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6870bfd09951896b7115cff4c6817dd7c29da86f", "html_url": "https://github.com/rust-lang/rust/commit/6870bfd09951896b7115cff4c6817dd7c29da86f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6870bfd09951896b7115cff4c6817dd7c29da86f/comments", "author": {"login": "tjdevries", "id": 4466899, "node_id": "MDQ6VXNlcjQ0NjY4OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4466899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tjdevries", "html_url": "https://github.com/tjdevries", "followers_url": "https://api.github.com/users/tjdevries/followers", "following_url": "https://api.github.com/users/tjdevries/following{/other_user}", "gists_url": "https://api.github.com/users/tjdevries/gists{/gist_id}", "starred_url": "https://api.github.com/users/tjdevries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tjdevries/subscriptions", "organizations_url": "https://api.github.com/users/tjdevries/orgs", "repos_url": "https://api.github.com/users/tjdevries/repos", "events_url": "https://api.github.com/users/tjdevries/events{/privacy}", "received_events_url": "https://api.github.com/users/tjdevries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tjdevries", "id": 4466899, "node_id": "MDQ6VXNlcjQ0NjY4OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4466899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tjdevries", "html_url": "https://github.com/tjdevries", "followers_url": "https://api.github.com/users/tjdevries/followers", "following_url": "https://api.github.com/users/tjdevries/following{/other_user}", "gists_url": "https://api.github.com/users/tjdevries/gists{/gist_id}", "starred_url": "https://api.github.com/users/tjdevries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tjdevries/subscriptions", "organizations_url": "https://api.github.com/users/tjdevries/orgs", "repos_url": "https://api.github.com/users/tjdevries/repos", "events_url": "https://api.github.com/users/tjdevries/events{/privacy}", "received_events_url": "https://api.github.com/users/tjdevries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d50f18fb65b2a4e991e765df0fcdfd8852a63eb1", "url": "https://api.github.com/repos/rust-lang/rust/commits/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1", "html_url": "https://github.com/rust-lang/rust/commit/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "c93c471f4948e7cf8e75bb31c9337c13367f1cf1", "filename": "crates/ide/src/moniker.rs", "status": "modified", "additions": 40, "deletions": 2, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/6870bfd09951896b7115cff4c6817dd7c29da86f/crates%2Fide%2Fsrc%2Fmoniker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6870bfd09951896b7115cff4c6817dd7c29da86f/crates%2Fide%2Fsrc%2Fmoniker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fmoniker.rs?ref=6870bfd09951896b7115cff4c6817dd7c29da86f", "patch": "@@ -110,8 +110,23 @@ pub(crate) fn def_to_moniker(\n     // Handle associated items within a trait\n     if let Some(assoc) = def.as_assoc_item(db) {\n         let container = assoc.container(db);\n-        if let AssocItemContainer::Trait(parent_trait) = container {\n-            path.push(parent_trait.name(db));\n+        match container {\n+            AssocItemContainer::Trait(trait_) => {\n+                // Because different traits can have functions with the same name,\n+                // we have to include the trait name as part of the moniker for uniqueness.\n+                path.push(trait_.name(db));\n+            }\n+            AssocItemContainer::Impl(impl_) => {\n+                // Because a struct can implement multiple traits, for implementations\n+                // we add both the struct name and the trait name to the path\n+                if let Some(adt) = impl_.self_ty(db).as_adt() {\n+                    path.push(adt.name(db));\n+                }\n+\n+                if let Some(trait_) = impl_.trait_(db) {\n+                    path.push(trait_.name(db));\n+                }\n+            }\n         }\n     }\n \n@@ -253,6 +268,29 @@ pub mod module {\n         );\n     }\n \n+    #[test]\n+    fn moniker_for_trait_impl_function() {\n+        check_moniker(\n+            r#\"\n+//- /foo/lib.rs crate:foo@CratesIo:0.1.0,https://a.b/foo.git\n+pub mod module {\n+    pub trait MyTrait {\n+        pub fn func() {}\n+    }\n+\n+    struct MyStruct {}\n+\n+    impl MyTrait for MyStruct {\n+        pub fn func$0() {}\n+    }\n+}\n+\"#,\n+            \"foo::module::MyStruct::MyTrait::func\",\n+            r#\"PackageInformation { name: \"foo\", repo: \"https://a.b/foo.git\", version: \"0.1.0\" }\"#,\n+            MonikerKind::Export,\n+        );\n+    }\n+\n     #[test]\n     fn moniker_for_field() {\n         check_moniker("}]}