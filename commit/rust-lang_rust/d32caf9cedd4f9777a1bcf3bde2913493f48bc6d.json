{"sha": "d32caf9cedd4f9777a1bcf3bde2913493f48bc6d", "node_id": "C_kwDOAAsO6NoAKGQzMmNhZjljZWRkNGY5Nzc3YTFiY2YzYmRlMjkxMzQ5M2Y0OGJjNmQ", "commit": {"author": {"name": "SLASHLogin", "email": "loginmlgxd@gmail.com", "date": "2022-08-26T12:11:47Z"}, "committer": {"name": "SLASHLogin", "email": "loginmlgxd@gmail.com", "date": "2022-11-09T13:56:21Z"}, "message": "Port ArchiveBuildFailure", "tree": {"sha": "ab92f0f7ced30e51326d75d8e29b0181c02e7d3d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab92f0f7ced30e51326d75d8e29b0181c02e7d3d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d", "html_url": "https://github.com/rust-lang/rust/commit/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d/comments", "author": {"login": "SLASHLogin", "id": 24846525, "node_id": "MDQ6VXNlcjI0ODQ2NTI1", "avatar_url": "https://avatars.githubusercontent.com/u/24846525?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SLASHLogin", "html_url": "https://github.com/SLASHLogin", "followers_url": "https://api.github.com/users/SLASHLogin/followers", "following_url": "https://api.github.com/users/SLASHLogin/following{/other_user}", "gists_url": "https://api.github.com/users/SLASHLogin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SLASHLogin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SLASHLogin/subscriptions", "organizations_url": "https://api.github.com/users/SLASHLogin/orgs", "repos_url": "https://api.github.com/users/SLASHLogin/repos", "events_url": "https://api.github.com/users/SLASHLogin/events{/privacy}", "received_events_url": "https://api.github.com/users/SLASHLogin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SLASHLogin", "id": 24846525, "node_id": "MDQ6VXNlcjI0ODQ2NTI1", "avatar_url": "https://avatars.githubusercontent.com/u/24846525?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SLASHLogin", "html_url": "https://github.com/SLASHLogin", "followers_url": "https://api.github.com/users/SLASHLogin/followers", "following_url": "https://api.github.com/users/SLASHLogin/following{/other_user}", "gists_url": "https://api.github.com/users/SLASHLogin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SLASHLogin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SLASHLogin/subscriptions", "organizations_url": "https://api.github.com/users/SLASHLogin/orgs", "repos_url": "https://api.github.com/users/SLASHLogin/repos", "events_url": "https://api.github.com/users/SLASHLogin/events{/privacy}", "received_events_url": "https://api.github.com/users/SLASHLogin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "978b5f73e4be94fc99c757b5a66bf297404202f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/978b5f73e4be94fc99c757b5a66bf297404202f2", "html_url": "https://github.com/rust-lang/rust/commit/978b5f73e4be94fc99c757b5a66bf297404202f2"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "e6ab0e74b7d0db87c044a484c29ef093db9e2218", "filename": "compiler/rustc_codegen_llvm/src/back/archive.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs?ref=d32caf9cedd4f9777a1bcf3bde2913493f48bc6d", "patch": "@@ -12,7 +12,7 @@ use std::str;\n use object::read::macho::FatArch;\n \n use crate::common;\n-use crate::errors::ErrorCreatingImportLibrary;\n+use crate::errors::{ErrorCreatingImportLibrary, ArchiveBuildFailure};\n use crate::llvm::archive_ro::{ArchiveRO, Child};\n use crate::llvm::{self, ArchiveKind, LLVMMachineType, LLVMRustCOFFShortExport};\n use rustc_codegen_ssa::back::archive::{ArchiveBuilder, ArchiveBuilderBuilder};\n@@ -148,7 +148,7 @@ impl<'a> ArchiveBuilder<'a> for LlvmArchiveBuilder<'a> {\n     fn build(mut self: Box<Self>, output: &Path) -> bool {\n         match self.build_with_llvm(output) {\n             Ok(any_members) => any_members,\n-            Err(e) => self.sess.fatal(&format!(\"failed to build archive: {}\", e)),\n+            Err(e) => self.sess.emit_fatal(ArchiveBuildFailure { error: e }),\n         }\n     }\n }"}, {"sha": "12ea4166cf46dd5fc2760ba9d83de96b30f5f568", "filename": "compiler/rustc_codegen_llvm/src/errors.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d/compiler%2Frustc_codegen_llvm%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d/compiler%2Frustc_codegen_llvm%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Ferrors.rs?ref=d32caf9cedd4f9777a1bcf3bde2913493f48bc6d", "patch": "@@ -84,3 +84,9 @@ pub(crate) struct LinkageConstOrMutType {\n #[derive(SessionDiagnostic)]\n #[diag(codegen_llvm::sanitizer_memtag_requires_mte)]\n pub(crate) struct SanitizerMemtagRequiresMte;\n+\n+#[derive(SessionDiagnostic)]\n+#[diag(codegen_llvm::archive_build_failure)]\n+pub(crate) struct ArchiveBuildFailure {\n+    pub error: std::io::Error,\n+}"}, {"sha": "7ce1bb18d62fbe612403702a7f3ebf631f2ddf05", "filename": "compiler/rustc_error_messages/locales/en-US/codegen_llvm.ftl", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_llvm.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/d32caf9cedd4f9777a1bcf3bde2913493f48bc6d/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_llvm.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_llvm.ftl?ref=d32caf9cedd4f9777a1bcf3bde2913493f48bc6d", "patch": "@@ -36,3 +36,6 @@ codegen_llvm_linkage_const_or_mut_type =\n \n codegen_llvm_sanitizer_memtag_requires_mte =\n     `-Zsanitizer=memtag` requires `-Ctarget-feature=+mte`\n+\n+codegen_llvm_archive_build_failure =\n+    failed to build archive: {$error}"}]}