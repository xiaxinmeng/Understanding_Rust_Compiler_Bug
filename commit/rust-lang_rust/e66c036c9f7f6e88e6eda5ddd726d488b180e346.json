{"sha": "e66c036c9f7f6e88e6eda5ddd726d488b180e346", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2NmMwMzZjOWY3ZjZlODhlNmVkYTVkZGQ3MjZkNDg4YjE4MGUzNDY=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-13T22:20:56Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-13T22:21:17Z"}, "message": "libcore: Add task::try", "tree": {"sha": "670fe55c5e1897007c818ac56c40d3de2759c8d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/670fe55c5e1897007c818ac56c40d3de2759c8d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e66c036c9f7f6e88e6eda5ddd726d488b180e346", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e66c036c9f7f6e88e6eda5ddd726d488b180e346", "html_url": "https://github.com/rust-lang/rust/commit/e66c036c9f7f6e88e6eda5ddd726d488b180e346", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e66c036c9f7f6e88e6eda5ddd726d488b180e346/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31bb6a60bb59d40c97ab3f68a313d199429bf4ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/31bb6a60bb59d40c97ab3f68a313d199429bf4ef", "html_url": "https://github.com/rust-lang/rust/commit/31bb6a60bb59d40c97ab3f68a313d199429bf4ef"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "b24e27596b5f3c80522d855a3e2203ac9cc4fc7a", "filename": "src/libcore/task.rs", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/e66c036c9f7f6e88e6eda5ddd726d488b180e346/src%2Flibcore%2Ftask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e66c036c9f7f6e88e6eda5ddd726d488b180e346/src%2Flibcore%2Ftask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftask.rs?ref=e66c036c9f7f6e88e6eda5ddd726d488b180e346", "patch": "@@ -50,6 +50,7 @@ export spawn_connected;\n export connected_fn;\n export connected_task;\n export currently_unwinding;\n+export try;\n \n #[abi = \"rust-intrinsic\"]\n native mod rusti {\n@@ -349,6 +350,30 @@ fn currently_unwinding() -> bool {\n     rustrt::rust_task_is_unwinding(rustrt::rust_get_task())\n }\n \n+/*\n+Function: try\n+\n+Execute a function in another task and return either the return value\n+of the function or result::err.\n+\n+Returns:\n+\n+If the function executed successfully then try returns result::ok\n+containing the value returned by the function. If the function fails\n+then try returns result::err containing nil.\n+*/\n+fn try<T:send>(+f: fn~() -> T) -> result::t<T,()> {\n+    let p = comm::port();\n+    let ch = comm::chan(p);\n+    alt join(spawn_joinable {||\n+        unsupervise();\n+        comm::send(ch, f());\n+    }) {\n+      tr_success. { result::ok(comm::recv(p)) }\n+      tr_failure. { result::err(()) }\n+    }\n+}\n+\n // Local Variables:\n // mode: rust;\n // fill-column: 78;"}, {"sha": "021a56a5dff481306d45fdc089b20533bcc454f8", "filename": "src/test/stdtest/task.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e66c036c9f7f6e88e6eda5ddd726d488b180e346/src%2Ftest%2Fstdtest%2Ftask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e66c036c9f7f6e88e6eda5ddd726d488b180e346/src%2Ftest%2Fstdtest%2Ftask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fstdtest%2Ftask.rs?ref=e66c036c9f7f6e88e6eda5ddd726d488b180e346", "patch": "@@ -57,3 +57,24 @@ fn spawn_polymorphic() {\n     task::spawn {|| foo(true);};\n     task::spawn {|| foo(42);};\n }\n+\n+#[test]\n+fn try_success() {\n+    alt task::try {||\n+        \"Success!\"\n+    } {\n+        result::ok(\"Success!\") { }\n+        _ { fail; }\n+    }\n+}\n+\n+#[test]\n+#[ignore(cfg(target_os = \"win32\"))]\n+fn try_fail() {\n+    alt task::try {||\n+        fail\n+    } {\n+        result::err(()) { }\n+        _ { fail; }\n+    }\n+}\n\\ No newline at end of file"}]}