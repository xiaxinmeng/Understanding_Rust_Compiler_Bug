{"sha": "193c3773c245132f0c113fe9d957524b75a0eaa0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5M2MzNzczYzI0NTEzMmYwYzExM2ZlOWQ5NTc1MjRiNzVhMGVhYTA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-02-13T17:12:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-02-13T17:12:30Z"}, "message": "Rollup merge of #58202 - varkor:deprecated-future-external, r=GuillaumeGomez\n\nIgnore future deprecations in #[deprecated]\n\nThe future deprecation warnings should only apply to `#[rustc_deprecated]` as they take into account rustc's version. Fixes #57952.\n\nI've also slightly modified rustdoc's display of future deprecation notices to make it more consistent, so I'm assigning a rustdoc team member for review to make sure this is okay.\n\nr? @GuillaumeGomez", "tree": {"sha": "757c734c6c371f4ae420087ba35a8da5c9b57da1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/757c734c6c371f4ae420087ba35a8da5c9b57da1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/193c3773c245132f0c113fe9d957524b75a0eaa0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcZE/+CRBK7hj4Ov3rIwAAdHIIABnguiGMNMpi5oqJWL+8MgtS\nbRgeb5/daAu58Tz+17XdZEtvsdM6xJkkIkt8StJrNqdRo2pRfbSyMZOCdBQfCtJZ\nEby+m7ps+L2NjsBd8Au0OOYTaYsyFF7Da+4rU0JknW7O5WdGRcaagD5cjMXdEZxG\nR3KCD5NLnQWHuP4Qt+11DwAy8sp4NIZBZaGGDokBuVlhADG5M/JdDxJkO+arXE3n\nWdxmczPiFoSJg59RUWNhwEt0d0rI7imPyKUWBbAhqUukQgdGyh+W9CRroN7wmHpj\nAWetvxmFeRV4XA+FN6q9ijLXpp/uvuYtUezCAZoltvbqG/i+j+zsDfRw7PLJuMA=\n=BUuR\n-----END PGP SIGNATURE-----\n", "payload": "tree 757c734c6c371f4ae420087ba35a8da5c9b57da1\nparent adb2bb6e6175e5eeb51b7ef337b3300afd19301d\nparent b5fa87076047207622a5fd6d3902e3ca58d0a9d6\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1550077950 +0100\ncommitter GitHub <noreply@github.com> 1550077950 +0100\n\nRollup merge of #58202 - varkor:deprecated-future-external, r=GuillaumeGomez\n\nIgnore future deprecations in #[deprecated]\n\nThe future deprecation warnings should only apply to `#[rustc_deprecated]` as they take into account rustc's version. Fixes #57952.\n\nI've also slightly modified rustdoc's display of future deprecation notices to make it more consistent, so I'm assigning a rustdoc team member for review to make sure this is okay.\n\nr? @GuillaumeGomez\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/193c3773c245132f0c113fe9d957524b75a0eaa0", "html_url": "https://github.com/rust-lang/rust/commit/193c3773c245132f0c113fe9d957524b75a0eaa0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/193c3773c245132f0c113fe9d957524b75a0eaa0/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "adb2bb6e6175e5eeb51b7ef337b3300afd19301d", "url": "https://api.github.com/repos/rust-lang/rust/commits/adb2bb6e6175e5eeb51b7ef337b3300afd19301d", "html_url": "https://github.com/rust-lang/rust/commit/adb2bb6e6175e5eeb51b7ef337b3300afd19301d"}, {"sha": "b5fa87076047207622a5fd6d3902e3ca58d0a9d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5fa87076047207622a5fd6d3902e3ca58d0a9d6", "html_url": "https://github.com/rust-lang/rust/commit/b5fa87076047207622a5fd6d3902e3ca58d0a9d6"}], "stats": {"total": 226, "additions": 134, "deletions": 92}, "files": [{"sha": "e4dbcc588f77344872862edd87b601f818129654", "filename": "src/librustc/middle/stability.rs", "status": "modified", "additions": 1, "deletions": 27, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Flibrustc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Flibrustc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fstability.rs?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -593,37 +593,11 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n         // Deprecated attributes apply in-crate and cross-crate.\n         if let Some(id) = id {\n             if let Some(depr_entry) = self.lookup_deprecation_entry(def_id) {\n-                // If the deprecation is scheduled for a future Rust\n-                // version, then we should display no warning message.\n-                let deprecated_in_future_version = if let Some(sym) = depr_entry.attr.since {\n-                    let since = sym.as_str();\n-                    if !deprecation_in_effect(&since) {\n-                        Some(since)\n-                    } else {\n-                        None\n-                    }\n-                } else {\n-                    None\n-                };\n-\n                 let parent_def_id = self.hir().local_def_id(self.hir().get_parent(id));\n                 let skip = self.lookup_deprecation_entry(parent_def_id)\n                                .map_or(false, |parent_depr| parent_depr.same_origin(&depr_entry));\n \n-                if let Some(since) = deprecated_in_future_version {\n-                    let path = self.item_path_str(def_id);\n-                    let message = format!(\"use of item '{}' \\\n-                                           that will be deprecated in future version {}\",\n-                                          path,\n-                                          since);\n-\n-                    lint_deprecated(def_id,\n-                                    id,\n-                                    depr_entry.attr.note,\n-                                    None,\n-                                    &message,\n-                                    lint::builtin::DEPRECATED_IN_FUTURE);\n-                } else if !skip {\n+                if !skip {\n                     let path = self.item_path_str(def_id);\n                     let message = format!(\"use of deprecated item '{}'\", path);\n                     lint_deprecated(def_id,"}, {"sha": "e660d27d74b4cf416cb7ababd012da123d5fa8c8", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 24, "deletions": 7, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -2823,7 +2823,17 @@ fn stability_tags(item: &clean::Item) -> String {\n \n     // The trailing space after each tag is to space it properly against the rest of the docs.\n     if item.deprecation().is_some() {\n-        tags += &tag_html(\"deprecated\", \"Deprecated\");\n+        let mut message = \"Deprecated\";\n+        if let Some(ref stab) = item.stability {\n+            if let Some(ref depr) = stab.deprecation {\n+                if let Some(ref since) = depr.since {\n+                    if !stability::deprecation_in_effect(&since) {\n+                        message = \"Deprecation planned\";\n+                    }\n+                }\n+            }\n+        }\n+        tags += &tag_html(\"deprecated\", message);\n     }\n \n     if let Some(stab) = item\n@@ -2851,16 +2861,23 @@ fn short_stability(item: &clean::Item, cx: &Context) -> Vec<String> {\n     let mut stability = vec![];\n     let error_codes = ErrorCodes::from(UnstableFeatures::from_environment().is_nightly_build());\n \n-    if let Some(Deprecation { since, note }) = &item.deprecation() {\n+    if let Some(Deprecation { note, since }) = &item.deprecation() {\n+        // We display deprecation messages for #[deprecated] and #[rustc_deprecated]\n+        // but only display the future-deprecation messages for #[rustc_deprecated].\n         let mut message = if let Some(since) = since {\n-            if stability::deprecation_in_effect(since) {\n-                format!(\"Deprecated since {}\", Escape(since))\n-            } else {\n-                format!(\"Deprecating in {}\", Escape(since))\n-            }\n+            format!(\"Deprecated since {}\", Escape(since))\n         } else {\n             String::from(\"Deprecated\")\n         };\n+        if let Some(ref stab) = item.stability {\n+            if let Some(ref depr) = stab.deprecation {\n+                if let Some(ref since) = depr.since {\n+                    if !stability::deprecation_in_effect(&since) {\n+                        message = format!(\"Deprecating in {}\", Escape(&since));\n+                    }\n+                }\n+            }\n+        }\n \n         if let Some(note) = note {\n             let mut ids = cx.id_map.borrow_mut();"}, {"sha": "c5248c52fb973313eefda0ff4143312fef01cbcd", "filename": "src/test/rustdoc/deprecated-future.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Frustdoc%2Fdeprecated-future.rs", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Frustdoc%2Fdeprecated-future.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fdeprecated-future.rs?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -1,6 +1,8 @@\n #![feature(deprecated)]\n \n+// @has deprecated_future/index.html '//*[@class=\"stab deprecated\"]' \\\n+//      'Deprecated'\n // @has deprecated_future/struct.S.html '//*[@class=\"stab deprecated\"]' \\\n-//      'Deprecating in 99.99.99: effectively never'\n+//      'Deprecated since 99.99.99: effectively never'\n #[deprecated(since = \"99.99.99\", note = \"effectively never\")]\n pub struct S;"}, {"sha": "3133775706b8de24386f15282a1adf4ddb5086f9", "filename": "src/test/rustdoc/rustc_deprecated-future.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Frustdoc%2Frustc_deprecated-future.rs", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Frustdoc%2Frustc_deprecated-future.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Frustc_deprecated-future.rs?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -0,0 +1,11 @@\n+#![feature(staged_api)]\n+\n+#![stable(feature = \"rustc_deprecated-future-test\", since = \"1.0.0\")]\n+\n+// @has rustc_deprecated_future/index.html '//*[@class=\"stab deprecated\"]' \\\n+//      'Deprecation planned'\n+// @has rustc_deprecated_future/struct.S.html '//*[@class=\"stab deprecated\"]' \\\n+//      'Deprecating in 99.99.99: effectively never'\n+#[rustc_deprecated(since = \"99.99.99\", reason = \"effectively never\")]\n+#[stable(feature = \"rustc_deprecated-future-test\", since = \"1.0.0\")]\n+pub struct S;"}, {"sha": "138d902621cbcb2e3309181255b9030b66cbb204", "filename": "src/test/ui/deprecation/deprecation-in-future.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-future.rs", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-future.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-future.rs?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -1,12 +1,14 @@\n // ignore-tidy-linelength\n \n+// run-pass\n+\n #![deny(deprecated_in_future)]\n \n #[deprecated(since = \"99.99.99\", note = \"text\")]\n pub fn deprecated_future() {}\n \n fn test() {\n-    deprecated_future(); //~ ERROR use of item 'deprecated_future' that will be deprecated in future version 99.99.99: text\n+    deprecated_future(); // ok; deprecated_in_future only applies to rustc_deprecated\n }\n \n fn main() {}"}, {"sha": "81d2461c1bd83754232e1d426b3f29349d6ea451", "filename": "src/test/ui/deprecation/deprecation-in-future.stderr", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-future.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-future.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-future.stderr?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -1,14 +1,8 @@\n-error: use of item 'deprecated_future' that will be deprecated in future version 99.99.99: text\n-  --> $DIR/deprecation-in-future.rs:9:5\n+warning: use of deprecated item 'deprecated_future': text\n+  --> $DIR/deprecation-in-future.rs:11:5\n    |\n-LL |     deprecated_future(); //~ ERROR use of item 'deprecated_future' that will be deprecated in future version 99.99.99: text\n+LL |     deprecated_future(); // ok; deprecated_in_future only applies to rustc_deprecated\n    |     ^^^^^^^^^^^^^^^^^\n    |\n-note: lint level defined here\n-  --> $DIR/deprecation-in-future.rs:3:9\n-   |\n-LL | #![deny(deprecated_in_future)]\n-   |         ^^^^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to previous error\n+   = note: #[warn(deprecated)] on by default\n "}, {"sha": "033d6eebbb21957542e11e245b2713001179d2a6", "filename": "src/test/ui/deprecation/deprecation-lint.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-lint.rs?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -261,8 +261,9 @@ mod this_crate {\n         <Foo>::trait_deprecated_text(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n         <Foo as Trait>::trait_deprecated_text(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n \n-        deprecated_future(); // Fine; no error.\n-        deprecated_future_text(); // Fine; no error.\n+        // Future deprecations are only permitted for rustc_deprecated.\n+        deprecated_future(); //~ ERROR use of deprecated item\n+        deprecated_future_text(); //~ ERROR use of deprecated item\n \n         let _ = DeprecatedStruct {\n             //~^ ERROR use of deprecated item 'this_crate::DeprecatedStruct': text"}, {"sha": "c48d06e86154d84b27b89d71927d4bc92a4b18d4", "filename": "src/test/ui/deprecation/deprecation-lint.stderr", "status": "modified", "additions": 56, "deletions": 44, "changes": 100, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-lint.stderr?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -214,128 +214,140 @@ error: use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n LL |         <Foo as Trait>::trait_deprecated_text(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n+error: use of deprecated item 'this_crate::deprecated_future': text\n+  --> $DIR/deprecation-lint.rs:265:9\n+   |\n+LL |         deprecated_future(); //~ ERROR use of deprecated item\n+   |         ^^^^^^^^^^^^^^^^^\n+\n+error: use of deprecated item 'this_crate::deprecated_future_text': text\n+  --> $DIR/deprecation-lint.rs:266:9\n+   |\n+LL |         deprecated_future_text(); //~ ERROR use of deprecated item\n+   |         ^^^^^^^^^^^^^^^^^^^^^^\n+\n error: use of deprecated item 'this_crate::DeprecatedStruct': text\n-  --> $DIR/deprecation-lint.rs:267:17\n+  --> $DIR/deprecation-lint.rs:268:17\n    |\n LL |         let _ = DeprecatedStruct {\n    |                 ^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::DeprecatedUnitStruct': text\n-  --> $DIR/deprecation-lint.rs:272:17\n+  --> $DIR/deprecation-lint.rs:273:17\n    |\n LL |         let _ = DeprecatedUnitStruct; //~ ERROR use of deprecated item 'this_crate::DeprecatedUnitStruct': text\n    |                 ^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Enum::DeprecatedVariant': text\n-  --> $DIR/deprecation-lint.rs:274:17\n+  --> $DIR/deprecation-lint.rs:275:17\n    |\n LL |         let _ = Enum::DeprecatedVariant; //~ ERROR use of deprecated item 'this_crate::Enum::DeprecatedVariant': text\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::DeprecatedTupleStruct': text\n-  --> $DIR/deprecation-lint.rs:276:17\n+  --> $DIR/deprecation-lint.rs:277:17\n    |\n LL |         let _ = DeprecatedTupleStruct (1); //~ ERROR use of deprecated item 'this_crate::DeprecatedTupleStruct': text\n    |                 ^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::nested::DeprecatedStruct': text\n-  --> $DIR/deprecation-lint.rs:278:17\n+  --> $DIR/deprecation-lint.rs:279:17\n    |\n LL |         let _ = nested::DeprecatedStruct {\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::nested::DeprecatedUnitStruct': text\n-  --> $DIR/deprecation-lint.rs:283:17\n+  --> $DIR/deprecation-lint.rs:284:17\n    |\n LL |         let _ = nested::DeprecatedUnitStruct; //~ ERROR use of deprecated item 'this_crate::nested::DeprecatedUnitStruct': text\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::nested::Enum::DeprecatedVariant': text\n-  --> $DIR/deprecation-lint.rs:285:17\n+  --> $DIR/deprecation-lint.rs:286:17\n    |\n LL |         let _ = nested::Enum::DeprecatedVariant; //~ ERROR use of deprecated item 'this_crate::nested::Enum::DeprecatedVariant': text\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::nested::DeprecatedTupleStruct': text\n-  --> $DIR/deprecation-lint.rs:287:17\n+  --> $DIR/deprecation-lint.rs:288:17\n    |\n LL |         let _ = nested::DeprecatedTupleStruct (1); //~ ERROR use of deprecated item 'this_crate::nested::DeprecatedTupleStruct': text\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated': text\n-  --> $DIR/deprecation-lint.rs:292:9\n+  --> $DIR/deprecation-lint.rs:293:9\n    |\n LL |         Trait::trait_deprecated(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated'\n    |         ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated': text\n-  --> $DIR/deprecation-lint.rs:294:9\n+  --> $DIR/deprecation-lint.rs:295:9\n    |\n LL |         <Foo as Trait>::trait_deprecated(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated'\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n-  --> $DIR/deprecation-lint.rs:296:9\n+  --> $DIR/deprecation-lint.rs:297:9\n    |\n LL |         Trait::trait_deprecated_text(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n-  --> $DIR/deprecation-lint.rs:298:9\n+  --> $DIR/deprecation-lint.rs:299:9\n    |\n LL |         <Foo as Trait>::trait_deprecated_text(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::test_fn_closure_body::{{closure}}::bar'\n-  --> $DIR/deprecation-lint.rs:316:13\n+  --> $DIR/deprecation-lint.rs:317:13\n    |\n LL |             bar(); //~ ERROR use of deprecated item 'this_crate::test_fn_closure_body::{{closure}}::bar'\n    |             ^^^\n \n error: use of deprecated item 'this_crate::DeprecatedTrait': text\n-  --> $DIR/deprecation-lint.rs:335:10\n+  --> $DIR/deprecation-lint.rs:336:10\n    |\n LL |     impl DeprecatedTrait for S { } //~ ERROR use of deprecated item 'this_crate::DeprecatedTrait': text\n    |          ^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::DeprecatedTrait': text\n-  --> $DIR/deprecation-lint.rs:337:24\n+  --> $DIR/deprecation-lint.rs:338:24\n    |\n LL |     trait LocalTrait : DeprecatedTrait { } //~ ERROR use of deprecated item 'this_crate::DeprecatedTrait': text\n    |                        ^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated': text\n-  --> $DIR/deprecation-lint.rs:389:17\n+  --> $DIR/deprecation-lint.rs:390:17\n    |\n LL |         let x = Deprecated {\n    |                 ^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated': text\n-  --> $DIR/deprecation-lint.rs:398:13\n+  --> $DIR/deprecation-lint.rs:399:13\n    |\n LL |         let Deprecated {\n    |             ^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated': text\n-  --> $DIR/deprecation-lint.rs:404:13\n+  --> $DIR/deprecation-lint.rs:405:13\n    |\n LL |         let Deprecated\n    |             ^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated2': text\n-  --> $DIR/deprecation-lint.rs:409:17\n+  --> $DIR/deprecation-lint.rs:410:17\n    |\n LL |         let x = Deprecated2(1, 2, 3);\n    |                 ^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated2': text\n-  --> $DIR/deprecation-lint.rs:419:13\n+  --> $DIR/deprecation-lint.rs:420:13\n    |\n LL |         let Deprecated2\n    |             ^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated2': text\n-  --> $DIR/deprecation-lint.rs:428:13\n+  --> $DIR/deprecation-lint.rs:429:13\n    |\n LL |         let Deprecated2\n    |             ^^^^^^^^^^^\n@@ -593,136 +605,136 @@ LL |         <Foo>::trait_deprecated_text(&foo); //~ ERROR use of deprecated ite\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::DeprecatedStruct::i': text\n-  --> $DIR/deprecation-lint.rs:269:13\n+  --> $DIR/deprecation-lint.rs:270:13\n    |\n LL |             i: 0 //~ ERROR use of deprecated item 'this_crate::DeprecatedStruct::i': text\n    |             ^^^^\n \n error: use of deprecated item 'this_crate::nested::DeprecatedStruct::i': text\n-  --> $DIR/deprecation-lint.rs:280:13\n+  --> $DIR/deprecation-lint.rs:281:13\n    |\n LL |             i: 0 //~ ERROR use of deprecated item 'this_crate::nested::DeprecatedStruct::i': text\n    |             ^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated': text\n-  --> $DIR/deprecation-lint.rs:291:13\n+  --> $DIR/deprecation-lint.rs:292:13\n    |\n LL |         foo.trait_deprecated(); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated'\n    |             ^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated': text\n-  --> $DIR/deprecation-lint.rs:293:9\n+  --> $DIR/deprecation-lint.rs:294:9\n    |\n LL |         <Foo>::trait_deprecated(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated'\n    |         ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n-  --> $DIR/deprecation-lint.rs:295:13\n+  --> $DIR/deprecation-lint.rs:296:13\n    |\n LL |         foo.trait_deprecated_text(); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n    |             ^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n-  --> $DIR/deprecation-lint.rs:297:9\n+  --> $DIR/deprecation-lint.rs:298:9\n    |\n LL |         <Foo>::trait_deprecated_text(&foo); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated': text\n-  --> $DIR/deprecation-lint.rs:302:13\n+  --> $DIR/deprecation-lint.rs:303:13\n    |\n LL |         foo.trait_deprecated(); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated'\n    |             ^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n-  --> $DIR/deprecation-lint.rs:303:13\n+  --> $DIR/deprecation-lint.rs:304:13\n    |\n LL |         foo.trait_deprecated_text(); //~ ERROR use of deprecated item 'this_crate::Trait::trait_deprecated_text': text\n    |             ^^^^^^^^^^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Stable::override2': text\n-  --> $DIR/deprecation-lint.rs:362:13\n+  --> $DIR/deprecation-lint.rs:363:13\n    |\n LL |             override2: 3,\n    |             ^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Stable::override2': text\n-  --> $DIR/deprecation-lint.rs:366:17\n+  --> $DIR/deprecation-lint.rs:367:17\n    |\n LL |         let _ = x.override2;\n    |                 ^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Stable::override2': text\n-  --> $DIR/deprecation-lint.rs:370:13\n+  --> $DIR/deprecation-lint.rs:371:13\n    |\n LL |             override2: _\n    |             ^^^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Stable2::2': text\n-  --> $DIR/deprecation-lint.rs:378:17\n+  --> $DIR/deprecation-lint.rs:379:17\n    |\n LL |         let _ = x.2;\n    |                 ^^^\n \n error: use of deprecated item 'this_crate2::Stable2::2': text\n-  --> $DIR/deprecation-lint.rs:383:20\n+  --> $DIR/deprecation-lint.rs:384:20\n    |\n LL |                    _)\n    |                    ^\n \n error: use of deprecated item 'this_crate2::Deprecated::inherit': text\n-  --> $DIR/deprecation-lint.rs:391:13\n+  --> $DIR/deprecation-lint.rs:392:13\n    |\n LL |             inherit: 1,\n    |             ^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated::inherit': text\n-  --> $DIR/deprecation-lint.rs:395:17\n+  --> $DIR/deprecation-lint.rs:396:17\n    |\n LL |         let _ = x.inherit;\n    |                 ^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated::inherit': text\n-  --> $DIR/deprecation-lint.rs:400:13\n+  --> $DIR/deprecation-lint.rs:401:13\n    |\n LL |             inherit: _,\n    |             ^^^^^^^^^^\n \n error: use of deprecated item 'this_crate2::Deprecated2::0': text\n-  --> $DIR/deprecation-lint.rs:412:17\n+  --> $DIR/deprecation-lint.rs:413:17\n    |\n LL |         let _ = x.0;\n    |                 ^^^\n \n error: use of deprecated item 'this_crate2::Deprecated2::1': text\n-  --> $DIR/deprecation-lint.rs:414:17\n+  --> $DIR/deprecation-lint.rs:415:17\n    |\n LL |         let _ = x.1;\n    |                 ^^^\n \n error: use of deprecated item 'this_crate2::Deprecated2::2': text\n-  --> $DIR/deprecation-lint.rs:416:17\n+  --> $DIR/deprecation-lint.rs:417:17\n    |\n LL |         let _ = x.2;\n    |                 ^^^\n \n error: use of deprecated item 'this_crate2::Deprecated2::0': text\n-  --> $DIR/deprecation-lint.rs:421:14\n+  --> $DIR/deprecation-lint.rs:422:14\n    |\n LL |             (_,\n    |              ^\n \n error: use of deprecated item 'this_crate2::Deprecated2::1': text\n-  --> $DIR/deprecation-lint.rs:423:14\n+  --> $DIR/deprecation-lint.rs:424:14\n    |\n LL |              _,\n    |              ^\n \n error: use of deprecated item 'this_crate2::Deprecated2::2': text\n-  --> $DIR/deprecation-lint.rs:425:14\n+  --> $DIR/deprecation-lint.rs:426:14\n    |\n LL |              _)\n    |              ^\n \n-error: aborting due to 120 previous errors\n+error: aborting due to 122 previous errors\n "}, {"sha": "a19363c512950c06f1b304b96d41d03ace087ac4", "filename": "src/test/ui/deprecation/rustc_deprecation-in-future.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Frustc_deprecation-in-future.rs", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Frustc_deprecation-in-future.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Frustc_deprecation-in-future.rs?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -0,0 +1,15 @@\n+// ignore-tidy-linelength\n+\n+#![deny(deprecated_in_future)]\n+\n+#![feature(staged_api)]\n+\n+#![stable(feature = \"rustc_deprecation-in-future-test\", since = \"1.0.0\")]\n+\n+#[rustc_deprecated(since = \"99.99.99\", reason = \"effectively never\")]\n+#[stable(feature = \"rustc_deprecation-in-future-test\", since = \"1.0.0\")]\n+pub struct S;\n+\n+fn main() {\n+    let _ = S; //~ ERROR use of item 'S' that will be deprecated in future version 99.99.99: effectively never\n+}"}, {"sha": "bd8ade16ec0e85577223123be5c99f80e1c75845", "filename": "src/test/ui/deprecation/rustc_deprecation-in-future.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Frustc_deprecation-in-future.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/193c3773c245132f0c113fe9d957524b75a0eaa0/src%2Ftest%2Fui%2Fdeprecation%2Frustc_deprecation-in-future.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Frustc_deprecation-in-future.stderr?ref=193c3773c245132f0c113fe9d957524b75a0eaa0", "patch": "@@ -0,0 +1,14 @@\n+error: use of item 'S' that will be deprecated in future version 99.99.99: effectively never\n+  --> $DIR/rustc_deprecation-in-future.rs:14:13\n+   |\n+LL |     let _ = S; //~ ERROR use of item 'S' that will be deprecated in future version 99.99.99: effectively never\n+   |             ^\n+   |\n+note: lint level defined here\n+  --> $DIR/rustc_deprecation-in-future.rs:3:9\n+   |\n+LL | #![deny(deprecated_in_future)]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}