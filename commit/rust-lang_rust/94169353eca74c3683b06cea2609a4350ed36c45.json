{"sha": "94169353eca74c3683b06cea2609a4350ed36c45", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0MTY5MzUzZWNhNzRjMzY4M2IwNmNlYTI2MDlhNDM1MGVkMzZjNDU=", "commit": {"author": {"name": "Barosl Lee", "email": "vcs@barosl.com", "date": "2014-11-14T08:14:44Z"}, "committer": {"name": "Barosl Lee", "email": "vcs@barosl.com", "date": "2014-11-14T15:22:21Z"}, "message": "Improve examples for syntax::ext::deriving::encodable\n\nThe examples in the documentation for syntax::ext::deriving::encodable\nare outdated, and do not work. To fix this, the following changes are\napplied:\n\n- emit_field() -> emit_struct_field()\n- read_field() -> read_struct_field()\n- Use Result to report errors\n- Add the mut keyword to Encoder/Decoder\n- Prefer Encodable::encode() to emit_uint", "tree": {"sha": "ac685b5408394a313c8041a34091b4ba1e5d6aeb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac685b5408394a313c8041a34091b4ba1e5d6aeb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94169353eca74c3683b06cea2609a4350ed36c45", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94169353eca74c3683b06cea2609a4350ed36c45", "html_url": "https://github.com/rust-lang/rust/commit/94169353eca74c3683b06cea2609a4350ed36c45", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94169353eca74c3683b06cea2609a4350ed36c45/comments", "author": {"login": "barosl", "id": 573768, "node_id": "MDQ6VXNlcjU3Mzc2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/573768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/barosl", "html_url": "https://github.com/barosl", "followers_url": "https://api.github.com/users/barosl/followers", "following_url": "https://api.github.com/users/barosl/following{/other_user}", "gists_url": "https://api.github.com/users/barosl/gists{/gist_id}", "starred_url": "https://api.github.com/users/barosl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/barosl/subscriptions", "organizations_url": "https://api.github.com/users/barosl/orgs", "repos_url": "https://api.github.com/users/barosl/repos", "events_url": "https://api.github.com/users/barosl/events{/privacy}", "received_events_url": "https://api.github.com/users/barosl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "barosl", "id": 573768, "node_id": "MDQ6VXNlcjU3Mzc2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/573768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/barosl", "html_url": "https://github.com/barosl", "followers_url": "https://api.github.com/users/barosl/followers", "following_url": "https://api.github.com/users/barosl/following{/other_user}", "gists_url": "https://api.github.com/users/barosl/gists{/gist_id}", "starred_url": "https://api.github.com/users/barosl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/barosl/subscriptions", "organizations_url": "https://api.github.com/users/barosl/orgs", "repos_url": "https://api.github.com/users/barosl/repos", "events_url": "https://api.github.com/users/barosl/events{/privacy}", "received_events_url": "https://api.github.com/users/barosl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb2168c5252adeda1dd35ccf7050df89655233d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb2168c5252adeda1dd35ccf7050df89655233d7", "html_url": "https://github.com/rust-lang/rust/commit/bb2168c5252adeda1dd35ccf7050df89655233d7"}], "stats": {"total": 71, "additions": 40, "deletions": 31}, "files": [{"sha": "69eb260b8c4cc0626ca8518d1180cb9e0e7ddc81", "filename": "src/libsyntax/ext/deriving/encodable.rs", "status": "modified", "additions": 40, "deletions": 31, "changes": 71, "blob_url": "https://github.com/rust-lang/rust/blob/94169353eca74c3683b06cea2609a4350ed36c45/src%2Flibsyntax%2Fext%2Fderiving%2Fencodable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94169353eca74c3683b06cea2609a4350ed36c45/src%2Flibsyntax%2Fext%2Fderiving%2Fencodable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fderiving%2Fencodable.rs?ref=94169353eca74c3683b06cea2609a4350ed36c45", "patch": "@@ -22,19 +22,23 @@\n //! would generate two implementations like:\n //!\n //! ```ignore\n-//! impl<S:serialize::Encoder> Encodable<S> for Node {\n-//!     fn encode(&self, s: &S) {\n-//!         s.emit_struct(\"Node\", 1, || {\n-//!             s.emit_field(\"id\", 0, || s.emit_uint(self.id))\n+//! impl<S: Encoder<E>, E> Encodable<S, E> for Node {\n+//!     fn encode(&self, s: &mut S) -> Result<(), E> {\n+//!         s.emit_struct(\"Node\", 1, |this| {\n+//!             this.emit_struct_field(\"id\", 0, |this| {\n+//!                 Encodable::encode(&self.id, this)\n+//!                 /* this.emit_uint(self.id) can also be used */\n+//!             })\n //!         })\n //!     }\n //! }\n //!\n-//! impl<D:Decoder> Decodable for node_id {\n-//!     fn decode(d: &D) -> Node {\n-//!         d.read_struct(\"Node\", 1, || {\n-//!             Node {\n-//!                 id: d.read_field(\"x\".to_string(), 0, || decode(d))\n+//! impl<D: Decoder<E>, E> Decodable<D, E> for Node {\n+//!     fn decode(d: &mut D) -> Result<Node, E> {\n+//!         d.read_struct(\"Node\", 1, |this| {\n+//!             match this.read_struct_field(\"id\", 0, |this| Decodable::decode(this)) {\n+//!                 Ok(id) => Ok(Node { id: id }),\n+//!                 Err(e) => Err(e),\n //!             }\n //!         })\n //!     }\n@@ -46,37 +50,42 @@\n //!\n //! ```ignore\n //! #[deriving(Encodable, Decodable)]\n-//! struct spanned<T> { node: T, span: Span }\n+//! struct Spanned<T> { node: T, span: Span }\n //! ```\n //!\n //! would yield functions like:\n //!\n //! ```ignore\n-//!     impl<\n-//!         S: Encoder,\n-//!         T: Encodable<S>\n-//!     > spanned<T>: Encodable<S> {\n-//!         fn encode<S:Encoder>(s: &S) {\n-//!             s.emit_rec(|| {\n-//!                 s.emit_field(\"node\", 0, || self.node.encode(s));\n-//!                 s.emit_field(\"span\", 1, || self.span.encode(s));\n-//!             })\n-//!         }\n+//! impl<\n+//!     S: Encoder<E>,\n+//!     E,\n+//!     T: Encodable<S, E>\n+//! > Encodable<S, E> for Spanned<T> {\n+//!     fn encode(&self, s: &mut S) -> Result<(), E> {\n+//!         s.emit_struct(\"Spanned\", 2, |this| {\n+//!             this.emit_struct_field(\"node\", 0, |this| self.node.encode(this))\n+//!                 .ok().unwrap();\n+//!             this.emit_struct_field(\"span\", 1, |this| self.span.encode(this))\n+//!         })\n //!     }\n+//! }\n //!\n-//!     impl<\n-//!         D: Decoder,\n-//!         T: Decodable<D>\n-//!     > spanned<T>: Decodable<D> {\n-//!         fn decode(d: &D) -> spanned<T> {\n-//!             d.read_rec(|| {\n-//!                 {\n-//!                     node: d.read_field(\"node\".to_string(), 0, || decode(d)),\n-//!                     span: d.read_field(\"span\".to_string(), 1, || decode(d)),\n-//!                 }\n+//! impl<\n+//!     D: Decoder<E>,\n+//!     E,\n+//!     T: Decodable<D, E>\n+//! > Decodable<D, E> for Spanned<T> {\n+//!     fn decode(d: &mut D) -> Result<Spanned<T>, E> {\n+//!         d.read_struct(\"Spanned\", 2, |this| {\n+//!             Ok(Spanned {\n+//!                 node: this.read_struct_field(\"node\", 0, |this| Decodable::decode(this))\n+//!                     .ok().unwrap(),\n+//!                 span: this.read_struct_field(\"span\", 1, |this| Decodable::decode(this))\n+//!                     .ok().unwrap(),\n //!             })\n-//!         }\n+//!         })\n //!     }\n+//! }\n //! ```\n \n use ast::{MetaItem, Item, Expr, ExprRet, MutMutable, LitNil};"}]}