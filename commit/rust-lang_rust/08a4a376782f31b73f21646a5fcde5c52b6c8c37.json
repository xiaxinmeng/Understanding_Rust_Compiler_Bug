{"sha": "08a4a376782f31b73f21646a5fcde5c52b6c8c37", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4YTRhMzc2NzgyZjMxYjczZjIxNjQ2YTVmY2RlNWM1MmI2YzhjMzc=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-30T22:54:04Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-30T22:54:04Z"}, "message": "Omit 'missing IndexMut impl' suggestion when IndexMut is implemented.", "tree": {"sha": "3bb3911ef468d375cc42b0691fff8caf50eaa58c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3bb3911ef468d375cc42b0691fff8caf50eaa58c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/08a4a376782f31b73f21646a5fcde5c52b6c8c37", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAluIdYwACgkQAXYLT59T\n8VRZdRAAjMeWJiqmcOx3szhK+irdFWGGABSJWnPSSW5f6wWFQGvKQ9yjmZULc1Pk\nvkH9vRw7Yvn0JB9CZ+opCSWekmyQrKN+pQkoJvkLpvBweQ5lwwz5h7qWqPyh8+qX\n8FpONApSjM/obG0fS4RpOIV3UPFZDrq9ovmWMmzrvgDjJaxATU7rFIL8JcneiMkl\n7wT5ZWuOPZpieQCT2XJ1y0/nMAw0wyPHZlOFNJgqO/6YiNhtM28/aWt/8EW/2wmi\n3J5ZlnP39YPRaRHCaOcoaQ1GYYuWpaYxlo0zkjlD5d6JWR4jRLEmszB9taIJcvwS\nuFoiW3g4HTJy0mE9n3b4loxsWwJ5/zzDFCVwYx3XNPyH8/Q9OSr/4kvQn8p4zBxq\nOc2+YzODC4yXQ1TPV9EAEdNlxla+C2N9GXvnztkMbGqz22s/aH+4jsQ81urbKEzK\ncVfdhIpHCmbGiWVlF7tw6w6xFvE9CE/KLiPJJGLxDh98Iaw58cLckNgODXLgk+lm\noQM2yLdHeaH2Au46iMa1bOzmCFSNBDeJW4VTeTwD4DHxAE8C4/DC2IL3HVBSciPV\nC86TfWMRHGCyDQsXry/BtOKd4LmQwrtMfVyHCRFxGb3Ev6jw4DQk6CcqMYAZ99fR\nScxabKcZNsSHBjqsPwLx7/Y4k8m4vRzNIJkpX6S2k0sIScBgHnQ=\n=1Z7x\n-----END PGP SIGNATURE-----", "payload": "tree 3bb3911ef468d375cc42b0691fff8caf50eaa58c\nparent 1ad2f5cec45869311f3a51731f77bbed009a66e9\nauthor David Wood <david@davidtw.co> 1535669644 +0200\ncommitter David Wood <david@davidtw.co> 1535669644 +0200\n\nOmit 'missing IndexMut impl' suggestion when IndexMut is implemented.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/08a4a376782f31b73f21646a5fcde5c52b6c8c37", "html_url": "https://github.com/rust-lang/rust/commit/08a4a376782f31b73f21646a5fcde5c52b6c8c37", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/08a4a376782f31b73f21646a5fcde5c52b6c8c37/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ad2f5cec45869311f3a51731f77bbed009a66e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ad2f5cec45869311f3a51731f77bbed009a66e9", "html_url": "https://github.com/rust-lang/rust/commit/1ad2f5cec45869311f3a51731f77bbed009a66e9"}], "stats": {"total": 62, "additions": 59, "deletions": 3}, "files": [{"sha": "78ab772d9ad5b2f3ed5fd9cbd2cbf26d62f53c50", "filename": "src/librustc_mir/borrow_check/mutability_errors.rs", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Flibrustc_mir%2Fborrow_check%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Flibrustc_mir%2Fborrow_check%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmutability_errors.rs?ref=08a4a376782f31b73f21646a5fcde5c52b6c8c37", "patch": "@@ -423,11 +423,27 @@ impl<'a, 'gcx, 'tcx> MirBorrowckCtxt<'a, 'gcx, 'tcx> {\n                             }\n                         ) = &self.mir.basic_blocks()[location.block].terminator {\n                             if self.tcx.parent(id) == self.tcx.lang_items().index_trait() {\n+\n+                                let mut found = false;\n+                                self.tcx.for_each_relevant_impl(\n+                                    self.tcx.lang_items().index_mut_trait().unwrap(),\n+                                    substs.type_at(0),\n+                                    |_relevant_impl| {\n+                                        found = true;\n+                                    }\n+                                );\n+\n+                                let extra = if found {\n+                                    String::from(\"\")\n+                                } else {\n+                                    format!(\", but it is not implemented for `{}`\",\n+                                            substs.type_at(0))\n+                                };\n+\n                                 err.help(\n                                     &format!(\n-                                        \"trait `IndexMut` is required to modify indexed content, \\\n-                                         but it is not implemented for `{}`\",\n-                                         substs.type_at(0),\n+                                        \"trait `IndexMut` is required to modify indexed content{}\",\n+                                         extra,\n                                     ),\n                                 );\n                             }"}, {"sha": "8e7ffa67b061c68524362f4f9be08f39adb5ab2b", "filename": "src/test/ui/borrowck/index-mut-help-with-impl.nll.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.nll.stderr?ref=08a4a376782f31b73f21646a5fcde5c52b6c8c37", "patch": "@@ -0,0 +1,11 @@\n+error[E0596]: cannot borrow data in a `&` reference as mutable\n+  --> $DIR/index-mut-help-with-impl.rs:19:5\n+   |\n+LL |     Index::index(&v, 1..2).make_ascii_uppercase(); //~ ERROR\n+   |     ^^^^^^^^^^^^^^^^^^^^^^ cannot borrow as mutable\n+   |\n+   = help: trait `IndexMut` is required to modify indexed content\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0596`."}, {"sha": "a5bab48c5cc581a64a40ef6e26bc0d274a9b3f30", "filename": "src/test/ui/borrowck/index-mut-help-with-impl.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.rs?ref=08a4a376782f31b73f21646a5fcde5c52b6c8c37", "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// When mutably indexing a type that implements `Index` and `IndexMut` but\n+// `Index::index` is being used specifically, the normal special help message\n+// should not mention a missing `IndexMut` impl.\n+\n+fn main() {\n+    use std::ops::Index;\n+\n+    let v = String::from(\"dinosaur\");\n+    Index::index(&v, 1..2).make_ascii_uppercase(); //~ ERROR\n+}"}, {"sha": "9c28b86c45a92fc00ecf1cb6b2563343e8fc597a", "filename": "src/test/ui/borrowck/index-mut-help-with-impl.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/08a4a376782f31b73f21646a5fcde5c52b6c8c37/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Findex-mut-help-with-impl.stderr?ref=08a4a376782f31b73f21646a5fcde5c52b6c8c37", "patch": "@@ -0,0 +1,9 @@\n+error[E0596]: cannot borrow immutable borrowed content as mutable\n+  --> $DIR/index-mut-help-with-impl.rs:19:5\n+   |\n+LL |     Index::index(&v, 1..2).make_ascii_uppercase(); //~ ERROR\n+   |     ^^^^^^^^^^^^^^^^^^^^^^ cannot borrow as mutable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0596`."}]}