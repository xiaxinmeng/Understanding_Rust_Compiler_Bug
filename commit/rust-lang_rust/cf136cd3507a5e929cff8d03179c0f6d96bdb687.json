{"sha": "cf136cd3507a5e929cff8d03179c0f6d96bdb687", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmMTM2Y2QzNTA3YTVlOTI5Y2ZmOGQwMzE3OWMwZjZkOTZiZGI2ODc=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2015-01-07T19:04:37Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2015-01-07T19:07:58Z"}, "message": "Use the `erase_regions` helper within trans in deference to\n`ty_fold::erase_regions`; also erase regions whenever we normalize\nassociated types.", "tree": {"sha": "7213560792c25c170546fbe7a43f37c19e48aa6a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7213560792c25c170546fbe7a43f37c19e48aa6a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf136cd3507a5e929cff8d03179c0f6d96bdb687", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf136cd3507a5e929cff8d03179c0f6d96bdb687", "html_url": "https://github.com/rust-lang/rust/commit/cf136cd3507a5e929cff8d03179c0f6d96bdb687", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf136cd3507a5e929cff8d03179c0f6d96bdb687/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bdc1bfd8f1740461d2ee39ba41f5245ed8913a2a", "url": "https://api.github.com/repos/rust-lang/rust/commits/bdc1bfd8f1740461d2ee39ba41f5245ed8913a2a", "html_url": "https://github.com/rust-lang/rust/commit/bdc1bfd8f1740461d2ee39ba41f5245ed8913a2a"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "017593f387e234f6f34f4ee528b797e6cdd1eceb", "filename": "src/librustc_trans/trans/common.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf136cd3507a5e929cff8d03179c0f6d96bdb687/src%2Flibrustc_trans%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf136cd3507a5e929cff8d03179c0f6d96bdb687/src%2Flibrustc_trans%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fcommon.rs?ref=cf136cd3507a5e929cff8d03179c0f6d96bdb687", "patch": "@@ -992,7 +992,7 @@ pub fn fulfill_obligation<'a, 'tcx>(ccx: &CrateContext<'a, 'tcx>,\n let tcx = ccx.tcx();\n \n // Remove any references to regions; this helps improve caching.\n-let trait_ref = ty_fold::erase_regions(tcx, trait_ref);\n+let trait_ref = erase_regions(tcx, &trait_ref);\n \n // First check the cache.\n match ccx.trait_cache().borrow().get(&trait_ref) {"}, {"sha": "a35bae07da09a647034e309114b98f861bf16cb3", "filename": "src/librustc_trans/trans/monomorphize.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf136cd3507a5e929cff8d03179c0f6d96bdb687/src%2Flibrustc_trans%2Ftrans%2Fmonomorphize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf136cd3507a5e929cff8d03179c0f6d96bdb687/src%2Flibrustc_trans%2Ftrans%2Fmonomorphize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fmonomorphize.rs?ref=cf136cd3507a5e929cff8d03179c0f6d96bdb687", "patch": "@@ -315,8 +315,10 @@ pub fn normalize_associated_type<'tcx,T>(tcx: &ty::ctxt<'tcx>, value: &T) -> T\n {\n     debug!(\"normalize_associated_type(t={})\", value.repr(tcx));\n \n+    let value = erase_regions(tcx, value);\n+\n     if !value.has_projection_types() {\n-        return value.clone();\n+        return value;\n     }\n \n     // FIXME(#20304) -- cache\n@@ -326,7 +328,7 @@ pub fn normalize_associated_type<'tcx,T>(tcx: &ty::ctxt<'tcx>, value: &T) -> T\n     let mut selcx = traits::SelectionContext::new(&infcx, &typer);\n     let cause = traits::ObligationCause::dummy();\n     let traits::Normalized { value: result, obligations } =\n-        traits::normalize(&mut selcx, cause, value);\n+        traits::normalize(&mut selcx, cause, &value);\n \n     debug!(\"normalize_associated_type: result={} obligations={}\",\n            result.repr(tcx),"}]}