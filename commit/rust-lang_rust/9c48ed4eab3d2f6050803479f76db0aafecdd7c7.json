{"sha": "9c48ed4eab3d2f6050803479f76db0aafecdd7c7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljNDhlZDRlYWIzZDJmNjA1MDgwMzQ3OWY3NmRiMGFhZmVjZGQ3Yzc=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-07-23T08:34:19Z"}, "committer": {"name": "Who? Me?!", "email": "mark-i-m@users.noreply.github.com", "date": "2019-07-23T20:36:51Z"}, "message": "more comments for toolstate scripts", "tree": {"sha": "3a53ce91b335f715a5e98703c66e88c006ed6139", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3a53ce91b335f715a5e98703c66e88c006ed6139"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c48ed4eab3d2f6050803479f76db0aafecdd7c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c48ed4eab3d2f6050803479f76db0aafecdd7c7", "html_url": "https://github.com/rust-lang/rust/commit/9c48ed4eab3d2f6050803479f76db0aafecdd7c7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c48ed4eab3d2f6050803479f76db0aafecdd7c7/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1aa10797df9ef70bd08011811d6a822a7b58e1a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/1aa10797df9ef70bd08011811d6a822a7b58e1a3", "html_url": "https://github.com/rust-lang/rust/commit/1aa10797df9ef70bd08011811d6a822a7b58e1a3"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "4fbb8c4d2034900dda85f48c5d4afa55b2834c4f", "filename": "src/ci/docker/x86_64-gnu-tools/checkregression.py", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9c48ed4eab3d2f6050803479f76db0aafecdd7c7/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fcheckregression.py", "raw_url": "https://github.com/rust-lang/rust/raw/9c48ed4eab3d2f6050803479f76db0aafecdd7c7/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fcheckregression.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fcheckregression.py?ref=9c48ed4eab3d2f6050803479f76db0aafecdd7c7", "patch": "@@ -1,10 +1,16 @@\n #!/usr/bin/env python\n # -*- coding: utf-8 -*-\n \n+## This script has two purposes: detect any tool that *regressed*, which is used\n+## during the week before the beta branches to reject PRs; and detect any tool\n+## that *changed* to see if we need to update the toolstate repo.\n+\n import sys\n import json\n \n-# Regressions for these tools do not cause failure.\n+# Regressions for these tools during the beta cutoff week do not cause failure.\n+# See `status_check` in `checktools.sh` for tools that have to pass on the\n+# beta/stable branches.\n REGRESSION_OK = [\"rustc-guide\", \"miri\", \"embedded-book\"]\n \n if __name__ == '__main__':"}, {"sha": "db10c84a9977c3cde624bf10609329b67e05b92c", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9c48ed4eab3d2f6050803479f76db0aafecdd7c7/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/9c48ed4eab3d2f6050803479f76db0aafecdd7c7/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=9c48ed4eab3d2f6050803479f76db0aafecdd7c7", "patch": "@@ -79,6 +79,9 @@ check_dispatch() {\n # List all tools here.\n # This function gets called with \"submodule_changed\" for each PR that changed a submodule,\n # and with \"beta_required\" for each PR that lands on beta/stable.\n+# The purpose of this function is to *reject* PRs if a tool is not \"test-pass\" and\n+# (a) the tool's submodule has been updated, or (b) we landed on beta/stable and the\n+# tool has to \"test-pass\" on that branch.\n status_check() {\n     check_dispatch $1 beta book src/doc/book\n     check_dispatch $1 beta nomicon src/doc/nomicon\n@@ -88,8 +91,10 @@ status_check() {\n     check_dispatch $1 beta rls src/tools/rls\n     check_dispatch $1 beta rustfmt src/tools/rustfmt\n     check_dispatch $1 beta clippy-driver src/tools/clippy\n-    # These tools are not required on the beta/stable branches.\n-    # They will still cause failure during the beta cutoff week, see `checkregression.py` for that.\n+    # These tools are not required on the beta/stable branches, but they *do* cause\n+    # PRs to fail if a submodule update does not fix them.\n+    # They will still cause failure during the beta cutoff week, unless `checkregression.py`\n+    # exempts them from that.\n     check_dispatch $1 nightly miri src/tools/miri\n     check_dispatch $1 nightly embedded-book src/doc/embedded-book\n }"}]}