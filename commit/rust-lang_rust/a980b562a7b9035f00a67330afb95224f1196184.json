{"sha": "a980b562a7b9035f00a67330afb95224f1196184", "node_id": "C_kwDOAAsO6NoAKGE5ODBiNTYyYTdiOTAzNWYwMGE2NzMzMGFmYjk1MjI0ZjExOTYxODQ", "commit": {"author": {"name": "hkalbasi", "email": "hamidrezakalbasi@protonmail.com", "date": "2023-03-10T10:14:07Z"}, "committer": {"name": "hkalbasi", "email": "hamidrezakalbasi@protonmail.com", "date": "2023-03-10T10:14:34Z"}, "message": "Fix stack overflow when derefrencing `&!`", "tree": {"sha": "1797ad2e7dc8287f6df8df2cde0f75dc772c956a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1797ad2e7dc8287f6df8df2cde0f75dc772c956a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a980b562a7b9035f00a67330afb95224f1196184", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a980b562a7b9035f00a67330afb95224f1196184", "html_url": "https://github.com/rust-lang/rust/commit/a980b562a7b9035f00a67330afb95224f1196184", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a980b562a7b9035f00a67330afb95224f1196184/comments", "author": {"login": "HKalbasi", "id": 45197576, "node_id": "MDQ6VXNlcjQ1MTk3NTc2", "avatar_url": "https://avatars.githubusercontent.com/u/45197576?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HKalbasi", "html_url": "https://github.com/HKalbasi", "followers_url": "https://api.github.com/users/HKalbasi/followers", "following_url": "https://api.github.com/users/HKalbasi/following{/other_user}", "gists_url": "https://api.github.com/users/HKalbasi/gists{/gist_id}", "starred_url": "https://api.github.com/users/HKalbasi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HKalbasi/subscriptions", "organizations_url": "https://api.github.com/users/HKalbasi/orgs", "repos_url": "https://api.github.com/users/HKalbasi/repos", "events_url": "https://api.github.com/users/HKalbasi/events{/privacy}", "received_events_url": "https://api.github.com/users/HKalbasi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "HKalbasi", "id": 45197576, "node_id": "MDQ6VXNlcjQ1MTk3NTc2", "avatar_url": "https://avatars.githubusercontent.com/u/45197576?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HKalbasi", "html_url": "https://github.com/HKalbasi", "followers_url": "https://api.github.com/users/HKalbasi/followers", "following_url": "https://api.github.com/users/HKalbasi/following{/other_user}", "gists_url": "https://api.github.com/users/HKalbasi/gists{/gist_id}", "starred_url": "https://api.github.com/users/HKalbasi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HKalbasi/subscriptions", "organizations_url": "https://api.github.com/users/HKalbasi/orgs", "repos_url": "https://api.github.com/users/HKalbasi/repos", "events_url": "https://api.github.com/users/HKalbasi/events{/privacy}", "received_events_url": "https://api.github.com/users/HKalbasi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b5bba45354f639fc55c82c8267902ad79cde6ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b5bba45354f639fc55c82c8267902ad79cde6ca", "html_url": "https://github.com/rust-lang/rust/commit/1b5bba45354f639fc55c82c8267902ad79cde6ca"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "6a29e8ce52e62bfbd75f91ac2e52f0d8bd7374d3", "filename": "crates/hir-ty/src/consteval/tests.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fhir-ty%2Fsrc%2Fconsteval%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fhir-ty%2Fsrc%2Fconsteval%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fconsteval%2Ftests.rs?ref=a980b562a7b9035f00a67330afb95224f1196184", "patch": "@@ -146,6 +146,22 @@ fn reference_autoderef() {\n     \"#,\n         3,\n     );\n+    check_number(\n+        r#\"\n+    struct Foo<T> { x: T }\n+    impl<T> Foo<T> {\n+        fn foo(&mut self) -> T { self.x }\n+    }\n+    fn f(i: &mut &mut Foo<Foo<i32>>) -> i32 {\n+        ((**i).x).foo()\n+    }\n+    fn g(i: Foo<Foo<i32>>) -> i32 {\n+        i.x.foo()\n+    }\n+    const GOAL: i32 = f(&mut &mut Foo { x: Foo { x: 3 } }) + g(Foo { x: Foo { x: 5 } });\n+    \"#,\n+        8,\n+    );\n }\n \n #[test]"}, {"sha": "435a914088bcf5313376db47a42900d565a4c65f", "filename": "crates/hir-ty/src/mir/lower.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower.rs?ref=a980b562a7b9035f00a67330afb95224f1196184", "patch": "@@ -637,7 +637,7 @@ impl MirLowerCtx<'_> {\n             }\n             Expr::Box { .. } => not_supported!(\"box expression\"),\n             Expr::Field { .. } | Expr::Index { .. } | Expr::UnaryOp { op: hir_def::expr::UnaryOp::Deref, .. } => {\n-                let Some((p, current)) = self.lower_expr_as_place(current, expr_id, true)? else {\n+                let Some((p, current)) = self.lower_expr_as_place_without_adjust(current, expr_id, true)? else {\n                     return Ok(None);\n                 };\n                 self.push_assignment(current, place, Operand::Copy(p).into(), expr_id.into());"}, {"sha": "fe8147dcd3e7af51f5865289ebabe903023b45af", "filename": "crates/hir-ty/src/mir/lower/as_place.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower%2Fas_place.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower%2Fas_place.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower%2Fas_place.rs?ref=a980b562a7b9035f00a67330afb95224f1196184", "patch": "@@ -110,7 +110,7 @@ impl MirLowerCtx<'_> {\n         }\n     }\n \n-    fn lower_expr_as_place_without_adjust(\n+    pub(super) fn lower_expr_as_place_without_adjust(\n         &mut self,\n         current: BasicBlockId,\n         expr_id: ExprId,"}, {"sha": "84189a5d560f97b9291ad471a2ef4e735100ad65", "filename": "crates/ide-diagnostics/src/handlers/mutability_errors.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a980b562a7b9035f00a67330afb95224f1196184/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmutability_errors.rs?ref=a980b562a7b9035f00a67330afb95224f1196184", "patch": "@@ -336,6 +336,18 @@ fn main() {\n         );\n     }\n \n+    #[test]\n+    fn regression_14310() {\n+        check_diagnostics(\n+            r#\"\n+            fn clone(mut i: &!) -> ! {\n+                   //^^^^^ \ud83d\udca1 weak: variable does not need to be mutable\n+                *i\n+            }\n+        \"#,\n+        );\n+    }\n+\n     #[test]\n     fn match_bindings() {\n         check_diagnostics("}]}