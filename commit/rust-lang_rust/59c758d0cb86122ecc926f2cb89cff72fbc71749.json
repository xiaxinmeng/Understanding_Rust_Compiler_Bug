{"sha": "59c758d0cb86122ecc926f2cb89cff72fbc71749", "node_id": "C_kwDOAAsO6NoAKDU5Yzc1OGQwY2I4NjEyMmVjYzkyNmYyY2I4OWNmZjcyZmJjNzE3NDk", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-10-02T07:08:48Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-02T07:08:48Z"}, "message": "Merge #10422\n\n10422: fix: overwrite files when calling `patchelf` r=lnicola a=lnicola\n\nFixes #10379\r\n\r\nbors r+\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "888cca485b75bd0163e3ed96766f9052766329ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/888cca485b75bd0163e3ed96766f9052766329ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59c758d0cb86122ecc926f2cb89cff72fbc71749", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhWAWACRBK7hj4Ov3rIwAAXK0IAEd8TR4b+Tfa6Vcn/6MxF7E2\n5YcdWqHrAWziUT86tBXIvX1FDSsM58YXPbpMFFw0BLctG0OWiYRstVQY7aeibU1D\n2bB9w596hMxs21tLT5If538y/DppJBzJNporlxcs/njwjASRYG/cx4VTbXsFjSWa\ndxaD1hCJCPYNDvHucmFaFI826pSxpYVwU0D5vYLuf3CtgJqE0ECgJoZnRXD8+iFq\n/AbS0vLJWWFARwniRJ2jev1oV1uDgYfVkrEEGbhwqgm+SYaUVyEXRAcMaE7rZVbp\n8bniFz+DemEixY4WqSjcR58jY3ZzHB1+Sx5YTkiQ0V/c2ZNG5U0eNrAdI6cmlDE=\n=9YKb\n-----END PGP SIGNATURE-----\n", "payload": "tree 888cca485b75bd0163e3ed96766f9052766329ad\nparent 237ea0d34dced3444486931f68e87cd07f52b6a8\nparent 502fa1755a50dd340c888500aebc2cb1a8dbc6bd\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1633158528 +0000\ncommitter GitHub <noreply@github.com> 1633158528 +0000\n\nMerge #10422\n\n10422: fix: overwrite files when calling `patchelf` r=lnicola a=lnicola\n\nFixes #10379\r\n\r\nbors r+\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59c758d0cb86122ecc926f2cb89cff72fbc71749", "html_url": "https://github.com/rust-lang/rust/commit/59c758d0cb86122ecc926f2cb89cff72fbc71749", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59c758d0cb86122ecc926f2cb89cff72fbc71749/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "237ea0d34dced3444486931f68e87cd07f52b6a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/237ea0d34dced3444486931f68e87cd07f52b6a8", "html_url": "https://github.com/rust-lang/rust/commit/237ea0d34dced3444486931f68e87cd07f52b6a8"}, {"sha": "502fa1755a50dd340c888500aebc2cb1a8dbc6bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/502fa1755a50dd340c888500aebc2cb1a8dbc6bd", "html_url": "https://github.com/rust-lang/rust/commit/502fa1755a50dd340c888500aebc2cb1a8dbc6bd"}], "stats": {"total": 33, "additions": 18, "deletions": 15}, "files": [{"sha": "f69b7fdf566e9d4f1f2943c868e673b58bd1098b", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 18, "deletions": 15, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/59c758d0cb86122ecc926f2cb89cff72fbc71749/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/59c758d0cb86122ecc926f2cb89cff72fbc71749/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=59c758d0cb86122ecc926f2cb89cff72fbc71749", "patch": "@@ -286,21 +286,24 @@ async function patchelf(dest: vscode.Uri): Promise<void> {\n                 }\n             `;\n             const origFile = vscode.Uri.file(dest.fsPath + \"-orig\");\n-            await vscode.workspace.fs.rename(dest, origFile);\n-            progress.report({ message: \"Patching executable\", increment: 20 });\n-            await new Promise((resolve, reject) => {\n-                const handle = exec(`nix-build -E - --argstr srcStr '${origFile.fsPath}' -o '${dest.fsPath}'`,\n-                    (err, stdout, stderr) => {\n-                        if (err != null) {\n-                            reject(Error(stderr));\n-                        } else {\n-                            resolve(stdout);\n-                        }\n-                    });\n-                handle.stdin?.write(expression);\n-                handle.stdin?.end();\n-            });\n-            await vscode.workspace.fs.delete(origFile);\n+            await vscode.workspace.fs.rename(dest, origFile, { overwrite: true });\n+            try {\n+                progress.report({ message: \"Patching executable\", increment: 20 });\n+                await new Promise((resolve, reject) => {\n+                    const handle = exec(`nix-build -E - --argstr srcStr '${origFile.fsPath}' -o '${dest.fsPath}'`,\n+                        (err, stdout, stderr) => {\n+                            if (err != null) {\n+                                reject(Error(stderr));\n+                            } else {\n+                                resolve(stdout);\n+                            }\n+                        });\n+                    handle.stdin?.write(expression);\n+                    handle.stdin?.end();\n+                });\n+            } finally {\n+                await vscode.workspace.fs.delete(origFile);\n+            }\n         }\n     );\n }"}]}