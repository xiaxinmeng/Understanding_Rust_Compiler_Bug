{"sha": "2c9b91ad326c387190bedab9dae9d08d3eb0705a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjOWI5MWFkMzI2YzM4NzE5MGJlZGFiOWRhZTlkMDhkM2ViMDcwNWE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-17T18:07:30Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-17T18:07:30Z"}, "message": "Merge ra_vfs_glob and ra_lsp_server", "tree": {"sha": "33542cd2b44bd5290f18baebee460b487008035a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33542cd2b44bd5290f18baebee460b487008035a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2c9b91ad326c387190bedab9dae9d08d3eb0705a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2c9b91ad326c387190bedab9dae9d08d3eb0705a", "html_url": "https://github.com/rust-lang/rust/commit/2c9b91ad326c387190bedab9dae9d08d3eb0705a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2c9b91ad326c387190bedab9dae9d08d3eb0705a/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "659b0e73cfd9ef7755d032f90622a08576f1d86d", "url": "https://api.github.com/repos/rust-lang/rust/commits/659b0e73cfd9ef7755d032f90622a08576f1d86d", "html_url": "https://github.com/rust-lang/rust/commit/659b0e73cfd9ef7755d032f90622a08576f1d86d"}], "stats": {"total": 38, "additions": 12, "deletions": 26}, "files": [{"sha": "c22cbca3a36360faa68860d5f007c9cd6fa1e9b5", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -1102,6 +1102,7 @@ dependencies = [\n  \"crossbeam-channel\",\n  \"either\",\n  \"env_logger\",\n+ \"globset\",\n  \"itertools\",\n  \"jod-thread\",\n  \"log\",\n@@ -1120,7 +1121,6 @@ dependencies = [\n  \"ra_syntax\",\n  \"ra_text_edit\",\n  \"ra_vfs\",\n- \"ra_vfs_glob\",\n  \"rand\",\n  \"relative-path\",\n  \"rustc-hash\",\n@@ -1227,14 +1227,6 @@ dependencies = [\n  \"walkdir\",\n ]\n \n-[[package]]\n-name = \"ra_vfs_glob\"\n-version = \"0.1.0\"\n-dependencies = [\n- \"globset\",\n- \"ra_vfs\",\n-]\n-\n [[package]]\n name = \"rand\"\n version = \"0.7.3\""}, {"sha": "da523ba8a2336612d731de0ccbda9592b71952bd", "filename": "crates/ra_lsp_server/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2FCargo.toml?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -12,6 +12,7 @@ anyhow = \"1.0\"\n crossbeam-channel = \"0.4\"\n either = \"1.5\"\n env_logger = { version = \"0.7.1\", default-features = false }\n+globset = \"0.4.4\"\n itertools = \"0.8.0\"\n jod-thread = \"0.1.0\"\n log = \"0.4.3\"\n@@ -33,7 +34,6 @@ ra_project_model = { path = \"../ra_project_model\" }\n ra_syntax = { path = \"../ra_syntax\" }\n ra_text_edit = { path = \"../ra_text_edit\" }\n ra_vfs = \"0.5.0\"\n-ra_vfs_glob = { path = \"../ra_vfs_glob\" }\n \n # This should only be used in CLI\n ra_db = { path = \"../ra_db\" }"}, {"sha": "89e2139cec2dbdfdf85d49f3444f4e2922179234", "filename": "crates/ra_lsp_server/src/args.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fargs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fargs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fargs.rs?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -1,3 +1,8 @@\n+//! Command like parsing for rust-analyzer.\n+//!\n+//! If run started args, we run the LSP server loop. With a subcommand, we do a\n+//! one-time batch processing.\n+\n use anyhow::{bail, Result};\n use pico_args::Arguments;\n use ra_lsp_server::cli::{BenchWhat, Position, Verbosity};"}, {"sha": "bb3e1513b87f5b884e832db0b5514392dbe810e8", "filename": "crates/ra_lsp_server/src/cli/load_cargo.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fcli%2Fload_cargo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fcli%2Fload_cargo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fcli%2Fload_cargo.rs?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -7,9 +7,10 @@ use ra_db::{CrateGraph, FileId, SourceRootId};\n use ra_ide::{AnalysisChange, AnalysisHost, FeatureFlags};\n use ra_project_model::{get_rustc_cfg_options, PackageRoot, ProjectWorkspace};\n use ra_vfs::{RootEntry, Vfs, VfsChange, VfsTask, Watch};\n-use ra_vfs_glob::RustPackageFilterBuilder;\n use rustc_hash::FxHashMap;\n \n+use crate::vfs_glob::RustPackageFilterBuilder;\n+\n use anyhow::Result;\n \n fn vfs_file_to_id(f: ra_vfs::VfsFile) -> FileId {"}, {"sha": "958c70fe5fac47f989a98cd29688999c7986cdb1", "filename": "crates/ra_lsp_server/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Flib.rs?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -23,6 +23,7 @@ macro_rules! print {\n     };\n }\n \n+mod vfs_glob;\n mod caps;\n mod cargo_target_spec;\n mod conv;"}, {"sha": "944074118df494c6e905d49e293b2d86937aa31a", "filename": "crates/ra_lsp_server/src/main_loop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -135,7 +135,7 @@ pub fn main_loop(\n         let globs = config\n             .exclude_globs\n             .iter()\n-            .map(|glob| ra_vfs_glob::Glob::new(glob))\n+            .map(|glob| crate::vfs_glob::Glob::new(glob))\n             .collect::<std::result::Result<Vec<_>, _>>()?;\n \n         if config.use_client_watching {"}, {"sha": "12401d75a82d2feed80b0dc438e1ba4c36921636", "filename": "crates/ra_lsp_server/src/vfs_glob.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fvfs_glob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fvfs_glob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fvfs_glob.rs?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "previous_filename": "crates/ra_vfs_glob/src/lib.rs"}, {"sha": "71c95d4af0037faf30354c45e86bb480243e011c", "filename": "crates/ra_lsp_server/src/world.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fworld.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/crates%2Fra_lsp_server%2Fsrc%2Fworld.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fworld.rs?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -19,12 +19,12 @@ use ra_ide::{\n };\n use ra_project_model::{get_rustc_cfg_options, ProjectWorkspace};\n use ra_vfs::{LineEndings, RootEntry, Vfs, VfsChange, VfsFile, VfsRoot, VfsTask, Watch};\n-use ra_vfs_glob::{Glob, RustPackageFilterBuilder};\n use relative_path::RelativePathBuf;\n \n use crate::{\n     diagnostics::{CheckFixes, DiagnosticCollection},\n     main_loop::pending_requests::{CompletedRequest, LatestRequests},\n+    vfs_glob::{Glob, RustPackageFilterBuilder},\n     LspError, Result,\n };\n "}, {"sha": "094d6d6f440bbb615c922f8abdc97cf0bfb64242", "filename": "crates/ra_vfs_glob/Cargo.toml", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/659b0e73cfd9ef7755d032f90622a08576f1d86d/crates%2Fra_vfs_glob%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/659b0e73cfd9ef7755d032f90622a08576f1d86d/crates%2Fra_vfs_glob%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_vfs_glob%2FCargo.toml?ref=659b0e73cfd9ef7755d032f90622a08576f1d86d", "patch": "@@ -1,12 +0,0 @@\n-[package]\n-edition = \"2018\"\n-name = \"ra_vfs_glob\"\n-version = \"0.1.0\"\n-authors = [\"rust-analyzer developers\"]\n-\n-[lib]\n-doctest = false\n-\n-[dependencies]\n-ra_vfs = \"0.5.0\"\n-globset = \"0.4.4\""}, {"sha": "b2571df25825a21a7ee4ceacebf6b2b036736613", "filename": "xtask/tests/tidy-tests/docs.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2c9b91ad326c387190bedab9dae9d08d3eb0705a/xtask%2Ftests%2Ftidy-tests%2Fdocs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c9b91ad326c387190bedab9dae9d08d3eb0705a/xtask%2Ftests%2Ftidy-tests%2Fdocs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Ftests%2Ftidy-tests%2Fdocs.rs?ref=2c9b91ad326c387190bedab9dae9d08d3eb0705a", "patch": "@@ -73,7 +73,6 @@ fn no_docs_comments() {\n     }\n \n     let whitelist = [\n-        \"ra_cli\",\n         \"ra_db\",\n         \"ra_hir\",\n         \"ra_hir_expand\","}]}