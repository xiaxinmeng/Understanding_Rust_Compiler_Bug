{"sha": "3827b6451c8cfbab9ec1f21bb385eabfede74022", "node_id": "C_kwDOAAsO6NoAKDM4MjdiNjQ1MWM4Y2ZiYWI5ZWMxZjIxYmIzODVlYWJmZWRlNzQwMjI", "commit": {"author": {"name": "Tom Farmer", "email": "tfarmer7980@gmail.com", "date": "2021-10-09T12:13:15Z"}, "committer": {"name": "Tom Farmer", "email": "tfarmer7980@gmail.com", "date": "2021-12-03T18:38:32Z"}, "message": "Update invalid crate attributes, add help message\n\ntidy run\n\nupdate invalid crate attributes, improve error\n\nupdate test outputs\n\nde-capitalise error\n\nupdate tests\n\nUpdate invalid crate attributes, add help message\n\nUpdate - generate span without using BytePos\n\nAdd correct dependancies\n\nUpdate - generate suggestion without BytePos\n\nTidy run\n\nupdate tests\n\nGenerate Suggestion without BytePos\n\nAdd all builtin attributes\n\nadd err builtin inner attr at top of crate\n\nfix tests\n\nadd err builtin inner attr at top of crate\n\ntidy fix\n\nadd err builtin inner attr at top of crate", "tree": {"sha": "7ef71bd9666d88cb19f57a201ec2b4a9f7e1b2af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ef71bd9666d88cb19f57a201ec2b4a9f7e1b2af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3827b6451c8cfbab9ec1f21bb385eabfede74022", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3827b6451c8cfbab9ec1f21bb385eabfede74022", "html_url": "https://github.com/rust-lang/rust/commit/3827b6451c8cfbab9ec1f21bb385eabfede74022", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3827b6451c8cfbab9ec1f21bb385eabfede74022/comments", "author": {"login": "tom7980", "id": 8884102, "node_id": "MDQ6VXNlcjg4ODQxMDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8884102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tom7980", "html_url": "https://github.com/tom7980", "followers_url": "https://api.github.com/users/tom7980/followers", "following_url": "https://api.github.com/users/tom7980/following{/other_user}", "gists_url": "https://api.github.com/users/tom7980/gists{/gist_id}", "starred_url": "https://api.github.com/users/tom7980/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tom7980/subscriptions", "organizations_url": "https://api.github.com/users/tom7980/orgs", "repos_url": "https://api.github.com/users/tom7980/repos", "events_url": "https://api.github.com/users/tom7980/events{/privacy}", "received_events_url": "https://api.github.com/users/tom7980/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tom7980", "id": 8884102, "node_id": "MDQ6VXNlcjg4ODQxMDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8884102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tom7980", "html_url": "https://github.com/tom7980", "followers_url": "https://api.github.com/users/tom7980/followers", "following_url": "https://api.github.com/users/tom7980/following{/other_user}", "gists_url": "https://api.github.com/users/tom7980/gists{/gist_id}", "starred_url": "https://api.github.com/users/tom7980/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tom7980/subscriptions", "organizations_url": "https://api.github.com/users/tom7980/orgs", "repos_url": "https://api.github.com/users/tom7980/repos", "events_url": "https://api.github.com/users/tom7980/events{/privacy}", "received_events_url": "https://api.github.com/users/tom7980/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a9e0831d6603d87220cedd1b1293e2eb82ef55c", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a9e0831d6603d87220cedd1b1293e2eb82ef55c", "html_url": "https://github.com/rust-lang/rust/commit/2a9e0831d6603d87220cedd1b1293e2eb82ef55c"}], "stats": {"total": 226, "additions": 213, "deletions": 13}, "files": [{"sha": "49e6a7df103012e7f773ca32555d05ff899fa08d", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 30, "deletions": 6, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -1953,28 +1953,52 @@ fn is_c_like_enum(item: &Item<'_>) -> bool {\n     }\n }\n \n+// FIXME: Fix \"Cannot determine resolution\" error and remove built-in macros\n+// from this check.\n fn check_invalid_crate_level_attr(tcx: TyCtxt<'_>, attrs: &[Attribute]) {\n+    // Check for builtin attributes at the crate level\n+    // which were unsuccessfully resolved due to cannot determine\n+    // resolution for the attribute macro error.\n     const ATTRS_TO_CHECK: &[Symbol] = &[\n         sym::macro_export,\n         sym::repr,\n         sym::path,\n         sym::automatically_derived,\n         sym::start,\n         sym::rustc_main,\n+        sym::derive,\n+        sym::test,\n+        sym::test_case,\n+        sym::global_allocator,\n+        sym::bench,\n     ];\n \n     for attr in attrs {\n-        for attr_to_check in ATTRS_TO_CHECK {\n-            if attr.has_name(*attr_to_check) {\n-                tcx.sess\n-                    .struct_span_err(\n+        // This function should only be called with crate attributes\n+        // which are inner attributes always but lets check to make sure\n+        if attr.style == AttrStyle::Inner {\n+            for attr_to_check in ATTRS_TO_CHECK {\n+                if attr.has_name(*attr_to_check) {\n+                    let mut err = tcx.sess.struct_span_err(\n                         attr.span,\n                         &format!(\n                             \"`{}` attribute cannot be used at crate level\",\n                             attr_to_check.to_ident_string()\n                         ),\n-                    )\n-                    .emit();\n+                    );\n+                    // Only emit an error with a suggestion if we can create a\n+                    // string out of the attribute span\n+                    if let Ok(src) = tcx.sess.source_map().span_to_snippet(attr.span) {\n+                        let replacement = src.replace(\"#!\", \"#\");\n+                        err.span_suggestion_verbose(\n+                            attr.span,\n+                            \"perhaps you meant to use an outer attribute\",\n+                            replacement,\n+                            rustc_errors::Applicability::MachineApplicable,\n+                        );\n+                    }\n+                    err.emit()\n+                }\n             }\n         }\n     }"}, {"sha": "08f293d2ebb06150d38ab7e6561fdc8e672b6d87", "filename": "src/test/ui/derives/issue-36617.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fderives%2Fissue-36617.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fderives%2Fissue-36617.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fderives%2Fissue-36617.rs?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -1,3 +1,16 @@\n #![derive(Copy)] //~ ERROR cannot determine resolution for the attribute macro `derive`\n+//~^ ERROR `derive` attribute cannot be used at crate level\n+\n+#![test]//~ ERROR cannot determine resolution for the attribute macro `test`\n+//~^ ERROR `test` attribute cannot be used at crate level\n+\n+#![test_case]//~ ERROR cannot determine resolution for the attribute macro `test_case`\n+//~^ ERROR `test_case` attribute cannot be used at crate level\n+\n+#![bench]//~ ERROR cannot determine resolution for the attribute macro `bench`\n+//~^ ERROR `bench` attribute cannot be used at crate level\n+\n+#![global_allocator]//~ ERROR cannot determine resolution for the attribute macro `global_allocator`\n+//~^ ERROR `global_allocator` attribute cannot be used at crate level\n \n fn main() {}"}, {"sha": "9cc0a29b0651db9c487e9005183318d70775b98e", "filename": "src/test/ui/derives/issue-36617.stderr", "status": "modified", "additions": 88, "deletions": 1, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fderives%2Fissue-36617.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fderives%2Fissue-36617.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fderives%2Fissue-36617.stderr?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -6,5 +6,92 @@ LL | #![derive(Copy)]\n    |\n    = note: import resolution is stuck, try simplifying macro imports\n \n-error: aborting due to previous error\n+error: cannot determine resolution for the attribute macro `test`\n+  --> $DIR/issue-36617.rs:4:4\n+   |\n+LL | #![test]\n+   |    ^^^^\n+   |\n+   = note: import resolution is stuck, try simplifying macro imports\n+\n+error: cannot determine resolution for the attribute macro `test_case`\n+  --> $DIR/issue-36617.rs:7:4\n+   |\n+LL | #![test_case]\n+   |    ^^^^^^^^^\n+   |\n+   = note: import resolution is stuck, try simplifying macro imports\n+\n+error: cannot determine resolution for the attribute macro `bench`\n+  --> $DIR/issue-36617.rs:10:4\n+   |\n+LL | #![bench]\n+   |    ^^^^^\n+   |\n+   = note: import resolution is stuck, try simplifying macro imports\n+\n+error: cannot determine resolution for the attribute macro `global_allocator`\n+  --> $DIR/issue-36617.rs:13:4\n+   |\n+LL | #![global_allocator]\n+   |    ^^^^^^^^^^^^^^^^\n+   |\n+   = note: import resolution is stuck, try simplifying macro imports\n+\n+error: `derive` attribute cannot be used at crate level\n+  --> $DIR/issue-36617.rs:1:1\n+   |\n+LL | #![derive(Copy)]\n+   | ^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[derive(Copy)]\n+   | ~~~~~~~~~~~~~~~\n+\n+error: `test` attribute cannot be used at crate level\n+  --> $DIR/issue-36617.rs:4:1\n+   |\n+LL | #![test]\n+   | ^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[test]\n+   | ~~~~~~~\n+\n+error: `test_case` attribute cannot be used at crate level\n+  --> $DIR/issue-36617.rs:7:1\n+   |\n+LL | #![test_case]\n+   | ^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[test_case]\n+   | ~~~~~~~~~~~~\n+\n+error: `bench` attribute cannot be used at crate level\n+  --> $DIR/issue-36617.rs:10:1\n+   |\n+LL | #![bench]\n+   | ^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[bench]\n+   | ~~~~~~~~\n+\n+error: `global_allocator` attribute cannot be used at crate level\n+  --> $DIR/issue-36617.rs:13:1\n+   |\n+LL | #![global_allocator]\n+   | ^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[global_allocator]\n+   | ~~~~~~~~~~~~~~~~~~~\n+\n+error: aborting due to 10 previous errors\n "}, {"sha": "796325b79af66cf6b60c4ba6c9ed09029baf2609", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-bench.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-bench.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-bench.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-bench.rs?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -6,5 +6,5 @@\n \n #![bench                   = \"4100\"]\n //~^ ERROR cannot determine resolution for the attribute macro `bench`\n-\n+//~^^ ERROR `bench` attribute cannot be used at crate level\n fn main() {}"}, {"sha": "6b33221194221263fd467ce61739a55ad0d048c4", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-bench.stderr", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-bench.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-bench.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-bench.stderr?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -6,5 +6,16 @@ LL | #![bench                   = \"4100\"]\n    |\n    = note: import resolution is stuck, try simplifying macro imports\n \n-error: aborting due to previous error\n+error: `bench` attribute cannot be used at crate level\n+  --> $DIR/issue-43106-gating-of-bench.rs:7:1\n+   |\n+LL | #![bench                   = \"4100\"]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[bench                   = \"4100\"]\n+   |\n+\n+error: aborting due to 2 previous errors\n "}, {"sha": "f94ec7d47041b38141d798b4e5864abe42056a85", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-builtin-attrs-error.stderr", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-builtin-attrs-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-builtin-attrs-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-builtin-attrs-error.stderr?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -129,36 +129,66 @@ error: `macro_export` attribute cannot be used at crate level\n    |\n LL | #![macro_export]\n    | ^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[macro_export]\n+   |\n \n error: `rustc_main` attribute cannot be used at crate level\n   --> $DIR/issue-43106-gating-of-builtin-attrs-error.rs:14:1\n    |\n LL | #![rustc_main]\n    | ^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[rustc_main]\n+   | ~~~~~~~~~~~~~\n \n error: `start` attribute cannot be used at crate level\n   --> $DIR/issue-43106-gating-of-builtin-attrs-error.rs:16:1\n    |\n LL | #![start]\n    | ^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[start]\n+   |\n \n error: `repr` attribute cannot be used at crate level\n   --> $DIR/issue-43106-gating-of-builtin-attrs-error.rs:18:1\n    |\n LL | #![repr()]\n    | ^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[repr()]\n+   |\n \n error: `path` attribute cannot be used at crate level\n   --> $DIR/issue-43106-gating-of-builtin-attrs-error.rs:20:1\n    |\n LL | #![path = \"3800\"]\n    | ^^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[path = \"3800\"]\n+   |\n \n error: `automatically_derived` attribute cannot be used at crate level\n   --> $DIR/issue-43106-gating-of-builtin-attrs-error.rs:22:1\n    |\n LL | #![automatically_derived]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[automatically_derived]\n+   |\n \n error[E0518]: attribute should be applied to function or closure\n   --> $DIR/issue-43106-gating-of-builtin-attrs-error.rs:36:17"}, {"sha": "39835c9268eef89324b9af59ca0f8aae0547e605", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-test.rs?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -3,5 +3,5 @@\n #![allow(soft_unstable)]\n #![test                    = \"4200\"]\n //~^ ERROR cannot determine resolution for the attribute macro `test`\n-\n+//~^^ ERROR `test` attribute cannot be used at crate level\n fn main() {}"}, {"sha": "300a9966dd880910dc9253d59e5a9cc725011996", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-test.stderr", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-test.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-test.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-test.stderr?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -6,5 +6,16 @@ LL | #![test                    = \"4200\"]\n    |\n    = note: import resolution is stuck, try simplifying macro imports\n \n-error: aborting due to previous error\n+error: `test` attribute cannot be used at crate level\n+  --> $DIR/issue-43106-gating-of-test.rs:4:1\n+   |\n+LL | #![test                    = \"4200\"]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[test                    = \"4200\"]\n+   |\n+\n+error: aborting due to 2 previous errors\n "}, {"sha": "ef2a5d634a678a00a21d49fd3880740b161067b1", "filename": "src/test/ui/imports/issue-28134.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fimports%2Fissue-28134.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fimports%2Fissue-28134.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-28134.rs?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -2,3 +2,4 @@\n \n #![allow(soft_unstable)]\n #![test] //~ ERROR cannot determine resolution for the attribute macro `test`\n+//~^ ERROR 4:1: 4:9: `test` attribute cannot be used at crate level"}, {"sha": "33cb53f202a30d36ec655c578beb046d1ffd6607", "filename": "src/test/ui/imports/issue-28134.stderr", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fimports%2Fissue-28134.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fimports%2Fissue-28134.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-28134.stderr?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -6,5 +6,16 @@ LL | #![test]\n    |\n    = note: import resolution is stuck, try simplifying macro imports\n \n-error: aborting due to previous error\n+error: `test` attribute cannot be used at crate level\n+  --> $DIR/issue-28134.rs:4:1\n+   |\n+LL | #![test]\n+   | ^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[test]\n+   | ~~~~~~~\n+\n+error: aborting due to 2 previous errors\n "}, {"sha": "935bfa001bfc6135d16ccc49525c55da0a55ea2f", "filename": "src/test/ui/span/issue-43927-non-ADT-derive.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fspan%2Fissue-43927-non-ADT-derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fspan%2Fissue-43927-non-ADT-derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-43927-non-ADT-derive.rs?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -1,5 +1,6 @@\n #![derive(Debug, PartialEq, Eq)] // should be an outer attribute!\n //~^ ERROR cannot determine resolution for the attribute macro `derive`\n+//~^^ ERROR `derive` attribute cannot be used at crate level\n struct DerivedOn;\n \n fn main() {}"}, {"sha": "e3ae37e368937997a54090390628b6dbdab97723", "filename": "src/test/ui/span/issue-43927-non-ADT-derive.stderr", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fspan%2Fissue-43927-non-ADT-derive.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3827b6451c8cfbab9ec1f21bb385eabfede74022/src%2Ftest%2Fui%2Fspan%2Fissue-43927-non-ADT-derive.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-43927-non-ADT-derive.stderr?ref=3827b6451c8cfbab9ec1f21bb385eabfede74022", "patch": "@@ -6,5 +6,16 @@ LL | #![derive(Debug, PartialEq, Eq)] // should be an outer attribute!\n    |\n    = note: import resolution is stuck, try simplifying macro imports\n \n-error: aborting due to previous error\n+error: `derive` attribute cannot be used at crate level\n+  --> $DIR/issue-43927-non-ADT-derive.rs:1:1\n+   |\n+LL | #![derive(Debug, PartialEq, Eq)] // should be an outer attribute!\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+help: perhaps you meant to use an outer attribute\n+   |\n+LL | #[derive(Debug, PartialEq, Eq)] // should be an outer attribute!\n+   | ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+error: aborting due to 2 previous errors\n "}]}