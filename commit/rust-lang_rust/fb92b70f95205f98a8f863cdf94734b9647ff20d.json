{"sha": "fb92b70f95205f98a8f863cdf94734b9647ff20d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiOTJiNzBmOTUyMDVmOThhOGY4NjNjZGY5NDczNGI5NjQ3ZmYyMGQ=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-24T12:11:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-24T12:11:59Z"}, "message": "Rollup merge of #77716 - francesca64:revert-ios-dynamic-linking, r=jonas-schievink\n\nRevert \"Allow dynamic linking for iOS/tvOS targets.\"\n\nThis reverts PR #73516.\n\nOn macOS I compile static libs for iOS, automated using [cargo-mobile](https://github.com/BrainiumLLC/cargo-mobile), which has worked smoothly for the past 2 years. However, upon updating to Rust 1.46.0, I was no longer able to use Rust on iOS. I've bisected this to the PR referenced above.\n\nFor most projects tested, apps now immediately crash with a message like this:\n```\ndyld: Library not loaded: /Users/francesca/Projects/example/target/aarch64-apple-ios/debug/deps/libexample.dylib\n  Referenced from: /private/var/containers/Bundle/Application/745912AF-A928-465C-B340-872BD1C9F368/example.app/example\n  Reason: image not found\ndyld: launch, loading dependent libraries\nDYLD_LIBRARY_PATH=/usr/lib/system/introspection\nDYLD_INSERT_LIBRARIES=/Developer/usr/lib/libBacktraceRecording.dylib:/Developer/usr/lib/libMainThreadChecker.dylib:/Developer/Library/PrivateFrameworks/DTDDISupport.framework/libViewDebuggerSupport.dylib:/Developer/Library/PrivateFrameworks/GPUTools.framework/libglInterpose.dylib:/usr/lib/libMTLCapture.dylib\n```\n\nThis can be reproduced by using cargo-mobile to generate a winit example project, and then attempting to run it on an iOS device (`cargo mobile init && cargo apple open`).\n\nIn our projects that depend on DisplayLink, the build instead fails with a linker error:\n```\n= note: Undefined symbols for architecture arm64:\n            \"_CACurrentMediaTime\", referenced from:\n                display_link::ios::run_callback_ios10::hda81197ff46aedbd in libapp-4f0abc1d7684103f.rlib(app-4f0abc1d7684103f.40d4iro0yz1iy487.rcgu.o)\n                display_link::ios::run_callback_pre_ios10::h91f085da19374320 in libapp-4f0abc1d7684103f.rlib(app-4f0abc1d7684103f.40d4iro0yz1iy487.rcgu.o)\n          ld: symbol(s) not found for architecture arm64\n```\n\nAfter reverting the change to enable dynamic linking on iOS, everything works the same as it did on Rust 1.45.2 for me.\n\nIn the future, would it be possible for me to be pinged when iOS-related PRs are made? I work for a company that intends on using Rust on iOS in production, so I'd gladly provide testing.\n\ncc @aspenluxxxy", "tree": {"sha": "75bdf6a3ef22c1f1599b505b990e15d7ea37abed", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/75bdf6a3ef22c1f1599b505b990e15d7ea37abed"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb92b70f95205f98a8f863cdf94734b9647ff20d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJflBoQCRBK7hj4Ov3rIwAAdHIIABpVyhjQVAKqoeaUcygCEkkf\n/oR4sdBu9L7lymzD9fpbGL+V9tYVgBqtPGpVuAUwKLbVlQMHEUoTzea0MMSq7RQ2\nQKa9WXR9JoXqMECn+zJz0fF/QprLeAn5hX8yKuN8/VbAlHGM2lSxeNUljKJyO8hd\nvtGT2fPjAZ6LHIf1CSZyVkJ5jLMm++iEYOy3N8FzZnuKlTr5epCwzt2Eq+LocffG\n8aTAQL3sJmwrtyvlOPILXzSVTXzKO2HBGU9Ogboh//wFz3XwKf/+E6SLpq5NCUeK\nIxOWkNVwzBHCqAd+xyJ8AS4b8MyTh8rhy8unmxJHg3Y2MS0KG4KDpSWMCANyHsE=\n=7uI9\n-----END PGP SIGNATURE-----\n", "payload": "tree 75bdf6a3ef22c1f1599b505b990e15d7ea37abed\nparent d7c635b3a514159afd3a61064772ec17cc1c44c2\nparent 16e10bf81ee73f61cf813acef3d5dbbce4f66da2\nauthor Jonas Schievink <jonasschievink@gmail.com> 1603541519 +0200\ncommitter GitHub <noreply@github.com> 1603541519 +0200\n\nRollup merge of #77716 - francesca64:revert-ios-dynamic-linking, r=jonas-schievink\n\nRevert \"Allow dynamic linking for iOS/tvOS targets.\"\n\nThis reverts PR #73516.\n\nOn macOS I compile static libs for iOS, automated using [cargo-mobile](https://github.com/BrainiumLLC/cargo-mobile), which has worked smoothly for the past 2 years. However, upon updating to Rust 1.46.0, I was no longer able to use Rust on iOS. I've bisected this to the PR referenced above.\n\nFor most projects tested, apps now immediately crash with a message like this:\n```\ndyld: Library not loaded: /Users/francesca/Projects/example/target/aarch64-apple-ios/debug/deps/libexample.dylib\n  Referenced from: /private/var/containers/Bundle/Application/745912AF-A928-465C-B340-872BD1C9F368/example.app/example\n  Reason: image not found\ndyld: launch, loading dependent libraries\nDYLD_LIBRARY_PATH=/usr/lib/system/introspection\nDYLD_INSERT_LIBRARIES=/Developer/usr/lib/libBacktraceRecording.dylib:/Developer/usr/lib/libMainThreadChecker.dylib:/Developer/Library/PrivateFrameworks/DTDDISupport.framework/libViewDebuggerSupport.dylib:/Developer/Library/PrivateFrameworks/GPUTools.framework/libglInterpose.dylib:/usr/lib/libMTLCapture.dylib\n```\n\nThis can be reproduced by using cargo-mobile to generate a winit example project, and then attempting to run it on an iOS device (`cargo mobile init && cargo apple open`).\n\nIn our projects that depend on DisplayLink, the build instead fails with a linker error:\n```\n= note: Undefined symbols for architecture arm64:\n            \"_CACurrentMediaTime\", referenced from:\n                display_link::ios::run_callback_ios10::hda81197ff46aedbd in libapp-4f0abc1d7684103f.rlib(app-4f0abc1d7684103f.40d4iro0yz1iy487.rcgu.o)\n                display_link::ios::run_callback_pre_ios10::h91f085da19374320 in libapp-4f0abc1d7684103f.rlib(app-4f0abc1d7684103f.40d4iro0yz1iy487.rcgu.o)\n          ld: symbol(s) not found for architecture arm64\n```\n\nAfter reverting the change to enable dynamic linking on iOS, everything works the same as it did on Rust 1.45.2 for me.\n\nIn the future, would it be possible for me to be pinged when iOS-related PRs are made? I work for a company that intends on using Rust on iOS in production, so I'd gladly provide testing.\n\ncc @aspenluxxxy\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb92b70f95205f98a8f863cdf94734b9647ff20d", "html_url": "https://github.com/rust-lang/rust/commit/fb92b70f95205f98a8f863cdf94734b9647ff20d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb92b70f95205f98a8f863cdf94734b9647ff20d/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d7c635b3a514159afd3a61064772ec17cc1c44c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7c635b3a514159afd3a61064772ec17cc1c44c2", "html_url": "https://github.com/rust-lang/rust/commit/d7c635b3a514159afd3a61064772ec17cc1c44c2"}, {"sha": "16e10bf81ee73f61cf813acef3d5dbbce4f66da2", "url": "https://api.github.com/repos/rust-lang/rust/commits/16e10bf81ee73f61cf813acef3d5dbbce4f66da2", "html_url": "https://github.com/rust-lang/rust/commit/16e10bf81ee73f61cf813acef3d5dbbce4f66da2"}], "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "1b17c2c278f9abd9ff374f2daf85e6f0c730b53a", "filename": "compiler/rustc_target/src/spec/apple_sdk_base.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb92b70f95205f98a8f863cdf94734b9647ff20d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fapple_sdk_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb92b70f95205f98a8f863cdf94734b9647ff20d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fapple_sdk_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fapple_sdk_base.rs?ref=fb92b70f95205f98a8f863cdf94734b9647ff20d", "patch": "@@ -34,6 +34,7 @@ fn link_env_remove(arch: Arch) -> Vec<String> {\n pub fn opts(arch: Arch) -> TargetOptions {\n     TargetOptions {\n         cpu: target_cpu(arch),\n+        dynamic_linking: false,\n         executables: true,\n         link_env_remove: link_env_remove(arch),\n         has_elf_tls: false,"}]}