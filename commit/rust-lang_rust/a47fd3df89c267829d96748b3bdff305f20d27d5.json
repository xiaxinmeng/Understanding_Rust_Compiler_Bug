{"sha": "a47fd3df89c267829d96748b3bdff305f20d27d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE0N2ZkM2RmODljMjY3ODI5ZDk2NzQ4YjNiZGZmMzA1ZjIwZDI3ZDU=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-02-20T18:49:54Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-02-21T00:12:52Z"}, "message": "make `#[unwind]` attribute specify expectations more clearly\n\nYou can now choose between the following:\n\n- `#[unwind(allowed)]`\n- `#[unwind(aborts)]`\n\nPer rust-lang/rust#48251, the default is `#[unwind(allowed)]`, though\nI think we should change this eventually.", "tree": {"sha": "676d0df0845297a873c5e0a6620f464dea49a642", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/676d0df0845297a873c5e0a6620f464dea49a642"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a47fd3df89c267829d96748b3bdff305f20d27d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a47fd3df89c267829d96748b3bdff305f20d27d5", "html_url": "https://github.com/rust-lang/rust/commit/a47fd3df89c267829d96748b3bdff305f20d27d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a47fd3df89c267829d96748b3bdff305f20d27d5/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27a046e9338fb0455c33b13e8fe28da78212dedc", "url": "https://api.github.com/repos/rust-lang/rust/commits/27a046e9338fb0455c33b13e8fe28da78212dedc", "html_url": "https://github.com/rust-lang/rust/commit/27a046e9338fb0455c33b13e8fe28da78212dedc"}], "stats": {"total": 132, "additions": 113, "deletions": 19}, "files": [{"sha": "94db0baa3f95f883f9eb73855ce0c0ff24b939fa", "filename": "src/libcore/panicking.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibcore%2Fpanicking.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibcore%2Fpanicking.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fpanicking.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -64,7 +64,8 @@ pub fn panic_fmt(fmt: fmt::Arguments, file_line_col: &(&'static str, u32, u32))\n     #[allow(improper_ctypes)]\n     extern {\n         #[lang = \"panic_fmt\"]\n-        #[unwind]\n+        #[cfg_attr(stage0, unwind)]\n+        #[cfg_attr(not(stage0), unwind(allowed))]\n         fn panic_impl(fmt: fmt::Arguments, file: &'static str, line: u32, col: u32) -> !;\n     }\n     let (file, line, col) = *file_line_col;"}, {"sha": "ca2fd561cadcfcc75d9bb719cc5937fee4227b31", "filename": "src/libpanic_unwind/gcc.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Fgcc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Fgcc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Fgcc.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -286,7 +286,8 @@ unsafe fn find_eh_action(context: *mut uw::_Unwind_Context)\n // See docs in the `unwind` module.\n #[cfg(all(target_os=\"windows\", target_arch = \"x86\", target_env=\"gnu\"))]\n #[lang = \"eh_unwind_resume\"]\n-#[unwind]\n+#[cfg_attr(stage0, unwind)]\n+#[cfg_attr(not(stage0), unwind(allowed))]\n unsafe extern \"C\" fn rust_eh_unwind_resume(panic_ctx: *mut u8) -> ! {\n     uw::_Unwind_Resume(panic_ctx as *mut uw::_Unwind_Exception);\n }"}, {"sha": "a5cebc3e4d04b6eee6b74854f82d1146508878d9", "filename": "src/libpanic_unwind/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Flib.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -112,7 +112,8 @@ pub unsafe extern \"C\" fn __rust_maybe_catch_panic(f: fn(*mut u8),\n // Entry point for raising an exception, just delegates to the platform-specific\n // implementation.\n #[no_mangle]\n-#[unwind]\n+#[cfg_attr(stage0, unwind)]\n+#[cfg_attr(not(stage0), unwind(allowed))]\n pub unsafe extern \"C\" fn __rust_start_panic(data: usize, vtable: usize) -> u32 {\n     imp::panic(mem::transmute(raw::TraitObject {\n         data: data as *mut (),"}, {"sha": "090cd095380ee8dfcaffdaeb3600e664130105b3", "filename": "src/libpanic_unwind/seh64_gnu.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Fseh64_gnu.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Fseh64_gnu.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Fseh64_gnu.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -108,7 +108,8 @@ unsafe extern \"C\" fn rust_eh_personality(exceptionRecord: *mut c::EXCEPTION_RECO\n }\n \n #[lang = \"eh_unwind_resume\"]\n-#[unwind]\n+#[cfg_attr(stage0, unwind)]\n+#[cfg_attr(not(stage0), unwind(allowed))]\n unsafe extern \"C\" fn rust_eh_unwind_resume(panic_ctx: c::LPVOID) -> ! {\n     let params = [panic_ctx as c::ULONG_PTR];\n     c::RaiseException(RUST_PANIC,"}, {"sha": "50fba5faee747facb0f1309ebd900411f912982e", "filename": "src/libpanic_unwind/windows.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Fwindows.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibpanic_unwind%2Fwindows.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2Fwindows.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -79,18 +79,21 @@ pub enum EXCEPTION_DISPOSITION {\n pub use self::EXCEPTION_DISPOSITION::*;\n \n extern \"system\" {\n-    #[unwind]\n+    #[cfg_attr(stage0, unwind)]\n+    #[cfg_attr(not(stage0), unwind(allowed))]\n     pub fn RaiseException(dwExceptionCode: DWORD,\n                           dwExceptionFlags: DWORD,\n                           nNumberOfArguments: DWORD,\n                           lpArguments: *const ULONG_PTR);\n-    #[unwind]\n+    #[cfg_attr(stage0, unwind)]\n+    #[cfg_attr(not(stage0), unwind(allowed))]\n     pub fn RtlUnwindEx(TargetFrame: LPVOID,\n                        TargetIp: LPVOID,\n                        ExceptionRecord: *const EXCEPTION_RECORD,\n                        ReturnValue: LPVOID,\n                        OriginalContext: *const CONTEXT,\n                        HistoryTable: *const UNWIND_HISTORY_TABLE);\n-    #[unwind]\n+    #[cfg_attr(stage0, unwind)]\n+    #[cfg_attr(not(stage0), unwind(allowed))]\n     pub fn _CxxThrowException(pExceptionObject: *mut c_void, pThrowInfo: *mut u8);\n }"}, {"sha": "a325cfe3eaae33cab4a84971cc58eadcab21502b", "filename": "src/librustc_mir/build/mod.rs", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fmod.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -28,6 +28,7 @@ use std::mem;\n use std::u32;\n use syntax::abi::Abi;\n use syntax::ast;\n+use syntax::attr::{self, UnwindAttr};\n use syntax::symbol::keywords;\n use syntax_pos::Span;\n use transform::MirSource;\n@@ -355,10 +356,9 @@ macro_rules! unpack {\n }\n \n fn should_abort_on_panic<'a, 'gcx, 'tcx>(tcx: TyCtxt<'a, 'gcx, 'tcx>,\n-                                         fn_id: ast::NodeId,\n+                                         fn_def_id: DefId,\n                                          abi: Abi)\n                                          -> bool {\n-\n     // Not callable from C, so we can safely unwind through these\n     if abi == Abi::Rust || abi == Abi::RustCall { return false; }\n \n@@ -370,9 +370,17 @@ fn should_abort_on_panic<'a, 'gcx, 'tcx>(tcx: TyCtxt<'a, 'gcx, 'tcx>,\n \n     // This is a special case: some functions have a C abi but are meant to\n     // unwind anyway. Don't stop them.\n-    if tcx.has_attr(tcx.hir.local_def_id(fn_id), \"unwind\") { return false; }\n+    let attrs = &tcx.get_attrs(fn_def_id);\n+    match attr::find_unwind_attr(Some(tcx.sess.diagnostic()), attrs) {\n+        None => {\n+            // FIXME(rust-lang/rust#48251) -- Had to disable\n+            // abort-on-panic for backwards compatibility reasons.\n+            false\n+        }\n \n-    return true;\n+        Some(UnwindAttr::Allowed) => false,\n+        Some(UnwindAttr::Aborts) => true,\n+    }\n }\n \n ///////////////////////////////////////////////////////////////////////////\n@@ -399,13 +407,14 @@ fn construct_fn<'a, 'gcx, 'tcx, A>(hir: Cx<'a, 'gcx, 'tcx>,\n         safety,\n         return_ty);\n \n+    let fn_def_id = tcx.hir.local_def_id(fn_id);\n     let call_site_scope = region::Scope::CallSite(body.value.hir_id.local_id);\n     let arg_scope = region::Scope::Arguments(body.value.hir_id.local_id);\n     let mut block = START_BLOCK;\n     let source_info = builder.source_info(span);\n     let call_site_s = (call_site_scope, source_info);\n     unpack!(block = builder.in_scope(call_site_s, LintLevel::Inherited, block, |builder| {\n-        if should_abort_on_panic(tcx, fn_id, abi) {\n+        if should_abort_on_panic(tcx, fn_def_id, abi) {\n             builder.schedule_abort();\n         }\n "}, {"sha": "454ac64735c67900e37f40cf5212da99e247d7fe", "filename": "src/libstd/panicking.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibstd%2Fpanicking.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibstd%2Fpanicking.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fpanicking.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -55,7 +55,8 @@ extern {\n                                 data: *mut u8,\n                                 data_ptr: *mut usize,\n                                 vtable_ptr: *mut usize) -> u32;\n-    #[unwind]\n+    #[cfg_attr(stage0, unwind)]\n+    #[cfg_attr(not(stage0), unwind(allowed))]\n     fn __rust_start_panic(data: usize, vtable: usize) -> u32;\n }\n \n@@ -315,7 +316,8 @@ pub fn panicking() -> bool {\n /// Entry point of panic from the libcore crate.\n #[cfg(not(test))]\n #[lang = \"panic_fmt\"]\n-#[unwind]\n+#[cfg_attr(stage0, unwind)]\n+#[cfg_attr(not(stage0), unwind(allowed))]\n pub extern fn rust_begin_panic(msg: fmt::Arguments,\n                                file: &'static str,\n                                line: u32,"}, {"sha": "d0822b69aa692d079bc926331595db5ed2f2cc67", "filename": "src/libsyntax/attr.rs", "status": "modified", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibsyntax%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibsyntax%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fattr.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -565,6 +565,51 @@ pub fn find_inline_attr(diagnostic: Option<&Handler>, attrs: &[Attribute]) -> In\n     })\n }\n \n+#[derive(Copy, Clone, PartialEq)]\n+pub enum UnwindAttr {\n+    Allowed,\n+    Aborts,\n+}\n+\n+/// Determine what `#[unwind]` attribute is present in `attrs`, if any.\n+pub fn find_unwind_attr(diagnostic: Option<&Handler>, attrs: &[Attribute]) -> Option<UnwindAttr> {\n+    let syntax_error = |attr: &Attribute| {\n+        mark_used(attr);\n+        diagnostic.map(|d| {\n+            span_err!(d, attr.span, E0633, \"malformed `#[unwind]` attribute\");\n+        });\n+        None\n+    };\n+\n+    attrs.iter().fold(None, |ia, attr| {\n+        if attr.path != \"unwind\" {\n+            return ia;\n+        }\n+        let meta = match attr.meta() {\n+            Some(meta) => meta.node,\n+            None => return ia,\n+        };\n+        match meta {\n+            MetaItemKind::Word => {\n+                syntax_error(attr)\n+            }\n+            MetaItemKind::List(ref items) => {\n+                mark_used(attr);\n+                if items.len() != 1 {\n+                    syntax_error(attr)\n+                } else if list_contains_name(&items[..], \"allowed\") {\n+                    Some(UnwindAttr::Allowed)\n+                } else if list_contains_name(&items[..], \"aborts\") {\n+                    Some(UnwindAttr::Aborts)\n+                } else {\n+                    syntax_error(attr)\n+                }\n+            }\n+            _ => ia,\n+        }\n+    })\n+}\n+\n /// True if `#[inline]` or `#[inline(always)]` is present in `attrs`.\n pub fn requests_inline(attrs: &[Attribute]) -> bool {\n     match find_inline_attr(None, attrs) {"}, {"sha": "84ab0336f1671ceb5ac88a31008ad3be9eb2f9bc", "filename": "src/libsyntax/diagnostic_list.rs", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibsyntax%2Fdiagnostic_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibsyntax%2Fdiagnostic_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostic_list.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -342,6 +342,33 @@ fn main() {\n ```\n \"##,\n \n+E0633: r##\"\n+The `unwind` attribute was malformed.\n+\n+Erroneous code example:\n+\n+```ignore (compile_fail not working here; see Issue #43707)\n+#[unwind()] // error: expected one argument\n+pub extern fn something() {}\n+\n+fn main() {}\n+```\n+\n+The `#[unwind]` attribute should be used as follows:\n+\n+- `#[unwind(aborts)]` -- specifies that if a non-Rust ABI function\n+  should abort the process if it attempts to unwind. This is the safer\n+  and preferred option.\n+\n+- `#[unwind(allowed)]` -- specifies that a non-Rust ABI function\n+  should be allowed to unwind. This can easily result in Undefined\n+  Behavior (UB), so be careful.\n+\n+NB. The default behavior here is \"allowed\", but this is unspecified\n+and likely to change in the future.\n+\n+\"##,\n+\n }\n \n register_diagnostics! {"}, {"sha": "f1d0a70a22cd0bf6ee508ed0c9f43d32d7a28b94", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -233,7 +233,7 @@ declare_features! (\n     // allow `extern \"platform-intrinsic\" { ... }`\n     (active, platform_intrinsics, \"1.4.0\", Some(27731)),\n \n-    // allow `#[unwind]`\n+    // allow `#[unwind(..)]`\n     // rust runtime internal\n     (active, unwind_attributes, \"1.4.0\", None),\n "}, {"sha": "aa73b11fb3813683534bc7286c502c13d36bfd54", "filename": "src/libunwind/libunwind.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibunwind%2Flibunwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Flibunwind%2Flibunwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2Flibunwind.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -83,7 +83,8 @@ pub enum _Unwind_Context {}\n pub type _Unwind_Exception_Cleanup_Fn = extern \"C\" fn(unwind_code: _Unwind_Reason_Code,\n                                                       exception: *mut _Unwind_Exception);\n extern \"C\" {\n-    #[unwind]\n+    #[cfg_attr(stage0, unwind)]\n+    #[cfg_attr(not(stage0), unwind(allowed))]\n     pub fn _Unwind_Resume(exception: *mut _Unwind_Exception) -> !;\n     pub fn _Unwind_DeleteException(exception: *mut _Unwind_Exception);\n     pub fn _Unwind_GetLanguageSpecificData(ctx: *mut _Unwind_Context) -> *mut c_void;\n@@ -220,7 +221,8 @@ if #[cfg(all(any(target_os = \"ios\", not(target_arch = \"arm\"))))] {\n if #[cfg(not(all(target_os = \"ios\", target_arch = \"arm\")))] {\n     // Not 32-bit iOS\n     extern \"C\" {\n-        #[unwind]\n+        #[cfg_attr(stage0, unwind)]\n+        #[cfg_attr(not(stage0), unwind(allowed))]\n         pub fn _Unwind_RaiseException(exception: *mut _Unwind_Exception) -> _Unwind_Reason_Code;\n         pub fn _Unwind_Backtrace(trace: _Unwind_Trace_Fn,\n                                  trace_argument: *mut c_void)\n@@ -229,7 +231,8 @@ if #[cfg(not(all(target_os = \"ios\", target_arch = \"arm\")))] {\n } else {\n     // 32-bit iOS uses SjLj and does not provide _Unwind_Backtrace()\n     extern \"C\" {\n-        #[unwind]\n+        #[cfg_attr(stage0, unwind)]\n+        #[cfg_attr(not(stage0), unwind(allowed))]\n         pub fn _Unwind_SjLj_RaiseException(e: *mut _Unwind_Exception) -> _Unwind_Reason_Code;\n     }\n "}, {"sha": "90ee0c75680dce81eea4e1b04ec8eb8271199f7b", "filename": "src/test/codegen/extern-functions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Ftest%2Fcodegen%2Fextern-functions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Ftest%2Fcodegen%2Fextern-functions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fextern-functions.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -19,7 +19,7 @@ extern {\n     fn extern_fn();\n // CHECK-NOT: Function Attrs: nounwind\n // CHECK: declare void @unwinding_extern_fn\n-    #[unwind]\n+    #[unwind(allowed)]\n     fn unwinding_extern_fn();\n }\n "}, {"sha": "5039c334f26f563b4029e22aa57f16942cd42e6d", "filename": "src/test/run-pass/abort-on-c-abi.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Ftest%2Frun-pass%2Fabort-on-c-abi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a47fd3df89c267829d96748b3bdff305f20d27d5/src%2Ftest%2Frun-pass%2Fabort-on-c-abi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fabort-on-c-abi.rs?ref=a47fd3df89c267829d96748b3bdff305f20d27d5", "patch": "@@ -19,6 +19,7 @@ use std::io::prelude::*;\n use std::io;\n use std::process::{Command, Stdio};\n \n+#[unwind(aborts)]\n extern \"C\" fn panic_in_ffi() {\n     panic!(\"Test\");\n }"}]}