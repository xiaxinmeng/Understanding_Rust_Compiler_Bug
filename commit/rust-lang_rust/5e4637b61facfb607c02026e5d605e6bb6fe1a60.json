{"sha": "5e4637b61facfb607c02026e5d605e6bb6fe1a60", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlNDYzN2I2MWZhY2ZiNjA3YzAyMDI2ZTVkNjA1ZTZiYjZmZTFhNjA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-07T18:58:49Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-12T00:31:38Z"}, "message": "Add Rust definitions for new LLVM EH instructions\n\nIssue #236", "tree": {"sha": "90084b079a37aed679eea0e2c5bf0fc8e41ad60b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/90084b079a37aed679eea0e2c5bf0fc8e41ad60b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e4637b61facfb607c02026e5d605e6bb6fe1a60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e4637b61facfb607c02026e5d605e6bb6fe1a60", "html_url": "https://github.com/rust-lang/rust/commit/5e4637b61facfb607c02026e5d605e6bb6fe1a60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e4637b61facfb607c02026e5d605e6bb6fe1a60/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4bced5e5f2fcf7e1c7725e747ac3110ef0a9c1e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bced5e5f2fcf7e1c7725e747ac3110ef0a9c1e4", "html_url": "https://github.com/rust-lang/rust/commit/4bced5e5f2fcf7e1c7725e747ac3110ef0a9c1e4"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "198b629e25126f19eaa5b57fde4984c1314f3c97", "filename": "src/comp/lib/llvm.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5e4637b61facfb607c02026e5d605e6bb6fe1a60/src%2Fcomp%2Flib%2Fllvm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e4637b61facfb607c02026e5d605e6bb6fe1a60/src%2Fcomp%2Flib%2Fllvm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Flib%2Fllvm.rs?ref=5e4637b61facfb607c02026e5d605e6bb6fe1a60", "patch": "@@ -572,6 +572,9 @@ native \"cdecl\" mod llvm = \"rustllvm\" {\n     fn LLVMBuildInvoke(B: BuilderRef, Fn: ValueRef, Args: *ValueRef,\n                        NumArgs: uint, Then: BasicBlockRef,\n                        Catch: BasicBlockRef, Name: sbuf) -> ValueRef;\n+    fn LLVMBuildLandingPad(B: BuilderRef, Ty: TypeRef, PersFn: ValueRef,\n+                           NumClauses: uint, Name: sbuf) -> ValueRef;\n+    fn LLVMBuildResume(B: BuilderRef, Exn: ValueRef) -> ValueRef;\n     fn LLVMBuildUnreachable(B: BuilderRef) -> ValueRef;\n \n     /* Add a case to the switch instruction */\n@@ -580,6 +583,12 @@ native \"cdecl\" mod llvm = \"rustllvm\" {\n     /* Add a destination to the indirectbr instruction */\n     fn LLVMAddDestination(IndirectBr: ValueRef, Dest: BasicBlockRef);\n \n+    /* Add a clause to the landing pad instruction */\n+    fn LLVMAddClause(LandingPad: ValueRef, ClauseVal: ValueRef);\n+\n+    /* Set the cleanup on a landing pad instruction */\n+    fn LLVMSetCleanup(LandingPad: ValueRef, Val: Bool);\n+\n     /* Arithmetic */\n     fn LLVMBuildAdd(B: BuilderRef, LHS: ValueRef, RHS: ValueRef, Name: sbuf)\n        -> ValueRef;"}, {"sha": "c869ebbb24c8a5c58fde0cdca45f8b0535f3f2d0", "filename": "src/comp/middle/trans_build.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/5e4637b61facfb607c02026e5d605e6bb6fe1a60/src%2Fcomp%2Fmiddle%2Ftrans_build.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e4637b61facfb607c02026e5d605e6bb6fe1a60/src%2Fcomp%2Fmiddle%2Ftrans_build.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_build.rs?ref=5e4637b61facfb607c02026e5d605e6bb6fe1a60", "patch": "@@ -545,6 +545,22 @@ fn Trap(cx: &@block_ctxt) -> ValueRef {\n                     });\n }\n \n+fn LandingPad(cx: &@block_ctxt, Ty: TypeRef, PersFn: ValueRef,\n+              NumClauses: uint) -> ValueRef {\n+    ret str::as_buf(\"\",\n+                    {|buf|\n+                        llvm::LLVMBuildLandingPad(B(cx),\n+                                                  Ty,\n+                                                  PersFn,\n+                                                  NumClauses,\n+                                                  buf)\n+                    });\n+}\n+\n+fn SetCleanup(_cx: &@block_ctxt, LandingPad: ValueRef) {\n+    llvm::LLVMSetCleanup(LandingPad, lib::llvm::True);\n+}\n+\n //\n // Local Variables:\n // mode: rust"}, {"sha": "deac70f3495ae8f514eef503b4d08917a95a08c6", "filename": "src/rustllvm/rustllvm.def.in", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5e4637b61facfb607c02026e5d605e6bb6fe1a60/src%2Frustllvm%2Frustllvm.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/5e4637b61facfb607c02026e5d605e6bb6fe1a60/src%2Frustllvm%2Frustllvm.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2Frustllvm.def.in?ref=5e4637b61facfb607c02026e5d605e6bb6fe1a60", "patch": "@@ -25,6 +25,7 @@ LLVMAddAttribute\n LLVMAddBasicAliasAnalysisPass\n LLVMAddCFGSimplificationPass\n LLVMAddCase\n+LLVMAddClause\n LLVMAddConstantMergePass\n LLVMAddConstantPropagationPass\n LLVMAddCorrelatedValuePropagationPass\n@@ -122,6 +123,7 @@ LLVMBuildIntToPtr\n LLVMBuildInvoke\n LLVMBuildIsNotNull\n LLVMBuildIsNull\n+LLVMBuildLandingPad\n LLVMBuildLShr\n LLVMBuildLoad\n LLVMBuildMalloc\n@@ -141,6 +143,7 @@ LLVMBuildPhi\n LLVMBuildPointerCast\n LLVMBuildPtrDiff\n LLVMBuildPtrToInt\n+LLVMBuildResume\n LLVMBuildRet\n LLVMBuildRetVoid\n LLVMBuildSDiv\n@@ -548,6 +551,7 @@ LLVMRunPassManager\n LLVMRunStaticConstructors\n LLVMRunStaticDestructors\n LLVMSetAlignment\n+LLVMSetCleanup\n LLVMSetCurrentDebugLocation\n LLVMSetDataLayout\n LLVMSetFunctionCallConv"}]}