{"sha": "08287c1e26c6faa18c145a8a794fdd25408217a4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4Mjg3YzFlMjZjNmZhYTE4YzE0NWE4YTc5NGZkZDI1NDA4MjE3YTQ=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-29T02:37:55Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-29T16:59:15Z"}, "message": "Toggle span highlighting on `-Zteach`", "tree": {"sha": "897420f822df3f373916e93e57f8cc2f65f04f6e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/897420f822df3f373916e93e57f8cc2f65f04f6e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/08287c1e26c6faa18c145a8a794fdd25408217a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/08287c1e26c6faa18c145a8a794fdd25408217a4", "html_url": "https://github.com/rust-lang/rust/commit/08287c1e26c6faa18c145a8a794fdd25408217a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/08287c1e26c6faa18c145a8a794fdd25408217a4/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "871856e8312e7248d12f06f0faa1555f38e50a93", "url": "https://api.github.com/repos/rust-lang/rust/commits/871856e8312e7248d12f06f0faa1555f38e50a93", "html_url": "https://github.com/rust-lang/rust/commit/871856e8312e7248d12f06f0faa1555f38e50a93"}], "stats": {"total": 51, "additions": 33, "deletions": 18}, "files": [{"sha": "b526819e3ce70f5bc00943634e7528f7d751da1f", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -904,10 +904,13 @@ pub fn build_session_with_codemap(sopts: config::Options,\n \n     let emitter: Box<Emitter> = match (sopts.error_format, emitter_dest) {\n         (config::ErrorOutputType::HumanReadable(color_config), None) => {\n-            Box::new(EmitterWriter::stderr(color_config, Some(codemap.clone()), false))\n+            Box::new(EmitterWriter::stderr(color_config,\n+                                           Some(codemap.clone()),\n+                                           false,\n+                                           sopts.debugging_opts.teach))\n         }\n         (config::ErrorOutputType::HumanReadable(_), Some(dst)) => {\n-            Box::new(EmitterWriter::new(dst, Some(codemap.clone()), false))\n+            Box::new(EmitterWriter::new(dst, Some(codemap.clone()), false, false))\n         }\n         (config::ErrorOutputType::Json(pretty), None) => {\n             Box::new(JsonEmitter::stderr(Some(registry), codemap.clone(), pretty))\n@@ -916,10 +919,10 @@ pub fn build_session_with_codemap(sopts: config::Options,\n             Box::new(JsonEmitter::new(dst, Some(registry), codemap.clone(), pretty))\n         }\n         (config::ErrorOutputType::Short(color_config), None) => {\n-            Box::new(EmitterWriter::stderr(color_config, Some(codemap.clone()), true))\n+            Box::new(EmitterWriter::stderr(color_config, Some(codemap.clone()), true, false))\n         }\n         (config::ErrorOutputType::Short(_), Some(dst)) => {\n-            Box::new(EmitterWriter::new(dst, Some(codemap.clone()), true))\n+            Box::new(EmitterWriter::new(dst, Some(codemap.clone()), true, false))\n         }\n     };\n \n@@ -1095,11 +1098,11 @@ pub enum IncrCompSession {\n pub fn early_error(output: config::ErrorOutputType, msg: &str) -> ! {\n     let emitter: Box<Emitter> = match output {\n         config::ErrorOutputType::HumanReadable(color_config) => {\n-            Box::new(EmitterWriter::stderr(color_config, None, false))\n+            Box::new(EmitterWriter::stderr(color_config, None, false, false))\n         }\n         config::ErrorOutputType::Json(pretty) => Box::new(JsonEmitter::basic(pretty)),\n         config::ErrorOutputType::Short(color_config) => {\n-            Box::new(EmitterWriter::stderr(color_config, None, true))\n+            Box::new(EmitterWriter::stderr(color_config, None, true, false))\n         }\n     };\n     let handler = errors::Handler::with_emitter(true, false, emitter);\n@@ -1110,11 +1113,11 @@ pub fn early_error(output: config::ErrorOutputType, msg: &str) -> ! {\n pub fn early_warn(output: config::ErrorOutputType, msg: &str) {\n     let emitter: Box<Emitter> = match output {\n         config::ErrorOutputType::HumanReadable(color_config) => {\n-            Box::new(EmitterWriter::stderr(color_config, None, false))\n+            Box::new(EmitterWriter::stderr(color_config, None, false, false))\n         }\n         config::ErrorOutputType::Json(pretty) => Box::new(JsonEmitter::basic(pretty)),\n         config::ErrorOutputType::Short(color_config) => {\n-            Box::new(EmitterWriter::stderr(color_config, None, true))\n+            Box::new(EmitterWriter::stderr(color_config, None, true, false))\n         }\n     };\n     let handler = errors::Handler::with_emitter(true, false, emitter);"}, {"sha": "84f52daf829a4dc9f0d31c414c5b95fcbf5c54e7", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -163,7 +163,8 @@ pub fn run<F>(run_compiler: F) -> isize\n                     let emitter =\n                         errors::emitter::EmitterWriter::stderr(errors::ColorConfig::Auto,\n                                                                None,\n-                                                               true);\n+                                                               true,\n+                                                               false);\n                     let handler = errors::Handler::with_emitter(true, false, Box::new(emitter));\n                     handler.emit(&MultiSpan::new(),\n                                  \"aborting due to previous error(s)\",\n@@ -1241,6 +1242,7 @@ pub fn monitor<F: FnOnce() + Send + 'static>(f: F) {\n             let emitter =\n                 Box::new(errors::emitter::EmitterWriter::stderr(errors::ColorConfig::Auto,\n                                                                 None,\n+                                                                false,\n                                                                 false));\n             let handler = errors::Handler::with_emitter(true, false, emitter);\n "}, {"sha": "f05609b4d478f0ed8b054e35d12ed532d377a9bb", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -106,6 +106,7 @@ pub struct EmitterWriter {\n     dst: Destination,\n     cm: Option<Rc<CodeMapper>>,\n     short_message: bool,\n+    teach: bool,\n }\n \n struct FileWithAnnotatedLines {\n@@ -117,32 +118,37 @@ struct FileWithAnnotatedLines {\n impl EmitterWriter {\n     pub fn stderr(color_config: ColorConfig,\n                   code_map: Option<Rc<CodeMapper>>,\n-                  short_message: bool)\n+                  short_message: bool,\n+                  teach: bool)\n                   -> EmitterWriter {\n         if color_config.use_color() {\n             let dst = Destination::from_stderr();\n             EmitterWriter {\n                 dst,\n                 cm: code_map,\n-                short_message: short_message,\n+                short_message,\n+                teach,\n             }\n         } else {\n             EmitterWriter {\n                 dst: Raw(Box::new(io::stderr())),\n                 cm: code_map,\n-                short_message: short_message,\n+                short_message,\n+                teach,\n             }\n         }\n     }\n \n     pub fn new(dst: Box<Write + Send>,\n                code_map: Option<Rc<CodeMapper>>,\n-               short_message: bool)\n+               short_message: bool,\n+               teach: bool)\n                -> EmitterWriter {\n         EmitterWriter {\n             dst: Raw(dst),\n             cm: code_map,\n-            short_message: short_message,\n+            short_message,\n+            teach,\n         }\n     }\n \n@@ -551,13 +557,14 @@ impl EmitterWriter {\n                                code_offset + annotation.start_col,\n                                style);\n                 }\n-                _ => {\n+                _ if self.teach => {\n                     buffer.set_style_range(line_offset,\n                                            code_offset + annotation.start_col,\n                                            code_offset + annotation.end_col,\n                                            style,\n                                            annotation.is_primary);\n-               }\n+                }\n+                _ => {}\n             }\n         }\n "}, {"sha": "47eb04621a126935fef64637f90f98a271a59899", "filename": "src/librustc_errors/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc_errors%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustc_errors%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Flib.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -297,7 +297,7 @@ impl Handler {\n                                       cm: Option<Rc<CodeMapper>>,\n                                       flags: HandlerFlags)\n                                       -> Handler {\n-        let emitter = Box::new(EmitterWriter::stderr(color_config, cm, false));\n+        let emitter = Box::new(EmitterWriter::stderr(color_config, cm, false, false));\n         Handler::with_emitter_and_flags(emitter, flags)\n     }\n "}, {"sha": "1eb3646d008779dd6c8a4b8fd06d9ad9a67b9b08", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -239,6 +239,7 @@ fn run_test(test: &str, cratename: &str, filename: &FileName, line: usize,\n     ));\n     let emitter = errors::emitter::EmitterWriter::new(box Sink(data.clone()),\n                                                       Some(codemap.clone()),\n+                                                      false,\n                                                       false);\n     let old = io::set_panic(Some(box Sink(data.clone())));\n     let _bomb = Bomb(data.clone(), old.unwrap_or(box io::stdout()));"}, {"sha": "7635ec26b289b347cec9f39ff140cf49fbcf2bb7", "filename": "src/libsyntax/json.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibsyntax%2Fjson.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibsyntax%2Fjson.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fjson.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -188,7 +188,7 @@ impl Diagnostic {\n         }\n         let buf = BufWriter::default();\n         let output = buf.clone();\n-        EmitterWriter::new(Box::new(buf), Some(je.cm.clone()), false).emit(db);\n+        EmitterWriter::new(Box::new(buf), Some(je.cm.clone()), false, false).emit(db);\n         let output = Arc::try_unwrap(output.0).unwrap().into_inner().unwrap();\n         let output = String::from_utf8(output).unwrap();\n "}, {"sha": "0fd069b76aadc6db18963786525c78f71ab94f06", "filename": "src/libsyntax/parse/lexer/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -1745,6 +1745,7 @@ mod tests {\n     fn mk_sess(cm: Rc<CodeMap>) -> ParseSess {\n         let emitter = errors::emitter::EmitterWriter::new(Box::new(io::sink()),\n                                                           Some(cm.clone()),\n+                                                          false,\n                                                           false);\n         ParseSess {\n             span_diagnostic: errors::Handler::with_emitter(true, false, Box::new(emitter)),"}, {"sha": "3b4bba24d779b6d0176fdc8c3e8f5b9461e83aa8", "filename": "src/libsyntax/test_snippet.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibsyntax%2Ftest_snippet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08287c1e26c6faa18c145a8a794fdd25408217a4/src%2Flibsyntax%2Ftest_snippet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ftest_snippet.rs?ref=08287c1e26c6faa18c145a8a794fdd25408217a4", "patch": "@@ -62,6 +62,7 @@ fn test_harness(file_text: &str, span_labels: Vec<SpanLabel>, expected_output: &\n \n     let emitter = EmitterWriter::new(Box::new(Shared { data: output.clone() }),\n                                      Some(code_map.clone()),\n+                                     false,\n                                      false);\n     let handler = Handler::with_emitter(true, false, Box::new(emitter));\n     handler.span_err(msp, \"foo\");"}]}