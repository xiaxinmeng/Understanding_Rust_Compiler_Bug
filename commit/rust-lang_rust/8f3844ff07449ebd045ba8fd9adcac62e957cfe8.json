{"sha": "8f3844ff07449ebd045ba8fd9adcac62e957cfe8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmMzg0NGZmMDc0NDllYmQwNDViYThmZDlhZGNhYzYyZTk1N2NmZTg=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2021-07-19T10:25:29Z"}, "committer": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2021-07-19T14:14:59Z"}, "message": "refactor adding rustc and std into extended builds", "tree": {"sha": "c20057e55ff28bdb1a17586ffbcf0dd2896fec4e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c20057e55ff28bdb1a17586ffbcf0dd2896fec4e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f3844ff07449ebd045ba8fd9adcac62e957cfe8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEMycKYjxLY0eb13b7zXazX3c0dp4FAmD1iOMACgkQzXazX3c0\ndp6OjA/5AXqaGB8pP2YvKDTRBiuZYVMqPnU4/SwIu7g3J46EPDrlLaXEjt+dOI5Q\nF7+ZuTl5EG6o1nlrqTenZ3hgTx89AkRKn6DAxspdfas7joWNkAdOHz5SSq1+HdnT\nIJVdVgN7npA2juyAIw7ZcGT8r529W1x5fPRHWB/i3wzGgrBlQpvYM0XEXhH3k0Zn\nz5Ck5MqZQEO4Eob37T9swPkA99I1jgDSTcSiV1/7VyWKuVmQZKVmyFHOIWPmK2a8\nf1jtvysYwMseHgK9kDnRhyUwgOvf+JW3Rhu5BqNtHeQT/Pm0IBxIfDY2mQcRqfFK\n6bfHvAU1XFrDaY8E0AwYtWvXAtDhjKbNBdUrfjEWmrxfu1Cj6Mk/7gl4NUz/CEse\nDqOkCBEDWJQLX19miiCShKYfalwZlR74r+lVkIlWtHRE93oxdxJrhBEHPr+pZxj0\n207tQGsROhwDEGouOKBk80PQ8C4HaTT8Yr1Hm2g+VMbsywOWR0iyhbnzyNLkicvK\n1deVo46i14Ihy8Na9guj0YVOZ2uM3jtI0TwHNqnjGzA0QHT7YFEjYmbyWYEraji+\nuTpl2OqMRKUK+JNKxrA54Imw9y/7DW43opXyKxW8JplZDnpbBp9CzNrDLiynxSuw\nXBefLs/5yYrkQ8H4OUn3N/ESl1YhPzLRH9H+2b/jmyYwW+OG7fo=\n=Gb32\n-----END PGP SIGNATURE-----", "payload": "tree c20057e55ff28bdb1a17586ffbcf0dd2896fec4e\nparent 8df945c4717ffaf923b57bf30c473df6fc98bc85\nauthor Pietro Albini <pietro.albini@ferrous-systems.com> 1626690329 +0200\ncommitter Pietro Albini <pietro.albini@ferrous-systems.com> 1626704099 +0200\n\nrefactor adding rustc and std into extended builds\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f3844ff07449ebd045ba8fd9adcac62e957cfe8", "html_url": "https://github.com/rust-lang/rust/commit/8f3844ff07449ebd045ba8fd9adcac62e957cfe8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f3844ff07449ebd045ba8fd9adcac62e957cfe8/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8df945c4717ffaf923b57bf30c473df6fc98bc85", "url": "https://api.github.com/repos/rust-lang/rust/commits/8df945c4717ffaf923b57bf30c473df6fc98bc85", "html_url": "https://github.com/rust-lang/rust/commit/8df945c4717ffaf923b57bf30c473df6fc98bc85"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "1d7dbeddee981fa18d5c20c35cd2692acd26486d", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8f3844ff07449ebd045ba8fd9adcac62e957cfe8/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f3844ff07449ebd045ba8fd9adcac62e957cfe8/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=8f3844ff07449ebd045ba8fd9adcac62e957cfe8", "patch": "@@ -1345,7 +1345,15 @@ impl Step for Extended {\n \n         builder.info(&format!(\"Dist extended stage{} ({})\", compiler.stage, target));\n \n-        let rustc_installer = builder.ensure(Rustc { compiler: builder.compiler(stage, target) });\n+        let mut tarballs = Vec::new();\n+\n+        // When rust-std package split from rustc, we needed to ensure that during\n+        // upgrades rustc was upgraded before rust-std. To avoid rustc clobbering\n+        // the std files during uninstall. To do this ensure that rustc comes\n+        // before rust-std in the list below.\n+        tarballs.push(builder.ensure(Rustc { compiler: builder.compiler(stage, target) }));\n+        tarballs.push(builder.ensure(Std { compiler, target }).expect(\"missing std\"));\n+\n         let cargo_installer = builder.ensure(Cargo { compiler, target });\n         let rustfmt_installer = builder.ensure(Rustfmt { compiler, target });\n         let rust_demangler_installer = builder.ensure(RustDemangler { compiler, target });\n@@ -1358,7 +1366,6 @@ impl Step for Extended {\n         let analysis_installer = builder.ensure(Analysis { compiler, target });\n \n         let docs_installer = builder.ensure(Docs { host: target });\n-        let std_installer = builder.ensure(Std { compiler, target });\n \n         let etc = builder.src.join(\"src/etc/installer\");\n \n@@ -1367,12 +1374,6 @@ impl Step for Extended {\n             return;\n         }\n \n-        // When rust-std package split from rustc, we needed to ensure that during\n-        // upgrades rustc was upgraded before rust-std. To avoid rustc clobbering\n-        // the std files during uninstall. To do this ensure that rustc comes\n-        // before rust-std in the list below.\n-        let mut tarballs = Vec::new();\n-        tarballs.push(rustc_installer);\n         tarballs.push(cargo_installer);\n         tarballs.push(clippy_installer);\n         tarballs.extend(rust_demangler_installer.clone());\n@@ -1384,7 +1385,6 @@ impl Step for Extended {\n         if let Some(analysis_installer) = analysis_installer {\n             tarballs.push(analysis_installer);\n         }\n-        tarballs.push(std_installer.expect(\"missing std\"));\n         if let Some(docs_installer) = docs_installer {\n             tarballs.push(docs_installer);\n         }"}]}