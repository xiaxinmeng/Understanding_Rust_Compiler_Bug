{"sha": "c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "node_id": "C_kwDOAAsO6NoAKGM2YmIyMTlmYzRlNzAzNjUyNzNjOGY4Y2I5NmZkZmYyZTkxMGJkMzg", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-03-27T03:36:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-27T03:36:08Z"}, "message": "Rollup merge of #93469 - compiler-errors:issue-93450, r=estebank\n\nSkip pointing out ambiguous impls in alloc/std crates too in inference errors\n\nThis generalizes the logic in `annotate_source_of_ambiguity` to skip printing ambiguity errors traits in `alloc` and `std` as well, not just `core`.\n\nWhile this does spot-fix the issue mentioned below, it would be nicer to generalize this logic, for example to detect when the trait predicate's `self_ty` has any numerical inference variables. Is it worthwhile to scrap this solution for one like that?\n\nFixes #93450\n\nr? `@estebank`\nfeel free to reassign", "tree": {"sha": "0d7cd4d7c4f8006d2b2cf23b3b46109862c73fb1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d7cd4d7c4f8006d2b2cf23b3b46109862c73fb1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiP9upCRBK7hj4Ov3rIwAAprQIAFE23b/qqC5PnQgM44dMaob5\neRM+2N8gzuyqN6KebYdCiQvdTqQF3MnR5yE+oQgyTpoNwQsXNGriu04WW3XebK74\nsvUxp2Bwj0RN8kZRt99ach91wP/1yLqeltZV6UJeQNgUVEHd6n3UzXdfqtCIygtB\n+Kprg205nVt1UrU0ObNlRak0MFRTFYfCfT7W8HwV2ZtqYn7uYhfB6xKhNk7Qlx/S\nXm4GU9erpHaFwkwLCKsd4ooLMoJXUdFr64a4uanTpsNdC2ZHMfnCdUku22Hoqiig\ny4zpm/ADFMVjoznCu51LVcwJYb1w6pyHHf9nYm9oCejqI4qIb7HD1shLBZz/NPw=\n=vSVI\n-----END PGP SIGNATURE-----\n", "payload": "tree 0d7cd4d7c4f8006d2b2cf23b3b46109862c73fb1\nparent 4435bb07043df567c3ecd12ebd20adbd5d9c9b2f\nparent 9072c8d274307c08ad0a7afb16681d43181c4033\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1648352168 +0200\ncommitter GitHub <noreply@github.com> 1648352168 +0200\n\nRollup merge of #93469 - compiler-errors:issue-93450, r=estebank\n\nSkip pointing out ambiguous impls in alloc/std crates too in inference errors\n\nThis generalizes the logic in `annotate_source_of_ambiguity` to skip printing ambiguity errors traits in `alloc` and `std` as well, not just `core`.\n\nWhile this does spot-fix the issue mentioned below, it would be nicer to generalize this logic, for example to detect when the trait predicate's `self_ty` has any numerical inference variables. Is it worthwhile to scrap this solution for one like that?\n\nFixes #93450\n\nr? `@estebank`\nfeel free to reassign\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "html_url": "https://github.com/rust-lang/rust/commit/c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4435bb07043df567c3ecd12ebd20adbd5d9c9b2f", "url": "https://api.github.com/repos/rust-lang/rust/commits/4435bb07043df567c3ecd12ebd20adbd5d9c9b2f", "html_url": "https://github.com/rust-lang/rust/commit/4435bb07043df567c3ecd12ebd20adbd5d9c9b2f"}, {"sha": "9072c8d274307c08ad0a7afb16681d43181c4033", "url": "https://api.github.com/repos/rust-lang/rust/commits/9072c8d274307c08ad0a7afb16681d43181c4033", "html_url": "https://github.com/rust-lang/rust/commit/9072c8d274307c08ad0a7afb16681d43181c4033"}], "stats": {"total": 62, "additions": 18, "deletions": 44}, "files": [{"sha": "468c7a3c55b3626f39e5fc32a431ed45b7c93617", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "patch": "@@ -1954,7 +1954,7 @@ impl<'a, 'tcx> InferCtxtPrivExt<'a, 'tcx> for InferCtxt<'a, 'tcx> {\n \n         if self.is_tainted_by_errors()\n             && crate_names.len() == 1\n-            && crate_names[0] == \"`core`\"\n+            && [\"`core`\", \"`alloc`\", \"`std`\"].contains(&crate_names[0].as_str())\n             && spans.len() == 0\n         {\n             // Avoid complaining about other inference issues for expressions like"}, {"sha": "828b5aac896beff3d71fb276d3dc3b0785502dfd", "filename": "src/test/ui/impl-trait/equality.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fimpl-trait%2Fequality.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fimpl-trait%2Fequality.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fequality.rs?ref=c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "patch": "@@ -17,7 +17,7 @@ fn two(x: bool) -> impl Foo {\n     //~| expected `i32`, found `u32`\n }\n \n-fn sum_to(n: u32) -> impl Foo { //~ ERROR type annotations needed\n+fn sum_to(n: u32) -> impl Foo {\n     if n == 0 {\n         0\n     } else {"}, {"sha": "536a4726c6de225f02c2247332f6c399a92b49f6", "filename": "src/test/ui/impl-trait/equality.stderr", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fimpl-trait%2Fequality.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fimpl-trait%2Fequality.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fequality.stderr?ref=c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "patch": "@@ -34,22 +34,7 @@ LL |         n + sum_to(n - 1)\n    |\n    = help: the trait `Add<impl Foo>` is not implemented for `u32`\n \n-error[E0283]: type annotations needed\n-  --> $DIR/equality.rs:20:22\n-   |\n-LL | fn sum_to(n: u32) -> impl Foo {\n-   |                      ^^^^^^^^ cannot infer type for type `{integer}`\n-   |\n-   = note: multiple `impl`s satisfying `{integer}: ToString` found in the `alloc` crate:\n-           - impl ToString for i8;\n-           - impl ToString for u8;\n-note: required because of the requirements on the impl of `Foo` for `{integer}`\n-  --> $DIR/equality.rs:5:26\n-   |\n-LL | impl<T: Copy + ToString> Foo for T {}\n-   |                          ^^^     ^\n-\n-error: aborting due to 3 previous errors; 1 warning emitted\n+error: aborting due to 2 previous errors; 1 warning emitted\n \n-Some errors have detailed explanations: E0277, E0283, E0308.\n+Some errors have detailed explanations: E0277, E0308.\n For more information about an error, try `rustc --explain E0277`."}, {"sha": "8c0a0f51a2157eeb34f8f17f10ee13af73977b09", "filename": "src/test/ui/issues/issue-72690.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fissues%2Fissue-72690.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fissues%2Fissue-72690.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-72690.rs?ref=c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "patch": "@@ -10,7 +10,6 @@ fn err() {\n \n fn arg_pat_closure_err() {\n     |x| String::from(\"x\".as_ref()); //~ ERROR type annotations needed\n-    //~^ ERROR type annotations needed\n     //~| ERROR type annotations needed\n }\n "}, {"sha": "f1ec678b20193fe4d7d196196eca65cb39239ebb", "filename": "src/test/ui/issues/issue-72690.stderr", "status": "modified", "additions": 14, "deletions": 24, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fissues%2Fissue-72690.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c6bb219fc4e70365273c8f8cb96fdff2e910bd38/src%2Ftest%2Fui%2Fissues%2Fissue-72690.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-72690.stderr?ref=c6bb219fc4e70365273c8f8cb96fdff2e910bd38", "patch": "@@ -29,16 +29,6 @@ error[E0282]: type annotations needed\n LL |     |x| String::from(\"x\".as_ref());\n    |      ^ consider giving this closure parameter a type\n \n-error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:12:9\n-   |\n-LL |     |x| String::from(\"x\".as_ref());\n-   |         ^^^^^^^^^^^^ cannot infer type for reference `&_`\n-   |\n-   = note: multiple `impl`s satisfying `String: From<&_>` found in the `alloc` crate:\n-           - impl<> From<&String> for String;\n-           - impl<> From<&str> for String;\n-\n error[E0283]: type annotations needed\n   --> $DIR/issue-72690.rs:12:26\n    |\n@@ -55,7 +45,7 @@ LL |     |x| String::from(\"x\".as_ref());\n            - impl AsRef<str> for str;\n \n error[E0283]: type annotations needed for `&T`\n-  --> $DIR/issue-72690.rs:18:17\n+  --> $DIR/issue-72690.rs:17:17\n    |\n LL |     let _ = \"x\".as_ref();\n    |         -       ^^^^^^ cannot infer type for type parameter `T` declared on the trait `AsRef`\n@@ -69,7 +59,7 @@ LL |     let _ = \"x\".as_ref();\n            - impl AsRef<str> for str;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:22:5\n+  --> $DIR/issue-72690.rs:21:5\n    |\n LL |     String::from(\"x\".as_ref());\n    |     ^^^^^^^^^^^^ cannot infer type for reference `&_`\n@@ -79,7 +69,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl<> From<&str> for String;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:22:22\n+  --> $DIR/issue-72690.rs:21:22\n    |\n LL |     String::from(\"x\".as_ref());\n    |                  ----^^^^^^--\n@@ -94,7 +84,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl AsRef<str> for str;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:29:5\n+  --> $DIR/issue-72690.rs:28:5\n    |\n LL |     String::from(\"x\".as_ref());\n    |     ^^^^^^^^^^^^ cannot infer type for reference `&_`\n@@ -104,7 +94,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl<> From<&str> for String;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:29:22\n+  --> $DIR/issue-72690.rs:28:22\n    |\n LL |     String::from(\"x\".as_ref());\n    |                  ----^^^^^^--\n@@ -119,7 +109,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl AsRef<str> for str;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:38:5\n+  --> $DIR/issue-72690.rs:37:5\n    |\n LL |     String::from(\"x\".as_ref());\n    |     ^^^^^^^^^^^^ cannot infer type for reference `&_`\n@@ -129,7 +119,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl<> From<&str> for String;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:38:22\n+  --> $DIR/issue-72690.rs:37:22\n    |\n LL |     String::from(\"x\".as_ref());\n    |                  ----^^^^^^--\n@@ -144,7 +134,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl AsRef<str> for str;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:47:5\n+  --> $DIR/issue-72690.rs:46:5\n    |\n LL |     String::from(\"x\".as_ref());\n    |     ^^^^^^^^^^^^ cannot infer type for reference `&_`\n@@ -154,7 +144,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl<> From<&str> for String;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:47:22\n+  --> $DIR/issue-72690.rs:46:22\n    |\n LL |     String::from(\"x\".as_ref());\n    |                  ----^^^^^^--\n@@ -169,7 +159,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl AsRef<str> for str;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:54:5\n+  --> $DIR/issue-72690.rs:53:5\n    |\n LL |     String::from(\"x\".as_ref());\n    |     ^^^^^^^^^^^^ cannot infer type for reference `&_`\n@@ -179,7 +169,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl<> From<&str> for String;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:54:22\n+  --> $DIR/issue-72690.rs:53:22\n    |\n LL |     String::from(\"x\".as_ref());\n    |                  ----^^^^^^--\n@@ -194,7 +184,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl AsRef<str> for str;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:63:5\n+  --> $DIR/issue-72690.rs:62:5\n    |\n LL |     String::from(\"x\".as_ref());\n    |     ^^^^^^^^^^^^ cannot infer type for reference `&_`\n@@ -204,7 +194,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl<> From<&str> for String;\n \n error[E0283]: type annotations needed\n-  --> $DIR/issue-72690.rs:63:22\n+  --> $DIR/issue-72690.rs:62:22\n    |\n LL |     String::from(\"x\".as_ref());\n    |                  ----^^^^^^--\n@@ -218,7 +208,7 @@ LL |     String::from(\"x\".as_ref());\n            - impl AsRef<[u8]> for str;\n            - impl AsRef<str> for str;\n \n-error: aborting due to 18 previous errors\n+error: aborting due to 17 previous errors\n \n Some errors have detailed explanations: E0282, E0283.\n For more information about an error, try `rustc --explain E0282`."}]}