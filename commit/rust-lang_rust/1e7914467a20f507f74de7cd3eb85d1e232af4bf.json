{"sha": "1e7914467a20f507f74de7cd3eb85d1e232af4bf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlNzkxNDQ2N2EyMGY1MDdmNzRkZTdjZDNlYjg1ZDFlMjMyYWY0YmY=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-05-23T22:00:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-23T22:00:52Z"}, "message": "Rollup merge of #72502 - RalfJung:generator-discr-ty, r=jonas-schievink\n\nfix discriminant type in generator transform\n\nThe generator transform assumed that the discriminant type is always `isize`, which is not correct, leading to [ICEs in Miri](https://github.com/rust-lang/rust/pull/72419/files#r429543536) when some extra sanity checking got enabled.\n\nr? @jonas-schievink @eddyb", "tree": {"sha": "ef0d060f69f253549f40b1ec1068dd13dcc75687", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef0d060f69f253549f40b1ec1068dd13dcc75687"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e7914467a20f507f74de7cd3eb85d1e232af4bf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeyZ0VCRBK7hj4Ov3rIwAAdHIIAAljbfmfPvM4E4JbZhB+jhOG\nc5LxzEziQzg9aae76UWXr/xQb2PThdwhOO7witXEQqm74ui1N+zeW/4pmxVPS5m5\nC78+7i/gDgJeHXu8UgQSjmYpHTphQe7SZt9A30RXekn7+vhgEOGTykYBtU8hrwIP\neH4LA6IOZpDfQXFP3WaLbB5YUCYjbdov4BtjVuR81ugR+OP60EXQYlpHmIPyX7H4\n7ZUyBS3skQECaEst3PASfeu44lY0RuzXrLe+b05n9fxl/5dZIz1G+tbVRehfL728\nQ3KG2gyBelnzR2ryh9QzySUSIR/p8IyvKlgGtR56O4o1nBsEsMzj3dSRQVArbWY=\n=8qCb\n-----END PGP SIGNATURE-----\n", "payload": "tree ef0d060f69f253549f40b1ec1068dd13dcc75687\nparent ee92ddf8114e61e4cd3cc5314733d652595ad92b\nparent b388f964954aa17d2ed6d3f4519234df51280c91\nauthor Dylan DPC <dylan.dpc@gmail.com> 1590271252 +0200\ncommitter GitHub <noreply@github.com> 1590271252 +0200\n\nRollup merge of #72502 - RalfJung:generator-discr-ty, r=jonas-schievink\n\nfix discriminant type in generator transform\n\nThe generator transform assumed that the discriminant type is always `isize`, which is not correct, leading to [ICEs in Miri](https://github.com/rust-lang/rust/pull/72419/files#r429543536) when some extra sanity checking got enabled.\n\nr? @jonas-schievink @eddyb\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e7914467a20f507f74de7cd3eb85d1e232af4bf", "html_url": "https://github.com/rust-lang/rust/commit/1e7914467a20f507f74de7cd3eb85d1e232af4bf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e7914467a20f507f74de7cd3eb85d1e232af4bf/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ee92ddf8114e61e4cd3cc5314733d652595ad92b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee92ddf8114e61e4cd3cc5314733d652595ad92b", "html_url": "https://github.com/rust-lang/rust/commit/ee92ddf8114e61e4cd3cc5314733d652595ad92b"}, {"sha": "b388f964954aa17d2ed6d3f4519234df51280c91", "url": "https://api.github.com/repos/rust-lang/rust/commits/b388f964954aa17d2ed6d3f4519234df51280c91", "html_url": "https://github.com/rust-lang/rust/commit/b388f964954aa17d2ed6d3f4519234df51280c91"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "50a882ab014fd0c2a9e5475a9049b122a0ded4ca", "filename": "src/librustc_mir/transform/generator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e7914467a20f507f74de7cd3eb85d1e232af4bf/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e7914467a20f507f74de7cd3eb85d1e232af4bf/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs?ref=1e7914467a20f507f74de7cd3eb85d1e232af4bf", "patch": "@@ -266,7 +266,7 @@ impl TransformVisitor<'tcx> {\n \n     // Create a statement which reads the discriminant into a temporary\n     fn get_discr(&self, body: &mut Body<'tcx>) -> (Statement<'tcx>, Place<'tcx>) {\n-        let temp_decl = LocalDecl::new(self.tcx.types.isize, body.span).internal();\n+        let temp_decl = LocalDecl::new(self.discr_ty, body.span).internal();\n         let local_decls_len = body.local_decls.push(temp_decl);\n         let temp = Place::from(local_decls_len);\n "}, {"sha": "6a32a42d85a82089532e0062bf96ae3beecf189a", "filename": "src/test/mir-opt/generator-drop-cleanup/rustc.main-{{closure}}.generator_drop.0.mir", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e7914467a20f507f74de7cd3eb85d1e232af4bf/src%2Ftest%2Fmir-opt%2Fgenerator-drop-cleanup%2Frustc.main-%7B%7Bclosure%7D%7D.generator_drop.0.mir", "raw_url": "https://github.com/rust-lang/rust/raw/1e7914467a20f507f74de7cd3eb85d1e232af4bf/src%2Ftest%2Fmir-opt%2Fgenerator-drop-cleanup%2Frustc.main-%7B%7Bclosure%7D%7D.generator_drop.0.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fgenerator-drop-cleanup%2Frustc.main-%7B%7Bclosure%7D%7D.generator_drop.0.mir?ref=1e7914467a20f507f74de7cd3eb85d1e232af4bf", "patch": "@@ -9,7 +9,7 @@ fn main::{{closure}}#0(_1: *mut [generator@$DIR/generator-drop-cleanup.rs:10:15:\n     let mut _5: ();                      // in scope 0 at $DIR/generator-drop-cleanup.rs:12:9: 12:14\n     let mut _7: ();                      // in scope 0 at $DIR/generator-drop-cleanup.rs:10:18: 10:18\n     let mut _8: ();                      // in scope 0 at $DIR/generator-drop-cleanup.rs:10:15: 13:6\n-    let mut _9: isize;                   // in scope 0 at $DIR/generator-drop-cleanup.rs:10:15: 13:6\n+    let mut _9: u32;                     // in scope 0 at $DIR/generator-drop-cleanup.rs:10:15: 13:6\n     scope 1 {\n         debug _s => (((*_1) as variant#3).0: std::string::String); // in scope 1 at $DIR/generator-drop-cleanup.rs:11:13: 11:15\n     }"}, {"sha": "c73dea5f8fde691402ba7d1034eb6f36b044028b", "filename": "src/test/mir-opt/generator-tiny/rustc.main-{{closure}}.generator_resume.0.mir", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e7914467a20f507f74de7cd3eb85d1e232af4bf/src%2Ftest%2Fmir-opt%2Fgenerator-tiny%2Frustc.main-%7B%7Bclosure%7D%7D.generator_resume.0.mir", "raw_url": "https://github.com/rust-lang/rust/raw/1e7914467a20f507f74de7cd3eb85d1e232af4bf/src%2Ftest%2Fmir-opt%2Fgenerator-tiny%2Frustc.main-%7B%7Bclosure%7D%7D.generator_resume.0.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fgenerator-tiny%2Frustc.main-%7B%7Bclosure%7D%7D.generator_resume.0.mir?ref=1e7914467a20f507f74de7cd3eb85d1e232af4bf", "patch": "@@ -12,7 +12,7 @@ fn main::{{closure}}#0(_1: std::pin::Pin<&mut [generator@$DIR/generator-tiny.rs:\n     let _8: ();                          // in scope 0 at $DIR/generator-tiny.rs:23:13: 23:21\n     let mut _9: ();                      // in scope 0 at $DIR/generator-tiny.rs:19:25: 19:25\n     let _10: u8;                         // in scope 0 at $DIR/generator-tiny.rs:19:17: 19:19\n-    let mut _11: isize;                  // in scope 0 at $DIR/generator-tiny.rs:19:16: 25:6\n+    let mut _11: u32;                    // in scope 0 at $DIR/generator-tiny.rs:19:16: 25:6\n     scope 1 {\n         debug _d => (((*(_1.0: &mut [generator@$DIR/generator-tiny.rs:19:16: 25:6 {u8, HasDrop, ()}])) as variant#3).0: HasDrop); // in scope 1 at $DIR/generator-tiny.rs:20:13: 20:15\n     }"}]}