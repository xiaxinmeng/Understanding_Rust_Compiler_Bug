{"sha": "069a1b3c8f514b04251788108ecebfa672e942ae", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA2OWExYjNjOGY1MTRiMDQyNTE3ODgxMDhlY2ViZmE2NzJlOTQyYWU=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-07-28T19:17:52Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-07-28T19:20:47Z"}, "message": "rustbuild: Tweak how we cross-compile LLVM\n\nIn preparation for upgrading to LLVM 5.0 it looks like we need to tweak how we\ncross compile LLVM slightly. It's using `CMAKE_SYSTEM_NAME` to infer whether to\nbuild libFuzzer which only works on some platforms, and then once we configure\nthat it needs to apparently reach into the host build area to try to compile\n`llvm-config` as well. Once these are both configured, though, it looks like we\ncan successfully cross-compile LLVM.", "tree": {"sha": "1d253919e7ad41d3df10121639d3b6fb9a0bec8c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d253919e7ad41d3df10121639d3b6fb9a0bec8c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/069a1b3c8f514b04251788108ecebfa672e942ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/069a1b3c8f514b04251788108ecebfa672e942ae", "html_url": "https://github.com/rust-lang/rust/commit/069a1b3c8f514b04251788108ecebfa672e942ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/069a1b3c8f514b04251788108ecebfa672e942ae/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6f815ca771b59fe652a5f88f198810b5dc37a4c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/6f815ca771b59fe652a5f88f198810b5dc37a4c9", "html_url": "https://github.com/rust-lang/rust/commit/6f815ca771b59fe652a5f88f198810b5dc37a4c9"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "bb80674c8877f695364915c8ec62e7c265dde5e8", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/069a1b3c8f514b04251788108ecebfa672e942ae/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/069a1b3c8f514b04251788108ecebfa672e942ae/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=069a1b3c8f514b04251788108ecebfa672e942ae", "patch": "@@ -154,6 +154,14 @@ impl Step for Llvm {\n             let host = build.llvm_out(build.build).join(\"bin/llvm-tblgen\");\n             cfg.define(\"CMAKE_CROSSCOMPILING\", \"True\")\n                .define(\"LLVM_TABLEGEN\", &host);\n+\n+            if target.contains(\"netbsd\") {\n+               cfg.define(\"CMAKE_SYSTEM_NAME\", \"NetBSD\");\n+            } else if target.contains(\"freebsd\") {\n+               cfg.define(\"CMAKE_SYSTEM_NAME\", \"FreeBSD\");\n+            }\n+\n+            cfg.define(\"LLVM_NATIVE_BUILD\", build.llvm_out(build.build).join(\"build\"));\n         }\n \n         let sanitize_cc = |cc: &Path| {"}]}