{"sha": "ac0c2fb5f12277617834e1e55b2960e05740139d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFjMGMyZmI1ZjEyMjc3NjE3ODM0ZTFlNTViMjk2MGUwNTc0MDEzOWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-10T14:15:09Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-10T14:15:09Z"}, "message": "Merge pull request #20808 from Manishearth/span_fix\n\nFix checking of command line expansion spans\n\nReviewed-by: alexcrichton", "tree": {"sha": "2111b73697e7694b81d325099a79c8d4187dfdcc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2111b73697e7694b81d325099a79c8d4187dfdcc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ac0c2fb5f12277617834e1e55b2960e05740139d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ac0c2fb5f12277617834e1e55b2960e05740139d", "html_url": "https://github.com/rust-lang/rust/commit/ac0c2fb5f12277617834e1e55b2960e05740139d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ac0c2fb5f12277617834e1e55b2960e05740139d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0ca57a6fb176d8082eac0ba1de4690f4c0eb0bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0ca57a6fb176d8082eac0ba1de4690f4c0eb0bb", "html_url": "https://github.com/rust-lang/rust/commit/c0ca57a6fb176d8082eac0ba1de4690f4c0eb0bb"}, {"sha": "4a7b710031de43c2d126ea42ac5f8b9c23201803", "url": "https://api.github.com/repos/rust-lang/rust/commits/4a7b710031de43c2d126ea42ac5f8b9c23201803", "html_url": "https://github.com/rust-lang/rust/commit/4a7b710031de43c2d126ea42ac5f8b9c23201803"}], "stats": {"total": 32, "additions": 8, "deletions": 24}, "files": [{"sha": "2413a001ee8053b5bdbf9d90c8c0836f332c8bb7", "filename": "src/compiletest/header.rs", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Fcompiletest%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Fcompiletest%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fheader.rs?ref=ac0c2fb5f12277617834e1e55b2960e05740139d", "patch": "@@ -42,8 +42,6 @@ pub struct TestProps {\n     pub pretty_compare_only: bool,\n     // Patterns which must not appear in the output of a cfail test.\n     pub forbid_output: Vec<String>,\n-    // Ignore errors which originate from a command line span\n-    pub ignore_command_line: bool,\n }\n \n // Load any test directives embedded in the file\n@@ -62,8 +60,6 @@ pub fn load_props(testfile: &Path) -> TestProps {\n     let mut pretty_mode = None;\n     let mut pretty_compare_only = false;\n     let mut forbid_output = Vec::new();\n-    let mut ignore_command_line = false;\n-\n     iter_header(testfile, |ln| {\n         match parse_error_pattern(ln) {\n           Some(ep) => error_patterns.push(ep),\n@@ -106,10 +102,6 @@ pub fn load_props(testfile: &Path) -> TestProps {\n             pretty_compare_only = parse_pretty_compare_only(ln);\n         }\n \n-        if !ignore_command_line {\n-            ignore_command_line = parse_ignore_command_line(ln);\n-        }\n-\n         match parse_aux_build(ln) {\n             Some(ab) => { aux_builds.push(ab); }\n             None => {}\n@@ -148,7 +140,6 @@ pub fn load_props(testfile: &Path) -> TestProps {\n         pretty_mode: pretty_mode.unwrap_or(\"normal\".to_string()),\n         pretty_compare_only: pretty_compare_only,\n         forbid_output: forbid_output,\n-        ignore_command_line: ignore_command_line,\n     }\n }\n \n@@ -300,10 +291,6 @@ fn parse_pretty_compare_only(line: &str) -> bool {\n     parse_name_directive(line, \"pretty-compare-only\")\n }\n \n-fn parse_ignore_command_line(line: &str) -> bool {\n-    parse_name_directive(line, \"ignore-command-line\")\n-}\n-\n fn parse_exec_env(line: &str) -> Option<(String, String)> {\n     parse_name_value_directive(line, \"exec-env\").map(|nv| {\n         // nv is either FOO or FOO=BAR"}, {"sha": "5de93c52029226503abbeee5d715f139e36057ca", "filename": "src/compiletest/runtest.rs", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=ac0c2fb5f12277617834e1e55b2960e05740139d", "patch": "@@ -104,7 +104,7 @@ fn run_cfail_test(config: &Config, props: &TestProps, testfile: &Path) {\n         if !props.error_patterns.is_empty() {\n             fatal(\"both error pattern and expected errors specified\");\n         }\n-        check_expected_errors(props, expected_errors, testfile, &proc_res);\n+        check_expected_errors(expected_errors, testfile, &proc_res);\n     } else {\n         check_error_patterns(props, testfile, output_to_check.as_slice(), &proc_res);\n     }\n@@ -941,8 +941,7 @@ fn check_forbid_output(props: &TestProps,\n     }\n }\n \n-fn check_expected_errors(props: &TestProps,\n-                         expected_errors: Vec<errors::ExpectedError> ,\n+fn check_expected_errors(expected_errors: Vec<errors::ExpectedError> ,\n                          testfile: &Path,\n                          proc_res: &ProcRes) {\n \n@@ -997,11 +996,6 @@ fn check_expected_errors(props: &TestProps,\n             was_expected = true;\n         }\n \n-        if line.starts_with(\"<command line option>\") &&\n-           props.ignore_command_line {\n-            was_expected = true;\n-        }\n-\n         if !was_expected && is_compiler_error_or_warning(line) {\n             fatal_proc_rec(format!(\"unexpected compiler error or warning: '{}'\",\n                                   line).as_slice(),"}, {"sha": "3f81dac2b0d6224afcc608e887690a65ad140e1a", "filename": "src/libsyntax/diagnostic.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Flibsyntax%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Flibsyntax%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostic.rs?ref=ac0c2fb5f12277617834e1e55b2960e05740139d", "patch": "@@ -13,7 +13,7 @@ pub use self::RenderSpan::*;\n pub use self::ColorConfig::*;\n use self::Destination::*;\n \n-use codemap::{COMMAND_LINE_SP, Pos, Span};\n+use codemap::{COMMAND_LINE_SP, COMMAND_LINE_EXPN, Pos, Span};\n use codemap;\n use diagnostics;\n \n@@ -393,7 +393,10 @@ impl Emitter for EmitterWriter {\n fn emit(dst: &mut EmitterWriter, cm: &codemap::CodeMap, rsp: RenderSpan,\n         msg: &str, code: Option<&str>, lvl: Level, custom: bool) -> io::IoResult<()> {\n     let sp = rsp.span();\n-    let ss = if sp == COMMAND_LINE_SP {\n+\n+    // We cannot check equality directly with COMMAND_LINE_SP\n+    // since PartialEq is manually implemented to ignore the ExpnId\n+    let ss = if sp.expn_id == COMMAND_LINE_EXPN {\n         \"<command line option>\".to_string()\n     } else {\n         cm.span_to_string(sp)"}, {"sha": "ffc21a5ce612326c9ef5e895a6526628679a841c", "filename": "src/test/compile-fail/recursion.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Ftest%2Fcompile-fail%2Frecursion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac0c2fb5f12277617834e1e55b2960e05740139d/src%2Ftest%2Fcompile-fail%2Frecursion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Frecursion.rs?ref=ac0c2fb5f12277617834e1e55b2960e05740139d", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// ignore-command-line: See https://github.com/rust-lang/rust/issues/20747\n+//~^^^^^^^^^^ ERROR overflow\n //\n // We also get a second error message at the top of file (dummy\n // span). This is not helpful, but also kind of annoying to prevent,"}]}