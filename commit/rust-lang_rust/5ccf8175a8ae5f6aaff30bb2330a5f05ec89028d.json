{"sha": "5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjY2Y4MTc1YThhZTVmNmFhZmYzMGJiMjMzMGE1ZjA1ZWM4OTAyOGQ=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-08-24T00:02:41Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-08-24T00:55:04Z"}, "message": "don't consider use of `@fn` to be region-param'd", "tree": {"sha": "6e1716b353995be25b059630cbea0d8570270887", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e1716b353995be25b059630cbea0d8570270887"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d", "html_url": "https://github.com/rust-lang/rust/commit/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "feca839b9bd1ca8f8dac2533e6d87c62b1c1a02d", "url": "https://api.github.com/repos/rust-lang/rust/commits/feca839b9bd1ca8f8dac2533e6d87c62b1c1a02d", "html_url": "https://github.com/rust-lang/rust/commit/feca839b9bd1ca8f8dac2533e6d87c62b1c1a02d"}], "stats": {"total": 41, "additions": 41, "deletions": 0}, "files": [{"sha": "17d4eaa598424572093193ca245883945e651ddf", "filename": "src/rustc/middle/region.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d/src%2Frustc%2Fmiddle%2Fregion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d/src%2Frustc%2Fmiddle%2Fregion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Fregion.rs?ref=5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d", "patch": "@@ -655,6 +655,25 @@ fn determine_rp_in_ty(ty: @ast::ty,\n       _ => {}\n     }\n \n+    // temporary hack: right now, fn() is short for &fn(), but @(fn())\n+    // is `@fn()`, so catch this and set anon_implies_rp to none in\n+    // that case\n+    match ty.node {\n+      ast::ty_box(mt) | ast::ty_uniq(mt) => {\n+        match mt.ty.node {\n+          ast::ty_fn(ast::proto_bare, _, _) |\n+          ast::ty_fn(ast::proto_block, _, _) => {\n+            do cx.with(cx.item_id, false) {\n+                visit_mt(mt, cx, visitor);\n+            }\n+            return;\n+          }\n+          _ => {}\n+        }\n+      }\n+      _ => {}\n+    }\n+\n     match ty.node {\n       ast::ty_box(mt) | ast::ty_uniq(mt) | ast::ty_vec(mt) |\n       ast::ty_rptr(_, mt) | ast::ty_ptr(mt) => {"}, {"sha": "385372f5c43246d04e13ba4e3522061b47e140d9", "filename": "src/test/compile-fail/regions-infer-at-fn-not-param.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d/src%2Ftest%2Fcompile-fail%2Fregions-infer-at-fn-not-param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d/src%2Ftest%2Fcompile-fail%2Fregions-infer-at-fn-not-param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fregions-infer-at-fn-not-param.rs?ref=5ccf8175a8ae5f6aaff30bb2330a5f05ec89028d", "patch": "@@ -0,0 +1,22 @@\n+struct param1 {\n+    g: &fn();\n+}\n+\n+struct param2 {\n+    g: fn();\n+}\n+\n+struct not_param1 {\n+    g: @fn();\n+}\n+\n+struct not_param2 {\n+    g: @fn();\n+}\n+\n+fn take1(p: param1) -> param1 { p } //~ ERROR mismatched types\n+fn take2(p: param2) -> param2 { p } //~ ERROR mismatched types\n+fn take3(p: not_param1) -> not_param1 { p }\n+fn take4(p: not_param2) -> not_param2 { p }\n+\n+fn main() {}"}]}