{"sha": "748e6881fc528cdafb0a0c257b0e00a7d1f495bb", "node_id": "C_kwDOAAsO6NoAKDc0OGU2ODgxZmM1MjhjZGFmYjBhMGMyNTdiMGUwMGE3ZDFmNDk1YmI", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T09:52:28Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T09:52:28Z"}, "message": "move tests", "tree": {"sha": "4091a55adf02425cc142aab9ae1ac48550bac78f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4091a55adf02425cc142aab9ae1ac48550bac78f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/748e6881fc528cdafb0a0c257b0e00a7d1f495bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/748e6881fc528cdafb0a0c257b0e00a7d1f495bb", "html_url": "https://github.com/rust-lang/rust/commit/748e6881fc528cdafb0a0c257b0e00a7d1f495bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/748e6881fc528cdafb0a0c257b0e00a7d1f495bb/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6fd2f1d25b807a72660034dd05e80abf3c462594", "url": "https://api.github.com/repos/rust-lang/rust/commits/6fd2f1d25b807a72660034dd05e80abf3c462594", "html_url": "https://github.com/rust-lang/rust/commit/6fd2f1d25b807a72660034dd05e80abf3c462594"}], "stats": {"total": 68, "additions": 40, "deletions": 28}, "files": [{"sha": "d113a2f504b4bd5d9a55033bb1bc9a5c7261c0b6", "filename": "crates/hir_def/src/macro_expansion_tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/748e6881fc528cdafb0a0c257b0e00a7d1f495bb/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/748e6881fc528cdafb0a0c257b0e00a7d1f495bb/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs?ref=748e6881fc528cdafb0a0c257b0e00a7d1f495bb", "patch": "@@ -128,7 +128,7 @@ fn pretty_print_macro_expansion(expn: SyntaxNode) -> String {\n             (T![>], _) if curr_kind.is_keyword() => \" \",\n             (T![->], _) | (_, T![->]) => \" \",\n             (T![&&], _) | (_, T![&&]) => \" \",\n-            (T![,], _) => \" \",\n+            (T![,] | T![:], _) => \" \",\n             (T![fn], T!['(']) => \"\",\n             (T![']'], _) if curr_kind.is_keyword() => \" \",\n             (T![']'], T![#]) => \"\\n\","}, {"sha": "3ac8f706b6ed0b1100ccc273b51297a2ee0808ee", "filename": "crates/hir_def/src/macro_expansion_tests/mbe.rs", "status": "modified", "additions": 39, "deletions": 6, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/748e6881fc528cdafb0a0c257b0e00a7d1f495bb/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/748e6881fc528cdafb0a0c257b0e00a7d1f495bb/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs?ref=748e6881fc528cdafb0a0c257b0e00a7d1f495bb", "patch": "@@ -35,12 +35,12 @@ macro_rules! impl_froms {\n     }\n }\n impl From<Leaf> for TokenTree {\n-    fn from(it:Leaf) -> TokenTree {\n+    fn from(it: Leaf) -> TokenTree {\n         TokenTree::Leaf(it)\n     }\n }\n impl From<Subtree> for TokenTree {\n-    fn from(it:Subtree) -> TokenTree {\n+    fn from(it: Subtree) -> TokenTree {\n         TokenTree::Subtree(it)\n     }\n }\n@@ -433,10 +433,10 @@ macro_rules! structs {\n }\n \n struct Foo {\n-    field:u32\n+    field: u32\n }\n struct Bar {\n-    field:u32\n+    field: u32\n }\n // MACRO_ITEMS@0..40\n //   STRUCT@0..20\n@@ -906,8 +906,8 @@ extern crate a;\n mod b;\n mod c {}\n use d;\n-const E:i32 = 0;\n-static F:i32 = 0;\n+const E: i32 = 0;\n+static F: i32 = 0;\n impl G {}\n struct H;\n enum I {\n@@ -1239,3 +1239,36 @@ struct Ref<'a> {\n \"#]],\n     );\n }\n+\n+#[test]\n+fn test_literal() {\n+    check(\n+        r#\"\n+macro_rules! m {\n+    ($type:ty, $lit:literal) => { const VALUE: $type = $ lit; };\n+}\n+m!(u8, 0);\n+\"#,\n+        expect![[r#\"\n+macro_rules! m {\n+    ($type:ty, $lit:literal) => { const VALUE: $type = $ lit; };\n+}\n+const VALUE: u8 = 0;\n+\"#]],\n+    );\n+\n+    check(\n+        r#\"\n+macro_rules! m {\n+    ($type:ty, $lit:literal) => { const VALUE: $ type = $ lit; };\n+}\n+m!(i32, -1);\n+\"#,\n+        expect![[r#\"\n+macro_rules! m {\n+    ($type:ty, $lit:literal) => { const VALUE: $ type = $ lit; };\n+}\n+const VALUE: i32 = -1;\n+\"#]],\n+    );\n+}"}, {"sha": "67543df5838c2dad8f9be9630b01846d79e53ffc", "filename": "crates/mbe/src/tests/expand.rs", "status": "modified", "additions": 0, "deletions": 21, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/748e6881fc528cdafb0a0c257b0e00a7d1f495bb/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/748e6881fc528cdafb0a0c257b0e00a7d1f495bb/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs?ref=748e6881fc528cdafb0a0c257b0e00a7d1f495bb", "patch": "@@ -101,27 +101,6 @@ fn test_attr_to_token_tree() {\n     );\n }\n \n-#[test]\n-fn test_literal() {\n-    parse_macro(\n-        r#\"\n-        macro_rules! foo {\n-              ($ type:ty , $ lit:literal) => { const VALUE: $ type = $ lit;};\n-        }\n-\"#,\n-    )\n-    .assert_expand_items(r#\"foo!(u8,0);\"#, r#\"const VALUE : u8 = 0 ;\"#);\n-\n-    parse_macro(\n-        r#\"\n-        macro_rules! foo {\n-              ($ type:ty , $ lit:literal) => { const VALUE: $ type = $ lit;};\n-        }\n-\"#,\n-    )\n-    .assert_expand_items(r#\"foo!(i32,-1);\"#, r#\"const VALUE : i32 = - 1 ;\"#);\n-}\n-\n #[test]\n fn test_boolean_is_ident() {\n     parse_macro("}]}