{"sha": "215baae2238971361c5f92accfae35ba0ad6c634", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxNWJhYWUyMjM4OTcxMzYxYzVmOTJhY2NmYWUzNWJhMGFkNmM2MzQ=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2018-05-04T18:12:06Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2018-05-06T07:58:03Z"}, "message": "Add a test for non-mod.rs mods", "tree": {"sha": "4d5d4b9d5fa7f308ca6863516b5a57a3aae56ec3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4d5d4b9d5fa7f308ca6863516b5a57a3aae56ec3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/215baae2238971361c5f92accfae35ba0ad6c634", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/215baae2238971361c5f92accfae35ba0ad6c634", "html_url": "https://github.com/rust-lang/rust/commit/215baae2238971361c5f92accfae35ba0ad6c634", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/215baae2238971361c5f92accfae35ba0ad6c634/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cf573e815712e1e617e895621a4faa859aa3d86e", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf573e815712e1e617e895621a4faa859aa3d86e", "html_url": "https://github.com/rust-lang/rust/commit/cf573e815712e1e617e895621a4faa859aa3d86e"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "80a7e85c71def304fa72e688f384e22e082f780e", "filename": "src/modules.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/215baae2238971361c5f92accfae35ba0ad6c634/src%2Fmodules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/215baae2238971361c5f92accfae35ba0ad6c634/src%2Fmodules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmodules.rs?ref=215baae2238971361c5f92accfae35ba0ad6c634", "patch": "@@ -75,7 +75,6 @@ fn module_file(\n     relative: Option<ast::Ident>,\n     codemap: &codemap::CodeMap,\n ) -> Result<(PathBuf, Option<ast::Ident>), io::Error> {\n-    eprintln!(\"module_file {:?} {:?} {:?}\", id, attrs, dir_path);\n     if let Some(path) = parser::Parser::submod_path_from_attr(attrs, dir_path) {\n         return Ok((path, None));\n     }"}, {"sha": "c58989508130355b7a90b2753aa7f3f9002eef4b", "filename": "src/test/mod.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/215baae2238971361c5f92accfae35ba0ad6c634/src%2Ftest%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/215baae2238971361c5f92accfae35ba0ad6c634/src%2Ftest%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmod.rs?ref=215baae2238971361c5f92accfae35ba0ad6c634", "patch": "@@ -232,6 +232,23 @@ fn self_tests() {\n     );\n }\n \n+#[test]\n+fn issue_2673_non_modrs_mods() {\n+    match idempotent_check(&PathBuf::from(\"tests/issue-2673-nonmodrs-mods/lib.rs\")) {\n+        Ok(ref report) if report.has_warnings() => {\n+            print!(\"{}\", report);\n+            panic!(\"had warnings\");\n+        }\n+        Ok(_report) => {}\n+        Err(err) => {\n+            if let IdempotentCheckError::Mismatch(msg) = err {\n+                print_mismatches_default_message(msg);\n+            }\n+            panic!(\"had errors\");\n+        }\n+    }\n+}\n+\n #[test]\n fn stdin_formatting_smoke_test() {\n     let input = Input::Text(\"fn main () {}\".to_owned());"}, {"sha": "c9fb22cf1a6b8ff20a14125f8dc91ac848513197", "filename": "tests/issue-2673-nonmodrs-mods/foo.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/215baae2238971361c5f92accfae35ba0ad6c634/tests%2Fissue-2673-nonmodrs-mods%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/215baae2238971361c5f92accfae35ba0ad6c634/tests%2Fissue-2673-nonmodrs-mods%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fissue-2673-nonmodrs-mods%2Ffoo.rs?ref=215baae2238971361c5f92accfae35ba0ad6c634", "patch": "@@ -0,0 +1,3 @@\n+mod bar;\n+\n+mod baz {}"}, {"sha": "9ceacd59d86f779890861cee8d5c2b0af759b6a6", "filename": "tests/issue-2673-nonmodrs-mods/foo/bar.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/215baae2238971361c5f92accfae35ba0ad6c634/tests%2Fissue-2673-nonmodrs-mods%2Ffoo%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/215baae2238971361c5f92accfae35ba0ad6c634/tests%2Fissue-2673-nonmodrs-mods%2Ffoo%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fissue-2673-nonmodrs-mods%2Ffoo%2Fbar.rs?ref=215baae2238971361c5f92accfae35ba0ad6c634", "patch": "@@ -0,0 +1 @@\n+fn dummy() {}"}, {"sha": "e2025a5449d8b041b9f36aab1f4549d94e2cef3b", "filename": "tests/issue-2673-nonmodrs-mods/lib.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/215baae2238971361c5f92accfae35ba0ad6c634/tests%2Fissue-2673-nonmodrs-mods%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/215baae2238971361c5f92accfae35ba0ad6c634/tests%2Fissue-2673-nonmodrs-mods%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fissue-2673-nonmodrs-mods%2Flib.rs?ref=215baae2238971361c5f92accfae35ba0ad6c634", "patch": "@@ -0,0 +1,3 @@\n+#![feature(non_modrs_mods)]\n+\n+mod foo;"}]}