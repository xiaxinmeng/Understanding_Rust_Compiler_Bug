{"sha": "ef3e360c4bb38de90ef7f39531e83a8978c05863", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmM2UzNjBjNGJiMzhkZTkwZWY3ZjM5NTMxZTgzYTg5NzhjMDU4NjM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-01-11T03:02:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-11T03:02:25Z"}, "message": "Rollup merge of #68074 - matthew-healy:skip-llvm-rebuild-option, r=Centril\n\nAdd `llvm-skip-rebuild` flag to `x.py`\n\nThis PR follows on from #67437 to complete the feature request from #65612.\n\nSpecifically it adds a new command-line flag, `--llvm-skip-rebuild`, which overrides both any value set in `config.toml` and the default value (`false`).\n\nI'm not 100% confident that I've implemented the override in the \"best\" way, but I've checked it locally and it seems to work at least.\n\nThis option isn't currently mentioned in the Guide to Rustc Development. I'd be happy to write something on it if folk think that's worthwhile.", "tree": {"sha": "d05c349311fb8867955126a2ee12ae5aad6d246f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d05c349311fb8867955126a2ee12ae5aad6d246f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef3e360c4bb38de90ef7f39531e83a8978c05863", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeGTrCCRBK7hj4Ov3rIwAAdHIIAKOhVUp9cljuasSRfcl/kdt3\nfCGm9B2oJXFJkQimNbcu/DjKBCN1RDyPOHfNDnINeOwsBxDlXR+K2VssML0oo/I8\nAeXpQnpne9mW3aIskTbSxfFUKuZOlQ3/sqVMEx4rs0spLugQLducz9t+Kh24i+rr\nZtaa8Ws/PdFCkN5AmZChuxI2tgp3BpFaJPAnT638OTRTHGBzXBp4U5W15a04IoOZ\n1frpQcBfPN8QYgtOwiCwRKGsB4WnWJQsT/ipc9IngRwNcP6oR/V69M39p/70Dv3p\nFhBfQSzuR9+7DYKWnll+rWU4Z+0C+VOaHvjoF5oRgc3nejHF3bfhPCmYc/fDbWM=\n=weXQ\n-----END PGP SIGNATURE-----\n", "payload": "tree d05c349311fb8867955126a2ee12ae5aad6d246f\nparent 8c0c5c7e65479eaac21b26980efeff7a9b893e60\nparent 7e50b599bfeb75f7be1d5a1fa855e37ec6d0e65d\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1578711745 +0100\ncommitter GitHub <noreply@github.com> 1578711745 +0100\n\nRollup merge of #68074 - matthew-healy:skip-llvm-rebuild-option, r=Centril\n\nAdd `llvm-skip-rebuild` flag to `x.py`\n\nThis PR follows on from #67437 to complete the feature request from #65612.\n\nSpecifically it adds a new command-line flag, `--llvm-skip-rebuild`, which overrides both any value set in `config.toml` and the default value (`false`).\n\nI'm not 100% confident that I've implemented the override in the \"best\" way, but I've checked it locally and it seems to work at least.\n\nThis option isn't currently mentioned in the Guide to Rustc Development. I'd be happy to write something on it if folk think that's worthwhile.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef3e360c4bb38de90ef7f39531e83a8978c05863", "html_url": "https://github.com/rust-lang/rust/commit/ef3e360c4bb38de90ef7f39531e83a8978c05863", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef3e360c4bb38de90ef7f39531e83a8978c05863/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c0c5c7e65479eaac21b26980efeff7a9b893e60", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c0c5c7e65479eaac21b26980efeff7a9b893e60", "html_url": "https://github.com/rust-lang/rust/commit/8c0c5c7e65479eaac21b26980efeff7a9b893e60"}, {"sha": "7e50b599bfeb75f7be1d5a1fa855e37ec6d0e65d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e50b599bfeb75f7be1d5a1fa855e37ec6d0e65d", "html_url": "https://github.com/rust-lang/rust/commit/7e50b599bfeb75f7be1d5a1fa855e37ec6d0e65d"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "110c8b844d54c6d68357b3161e753fda23c7d2a1", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ef3e360c4bb38de90ef7f39531e83a8978c05863/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef3e360c4bb38de90ef7f39531e83a8978c05863/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=ef3e360c4bb38de90ef7f39531e83a8978c05863", "patch": "@@ -493,9 +493,13 @@ impl Config {\n             config.mandir = install.mandir.clone().map(PathBuf::from);\n         }\n \n+        // We want the llvm-skip-rebuild flag to take precedence over the\n+        // skip-rebuild config.toml option so we store it separately\n+        // so that we can infer the right value\n+        let mut llvm_skip_rebuild = flags.llvm_skip_rebuild;\n+\n         // Store off these values as options because if they're not provided\n         // we'll infer default values for them later\n-        let mut llvm_skip_rebuild = None;\n         let mut llvm_assertions = None;\n         let mut debug = None;\n         let mut debug_assertions = None;\n@@ -517,7 +521,7 @@ impl Config {\n             }\n             set(&mut config.ninja, llvm.ninja);\n             llvm_assertions = llvm.assertions;\n-            llvm_skip_rebuild = llvm.skip_rebuild;\n+            llvm_skip_rebuild = llvm_skip_rebuild.or(llvm.skip_rebuild);\n             set(&mut config.llvm_optimize, llvm.optimize);\n             set(&mut config.llvm_thin_lto, llvm.thin_lto);\n             set(&mut config.llvm_release_debuginfo, llvm.release_debuginfo);"}, {"sha": "1fbdd50a51133d4636c7b1bf5069c887a32dfcb0", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ef3e360c4bb38de90ef7f39531e83a8978c05863/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef3e360c4bb38de90ef7f39531e83a8978c05863/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=ef3e360c4bb38de90ef7f39531e83a8978c05863", "patch": "@@ -38,6 +38,8 @@ pub struct Flags {\n     //\n     // true => deny, false => warn\n     pub deny_warnings: Option<bool>,\n+\n+    pub llvm_skip_rebuild: Option<bool>,\n }\n \n pub enum Subcommand {\n@@ -150,6 +152,14 @@ To learn more about a subcommand, run `./x.py <subcommand> -h`\",\n             \"VALUE\",\n         );\n         opts.optopt(\"\", \"error-format\", \"rustc error format\", \"FORMAT\");\n+        opts.optopt(\n+            \"\",\n+            \"llvm-skip-rebuild\",\n+            \"whether rebuilding llvm should be skipped \\\n+             a VALUE of TRUE indicates that llvm will not be rebuilt \\\n+             VALUE overrides the skip-rebuild option in config.toml.\",\n+            \"VALUE\",\n+        );\n \n         // fn usage()\n         let usage =\n@@ -487,6 +497,9 @@ Arguments:\n                 .map(|p| p.into())\n                 .collect::<Vec<_>>(),\n             deny_warnings: parse_deny_warnings(&matches),\n+            llvm_skip_rebuild: matches.opt_str(\"llvm-skip-rebuild\").map(|s| s.to_lowercase()).map(\n+                |s| s.parse::<bool>().expect(\"`llvm-skip-rebuild` should be either true or false\"),\n+            ),\n         }\n     }\n }"}]}