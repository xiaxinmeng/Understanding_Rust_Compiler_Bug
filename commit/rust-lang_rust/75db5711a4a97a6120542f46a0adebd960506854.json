{"sha": "75db5711a4a97a6120542f46a0adebd960506854", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1ZGI1NzExYTRhOTdhNjEyMDU0MmY0NmEwYWRlYmQ5NjA1MDY4NTQ=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-16T15:09:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-16T15:09:41Z"}, "message": "Rollup merge of #64467 - Mark-Simulacrum:hide-cfg-failures, r=estebank\n\nHide diagnostics emitted during --cfg parsing\n\nThe early error is more than sufficient for fixing the problem.\n\nFixes https://github.com/rust-lang/rust/issues/31496.", "tree": {"sha": "1e5e39cbd4553d624624aa3b40959e83b711b4f9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e5e39cbd4553d624624aa3b40959e83b711b4f9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75db5711a4a97a6120542f46a0adebd960506854", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdf6W1CRBK7hj4Ov3rIwAAdHIIABZ9GHg3hTzRvVRgODmdBuCn\nBE1C5b6ux9GjQ87FdCk9DKMvx9FkhCpa7VhXnVCX2kNIQs0srOSqSL1Tzg66m1Jn\nUxvFQmAt/FIftcFKX0q/V2f/jwhy294A5kpRfrlMoXEIh+rNeLaRtO3kBsUAnrJH\n7JnT5aJKUVezU8E/k2XJbZ77JldnrOX5MCMn3SV8tHK16qVtJ0KvLIJdi0XraBSu\n8jH9uq/CCELCYvQx1aS5czIPbWM43QH4AuTYlsKlVkUpeETaGLbDxpPXbVY1BGZy\naDr0hZfCTX7h7d2vgikLRPsp/72rSP9cWII44XcOKZQ6arXwKZqmMyn+MoA3HIo=\n=k7mS\n-----END PGP SIGNATURE-----\n", "payload": "tree 1e5e39cbd4553d624624aa3b40959e83b711b4f9\nparent 7975973e2b806a7ee8e54b40f9e774528a777e31\nparent a678e3191197f145451c97c6cc884e15cae38186\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1568646581 +0200\ncommitter GitHub <noreply@github.com> 1568646581 +0200\n\nRollup merge of #64467 - Mark-Simulacrum:hide-cfg-failures, r=estebank\n\nHide diagnostics emitted during --cfg parsing\n\nThe early error is more than sufficient for fixing the problem.\n\nFixes https://github.com/rust-lang/rust/issues/31496.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75db5711a4a97a6120542f46a0adebd960506854", "html_url": "https://github.com/rust-lang/rust/commit/75db5711a4a97a6120542f46a0adebd960506854", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75db5711a4a97a6120542f46a0adebd960506854/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7975973e2b806a7ee8e54b40f9e774528a777e31", "url": "https://api.github.com/repos/rust-lang/rust/commits/7975973e2b806a7ee8e54b40f9e774528a777e31", "html_url": "https://github.com/rust-lang/rust/commit/7975973e2b806a7ee8e54b40f9e774528a777e31"}, {"sha": "a678e3191197f145451c97c6cc884e15cae38186", "url": "https://api.github.com/repos/rust-lang/rust/commits/a678e3191197f145451c97c6cc884e15cae38186", "html_url": "https://github.com/rust-lang/rust/commit/a678e3191197f145451c97c6cc884e15cae38186"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "723855c7c29cf11b03f572dfef7a99b7b74e95e7", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/75db5711a4a97a6120542f46a0adebd960506854/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75db5711a4a97a6120542f46a0adebd960506854/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=75db5711a4a97a6120542f46a0adebd960506854", "patch": "@@ -7,6 +7,7 @@ use crate::session::{early_error, early_warn, Session};\n use crate::session::search_paths::SearchPath;\n \n use rustc_data_structures::fx::FxHashSet;\n+use rustc_data_structures::sync::Lrc;\n \n use rustc_target::spec::{LinkerFlavor, MergeFunctions, PanicStrategy, RelroLevel};\n use rustc_target::spec::{Target, TargetTriple};\n@@ -19,6 +20,7 @@ use syntax::parse::{ParseSess, new_parser_from_source_str};\n use syntax::parse::token;\n use syntax::symbol::{sym, Symbol};\n use syntax::feature_gate::UnstableFeatures;\n+use syntax::source_map::SourceMap;\n \n use errors::emitter::HumanReadableErrorType;\n use errors::{ColorConfig, FatalError, Handler};\n@@ -1850,11 +1852,20 @@ pub fn rustc_optgroups() -> Vec<RustcOptGroup> {\n     opts\n }\n \n+struct NullEmitter;\n+\n+impl errors::emitter::Emitter for NullEmitter {\n+    fn emit_diagnostic(&mut self, _: &errors::DiagnosticBuilder<'_>) {}\n+}\n+\n // Converts strings provided as `--cfg [cfgspec]` into a `crate_cfg`.\n pub fn parse_cfgspecs(cfgspecs: Vec<String>) -> FxHashSet<(String, Option<String>)> {\n     syntax::with_default_globals(move || {\n         let cfg = cfgspecs.into_iter().map(|s| {\n-            let sess = ParseSess::new(FilePathMapping::empty());\n+\n+            let cm = Lrc::new(SourceMap::new(FilePathMapping::empty()));\n+            let handler = Handler::with_emitter(false, None, Box::new(NullEmitter));\n+            let sess = ParseSess::with_span_handler(handler, cm);\n             let filename = FileName::cfg_spec_source_code(&s);\n             let mut parser = new_parser_from_source_str(&sess, filename, s.to_string());\n "}, {"sha": "9fa726f93e3eada91f18a11e4d3d7a95964e78fd", "filename": "src/test/ui/conditional-compilation/cfg-arg-invalid-6.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/75db5711a4a97a6120542f46a0adebd960506854/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-6.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75db5711a4a97a6120542f46a0adebd960506854/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-6.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-6.rs?ref=75db5711a4a97a6120542f46a0adebd960506854", "patch": "@@ -0,0 +1,3 @@\n+// compile-flags: --cfg a{\n+// error-pattern: invalid `--cfg` argument: `a{` (expected `key` or `key=\"value\"`)\n+fn main() {}"}, {"sha": "7d2087b4b71f71f91d05f30017635547ebbf896b", "filename": "src/test/ui/conditional-compilation/cfg-arg-invalid-6.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/75db5711a4a97a6120542f46a0adebd960506854/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-6.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/75db5711a4a97a6120542f46a0adebd960506854/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-6.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-6.stderr?ref=75db5711a4a97a6120542f46a0adebd960506854", "patch": "@@ -0,0 +1,2 @@\n+error: invalid `--cfg` argument: `a{` (expected `key` or `key=\"value\"`)\n+"}]}