{"sha": "33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzMTk5YjdlNDM0ZDlkMmJkNWJhN2ExNGM4YzE2ZWY5ODFhMGVkYTc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-09-04T09:27:27Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-09-04T09:27:27Z"}, "message": "fix: don't panic if the client sends invalid request", "tree": {"sha": "6d9575607f64423a3b9d8e663a8f02e02314a37e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d9575607f64423a3b9d8e663a8f02e02314a37e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7", "html_url": "https://github.com/rust-lang/rust/commit/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac2520128dc348529afc99263f82f255d39e047d", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac2520128dc348529afc99263f82f255d39e047d", "html_url": "https://github.com/rust-lang/rust/commit/ac2520128dc348529afc99263f82f255d39e047d"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "28f3fa2786cfdb8cc75d6a1036b112258ca2b5f1", "filename": "crates/rust-analyzer/src/from_proto.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7/crates%2Frust-analyzer%2Fsrc%2Ffrom_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7/crates%2Frust-analyzer%2Fsrc%2Ffrom_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Ffrom_proto.rs?ref=33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7", "patch": "@@ -10,7 +10,7 @@ use crate::{\n     from_json,\n     global_state::GlobalStateSnapshot,\n     line_index::{LineIndex, OffsetEncoding},\n-    lsp_ext, Result,\n+    lsp_ext, LspError, Result,\n };\n \n pub(crate) fn abs_path(url: &lsp_types::Url) -> Result<AbsPathBuf> {\n@@ -85,7 +85,10 @@ pub(crate) fn annotation(\n     snap: &GlobalStateSnapshot,\n     code_lens: lsp_types::CodeLens,\n ) -> Result<Annotation> {\n-    let data = code_lens.data.unwrap();\n+    let data = code_lens.data.ok_or_else(|| LspError {\n+        code: lsp_server::ErrorCode::InvalidParams as i32,\n+        message: \"code lens without data\".to_string(),\n+    });\n     let resolve = from_json::<lsp_ext::CodeLensResolveData>(\"CodeLensResolveData\", data)?;\n \n     match resolve {"}, {"sha": "ed912cb16023f7a4e7a6513cbb4f82f401ac18e1", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=33199b7e434d9d2bd5ba7a14c8c16ef981a0eda7", "patch": "@@ -1038,7 +1038,10 @@ pub(crate) fn handle_code_action_resolve(\n     let _p = profile::span(\"handle_code_action_resolve\");\n     let params = match code_action.data.take() {\n         Some(it) => it,\n-        None => Err(\"can't resolve code action without data\")?,\n+        None => Err(LspError {\n+            code: lsp_server::ErrorCode::InvalidParams as i32,\n+            message: format!(\"code action without data\"),\n+        })?,\n     };\n \n     let file_id = from_proto::file_id(&snap, &params.code_action_params.text_document.uri)?;"}]}