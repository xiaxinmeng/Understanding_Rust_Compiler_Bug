{"sha": "eb51abdc646e11b8c23fee83b6f052d3dde87985", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViNTFhYmRjNjQ2ZTExYjhjMjNmZWU4M2I2ZjA1MmQzZGRlODc5ODU=", "commit": {"author": {"name": "Steffen Lyngbaek", "email": "steffenlyngbaek@gmail.com", "date": "2020-03-18T23:15:32Z"}, "committer": {"name": "Steffen Lyngbaek", "email": "steffenlyngbaek@gmail.com", "date": "2020-03-19T21:12:00Z"}, "message": "Fixes to more accurately give complete_scope completions\n\n- Exclude const, static, functions form is_pat_binding_and_path\n  (there might be more?)\n- Add a check to filter out Record Fields\n- Fix tests", "tree": {"sha": "1459c46b52fa33545a1ba5854cea6fdf053255cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1459c46b52fa33545a1ba5854cea6fdf053255cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb51abdc646e11b8c23fee83b6f052d3dde87985", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb51abdc646e11b8c23fee83b6f052d3dde87985", "html_url": "https://github.com/rust-lang/rust/commit/eb51abdc646e11b8c23fee83b6f052d3dde87985", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb51abdc646e11b8c23fee83b6f052d3dde87985/comments", "author": {"login": "slyngbaek", "id": 1216902, "node_id": "MDQ6VXNlcjEyMTY5MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/1216902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/slyngbaek", "html_url": "https://github.com/slyngbaek", "followers_url": "https://api.github.com/users/slyngbaek/followers", "following_url": "https://api.github.com/users/slyngbaek/following{/other_user}", "gists_url": "https://api.github.com/users/slyngbaek/gists{/gist_id}", "starred_url": "https://api.github.com/users/slyngbaek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/slyngbaek/subscriptions", "organizations_url": "https://api.github.com/users/slyngbaek/orgs", "repos_url": "https://api.github.com/users/slyngbaek/repos", "events_url": "https://api.github.com/users/slyngbaek/events{/privacy}", "received_events_url": "https://api.github.com/users/slyngbaek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "slyngbaek", "id": 1216902, "node_id": "MDQ6VXNlcjEyMTY5MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/1216902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/slyngbaek", "html_url": "https://github.com/slyngbaek", "followers_url": "https://api.github.com/users/slyngbaek/followers", "following_url": "https://api.github.com/users/slyngbaek/following{/other_user}", "gists_url": "https://api.github.com/users/slyngbaek/gists{/gist_id}", "starred_url": "https://api.github.com/users/slyngbaek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/slyngbaek/subscriptions", "organizations_url": "https://api.github.com/users/slyngbaek/orgs", "repos_url": "https://api.github.com/users/slyngbaek/repos", "events_url": "https://api.github.com/users/slyngbaek/events{/privacy}", "received_events_url": "https://api.github.com/users/slyngbaek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6941a7faba49b3927df3106b70b780857d1bab17", "url": "https://api.github.com/repos/rust-lang/rust/commits/6941a7faba49b3927df3106b70b780857d1bab17", "html_url": "https://github.com/rust-lang/rust/commit/6941a7faba49b3927df3106b70b780857d1bab17"}], "stats": {"total": 53, "additions": 38, "deletions": 15}, "files": [{"sha": "e8e676a4c32ce67a71961c73d6c7324f7a413928", "filename": "crates/ra_ide/src/completion/complete_pattern.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/eb51abdc646e11b8c23fee83b6f052d3dde87985/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb51abdc646e11b8c23fee83b6f052d3dde87985/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_pattern.rs?ref=eb51abdc646e11b8c23fee83b6f052d3dde87985", "patch": "@@ -55,6 +55,20 @@ mod tests {\n         );\n         assert_debug_snapshot!(completions, @r###\"\n         [\n+            CompletionItem {\n+                label: \"Bar\",\n+                source_range: [246; 246),\n+                delete: [246; 246),\n+                insert: \"Bar\",\n+                kind: Struct,\n+            },\n+            CompletionItem {\n+                label: \"E\",\n+                source_range: [246; 246),\n+                delete: [246; 246),\n+                insert: \"E\",\n+                kind: Enum,\n+            },\n             CompletionItem {\n                 label: \"E\",\n                 source_range: [246; 246),\n@@ -69,6 +83,13 @@ mod tests {\n                 insert: \"X\",\n                 kind: EnumVariant,\n             },\n+            CompletionItem {\n+                label: \"X\",\n+                source_range: [246; 246),\n+                delete: [246; 246),\n+                insert: \"X\",\n+                kind: EnumVariant,\n+            },\n             CompletionItem {\n                 label: \"Z\",\n                 source_range: [246; 246),\n@@ -83,6 +104,13 @@ mod tests {\n                 insert: \"m\",\n                 kind: Module,\n             },\n+            CompletionItem {\n+                label: \"m\",\n+                source_range: [246; 246),\n+                delete: [246; 246),\n+                insert: \"m\",\n+                kind: Module,\n+            },\n         ]\n         \"###);\n     }"}, {"sha": "1cb2ed07085765d0bbc09dadc0e569fa28d5e2c6", "filename": "crates/ra_ide/src/completion/complete_scope.rs", "status": "modified", "additions": 5, "deletions": 12, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/eb51abdc646e11b8c23fee83b6f052d3dde87985/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb51abdc646e11b8c23fee83b6f052d3dde87985/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=eb51abdc646e11b8c23fee83b6f052d3dde87985", "patch": "@@ -1,15 +1,18 @@\n //! Completion of names from the current scope, e.g. locals and imported items.\n \n use crate::completion::{CompletionContext, Completions};\n-use hir::ScopeDef;\n+use hir::{ModuleDef, ScopeDef};\n \n pub(super) fn complete_scope(acc: &mut Completions, ctx: &CompletionContext) {\n     if !ctx.is_trivial_path && !ctx.is_pat_binding_and_path {\n         return;\n     }\n \n     ctx.scope().process_all_names(&mut |name, res| match (ctx.is_pat_binding_and_path, &res) {\n-        (true, ScopeDef::Local(..)) => {}\n+        (true, ScopeDef::ModuleDef(ModuleDef::Function(..))) => (),\n+        (true, ScopeDef::ModuleDef(ModuleDef::Static(..))) => (),\n+        (true, ScopeDef::ModuleDef(ModuleDef::Const(..))) => (),\n+        (true, ScopeDef::Local(..)) => (),\n         _ => acc.add_resolution(ctx, name.to_string(), &res),\n     });\n }\n@@ -71,16 +74,6 @@ mod tests {\n                     insert: \"Enum\",\n                     kind: Enum,\n                 },\n-                CompletionItem {\n-                    label: \"quux(\u2026)\",\n-                    source_range: [231; 233),\n-                    delete: [231; 233),\n-                    insert: \"quux(${1:x})$0\",\n-                    kind: Function,\n-                    lookup: \"quux\",\n-                    detail: \"fn quux(x: Option<Enum>)\",\n-                    trigger_call_info: true,\n-                },\n             ]\n             \"###\n         );"}, {"sha": "65bdac18263f4d6f98f4442106dc395c51f342dd", "filename": "crates/ra_ide/src/completion/completion_context.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/eb51abdc646e11b8c23fee83b6f052d3dde87985/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcompletion_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb51abdc646e11b8c23fee83b6f052d3dde87985/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcompletion_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcompletion_context.rs?ref=eb51abdc646e11b8c23fee83b6f052d3dde87985", "patch": "@@ -197,9 +197,11 @@ impl<'a> CompletionContext<'a> {\n                     self.is_pat_binding = true;\n                 }\n \n-                let bind_pat_string = bind_pat.syntax().to_string();\n-                if !bind_pat_string.contains(\"ref \") && !bind_pat_string.contains(\" @ \") {\n-                    self.is_pat_binding_and_path = true;\n+                if parent.and_then(ast::RecordFieldPatList::cast).is_none() {\n+                    let bind_pat_string = bind_pat.syntax().to_string();\n+                    if !bind_pat_string.contains(\"ref \") && !bind_pat_string.contains(\" @ \") {\n+                        self.is_pat_binding_and_path = true;\n+                    }\n                 }\n             }\n             if is_node::<ast::Param>(name.syntax()) {"}]}