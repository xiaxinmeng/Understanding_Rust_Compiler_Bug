{"sha": "2cedd86b1c25db321e7e023f6a429e23425a7e00", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjZWRkODZiMWMyNWRiMzIxZTdlMDIzZjZhNDI5ZTIzNDI1YTdlMDA=", "commit": {"author": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-06-17T14:45:26Z"}, "committer": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-06-17T14:45:26Z"}, "message": "Fix ICE when using `#[doc(keyword = \"...\")]` on non-items", "tree": {"sha": "4b1ce63f4306558f9cdfcb9c7e1489f34828eb8b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b1ce63f4306558f9cdfcb9c7e1489f34828eb8b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2cedd86b1c25db321e7e023f6a429e23425a7e00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2cedd86b1c25db321e7e023f6a429e23425a7e00", "html_url": "https://github.com/rust-lang/rust/commit/2cedd86b1c25db321e7e023f6a429e23425a7e00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2cedd86b1c25db321e7e023f6a429e23425a7e00/comments", "author": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b17d9c1332693fc386f5374f0d63aae0ce5abab5", "url": "https://api.github.com/repos/rust-lang/rust/commits/b17d9c1332693fc386f5374f0d63aae0ce5abab5", "html_url": "https://github.com/rust-lang/rust/commit/b17d9c1332693fc386f5374f0d63aae0ce5abab5"}], "stats": {"total": 25, "additions": 23, "deletions": 2}, "files": [{"sha": "e85392cf0bda5b2bf615515821343d54db32f334", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2cedd86b1c25db321e7e023f6a429e23425a7e00/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cedd86b1c25db321e7e023f6a429e23425a7e00/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=2cedd86b1c25db321e7e023f6a429e23425a7e00", "patch": "@@ -525,8 +525,11 @@ impl CheckAttrVisitor<'tcx> {\n             self.doc_attr_str_error(meta, \"keyword\");\n             return false;\n         }\n-        match self.tcx.hir().expect_item(hir_id).kind {\n-            ItemKind::Mod(ref module) => {\n+        match self.tcx.hir().find(hir_id).and_then(|node| match node {\n+            hir::Node::Item(item) => Some(&item.kind),\n+            _ => None,\n+        }) {\n+            Some(ItemKind::Mod(ref module)) => {\n                 if !module.item_ids.is_empty() {\n                     self.tcx\n                         .sess"}, {"sha": "378f685ed30aa72a737b197ae67e75fb73980ba9", "filename": "src/test/ui/rustdoc/issue-83512.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2cedd86b1c25db321e7e023f6a429e23425a7e00/src%2Ftest%2Fui%2Frustdoc%2Fissue-83512.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cedd86b1c25db321e7e023f6a429e23425a7e00/src%2Ftest%2Fui%2Frustdoc%2Fissue-83512.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frustdoc%2Fissue-83512.rs?ref=2cedd86b1c25db321e7e023f6a429e23425a7e00", "patch": "@@ -0,0 +1,10 @@\n+// Regression test for the ICE described in #83512.\n+\n+#![feature(doc_keyword)]\n+#![crate_type=\"lib\"]\n+\n+trait Foo {\n+    #[doc(keyword = \"match\")]\n+    //~^ ERROR: `#[doc(keyword = \"...\")]` can only be used on modules\n+    fn quux() {}\n+}"}, {"sha": "da7e480c63e37dda758d2957adc2ae4dbe9eceec", "filename": "src/test/ui/rustdoc/issue-83512.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2cedd86b1c25db321e7e023f6a429e23425a7e00/src%2Ftest%2Fui%2Frustdoc%2Fissue-83512.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2cedd86b1c25db321e7e023f6a429e23425a7e00/src%2Ftest%2Fui%2Frustdoc%2Fissue-83512.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frustdoc%2Fissue-83512.stderr?ref=2cedd86b1c25db321e7e023f6a429e23425a7e00", "patch": "@@ -0,0 +1,8 @@\n+error: `#[doc(keyword = \"...\")]` can only be used on modules\n+  --> $DIR/issue-83512.rs:7:11\n+   |\n+LL |     #[doc(keyword = \"match\")]\n+   |           ^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}