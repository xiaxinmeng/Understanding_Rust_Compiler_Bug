{"sha": "3f4181a6e5c41a8d9d8ee434e6b75e7bef315998", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmNDE4MWE2ZTVjNDFhOGQ5ZDhlZTQzNGU2Yjc1ZTdiZWYzMTU5OTg=", "commit": {"author": {"name": "Valerii Hiora", "email": "valerii.hiora@gmail.com", "date": "2015-02-26T18:26:36Z"}, "committer": {"name": "Valerii Hiora", "email": "valerii.hiora@gmail.com", "date": "2015-03-05T10:41:59Z"}, "message": "iOS: open file on aarch64 breaks permissions\n\nAccording to Apple arm64 calling convention varargs always are passed\nthrough stack. Since `open` is actually a vararg function on Darwin's,\nit means that older declaration caused permissions to be taken from\nstack, while passed through register => it set file permissions\nto garbage and it was simply impossible to read/delete files after they\nwere created.\n\nThey way this commit handles it is to preserve compatibility with\nexisting code - it simply creates a shim unsafe function so all existing\ncallers continue work as nothing happened.", "tree": {"sha": "11383c7b9a5e1199b30c04b5edd3ac2c441a97b7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/11383c7b9a5e1199b30c04b5edd3ac2c441a97b7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3f4181a6e5c41a8d9d8ee434e6b75e7bef315998", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3f4181a6e5c41a8d9d8ee434e6b75e7bef315998", "html_url": "https://github.com/rust-lang/rust/commit/3f4181a6e5c41a8d9d8ee434e6b75e7bef315998", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3f4181a6e5c41a8d9d8ee434e6b75e7bef315998/comments", "author": {"login": "vhbit", "id": 140199, "node_id": "MDQ6VXNlcjE0MDE5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/140199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vhbit", "html_url": "https://github.com/vhbit", "followers_url": "https://api.github.com/users/vhbit/followers", "following_url": "https://api.github.com/users/vhbit/following{/other_user}", "gists_url": "https://api.github.com/users/vhbit/gists{/gist_id}", "starred_url": "https://api.github.com/users/vhbit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vhbit/subscriptions", "organizations_url": "https://api.github.com/users/vhbit/orgs", "repos_url": "https://api.github.com/users/vhbit/repos", "events_url": "https://api.github.com/users/vhbit/events{/privacy}", "received_events_url": "https://api.github.com/users/vhbit/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vhbit", "id": 140199, "node_id": "MDQ6VXNlcjE0MDE5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/140199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vhbit", "html_url": "https://github.com/vhbit", "followers_url": "https://api.github.com/users/vhbit/followers", "following_url": "https://api.github.com/users/vhbit/following{/other_user}", "gists_url": "https://api.github.com/users/vhbit/gists{/gist_id}", "starred_url": "https://api.github.com/users/vhbit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vhbit/subscriptions", "organizations_url": "https://api.github.com/users/vhbit/orgs", "repos_url": "https://api.github.com/users/vhbit/repos", "events_url": "https://api.github.com/users/vhbit/events{/privacy}", "received_events_url": "https://api.github.com/users/vhbit/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd077d5decbc3e462a9fe2feb1a0af0486897acb", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd077d5decbc3e462a9fe2feb1a0af0486897acb", "html_url": "https://github.com/rust-lang/rust/commit/dd077d5decbc3e462a9fe2feb1a0af0486897acb"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "1a5000161759ad11dcee14010b842e5d56e7b250", "filename": "src/liblibc/lib.rs", "status": "modified", "additions": 29, "deletions": 2, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/3f4181a6e5c41a8d9d8ee434e6b75e7bef315998/src%2Fliblibc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f4181a6e5c41a8d9d8ee434e6b75e7bef315998/src%2Fliblibc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliblibc%2Flib.rs?ref=3f4181a6e5c41a8d9d8ee434e6b75e7bef315998", "patch": "@@ -5003,9 +5003,36 @@ pub mod funcs {\n             use types::os::arch::c95::{c_char, c_int};\n             use types::os::arch::posix88::mode_t;\n \n+            mod open_shim {\n+                extern {\n+                    #[cfg(any(target_os = \"macos\",\n+                              target_os = \"ios\"))]\n+                    pub fn open(path: *const ::c_char, oflag: ::c_int, ...)\n+                                -> ::c_int;\n+\n+                    #[cfg(not(any(target_os = \"macos\",\n+                                  target_os = \"ios\")))]\n+                    pub fn open(path: *const ::c_char, oflag: ::c_int, mode: ::mode_t)\n+                                -> ::c_int;\n+                }\n+            }\n+\n+            #[cfg(any(target_os = \"macos\",\n+                      target_os = \"ios\"))]\n+            #[inline]\n+            pub unsafe extern fn open(path: *const c_char, oflag: c_int, mode: mode_t) -> c_int {\n+                use types::os::arch::c95::c_uint;\n+                open_shim::open(path, oflag, mode as c_uint)\n+            }\n+\n+            #[cfg(not(any(target_os = \"macos\",\n+                          target_os = \"ios\")))]\n+            #[inline]\n+            pub unsafe extern fn open(path: *const c_char, oflag: c_int, mode: mode_t) -> c_int {\n+                open_shim::open(path, oflag, mode)\n+            }\n+\n             extern {\n-                pub fn open(path: *const c_char, oflag: c_int, mode: mode_t)\n-                            -> c_int;\n                 pub fn creat(path: *const c_char, mode: mode_t) -> c_int;\n                 pub fn fcntl(fd: c_int, cmd: c_int, ...) -> c_int;\n             }"}]}