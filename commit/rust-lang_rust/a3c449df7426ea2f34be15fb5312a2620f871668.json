{"sha": "a3c449df7426ea2f34be15fb5312a2620f871668", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzYzQ0OWRmNzQyNmVhMmYzNGJlMTVmYjUzMTJhMjYyMGY4NzE2Njg=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-14T13:30:59Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-14T13:30:59Z"}, "message": "Make ast_map.rs index function args, switch it over to simple_visitor", "tree": {"sha": "9c48a799c22e3e6afd52e3056018c6e62c76a999", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c48a799c22e3e6afd52e3056018c6e62c76a999"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3c449df7426ea2f34be15fb5312a2620f871668", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3c449df7426ea2f34be15fb5312a2620f871668", "html_url": "https://github.com/rust-lang/rust/commit/a3c449df7426ea2f34be15fb5312a2620f871668", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3c449df7426ea2f34be15fb5312a2620f871668/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd0e7fc041695596865b5bb875c8f4b93ffd57ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd0e7fc041695596865b5bb875c8f4b93ffd57ba", "html_url": "https://github.com/rust-lang/rust/commit/cd0e7fc041695596865b5bb875c8f4b93ffd57ba"}], "stats": {"total": 28, "additions": 16, "deletions": 12}, "files": [{"sha": "40e737811268010e6b81204ec42c4256a64718f4", "filename": "src/comp/middle/ast_map.rs", "status": "modified", "additions": 16, "deletions": 12, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/a3c449df7426ea2f34be15fb5312a2620f871668/src%2Fcomp%2Fmiddle%2Fast_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3c449df7426ea2f34be15fb5312a2620f871668/src%2Fcomp%2Fmiddle%2Fast_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fast_map.rs?ref=a3c449df7426ea2f34be15fb5312a2620f871668", "patch": "@@ -8,6 +8,7 @@ tag ast_node {\n     node_obj_ctor(@item);\n     node_native_item(@native_item);\n     node_expr(@expr);\n+    node_arg(arg);\n }\n \n type map = std::map::hashmap<node_id, ast_node>;\n@@ -18,32 +19,35 @@ fn map_crate(c: crate) -> map {\n     // convert everything to use the smallintmap.\n     let map = new_smallintmap_int_adapter::<ast_node>();\n \n-    let v_map =\n-        @{visit_item: bind map_item(map, _, _, _),\n-          visit_native_item: bind map_native_item(map, _, _, _),\n-          visit_expr: bind map_expr(map, _, _, _)\n-             with *visit::default_visitor::<()>()};\n-    visit::visit_crate(c, (), visit::mk_vt(v_map));\n+    let v_map = visit::mk_simple_visitor\n+        (@{visit_item: bind map_item(map, _),\n+           visit_native_item: bind map_native_item(map, _),\n+           visit_expr: bind map_expr(map, _),\n+           visit_fn: bind map_fn(map, _, _, _, _, _)\n+               with *visit::default_simple_visitor()});\n+    visit::visit_crate(c, (), v_map);\n     ret map;\n }\n \n-fn map_item(map: map, i: @item, e: (), v: vt<()>) {\n+fn map_fn(map: map, f: _fn, _tp: [ty_param], _sp: codemap::span,\n+          _name: fn_ident, _id: node_id) {\n+    for a in f.decl.inputs { map.insert(a.id, node_arg(a)); }\n+}\n+\n+fn map_item(map: map, i: @item) {\n     map.insert(i.id, node_item(i));\n     alt i.node {\n       item_obj(_, _, ctor_id) { map.insert(ctor_id, node_obj_ctor(i)); }\n       _ { }\n     }\n-    visit::visit_item(i, e, v);\n }\n \n-fn map_native_item(map: map, i: @native_item, e: (), v: vt<()>) {\n+fn map_native_item(map: map, i: @native_item) {\n     map.insert(i.id, node_native_item(i));\n-    visit::visit_native_item(i, e, v);\n }\n \n-fn map_expr(map: map, ex: @expr, e: (), v: vt<()>) {\n+fn map_expr(map: map, ex: @expr) {\n     map.insert(ex.id, node_expr(ex));\n-    visit::visit_expr(ex, e, v);\n }\n \n fn new_smallintmap_int_adapter<@V>() -> std::map::hashmap<int, V> {"}]}