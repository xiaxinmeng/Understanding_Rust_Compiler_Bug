{"sha": "0f8e931475b1f7864504f509b389d28e1ffbc93a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmOGU5MzE0NzViMWY3ODY0NTA0ZjUwOWIzODlkMjhlMWZmYmM5M2E=", "commit": {"author": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-28T18:23:38Z"}, "committer": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-28T18:31:26Z"}, "message": "rustbuild: allow overriding list of LLVM targets to build\n\nA new option is introduced under the `[llvm]` section of `config.toml`,\n`targets`, for overriding the list of LLVM targets to build support for.\nThe option is passed through to LLVM configure script. Also notes are\nadded about the implications of (ab)using the option; since the default\nis not changed, and users of the option are expected to know what\nthey're doing anyway (as every porter should), the impact should be\nminimal.\n\nFixes #38200.", "tree": {"sha": "4deb9c2f87c6ed71eb96377741a76958b47e281f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4deb9c2f87c6ed71eb96377741a76958b47e281f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f8e931475b1f7864504f509b389d28e1ffbc93a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJYZAUFAAoJEDhUS04t5/q5I00P/28KccZMsXww0gvKCQY7iZXZ\ncgleqbd2MF2Oj1fP68JzElCb2PlZybB3yo/4j8In6LfkUwoktB98cPrN8U1pmF6B\nFp4mRxEm5DCKco/sdrMMuVF7b91ILnOzEcW72OxbrqhmVJDb+5c5TwuJ9DLLl02j\nYtUrfEJP9XqfdpyGS7v+woIjiQDingVwlWPVHpk+npVpDNe6roc4xlVZKqyJb4z9\nM8B/6W0ketwLpYdrw0zy35QReyWRbyUGt4MMVVWkXgKYbc2UUVt4B3RoSkR/wPoH\nMXIspIIqm2o9Als3CGdltRjwZD2SIf9rpRFqpYVz7cGPScbcT5mZZLR08+1Px5I5\nfxYk2ZYDqMklOPSiy2zfb8a8Dl9PcHIGCeKU0m7YmwjHMTftTwo7e3BRE8hecUoy\nTTOSFiBuV3D7kWw0jAnTNQ/X6Pt8N0N7yS1QFJl0bcs3g7sJv9+J9gWEwkb0yBL5\nwElfnif7abq2TYl6dcsuYicA1ngqX2FgT79u3i0/22S9cRj3oPctEkD5F3YqCDFy\nIicgaeVnVryrqxXSqVCrP36VAdoALfKuHtBL0TfrDIir+8r0TJs6cnsCRHxS0EbD\n/GPCGCGibarfUft0dHndRezT387n2rS0I0jgCs+N3hbKbuTFUYcfwzLHPQpOOOXl\ndu6hADciTLj3yc3epuF8\n=35/v\n-----END PGP SIGNATURE-----", "payload": "tree 4deb9c2f87c6ed71eb96377741a76958b47e281f\nparent 371f4d6bf697ac4b08845b6e739ab263df6f8395\nauthor Wang Xuerui <git@xen0n.name> 1482949418 +0800\ncommitter Wang Xuerui <git@xen0n.name> 1482949886 +0800\n\nrustbuild: allow overriding list of LLVM targets to build\n\nA new option is introduced under the `[llvm]` section of `config.toml`,\n`targets`, for overriding the list of LLVM targets to build support for.\nThe option is passed through to LLVM configure script. Also notes are\nadded about the implications of (ab)using the option; since the default\nis not changed, and users of the option are expected to know what\nthey're doing anyway (as every porter should), the impact should be\nminimal.\n\nFixes #38200.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f8e931475b1f7864504f509b389d28e1ffbc93a", "html_url": "https://github.com/rust-lang/rust/commit/0f8e931475b1f7864504f509b389d28e1ffbc93a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f8e931475b1f7864504f509b389d28e1ffbc93a/comments", "author": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "371f4d6bf697ac4b08845b6e739ab263df6f8395", "url": "https://api.github.com/repos/rust-lang/rust/commits/371f4d6bf697ac4b08845b6e739ab263df6f8395", "html_url": "https://github.com/rust-lang/rust/commit/371f4d6bf697ac4b08845b6e739ab263df6f8395"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "7e576175c3541762e68fe9ca74a5ffed95b16125", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0f8e931475b1f7864504f509b389d28e1ffbc93a/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f8e931475b1f7864504f509b389d28e1ffbc93a/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=0f8e931475b1f7864504f509b389d28e1ffbc93a", "patch": "@@ -54,6 +54,7 @@ pub struct Config {\n     pub llvm_version_check: bool,\n     pub llvm_static_stdcpp: bool,\n     pub llvm_link_shared: bool,\n+    pub llvm_targets: Option<String>,\n \n     // rust codegen options\n     pub rust_optimize: bool,\n@@ -152,6 +153,7 @@ struct Llvm {\n     release_debuginfo: Option<bool>,\n     version_check: Option<bool>,\n     static_libstdcpp: Option<bool>,\n+    targets: Option<String>,\n }\n \n #[derive(RustcDecodable)]\n@@ -285,6 +287,7 @@ impl Config {\n             set(&mut config.llvm_release_debuginfo, llvm.release_debuginfo);\n             set(&mut config.llvm_version_check, llvm.version_check);\n             set(&mut config.llvm_static_stdcpp, llvm.static_libstdcpp);\n+            config.llvm_targets = llvm.targets.clone();\n         }\n \n         if let Some(ref rust) = toml.rust {"}, {"sha": "25f668f6e473e13c74ee077f98dc7bea2f294e21", "filename": "src/bootstrap/config.toml.example", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0f8e931475b1f7864504f509b389d28e1ffbc93a/src%2Fbootstrap%2Fconfig.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/0f8e931475b1f7864504f509b389d28e1ffbc93a/src%2Fbootstrap%2Fconfig.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.toml.example?ref=0f8e931475b1f7864504f509b389d28e1ffbc93a", "patch": "@@ -42,6 +42,17 @@\n # example.\n #ninja = false\n \n+# LLVM targets to build support for.\n+# Note: this is NOT related to Rust compilation targets. However, as Rust is\n+# dependent on LLVM for code generation, turning targets off here WILL lead to\n+# the resulting rustc being unable to compile for the disabled architectures.\n+# Also worth pointing out is that, in case support for new targets are added to\n+# LLVM, enabling them here doesn't mean Rust is automatically gaining said\n+# support. You'll need to write a target specification at least, and most\n+# likely, teach rustc about the C ABI of the target. Get in touch with the\n+# Rust team and file an issue if you need assistance in porting!\n+#targets = \"X86;ARM;AArch64;Mips;PowerPC;SystemZ;JSBackend;MSP430;Sparc\"\n+\n # =============================================================================\n # General build configuration options\n # ============================================================================="}, {"sha": "d3fa54e417ac253e6e5dd41a72e1c5be3e0c55c8", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0f8e931475b1f7864504f509b389d28e1ffbc93a/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f8e931475b1f7864504f509b389d28e1ffbc93a/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=0f8e931475b1f7864504f509b389d28e1ffbc93a", "patch": "@@ -75,13 +75,18 @@ pub fn llvm(build: &Build, target: &str) {\n         (true, true) => \"RelWithDebInfo\",\n     };\n \n+    // NOTE: remember to also update `config.toml.example` when changing the defaults!\n+    let llvm_targets = match build.config.llvm_targets {\n+        Some(ref s) => s,\n+        None => \"X86;ARM;AArch64;Mips;PowerPC;SystemZ;JSBackend;MSP430;Sparc\",\n+    };\n+\n     cfg.target(target)\n        .host(&build.config.build)\n        .out_dir(&dst)\n        .profile(profile)\n        .define(\"LLVM_ENABLE_ASSERTIONS\", assertions)\n-       .define(\"LLVM_TARGETS_TO_BUILD\",\n-               \"X86;ARM;AArch64;Mips;PowerPC;SystemZ;JSBackend;MSP430;Sparc\")\n+       .define(\"LLVM_TARGETS_TO_BUILD\", llvm_targets)\n        .define(\"LLVM_INCLUDE_EXAMPLES\", \"OFF\")\n        .define(\"LLVM_INCLUDE_TESTS\", \"OFF\")\n        .define(\"LLVM_INCLUDE_DOCS\", \"OFF\")"}]}