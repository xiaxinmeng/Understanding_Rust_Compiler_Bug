{"sha": "e5f9d54661a46c3e37130716264f8c5ea7540af9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1ZjlkNTQ2NjFhNDZjM2UzNzEzMDcxNjI2NGY4YzVlYTc1NDBhZjk=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-11T22:01:52Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-12T20:49:54Z"}, "message": "Fix another crash", "tree": {"sha": "5f9237fe67c6a5fd8e3f17eddfc3ee9b5a7a35a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f9237fe67c6a5fd8e3f17eddfc3ee9b5a7a35a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5f9d54661a46c3e37130716264f8c5ea7540af9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5f9d54661a46c3e37130716264f8c5ea7540af9", "html_url": "https://github.com/rust-lang/rust/commit/e5f9d54661a46c3e37130716264f8c5ea7540af9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5f9d54661a46c3e37130716264f8c5ea7540af9/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61324a845bde0959c1f9ac86ce31d022812f4c21", "url": "https://api.github.com/repos/rust-lang/rust/commits/61324a845bde0959c1f9ac86ce31d022812f4c21", "html_url": "https://github.com/rust-lang/rust/commit/61324a845bde0959c1f9ac86ce31d022812f4c21"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "f28a7e7314e39ac1cf06646f0d738c27cc7e71a8", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e5f9d54661a46c3e37130716264f8c5ea7540af9/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5f9d54661a46c3e37130716264f8c5ea7540af9/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=e5f9d54661a46c3e37130716264f8c5ea7540af9", "patch": "@@ -450,7 +450,6 @@ impl Ty {\n     }\n \n     pub fn walk(&self, f: &mut impl FnMut(&Ty)) {\n-        f(self);\n         match self {\n             Ty::Slice(t) | Ty::Array(t) => t.walk(f),\n             Ty::RawPtr(t, _) => t.walk(f),\n@@ -490,10 +489,10 @@ impl Ty {\n             | Ty::Infer(_)\n             | Ty::Unknown => {}\n         }\n+        f(self);\n     }\n \n     fn walk_mut(&mut self, f: &mut impl FnMut(&mut Ty)) {\n-        f(self);\n         match self {\n             Ty::Slice(t) | Ty::Array(t) => Arc::make_mut(t).walk_mut(f),\n             Ty::RawPtr(t, _) => Arc::make_mut(t).walk_mut(f),\n@@ -544,6 +543,7 @@ impl Ty {\n             | Ty::Infer(_)\n             | Ty::Unknown => {}\n         }\n+        f(self);\n     }\n \n     fn fold(mut self, f: &mut impl FnMut(Ty) -> Ty) -> Ty {"}, {"sha": "209454a9140b62d056dd87a6c41587fb0ad0ad47", "filename": "crates/ra_hir/src/ty/snapshots/tests__infer_nested_generics_crash.snap", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e5f9d54661a46c3e37130716264f8c5ea7540af9/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_nested_generics_crash.snap", "raw_url": "https://github.com/rust-lang/rust/raw/e5f9d54661a46c3e37130716264f8c5ea7540af9/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_nested_generics_crash.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_nested_generics_crash.snap?ref=e5f9d54661a46c3e37130716264f8c5ea7540af9", "patch": "@@ -0,0 +1,12 @@\n+---\n+created: \"2019-02-11T21:59:04.302375838Z\"\n+creator: insta@0.6.1\n+source: crates/ra_hir/src/ty/tests.rs\n+expression: \"&result\"\n+---\n+[92; 106) 'query_response': Canonical<QueryResponse<R>>\n+[137; 167) '{     ...lue; }': ()\n+[143; 164) '&query....value': &QueryResponse<R>\n+[144; 158) 'query_response': Canonical<QueryResponse<R>>\n+[144; 164) 'query_....value': QueryResponse<R>\n+"}, {"sha": "203f1fe4d0a2949a7ff4e6129168a88d610092b2", "filename": "crates/ra_hir/src/ty/tests.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/e5f9d54661a46c3e37130716264f8c5ea7540af9/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5f9d54661a46c3e37130716264f8c5ea7540af9/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs?ref=e5f9d54661a46c3e37130716264f8c5ea7540af9", "patch": "@@ -719,6 +719,25 @@ fn extra_compiler_flags() {\n     );\n }\n \n+#[test]\n+fn infer_nested_generics_crash() {\n+    // another crash found typechecking rustc\n+    check_inference(\n+        \"infer_nested_generics_crash\",\n+        r#\"\n+struct Canonical<V> {\n+    value: V,\n+}\n+struct QueryResponse<V> {\n+    value: V,\n+}\n+fn test<R>(query_response: Canonical<QueryResponse<R>>) {\n+    &query_response.value;\n+}\n+\"#,\n+    );\n+}\n+\n fn infer(content: &str) -> String {\n     let (db, _, file_id) = MockDatabase::with_single_file(content);\n     let source_file = db.parse(file_id);"}]}