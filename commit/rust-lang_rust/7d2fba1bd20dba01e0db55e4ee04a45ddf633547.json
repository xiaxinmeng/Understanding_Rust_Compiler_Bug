{"sha": "7d2fba1bd20dba01e0db55e4ee04a45ddf633547", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkMmZiYTFiZDIwZGJhMDFlMGRiNTVlNGVlMDRhNDVkZGY2MzM1NDc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-06-23T20:09:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-23T20:09:59Z"}, "message": "Rollup merge of #72780 - GuillaumeGomez:enforce-doc-alias-check, r=ollie27\n\nEnforce doc alias check\n\nPart of #50146.\n\nr? @ollie27", "tree": {"sha": "39a88dcffac6715c6e3ed802a0e491dbf8205b54", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/39a88dcffac6715c6e3ed802a0e491dbf8205b54"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7d2fba1bd20dba01e0db55e4ee04a45ddf633547", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe8mGXCRBK7hj4Ov3rIwAAdHIIAJKW96UCpxTxgCfj2HfcvJPQ\nBkccsi4GwG4drlsUneCb0r4lYcR12xgPdojbyTf/+smfAijw6S00zwbH7OKNTqWs\nRL8CsJi7oj3LRVW6dE7y13YmYt0sHoNmaXQQkPDJWtGgXx619LHavAtmMV5TfCzy\nqwmnFje0SIOCzHVj6GyzCBRrwKNYQB1H1Lr7i1Qh+jbcTM7En+kPm+ojj7D7lY9f\nLvbITZ4u/PmLu7aIQW++XRzFqleKY4FxUOJTPUWXCg+J7mZbz0f9weqVRnUJ3YFY\nnrbx+QbJUpo49EZfow7dfwMz9AfGyiS8DViI2eNEeHGrhJo3zy8kRCqr7v70sFs=\n=JAXg\n-----END PGP SIGNATURE-----\n", "payload": "tree 39a88dcffac6715c6e3ed802a0e491dbf8205b54\nparent 1557fb031b272b4c5bfcc7de5df7eddc7b36a584\nparent 2d6267a7a8ae0399f2d363b6ac667fee0b53a1a0\nauthor Manish Goregaokar <manishsmail@gmail.com> 1592942999 -0700\ncommitter GitHub <noreply@github.com> 1592942999 -0700\n\nRollup merge of #72780 - GuillaumeGomez:enforce-doc-alias-check, r=ollie27\n\nEnforce doc alias check\n\nPart of #50146.\n\nr? @ollie27\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7d2fba1bd20dba01e0db55e4ee04a45ddf633547", "html_url": "https://github.com/rust-lang/rust/commit/7d2fba1bd20dba01e0db55e4ee04a45ddf633547", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7d2fba1bd20dba01e0db55e4ee04a45ddf633547/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1557fb031b272b4c5bfcc7de5df7eddc7b36a584", "url": "https://api.github.com/repos/rust-lang/rust/commits/1557fb031b272b4c5bfcc7de5df7eddc7b36a584", "html_url": "https://github.com/rust-lang/rust/commit/1557fb031b272b4c5bfcc7de5df7eddc7b36a584"}, {"sha": "2d6267a7a8ae0399f2d363b6ac667fee0b53a1a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d6267a7a8ae0399f2d363b6ac667fee0b53a1a0", "html_url": "https://github.com/rust-lang/rust/commit/2d6267a7a8ae0399f2d363b6ac667fee0b53a1a0"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "6dec016cc2ee3d7a0c70de06ce58d2567510d912", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7d2fba1bd20dba01e0db55e4ee04a45ddf633547/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2fba1bd20dba01e0db55e4ee04a45ddf633547/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=7d2fba1bd20dba01e0db55e4ee04a45ddf633547", "patch": "@@ -486,6 +486,33 @@ impl Attributes {\n         })\n     }\n \n+    /// Enforce the format of attributes inside `#[doc(...)]`.\n+    pub fn check_doc_attributes(\n+        diagnostic: &::rustc_errors::Handler,\n+        mi: &ast::MetaItem,\n+    ) -> Option<(String, String)> {\n+        mi.meta_item_list().and_then(|list| {\n+            for meta in list {\n+                if meta.check_name(sym::alias) {\n+                    if !meta.is_value_str()\n+                        || meta\n+                            .value_str()\n+                            .map(|s| s.to_string())\n+                            .unwrap_or_else(String::new)\n+                            .is_empty()\n+                    {\n+                        diagnostic.span_err(\n+                            meta.span(),\n+                            \"doc alias attribute expects a string: #[doc(alias = \\\"0\\\")]\",\n+                        );\n+                    }\n+                }\n+            }\n+\n+            None\n+        })\n+    }\n+\n     pub fn has_doc_flag(&self, flag: Symbol) -> bool {\n         for attr in &self.other_attrs {\n             if !attr.check_name(sym::doc) {\n@@ -529,6 +556,7 @@ impl Attributes {\n                 } else {\n                     if attr.check_name(sym::doc) {\n                         if let Some(mi) = attr.meta() {\n+                            Attributes::check_doc_attributes(&diagnostic, &mi);\n                             if let Some(cfg_mi) = Attributes::extract_cfg(&mi) {\n                                 // Extracted #[doc(cfg(...))]\n                                 match Cfg::parse(cfg_mi) {"}, {"sha": "2f01099107d9ee44d1f91ca55c76253927366967", "filename": "src/test/rustdoc-ui/check-doc-alias-attr.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7d2fba1bd20dba01e0db55e4ee04a45ddf633547/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2fba1bd20dba01e0db55e4ee04a45ddf633547/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.rs?ref=7d2fba1bd20dba01e0db55e4ee04a45ddf633547", "patch": "@@ -0,0 +1,9 @@\n+#![feature(doc_alias)]\n+\n+#[doc(alias = \"foo\")] // ok!\n+pub struct Bar;\n+\n+#[doc(alias)] //~ ERROR\n+#[doc(alias = 0)] //~ ERROR\n+#[doc(alias(\"bar\"))] //~ ERROR\n+pub struct Foo;"}, {"sha": "480acc821aaa85fd1c525ad7511da8140d77d5d1", "filename": "src/test/rustdoc-ui/check-doc-alias-attr.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7d2fba1bd20dba01e0db55e4ee04a45ddf633547/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7d2fba1bd20dba01e0db55e4ee04a45ddf633547/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.stderr?ref=7d2fba1bd20dba01e0db55e4ee04a45ddf633547", "patch": "@@ -0,0 +1,20 @@\n+error: doc alias attribute expects a string: #[doc(alias = \"0\")]\n+  --> $DIR/check-doc-alias-attr.rs:6:7\n+   |\n+LL | #[doc(alias)]\n+   |       ^^^^^\n+\n+error: doc alias attribute expects a string: #[doc(alias = \"0\")]\n+  --> $DIR/check-doc-alias-attr.rs:7:7\n+   |\n+LL | #[doc(alias = 0)]\n+   |       ^^^^^^^^^\n+\n+error: doc alias attribute expects a string: #[doc(alias = \"0\")]\n+  --> $DIR/check-doc-alias-attr.rs:8:7\n+   |\n+LL | #[doc(alias(\"bar\"))]\n+   |       ^^^^^^^^^^^^\n+\n+error: aborting due to 3 previous errors\n+"}]}