{"sha": "ff89ceca1f6abee64f80c265eabe5ce1df6d3628", "node_id": "C_kwDOAAsO6NoAKGZmODljZWNhMWY2YWJlZTY0ZjgwYzI2NWVhYmU1Y2UxZGY2ZDM2Mjg", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev+love@gmail.com", "date": "2022-11-01T03:03:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-01T03:03:42Z"}, "message": "Rollup merge of #103788 - chenyukang:yukang/fix-ice-103783, r=compiler-errors\n\nFix ICE in checking transmutability of NaughtyLenArray\n\nFixes #103783", "tree": {"sha": "0cb4ec2e614634c98f7c66b5effbe781ef5f1cee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0cb4ec2e614634c98f7c66b5effbe781ef5f1cee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ff89ceca1f6abee64f80c265eabe5ce1df6d3628", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjYIyOCRBK7hj4Ov3rIwAAfUMIADfBLBweKTfb+SAnB0sk0rlm\nisSNmwAmMwmeFqC3eZEr++tWd3PzylhmTYzsCinmLmtZwQLHwSOJAwdcMao7Ymy4\nOPkuozVM/VmaNoy7fzEZI4jcTcc1BarHUPuLkOWk2REdKFJrnr3F+4m42+rubWDK\nB8S8a9B6mhxPERk6ylkktj9y5RgFDj0D97e2LD0VRFBk5tldkp3Gu/gt1pevCkDt\ndJaFDdHv4cfMpWX+iOJfXE6WnUvhMs2ztf0oQgQCJP15FkP6YBdDCaO4PHE4duN2\nPZgkJ5bD/1DTyPN726mIgbi/Jysv22dBtPt0UC5p4EWfKC9HB+JxTsegU5fxusY=\n=a3Rx\n-----END PGP SIGNATURE-----\n", "payload": "tree 0cb4ec2e614634c98f7c66b5effbe781ef5f1cee\nparent 5bf9d617cb28ac857b9495fdc0df7031ad906eaf\nparent 55568419acfc312ac0d4200ed3334040f2034c4b\nauthor Yuki Okushi <huyuumi.dev+love@gmail.com> 1667271822 +0900\ncommitter GitHub <noreply@github.com> 1667271822 +0900\n\nRollup merge of #103788 - chenyukang:yukang/fix-ice-103783, r=compiler-errors\n\nFix ICE in checking transmutability of NaughtyLenArray\n\nFixes #103783\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ff89ceca1f6abee64f80c265eabe5ce1df6d3628", "html_url": "https://github.com/rust-lang/rust/commit/ff89ceca1f6abee64f80c265eabe5ce1df6d3628", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ff89ceca1f6abee64f80c265eabe5ce1df6d3628/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5bf9d617cb28ac857b9495fdc0df7031ad906eaf", "url": "https://api.github.com/repos/rust-lang/rust/commits/5bf9d617cb28ac857b9495fdc0df7031ad906eaf", "html_url": "https://github.com/rust-lang/rust/commit/5bf9d617cb28ac857b9495fdc0df7031ad906eaf"}, {"sha": "55568419acfc312ac0d4200ed3334040f2034c4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/55568419acfc312ac0d4200ed3334040f2034c4b", "html_url": "https://github.com/rust-lang/rust/commit/55568419acfc312ac0d4200ed3334040f2034c4b"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "2bc6bc1fc23aefd98135e45626a433f34acc721f", "filename": "compiler/rustc_transmute/src/layout/tree.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ff89ceca1f6abee64f80c265eabe5ce1df6d3628/compiler%2Frustc_transmute%2Fsrc%2Flayout%2Ftree.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ff89ceca1f6abee64f80c265eabe5ce1df6d3628/compiler%2Frustc_transmute%2Fsrc%2Flayout%2Ftree.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_transmute%2Fsrc%2Flayout%2Ftree.rs?ref=ff89ceca1f6abee64f80c265eabe5ce1df6d3628", "patch": "@@ -284,7 +284,8 @@ pub(crate) mod rustc {\n                 }\n \n                 ty::Array(ty, len) => {\n-                    let len = len.try_eval_usize(tcx, ParamEnv::reveal_all()).unwrap();\n+                    let len =\n+                        len.try_eval_usize(tcx, ParamEnv::reveal_all()).ok_or(Err::Unspecified)?;\n                     let elt = Tree::from_ty(*ty, tcx)?;\n                     Ok(std::iter::repeat(elt)\n                         .take(len as usize)"}, {"sha": "cb36e539ed11a1e7299b2a1a5ac2e72168d9cf96", "filename": "src/test/ui/transmutability/arrays/issue-103783-array-length.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/ff89ceca1f6abee64f80c265eabe5ce1df6d3628/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ff89ceca1f6abee64f80c265eabe5ce1df6d3628/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.rs?ref=ff89ceca1f6abee64f80c265eabe5ce1df6d3628", "patch": "@@ -0,0 +1,24 @@\n+#![crate_type = \"lib\"]\n+#![feature(transmutability)]\n+#![allow(dead_code)]\n+\n+mod assert {\n+    use std::mem::{Assume, BikeshedIntrinsicFrom};\n+    pub struct Context;\n+\n+    pub fn is_maybe_transmutable<Src, Dst>()\n+    where\n+        Dst: BikeshedIntrinsicFrom<\n+            Src,\n+            Context,\n+            { Assume { alignment: true, lifetimes: true, safety: true, validity: true } },\n+        >,\n+    {\n+    }\n+}\n+\n+fn test() {\n+    type NaughtyLenArray = [u32; 3.14159]; //~ ERROR mismatched types\n+    type JustUnit = ();\n+    assert::is_maybe_transmutable::<JustUnit, NaughtyLenArray>();\n+}"}, {"sha": "37774c59e6cbb50af0efab097df8ec3c442698a6", "filename": "src/test/ui/transmutability/arrays/issue-103783-array-length.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ff89ceca1f6abee64f80c265eabe5ce1df6d3628/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ff89ceca1f6abee64f80c265eabe5ce1df6d3628/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftransmutability%2Farrays%2Fissue-103783-array-length.stderr?ref=ff89ceca1f6abee64f80c265eabe5ce1df6d3628", "patch": "@@ -0,0 +1,9 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-103783-array-length.rs:21:34\n+   |\n+LL |     type NaughtyLenArray = [u32; 3.14159];\n+   |                                  ^^^^^^^ expected `usize`, found floating-point number\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}