{"sha": "2632a1c8798e060a6570dbb91b64ae52f24b4acd", "node_id": "C_kwDOAAsO6NoAKDI2MzJhMWM4Nzk4ZTA2MGE2NTcwZGJiOTFiNjRhZTUyZjI0YjRhY2Q", "commit": {"author": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-03-06T00:12:35Z"}, "committer": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-03-06T00:12:35Z"}, "message": "Append to PYTHONPATH in compiletest", "tree": {"sha": "b5cf144bbcd6dff5b89273532b3d66627c9d9ee5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5cf144bbcd6dff5b89273532b3d66627c9d9ee5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2632a1c8798e060a6570dbb91b64ae52f24b4acd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2632a1c8798e060a6570dbb91b64ae52f24b4acd", "html_url": "https://github.com/rust-lang/rust/commit/2632a1c8798e060a6570dbb91b64ae52f24b4acd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2632a1c8798e060a6570dbb91b64ae52f24b4acd/comments", "author": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "committer": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7820b62d20bc548096d4632a3487987308cb4b5d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7820b62d20bc548096d4632a3487987308cb4b5d", "html_url": "https://github.com/rust-lang/rust/commit/7820b62d20bc548096d4632a3487987308cb4b5d"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "a127875b55d5ffc3eba277ee330e427bc4133a8e", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/2632a1c8798e060a6570dbb91b64ae52f24b4acd/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2632a1c8798e060a6570dbb91b64ae52f24b4acd/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=2632a1c8798e060a6570dbb91b64ae52f24b4acd", "patch": "@@ -983,7 +983,12 @@ impl<'test> TestCx<'test> {\n                 &[\"-quiet\".as_ref(), \"-batch\".as_ref(), \"-nx\".as_ref(), &debugger_script];\n \n             let mut gdb = Command::new(self.config.gdb.as_ref().unwrap());\n-            gdb.args(debugger_opts).env(\"PYTHONPATH\", rust_pp_module_abs_path);\n+            let pythonpath = if let Ok(pp) = std::env::var(\"PYTHONPATH\") {\n+                format!(\"{pp}:{rust_pp_module_abs_path}\")\n+            } else {\n+                rust_pp_module_abs_path\n+            };\n+            gdb.args(debugger_opts).env(\"PYTHONPATH\", pythonpath);\n \n             debugger_run_result =\n                 self.compose_and_run(gdb, self.config.run_lib_path.to_str().unwrap(), None, None);\n@@ -1149,13 +1154,18 @@ impl<'test> TestCx<'test> {\n     ) -> ProcRes {\n         // Prepare the lldb_batchmode which executes the debugger script\n         let lldb_script_path = rust_src_root.join(\"src/etc/lldb_batchmode.py\");\n+        let pythonpath = if let Ok(pp) = std::env::var(\"PYTHONPATH\") {\n+            format!(\"{pp}:{}\", self.config.lldb_python_dir.as_ref().unwrap())\n+        } else {\n+            self.config.lldb_python_dir.as_ref().unwrap().to_string()\n+        };\n         self.cmd2procres(\n             Command::new(&self.config.python)\n                 .arg(&lldb_script_path)\n                 .arg(test_executable)\n                 .arg(debugger_script)\n                 .env(\"PYTHONUNBUFFERED\", \"1\") // Help debugging #78665\n-                .env(\"PYTHONPATH\", self.config.lldb_python_dir.as_ref().unwrap()),\n+                .env(\"PYTHONPATH\", pythonpath),\n         )\n     }\n "}]}