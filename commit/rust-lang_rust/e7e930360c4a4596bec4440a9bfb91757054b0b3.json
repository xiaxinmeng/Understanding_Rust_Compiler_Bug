{"sha": "e7e930360c4a4596bec4440a9bfb91757054b0b3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3ZTkzMDM2MGM0YTQ1OTZiZWM0NDQwYTliZmI5MTc1NzA1NGIwYjM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-09-03T00:23:10Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-09-03T00:23:10Z"}, "message": "Auto merge of #88363 - michaelwoerister:remapped-diagnostics, r=estebank\n\nPath remapping: Make behavior of diagnostics output dependent on presence of --remap-path-prefix.\n\nThis PR fixes a regression (#87745) with `--remap-path-prefix` where the flag stopped causing diagnostic messages to be remapped as well. The regression was introduced in https://github.com/rust-lang/rust/pull/83813 where we erroneously assumed that remapping of diagnostic messages was not desired anymore (because #70642 partially undid that functionality with nobody objecting).\n\nThe issue is fixed by making `--remap-path-prefix` remap diagnostic messages again, including for paths that have been remapped in upstream crates (e.g. the standard library). This means that \"sysroot-localization\" (implemented in #70642) is also disabled if `rustc` is invoked with `--remap-path-prefix`. The assumption is that once someone starts explicitly remapping paths they also don't want paths to their local Rust installation in their build output.\n\nIn the future we might want to give more fine-grained control over this behavior via compiler flags (see https://github.com/rust-lang/rfcs/pull/3127 for a related RFC). For now this PR is intended as a regression fix.\n\nThis PR is an alternative to https://github.com/rust-lang/rust/pull/88191, which makes diagnostic messages be remapped unconditionally. That approach, however, would effectively revert #70642.\n\nFixes https://github.com/rust-lang/rust/issues/87745.\n\ncc `@cbeuw`\nr? `@ghost`", "tree": {"sha": "3f4a35e445dc3d4f01d1e856cd403e6b39c9a119", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3f4a35e445dc3d4f01d1e856cd403e6b39c9a119"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7e930360c4a4596bec4440a9bfb91757054b0b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7e930360c4a4596bec4440a9bfb91757054b0b3", "html_url": "https://github.com/rust-lang/rust/commit/e7e930360c4a4596bec4440a9bfb91757054b0b3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7e930360c4a4596bec4440a9bfb91757054b0b3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6049759d0c0d0bdef1b37edec03d76f52621746", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6049759d0c0d0bdef1b37edec03d76f52621746", "html_url": "https://github.com/rust-lang/rust/commit/e6049759d0c0d0bdef1b37edec03d76f52621746"}, {"sha": "7753eda91a846fd279d74567559515bfa3e16f85", "url": "https://api.github.com/repos/rust-lang/rust/commits/7753eda91a846fd279d74567559515bfa3e16f85", "html_url": "https://github.com/rust-lang/rust/commit/7753eda91a846fd279d74567559515bfa3e16f85"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "cabe3e43b342c5bc8f9e20bb336fb0bb9fdc2c50", "filename": "src/debuginfo/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e7e930360c4a4596bec4440a9bfb91757054b0b3/src%2Fdebuginfo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7e930360c4a4596bec4440a9bfb91757054b0b3/src%2Fdebuginfo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdebuginfo%2Fmod.rs?ref=e7e930360c4a4596bec4440a9bfb91757054b0b3", "patch": "@@ -66,7 +66,7 @@ impl<'tcx> DebugContext<'tcx> {\n             rustc_interface::util::version_str().unwrap_or(\"unknown version\"),\n             cranelift_codegen::VERSION,\n         );\n-        let comp_dir = tcx.sess.opts.working_dir.to_string_lossy(false).into_owned();\n+        let comp_dir = tcx.sess.opts.working_dir.to_string_lossy(FileNameDisplayPreference::Remapped).into_owned();\n         let (name, file_info) = match tcx.sess.local_crate_source_file.clone() {\n             Some(path) => {\n                 let name = path.to_string_lossy().into_owned();"}, {"sha": "6c7c8cbc311f9f3fabe798685ff895b9d614980b", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e7e930360c4a4596bec4440a9bfb91757054b0b3/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7e930360c4a4596bec4440a9bfb91757054b0b3/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=e7e930360c4a4596bec4440a9bfb91757054b0b3", "patch": "@@ -74,7 +74,7 @@ mod vtable;\n mod prelude {\n     pub(crate) use std::convert::{TryFrom, TryInto};\n \n-    pub(crate) use rustc_span::Span;\n+    pub(crate) use rustc_span::{Span, FileNameDisplayPreference};\n \n     pub(crate) use rustc_hir::def_id::{DefId, LOCAL_CRATE};\n     pub(crate) use rustc_middle::bug;"}]}