{"sha": "8a7a0308e32711dce241142dac6c97ccd3a74807", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhhN2EwMzA4ZTMyNzExZGNlMjQxMTQyZGFjNmM5N2NjZDNhNzQ4MDc=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-10-12T01:13:14Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-10-12T01:13:14Z"}, "message": "rustc: Parse lets", "tree": {"sha": "280e15252440c0401d2198b19743d501c88e27d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/280e15252440c0401d2198b19743d501c88e27d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8a7a0308e32711dce241142dac6c97ccd3a74807", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8a7a0308e32711dce241142dac6c97ccd3a74807", "html_url": "https://github.com/rust-lang/rust/commit/8a7a0308e32711dce241142dac6c97ccd3a74807", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8a7a0308e32711dce241142dac6c97ccd3a74807/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a2c98794426209f90ebdb25a9d4c64e3c8546716", "url": "https://api.github.com/repos/rust-lang/rust/commits/a2c98794426209f90ebdb25a9d4c64e3c8546716", "html_url": "https://github.com/rust-lang/rust/commit/a2c98794426209f90ebdb25a9d4c64e3c8546716"}], "stats": {"total": 39, "additions": 33, "deletions": 6}, "files": [{"sha": "34df06add689323ac5b296dc12583fb83f68c05f", "filename": "src/comp/front/ast.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8a7a0308e32711dce241142dac6c97ccd3a74807/src%2Fcomp%2Ffront%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a7a0308e32711dce241142dac6c97ccd3a74807/src%2Fcomp%2Ffront%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Fast.rs?ref=8a7a0308e32711dce241142dac6c97ccd3a74807", "patch": "@@ -76,7 +76,7 @@ tag stmt_ {\n \n type decl = spanned[decl_];\n tag decl_ {\n-    decl_local(ident, bool, option[@ty]);\n+    decl_local(ident, option[@ty], option[@expr]);\n     decl_item(name, @item);\n }\n "}, {"sha": "877119de914ac694182edacdb707b69425c4d758", "filename": "src/comp/front/parser.rs", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/8a7a0308e32711dce241142dac6c97ccd3a74807/src%2Fcomp%2Ffront%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a7a0308e32711dce241142dac6c97ccd3a74807/src%2Fcomp%2Ffront%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Fparser.rs?ref=8a7a0308e32711dce241142dac6c97ccd3a74807", "patch": "@@ -541,6 +541,27 @@ io fn parse_expr(parser p) -> @ast.expr {\n     }\n }\n \n+io fn parse_let(parser p) -> @ast.decl {\n+    auto lo = p.get_span();\n+\n+    expect(p, token.LET);\n+    auto ty = parse_ty(p);\n+    auto id = parse_ident(p);\n+\n+    auto init;\n+    if (p.peek() == token.EQ) {\n+        p.bump();\n+        init = some(parse_expr(p));\n+    } else {\n+        init = none[@ast.expr];\n+    }\n+\n+    expect(p, token.SEMI);\n+\n+    auto hi = p.get_span();\n+    ret @spanned(lo, hi, ast.decl_local(id, some(ty), init));\n+}\n+\n io fn parse_stmt(parser p) -> @ast.stmt {\n     auto lo = p.get_span();\n     alt (p.peek()) {\n@@ -553,6 +574,12 @@ io fn parse_stmt(parser p) -> @ast.stmt {\n             ret @spanned(lo, hi, ast.stmt_log(e));\n         }\n \n+        case (token.LET) {\n+            auto leht = parse_let(p);\n+            auto hi = p.get_span();\n+            ret @spanned(lo, hi, ast.stmt_decl(leht));\n+        }\n+\n         // Handle the (few) block-expr stmts first.\n \n         case (token.IF) {"}, {"sha": "543a05e1edeabe24be9751e63612af5501a0d589", "filename": "src/comp/middle/fold.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8a7a0308e32711dce241142dac6c97ccd3a74807/src%2Fcomp%2Fmiddle%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a7a0308e32711dce241142dac6c97ccd3a74807/src%2Fcomp%2Fmiddle%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ffold.rs?ref=8a7a0308e32711dce241142dac6c97ccd3a74807", "patch": "@@ -85,8 +85,8 @@ type ast_fold[ENV] =\n \n      // Decl folds.\n      (fn(&ENV e, &span sp,\n-         ident ident, bool infer,\n-         &option[@ty] ty) -> @decl)               fold_decl_local,\n+         ident ident, &option[@ty] ty,\n+         &option[@expr]) -> @decl)                fold_decl_local,\n \n      (fn(&ENV e, &span sp,\n          &name name, @item item) -> @decl)        fold_decl_item,\n@@ -483,9 +483,9 @@ fn identity_fold_expr_block[ENV](&ENV env, &span sp, block blk) -> @expr {\n // Decl identities.\n \n fn identity_fold_decl_local[ENV](&ENV e, &span sp,\n-                                 ident i, bool infer,\n-                                 &option[@ty] t) -> @decl {\n-    ret @respan(sp, ast.decl_local(i, infer, t));\n+                                 ident i, &option[@ty] t,\n+                                 &option[@expr] init) -> @decl {\n+    ret @respan(sp, ast.decl_local(i, t, init));\n }\n \n fn identity_fold_decl_item[ENV](&ENV e, &span sp,"}]}