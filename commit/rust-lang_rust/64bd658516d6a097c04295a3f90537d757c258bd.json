{"sha": "64bd658516d6a097c04295a3f90537d757c258bd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0YmQ2NTg1MTZkNmEwOTdjMDQyOTVhM2Y5MDUzN2Q3NTdjMjU4YmQ=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-31T07:03:50Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-31T07:03:50Z"}, "message": "RIIR update lints: Generate deprecated lints\n\nThe update script now also generates the 'register_removed' section in\n`clippy_lints/src/lib.rs`.\n\nAlso, instead of using `let mut store ...`, I added a new identifier\nline so that the replacement will continue to work in case `let mut\nstore ...` ever changes.", "tree": {"sha": "557653ea03519674b731307edfa540f36f5bda00", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/557653ea03519674b731307edfa540f36f5bda00"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64bd658516d6a097c04295a3f90537d757c258bd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlvZVKsACgkQtvoGpuDi\nZlsuWQ/5AcFVEFbGUog22Zl5ia/ItJf8575h8Pig+XUOUHcXaNVDJeuXpD2Bh6Qm\ne5jUbNmsJHRMQAJt5EEIL95b2lPXiRZ/t0ILuQ57wC+KdR9kOieNdxfAYYR0wiVO\n9bTYrD78p9SM9FNu0/2ddoblz2OaXwwXDsiskHcOq7gh0FH9LP15tnDUIALulpzF\nVOE90cr7swqG9ksSAJrFwc6VhIeYbZTCF8PqBylZhARI+I+OUxjvTzNa2YH+i/pH\n26xY4bepl8scCZGw46k4d7XEbDOcukGAndp37t5DfYlYkc9f7vE0uaBB/FHNLhRt\nlAbWtMHqznMa1D46wV25LvIAVYJ5JPoyQDcB0GrwUK/bQRo1YDZ776NeZRAt8cja\nnGvde507laLYUOKYnwFp8lITyfYANdFkY03MvESW1ksUttnV77XsWVYHndnTC9IE\n+BZBz9MtNlMULudoFpUTEZ7ACLJbMNTwgLa1O4hKoXkfKAZ952Zu1He7EsDmWo6Q\nKPNcqiwCg7R7smT0ADoO5M6qw6TIdy6i5pvcOJaFORZvDl0Ql/YwoAhcQYaj0xpD\nLLkxL3BfTaRZRyttdh1T4zfXTYySCGf86/K9Cy2NBlpNIQbQypaitGX62v+C8EZF\nOLwlfF/QwtRpAMLaEAk08vJnVVqaOwJxvLJGowoN8F/HtEzW08A=\n=zgi3\n-----END PGP SIGNATURE-----", "payload": "tree 557653ea03519674b731307edfa540f36f5bda00\nparent e695015caa8223abd1b49dc74f1e34b591a2f438\nauthor Philipp Hansch <dev@phansch.net> 1540969430 +0100\ncommitter Philipp Hansch <dev@phansch.net> 1540969430 +0100\n\nRIIR update lints: Generate deprecated lints\n\nThe update script now also generates the 'register_removed' section in\n`clippy_lints/src/lib.rs`.\n\nAlso, instead of using `let mut store ...`, I added a new identifier\nline so that the replacement will continue to work in case `let mut\nstore ...` ever changes.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64bd658516d6a097c04295a3f90537d757c258bd", "html_url": "https://github.com/rust-lang/rust/commit/64bd658516d6a097c04295a3f90537d757c258bd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64bd658516d6a097c04295a3f90537d757c258bd/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e695015caa8223abd1b49dc74f1e34b591a2f438", "url": "https://api.github.com/repos/rust-lang/rust/commits/e695015caa8223abd1b49dc74f1e34b591a2f438", "html_url": "https://github.com/rust-lang/rust/commit/e695015caa8223abd1b49dc74f1e34b591a2f438"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "d2191d426ffe560aaf6a0d0a11f08332bf2d796a", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/64bd658516d6a097c04295a3f90537d757c258bd/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64bd658516d6a097c04295a3f90537d757c258bd/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=64bd658516d6a097c04295a3f90537d757c258bd", "patch": "@@ -72,6 +72,7 @@ impl Lint {\n     }\n }\n \n+/// Generates the list of lint links at the bottom of the README\n pub fn gen_changelog_lint_list(lints: Vec<Lint>) -> Vec<String> {\n     let mut lint_list_sorted: Vec<Lint> = lints;\n     lint_list_sorted.sort_by_key(|l| l.name.clone());\n@@ -84,6 +85,23 @@ pub fn gen_changelog_lint_list(lints: Vec<Lint>) -> Vec<String> {\n         .collect()\n }\n \n+/// Generates the 'register_removed' code in `./clippy_lints/src/lib.rs`.\n+pub fn gen_deprecated(lints: Vec<Lint>) -> Vec<String> {\n+    lints.iter()\n+        .filter(|l| l.deprecation.is_some())\n+        .map(|l| {\n+            format!(\n+                r#\"    store.register_removed(\n+        \"{}\",\n+        \"{}\",\n+    );\"#,\n+                l.name,\n+                l.deprecation.clone().unwrap()\n+            )\n+        })\n+        .collect()\n+}\n+\n /// Gathers all files in `src/clippy_lints` and gathers all lints inside\n pub fn gather_all() -> impl Iterator<Item=Lint> {\n     lint_files().flat_map(|f| gather_from_file(&f))\n@@ -321,3 +339,18 @@ fn test_gen_changelog_lint_list() {\n     ];\n     assert_eq!(expected, gen_changelog_lint_list(lints));\n }\n+\n+#[test]\n+fn test_gen_deprecated() {\n+    let lints = vec![\n+        Lint::new(\"should_assert_eq\", \"group1\", \"abc\", Some(\"has been superseeded by should_assert_eq2\"), \"module_name\"),\n+        Lint::new(\"should_assert_eq2\", \"group2\", \"abc\", None, \"module_name\")\n+    ];\n+    let expected: Vec<String> = vec![\n+        r#\"    store.register_removed(\n+        \"should_assert_eq\",\n+        \"has been superseeded by should_assert_eq2\",\n+    );\"#.to_string()\n+    ];\n+    assert_eq!(expected, gen_deprecated(lints));\n+}"}, {"sha": "cf321dbbc020944c62893212a8b2f61fb9a41f20", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/64bd658516d6a097c04295a3f90537d757c258bd/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64bd658516d6a097c04295a3f90537d757c258bd/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=64bd658516d6a097c04295a3f90537d757c258bd", "patch": "@@ -82,4 +82,12 @@ fn update_lints() {\n         false,\n         || { gen_changelog_lint_list(lint_list.clone()) }\n     );\n+\n+    replace_region_in_file(\n+        \"../clippy_lints/src/lib.rs\",\n+        \"begin deprecated lints\",\n+        \"end deprecated lints\",\n+        false,\n+        || { gen_deprecated(lint_list.clone()) }\n+    );\n }"}, {"sha": "f7b103e8d72428a03e9938e62ffcec794a38b923", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/64bd658516d6a097c04295a3f90537d757c258bd/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64bd658516d6a097c04295a3f90537d757c258bd/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=64bd658516d6a097c04295a3f90537d757c258bd", "patch": "@@ -270,6 +270,7 @@ pub fn read_conf(reg: &rustc_plugin::Registry<'_>) -> Conf {\n #[rustfmt::skip]\n pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n     let mut store = reg.sess.lint_store.borrow_mut();\n+    // begin deprecated lints, do not remove this comment, it\u2019s used in `update_lints`\n     store.register_removed(\n         \"should_assert_eq\",\n         \"`assert!()` will be more flexible with RFC 2011\","}, {"sha": "221069d353cb3093063b1b0eefc60b46435475e4", "filename": "util/update_lints.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/64bd658516d6a097c04295a3f90537d757c258bd/util%2Fupdate_lints.py", "raw_url": "https://github.com/rust-lang/rust/raw/64bd658516d6a097c04295a3f90537d757c258bd/util%2Fupdate_lints.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fupdate_lints.py?ref=64bd658516d6a097c04295a3f90537d757c258bd", "patch": "@@ -240,7 +240,7 @@ def main(print_only=False, check=False):\n \n     # same for \"deprecated\" lint collection\n     changed |= replace_region(\n-        'clippy_lints/src/lib.rs', r'let mut store', r'end deprecated lints',\n+        'clippy_lints/src/lib.rs', r'begin deprecated lints', r'end deprecated lints',\n         lambda: gen_deprecated(deprecated_lints),\n         replace_start=False,\n         write_back=not check)"}]}