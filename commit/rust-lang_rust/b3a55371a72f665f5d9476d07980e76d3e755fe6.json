{"sha": "b3a55371a72f665f5d9476d07980e76d3e755fe6", "node_id": "C_kwDOAAsO6NoAKGIzYTU1MzcxYTcyZjY2NWY1ZDk0NzZkMDc5ODBlNzZkM2U3NTVmZTY", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2021-12-09T18:48:19Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2021-12-12T11:20:03Z"}, "message": "Remove automatic rustfix of asm! to llvm_asm!\n\nThis no longer works now that asm! needs an explicit import. Also, it's\nbeen over a year since asm! landed, everyone should have transitioned by\nnow.", "tree": {"sha": "eff3dc1928bfac58df2b434bf693fc730da8272b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eff3dc1928bfac58df2b434bf693fc730da8272b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3a55371a72f665f5d9476d07980e76d3e755fe6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3a55371a72f665f5d9476d07980e76d3e755fe6", "html_url": "https://github.com/rust-lang/rust/commit/b3a55371a72f665f5d9476d07980e76d3e755fe6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3a55371a72f665f5d9476d07980e76d3e755fe6/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a0a4c7d1e48c39a73119eb9107d402d60c83293b", "url": "https://api.github.com/repos/rust-lang/rust/commits/a0a4c7d1e48c39a73119eb9107d402d60c83293b", "html_url": "https://github.com/rust-lang/rust/commit/a0a4c7d1e48c39a73119eb9107d402d60c83293b"}], "stats": {"total": 71, "additions": 0, "deletions": 71}, "files": [{"sha": "d67d872b884a561a3e767f70198ff0deb3aca34d", "filename": "compiler/rustc_builtin_macros/src/asm.rs", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b3a55371a72f665f5d9476d07980e76d3e755fe6/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3a55371a72f665f5d9476d07980e76d3e755fe6/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs?ref=b3a55371a72f665f5d9476d07980e76d3e755fe6", "patch": "@@ -42,19 +42,6 @@ fn parse_args<'a>(\n             ecx.struct_span_err(sp, \"the legacy LLVM-style asm! syntax is no longer supported\");\n         err.note(\"consider migrating to the new asm! syntax specified in RFC 2873\");\n         err.note(\"alternatively, switch to llvm_asm! to keep your code working as it is\");\n-\n-        // Find the span of the \"asm!\" so that we can offer an automatic suggestion\n-        let asm_span = sp.from_inner(InnerSpan::new(0, 4));\n-        if let Ok(s) = ecx.source_map().span_to_snippet(asm_span) {\n-            if s == \"asm!\" {\n-                err.span_suggestion(\n-                    asm_span,\n-                    \"replace with\",\n-                    \"llvm_asm!\".into(),\n-                    Applicability::MachineApplicable,\n-                );\n-            }\n-        }\n         return Err(err);\n     }\n "}, {"sha": "1d5d2038aa89caa0c8e4ee056a5e9962cc355d4b", "filename": "src/test/ui/asm/rustfix-asm.fixed", "status": "removed", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a0a4c7d1e48c39a73119eb9107d402d60c83293b/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/a0a4c7d1e48c39a73119eb9107d402d60c83293b/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.fixed?ref=a0a4c7d1e48c39a73119eb9107d402d60c83293b", "patch": "@@ -1,17 +0,0 @@\n-// run-rustfix\n-// needs-asm-support\n-\n-#![feature(asm, llvm_asm)]\n-#![allow(deprecated)] // llvm_asm!\n-\n-fn main() {\n-    unsafe {\n-        let x = 1;\n-        let y: i32;\n-        llvm_asm!(\"\" :: \"r\" (x));\n-        //~^ ERROR the legacy LLVM-style asm! syntax is no longer supported\n-        llvm_asm!(\"\" : \"=r\" (y));\n-        //~^ ERROR the legacy LLVM-style asm! syntax is no longer supported\n-        let _ = y;\n-    }\n-}"}, {"sha": "12be0e666ee141bfad8233f6c3e75f1a7aeec6ff", "filename": "src/test/ui/asm/rustfix-asm.rs", "status": "removed", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a0a4c7d1e48c39a73119eb9107d402d60c83293b/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0a4c7d1e48c39a73119eb9107d402d60c83293b/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.rs?ref=a0a4c7d1e48c39a73119eb9107d402d60c83293b", "patch": "@@ -1,17 +0,0 @@\n-// run-rustfix\n-// needs-asm-support\n-\n-#![feature(asm, llvm_asm)]\n-#![allow(deprecated)] // llvm_asm!\n-\n-fn main() {\n-    unsafe {\n-        let x = 1;\n-        let y: i32;\n-        asm!(\"\" :: \"r\" (x));\n-        //~^ ERROR the legacy LLVM-style asm! syntax is no longer supported\n-        asm!(\"\" : \"=r\" (y));\n-        //~^ ERROR the legacy LLVM-style asm! syntax is no longer supported\n-        let _ = y;\n-    }\n-}"}, {"sha": "babb154ccf435a1adefd4850e91672ce0d6f449e", "filename": "src/test/ui/asm/rustfix-asm.stderr", "status": "removed", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/a0a4c7d1e48c39a73119eb9107d402d60c83293b/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a0a4c7d1e48c39a73119eb9107d402d60c83293b/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Frustfix-asm.stderr?ref=a0a4c7d1e48c39a73119eb9107d402d60c83293b", "patch": "@@ -1,24 +0,0 @@\n-error: the legacy LLVM-style asm! syntax is no longer supported\n-  --> $DIR/rustfix-asm.rs:11:9\n-   |\n-LL |         asm!(\"\" :: \"r\" (x));\n-   |         ----^^^^^^^^^^^^^^^\n-   |         |\n-   |         help: replace with: `llvm_asm!`\n-   |\n-   = note: consider migrating to the new asm! syntax specified in RFC 2873\n-   = note: alternatively, switch to llvm_asm! to keep your code working as it is\n-\n-error: the legacy LLVM-style asm! syntax is no longer supported\n-  --> $DIR/rustfix-asm.rs:13:9\n-   |\n-LL |         asm!(\"\" : \"=r\" (y));\n-   |         ----^^^^^^^^^^^^^^^\n-   |         |\n-   |         help: replace with: `llvm_asm!`\n-   |\n-   = note: consider migrating to the new asm! syntax specified in RFC 2873\n-   = note: alternatively, switch to llvm_asm! to keep your code working as it is\n-\n-error: aborting due to 2 previous errors\n-"}]}