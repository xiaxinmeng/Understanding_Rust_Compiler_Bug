{"sha": "4cb87899d9a513fd4fab78e632e419758005e051", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjYjg3ODk5ZDlhNTEzZmQ0ZmFiNzhlNjMyZTQxOTc1ODAwNWUwNTE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-01-17T17:57:20Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-01-17T17:57:20Z"}, "message": "Rollup merge of #47444 - etaoins:dont-include-bang-in-macro-suggestion, r=estebank\n\nDon't include bang in macro replacement suggestion\n\nWhen we suggest the replacement for a macro we include the \"!\" in the suggested replacement but the span only contains the name of the macro itself. Using that replacement would cause a duplicate \"!\" in the resulting code.\n\nI originally tried to extend the span to be replaced by 1 byte in rust-lang/rust#47424. However, @zackmdavis pointed out that there can be whitespace between the macro name and the bang.\n\nInstead, just remove the bang from the suggested replacement.\n\nFixes #47418\n\nr? @estebank", "tree": {"sha": "60951cf5f0ec168052ddea5854cd18e4e0269024", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/60951cf5f0ec168052ddea5854cd18e4e0269024"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4cb87899d9a513fd4fab78e632e419758005e051", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4cb87899d9a513fd4fab78e632e419758005e051", "html_url": "https://github.com/rust-lang/rust/commit/4cb87899d9a513fd4fab78e632e419758005e051", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4cb87899d9a513fd4fab78e632e419758005e051/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "233f29190bdd8b641af8f4e5c3a22a1497aa0ad4", "url": "https://api.github.com/repos/rust-lang/rust/commits/233f29190bdd8b641af8f4e5c3a22a1497aa0ad4", "html_url": "https://github.com/rust-lang/rust/commit/233f29190bdd8b641af8f4e5c3a22a1497aa0ad4"}, {"sha": "ecd47a91c7c5eb22fba5fcdec7fa8d78a8bcac51", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecd47a91c7c5eb22fba5fcdec7fa8d78a8bcac51", "html_url": "https://github.com/rust-lang/rust/commit/ecd47a91c7c5eb22fba5fcdec7fa8d78a8bcac51"}], "stats": {"total": 13, "additions": 6, "deletions": 7}, "files": [{"sha": "ceb39aea108c8ac2602eb33849afe42a8833012d", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4cb87899d9a513fd4fab78e632e419758005e051/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cb87899d9a513fd4fab78e632e419758005e051/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=4cb87899d9a513fd4fab78e632e419758005e051", "patch": "@@ -691,8 +691,7 @@ impl<'a> Resolver<'a> {\n         if let Some(suggestion) = suggestion {\n             if suggestion != name {\n                 if let MacroKind::Bang = kind {\n-                    err.span_suggestion(span, \"you could try the macro\",\n-                                        format!(\"{}!\", suggestion));\n+                    err.span_suggestion(span, \"you could try the macro\", suggestion.to_string());\n                 } else {\n                     err.span_suggestion(span, \"try\", suggestion.to_string());\n                 }"}, {"sha": "9121ce1720c98952f6f9d73189949e4317cf42d6", "filename": "src/test/ui-fulldeps/resolve-error.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4cb87899d9a513fd4fab78e632e419758005e051/src%2Ftest%2Fui-fulldeps%2Fresolve-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4cb87899d9a513fd4fab78e632e419758005e051/src%2Ftest%2Fui-fulldeps%2Fresolve-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fresolve-error.stderr?ref=4cb87899d9a513fd4fab78e632e419758005e051", "patch": "@@ -38,13 +38,13 @@ error: cannot find macro `FooWithLongNama!` in this scope\n   --> $DIR/resolve-error.rs:62:5\n    |\n 62 |     FooWithLongNama!();\n-   |     ^^^^^^^^^^^^^^^ help: you could try the macro: `FooWithLongNam!`\n+   |     ^^^^^^^^^^^^^^^ help: you could try the macro: `FooWithLongNam`\n \n error: cannot find macro `attr_proc_macra!` in this scope\n   --> $DIR/resolve-error.rs:65:5\n    |\n 65 |     attr_proc_macra!();\n-   |     ^^^^^^^^^^^^^^^ help: you could try the macro: `attr_proc_mac!`\n+   |     ^^^^^^^^^^^^^^^ help: you could try the macro: `attr_proc_mac`\n \n error: cannot find macro `Dlona!` in this scope\n   --> $DIR/resolve-error.rs:68:5\n@@ -56,7 +56,7 @@ error: cannot find macro `bang_proc_macrp!` in this scope\n   --> $DIR/resolve-error.rs:71:5\n    |\n 71 |     bang_proc_macrp!();\n-   |     ^^^^^^^^^^^^^^^ help: you could try the macro: `bang_proc_macro!`\n+   |     ^^^^^^^^^^^^^^^ help: you could try the macro: `bang_proc_macro`\n \n error: aborting due to 10 previous errors\n "}, {"sha": "ebe95356c26ebd0fe0aeb74044eefe215fdd1078", "filename": "src/test/ui/macros/macro-name-typo.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4cb87899d9a513fd4fab78e632e419758005e051/src%2Ftest%2Fui%2Fmacros%2Fmacro-name-typo.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4cb87899d9a513fd4fab78e632e419758005e051/src%2Ftest%2Fui%2Fmacros%2Fmacro-name-typo.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-name-typo.stderr?ref=4cb87899d9a513fd4fab78e632e419758005e051", "patch": "@@ -2,7 +2,7 @@ error: cannot find macro `printlx!` in this scope\n   --> $DIR/macro-name-typo.rs:12:5\n    |\n 12 |     printlx!(\"oh noes!\"); //~ ERROR cannot find\n-   |     ^^^^^^^ help: you could try the macro: `println!`\n+   |     ^^^^^^^ help: you could try the macro: `println`\n \n error: aborting due to previous error\n "}, {"sha": "8d6da6a4732fc9a71e38181a923f1faeb2ebc196", "filename": "src/test/ui/macros/macro_undefined.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4cb87899d9a513fd4fab78e632e419758005e051/src%2Ftest%2Fui%2Fmacros%2Fmacro_undefined.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4cb87899d9a513fd4fab78e632e419758005e051/src%2Ftest%2Fui%2Fmacros%2Fmacro_undefined.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro_undefined.stderr?ref=4cb87899d9a513fd4fab78e632e419758005e051", "patch": "@@ -10,7 +10,7 @@ error: cannot find macro `k!` in this scope\n   --> $DIR/macro_undefined.rs:21:5\n    |\n 21 |     k!(); //~ ERROR cannot find\n-   |     ^ help: you could try the macro: `kl!`\n+   |     ^ help: you could try the macro: `kl`\n \n error: aborting due to 2 previous errors\n "}]}