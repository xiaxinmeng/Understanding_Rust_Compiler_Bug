{"sha": "97ca0737c6b63507945e9198177ebadf9d4eff82", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3Y2EwNzM3YzZiNjM1MDc5NDVlOTE5ODE3N2ViYWRmOWQ0ZWZmODI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-21T14:01:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-21T14:01:35Z"}, "message": "Rollup merge of #64642 - cuviper:move-for-loop-snippet, r=varkor\n\nFix the span used to suggest avoiding for-loop moves\n\nIt was using the snippet from the \"use\" span, which often renders the\nsame, but with closures that snippet is on the start of the closure\nwhere the value is captured. We should be using the snippet from the\nspan where it was moved into the `for` loop, which is `move_span`.\n\nFixes #64559.", "tree": {"sha": "931af44227c59522d720d6277caa4a411cbdf747", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/931af44227c59522d720d6277caa4a411cbdf747"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/97ca0737c6b63507945e9198177ebadf9d4eff82", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdhi0/CRBK7hj4Ov3rIwAAdHIIAARvWxlQHw2sfx/3Bgkpz0l3\nv9gP5p8ZyH4Bjl4zd6rWmdA9GAzyhRadADqJH1hudJyGqSM1SheoqZ+H1yUREQNN\nqCvgmojPD3L23VoYkbIzH6WC0hbgxAm1btvf3oTxmR3D2waYDg31isosY5758F+o\nADIZl3Zlm0jla9VJxFZKgLSGq/wiGjpmx2BgIgnguaT8nCu8sMZFEF/xFhWUkpu1\nhZekAO67M992VNt1APHqMAL68+2kJsHX+rE0TANSMfjIvaR82JIDRtRftBzo3Lhy\nFyf9jcNzD2WrwKaWwX3/DYRJep0wnaR+cEyPYl9cHHxzi+esLKrsSZenVcJjaMY=\n=OSZc\n-----END PGP SIGNATURE-----\n", "payload": "tree 931af44227c59522d720d6277caa4a411cbdf747\nparent 1486b7f91ce18962038ef36d2479e57e27a569ed\nparent c3f72d1c098a61f26271021460b5ae420ff28ae8\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1569074495 +0200\ncommitter GitHub <noreply@github.com> 1569074495 +0200\n\nRollup merge of #64642 - cuviper:move-for-loop-snippet, r=varkor\n\nFix the span used to suggest avoiding for-loop moves\n\nIt was using the snippet from the \"use\" span, which often renders the\nsame, but with closures that snippet is on the start of the closure\nwhere the value is captured. We should be using the snippet from the\nspan where it was moved into the `for` loop, which is `move_span`.\n\nFixes #64559.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/97ca0737c6b63507945e9198177ebadf9d4eff82", "html_url": "https://github.com/rust-lang/rust/commit/97ca0737c6b63507945e9198177ebadf9d4eff82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/97ca0737c6b63507945e9198177ebadf9d4eff82/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1486b7f91ce18962038ef36d2479e57e27a569ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/1486b7f91ce18962038ef36d2479e57e27a569ed", "html_url": "https://github.com/rust-lang/rust/commit/1486b7f91ce18962038ef36d2479e57e27a569ed"}, {"sha": "c3f72d1c098a61f26271021460b5ae420ff28ae8", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3f72d1c098a61f26271021460b5ae420ff28ae8", "html_url": "https://github.com/rust-lang/rust/commit/c3f72d1c098a61f26271021460b5ae420ff28ae8"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "599a0ad0d0c52641d2daeee4d6575aca42bb614c", "filename": "src/librustc_mir/borrow_check/conflict_errors.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/97ca0737c6b63507945e9198177ebadf9d4eff82/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/97ca0737c6b63507945e9198177ebadf9d4eff82/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs?ref=97ca0737c6b63507945e9198177ebadf9d4eff82", "patch": "@@ -180,7 +180,8 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                     );\n                 }\n                 if Some(DesugaringKind::ForLoop) == move_span.desugaring_kind() {\n-                    if let Ok(snippet) = self.infcx.tcx.sess.source_map().span_to_snippet(span) {\n+                    let sess = self.infcx.tcx.sess;\n+                    if let Ok(snippet) = sess.source_map().span_to_snippet(move_span) {\n                         err.span_suggestion(\n                             move_span,\n                             \"consider borrowing to avoid moving into the for loop\","}, {"sha": "71e054b5d9876a47f9ffeebc720ee43a31dac3a5", "filename": "src/test/ui/issues/issue-64559.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/97ca0737c6b63507945e9198177ebadf9d4eff82/src%2Ftest%2Fui%2Fissues%2Fissue-64559.rs", "raw_url": "https://github.com/rust-lang/rust/raw/97ca0737c6b63507945e9198177ebadf9d4eff82/src%2Ftest%2Fui%2Fissues%2Fissue-64559.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-64559.rs?ref=97ca0737c6b63507945e9198177ebadf9d4eff82", "patch": "@@ -0,0 +1,6 @@\n+fn main() {\n+    let orig = vec![true];\n+    for _val in orig {}\n+    let _closure = || orig;\n+    //~^ ERROR use of moved value: `orig`\n+}"}, {"sha": "3c685dc8d089a145dc8ce0bd95ba2941905eab0a", "filename": "src/test/ui/issues/issue-64559.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/97ca0737c6b63507945e9198177ebadf9d4eff82/src%2Ftest%2Fui%2Fissues%2Fissue-64559.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/97ca0737c6b63507945e9198177ebadf9d4eff82/src%2Ftest%2Fui%2Fissues%2Fissue-64559.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-64559.stderr?ref=97ca0737c6b63507945e9198177ebadf9d4eff82", "patch": "@@ -0,0 +1,18 @@\n+error[E0382]: use of moved value: `orig`\n+  --> $DIR/issue-64559.rs:4:20\n+   |\n+LL |     let orig = vec![true];\n+   |         ---- move occurs because `orig` has type `std::vec::Vec<bool>`, which does not implement the `Copy` trait\n+LL |     for _val in orig {}\n+   |                 ----\n+   |                 |\n+   |                 value moved here\n+   |                 help: consider borrowing to avoid moving into the for loop: `&orig`\n+LL |     let _closure = || orig;\n+   |                    ^^ ---- use occurs due to use in closure\n+   |                    |\n+   |                    value used here after move\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0382`."}]}