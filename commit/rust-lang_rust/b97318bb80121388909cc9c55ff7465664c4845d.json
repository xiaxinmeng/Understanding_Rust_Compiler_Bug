{"sha": "b97318bb80121388909cc9c55ff7465664c4845d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5NzMxOGJiODAxMjEzODg5MDljYzljNTVmZjc0NjU2NjRjNDg0NWQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-12T22:50:31Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-12T23:54:47Z"}, "message": "Simplify the code for generating tests. Issue #428", "tree": {"sha": "937adfe843551e5fa5d9b03bee2740076fe4b362", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/937adfe843551e5fa5d9b03bee2740076fe4b362"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b97318bb80121388909cc9c55ff7465664c4845d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b97318bb80121388909cc9c55ff7465664c4845d", "html_url": "https://github.com/rust-lang/rust/commit/b97318bb80121388909cc9c55ff7465664c4845d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b97318bb80121388909cc9c55ff7465664c4845d/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed83f28076fd6a189b87405c6b4bf8844eea6f41", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed83f28076fd6a189b87405c6b4bf8844eea6f41", "html_url": "https://github.com/rust-lang/rust/commit/ed83f28076fd6a189b87405c6b4bf8844eea6f41"}], "stats": {"total": 27, "additions": 10, "deletions": 17}, "files": [{"sha": "0d243a7abf9dd9701987ee617b8913f98eff07cf", "filename": "src/comp/front/test.rs", "status": "modified", "additions": 10, "deletions": 17, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/b97318bb80121388909cc9c55ff7465664c4845d/src%2Fcomp%2Ffront%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b97318bb80121388909cc9c55ff7465664c4845d/src%2Fcomp%2Ffront%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Ftest.rs?ref=b97318bb80121388909cc9c55ff7465664c4845d", "patch": "@@ -165,7 +165,7 @@ fn nospan[T](&T t) -> ast::spanned[T] {\n }\n \n fn mk_tests(&test_ctxt cx) -> @ast::item {\n-    auto ret_ty = mk_test_desc_ivec_ty();\n+    auto ret_ty = mk_test_desc_ivec_ty(cx);\n \n     let ast::fn_decl decl = rec(inputs = ~[],\n                                 output = ret_ty,\n@@ -204,23 +204,16 @@ fn empty_fn_ty() -> ast::ty {\n     ret nospan(ast::ty_fn(proto, input_ty, ret_ty, cf, constrs));\n }\n \n-// The ast::ty of std::test::test_desc\n-fn mk_test_desc_ivec_ty() -> @ast::ty {\n-    // Oh this is brutal to build by hand\n-    let ast::mt name_mt = rec(ty = @nospan(ast::ty_str),\n-                              mut = ast::imm);\n-    let ast::mt fn_mt = rec(ty = @empty_fn_ty(),\n-                            mut = ast::imm);\n-\n-    let ast::ty_field_ name_ty_field_ = rec(ident = \"name\",\n-                                            mt = name_mt);\n+// The ast::ty of std::test::test_desc[]\n+fn mk_test_desc_ivec_ty(&test_ctxt cx) -> @ast::ty {\n+    let ast::path test_desc_ty_path = nospan(rec(global = false,\n+                                                 idents = ~[\"std\",\n+                                                            \"test\",\n+                                                            \"test_desc\"],\n+                                                 types = ~[]));\n \n-    let ast::ty_field_ fn_ty_field_ = rec(ident = \"fn\",\n-                                          mt = fn_mt);\n-    \n-    let ast::ty_field[] test_desc_fields = ~[nospan(name_ty_field_),\n-                                             nospan(fn_ty_field_)];\n-    let ast::ty test_desc_ty = nospan(ast::ty_rec(test_desc_fields));\n+    let ast::ty test_desc_ty = nospan(ast::ty_path(test_desc_ty_path,\n+                                                   cx.next_node_id()));\n \n     let ast::mt ivec_mt = rec(ty = @test_desc_ty,\n                               mut = ast::imm);"}]}