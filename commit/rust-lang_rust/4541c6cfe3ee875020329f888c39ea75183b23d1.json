{"sha": "4541c6cfe3ee875020329f888c39ea75183b23d1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ1NDFjNmNmZTNlZTg3NTAyMDMyOWY4ODhjMzllYTc1MTgzYjIzZDE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-08-23T05:55:11Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-08-24T01:38:59Z"}, "message": "rt: Remove exit_status helpers", "tree": {"sha": "dd6b276b19f8e284a21a974f025e47ee3a1c47e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd6b276b19f8e284a21a974f025e47ee3a1c47e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4541c6cfe3ee875020329f888c39ea75183b23d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4541c6cfe3ee875020329f888c39ea75183b23d1", "html_url": "https://github.com/rust-lang/rust/commit/4541c6cfe3ee875020329f888c39ea75183b23d1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4541c6cfe3ee875020329f888c39ea75183b23d1/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4ef59db2fdf3d2f2c239a03f60569196a8df44d", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4ef59db2fdf3d2f2c239a03f60569196a8df44d", "html_url": "https://github.com/rust-lang/rust/commit/b4ef59db2fdf3d2f2c239a03f60569196a8df44d"}], "stats": {"total": 38, "additions": 5, "deletions": 33}, "files": [{"sha": "f2ede8872c298440116e618b06f42e73c3274078", "filename": "src/libstd/rt/util.rs", "status": "modified", "additions": 5, "deletions": 16, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/4541c6cfe3ee875020329f888c39ea75183b23d1/src%2Flibstd%2Frt%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4541c6cfe3ee875020329f888c39ea75183b23d1/src%2Flibstd%2Frt%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Futil.rs?ref=4541c6cfe3ee875020329f888c39ea75183b23d1", "patch": "@@ -14,6 +14,7 @@ use libc;\n use option::{Some, None};\n use os;\n use str::StrSlice;\n+use unstable::atomics::{AtomicInt, INIT_ATOMIC_INT, SeqCst};\n \n #[cfg(target_os=\"macos\")]\n use unstable::running_on_valgrind;\n@@ -129,24 +130,12 @@ memory and partly incapable of presentation to others.\",\n     }\n }\n \n-pub fn set_exit_status(code: int) {\n-    #[fixed_stack_segment]; #[inline(never)];\n-    unsafe {\n-        return rust_set_exit_status_newrt(code as libc::uintptr_t);\n-    }\n+static mut EXIT_STATUS: AtomicInt = INIT_ATOMIC_INT;\n \n-    extern {\n-        fn rust_set_exit_status_newrt(code: libc::uintptr_t);\n-    }\n+pub fn set_exit_status(code: int) {\n+    unsafe { EXIT_STATUS.store(code, SeqCst) }\n }\n \n pub fn get_exit_status() -> int {\n-    #[fixed_stack_segment]; #[inline(never)];\n-    unsafe {\n-        return rust_get_exit_status_newrt() as int;\n-    }\n-\n-    extern {\n-        fn rust_get_exit_status_newrt() -> libc::uintptr_t;\n-    }\n+    unsafe { EXIT_STATUS.load(SeqCst) }\n }"}, {"sha": "3a2a8e8941559c3ae721eb3bd242b3b5ddab0abc", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4541c6cfe3ee875020329f888c39ea75183b23d1/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/4541c6cfe3ee875020329f888c39ea75183b23d1/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=4541c6cfe3ee875020329f888c39ea75183b23d1", "patch": "@@ -653,21 +653,6 @@ rust_get_global_args_ptr() {\n     return &global_args_ptr;\n }\n \n-static lock_and_signal exit_status_lock;\n-static uintptr_t exit_status = 0;\n-\n-extern \"C\" CDECL void\n-rust_set_exit_status_newrt(uintptr_t code) {\n-    scoped_lock with(exit_status_lock);\n-    exit_status = code;\n-}\n-\n-extern \"C\" CDECL uintptr_t\n-rust_get_exit_status_newrt() {\n-    scoped_lock with(exit_status_lock);\n-    return exit_status;\n-}\n-\n static lock_and_signal change_dir_lock;\n \n extern \"C\" CDECL void"}, {"sha": "54b6dc2c6020123df6d4e6020add7e3183e31508", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4541c6cfe3ee875020329f888c39ea75183b23d1/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/4541c6cfe3ee875020329f888c39ea75183b23d1/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=4541c6cfe3ee875020329f888c39ea75183b23d1", "patch": "@@ -191,8 +191,6 @@ rust_get_num_cpus\n rust_get_global_args_ptr\n rust_take_global_args_lock\n rust_drop_global_args_lock\n-rust_set_exit_status_newrt\n-rust_get_exit_status_newrt\n rust_take_change_dir_lock\n rust_drop_change_dir_lock\n rust_get_test_int"}]}