{"sha": "fb8396da843fd665fc73a0bf448d5fb83b1b978b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiODM5NmRhODQzZmQ2NjVmYzczYTBiZjQ0OGQ1ZmI4M2IxYjk3OGI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-03-31T14:10:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-03-31T14:10:38Z"}, "message": "Rollup merge of #59574 - JohnTitor:distinguish-error-vs-warning, r=Centril\n\nDistinguish message for external macros depending on error level\n\nfixes #57716\n\n(I picked you because assigned to this issue.)\nr? @estebank", "tree": {"sha": "8454df10ef33efa7dbef5bae1de8b23586d57e59", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8454df10ef33efa7dbef5bae1de8b23586d57e59"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb8396da843fd665fc73a0bf448d5fb83b1b978b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcoMpeCRBK7hj4Ov3rIwAAdHIIAFlvCEnco06z/vk9cIDR5MJs\nitHFxuRwjdDOwpLwKlJ591ge0e3sr+Q8G7reB84yT19HKIsZMF7iccoasKz3tWGU\ndbUDw/fk0o7E9jOfmSshvZTph8jpPX4Puq9gWgAbegFNoqVj2ZrHTMP9hOM57/+v\nCIUgBTNI8k6+iXNTcrvl5KWkVjRx+R7fpLTosZdR9uv//3Z26C7wbkC0ILgW6doi\n3G3jDqdpo9QyRp28DFp/frWHF7KVYyHTpqW3A7ebeqrFy1dHD2NyqTt3/Ccidd6V\n1NC2IthO1hXpC6PSWgJoutVWY26piuiv8YBr4My/1yKl5r2+5yJMRaoHKfmM7kI=\n=atJ+\n-----END PGP SIGNATURE-----\n", "payload": "tree 8454df10ef33efa7dbef5bae1de8b23586d57e59\nparent 61222b5731a733628555a7f6eabc9ff93bd2437f\nparent 45c82abf13385f22d10dccecd1e54b28cfbeb5cc\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1554041438 +0200\ncommitter GitHub <noreply@github.com> 1554041438 +0200\n\nRollup merge of #59574 - JohnTitor:distinguish-error-vs-warning, r=Centril\n\nDistinguish message for external macros depending on error level\n\nfixes #57716\n\n(I picked you because assigned to this issue.)\nr? @estebank\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb8396da843fd665fc73a0bf448d5fb83b1b978b", "html_url": "https://github.com/rust-lang/rust/commit/fb8396da843fd665fc73a0bf448d5fb83b1b978b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb8396da843fd665fc73a0bf448d5fb83b1b978b/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61222b5731a733628555a7f6eabc9ff93bd2437f", "url": "https://api.github.com/repos/rust-lang/rust/commits/61222b5731a733628555a7f6eabc9ff93bd2437f", "html_url": "https://github.com/rust-lang/rust/commit/61222b5731a733628555a7f6eabc9ff93bd2437f"}, {"sha": "45c82abf13385f22d10dccecd1e54b28cfbeb5cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/45c82abf13385f22d10dccecd1e54b28cfbeb5cc", "html_url": "https://github.com/rust-lang/rust/commit/45c82abf13385f22d10dccecd1e54b28cfbeb5cc"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "ee2a1b69cbd015155ab3722e2e6bec59b552651d", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/fb8396da843fd665fc73a0bf448d5fb83b1b978b/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb8396da843fd665fc73a0bf448d5fb83b1b978b/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=fb8396da843fd665fc73a0bf448d5fb83b1b978b", "patch": "@@ -6,6 +6,7 @@ use crate::{\n     Level, CodeSuggestion, DiagnosticBuilder, SubDiagnostic,\n     SuggestionStyle, SourceMapperDyn, DiagnosticId,\n };\n+use crate::Level::Error;\n use crate::snippet::{Annotation, AnnotationType, Line, MultilineAnnotation, StyledString, Style};\n use crate::styled_buffer::StyledBuffer;\n \n@@ -72,6 +73,7 @@ impl Emitter for EmitterWriter {\n \n         self.fix_multispans_in_std_macros(&mut primary_span,\n                                           &mut children,\n+                                          &db.level,\n                                           db.handler.flags.external_macro_backtrace);\n \n         self.emit_messages_default(&db.level,\n@@ -888,18 +890,27 @@ impl EmitterWriter {\n     fn fix_multispans_in_std_macros(&mut self,\n                                     span: &mut MultiSpan,\n                                     children: &mut Vec<SubDiagnostic>,\n+                                    level: &Level,\n                                     backtrace: bool) {\n         let mut spans_updated = self.fix_multispan_in_std_macros(span, backtrace);\n         for child in children.iter_mut() {\n             spans_updated |= self.fix_multispan_in_std_macros(&mut child.span, backtrace);\n         }\n+        let msg = if level == &Error {\n+            \"this error originates in a macro outside of the current crate \\\n+             (in Nightly builds, run with -Z external-macro-backtrace \\\n+              for more info)\".to_string()\n+        } else {\n+            \"this warning originates in a macro outside of the current crate \\\n+             (in Nightly builds, run with -Z external-macro-backtrace \\\n+              for more info)\".to_string()\n+        };\n+\n         if spans_updated {\n             children.push(SubDiagnostic {\n                 level: Level::Note,\n                 message: vec![\n-                    (\"this error originates in a macro outside of the current crate \\\n-                      (in Nightly builds, run with -Z external-macro-backtrace \\\n-                       for more info)\".to_string(),\n+                    (msg,\n                      Style::NoStyle),\n                 ],\n                 span: MultiSpan::new(),"}, {"sha": "4c358a81cc1a451f10775457142b398b51161e5d", "filename": "src/test/ui/imports/import-crate-var.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb8396da843fd665fc73a0bf448d5fb83b1b978b/src%2Ftest%2Fui%2Fimports%2Fimport-crate-var.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb8396da843fd665fc73a0bf448d5fb83b1b978b/src%2Ftest%2Fui%2Fimports%2Fimport-crate-var.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fimport-crate-var.stderr?ref=fb8396da843fd665fc73a0bf448d5fb83b1b978b", "patch": "@@ -5,5 +5,5 @@ LL |     m!();\n    |     ^^^^^\n    |\n    = note: `use $crate;` was erroneously allowed and will become a hard error in a future release\n-   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n+   = note: this warning originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n "}, {"sha": "302c8aa7e6a5558e23738afe58a93b8d2ab77936", "filename": "src/test/ui/macros/must-use-in-macro-55516.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb8396da843fd665fc73a0bf448d5fb83b1b978b/src%2Ftest%2Fui%2Fmacros%2Fmust-use-in-macro-55516.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb8396da843fd665fc73a0bf448d5fb83b1b978b/src%2Ftest%2Fui%2Fmacros%2Fmust-use-in-macro-55516.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmust-use-in-macro-55516.stderr?ref=fb8396da843fd665fc73a0bf448d5fb83b1b978b", "patch": "@@ -6,5 +6,5 @@ LL |     write!(&mut example, \"{}\", 42);\n    |\n    = note: `-W unused-must-use` implied by `-W unused`\n    = note: this `Result` may be an `Err` variant, which should be handled\n-   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n+   = note: this warning originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n "}]}