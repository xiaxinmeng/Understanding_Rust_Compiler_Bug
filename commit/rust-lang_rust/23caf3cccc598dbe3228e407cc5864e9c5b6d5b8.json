{"sha": "23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzY2FmM2NjY2M1OThkYmUzMjI4ZTQwN2NjNTg2NGU5YzViNmQ1Yjg=", "commit": {"author": {"name": "llogiq", "email": "bogusandre@gmail.com", "date": "2015-06-11T09:35:00Z"}, "committer": {"name": "llogiq", "email": "bogusandre@gmail.com", "date": "2015-06-11T09:35:00Z"}, "message": "first unicode lint: zero_width_space", "tree": {"sha": "06c5c577a030a25310197bf5c2c6dbfa75f0da06", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/06c5c577a030a25310197bf5c2c6dbfa75f0da06"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "html_url": "https://github.com/rust-lang/rust/commit/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/comments", "author": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "committer": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad8841c20b86e7f35544bc124050e3d124f45d09", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad8841c20b86e7f35544bc124050e3d124f45d09", "html_url": "https://github.com/rust-lang/rust/commit/ad8841c20b86e7f35544bc124050e3d124f45d09"}], "stats": {"total": 74, "additions": 74, "deletions": 0}, "files": [{"sha": "979fb47985a6a176d3d57ce283a030635bbd8567", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "patch": "@@ -29,6 +29,7 @@ Lints included in this crate:\n  - `redundant_closure` warns on creating a closure where none is needed, e.g. `|x| foo(x)`, where `foo` can be used directly\n  - `inline_always`: Warns on `#[inline(always)]`, because in most cases it is a bad idea\n  - `collapsible_if`: Warns on cases where two nested `if`-expressions can be collapsed into one, e.g. `if x { if y { foo() } }` can be written as `if x && y { foo() }`\n+ - `zero_width_space`: Warns on encountering a unicode zero-width space\n \n To use, add the following lines to your Cargo.toml:\n "}, {"sha": "647128e0f0c4bfe3346d8b6725360f6ade2c3044", "filename": "src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "patch": "@@ -26,6 +26,7 @@ pub mod mut_mut;\n pub mod len_zero;\n pub mod attrs;\n pub mod collapsible_if;\n+pub mod unicode;\n pub mod utils;\n \n #[plugin_registrar]\n@@ -49,6 +50,7 @@ pub fn plugin_registrar(reg: &mut Registry) {\n     reg.register_lint_pass(box misc::CmpOwned as LintPassObject);\n     reg.register_lint_pass(box attrs::AttrPass as LintPassObject);\n     reg.register_lint_pass(box collapsible_if::CollapsibleIf as LintPassObject);\n+    reg.register_lint_pass(box unicode::Unicode as LintPassObject);\n     \n     reg.register_lint_group(\"clippy\", vec![types::BOX_VEC, types::LINKEDLIST,\n                                            misc::SINGLE_MATCH, misc::STR_TO_STRING,\n@@ -67,5 +69,6 @@ pub fn plugin_registrar(reg: &mut Registry) {\n                                            len_zero::LEN_WITHOUT_IS_EMPTY,\n                                            attrs::INLINE_ALWAYS,\n                                            collapsible_if::COLLAPSIBLE_IF,\n+                                           unicode::ZERO_WIDTH_SPACE,\n                                            ]);\n }"}, {"sha": "3ffcf699c26f95f038cec2e78b47a93c03a4c3bc", "filename": "src/unicode.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/src%2Funicode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/src%2Funicode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Funicode.rs?ref=23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "patch": "@@ -0,0 +1,45 @@\n+use rustc::lint::*;\n+use syntax::ast::*;\n+use syntax::codemap::{BytePos, Span};\n+\n+declare_lint!{ pub ZERO_WIDTH_SPACE, Deny, \"Zero-width space is confusing\" }\n+\n+#[derive(Copy, Clone)]\n+pub struct Unicode;\n+\n+impl LintPass for Unicode {\n+\tfn get_lints(&self) -> LintArray {\n+        lint_array!(ZERO_WIDTH_SPACE)\n+    }\n+    \n+    fn check_expr(&mut self, cx: &Context, expr: &Expr) {\n+\t\tif let ExprLit(ref lit) = expr.node {\n+\t\t\tif let LitStr(ref string, _) = lit.node {\n+\t\t\t\tcheck_str(cx, string, lit.span)\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n+\n+fn check_str(cx: &Context, string: &str, span: Span) {\n+\tlet mut start: Option<usize> = None;\n+\tfor (i, c) in string.char_indices() {\n+\t\tif c == '\\u{200B}' {\n+\t\t\tif start.is_none() { start = Some(i); }\n+\t\t} else {\n+\t\t\tlint_zero_width(cx, span, start);\n+\t\t\tstart = None;\n+\t\t}\n+\t}\n+\tlint_zero_width(cx, span, start);\n+}\n+\n+fn lint_zero_width(cx: &Context, span: Span, start: Option<usize>) {\n+\tstart.map(|index| {\n+\t\tcx.span_lint(ZERO_WIDTH_SPACE, Span {\n+\t\t\tlo: span.lo + BytePos(index as u32),\n+\t\t\thi: span.lo + BytePos(index as u32),\n+\t\t\texpn_id: span.expn_id,\n+\t\t}, \"Zero-width space detected. Consider using \\\\u{200B}\")\n+\t});\n+}"}, {"sha": "0385f45cc5ea0886660a163e01cc51f4195d52bf", "filename": "tests/compile-fail/unicode.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/tests%2Fcompile-fail%2Funicode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8/tests%2Fcompile-fail%2Funicode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funicode.rs?ref=23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "patch": "@@ -0,0 +1,25 @@\n+#![feature(plugin)]\n+#![plugin(clippy)]\n+\n+#[deny(zero_width_space)]\n+fn zero() {\n+\tprint!(\"Here >\u200b< is a ZWS, and \u200banother\"); \n+\t\t\t\t//~^ ERROR Zero-width space detected. Consider using \\u{200B}\n+\t\t\t\t\t\t\t\t//~^^ ERROR Zero-width space detected. Consider using \\u{200B}\n+}\n+\n+//#[deny(unicode_canon)]\n+fn canon() {\n+\tprint!(\"\u0300ah?\"); //not yet ~ERROR Non-canonical unicode sequence detected. Consider using \u00e0\n+}\n+\n+//#[deny(ascii_only)]\n+fn uni() {\n+\tprintln!(\"\u00dcben!\"); //not yet ~ERROR Unicode literal detected. Consider using \\u{FC}\n+}\n+\n+fn main() {\n+\tzero();\n+\tuni();\n+\tcanon();\n+}"}]}