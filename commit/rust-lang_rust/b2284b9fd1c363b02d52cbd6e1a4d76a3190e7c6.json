{"sha": "b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6", "node_id": "C_kwDOAAsO6NoAKGIyMjg0YjlmZDFjMzYzYjAyZDUyY2JkNmUxYTRkNzZhMzE5MGU3YzY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-02-07T16:57:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-02-07T16:57:16Z"}, "message": "Rollup merge of #107700 - jyn514:tools-builder, r=Mark-Simulacrum\n\nRun the tools builder on all PRs\n\nPreviously, it would only run on changes to subtrees, submodules, or select directories. That made it so that changes to the compiler that broke tools would only be detected on a full bors merge. This makes it so the tools builder runs by default, making it easier to catch breaking changes to clippy (which was the most affected).\n\nr? ``@Mark-Simulacrum`` cc ``@pietroalbini`` ``@flip1995`` ``@m-ou-se``", "tree": {"sha": "ab6d596a8dae55fdf08fe9e8738abb4002a22c08", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab6d596a8dae55fdf08fe9e8738abb4002a22c08"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj4oLsCRBK7hj4Ov3rIwAAvssIACdBedHW1NtWDayCiwJ95exv\n/nE4PNeHYQQ2NMe8PxSbNhDdUJPmrhgu1zCJoXSjFpjkdmvkhmPS+/e1Bq66TzoV\nzsF/CIR4w5aP3nSFQx6O2Cw+i9IU22EDB2K3sA9sOfYHbXItxfaNXD9qcR//618U\nDMK7efMH2lMLnXO5c82jyhtMIX27KFA1WwHjCzVCWSsLBvIxBtO4PbokLY2gSFg5\nF+0ohybQnMu/PzcWPgMeJJIHOw7cyEmYQLk3NRfkgAgx3oCThscWxMs2egdxbHIu\nEooGtXR0IC2A7/jRiTEd1K+nKAHuVnOaoUq/FQTpoTWxXu7bVZDJua4rK913BnM=\n=qGyR\n-----END PGP SIGNATURE-----\n", "payload": "tree ab6d596a8dae55fdf08fe9e8738abb4002a22c08\nparent 4b859c3f2f023c95b5aff6d330e2eabe71253b39\nparent 9dfec5d35b4f52d0b9653edf8e656c9a3c04f492\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1675789036 +0100\ncommitter GitHub <noreply@github.com> 1675789036 +0100\n\nRollup merge of #107700 - jyn514:tools-builder, r=Mark-Simulacrum\n\nRun the tools builder on all PRs\n\nPreviously, it would only run on changes to subtrees, submodules, or select directories. That made it so that changes to the compiler that broke tools would only be detected on a full bors merge. This makes it so the tools builder runs by default, making it easier to catch breaking changes to clippy (which was the most affected).\n\nr? ``@Mark-Simulacrum`` cc ``@pietroalbini`` ``@flip1995`` ``@m-ou-se``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6", "html_url": "https://github.com/rust-lang/rust/commit/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b859c3f2f023c95b5aff6d330e2eabe71253b39", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b859c3f2f023c95b5aff6d330e2eabe71253b39", "html_url": "https://github.com/rust-lang/rust/commit/4b859c3f2f023c95b5aff6d330e2eabe71253b39"}, {"sha": "9dfec5d35b4f52d0b9653edf8e656c9a3c04f492", "url": "https://api.github.com/repos/rust-lang/rust/commits/9dfec5d35b4f52d0b9653edf8e656c9a3c04f492", "html_url": "https://github.com/rust-lang/rust/commit/9dfec5d35b4f52d0b9653edf8e656c9a3c04f492"}], "stats": {"total": 42, "additions": 2, "deletions": 40}, "files": [{"sha": "b51105750c82cc9aa428298d520959ab20071409", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6", "patch": "@@ -60,9 +60,8 @@ jobs:\n             env: {}\n           - name: x86_64-gnu-tools\n             tidy: false\n-            env:\n-              CI_ONLY_WHEN_SUBMODULES_CHANGED: 1\n             os: ubuntu-20.04-xl\n+            env: {}\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n     steps:"}, {"sha": "3c128c0ca251b514142c020fbc7c6409ee843a06", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6", "patch": "@@ -307,8 +307,6 @@ jobs:\n           - name: x86_64-gnu-tools\n             <<: *job-linux-xl\n             tidy: false\n-            env:\n-              CI_ONLY_WHEN_SUBMODULES_CHANGED: 1\n \n   auto:\n     permissions:"}, {"sha": "48127166ad0809b644ba4b533b042588ab0eec7a", "filename": "src/ci/scripts/should-skip-this.sh", "status": "modified", "additions": 1, "deletions": 36, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6/src%2Fci%2Fscripts%2Fshould-skip-this.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6/src%2Fci%2Fscripts%2Fshould-skip-this.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fshould-skip-this.sh?ref=b2284b9fd1c363b02d52cbd6e1a4d76a3190e7c6", "patch": "@@ -1,46 +1,11 @@\n #!/bin/bash\n-# Set the SKIP_JOB environment variable if this job is supposed to only run\n-# when submodules are updated and they were not. The following time consuming\n-# tasks will be skipped when the environment variable is present.\n+# Set the SKIP_JOB environment variable if this job is not supposed to run on the current builder.\n \n set -euo pipefail\n IFS=$'\\n\\t'\n \n source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n \n-if [[ -n \"${CI_ONLY_WHEN_SUBMODULES_CHANGED-}\" ]]; then\n-    git fetch \"https://github.com/$GITHUB_REPOSITORY\" \"$GITHUB_BASE_REF\"\n-    BASE_COMMIT=\"$(git merge-base FETCH_HEAD HEAD)\"\n-\n-    echo \"Searching for toolstate changes between $BASE_COMMIT and $(git rev-parse HEAD)\"\n-\n-    if git diff \"$BASE_COMMIT\" | grep --quiet \"^index .* 160000\"; then\n-        # Submodules pseudo-files inside git have the 160000 permissions, so when\n-        # those files are present in the diff a submodule was updated.\n-        echo \"Submodules were updated\"\n-    elif ! (git diff --quiet \"$BASE_COMMIT\" -- \\\n-             src/tools/clippy src/tools/rustfmt src/tools/miri \\\n-             library/std/src/sys); then\n-        # There is not an easy blanket search for subtrees. For now, manually list\n-        # the subtrees.\n-        # Also run this when the platform-specific parts of std change, in case\n-        # that breaks Miri.\n-        echo \"Tool subtrees were updated\"\n-    elif ! (git diff --quiet \"$BASE_COMMIT\" -- \\\n-             tests/rustdoc-gui \\\n-             src/librustdoc \\\n-             src/ci/docker/host-x86_64/x86_64-gnu-tools/Dockerfile \\\n-             src/ci/docker/host-x86_64/x86_64-gnu-tools/browser-ui-test.version \\\n-             src/tools/rustdoc-gui); then\n-        # There was a change in either rustdoc or in its GUI tests.\n-        echo \"Rustdoc was updated\"\n-    else\n-        echo \"Not executing this job since no submodules nor subtrees were updated\"\n-        ciCommandSetEnv SKIP_JOB 1\n-        exit 0\n-    fi\n-fi\n-\n if [[ -n \"${CI_ONLY_WHEN_CHANNEL-}\" ]]; then\n     if [[ \"${CI_ONLY_WHEN_CHANNEL}\" = \"$(cat src/ci/channel)\" ]]; then\n         echo \"The channel is the expected one\""}]}