{"sha": "330a558e42abb0fbfc020079754de299aaa409f2", "node_id": "C_kwDOAAsO6NoAKDMzMGE1NThlNDJhYmIwZmJmYzAyMDA3OTc1NGRlMjk5YWFhNDA5ZjI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-11-26T21:41:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-11-26T21:41:40Z"}, "message": "Rollup merge of #91223 - GuillaumeGomez:headings-indent, r=jsha\n\nFix headings indent\n\nFixes #91200.\n\nScreenshots with the fix:\n\n![Screenshot from 2021-11-25 15-32-35](https://user-images.githubusercontent.com/3050060/143462481-f7e9ea13-72d5-46fe-90e0-9527e74599e3.png)\n![Screenshot from 2021-11-25 15-32-49](https://user-images.githubusercontent.com/3050060/143462485-c010716a-0276-421b-a777-afff19c81c96.png)\n\nIf the first element of a top docblock is a heading, we still need to keep the indent, but only on this one (I added a test to check it). We need it because otherwise the anchor will go over the `[-]` toggle.\n\ncc `@camelid`\nr? `@jsha`", "tree": {"sha": "fed5a6701c7574e7e1f6da796cd9190d6360db9f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fed5a6701c7574e7e1f6da796cd9190d6360db9f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/330a558e42abb0fbfc020079754de299aaa409f2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhoVSUCRBK7hj4Ov3rIwAA5roIABk9D+TBmKFsos+NydrWuvxO\nK8MhDATMGaNKA2+l97leElZTuzrOxvDXuBBbNsGgTNf4I9/8N6EsjXAFyTH/lIAV\nPcg+PLWWeRw0cokSozKmrXd8boJVcNoSwLisbLHGWtpLPAJwd/oTwz8hQRX5uC0u\nQRX7Dj+M6V9wFrRZpac5gQWeifTDlABABE9+Ezm1keHt26rtiLi/7VT/vadao3j0\nLwEjwbI382Hhc5QnirXI+mCz5n8g5ViI9Y0towHP8q1V+bW58gNc27e8X0lGGkMM\n2BP+A7UfLYfapp4cvGeIIfqAD6UWRNAQqyFOAbkrrv66BrJtUbiiSnaLhXfE0UM=\n=4cqR\n-----END PGP SIGNATURE-----\n", "payload": "tree fed5a6701c7574e7e1f6da796cd9190d6360db9f\nparent fcbbdaf2092ad2dee5763389ad89f89cbf560906\nparent 23427567b2030dfe1a8e99cd86d2602517118035\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1637962900 +0100\ncommitter GitHub <noreply@github.com> 1637962900 +0100\n\nRollup merge of #91223 - GuillaumeGomez:headings-indent, r=jsha\n\nFix headings indent\n\nFixes #91200.\n\nScreenshots with the fix:\n\n![Screenshot from 2021-11-25 15-32-35](https://user-images.githubusercontent.com/3050060/143462481-f7e9ea13-72d5-46fe-90e0-9527e74599e3.png)\n![Screenshot from 2021-11-25 15-32-49](https://user-images.githubusercontent.com/3050060/143462485-c010716a-0276-421b-a777-afff19c81c96.png)\n\nIf the first element of a top docblock is a heading, we still need to keep the indent, but only on this one (I added a test to check it). We need it because otherwise the anchor will go over the `[-]` toggle.\n\ncc `@camelid`\nr? `@jsha`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/330a558e42abb0fbfc020079754de299aaa409f2", "html_url": "https://github.com/rust-lang/rust/commit/330a558e42abb0fbfc020079754de299aaa409f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/330a558e42abb0fbfc020079754de299aaa409f2/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fcbbdaf2092ad2dee5763389ad89f89cbf560906", "url": "https://api.github.com/repos/rust-lang/rust/commits/fcbbdaf2092ad2dee5763389ad89f89cbf560906", "html_url": "https://github.com/rust-lang/rust/commit/fcbbdaf2092ad2dee5763389ad89f89cbf560906"}, {"sha": "23427567b2030dfe1a8e99cd86d2602517118035", "url": "https://api.github.com/repos/rust-lang/rust/commits/23427567b2030dfe1a8e99cd86d2602517118035", "html_url": "https://github.com/rust-lang/rust/commit/23427567b2030dfe1a8e99cd86d2602517118035"}], "stats": {"total": 58, "additions": 53, "deletions": 5}, "files": [{"sha": "479b5210f9e0921a43e0c13ca027ec6834f49ee7", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/330a558e42abb0fbfc020079754de299aaa409f2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/330a558e42abb0fbfc020079754de299aaa409f2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=330a558e42abb0fbfc020079754de299aaa409f2", "patch": "@@ -1129,15 +1129,17 @@ h3.variant {\n \tmargin-top: 3px;\n }\n \n-.docblock > .section-header:first-child {\n+.top-doc .docblock > .section-header:first-child {\n \tmargin-left: 15px;\n-\tmargin-top: 0;\n }\n-\n-.docblock > .section-header:first-child:hover > a:before {\n+.top-doc .docblock > .section-header:first-child:hover > a:before {\n \tleft: -10px;\n }\n \n+.docblock > .section-header:first-child {\n+\tmargin-top: 0;\n+}\n+\n :target > code, :target > .code-header {\n \topacity: 1;\n }"}, {"sha": "8910cbbbb256c7c14cccd904c548591919a52576", "filename": "src/test/rustdoc-gui/anchors.goml", "status": "modified", "additions": 45, "deletions": 1, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/330a558e42abb0fbfc020079754de299aaa409f2/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "raw_url": "https://github.com/rust-lang/rust/raw/330a558e42abb0fbfc020079754de299aaa409f2/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fanchors.goml?ref=330a558e42abb0fbfc020079754de299aaa409f2", "patch": "@@ -1,4 +1,4 @@\n-// This test is to ensure that the anchors (`\u00a7`) have the expected color.\n+// This test is to ensure that the anchors (`\u00a7`) have the expected color and position.\n goto: file://|DOC_PATH|/test_docs/struct.HeavilyDocumentedStruct.html\n show-text: true\n \n@@ -28,3 +28,47 @@ assert-css: (\"h2#implementations a.anchor\", {\"color\": \"rgb(0, 0, 0)\"})\n // Same thing with the impl block title.\n move-cursor-to: \"#impl\"\n assert-css: (\"#impl a.anchor\", {\"color\": \"rgb(0, 0, 0)\"})\n+\n+// Now we check the positions: only the first heading of the top doc comment should\n+// have a different position.\n+move-cursor-to: \".top-doc .docblock .section-header:first-child\"\n+assert-css: (\n+    \".top-doc .docblock .section-header:first-child > a::before\",\n+    {\"left\": \"-10px\", \"padding-right\": \"10px\"}\n+)\n+// We also check that the heading itself has a different indent.\n+assert-css: (\".top-doc .docblock .section-header:first-child\", {\"margin-left\": \"15px\"})\n+\n+move-cursor-to: \".top-doc .docblock .section-header:not(:first-child)\"\n+assert-css: (\n+    \".top-doc .docblock .section-header:not(:first-child) > a::before\",\n+    {\"left\": \"-25px\", \"padding-right\": \"10px\"}\n+)\n+assert-css: (\".top-doc .docblock .section-header:not(:first-child)\", {\"margin-left\": \"0px\"})\n+\n+// Now let's check some other docblock headings...\n+// First the impl block docs.\n+move-cursor-to: \"#title-for-struct-impl-doc\"\n+assert-css: (\n+    \"#title-for-struct-impl-doc > a::before\",\n+    {\"left\": \"-25px\", \"padding-right\": \"10px\"}\n+)\n+assert-css: (\"#title-for-struct-impl-doc\", {\"margin-left\": \"0px\"})\n+// Now a method docs.\n+move-cursor-to: \"#title-for-struct-impl-item-doc\"\n+assert-css: (\n+    \"#title-for-struct-impl-item-doc > a::before\",\n+    {\"left\": \"-25px\", \"padding-right\": \"10px\"}\n+)\n+assert-css: (\"#title-for-struct-impl-item-doc\", {\"margin-left\": \"0px\"})\n+\n+// Finally, we want to ensure that if the first element of the doc block isn't a heading,\n+// if there is a heading afterwards, it won't have the indent.\n+goto: file://|DOC_PATH|/test_docs/enum.WhoLetTheDogOut.html\n+\n+move-cursor-to: \".top-doc .docblock .section-header\"\n+assert-css: (\n+    \".top-doc .docblock .section-header > a::before\",\n+    {\"left\": \"-25px\", \"padding-right\": \"10px\"}\n+)\n+assert-css: (\".top-doc .docblock .section-header\", {\"margin-left\": \"0px\"})"}, {"sha": "9b37703dded4b7acf9e494019ecc200c512ad997", "filename": "src/test/rustdoc-gui/src/test_docs/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/330a558e42abb0fbfc020079754de299aaa409f2/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/330a558e42abb0fbfc020079754de299aaa409f2/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Ftest_docs%2Flib.rs?ref=330a558e42abb0fbfc020079754de299aaa409f2", "patch": "@@ -47,6 +47,8 @@ impl AsRef<str> for Foo {\n }\n \n /// Just a normal enum.\n+///\n+/// # title!\n #[doc(alias = \"ThisIsAnAlias\")]\n pub enum WhoLetTheDogOut {\n     /// Woof!"}]}