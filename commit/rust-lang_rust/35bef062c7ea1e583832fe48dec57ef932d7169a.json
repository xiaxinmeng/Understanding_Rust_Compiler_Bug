{"sha": "35bef062c7ea1e583832fe48dec57ef932d7169a", "node_id": "C_kwDOAAsO6NoAKDM1YmVmMDYyYzdlYTFlNTgzODMyZmU0OGRlYzU3ZWY5MzJkNzE2OWE", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-05-20T06:51:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-20T06:51:00Z"}, "message": "Rollup merge of #111708 - jyn514:delay-span-bug-msg, r=compiler-errors\n\nGive a more useful location for where a span_bug was delayed\n\nBefore:\n```\n   = note: delayed at    0: <rustc_errors::HandlerInner>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1335:29\n              1: <rustc_errors::Handler>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1124:9\n...\n```\n\nAfter:\n```\n   = note: delayed at compiler/rustc_parse/src/parser/diagnostics.rs:2158:28\n              0: <rustc_errors::HandlerInner>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1335:29\n              1: <rustc_errors::Handler>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1124:9\n...\n```\n\nThis both makes the relevant frame easier to find without having to dig through diagnostic internals, and avoids the weird-looking formatting for the first frame.\n\nFound while working on https://github.com/rust-lang/rust/issues/111529.", "tree": {"sha": "0de22caea6d2972fe05789937259ce87e71ae2ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0de22caea6d2972fe05789937259ce87e71ae2ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/35bef062c7ea1e583832fe48dec57ef932d7169a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkaG3UCRBK7hj4Ov3rIwAAaM0IADIImsqQRBn9EE5ytg667Flm\nql4XMrBK59pyVAAIstUoeTBoAwEn+aCbszQL2CYzt4MA4Uf9I3DU4B8qt8knuWpC\nApW4OJmv0NnzM8wXRjr/jIm10mhc7aY346W0xp70+u7sqSwP3GPXSO8G3OsS5Z0B\nCJOf27a7Uh2jzC0LVHf7XycORLJkpQWMNOAkQE+HeDxZe71JvM29Mvhoy281cRWg\nc5uCtrS9RjE/kF0myTrcnoZ8JK87qwpWBHTEiWXpi0tdac2BNJ59LoulBQkMwohZ\nzBd/Pd2FY5ntPzIcOQC/jRiwrrx6r1eZntCHp2YO2YxVE74Pck21jCjqng/4iBU=\n=V6eC\n-----END PGP SIGNATURE-----\n", "payload": "tree 0de22caea6d2972fe05789937259ce87e71ae2ea\nparent e892e32df48f9fc180e085fe0d8a4969525c0130\nparent e6a7fdedd720cce583f30cab41f67bf0a353a75a\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1684565460 +0530\ncommitter GitHub <noreply@github.com> 1684565460 +0530\n\nRollup merge of #111708 - jyn514:delay-span-bug-msg, r=compiler-errors\n\nGive a more useful location for where a span_bug was delayed\n\nBefore:\n```\n   = note: delayed at    0: <rustc_errors::HandlerInner>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1335:29\n              1: <rustc_errors::Handler>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1124:9\n...\n```\n\nAfter:\n```\n   = note: delayed at compiler/rustc_parse/src/parser/diagnostics.rs:2158:28\n              0: <rustc_errors::HandlerInner>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1335:29\n              1: <rustc_errors::Handler>::emit_diagnostic\n                        at ./compiler/rustc_errors/src/lib.rs:1124:9\n...\n```\n\nThis both makes the relevant frame easier to find without having to dig through diagnostic internals, and avoids the weird-looking formatting for the first frame.\n\nFound while working on https://github.com/rust-lang/rust/issues/111529.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/35bef062c7ea1e583832fe48dec57ef932d7169a", "html_url": "https://github.com/rust-lang/rust/commit/35bef062c7ea1e583832fe48dec57ef932d7169a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/35bef062c7ea1e583832fe48dec57ef932d7169a/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e892e32df48f9fc180e085fe0d8a4969525c0130", "url": "https://api.github.com/repos/rust-lang/rust/commits/e892e32df48f9fc180e085fe0d8a4969525c0130", "html_url": "https://github.com/rust-lang/rust/commit/e892e32df48f9fc180e085fe0d8a4969525c0130"}, {"sha": "e6a7fdedd720cce583f30cab41f67bf0a353a75a", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6a7fdedd720cce583f30cab41f67bf0a353a75a", "html_url": "https://github.com/rust-lang/rust/commit/e6a7fdedd720cce583f30cab41f67bf0a353a75a"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "d58555272424ca317077ea7b6a3e4593f68c3ae5", "filename": "compiler/rustc_errors/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/35bef062c7ea1e583832fe48dec57ef932d7169a/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/35bef062c7ea1e583832fe48dec57ef932d7169a/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Flib.rs?ref=35bef062c7ea1e583832fe48dec57ef932d7169a", "patch": "@@ -1740,7 +1740,7 @@ impl DelayedDiagnostic {\n     }\n \n     fn decorate(mut self) -> Diagnostic {\n-        self.inner.note(format!(\"delayed at {}\", self.note));\n+        self.inner.note(format!(\"delayed at {}\\n{}\", self.inner.emitted_at, self.note));\n         self.inner\n     }\n }"}, {"sha": "bcef0f7185fbf43b273dcc4486cbc661548bdf1a", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/35bef062c7ea1e583832fe48dec57ef932d7169a/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/35bef062c7ea1e583832fe48dec57ef932d7169a/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=35bef062c7ea1e583832fe48dec57ef932d7169a", "patch": "@@ -238,6 +238,7 @@ impl<'a> DerefMut for SnapshotParser<'a> {\n \n impl<'a> Parser<'a> {\n     #[rustc_lint_diagnostics]\n+    #[track_caller]\n     pub fn struct_span_err<S: Into<MultiSpan>>(\n         &self,\n         sp: S,"}]}