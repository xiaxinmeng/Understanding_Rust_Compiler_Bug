{"sha": "7537f953e2d28dc0f34ab39737b058e7b79a7fb7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1MzdmOTUzZTJkMjhkYzBmMzRhYjM5NzM3YjA1OGU3Yjc5YTdmYjc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-08T15:39:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-08T15:39:39Z"}, "message": "Auto merge of #38182 - bluss:more-vec-extend, r=alexcrichton\n\nSpecialization for Extend<&T> for vec\n\nSpecialize to use copy_from_slice when extending a Vec with &[T] where\nT: Copy.\n\nThis specialization results in `.clone()` not being called in `extend_from_slice` and `extend` when the element is `Copy`.\n\nFixes #38021", "tree": {"sha": "8af0e2635b2d7cc801be99ad33185577178040a3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8af0e2635b2d7cc801be99ad33185577178040a3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7537f953e2d28dc0f34ab39737b058e7b79a7fb7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7537f953e2d28dc0f34ab39737b058e7b79a7fb7", "html_url": "https://github.com/rust-lang/rust/commit/7537f953e2d28dc0f34ab39737b058e7b79a7fb7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7537f953e2d28dc0f34ab39737b058e7b79a7fb7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47ffafcdcd01ec3f782b89e8ea27a7f1a7183ae0", "url": "https://api.github.com/repos/rust-lang/rust/commits/47ffafcdcd01ec3f782b89e8ea27a7f1a7183ae0", "html_url": "https://github.com/rust-lang/rust/commit/47ffafcdcd01ec3f782b89e8ea27a7f1a7183ae0"}, {"sha": "02bf1ce9cc617979478aac09a95486696f2c4b36", "url": "https://api.github.com/repos/rust-lang/rust/commits/02bf1ce9cc617979478aac09a95486696f2c4b36", "html_url": "https://github.com/rust-lang/rust/commit/02bf1ce9cc617979478aac09a95486696f2c4b36"}], "stats": {"total": 39, "additions": 33, "deletions": 6}, "files": [{"sha": "c9f9e513ef3d6f7a34e789eb1d839af1916ebb9e", "filename": "src/libcollections/vec.rs", "status": "modified", "additions": 33, "deletions": 6, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/7537f953e2d28dc0f34ab39737b058e7b79a7fb7/src%2Flibcollections%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7537f953e2d28dc0f34ab39737b058e7b79a7fb7/src%2Flibcollections%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec.rs?ref=7537f953e2d28dc0f34ab39737b058e7b79a7fb7", "patch": "@@ -1244,7 +1244,7 @@ impl<T: Clone> Vec<T> {\n     /// ```\n     #[stable(feature = \"vec_extend_from_slice\", since = \"1.6.0\")]\n     pub fn extend_from_slice(&mut self, other: &[T]) {\n-        self.extend(other.iter().cloned())\n+        self.spec_extend(other.iter())\n     }\n }\n \n@@ -1499,7 +1499,7 @@ impl<T> ops::DerefMut for Vec<T> {\n impl<T> FromIterator<T> for Vec<T> {\n     #[inline]\n     fn from_iter<I: IntoIterator<Item = T>>(iter: I) -> Vec<T> {\n-        <Self as SpecExtend<_>>::from_iter(iter.into_iter())\n+        <Self as SpecExtend<_, _>>::from_iter(iter.into_iter())\n     }\n }\n \n@@ -1572,12 +1572,12 @@ impl<T> Extend<T> for Vec<T> {\n }\n \n // Specialization trait used for Vec::from_iter and Vec::extend\n-trait SpecExtend<I> {\n+trait SpecExtend<T, I> {\n     fn from_iter(iter: I) -> Self;\n     fn spec_extend(&mut self, iter: I);\n }\n \n-impl<I, T> SpecExtend<I> for Vec<T>\n+impl<T, I> SpecExtend<T, I> for Vec<T>\n     where I: Iterator<Item=T>,\n {\n     default fn from_iter(mut iterator: I) -> Self {\n@@ -1607,7 +1607,7 @@ impl<I, T> SpecExtend<I> for Vec<T>\n     }\n }\n \n-impl<I, T> SpecExtend<I> for Vec<T>\n+impl<T, I> SpecExtend<T, I> for Vec<T>\n     where I: TrustedLen<Item=T>,\n {\n     fn from_iter(iterator: I) -> Self {\n@@ -1642,6 +1642,33 @@ impl<I, T> SpecExtend<I> for Vec<T>\n     }\n }\n \n+impl<'a, T: 'a, I> SpecExtend<&'a T, I> for Vec<T>\n+    where I: Iterator<Item=&'a T>,\n+          T: Clone,\n+{\n+    default fn from_iter(iterator: I) -> Self {\n+        SpecExtend::from_iter(iterator.cloned())\n+    }\n+\n+    default fn spec_extend(&mut self, iterator: I) {\n+        self.spec_extend(iterator.cloned())\n+    }\n+}\n+\n+impl<'a, T: 'a> SpecExtend<&'a T, slice::Iter<'a, T>> for Vec<T>\n+    where T: Copy,\n+{\n+    fn spec_extend(&mut self, iterator: slice::Iter<'a, T>) {\n+        let slice = iterator.as_slice();\n+        self.reserve(slice.len());\n+        unsafe {\n+            let len = self.len();\n+            self.set_len(len + slice.len());\n+            self.get_unchecked_mut(len..).copy_from_slice(slice);\n+        }\n+    }\n+}\n+\n impl<T> Vec<T> {\n     fn extend_desugared<I: Iterator<Item = T>>(&mut self, mut iterator: I) {\n         // This is the case for a general iterator.\n@@ -1669,7 +1696,7 @@ impl<T> Vec<T> {\n #[stable(feature = \"extend_ref\", since = \"1.2.0\")]\n impl<'a, T: 'a + Copy> Extend<&'a T> for Vec<T> {\n     fn extend<I: IntoIterator<Item = &'a T>>(&mut self, iter: I) {\n-        self.extend(iter.into_iter().map(|&x| x))\n+        self.spec_extend(iter.into_iter())\n     }\n }\n "}]}