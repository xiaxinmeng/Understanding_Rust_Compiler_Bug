{"sha": "9f89cc9d15cafc3d6bc36ed98b2b816adec81e83", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmODljYzlkMTVjYWZjM2Q2YmMzNmVkOThiMmI4MTZhZGVjODFlODM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-21T22:06:52Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-22T02:10:32Z"}, "message": "rt: Shave a few instructions off __morestack", "tree": {"sha": "9e92f612e34ef4248a8e1f8cc734a5fb58fd46f5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9e92f612e34ef4248a8e1f8cc734a5fb58fd46f5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f89cc9d15cafc3d6bc36ed98b2b816adec81e83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f89cc9d15cafc3d6bc36ed98b2b816adec81e83", "html_url": "https://github.com/rust-lang/rust/commit/9f89cc9d15cafc3d6bc36ed98b2b816adec81e83", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f89cc9d15cafc3d6bc36ed98b2b816adec81e83/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5f6135fd0b2ed68ee0b0836967a31d8375523e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5f6135fd0b2ed68ee0b0836967a31d8375523e0", "html_url": "https://github.com/rust-lang/rust/commit/f5f6135fd0b2ed68ee0b0836967a31d8375523e0"}], "stats": {"total": 73, "additions": 31, "deletions": 42}, "files": [{"sha": "a535f6388c063a73bc06a3b0fcc427effd81890a", "filename": "src/rt/arch/x86_64/morestack.S", "status": "modified", "additions": 31, "deletions": 42, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/9f89cc9d15cafc3d6bc36ed98b2b816adec81e83/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "raw_url": "https://github.com/rust-lang/rust/raw/9f89cc9d15cafc3d6bc36ed98b2b816adec81e83/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S?ref=9f89cc9d15cafc3d6bc36ed98b2b816adec81e83", "patch": "@@ -49,30 +49,25 @@ MORESTACK:\n \t// Calculate the CFA as on offset from %ebp\n \t.cfi_def_cfa_register %rbp\n \n-\tpushq $0 // Alignment\n+        subq $200, %rsp\n \n \t// FIXME: libgcc also saves rax. not sure if we need to\n \n \t// Save argument registers of the original function\n-\tpushq\t%rdi\n-\tpushq\t%rsi\n-\tpushq\t%rdx\n-\tpushq\t%rcx\n-\tpushq\t%r8\n-\tpushq\t%r9\n-\n-\tpushq $0 // Alignment\n-\tpushq $0 // Alignment\n-\n-\tsubq $128, %rsp\n-\tmovdqa %xmm0,\t (%rsp)\n-\tmovdqa %xmm1,  16(%rsp)\n-\tmovdqa %xmm2,  32(%rsp)\n-\tmovdqa %xmm3,  48(%rsp)\n-\tmovdqa %xmm4,  64(%rsp)\n-\tmovdqa %xmm5,  80(%rsp)\n-\tmovdqa %xmm6,  96(%rsp)\n-\tmovdqa %xmm7, 112(%rsp)\n+\tmovq %rdi,       (%rsp)\n+\tmovq %rsi,      8(%rsp)\n+\tmovq %rdx,     16(%rsp)\n+\tmovq %rcx,     24(%rsp)\n+\tmovq %r8,      32(%rsp)\n+\tmovq %r9,      40(%rsp)\n+\tmovdqa %xmm0,  48(%rsp)\n+\tmovdqa %xmm1,  64(%rsp)\n+\tmovdqa %xmm2,  80(%rsp)\n+\tmovdqa %xmm3,  96(%rsp)\n+\tmovdqa %xmm4, 112(%rsp)\n+\tmovdqa %xmm5, 128(%rsp)\n+\tmovdqa %xmm6, 144(%rsp)\n+\tmovdqa %xmm7, 160(%rsp)\n \n \t// Calculate the address of the stack arguments.\n \t// We have the base pointer, __morestack's return address,\n@@ -97,28 +92,22 @@ MORESTACK:\n #endif\n \n \t// Pop the saved arguments\n-\tmovdqa    (%rsp), %xmm0\n-\tmovdqa  16(%rsp), %xmm1\n-\tmovdqa  32(%rsp), %xmm2\n-\tmovdqa  48(%rsp), %xmm3\n-\tmovdqa  64(%rsp), %xmm4\n-\tmovdqa  80(%rsp), %xmm5\n-\tmovdqa  96(%rsp), %xmm6\n-\tmovdqa 112(%rsp), %xmm7\n-\taddq $128, %rsp\n-\n-\tpopq %r9 // Alignment\n-\tpopq %r9 // Alignment\n-\n-\tpopq %r9\n-\tpopq %r8\n-\tpopq %rcx\n-\tpopq %rdx\n-\tpopq %rsi\n-\tpopq %rdi\n-\n-\t// Pop the unwinding %rsp\n-\taddq $8, %rsp\n+\tmovq      (%rsp), %rdi\n+\tmovq     8(%rsp), %rsi\n+\tmovq    16(%rsp), %rdx\n+\tmovq    24(%rsp), %rcx\n+\tmovq    32(%rsp), %r8\n+\tmovq    40(%rsp), %r9\n+\tmovdqa  48(%rsp), %xmm0\n+\tmovdqa  64(%rsp), %xmm1\n+\tmovdqa  80(%rsp), %xmm2\n+\tmovdqa  96(%rsp), %xmm3\n+\tmovdqa 112(%rsp), %xmm4\n+\tmovdqa 128(%rsp), %xmm5\n+\tmovdqa 144(%rsp), %xmm6\n+\tmovdqa 160(%rsp), %xmm7\n+\n+\taddq $200, %rsp\n \n         movq 8(%rbp),%r10       // Grab the return pointer.\n         incq %r10               // Skip past the `ret` in our parent frame"}]}