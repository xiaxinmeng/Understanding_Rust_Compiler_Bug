{"sha": "1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhNDkxZTIzMDQzODdjMmE1MGM1YTBhZTIxOWU4ZDVhMGNlMWJjODk=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-04-10T20:28:58Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-05-02T21:32:44Z"}, "message": "Set target_family=\"wasm\" for wasm targets", "tree": {"sha": "383576f880aba8c44a663531b827250323656cfe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/383576f880aba8c44a663531b827250323656cfe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "html_url": "https://github.com/rust-lang/rust/commit/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4afea69090b5501c17b16957d090658a1b3c2216", "url": "https://api.github.com/repos/rust-lang/rust/commits/4afea69090b5501c17b16957d090658a1b3c2216", "html_url": "https://github.com/rust-lang/rust/commit/4afea69090b5501c17b16957d090658a1b3c2216"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "3ac9b5b3d3b7fe7697cdf42dd8db206488771060", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "patch": "@@ -1046,7 +1046,7 @@ pub struct TargetOptions {\n     ///\n     /// Common options are: \"unix\", \"windows\". Defaults to no families.\n     ///\n-    /// See https://doc.rust-lang.org/reference/conditional-compilation.html#target_family\n+    /// See <https://doc.rust-lang.org/reference/conditional-compilation.html#target_family>.\n     pub families: Vec<String>,\n     /// Whether the target toolchain's ABI supports returning small structs as an integer.\n     pub abi_return_struct_as_int: bool,"}, {"sha": "87e740de08e9175e0099c03bac8ff93252d65c63", "filename": "compiler/rustc_target/src/spec/wasm_base.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm_base.rs?ref=1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "patch": "@@ -61,6 +61,7 @@ pub fn options() -> TargetOptions {\n \n     TargetOptions {\n         is_like_wasm: true,\n+        families: vec![\"wasm\".to_string()],\n \n         // we allow dynamic linking, but only cdylibs. Basically we allow a\n         // final library artifact that exports some symbols (a wasm module) but"}, {"sha": "c7d196a2aa6eba992610f4ea1319b68450f37a99", "filename": "src/test/ui/cfg/cfg-family.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/src%2Ftest%2Fui%2Fcfg%2Fcfg-family.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/src%2Ftest%2Fui%2Fcfg%2Fcfg-family.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg%2Fcfg-family.rs?ref=1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "patch": "@@ -1,6 +1,6 @@\n-// run-pass\n+// build-pass\n // pretty-expanded FIXME #23616\n-// ignore-wasm32-bare no target_family\n+// ignore-wasm32-bare no bare family\n // ignore-sgx\n \n #[cfg(windows)]"}, {"sha": "90a59fab8e250b7c2808e21492146600abf425b5", "filename": "src/test/ui/cfg/cfg-target-family.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/src%2Ftest%2Fui%2Fcfg%2Fcfg-target-family.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89/src%2Ftest%2Fui%2Fcfg%2Fcfg-target-family.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg%2Fcfg-target-family.rs?ref=1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "patch": "@@ -1,5 +1,4 @@\n-// run-pass\n-// ignore-wasm32-bare no target_family\n+// build-pass\n // ignore-sgx\n \n // pretty-expanded FIXME #23616\n@@ -11,3 +10,7 @@ pub fn main() {\n #[cfg(target_family = \"unix\")]\n pub fn main() {\n }\n+\n+#[cfg(target_family=\"wasm\")]\n+pub fn main() {\n+}"}]}