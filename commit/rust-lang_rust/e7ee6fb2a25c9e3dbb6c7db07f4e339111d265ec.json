{"sha": "e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3ZWU2ZmIyYTI1YzllM2RiYjZjN2RiMDdmNGUzMzkxMTFkMjY1ZWM=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-08-11T13:58:28Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-08-11T14:02:47Z"}, "message": "Do not consider built-in attributes as candidates when resolving non-attribute macro invocations\n\nThis is needed to avoid regressions on stable channel", "tree": {"sha": "6d01f6d40a7d13c532534c1ae427d6f38974962c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d01f6d40a7d13c532534c1ae427d6f38974962c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "html_url": "https://github.com/rust-lang/rust/commit/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2f56378da7f722145d54f7c9c54deed43e2a12b", "url": "https://api.github.com/repos/rust-lang/rust/commits/d2f56378da7f722145d54f7c9c54deed43e2a12b", "html_url": "https://github.com/rust-lang/rust/commit/d2f56378da7f722145d54f7c9c54deed43e2a12b"}], "stats": {"total": 56, "additions": 20, "deletions": 36}, "files": [{"sha": "f111a44efe05b6d323bc807f7f034cb534041470", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "patch": "@@ -669,7 +669,10 @@ impl<'a, 'cl> Resolver<'a, 'cl> {\n                     }\n                 }\n                 WhereToResolve::BuiltinAttrs => {\n-                    if is_builtin_attr_name(ident.name) {\n+                    // FIXME: Only built-in attributes are not considered as candidates for\n+                    // non-attributes to fight off regressions on stable channel (#53205).\n+                    // We need to come up with some more principled approach instead.\n+                    if is_attr && is_builtin_attr_name(ident.name) {\n                         let binding = (Def::NonMacroAttr(NonMacroAttrKind::Builtin),\n                                        ty::Visibility::Public, ident.span, Mark::root())\n                                        .to_name_binding(self.arenas);"}, {"sha": "acac2d151fe9ad5ef8008d3caf10f1a5de111bf7", "filename": "src/test/ui/issue-11692-2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fissue-11692-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fissue-11692-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-11692-2.rs?ref=e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "patch": "@@ -10,5 +10,5 @@\n \n fn main() {\n     concat!(test!());\n-    //~^ ERROR expected a macro, found built-in attribute\n+    //~^ ERROR cannot find macro `test!` in this scope\n }"}, {"sha": "51d6041e92220e356b6f873a9ec54c9c8e5ca952", "filename": "src/test/ui/issue-11692-2.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fissue-11692-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fissue-11692-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-11692-2.stderr?ref=e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "patch": "@@ -1,4 +1,4 @@\n-error: expected a macro, found built-in attribute\n+error: cannot find macro `test!` in this scope\n   --> $DIR/issue-11692-2.rs:12:13\n    |\n LL |     concat!(test!());"}, {"sha": "d325b0460015c7f18660ce555e42aa0136757b44", "filename": "src/test/ui/macro-path-prelude-fail-3.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-fail-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-fail-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacro-path-prelude-fail-3.rs?ref=e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "patch": "@@ -10,9 +10,9 @@\n \n #![feature(use_extern_macros)]\n \n-#[derive(inline)] //~ ERROR expected a macro, found built-in attribute\n+#[derive(inline)] //~ ERROR cannot find derive macro `inline` in this scope\n struct S;\n \n fn main() {\n-    inline!(); //~ ERROR expected a macro, found built-in attribute\n+    inline!(); //~ ERROR cannot find macro `inline!` in this scope\n }"}, {"sha": "c9af4b66427516df4a674b863d0a2c7b5e68d057", "filename": "src/test/ui/macro-path-prelude-fail-3.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-fail-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-fail-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacro-path-prelude-fail-3.stderr?ref=e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "patch": "@@ -1,14 +1,14 @@\n-error: expected a macro, found built-in attribute\n+error: cannot find derive macro `inline` in this scope\n   --> $DIR/macro-path-prelude-fail-3.rs:13:10\n    |\n-LL | #[derive(inline)] //~ ERROR expected a macro, found built-in attribute\n+LL | #[derive(inline)] //~ ERROR cannot find derive macro `inline` in this scope\n    |          ^^^^^^\n \n-error: expected a macro, found built-in attribute\n+error: cannot find macro `inline!` in this scope\n   --> $DIR/macro-path-prelude-fail-3.rs:17:5\n    |\n-LL |     inline!(); //~ ERROR expected a macro, found built-in attribute\n-   |     ^^^^^^\n+LL |     inline!(); //~ ERROR cannot find macro `inline!` in this scope\n+   |     ^^^^^^ help: you could try the macro: `line`\n \n error: aborting due to 2 previous errors\n "}, {"sha": "6831cd81d7daebffc0291d15a21f65ca8a21d74b", "filename": "src/test/ui/macro-path-prelude-shadowing.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-shadowing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-shadowing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacro-path-prelude-shadowing.rs?ref=e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "patch": "@@ -21,7 +21,9 @@ add_macro_expanded_things_to_macro_prelude!();\n \n mod m1 {\n     fn check() {\n-        inline!(); //~ ERROR `inline` is ambiguous\n+        inline!(); // OK. Theoretically ambiguous, but we do not consider built-in attributes\n+                   // as candidates for non-attribute macro invocations to avoid regressions\n+                   // on stable channel\n     }\n }\n "}, {"sha": "c0892f97376e32fd0ccbacdfb5824f824395957a", "filename": "src/test/ui/macro-path-prelude-shadowing.stderr", "status": "modified", "additions": 4, "deletions": 25, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-shadowing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec/src%2Ftest%2Fui%2Fmacro-path-prelude-shadowing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacro-path-prelude-shadowing.stderr?ref=e7ee6fb2a25c9e3dbb6c7db07f4e339111d265ec", "patch": "@@ -1,42 +1,21 @@\n-error[E0659]: `inline` is ambiguous\n-  --> $DIR/macro-path-prelude-shadowing.rs:24:9\n-   |\n-LL |         inline!(); //~ ERROR `inline` is ambiguous\n-   |         ^^^^^^\n-   |\n-note: `inline` could refer to the name imported here\n-  --> $DIR/macro-path-prelude-shadowing.rs:16:5\n-   |\n-LL |     #[macro_use]\n-   |     ^^^^^^^^^^^^\n-...\n-LL | add_macro_expanded_things_to_macro_prelude!();\n-   | ---------------------------------------------- in this macro invocation\n-note: `inline` could also refer to the name defined here\n-  --> $DIR/macro-path-prelude-shadowing.rs:24:9\n-   |\n-LL |         inline!(); //~ ERROR `inline` is ambiguous\n-   |         ^^^^^^\n-   = note: macro-expanded macro imports do not shadow\n-\n error[E0659]: `std` is ambiguous\n-  --> $DIR/macro-path-prelude-shadowing.rs:37:9\n+  --> $DIR/macro-path-prelude-shadowing.rs:39:9\n    |\n LL |         std::panic!(); //~ ERROR `std` is ambiguous\n    |         ^^^^^^^^^^\n    |\n note: `std` could refer to the name imported here\n-  --> $DIR/macro-path-prelude-shadowing.rs:35:9\n+  --> $DIR/macro-path-prelude-shadowing.rs:37:9\n    |\n LL |     use m2::*; // glob-import user-defined `std`\n    |         ^^^^^\n note: `std` could also refer to the name defined here\n-  --> $DIR/macro-path-prelude-shadowing.rs:37:9\n+  --> $DIR/macro-path-prelude-shadowing.rs:39:9\n    |\n LL |         std::panic!(); //~ ERROR `std` is ambiguous\n    |         ^^^\n    = note: consider adding an explicit import of `std` to disambiguate\n \n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0659`."}]}