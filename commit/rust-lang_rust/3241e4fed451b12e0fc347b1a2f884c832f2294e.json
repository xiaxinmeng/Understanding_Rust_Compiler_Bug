{"sha": "3241e4fed451b12e0fc347b1a2f884c832f2294e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyNDFlNGZlZDQ1MWIxMmUwZmMzNDdiMWEyZjg4NGM4MzJmMjI5NGU=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-12T13:49:08Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-12T14:01:39Z"}, "message": "Run deploy workflow on tags, instead of releases", "tree": {"sha": "6e3fe868f21543bb8093ba3ba03912e0c7f271c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e3fe868f21543bb8093ba3ba03912e0c7f271c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3241e4fed451b12e0fc347b1a2f884c832f2294e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl5EBUQACgkQaTCGhp1Q\nZjeJxw//ZGYL/i0qKPWTsbXPBZCgQc3dhhI0v/Y9BOE5957iKXnWorDRD3mVsvvw\nUcAAuuC6IYusLwP4NZKwEJnWy0XIRQu1sv+f63XkdyzlWubz+Wzll47yUu8qKRPH\nv83m0k3dBTr8ly7/KrUBwtSj63OiNYGghkekp1CBRLxf7zbMswVzvqGGUdTW+VD2\nMvmoT3ub5vrPxWWNTigOa025MVu0ULt4pGErp0E+/Iqyf5DI1SluaPx6EsXtWSgp\nlDwe9Lh32CNEsALwPkrxlOPgc25YgU8IS/mwWjTTt7ZYVE3oN+sLTe+RWW1Zsixk\nLmlfzLw33rIHxFAsGQ/q91CVQYflL3uvFPHhd0XtRl11qdKvhlCjN+tfj/i716E8\n6mx0LNxo0pTruiA2u+pExiJIWPg7gnQ0vmJSd22FQ+tlHRetuKr1FajDCG6I6auW\nQMYHjLP9aYEvF1CprYSUq5Y9jL4ck0tRwitfCa4/SnL/LYIz9NJbJZpCS8+WOb1t\nngTmCB6H2xjOIXWKsnFAZf+8Z0+qrG+H6DSwX9WdxgsfVS4dokjq6RuJGesz3QHy\ngF15qalaBU2AEwJoRDCnj6XiiPrbiuylCu5iUXIXrJJ7h0W42yYE5yJWEblEIVjr\n/QOGWluimRLEmz2tb4cvZuU0nUE7P78XanRj97IqsEwFwxLH+J4=\n=LhAE\n-----END PGP SIGNATURE-----", "payload": "tree 6e3fe868f21543bb8093ba3ba03912e0c7f271c7\nparent 2432a16973bf50665f75cb3e56cab1611bd96ec0\nauthor flip1995 <hello@philkrones.com> 1581515348 +0100\ncommitter flip1995 <hello@philkrones.com> 1581516099 +0100\n\nRun deploy workflow on tags, instead of releases\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3241e4fed451b12e0fc347b1a2f884c832f2294e", "html_url": "https://github.com/rust-lang/rust/commit/3241e4fed451b12e0fc347b1a2f884c832f2294e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3241e4fed451b12e0fc347b1a2f884c832f2294e/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2432a16973bf50665f75cb3e56cab1611bd96ec0", "url": "https://api.github.com/repos/rust-lang/rust/commits/2432a16973bf50665f75cb3e56cab1611bd96ec0", "html_url": "https://github.com/rust-lang/rust/commit/2432a16973bf50665f75cb3e56cab1611bd96ec0"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "be40b27440d7c773aea6ec19e332d6e766ebc87c", "filename": ".github/workflows/deploy.yml", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3241e4fed451b12e0fc347b1a2f884c832f2294e/.github%2Fworkflows%2Fdeploy.yml", "raw_url": "https://github.com/rust-lang/rust/raw/3241e4fed451b12e0fc347b1a2f884c832f2294e/.github%2Fworkflows%2Fdeploy.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fdeploy.yml?ref=3241e4fed451b12e0fc347b1a2f884c832f2294e", "patch": "@@ -4,15 +4,13 @@ on:\n   push:\n     branches:\n       - master\n-  release:\n-    types:\n-      - created\n+    tags:\n+      - rust-1.**\n \n env:\n   TARGET_BRANCH: 'gh-pages'\n   SHA: '${{ github.sha }}'\n   SSH_REPO: 'git@github.com:${{ github.repository }}.git'\n-  TAG_NAME: '${{ github.event.release.GITHUB_REF }}'\n \n jobs:\n   deploy:\n@@ -30,6 +28,11 @@ jobs:\n         path: 'out'\n \n     # Run\n+    - name: Set tag name\n+      if: startswith(github.ref, 'refs/tags/')\n+      run: |\n+        TAG=$(basename ${{ github.ref }})\n+        echo \"::set-env name=TAG_NAME::$TAG\"\n     - name: Deploy\n       run: |\n         eval \"$(ssh-agent -s)\""}]}