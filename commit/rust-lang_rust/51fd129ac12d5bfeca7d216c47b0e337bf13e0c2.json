{"sha": "51fd129ac12d5bfeca7d216c47b0e337bf13e0c2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxZmQxMjlhYzEyZDViZmVjYTdkMjE2YzQ3YjBlMzM3YmYxM2UwYzI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-30T05:02:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-30T05:02:01Z"}, "message": "Auto merge of #86689 - rylev:future-compat-lint-group, r=nikomatsakis\n\nOnly include lint in future_incompatible lint group if not an edition lint\n\nA follow up to #86330 - this only includes lints annotated with `FutureIncompatibleInfo` in the `future_incompatibile` lint group if the future compatibility is not tied to an edition.\n\nWe probably want to rename `FutureIncompatibleInfo` to something else since this type is now used to indicate future breakages of all kinds (even those that happen in editions). I'd prefer to do that in a separate PR though.\n\nr? `@nikomatsakis`", "tree": {"sha": "a8cfa383dff35085dbf71e48d61198b2223ae912", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a8cfa383dff35085dbf71e48d61198b2223ae912"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2", "html_url": "https://github.com/rust-lang/rust/commit/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9af4bdeab0d971d61ea59a02923944fc80daafcc", "url": "https://api.github.com/repos/rust-lang/rust/commits/9af4bdeab0d971d61ea59a02923944fc80daafcc", "html_url": "https://github.com/rust-lang/rust/commit/9af4bdeab0d971d61ea59a02923944fc80daafcc"}, {"sha": "f0d7280ff3b608f56031c63930dee0358f8b5038", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0d7280ff3b608f56031c63930dee0358f8b5038", "html_url": "https://github.com/rust-lang/rust/commit/f0d7280ff3b608f56031c63930dee0358f8b5038"}], "stats": {"total": 62, "additions": 43, "deletions": 19}, "files": [{"sha": "b352b8c31ecf2f7a1cbf75686e6cc161c083feea", "filename": "compiler/rustc_lint/src/context.rs", "status": "modified", "additions": 13, "deletions": 10, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs?ref=51fd129ac12d5bfeca7d216c47b0e337bf13e0c2", "patch": "@@ -220,17 +220,20 @@ impl LintStore {\n                         })\n                         .lint_ids\n                         .push(id);\n+                } else {\n+                    // Lints belonging to the `future_incompatible` lint group are lints where a\n+                    // future version of rustc will cause existing code to stop compiling.\n+                    // Lints tied to an edition don't count because they are opt-in.\n+                    self.lint_groups\n+                        .entry(\"future_incompatible\")\n+                        .or_insert(LintGroup {\n+                            lint_ids: vec![],\n+                            from_plugin: lint.is_plugin,\n+                            depr: None,\n+                        })\n+                        .lint_ids\n+                        .push(id);\n                 }\n-\n-                self.lint_groups\n-                    .entry(\"future_incompatible\")\n-                    .or_insert(LintGroup {\n-                        lint_ids: vec![],\n-                        from_plugin: lint.is_plugin,\n-                        depr: None,\n-                    })\n-                    .lint_ids\n-                    .push(id);\n             }\n         }\n     }"}, {"sha": "bbd0e33d7193e9081fd0df6b99515a86f47b6e22", "filename": "src/test/ui/future-incompatible-lint-group.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2/src%2Ftest%2Fui%2Ffuture-incompatible-lint-group.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2/src%2Ftest%2Fui%2Ffuture-incompatible-lint-group.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffuture-incompatible-lint-group.rs?ref=51fd129ac12d5bfeca7d216c47b0e337bf13e0c2", "patch": "@@ -1,8 +1,18 @@\n+// Ensure that the future_incompatible lint group only includes\n+// lints for changes that are not tied to an edition\n #![deny(future_incompatible)]\n \n trait Tr {\n-    fn f(u8) {} //~ ERROR anonymous parameters are deprecated\n-                //~^ WARN this is accepted in the current edition\n+    // Warn only since this is not a `future_incompatible` lint\n+    fn f(u8) {} //~ WARN anonymous parameters are deprecated\n+                //~| WARN this is accepted in the current edition\n+}\n+\n+pub mod submodule {\n+    // Error since this is a `future_incompatible` lint\n+    #![doc(test(some_test))]\n+        //~^ ERROR this attribute can only be applied at the crate level\n+        //~| WARN this was previously accepted by the compiler\n }\n \n fn main() {}"}, {"sha": "cb9be88c9ee44f43a14e63f267f545fbf9588f95", "filename": "src/test/ui/future-incompatible-lint-group.stderr", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2/src%2Ftest%2Fui%2Ffuture-incompatible-lint-group.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/51fd129ac12d5bfeca7d216c47b0e337bf13e0c2/src%2Ftest%2Fui%2Ffuture-incompatible-lint-group.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffuture-incompatible-lint-group.stderr?ref=51fd129ac12d5bfeca7d216c47b0e337bf13e0c2", "patch": "@@ -1,17 +1,28 @@\n-error: anonymous parameters are deprecated and will be removed in the next edition.\n-  --> $DIR/future-incompatible-lint-group.rs:4:10\n+warning: anonymous parameters are deprecated and will be removed in the next edition.\n+  --> $DIR/future-incompatible-lint-group.rs:7:10\n    |\n LL |     fn f(u8) {}\n    |          ^^ help: try naming the parameter or explicitly ignoring it: `_: u8`\n    |\n+   = note: `#[warn(anonymous_parameters)]` on by default\n+   = warning: this is accepted in the current edition (Rust 2015) but is a hard error in Rust 2018!\n+   = note: for more information, see issue #41686 <https://github.com/rust-lang/rust/issues/41686>\n+\n+error: this attribute can only be applied at the crate level\n+  --> $DIR/future-incompatible-lint-group.rs:13:12\n+   |\n+LL |     #![doc(test(some_test))]\n+   |            ^^^^^^^^^^^^^^^\n+   |\n note: the lint level is defined here\n-  --> $DIR/future-incompatible-lint-group.rs:1:9\n+  --> $DIR/future-incompatible-lint-group.rs:3:9\n    |\n LL | #![deny(future_incompatible)]\n    |         ^^^^^^^^^^^^^^^^^^^\n-   = note: `#[deny(anonymous_parameters)]` implied by `#[deny(future_incompatible)]`\n-   = warning: this is accepted in the current edition (Rust 2015) but is a hard error in Rust 2018!\n-   = note: for more information, see issue #41686 <https://github.com/rust-lang/rust/issues/41686>\n+   = note: `#[deny(invalid_doc_attributes)]` implied by `#[deny(future_incompatible)]`\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n+   = note: read https://doc.rust-lang.org/nightly/rustdoc/the-doc-attribute.html#at-the-crate-level for more information\n \n-error: aborting due to previous error\n+error: aborting due to previous error; 1 warning emitted\n "}]}