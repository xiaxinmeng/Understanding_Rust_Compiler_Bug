{"sha": "eec86ba3bdec9599b451593c4d16ca5581d190c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlYzg2YmEzYmRlYzk1OTliNDUxNTkzYzRkMTZjYTU1ODFkMTkwYzk=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-04-10T23:52:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-10T23:52:26Z"}, "message": "Rollup merge of #70957 - oli-obk:lazy_repeat_length_eval_ice, r=matthewjasper\n\nNormalize MIR locals' types for generator layout computation.\n\nfixes #70905", "tree": {"sha": "ea5a61584f2a85fccae49226e1608d68bc9b7b06", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea5a61584f2a85fccae49226e1608d68bc9b7b06"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eec86ba3bdec9599b451593c4d16ca5581d190c9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJekQa6CRBK7hj4Ov3rIwAAdHIIADXWeKxSBPiEdSmVmp8QQ/4z\nIs7Nm8k0jDkqM4apf5Z6oq1Z4ofL+P63x1rUbkDY+HXbAJTV+niuEQqeEg+9VOCM\nxcN9aZ/F9zvUVXWhIMedjuaT64UUQnOoTXoOQObdI3OMGmlhXFiJstF3mSaPnRY9\nwNjQfjiuBCE4qLqv6yyKLgQrv8/mE2cOwUoitsZG31BIY4KivVE4DVRxagdR0Ute\nCDkh6OazCYnkFEGSaz675Bbl537klgmO7ijdIE4P6mtDcqDZZeyDG/naF5yYdkf7\nTVeyO83HhOV0voDiNG/DpLLKa4Q7Of8EGJ56VAKYWxvD0Nbrt6b3jtZGYvJMl5U=\n=o3Mz\n-----END PGP SIGNATURE-----\n", "payload": "tree ea5a61584f2a85fccae49226e1608d68bc9b7b06\nparent 4dfa73a0d8eec6732b70ced27062913bf5160a48\nparent 8a03147f224369f96c2a826bc2dcbde3a6be1f10\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1586562746 +0200\ncommitter GitHub <noreply@github.com> 1586562746 +0200\n\nRollup merge of #70957 - oli-obk:lazy_repeat_length_eval_ice, r=matthewjasper\n\nNormalize MIR locals' types for generator layout computation.\n\nfixes #70905\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eec86ba3bdec9599b451593c4d16ca5581d190c9", "html_url": "https://github.com/rust-lang/rust/commit/eec86ba3bdec9599b451593c4d16ca5581d190c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eec86ba3bdec9599b451593c4d16ca5581d190c9/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4dfa73a0d8eec6732b70ced27062913bf5160a48", "url": "https://api.github.com/repos/rust-lang/rust/commits/4dfa73a0d8eec6732b70ced27062913bf5160a48", "html_url": "https://github.com/rust-lang/rust/commit/4dfa73a0d8eec6732b70ced27062913bf5160a48"}, {"sha": "8a03147f224369f96c2a826bc2dcbde3a6be1f10", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a03147f224369f96c2a826bc2dcbde3a6be1f10", "html_url": "https://github.com/rust-lang/rust/commit/8a03147f224369f96c2a826bc2dcbde3a6be1f10"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "033ba17f658552b0b06404702acea134a0a24b4d", "filename": "src/librustc_mir/transform/generator.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eec86ba3bdec9599b451593c4d16ca5581d190c9/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eec86ba3bdec9599b451593c4d16ca5581d190c9/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs?ref=eec86ba3bdec9599b451593c4d16ca5581d190c9", "patch": "@@ -721,15 +721,18 @@ fn compute_layout<'tcx>(\n         _ => bug!(),\n     };\n \n+    let param_env = tcx.param_env(source.def_id());\n+\n     for (local, decl) in body.local_decls.iter_enumerated() {\n         // Ignore locals which are internal or not live\n         if !live_locals.contains(local) || decl.internal {\n             continue;\n         }\n+        let decl_ty = tcx.normalize_erasing_regions(param_env, decl.ty);\n \n         // Sanity check that typeck knows about the type of locals which are\n         // live across a suspension point\n-        if !allowed.contains(&decl.ty) && !allowed_upvars.contains(&decl.ty) {\n+        if !allowed.contains(&decl_ty) && !allowed_upvars.contains(&decl_ty) {\n             span_bug!(\n                 body.span,\n                 \"Broken MIR: generator contains type {} in MIR, \\"}, {"sha": "ebabc3fbf10f9185a3ee9287afeaef3e7c145dbe", "filename": "src/test/ui/repeat_count_const_in_async_fn.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/eec86ba3bdec9599b451593c4d16ca5581d190c9/src%2Ftest%2Fui%2Frepeat_count_const_in_async_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eec86ba3bdec9599b451593c4d16ca5581d190c9/src%2Ftest%2Fui%2Frepeat_count_const_in_async_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepeat_count_const_in_async_fn.rs?ref=eec86ba3bdec9599b451593c4d16ca5581d190c9", "patch": "@@ -0,0 +1,10 @@\n+// check-pass\n+// edition:2018\n+// compile-flags: --crate-type=lib\n+\n+pub async fn test() {\n+    const C: usize = 4;\n+    foo(&mut [0u8; C]).await;\n+}\n+\n+async fn foo(_: &mut [u8]) {}"}]}