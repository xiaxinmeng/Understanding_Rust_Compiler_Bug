{"sha": "6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiZTI1YzhhMGNmZTI4ZjAzMmNlMmI2NWY4Y2IwN2RkMWExYWUxNDg=", "commit": {"author": {"name": "Kevin Cantu", "email": "me@kevincantu.org", "date": "2012-02-04T22:56:42Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-05T22:56:16Z"}, "message": "Adding str::reserve", "tree": {"sha": "28f3f534b113b48a6d2e270db4182cbe426edba1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/28f3f534b113b48a6d2e270db4182cbe426edba1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148", "html_url": "https://github.com/rust-lang/rust/commit/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148/comments", "author": {"login": "killerswan", "id": 195060, "node_id": "MDQ6VXNlcjE5NTA2MA==", "avatar_url": "https://avatars.githubusercontent.com/u/195060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killerswan", "html_url": "https://github.com/killerswan", "followers_url": "https://api.github.com/users/killerswan/followers", "following_url": "https://api.github.com/users/killerswan/following{/other_user}", "gists_url": "https://api.github.com/users/killerswan/gists{/gist_id}", "starred_url": "https://api.github.com/users/killerswan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killerswan/subscriptions", "organizations_url": "https://api.github.com/users/killerswan/orgs", "repos_url": "https://api.github.com/users/killerswan/repos", "events_url": "https://api.github.com/users/killerswan/events{/privacy}", "received_events_url": "https://api.github.com/users/killerswan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3dfe8758d674d41c3aae116385bcc2b992413ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3dfe8758d674d41c3aae116385bcc2b992413ed", "html_url": "https://github.com/rust-lang/rust/commit/d3dfe8758d674d41c3aae116385bcc2b992413ed"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "618fa04a314319003105180f72e200b097778970", "filename": "src/libcore/str.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148/src%2Flibcore%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148/src%2Flibcore%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fstr.rs?ref=6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148", "patch": "@@ -97,6 +97,7 @@ export\n    as_buf,\n    //buf,\n    sbuf,\n+   reserve,\n \n    unsafe;\n \n@@ -105,6 +106,7 @@ export\n #[abi = \"cdecl\"]\n native mod rustrt {\n     fn rust_str_push(&s: str, ch: u8);\n+    fn str_reserve_shared(&ss: str, nn: ctypes::size_t);\n }\n \n // FIXME: add pure to a lot of functions\n@@ -755,6 +757,7 @@ Apply a function to each character\n */\n fn map(ss: str, ff: fn(char) -> char) -> str {\n     let result = \"\";\n+    reserve(result, byte_len(ss));\n \n     chars_iter(ss, {|cc|\n         str::push_char(result, ff(cc));\n@@ -1302,6 +1305,13 @@ An unsafe buffer of bytes. Corresponds to a C char pointer.\n */\n type sbuf = *u8;\n \n+// Function: reserve\n+//\n+// Allocate more memory for a string, up to `nn` + 1 bytes\n+fn reserve(&ss: str, nn: uint) {\n+    rustrt::str_reserve_shared(ss, nn);\n+}\n+\n // Module: unsafe\n //\n // These functions may create invalid UTF-8 strings and eat your baby."}, {"sha": "783ca43d8622549146cd47085d59f8f43f2c831a", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148", "patch": "@@ -105,6 +105,13 @@ vec_reserve_shared(type_desc* ty, rust_vec** vp,\n     reserve_vec_exact(task, vp, n_elts * ty->size);\n }\n \n+extern \"C\" CDECL void\n+str_reserve_shared(rust_vec** sp,\n+                   size_t n_elts) {\n+    rust_task *task = rust_task_thread::get_task();\n+    reserve_vec_exact(task, sp, n_elts + 1);\n+}\n+\n /**\n  * Copies elements in an unsafe buffer to the given interior vector. The\n  * vector must have size zero."}, {"sha": "48736ef029b2376662d74ede5299c43ba9bb18a6", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=6be25c8a0cfe28f032ce2b65f8cb07dd1a1ae148", "patch": "@@ -50,6 +50,7 @@ shape_log_str\n squareroot\n start_task\n vec_reserve_shared\n+str_reserve_shared\n vec_from_buf_shared\n unsupervise\n upcall_cmp_type"}]}