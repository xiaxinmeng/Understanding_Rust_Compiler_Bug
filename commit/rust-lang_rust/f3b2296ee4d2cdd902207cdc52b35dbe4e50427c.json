{"sha": "f3b2296ee4d2cdd902207cdc52b35dbe4e50427c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzYjIyOTZlZTRkMmNkZDkwMjIwN2NkYzUyYjM1ZGJlNGU1MDQyN2M=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-08-07T02:16:44Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-08-07T02:17:44Z"}, "message": "Auto-deref the base expr in trans_method_callee\n\n(specifically in the method_trait case) -- if you wrote x.f()\nand x has type @T for a trait T, x wasn't getting auto-deref'ed.\n\nThis was bad.\n\nCloses #2935", "tree": {"sha": "1acf2f3bfada3b5f51ac0e6258eaf2e91a642fc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1acf2f3bfada3b5f51ac0e6258eaf2e91a642fc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c", "html_url": "https://github.com/rust-lang/rust/commit/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aacd18f4ed860420cb89cd103a9832ef47e838f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/aacd18f4ed860420cb89cd103a9832ef47e838f3", "html_url": "https://github.com/rust-lang/rust/commit/aacd18f4ed860420cb89cd103a9832ef47e838f3"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "066c1bedba2769169a53df13969ab5aeeb0b859d", "filename": "src/rustc/middle/trans/impl.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c/src%2Frustc%2Fmiddle%2Ftrans%2Fimpl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c/src%2Frustc%2Fmiddle%2Ftrans%2Fimpl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fimpl.rs?ref=f3b2296ee4d2cdd902207cdc52b35dbe4e50427c", "patch": "@@ -14,6 +14,9 @@ import lib::llvm::llvm;\n import lib::llvm::{ValueRef, TypeRef};\n import lib::llvm::llvm::LLVMGetParam;\n import std::map::hashmap;\n+import util::ppaux::{ty_to_str, tys_to_str};\n+\n+import syntax::print::pprust::expr_to_str;\n \n fn trans_impl(ccx: @crate_ctxt, path: path, name: ast::ident,\n               methods: ~[@ast::method], tps: ~[ast::ty_param]) {\n@@ -70,6 +73,9 @@ fn trans_method_callee(bcx: block, callee_id: ast::node_id,\n       typeck::method_trait(_, off) => {\n         let {bcx, val} = trans_temp_expr(bcx, self);\n         let fty = node_id_type(bcx, callee_id);\n+        let self_ty = node_id_type(bcx, self.id);\n+        let {bcx, val, _} = autoderef(bcx, self.id, val, self_ty,\n+                                      uint::max_value);\n         trans_trait_callee(bcx, val, fty, off)\n       }\n     }"}, {"sha": "36ad03a0df3f5b4f01fbd0bcadd401267357047b", "filename": "src/test/run-pass/issue-2935.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c/src%2Ftest%2Frun-pass%2Fissue-2935.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3b2296ee4d2cdd902207cdc52b35dbe4e50427c/src%2Ftest%2Frun-pass%2Fissue-2935.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-2935.rs?ref=f3b2296ee4d2cdd902207cdc52b35dbe4e50427c", "patch": "@@ -0,0 +1,24 @@\n+//type t = { a: int };\n+// type t = { a: bool };\n+type t = bool;\n+\n+trait it {\n+    fn f();\n+}\n+\n+impl  of it for t {\n+    fn f() { }\n+}\n+\n+fn main() {\n+  //    let x = ({a: 4i} as it);\n+  //   let y = @({a: 4i});\n+  //    let z = @({a: 4i} as it);\n+  //    let z = @({a: true} as it);\n+    let z = @(true as it);\n+    //  x.f();\n+    // y.f();\n+    // (*z).f();\n+    #error[\"ok so far...\"];\n+    z.f(); //segfault\n+}"}]}