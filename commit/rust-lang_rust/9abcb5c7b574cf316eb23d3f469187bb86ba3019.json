{"sha": "9abcb5c7b574cf316eb23d3f469187bb86ba3019", "node_id": "C_kwDOAAsO6NoAKDlhYmNiNWM3YjU3NGNmMzE2ZWIyM2QzZjQ2OTE4N2JiODZiYTMwMTk", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-06-02T09:55:54Z"}, "committer": {"name": "Oli Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2022-06-02T10:06:34Z"}, "message": "Make the crate work both in rustc and locally", "tree": {"sha": "8156ef820b283c9bcc567a37cce77e4db2a66f36", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8156ef820b283c9bcc567a37cce77e4db2a66f36"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9abcb5c7b574cf316eb23d3f469187bb86ba3019", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9abcb5c7b574cf316eb23d3f469187bb86ba3019", "html_url": "https://github.com/rust-lang/rust/commit/9abcb5c7b574cf316eb23d3f469187bb86ba3019", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9abcb5c7b574cf316eb23d3f469187bb86ba3019/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "615f8c5dbbd59b9ec734efaeb36b0e619c9e3e38", "url": "https://api.github.com/repos/rust-lang/rust/commits/615f8c5dbbd59b9ec734efaeb36b0e619c9e3e38", "html_url": "https://github.com/rust-lang/rust/commit/615f8c5dbbd59b9ec734efaeb36b0e619c9e3e38"}], "stats": {"total": 59, "additions": 45, "deletions": 14}, "files": [{"sha": "eb5a316cbd195d26e3f768c7dd8e1b47299e17f8", "filename": ".gitignore", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9abcb5c7b574cf316eb23d3f469187bb86ba3019/.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/9abcb5c7b574cf316eb23d3f469187bb86ba3019/.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.gitignore?ref=9abcb5c7b574cf316eb23d3f469187bb86ba3019", "patch": "@@ -0,0 +1 @@\n+target"}, {"sha": "bc0cac5a0bcef267027f80f8d18befe0a9818da7", "filename": "Cargo.toml", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9abcb5c7b574cf316eb23d3f469187bb86ba3019/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/9abcb5c7b574cf316eb23d3f469187bb86ba3019/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=9abcb5c7b574cf316eb23d3f469187bb86ba3019", "patch": "@@ -4,7 +4,10 @@ version = \"0.0.0\"\n edition = \"2021\"\n \n [dependencies]\n-rustc_middle = { path = \"../rustc_middle\" }\n-rustc_driver = { path = \"../rustc_driver\" }\n-rustc_borrowck = { path = \"../rustc_borrowck\" }\n-rustc_interface = { path = \"../rustc_interface\" }\n+rustc_middle = { path = \"../rustc_middle\", optional = true }\n+rustc_driver = { path = \"../rustc_driver\", optional = true }\n+rustc_borrowck = { path = \"../rustc_borrowck\", optional = true }\n+rustc_interface = { path = \"../rustc_interface\", optional = true }\n+\n+[features]\n+default = [\"rustc_middle\", \"rustc_driver\", \"rustc_borrowck\", \"rustc_interface\"]"}, {"sha": "ae49098dd0ce65095f859f79eb069c4e0b39befa", "filename": "README.md", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9abcb5c7b574cf316eb23d3f469187bb86ba3019/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/9abcb5c7b574cf316eb23d3f469187bb86ba3019/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=9abcb5c7b574cf316eb23d3f469187bb86ba3019", "patch": "@@ -7,6 +7,18 @@ sync is pushed entirely onto us, without affecting rustc workflows negatively.\n This may change in the future, but changes to policy should only be done via a\n compiler team MCP.\n \n+## Instructions for working on this crate locally\n+\n+Since the crate is the same in the rustc repo and here, the dependencies on rustc_* crates\n+will only either work here or there, but never in both places at the same time. Thus we use\n+optional dependencies on the rustc_* crates, requiring local development to use\n+\n+```\n+cargo build --no-default-features -Zavoid-dev-deps\n+```\n+\n+in order to compile successfully.\n+\n ## Instructions for syncing\n \n ### Updating this repository"}, {"sha": "decdae953d95bec992a4b0520271e4451ff9d790", "filename": "src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9abcb5c7b574cf316eb23d3f469187bb86ba3019/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9abcb5c7b574cf316eb23d3f469187bb86ba3019/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=9abcb5c7b574cf316eb23d3f469187bb86ba3019", "patch": "@@ -11,6 +11,8 @@\n     test(attr(allow(unused_variables), deny(warnings)))\n )]\n \n+#![cfg_attr(not(feature = \"default\"), feature(rustc_private))]\n+\n pub mod mir;\n \n pub mod very_unstable;"}, {"sha": "855605b1a4f9d449a761c55a531080fb8807b2f0", "filename": "src/mir.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9abcb5c7b574cf316eb23d3f469187bb86ba3019/src%2Fmir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9abcb5c7b574cf316eb23d3f469187bb86ba3019/src%2Fmir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmir.rs?ref=9abcb5c7b574cf316eb23d3f469187bb86ba3019", "patch": "@@ -1,4 +1,4 @@\n-pub use rustc_middle::mir::{\n+pub use crate::very_unstable::middle::mir::{\n     visit::MutVisitor, AggregateKind, AssertKind, BasicBlock, BasicBlockData, BinOp, BindingForm,\n     BlockTailInfo, Body, BorrowKind, CastKind, ClearCrossCrate, Constant, ConstantKind,\n     CopyNonOverlapping, Coverage, FakeReadCause, Field, GeneratorInfo, ImplicitSelfKind,"}, {"sha": "12ba133dbb169403305825f59f39eba7cff394a6", "filename": "src/very_unstable.rs", "status": "modified", "additions": 22, "deletions": 9, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/9abcb5c7b574cf316eb23d3f469187bb86ba3019/src%2Fvery_unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9abcb5c7b574cf316eb23d3f469187bb86ba3019/src%2Fvery_unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvery_unstable.rs?ref=9abcb5c7b574cf316eb23d3f469187bb86ba3019", "patch": "@@ -3,12 +3,25 @@\n //! Only use rustc_smir in your dependencies and use the reexports here instead of\n //! directly referring to the unstable crates.\n \n-pub use rustc_borrowck as borrowck;\n-pub use rustc_driver as driver;\n-pub use rustc_hir as hir;\n-pub use rustc_interface as interface;\n-pub use rustc_middle as middle;\n-pub use rustc_mir_dataflow as dataflow;\n-pub use rustc_mir_transform as transform;\n-pub use rustc_serialize as serialize;\n-pub use rustc_trait_selection as trait_selection;\n+macro_rules! crates {\n+    ($($rustc_name:ident -> $name:ident,)*) => {\n+        $(\n+            #[cfg(not(feature = \"default\"))]\n+            pub extern crate $rustc_name as $name;\n+            #[cfg(feature = \"default\")]\n+            pub use $rustc_name as $name;\n+        )*\n+    }\n+}\n+\n+crates! {\n+    rustc_borrowck -> borrowck,\n+    rustc_driver -> driver,\n+    rustc_hir -> hir,\n+    rustc_interface -> interface,\n+    rustc_middle -> middle,\n+    rustc_mir_dataflow -> dataflow,\n+    rustc_mir_transform -> transform,\n+    rustc_serialize -> serialize,\n+    rustc_trait_selection -> trait_selection,\n+}"}]}