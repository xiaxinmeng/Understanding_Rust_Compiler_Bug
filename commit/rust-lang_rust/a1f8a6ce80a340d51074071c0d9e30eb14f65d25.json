{"sha": "a1f8a6ce80a340d51074071c0d9e30eb14f65d25", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExZjhhNmNlODBhMzQwZDUxMDc0MDcxYzBkOWUzMGViMTRmNjVkMjU=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-06-28T08:45:57Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-06-28T08:46:04Z"}, "message": "Fix FileMap::line_begin_pos().\n\nThe method relied on the FileMap still being under construction in\norder for it to do what the name promises. It's now independent of\nthe current state.", "tree": {"sha": "c029a685cd4b14a2deb5f8b215d09467d2950a6c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c029a685cd4b14a2deb5f8b215d09467d2950a6c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a1f8a6ce80a340d51074071c0d9e30eb14f65d25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a1f8a6ce80a340d51074071c0d9e30eb14f65d25", "html_url": "https://github.com/rust-lang/rust/commit/a1f8a6ce80a340d51074071c0d9e30eb14f65d25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a1f8a6ce80a340d51074071c0d9e30eb14f65d25/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba30c1dac9d0af45836403b2da89561a627b9a6e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba30c1dac9d0af45836403b2da89561a627b9a6e", "html_url": "https://github.com/rust-lang/rust/commit/ba30c1dac9d0af45836403b2da89561a627b9a6e"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "3995a9b8689e77e7a4b2f139ee019cef55ccc8f7", "filename": "src/libsyntax/parse/lexer/comments.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a1f8a6ce80a340d51074071c0d9e30eb14f65d25/src%2Flibsyntax%2Fparse%2Flexer%2Fcomments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1f8a6ce80a340d51074071c0d9e30eb14f65d25/src%2Flibsyntax%2Fparse%2Flexer%2Fcomments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer%2Fcomments.rs?ref=a1f8a6ce80a340d51074071c0d9e30eb14f65d25", "patch": "@@ -240,9 +240,11 @@ fn read_block_comment(rdr: &mut StringReader,\n     let mut lines: Vec<String> = Vec::new();\n \n     // Count the number of chars since the start of the line by rescanning.\n-    let mut src_index = rdr.src_index(rdr.filemap.line_begin_pos());\n+    let mut src_index = rdr.src_index(rdr.filemap.line_begin_pos(rdr.pos));\n     let end_src_index = rdr.src_index(rdr.pos);\n-    assert!(src_index <= end_src_index);\n+    assert!(src_index <= end_src_index,\n+        \"src_index={}, end_src_index={}, line_begin_pos={}\",\n+        src_index, end_src_index, rdr.filemap.line_begin_pos(rdr.pos).to_u32());\n     let mut n = 0;\n     while src_index < end_src_index {\n         let c = char_at(&rdr.src, src_index);"}, {"sha": "55dec31511c37f506825d111b00dffe50e051c62", "filename": "src/libsyntax_pos/lib.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a1f8a6ce80a340d51074071c0d9e30eb14f65d25/src%2Flibsyntax_pos%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1f8a6ce80a340d51074071c0d9e30eb14f65d25/src%2Flibsyntax_pos%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Flib.rs?ref=a1f8a6ce80a340d51074071c0d9e30eb14f65d25", "patch": "@@ -976,11 +976,9 @@ impl FileMap {\n     }\n \n     /// Return the BytePos of the beginning of the current line.\n-    pub fn line_begin_pos(&self) -> BytePos {\n-        match self.lines.last() {\n-            Some(&line_pos) => line_pos,\n-            None => self.start_pos,\n-        }\n+    pub fn line_begin_pos(&self, pos: BytePos) -> BytePos {\n+        let line_index = self.lookup_line(pos).unwrap();\n+        self.lines[line_index]\n     }\n \n     /// Add externally loaded source."}]}