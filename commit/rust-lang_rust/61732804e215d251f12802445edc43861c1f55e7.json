{"sha": "61732804e215d251f12802445edc43861c1f55e7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxNzMyODA0ZTIxNWQyNTFmMTI4MDI0NDVlZGM0Mzg2MWMxZjU1ZTc=", "commit": {"author": {"name": "roblabla", "email": "unfiltered@roblab.la", "date": "2019-10-25T14:44:21Z"}, "committer": {"name": "roblabla", "email": "unfiltered@roblab.la", "date": "2019-10-25T16:04:20Z"}, "message": "Fix EFIABI test\n\nUse revisions to run the EFIABI in multiple configurations, compiling\nfor each supported UEFI platform, and checking the ABI generated in the\nLLVM IR is correct.\n\nUse no_core to make it easier to test.", "tree": {"sha": "082261c8a05db68e2250c07b44d1a3688a3df2aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/082261c8a05db68e2250c07b44d1a3688a3df2aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61732804e215d251f12802445edc43861c1f55e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61732804e215d251f12802445edc43861c1f55e7", "html_url": "https://github.com/rust-lang/rust/commit/61732804e215d251f12802445edc43861c1f55e7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61732804e215d251f12802445edc43861c1f55e7/comments", "author": {"login": "roblabla", "id": 1069318, "node_id": "MDQ6VXNlcjEwNjkzMTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=4", "gravatar_id": "", "url": "https://api.github.com/users/roblabla", "html_url": "https://github.com/roblabla", "followers_url": "https://api.github.com/users/roblabla/followers", "following_url": "https://api.github.com/users/roblabla/following{/other_user}", "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}", "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions", "organizations_url": "https://api.github.com/users/roblabla/orgs", "repos_url": "https://api.github.com/users/roblabla/repos", "events_url": "https://api.github.com/users/roblabla/events{/privacy}", "received_events_url": "https://api.github.com/users/roblabla/received_events", "type": "User", "site_admin": false}, "committer": {"login": "roblabla", "id": 1069318, "node_id": "MDQ6VXNlcjEwNjkzMTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=4", "gravatar_id": "", "url": "https://api.github.com/users/roblabla", "html_url": "https://github.com/roblabla", "followers_url": "https://api.github.com/users/roblabla/followers", "following_url": "https://api.github.com/users/roblabla/following{/other_user}", "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}", "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions", "organizations_url": "https://api.github.com/users/roblabla/orgs", "repos_url": "https://api.github.com/users/roblabla/repos", "events_url": "https://api.github.com/users/roblabla/events{/privacy}", "received_events_url": "https://api.github.com/users/roblabla/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "093ec70b1e4da3d814a137f5aea6f4ff75ad3399", "url": "https://api.github.com/repos/rust-lang/rust/commits/093ec70b1e4da3d814a137f5aea6f4ff75ad3399", "html_url": "https://github.com/rust-lang/rust/commit/093ec70b1e4da3d814a137f5aea6f4ff75ad3399"}], "stats": {"total": 33, "additions": 21, "deletions": 12}, "files": [{"sha": "cfd31ef1a31fdab6b2f8e249362927270386f13a", "filename": "src/test/codegen/abi-efiapi.rs", "status": "modified", "additions": 21, "deletions": 12, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/61732804e215d251f12802445edc43861c1f55e7/src%2Ftest%2Fcodegen%2Fabi-efiapi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61732804e215d251f12802445edc43861c1f55e7/src%2Ftest%2Fcodegen%2Fabi-efiapi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fabi-efiapi.rs?ref=61732804e215d251f12802445edc43861c1f55e7", "patch": "@@ -1,20 +1,29 @@\n // Checks if the correct annotation for the efiapi ABI is passed to llvm.\n \n+// revisions:x86_64 i686 aarch64 arm riscv\n+\n+//[x86_64] compile-flags: --target x86_64-unknown-uefi\n+//[i686] compile-flags: --target i686-unknown-linux-musl\n+//[aarch64] compile-flags: --target aarch64-unknown-none\n+//[arm] compile-flags: --target armv7r-none-eabi\n+//[riscv] compile-flags: --target riscv64gc-unknown-none-elf\n // compile-flags: -C no-prepopulate-passes\n \n #![crate_type = \"lib\"]\n-#![feature(abi_efiapi)]\n+#![feature(no_core, lang_items, abi_efiapi)]\n+#![no_core]\n \n-// CHECK: define win64 i64 @has_efiapi\n-#[no_mangle]\n-#[cfg(target_arch = \"x86_64\")]\n-pub extern \"efiapi\" fn has_efiapi(a: i64) -> i64 {\n-    a * 2\n-}\n+#[lang=\"sized\"]\n+trait Sized { }\n+#[lang=\"freeze\"]\n+trait Freeze { }\n+#[lang=\"copy\"]\n+trait Copy { }\n \n-// CHECK: define c i64 @has_efiapi\n+//x86_64: define win64cc void @has_efiapi\n+//i686: define void @has_efiapi\n+//aarch64: define void @has_efiapi\n+//arm: define void @has_efiapi\n+//riscv: define void @has_efiapi\n #[no_mangle]\n-#[cfg(not(target_arch = \"x86_64\"))]\n-pub extern \"efiapi\" fn has_efiapi(a: i64) -> i64 {\n-    a * 2\n-}\n+pub extern \"efiapi\" fn has_efiapi() {}"}]}