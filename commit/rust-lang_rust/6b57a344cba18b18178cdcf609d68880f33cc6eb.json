{"sha": "6b57a344cba18b18178cdcf609d68880f33cc6eb", "node_id": "C_kwDOAAsO6NoAKDZiNTdhMzQ0Y2JhMThiMTgxNzhjZGNmNjA5ZDY4ODgwZjMzY2M2ZWI", "commit": {"author": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2023-04-04T20:42:38Z"}, "committer": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2023-04-04T20:42:38Z"}, "message": "Make rust-docs optional for the Windows MSI installer.", "tree": {"sha": "bc917fdf63ae63bc77621f83cfb9f8ca9bde5e6d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc917fdf63ae63bc77621f83cfb9f8ca9bde5e6d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b57a344cba18b18178cdcf609d68880f33cc6eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b57a344cba18b18178cdcf609d68880f33cc6eb", "html_url": "https://github.com/rust-lang/rust/commit/6b57a344cba18b18178cdcf609d68880f33cc6eb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b57a344cba18b18178cdcf609d68880f33cc6eb/comments", "author": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b9aa5fa2cb4daf8414b9b8091dc651a8e17f9e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b9aa5fa2cb4daf8414b9b8091dc651a8e17f9e7", "html_url": "https://github.com/rust-lang/rust/commit/7b9aa5fa2cb4daf8414b9b8091dc651a8e17f9e7"}], "stats": {"total": 57, "additions": 35, "deletions": 22}, "files": [{"sha": "8ce220c86478145cb229e71da91702d77d68556d", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 29, "deletions": 22, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/6b57a344cba18b18178cdcf609d68880f33cc6eb/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b57a344cba18b18178cdcf609d68880f33cc6eb/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=6b57a344cba18b18178cdcf609d68880f33cc6eb", "patch": "@@ -1585,11 +1585,10 @@ impl Step for Extended {\n             prepare(\"rustc\");\n             prepare(\"cargo\");\n             prepare(\"rust-analysis\");\n-            prepare(\"rust-docs\");\n             prepare(\"rust-std\");\n             prepare(\"clippy\");\n             prepare(\"rust-analyzer\");\n-            for tool in &[\"rust-demangler\", \"miri\"] {\n+            for tool in &[\"rust-docs\", \"rust-demangler\", \"miri\"] {\n                 if built_tools.contains(tool) {\n                     prepare(tool);\n                 }\n@@ -1624,23 +1623,25 @@ impl Step for Extended {\n                     .arg(\"-out\")\n                     .arg(exe.join(\"RustcGroup.wxs\")),\n             );\n-            builder.run(\n-                Command::new(&heat)\n-                    .current_dir(&exe)\n-                    .arg(\"dir\")\n-                    .arg(\"rust-docs\")\n-                    .args(&heat_flags)\n-                    .arg(\"-cg\")\n-                    .arg(\"DocsGroup\")\n-                    .arg(\"-dr\")\n-                    .arg(\"Docs\")\n-                    .arg(\"-var\")\n-                    .arg(\"var.DocsDir\")\n-                    .arg(\"-out\")\n-                    .arg(exe.join(\"DocsGroup.wxs\"))\n-                    .arg(\"-t\")\n-                    .arg(etc.join(\"msi/squash-components.xsl\")),\n-            );\n+            if built_tools.contains(\"rust-docs\") {\n+                builder.run(\n+                    Command::new(&heat)\n+                        .current_dir(&exe)\n+                        .arg(\"dir\")\n+                        .arg(\"rust-docs\")\n+                        .args(&heat_flags)\n+                        .arg(\"-cg\")\n+                        .arg(\"DocsGroup\")\n+                        .arg(\"-dr\")\n+                        .arg(\"Docs\")\n+                        .arg(\"-var\")\n+                        .arg(\"var.DocsDir\")\n+                        .arg(\"-out\")\n+                        .arg(exe.join(\"DocsGroup.wxs\"))\n+                        .arg(\"-t\")\n+                        .arg(etc.join(\"msi/squash-components.xsl\")),\n+                );\n+            }\n             builder.run(\n                 Command::new(&heat)\n                     .current_dir(&exe)\n@@ -1787,7 +1788,6 @@ impl Step for Extended {\n                 cmd.current_dir(&exe)\n                     .arg(\"-nologo\")\n                     .arg(\"-dRustcDir=rustc\")\n-                    .arg(\"-dDocsDir=rust-docs\")\n                     .arg(\"-dCargoDir=cargo\")\n                     .arg(\"-dStdDir=rust-std\")\n                     .arg(\"-dAnalysisDir=rust-analysis\")\n@@ -1799,6 +1799,9 @@ impl Step for Extended {\n                     .arg(&input);\n                 add_env(builder, &mut cmd, target);\n \n+                if built_tools.contains(\"rust-docs\") {\n+                    cmd.arg(\"-dDocsDir=rust-docs\");\n+                }\n                 if built_tools.contains(\"rust-demangler\") {\n                     cmd.arg(\"-dRustDemanglerDir=rust-demangler\");\n                 }\n@@ -1817,7 +1820,9 @@ impl Step for Extended {\n             candle(&etc.join(\"msi/ui.wxs\"));\n             candle(&etc.join(\"msi/rustwelcomedlg.wxs\"));\n             candle(\"RustcGroup.wxs\".as_ref());\n-            candle(\"DocsGroup.wxs\".as_ref());\n+            if built_tools.contains(\"rust-docs\") {\n+                candle(\"DocsGroup.wxs\".as_ref());\n+            }\n             candle(\"CargoGroup.wxs\".as_ref());\n             candle(\"StdGroup.wxs\".as_ref());\n             candle(\"ClippyGroup.wxs\".as_ref());\n@@ -1854,7 +1859,6 @@ impl Step for Extended {\n                 .arg(\"ui.wixobj\")\n                 .arg(\"rustwelcomedlg.wixobj\")\n                 .arg(\"RustcGroup.wixobj\")\n-                .arg(\"DocsGroup.wixobj\")\n                 .arg(\"CargoGroup.wixobj\")\n                 .arg(\"StdGroup.wixobj\")\n                 .arg(\"AnalysisGroup.wixobj\")\n@@ -1870,6 +1874,9 @@ impl Step for Extended {\n             if built_tools.contains(\"rust-demangler\") {\n                 cmd.arg(\"RustDemanglerGroup.wixobj\");\n             }\n+            if built_tools.contains(\"rust-docs\") {\n+                cmd.arg(\"DocsGroup.wixobj\");\n+            }\n \n             if target.ends_with(\"windows-gnu\") {\n                 cmd.arg(\"GccGroup.wixobj\");"}, {"sha": "9f4e4fd0611df6a7569f1ad0b1c9dc93d22a15c5", "filename": "src/etc/installer/msi/rust.wxs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b57a344cba18b18178cdcf609d68880f33cc6eb/src%2Fetc%2Finstaller%2Fmsi%2Frust.wxs", "raw_url": "https://github.com/rust-lang/rust/raw/6b57a344cba18b18178cdcf609d68880f33cc6eb/src%2Fetc%2Finstaller%2Fmsi%2Frust.wxs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Finstaller%2Fmsi%2Frust.wxs?ref=6b57a344cba18b18178cdcf609d68880f33cc6eb", "patch": "@@ -167,7 +167,9 @@\n                     <?if $(env.CFG_MINGW)=\"1\" ?>\n                         <Directory Id=\"Gcc\" Name=\".\" />\n                     <?endif?>\n+                    <!-- tool-rust-docs-start -->\n                     <Directory Id=\"Docs\" Name=\".\" />\n+                    <!-- tool-rust-docs-end -->\n                     <Directory Id=\"Cargo\" Name=\".\" />\n                     <Directory Id=\"Std\" Name=\".\" />\n                 </Directory>\n@@ -209,6 +211,7 @@\n                         <RegistryValue Root=\"HKMU\" Key=\"$(var.BaseRegKey)\" Name=\"RustShell\" Type=\"integer\" Value=\"1\" KeyPath=\"yes\" />\n                         <RemoveFolder Id=\"ApplicationProgramsFolder1\" On=\"uninstall\" />\n                     </Component>\n+                    <!-- tool-rust-docs-start -->\n                     <Component Id=\"DocIndexShortcut\" Guid=\"*\">\n                         <Shortcut Id=\"RustDocs\"\n                                   Name=\"$(var.ProductName) Documentation\"\n@@ -217,6 +220,7 @@\n                         <RegistryValue Root=\"HKMU\" Key=\"$(var.BaseRegKey)\" Name=\"RustDocs\" Type=\"integer\" Value=\"1\" KeyPath=\"yes\" />\n                         <RemoveFolder Id=\"ApplicationProgramsFolder2\" On=\"uninstall\" />\n                     </Component>\n+                    <!-- tool-rust-docs-end -->\n                 </Directory>\n             </Directory>\n \n@@ -256,6 +260,7 @@\n                      <ComponentGroupRef Id=\"GccGroup\" />\n             </Feature>\n         <?endif?>\n+        <!-- tool-rust-docs-start -->\n         <Feature Id=\"Docs\"\n                  Title=\"HTML documentation\"\n                  Display=\"5\"\n@@ -264,6 +269,7 @@\n                  <ComponentGroupRef Id=\"DocsGroup\" />\n                  <ComponentRef Id=\"DocIndexShortcut\" />\n         </Feature>\n+        <!-- tool-rust-docs-end -->\n         <Feature Id=\"Path\"\n                  Title=\"Add to PATH\"\n                  Description=\"Add Rust to PATH environment variable\""}]}