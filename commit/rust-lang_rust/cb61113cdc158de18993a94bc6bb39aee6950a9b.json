{"sha": "cb61113cdc158de18993a94bc6bb39aee6950a9b", "node_id": "C_kwDOAAsO6NoAKGNiNjExMTNjZGMxNThkZTE4OTkzYTk0YmM2YmIzOWFlZTY5NTBhOWI", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-10-21T18:53:27Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-10-21T19:04:13Z"}, "message": "tests", "tree": {"sha": "61bb70502d1581b6ac6c5311b3fe9cdde24242c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/61bb70502d1581b6ac6c5311b3fe9cdde24242c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb61113cdc158de18993a94bc6bb39aee6950a9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb61113cdc158de18993a94bc6bb39aee6950a9b", "html_url": "https://github.com/rust-lang/rust/commit/cb61113cdc158de18993a94bc6bb39aee6950a9b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb61113cdc158de18993a94bc6bb39aee6950a9b/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f6b9dd64465251b4167a442077feb6e5dd9fbda", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f6b9dd64465251b4167a442077feb6e5dd9fbda", "html_url": "https://github.com/rust-lang/rust/commit/9f6b9dd64465251b4167a442077feb6e5dd9fbda"}], "stats": {"total": 159, "additions": 159, "deletions": 0}, "files": [{"sha": "1e9f925f8458db2f59d9d4e31c486857ddb884a1", "filename": "src/test/rustdoc/not-wf-ambiguous-normalization.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Frustdoc%2Fnot-wf-ambiguous-normalization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Frustdoc%2Fnot-wf-ambiguous-normalization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fnot-wf-ambiguous-normalization.rs?ref=cb61113cdc158de18993a94bc6bb39aee6950a9b", "patch": "@@ -0,0 +1,24 @@\n+// compile-flags: -Znormalize-docs\n+\n+#![feature(type_alias_impl_trait)]\n+\n+trait Allocator {\n+    type Buffer;\n+}\n+\n+struct DefaultAllocator;\n+\n+// This unconstrained impl parameter causes the normalization of\n+// `<DefaultAllocator as Allocator>::Buffer` to be ambiguous,\n+// which caused an ICE with `-Znormalize-docs`.\n+impl<T> Allocator for DefaultAllocator {\n+    type Buffer = ();\n+}\n+\n+type A = impl Fn(<DefaultAllocator as Allocator>::Buffer);\n+\n+fn foo() -> A {\n+    |_| ()\n+}\n+\n+fn main() {}"}, {"sha": "197aedf9d98bc95444224cb00a59dee2e93e2aff", "filename": "src/test/ui/impl-trait/issue-103181-1.rs", "status": "added", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/rust-lang/rust/blob/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-1.rs?ref=cb61113cdc158de18993a94bc6bb39aee6950a9b", "patch": "@@ -0,0 +1,85 @@\n+// edition:2021\n+\n+mod hyper {\n+    use std::{fmt::Debug, future::Future, marker::PhantomData, pin::Pin, task::Poll};\n+\n+    pub trait HttpBody {\n+        type Error;\n+    }\n+    impl HttpBody for () {\n+        //~^ ERROR not all trait items implemented, missing: `Error`\n+        // don't implement `Error` here for the ICE\n+    }\n+\n+    pub struct Server<I, S>(I, S);\n+\n+    pub fn serve<I, S>(_: S) -> Server<I, S> {\n+        todo!()\n+    }\n+\n+    impl<S, B> Future for Server<(), S>\n+    where\n+        S: MakeServiceRef<(), (), ResBody = B>,\n+        B: HttpBody,\n+        B::Error: Debug,\n+    {\n+        type Output = ();\n+\n+        fn poll(self: Pin<&mut Self>, _: &mut std::task::Context<'_>) -> Poll<Self::Output> {\n+            todo!()\n+        }\n+    }\n+\n+    pub trait MakeServiceRef<Target, ReqBody> {\n+        type ResBody;\n+    }\n+\n+    impl<T, S> MakeServiceRef<(), ()> for T\n+    where\n+        T: for<'a> Service<&'a (), Response = S>,\n+        S: Service<()>,\n+    {\n+        type ResBody = ();\n+    }\n+\n+    pub struct MakeServiceFn<F>(pub F);\n+    pub struct ServiceFn<F, R>(pub PhantomData<(F, R)>);\n+\n+    pub trait Service<Request> {\n+        type Response;\n+    }\n+\n+    impl<'t, F, Ret, Target, Svc> Service<&'t Target> for MakeServiceFn<F>\n+    where\n+        F: Fn() -> Ret,\n+        Ret: Future<Output = Result<Svc, ()>>,\n+    {\n+        type Response = Svc;\n+    }\n+\n+    impl<F, ReqBody, Ret, ResBody, E> Service<ReqBody> for ServiceFn<F, ReqBody>\n+    where\n+        F: Fn() -> Ret,\n+        Ret: Future<Output = Result<ResBody, E>>,\n+    {\n+        type Response = ResBody;\n+    }\n+}\n+\n+async fn smarvice() -> Result<(), ()> {\n+    Ok(())\n+}\n+\n+fn service_fn<F, R, S>(f: F) -> hyper::ServiceFn<F, R>\n+where\n+    F: Fn() -> S,\n+{\n+    hyper::ServiceFn(std::marker::PhantomData)\n+}\n+\n+async fn iceice() {\n+    let service = hyper::MakeServiceFn(|| async { Ok::<_, ()>(service_fn(|| smarvice())) });\n+    hyper::serve::<(), _>(service).await;\n+}\n+\n+fn main() {}"}, {"sha": "cd026607d52fc1b63f745c12c2239e9a987d0dd5", "filename": "src/test/ui/impl-trait/issue-103181-1.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-1.stderr?ref=cb61113cdc158de18993a94bc6bb39aee6950a9b", "patch": "@@ -0,0 +1,12 @@\n+error[E0046]: not all trait items implemented, missing: `Error`\n+  --> $DIR/issue-103181-1.rs:9:5\n+   |\n+LL |         type Error;\n+   |         ---------- `Error` from trait\n+LL |     }\n+LL |     impl HttpBody for () {\n+   |     ^^^^^^^^^^^^^^^^^^^^ missing `Error` in implementation\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0046`."}, {"sha": "b43ac45075e2bd409500b7209052e6bd18807141", "filename": "src/test/ui/impl-trait/issue-103181-2.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-2.rs?ref=cb61113cdc158de18993a94bc6bb39aee6950a9b", "patch": "@@ -0,0 +1,29 @@\n+// edition:2021\n+\n+trait SendFuture: Send {\n+    type Output;\n+}\n+\n+impl<Fut: Send> SendFuture for Fut {\n+    type Output = ();\n+}\n+\n+async fn broken_fut() {\n+    ident_error;\n+    //~^ ERROR cannot find value `ident_error` in this scope\n+}\n+\n+// triggers normalization of `<Fut as SendFuture>::Output`,\n+// which requires `Fut: Send`.\n+fn normalize<Fut: SendFuture>(_: Fut, _: Fut::Output) {}\n+\n+async fn iceice<A, B>()\n+// <- async fn is necessary\n+where\n+    A: Send,\n+    B: Send, // <- a second bound\n+{\n+    normalize(broken_fut(), ());\n+}\n+\n+fn main() {}"}, {"sha": "5eb2dd9184bec9dfe3b34e611ba192270316ff94", "filename": "src/test/ui/impl-trait/issue-103181-2.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cb61113cdc158de18993a94bc6bb39aee6950a9b/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-103181-2.stderr?ref=cb61113cdc158de18993a94bc6bb39aee6950a9b", "patch": "@@ -0,0 +1,9 @@\n+error[E0425]: cannot find value `ident_error` in this scope\n+  --> $DIR/issue-103181-2.rs:12:5\n+   |\n+LL |     ident_error;\n+   |     ^^^^^^^^^^^ not found in this scope\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0425`."}]}