{"sha": "f8dffc6789113a10c9dbf1d815c3569b19b53e96", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4ZGZmYzY3ODkxMTNhMTBjOWRiZjFkODE1YzM1NjliMTliNTNlOTY=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-05-03T02:13:56Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-05-03T02:13:56Z"}, "message": "core: Wire up the unwinder to newsched again\n\nThis was some merge fallout", "tree": {"sha": "7a850e944ba9b7fc58c5eea54ffa9dabe74ac399", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a850e944ba9b7fc58c5eea54ffa9dabe74ac399"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f8dffc6789113a10c9dbf1d815c3569b19b53e96", "comment_count": 3, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f8dffc6789113a10c9dbf1d815c3569b19b53e96", "html_url": "https://github.com/rust-lang/rust/commit/f8dffc6789113a10c9dbf1d815c3569b19b53e96", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f8dffc6789113a10c9dbf1d815c3569b19b53e96/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db6a62c537852a30f030f866598c358d01fb95cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/db6a62c537852a30f030f866598c358d01fb95cd", "html_url": "https://github.com/rust-lang/rust/commit/db6a62c537852a30f030f866598c358d01fb95cd"}], "stats": {"total": 35, "additions": 18, "deletions": 17}, "files": [{"sha": "4a8d9fe27d91585612c30c8a521c298006463c2a", "filename": "src/libcore/sys.rs", "status": "modified", "additions": 18, "deletions": 17, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/f8dffc6789113a10c9dbf1d815c3569b19b53e96/src%2Flibcore%2Fsys.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f8dffc6789113a10c9dbf1d815c3569b19b53e96/src%2Flibcore%2Fsys.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fsys.rs?ref=f8dffc6789113a10c9dbf1d815c3569b19b53e96", "patch": "@@ -204,22 +204,32 @@ impl FailWithCause for &'static str {\n #[cfg(stage0)]\n pub fn begin_unwind(msg: ~str, file: ~str, line: uint) -> ! {\n \n+    do str::as_buf(msg) |msg_buf, _msg_len| {\n+        do str::as_buf(file) |file_buf, _file_len| {\n+            unsafe {\n+                let msg_buf = cast::transmute(msg_buf);\n+                let file_buf = cast::transmute(file_buf);\n+                begin_unwind_(msg_buf, file_buf, line as libc::size_t)\n+            }\n+        }\n+    }\n+}\n+\n+// FIXME #4427: Temporary until rt::rt_fail_ goes away\n+pub fn begin_unwind_(msg: *c_char, file: *c_char, line: size_t) -> ! {\n     use rt::{context, OldTaskContext};\n     use rt::local_services::unsafe_borrow_local_services;\n \n     match context() {\n         OldTaskContext => {\n-            do str::as_buf(msg) |msg_buf, _msg_len| {\n-                do str::as_buf(file) |file_buf, _file_len| {\n-                    unsafe {\n-                        let msg_buf = cast::transmute(msg_buf);\n-                        let file_buf = cast::transmute(file_buf);\n-                        begin_unwind_(msg_buf, file_buf, line as libc::size_t)\n-                    }\n-                }\n+            unsafe {\n+                gc::cleanup_stack_for_failure();\n+                rustrt::rust_upcall_fail(msg, file, line);\n+                cast::transmute(())\n             }\n         }\n         _ => {\n+            // XXX: Need to print the failure message\n             gc::cleanup_stack_for_failure();\n             unsafe {\n                 let local_services = unsafe_borrow_local_services();\n@@ -232,15 +242,6 @@ pub fn begin_unwind(msg: ~str, file: ~str, line: uint) -> ! {\n     }\n }\n \n-// FIXME #4427: Temporary until rt::rt_fail_ goes away\n-pub fn begin_unwind_(msg: *c_char, file: *c_char, line: size_t) -> ! {\n-    unsafe {\n-        gc::cleanup_stack_for_failure();\n-        rustrt::rust_upcall_fail(msg, file, line);\n-        cast::transmute(())\n-    }\n-}\n-\n // NOTE: remove function after snapshot\n #[cfg(stage0)]\n pub fn fail_assert(msg: &str, file: &str, line: uint) -> ! {"}]}