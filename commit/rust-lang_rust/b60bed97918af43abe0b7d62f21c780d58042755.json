{"sha": "b60bed97918af43abe0b7d62f21c780d58042755", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2MGJlZDk3OTE4YWY0M2FiZTBiN2Q2MmYyMWM3ODBkNTgwNDI3NTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-02-08T09:56:30Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-02-08T09:56:30Z"}, "message": "auto merge of #12096 : brson/rust/morestack-addr, r=thestinger", "tree": {"sha": "47b8f9297f872b216537e399711598e8d76c645a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47b8f9297f872b216537e399711598e8d76c645a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b60bed97918af43abe0b7d62f21c780d58042755", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b60bed97918af43abe0b7d62f21c780d58042755", "html_url": "https://github.com/rust-lang/rust/commit/b60bed97918af43abe0b7d62f21c780d58042755", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b60bed97918af43abe0b7d62f21c780d58042755/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "95483e30a2fd18ddb72c50a17a87cf8439c8f2bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/95483e30a2fd18ddb72c50a17a87cf8439c8f2bd", "html_url": "https://github.com/rust-lang/rust/commit/95483e30a2fd18ddb72c50a17a87cf8439c8f2bd"}, {"sha": "b91caac729fd103a7ce4a6094be7845643f4704d", "url": "https://api.github.com/repos/rust-lang/rust/commits/b91caac729fd103a7ce4a6094be7845643f4704d", "html_url": "https://github.com/rust-lang/rust/commit/b91caac729fd103a7ce4a6094be7845643f4704d"}], "stats": {"total": 41, "additions": 0, "deletions": 41}, "files": [{"sha": "25ecbeaa9a5ed0d5af34a24af16e7b11aac7594e", "filename": "src/librustc/middle/trans/intrinsic.rs", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b60bed97918af43abe0b7d62f21c780d58042755/src%2Flibrustc%2Fmiddle%2Ftrans%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60bed97918af43abe0b7d62f21c780d58042755/src%2Flibrustc%2Fmiddle%2Ftrans%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fintrinsic.rs?ref=b60bed97918af43abe0b7d62f21c780d58042755", "patch": "@@ -461,17 +461,6 @@ pub fn trans_intrinsic(ccx: @CrateContext,\n             glue::call_visit_glue(bcx, visitor, td, None);\n             RetVoid(bcx);\n         }\n-        \"morestack_addr\" => {\n-            // FIXME This is a hack to grab the address of this particular\n-            // native function. There should be a general in-language\n-            // way to do this\n-            let llfty = type_of_rust_fn(bcx.ccx(), false, [], ty::mk_nil());\n-            let morestack_addr = decl_cdecl_fn(bcx.ccx().llmod, \"__morestack\",\n-                                               llfty, ty::mk_nil());\n-            let morestack_addr = PointerCast(bcx, morestack_addr,\n-                                             Type::nil().ptr_to());\n-            Ret(bcx, morestack_addr);\n-        }\n         \"offset\" => {\n             let ptr = get_param(decl, first_real_arg);\n             let offset = get_param(decl, first_real_arg + 1);"}, {"sha": "81948464d53d6882fc832cff37fb6cd22b2d5b37", "filename": "src/librustc/middle/typeck/check/mod.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b60bed97918af43abe0b7d62f21c780d58042755/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60bed97918af43abe0b7d62f21c780d58042755/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs?ref=b60bed97918af43abe0b7d62f21c780d58042755", "patch": "@@ -4127,9 +4127,6 @@ pub fn check_intrinsic_type(ccx: @CrateCtxt, it: &ast::ForeignItem) {\n               });\n               (0, ~[ td_ptr, visitor_object_ty ], ty::mk_nil())\n             }\n-            \"morestack_addr\" => {\n-              (0u, ~[], ty::mk_nil_ptr(ccx.tcx))\n-            }\n             \"offset\" => {\n               (1,\n                ~["}, {"sha": "7ca28711504c9a56df31fc53961fbbefd797563b", "filename": "src/libstd/unstable/intrinsics.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b60bed97918af43abe0b7d62f21c780d58042755/src%2Flibstd%2Funstable%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60bed97918af43abe0b7d62f21c780d58042755/src%2Flibstd%2Funstable%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Fintrinsics.rs?ref=b60bed97918af43abe0b7d62f21c780d58042755", "patch": "@@ -310,9 +310,6 @@ extern \"rust-intrinsic\" {\n \n     pub fn visit_tydesc(td: *TyDesc, tv: &mut TyVisitor);\n \n-    /// Get the address of the `__morestack` stack growth function.\n-    pub fn morestack_addr() -> *();\n-\n     /// Calculates the offset from a pointer. The offset *must* be in-bounds of\n     /// the object, or one-byte-past-the-end. An arithmetic overflow is also\n     /// undefined behaviour."}, {"sha": "ec678df357a8ddd4ffde27790768887fa4402f11", "filename": "src/test/run-pass/morestack-address.rs", "status": "removed", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/95483e30a2fd18ddb72c50a17a87cf8439c8f2bd/src%2Ftest%2Frun-pass%2Fmorestack-address.rs", "raw_url": "https://github.com/rust-lang/rust/raw/95483e30a2fd18ddb72c50a17a87cf8439c8f2bd/src%2Ftest%2Frun-pass%2Fmorestack-address.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmorestack-address.rs?ref=95483e30a2fd18ddb72c50a17a87cf8439c8f2bd", "patch": "@@ -1,24 +0,0 @@\n-// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-mod rusti {\n-    #[nolink]\n-    extern \"rust-intrinsic\" {\n-        pub fn morestack_addr() -> *();\n-    }\n-}\n-\n-pub fn main() {\n-    unsafe {\n-        let addr = rusti::morestack_addr();\n-        assert!(addr.is_not_null());\n-        error!(\"{}\", addr);\n-    }\n-}"}]}