{"sha": "56ddef8ab855ebdd57febde8356e890cdc03f118", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2ZGRlZjhhYjg1NWViZGQ1N2ZlYmRlODM1NmU4OTBjZGMwM2YxMTg=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-06-30T20:20:57Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-06-30T20:20:57Z"}, "message": "Rollup merge of #86680 - camsteffen:dbg-opt-error, r=petrochenkov\n\nImprove error for missing -Z with debugging option\n\nBefore:\n```text\n\u276f rustc --unpretty=hir\nerror: Unrecognized option: 'unpretty'\n```\nAfter:\n```text\n\u276f rustc --unpretty=hir\nerror: Unrecognized option: 'unpretty'. Did you mean `-Z unpretty`?\n```", "tree": {"sha": "cb3cc11568f04232e72893abbff18636060ff119", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb3cc11568f04232e72893abbff18636060ff119"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56ddef8ab855ebdd57febde8356e890cdc03f118", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg3NIqCRBK7hj4Ov3rIwAAAjUIAEAeVPvuRFoGE3xg+mx2A1Vj\nsNxIuNxBNPULwaB2K/EAODznLKQLT4qwSt4S87YAwh4MPi2FNjbDPFihiS5uaclI\nnwHCkRGxNJzznMk6/II07CFHAlpTyoXjgd2ecvLxAT6kKb39IV7jr2jx4bD+D/aD\n+KOOKgtqhaYpdrb/ostzpmPAiIzt7pjZIskDIqGhQzQPB4olQleYJdh4fSGeK70L\nfSHfslALL63O9S1sskwR+gH8v/JBVdv7r1MJ+GpjyJg87tX9bRmNbUN6Lw3rBoud\n44eL9SRqp1WTYPfzBn9GDJhHfNXMfAJ3Rlg6znl0azo4XUJs4bax77KHpl+4z8I=\n=p95a\n-----END PGP SIGNATURE-----\n", "payload": "tree cb3cc11568f04232e72893abbff18636060ff119\nparent 1823b3f2b3f52be546a76e57d7c501ddd04763b2\nparent 2a60f090b9d39e5600dcbcf83229bbaec2f02176\nauthor Yuki Okushi <jtitor@2k36.org> 1625084457 +0900\ncommitter GitHub <noreply@github.com> 1625084457 +0900\n\nRollup merge of #86680 - camsteffen:dbg-opt-error, r=petrochenkov\n\nImprove error for missing -Z with debugging option\n\nBefore:\n```text\n\u276f rustc --unpretty=hir\nerror: Unrecognized option: 'unpretty'\n```\nAfter:\n```text\n\u276f rustc --unpretty=hir\nerror: Unrecognized option: 'unpretty'. Did you mean `-Z unpretty`?\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56ddef8ab855ebdd57febde8356e890cdc03f118", "html_url": "https://github.com/rust-lang/rust/commit/56ddef8ab855ebdd57febde8356e890cdc03f118", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56ddef8ab855ebdd57febde8356e890cdc03f118/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1823b3f2b3f52be546a76e57d7c501ddd04763b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/1823b3f2b3f52be546a76e57d7c501ddd04763b2", "html_url": "https://github.com/rust-lang/rust/commit/1823b3f2b3f52be546a76e57d7c501ddd04763b2"}, {"sha": "2a60f090b9d39e5600dcbcf83229bbaec2f02176", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a60f090b9d39e5600dcbcf83229bbaec2f02176", "html_url": "https://github.com/rust-lang/rust/commit/2a60f090b9d39e5600dcbcf83229bbaec2f02176"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "2ad2820fac0a87ce2e0ca867ef9087491c07fb87", "filename": "compiler/rustc_driver/src/lib.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/56ddef8ab855ebdd57febde8356e890cdc03f118/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56ddef8ab855ebdd57febde8356e890cdc03f118/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver%2Fsrc%2Flib.rs?ref=56ddef8ab855ebdd57febde8356e890cdc03f118", "patch": "@@ -29,7 +29,7 @@ use rustc_middle::middle::cstore::MetadataLoader;\n use rustc_save_analysis as save;\n use rustc_save_analysis::DumpHandler;\n use rustc_serialize::json::{self, ToJson};\n-use rustc_session::config::nightly_options;\n+use rustc_session::config::{nightly_options, CG_OPTIONS, DB_OPTIONS};\n use rustc_session::config::{ErrorOutputType, Input, OutputType, PrintRequest, TrimmedDefPaths};\n use rustc_session::getopts;\n use rustc_session::lint::{Lint, LintId};\n@@ -1017,9 +1017,18 @@ pub fn handle_options(args: &[String]) -> Option<getopts::Matches> {\n     for option in config::rustc_optgroups() {\n         (option.apply)(&mut options);\n     }\n-    let matches = options\n-        .parse(args)\n-        .unwrap_or_else(|f| early_error(ErrorOutputType::default(), &f.to_string()));\n+    let matches = options.parse(args).unwrap_or_else(|e| {\n+        let msg = match e {\n+            getopts::Fail::UnrecognizedOption(ref opt) => CG_OPTIONS\n+                .iter()\n+                .map(|&(name, ..)| ('C', name))\n+                .chain(DB_OPTIONS.iter().map(|&(name, ..)| ('Z', name)))\n+                .find(|&(_, name)| *opt == name.replace(\"_\", \"-\"))\n+                .map(|(flag, _)| format!(\"{}. Did you mean `-{} {}`?\", e, flag, opt)),\n+            _ => None,\n+        };\n+        early_error(ErrorOutputType::default(), &msg.unwrap_or_else(|| e.to_string()));\n+    });\n \n     // For all options we just parsed, we check a few aspects:\n     //"}, {"sha": "7bbf47a3839513627649f5028e30655c38a945a3", "filename": "src/test/ui/invalid-compile-flags/codegen-option-without-group.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.rs?ref=56ddef8ab855ebdd57febde8356e890cdc03f118", "patch": "@@ -0,0 +1 @@\n+// compile-flags: --llvm-args"}, {"sha": "c5a0c29cad96581663e1e696062f97ffe577c4a7", "filename": "src/test/ui/invalid-compile-flags/codegen-option-without-group.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.stderr?ref=56ddef8ab855ebdd57febde8356e890cdc03f118", "patch": "@@ -0,0 +1,2 @@\n+error: Unrecognized option: 'llvm-args'. Did you mean `-C llvm-args`?\n+"}, {"sha": "86e40c1785405453ccad899e229d9266b9c56b1b", "filename": "src/test/ui/invalid-compile-flags/debug-option-without-group.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.rs?ref=56ddef8ab855ebdd57febde8356e890cdc03f118", "patch": "@@ -0,0 +1 @@\n+// compile-flags: --unpretty=hir"}, {"sha": "0e57e31ad3dfa7e10217ced6fca01db944f682cc", "filename": "src/test/ui/invalid-compile-flags/debug-option-without-group.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/56ddef8ab855ebdd57febde8356e890cdc03f118/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.stderr?ref=56ddef8ab855ebdd57febde8356e890cdc03f118", "patch": "@@ -0,0 +1,2 @@\n+error: Unrecognized option: 'unpretty'. Did you mean `-Z unpretty`?\n+"}]}