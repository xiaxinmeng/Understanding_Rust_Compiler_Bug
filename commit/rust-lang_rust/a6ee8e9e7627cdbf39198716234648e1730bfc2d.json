{"sha": "a6ee8e9e7627cdbf39198716234648e1730bfc2d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2ZWU4ZTllNzYyN2NkYmYzOTE5ODcxNjIzNDY0OGUxNzMwYmZjMmQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-03-01T19:31:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-01T19:31:01Z"}, "message": "Merge #7829 #7833\n\n7829: Bump deps r=matklad a=lnicola\n\nUnfortunately, this brings a bunch of proc macros dep because `cargo-metadata` went full-in on `derive-builder`. I'm not sure what we can do here..\n\n7833: Use chalk_ir::Mutability r=Veykril a=Veykril\n\n\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "3c22ee4d3b1b1e808b08719acd6aa535f9ffa460", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c22ee4d3b1b1e808b08719acd6aa535f9ffa460"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a6ee8e9e7627cdbf39198716234648e1730bfc2d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgPUD1CRBK7hj4Ov3rIwAAdHIIAHBNBopqqFjvwsOzDObehI3o\nkH3MpnHMynuepQDQ8CZRJwOIMOz82lw2YsoNPKCmMvBCfhb36ktyy4ZiQCAyLgaj\nYbAkLkR5dHhjkGuZmlmPAs/wMOXzbN0jCTqqQ5PwWerE1Ry/NoAOoV2t3FKAe5s/\nJy2yYIQeDoLhkZk3os2mMTZzSFnWkdu1LMZYhCHlZsz615i8P9NhFRCyQvPH6py9\nTMWQFXtH29UXcozfZbESZkiUWtidYIeuRVDJZIyuAMtD5EIyST0uiGBot8wErVEY\nLnjIMv/EI4BElYw3y/lf8UAiMFkklSkDvyZ0nU1AKAfTnkLyhYI0UYVOhVxec5A=\n=d+79\n-----END PGP SIGNATURE-----\n", "payload": "tree 3c22ee4d3b1b1e808b08719acd6aa535f9ffa460\nparent f17f9f51d6bc8e29a309980bfca24fbcb3cecb33\nparent 63e8bdb8a26476e8fa668dfdd16966f6ebc81471\nparent 7072f59fc61b8b487f301df1fe5eefbcc84672aa\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1614627061 +0000\ncommitter GitHub <noreply@github.com> 1614627061 +0000\n\nMerge #7829 #7833\n\n7829: Bump deps r=matklad a=lnicola\n\nUnfortunately, this brings a bunch of proc macros dep because `cargo-metadata` went full-in on `derive-builder`. I'm not sure what we can do here..\n\n7833: Use chalk_ir::Mutability r=Veykril a=Veykril\n\n\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a6ee8e9e7627cdbf39198716234648e1730bfc2d", "html_url": "https://github.com/rust-lang/rust/commit/a6ee8e9e7627cdbf39198716234648e1730bfc2d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a6ee8e9e7627cdbf39198716234648e1730bfc2d/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f17f9f51d6bc8e29a309980bfca24fbcb3cecb33", "url": "https://api.github.com/repos/rust-lang/rust/commits/f17f9f51d6bc8e29a309980bfca24fbcb3cecb33", "html_url": "https://github.com/rust-lang/rust/commit/f17f9f51d6bc8e29a309980bfca24fbcb3cecb33"}, {"sha": "63e8bdb8a26476e8fa668dfdd16966f6ebc81471", "url": "https://api.github.com/repos/rust-lang/rust/commits/63e8bdb8a26476e8fa668dfdd16966f6ebc81471", "html_url": "https://github.com/rust-lang/rust/commit/63e8bdb8a26476e8fa668dfdd16966f6ebc81471"}, {"sha": "7072f59fc61b8b487f301df1fe5eefbcc84672aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/7072f59fc61b8b487f301df1fe5eefbcc84672aa", "html_url": "https://github.com/rust-lang/rust/commit/7072f59fc61b8b487f301df1fe5eefbcc84672aa"}], "stats": {"total": 213, "additions": 109, "deletions": 104}, "files": [{"sha": "0476a15eb11b1dfc295995b62f12dd5c2aa2ceb3", "filename": "Cargo.lock", "status": "modified", "additions": 28, "deletions": 37, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -13,9 +13,9 @@ dependencies = [\n \n [[package]]\n name = \"adler\"\n-version = \"1.0.1\"\n+version = \"1.0.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"bedc89c5c7b5550ffb9372eb5c5ffc7f9f705cc3f4a128bd4669b9745f555093\"\n+checksum = \"f26201604c87b1e01bd3d98f8d5d9a8fcbb815e8cedb41ffccbeb4bf593a35fe\"\n \n [[package]]\n name = \"always-assert\"\n@@ -158,9 +158,9 @@ checksum = \"baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd\"\n \n [[package]]\n name = \"chalk-derive\"\n-version = \"0.58.0\"\n+version = \"0.59.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"e625b7c688272783140509a0de8f7aa9000217cb0982c9b10606a12b0b747ba8\"\n+checksum = \"4b9000fbcb67353dc8973ab9fd136277d321d85b79bd36b8756bb3ae0979a94a\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -170,9 +170,9 @@ dependencies = [\n \n [[package]]\n name = \"chalk-ir\"\n-version = \"0.58.0\"\n+version = \"0.59.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"c220d870128959d7d56667060d556ffdebd490f32ee0fc9f4060a76c1193f206\"\n+checksum = \"b23528d61b3557c676eccf508fa0771a38453b379f0b780154eaa7f70afe8dfc\"\n dependencies = [\n  \"bitflags\",\n  \"chalk-derive\",\n@@ -181,9 +181,9 @@ dependencies = [\n \n [[package]]\n name = \"chalk-recursive\"\n-version = \"0.58.0\"\n+version = \"0.59.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7d8cd81a15aa936215378e695a8907b9f1af8626a27a32ee22e97a50984960da\"\n+checksum = \"a8bdd37afc666b771de8b4429fe014363d0e74aae5cc26f320f60a3eab34d744\"\n dependencies = [\n  \"chalk-derive\",\n  \"chalk-ir\",\n@@ -194,14 +194,14 @@ dependencies = [\n \n [[package]]\n name = \"chalk-solve\"\n-version = \"0.58.0\"\n+version = \"0.59.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"55571250dfe096a4c899be88c81418284c952ce1c8a06aa16afb5781b298e9c9\"\n+checksum = \"4182c42ca319cb71c89898ebc3d2671d1fa7d928123b171b66f1797a2000b9c8\"\n dependencies = [\n  \"chalk-derive\",\n  \"chalk-ir\",\n  \"ena\",\n- \"itertools 0.9.0\",\n+ \"itertools\",\n  \"petgraph\",\n  \"rustc-hash\",\n  \"tracing\",\n@@ -475,7 +475,7 @@ dependencies = [\n  \"hir_def\",\n  \"hir_expand\",\n  \"hir_ty\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"log\",\n  \"profile\",\n  \"rustc-hash\",\n@@ -497,7 +497,7 @@ dependencies = [\n  \"fst\",\n  \"hir_expand\",\n  \"indexmap\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"la-arena\",\n  \"log\",\n  \"mbe\",\n@@ -541,7 +541,7 @@ dependencies = [\n  \"expect-test\",\n  \"hir_def\",\n  \"hir_expand\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"la-arena\",\n  \"log\",\n  \"once_cell\",\n@@ -579,7 +579,7 @@ dependencies = [\n  \"ide_db\",\n  \"ide_ssr\",\n  \"indexmap\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"log\",\n  \"oorandom\",\n  \"profile\",\n@@ -601,7 +601,7 @@ dependencies = [\n  \"expect-test\",\n  \"hir\",\n  \"ide_db\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"profile\",\n  \"rustc-hash\",\n  \"stdx\",\n@@ -619,7 +619,7 @@ dependencies = [\n  \"expect-test\",\n  \"hir\",\n  \"ide_db\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"log\",\n  \"profile\",\n  \"rustc-hash\",\n@@ -638,7 +638,7 @@ dependencies = [\n  \"expect-test\",\n  \"fst\",\n  \"hir\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"log\",\n  \"once_cell\",\n  \"profile\",\n@@ -657,7 +657,7 @@ dependencies = [\n  \"expect-test\",\n  \"hir\",\n  \"ide_db\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"rustc-hash\",\n  \"syntax\",\n  \"test_utils\",\n@@ -714,15 +714,6 @@ dependencies = [\n  \"cfg-if\",\n ]\n \n-[[package]]\n-name = \"itertools\"\n-version = \"0.9.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"284f18f85651fe11e8a991b2adb42cb078325c996ed026d994719efcfca1d54b\"\n-dependencies = [\n- \"either\",\n-]\n-\n [[package]]\n name = \"itertools\"\n version = \"0.10.0\"\n@@ -1206,7 +1197,7 @@ dependencies = [\n  \"base_db\",\n  \"cargo_metadata\",\n  \"cfg\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"la-arena\",\n  \"log\",\n  \"paths\",\n@@ -1338,7 +1329,7 @@ dependencies = [\n  \"ide\",\n  \"ide_db\",\n  \"ide_ssr\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"jemallocator\",\n  \"jod-thread\",\n  \"log\",\n@@ -1490,9 +1481,9 @@ dependencies = [\n \n [[package]]\n name = \"serde_json\"\n-version = \"1.0.62\"\n+version = \"1.0.64\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ea1c6153794552ea7cf7cf63b1231a25de00ec90db326ba6264440fa08e31486\"\n+checksum = \"799e97dc9fdae36a5c8b8f2cae9ce2ee9fdce2058c57a93e6099d919fd982f79\"\n dependencies = [\n  \"indexmap\",\n  \"itoa\",\n@@ -1593,7 +1584,7 @@ dependencies = [\n  \"arrayvec\",\n  \"expect-test\",\n  \"indexmap\",\n- \"itertools 0.10.0\",\n+ \"itertools\",\n  \"once_cell\",\n  \"parser\",\n  \"profile\",\n@@ -1923,18 +1914,18 @@ checksum = \"06069a848f95fceae3e5e03c0ddc8cb78452b56654ee0c8e68f938cf790fb9e3\"\n \n [[package]]\n name = \"xshell\"\n-version = \"0.1.8\"\n+version = \"0.1.9\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ed373ede30cea03e8c0af22f48ee1ba80efbf06fec8b4746977e6ee703878de0\"\n+checksum = \"6f18102278453c8f70ea5c514ac78cb4c73a0ef72a8273d17094b52f9584c0c1\"\n dependencies = [\n  \"xshell-macros\",\n ]\n \n [[package]]\n name = \"xshell-macros\"\n-version = \"0.1.8\"\n+version = \"0.1.9\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7f6af9f8119104697b0105989a73c578ce33f922d9d6f3dae0e8ae3d538db321\"\n+checksum = \"6093c460064572007f885facc70bb0ca5e40a83ea7ff8b16c1abbee56fd2e767\"\n \n [[package]]\n name = \"xtask\""}, {"sha": "fc1a74641cc8aa5922fae659155fcb797212ea94", "filename": "crates/hir/src/code_model.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fcode_model.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -14,7 +14,7 @@ use hir_def::{\n     per_ns::PerNs,\n     resolver::{HasResolver, Resolver},\n     src::HasSource as _,\n-    type_ref::{Mutability, TypeRef},\n+    type_ref::TypeRef,\n     AdtId, AssocContainerId, AssocItemId, AssocItemLoc, AttrDefId, ConstId, ConstParamId,\n     DefWithBodyId, EnumId, FunctionId, GenericDefId, HasModule, ImplId, LifetimeParamId,\n     LocalEnumVariantId, LocalFieldId, Lookup, ModuleId, StaticId, StructId, TraitId, TypeAliasId,\n@@ -32,8 +32,8 @@ use hir_ty::{\n     method_resolution,\n     traits::{FnTrait, Solution, SolutionVariables},\n     AliasTy, BoundVar, CallableDefId, CallableSig, Canonical, DebruijnIndex, GenericPredicate,\n-    InEnvironment, Obligation, ProjectionPredicate, ProjectionTy, Scalar, Substs, TraitEnvironment,\n-    Ty, TyDefId, TyVariableKind,\n+    InEnvironment, Mutability, Obligation, ProjectionPredicate, ProjectionTy, Scalar, Substs,\n+    TraitEnvironment, Ty, TyDefId, TyVariableKind,\n };\n use rustc_hash::FxHashSet;\n use stdx::{format_to, impl_from};\n@@ -836,7 +836,7 @@ pub enum Access {\n impl From<Mutability> for Access {\n     fn from(mutability: Mutability) -> Access {\n         match mutability {\n-            Mutability::Shared => Access::Shared,\n+            Mutability::Not => Access::Shared,\n             Mutability::Mut => Access::Exclusive,\n         }\n     }\n@@ -865,7 +865,10 @@ impl SelfParam {\n             .params\n             .first()\n             .map(|param| match *param {\n-                TypeRef::Reference(.., mutability) => mutability.into(),\n+                TypeRef::Reference(.., mutability) => match mutability {\n+                    hir_def::type_ref::Mutability::Shared => Access::Shared,\n+                    hir_def::type_ref::Mutability::Mut => Access::Exclusive,\n+                },\n                 _ => Access::Owned,\n             })\n             .unwrap_or(Access::Owned)"}, {"sha": "d1302d7497ae11e45bc396888414cb47d3a4871a", "filename": "crates/hir_ty/Cargo.toml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2FCargo.toml?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -17,9 +17,9 @@ ena = \"0.14.0\"\n log = \"0.4.8\"\n rustc-hash = \"1.1.0\"\n scoped-tls = \"1\"\n-chalk-solve = { version = \"0.58\", default-features = false }\n-chalk-ir = \"0.58\"\n-chalk-recursive = \"0.58\"\n+chalk-solve = { version = \"0.59\", default-features = false }\n+chalk-ir = \"0.59\"\n+chalk-recursive = \"0.59\"\n la-arena = { version = \"0.2.0\", path = \"../../lib/arena\" }\n \n stdx = { path = \"../stdx\", version = \"0.0.0\" }"}, {"sha": "d4a8b48e655e1745081425fec459bb568902cd7d", "filename": "crates/hir_ty/src/display.rs", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -8,6 +8,7 @@ use crate::{\n     TraitRef, Ty,\n };\n use arrayvec::ArrayVec;\n+use chalk_ir::Mutability;\n use hir_def::{\n     db::DefDatabase, find_path, generics::TypeParamProvenance, item_scope::ItemInNs, AdtId,\n     AssocContainerId, HasModule, Lookup, ModuleId, TraitId,\n@@ -291,9 +292,23 @@ impl HirDisplay for Ty {\n                     t.into_displayable(f.db, f.max_size, f.omit_verbose_types, f.display_target);\n \n                 if matches!(self, Ty::Raw(..)) {\n-                    write!(f, \"*{}\", m.as_keyword_for_ptr())?;\n+                    write!(\n+                        f,\n+                        \"*{}\",\n+                        match m {\n+                            Mutability::Not => \"const \",\n+                            Mutability::Mut => \"mut \",\n+                        }\n+                    )?;\n                 } else {\n-                    write!(f, \"&{}\", m.as_keyword_for_ref())?;\n+                    write!(\n+                        f,\n+                        \"&{}\",\n+                        match m {\n+                            Mutability::Not => \"\",\n+                            Mutability::Mut => \"mut \",\n+                        }\n+                    )?;\n                 }\n \n                 let datas;"}, {"sha": "4d771a91e8d99e340d603103df28c7b574737653", "filename": "crates/hir_ty/src/infer.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Finfer.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -18,14 +18,15 @@ use std::mem;\n use std::ops::Index;\n use std::sync::Arc;\n \n+use chalk_ir::Mutability;\n use hir_def::{\n     body::Body,\n     data::{ConstData, FunctionData, StaticData},\n     expr::{ArithOp, BinaryOp, BindingAnnotation, ExprId, PatId},\n     lang_item::LangItemTarget,\n     path::{path, Path},\n     resolver::{HasResolver, Resolver, TypeNs},\n-    type_ref::{Mutability, TypeRef},\n+    type_ref::TypeRef,\n     AdtId, AssocItemId, DefWithBodyId, EnumVariantId, FieldId, FunctionId, Lookup, TraitId,\n     TypeAliasId, VariantId,\n };\n@@ -87,7 +88,7 @@ impl BindingMode {\n     fn convert(annotation: BindingAnnotation) -> BindingMode {\n         match annotation {\n             BindingAnnotation::Unannotated | BindingAnnotation::Mutable => BindingMode::Move,\n-            BindingAnnotation::Ref => BindingMode::Ref(Mutability::Shared),\n+            BindingAnnotation::Ref => BindingMode::Ref(Mutability::Not),\n             BindingAnnotation::RefMut => BindingMode::Ref(Mutability::Mut),\n         }\n     }"}, {"sha": "cf0a3add49d0286056cc59fe15bdc8ef15cd3236", "filename": "crates/hir_ty/src/infer/coerce.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer%2Fcoerce.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer%2Fcoerce.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Finfer%2Fcoerce.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -4,8 +4,8 @@\n //!\n //! See: https://doc.rust-lang.org/nomicon/coercions.html\n \n-use chalk_ir::TyVariableKind;\n-use hir_def::{lang_item::LangItemTarget, type_ref::Mutability};\n+use chalk_ir::{Mutability, TyVariableKind};\n+use hir_def::lang_item::LangItemTarget;\n use test_utils::mark;\n \n use crate::{autoderef, traits::Solution, Obligation, Substs, TraitRef, Ty};\n@@ -73,20 +73,20 @@ impl<'a> InferenceContext<'a> {\n         match (&mut from_ty, to_ty) {\n             // `*mut T` -> `*const T`\n             // `&mut T` -> `&T`\n-            (Ty::Raw(m1, ..), Ty::Raw(m2 @ Mutability::Shared, ..))\n-            | (Ty::Ref(m1, ..), Ty::Ref(m2 @ Mutability::Shared, ..)) => {\n+            (Ty::Raw(m1, ..), Ty::Raw(m2 @ Mutability::Not, ..))\n+            | (Ty::Ref(m1, ..), Ty::Ref(m2 @ Mutability::Not, ..)) => {\n                 *m1 = *m2;\n             }\n             // `&T` -> `*const T`\n             // `&mut T` -> `*mut T`/`*const T`\n-            (Ty::Ref(.., substs), &Ty::Raw(m2 @ Mutability::Shared, ..))\n+            (Ty::Ref(.., substs), &Ty::Raw(m2 @ Mutability::Not, ..))\n             | (Ty::Ref(Mutability::Mut, substs), &Ty::Raw(m2, ..)) => {\n                 from_ty = Ty::Raw(m2, substs.clone());\n             }\n \n             // Illegal mutability conversion\n-            (Ty::Raw(Mutability::Shared, ..), Ty::Raw(Mutability::Mut, ..))\n-            | (Ty::Ref(Mutability::Shared, ..), Ty::Ref(Mutability::Mut, ..)) => return false,\n+            (Ty::Raw(Mutability::Not, ..), Ty::Raw(Mutability::Mut, ..))\n+            | (Ty::Ref(Mutability::Not, ..), Ty::Ref(Mutability::Mut, ..)) => return false,\n \n             // `{function_type}` -> `fn()`\n             (Ty::FnDef(..), Ty::Function { .. }) => match from_ty.callable_sig(self.db) {"}, {"sha": "cf1f1038a9b78246e2e3b732897c9a136b299839", "filename": "crates/hir_ty/src/infer/expr.rs", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Finfer%2Fexpr.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -3,7 +3,7 @@\n use std::iter::{repeat, repeat_with};\n use std::{mem, sync::Arc};\n \n-use chalk_ir::TyVariableKind;\n+use chalk_ir::{Mutability, TyVariableKind};\n use hir_def::{\n     expr::{Array, BinaryOp, Expr, ExprId, Literal, Statement, UnaryOp},\n     path::{GenericArg, GenericArgs},\n@@ -15,12 +15,14 @@ use syntax::ast::RangeOp;\n use test_utils::mark;\n \n use crate::{\n-    autoderef, method_resolution, op,\n+    autoderef,\n+    lower::lower_to_chalk_mutability,\n+    method_resolution, op,\n     primitive::{self, UintTy},\n     traits::{FnTrait, InEnvironment},\n     utils::{generics, variant_data, Generics},\n-    Binders, CallableDefId, FnPointer, FnSig, Mutability, Obligation, OpaqueTyId, Rawness, Scalar,\n-    Substs, TraitRef, Ty,\n+    Binders, CallableDefId, FnPointer, FnSig, Obligation, OpaqueTyId, Rawness, Scalar, Substs,\n+    TraitRef, Ty,\n };\n \n use super::{\n@@ -462,10 +464,11 @@ impl<'a> InferenceContext<'a> {\n                 cast_ty\n             }\n             Expr::Ref { expr, rawness, mutability } => {\n+                let mutability = lower_to_chalk_mutability(*mutability);\n                 let expectation = if let Some((exp_inner, exp_rawness, exp_mutability)) =\n                     &expected.ty.as_reference_or_ptr()\n                 {\n-                    if *exp_mutability == Mutability::Mut && *mutability == Mutability::Shared {\n+                    if *exp_mutability == Mutability::Mut && mutability == Mutability::Not {\n                         // FIXME: throw type error - expected mut reference but found shared ref,\n                         // which cannot be coerced\n                     }\n@@ -479,8 +482,8 @@ impl<'a> InferenceContext<'a> {\n                 };\n                 let inner_ty = self.infer_expr_inner(*expr, &expectation);\n                 match rawness {\n-                    Rawness::RawPtr => Ty::Raw(*mutability, Substs::single(inner_ty)),\n-                    Rawness::Ref => Ty::Ref(*mutability, Substs::single(inner_ty)),\n+                    Rawness::RawPtr => Ty::Raw(mutability, Substs::single(inner_ty)),\n+                    Rawness::Ref => Ty::Ref(mutability, Substs::single(inner_ty)),\n                 }\n             }\n             Expr::Box { expr } => {\n@@ -684,11 +687,11 @@ impl<'a> InferenceContext<'a> {\n             }\n             Expr::Literal(lit) => match lit {\n                 Literal::Bool(..) => Ty::Scalar(Scalar::Bool),\n-                Literal::String(..) => Ty::Ref(Mutability::Shared, Substs::single(Ty::Str)),\n+                Literal::String(..) => Ty::Ref(Mutability::Not, Substs::single(Ty::Str)),\n                 Literal::ByteString(..) => {\n                     let byte_type = Ty::Scalar(Scalar::Uint(UintTy::U8));\n                     let array_type = Ty::Array(Substs::single(byte_type));\n-                    Ty::Ref(Mutability::Shared, Substs::single(array_type))\n+                    Ty::Ref(Mutability::Not, Substs::single(array_type))\n                 }\n                 Literal::Char(..) => Ty::Scalar(Scalar::Char),\n                 Literal::Int(_v, ty) => match ty {"}, {"sha": "eb099311ca79393b173b8cd7f711115e2cf73b2a", "filename": "crates/hir_ty/src/infer/pat.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Finfer%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Finfer%2Fpat.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -3,17 +3,17 @@\n use std::iter::repeat;\n use std::sync::Arc;\n \n+use chalk_ir::Mutability;\n use hir_def::{\n     expr::{BindingAnnotation, Expr, Literal, Pat, PatId, RecordFieldPat},\n     path::Path,\n-    type_ref::Mutability,\n     FieldId,\n };\n use hir_expand::name::Name;\n use test_utils::mark;\n \n use super::{BindingMode, Expectation, InferenceContext};\n-use crate::{utils::variant_data, Substs, Ty};\n+use crate::{lower::lower_to_chalk_mutability, utils::variant_data, Substs, Ty};\n \n impl<'a> InferenceContext<'a> {\n     fn infer_tuple_struct_pat(\n@@ -103,7 +103,7 @@ impl<'a> InferenceContext<'a> {\n                 expected = inner;\n                 default_bm = match default_bm {\n                     BindingMode::Move => BindingMode::Ref(mutability),\n-                    BindingMode::Ref(Mutability::Shared) => BindingMode::Ref(Mutability::Shared),\n+                    BindingMode::Ref(Mutability::Not) => BindingMode::Ref(Mutability::Not),\n                     BindingMode::Ref(Mutability::Mut) => BindingMode::Ref(mutability),\n                 }\n             }\n@@ -152,17 +152,18 @@ impl<'a> InferenceContext<'a> {\n                 }\n             }\n             Pat::Ref { pat, mutability } => {\n+                let mutability = lower_to_chalk_mutability(*mutability);\n                 let expectation = match expected.as_reference() {\n                     Some((inner_ty, exp_mut)) => {\n-                        if *mutability != exp_mut {\n+                        if mutability != exp_mut {\n                             // FIXME: emit type error?\n                         }\n                         inner_ty\n                     }\n                     _ => &Ty::Unknown,\n                 };\n                 let subty = self.infer_pat(*pat, expectation, default_bm);\n-                Ty::Ref(*mutability, Substs::single(subty))\n+                Ty::Ref(mutability, Substs::single(subty))\n             }\n             Pat::TupleStruct { path: p, args: subpats, ellipsis } => self.infer_tuple_struct_pat(\n                 p.as_ref(),"}, {"sha": "c2a20c480d0726eab7973e57abcff0ee8e768c2a", "filename": "crates/hir_ty/src/lib.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Flib.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -27,11 +27,9 @@ use std::{iter, mem, ops::Deref, sync::Arc};\n \n use base_db::salsa;\n use hir_def::{\n-    builtin_type::BuiltinType,\n-    expr::ExprId,\n-    type_ref::{Mutability, Rawness},\n-    AdtId, AssocContainerId, DefWithBodyId, FunctionId, GenericDefId, HasModule, LifetimeParamId,\n-    Lookup, TraitId, TypeAliasId, TypeParamId,\n+    builtin_type::BuiltinType, expr::ExprId, type_ref::Rawness, AdtId, AssocContainerId,\n+    DefWithBodyId, FunctionId, GenericDefId, HasModule, LifetimeParamId, Lookup, TraitId,\n+    TypeAliasId, TypeParamId,\n };\n use itertools::Itertools;\n \n@@ -49,7 +47,7 @@ pub use lower::{\n };\n pub use traits::{InEnvironment, Obligation, ProjectionPredicate, TraitEnvironment};\n \n-pub use chalk_ir::{BoundVar, DebruijnIndex, Scalar, TyVariableKind};\n+pub use chalk_ir::{BoundVar, DebruijnIndex, Mutability, Scalar, TyVariableKind};\n \n #[derive(Clone, PartialEq, Eq, Debug, Hash)]\n pub enum Lifetime {"}, {"sha": "1b5843d48a0357a309c465fac26d69b11e763dbb", "filename": "crates/hir_ty/src/lower.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Flower.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -8,6 +8,7 @@\n use std::{iter, sync::Arc};\n \n use base_db::CrateId;\n+use chalk_ir::Mutability;\n use hir_def::{\n     adt::StructKind,\n     builtin_type::BuiltinType,\n@@ -157,7 +158,7 @@ impl Ty {\n             }\n             TypeRef::RawPtr(inner, mutability) => {\n                 let inner_ty = Ty::from_hir(ctx, inner);\n-                Ty::Raw(*mutability, Substs::single(inner_ty))\n+                Ty::Raw(lower_to_chalk_mutability(*mutability), Substs::single(inner_ty))\n             }\n             TypeRef::Array(inner) => {\n                 let inner_ty = Ty::from_hir(ctx, inner);\n@@ -169,7 +170,7 @@ impl Ty {\n             }\n             TypeRef::Reference(inner, _, mutability) => {\n                 let inner_ty = Ty::from_hir(ctx, inner);\n-                Ty::Ref(*mutability, Substs::single(inner_ty))\n+                Ty::Ref(lower_to_chalk_mutability(*mutability), Substs::single(inner_ty))\n             }\n             TypeRef::Placeholder => Ty::Unknown,\n             TypeRef::Fn(params, is_varargs) => {\n@@ -1259,3 +1260,10 @@ pub(crate) fn return_type_impl_traits(\n         Some(Arc::new(Binders::new(num_binders, return_type_impl_traits)))\n     }\n }\n+\n+pub(crate) fn lower_to_chalk_mutability(m: hir_def::type_ref::Mutability) -> Mutability {\n+    match m {\n+        hir_def::type_ref::Mutability::Shared => Mutability::Not,\n+        hir_def::type_ref::Mutability::Mut => Mutability::Mut,\n+    }\n+}"}, {"sha": "f301a84777e81ccf1503f6e50342c13e34e7e8e2", "filename": "crates/hir_ty/src/method_resolution.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Fmethod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Fmethod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Fmethod_resolution.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -6,9 +6,10 @@ use std::{iter, sync::Arc};\n \n use arrayvec::ArrayVec;\n use base_db::CrateId;\n+use chalk_ir::Mutability;\n use hir_def::{\n-    lang_item::LangItemTarget, type_ref::Mutability, AdtId, AssocContainerId, AssocItemId,\n-    FunctionId, GenericDefId, HasModule, ImplId, Lookup, ModuleId, TraitId, TypeAliasId,\n+    lang_item::LangItemTarget, AdtId, AssocContainerId, AssocItemId, FunctionId, GenericDefId,\n+    HasModule, ImplId, Lookup, ModuleId, TraitId, TypeAliasId,\n };\n use hir_expand::name::Name;\n use rustc_hash::{FxHashMap, FxHashSet};\n@@ -251,7 +252,7 @@ impl Ty {\n             }\n             Ty::Str => lang_item_crate!(\"str_alloc\", \"str\"),\n             Ty::Slice(_) => lang_item_crate!(\"slice_alloc\", \"slice\"),\n-            Ty::Raw(Mutability::Shared, _) => lang_item_crate!(\"const_ptr\"),\n+            Ty::Raw(Mutability::Not, _) => lang_item_crate!(\"const_ptr\"),\n             Ty::Raw(Mutability::Mut, _) => lang_item_crate!(\"mut_ptr\"),\n             Ty::Dyn(_) => {\n                 return self.dyn_trait().and_then(|trait_| {\n@@ -429,7 +430,7 @@ fn iterate_method_candidates_with_autoref(\n     }\n     let refed = Canonical {\n         kinds: deref_chain[0].kinds.clone(),\n-        value: Ty::Ref(Mutability::Shared, Substs::single(deref_chain[0].value.clone())),\n+        value: Ty::Ref(Mutability::Not, Substs::single(deref_chain[0].value.clone())),\n     };\n     if iterate_method_candidates_by_receiver(\n         &refed,"}, {"sha": "db1760e6c566ca7b8084545c48bc5252eb971d75", "filename": "crates/hir_ty/src/traits/chalk/mapping.rs", "status": "modified", "additions": 6, "deletions": 22, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Fmapping.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6ee8e9e7627cdbf39198716234648e1730bfc2d/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Fmapping.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Fmapping.rs?ref=a6ee8e9e7627cdbf39198716234648e1730bfc2d", "patch": "@@ -10,7 +10,7 @@ use chalk_ir::{\n use chalk_solve::rust_ir;\n \n use base_db::salsa::InternKey;\n-use hir_def::{type_ref::Mutability, AssocContainerId, GenericDefId, Lookup, TypeAliasId};\n+use hir_def::{AssocContainerId, GenericDefId, Lookup, TypeAliasId};\n \n use crate::{\n     db::HirDatabase,\n@@ -65,7 +65,7 @@ impl ToChalk for Ty {\n             }\n             Ty::Raw(mutability, substs) => {\n                 let ty = substs[0].clone().to_chalk(db);\n-                chalk_ir::TyKind::Raw(mutability.to_chalk(db), ty).intern(&Interner)\n+                chalk_ir::TyKind::Raw(mutability, ty).intern(&Interner)\n             }\n             Ty::Slice(substs) => {\n                 chalk_ir::TyKind::Slice(substs[0].clone().to_chalk(db)).intern(&Interner)\n@@ -198,11 +198,11 @@ impl ToChalk for Ty {\n                 Ty::Tuple(cardinality, from_chalk(db, subst))\n             }\n             chalk_ir::TyKind::Raw(mutability, ty) => {\n-                Ty::Raw(from_chalk(db, mutability), Substs::single(from_chalk(db, ty)))\n+                Ty::Raw(mutability, Substs::single(from_chalk(db, ty)))\n             }\n             chalk_ir::TyKind::Slice(ty) => Ty::Slice(Substs::single(from_chalk(db, ty))),\n             chalk_ir::TyKind::Ref(mutability, _lifetime, ty) => {\n-                Ty::Ref(from_chalk(db, mutability), Substs::single(from_chalk(db, ty)))\n+                Ty::Ref(mutability, Substs::single(from_chalk(db, ty)))\n             }\n             chalk_ir::TyKind::Str => Ty::Str,\n             chalk_ir::TyKind::Never => Ty::Never,\n@@ -230,12 +230,12 @@ impl ToChalk for Ty {\n /// fake lifetime here, because Chalks built-in logic may expect it to be there.\n fn ref_to_chalk(\n     db: &dyn HirDatabase,\n-    mutability: Mutability,\n+    mutability: chalk_ir::Mutability,\n     subst: Substs,\n ) -> chalk_ir::Ty<Interner> {\n     let arg = subst[0].clone().to_chalk(db);\n     let lifetime = LifetimeData::Static.intern(&Interner);\n-    chalk_ir::TyKind::Ref(mutability.to_chalk(db), lifetime, arg).intern(&Interner)\n+    chalk_ir::TyKind::Ref(mutability, lifetime, arg).intern(&Interner)\n }\n \n /// We currently don't model constants, but Chalk does. So, we have to insert a\n@@ -313,22 +313,6 @@ impl ToChalk for OpaqueTyId {\n     }\n }\n \n-impl ToChalk for Mutability {\n-    type Chalk = chalk_ir::Mutability;\n-    fn to_chalk(self, _db: &dyn HirDatabase) -> Self::Chalk {\n-        match self {\n-            Mutability::Shared => chalk_ir::Mutability::Not,\n-            Mutability::Mut => chalk_ir::Mutability::Mut,\n-        }\n-    }\n-    fn from_chalk(_db: &dyn HirDatabase, chalk: Self::Chalk) -> Self {\n-        match chalk {\n-            chalk_ir::Mutability::Mut => Mutability::Mut,\n-            chalk_ir::Mutability::Not => Mutability::Shared,\n-        }\n-    }\n-}\n-\n impl ToChalk for hir_def::ImplId {\n     type Chalk = ImplId;\n "}]}