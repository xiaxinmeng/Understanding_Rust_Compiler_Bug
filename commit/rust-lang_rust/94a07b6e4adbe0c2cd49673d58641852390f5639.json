{"sha": "94a07b6e4adbe0c2cd49673d58641852390f5639", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0YTA3YjZlNGFkYmUwYzJjZDQ5NjczZDU4NjQxODUyMzkwZjU2Mzk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-02-25T19:10:42Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-02-28T22:59:56Z"}, "message": "Fix leaking non-public 'use' statements with glob imports", "tree": {"sha": "c8d57f4e1d7c08bcc533ee0f369886a6da2df3b5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c8d57f4e1d7c08bcc533ee0f369886a6da2df3b5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94a07b6e4adbe0c2cd49673d58641852390f5639", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94a07b6e4adbe0c2cd49673d58641852390f5639", "html_url": "https://github.com/rust-lang/rust/commit/94a07b6e4adbe0c2cd49673d58641852390f5639", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94a07b6e4adbe0c2cd49673d58641852390f5639/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e1d3a4fb3e2f5b165142adc382de1b226eb688f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e1d3a4fb3e2f5b165142adc382de1b226eb688f7", "html_url": "https://github.com/rust-lang/rust/commit/e1d3a4fb3e2f5b165142adc382de1b226eb688f7"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "e9ed6f382614caba03126db53757d7c62cbc7e40", "filename": "src/librustc/middle/resolve.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/94a07b6e4adbe0c2cd49673d58641852390f5639/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94a07b6e4adbe0c2cd49673d58641852390f5639/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve.rs?ref=94a07b6e4adbe0c2cd49673d58641852390f5639", "patch": "@@ -2480,7 +2480,7 @@ pub impl Resolver {\n \n             // Here we merge two import resolutions.\n             match module_.import_resolutions.find(&ident) {\n-                None => {\n+                None if target_import_resolution.privacy == Public => {\n                     // Simple: just copy the old import resolution.\n                     let new_import_resolution =\n                         @mut ImportResolution(privacy,\n@@ -2494,6 +2494,7 @@ pub impl Resolver {\n                     module_.import_resolutions.insert\n                         (ident, new_import_resolution);\n                 }\n+                None => { /* continue ... */ }\n                 Some(dest_import_resolution) => {\n                     // Merge the two import resolutions at a finer-grained\n                     // level.\n@@ -2756,6 +2757,8 @@ pub impl Resolver {\n                                namespace);\n                     }\n                     Some(target) => {\n+                        debug!(\"(resolving item in lexical scope) using \\\n+                                import resolution\");\n                         import_resolution.state.used = true;\n                         return Success(copy target);\n                     }"}, {"sha": "568baa1e857fc0e53d8bdc5c8a779cfa36a004b5", "filename": "src/test/compile-fail/issue-4366.rs", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/94a07b6e4adbe0c2cd49673d58641852390f5639/src%2Ftest%2Fcompile-fail%2Fissue-4366.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94a07b6e4adbe0c2cd49673d58641852390f5639/src%2Ftest%2Fcompile-fail%2Fissue-4366.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-4366.rs?ref=94a07b6e4adbe0c2cd49673d58641852390f5639", "patch": "@@ -0,0 +1,39 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// regression test for issue 4366\n+\n+// ensures that 'use foo:*' doesn't import non-public 'use' statements in the\n+// module 'foo'\n+\n+mod foo {\n+    pub fn foo() {}\n+}\n+mod a {\n+    pub mod b {\n+        use foo::foo;\n+        type bar = int;\n+    }\n+    pub mod sub {\n+        use a::b::*;\n+        fn sub() -> bar { foo(); 1 } //~ ERROR: unresolved name: foo\n+        //~^ ERROR: unresolved name: bar\n+    }\n+}\n+\n+mod m1 {\n+    fn foo() {}\n+}\n+use m1::*;\n+\n+fn main() {\n+    foo(); //~ ERROR: unresolved name: foo\n+}\n+"}]}