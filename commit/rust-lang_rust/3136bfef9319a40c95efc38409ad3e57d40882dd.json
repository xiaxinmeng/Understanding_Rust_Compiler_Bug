{"sha": "3136bfef9319a40c95efc38409ad3e57d40882dd", "node_id": "C_kwDOAAsO6NoAKDMxMzZiZmVmOTMxOWE0MGM5NWVmYzM4NDA5YWQzZTU3ZDQwODgyZGQ", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-02-09T17:39:28Z"}, "committer": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-03-28T16:31:52Z"}, "message": "Special case the situation where the previous span is the same as the new one", "tree": {"sha": "08e811fb648b2142dc8795789624a335cc5ba17d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/08e811fb648b2142dc8795789624a335cc5ba17d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3136bfef9319a40c95efc38409ad3e57d40882dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3136bfef9319a40c95efc38409ad3e57d40882dd", "html_url": "https://github.com/rust-lang/rust/commit/3136bfef9319a40c95efc38409ad3e57d40882dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3136bfef9319a40c95efc38409ad3e57d40882dd/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5b6510bfb8484a964428fe44e2a66eebb15e66e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5b6510bfb8484a964428fe44e2a66eebb15e66e", "html_url": "https://github.com/rust-lang/rust/commit/d5b6510bfb8484a964428fe44e2a66eebb15e66e"}], "stats": {"total": 42, "additions": 17, "deletions": 25}, "files": [{"sha": "95d1b6a15f51ab8b8f81826dac40bf424071e49d", "filename": "compiler/rustc_typeck/src/collect/type_of.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3136bfef9319a40c95efc38409ad3e57d40882dd/compiler%2Frustc_typeck%2Fsrc%2Fcollect%2Ftype_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3136bfef9319a40c95efc38409ad3e57d40882dd/compiler%2Frustc_typeck%2Fsrc%2Fcollect%2Ftype_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect%2Ftype_of.rs?ref=3136bfef9319a40c95efc38409ad3e57d40882dd", "patch": "@@ -610,7 +610,11 @@ fn find_opaque_ty_constraints(tcx: TyCtxt<'_>, def_id: LocalDefId) -> Ty<'_> {\n                             concrete_type.span,\n                             format!(\"expected `{}`, got `{}`\", prev.ty, concrete_type.ty),\n                         );\n-                        err.span_note(prev.span, \"previous use here\");\n+                        if prev.span == concrete_type.span {\n+                            err.span_label(prev.span, \"this expression supplies two conflicting concrete types for the same opaque type\");\n+                        } else {\n+                            err.span_note(prev.span, \"previous use here\");\n+                        }\n                         err.emit();\n                     }\n                 } else {"}, {"sha": "90d6904ed616468583b6eae338ad399dcb87c3ca", "filename": "src/test/ui/impl-trait/issue-86465.stderr", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-86465.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-86465.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-86465.stderr?ref=3136bfef9319a40c95efc38409ad3e57d40882dd", "patch": "@@ -1,14 +1,11 @@\n error: concrete type differs from previous defining opaque type use\n   --> $DIR/issue-86465.rs:6:5\n    |\n-LL |     (a, a)\n-   |     ^^^^^^ expected `&'a u32`, got `&'b u32`\n-   |\n-note: previous use here\n-  --> $DIR/issue-86465.rs:6:5\n-   |\n LL |     (a, a)\n    |     ^^^^^^\n+   |     |\n+   |     expected `&'a u32`, got `&'b u32`\n+   |     this expression supplies two conflicting concrete types for the same opaque type\n \n error: aborting due to previous error\n "}, {"sha": "2781170091245efb3172f77beab2ee26bed24194", "filename": "src/test/ui/type-alias-impl-trait/multiple-def-uses-in-one-fn-infer.stderr", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn-infer.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn-infer.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn-infer.stderr?ref=3136bfef9319a40c95efc38409ad3e57d40882dd", "patch": "@@ -1,14 +1,11 @@\n error: concrete type differs from previous defining opaque type use\n   --> $DIR/multiple-def-uses-in-one-fn-infer.rs:10:5\n    |\n-LL |     (42_i64, 60)\n-   |     ^^^^^^^^^^^^ expected `i64`, got `i32`\n-   |\n-note: previous use here\n-  --> $DIR/multiple-def-uses-in-one-fn-infer.rs:10:5\n-   |\n LL |     (42_i64, 60)\n    |     ^^^^^^^^^^^^\n+   |     |\n+   |     expected `i64`, got `i32`\n+   |     this expression supplies two conflicting concrete types for the same opaque type\n \n error: aborting due to previous error\n "}, {"sha": "81e603e2355df25bf91be1d04a85bed54ecc77bf", "filename": "src/test/ui/type-alias-impl-trait/multiple-def-uses-in-one-fn-lifetimes.stderr", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn-lifetimes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn-lifetimes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn-lifetimes.stderr?ref=3136bfef9319a40c95efc38409ad3e57d40882dd", "patch": "@@ -1,14 +1,11 @@\n error: concrete type differs from previous defining opaque type use\n   --> $DIR/multiple-def-uses-in-one-fn-lifetimes.rs:6:5\n    |\n-LL |     (i, i)\n-   |     ^^^^^^ expected `&'a i32`, got `&'b i32`\n-   |\n-note: previous use here\n-  --> $DIR/multiple-def-uses-in-one-fn-lifetimes.rs:6:5\n-   |\n LL |     (i, i)\n    |     ^^^^^^\n+   |     |\n+   |     expected `&'a i32`, got `&'b i32`\n+   |     this expression supplies two conflicting concrete types for the same opaque type\n \n error: aborting due to previous error\n "}, {"sha": "0f752212ac9c6c9c10c2e04f3e8b51d7d647c8af", "filename": "src/test/ui/type-alias-impl-trait/multiple-def-uses-in-one-fn2.stderr", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3136bfef9319a40c95efc38409ad3e57d40882dd/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fmultiple-def-uses-in-one-fn2.stderr?ref=3136bfef9319a40c95efc38409ad3e57d40882dd", "patch": "@@ -1,14 +1,11 @@\n error: concrete type differs from previous defining opaque type use\n   --> $DIR/multiple-def-uses-in-one-fn2.rs:10:5\n    |\n-LL |     (a.clone(), a)\n-   |     ^^^^^^^^^^^^^^ expected `A`, got `B`\n-   |\n-note: previous use here\n-  --> $DIR/multiple-def-uses-in-one-fn2.rs:10:5\n-   |\n LL |     (a.clone(), a)\n    |     ^^^^^^^^^^^^^^\n+   |     |\n+   |     expected `A`, got `B`\n+   |     this expression supplies two conflicting concrete types for the same opaque type\n \n error: aborting due to previous error\n "}]}