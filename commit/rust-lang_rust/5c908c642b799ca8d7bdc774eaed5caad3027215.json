{"sha": "5c908c642b799ca8d7bdc774eaed5caad3027215", "node_id": "C_kwDOAAsO6NoAKDVjOTA4YzY0MmI3OTljYThkN2JkYzc3NGVhZWQ1Y2FhZDMwMjcyMTU", "commit": {"author": {"name": "dawnofmidnight", "email": "dawnofmidnight@duck.com", "date": "2022-10-03T03:21:26Z"}, "committer": {"name": "dawnofmidnight", "email": "dawnofmidnight@duck.com", "date": "2022-10-03T03:58:40Z"}, "message": "re-add git-commit-hash file to tarballs\n\nrust-lang/rust#100557 removed the `git-commit-hash` file and replaced it\nwith `git-commit-info`. However, build-manifest relies on the\n`git-commit-hash` file being present, so this adds it back.", "tree": {"sha": "c0e578866dd7647c7eef9a4bbdf67f1376831f06", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0e578866dd7647c7eef9a4bbdf67f1376831f06"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c908c642b799ca8d7bdc774eaed5caad3027215", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c908c642b799ca8d7bdc774eaed5caad3027215", "html_url": "https://github.com/rust-lang/rust/commit/5c908c642b799ca8d7bdc774eaed5caad3027215", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c908c642b799ca8d7bdc774eaed5caad3027215/comments", "author": {"login": "dawnofmidnight", "id": 78233879, "node_id": "MDQ6VXNlcjc4MjMzODc5", "avatar_url": "https://avatars.githubusercontent.com/u/78233879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dawnofmidnight", "html_url": "https://github.com/dawnofmidnight", "followers_url": "https://api.github.com/users/dawnofmidnight/followers", "following_url": "https://api.github.com/users/dawnofmidnight/following{/other_user}", "gists_url": "https://api.github.com/users/dawnofmidnight/gists{/gist_id}", "starred_url": "https://api.github.com/users/dawnofmidnight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dawnofmidnight/subscriptions", "organizations_url": "https://api.github.com/users/dawnofmidnight/orgs", "repos_url": "https://api.github.com/users/dawnofmidnight/repos", "events_url": "https://api.github.com/users/dawnofmidnight/events{/privacy}", "received_events_url": "https://api.github.com/users/dawnofmidnight/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dawnofmidnight", "id": 78233879, "node_id": "MDQ6VXNlcjc4MjMzODc5", "avatar_url": "https://avatars.githubusercontent.com/u/78233879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dawnofmidnight", "html_url": "https://github.com/dawnofmidnight", "followers_url": "https://api.github.com/users/dawnofmidnight/followers", "following_url": "https://api.github.com/users/dawnofmidnight/following{/other_user}", "gists_url": "https://api.github.com/users/dawnofmidnight/gists{/gist_id}", "starred_url": "https://api.github.com/users/dawnofmidnight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dawnofmidnight/subscriptions", "organizations_url": "https://api.github.com/users/dawnofmidnight/orgs", "repos_url": "https://api.github.com/users/dawnofmidnight/repos", "events_url": "https://api.github.com/users/dawnofmidnight/events{/privacy}", "received_events_url": "https://api.github.com/users/dawnofmidnight/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "573fd5a8c52d044e3fcb6bd9b7082046d60526da", "url": "https://api.github.com/repos/rust-lang/rust/commits/573fd5a8c52d044e3fcb6bd9b7082046d60526da", "html_url": "https://github.com/rust-lang/rust/commit/573fd5a8c52d044e3fcb6bd9b7082046d60526da"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "258352a21a4ad76a2bc4582b4ed5dba919b64700", "filename": "src/bootstrap/channel.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5c908c642b799ca8d7bdc774eaed5caad3027215/src%2Fbootstrap%2Fchannel.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c908c642b799ca8d7bdc774eaed5caad3027215/src%2Fbootstrap%2Fchannel.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fchannel.rs?ref=5c908c642b799ca8d7bdc774eaed5caad3027215", "patch": "@@ -150,3 +150,8 @@ pub fn write_commit_info_file(root: &Path, info: &Info) {\n     let commit_info = format!(\"{}\\n{}\\n{}\\n\", info.sha, info.short_sha, info.commit_date);\n     t!(fs::write(root.join(\"git-commit-info\"), &commit_info));\n }\n+\n+/// Write the commit hash to the `git-commit-hash` file given the project root.\n+pub fn write_commit_hash_file(root: &Path, sha: &str) {\n+    t!(fs::write(root.join(\"git-commit-hash\"), sha));\n+}"}, {"sha": "de945398c58b6d9d45407a3b92e6f1111a6bdf92", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5c908c642b799ca8d7bdc774eaed5caad3027215/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c908c642b799ca8d7bdc774eaed5caad3027215/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=5c908c642b799ca8d7bdc774eaed5caad3027215", "patch": "@@ -920,6 +920,7 @@ impl Step for PlainSourceTarball {\n         // Create the version file\n         builder.create(&plain_dst_src.join(\"version\"), &builder.rust_version());\n         if let Some(info) = builder.rust_info.info() {\n+            channel::write_commit_hash_file(&plain_dst_src, &info.sha);\n             channel::write_commit_info_file(&plain_dst_src, info);\n         }\n "}, {"sha": "d999b6c150333617352b7995fd2c16b1420ed236", "filename": "src/bootstrap/tarball.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5c908c642b799ca8d7bdc774eaed5caad3027215/src%2Fbootstrap%2Ftarball.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c908c642b799ca8d7bdc774eaed5caad3027215/src%2Fbootstrap%2Ftarball.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftarball.rs?ref=5c908c642b799ca8d7bdc774eaed5caad3027215", "patch": "@@ -299,6 +299,7 @@ impl<'a> Tarball<'a> {\n         t!(std::fs::create_dir_all(&self.overlay_dir));\n         self.builder.create(&self.overlay_dir.join(\"version\"), &self.overlay.version(self.builder));\n         if let Some(info) = self.builder.rust_info.info() {\n+            channel::write_commit_hash_file(&self.overlay_dir, &info.sha);\n             channel::write_commit_info_file(&self.overlay_dir, info);\n         }\n         for file in self.overlay.legal_and_readme() {"}]}