{"sha": "b32dc91372abf7a9b86a8cddbe490e500aa63969", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzMmRjOTEzNzJhYmY3YTliODZhOGNkZGJlNDkwZTUwMGFhNjM5Njk=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-01-04T01:19:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-04T01:19:52Z"}, "message": "Rollup merge of #67810 - crlf0710:uncommon_codepoints_lint, r=Manishearth\n\nImplement uncommon_codepoints lint.\n\nPart of #55467 .  The checks of `$crate` and `{{root}}` are very unfortunate. But i'm not sure where they belongs to.", "tree": {"sha": "421fa1227e01722cf0a270c6acbbe415eff0e444", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/421fa1227e01722cf0a270c6acbbe415eff0e444"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b32dc91372abf7a9b86a8cddbe490e500aa63969", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeD+g4CRBK7hj4Ov3rIwAAdHIIACPdxzSTeX3rxfjb5ySKyiUv\n4NCtzCIXckRQ2AFl6CcHc+BJqPER4uTMRYqRbuUBjHFALp9PNJmMO1s4eXtylG3X\nAmpSsMavARGHvCw7Wfpq906Au1OmkSjcMZsdkj/d1NdsEn3SJWaR+1rUiNdU/rQ7\n2loRs0y/GJo3Ps9zWL/svqIiOoPARnsTw49hcjJc12u79M8MxQPVXMlP+ApVGOfT\nOqZqIITOsVKWBaBUlNEml9398gEglMd6Hwz3QBQ7JGd3CEn1cBGC1E8JKSNcS+yk\nKIgWnN/U+DFPI+sMPjpLNLHUOpiKG5Vu/+2g1+r4MB4DwbVdqP//OTWrZ3z0NwE=\n=8BXH\n-----END PGP SIGNATURE-----\n", "payload": "tree 421fa1227e01722cf0a270c6acbbe415eff0e444\nparent e72a21408553f551ab1f23691fe0f5e72d19bbf7\nparent 485e98aae2f4d6e7d795eb13170a08407a776fdf\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1578100792 +0100\ncommitter GitHub <noreply@github.com> 1578100792 +0100\n\nRollup merge of #67810 - crlf0710:uncommon_codepoints_lint, r=Manishearth\n\nImplement uncommon_codepoints lint.\n\nPart of #55467 .  The checks of `$crate` and `{{root}}` are very unfortunate. But i'm not sure where they belongs to.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b32dc91372abf7a9b86a8cddbe490e500aa63969", "html_url": "https://github.com/rust-lang/rust/commit/b32dc91372abf7a9b86a8cddbe490e500aa63969", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b32dc91372abf7a9b86a8cddbe490e500aa63969/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e72a21408553f551ab1f23691fe0f5e72d19bbf7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e72a21408553f551ab1f23691fe0f5e72d19bbf7", "html_url": "https://github.com/rust-lang/rust/commit/e72a21408553f551ab1f23691fe0f5e72d19bbf7"}, {"sha": "485e98aae2f4d6e7d795eb13170a08407a776fdf", "url": "https://api.github.com/repos/rust-lang/rust/commits/485e98aae2f4d6e7d795eb13170a08407a776fdf", "html_url": "https://github.com/rust-lang/rust/commit/485e98aae2f4d6e7d795eb13170a08407a776fdf"}], "stats": {"total": 88, "additions": 84, "deletions": 4}, "files": [{"sha": "45a1a169be446528c4d1e2dbdd11bdf6ac0fa6ad", "filename": "Cargo.lock", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b32dc91372abf7a9b86a8cddbe490e500aa63969/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/b32dc91372abf7a9b86a8cddbe490e500aa63969/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=b32dc91372abf7a9b86a8cddbe490e500aa63969", "patch": "@@ -3642,6 +3642,7 @@ dependencies = [\n  \"rustc_span\",\n  \"rustc_target\",\n  \"syntax\",\n+ \"unicode-security\",\n ]\n \n [[package]]\n@@ -4940,6 +4941,21 @@ dependencies = [\n  \"smallvec 1.0.0\",\n ]\n \n+[[package]]\n+name = \"unicode-script\"\n+version = \"0.4.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"5b2c5c29e805da6817f5af6a627d65adb045cebf05cccd5a3493d6109454391c\"\n+\n+[[package]]\n+name = \"unicode-security\"\n+version = \"0.0.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c49d35967fa037b881acc34ef717c38c4b5560eba10e3685271b3f530bb19634\"\n+dependencies = [\n+ \"unicode-script\",\n+]\n+\n [[package]]\n name = \"unicode-segmentation\"\n version = \"1.6.0\""}, {"sha": "a40c5d1697c43394a3ad3087dfe2f0768dbf54db", "filename": "src/librustc_lint/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Flibrustc_lint%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Flibrustc_lint%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2FCargo.toml?ref=b32dc91372abf7a9b86a8cddbe490e500aa63969", "patch": "@@ -10,6 +10,7 @@ path = \"lib.rs\"\n \n [dependencies]\n log = \"0.4\"\n+unicode-security = \"0.0.2\"\n rustc = { path = \"../librustc\" }\n rustc_target = { path = \"../librustc_target\" }\n syntax = { path = \"../libsyntax\" }"}, {"sha": "f30d0bcbdd53fe0eb9c308cb6c34a4b0ccbaac05", "filename": "src/librustc_lint/non_ascii_idents.rs", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Flibrustc_lint%2Fnon_ascii_idents.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Flibrustc_lint%2Fnon_ascii_idents.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fnon_ascii_idents.rs?ref=b32dc91372abf7a9b86a8cddbe490e500aa63969", "patch": "@@ -7,15 +7,32 @@ declare_lint! {\n     \"detects non-ASCII identifiers\"\n }\n \n-declare_lint_pass!(NonAsciiIdents => [NON_ASCII_IDENTS]);\n+declare_lint! {\n+    pub UNCOMMON_CODEPOINTS,\n+    Warn,\n+    \"detects uncommon Unicode codepoints in identifiers\"\n+}\n+\n+declare_lint_pass!(NonAsciiIdents => [NON_ASCII_IDENTS, UNCOMMON_CODEPOINTS]);\n \n impl EarlyLintPass for NonAsciiIdents {\n     fn check_ident(&mut self, cx: &EarlyContext<'_>, ident: ast::Ident) {\n-        if !ident.name.as_str().is_ascii() {\n+        use unicode_security::GeneralSecurityProfile;\n+        let name_str = ident.name.as_str();\n+        if name_str.is_ascii() {\n+            return;\n+        }\n+        cx.struct_span_lint(\n+            NON_ASCII_IDENTS,\n+            ident.span,\n+            \"identifier contains non-ASCII characters\",\n+        )\n+        .emit();\n+        if !name_str.chars().all(GeneralSecurityProfile::identifier_allowed) {\n             cx.struct_span_lint(\n-                NON_ASCII_IDENTS,\n+                UNCOMMON_CODEPOINTS,\n                 ident.span,\n-                \"identifier contains non-ASCII characters\",\n+                \"identifier contains uncommon Unicode codepoints\",\n             )\n             .emit();\n         }"}, {"sha": "87965c204ada7e9f131c0d848a6345cc2b07d90b", "filename": "src/test/ui/issues/issue-48508.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftest%2Fui%2Fissues%2Fissue-48508.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftest%2Fui%2Fissues%2Fissue-48508.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-48508.rs?ref=b32dc91372abf7a9b86a8cddbe490e500aa63969", "patch": "@@ -11,6 +11,7 @@\n // ignore-asmjs wasm2js does not support source maps yet\n \n #![feature(non_ascii_idents)]\n+#[allow(uncommon_codepoints)]\n \n #[path = \"issue-48508-aux.rs\"]\n mod other_file;"}, {"sha": "7ac0d035d5bf1eb146367728ef84c92103f91bdc", "filename": "src/test/ui/lint/rfc-2457-non-ascii-idents/lint-uncommon-codepoints.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftest%2Fui%2Flint%2Frfc-2457-non-ascii-idents%2Flint-uncommon-codepoints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftest%2Fui%2Flint%2Frfc-2457-non-ascii-idents%2Flint-uncommon-codepoints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Frfc-2457-non-ascii-idents%2Flint-uncommon-codepoints.rs?ref=b32dc91372abf7a9b86a8cddbe490e500aa63969", "patch": "@@ -0,0 +1,11 @@\n+#![feature(non_ascii_idents)]\n+#![deny(uncommon_codepoints)]\n+\n+const \u00b5: f64 = 0.000001; //~ ERROR identifier contains uncommon Unicode codepoints\n+\n+fn d\u0133kstra() {} //~ ERROR identifier contains uncommon Unicode codepoints\n+\n+fn main() {\n+    let \u31fb\u31f2\u31f3 = \"rust\"; //~ ERROR identifier contains uncommon Unicode codepoints\n+    println!(\"{}\", \u31fb\u31f2\u31f3); //~ ERROR identifier contains uncommon Unicode codepoints\n+}"}, {"sha": "4580d25665ef9d33f7df47529571a3470e86a632", "filename": "src/test/ui/lint/rfc-2457-non-ascii-idents/lint-uncommon-codepoints.stderr", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftest%2Fui%2Flint%2Frfc-2457-non-ascii-idents%2Flint-uncommon-codepoints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftest%2Fui%2Flint%2Frfc-2457-non-ascii-idents%2Flint-uncommon-codepoints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Frfc-2457-non-ascii-idents%2Flint-uncommon-codepoints.stderr?ref=b32dc91372abf7a9b86a8cddbe490e500aa63969", "patch": "@@ -0,0 +1,32 @@\n+error: identifier contains uncommon Unicode codepoints\n+  --> $DIR/lint-uncommon-codepoints.rs:4:7\n+   |\n+LL | const \u00b5: f64 = 0.000001;\n+   |       ^\n+   |\n+note: lint level defined here\n+  --> $DIR/lint-uncommon-codepoints.rs:2:9\n+   |\n+LL | #![deny(uncommon_codepoints)]\n+   |         ^^^^^^^^^^^^^^^^^^^\n+\n+error: identifier contains uncommon Unicode codepoints\n+  --> $DIR/lint-uncommon-codepoints.rs:6:4\n+   |\n+LL | fn d\u0133kstra() {}\n+   |    ^^^^^^^\n+\n+error: identifier contains uncommon Unicode codepoints\n+  --> $DIR/lint-uncommon-codepoints.rs:9:9\n+   |\n+LL |     let \u31fb\u31f2\u31f3 = \"rust\";\n+   |         ^^^^^^\n+\n+error: identifier contains uncommon Unicode codepoints\n+  --> $DIR/lint-uncommon-codepoints.rs:10:20\n+   |\n+LL |     println!(\"{}\", \u31fb\u31f2\u31f3);\n+   |                    ^^^^^^\n+\n+error: aborting due to 4 previous errors\n+"}, {"sha": "352c00dbe41bd99c6ef7dcb79e74e1d0fd36351a", "filename": "src/tools/tidy/src/deps.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32dc91372abf7a9b86a8cddbe490e500aa63969/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs?ref=b32dc91372abf7a9b86a8cddbe490e500aa63969", "patch": "@@ -171,6 +171,8 @@ const WHITELIST: &[Crate<'_>] = &[\n     Crate(\"thread_local\"),\n     Crate(\"ucd-util\"),\n     Crate(\"unicode-normalization\"),\n+    Crate(\"unicode-script\"),\n+    Crate(\"unicode-security\"),\n     Crate(\"unicode-width\"),\n     Crate(\"unicode-xid\"),\n     Crate(\"unreachable\"),"}]}