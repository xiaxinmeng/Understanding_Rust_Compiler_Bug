{"sha": "84d182c7a2002cd6e511db341ddddcd8ba473105", "node_id": "C_kwDOAAsO6NoAKDg0ZDE4MmM3YTIwMDJjZDZlNTExZGIzNDFkZGRkY2Q4YmE0NzMxMDU", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-09T12:29:31Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-09T12:29:31Z"}, "message": "internal: docs", "tree": {"sha": "b4c215db60eb278462f65d623f62cf7271ee3fcc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4c215db60eb278462f65d623f62cf7271ee3fcc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84d182c7a2002cd6e511db341ddddcd8ba473105", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84d182c7a2002cd6e511db341ddddcd8ba473105", "html_url": "https://github.com/rust-lang/rust/commit/84d182c7a2002cd6e511db341ddddcd8ba473105", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84d182c7a2002cd6e511db341ddddcd8ba473105/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef1251f696b8e8d306e6a1a902502e8d75420118", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef1251f696b8e8d306e6a1a902502e8d75420118", "html_url": "https://github.com/rust-lang/rust/commit/ef1251f696b8e8d306e6a1a902502e8d75420118"}], "stats": {"total": 48, "additions": 30, "deletions": 18}, "files": [{"sha": "cc6551f8aa6e45c0bac4f67d7a5824fc12c0e86d", "filename": "crates/hir_def/src/macro_expansion_tests/mbe.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs?ref=84d182c7a2002cd6e511db341ddddcd8ba473105", "patch": "@@ -1,3 +1,6 @@\n+//! Tests specific to declarative macros, aka macros by example. This covers\n+//! both stable `macro_rules!` macros as well as unstable `macro` macros.\n+\n mod tt_conversion;\n mod matching;\n mod meta_syntax;\n@@ -25,3 +28,21 @@ fn f() { let _ = /* error: could not convert tokens */; }\n \"#]],\n     )\n }\n+\n+#[test]\n+fn wrong_nesting_level() {\n+    check(\n+        r#\"\n+macro_rules! m {\n+    ($($i:ident);*) => ($i)\n+}\n+m!{a}\n+\"#,\n+        expect![[r#\"\n+macro_rules! m {\n+    ($($i:ident);*) => ($i)\n+}\n+/* error: expected simple binding, found nested binding `i` */\n+\"#]],\n+    );\n+}"}, {"sha": "11317cfa9d5b40014185283bee17fa170f4783cc", "filename": "crates/hir_def/src/macro_expansion_tests/mbe/matching.rs", "status": "modified", "additions": 2, "deletions": 18, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmatching.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmatching.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmatching.rs?ref=84d182c7a2002cd6e511db341ddddcd8ba473105", "patch": "@@ -1,3 +1,5 @@\n+//! Test that `$var:expr` captures function correctly.\n+\n use expect_test::expect;\n \n use crate::macro_expansion_tests::check;\n@@ -21,21 +23,3 @@ literal!()\n \"#]],\n     )\n }\n-\n-#[test]\n-fn wrong_nesting_level() {\n-    check(\n-        r#\"\n-macro_rules! m {\n-    ($($i:ident);*) => ($i)\n-}\n-m!{a}\n-\"#,\n-        expect![[r#\"\n-macro_rules! m {\n-    ($($i:ident);*) => ($i)\n-}\n-/* error: expected simple binding, found nested binding `i` */\n-\"#]],\n-    );\n-}"}, {"sha": "4249c2507e9a1e7461833fa325c38101a7591276", "filename": "crates/hir_def/src/macro_expansion_tests/mbe/meta_syntax.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmeta_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmeta_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmeta_syntax.rs?ref=84d182c7a2002cd6e511db341ddddcd8ba473105", "patch": "@@ -1,3 +1,5 @@\n+//! Test for the syntax of macros themselves.\n+\n use expect_test::expect;\n \n use crate::macro_expansion_tests::check;"}, {"sha": "a24fe9bee2c74ce40ba7ee8fa955874e97392b66", "filename": "crates/hir_def/src/macro_expansion_tests/mbe/tt_conversion.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84d182c7a2002cd6e511db341ddddcd8ba473105/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs?ref=84d182c7a2002cd6e511db341ddddcd8ba473105", "patch": "@@ -1,3 +1,8 @@\n+//! Unlike rustc, rust-analyzer's syntax tree are not \"made of\" token trees.\n+//! Rather, token trees are an explicit bridge between the parser and\n+//! (procedural or declarative) macros.\n+//!\n+//! This module tests tt <-> syntax tree conversion specifically\n use expect_test::expect;\n \n use crate::macro_expansion_tests::check;"}]}