{"sha": "735e518a815bd06fa99ea343351041ba22751fe4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczNWU1MThhODE1YmQwNmZhOTllYTM0MzM1MTA0MWJhMjI3NTFmZTQ=", "commit": {"author": {"name": "Luqman Aden", "email": "laden@csclub.uwaterloo.ca", "date": "2014-06-05T22:06:33Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-06-07T02:51:17Z"}, "message": "librustc: Update AutoObject adjustment in writeback.", "tree": {"sha": "f545bc3d0447bfbaff1cf6cf61f916772a40834c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f545bc3d0447bfbaff1cf6cf61f916772a40834c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/735e518a815bd06fa99ea343351041ba22751fe4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/735e518a815bd06fa99ea343351041ba22751fe4", "html_url": "https://github.com/rust-lang/rust/commit/735e518a815bd06fa99ea343351041ba22751fe4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/735e518a815bd06fa99ea343351041ba22751fe4/comments", "author": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f35328caed68528380cf5f19e4c04eba70f03638", "url": "https://api.github.com/repos/rust-lang/rust/commits/f35328caed68528380cf5f19e4c04eba70f03638", "html_url": "https://github.com/rust-lang/rust/commit/f35328caed68528380cf5f19e4c04eba70f03638"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "e488a946d4a14deae9248086f154691fd8d7c040", "filename": "src/librustc/middle/typeck/check/regionck.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/735e518a815bd06fa99ea343351041ba22751fe4/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/735e518a815bd06fa99ea343351041ba22751fe4/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs?ref=735e518a815bd06fa99ea343351041ba22751fe4", "patch": "@@ -432,7 +432,7 @@ fn visit_expr(rcx: &mut Rcx, expr: &ast::Expr) {\n                 // function check_cast_for_escaping_regions() in kind.rs\n                 // explaining how it goes about doing that.\n \n-                let source_ty = rcx.fcx.expr_ty(expr);\n+                let source_ty = rcx.resolve_node_type(expr.id);\n                 constrain_regions_in_type(rcx, trait_region,\n                                             infer::RelateObjectBound(expr.span), source_ty);\n             }"}, {"sha": "b93550384ae3b1483b51bc91d8f58ced9ed48f5f", "filename": "src/librustc/middle/typeck/check/writeback.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/735e518a815bd06fa99ea343351041ba22751fe4/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fwriteback.rs", "raw_url": "https://github.com/rust-lang/rust/raw/735e518a815bd06fa99ea343351041ba22751fe4/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fwriteback.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fwriteback.rs?ref=735e518a815bd06fa99ea343351041ba22751fe4", "patch": "@@ -260,7 +260,14 @@ impl<'cx> WritebackCx<'cx> {\n                         })\n                     }\n \n-                    adjustment => adjustment\n+                    ty::AutoObject(trait_store, bb, def_id, substs) => {\n+                        ty::AutoObject(\n+                            self.resolve(&trait_store, reason),\n+                            self.resolve(&bb, reason),\n+                            def_id,\n+                            self.resolve(&substs, reason)\n+                        )\n+                    }\n                 };\n                 debug!(\"Adjustments for node {}: {:?}\", id, resolved_adjustment);\n                 self.tcx().adjustments.borrow_mut().insert("}, {"sha": "5fb2274a446fe216dfada9259caa9d28925ac8de", "filename": "src/test/run-pass/issue-11612.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/735e518a815bd06fa99ea343351041ba22751fe4/src%2Ftest%2Frun-pass%2Fissue-11612.rs", "raw_url": "https://github.com/rust-lang/rust/raw/735e518a815bd06fa99ea343351041ba22751fe4/src%2Ftest%2Frun-pass%2Fissue-11612.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-11612.rs?ref=735e518a815bd06fa99ea343351041ba22751fe4", "patch": "@@ -0,0 +1,30 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// #11612\n+// We weren't updating the auto adjustments with all the resolved\n+// type information after type check.\n+\n+trait A {}\n+\n+struct B<'a, T> {\n+    f: &'a T\n+}\n+\n+impl<'a, T> A for B<'a, T> {}\n+\n+fn foo(_: &A) {}\n+\n+fn bar<G>(b: &B<G>) {\n+    foo(b);       // Coercion should work\n+    foo(b as &A); // Explicit cast should work as well\n+}\n+\n+fn main() {}"}]}