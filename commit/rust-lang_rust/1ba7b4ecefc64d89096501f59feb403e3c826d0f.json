{"sha": "1ba7b4ecefc64d89096501f59feb403e3c826d0f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiYTdiNGVjZWZjNjRkODkwOTY1MDFmNTlmZWI0MDNlM2M4MjZkMGY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-21T04:01:37Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-21T04:01:37Z"}, "message": "Auto merge of #65630 - ecstatic-morse:graphviz-tidy, r=Mark-Simulacrum\n\nCheck all files in `src/test` for `borrowck_graphviz_postflow`\n\nThis attribute causes DOT files to be generated in the top-level directory. It is intended to be used only temporarily and should never appear on master. This also tells git to ignore DOT files in the root or the  `mir_dump` directory, which `-Z dump-mir` uses by default.\n\nThis will prevent #65071 from occurring again. It needs to be merged after #65629, otherwise `tidy` will start failing.\n\nr? @Mark-Simulacrum", "tree": {"sha": "8b7f6822b1649df99cc1758c2c9c435b5205058a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b7f6822b1649df99cc1758c2c9c435b5205058a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ba7b4ecefc64d89096501f59feb403e3c826d0f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ba7b4ecefc64d89096501f59feb403e3c826d0f", "html_url": "https://github.com/rust-lang/rust/commit/1ba7b4ecefc64d89096501f59feb403e3c826d0f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ba7b4ecefc64d89096501f59feb403e3c826d0f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "770b9e3012bd58bdf6046d328dabfd57df163eb6", "url": "https://api.github.com/repos/rust-lang/rust/commits/770b9e3012bd58bdf6046d328dabfd57df163eb6", "html_url": "https://github.com/rust-lang/rust/commit/770b9e3012bd58bdf6046d328dabfd57df163eb6"}, {"sha": "efcae577bf5ebf503a702c7e66c2924ddb53cdb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/efcae577bf5ebf503a702c7e66c2924ddb53cdb8", "html_url": "https://github.com/rust-lang/rust/commit/efcae577bf5ebf503a702c7e66c2924ddb53cdb8"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "1c47ed4c024822730874b26588ad7e45b9fdf947", "filename": ".gitignore", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1ba7b4ecefc64d89096501f59feb403e3c826d0f/.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/1ba7b4ecefc64d89096501f59feb403e3c826d0f/.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.gitignore?ref=1ba7b4ecefc64d89096501f59feb403e3c826d0f", "patch": "@@ -52,3 +52,6 @@ config.stamp\n Session.vim\n .cargo\n no_llvm_build\n+# Generated when dumping Graphviz output for debugging:\n+/mir_dump/\n+/*.dot"}, {"sha": "ee555a3e5bda764a0500d82d80e00462f6cc6f05", "filename": "src/tools/tidy/src/debug_artifacts.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/1ba7b4ecefc64d89096501f59feb403e3c826d0f/src%2Ftools%2Ftidy%2Fsrc%2Fdebug_artifacts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ba7b4ecefc64d89096501f59feb403e3c826d0f/src%2Ftools%2Ftidy%2Fsrc%2Fdebug_artifacts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdebug_artifacts.rs?ref=1ba7b4ecefc64d89096501f59feb403e3c826d0f", "patch": "@@ -0,0 +1,24 @@\n+//! Tidy check to prevent creation of unnecessary debug artifacts.\n+\n+use std::path::{Path, PathBuf};\n+\n+const GRAPHVIZ_POSTFLOW_MSG: &'static str =\n+    \"`borrowck_graphviz_postflow` attribute in test\";\n+\n+pub fn check(path: &Path, bad: &mut bool) {\n+    let test_dir: PathBuf = path.join(\"test\");\n+\n+    super::walk(&test_dir, &mut super::filter_dirs, &mut |entry, contents| {\n+        let filename = entry.path();\n+        let is_rust = filename.extension().map_or(false, |ext| ext == \"rs\");\n+        if !is_rust {\n+            return;\n+        }\n+\n+        for (i, line) in contents.lines().enumerate() {\n+            if line.contains(\"borrowck_graphviz_postflow\") {\n+                tidy_error!(bad, \"{}:{}: {}\", filename.display(), i + 1, GRAPHVIZ_POSTFLOW_MSG);\n+            }\n+        }\n+    });\n+}"}, {"sha": "c76cc4cff7f87378f084a2a9635c4018fc1df3a0", "filename": "src/tools/tidy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ba7b4ecefc64d89096501f59feb403e3c826d0f/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ba7b4ecefc64d89096501f59feb403e3c826d0f/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs?ref=1ba7b4ecefc64d89096501f59feb403e3c826d0f", "patch": "@@ -31,6 +31,7 @@ macro_rules! tidy_error {\n \n pub mod bins;\n pub mod style;\n+pub mod debug_artifacts;\n pub mod errors;\n pub mod features;\n pub mod cargo;"}, {"sha": "de6b0c5b28d9de31674a7d353a03167dd87b49c1", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ba7b4ecefc64d89096501f59feb403e3c826d0f/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ba7b4ecefc64d89096501f59feb403e3c826d0f/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=1ba7b4ecefc64d89096501f59feb403e3c826d0f", "patch": "@@ -22,6 +22,7 @@ fn main() {\n     let verbose = args.iter().any(|s| *s == \"--verbose\");\n     bins::check(&path, &mut bad);\n     style::check(&path, &mut bad);\n+    debug_artifacts::check(&path, &mut bad);\n     errors::check(&path, &mut bad);\n     cargo::check(&path, &mut bad);\n     edition::check(&path, &mut bad);"}]}