{"sha": "3a59b56324db99475ea2027cb94f82785b16ad14", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhNTliNTYzMjRkYjk5NDc1ZWEyMDI3Y2I5NGY4Mjc4NWIxNmFkMTQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-07-26T18:28:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-26T18:28:32Z"}, "message": "Merge #9702\n\n9702: minor: Simplify r=Veykril a=Veykril\n\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "ca36677c8882ee665cc6664c038217194268b694", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ca36677c8882ee665cc6664c038217194268b694"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a59b56324db99475ea2027cb94f82785b16ad14", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg/v7QCRBK7hj4Ov3rIwAAqCsIAF3eUa2nRuTd8xiFTGf4sUiK\n+pJr1amtQ/jbiLxH7M5JO0RsbPmF7UQs91sJ0L+wfOynJOdOIexucFTyKSV6S5Zw\naJL3OCbQCZncnc25jdvu0vcXwCLnwLJwqNVNmNSymiUvV/Mi8Ckvcoe6oiTK8Wsh\nNuKsDXG48juM5PwSngtpSFOGOvL5FarlqvM3RCn51X3mNjWG3Zy4AkUVmodCbNUI\nnOJYOk3J2SpiKT2NH3DAAUnlgBo6DUcwZKRa7RCQw1UAaJzxCJjMiNNgU0tQtyLu\nbLGs1J1+OOKq01hss/ErpwejoIAk6JJV9lNM8kYDEVLLmZqi6/aXVqEmzOGzePE=\n=Jtgd\n-----END PGP SIGNATURE-----\n", "payload": "tree ca36677c8882ee665cc6664c038217194268b694\nparent e6bae220b7129790805a0689ed1a2f2a2c47aeb4\nparent 3fab50019c0e19fbd06891c83038b1593ba7901a\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1627324112 +0000\ncommitter GitHub <noreply@github.com> 1627324112 +0000\n\nMerge #9702\n\n9702: minor: Simplify r=Veykril a=Veykril\n\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a59b56324db99475ea2027cb94f82785b16ad14", "html_url": "https://github.com/rust-lang/rust/commit/3a59b56324db99475ea2027cb94f82785b16ad14", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a59b56324db99475ea2027cb94f82785b16ad14/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6bae220b7129790805a0689ed1a2f2a2c47aeb4", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6bae220b7129790805a0689ed1a2f2a2c47aeb4", "html_url": "https://github.com/rust-lang/rust/commit/e6bae220b7129790805a0689ed1a2f2a2c47aeb4"}, {"sha": "3fab50019c0e19fbd06891c83038b1593ba7901a", "url": "https://api.github.com/repos/rust-lang/rust/commits/3fab50019c0e19fbd06891c83038b1593ba7901a", "html_url": "https://github.com/rust-lang/rust/commit/3fab50019c0e19fbd06891c83038b1593ba7901a"}], "stats": {"total": 22, "additions": 10, "deletions": 12}, "files": [{"sha": "40e570bbbaeee0db442ecadd1713e3f8900f3ec3", "filename": "crates/ide/src/doc_links.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fdoc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fdoc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdoc_links.rs?ref=3a59b56324db99475ea2027cb94f82785b16ad14", "patch": "@@ -24,6 +24,7 @@ use crate::{\n     FilePosition, Semantics,\n };\n \n+/// Weblink to an item's documentation.\n pub(crate) type DocumentationLink = String;\n \n /// Rewrite documentation links in markdown to point to an online host (e.g. docs.rs)"}, {"sha": "ca22b10dfcb53edda387d21e13ebca94eb0568b8", "filename": "crates/ide/src/goto_definition.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fgoto_definition.rs?ref=3a59b56324db99475ea2027cb94f82785b16ad14", "patch": "@@ -43,11 +43,10 @@ pub(crate) fn goto_definition(\n     let parent = token.parent()?;\n     if let Some(_) = ast::Comment::cast(token.clone()) {\n         let (attributes, def) = doc_attributes(&sema, &parent)?;\n-\n         let (docs, doc_mapping) = attributes.docs_with_rangemap(db)?;\n         let (_, link, ns) =\n-            extract_definitions_from_docs(&docs).into_iter().find(|(range, ..)| {\n-                doc_mapping.map(*range).map_or(false, |InFile { file_id, value: range }| {\n+            extract_definitions_from_docs(&docs).into_iter().find(|&(range, ..)| {\n+                doc_mapping.map(range).map_or(false, |InFile { file_id, value: range }| {\n                     file_id == position.file_id.into() && range.contains(position.offset)\n                 })\n             })?;"}, {"sha": "35601f2efc7a0d9df7d43c1b99d1dcbd7879c1bf", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=3a59b56324db99475ea2027cb94f82785b16ad14", "patch": "@@ -120,12 +120,8 @@ pub(crate) fn hover(\n                     let (docs, doc_mapping) = attributes.docs_with_rangemap(db)?;\n                     let (idl_range, link, ns) =\n                         extract_definitions_from_docs(&docs).into_iter().find_map(|(range, link, ns)| {\n-                            let hir::InFile { file_id, value: range } = doc_mapping.map(range)?;\n-                            if file_id == position.file_id.into() && range.contains(position.offset) {\n-                                Some((range, link, ns))\n-                            } else {\n-                                None\n-                            }\n+                            let hir::InFile { file_id, value: mapped_range } = doc_mapping.map(range)?;\n+                            (file_id == position.file_id.into() && mapped_range.contains(position.offset)).then(||(mapped_range, link, ns))\n                         })?;\n                     range = Some(idl_range);\n                     resolve_doc_path_for_def(db, def, &link, ns).map(Definition::ModuleDef)"}, {"sha": "7c9fd46fc57958563e2afb2368c52d176b91c46b", "filename": "crates/ide/src/syntax_highlighting/inject.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Finject.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a59b56324db99475ea2027cb94f82785b16ad14/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Finject.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Finject.rs?ref=3a59b56324db99475ea2027cb94f82785b16ad14", "patch": "@@ -107,9 +107,11 @@ pub(super) fn doc_comment(\n         extract_definitions_from_docs(&docs)\n             .into_iter()\n             .filter_map(|(range, link, ns)| {\n-                let def = resolve_doc_path_for_def(sema.db, def, &link, ns)?;\n-                let InFile { file_id, value: range } = doc_mapping.map(range)?;\n-                (file_id == node.file_id).then(|| (range, def))\n+                doc_mapping.map(range).filter(|mapping| mapping.file_id == node.file_id).and_then(\n+                    |InFile { value: mapped_range, .. }| {\n+                        Some(mapped_range).zip(resolve_doc_path_for_def(sema.db, def, &link, ns))\n+                    },\n+                )\n             })\n             .for_each(|(range, def)| {\n                 hl.add(HlRange {"}]}