{"sha": "47f291ec2d9d6e4820cca517e69b3efddec40c20", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3ZjI5MWVjMmQ5ZDZlNDgyMGNjYTUxN2U2OWIzZWZkZGVjNDBjMjA=", "commit": {"author": {"name": "Jakub Kulik", "email": "kulikjak@gmail.com", "date": "2021-02-19T10:50:30Z"}, "committer": {"name": "Jakub Kulik", "email": "kulikjak@gmail.com", "date": "2021-03-01T14:06:32Z"}, "message": "Update Docker to use the correct target", "tree": {"sha": "fee4d7ec140c020601ee07bbc55e856a70a2383f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fee4d7ec140c020601ee07bbc55e856a70a2383f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47f291ec2d9d6e4820cca517e69b3efddec40c20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47f291ec2d9d6e4820cca517e69b3efddec40c20", "html_url": "https://github.com/rust-lang/rust/commit/47f291ec2d9d6e4820cca517e69b3efddec40c20", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47f291ec2d9d6e4820cca517e69b3efddec40c20/comments", "author": {"login": "kulikjak", "id": 18516837, "node_id": "MDQ6VXNlcjE4NTE2ODM3", "avatar_url": "https://avatars.githubusercontent.com/u/18516837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kulikjak", "html_url": "https://github.com/kulikjak", "followers_url": "https://api.github.com/users/kulikjak/followers", "following_url": "https://api.github.com/users/kulikjak/following{/other_user}", "gists_url": "https://api.github.com/users/kulikjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/kulikjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kulikjak/subscriptions", "organizations_url": "https://api.github.com/users/kulikjak/orgs", "repos_url": "https://api.github.com/users/kulikjak/repos", "events_url": "https://api.github.com/users/kulikjak/events{/privacy}", "received_events_url": "https://api.github.com/users/kulikjak/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kulikjak", "id": 18516837, "node_id": "MDQ6VXNlcjE4NTE2ODM3", "avatar_url": "https://avatars.githubusercontent.com/u/18516837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kulikjak", "html_url": "https://github.com/kulikjak", "followers_url": "https://api.github.com/users/kulikjak/followers", "following_url": "https://api.github.com/users/kulikjak/following{/other_user}", "gists_url": "https://api.github.com/users/kulikjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/kulikjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kulikjak/subscriptions", "organizations_url": "https://api.github.com/users/kulikjak/orgs", "repos_url": "https://api.github.com/users/kulikjak/repos", "events_url": "https://api.github.com/users/kulikjak/events{/privacy}", "received_events_url": "https://api.github.com/users/kulikjak/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3226accbeb3ec34e10a4001af96278a37651b34", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3226accbeb3ec34e10a4001af96278a37651b34", "html_url": "https://github.com/rust-lang/rust/commit/c3226accbeb3ec34e10a4001af96278a37651b34"}], "stats": {"total": 39, "additions": 26, "deletions": 13}, "files": [{"sha": "7bb3cb14516887c7ea9171ea442c3c8deddff76a", "filename": "src/ci/docker/host-x86_64/dist-various-2/Dockerfile", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/47f291ec2d9d6e4820cca517e69b3efddec40c20/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/47f291ec2d9d6e4820cca517e69b3efddec40c20/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile?ref=47f291ec2d9d6e4820cca517e69b3efddec40c20", "patch": "@@ -39,9 +39,9 @@ ENV \\\n     AR_sparcv9_sun_solaris=sparcv9-sun-solaris2.10-ar \\\n     CC_sparcv9_sun_solaris=sparcv9-sun-solaris2.10-gcc \\\n     CXX_sparcv9_sun_solaris=sparcv9-sun-solaris2.10-g++ \\\n-    AR_x86_64_sun_solaris=x86_64-sun-solaris2.10-ar \\\n-    CC_x86_64_sun_solaris=x86_64-sun-solaris2.10-gcc \\\n-    CXX_x86_64_sun_solaris=x86_64-sun-solaris2.10-g++ \\\n+    AR_x86_64_pc_solaris=x86_64-pc-solaris2.10-ar \\\n+    CC_x86_64_pc_solaris=x86_64-pc-solaris2.10-gcc \\\n+    CXX_x86_64_pc_solaris=x86_64-pc-solaris2.10-g++ \\\n     CC_armv7_unknown_linux_gnueabi=arm-linux-gnueabi-gcc-8 \\\n     CXX_armv7_unknown_linux_gnueabi=arm-linux-gnueabi-g++-8 \\\n     AR_x86_64_fortanix_unknown_sgx=ar \\\n@@ -100,7 +100,7 @@ ENV TARGETS=$TARGETS,aarch64-fuchsia\n ENV TARGETS=$TARGETS,wasm32-unknown-unknown\n ENV TARGETS=$TARGETS,wasm32-wasi\n ENV TARGETS=$TARGETS,sparcv9-sun-solaris\n-ENV TARGETS=$TARGETS,x86_64-sun-solaris\n+ENV TARGETS=$TARGETS,x86_64-pc-solaris\n ENV TARGETS=$TARGETS,x86_64-unknown-linux-gnux32\n ENV TARGETS=$TARGETS,x86_64-fortanix-unknown-sgx\n ENV TARGETS=$TARGETS,nvptx64-nvidia-cuda"}, {"sha": "ee76fafb1f94812c96f11bdb354c7648048f28ee", "filename": "src/ci/docker/host-x86_64/dist-various-2/build-solaris-toolchain.sh", "status": "modified", "additions": 21, "deletions": 8, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/47f291ec2d9d6e4820cca517e69b3efddec40c20/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fbuild-solaris-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/47f291ec2d9d6e4820cca517e69b3efddec40c20/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fbuild-solaris-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fbuild-solaris-toolchain.sh?ref=47f291ec2d9d6e4820cca517e69b3efddec40c20", "patch": "@@ -9,14 +9,27 @@ APT_ARCH=$3\n BINUTILS=2.28.1\n GCC=6.5.0\n \n+# Choose correct target based on the $ARCH\n+case \"$ARCH\" in\n+x86_64)\n+  TARGET=x86_64-pc-solaris2.10\n+  ;;\n+sparcv9)\n+  TARGET=sparcv9-sun-solaris2.10\n+  ;;\n+*)\n+  printf 'ERROR: unknown architecture: %s\\n' \"$ARCH\"\n+  exit 1\n+esac\n+\n # First up, build binutils\n mkdir binutils\n cd binutils\n \n curl https://ftp.gnu.org/gnu/binutils/binutils-$BINUTILS.tar.xz | tar xJf -\n mkdir binutils-build\n cd binutils-build\n-hide_output ../binutils-$BINUTILS/configure --target=$ARCH-sun-solaris2.10\n+hide_output ../binutils-$BINUTILS/configure --target=$TARGET\n hide_output make -j10\n hide_output make install\n \n@@ -62,13 +75,13 @@ patch -p0  << 'EOF'\n -extern size_t strnlen(const char *, size_t);\n EOF\n \n-mkdir                  /usr/local/$ARCH-sun-solaris2.10/usr\n-mv usr/include         /usr/local/$ARCH-sun-solaris2.10/usr/include\n-mv usr/lib/$LIB_ARCH/* /usr/local/$ARCH-sun-solaris2.10/lib\n-mv     lib/$LIB_ARCH/* /usr/local/$ARCH-sun-solaris2.10/lib\n+mkdir                  /usr/local/$TARGET/usr\n+mv usr/include         /usr/local/$TARGET/usr/include\n+mv usr/lib/$LIB_ARCH/* /usr/local/$TARGET/lib\n+mv     lib/$LIB_ARCH/* /usr/local/$TARGET/lib\n \n-ln -s usr/include /usr/local/$ARCH-sun-solaris2.10/sys-include\n-ln -s usr/include /usr/local/$ARCH-sun-solaris2.10/include\n+ln -s usr/include /usr/local/$TARGET/sys-include\n+ln -s usr/include /usr/local/$TARGET/include\n \n cd ..\n rm -rf solaris\n@@ -84,7 +97,7 @@ mkdir ../gcc-build\n cd ../gcc-build\n hide_output ../gcc-$GCC/configure \\\n   --enable-languages=c,c++        \\\n-  --target=$ARCH-sun-solaris2.10  \\\n+  --target=$TARGET                \\\n   --with-gnu-as                   \\\n   --with-gnu-ld                   \\\n   --disable-multilib              \\"}, {"sha": "3f1d5f3426abf4ca5a60c45a25c7f0559b857528", "filename": "src/ci/docker/scripts/illumos-toolchain.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/47f291ec2d9d6e4820cca517e69b3efddec40c20/src%2Fci%2Fdocker%2Fscripts%2Fillumos-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/47f291ec2d9d6e4820cca517e69b3efddec40c20/src%2Fci%2Fdocker%2Fscripts%2Fillumos-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fillumos-toolchain.sh?ref=47f291ec2d9d6e4820cca517e69b3efddec40c20", "patch": "@@ -18,7 +18,7 @@ x86_64)\n         exit 1\n esac\n \n-BUILD_TARGET=\"$ARCH-sun-solaris2.10\"\n+BUILD_TARGET=\"$ARCH-pc-solaris2.10\"\n \n #\n # The illumos and the Solaris build both use the same GCC-level host triple,"}]}