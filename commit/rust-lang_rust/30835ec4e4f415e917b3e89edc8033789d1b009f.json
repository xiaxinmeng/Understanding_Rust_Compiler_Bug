{"sha": "30835ec4e4f415e917b3e89edc8033789d1b009f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwODM1ZWM0ZTRmNDE1ZTkxN2IzZTg5ZWRjODAzMzc4OWQxYjAwOWY=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2016-08-27T04:01:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-27T04:01:15Z"}, "message": "Rollup merge of #36005 - apasel422:traitobj, r=alexcrichton\n\nReplace unnecessary uses of `TraitObject` with casts\n\nr? @alexcrichton", "tree": {"sha": "f708d72391df676805df764884027173b7c9942a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f708d72391df676805df764884027173b7c9942a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30835ec4e4f415e917b3e89edc8033789d1b009f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30835ec4e4f415e917b3e89edc8033789d1b009f", "html_url": "https://github.com/rust-lang/rust/commit/30835ec4e4f415e917b3e89edc8033789d1b009f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30835ec4e4f415e917b3e89edc8033789d1b009f/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "933d481bdd1ad64804173e09a257dc46535d333e", "url": "https://api.github.com/repos/rust-lang/rust/commits/933d481bdd1ad64804173e09a257dc46535d333e", "html_url": "https://github.com/rust-lang/rust/commit/933d481bdd1ad64804173e09a257dc46535d333e"}, {"sha": "2b10df7f24828b09759277cc3a9c18c493c38ce0", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b10df7f24828b09759277cc3a9c18c493c38ce0", "html_url": "https://github.com/rust-lang/rust/commit/2b10df7f24828b09759277cc3a9c18c493c38ce0"}], "stats": {"total": 47, "additions": 9, "deletions": 38}, "files": [{"sha": "c8a78f84f185768fde245c014c5d9bf29559833a", "filename": "src/liballoc/boxed.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Fliballoc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Fliballoc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fboxed.rs?ref=30835ec4e4f415e917b3e89edc8033789d1b009f", "patch": "@@ -67,7 +67,6 @@ use core::mem;\n use core::ops::{CoerceUnsized, Deref, DerefMut};\n use core::ops::{BoxPlace, Boxed, InPlace, Place, Placer};\n use core::ptr::{self, Unique};\n-use core::raw::TraitObject;\n use core::convert::From;\n \n /// A value that represents the heap. This is the default place that the `box`\n@@ -428,12 +427,8 @@ impl Box<Any> {\n     pub fn downcast<T: Any>(self) -> Result<Box<T>, Box<Any>> {\n         if self.is::<T>() {\n             unsafe {\n-                // Get the raw representation of the trait object\n-                let raw = Box::into_raw(self);\n-                let to: TraitObject = mem::transmute::<*mut Any, TraitObject>(raw);\n-\n-                // Extract the data pointer\n-                Ok(Box::from_raw(to.data as *mut T))\n+                let raw: *mut Any = Box::into_raw(self);\n+                Ok(Box::from_raw(raw as *mut T))\n             }\n         } else {\n             Err(self)"}, {"sha": "c6453da3f4697d5f660634cf59a088a4197059ea", "filename": "src/liballoc/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Fliballoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Fliballoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Flib.rs?ref=30835ec4e4f415e917b3e89edc8033789d1b009f", "patch": "@@ -91,7 +91,7 @@\n #![cfg_attr(stage0, feature(unsafe_no_drop_flag))]\n #![feature(unsize)]\n \n-#![cfg_attr(not(test), feature(fused, raw, fn_traits, placement_new_protocol))]\n+#![cfg_attr(not(test), feature(fused, fn_traits, placement_new_protocol))]\n #![cfg_attr(test, feature(test, box_heap))]\n \n // Allow testing this library"}, {"sha": "a3018a46eea22063545331e6937609597a98654d", "filename": "src/libcore/any.rs", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Flibcore%2Fany.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Flibcore%2Fany.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fany.rs?ref=30835ec4e4f415e917b3e89edc8033789d1b009f", "patch": "@@ -72,8 +72,6 @@\n #![stable(feature = \"rust1\", since = \"1.0.0\")]\n \n use fmt;\n-use mem::transmute;\n-use raw::TraitObject;\n use intrinsics;\n use marker::Reflect;\n \n@@ -199,11 +197,7 @@ impl Any {\n     pub fn downcast_ref<T: Any>(&self) -> Option<&T> {\n         if self.is::<T>() {\n             unsafe {\n-                // Get the raw representation of the trait object\n-                let to: TraitObject = transmute(self);\n-\n-                // Extract the data pointer\n-                Some(&*(to.data as *const T))\n+                Some(&*(self as *const Any as *const T))\n             }\n         } else {\n             None\n@@ -240,11 +234,7 @@ impl Any {\n     pub fn downcast_mut<T: Any>(&mut self) -> Option<&mut T> {\n         if self.is::<T>() {\n             unsafe {\n-                // Get the raw representation of the trait object\n-                let to: TraitObject = transmute(self);\n-\n-                // Extract the data pointer\n-                Some(&mut *(to.data as *const T as *mut T))\n+                Some(&mut *(self as *mut Any as *mut T))\n             }\n         } else {\n             None"}, {"sha": "ab537f39bf96a268a2c8161ca30e70cce9b0a9ec", "filename": "src/libstd/error.rs", "status": "modified", "additions": 4, "deletions": 18, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Flibstd%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30835ec4e4f415e917b3e89edc8033789d1b009f/src%2Flibstd%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ferror.rs?ref=30835ec4e4f415e917b3e89edc8033789d1b009f", "patch": "@@ -54,7 +54,6 @@ use fmt::{self, Debug, Display};\n use marker::Reflect;\n use mem::transmute;\n use num;\n-use raw::TraitObject;\n use str;\n use string;\n \n@@ -326,11 +325,7 @@ impl Error + 'static {\n     pub fn downcast_ref<T: Error + 'static>(&self) -> Option<&T> {\n         if self.is::<T>() {\n             unsafe {\n-                // Get the raw representation of the trait object\n-                let to: TraitObject = transmute(self);\n-\n-                // Extract the data pointer\n-                Some(&*(to.data as *const T))\n+                Some(&*(self as *const Error as *const T))\n             }\n         } else {\n             None\n@@ -344,11 +339,7 @@ impl Error + 'static {\n     pub fn downcast_mut<T: Error + 'static>(&mut self) -> Option<&mut T> {\n         if self.is::<T>() {\n             unsafe {\n-                // Get the raw representation of the trait object\n-                let to: TraitObject = transmute(self);\n-\n-                // Extract the data pointer\n-                Some(&mut *(to.data as *const T as *mut T))\n+                Some(&mut *(self as *mut Error as *mut T))\n             }\n         } else {\n             None\n@@ -409,13 +400,8 @@ impl Error {\n     pub fn downcast<T: Error + 'static>(self: Box<Self>) -> Result<Box<T>, Box<Error>> {\n         if self.is::<T>() {\n             unsafe {\n-                // Get the raw representation of the trait object\n-                let raw = Box::into_raw(self);\n-                let to: TraitObject =\n-                    transmute::<*mut Error, TraitObject>(raw);\n-\n-                // Extract the data pointer\n-                Ok(Box::from_raw(to.data as *mut T))\n+                let raw: *mut Error = Box::into_raw(self);\n+                Ok(Box::from_raw(raw as *mut T))\n             }\n         } else {\n             Err(self)"}]}