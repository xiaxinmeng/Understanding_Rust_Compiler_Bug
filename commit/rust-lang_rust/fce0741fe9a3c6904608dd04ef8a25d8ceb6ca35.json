{"sha": "fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35", "node_id": "C_kwDOAAsO6NoAKGZjZTA3NDFmZTlhM2M2OTA0NjA4ZGQwNGVmOGEyNWQ4Y2ViNmNhMzU", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-05-03T18:47:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-03T18:47:25Z"}, "message": "Rollup merge of #111062 - clubby789:invalid-repr-unchecked, r=petrochenkov\n\nDon't bail out early when checking invalid `repr` attr\n\nFixes #111051\n\nAn invalid repr delays a bug. If there are other invalid attributes on the item, we emit a warning and exit without re-checking the repr here, so no error is emitted and the delayed bug ICEs", "tree": {"sha": "bad2964aa31977881d23f86950aa92c66f4c2960", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bad2964aa31977881d23f86950aa92c66f4c2960"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkUqw9CRBK7hj4Ov3rIwAAzzAIAIGH0iZ1cuRP0AlguxBfGMJt\nhgK22DXoYurKTpdxVKEddmRcsTG19SwADWO8Y0Fx7DcyeZMDtNuvdq37p7Esc9wL\nK+YQThdyiwGVryyT5PfzIrPM0eOW8cw2jJskqT7KZpLDVPZ5SlWYsDDCaMPOT03c\ni0hY78WC4dvDoQD4YFY2gmowVCBP/cRur48L84TCh0r7mCmvnh4kGInGkGw3v9FU\ncTcu6AFBJRHHo0qNe0gBR52i6fY5L54j0q0HNbeZJ/ULZvF/EiUi82zEWPtMg/FR\nJ/8S/XZMLZcoQMkDU40KRDwdxLzkRIfHuWjtFICoDJxpzZ0E4txKe9O7DZ227lQ=\n=vSVh\n-----END PGP SIGNATURE-----\n", "payload": "tree bad2964aa31977881d23f86950aa92c66f4c2960\nparent 8b7080b15bc2846ba547a9086ae1b3df8a69d2d1\nparent 0453cda59e4eb09e2bc632c41420da22bfeac242\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1683139645 +0530\ncommitter GitHub <noreply@github.com> 1683139645 +0530\n\nRollup merge of #111062 - clubby789:invalid-repr-unchecked, r=petrochenkov\n\nDon't bail out early when checking invalid `repr` attr\n\nFixes #111051\n\nAn invalid repr delays a bug. If there are other invalid attributes on the item, we emit a warning and exit without re-checking the repr here, so no error is emitted and the delayed bug ICEs\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35", "html_url": "https://github.com/rust-lang/rust/commit/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b7080b15bc2846ba547a9086ae1b3df8a69d2d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b7080b15bc2846ba547a9086ae1b3df8a69d2d1", "html_url": "https://github.com/rust-lang/rust/commit/8b7080b15bc2846ba547a9086ae1b3df8a69d2d1"}, {"sha": "0453cda59e4eb09e2bc632c41420da22bfeac242", "url": "https://api.github.com/repos/rust-lang/rust/commits/0453cda59e4eb09e2bc632c41420da22bfeac242", "html_url": "https://github.com/rust-lang/rust/commit/0453cda59e4eb09e2bc632c41420da22bfeac242"}], "stats": {"total": 33, "additions": 25, "deletions": 8}, "files": [{"sha": "06aa2737915263c7d82b1fead7a43fceb2b39d97", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35", "patch": "@@ -101,12 +101,11 @@ impl CheckAttrVisitor<'_> {\n         item: Option<ItemLike<'_>>,\n     ) {\n         let mut doc_aliases = FxHashMap::default();\n-        let mut is_valid = true;\n         let mut specified_inline = None;\n         let mut seen = FxHashMap::default();\n         let attrs = self.tcx.hir().attrs(hir_id);\n         for attr in attrs {\n-            let attr_is_valid = match attr.name_or_empty() {\n+            match attr.name_or_empty() {\n                 sym::do_not_recommend => self.check_do_not_recommend(attr.span, target),\n                 sym::inline => self.check_inline(hir_id, attr, span, target),\n                 sym::no_coverage => self.check_no_coverage(hir_id, attr, span, target),\n@@ -188,7 +187,6 @@ impl CheckAttrVisitor<'_> {\n                 sym::link_ordinal => self.check_link_ordinal(&attr, span, target),\n                 _ => true,\n             };\n-            is_valid &= attr_is_valid;\n \n             // lint-only checks\n             match attr.name_or_empty() {\n@@ -255,10 +253,6 @@ impl CheckAttrVisitor<'_> {\n             self.check_unused_attribute(hir_id, attr)\n         }\n \n-        if !is_valid {\n-            return;\n-        }\n-\n         self.check_repr(attrs, span, target, item, hir_id);\n         self.check_used(attrs, target);\n     }"}, {"sha": "785ffb1e0f4cbf03312c0e1b3158a2999150d009", "filename": "tests/ui/repr/invalid_repr_list_help.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35/tests%2Fui%2Frepr%2Finvalid_repr_list_help.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35/tests%2Fui%2Frepr%2Finvalid_repr_list_help.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frepr%2Finvalid_repr_list_help.rs?ref=fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35", "patch": "@@ -15,3 +15,8 @@ pub struct OwO3 {\n pub enum OwO4 {\n     UwU = 1,\n }\n+\n+#[repr(uwu)] //~ERROR: unrecognized representation hint\n+#[doc(owo)]  //~WARN: unknown `doc` attribute\n+             //~^ WARN: this was previously\n+pub struct Owo5;"}, {"sha": "48a6af3dd4c11ce518180faad53e2bd77861a13a", "filename": "tests/ui/repr/invalid_repr_list_help.stderr", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35/tests%2Fui%2Frepr%2Finvalid_repr_list_help.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35/tests%2Fui%2Frepr%2Finvalid_repr_list_help.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frepr%2Finvalid_repr_list_help.stderr?ref=fce0741fe9a3c6904608dd04ef8a25d8ceb6ca35", "patch": "@@ -30,6 +30,24 @@ LL | #[repr(uwu, u8)]\n    |\n    = help: valid reprs are `C`, `align`, `packed`, `transparent`, `simd`, `i8`, `u8`, `i16`, `u16`, `i32`, `u32`, `i64`, `u64`, `i128`, `u128`, `isize`, `usize`\n \n-error: aborting due to 4 previous errors\n+warning: unknown `doc` attribute `owo`\n+  --> $DIR/invalid_repr_list_help.rs:20:7\n+   |\n+LL | #[doc(owo)]\n+   |       ^^^\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n+   = note: `#[warn(invalid_doc_attributes)]` on by default\n+\n+error[E0552]: unrecognized representation hint\n+  --> $DIR/invalid_repr_list_help.rs:19:8\n+   |\n+LL | #[repr(uwu)]\n+   |        ^^^\n+   |\n+   = help: valid reprs are `C`, `align`, `packed`, `transparent`, `simd`, `i8`, `u8`, `i16`, `u16`, `i32`, `u32`, `i64`, `u64`, `i128`, `u128`, `isize`, `usize`\n+\n+error: aborting due to 5 previous errors; 1 warning emitted\n \n For more information about this error, try `rustc --explain E0552`."}]}