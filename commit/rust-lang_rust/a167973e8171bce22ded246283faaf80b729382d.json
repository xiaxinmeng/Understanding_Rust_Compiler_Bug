{"sha": "a167973e8171bce22ded246283faaf80b729382d", "node_id": "C_kwDOAAsO6NoAKGExNjc5NzNlODE3MWJjZTIyZGVkMjQ2MjgzZmFhZjgwYjcyOTM4MmQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-14T04:41:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-14T04:41:41Z"}, "message": "Auto merge of #10768 - c410-f3r:arith-3, r=Jarcho\n\n[arithmetic_side_effects] Consider referenced allowed or hard-coded types\n\nFix #10767\n\n```\nchangelog: [`arithmetic_side_effects`]: Do not fire when dealing with allowed or hard-coded types that are referenced.\n```", "tree": {"sha": "4baf4637b246364c280f40198cb64597590fa3f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4baf4637b246364c280f40198cb64597590fa3f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a167973e8171bce22ded246283faaf80b729382d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a167973e8171bce22ded246283faaf80b729382d", "html_url": "https://github.com/rust-lang/rust/commit/a167973e8171bce22ded246283faaf80b729382d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a167973e8171bce22ded246283faaf80b729382d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fff790b6590ca249e3fde5614c05a86cde20a5f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/fff790b6590ca249e3fde5614c05a86cde20a5f0", "html_url": "https://github.com/rust-lang/rust/commit/fff790b6590ca249e3fde5614c05a86cde20a5f0"}, {"sha": "891fffef0ced6a62406db1b9c7742cc064af96ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/891fffef0ced6a62406db1b9c7742cc064af96ba", "html_url": "https://github.com/rust-lang/rust/commit/891fffef0ced6a62406db1b9c7742cc064af96ba"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "c80e2ff7057e3aa92fee3526db97b07db1a84c53", "filename": "clippy_lints/src/operators/arithmetic_side_effects.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a167973e8171bce22ded246283faaf80b729382d/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a167973e8171bce22ded246283faaf80b729382d/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs?ref=a167973e8171bce22ded246283faaf80b729382d", "patch": "@@ -21,7 +21,7 @@ const HARD_CODED_ALLOWED_BINARY: &[[&str; 2]] = &[\n     [\"f64\", \"f64\"],\n     [\"std::num::Saturating\", \"std::num::Saturating\"],\n     [\"std::num::Wrapping\", \"std::num::Wrapping\"],\n-    [\"std::string::String\", \"&str\"],\n+    [\"std::string::String\", \"str\"],\n ];\n const HARD_CODED_ALLOWED_UNARY: &[&str] = &[\"f32\", \"f64\", \"std::num::Saturating\", \"std::num::Wrapping\"];\n const INTEGER_METHODS: &[&str] = &[\"saturating_div\", \"wrapping_div\", \"wrapping_rem\", \"wrapping_rem_euclid\"];\n@@ -144,8 +144,10 @@ impl ArithmeticSideEffects {\n         ) {\n             return;\n         };\n-        let lhs_ty = cx.typeck_results().expr_ty(lhs);\n-        let rhs_ty = cx.typeck_results().expr_ty(rhs);\n+        let (actual_lhs, lhs_ref_counter) = peel_hir_expr_refs(lhs);\n+        let (actual_rhs, rhs_ref_counter) = peel_hir_expr_refs(rhs);\n+        let lhs_ty = cx.typeck_results().expr_ty(actual_lhs).peel_refs();\n+        let rhs_ty = cx.typeck_results().expr_ty(actual_rhs).peel_refs();\n         if self.has_allowed_binary(lhs_ty, rhs_ty) {\n             return;\n         }\n@@ -154,8 +156,6 @@ impl ArithmeticSideEffects {\n                 // At least for integers, shifts are already handled by the CTFE\n                 return;\n             }\n-            let (actual_lhs, lhs_ref_counter) = peel_hir_expr_refs(lhs);\n-            let (actual_rhs, rhs_ref_counter) = peel_hir_expr_refs(rhs);\n             match (\n                 Self::literal_integer(cx, actual_lhs),\n                 Self::literal_integer(cx, actual_rhs),"}, {"sha": "f95af1017bcbbfc01efcd64fa1466a0dd915d6ac", "filename": "tests/ui/arithmetic_side_effects.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a167973e8171bce22ded246283faaf80b729382d/tests%2Fui%2Farithmetic_side_effects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a167973e8171bce22ded246283faaf80b729382d/tests%2Fui%2Farithmetic_side_effects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic_side_effects.rs?ref=a167973e8171bce22ded246283faaf80b729382d", "patch": "@@ -458,4 +458,12 @@ pub fn issue_10583(a: u16) -> u16 {\n     10 / a\n }\n \n+pub fn issue_10767() {\n+    let n = &1.0;\n+    n + n;\n+    3.1_f32 + &1.2_f32;\n+    &3.4_f32 + 1.5_f32;\n+    &3.5_f32 + &1.3_f32;\n+}\n+\n fn main() {}"}]}