{"sha": "a6446c53fe8be6692b07e121b831c3db770ff94a", "node_id": "C_kwDOAAsO6NoAKGE2NDQ2YzUzZmU4YmU2NjkyYjA3ZTEyMWI4MzFjM2RiNzcwZmY5NGE", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-03-07T17:06:42Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-03-07T18:20:49Z"}, "message": "rustdoc: fix type search index for `fn<T>() -> &T where T: Trait`", "tree": {"sha": "53a2359aaf4d1b4c7eeb8a3504b3f699179c4ae1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53a2359aaf4d1b4c7eeb8a3504b3f699179c4ae1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a6446c53fe8be6692b07e121b831c3db770ff94a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a6446c53fe8be6692b07e121b831c3db770ff94a", "html_url": "https://github.com/rust-lang/rust/commit/a6446c53fe8be6692b07e121b831c3db770ff94a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a6446c53fe8be6692b07e121b831c3db770ff94a/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a3b557d528dd7c8a88ceca6f7dc0699b89a3ef4", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a3b557d528dd7c8a88ceca6f7dc0699b89a3ef4", "html_url": "https://github.com/rust-lang/rust/commit/0a3b557d528dd7c8a88ceca6f7dc0699b89a3ef4"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "483137f4c3561a22fe60ed0d3d5891665502e649", "filename": "src/librustdoc/html/render/search_index.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a6446c53fe8be6692b07e121b831c3db770ff94a/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6446c53fe8be6692b07e121b831c3db770ff94a/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs?ref=a6446c53fe8be6692b07e121b831c3db770ff94a", "patch": "@@ -465,7 +465,7 @@ fn add_generics_and_bounds_as_types<'tcx, 'a>(\n     }\n \n     // First, check if it's \"Self\".\n-    let arg = if let Some(self_) = self_ {\n+    let mut arg = if let Some(self_) = self_ {\n         match &*arg {\n             Type::BorrowedRef { type_, .. } if type_.is_self_type() => self_,\n             type_ if type_.is_self_type() => self_,\n@@ -475,6 +475,11 @@ fn add_generics_and_bounds_as_types<'tcx, 'a>(\n         arg\n     };\n \n+    // strip references from the argument type\n+    while let Type::BorrowedRef { type_, .. } = &*arg {\n+        arg = &*type_;\n+    }\n+\n     // If this argument is a type parameter and not a trait bound or a type, we need to look\n     // for its bounds.\n     if let Type::Generic(arg_s) = *arg {"}, {"sha": "4112f08fb0a5f8252618396c3550e0e5fab74ea2", "filename": "tests/rustdoc-js/where-clause.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a6446c53fe8be6692b07e121b831c3db770ff94a/tests%2Frustdoc-js%2Fwhere-clause.js", "raw_url": "https://github.com/rust-lang/rust/raw/a6446c53fe8be6692b07e121b831c3db770ff94a/tests%2Frustdoc-js%2Fwhere-clause.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-js%2Fwhere-clause.js?ref=a6446c53fe8be6692b07e121b831c3db770ff94a", "patch": "@@ -1,4 +1,4 @@\n-const QUERY = ['trait<nested>', '-> trait<nested>', 't1, t2'];\n+const QUERY = ['trait<nested>', '-> trait<nested>', 't1, t2', '-> shazam'];\n \n const EXPECTED = [\n     {\n@@ -16,4 +16,9 @@ const EXPECTED = [\n             { 'path': 'where_clause', 'name': 'presto' },\n         ],\n     },\n+    {\n+        'others': [\n+            { 'path': 'where_clause', 'name': 'bippety' },\n+        ],\n+    },\n ];"}, {"sha": "f8bdc072216e61d35ee4613811b90cbac7e8f5d5", "filename": "tests/rustdoc-js/where-clause.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a6446c53fe8be6692b07e121b831c3db770ff94a/tests%2Frustdoc-js%2Fwhere-clause.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6446c53fe8be6692b07e121b831c3db770ff94a/tests%2Frustdoc-js%2Fwhere-clause.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-js%2Fwhere-clause.rs?ref=a6446c53fe8be6692b07e121b831c3db770ff94a", "patch": "@@ -14,3 +14,9 @@ pub trait T2<'a, T> {\n }\n \n pub fn presto<A, B>(_: A, _: B) where A: T1, B: for <'b> T2<'b, Nested> {}\n+\n+pub trait Shazam {}\n+\n+pub fn bippety<X>() -> &'static X where X: Shazam {\n+    panic!()\n+}"}]}