{"sha": "1e37ba76d47280fa867c3863aa6d22376535637a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlMzdiYTc2ZDQ3MjgwZmE4NjdjMzg2M2FhNmQyMjM3NjUzNTYzN2E=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-01T09:30:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-01T09:30:11Z"}, "message": "Auto merge of #78531 - cuviper:unwrap-metadata, r=tmandry\n\nrustc_llvm: unwrap LLVMMetadataRef before casting\n\nDirectly casting the opaque pointer was [reported] to cause an\n\"incomplete type\" error with GCC 9.3:\n\n```\nllvm-wrapper/RustWrapper.cpp:939:31:   required from here\n/usr/include/c++/9.3/type_traits:1301:12: error: invalid use of incomplete type 'struct LLVMOpaqueMetadata'\n 1301 |     struct is_base_of\n      |            ^~~~~~~~~~\nIn file included from [...]/rust/src/llvm-project/llvm/include/llvm-c/BitReader.h:23,\n                 from llvm-wrapper/LLVMWrapper.h:1,\n                 from llvm-wrapper/RustWrapper.cpp:1:\n[...]/rust/src/llvm-project/llvm/include/llvm-c/Types.h:89:16: note: forward declaration of 'struct LLVMOpaqueMetadata'\n   89 | typedef struct LLVMOpaqueMetadata *LLVMMetadataRef;\n      |                ^~~~~~~~~~~~~~~~~~\n```\n\n[reported]: https://zulip-archive.rust-lang.org/182449tcompilerhelp/12215halprustcllvmbuildfail.html#214915124\n\nA simple `unwrap` fixes the issue.\n\nr? `@eddyb`", "tree": {"sha": "1e26368f298552f8351e140c589e94346035ebc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e26368f298552f8351e140c589e94346035ebc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e37ba76d47280fa867c3863aa6d22376535637a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e37ba76d47280fa867c3863aa6d22376535637a", "html_url": "https://github.com/rust-lang/rust/commit/1e37ba76d47280fa867c3863aa6d22376535637a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e37ba76d47280fa867c3863aa6d22376535637a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d5b7c3c96a86c96f1fbf1441475028df94d165a", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d5b7c3c96a86c96f1fbf1441475028df94d165a", "html_url": "https://github.com/rust-lang/rust/commit/1d5b7c3c96a86c96f1fbf1441475028df94d165a"}, {"sha": "dcbf2f324f3e3c116b3a7f45b501e2382e89510d", "url": "https://api.github.com/repos/rust-lang/rust/commits/dcbf2f324f3e3c116b3a7f45b501e2382e89510d", "html_url": "https://github.com/rust-lang/rust/commit/dcbf2f324f3e3c116b3a7f45b501e2382e89510d"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "40a10434248486170fcaf21717403b14970529b9", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e37ba76d47280fa867c3863aa6d22376535637a/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/1e37ba76d47280fa867c3863aa6d22376535637a/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=1e37ba76d47280fa867c3863aa6d22376535637a", "patch": "@@ -936,7 +936,7 @@ extern \"C\" LLVMValueRef LLVMRustDIBuilderInsertDeclareAtEnd(\n   return wrap(Builder->insertDeclare(\n       unwrap(V), unwrap<DILocalVariable>(VarInfo),\n       Builder->createExpression(llvm::ArrayRef<int64_t>(AddrOps, AddrOpsCount)),\n-      DebugLoc(cast<MDNode>(DL)),\n+      DebugLoc(cast<MDNode>(unwrap(DL))),\n       unwrap(InsertAtEnd)));\n }\n "}]}