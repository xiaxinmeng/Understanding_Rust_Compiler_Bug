{"sha": "4a21af67e3770f413afea9e74fb4a29540d6c85d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhMjFhZjY3ZTM3NzBmNDEzYWZlYTllNzRmYjRhMjk1NDBkNmM4NWQ=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-01-04T20:50:45Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-03-09T17:51:37Z"}, "message": "Take a slice in stmt_let_pat.", "tree": {"sha": "d67e5f2989842df7f0fefe67a146cd461bda585f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d67e5f2989842df7f0fefe67a146cd461bda585f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a21af67e3770f413afea9e74fb4a29540d6c85d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a21af67e3770f413afea9e74fb4a29540d6c85d", "html_url": "https://github.com/rust-lang/rust/commit/4a21af67e3770f413afea9e74fb4a29540d6c85d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a21af67e3770f413afea9e74fb4a29540d6c85d/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fb257b3b4d11552963103acd8491d1bbea547d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fb257b3b4d11552963103acd8491d1bbea547d0", "html_url": "https://github.com/rust-lang/rust/commit/1fb257b3b4d11552963103acd8491d1bbea547d0"}], "stats": {"total": 25, "additions": 16, "deletions": 9}, "files": [{"sha": "21f69bdfbb5224cd84fc3b44f825483f6959790f", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4a21af67e3770f413afea9e74fb4a29540d6c85d/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a21af67e3770f413afea9e74fb4a29540d6c85d/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=4a21af67e3770f413afea9e74fb4a29540d6c85d", "patch": "@@ -1026,7 +1026,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n \n         // Introduce a `let` for destructuring: `let (lhs1, lhs2) = t`.\n         let destructure_let = self.stmt_let_pat(\n-            ThinVec::new(),\n+            &[],\n             whole_span,\n             Some(rhs),\n             pat,\n@@ -1785,7 +1785,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n \n         // `let mut __next`\n         let next_let = self.stmt_let_pat(\n-            ThinVec::new(),\n+            &[],\n             desugared_span,\n             None,\n             next_pat,\n@@ -1795,7 +1795,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         // `let <pat> = __next`\n         let pat = self.lower_pat(pat);\n         let pat_let = self.stmt_let_pat(\n-            ThinVec::new(),\n+            &[],\n             desugared_span,\n             Some(next_expr),\n             pat,"}, {"sha": "b13cdbadb5aef22710a9e8c78caeaf8c0127e49b", "filename": "compiler/rustc_ast_lowering/src/item.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4a21af67e3770f413afea9e74fb4a29540d6c85d/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a21af67e3770f413afea9e74fb4a29540d6c85d/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs?ref=4a21af67e3770f413afea9e74fb4a29540d6c85d", "patch": "@@ -1177,8 +1177,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                 //\n                 // If this is the simple case, this parameter will end up being the same as the\n                 // original parameter, but with a different pattern id.\n-                let mut stmt_attrs = AttrVec::new();\n-                stmt_attrs.extend(parameter.attrs.iter().cloned());\n+                let stmt_attrs = this.attrs[parameter.hir_id];\n                 let (new_parameter_pat, new_parameter_id) = this.pat_ident(desugared_span, ident);\n                 let new_parameter = hir::Param {\n                     attrs: parameter.attrs,\n@@ -1224,7 +1223,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                     );\n                     let move_expr = this.expr_ident(desugared_span, ident, new_parameter_id);\n                     let move_stmt = this.stmt_let_pat(\n-                        AttrVec::new(),\n+                        &[],\n                         desugared_span,\n                         Some(move_expr),\n                         move_pat,"}, {"sha": "ac945a8903a86314386736c8222673518e3127ca", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4a21af67e3770f413afea9e74fb4a29540d6c85d/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a21af67e3770f413afea9e74fb4a29540d6c85d/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=4a21af67e3770f413afea9e74fb4a29540d6c85d", "patch": "@@ -2526,15 +2526,23 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n \n     fn stmt_let_pat(\n         &mut self,\n-        attrs: AttrVec,\n+        attrs: &'hir [Attribute],\n         span: Span,\n         init: Option<&'hir hir::Expr<'hir>>,\n         pat: &'hir hir::Pat<'hir>,\n         source: hir::LocalSource,\n     ) -> hir::Stmt<'hir> {\n         let hir_id = self.next_id();\n-        self.attrs.push_sparse(hir_id, &*self.arena.alloc_from_iter(attrs.iter().cloned()));\n-        let local = hir::Local { attrs, hir_id, init, pat, source, span, ty: None };\n+        self.attrs.push_sparse(hir_id, attrs);\n+        let local = hir::Local {\n+            attrs: attrs.iter().cloned().collect::<Vec<_>>().into(),\n+            hir_id,\n+            init,\n+            pat,\n+            source,\n+            span,\n+            ty: None,\n+        };\n         self.stmt(span, hir::StmtKind::Local(self.arena.alloc(local)))\n     }\n "}]}