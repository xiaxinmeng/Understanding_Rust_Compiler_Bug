{"sha": "caa858ba484719a62d4e6a0bcfa594254735b9e0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhYTg1OGJhNDg0NzE5YTYyZDRlNmEwYmNmYTU5NDI1NDczNWI5ZTA=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-07T00:45:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-07T00:45:35Z"}, "message": "Rollup merge of #74089 - matklad:ship-rust-analyzer-some-more, r=pietroalbini\n\nAdd rust-analyzer to the build manifest\n\nDoes not die locally, produces `rust-analyzer-0.1.0-dev-x86_64-unknown-linux-gnu.tar.gz.sha256` and add something about rust-analyzer to some `.toml` file. Seems like a success?", "tree": {"sha": "5e75983c400578ddb7c5dc1b19b8705bc6d8093d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e75983c400578ddb7c5dc1b19b8705bc6d8093d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/caa858ba484719a62d4e6a0bcfa594254735b9e0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfA8WwCRBK7hj4Ov3rIwAAdHIIAJlRHh8BSVvqr+ZXsSPTLw7v\nsjeeg1MvIF7kiuX3XUx8ygKC0xZxIbLkMpyRxMaM+OVuHk7uX4xWQESplT2Zf5ic\n+TnUVs7zc6aucFBTekFa/Hsza70Dyu2bpkNFHT1hGK2Py0hglzPC2rEZ9UiX6o34\nM/rN6+lkBzQDWj7t2JbH10ZzhqWKT9hwVG/1vZJbIusogHsIlHaxZOs7oJKhUTvB\nvvyjW+7yaCfDg45X0qhuN60/k73Qj7G9QqrV6caB5Ivge0elomqYNzy1BMHY8faD\n1DTdKnbCNt25j7EXS+8zEol7uShFzN0b6C5FqppGP5fslgFy/i0/IV34ey4N5uU=\n=DJzd\n-----END PGP SIGNATURE-----\n", "payload": "tree 5e75983c400578ddb7c5dc1b19b8705bc6d8093d\nparent ecc6f5683b6c2ad1e92b58011c828cb604e0b5ac\nparent fdd39a343efba586227773499b366a4e8a8f8df8\nauthor Manish Goregaokar <manishsmail@gmail.com> 1594082735 -0700\ncommitter GitHub <noreply@github.com> 1594082735 -0700\n\nRollup merge of #74089 - matklad:ship-rust-analyzer-some-more, r=pietroalbini\n\nAdd rust-analyzer to the build manifest\n\nDoes not die locally, produces `rust-analyzer-0.1.0-dev-x86_64-unknown-linux-gnu.tar.gz.sha256` and add something about rust-analyzer to some `.toml` file. Seems like a success?\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/caa858ba484719a62d4e6a0bcfa594254735b9e0", "html_url": "https://github.com/rust-lang/rust/commit/caa858ba484719a62d4e6a0bcfa594254735b9e0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/caa858ba484719a62d4e6a0bcfa594254735b9e0/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ecc6f5683b6c2ad1e92b58011c828cb604e0b5ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecc6f5683b6c2ad1e92b58011c828cb604e0b5ac", "html_url": "https://github.com/rust-lang/rust/commit/ecc6f5683b6c2ad1e92b58011c828cb604e0b5ac"}, {"sha": "fdd39a343efba586227773499b366a4e8a8f8df8", "url": "https://api.github.com/repos/rust-lang/rust/commits/fdd39a343efba586227773499b366a4e8a8f8df8", "html_url": "https://github.com/rust-lang/rust/commit/fdd39a343efba586227773499b366a4e8a8f8df8"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "a80f36d49699801d46581277d67e13d8f6473be6", "filename": "src/tools/build-manifest/README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/caa858ba484719a62d4e6a0bcfa594254735b9e0/src%2Ftools%2Fbuild-manifest%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/caa858ba484719a62d4e6a0bcfa594254735b9e0/src%2Ftools%2Fbuild-manifest%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2FREADME.md?ref=caa858ba484719a62d4e6a0bcfa594254735b9e0", "patch": "@@ -22,7 +22,7 @@ Then, you can generate the manifest and all the packages from `path/to/dist` to\n ```\n $ BUILD_MANIFEST_DISABLE_SIGNING=1 cargo +nightly run \\\n     path/to/dist path/to/output 1970-01-01 \\\n-    nightly nightly nightly nightly nightly nightly nightly \\\n+    nightly nightly nightly nightly nightly nightly nightly nightly \\\n     http://example.com\n ```\n "}, {"sha": "5c50587ea973d7bcf89a05b5867da0f195d33ec7", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 24, "deletions": 2, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/caa858ba484719a62d4e6a0bcfa594254735b9e0/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/caa858ba484719a62d4e6a0bcfa594254735b9e0/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=caa858ba484719a62d4e6a0bcfa594254735b9e0", "patch": "@@ -158,6 +158,8 @@ static DOCS_TARGETS: &[&str] = &[\n \n static MINGW: &[&str] = &[\"i686-pc-windows-gnu\", \"x86_64-pc-windows-gnu\"];\n \n+static NIGHTLY_ONLY_COMPONENTS: &[&str] = &[\"miri-preview\", \"rust-analyzer-preview\"];\n+\n #[derive(Serialize)]\n #[serde(rename_all = \"kebab-case\")]\n struct Manifest {\n@@ -222,6 +224,7 @@ struct Builder {\n     rust_release: String,\n     cargo_release: String,\n     rls_release: String,\n+    rust_analyzer_release: String,\n     clippy_release: String,\n     rustfmt_release: String,\n     llvm_tools_release: String,\n@@ -237,6 +240,7 @@ struct Builder {\n     rust_version: Option<String>,\n     cargo_version: Option<String>,\n     rls_version: Option<String>,\n+    rust_analyzer_version: Option<String>,\n     clippy_version: Option<String>,\n     rustfmt_version: Option<String>,\n     llvm_tools_version: Option<String>,\n@@ -245,6 +249,7 @@ struct Builder {\n     rust_git_commit_hash: Option<String>,\n     cargo_git_commit_hash: Option<String>,\n     rls_git_commit_hash: Option<String>,\n+    rust_analyzer_git_commit_hash: Option<String>,\n     clippy_git_commit_hash: Option<String>,\n     rustfmt_git_commit_hash: Option<String>,\n     llvm_tools_git_commit_hash: Option<String>,\n@@ -274,6 +279,7 @@ fn main() {\n     let s3_address = args.next().unwrap();\n     let cargo_release = args.next().unwrap();\n     let rls_release = args.next().unwrap();\n+    let rust_analyzer_release = args.next().unwrap();\n     let clippy_release = args.next().unwrap();\n     let miri_release = args.next().unwrap();\n     let rustfmt_release = args.next().unwrap();\n@@ -290,6 +296,7 @@ fn main() {\n         rust_release,\n         cargo_release,\n         rls_release,\n+        rust_analyzer_release,\n         clippy_release,\n         rustfmt_release,\n         llvm_tools_release,\n@@ -305,6 +312,7 @@ fn main() {\n         rust_version: None,\n         cargo_version: None,\n         rls_version: None,\n+        rust_analyzer_version: None,\n         clippy_version: None,\n         rustfmt_version: None,\n         llvm_tools_version: None,\n@@ -313,6 +321,7 @@ fn main() {\n         rust_git_commit_hash: None,\n         cargo_git_commit_hash: None,\n         rls_git_commit_hash: None,\n+        rust_analyzer_git_commit_hash: None,\n         clippy_git_commit_hash: None,\n         rustfmt_git_commit_hash: None,\n         llvm_tools_git_commit_hash: None,\n@@ -327,6 +336,7 @@ enum PkgType {\n     RustSrc,\n     Cargo,\n     Rls,\n+    RustAnalyzer,\n     Clippy,\n     Rustfmt,\n     LlvmTools,\n@@ -341,6 +351,7 @@ impl PkgType {\n             \"rust-src\" => RustSrc,\n             \"cargo\" => Cargo,\n             \"rls\" | \"rls-preview\" => Rls,\n+            \"rust-analyzer\" | \"rust-analyzer-preview\" => RustAnalyzer,\n             \"clippy\" | \"clippy-preview\" => Clippy,\n             \"rustfmt\" | \"rustfmt-preview\" => Rustfmt,\n             \"llvm-tools\" | \"llvm-tools-preview\" => LlvmTools,\n@@ -355,6 +366,7 @@ impl Builder {\n         self.rust_version = self.version(\"rust\", \"x86_64-unknown-linux-gnu\");\n         self.cargo_version = self.version(\"cargo\", \"x86_64-unknown-linux-gnu\");\n         self.rls_version = self.version(\"rls\", \"x86_64-unknown-linux-gnu\");\n+        self.rust_analyzer_version = self.version(\"rust-analyzer\", \"x86_64-unknown-linux-gnu\");\n         self.clippy_version = self.version(\"clippy\", \"x86_64-unknown-linux-gnu\");\n         self.rustfmt_version = self.version(\"rustfmt\", \"x86_64-unknown-linux-gnu\");\n         self.llvm_tools_version = self.version(\"llvm-tools\", \"x86_64-unknown-linux-gnu\");\n@@ -363,6 +375,8 @@ impl Builder {\n         self.rust_git_commit_hash = self.git_commit_hash(\"rust\", \"x86_64-unknown-linux-gnu\");\n         self.cargo_git_commit_hash = self.git_commit_hash(\"cargo\", \"x86_64-unknown-linux-gnu\");\n         self.rls_git_commit_hash = self.git_commit_hash(\"rls\", \"x86_64-unknown-linux-gnu\");\n+        self.rust_analyzer_git_commit_hash =\n+            self.git_commit_hash(\"rust-analyzer\", \"x86_64-unknown-linux-gnu\");\n         self.clippy_git_commit_hash = self.git_commit_hash(\"clippy\", \"x86_64-unknown-linux-gnu\");\n         self.rustfmt_git_commit_hash = self.git_commit_hash(\"rustfmt\", \"x86_64-unknown-linux-gnu\");\n         self.llvm_tools_git_commit_hash =\n@@ -436,6 +450,7 @@ impl Builder {\n         package(\"rust-docs\", DOCS_TARGETS);\n         package(\"rust-src\", &[\"*\"]);\n         package(\"rls-preview\", HOSTS);\n+        package(\"rust-analyzer-preview\", HOSTS);\n         package(\"clippy-preview\", HOSTS);\n         package(\"miri-preview\", HOSTS);\n         package(\"rustfmt-preview\", HOSTS);\n@@ -469,6 +484,7 @@ impl Builder {\n                 \"rustfmt-preview\",\n                 \"clippy-preview\",\n                 \"rls-preview\",\n+                \"rust-analyzer-preview\",\n                 \"rust-src\",\n                 \"llvm-tools-preview\",\n                 \"rust-analysis\",\n@@ -543,6 +559,7 @@ impl Builder {\n             host_component(\"clippy-preview\"),\n             host_component(\"miri-preview\"),\n             host_component(\"rls-preview\"),\n+            host_component(\"rust-analyzer-preview\"),\n             host_component(\"rustfmt-preview\"),\n             host_component(\"llvm-tools-preview\"),\n             host_component(\"rust-analysis\"),\n@@ -612,8 +629,8 @@ impl Builder {\n             .map(|version| (version, true))\n             .unwrap_or_default(); // `is_present` defaults to `false` here.\n \n-        // Miri is nightly-only; never ship it for other trains.\n-        if pkgname == \"miri-preview\" && self.rust_release != \"nightly\" {\n+        // Never ship nightly-only components for other trains.\n+        if self.rust_release != \"nightly\" && NIGHTLY_ONLY_COMPONENTS.contains(&pkgname) {\n             is_present = false; // Pretend the component is entirely missing.\n         }\n \n@@ -671,6 +688,9 @@ impl Builder {\n             RustSrc => format!(\"rust-src-{}.tar.gz\", self.rust_release),\n             Cargo => format!(\"cargo-{}-{}.tar.gz\", self.cargo_release, target),\n             Rls => format!(\"rls-{}-{}.tar.gz\", self.rls_release, target),\n+            RustAnalyzer => {\n+                format!(\"rust-analyzer-{}-{}.tar.gz\", self.rust_analyzer_release, target)\n+            }\n             Clippy => format!(\"clippy-{}-{}.tar.gz\", self.clippy_release, target),\n             Rustfmt => format!(\"rustfmt-{}-{}.tar.gz\", self.rustfmt_release, target),\n             LlvmTools => format!(\"llvm-tools-{}-{}.tar.gz\", self.llvm_tools_release, target),\n@@ -684,6 +704,7 @@ impl Builder {\n         match PkgType::from_component(component) {\n             Cargo => &self.cargo_version,\n             Rls => &self.rls_version,\n+            RustAnalyzer => &self.rust_analyzer_version,\n             Clippy => &self.clippy_version,\n             Rustfmt => &self.rustfmt_version,\n             LlvmTools => &self.llvm_tools_version,\n@@ -697,6 +718,7 @@ impl Builder {\n         match PkgType::from_component(component) {\n             Cargo => &self.cargo_git_commit_hash,\n             Rls => &self.rls_git_commit_hash,\n+            RustAnalyzer => &self.rust_analyzer_git_commit_hash,\n             Clippy => &self.clippy_git_commit_hash,\n             Rustfmt => &self.rustfmt_git_commit_hash,\n             LlvmTools => &self.llvm_tools_git_commit_hash,"}]}