{"sha": "d8db5299fae13a5ef321fd8f7be7364d735fecbb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ4ZGI1Mjk5ZmFlMTNhNWVmMzIxZmQ4ZjdiZTczNjRkNzM1ZmVjYmI=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-10-16T22:47:28Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-10-16T22:47:28Z"}, "message": "Don't buffer lints.\n\nWhen lints are emitted from the AST borrow checker, they do not signal\nan error as it is not known at that time whether, due to attributes,\nthat lint will error or warn. This means that when lints are buffered\nin the MIR they will always be downgraded, as the AST borrowck will not\nhave been marked as having errored, even if a lint was upgraded to\nan error after being emitted from the AST borrowck. The simple solution\nto this is to not buffer any lints from the MIR borrowck.", "tree": {"sha": "55efb51bba3b6fb685f45ea72a9ada531d394ce3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/55efb51bba3b6fb685f45ea72a9ada531d394ce3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d8db5299fae13a5ef321fd8f7be7364d735fecbb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlvGa0QACgkQAXYLT59T\n8VQnuBAAlslvnEFFoDdhSOi1rlDfuKET3vC1lF2W6R8mwm1IC/Wn1M0CrZDTZF81\nW/0Ds6r5YQo6X1CJIf2MHoaaCt/FHv91hwQcWAeieGVl//YWkub0TAjp/mya8Kt0\nc12S/McZlZwiVuBwyN1uMn/HXrgPg+CsZZKSmsg0ez2ypjVNMjgCtulIyI5xfPQu\nOc7GItwLwtbpIM+gU8as7itbKLPpmtuqfNtCfZdPQ2jACxfMPL/KebaDJZms/aFi\n4ZiY53x7WxALsd011bMV2rmZ/xHarHf1douCgP0TCR9JOwumI7IWP+wLjhvY+7tH\nEvVb58DzF2ahnFDBJH2x05+FL8G7Y8/UQUDSMJKi1Qy7aEV56NUHu5z4kdYAWN3F\niuJKoFQeyrqi8lsnrEXZ6ATJb/mP0+ROgS7nroN8CLaw0tn7mYencOQSWNURM2Mv\n0xDBOn4PUcPV46XFTqKByff2x7vuU2b48wZEM9Fe/h+doFiHeLtX7pXVi9r6HqES\n6yaO/LT9pAvuQJ3VRDShF4gcjHteDb2HrUsFOkkBykEINMVx9WkOqEd78Oyp1vN4\nkHqizj3yowfHX8C4/RX1R8y4bfqIy7iEOGVJDwczpjRDsywpv28m8q3nSn0P4dZR\noEP6wx0Trad5db9uAL/sQJWmfMULjzOAKsHOl33dWhLLm8E2/3o=\n=n23Z\n-----END PGP SIGNATURE-----", "payload": "tree 55efb51bba3b6fb685f45ea72a9ada531d394ce3\nparent 99ab2f4071b959b0276862605d7107227c2fa76f\nauthor David Wood <david@davidtw.co> 1539730048 +0200\ncommitter David Wood <david@davidtw.co> 1539730048 +0200\n\nDon't buffer lints.\n\nWhen lints are emitted from the AST borrow checker, they do not signal\nan error as it is not known at that time whether, due to attributes,\nthat lint will error or warn. This means that when lints are buffered\nin the MIR they will always be downgraded, as the AST borrowck will not\nhave been marked as having errored, even if a lint was upgraded to\nan error after being emitted from the AST borrowck. The simple solution\nto this is to not buffer any lints from the MIR borrowck.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d8db5299fae13a5ef321fd8f7be7364d735fecbb", "html_url": "https://github.com/rust-lang/rust/commit/d8db5299fae13a5ef321fd8f7be7364d735fecbb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d8db5299fae13a5ef321fd8f7be7364d735fecbb/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "99ab2f4071b959b0276862605d7107227c2fa76f", "url": "https://api.github.com/repos/rust-lang/rust/commits/99ab2f4071b959b0276862605d7107227c2fa76f", "html_url": "https://github.com/rust-lang/rust/commit/99ab2f4071b959b0276862605d7107227c2fa76f"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "fe80447e4a84f4b9647f959899995a302283154e", "filename": "src/librustc_mir/borrow_check/mod.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d8db5299fae13a5ef321fd8f7be7364d735fecbb/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8db5299fae13a5ef321fd8f7be7364d735fecbb/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs?ref=d8db5299fae13a5ef321fd8f7be7364d735fecbb", "patch": "@@ -321,20 +321,20 @@ fn do_mir_borrowck<'a, 'gcx, 'tcx>(\n                 continue;\n             }\n \n-            let mut err = tcx.struct_span_lint_node(\n+            let mut_span = tcx.sess.source_map().span_until_non_whitespace(span);\n+            tcx.struct_span_lint_node(\n                 UNUSED_MUT,\n                 vsi[local_decl.source_info.scope].lint_root,\n                 span,\n                 \"variable does not need to be mutable\",\n-            );\n-            let mut_span = tcx.sess.source_map().span_until_non_whitespace(span);\n-            err.span_suggestion_short_with_applicability(\n+            )\n+            .span_suggestion_short_with_applicability(\n                 mut_span,\n                 \"remove this `mut`\",\n                 String::new(),\n-                Applicability::MachineApplicable);\n-\n-            err.buffer(&mut mbcx.errors_buffer);\n+                Applicability::MachineApplicable,\n+            )\n+            .emit();\n         }\n     }\n "}]}