{"sha": "b779cbbe6806caccb73f21ac6aeba99316ca8900", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3NzljYmJlNjgwNmNhY2NiNzNmMjFhYzZhZWJhOTkzMTZjYTg5MDA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-12-20T11:17:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-20T11:17:22Z"}, "message": "Rollup merge of #67219 - jsgf:command-argv0-debug, r=joshtriplett\n\nFix up Command Debug output when arg0 is specified.\n\nPR https://github.com/rust-lang/rust/pull/66512 added the ability to set argv[0] on\nCommand. As a side effect, it changed the Debug output to print both the program and\nargv[0], which in practice results in stuttery output (`\"echo\" \"echo\" \"foo\"`).\n\nThis PR reverts the behaviour to the the old one, so that the command is only printed\nonce - unless arg0 has been set. In that case it emits `\"[command]\" \"arg0\" \"arg1\" ...`.", "tree": {"sha": "1e0df416d7841096d632bd247f17c05b7abf0f9f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e0df416d7841096d632bd247f17c05b7abf0f9f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b779cbbe6806caccb73f21ac6aeba99316ca8900", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd/K3CCRBK7hj4Ov3rIwAAdHIIAFBVkug6zOnSDXqKAwXyfUMR\nzvCSUi38VUFOXdtPYnYnWKDnjoD4jQKh+EPdGOr1VoAlYNu1CB8w0NAWCtis0hh2\n8FEYa/WITOfhMA0uGaiovBCxXiYCjJ75OwAsvrHlMXqu5jUJNQcLNjmMainRaAhu\n2yinllWFpViAOYdW2CWbEzvM56dWF7aEhVt2Mb+Qm5zW5TNbKlW2g1UIUmeLSHMB\nEDwnFjB5Qrz5ks2XG6nXLDC3lblfGemZjEx5CI5tulYM358WHOOMBwwY1oGOch8Y\nB/IMdYn0MGq8YOxe3//7+Bpv45uy/UWdAbu8iDHVoaIToYd4RfNloF8vRvf3mRc=\n=xqGr\n-----END PGP SIGNATURE-----\n", "payload": "tree 1e0df416d7841096d632bd247f17c05b7abf0f9f\nparent f0eb4b4752424233e64b19ae242c052eaa65e1ce\nparent ce56e7528359b9581cac0b59080d25468d60de20\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1576840642 +0100\ncommitter GitHub <noreply@github.com> 1576840642 +0100\n\nRollup merge of #67219 - jsgf:command-argv0-debug, r=joshtriplett\n\nFix up Command Debug output when arg0 is specified.\n\nPR https://github.com/rust-lang/rust/pull/66512 added the ability to set argv[0] on\nCommand. As a side effect, it changed the Debug output to print both the program and\nargv[0], which in practice results in stuttery output (`\"echo\" \"echo\" \"foo\"`).\n\nThis PR reverts the behaviour to the the old one, so that the command is only printed\nonce - unless arg0 has been set. In that case it emits `\"[command]\" \"arg0\" \"arg1\" ...`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b779cbbe6806caccb73f21ac6aeba99316ca8900", "html_url": "https://github.com/rust-lang/rust/commit/b779cbbe6806caccb73f21ac6aeba99316ca8900", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b779cbbe6806caccb73f21ac6aeba99316ca8900/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0eb4b4752424233e64b19ae242c052eaa65e1ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0eb4b4752424233e64b19ae242c052eaa65e1ce", "html_url": "https://github.com/rust-lang/rust/commit/f0eb4b4752424233e64b19ae242c052eaa65e1ce"}, {"sha": "ce56e7528359b9581cac0b59080d25468d60de20", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce56e7528359b9581cac0b59080d25468d60de20", "html_url": "https://github.com/rust-lang/rust/commit/ce56e7528359b9581cac0b59080d25468d60de20"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "e66d6fdc56ac634d83741b66b6df25b98d6f42a2", "filename": "src/libstd/sys/unix/process/process_common.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs?ref=b779cbbe6806caccb73f21ac6aeba99316ca8900", "patch": "@@ -375,8 +375,12 @@ impl ChildStdio {\n \n impl fmt::Debug for Command {\n     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n-        write!(f, \"{:?}\", self.program)?;\n-        for arg in &self.args {\n+        if self.program != self.args[0] {\n+            write!(f, \"[{:?}] \", self.program)?;\n+        }\n+        write!(f, \"{:?}\", self.args[0])?;\n+\n+        for arg in &self.args[1..] {\n             write!(f, \" {:?}\", arg)?;\n         }\n         Ok(())"}, {"sha": "133d2ada2b26379b22540faaf9150ec4bb176329", "filename": "src/test/ui/command/command-argv0-debug.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-argv0-debug.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-argv0-debug.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcommand%2Fcommand-argv0-debug.rs?ref=b779cbbe6806caccb73f21ac6aeba99316ca8900", "patch": "@@ -0,0 +1,24 @@\n+// run-pass\n+\n+// ignore-windows - this is a unix-specific test\n+// ignore-cloudabi no processes\n+// ignore-emscripten no processes\n+// ignore-sgx no processes\n+#![feature(process_set_argv0)]\n+\n+use std::os::unix::process::CommandExt;\n+use std::process::Command;\n+\n+fn main() {\n+    let mut command = Command::new(\"some-boring-name\");\n+\n+    assert_eq!(format!(\"{:?}\", command), r#\"\"some-boring-name\"\"#);\n+\n+    command.args(&[\"1\", \"2\", \"3\"]);\n+\n+    assert_eq!(format!(\"{:?}\", command), r#\"\"some-boring-name\" \"1\" \"2\" \"3\"\"#);\n+\n+    command.arg0(\"exciting-name\");\n+\n+    assert_eq!(format!(\"{:?}\", command), r#\"[\"some-boring-name\"] \"exciting-name\" \"1\" \"2\" \"3\"\"#);\n+}"}, {"sha": "56a9fb4d39125d9855543368fb11f603fe18e2a4", "filename": "src/test/ui/command/command-argv0.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-argv0.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-argv0.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcommand%2Fcommand-argv0.rs?ref=b779cbbe6806caccb73f21ac6aeba99316ca8900", "previous_filename": "src/test/ui/command-argv0.rs"}, {"sha": "568be67abe372bf106e50f3ca9b4b598abf8d75c", "filename": "src/test/ui/command/command-exec.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-exec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-exec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcommand%2Fcommand-exec.rs?ref=b779cbbe6806caccb73f21ac6aeba99316ca8900", "previous_filename": "src/test/ui/command-exec.rs"}, {"sha": "c0fc554183a43fa1262d94c5eeeed7d2590a50fa", "filename": "src/test/ui/command/command-pre-exec.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-pre-exec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-pre-exec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcommand%2Fcommand-pre-exec.rs?ref=b779cbbe6806caccb73f21ac6aeba99316ca8900", "previous_filename": "src/test/ui/command-pre-exec.rs"}, {"sha": "f867106c35d0789f289f9e8482fb8f7ce2dd9373", "filename": "src/test/ui/command/command-uid-gid.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-uid-gid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b779cbbe6806caccb73f21ac6aeba99316ca8900/src%2Ftest%2Fui%2Fcommand%2Fcommand-uid-gid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcommand%2Fcommand-uid-gid.rs?ref=b779cbbe6806caccb73f21ac6aeba99316ca8900", "previous_filename": "src/test/ui/command-uid-gid.rs"}]}