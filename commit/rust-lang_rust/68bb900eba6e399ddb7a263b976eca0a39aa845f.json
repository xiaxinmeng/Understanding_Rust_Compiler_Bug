{"sha": "68bb900eba6e399ddb7a263b976eca0a39aa845f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4YmI5MDBlYmE2ZTM5OWRkYjdhMjYzYjk3NmVjYTBhMzlhYTg0NWY=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-12-04T06:26:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-12-04T06:26:29Z"}, "message": "Merge pull request #3473 from lucasloisp/additional-bool-comparisons\n\nAdds inequality cases to bool comparison (#3438)", "tree": {"sha": "2466fd57df8c6967456affe38da2cbdd2ede61d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2466fd57df8c6967456affe38da2cbdd2ede61d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68bb900eba6e399ddb7a263b976eca0a39aa845f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcBh4VCRBK7hj4Ov3rIwAAdHIIACmn3C2C9hUfe1Bl2LuLjlsP\n4gm6Pzn6OEoMYKfq2WIuNrhSnuKG424shUE+NXWOgWe7fEv0nyW94Dc32g6NErtZ\nfC1bdrHRD0d+yjVyIlor2ZZRv+s3HTjjSgKPuasc8lTmVHAkb2R4kvqSjjxdS2Fb\nDFEaEAQlJjV1GlwHJW8bJnu2Ox1Xk1ElfRcnpL5TXuisOHyKNu7dhCTs4N41XyZt\nJ+QOxijL3gNu+pntOIlW/UxxZw38tcQalIGaeiSwIg80V2uAbjou3xOYZIENXyKV\nbsDc3PJPyhNkhHDKMgww5Mg79KDfDZzilwoW46dgnBaWTya3MTr6WPzT4SOldss=\n=79yd\n-----END PGP SIGNATURE-----\n", "payload": "tree 2466fd57df8c6967456affe38da2cbdd2ede61d8\nparent 8b2eb06df30edeec2046f919dd359b5b86077d6a\nparent 393014805986a1360d9b2ec4fd54137839777dbe\nauthor Philipp Hansch <dev@phansch.net> 1543904789 +0100\ncommitter GitHub <noreply@github.com> 1543904789 +0100\n\nMerge pull request #3473 from lucasloisp/additional-bool-comparisons\n\nAdds inequality cases to bool comparison (#3438)"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68bb900eba6e399ddb7a263b976eca0a39aa845f", "html_url": "https://github.com/rust-lang/rust/commit/68bb900eba6e399ddb7a263b976eca0a39aa845f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68bb900eba6e399ddb7a263b976eca0a39aa845f/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b2eb06df30edeec2046f919dd359b5b86077d6a", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b2eb06df30edeec2046f919dd359b5b86077d6a", "html_url": "https://github.com/rust-lang/rust/commit/8b2eb06df30edeec2046f919dd359b5b86077d6a"}, {"sha": "393014805986a1360d9b2ec4fd54137839777dbe", "url": "https://api.github.com/repos/rust-lang/rust/commits/393014805986a1360d9b2ec4fd54137839777dbe", "html_url": "https://github.com/rust-lang/rust/commit/393014805986a1360d9b2ec4fd54137839777dbe"}], "stats": {"total": 160, "additions": 95, "deletions": 65}, "files": [{"sha": "3bb87fbf5e92119a824901f8a41fde2dd70d640a", "filename": "clippy_lints/src/needless_bool.rs", "status": "modified", "additions": 66, "deletions": 64, "changes": 130, "blob_url": "https://github.com/rust-lang/rust/blob/68bb900eba6e399ddb7a263b976eca0a39aa845f/clippy_lints%2Fsrc%2Fneedless_bool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68bb900eba6e399ddb7a263b976eca0a39aa845f/clippy_lints%2Fsrc%2Fneedless_bool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_bool.rs?ref=68bb900eba6e399ddb7a263b976eca0a39aa845f", "patch": "@@ -18,7 +18,7 @@ use crate::rustc_errors::Applicability;\n use crate::syntax::ast::LitKind;\n use crate::syntax::source_map::Spanned;\n use crate::utils::sugg::Sugg;\n-use crate::utils::{in_macro, snippet_with_applicability, span_lint, span_lint_and_sugg};\n+use crate::utils::{in_macro, span_lint, span_lint_and_sugg};\n \n /// **What it does:** Checks for expressions of the form `if c { true } else {\n /// false }`\n@@ -45,8 +45,8 @@ declare_clippy_lint! {\n     \"if-statements with plain booleans in the then- and else-clause, e.g. `if p { true } else { false }`\"\n }\n \n-/// **What it does:** Checks for expressions of the form `x == true` (or vice\n-/// versa) and suggest using the variable directly.\n+/// **What it does:** Checks for expressions of the form `x == true` and\n+/// `x != true` (or vice versa) and suggest using the variable directly.\n ///\n /// **Why is this bad?** Unnecessary code.\n ///\n@@ -59,7 +59,7 @@ declare_clippy_lint! {\n declare_clippy_lint! {\n     pub BOOL_COMPARISON,\n     complexity,\n-    \"comparing a variable to a boolean, e.g. `if x == true`\"\n+    \"comparing a variable to a boolean, e.g. `if x == true` or `if x != true`\"\n }\n \n #[derive(Copy, Clone)]\n@@ -138,76 +138,78 @@ impl LintPass for BoolComparison {\n \n impl<'a, 'tcx> LateLintPass<'a, 'tcx> for BoolComparison {\n     fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, e: &'tcx Expr) {\n-        use self::Expression::*;\n-\n         if in_macro(e.span) {\n             return;\n         }\n \n-        if let ExprKind::Binary(\n-            Spanned {\n-                node: BinOpKind::Eq, ..\n-            },\n-            ref left_side,\n-            ref right_side,\n-        ) = e.node\n-        {\n-            let mut applicability = Applicability::MachineApplicable;\n-            match (fetch_bool_expr(left_side), fetch_bool_expr(right_side)) {\n-                (Bool(true), Other) => {\n-                    let hint = snippet_with_applicability(cx, right_side.span, \"..\", &mut applicability);\n-                    span_lint_and_sugg(\n-                        cx,\n-                        BOOL_COMPARISON,\n-                        e.span,\n-                        \"equality checks against true are unnecessary\",\n-                        \"try simplifying it as shown\",\n-                        hint.to_string(),\n-                        applicability,\n-                    );\n-                },\n-                (Other, Bool(true)) => {\n-                    let hint = snippet_with_applicability(cx, left_side.span, \"..\", &mut applicability);\n-                    span_lint_and_sugg(\n-                        cx,\n-                        BOOL_COMPARISON,\n-                        e.span,\n-                        \"equality checks against true are unnecessary\",\n-                        \"try simplifying it as shown\",\n-                        hint.to_string(),\n-                        applicability,\n-                    );\n-                },\n-                (Bool(false), Other) => {\n-                    let hint = Sugg::hir_with_applicability(cx, right_side, \"..\", &mut applicability);\n-                    span_lint_and_sugg(\n-                        cx,\n-                        BOOL_COMPARISON,\n-                        e.span,\n-                        \"equality checks against false can be replaced by a negation\",\n-                        \"try simplifying it as shown\",\n-                        (!hint).to_string(),\n-                        applicability,\n-                    );\n-                },\n-                (Other, Bool(false)) => {\n-                    let hint = Sugg::hir_with_applicability(cx, left_side, \"..\", &mut applicability);\n-                    span_lint_and_sugg(\n-                        cx,\n-                        BOOL_COMPARISON,\n-                        e.span,\n-                        \"equality checks against false can be replaced by a negation\",\n-                        \"try simplifying it as shown\",\n-                        (!hint).to_string(),\n-                        applicability,\n-                    );\n-                },\n+        if let ExprKind::Binary(Spanned { node, .. }, ..) = e.node {\n+            match node {\n+                BinOpKind::Eq => check_comparison(\n+                    cx,\n+                    e,\n+                    \"equality checks against true are unnecessary\",\n+                    \"equality checks against false can be replaced by a negation\",\n+                    |h| h,\n+                    |h| !h,\n+                ),\n+                BinOpKind::Ne => check_comparison(\n+                    cx,\n+                    e,\n+                    \"inequality checks against true can be replaced by a negation\",\n+                    \"inequality checks against false are unnecessary\",\n+                    |h| !h,\n+                    |h| h,\n+                ),\n                 _ => (),\n             }\n         }\n     }\n }\n \n+fn check_comparison<'a, 'tcx>(\n+    cx: &LateContext<'a, 'tcx>,\n+    e: &'tcx Expr,\n+    true_message: &str,\n+    false_message: &str,\n+    true_hint: impl FnOnce(Sugg<'_>) -> Sugg<'_>,\n+    false_hint: impl FnOnce(Sugg<'_>) -> Sugg<'_>,\n+) {\n+    use self::Expression::*;\n+\n+    if let ExprKind::Binary(_, ref left_side, ref right_side) = e.node {\n+        let applicability = Applicability::MachineApplicable;\n+        match (fetch_bool_expr(left_side), fetch_bool_expr(right_side)) {\n+            (Bool(true), Other) => suggest_bool_comparison(cx, e, right_side, applicability, true_message, true_hint),\n+            (Other, Bool(true)) => suggest_bool_comparison(cx, e, left_side, applicability, true_message, true_hint),\n+            (Bool(false), Other) => {\n+                suggest_bool_comparison(cx, e, right_side, applicability, false_message, false_hint)\n+            },\n+            (Other, Bool(false)) => suggest_bool_comparison(cx, e, left_side, applicability, false_message, false_hint),\n+            _ => (),\n+        }\n+    }\n+}\n+\n+fn suggest_bool_comparison<'a, 'tcx>(\n+    cx: &LateContext<'a, 'tcx>,\n+    e: &'tcx Expr,\n+    expr: &Expr,\n+    mut applicability: Applicability,\n+    message: &str,\n+    conv_hint: impl FnOnce(Sugg<'_>) -> Sugg<'_>,\n+) {\n+    let hint = Sugg::hir_with_applicability(cx, expr, \"..\", &mut applicability);\n+    span_lint_and_sugg(\n+        cx,\n+        BOOL_COMPARISON,\n+        e.span,\n+        message,\n+        \"try simplifying it as shown\",\n+        conv_hint(hint).to_string(),\n+        applicability,\n+    );\n+}\n+\n enum Expression {\n     Bool(bool),\n     RetBool(bool),"}, {"sha": "8ab8b3f928139a2ed90efa6a947c9ee9b7b0d25a", "filename": "tests/ui/bool_comparison.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/68bb900eba6e399ddb7a263b976eca0a39aa845f/tests%2Fui%2Fbool_comparison.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68bb900eba6e399ddb7a263b976eca0a39aa845f/tests%2Fui%2Fbool_comparison.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbool_comparison.rs?ref=68bb900eba6e399ddb7a263b976eca0a39aa845f", "patch": "@@ -18,4 +18,8 @@ fn main() {\n     if x == false { \"yes\" } else { \"no\" };\n     if true == x { \"yes\" } else { \"no\" };\n     if false == x { \"yes\" } else { \"no\" };\n+    if x != true { \"yes\" } else { \"no\" };\n+    if x != false { \"yes\" } else { \"no\" };\n+    if true != x { \"yes\" } else { \"no\" };\n+    if false != x { \"yes\" } else { \"no\" };\n }"}, {"sha": "b4a1545b49e68cdcae8a3ad1fc797594012874ea", "filename": "tests/ui/bool_comparison.stderr", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/68bb900eba6e399ddb7a263b976eca0a39aa845f/tests%2Fui%2Fbool_comparison.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/68bb900eba6e399ddb7a263b976eca0a39aa845f/tests%2Fui%2Fbool_comparison.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbool_comparison.stderr?ref=68bb900eba6e399ddb7a263b976eca0a39aa845f", "patch": "@@ -24,5 +24,29 @@ error: equality checks against false can be replaced by a negation\n 20 |     if false == x { \"yes\" } else { \"no\" };\n    |        ^^^^^^^^^^ help: try simplifying it as shown: `!x`\n \n-error: aborting due to 4 previous errors\n+error: inequality checks against true can be replaced by a negation\n+  --> $DIR/bool_comparison.rs:21:8\n+   |\n+21 |     if x != true { \"yes\" } else { \"no\" };\n+   |        ^^^^^^^^^ help: try simplifying it as shown: `!x`\n+\n+error: inequality checks against false are unnecessary\n+  --> $DIR/bool_comparison.rs:22:8\n+   |\n+22 |     if x != false { \"yes\" } else { \"no\" };\n+   |        ^^^^^^^^^^ help: try simplifying it as shown: `x`\n+\n+error: inequality checks against true can be replaced by a negation\n+  --> $DIR/bool_comparison.rs:23:8\n+   |\n+23 |     if true != x { \"yes\" } else { \"no\" };\n+   |        ^^^^^^^^^ help: try simplifying it as shown: `!x`\n+\n+error: inequality checks against false are unnecessary\n+  --> $DIR/bool_comparison.rs:24:8\n+   |\n+24 |     if false != x { \"yes\" } else { \"no\" };\n+   |        ^^^^^^^^^^ help: try simplifying it as shown: `x`\n+\n+error: aborting due to 8 previous errors\n "}]}