{"sha": "b28e403c6ca1f87e452955df8d6be976805bd771", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyOGU0MDNjNmNhMWY4N2U0NTI5NTVkZjhkNmJlOTc2ODA1YmQ3NzE=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-04-10T10:58:21Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-04-10T10:58:21Z"}, "message": "Merge #1130\n\n1130: Use inline snapshots in complete_fn_param r=matklad a=vipentti\n\nRelates to #1127 \n\nCo-authored-by: Ville Penttinen <villem.penttinen@gmail.com>", "tree": {"sha": "efba4cc07c6d2cd53e42bcfa6fb388246007371f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/efba4cc07c6d2cd53e42bcfa6fb388246007371f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b28e403c6ca1f87e452955df8d6be976805bd771", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b28e403c6ca1f87e452955df8d6be976805bd771", "html_url": "https://github.com/rust-lang/rust/commit/b28e403c6ca1f87e452955df8d6be976805bd771", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b28e403c6ca1f87e452955df8d6be976805bd771/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "37eb12f2dd6f36570a27b4e4aaf9048860b5a06b", "url": "https://api.github.com/repos/rust-lang/rust/commits/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b", "html_url": "https://github.com/rust-lang/rust/commit/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b"}, {"sha": "1b19c1c8f218d0c23e78a14b80845bf7c2cfd32c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b19c1c8f218d0c23e78a14b80845bf7c2cfd32c", "html_url": "https://github.com/rust-lang/rust/commit/1b19c1c8f218d0c23e78a14b80845bf7c2cfd32c"}], "stats": {"total": 130, "additions": 58, "deletions": 72}, "files": [{"sha": "85ef62f52f304d2d8bf459bee78cb8c8025b9281", "filename": "crates/ra_ide_api/src/completion/complete_fn_param.rs", "status": "modified", "additions": 58, "deletions": 27, "changes": 85, "blob_url": "https://github.com/rust-lang/rust/blob/b28e403c6ca1f87e452955df8d6be976805bd771/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b28e403c6ca1f87e452955df8d6be976805bd771/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs?ref=b28e403c6ca1f87e452955df8d6be976805bd771", "patch": "@@ -54,48 +54,79 @@ pub(super) fn complete_fn_param(acc: &mut Completions, ctx: &CompletionContext)\n \n #[cfg(test)]\n mod tests {\n-    use crate::completion::{check_completion, CompletionKind};\n+    use crate::completion::{do_completion, CompletionItem, CompletionKind};\n+    use insta::assert_debug_snapshot_matches;\n \n-    fn check_magic_completion(name: &str, code: &str) {\n-        check_completion(name, code, CompletionKind::Magic);\n+    fn do_magic_completion(code: &str) -> Vec<CompletionItem> {\n+        do_completion(code, CompletionKind::Magic)\n     }\n \n     #[test]\n     fn test_param_completion_last_param() {\n-        check_magic_completion(\n-            \"param_completion_last_param\",\n-            r\"\n-            fn foo(file_id: FileId) {}\n-            fn bar(file_id: FileId) {}\n-            fn baz(file<|>) {}\n-            \",\n+        assert_debug_snapshot_matches!(\n+        do_magic_completion(\n+                r\"\n+                fn foo(file_id: FileId) {}\n+                fn bar(file_id: FileId) {}\n+                fn baz(file<|>) {}\n+                \",\n+        ),\n+            @r###\"[\n+    CompletionItem {\n+        label: \"file_id: FileId\",\n+        source_range: [110; 114),\n+        delete: [110; 114),\n+        insert: \"file_id: FileId\",\n+        lookup: \"file_id\"\n+    }\n+]\"###\n         );\n     }\n \n     #[test]\n     fn test_param_completion_nth_param() {\n-        check_magic_completion(\n-            \"param_completion_nth_param\",\n-            r\"\n-            fn foo(file_id: FileId) {}\n-            fn bar(file_id: FileId) {}\n-            fn baz(file<|>, x: i32) {}\n-            \",\n+        assert_debug_snapshot_matches!(\n+        do_magic_completion(\n+                r\"\n+                fn foo(file_id: FileId) {}\n+                fn bar(file_id: FileId) {}\n+                fn baz(file<|>, x: i32) {}\n+                \",\n+        ),\n+            @r###\"[\n+    CompletionItem {\n+        label: \"file_id: FileId\",\n+        source_range: [110; 114),\n+        delete: [110; 114),\n+        insert: \"file_id: FileId\",\n+        lookup: \"file_id\"\n+    }\n+]\"###\n         );\n     }\n \n     #[test]\n     fn test_param_completion_trait_param() {\n-        check_magic_completion(\n-            \"param_completion_trait_param\",\n-            r\"\n-            pub(crate) trait SourceRoot {\n-                pub fn contains(&self, file_id: FileId) -> bool;\n-                pub fn module_map(&self) -> &ModuleMap;\n-                pub fn lines(&self, file_id: FileId) -> &LineIndex;\n-                pub fn syntax(&self, file<|>)\n-            }\n-            \",\n+        assert_debug_snapshot_matches!(\n+        do_magic_completion(\n+                r\"\n+                pub(crate) trait SourceRoot {\n+                    pub fn contains(&self, file_id: FileId) -> bool;\n+                    pub fn module_map(&self) -> &ModuleMap;\n+                    pub fn lines(&self, file_id: FileId) -> &LineIndex;\n+                    pub fn syntax(&self, file<|>)\n+                }\n+                \",\n+        ),\n+            @r###\"[\n+    CompletionItem {\n+        label: \"file_id: FileId\",\n+        source_range: [289; 293),\n+        delete: [289; 293),\n+        insert: \"file_id: FileId\",\n+        lookup: \"file_id\"\n+    }\n+]\"###\n         );\n     }\n }"}, {"sha": "cab77f5a257ac6b969234a6ddecafa362610295f", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__param_completion_last_param.snap", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_last_param.snap", "raw_url": "https://github.com/rust-lang/rust/raw/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_last_param.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_last_param.snap?ref=37eb12f2dd6f36570a27b4e4aaf9048860b5a06b", "patch": "@@ -1,15 +0,0 @@\n----\n-created: \"2019-02-18T09:22:23.949634602Z\"\n-creator: insta@0.6.2\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"file_id: FileId\",\n-        source_range: [98; 102),\n-        delete: [98; 102),\n-        insert: \"file_id: FileId\",\n-        lookup: \"file_id\"\n-    }\n-]"}, {"sha": "8fbee160c303abb000e8a8a270af811403cba029", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__param_completion_nth_param.snap", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_nth_param.snap", "raw_url": "https://github.com/rust-lang/rust/raw/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_nth_param.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_nth_param.snap?ref=37eb12f2dd6f36570a27b4e4aaf9048860b5a06b", "patch": "@@ -1,15 +0,0 @@\n----\n-created: \"2019-02-18T09:22:23.949634355Z\"\n-creator: insta@0.6.2\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"file_id: FileId\",\n-        source_range: [98; 102),\n-        delete: [98; 102),\n-        insert: \"file_id: FileId\",\n-        lookup: \"file_id\"\n-    }\n-]"}, {"sha": "76eeadb6db9e2d0f3c44362df9c4fcdd88fd934c", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__param_completion_trait_param.snap", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_trait_param.snap", "raw_url": "https://github.com/rust-lang/rust/raw/37eb12f2dd6f36570a27b4e4aaf9048860b5a06b/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_trait_param.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_trait_param.snap?ref=37eb12f2dd6f36570a27b4e4aaf9048860b5a06b", "patch": "@@ -1,15 +0,0 @@\n----\n-created: \"2019-02-18T09:22:23.974417169Z\"\n-creator: insta@0.6.2\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"file_id: FileId\",\n-        source_range: [269; 273),\n-        delete: [269; 273),\n-        insert: \"file_id: FileId\",\n-        lookup: \"file_id\"\n-    }\n-]"}]}