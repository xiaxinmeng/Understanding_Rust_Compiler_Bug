{"sha": "c63b6349b44019146cc2edcef8141692891b9401", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2M2I2MzQ5YjQ0MDE5MTQ2Y2MyZWRjZWY4MTQxNjkyODkxYjk0MDE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-05T14:04:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-05T14:04:31Z"}, "message": "Auto merge of #3635 - matthiaskrgr:revert_random_state_3603, r=xfix\n\nRevert the random_state lint.\n\nRemove the random_state lint until it or rustc has been fixed to no longer crash with debug assertions (see #3628)\nWe can't update clippy in the rustc repo because of this which is blocking nightlies because toolstate is already broken.\n\nfixes #3628", "tree": {"sha": "cb1a9c05a0521e08fd462f1a5e046d1f8ca1a6ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb1a9c05a0521e08fd462f1a5e046d1f8ca1a6ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c63b6349b44019146cc2edcef8141692891b9401", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c63b6349b44019146cc2edcef8141692891b9401", "html_url": "https://github.com/rust-lang/rust/commit/c63b6349b44019146cc2edcef8141692891b9401", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c63b6349b44019146cc2edcef8141692891b9401/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05467abd2481a2d2437c77bc988735e8f4f610f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/05467abd2481a2d2437c77bc988735e8f4f610f9", "html_url": "https://github.com/rust-lang/rust/commit/05467abd2481a2d2437c77bc988735e8f4f610f9"}, {"sha": "8ff4a1f0a82be971ecadfdba0066fd448db2a8b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ff4a1f0a82be971ecadfdba0066fd448db2a8b3", "html_url": "https://github.com/rust-lang/rust/commit/8ff4a1f0a82be971ecadfdba0066fd448db2a8b3"}], "stats": {"total": 105, "additions": 1, "deletions": 104}, "files": [{"sha": "efa637b185cda991a085e29a6047a204ef257244", "filename": "CHANGELOG.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c63b6349b44019146cc2edcef8141692891b9401/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/c63b6349b44019146cc2edcef8141692891b9401/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=c63b6349b44019146cc2edcef8141692891b9401", "patch": "@@ -814,7 +814,6 @@ All notable changes to this project will be documented in this file.\n [`ptr_offset_with_cast`]: https://rust-lang.github.io/rust-clippy/master/index.html#ptr_offset_with_cast\n [`pub_enum_variant_names`]: https://rust-lang.github.io/rust-clippy/master/index.html#pub_enum_variant_names\n [`question_mark`]: https://rust-lang.github.io/rust-clippy/master/index.html#question_mark\n-[`random_state`]: https://rust-lang.github.io/rust-clippy/master/index.html#random_state\n [`range_minus_one`]: https://rust-lang.github.io/rust-clippy/master/index.html#range_minus_one\n [`range_plus_one`]: https://rust-lang.github.io/rust-clippy/master/index.html#range_plus_one\n [`range_step_by_zero`]: https://rust-lang.github.io/rust-clippy/master/index.html#range_step_by_zero"}, {"sha": "be54424dc38114dbcc238fa30d1981f96b6dce48", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c63b6349b44019146cc2edcef8141692891b9401/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/c63b6349b44019146cc2edcef8141692891b9401/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=c63b6349b44019146cc2edcef8141692891b9401", "patch": "@@ -7,7 +7,7 @@\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are 291 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n+[There are 290 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "2e515cc8aea6042b180c0d33133f44165693f052", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c63b6349b44019146cc2edcef8141692891b9401/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c63b6349b44019146cc2edcef8141692891b9401/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=c63b6349b44019146cc2edcef8141692891b9401", "patch": "@@ -180,7 +180,6 @@ pub mod precedence;\n pub mod ptr;\n pub mod ptr_offset_with_cast;\n pub mod question_mark;\n-pub mod random_state;\n pub mod ranges;\n pub mod redundant_clone;\n pub mod redundant_field_names;\n@@ -487,7 +486,6 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n     reg.register_late_lint_pass(box ptr_offset_with_cast::Pass);\n     reg.register_late_lint_pass(box redundant_clone::RedundantClone);\n     reg.register_late_lint_pass(box slow_vector_initialization::Pass);\n-    reg.register_late_lint_pass(box random_state::Pass);\n \n     reg.register_lint_group(\"clippy::restriction\", Some(\"clippy_restriction\"), vec![\n         arithmetic::FLOAT_ARITHMETIC,\n@@ -1027,7 +1025,6 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n         fallible_impl_from::FALLIBLE_IMPL_FROM,\n         mutex_atomic::MUTEX_INTEGER,\n         needless_borrow::NEEDLESS_BORROW,\n-        random_state::RANDOM_STATE,\n         redundant_clone::REDUNDANT_CLONE,\n         unwrap::PANICKING_UNWRAP,\n         unwrap::UNNECESSARY_UNWRAP,"}, {"sha": "f95116c04b6d9078c902d15c0c042efe45d7bd71", "filename": "clippy_lints/src/random_state.rs", "status": "removed", "additions": 0, "deletions": 50, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/05467abd2481a2d2437c77bc988735e8f4f610f9/clippy_lints%2Fsrc%2Frandom_state.rs", "raw_url": "https://github.com/rust-lang/rust/raw/05467abd2481a2d2437c77bc988735e8f4f610f9/clippy_lints%2Fsrc%2Frandom_state.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Frandom_state.rs?ref=05467abd2481a2d2437c77bc988735e8f4f610f9", "patch": "@@ -1,50 +0,0 @@\n-use crate::utils::{match_type, paths, span_lint};\n-use rustc::hir::Ty;\n-use rustc::lint::{LateContext, LateLintPass, LintArray, LintPass};\n-use rustc::ty::subst::UnpackedKind;\n-use rustc::ty::TyKind;\n-use rustc::{declare_tool_lint, lint_array};\n-\n-/// **What it does:** Checks for usage of `RandomState`\n-///\n-/// **Why is this bad?** Some applications don't need collision prevention\n-/// which lowers the performance.\n-///\n-/// **Known problems:** None.\n-///\n-/// **Example:**\n-/// ```rust\n-/// fn x() {\n-///     let mut map = std::collections::HashMap::new();\n-///     map.insert(3, 4);\n-/// }\n-/// ```\n-declare_clippy_lint! {\n-    pub RANDOM_STATE,\n-    nursery,\n-    \"use of RandomState\"\n-}\n-\n-pub struct Pass;\n-\n-impl LintPass for Pass {\n-    fn get_lints(&self) -> LintArray {\n-        lint_array!(RANDOM_STATE)\n-    }\n-}\n-\n-impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n-    fn check_ty(&mut self, cx: &LateContext<'a, 'tcx>, ty: &Ty) {\n-        if let Some(tys) = cx.tables.node_id_to_type_opt(ty.hir_id) {\n-            if let TyKind::Adt(_, substs) = tys.sty {\n-                for subst in substs {\n-                    if let UnpackedKind::Type(build_hasher) = subst.unpack() {\n-                        if match_type(cx, build_hasher, &paths::RANDOM_STATE) {\n-                            span_lint(cx, RANDOM_STATE, ty.span, \"usage of RandomState\");\n-                        }\n-                    }\n-                }\n-            }\n-        }\n-    }\n-}"}, {"sha": "0779d77936f52f4dbd7cf8c164d54244fc54e036", "filename": "clippy_lints/src/utils/paths.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c63b6349b44019146cc2edcef8141692891b9401/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c63b6349b44019146cc2edcef8141692891b9401/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fpaths.rs?ref=c63b6349b44019146cc2edcef8141692891b9401", "patch": "@@ -73,7 +73,6 @@ pub const PATH_BUF: [&str; 3] = [\"std\", \"path\", \"PathBuf\"];\n pub const PATH_TO_PATH_BUF: [&str; 4] = [\"std\", \"path\", \"Path\", \"to_path_buf\"];\n pub const PTR_NULL: [&str; 2] = [\"ptr\", \"null\"];\n pub const PTR_NULL_MUT: [&str; 2] = [\"ptr\", \"null_mut\"];\n-pub const RANDOM_STATE: [&str; 5] = [\"std\", \"collections\", \"hash\", \"map\", \"RandomState\"];\n pub const RANGE: [&str; 3] = [\"core\", \"ops\", \"Range\"];\n pub const RANGE_ARGUMENT_TRAIT: [&str; 3] = [\"core\", \"ops\", \"RangeBounds\"];\n pub const RANGE_FROM: [&str; 3] = [\"core\", \"ops\", \"RangeFrom\"];"}, {"sha": "8b6c6557b4947e4335ccb641bf1665d5d0401623", "filename": "tests/run-pass/used_underscore_binding_macro.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c63b6349b44019146cc2edcef8141692891b9401/tests%2Frun-pass%2Fused_underscore_binding_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c63b6349b44019146cc2edcef8141692891b9401/tests%2Frun-pass%2Fused_underscore_binding_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fused_underscore_binding_macro.rs?ref=c63b6349b44019146cc2edcef8141692891b9401", "patch": "@@ -8,7 +8,6 @@\n // except according to those terms.\n \n #![allow(clippy::useless_attribute)] //issue #2910\n-#![allow(clippy::random_state)] // issue #3628\n \n #[macro_use]\n extern crate serde_derive;"}, {"sha": "f4fa85997a828f6974127512a977756bdfe421ee", "filename": "tests/ui/random_state.rs", "status": "removed", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/05467abd2481a2d2437c77bc988735e8f4f610f9/tests%2Fui%2Frandom_state.rs", "raw_url": "https://github.com/rust-lang/rust/raw/05467abd2481a2d2437c77bc988735e8f4f610f9/tests%2Fui%2Frandom_state.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frandom_state.rs?ref=05467abd2481a2d2437c77bc988735e8f4f610f9", "patch": "@@ -1,19 +0,0 @@\n-#![warn(clippy::random_state)]\n-\n-use std::collections::hash_map::RandomState;\n-use std::collections::hash_map::{DefaultHasher, HashMap};\n-use std::hash::BuildHasherDefault;\n-\n-fn main() {\n-    // Should warn\n-    let mut map = HashMap::new();\n-    map.insert(3, 4);\n-    let mut map = HashMap::with_hasher(RandomState::new());\n-    map.insert(true, false);\n-    let _map: HashMap<_, _> = vec![(2, 3)].into_iter().collect();\n-    let _vec: Vec<HashMap<i32, i32>>;\n-    // Shouldn't warn\n-    let _map: HashMap<i32, i32, BuildHasherDefault<DefaultHasher>> = HashMap::default();\n-    let mut map = HashMap::with_hasher(BuildHasherDefault::<DefaultHasher>::default());\n-    map.insert(\"a\", \"b\");\n-}"}, {"sha": "df224bf0c298c00fc4ebdd1a7de222d15defb0a9", "filename": "tests/ui/random_state.stderr", "status": "removed", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/05467abd2481a2d2437c77bc988735e8f4f610f9/tests%2Fui%2Frandom_state.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/05467abd2481a2d2437c77bc988735e8f4f610f9/tests%2Fui%2Frandom_state.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frandom_state.stderr?ref=05467abd2481a2d2437c77bc988735e8f4f610f9", "patch": "@@ -1,28 +0,0 @@\n-error: usage of RandomState\n-  --> $DIR/random_state.rs:9:19\n-   |\n-LL |     let mut map = HashMap::new();\n-   |                   ^^^^^^^^^^^^\n-   |\n-   = note: `-D clippy::random-state` implied by `-D warnings`\n-\n-error: usage of RandomState\n-  --> $DIR/random_state.rs:11:19\n-   |\n-LL |     let mut map = HashMap::with_hasher(RandomState::new());\n-   |                   ^^^^^^^^^^^^^^^^^^^^\n-\n-error: usage of RandomState\n-  --> $DIR/random_state.rs:13:15\n-   |\n-LL |     let _map: HashMap<_, _> = vec![(2, 3)].into_iter().collect();\n-   |               ^^^^^^^^^^^^^\n-\n-error: usage of RandomState\n-  --> $DIR/random_state.rs:14:19\n-   |\n-LL |     let _vec: Vec<HashMap<i32, i32>>;\n-   |                   ^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to 4 previous errors\n-"}]}