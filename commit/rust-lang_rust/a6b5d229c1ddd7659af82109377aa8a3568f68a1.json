{"sha": "a6b5d229c1ddd7659af82109377aa8a3568f68a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2YjVkMjI5YzFkZGQ3NjU5YWY4MjEwOTM3N2FhOGEzNTY4ZjY4YTE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-27T08:15:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-27T08:15:27Z"}, "message": "Auto merge of #62147 - Centril:rollup-pigazoz, r=alexcrichton\n\n[CI] Rollup of 5 pull requests\n\nSuccessful merges:\n\n - #62140 (ci: Turn off PR builds on Travis)\n - #62141 (ci: Disable assertions in PR builds)\n - #62142 (ci: Switch official `try` builds to happen on Azure)\n - #62143 (ci: Publish toolstate changes from Azure)\n - #62145 (ci: Sync AppVeyor/Travis with Azure configuration)\n\nFailed merges:\n\nr? @ghost", "tree": {"sha": "98359e2e98a4f1fcf00fcaf0a83e291cd10b9e6e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98359e2e98a4f1fcf00fcaf0a83e291cd10b9e6e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a6b5d229c1ddd7659af82109377aa8a3568f68a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a6b5d229c1ddd7659af82109377aa8a3568f68a1", "html_url": "https://github.com/rust-lang/rust/commit/a6b5d229c1ddd7659af82109377aa8a3568f68a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a6b5d229c1ddd7659af82109377aa8a3568f68a1/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3e2cec29225a46298ec4ebf082f34ebd7cfeecf", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3e2cec29225a46298ec4ebf082f34ebd7cfeecf", "html_url": "https://github.com/rust-lang/rust/commit/d3e2cec29225a46298ec4ebf082f34ebd7cfeecf"}, {"sha": "6772ebc27477827424fcf6297c7bfb03b52a88b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/6772ebc27477827424fcf6297c7bfb03b52a88b3", "html_url": "https://github.com/rust-lang/rust/commit/6772ebc27477827424fcf6297c7bfb03b52a88b3"}], "stats": {"total": 150, "additions": 74, "deletions": 76}, "files": [{"sha": "c2ea8b756e03cd8408673a1be1297de8f6db175b", "filename": ".azure-pipelines/auto.yml", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.azure-pipelines%2Fauto.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.azure-pipelines%2Fauto.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fauto.yml?ref=a6b5d229c1ddd7659af82109377aa8a3568f68a1", "patch": "@@ -251,10 +251,12 @@ jobs:\n         RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc\n         VCVARS_BAT: vcvars64.bat\n       # MSVC tools tests\n-      x86_64-msvc-tools:\n-        MSYS_BITS: 64\n-        SCRIPT: src/ci/docker/x86_64-gnu-tools/checktools.sh x.py /tmp/toolstates.json windows\n-        RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --save-toolstates=/tmp/toolstates.json --enable-test-miri\n+      # FIXME: broken on azure right now, need to figure out a cause and\n+      # reenable\n+      # x86_64-msvc-tools:\n+      #   MSYS_BITS: 64\n+      #   SCRIPT: src/ci/docker/x86_64-gnu-tools/checktools.sh x.py /tmp/toolstates.json windows\n+      #   RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --save-toolstates=/tmp/toolstates.json --enable-test-miri\n \n       # 32/64-bit MinGW builds.\n       #\n@@ -325,7 +327,7 @@ jobs:\n         DEPLOY: 1\n       dist-i686-mingw:\n         MSYS_BITS: 32\n-        RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-full-tools\n+        RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-full-tools --enable-profiler\n         SCRIPT: python x.py dist\n         MINGW_URL: https://rust-lang-ci2.s3.amazonaws.com/rust-ci-mirror\n         MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n@@ -335,7 +337,7 @@ jobs:\n       dist-x86_64-mingw:\n         MSYS_BITS: 64\n         SCRIPT: python x.py dist\n-        RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-full-tools\n+        RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-full-tools --enable-profiler\n         MINGW_URL: https://rust-lang-ci2.s3.amazonaws.com/rust-ci-mirror\n         MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n         MINGW_DIR: mingw64"}, {"sha": "9742c7196585113050aa91f235bfea1ee8263f47", "filename": ".azure-pipelines/master.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.azure-pipelines%2Fmaster.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.azure-pipelines%2Fmaster.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fmaster.yml?ref=a6b5d229c1ddd7659af82109377aa8a3568f68a1", "patch": "@@ -7,7 +7,7 @@ trigger:\n   - master\n \n variables:\n-- group: prod-credentials\n+- group: real-prod-credentials\n \n pool:\n   vmImage: ubuntu-16.04"}, {"sha": "6a22e57c124064a20f099448e3543364f48a9e00", "filename": ".azure-pipelines/try.yml", "status": "modified", "additions": 55, "deletions": 55, "changes": 110, "blob_url": "https://github.com/rust-lang/rust/blob/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.azure-pipelines%2Ftry.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.azure-pipelines%2Ftry.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Ftry.yml?ref=a6b5d229c1ddd7659af82109377aa8a3568f68a1", "patch": "@@ -1,13 +1,9 @@\n-#\n-# Azure Pipelines \"auto\" branch build for Rust on Linux, macOS, and Windows.\n-#\n-\n pr: none\n trigger:\n - try\n \n variables:\n-- group: prod-credentials\n+- group: real-prod-credentials\n \n jobs:\n - job: Linux\n@@ -26,53 +22,57 @@ jobs:\n         IMAGE: dist-x86_64-linux\n         DEPLOY_ALT: 1\n \n-- job: macOS\n-  timeoutInMinutes: 600\n-  pool:\n-    vmImage: macos-10.13\n-  steps:\n-  - template: steps/run.yml\n-  strategy:\n-    matrix:\n-      dist-x86_64-apple:\n-        SCRIPT: ./x.py dist\n-        RUST_CONFIGURE_ARGS: --target=aarch64-apple-ios,armv7-apple-ios,armv7s-apple-ios,i386-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --enable-lldb --set rust.jemalloc\n-        DEPLOY: 1\n-        RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-        MACOSX_DEPLOYMENT_TARGET: 10.7\n-        NO_LLVM_ASSERTIONS: 1\n-        NO_DEBUG_ASSERTIONS: 1\n-        DIST_REQUIRE_ALL_TOOLS: 1\n-\n-      dist-x86_64-apple-alt:\n-        SCRIPT: ./x.py dist\n-        RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --enable-lldb --set rust.jemalloc\n-        DEPLOY_ALT: 1\n-        RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-        MACOSX_DEPLOYMENT_TARGET: 10.7\n-        NO_LLVM_ASSERTIONS: 1\n-        NO_DEBUG_ASSERTIONS: 1\n-\n-- job: Windows\n-  timeoutInMinutes: 600\n-  pool:\n-    vmImage: 'vs2017-win2016'\n-  steps:\n-  - template: steps/run.yml\n-  strategy:\n-    matrix:\n-      dist-x86_64-msvc:\n-        RUST_CONFIGURE_ARGS: >\n-          --build=x86_64-pc-windows-msvc\n-          --target=x86_64-pc-windows-msvc,aarch64-pc-windows-msvc\n-          --enable-full-tools\n-          --enable-profiler\n-        SCRIPT: python x.py dist\n-        DIST_REQUIRE_ALL_TOOLS: 1\n-        DEPLOY: 1\n-\n-      dist-x86_64-msvc-alt:\n-        MSYS_BITS: 64\n-        RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-extended --enable-profiler\n-        SCRIPT: python x.py dist\n-        DEPLOY_ALT: 1\n+# The macOS and Windows builds here are currently disabled due to them not being\n+# overly necessary on `try` builds. We also don't actually have anything that\n+# consumes the artifacts currently. Perhaps one day we can reenable, but for now\n+# it helps free up capacity on Azure.\n+# - job: macOS\n+#   timeoutInMinutes: 600\n+#   pool:\n+#     vmImage: macos-10.13\n+#   steps:\n+#   - template: steps/run.yml\n+#   strategy:\n+#     matrix:\n+#       dist-x86_64-apple:\n+#         SCRIPT: ./x.py dist\n+#         RUST_CONFIGURE_ARGS: --target=aarch64-apple-ios,armv7-apple-ios,armv7s-apple-ios,i386-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --enable-lldb --set rust.jemalloc\n+#         DEPLOY: 1\n+#         RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+#         MACOSX_DEPLOYMENT_TARGET: 10.7\n+#         NO_LLVM_ASSERTIONS: 1\n+#         NO_DEBUG_ASSERTIONS: 1\n+#         DIST_REQUIRE_ALL_TOOLS: 1\n+#\n+#       dist-x86_64-apple-alt:\n+#         SCRIPT: ./x.py dist\n+#         RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --enable-lldb --set rust.jemalloc\n+#         DEPLOY_ALT: 1\n+#         RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+#         MACOSX_DEPLOYMENT_TARGET: 10.7\n+#         NO_LLVM_ASSERTIONS: 1\n+#         NO_DEBUG_ASSERTIONS: 1\n+#\n+# - job: Windows\n+#   timeoutInMinutes: 600\n+#   pool:\n+#     vmImage: 'vs2017-win2016'\n+#   steps:\n+#   - template: steps/run.yml\n+#   strategy:\n+#     matrix:\n+#       dist-x86_64-msvc:\n+#         RUST_CONFIGURE_ARGS: >\n+#           --build=x86_64-pc-windows-msvc\n+#           --target=x86_64-pc-windows-msvc,aarch64-pc-windows-msvc\n+#           --enable-full-tools\n+#           --enable-profiler\n+#         SCRIPT: python x.py dist\n+#         DIST_REQUIRE_ALL_TOOLS: 1\n+#         DEPLOY: 1\n+#\n+#       dist-x86_64-msvc-alt:\n+#         MSYS_BITS: 64\n+#         RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-extended --enable-profiler\n+#         SCRIPT: python x.py dist\n+#         DEPLOY_ALT: 1"}, {"sha": "dbfc6c81963b3af5e6a0384e2b0a95af83a27d53", "filename": ".travis.yml", "status": "modified", "additions": 4, "deletions": 14, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a6b5d229c1ddd7659af82109377aa8a3568f68a1/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=a6b5d229c1ddd7659af82109377aa8a3568f68a1", "patch": "@@ -22,18 +22,18 @@ matrix:\n     # Images used in testing PR and try-build should be run first.\n     - env: IMAGE=x86_64-gnu-llvm-6.0 RUST_BACKTRACE=1\n       name: x86_64-gnu-llvm-6.0\n-      if: type = pull_request OR branch = auto\n+      if: branch = auto\n \n     - env: IMAGE=dist-x86_64-linux DEPLOY=1\n       name: dist-x86_64-linux\n-      if: branch = try OR branch = auto\n+      if: branch = auto\n \n     # \"alternate\" deployments, these are \"nightlies\" but have LLVM assertions\n     # turned on, they're deployed to a different location primarily for\n     # additional testing.\n     - env: IMAGE=dist-x86_64-linux DEPLOY_ALT=1\n       name: dist-x86_64-linux-alt\n-      if: branch = try OR branch = auto\n+      if: branch = auto\n \n     - env: >\n         SCRIPT=\"./x.py dist\"\n@@ -227,17 +227,7 @@ matrix:\n       if: branch = auto\n     - env: IMAGE=mingw-check\n       name: mingw-check\n-      if: type = pull_request OR branch = auto\n-\n-    - stage: publish toolstate\n-      if: branch = master AND type = push\n-      before_install: []\n-      install: []\n-      sudo: false\n-      script:\n-        MESSAGE_FILE=$(mktemp -t msg.XXXXXX);\n-        . src/ci/docker/x86_64-gnu-tools/repo.sh;\n-        commit_toolstate_change \"$MESSAGE_FILE\" \"$TRAVIS_BUILD_DIR/src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \"$(git log --format=%s -n1 HEAD)\" \"$MESSAGE_FILE\" \"$TOOLSTATE_REPO_ACCESS_TOKEN\";\n+      if: branch = auto\n \n before_install:\n   # We'll use the AWS cli to download/upload cached docker layers as well as"}, {"sha": "ef97f59cafd83005c099a4a02c0ef60ff7bb393e", "filename": "src/ci/docker/x86_64-gnu-llvm-6.0/Dockerfile", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a6b5d229c1ddd7659af82109377aa8a3568f68a1/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-6.0%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/a6b5d229c1ddd7659af82109377aa8a3568f68a1/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-6.0%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-6.0%2FDockerfile?ref=a6b5d229c1ddd7659af82109377aa8a3568f68a1", "patch": "@@ -25,3 +25,9 @@ ENV RUST_CONFIGURE_ARGS \\\n       --llvm-root=/usr/lib/llvm-6.0 \\\n       --enable-llvm-link-shared\n ENV SCRIPT python2.7 ../x.py test src/tools/tidy && python2.7 ../x.py test\n+\n+# The purpose of this container isn't to test with debug assertions and\n+# this is run on all PRs, so let's get speedier builds by disabling these extra\n+# checks.\n+ENV NO_DEBUG_ASSERTIONS=1\n+ENV NO_LLVM_ASSERTIONS=1"}]}