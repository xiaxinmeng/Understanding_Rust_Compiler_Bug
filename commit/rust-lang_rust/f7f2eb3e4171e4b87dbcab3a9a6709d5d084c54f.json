{"sha": "f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f", "node_id": "C_kwDOAAsO6NoAKGY3ZjJlYjNlNDE3MWU0Yjg3ZGJjYWIzYTlhNjcwOWQ1ZDA4NGM1NGY", "commit": {"author": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2023-04-07T18:45:17Z"}, "committer": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2023-04-07T18:48:27Z"}, "message": "Move `FnPtrAddr` error to `SessionDiagnostic`", "tree": {"sha": "8e3275eb19094bddb404884826d6cbcec8e06f26", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e3275eb19094bddb404884826d6cbcec8e06f26"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f", "html_url": "https://github.com/rust-lang/rust/commit/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f/comments", "author": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94524020ea12f7947275063b65f8b7d705be073e", "url": "https://api.github.com/repos/rust-lang/rust/commits/94524020ea12f7947275063b65f8b7d705be073e", "html_url": "https://github.com/rust-lang/rust/commit/94524020ea12f7947275063b65f8b7d705be073e"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "e0aa27b73f62688a21ea1a642c3120eb55d07bbd", "filename": "compiler/rustc_ty_utils/messages.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f/compiler%2Frustc_ty_utils%2Fmessages.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f/compiler%2Frustc_ty_utils%2Fmessages.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fmessages.ftl?ref=f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f", "patch": "@@ -45,3 +45,5 @@ ty_utils_control_flow_not_supported = control flow is not supported in generic c\n ty_utils_inline_asm_not_supported = assembly is not supported in generic constants\n \n ty_utils_operation_not_supported = unsupported operation in generic constants\n+\n+ty_utils_unexpected_fnptr_associated_item = `FnPtr` trait with unexpected associated item"}, {"sha": "c05815d510ae36306c4f58c92d83177e9bbf3305", "filename": "compiler/rustc_ty_utils/src/errors.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f/compiler%2Frustc_ty_utils%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f/compiler%2Frustc_ty_utils%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Ferrors.rs?ref=f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f", "patch": "@@ -67,3 +67,10 @@ pub enum GenericConstantTooComplexSub {\n     #[label(ty_utils_operation_not_supported)]\n     OperationNotSupported(#[primary_span] Span),\n }\n+\n+#[derive(Diagnostic)]\n+#[diag(ty_utils_unexpected_fnptr_associated_item)]\n+pub struct UnexpectedFnPtrAssociatedItem {\n+    #[primary_span]\n+    pub span: Span,\n+}"}, {"sha": "0a6c118093e50657237e62cd9a3a177a67e13657", "filename": "compiler/rustc_ty_utils/src/instance.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f/compiler%2Frustc_ty_utils%2Fsrc%2Finstance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f/compiler%2Frustc_ty_utils%2Fsrc%2Finstance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Finstance.rs?ref=f7f2eb3e4171e4b87dbcab3a9a6709d5d084c54f", "patch": "@@ -8,6 +8,8 @@ use rustc_span::sym;\n use rustc_trait_selection::traits;\n use traits::{translate_substs, Reveal};\n \n+use crate::errors::UnexpectedFnPtrAssociatedItem;\n+\n fn resolve_instance<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     key: ty::ParamEnvAnd<'tcx, (DefId, SubstsRef<'tcx>)>,\n@@ -282,10 +284,9 @@ fn resolve_associated_item<'tcx>(\n                         substs: rcvr_substs,\n                     })\n                 } else {\n-                    tcx.sess.span_fatal(\n-                        tcx.def_span(trait_item_id),\n-                        \"`FnPtrAddr` trait with unexpected assoc item\",\n-                    )\n+                    tcx.sess.emit_fatal(UnexpectedFnPtrAssociatedItem {\n+                        span: tcx.def_span(trait_item_id),\n+                    })\n                 }\n             } else {\n                 None"}]}