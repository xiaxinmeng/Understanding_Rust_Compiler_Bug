{"sha": "7e64cebf97df021b7ece9df435e748652e0b2e83", "node_id": "C_kwDOAAsO6NoAKDdlNjRjZWJmOTdkZjAyMWI3ZWNlOWRmNDM1ZTc0ODY1MmUwYjJlODM", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-12-12T19:46:11Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-12-12T19:49:29Z"}, "message": "rustdoc: stop treating everything in a trait item as a method\n\nThis was added in 0b9b4b70683db6ef707755f520f139eb7b92a944 to fix the\nspacing on trait pages, but stopped being needed because\n791f04e5a47ee78951552c7ed1545b2b01a44c74 stopped styling method-toggle.\nBy only putting the method-toggle class on actual methods, the JS setting\ndoes the right thing.", "tree": {"sha": "aca5d99dfccea794aa55bb6b2a14e34c4dc851c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aca5d99dfccea794aa55bb6b2a14e34c4dc851c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e64cebf97df021b7ece9df435e748652e0b2e83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e64cebf97df021b7ece9df435e748652e0b2e83", "html_url": "https://github.com/rust-lang/rust/commit/7e64cebf97df021b7ece9df435e748652e0b2e83", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e64cebf97df021b7ece9df435e748652e0b2e83/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37d7de337903a558dbeb1e82c844fe915ab8ff25", "url": "https://api.github.com/repos/rust-lang/rust/commits/37d7de337903a558dbeb1e82c844fe915ab8ff25", "html_url": "https://github.com/rust-lang/rust/commit/37d7de337903a558dbeb1e82c844fe915ab8ff25"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "2f1f4cbf3592457e7972dc043e04e6b86f27c3ae", "filename": "src/librustdoc/formats/item_type.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Flibrustdoc%2Fformats%2Fitem_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Flibrustdoc%2Fformats%2Fitem_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fformats%2Fitem_type.rs?ref=7e64cebf97df021b7ece9df435e748652e0b2e83", "patch": "@@ -177,6 +177,9 @@ impl ItemType {\n             ItemType::TraitAlias => \"traitalias\",\n         }\n     }\n+    pub(crate) fn is_method(&self) -> bool {\n+        matches!(*self, ItemType::Method | ItemType::TyMethod)\n+    }\n }\n \n impl fmt::Display for ItemType {"}, {"sha": "80fbe9c1f066c6dbc139027e4235475f15318674", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=7e64cebf97df021b7ece9df435e748652e0b2e83", "patch": "@@ -1512,8 +1512,7 @@ fn render_impl(\n \n         let toggled = !doc_buffer.is_empty();\n         if toggled {\n-            let method_toggle_class =\n-                if item_type == ItemType::Method { \" method-toggle\" } else { \"\" };\n+            let method_toggle_class = if item_type.is_method() { \" method-toggle\" } else { \"\" };\n             write!(w, \"<details class=\\\"rustdoc-toggle{}\\\" open><summary>\", method_toggle_class);\n         }\n         match &*item.kind {"}, {"sha": "a7b57c373e3bec3b4a9219758d8d020f2b1a0642", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=7e64cebf97df021b7ece9df435e748652e0b2e83", "patch": "@@ -732,7 +732,8 @@ fn item_trait(w: &mut Buffer, cx: &mut Context<'_>, it: &clean::Item, t: &clean:\n         document(&mut content, cx, m, Some(t), HeadingOffset::H5);\n         let toggled = !content.is_empty();\n         if toggled {\n-            write!(w, \"<details class=\\\"rustdoc-toggle method-toggle\\\" open><summary>\");\n+            let method_toggle_class = if item_type.is_method() { \" method-toggle\" } else { \"\" };\n+            write!(w, \"<details class=\\\"rustdoc-toggle{method_toggle_class}\\\" open><summary>\");\n         }\n         write!(w, \"<section id=\\\"{}\\\" class=\\\"method has-srclink\\\">\", id);\n         render_rightside(w, cx, m, t, RenderMode::Normal);"}, {"sha": "0a1f088b9ab5c8fb830f55120be7a6fb3d6b2f64", "filename": "src/test/rustdoc/toggle-trait-fn.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Ftest%2Frustdoc%2Ftoggle-trait-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e64cebf97df021b7ece9df435e748652e0b2e83/src%2Ftest%2Frustdoc%2Ftoggle-trait-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ftoggle-trait-fn.rs?ref=7e64cebf97df021b7ece9df435e748652e0b2e83", "patch": "@@ -4,13 +4,20 @@\n // summary. Trait methods with no documentation should not be wrapped.\n //\n // @has foo/trait.Foo.html\n+// @has - '//details[@class=\"rustdoc-toggle\"]//summary//h4[@class=\"code-header\"]' 'type Item'\n+// @!has - '//details[@class=\"rustdoc-toggle\"]//summary//h4[@class=\"code-header\"]' 'type Item2'\n // @has -  '//details[@class=\"rustdoc-toggle method-toggle\"]//summary//h4[@class=\"code-header\"]' 'is_documented()'\n // @!has - '//details[@class=\"rustdoc-toggle method-toggle\"]//summary//h4[@class=\"code-header\"]' 'not_documented()'\n // @has -  '//details[@class=\"rustdoc-toggle method-toggle\"]//*[@class=\"docblock\"]' 'is_documented is documented'\n // @has -  '//details[@class=\"rustdoc-toggle method-toggle\"]//summary//h4[@class=\"code-header\"]' 'is_documented_optional()'\n // @!has - '//details[@class=\"rustdoc-toggle method-toggle\"]//summary//h4[@class=\"code-header\"]' 'not_documented_optional()'\n // @has -  '//details[@class=\"rustdoc-toggle method-toggle\"]//*[@class=\"docblock\"]' 'is_documented_optional is documented'\n pub trait Foo {\n+    /// is documented\n+    type Item;\n+\n+    type Item2;\n+\n     fn not_documented();\n \n     /// is_documented is documented"}]}