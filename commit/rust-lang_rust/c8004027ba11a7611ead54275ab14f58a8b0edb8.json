{"sha": "c8004027ba11a7611ead54275ab14f58a8b0edb8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4MDA0MDI3YmExMWE3NjExZWFkNTQyNzVhYjE0ZjU4YThiMGVkYjg=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-03-28T21:09:12Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-03-28T21:09:12Z"}, "message": "Dump graphviz dataflow results with flag", "tree": {"sha": "6d0e02406bc1289f0515d11c505b1606e2a00716", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d0e02406bc1289f0515d11c505b1606e2a00716"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c8004027ba11a7611ead54275ab14f58a8b0edb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c8004027ba11a7611ead54275ab14f58a8b0edb8", "html_url": "https://github.com/rust-lang/rust/commit/c8004027ba11a7611ead54275ab14f58a8b0edb8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c8004027ba11a7611ead54275ab14f58a8b0edb8/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "edbd7c86027c7205076832924ee7999796c2405f", "url": "https://api.github.com/repos/rust-lang/rust/commits/edbd7c86027c7205076832924ee7999796c2405f", "html_url": "https://github.com/rust-lang/rust/commit/edbd7c86027c7205076832924ee7999796c2405f"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "54263287e0228f44e0e9bde16031c8eb7a366049", "filename": "src/librustc_mir/dataflow/framework/engine.rs", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c8004027ba11a7611ead54275ab14f58a8b0edb8/src%2Flibrustc_mir%2Fdataflow%2Fframework%2Fengine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8004027ba11a7611ead54275ab14f58a8b0edb8/src%2Flibrustc_mir%2Fdataflow%2Fframework%2Fengine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fframework%2Fengine.rs?ref=c8004027ba11a7611ead54275ab14f58a8b0edb8", "patch": "@@ -15,6 +15,7 @@ use rustc_span::symbol::{sym, Symbol};\n \n use super::graphviz;\n use super::{Analysis, GenKillAnalysis, GenKillSet, Results};\n+use crate::util::pretty::dump_enabled;\n \n /// A solver for dataflow problems.\n pub struct Engine<'a, 'tcx, A>\n@@ -400,12 +401,25 @@ where\n     let attrs = match RustcMirAttrs::parse(tcx, def_id) {\n         Ok(attrs) => attrs,\n \n-        // Invalid `rustc_mir` attrs will be reported using `span_err`.\n+        // Invalid `rustc_mir` attrs are reported in `RustcMirAttrs::parse`\n         Err(()) => return Ok(()),\n     };\n \n     let path = match attrs.output_path(A::NAME) {\n         Some(path) => path,\n+\n+        None if tcx.sess.opts.debugging_opts.dump_mir_dataflow\n+            && dump_enabled(tcx, A::NAME, def_id) =>\n+        {\n+            let mut path = PathBuf::from(&tcx.sess.opts.debugging_opts.dump_mir_dir);\n+\n+            let item_name = ty::print::with_forced_impl_filename_line(|| {\n+                tcx.def_path(def_id).to_filename_friendly_no_crate()\n+            });\n+            path.push(format!(\"rustc.{}.{}.dot\", item_name, A::NAME));\n+            path\n+        }\n+\n         None => return Ok(()),\n     };\n "}]}