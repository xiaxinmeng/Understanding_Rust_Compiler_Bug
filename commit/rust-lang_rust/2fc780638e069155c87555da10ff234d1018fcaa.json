{"sha": "2fc780638e069155c87555da10ff234d1018fcaa", "node_id": "C_kwDOAAsO6NoAKDJmYzc4MDYzOGUwNjkxNTVjODc1NTVkYTEwZmYyMzRkMTAxOGZjYWE", "commit": {"author": {"name": "woppopo", "email": "woppopo@protonmail.com", "date": "2021-10-20T03:04:58Z"}, "committer": {"name": "woppopo", "email": "woppopo@protonmail.com", "date": "2021-10-20T03:04:58Z"}, "message": "Make `From` impls of NonZero integer const.\nI also changed the feature gate added to `From` impls of Atomic integer to `const_num_from_num` from `const_convert`.", "tree": {"sha": "6d8edf420149984a0fa7120ec69c2baaced01e06", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d8edf420149984a0fa7120ec69c2baaced01e06"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2fc780638e069155c87555da10ff234d1018fcaa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2fc780638e069155c87555da10ff234d1018fcaa", "html_url": "https://github.com/rust-lang/rust/commit/2fc780638e069155c87555da10ff234d1018fcaa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2fc780638e069155c87555da10ff234d1018fcaa/comments", "author": {"login": "lilasta", "id": 77098789, "node_id": "MDQ6VXNlcjc3MDk4Nzg5", "avatar_url": "https://avatars.githubusercontent.com/u/77098789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lilasta", "html_url": "https://github.com/lilasta", "followers_url": "https://api.github.com/users/lilasta/followers", "following_url": "https://api.github.com/users/lilasta/following{/other_user}", "gists_url": "https://api.github.com/users/lilasta/gists{/gist_id}", "starred_url": "https://api.github.com/users/lilasta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lilasta/subscriptions", "organizations_url": "https://api.github.com/users/lilasta/orgs", "repos_url": "https://api.github.com/users/lilasta/repos", "events_url": "https://api.github.com/users/lilasta/events{/privacy}", "received_events_url": "https://api.github.com/users/lilasta/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lilasta", "id": 77098789, "node_id": "MDQ6VXNlcjc3MDk4Nzg5", "avatar_url": "https://avatars.githubusercontent.com/u/77098789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lilasta", "html_url": "https://github.com/lilasta", "followers_url": "https://api.github.com/users/lilasta/followers", "following_url": "https://api.github.com/users/lilasta/following{/other_user}", "gists_url": "https://api.github.com/users/lilasta/gists{/gist_id}", "starred_url": "https://api.github.com/users/lilasta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lilasta/subscriptions", "organizations_url": "https://api.github.com/users/lilasta/orgs", "repos_url": "https://api.github.com/users/lilasta/repos", "events_url": "https://api.github.com/users/lilasta/events{/privacy}", "received_events_url": "https://api.github.com/users/lilasta/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42983a28ab3c70728da7a9b932b667c978dd898d", "url": "https://api.github.com/repos/rust-lang/rust/commits/42983a28ab3c70728da7a9b932b667c978dd898d", "html_url": "https://github.com/rust-lang/rust/commit/42983a28ab3c70728da7a9b932b667c978dd898d"}], "stats": {"total": 21, "additions": 13, "deletions": 8}, "files": [{"sha": "2b6ea90bf043019dd9f177fcb313716e8ab42d88", "filename": "library/core/src/convert/num.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Fconvert%2Fnum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Fconvert%2Fnum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fconvert%2Fnum.rs?ref=2fc780638e069155c87555da10ff234d1018fcaa", "patch": "@@ -390,15 +390,16 @@ use crate::num::NonZeroUsize;\n macro_rules! nzint_impl_from {\n     ($Small: ty, $Large: ty, #[$attr:meta], $doc: expr) => {\n         #[$attr]\n-        impl From<$Small> for $Large {\n+        #[rustc_const_unstable(feature = \"const_num_from_num\", issue = \"87852\")]\n+        impl const From<$Small> for $Large {\n             // Rustdocs on the impl block show a \"[+] show undocumented items\" toggle.\n             // Rustdocs on functions do not.\n             #[doc = $doc]\n             #[inline]\n             fn from(small: $Small) -> Self {\n                 // SAFETY: input type guarantees the value is non-zero\n                 unsafe {\n-                    Self::new_unchecked(small.get().into())\n+                    Self::new_unchecked(From::from(small.get()))\n                 }\n             }\n         }"}, {"sha": "58a170401e7c123c5f08c97b164877022dfd2133", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=2fc780638e069155c87555da10ff234d1018fcaa", "patch": "@@ -115,6 +115,7 @@\n #![feature(const_likely)]\n #![feature(const_maybe_uninit_as_ptr)]\n #![feature(const_maybe_uninit_assume_init)]\n+#![feature(const_num_from_num)]\n #![feature(const_option)]\n #![feature(const_pin)]\n #![feature(const_replace)]"}, {"sha": "9b1a4de5d80378ce7016c058f575f6f481241cff", "filename": "library/core/src/num/nonzero.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs?ref=2fc780638e069155c87555da10ff234d1018fcaa", "patch": "@@ -82,7 +82,7 @@ macro_rules! nonzero_integers {\n             }\n \n             #[stable(feature = \"from_nonzero\", since = \"1.31.0\")]\n-            #[rustc_const_unstable(feature = \"const_convert\", issue = \"88674\")]\n+            #[rustc_const_unstable(feature = \"const_num_from_num\", issue = \"87852\")]\n             impl const From<$Ty> for $Int {\n                 #[doc = concat!(\"Converts a `\", stringify!($Ty), \"` into an `\", stringify!($Int), \"`\")]\n                 #[inline]"}, {"sha": "1dd3b2d8e3c8d8c2ae4a0202aa090e64c96a16de", "filename": "library/core/src/sync/atomic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs?ref=2fc780638e069155c87555da10ff234d1018fcaa", "patch": "@@ -1365,7 +1365,7 @@ macro_rules! atomic_int {\n         }\n \n         #[$stable_from]\n-        #[rustc_const_unstable(feature = \"const_convert\", issue = \"88674\")]\n+        #[rustc_const_unstable(feature = \"const_num_from_num\", issue = \"87852\")]\n         impl const From<$int_type> for $atomic_type {\n             #[doc = concat!(\"Converts an `\", stringify!($int_type), \"` into an `\", stringify!($atomic_type), \"`.\")]\n             #[inline]"}, {"sha": "a0ca919a851c36c15762c45e1001263f769dffe2", "filename": "library/core/tests/nonzero.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Ftests%2Fnonzero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fc780638e069155c87555da10ff234d1018fcaa/library%2Fcore%2Ftests%2Fnonzero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fnonzero.rs?ref=2fc780638e069155c87555da10ff234d1018fcaa", "patch": "@@ -204,9 +204,9 @@ fn nonzero_const() {\n     // test that the methods of `NonZeroX>` are usable in a const context\n     // Note: only tests NonZero8\n \n-    const NONZERO: NonZeroU8 = unsafe { NonZeroU8::new_unchecked(5) };\n+    const NONZERO_U8: NonZeroU8 = unsafe { NonZeroU8::new_unchecked(5) };\n \n-    const GET: u8 = NONZERO.get();\n+    const GET: u8 = NONZERO_U8.get();\n     assert_eq!(GET, 5);\n \n     const ZERO: Option<NonZeroU8> = NonZeroU8::new(0);\n@@ -215,8 +215,11 @@ fn nonzero_const() {\n     const ONE: Option<NonZeroU8> = NonZeroU8::new(1);\n     assert!(ONE.is_some());\n \n-    const FROM_NONZERO: u8 = u8::from(NONZERO);\n-    assert_eq!(FROM_NONZERO, 5);\n+    const FROM_NONZERO_U8: u8 = u8::from(NONZERO_U8);\n+    assert_eq!(FROM_NONZERO_U8, 5);\n+\n+    const NONZERO_CONVERT: NonZeroU32 = NonZeroU32::from(NONZERO_U8);\n+    assert_eq!(NONZERO_CONVERT.get(), 5);\n }\n \n #[test]"}]}