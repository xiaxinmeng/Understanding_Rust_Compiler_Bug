{"sha": "f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyYWYyY2ZmMGZhMTZhYWEyNzcyNDFmNmE4YzhkYmQ5YzIwNWM0YTg=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-03-13T19:03:33Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-13T19:03:33Z"}, "message": "Rollup merge of #69960 - RalfJung:abort, r=oli-obk\n\nmiri engine: fix treatment of abort intrinsic\n\nI screwed up in https://github.com/rust-lang/rust/pull/69830 and added `abort` to the wrong block of intrinsics, namely the one that actually has a return place. So that branch was never actually reached.\n\nr? @oli-obk", "tree": {"sha": "c2717937fed0f56ec56e89ae9808010b8fcf610e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2717937fed0f56ec56e89ae9808010b8fcf610e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJea9kFCRBK7hj4Ov3rIwAAdHIIAAvAsA9Lj4Ci4hgOfvxTHBnQ\nky+mpuy5fhEg5D2xRTPyrpAfadZA6Xl8ozVZF4FRa2rczJ/B3eWfVVtYKfEyZ4wG\nWtC6Qlb2j/50FZeOVPmuS5VZV9T+HFrjltm7A77Z8vUM5aPnhj6JrpQ0XNJ+qptg\nlEwpAJPH44q3Mkx+NDVQc5sQQ7/B55h4D11YkSmr44qlTTaIeSN002IjEu6kaoza\nPzYb2an+/4BsLxEgnYlSMXGyQwYEwgK8JHzb3HG3w6ZMG+KRs5YBPCNX6NyiMYaF\n5/HQvhA32HIMk0LBjgaK8vnq2h/YihrtOtru2l2GbuXz7qxA453RqzcGnXQ4psM=\n=lNqZ\n-----END PGP SIGNATURE-----\n", "payload": "tree c2717937fed0f56ec56e89ae9808010b8fcf610e\nparent 77263db96f30a5bc2c4b74d0546803ad9d79b865\nparent 13ea774513131b8102f35cb105cc17f39eb1b947\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1584126213 +0900\ncommitter GitHub <noreply@github.com> 1584126213 +0900\n\nRollup merge of #69960 - RalfJung:abort, r=oli-obk\n\nmiri engine: fix treatment of abort intrinsic\n\nI screwed up in https://github.com/rust-lang/rust/pull/69830 and added `abort` to the wrong block of intrinsics, namely the one that actually has a return place. So that branch was never actually reached.\n\nr? @oli-obk\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8", "html_url": "https://github.com/rust-lang/rust/commit/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "77263db96f30a5bc2c4b74d0546803ad9d79b865", "url": "https://api.github.com/repos/rust-lang/rust/commits/77263db96f30a5bc2c4b74d0546803ad9d79b865", "html_url": "https://github.com/rust-lang/rust/commit/77263db96f30a5bc2c4b74d0546803ad9d79b865"}, {"sha": "13ea774513131b8102f35cb105cc17f39eb1b947", "url": "https://api.github.com/repos/rust-lang/rust/commits/13ea774513131b8102f35cb105cc17f39eb1b947", "html_url": "https://github.com/rust-lang/rust/commit/13ea774513131b8102f35cb105cc17f39eb1b947"}], "stats": {"total": 15, "additions": 6, "deletions": 9}, "files": [{"sha": "37a60bcc8368d35fb62b49124478b2af34a4ab67", "filename": "src/librustc_mir/interpret/intrinsics.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8/src%2Flibrustc_mir%2Finterpret%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8/src%2Flibrustc_mir%2Finterpret%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fintrinsics.rs?ref=f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8", "patch": "@@ -84,14 +84,15 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n         let substs = instance.substs;\n         let intrinsic_name = self.tcx.item_name(instance.def_id());\n \n-        // We currently do not handle any intrinsics that are *allowed* to diverge,\n-        // but `transmute` could lack a return place in case of UB.\n+        // First handle intrinsics without return place.\n         let (dest, ret) = match ret {\n-            Some(p) => p,\n             None => match intrinsic_name {\n-                sym::transmute => throw_ub!(Unreachable),\n+                sym::transmute => throw_ub_format!(\"transmuting to uninhabited type\"),\n+                sym::abort => M::abort(self)?,\n+                // Unsupported diverging intrinsic.\n                 _ => return Ok(false),\n             },\n+            Some(p) => p,\n         };\n \n         // Keep the patterns in this match ordered the same as the list in\n@@ -103,10 +104,6 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                 self.write_scalar(location.ptr, dest)?;\n             }\n \n-            sym::abort => {\n-                M::abort(self)?;\n-            }\n-\n             sym::min_align_of\n             | sym::pref_align_of\n             | sym::needs_drop"}, {"sha": "cede356a6b8a190ba48585677ee7b83174b45575", "filename": "src/test/ui/consts/const-eval/validate_uninhabited_zsts.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fvalidate_uninhabited_zsts.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fvalidate_uninhabited_zsts.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fvalidate_uninhabited_zsts.stderr?ref=f2af2cff0fa16aaa277241f6a8c8dbd9c205c4a8", "patch": "@@ -4,7 +4,7 @@ warning: any use of this value will cause an error\n LL |     unsafe { std::mem::transmute(()) }\n    |              ^^^^^^^^^^^^^^^^^^^^^^^\n    |              |\n-   |              entering unreachable code\n+   |              transmuting to uninhabited type\n    |              inside call to `foo` at $DIR/validate_uninhabited_zsts.rs:14:26\n ...\n LL | const FOO: [Empty; 3] = [foo(); 3];"}]}