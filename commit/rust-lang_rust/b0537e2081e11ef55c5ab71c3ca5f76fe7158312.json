{"sha": "b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIwNTM3ZTIwODFlMTFlZjU1YzVhYjcxYzNjYTVmNzZmZTcxNTgzMTI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-03-17T08:37:59Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-03-24T05:28:55Z"}, "message": "generic_extension: defatalize Error case", "tree": {"sha": "05d58275a5d0be8fef6d6d0d3c8b6f312984cc89", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/05d58275a5d0be8fef6d6d0d3c8b6f312984cc89"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "html_url": "https://github.com/rust-lang/rust/commit/b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7909b22b5ef31a9cc847be58f50cdf268c7b854", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7909b22b5ef31a9cc847be58f50cdf268c7b854", "html_url": "https://github.com/rust-lang/rust/commit/b7909b22b5ef31a9cc847be58f50cdf268c7b854"}], "stats": {"total": 41, "additions": 32, "deletions": 9}, "files": [{"sha": "9d6f5e75faadb1429a9ba07dcbe60e317b1dd387", "filename": "src/librustc_expand/mbe/macro_rules.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Flibrustc_expand%2Fmbe%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Flibrustc_expand%2Fmbe%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_expand%2Fmbe%2Fmacro_rules.rs?ref=b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "patch": "@@ -293,7 +293,11 @@ fn generic_extension<'cx>(\n                 Some((ref best_token, _)) if best_token.span.lo() >= token.span.lo() => {}\n                 _ => best_failure = Some((token, msg)),\n             },\n-            Error(err_sp, ref msg) => cx.span_fatal(err_sp.substitute_dummy(sp), &msg[..]),\n+            Error(err_sp, ref msg) => {\n+                let span = err_sp.substitute_dummy(sp);\n+                cx.struct_span_err(span, &msg).emit();\n+                return DummyResult::any(span);\n+            }\n         }\n \n         // The matcher was not `Success(..)`ful."}, {"sha": "b23e5c71c03f06e29245481dbfa775b0b3c57874", "filename": "src/test/ui/macros/macro-match-nonterminal.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fmacros%2Fmacro-match-nonterminal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fmacros%2Fmacro-match-nonterminal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-match-nonterminal.rs?ref=b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "patch": "@@ -1,4 +1,11 @@\n-macro_rules! test { ($a, $b) => (()); } //~ ERROR missing fragment\n+macro_rules! test {\n+    ($a, $b) => {\n+        //~^ ERROR missing fragment\n+        //~| ERROR missing fragment\n+        //~| WARN this was previously accepted\n+        ()\n+    };\n+}\n \n fn main() {\n     test!()"}, {"sha": "674ce3434aac63fd9446e23a30c91f34fe2c3271", "filename": "src/test/ui/macros/macro-match-nonterminal.stderr", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fmacros%2Fmacro-match-nonterminal.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fmacros%2Fmacro-match-nonterminal.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-match-nonterminal.stderr?ref=b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "patch": "@@ -1,8 +1,18 @@\n error: missing fragment specifier\n-  --> $DIR/macro-match-nonterminal.rs:1:24\n+  --> $DIR/macro-match-nonterminal.rs:2:8\n    |\n-LL | macro_rules! test { ($a, $b) => (()); }\n-   |                        ^\n+LL |     ($a, $b) => {\n+   |        ^\n \n-error: aborting due to previous error\n+error: missing fragment specifier\n+  --> $DIR/macro-match-nonterminal.rs:2:10\n+   |\n+LL |     ($a, $b) => {\n+   |          ^^\n+   |\n+   = note: `#[deny(missing_fragment_specifier)]` on by default\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #40107 <https://github.com/rust-lang/rust/issues/40107>\n+\n+error: aborting due to 2 previous errors\n "}, {"sha": "e32825ad3e06449a4fe23e8d3e1ee9160c2b86a9", "filename": "src/test/ui/parser/macro/issue-33569.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-33569.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-33569.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-33569.rs?ref=b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "patch": "@@ -1,3 +1,5 @@\n+fn main() {}\n+\n macro_rules! foo {\n     { $+ } => { //~ ERROR expected identifier, found `+`\n                 //~^ ERROR missing fragment specifier"}, {"sha": "a08d26095f5643891fa5da143ee7f4b6e88cf8d5", "filename": "src/test/ui/parser/macro/issue-33569.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-33569.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b0537e2081e11ef55c5ab71c3ca5f76fe7158312/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-33569.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-33569.stderr?ref=b0537e2081e11ef55c5ab71c3ca5f76fe7158312", "patch": "@@ -1,17 +1,17 @@\n error: expected identifier, found `+`\n-  --> $DIR/issue-33569.rs:2:8\n+  --> $DIR/issue-33569.rs:4:8\n    |\n LL |     { $+ } => {\n    |        ^\n \n error: expected one of: `*`, `+`, or `?`\n-  --> $DIR/issue-33569.rs:4:13\n+  --> $DIR/issue-33569.rs:6:13\n    |\n LL |         $(x)(y)\n    |             ^^^\n \n error: missing fragment specifier\n-  --> $DIR/issue-33569.rs:2:8\n+  --> $DIR/issue-33569.rs:4:8\n    |\n LL |     { $+ } => {\n    |        ^"}]}