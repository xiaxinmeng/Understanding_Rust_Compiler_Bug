{"sha": "7ddd353ef693bd19b5058f89d01529407d6aa926", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkZGQzNTNlZjY5M2JkMTliNTA1OGY4OWQwMTUyOTQwN2Q2YWE5MjY=", "commit": {"author": {"name": "Graham Fawcett", "email": "fawcett@uwindsor.ca", "date": "2011-12-15T20:25:29Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-12-16T23:29:59Z"}, "message": "implement #[nolink]; deprecate #[link_name = \"\"]; note in stdlib to remove empty link_name.\n\nCan't remove them from stdlib until the snapshotted compiler supports #[nolink].", "tree": {"sha": "e325f66296361160773b4ac1b216d5e965f00e94", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e325f66296361160773b4ac1b216d5e965f00e94"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7ddd353ef693bd19b5058f89d01529407d6aa926", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7ddd353ef693bd19b5058f89d01529407d6aa926", "html_url": "https://github.com/rust-lang/rust/commit/7ddd353ef693bd19b5058f89d01529407d6aa926", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7ddd353ef693bd19b5058f89d01529407d6aa926/comments", "author": {"login": "gmfawcett", "id": 49970, "node_id": "MDQ6VXNlcjQ5OTcw", "avatar_url": "https://avatars.githubusercontent.com/u/49970?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmfawcett", "html_url": "https://github.com/gmfawcett", "followers_url": "https://api.github.com/users/gmfawcett/followers", "following_url": "https://api.github.com/users/gmfawcett/following{/other_user}", "gists_url": "https://api.github.com/users/gmfawcett/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmfawcett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmfawcett/subscriptions", "organizations_url": "https://api.github.com/users/gmfawcett/orgs", "repos_url": "https://api.github.com/users/gmfawcett/repos", "events_url": "https://api.github.com/users/gmfawcett/events{/privacy}", "received_events_url": "https://api.github.com/users/gmfawcett/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8dc5c445cc7a37d6e0dc37ce93b763b7460adf8e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8dc5c445cc7a37d6e0dc37ce93b763b7460adf8e", "html_url": "https://github.com/rust-lang/rust/commit/8dc5c445cc7a37d6e0dc37ce93b763b7460adf8e"}], "stats": {"total": 53, "additions": 34, "deletions": 19}, "files": [{"sha": "248da6edef48893431ee958c52f406ed9c9cc22a", "filename": "doc/tutorial/ffi.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/doc%2Ftutorial%2Fffi.md", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/doc%2Ftutorial%2Fffi.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Ftutorial%2Fffi.md?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -189,7 +189,7 @@ microsecond-resolution timer.\n     use std;\n     type timeval = {mutable tv_sec: u32,\n                     mutable tv_usec: u32};\n-    #[link_name = \"\"]\n+    #[nolink]\n     native mod libc {\n         fn gettimeofday(tv: *timeval, tz: *()) -> i32;\n     }\n@@ -199,7 +199,7 @@ microsecond-resolution timer.\n         ret (x.tv_sec as u64) * 1000_000_u64 + (x.tv_usec as u64);\n     }\n \n-The `#[link_name = \"\"]` sets the name of the native module to the\n+The `#[nolink]` sets the name of the native module to the\n empty string to prevent the rust compiler from trying to link it.\n The standard C library is already linked with Rust programs.\n "}, {"sha": "a79329ea5a3dcc4485ef6d0bb01016512b2243ac", "filename": "src/comp/metadata/creader.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Fcomp%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Fcomp%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fcreader.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -57,12 +57,20 @@ fn visit_item(e: env, i: @ast::item) {\n           }\n           either::left(msg) { e.sess.span_fatal(i.span, msg); }\n         }\n+\n         let cstore = e.sess.get_cstore();\n         let native_name = i.ident;\n+        if vec::len(attr::find_attrs_by_name(i.attrs, \"nolink\")) > 0u {\n+            ret;\n+        }\n         alt attr::get_meta_item_value_str_by_name(i.attrs, \"link_name\") {\n           some(nn) { native_name = nn; }\n           none. { }\n         }\n+        if native_name == \"\" {\n+            e.sess.span_fatal(i.span,\n+                \"empty #[link_name] not allowed; use #[nolink].\");\n+        }\n         if !cstore::add_used_library(cstore, native_name) { ret; }\n         for a: ast::attribute in\n             attr::find_attrs_by_name(i.attrs, \"link_args\") {"}, {"sha": "b1e2692584c74ad6482e0e9862bca8f2cac260cc", "filename": "src/comp/metadata/cstore.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Fcomp%2Fmetadata%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Fcomp%2Fmetadata%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fcstore.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -93,7 +93,6 @@ fn add_used_library(cstore: cstore, lib: str) -> bool {\n     if lib == \"\" { ret false; }\n \n     if vec::member(lib, p(cstore).used_libraries) { ret false; }\n-\n     p(cstore).used_libraries += [lib];\n     ret true;\n }"}, {"sha": "e5b13a7cfc2a6ad0f2c267a4aafe3fced490712a", "filename": "src/libstd/linux_os.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Flibstd%2Flinux_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Flibstd%2Flinux_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flinux_os.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -24,7 +24,8 @@ export fsync_fd;\n // FIXME Somehow merge stuff duplicated here and macosx_os.rs. Made difficult\n // by https://github.com/graydon/rust/issues#issue/268\n \n-#[link_name = \"\"]\n+#[link_name = \"\"]               // FIXME remove after #[nolink] is snapshotted\n+#[nolink]\n #[abi = \"cdecl\"]\n native mod libc {\n     fn read(fd: fd_t, buf: *u8, count: size_t) -> ssize_t;"}, {"sha": "37a7d0ff95f2ff68206a2361552d76af2c6e1b44", "filename": "src/libstd/macos_os.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Flibstd%2Fmacos_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Flibstd%2Fmacos_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fmacos_os.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -18,7 +18,7 @@ export fsync_fd;\n // FIXME Refactor into unix_os module or some such. Doesn't\n // seem to work right now.\n \n-#[link_name = \"\"]\n+#[nolink]\n #[abi = \"cdecl\"]\n native mod libc {\n     fn read(fd: fd_t, buf: *u8, count: size_t) -> ssize_t;\n@@ -118,7 +118,8 @@ native mod rustrt {\n \n fn getcwd() -> str { ret rustrt::rust_getcwd(); }\n \n-#[link_name = \"\"]\n+#[link_name = \"\"]               // FIXME remove after #[nolink] is snapshotted\n+#[nolink]\n #[abi = \"cdecl\"]\n native mod mac_libc {\n     fn _NSGetExecutablePath(buf: str::sbuf,"}, {"sha": "825f4ffa0ebd26b2338f4ac668a9df5c1451754c", "filename": "src/libstd/win32_os.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Flibstd%2Fwin32_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Flibstd%2Fwin32_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fwin32_os.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -2,7 +2,8 @@ import core::option;\n import ctypes::*;\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[link_name = \"\"]               // FIXME remove after #[nolink] is snapshotted\n+#[nolink]\n native mod libc {\n     fn read(fd: fd_t, buf: *u8, count: size_t) -> ssize_t;\n     fn write(fd: fd_t, buf: *u8, count: size_t) -> ssize_t;"}, {"sha": "cf4daa6b2ec0dbd682951622b44f47df64e91aa8", "filename": "src/test/bench/shootout-nbody.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Fbench%2Fshootout-nbody.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Fbench%2Fshootout-nbody.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fshootout-nbody.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -2,7 +2,7 @@\n // http://shootout.alioth.debian.org/u32/benchmark.php?test=nbody&lang=java\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod llvm {\n     fn sqrt(n: float) -> float;\n }"}, {"sha": "1e04913884bf084b66df5606a67e7d3350856284", "filename": "src/test/compile-fail/empty-linkname.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Fcompile-fail%2Fempty-linkname.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Fcompile-fail%2Fempty-linkname.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fempty-linkname.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -0,0 +1,5 @@\n+// error-pattern:empty #[link_name] not allowed; use #[nolink].\n+\n+#[link_name = \"\"]\n+native mod foo {\n+}"}, {"sha": "2984f97813b66ed7a029db5ffad517c22ef38c97", "filename": "src/test/run-pass/bind-native-fn.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fbind-native-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fbind-native-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fbind-native-fn.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -5,7 +5,7 @@ use std;\n import str;\n import ctypes::*;\n \n-#[link_name = \"\"]\n+#[nolink]\n native mod libc {\n     fn write(fd: c_int, buf: *u8, nbyte: size_t);\n }"}, {"sha": "56469dbb17262c71411aef3641c82a76a2814494", "filename": "src/test/run-pass/binops.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fbinops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fbinops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fbinops.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -118,7 +118,7 @@ fn test_fn() {\n }\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod test {\n     fn do_gc();\n     fn unsupervise();"}, {"sha": "66c79290e4726c2aacb3f04eceb860425767733b", "filename": "src/test/run-pass/c-stack-returning-int64.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fc-stack-returning-int64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fc-stack-returning-int64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fc-stack-returning-int64.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -2,7 +2,7 @@ use std;\n import str;\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod libc {\n     fn atol(x: str::sbuf) -> int;\n     fn atoll(x: str::sbuf) -> i64;"}, {"sha": "24a15e284d4e91f4ada1df178c0c1d083753bed6", "filename": "src/test/run-pass/import-glob-1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fimport-glob-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fimport-glob-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fimport-glob-1.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -21,7 +21,7 @@ mod a1 {\n mod a2 {\n     //   |   |   |\n     #[abi = \"cdecl\"]\n-    #[link_name = \"\"]\n+    #[nolink]\n     native mod b1 {\n         //   |   |   |\n         import a1::b2::*;"}, {"sha": "72d0ab01f96617535a1972450e60790d76ecc3c6", "filename": "src/test/run-pass/native-fn-linkname.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fnative-fn-linkname.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fnative-fn-linkname.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fnative-fn-linkname.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -3,7 +3,7 @@ use std;\n import vec;\n import str;\n \n-#[link_name = \"\"]\n+#[nolink]\n #[abi = \"cdecl\"]\n native mod libc {\n     #[link_name = \"strlen\"]"}, {"sha": "e91b4e684b7633d430667035346bad160e71fb54", "filename": "src/test/run-pass/native-opaque-type.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fnative-opaque-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fnative-opaque-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fnative-opaque-type.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -1,7 +1,7 @@\n \n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod libc {\n     type file_handle;\n }"}, {"sha": "359ce18090f392fe7c5b5ec4291cd4f7b3677042", "filename": "src/test/run-pass/native2.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fnative2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Frun-pass%2Fnative2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fnative2.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -6,21 +6,21 @@ native mod rustrt {\n }\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod bar { }\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod zed { }\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod libc {\n     fn write(fd: int, buf: *u8, count: uint) -> int;\n }\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]\n+#[nolink]\n native mod baz { }\n \n fn main(args: [str]) { }"}, {"sha": "65a6fc9c0bee12299286d92facc03e7b435035ed", "filename": "src/test/stdtest/c_vec.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Fstdtest%2Fc_vec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ddd353ef693bd19b5058f89d01529407d6aa926/src%2Ftest%2Fstdtest%2Fc_vec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fstdtest%2Fc_vec.rs?ref=7ddd353ef693bd19b5058f89d01529407d6aa926", "patch": "@@ -5,7 +5,7 @@ use std;\n import std::c_vec::*;\n import ctypes::*;\n \n-#[link_name = \"\"]\n+#[nolink]\n #[abi = \"cdecl\"]\n native mod libc {\n     fn malloc(n: size_t) -> *mutable u8;"}]}