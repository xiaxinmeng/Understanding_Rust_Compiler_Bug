{"sha": "2a40918928818bdaa8bdc3780ce5d6449bb69f85", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhNDA5MTg5Mjg4MThiZGFhOGJkYzM3ODBjZTVkNjQ0OWJiNjlmODU=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2017-02-28T10:17:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-02-28T10:17:14Z"}, "message": "Syntax highlighting in region infer docs", "tree": {"sha": "bc5c2706363cc9d0774d3671615fe86722c5fab2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc5c2706363cc9d0774d3671615fe86722c5fab2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a40918928818bdaa8bdc3780ce5d6449bb69f85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a40918928818bdaa8bdc3780ce5d6449bb69f85", "html_url": "https://github.com/rust-lang/rust/commit/2a40918928818bdaa8bdc3780ce5d6449bb69f85", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a40918928818bdaa8bdc3780ce5d6449bb69f85/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54a1c8b1a66ce6dd4f46fc6063612607897b2638", "url": "https://api.github.com/repos/rust-lang/rust/commits/54a1c8b1a66ce6dd4f46fc6063612607897b2638", "html_url": "https://github.com/rust-lang/rust/commit/54a1c8b1a66ce6dd4f46fc6063612607897b2638"}], "stats": {"total": 108, "additions": 59, "deletions": 49}, "files": [{"sha": "f5c254a4594076411cfc4b7845227fa7f86c0ad7", "filename": "src/librustc/infer/region_inference/README.md", "status": "modified", "additions": 59, "deletions": 49, "changes": 108, "blob_url": "https://github.com/rust-lang/rust/blob/2a40918928818bdaa8bdc3780ce5d6449bb69f85/src%2Flibrustc%2Finfer%2Fregion_inference%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/2a40918928818bdaa8bdc3780ce5d6449bb69f85/src%2Flibrustc%2Finfer%2Fregion_inference%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fregion_inference%2FREADME.md?ref=2a40918928818bdaa8bdc3780ce5d6449bb69f85", "patch": "@@ -121,17 +121,19 @@ every expression, block, and pattern (patterns are considered to\n \"execute\" by testing the value they are applied to and creating any\n relevant bindings).  So, for example:\n \n-    fn foo(x: isize, y: isize) { // -+\n-    //  +------------+           //  |\n-    //  |      +-----+           //  |\n-    //  |  +-+ +-+ +-+           //  |\n-    //  |  | | | | | |           //  |\n-    //  v  v v v v v v           //  |\n-        let z = x + y;           //  |\n-        ...                      //  |\n-    }                            // -+\n-\n-    fn bar() { ... }\n+```rust\n+fn foo(x: isize, y: isize) { // -+\n+//  +------------+           //  |\n+//  |      +-----+           //  |\n+//  |  +-+ +-+ +-+           //  |\n+//  |  | | | | | |           //  |\n+//  v  v v v v v v           //  |\n+    let z = x + y;           //  |\n+    ...                      //  |\n+}                            // -+\n+\n+fn bar() { ... }\n+```\n \n In this example, there is a region for the fn body block as a whole,\n and then a subregion for the declaration of the local variable.\n@@ -160,28 +162,32 @@ this, we get a lot of spurious errors around nested calls, in\n particular when combined with `&mut` functions. For example, a call\n like this one\n \n-    self.foo(self.bar())\n+```rust\n+self.foo(self.bar())\n+```\n \n where both `foo` and `bar` are `&mut self` functions will always yield\n an error.\n \n Here is a more involved example (which is safe) so we can see what's\n going on:\n \n-    struct Foo { f: usize, g: usize }\n-    ...\n-    fn add(p: &mut usize, v: usize) {\n-        *p += v;\n-    }\n-    ...\n-    fn inc(p: &mut usize) -> usize {\n-        *p += 1; *p\n-    }\n-    fn weird() {\n-        let mut x: Box<Foo> = box Foo { ... };\n-        'a: add(&mut (*x).f,\n-                'b: inc(&mut (*x).f)) // (..)\n-    }\n+```rust\n+struct Foo { f: usize, g: usize }\n+// ...\n+fn add(p: &mut usize, v: usize) {\n+    *p += v;\n+}\n+// ...\n+fn inc(p: &mut usize) -> usize {\n+    *p += 1; *p\n+}\n+fn weird() {\n+    let mut x: Box<Foo> = box Foo { ... };\n+    'a: add(&mut (*x).f,\n+            'b: inc(&mut (*x).f)) // (..)\n+}\n+```\n \n The important part is the line marked `(..)` which contains a call to\n `add()`. The first argument is a mutable borrow of the field `f`.  The\n@@ -197,16 +203,18 @@ can see that this error is unnecessary. Let's examine the lifetimes\n involved with `'a` in detail. We'll break apart all the steps involved\n in a call expression:\n \n-    'a: {\n-        'a_arg1: let a_temp1: ... = add;\n-        'a_arg2: let a_temp2: &'a mut usize = &'a mut (*x).f;\n-        'a_arg3: let a_temp3: usize = {\n-            let b_temp1: ... = inc;\n-            let b_temp2: &'b = &'b mut (*x).f;\n-            'b_call: b_temp1(b_temp2)\n-        };\n-        'a_call: a_temp1(a_temp2, a_temp3) // (**)\n-    }\n+```rust\n+'a: {\n+    'a_arg1: let a_temp1: ... = add;\n+    'a_arg2: let a_temp2: &'a mut usize = &'a mut (*x).f;\n+    'a_arg3: let a_temp3: usize = {\n+        let b_temp1: ... = inc;\n+        let b_temp2: &'b = &'b mut (*x).f;\n+        'b_call: b_temp1(b_temp2)\n+    };\n+    'a_call: a_temp1(a_temp2, a_temp3) // (**)\n+}\n+```\n \n Here we see that the lifetime `'a` includes a number of substatements.\n In particular, there is this lifetime I've called `'a_call` that\n@@ -225,19 +233,21 @@ it will not be *dereferenced* during the evaluation of the second\n argument, it can still be *invalidated* by that evaluation. Consider\n this similar but unsound example:\n \n-    struct Foo { f: usize, g: usize }\n-    ...\n-    fn add(p: &mut usize, v: usize) {\n-        *p += v;\n-    }\n-    ...\n-    fn consume(x: Box<Foo>) -> usize {\n-        x.f + x.g\n-    }\n-    fn weird() {\n-        let mut x: Box<Foo> = box Foo { ... };\n-        'a: add(&mut (*x).f, consume(x)) // (..)\n-    }\n+```rust\n+struct Foo { f: usize, g: usize }\n+// ...\n+fn add(p: &mut usize, v: usize) {\n+    *p += v;\n+}\n+// ...\n+fn consume(x: Box<Foo>) -> usize {\n+    x.f + x.g\n+}\n+fn weird() {\n+    let mut x: Box<Foo> = box Foo { ... };\n+    'a: add(&mut (*x).f, consume(x)) // (..)\n+}\n+```\n \n In this case, the second argument to `add` actually consumes `x`, thus\n invalidating the first argument."}]}