{"sha": "0c85f2a1bdb01666e74cd391df630da581f12ad0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBjODVmMmExYmRiMDE2NjZlNzRjZDM5MWRmNjMwZGE1ODFmMTJhZDA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-31T06:13:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-31T06:13:05Z"}, "message": "Auto merge of #38847 - michaelwoerister:gate-on-incr-comp, r=alexcrichton\n\ntravis: Gate on some minimal support for incremental compilation.\n\nThis commit adds a travis job that\n\n1. builds a stage2 compiler in incremental mode (but with empty incremental compilation cache), and\n2. builds and runs the run-pass test suite also in incremental mode.\n\nBuilding incrementally with an empty cache makes sure that the compiler doesn't crash in dependency tracking during bootstrapping. Executing the incrementally built test suite gives some measure of confidence that we generate valid code.\n\nNote, however, that the above does not give strong guarantees about the validity of incremental compilation, it just provides a basis for being able to rely on from-scratch incr. comp. builds as reference values in further tests (which then do actual incremental compilation).\n\nr? @alexcrichton", "tree": {"sha": "6c3e3884d02db1dce344890eb6464dcefdd9642b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6c3e3884d02db1dce344890eb6464dcefdd9642b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0c85f2a1bdb01666e74cd391df630da581f12ad0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0c85f2a1bdb01666e74cd391df630da581f12ad0", "html_url": "https://github.com/rust-lang/rust/commit/0c85f2a1bdb01666e74cd391df630da581f12ad0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0c85f2a1bdb01666e74cd391df630da581f12ad0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b854d74bb8d074b5080ea83fda8c9517e3903544", "url": "https://api.github.com/repos/rust-lang/rust/commits/b854d74bb8d074b5080ea83fda8c9517e3903544", "html_url": "https://github.com/rust-lang/rust/commit/b854d74bb8d074b5080ea83fda8c9517e3903544"}, {"sha": "d292e1229f1e7cc882e550d3ecc0e152720a0ab5", "url": "https://api.github.com/repos/rust-lang/rust/commits/d292e1229f1e7cc882e550d3ecc0e152720a0ab5", "html_url": "https://github.com/rust-lang/rust/commit/d292e1229f1e7cc882e550d3ecc0e152720a0ab5"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "f138b0bed2b0282a94b69e73a41689d0e4a58578", "filename": ".travis.yml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0c85f2a1bdb01666e74cd391df630da581f12ad0/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/0c85f2a1bdb01666e74cd391df630da581f12ad0/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=0c85f2a1bdb01666e74cd391df630da581f12ad0", "patch": "@@ -35,6 +35,7 @@ matrix:\n     - env: IMAGE=x86_64-gnu-make\n     - env: IMAGE=x86_64-gnu-llvm-3.7 ALLOW_PR=1 RUST_BACKTRACE=1\n     - env: IMAGE=x86_64-gnu-distcheck\n+    - env: IMAGE=x86_64-gnu-incremental\n \n     # OSX builders\n     - env: >"}, {"sha": "3e084f4a3c30289384b4affe22c0e84e8385713f", "filename": "src/ci/docker/x86_64-gnu-incremental/Dockerfile", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/0c85f2a1bdb01666e74cd391df630da581f12ad0/src%2Fci%2Fdocker%2Fx86_64-gnu-incremental%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/0c85f2a1bdb01666e74cd391df630da581f12ad0/src%2Fci%2Fdocker%2Fx86_64-gnu-incremental%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-incremental%2FDockerfile?ref=0c85f2a1bdb01666e74cd391df630da581f12ad0", "patch": "@@ -0,0 +1,27 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  gdb \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu\n+ENV RUSTFLAGS -Zincremental=/tmp/rust-incr-cache\n+ENV RUST_CHECK_TARGET check"}, {"sha": "86fa5e70c9c28322f11d651af32f51408ae82028", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0c85f2a1bdb01666e74cd391df630da581f12ad0/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c85f2a1bdb01666e74cd391df630da581f12ad0/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=0c85f2a1bdb01666e74cd391df630da581f12ad0", "patch": "@@ -2175,6 +2175,10 @@ actual:\\n\\\n            .env(\"LLVM_COMPONENTS\", &self.config.llvm_components)\n            .env(\"LLVM_CXXFLAGS\", &self.config.llvm_cxxflags);\n \n+        // We don't want RUSTFLAGS set from the outside to interfere with\n+        // compiler flags set in the test cases:\n+        cmd.env_remove(\"RUSTFLAGS\");\n+\n         if self.config.target.contains(\"msvc\") {\n             // We need to pass a path to `lib.exe`, so assume that `cc` is `cl.exe`\n             // and that `lib.exe` lives next to it."}]}