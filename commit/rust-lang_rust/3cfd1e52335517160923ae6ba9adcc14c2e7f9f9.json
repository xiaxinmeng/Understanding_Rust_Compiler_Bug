{"sha": "3cfd1e52335517160923ae6ba9adcc14c2e7f9f9", "node_id": "C_kwDOAAsO6NoAKDNjZmQxZTUyMzM1NTE3MTYwOTIzYWU2YmE5YWRjYzE0YzJlN2Y5Zjk", "commit": {"author": {"name": "Preston From", "email": "prestonfrom@gmail.com", "date": "2022-06-28T04:52:22Z"}, "committer": {"name": "Preston From", "email": "prestonfrom@gmail.com", "date": "2022-06-28T04:52:22Z"}, "message": "Make messages more accurate, check lint enabled", "tree": {"sha": "7effe629ef5d7a5f40ca145c768e4b320223d936", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7effe629ef5d7a5f40ca145c768e4b320223d936"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9", "html_url": "https://github.com/rust-lang/rust/commit/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9/comments", "author": {"login": "PrestonFrom", "id": 12164367, "node_id": "MDQ6VXNlcjEyMTY0MzY3", "avatar_url": "https://avatars.githubusercontent.com/u/12164367?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PrestonFrom", "html_url": "https://github.com/PrestonFrom", "followers_url": "https://api.github.com/users/PrestonFrom/followers", "following_url": "https://api.github.com/users/PrestonFrom/following{/other_user}", "gists_url": "https://api.github.com/users/PrestonFrom/gists{/gist_id}", "starred_url": "https://api.github.com/users/PrestonFrom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PrestonFrom/subscriptions", "organizations_url": "https://api.github.com/users/PrestonFrom/orgs", "repos_url": "https://api.github.com/users/PrestonFrom/repos", "events_url": "https://api.github.com/users/PrestonFrom/events{/privacy}", "received_events_url": "https://api.github.com/users/PrestonFrom/received_events", "type": "User", "site_admin": false}, "committer": {"login": "PrestonFrom", "id": 12164367, "node_id": "MDQ6VXNlcjEyMTY0MzY3", "avatar_url": "https://avatars.githubusercontent.com/u/12164367?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PrestonFrom", "html_url": "https://github.com/PrestonFrom", "followers_url": "https://api.github.com/users/PrestonFrom/followers", "following_url": "https://api.github.com/users/PrestonFrom/following{/other_user}", "gists_url": "https://api.github.com/users/PrestonFrom/gists{/gist_id}", "starred_url": "https://api.github.com/users/PrestonFrom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PrestonFrom/subscriptions", "organizations_url": "https://api.github.com/users/PrestonFrom/orgs", "repos_url": "https://api.github.com/users/PrestonFrom/repos", "events_url": "https://api.github.com/users/PrestonFrom/events{/privacy}", "received_events_url": "https://api.github.com/users/PrestonFrom/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f707db0bf928454b699af1a2da745dfdbdeb680", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f707db0bf928454b699af1a2da745dfdbdeb680", "html_url": "https://github.com/rust-lang/rust/commit/1f707db0bf928454b699af1a2da745dfdbdeb680"}], "stats": {"total": 195, "additions": 104, "deletions": 91}, "files": [{"sha": "7efa81226e0e900d632fadec59a5ec633af3ed62", "filename": "clippy_lints/src/matches/significant_drop_in_scrutinee.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9/clippy_lints%2Fsrc%2Fmatches%2Fsignificant_drop_in_scrutinee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9/clippy_lints%2Fsrc%2Fmatches%2Fsignificant_drop_in_scrutinee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches%2Fsignificant_drop_in_scrutinee.rs?ref=3cfd1e52335517160923ae6ba9adcc14c2e7f9f9", "patch": "@@ -1,6 +1,6 @@\n use crate::FxHashSet;\n use clippy_utils::diagnostics::span_lint_and_then;\n-use clippy_utils::get_attr;\n+use clippy_utils::{get_attr, is_lint_allowed};\n use clippy_utils::source::{indent_of, snippet};\n use rustc_errors::{Applicability, Diagnostic};\n use rustc_hir::intravisit::{walk_expr, Visitor};\n@@ -19,16 +19,18 @@ pub(super) fn check<'tcx>(\n     arms: &'tcx [Arm<'_>],\n     source: MatchSource,\n ) {\n+    if is_lint_allowed(cx, SIGNIFICANT_DROP_IN_SCRUTINEE, expr.hir_id) {\n+        return;\n+    }\n+\n     if let Some((suggestions, message)) = has_significant_drop_in_scrutinee(cx, scrutinee, source) {\n         for found in suggestions {\n             span_lint_and_then(cx, SIGNIFICANT_DROP_IN_SCRUTINEE, found.found_span, message, |diag| {\n                 set_diagnostic(diag, cx, expr, found);\n                 let s = Span::new(expr.span.hi(), expr.span.hi(), expr.span.ctxt(), None);\n-                diag.span_label(s, \"original temporary lives until here\");\n-                if let Some(spans) = has_significant_drop_in_arms(cx, arms) {\n-                    for span in spans {\n-                        diag.span_label(span, \"another temporary with significant `Drop` created here\");\n-                    }\n+                diag.span_label(s, \"temporary lives until here\");\n+                for span in has_significant_drop_in_arms(cx, arms) {\n+                    diag.span_label(span, \"another value with significant `Drop` created here\");\n                 }\n                 diag.note(\"this might lead to deadlocks or other unexpected behavior\");\n             });\n@@ -360,19 +362,19 @@ impl<'a, 'tcx> Visitor<'tcx> for SigDropHelper<'a, 'tcx> {\n \n struct ArmSigDropHelper<'a, 'tcx> {\n     sig_drop_checker: SigDropChecker<'a, 'tcx>,\n-    found_sig_drop_spans: Option<FxHashSet<Span>>,\n+    found_sig_drop_spans: FxHashSet<Span>,\n }\n \n impl<'a, 'tcx> ArmSigDropHelper<'a, 'tcx> {\n     fn new(cx: &'a LateContext<'tcx>) -> ArmSigDropHelper<'a, 'tcx> {\n         ArmSigDropHelper {\n             sig_drop_checker: SigDropChecker::new(cx),\n-            found_sig_drop_spans: None,\n+            found_sig_drop_spans: FxHashSet::<Span>::default(),\n         }\n     }\n }\n \n-fn has_significant_drop_in_arms<'tcx, 'a>(cx: &'a LateContext<'tcx>, arms: &'tcx [Arm<'_>]) -> Option<FxHashSet<Span>> {\n+fn has_significant_drop_in_arms<'tcx, 'a>(cx: &'a LateContext<'tcx>, arms: &'tcx [Arm<'_>]) -> FxHashSet<Span> {\n     let mut helper = ArmSigDropHelper::new(cx);\n     for arm in arms {\n         helper.visit_expr(arm.body);\n@@ -386,9 +388,7 @@ impl<'a, 'tcx> Visitor<'tcx> for ArmSigDropHelper<'a, 'tcx> {\n             .sig_drop_checker\n             .has_sig_drop_attr(self.sig_drop_checker.cx, self.sig_drop_checker.get_type(ex))\n         {\n-            self.found_sig_drop_spans\n-                .get_or_insert_with(FxHashSet::default)\n-                .insert(ex.span);\n+            self.found_sig_drop_spans.insert(ex.span);\n             return;\n         }\n         walk_expr(self, ex);"}, {"sha": "185e5009b60f1500db71b3e49cbad47f3cc09462", "filename": "tests/ui/significant_drop_in_scrutinee.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9/tests%2Fui%2Fsignificant_drop_in_scrutinee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9/tests%2Fui%2Fsignificant_drop_in_scrutinee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsignificant_drop_in_scrutinee.rs?ref=3cfd1e52335517160923ae6ba9adcc14c2e7f9f9", "patch": "@@ -64,6 +64,19 @@ fn should_trigger_lint_with_mutex_guard_in_match_scrutinee() {\n     };\n }\n \n+fn should_not_trigger_lint_with_mutex_guard_in_match_scrutinee_when_lint_allowed() {\n+    let mutex = Mutex::new(State {});\n+\n+    // Lint should not be triggered because it is \"allowed\" below.\n+    #[allow(clippy::significant_drop_in_scrutinee)]\n+    match mutex.lock().unwrap().foo() {\n+        true => {\n+            mutex.lock().unwrap().bar();\n+        },\n+        false => {},\n+    };\n+}\n+\n fn should_not_trigger_lint_for_insignificant_drop() {\n     // Should not trigger lint because there are no temporaries whose drops have a significant\n     // side effect."}, {"sha": "dbb41837e790e2a67455600e0993cea6caf1467e", "filename": "tests/ui/significant_drop_in_scrutinee.stderr", "status": "modified", "additions": 79, "deletions": 79, "changes": 158, "blob_url": "https://github.com/rust-lang/rust/blob/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9/tests%2Fui%2Fsignificant_drop_in_scrutinee.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3cfd1e52335517160923ae6ba9adcc14c2e7f9f9/tests%2Fui%2Fsignificant_drop_in_scrutinee.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsignificant_drop_in_scrutinee.stderr?ref=3cfd1e52335517160923ae6ba9adcc14c2e7f9f9", "patch": "@@ -5,10 +5,10 @@ LL |     match mutex.lock().unwrap().foo() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         true => {\n LL |             mutex.lock().unwrap().bar();\n-   |             --------------------- another temporary with significant `Drop` created here\n+   |             --------------------- another value with significant `Drop` created here\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: `-D clippy::significant-drop-in-scrutinee` implied by `-D warnings`\n    = note: this might lead to deadlocks or other unexpected behavior\n@@ -19,16 +19,16 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:132:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:145:11\n    |\n LL |     match s.lock_m().get_the_value() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |             println!(\"{}\", s.lock_m().get_the_value());\n-   |                            ---------- another temporary with significant `Drop` created here\n+   |                            ---------- another value with significant `Drop` created here\n ...\n LL |     }\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -38,16 +38,16 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:153:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:166:11\n    |\n LL |     match s.lock_m_m().get_the_value() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |             println!(\"{}\", s.lock_m().get_the_value());\n-   |                            ---------- another temporary with significant `Drop` created here\n+   |                            ---------- another value with significant `Drop` created here\n ...\n LL |     }\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -57,13 +57,13 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:201:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:214:11\n    |\n LL |     match counter.temp_increment().len() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -73,16 +73,16 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:224:16\n+  --> $DIR/significant_drop_in_scrutinee.rs:237:16\n    |\n LL |         match (mutex1.lock().unwrap().s.len(), true) {\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |         };\n-   |          - original temporary lives until here\n+   |          - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -92,16 +92,16 @@ LL ~         match (value, true) {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:233:22\n+  --> $DIR/significant_drop_in_scrutinee.rs:246:22\n    |\n LL |         match (true, mutex1.lock().unwrap().s.len(), true) {\n    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |         };\n-   |          - original temporary lives until here\n+   |          - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -111,18 +111,18 @@ LL ~         match (true, value, true) {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:243:16\n+  --> $DIR/significant_drop_in_scrutinee.rs:256:16\n    |\n LL |         match (mutex1.lock().unwrap().s.len(), true, mutex2.lock().unwrap().s.len()) {\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n LL |                 mutex2.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |         };\n-   |          - original temporary lives until here\n+   |          - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -132,18 +132,18 @@ LL ~         match (value, true, mutex2.lock().unwrap().s.len()) {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:243:54\n+  --> $DIR/significant_drop_in_scrutinee.rs:256:54\n    |\n LL |         match (mutex1.lock().unwrap().s.len(), true, mutex2.lock().unwrap().s.len()) {\n    |                                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n LL |                 mutex2.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |         };\n-   |          - original temporary lives until here\n+   |          - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -153,48 +153,48 @@ LL ~         match (mutex1.lock().unwrap().s.len(), true, value) {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:254:15\n+  --> $DIR/significant_drop_in_scrutinee.rs:267:15\n    |\n LL |         match mutex3.lock().unwrap().s.as_str() {\n    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n LL |                 mutex2.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |         };\n-   |          - original temporary lives until here\n+   |          - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:264:22\n+  --> $DIR/significant_drop_in_scrutinee.rs:277:22\n    |\n LL |         match (true, mutex3.lock().unwrap().s.as_str()) {\n    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n LL |                 mutex2.lock().unwrap().s.len();\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |         };\n-   |          - original temporary lives until here\n+   |          - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:283:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:296:11\n    |\n LL |     match mutex.lock().unwrap().s.len() > 1 {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         true => {\n LL |             mutex.lock().unwrap().s.len();\n-   |             --------------------- another temporary with significant `Drop` created here\n+   |             --------------------- another value with significant `Drop` created here\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -204,16 +204,16 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:290:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:303:11\n    |\n LL |     match 1 < mutex.lock().unwrap().s.len() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         true => {\n LL |             mutex.lock().unwrap().s.len();\n-   |             --------------------- another temporary with significant `Drop` created here\n+   |             --------------------- another value with significant `Drop` created here\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -223,18 +223,18 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:308:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:321:11\n    |\n LL |     match mutex1.lock().unwrap().s.len() < mutex2.lock().unwrap().s.len() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len(),\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n LL |                 mutex2.lock().unwrap().s.len()\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -244,18 +244,18 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:319:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:332:11\n    |\n LL |     match mutex1.lock().unwrap().s.len() >= mutex2.lock().unwrap().s.len() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |                 mutex1.lock().unwrap().s.len(),\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n LL |                 mutex2.lock().unwrap().s.len()\n-   |                 ---------------------- another temporary with significant `Drop` created here\n+   |                 ---------------------- another value with significant `Drop` created here\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -265,16 +265,16 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:354:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:367:11\n    |\n LL |     match get_mutex_guard().s.len() > 1 {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         true => {\n LL |             mutex1.lock().unwrap().s.len();\n-   |             ---------------------- another temporary with significant `Drop` created here\n+   |             ---------------------- another value with significant `Drop` created here\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -284,7 +284,7 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:371:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:384:11\n    |\n LL |       match match i {\n    |  ___________^\n@@ -297,10 +297,10 @@ LL | |         > 1\n    | |___________^\n ...\n LL |               mutex1.lock().unwrap().s.len();\n-   |               ---------------------- another temporary with significant `Drop` created here\n+   |               ---------------------- another value with significant `Drop` created here\n ...\n LL |       };\n-   |        - original temporary lives until here\n+   |        - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -314,7 +314,7 @@ LL +     .len()\n  ...\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:397:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:410:11\n    |\n LL |       match if i > 1 {\n    |  ___________^\n@@ -327,10 +327,10 @@ LL | |         > 1\n    | |___________^\n ...\n LL |               mutex1.lock().unwrap().s.len();\n-   |               ---------------------- another temporary with significant `Drop` created here\n+   |               ---------------------- another value with significant `Drop` created here\n ...\n LL |       };\n-   |        - original temporary lives until here\n+   |        - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -344,15 +344,15 @@ LL +     .s\n  ...\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:451:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:464:11\n    |\n LL |     match s.lock().deref().deref() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         0 | 1 => println!(\"Value was less than 2\"),\n LL |         _ => println!(\"Value is {}\", s.lock().deref()),\n-   |                                      ---------------- another temporary with significant `Drop` created here\n+   |                                      ---------------- another value with significant `Drop` created here\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match and create a copy\n@@ -362,29 +362,29 @@ LL ~     match value {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:479:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:492:11\n    |\n LL |     match s.lock().deref().deref() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         matcher => println!(\"Value is {}\", s.lock().deref()),\n-   |                                            ---------------- another temporary with significant `Drop` created here\n+   |                                            ---------------- another value with significant `Drop` created here\n LL |         _ => println!(\"Value was not a match\"),\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:498:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:511:11\n    |\n LL |     match mutex.lock().unwrap().i = i {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         _ => {\n LL |             println!(\"{}\", mutex.lock().unwrap().i);\n-   |                            --------------------- another temporary with significant `Drop` created here\n+   |                            --------------------- another value with significant `Drop` created here\n LL |         },\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -394,16 +394,16 @@ LL ~     match () {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:504:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:517:11\n    |\n LL |     match i = mutex.lock().unwrap().i {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         _ => {\n LL |             println!(\"{}\", mutex.lock().unwrap().i);\n-   |                            --------------------- another temporary with significant `Drop` created here\n+   |                            --------------------- another value with significant `Drop` created here\n LL |         },\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -413,16 +413,16 @@ LL ~     match () {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:510:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:523:11\n    |\n LL |     match mutex.lock().unwrap().i += 1 {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         _ => {\n LL |             println!(\"{}\", mutex.lock().unwrap().i);\n-   |                            --------------------- another temporary with significant `Drop` created here\n+   |                            --------------------- another value with significant `Drop` created here\n LL |         },\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -432,16 +432,16 @@ LL ~     match () {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:516:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:529:11\n    |\n LL |     match i += mutex.lock().unwrap().i {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         _ => {\n LL |             println!(\"{}\", mutex.lock().unwrap().i);\n-   |                            --------------------- another temporary with significant `Drop` created here\n+   |                            --------------------- another value with significant `Drop` created here\n LL |         },\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match\n@@ -451,35 +451,35 @@ LL ~     match () {\n    |\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:579:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:592:11\n    |\n LL |     match rwlock.read().unwrap().to_number() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n \n error: temporary with significant `Drop` in `for` loop condition will live until the end of the `for` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:589:14\n+  --> $DIR/significant_drop_in_scrutinee.rs:602:14\n    |\n LL |     for s in rwlock.read().unwrap().iter() {\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         println!(\"{}\", s);\n LL |     }\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n \n error: temporary with significant `Drop` in `match` scrutinee will live until the end of the `match` expression\n-  --> $DIR/significant_drop_in_scrutinee.rs:604:11\n+  --> $DIR/significant_drop_in_scrutinee.rs:617:11\n    |\n LL |     match mutex.lock().unwrap().foo() {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n ...\n LL |     };\n-   |      - original temporary lives until here\n+   |      - temporary lives until here\n    |\n    = note: this might lead to deadlocks or other unexpected behavior\n help: try moving the temporary above the match"}]}