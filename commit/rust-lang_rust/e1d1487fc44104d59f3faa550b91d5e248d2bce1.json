{"sha": "e1d1487fc44104d59f3faa550b91d5e248d2bce1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxZDE0ODdmYzQ0MTA0ZDU5ZjNmYWE1NTBiOTFkNWUyNDhkMmJjZTE=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-12-09T19:58:51Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-12T13:17:26Z"}, "message": "resolve: Prohibit use of uniform paths in macros originating from 2015 edition\n\n...while still keeping ambiguity errors future-proofing for uniform paths.\nThis corner case is not going to be stabilized for 1.32 and needs some more general experiments about retrofitting 2018 import rules to 2015 edition", "tree": {"sha": "e146e8708a43641ec75f0e1cddb3602bcc141dd6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e146e8708a43641ec75f0e1cddb3602bcc141dd6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1d1487fc44104d59f3faa550b91d5e248d2bce1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1d1487fc44104d59f3faa550b91d5e248d2bce1", "html_url": "https://github.com/rust-lang/rust/commit/e1d1487fc44104d59f3faa550b91d5e248d2bce1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1d1487fc44104d59f3faa550b91d5e248d2bce1/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "099b3d86f92166ca5974a103e6998fdbaf6a9872", "url": "https://api.github.com/repos/rust-lang/rust/commits/099b3d86f92166ca5974a103e6998fdbaf6a9872", "html_url": "https://github.com/rust-lang/rust/commit/099b3d86f92166ca5974a103e6998fdbaf6a9872"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "b2b794c6925cffe90bcc9b96d9817ff05c4a2086", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e1d1487fc44104d59f3faa550b91d5e248d2bce1/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1d1487fc44104d59f3faa550b91d5e248d2bce1/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=e1d1487fc44104d59f3faa550b91d5e248d2bce1", "patch": "@@ -828,7 +828,7 @@ impl<'a> Resolver<'a> {\n             // but its `Def` should coincide with a crate passed with `--extern`\n             // (otherwise there would be ambiguity) and we can skip feature error in this case.\n             'ok: {\n-                if !is_import || self.session.features_untracked().uniform_paths {\n+                if !is_import || (!rust_2015 && self.session.features_untracked().uniform_paths) {\n                     break 'ok;\n                 }\n                 if ns == TypeNS && use_prelude && self.extern_prelude_get(ident, true).is_some() {\n@@ -844,10 +844,15 @@ impl<'a> Resolver<'a> {\n                     }\n                 }\n \n-                let msg = \"imports can only refer to extern crate names \\\n-                           passed with `--extern` on stable channel\";\n+                let reason = if rust_2015 {\n+                    \"in macros originating from 2015 edition\"\n+                } else {\n+                    \"on stable channel\"\n+                };\n+                let msg = format!(\"imports can only refer to extern crate names \\\n+                                   passed with `--extern` {}\", reason);\n                 let mut err = feature_err(&self.session.parse_sess, \"uniform_paths\",\n-                                          ident.span, GateIssue::Language, msg);\n+                                          ident.span, GateIssue::Language, &msg);\n \n                 let what = self.binding_description(binding, ident,\n                                                     flags.contains(Flags::MISC_FROM_PRELUDE));"}, {"sha": "3cf967dbf70e94f3114f387aaafac38486185548", "filename": "src/test/ui/editions/edition-imports-virtual-2015-gated.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e1d1487fc44104d59f3faa550b91d5e248d2bce1/src%2Ftest%2Fui%2Feditions%2Fedition-imports-virtual-2015-gated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e1d1487fc44104d59f3faa550b91d5e248d2bce1/src%2Ftest%2Fui%2Feditions%2Fedition-imports-virtual-2015-gated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Feditions%2Fedition-imports-virtual-2015-gated.stderr?ref=e1d1487fc44104d59f3faa550b91d5e248d2bce1", "patch": "@@ -1,4 +1,4 @@\n-error[E0658]: imports can only refer to extern crate names passed with `--extern` on stable channel (see issue #53130)\n+error[E0658]: imports can only refer to extern crate names passed with `--extern` in macros originating from 2015 edition (see issue #53130)\n   --> <::edition_imports_2015::gen_gated macros>:1:50\n    |\n LL | (  ) => { fn check_gated (  ) { enum E { A } use E :: * ; } }"}]}