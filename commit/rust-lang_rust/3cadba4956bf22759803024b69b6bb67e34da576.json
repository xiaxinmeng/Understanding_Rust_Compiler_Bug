{"sha": "3cadba4956bf22759803024b69b6bb67e34da576", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjYWRiYTQ5NTZiZjIyNzU5ODAzMDI0YjY5YjZiYjY3ZTM0ZGE1NzY=", "commit": {"author": {"name": "Igor Aleksanov", "email": "popzxc@yandex.ru", "date": "2020-10-03T10:44:43Z"}, "committer": {"name": "Igor Aleksanov", "email": "popzxc@yandex.ru", "date": "2020-10-03T10:44:43Z"}, "message": "Improve readability in inlay_hints.rs", "tree": {"sha": "a9d154c1920dd03e72d83f016e77eb8b652fbbc4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a9d154c1920dd03e72d83f016e77eb8b652fbbc4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3cadba4956bf22759803024b69b6bb67e34da576", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3cadba4956bf22759803024b69b6bb67e34da576", "html_url": "https://github.com/rust-lang/rust/commit/3cadba4956bf22759803024b69b6bb67e34da576", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3cadba4956bf22759803024b69b6bb67e34da576/comments", "author": {"login": "popzxc", "id": 12111581, "node_id": "MDQ6VXNlcjEyMTExNTgx", "avatar_url": "https://avatars.githubusercontent.com/u/12111581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popzxc", "html_url": "https://github.com/popzxc", "followers_url": "https://api.github.com/users/popzxc/followers", "following_url": "https://api.github.com/users/popzxc/following{/other_user}", "gists_url": "https://api.github.com/users/popzxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/popzxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popzxc/subscriptions", "organizations_url": "https://api.github.com/users/popzxc/orgs", "repos_url": "https://api.github.com/users/popzxc/repos", "events_url": "https://api.github.com/users/popzxc/events{/privacy}", "received_events_url": "https://api.github.com/users/popzxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "popzxc", "id": 12111581, "node_id": "MDQ6VXNlcjEyMTExNTgx", "avatar_url": "https://avatars.githubusercontent.com/u/12111581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popzxc", "html_url": "https://github.com/popzxc", "followers_url": "https://api.github.com/users/popzxc/followers", "following_url": "https://api.github.com/users/popzxc/following{/other_user}", "gists_url": "https://api.github.com/users/popzxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/popzxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popzxc/subscriptions", "organizations_url": "https://api.github.com/users/popzxc/orgs", "repos_url": "https://api.github.com/users/popzxc/repos", "events_url": "https://api.github.com/users/popzxc/events{/privacy}", "received_events_url": "https://api.github.com/users/popzxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "91a09f50f47d451d40fe863ec4af7e2b38ed5a45", "url": "https://api.github.com/repos/rust-lang/rust/commits/91a09f50f47d451d40fe863ec4af7e2b38ed5a45", "html_url": "https://github.com/rust-lang/rust/commit/91a09f50f47d451d40fe863ec4af7e2b38ed5a45"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "1d7e8de565903e44fd438955e550f34a71bef722", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3cadba4956bf22759803024b69b6bb67e34da576/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cadba4956bf22759803024b69b6bb67e34da576/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=3cadba4956bf22759803024b69b6bb67e34da576", "patch": "@@ -254,10 +254,11 @@ fn should_not_display_type_hint(\n                 ast::ForExpr(it) => {\n                     // We *should* display hint only if user provided \"in {expr}\" and we know the type of expr (and it's not unit).\n                     // Type of expr should be iterable.\n-                    let type_is_known = |ty: Option<hir::Type>| ty.map(|ty| !ty.is_unit() && !ty.is_unknown()).unwrap_or(false);\n-                    let should_display = it.in_token().is_some()\n-                        && it.iterable().map(|expr| type_is_known(sema.type_of_expr(&expr))).unwrap_or(false);\n-                    return !should_display;\n+                    return it.in_token().is_none() ||\n+                        it.iterable()\n+                            .and_then(|iterable_expr|sema.type_of_expr(&iterable_expr))\n+                            .map(|iterable_ty| iterable_ty.is_unknown() || iterable_ty.is_unit())\n+                            .unwrap_or(true)\n                 },\n                 _ => (),\n             }"}]}