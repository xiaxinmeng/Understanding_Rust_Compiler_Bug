{"sha": "f276dd4f284c158fff60ca6beffacdcf1eac48f7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyNzZkZDRmMjg0YzE1OGZmZjYwY2E2YmVmZmFjZGNmMWVhYzQ4Zjc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-18T01:13:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-18T01:13:47Z"}, "message": "Rollup merge of #74448 - davidtwco:improper-ctypes-definitions-boxes, r=davidtwco\n\nimproper_ctypes_definitions: allow `Box`\n\nAddresses https://github.com/rust-lang/rust/pull/72700#issuecomment-659449386.\n\nThis PR stops linting against `Box` in `extern \"C\" fn`s for the `improper_ctypes_definitions` lint - boxes are documented to be FFI-safe.\n\ncc @alexcrichton @CryZe", "tree": {"sha": "402daa8d7ee26fada512937e92ab24c8c1e18b84", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/402daa8d7ee26fada512937e92ab24c8c1e18b84"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f276dd4f284c158fff60ca6beffacdcf1eac48f7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfEkzLCRBK7hj4Ov3rIwAAdHIIAEO1MLEc2Q802AJwwSo3MP+m\nqAvM1YXvvRNmfsxSs2jy1NwjL3AYyo+trJFhE41aP2gp4KZWj82TgdYo5CGFvXek\n0XVyiYBof6cH5kDB9mHXFXWtDrLi+jdweMTup/73yYQ5CMf4z+qo24V/HvzJWSL5\nqQO8DD3uqFOfPucXF2bdMC686KFXo+tk4KG6VHyQsjgk1NXW+7kgzSdXOh9wXQOy\nI385BMxXNa2FU3J0/KHXu7R9G9Cumhhrfy7a2t9oajKPQ8SifpVe7EvpdB4i3JDw\ng1tr+UHT1KPV9Hhil1khssWrdaQt9cRPT3q27mVkQgiyykB6BoY3oa+V+utWJGA=\n=w3lJ\n-----END PGP SIGNATURE-----\n", "payload": "tree 402daa8d7ee26fada512937e92ab24c8c1e18b84\nparent 378f46d1f2908014aa908f5c9823a44fd0a57c80\nparent 95df8024e7e934aec9f985a6680b65fd0d40a428\nauthor Manish Goregaokar <manishsmail@gmail.com> 1595034827 -0700\ncommitter GitHub <noreply@github.com> 1595034827 -0700\n\nRollup merge of #74448 - davidtwco:improper-ctypes-definitions-boxes, r=davidtwco\n\nimproper_ctypes_definitions: allow `Box`\n\nAddresses https://github.com/rust-lang/rust/pull/72700#issuecomment-659449386.\n\nThis PR stops linting against `Box` in `extern \"C\" fn`s for the `improper_ctypes_definitions` lint - boxes are documented to be FFI-safe.\n\ncc @alexcrichton @CryZe\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f276dd4f284c158fff60ca6beffacdcf1eac48f7", "html_url": "https://github.com/rust-lang/rust/commit/f276dd4f284c158fff60ca6beffacdcf1eac48f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f276dd4f284c158fff60ca6beffacdcf1eac48f7/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "378f46d1f2908014aa908f5c9823a44fd0a57c80", "url": "https://api.github.com/repos/rust-lang/rust/commits/378f46d1f2908014aa908f5c9823a44fd0a57c80", "html_url": "https://github.com/rust-lang/rust/commit/378f46d1f2908014aa908f5c9823a44fd0a57c80"}, {"sha": "95df8024e7e934aec9f985a6680b65fd0d40a428", "url": "https://api.github.com/repos/rust-lang/rust/commits/95df8024e7e934aec9f985a6680b65fd0d40a428", "html_url": "https://github.com/rust-lang/rust/commit/95df8024e7e934aec9f985a6680b65fd0d40a428"}], "stats": {"total": 122, "additions": 58, "deletions": 64}, "files": [{"sha": "1affc9457b89e167492782df5bd0b1d8314b96f6", "filename": "src/librustc_lint/types.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Flibrustc_lint%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Flibrustc_lint%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Ftypes.rs?ref=f276dd4f284c158fff60ca6beffacdcf1eac48f7", "patch": "@@ -531,6 +531,11 @@ impl<'a, 'tcx> ImproperCTypesVisitor<'a, 'tcx> {\n         match ty.kind {\n             ty::FnPtr(_) => true,\n             ty::Ref(..) => true,\n+            ty::Adt(def, _)\n+                if def.is_box() && matches!(self.mode, ImproperCTypesMode::Definitions) =>\n+            {\n+                true\n+            }\n             ty::Adt(def, substs) if def.repr.transparent() && !def.is_union() => {\n                 let guaranteed_nonnull_optimization = self\n                     .cx\n@@ -558,7 +563,7 @@ impl<'a, 'tcx> ImproperCTypesVisitor<'a, 'tcx> {\n     }\n \n     /// Check if this enum can be safely exported based on the \"nullable pointer optimization\".\n-    /// Currently restricted to function pointers, references, `core::num::NonZero*`,\n+    /// Currently restricted to function pointers, boxes, references, `core::num::NonZero*`,\n     /// `core::ptr::NonNull`, and `#[repr(transparent)]` newtypes.\n     fn is_repr_nullable_ptr(\n         &self,\n@@ -692,6 +697,12 @@ impl<'a, 'tcx> ImproperCTypesVisitor<'a, 'tcx> {\n         }\n \n         match ty.kind {\n+            ty::Adt(def, _)\n+                if def.is_box() && matches!(self.mode, ImproperCTypesMode::Definitions) =>\n+            {\n+                FfiSafe\n+            }\n+\n             ty::Adt(def, substs) => {\n                 if def.is_phantom_data() {\n                     return FfiPhantom(ty);"}, {"sha": "aa02e578663286e4add09881b496b47a5a247af5", "filename": "src/test/ui/lint/lint-ctypes-fn.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.rs?ref=f276dd4f284c158fff60ca6beffacdcf1eac48f7", "patch": "@@ -71,7 +71,8 @@ pub extern \"C\" fn str_type(p: &str) { }\n //~^ ERROR: uses type `str`\n \n pub extern \"C\" fn box_type(p: Box<u32>) { }\n-//~^ ERROR uses type `std::boxed::Box<u32>`\n+\n+pub extern \"C\" fn opt_box_type(p: Option<Box<u32>>) { }\n \n pub extern \"C\" fn char_type(p: char) { }\n //~^ ERROR uses type `char`\n@@ -106,7 +107,6 @@ pub extern \"C\" fn fn_type2(p: fn()) { }\n //~^ ERROR uses type `fn()`\n \n pub extern \"C\" fn fn_contained(p: RustBadRet) { }\n-//~^ ERROR: uses type `std::boxed::Box<u32>`\n \n pub extern \"C\" fn transparent_i128(p: TransparentI128) { }\n //~^ ERROR: uses type `i128`\n@@ -115,7 +115,6 @@ pub extern \"C\" fn transparent_str(p: TransparentStr) { }\n //~^ ERROR: uses type `str`\n \n pub extern \"C\" fn transparent_fn(p: TransparentBadFn) { }\n-//~^ ERROR: uses type `std::boxed::Box<u32>`\n \n pub extern \"C\" fn good3(fptr: Option<extern fn()>) { }\n "}, {"sha": "d0a449514e50ef767db39de3abc0817ba96eeab5", "filename": "src/test/ui/lint/lint-ctypes-fn.stderr", "status": "modified", "additions": 14, "deletions": 41, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.stderr?ref=f276dd4f284c158fff60ca6beffacdcf1eac48f7", "patch": "@@ -21,17 +21,8 @@ LL | pub extern \"C\" fn str_type(p: &str) { }\n    = help: consider using `*const u8` and a length instead\n    = note: string slices have no C equivalent\n \n-error: `extern` fn uses type `std::boxed::Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:73:31\n-   |\n-LL | pub extern \"C\" fn box_type(p: Box<u32>) { }\n-   |                               ^^^^^^^^ not FFI-safe\n-   |\n-   = help: consider adding a `#[repr(C)]` or `#[repr(transparent)]` attribute to this struct\n-   = note: this struct has unspecified layout\n-\n error: `extern` fn uses type `char`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:76:32\n+  --> $DIR/lint-ctypes-fn.rs:77:32\n    |\n LL | pub extern \"C\" fn char_type(p: char) { }\n    |                                ^^^^ not FFI-safe\n@@ -40,23 +31,23 @@ LL | pub extern \"C\" fn char_type(p: char) { }\n    = note: the `char` type has no C equivalent\n \n error: `extern` fn uses type `i128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:79:32\n+  --> $DIR/lint-ctypes-fn.rs:80:32\n    |\n LL | pub extern \"C\" fn i128_type(p: i128) { }\n    |                                ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` fn uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:82:32\n+  --> $DIR/lint-ctypes-fn.rs:83:32\n    |\n LL | pub extern \"C\" fn u128_type(p: u128) { }\n    |                                ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` fn uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:85:33\n+  --> $DIR/lint-ctypes-fn.rs:86:33\n    |\n LL | pub extern \"C\" fn tuple_type(p: (i32, i32)) { }\n    |                                 ^^^^^^^^^^ not FFI-safe\n@@ -65,7 +56,7 @@ LL | pub extern \"C\" fn tuple_type(p: (i32, i32)) { }\n    = note: tuples have unspecified layout\n \n error: `extern` fn uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:88:34\n+  --> $DIR/lint-ctypes-fn.rs:89:34\n    |\n LL | pub extern \"C\" fn tuple_type2(p: I32Pair) { }\n    |                                  ^^^^^^^ not FFI-safe\n@@ -74,7 +65,7 @@ LL | pub extern \"C\" fn tuple_type2(p: I32Pair) { }\n    = note: tuples have unspecified layout\n \n error: `extern` fn uses type `ZeroSize`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:91:32\n+  --> $DIR/lint-ctypes-fn.rs:92:32\n    |\n LL | pub extern \"C\" fn zero_size(p: ZeroSize) { }\n    |                                ^^^^^^^^ not FFI-safe\n@@ -88,7 +79,7 @@ LL | pub struct ZeroSize;\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` fn uses type `ZeroSizeWithPhantomData`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:94:40\n+  --> $DIR/lint-ctypes-fn.rs:95:40\n    |\n LL | pub extern \"C\" fn zero_size_phantom(p: ZeroSizeWithPhantomData) { }\n    |                                        ^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -101,15 +92,15 @@ LL | pub struct ZeroSizeWithPhantomData(PhantomData<i32>);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` fn uses type `std::marker::PhantomData<bool>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:97:51\n+  --> $DIR/lint-ctypes-fn.rs:98:51\n    |\n LL | pub extern \"C\" fn zero_size_phantom_toplevel() -> PhantomData<bool> {\n    |                                                   ^^^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: composed only of `PhantomData`\n \n error: `extern` fn uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:102:30\n+  --> $DIR/lint-ctypes-fn.rs:103:30\n    |\n LL | pub extern \"C\" fn fn_type(p: RustFn) { }\n    |                              ^^^^^^ not FFI-safe\n@@ -118,23 +109,14 @@ LL | pub extern \"C\" fn fn_type(p: RustFn) { }\n    = note: this function pointer has Rust-specific calling convention\n \n error: `extern` fn uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:105:31\n+  --> $DIR/lint-ctypes-fn.rs:106:31\n    |\n LL | pub extern \"C\" fn fn_type2(p: fn()) { }\n    |                               ^^^^ not FFI-safe\n    |\n    = help: consider using an `extern fn(...) -> ...` function pointer instead\n    = note: this function pointer has Rust-specific calling convention\n \n-error: `extern` fn uses type `std::boxed::Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:108:35\n-   |\n-LL | pub extern \"C\" fn fn_contained(p: RustBadRet) { }\n-   |                                   ^^^^^^^^^^ not FFI-safe\n-   |\n-   = help: consider adding a `#[repr(C)]` or `#[repr(transparent)]` attribute to this struct\n-   = note: this struct has unspecified layout\n-\n error: `extern` fn uses type `i128`, which is not FFI-safe\n   --> $DIR/lint-ctypes-fn.rs:111:39\n    |\n@@ -152,25 +134,16 @@ LL | pub extern \"C\" fn transparent_str(p: TransparentStr) { }\n    = help: consider using `*const u8` and a length instead\n    = note: string slices have no C equivalent\n \n-error: `extern` fn uses type `std::boxed::Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:117:37\n-   |\n-LL | pub extern \"C\" fn transparent_fn(p: TransparentBadFn) { }\n-   |                                     ^^^^^^^^^^^^^^^^ not FFI-safe\n-   |\n-   = help: consider adding a `#[repr(C)]` or `#[repr(transparent)]` attribute to this struct\n-   = note: this struct has unspecified layout\n-\n error: `extern` fn uses type `std::marker::PhantomData<bool>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:161:43\n+  --> $DIR/lint-ctypes-fn.rs:160:43\n    |\n LL | pub extern \"C\" fn unused_generic2<T>() -> PhantomData<bool> {\n    |                                           ^^^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: composed only of `PhantomData`\n \n error: `extern` fn uses type `std::vec::Vec<T>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:174:39\n+  --> $DIR/lint-ctypes-fn.rs:173:39\n    |\n LL | pub extern \"C\" fn used_generic4<T>(x: Vec<T>) { }\n    |                                       ^^^^^^ not FFI-safe\n@@ -179,13 +152,13 @@ LL | pub extern \"C\" fn used_generic4<T>(x: Vec<T>) { }\n    = note: this struct has unspecified layout\n \n error: `extern` fn uses type `std::vec::Vec<T>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:177:41\n+  --> $DIR/lint-ctypes-fn.rs:176:41\n    |\n LL | pub extern \"C\" fn used_generic5<T>() -> Vec<T> {\n    |                                         ^^^^^^ not FFI-safe\n    |\n    = help: consider adding a `#[repr(C)]` or `#[repr(transparent)]` attribute to this struct\n    = note: this struct has unspecified layout\n \n-error: aborting due to 20 previous errors\n+error: aborting due to 17 previous errors\n "}, {"sha": "bdf95350c70451c6a82eb66a03c8332f790b95e8", "filename": "src/test/ui/lint/lint-ctypes.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs?ref=f276dd4f284c158fff60ca6beffacdcf1eac48f7", "patch": "@@ -48,6 +48,8 @@ extern {\n     pub fn slice_type(p: &[u32]); //~ ERROR: uses type `[u32]`\n     pub fn str_type(p: &str); //~ ERROR: uses type `str`\n     pub fn box_type(p: Box<u32>); //~ ERROR uses type `std::boxed::Box<u32>`\n+    pub fn opt_box_type(p: Option<Box<u32>>);\n+    //~^ ERROR uses type `std::option::Option<std::boxed::Box<u32>>`\n     pub fn char_type(p: char); //~ ERROR uses type `char`\n     pub fn i128_type(p: i128); //~ ERROR uses type `i128`\n     pub fn u128_type(p: u128); //~ ERROR uses type `u128`"}, {"sha": "13b9adca3f9f5af7c4cd86f6d369daac55ae66b8", "filename": "src/test/ui/lint/lint-ctypes.stderr", "status": "modified", "additions": 28, "deletions": 19, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f276dd4f284c158fff60ca6beffacdcf1eac48f7/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr?ref=f276dd4f284c158fff60ca6beffacdcf1eac48f7", "patch": "@@ -58,8 +58,17 @@ LL |     pub fn box_type(p: Box<u32>);\n    = help: consider adding a `#[repr(C)]` or `#[repr(transparent)]` attribute to this struct\n    = note: this struct has unspecified layout\n \n+error: `extern` block uses type `std::option::Option<std::boxed::Box<u32>>`, which is not FFI-safe\n+  --> $DIR/lint-ctypes.rs:51:28\n+   |\n+LL |     pub fn opt_box_type(p: Option<Box<u32>>);\n+   |                            ^^^^^^^^^^^^^^^^ not FFI-safe\n+   |\n+   = help: consider adding a `#[repr(C)]`, `#[repr(transparent)]`, or integer `#[repr(...)]` attribute to this enum\n+   = note: enum has no representation hint\n+\n error: `extern` block uses type `char`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:51:25\n+  --> $DIR/lint-ctypes.rs:53:25\n    |\n LL |     pub fn char_type(p: char);\n    |                         ^^^^ not FFI-safe\n@@ -68,31 +77,31 @@ LL |     pub fn char_type(p: char);\n    = note: the `char` type has no C equivalent\n \n error: `extern` block uses type `i128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:52:25\n+  --> $DIR/lint-ctypes.rs:54:25\n    |\n LL |     pub fn i128_type(p: i128);\n    |                         ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:53:25\n+  --> $DIR/lint-ctypes.rs:55:25\n    |\n LL |     pub fn u128_type(p: u128);\n    |                         ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `dyn std::clone::Clone`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:54:26\n+  --> $DIR/lint-ctypes.rs:56:26\n    |\n LL |     pub fn trait_type(p: &dyn Clone);\n    |                          ^^^^^^^^^^ not FFI-safe\n    |\n    = note: trait objects have no C equivalent\n \n error: `extern` block uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:55:26\n+  --> $DIR/lint-ctypes.rs:57:26\n    |\n LL |     pub fn tuple_type(p: (i32, i32));\n    |                          ^^^^^^^^^^ not FFI-safe\n@@ -101,7 +110,7 @@ LL |     pub fn tuple_type(p: (i32, i32));\n    = note: tuples have unspecified layout\n \n error: `extern` block uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:56:27\n+  --> $DIR/lint-ctypes.rs:58:27\n    |\n LL |     pub fn tuple_type2(p: I32Pair);\n    |                           ^^^^^^^ not FFI-safe\n@@ -110,7 +119,7 @@ LL |     pub fn tuple_type2(p: I32Pair);\n    = note: tuples have unspecified layout\n \n error: `extern` block uses type `ZeroSize`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:57:25\n+  --> $DIR/lint-ctypes.rs:59:25\n    |\n LL |     pub fn zero_size(p: ZeroSize);\n    |                         ^^^^^^^^ not FFI-safe\n@@ -124,7 +133,7 @@ LL | pub struct ZeroSize;\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` block uses type `ZeroSizeWithPhantomData`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:58:33\n+  --> $DIR/lint-ctypes.rs:60:33\n    |\n LL |     pub fn zero_size_phantom(p: ZeroSizeWithPhantomData);\n    |                                 ^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -137,15 +146,15 @@ LL | pub struct ZeroSizeWithPhantomData(::std::marker::PhantomData<i32>);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` block uses type `std::marker::PhantomData<bool>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:61:12\n+  --> $DIR/lint-ctypes.rs:63:12\n    |\n LL |         -> ::std::marker::PhantomData<bool>;\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: composed only of `PhantomData`\n \n error: `extern` block uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:62:23\n+  --> $DIR/lint-ctypes.rs:64:23\n    |\n LL |     pub fn fn_type(p: RustFn);\n    |                       ^^^^^^ not FFI-safe\n@@ -154,7 +163,7 @@ LL |     pub fn fn_type(p: RustFn);\n    = note: this function pointer has Rust-specific calling convention\n \n error: `extern` block uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:63:24\n+  --> $DIR/lint-ctypes.rs:65:24\n    |\n LL |     pub fn fn_type2(p: fn());\n    |                        ^^^^ not FFI-safe\n@@ -163,7 +172,7 @@ LL |     pub fn fn_type2(p: fn());\n    = note: this function pointer has Rust-specific calling convention\n \n error: `extern` block uses type `std::boxed::Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:64:28\n+  --> $DIR/lint-ctypes.rs:66:28\n    |\n LL |     pub fn fn_contained(p: RustBadRet);\n    |                            ^^^^^^^^^^ not FFI-safe\n@@ -172,15 +181,15 @@ LL |     pub fn fn_contained(p: RustBadRet);\n    = note: this struct has unspecified layout\n \n error: `extern` block uses type `i128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:65:32\n+  --> $DIR/lint-ctypes.rs:67:32\n    |\n LL |     pub fn transparent_i128(p: TransparentI128);\n    |                                ^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `str`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:66:31\n+  --> $DIR/lint-ctypes.rs:68:31\n    |\n LL |     pub fn transparent_str(p: TransparentStr);\n    |                               ^^^^^^^^^^^^^^ not FFI-safe\n@@ -189,7 +198,7 @@ LL |     pub fn transparent_str(p: TransparentStr);\n    = note: string slices have no C equivalent\n \n error: `extern` block uses type `std::boxed::Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:67:30\n+  --> $DIR/lint-ctypes.rs:69:30\n    |\n LL |     pub fn transparent_fn(p: TransparentBadFn);\n    |                              ^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -198,7 +207,7 @@ LL |     pub fn transparent_fn(p: TransparentBadFn);\n    = note: this struct has unspecified layout\n \n error: `extern` block uses type `[u8; 8]`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:68:27\n+  --> $DIR/lint-ctypes.rs:70:27\n    |\n LL |     pub fn raw_array(arr: [u8; 8]);\n    |                           ^^^^^^^ not FFI-safe\n@@ -207,20 +216,20 @@ LL |     pub fn raw_array(arr: [u8; 8]);\n    = note: passing raw arrays by value is not FFI-safe\n \n error: `extern` block uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:70:34\n+  --> $DIR/lint-ctypes.rs:72:34\n    |\n LL |     pub static static_u128_type: u128;\n    |                                  ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:71:40\n+  --> $DIR/lint-ctypes.rs:73:40\n    |\n LL |     pub static static_u128_array_type: [u128; 16];\n    |                                        ^^^^^^^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n-error: aborting due to 23 previous errors\n+error: aborting due to 24 previous errors\n "}]}