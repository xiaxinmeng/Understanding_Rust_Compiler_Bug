{"sha": "ad292a8c73a0cceddfa9618a4d6eea577897bae8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkMjkyYThjNzNhMGNjZWRkZmE5NjE4YTRkNmVlYTU3Nzg5N2JhZTg=", "commit": {"author": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-30T23:31:16Z"}, "committer": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-31T00:39:53Z"}, "message": "Add xorshift to core::rand, which gave a 3x speedup for graph generation in the bfs code. Also, remove trailing white space.", "tree": {"sha": "7097251eb5006fa4f3a83822f6eb154f9273b031", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7097251eb5006fa4f3a83822f6eb154f9273b031"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad292a8c73a0cceddfa9618a4d6eea577897bae8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad292a8c73a0cceddfa9618a4d6eea577897bae8", "html_url": "https://github.com/rust-lang/rust/commit/ad292a8c73a0cceddfa9618a4d6eea577897bae8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad292a8c73a0cceddfa9618a4d6eea577897bae8/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09a32aedb5ae56cabac371ba9af7cce631becf51", "url": "https://api.github.com/repos/rust-lang/rust/commits/09a32aedb5ae56cabac371ba9af7cce631becf51", "html_url": "https://github.com/rust-lang/rust/commit/09a32aedb5ae56cabac371ba9af7cce631becf51"}], "stats": {"total": 38, "additions": 34, "deletions": 4}, "files": [{"sha": "31601d462436ce8515841e9a68572d7f4365fa5f", "filename": "src/libcore/rand.rs", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/ad292a8c73a0cceddfa9618a4d6eea577897bae8/src%2Flibcore%2Frand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad292a8c73a0cceddfa9618a4d6eea577897bae8/src%2Flibcore%2Frand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Frand.rs?ref=ad292a8c73a0cceddfa9618a4d6eea577897bae8", "patch": "@@ -1,6 +1,7 @@\n #[doc = \"Random number generation\"];\n \n export rng, seed, seeded_rng, weighted, extensions;\n+export xorshift, seeded_xorshift;\n \n enum rctx {}\n \n@@ -253,6 +254,35 @@ fn seeded_rng(seed: [u8]) -> rng {\n     @rand_res(rustrt::rand_new_seeded(seed)) as rng\n }\n \n+type xorshift_state = {\n+    mut x: u32,\n+    mut y: u32,\n+    mut z: u32,\n+    mut w: u32\n+};\n+\n+impl of rng for xorshift_state {\n+    fn next() -> u32 {\n+        let x = self.x;\n+        let mut t = x ^ (x << 11);\n+        self.x = self.y;\n+        self.y = self.z;\n+        self.z = self.w;\n+        let w = self.w;\n+        self.w = w ^ (w >> 19) ^ (t ^ (t >> 8));\n+        self.w\n+    }\n+}\n+\n+fn xorshift() -> rng {\n+    // constants taken from http://en.wikipedia.org/wiki/Xorshift\n+    seeded_xorshift(123456789u32, 362436069u32, 521288629u32, 88675123u32)\n+}\n+\n+fn seeded_xorshift(x: u32, y: u32, z: u32, w: u32) -> rng {\n+    {mut x: x, mut y: y, mut z: z, mut w: w} as rng\n+}\n+\n #[cfg(test)]\n mod tests {\n "}, {"sha": "5db344713a702e6fef90d91f22a1fbb7cc445466", "filename": "src/libstd/par.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ad292a8c73a0cceddfa9618a4d6eea577897bae8/src%2Flibstd%2Fpar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad292a8c73a0cceddfa9618a4d6eea577897bae8/src%2Flibstd%2Fpar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fpar.rs?ref=ad292a8c73a0cceddfa9618a4d6eea577897bae8", "patch": "@@ -129,7 +129,7 @@ fn alli<A: copy send>(xs: [A], f: fn~(uint, A) -> bool) -> bool {\n \n #[doc=\"Returns true if the function holds for any elements in the vector.\"]\n fn any<A: copy send>(xs: [A], f: fn~(A) -> bool) -> bool {\n-    vec::any(map_slices(xs) {|| \n+    vec::any(map_slices(xs) {||\n         fn~(_base : uint, slice: [const A]/&, copy f) -> bool {\n             vec::any(slice, f)\n         }"}, {"sha": "85c77b04c5f34f4b54fb2e849d723c0023a1c2cf", "filename": "src/test/bench/graph500-bfs.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ad292a8c73a0cceddfa9618a4d6eea577897bae8/src%2Ftest%2Fbench%2Fgraph500-bfs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad292a8c73a0cceddfa9618a4d6eea577897bae8/src%2Ftest%2Fbench%2Fgraph500-bfs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fgraph500-bfs.rs?ref=ad292a8c73a0cceddfa9618a4d6eea577897bae8", "patch": "@@ -21,7 +21,7 @@ type graph = [[node_id]];\n type bfs_result = [node_id];\n \n fn make_edges(scale: uint, edgefactor: uint) -> [(node_id, node_id)] {\n-    let r = rand::rng();\n+    let r = rand::xorshift();\n \n     fn choose_edge(i: node_id, j: node_id, scale: uint, r: rand::rng)\n         -> (node_id, node_id) {\n@@ -247,12 +247,12 @@ fn pbfs(&&graph: arc::arc<graph>, key: node_id) -> bfs_result {\n                   white {\n                     let i = i as node_id;\n                     \n-                    let neighbors = (*graph)[i];\n+                    let neighbors = graph[i];\n                     \n                     let mut color = white;\n                     \n                     neighbors.each() {|k|\n-                        if is_gray((*colors)[k]) {\n+                        if is_gray(colors[k]) {\n                             color = gray(k);\n                             false\n                         }"}]}