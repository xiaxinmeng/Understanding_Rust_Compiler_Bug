{"sha": "55cabda8d5bc023991aff7f53230a11a539dad80", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1Y2FiZGE4ZDViYzAyMzk5MWFmZjdmNTMyMzBhMTFhNTM5ZGFkODA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-20T11:34:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-20T11:34:34Z"}, "message": "Auto merge of #33729 - alexcrichton:patch-libbacktrace, r=sfackler\n\nstd: Backport a libbacktrace soundness fix\n\nThis is a backport of gcc-mirror/gcc@047a1c2f which is a soundness fix for when\na backtrace is generated on executables that do not have debug information.", "tree": {"sha": "58ce0cc0097a307209b185d1144b443065b81a5d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/58ce0cc0097a307209b185d1144b443065b81a5d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/55cabda8d5bc023991aff7f53230a11a539dad80", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/55cabda8d5bc023991aff7f53230a11a539dad80", "html_url": "https://github.com/rust-lang/rust/commit/55cabda8d5bc023991aff7f53230a11a539dad80", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/55cabda8d5bc023991aff7f53230a11a539dad80/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d27bdafc3eaab2729d664f82b7d650782640f31a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d27bdafc3eaab2729d664f82b7d650782640f31a", "html_url": "https://github.com/rust-lang/rust/commit/d27bdafc3eaab2729d664f82b7d650782640f31a"}, {"sha": "a42115375b1d7ae2a6c3f8c85819ef8182abaf52", "url": "https://api.github.com/repos/rust-lang/rust/commits/a42115375b1d7ae2a6c3f8c85819ef8182abaf52", "html_url": "https://github.com/rust-lang/rust/commit/a42115375b1d7ae2a6c3f8c85819ef8182abaf52"}], "stats": {"total": 35, "additions": 31, "deletions": 4}, "files": [{"sha": "acc07047f6729cc578b55bec881acb8f8fd379ba", "filename": "src/libbacktrace/ChangeLog", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2FChangeLog", "raw_url": "https://github.com/rust-lang/rust/raw/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2FChangeLog", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibbacktrace%2FChangeLog?ref=55cabda8d5bc023991aff7f53230a11a539dad80", "patch": "@@ -1,15 +1,33 @@\n+2016-05-18  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/71161\n+\t* elf.c (phdr_callback) [__i386__]: Add\n+\t__attribute__((__force_align_arg_pointer__)).\n+\n+2016-03-02  Maxim Ostapenko  <m.ostapenko@partner.samsung.com>\n+\n+\t* elf.c (backtrace_initialize): Properly initialize elf_fileline_fn to\n+\tavoid possible crash.\n+\t(elf_add): Don't set *fileline_fn to elf_nodebug value in case of\n+\tmissing debug info anymore.\n+\n+2016-02-06  John David Anglin  <danglin@gcc.gnu.org>\n+\n+\t* mmap.c (MAP_FAILED): Define if not defined.\n+\n 2016-01-04  Jakub Jelinek  <jakub@redhat.com>\n \n \tUpdate copyright years.\n \n 2015-12-18  Andris Pavenis  <andris.pavenis@iki.fi>\n \n-\t* configure.ac: Specify that DJGPP do not have mmap even when sys/mman.h exists\n+\t* configure.ac: Specify that DJGPP do not have mmap\n+\teven when sys/mman.h exists.\n \t* configure: Regenerate\n \n 2015-12-09  John David Anglin  <danglin@gcc.gnu.org>\n \n-\tPR 68115/libfortran\n+\tPR libgfortran/68115\n \t* configure.ac: Set libbacktrace_cv_sys_sync to no on hppa*-*-hpux*.\n \t* configure: Regenerate.\n \t* elf.c (backtrace_initialize): Cast __sync_bool_compare_and_swap call"}, {"sha": "81ba3440ab7d18539180f53805ac36c408284a66", "filename": "src/libbacktrace/elf.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2Felf.c", "raw_url": "https://github.com/rust-lang/rust/raw/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2Felf.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibbacktrace%2Felf.c?ref=55cabda8d5bc023991aff7f53230a11a539dad80", "patch": "@@ -791,7 +791,6 @@ elf_add (struct backtrace_state *state, int descriptor, uintptr_t base_address,\n     {\n       if (!backtrace_close (descriptor, error_callback, data))\n \tgoto fail;\n-      *fileline_fn = elf_nodebug;\n       return 1;\n     }\n \n@@ -867,6 +866,9 @@ struct phdr_data\n    libraries.  */\n \n static int\n+#ifdef __i386__\n+__attribute__ ((__force_align_arg_pointer__))\n+#endif\n phdr_callback (struct dl_phdr_info *info, size_t size ATTRIBUTE_UNUSED,\n \t       void *pdata)\n {\n@@ -925,7 +927,7 @@ backtrace_initialize (struct backtrace_state *state, int descriptor,\n   int ret;\n   int found_sym;\n   int found_dwarf;\n-  fileline elf_fileline_fn;\n+  fileline elf_fileline_fn = elf_nodebug;\n   struct phdr_data pd;\n \n   ret = elf_add (state, descriptor, 0, error_callback, data, &elf_fileline_fn,"}, {"sha": "138ef70711a02597b6e843516d84c687f9aef753", "filename": "src/libbacktrace/mmap.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2Fmmap.c", "raw_url": "https://github.com/rust-lang/rust/raw/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2Fmmap.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibbacktrace%2Fmmap.c?ref=55cabda8d5bc023991aff7f53230a11a539dad80", "patch": "@@ -50,6 +50,10 @@ POSSIBILITY OF SUCH DAMAGE.  */\n #define MAP_ANONYMOUS MAP_ANON\n #endif\n \n+#ifndef MAP_FAILED\n+#define MAP_FAILED ((void *)-1)\n+#endif\n+\n /* A list of free memory blocks.  */\n \n struct backtrace_freelist_struct"}, {"sha": "04e0bafb14981c49b19b158c75588a78935827e6", "filename": "src/libbacktrace/pecoff.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2Fpecoff.c", "raw_url": "https://github.com/rust-lang/rust/raw/55cabda8d5bc023991aff7f53230a11a539dad80/src%2Flibbacktrace%2Fpecoff.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibbacktrace%2Fpecoff.c?ref=55cabda8d5bc023991aff7f53230a11a539dad80", "patch": "@@ -602,6 +602,9 @@ coff_add (struct backtrace_state *state, int descriptor,\n   const b_coff_section_header *sects;\n   struct backtrace_view str_view;\n   int str_view_valid;\n+  // NOTE: upstream this is a `size_t` but this was fixed in Rust commit\n+  //       55e2b7e1b, see #33729 for more info. If you see this in a diff\n+  //       against the upstream libbacktrace, that's what's going on.\n   uint32_t str_size;\n   off_t str_off;\n   struct backtrace_view syms_view;"}]}