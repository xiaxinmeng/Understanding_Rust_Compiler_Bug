{"sha": "5c819186edb77bd49ccaf8fb61dbc277a05f3aea", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjODE5MTg2ZWRiNzdiZDQ5Y2NhZjhmYjYxZGJjMjc3YTA1ZjNhZWE=", "commit": {"author": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2014-09-03T08:55:38Z"}, "committer": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2014-09-03T10:07:08Z"}, "message": "bitv: add larger tests, better benchmarks & remove dead code.\n\nThere were no tests for iteration etc. with more than 5 elements,\ni.e. not even going beyond a single word. This situation is rectified.\n\nAlso, the only benchmarks for `set` were with a constant bit value,\nwhich was not indicative of every situation, due to inlining & branch\nremoval. This adds a benchmark at the other end of the spectrum: random\ninput.", "tree": {"sha": "eb096f8175db6b3c7fec2087f641cd0ec74b3c4e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eb096f8175db6b3c7fec2087f641cd0ec74b3c4e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c819186edb77bd49ccaf8fb61dbc277a05f3aea", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c819186edb77bd49ccaf8fb61dbc277a05f3aea", "html_url": "https://github.com/rust-lang/rust/commit/5c819186edb77bd49ccaf8fb61dbc277a05f3aea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c819186edb77bd49ccaf8fb61dbc277a05f3aea/comments", "author": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5dfb7a6ec1c1b7827a1f019b276c4d959cf2d71e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5dfb7a6ec1c1b7827a1f019b276c4d959cf2d71e", "html_url": "https://github.com/rust-lang/rust/commit/5dfb7a6ec1c1b7827a1f019b276c4d959cf2d71e"}], "stats": {"total": 51, "additions": 29, "deletions": 22}, "files": [{"sha": "0a658c51dbd427bab250971fb260b624221b2d1b", "filename": "src/libcollections/bitv.rs", "status": "modified", "additions": 29, "deletions": 22, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/5c819186edb77bd49ccaf8fb61dbc277a05f3aea/src%2Flibcollections%2Fbitv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c819186edb77bd49ccaf8fb61dbc277a05f3aea/src%2Flibcollections%2Fbitv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fbitv.rs?ref=5c819186edb77bd49ccaf8fb61dbc277a05f3aea", "patch": "@@ -95,20 +95,6 @@ fn match_words <'a,'b>(a: &'a Bitv, b: &'b Bitv) -> (MatchWords<'a>, MatchWords<\n static TRUE: bool = true;\n static FALSE: bool = false;\n \n-#[deriving(Clone)]\n-struct SmallBitv {\n-    /// only the lowest nbits of this value are used. the rest is undefined.\n-    bits: uint\n-}\n-\n-#[deriving(Clone)]\n-struct BigBitv {\n-    storage: Vec<uint>\n-}\n-\n-#[deriving(Clone)]\n-enum BitvVariant { Big(BigBitv), Small(SmallBitv) }\n-\n /// The bitvector type.\n ///\n /// # Example\n@@ -1653,6 +1639,7 @@ impl<'a> Iterator<uint> for TwoBitPositions<'a> {\n #[cfg(test)]\n mod tests {\n     use std::prelude::*;\n+    use std::iter::range_step;\n     use std::uint;\n     use std::rand;\n     use std::rand::Rng;\n@@ -2046,12 +2033,14 @@ mod tests {\n \n     #[test]\n     fn test_bitv_iterator() {\n-        let bools = [true, false, true, true];\n+        let bools = vec![true, false, true, true];\n         let bitv: Bitv = bools.iter().map(|n| *n).collect();\n \n-        for (act, &ex) in bitv.iter().zip(bools.iter()) {\n-            assert_eq!(ex, act);\n-        }\n+        assert_eq!(bitv.iter().collect::<Vec<bool>>(), bools)\n+\n+        let long = Vec::from_fn(10000, |i| i % 2 == 0);\n+        let bitv: Bitv = long.iter().map(|n| *n).collect();\n+        assert_eq!(bitv.iter().collect::<Vec<bool>>(), long)\n     }\n \n     #[test]\n@@ -2061,6 +2050,12 @@ mod tests {\n \n         let idxs: Vec<uint> = bitv.iter().collect();\n         assert_eq!(idxs, vec!(0, 2, 3));\n+\n+        let long: BitvSet = range(0u, 10000).map(|n| n % 2 == 0).collect();\n+        let real = range_step(0, 10000, 2).collect::<Vec<uint>>();\n+\n+        let idxs: Vec<uint> = long.iter().collect();\n+        assert_eq!(idxs, real);\n     }\n \n     #[test]\n@@ -2574,7 +2569,7 @@ mod tests {\n     }\n \n     #[bench]\n-    fn bench_bitv_big(b: &mut Bencher) {\n+    fn bench_bitv_set_big_fixed(b: &mut Bencher) {\n         let mut r = rng();\n         let mut bitv = Bitv::with_capacity(BENCH_BITS, false);\n         b.iter(|| {\n@@ -2586,7 +2581,19 @@ mod tests {\n     }\n \n     #[bench]\n-    fn bench_bitv_small(b: &mut Bencher) {\n+    fn bench_bitv_set_big_variable(b: &mut Bencher) {\n+        let mut r = rng();\n+        let mut bitv = Bitv::with_capacity(BENCH_BITS, false);\n+        b.iter(|| {\n+            for i in range(0u, 100) {\n+                bitv.set((r.next_u32() as uint) % BENCH_BITS, r.gen());\n+            }\n+            &bitv\n+        })\n+    }\n+\n+    #[bench]\n+    fn bench_bitv_set_small(b: &mut Bencher) {\n         let mut r = rng();\n         let mut bitv = Bitv::with_capacity(uint::BITS, false);\n         b.iter(|| {\n@@ -2598,7 +2605,7 @@ mod tests {\n     }\n \n     #[bench]\n-    fn bench_bitv_set_small(b: &mut Bencher) {\n+    fn bench_bitvset_small(b: &mut Bencher) {\n         let mut r = rng();\n         let mut bitv = BitvSet::new();\n         b.iter(|| {\n@@ -2610,7 +2617,7 @@ mod tests {\n     }\n \n     #[bench]\n-    fn bench_bitv_set_big(b: &mut Bencher) {\n+    fn bench_bitvset_big(b: &mut Bencher) {\n         let mut r = rng();\n         let mut bitv = BitvSet::new();\n         b.iter(|| {"}]}