{"sha": "e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1M2VhYjNmMjVhZjJlYmQzODEwMTJmMWIzNGYwYmM1MmM2OTUxZWI=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-25T19:49:54Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-25T19:49:54Z"}, "message": "Merge #650\n\n650: Add docs to struct fields r=matklad a=kjeremy\n\n\n\nCo-authored-by: Jeremy A. Kolb <jkolb@ara.com>", "tree": {"sha": "fdb97e99f511d05aae145fe13ef3152883c24892", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fdb97e99f511d05aae145fe13ef3152883c24892"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "html_url": "https://github.com/rust-lang/rust/commit/e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "55906341a6f61e12df1dc0a4bda35dd9814ece8b", "url": "https://api.github.com/repos/rust-lang/rust/commits/55906341a6f61e12df1dc0a4bda35dd9814ece8b", "html_url": "https://github.com/rust-lang/rust/commit/55906341a6f61e12df1dc0a4bda35dd9814ece8b"}, {"sha": "7a0bc2dd6402d681223be4198ec68ee7bb65d9ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a0bc2dd6402d681223be4198ec68ee7bb65d9ee", "html_url": "https://github.com/rust-lang/rust/commit/7a0bc2dd6402d681223be4198ec68ee7bb65d9ee"}], "stats": {"total": 34, "additions": 26, "deletions": 8}, "files": [{"sha": "41bac05c63f76c3bfeddaaa6cea46f4d0c96b34d", "filename": "crates/ra_hir/src/code_model_api.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs?ref=e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "patch": "@@ -216,6 +216,15 @@ impl StructField {\n     }\n }\n \n+impl Docs for StructField {\n+    fn docs(&self, db: &impl HirDatabase) -> Option<Documentation> {\n+        match self.source(db).1 {\n+            FieldSource::Named(named) => docs_from_ast(&*named),\n+            FieldSource::Pos(..) => return None,\n+        }\n+    }\n+}\n+\n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n pub struct Struct {\n     pub(crate) id: StructId,"}, {"sha": "bad51cc51f211dea1594ad34a7b1b6ee5bab77ca", "filename": "crates/ra_ide_api/src/completion/complete_dot.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_dot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_dot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_dot.rs?ref=e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "patch": "@@ -1,4 +1,4 @@\n-use hir::{Ty, AdtDef};\n+use hir::{Ty, AdtDef, Docs};\n \n use crate::completion::{CompletionContext, Completions, CompletionItem, CompletionItemKind};\n use crate::completion::completion_item::CompletionKind;\n@@ -38,6 +38,7 @@ fn complete_fields(acc: &mut Completions, ctx: &CompletionContext, receiver: Ty)\n                             )\n                             .kind(CompletionItemKind::Field)\n                             .detail(field.ty(ctx.db).subst(substs).to_string())\n+                            .set_documentation(field.docs(ctx.db))\n                             .add_to(acc);\n                         }\n                     }\n@@ -107,7 +108,10 @@ mod tests {\n         check_ref_completion(\n             \"struct_field_completion_self\",\n             r\"\n-            struct A { the_field: (u32,) }\n+            struct A {\n+                /// This is the_field\n+                the_field: (u32,)\n+            }\n             impl A {\n                 fn foo(self) {\n                     self.<|>"}, {"sha": "580e92a90571f8f2b095e29ffa21255242b74dab", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__struct_field_completion_self.snap", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_self.snap", "raw_url": "https://github.com/rust-lang/rust/raw/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_self.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_self.snap?ref=e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-01-23T13:19:23.501297515+00:00\"\n+created: \"2019-01-25T19:27:09.519688600+00:00\"\n creator: insta@0.5.2\n expression: kind_completions\n source: crates/ra_ide_api/src/completion/completion_item.rs\n@@ -14,11 +14,15 @@ source: crates/ra_ide_api/src/completion/completion_item.rs\n         detail: Some(\n             \"(u32,)\"\n         ),\n-        documentation: None,\n+        documentation: Some(\n+            Documentation(\n+                \"This is the_field\"\n+            )\n+        ),\n         lookup: None,\n         insert_text: None,\n         insert_text_format: PlainText,\n-        source_range: [121; 121),\n+        source_range: [187; 187),\n         text_edit: None\n     },\n     CompletionItem {\n@@ -36,7 +40,7 @@ source: crates/ra_ide_api/src/completion/completion_item.rs\n             \"foo()$0\"\n         ),\n         insert_text_format: Snippet,\n-        source_range: [121; 121),\n+        source_range: [187; 187),\n         text_edit: None\n     }\n ]"}, {"sha": "e936c2a6d7ed4a60e4e603b406060714b3749355", "filename": "crates/ra_syntax/src/ast/generated.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_syntax%2Fsrc%2Fast%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_syntax%2Fsrc%2Fast%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fast%2Fgenerated.rs?ref=e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "patch": "@@ -2248,6 +2248,7 @@ impl ToOwned for NamedFieldDef {\n impl ast::VisibilityOwner for NamedFieldDef {}\n impl ast::NameOwner for NamedFieldDef {}\n impl ast::AttrsOwner for NamedFieldDef {}\n+impl ast::DocCommentsOwner for NamedFieldDef {}\n impl NamedFieldDef {\n     pub fn type_ref(&self) -> Option<&TypeRef> {\n         super::child_opt(self)"}, {"sha": "a92d9bbda3108ab52d7335343540e5e35832fbee", "filename": "crates/ra_syntax/src/grammar.ron", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron", "raw_url": "https://github.com/rust-lang/rust/raw/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron?ref=e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "patch": "@@ -268,7 +268,7 @@ Grammar(\n             ]\n         ),\n         \"NamedFieldDefList\": (collections: [[\"fields\", \"NamedFieldDef\"]]),\n-        \"NamedFieldDef\": ( traits: [\"VisibilityOwner\", \"NameOwner\", \"AttrsOwner\"], options: [\"TypeRef\"] ),\n+        \"NamedFieldDef\": ( traits: [\"VisibilityOwner\", \"NameOwner\", \"AttrsOwner\", \"DocCommentsOwner\"], options: [\"TypeRef\"] ),\n         \"PosFieldList\": (collections: [[\"fields\", \"PosField\"]]),\n         \"PosField\": ( traits: [\"VisibilityOwner\", \"AttrsOwner\"], options: [\"TypeRef\"]),\n         \"EnumDef\": ( traits: ["}, {"sha": "33e10ef85df14f0be4d9a0607c402901c18bf065", "filename": "crates/ra_syntax/src/parser_impl/event.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fevent.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e53eab3f25af2ebd381012f1b34f0bc52c6951eb/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fevent.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fevent.rs?ref=e53eab3f25af2ebd381012f1b34f0bc52c6951eb", "patch": "@@ -250,7 +250,7 @@ fn n_attached_trivias<'a>(\n ) -> usize {\n     match kind {\n         CONST_DEF | TYPE_DEF | STRUCT_DEF | ENUM_DEF | ENUM_VARIANT | FN_DEF | TRAIT_DEF\n-        | MODULE => {\n+        | MODULE | NAMED_FIELD_DEF => {\n             let mut res = 0;\n             for (i, (kind, text)) in trivias.enumerate() {\n                 match kind {"}]}