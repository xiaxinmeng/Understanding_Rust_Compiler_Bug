{"sha": "4a7e19946a60b4cba6ef9d9916ae0fbec65c74da", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhN2UxOTk0NmE2MGI0Y2JhNmVmOWQ5OTE2YWUwZmJlYzY1Yzc0ZGE=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-12-20T15:11:07Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-12-20T15:26:04Z"}, "message": "Fix parser for macro call in pattern position", "tree": {"sha": "35a9048f1f6f7a7e948faf2f337dd7973ab3427b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/35a9048f1f6f7a7e948faf2f337dd7973ab3427b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da", "html_url": "https://github.com/rust-lang/rust/commit/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af5e2abe15c2bf182b871e26a680507a51526176", "url": "https://api.github.com/repos/rust-lang/rust/commits/af5e2abe15c2bf182b871e26a680507a51526176", "html_url": "https://github.com/rust-lang/rust/commit/af5e2abe15c2bf182b871e26a680507a51526176"}], "stats": {"total": 47, "additions": 41, "deletions": 6}, "files": [{"sha": "79d332e8cea6f4aa180596968fb321fcc854c349", "filename": "crates/ra_ide/src/goto_definition.rs", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs?ref=4a7e19946a60b4cba6ef9d9916ae0fbec65c74da", "patch": "@@ -424,6 +424,42 @@ mod tests {\n         );\n     }\n \n+    #[test]\n+    fn goto_definition_works_for_macro_inside_pattern() {\n+        check_goto(\n+            \"\n+            //- /lib.rs\n+            macro_rules! foo {() => {0}}\n+\n+            fn bar() {\n+                match (0,1) {\n+                    (<|>foo!(), _) => {}\n+                }\n+            }\n+            \",\n+            \"foo MACRO_CALL FileId(1) [0; 28) [13; 16)\",\n+            \"macro_rules! foo {() => {0}}|foo\",\n+        );\n+    }\n+\n+    #[test]\n+    fn goto_definition_works_for_macro_inside_match_arm_lhs() {\n+        check_goto(\n+            \"\n+            //- /lib.rs\n+            macro_rules! foo {() => {0}}\n+\n+            fn bar() {\n+                match 0 {\n+                    <|>foo!() => {}\n+                }\n+            }\n+            \",\n+            \"foo MACRO_CALL FileId(1) [0; 28) [13; 16)\",\n+            \"macro_rules! foo {() => {0}}|foo\",\n+        );\n+    }\n+\n     #[test]\n     fn goto_def_for_methods() {\n         covers!(goto_def_for_methods);"}, {"sha": "422a4e3dc175b176a8fdd7bb90900f090a7cc12c", "filename": "crates/ra_parser/src/grammar/patterns.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs?ref=4a7e19946a60b4cba6ef9d9916ae0fbec65c74da", "patch": "@@ -50,7 +50,7 @@ pub(super) fn pattern_r(p: &mut Parser, recovery_set: TokenSet) {\n         //     let m!(x) = 0;\n         // }\n         if lhs.kind() == PATH_PAT && p.at(T![!]) {\n-            let m = lhs.precede(p);\n+            let m = lhs.undo_completion(p);\n             items::macro_call_after_excl(p);\n             m.complete(p, MACRO_CALL);\n         }"}, {"sha": "b05ccc0ed5735736d208c55a5db25cd416d5fe62", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0129_marco_pat.txt", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0129_marco_pat.txt", "raw_url": "https://github.com/rust-lang/rust/raw/4a7e19946a60b4cba6ef9d9916ae0fbec65c74da/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0129_marco_pat.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0129_marco_pat.txt?ref=4a7e19946a60b4cba6ef9d9916ae0fbec65c74da", "patch": "@@ -16,11 +16,10 @@ SOURCE_FILE@[0; 33)\n           LET_KW@[16; 19) \"let\"\n           WHITESPACE@[19; 20) \" \"\n           MACRO_CALL@[20; 25)\n-            PATH_PAT@[20; 21)\n-              PATH@[20; 21)\n-                PATH_SEGMENT@[20; 21)\n-                  NAME_REF@[20; 21)\n-                    IDENT@[20; 21) \"m\"\n+            PATH@[20; 21)\n+              PATH_SEGMENT@[20; 21)\n+                NAME_REF@[20; 21)\n+                  IDENT@[20; 21) \"m\"\n             EXCL@[21; 22) \"!\"\n             TOKEN_TREE@[22; 25)\n               L_PAREN@[22; 23) \"(\""}]}