{"sha": "854abd319e1a7ed080100c66556b8583eb0624a7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg1NGFiZDMxOWUxYTdlZDA4MDEwMGM2NjU1NmI4NTgzZWIwNjI0YTc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-12-15T15:44:46Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-12-27T05:57:29Z"}, "message": "Added a job to dry-run the publish_toolstate.py once", "tree": {"sha": "4636d98a002cd5eb75a03425d114f4d76f0aa97f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4636d98a002cd5eb75a03425d114f4d76f0aa97f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/854abd319e1a7ed080100c66556b8583eb0624a7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlwkacsACgkQ/vbIBR0O\nATyVbRAAo68Hsr1WUIllyYFvB0DuzYyJaZlzCuVs2v4/lHn+FvnnnlJElRppjTCt\ngDXzvQEBKgQHwXU5KhEP1Fx0X+HZbnslVJ4De23es8k+m366LYOXcjijkihni6ZP\nxDfiAa9+Kvx4h1Ue1dRbUQOQrd8HIs8GXzonFIkMONqL3PqGLcBzx6sII4Ws0+Ow\nK6QcvmOjNiGxzv8gmYYNk55TXBaEJsxI5sBimYRV7RMVoGnpeXxErD7GMLymB1ot\nSUHzHU7KldI7BPqOtO1ECvHhhmSdKZmb8+Vvjw/BKwJ/uXegb831QsDu5fhFwGqj\naS6Z8KXQYFX1IyYqVWeC7yi1xhpG6vv4ob/jAPRxgp1fjIVNsiqsITF5iDbIdeWJ\nsE46Ej3MZiY2VJ3J5vjndQfWVDrGu/fmZNjrW1c+YCgqyQI22ga6aGGZ1jPxIudJ\nDE5/VAXcCZOGHtznJG3j8aBSwnwWxXOmwX5iW4akCZc4xlz9v18t/8YTYwUfH002\nf58Zhqg+6W14q/xo+VSSuk0Iq4VdBBjBv3MsxaFZqvmkXjNBupWkWVHiP7YS48Ce\nb3RhPIopgzqXcrYZAPoTU1v36cPYqEoDeOCDLhlR7ZFku5ogPmpNGurM2vTgydVv\nJResifCRlJFDLAcf2DL0+re7/G0yAxT5OFsUHK+1LzURx0IN6qc=\n=+QhF\n-----END PGP SIGNATURE-----", "payload": "tree 4636d98a002cd5eb75a03425d114f4d76f0aa97f\nparent a1bad57fa59a8069a6ebb05cd6a2ae73c88b2e98\nauthor kennytm <kennytm@gmail.com> 1544888686 +0800\ncommitter kennytm <kennytm@gmail.com> 1545890249 +0800\n\nAdded a job to dry-run the publish_toolstate.py once\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/854abd319e1a7ed080100c66556b8583eb0624a7", "html_url": "https://github.com/rust-lang/rust/commit/854abd319e1a7ed080100c66556b8583eb0624a7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/854abd319e1a7ed080100c66556b8583eb0624a7/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1bad57fa59a8069a6ebb05cd6a2ae73c88b2e98", "url": "https://api.github.com/repos/rust-lang/rust/commits/a1bad57fa59a8069a6ebb05cd6a2ae73c88b2e98", "html_url": "https://github.com/rust-lang/rust/commit/a1bad57fa59a8069a6ebb05cd6a2ae73c88b2e98"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "7f99678499acef31680429e2f6997a4ea6d43293", "filename": ".travis.yml", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/854abd319e1a7ed080100c66556b8583eb0624a7/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/854abd319e1a7ed080100c66556b8583eb0624a7/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=854abd319e1a7ed080100c66556b8583eb0624a7", "patch": "@@ -248,6 +248,15 @@ before_script:\n           # Enable core dump on Linux.\n           sudo sh -c 'echo \"/checkout/obj/cores/core.%p.%E\" > /proc/sys/kernel/core_pattern';\n       fi\n+  - >\n+      if [ \"$IMAGE\" = mingw-check ]; then\n+        # verify the publish_toolstate script works.\n+        git clone --depth=1 https://github.com/rust-lang-nursery/rust-toolstate.git;\n+        cd rust-toolstate;\n+        python2.7 \"$TRAVIS_BUILD_DIR/src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \"$(git log --format=%s -n1 HEAD)\" \"\" \"\";\n+        cd ..;\n+        rm -rf rust-toolstate;\n+      fi\n \n # Log time information from this machine and an external machine for insight into possible\n # clock drift. Timezones don't matter since relative deltas give all the necessary info."}, {"sha": "323f81181682f45a9bb41bf36bf92d3ca7daec9f", "filename": "src/tools/publish_toolstate.py", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/854abd319e1a7ed080100c66556b8583eb0624a7/src%2Ftools%2Fpublish_toolstate.py", "raw_url": "https://github.com/rust-lang/rust/raw/854abd319e1a7ed080100c66556b8583eb0624a7/src%2Ftools%2Fpublish_toolstate.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fpublish_toolstate.py?ref=854abd319e1a7ed080100c66556b8583eb0624a7", "patch": "@@ -120,6 +120,11 @@ def update_latest(\n         sys.exit(0)\n \n     print(message)\n+\n+    if not github_token:\n+        print('Dry run only, not committing anything')\n+        sys.exit(0)\n+\n     with open(save_message_to_path, 'w') as f:\n         f.write(message)\n "}]}