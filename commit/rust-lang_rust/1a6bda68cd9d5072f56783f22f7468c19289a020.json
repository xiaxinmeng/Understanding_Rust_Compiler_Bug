{"sha": "1a6bda68cd9d5072f56783f22f7468c19289a020", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhNmJkYTY4Y2Q5ZDUwNzJmNTY3ODNmMjJmNzQ2OGMxOTI4OWEwMjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-27T03:32:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-27T03:32:47Z"}, "message": "Auto merge of #51075 - estebank:and_the_case_of_the_confusable_float_exponent, r=eddyb\n\nCheck for confusable Unicode chars in float literal exponent\n\nFixing tests for #49989. Resolves #49746.", "tree": {"sha": "d07bdbc217214d65ea849c3de07e814e8e27c035", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d07bdbc217214d65ea849c3de07e814e8e27c035"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a6bda68cd9d5072f56783f22f7468c19289a020", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a6bda68cd9d5072f56783f22f7468c19289a020", "html_url": "https://github.com/rust-lang/rust/commit/1a6bda68cd9d5072f56783f22f7468c19289a020", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a6bda68cd9d5072f56783f22f7468c19289a020/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0805a4421449bd6fe3096d63820fbebe2bfcd1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0805a4421449bd6fe3096d63820fbebe2bfcd1d", "html_url": "https://github.com/rust-lang/rust/commit/f0805a4421449bd6fe3096d63820fbebe2bfcd1d"}, {"sha": "7dec8a4e99ee10696a3b1e61bfa5918683c49437", "url": "https://api.github.com/repos/rust-lang/rust/commits/7dec8a4e99ee10696a3b1e61bfa5918683c49437", "html_url": "https://github.com/rust-lang/rust/commit/7dec8a4e99ee10696a3b1e61bfa5918683c49437"}], "stats": {"total": 53, "additions": 45, "deletions": 8}, "files": [{"sha": "c39eb1594b28bf3591b8546a89421655c795c0cc", "filename": "src/libsyntax/parse/lexer/mod.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs?ref=1a6bda68cd9d5072f56783f22f7468c19289a020", "patch": "@@ -1075,9 +1075,18 @@ impl<'a> StringReader<'a> {\n                 self.bump();\n             }\n             if self.scan_digits(10, 10) == 0 {\n-                self.err_span_(self.pos,\n-                               self.next_pos,\n-                               \"expected at least one digit in exponent\")\n+                let mut err = self.struct_span_fatal(\n+                    self.pos, self.next_pos,\n+                    \"expected at least one digit in exponent\"\n+                );\n+                if let Some(ch) = self.ch {\n+                    // check for e.g. Unicode minus '\u2212' (Issue #49746)\n+                    if unicode_chars::check_for_substitution(self, ch, &mut err) {\n+                        self.bump();\n+                        self.scan_digits(10, 10);\n+                    }\n+                }\n+                err.emit();\n             }\n         }\n     }"}, {"sha": "c5c2e02523302c20100bb407ae1d03d2462bb161", "filename": "src/libsyntax/parse/lexer/unicode_chars.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Flibsyntax%2Fparse%2Flexer%2Funicode_chars.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Flibsyntax%2Fparse%2Flexer%2Funicode_chars.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer%2Funicode_chars.rs?ref=1a6bda68cd9d5072f56783f22f7468c19289a020", "patch": "@@ -335,7 +335,7 @@ const ASCII_ARRAY: &'static [(char, &'static str)] = &[\n \n pub fn check_for_substitution<'a>(reader: &StringReader<'a>,\n                                   ch: char,\n-                                  err: &mut DiagnosticBuilder<'a>) {\n+                                  err: &mut DiagnosticBuilder<'a>) -> bool {\n     UNICODE_ARRAY\n     .iter()\n     .find(|&&(c, _, _)| c == ch)\n@@ -344,14 +344,16 @@ pub fn check_for_substitution<'a>(reader: &StringReader<'a>,\n         match ASCII_ARRAY.iter().find(|&&(c, _)| c == ascii_char) {\n             Some(&(ascii_char, ascii_name)) => {\n                 let msg =\n-                    format!(\"unicode character '{}' ({}) looks like '{}' ({}), but it's not\",\n+                    format!(\"Unicode character '{}' ({}) looks like '{}' ({}), but it is not\",\n                             ch, u_name, ascii_char, ascii_name);\n-                err.span_help(span, &msg);\n+                err.span_suggestion(span, &msg, ascii_char.to_string());\n+                true\n             },\n             None => {\n                 let msg = format!(\"substitution character not found for '{}'\", ch);\n                 reader.sess.span_diagnostic.span_bug_no_panic(span, &msg);\n+                false\n             }\n         }\n-    });\n+    }).unwrap_or(false)\n }"}, {"sha": "f590a7f2aa2eb9a4fea9638317bc2ebd46c762da", "filename": "src/test/parse-fail/unicode-chars.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Ftest%2Fparse-fail%2Funicode-chars.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Ftest%2Fparse-fail%2Funicode-chars.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fparse-fail%2Funicode-chars.rs?ref=1a6bda68cd9d5072f56783f22f7468c19289a020", "patch": "@@ -13,5 +13,5 @@\n fn main() {\n     let y = 0\u037e\n     //~^ ERROR unknown start of token: \\u{37e}\n-    //~^^ HELP unicode character '\u037e' (Greek Question Mark) looks like ';' (Semicolon), but it's not\n+    //~^^ HELP Unicode character '\u037e' (Greek Question Mark) looks like ';' (Semicolon), but it is not\n }"}, {"sha": "9daf9df695548ee76d7f4f782f1c1e38acc63cf7", "filename": "src/test/ui/did_you_mean/issue-49746-unicode-confusable-in-float-literal-expt.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.rs?ref=1a6bda68cd9d5072f56783f22f7468c19289a020", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+const UNIVERSAL_GRAVITATIONAL_CONSTANT: f64 = 6.674e\u221211; // m\u00b3\u22c5kg\u207b\u00b9\u22c5s\u207b\u00b2\n+//~^ ERROR expected at least one digit in exponent\n+\n+fn main() {}"}, {"sha": "b387472e0e7499e47b03921f021b983614232eea", "filename": "src/test/ui/did_you_mean/issue-49746-unicode-confusable-in-float-literal-expt.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1a6bda68cd9d5072f56783f22f7468c19289a020/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.stderr?ref=1a6bda68cd9d5072f56783f22f7468c19289a020", "patch": "@@ -0,0 +1,12 @@\n+error: expected at least one digit in exponent\n+  --> $DIR/issue-49746-unicode-confusable-in-float-literal-expt.rs:11:53\n+   |\n+LL | const UNIVERSAL_GRAVITATIONAL_CONSTANT: f64 = 6.674e\u221211; // m\u00b3\u22c5kg\u207b\u00b9\u22c5s\u207b\u00b2\n+   |                                                     ^\n+help: Unicode character '\u2212' (Minus Sign) looks like '-' (Minus/Hyphen), but it is not\n+   |\n+LL | const UNIVERSAL_GRAVITATIONAL_CONSTANT: f64 = 6.674e-11; // m\u00b3\u22c5kg\u207b\u00b9\u22c5s\u207b\u00b2\n+   |                                                     ^\n+\n+error: aborting due to previous error\n+"}]}