{"sha": "37e8e0571279265f8abfdd9dd93fbc58677029df", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3ZThlMDU3MTI3OTI2NWY4YWJmZGQ5ZGQ5M2ZiYzU4Njc3MDI5ZGY=", "commit": {"author": {"name": "Tom Eccles", "email": "tom.eccles@codethink.co.uk", "date": "2020-06-04T10:13:52Z"}, "committer": {"name": "Tom Eccles", "email": "tom.eccles@codethink.co.uk", "date": "2020-06-04T11:02:03Z"}, "message": "test: codegen: Add riscv abi llvm intrinsics test", "tree": {"sha": "784b806209cb5adda79f3aa5093e5cc9fc819826", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/784b806209cb5adda79f3aa5093e5cc9fc819826"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37e8e0571279265f8abfdd9dd93fbc58677029df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37e8e0571279265f8abfdd9dd93fbc58677029df", "html_url": "https://github.com/rust-lang/rust/commit/37e8e0571279265f8abfdd9dd93fbc58677029df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37e8e0571279265f8abfdd9dd93fbc58677029df/comments", "author": {"login": "tblah", "id": 3716681, "node_id": "MDQ6VXNlcjM3MTY2ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3716681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tblah", "html_url": "https://github.com/tblah", "followers_url": "https://api.github.com/users/tblah/followers", "following_url": "https://api.github.com/users/tblah/following{/other_user}", "gists_url": "https://api.github.com/users/tblah/gists{/gist_id}", "starred_url": "https://api.github.com/users/tblah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tblah/subscriptions", "organizations_url": "https://api.github.com/users/tblah/orgs", "repos_url": "https://api.github.com/users/tblah/repos", "events_url": "https://api.github.com/users/tblah/events{/privacy}", "received_events_url": "https://api.github.com/users/tblah/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tblah", "id": 3716681, "node_id": "MDQ6VXNlcjM3MTY2ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3716681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tblah", "html_url": "https://github.com/tblah", "followers_url": "https://api.github.com/users/tblah/followers", "following_url": "https://api.github.com/users/tblah/following{/other_user}", "gists_url": "https://api.github.com/users/tblah/gists{/gist_id}", "starred_url": "https://api.github.com/users/tblah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tblah/subscriptions", "organizations_url": "https://api.github.com/users/tblah/orgs", "repos_url": "https://api.github.com/users/tblah/repos", "events_url": "https://api.github.com/users/tblah/events{/privacy}", "received_events_url": "https://api.github.com/users/tblah/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c872dcf956e541315985ee5fdc592907c20df8ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/c872dcf956e541315985ee5fdc592907c20df8ec", "html_url": "https://github.com/rust-lang/rust/commit/c872dcf956e541315985ee5fdc592907c20df8ec"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "24e3d3cd64b58ce41268ac8f83e821d9f0c79ee5", "filename": "src/test/codegen/call-llvm-intrinsics.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/37e8e0571279265f8abfdd9dd93fbc58677029df/src%2Ftest%2Fcodegen%2Fcall-llvm-intrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37e8e0571279265f8abfdd9dd93fbc58677029df/src%2Ftest%2Fcodegen%2Fcall-llvm-intrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fcall-llvm-intrinsics.rs?ref=37e8e0571279265f8abfdd9dd93fbc58677029df", "patch": "@@ -1,5 +1,7 @@\n // compile-flags: -C no-prepopulate-passes\n \n+// ignore-riscv64\n+\n #![feature(link_llvm_intrinsics)]\n #![crate_type = \"lib\"]\n "}, {"sha": "f100a23a3189756c75006937c389be5e51d0f063", "filename": "src/test/codegen/riscv-abi/call-llvm-intrinsics.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/37e8e0571279265f8abfdd9dd93fbc58677029df/src%2Ftest%2Fcodegen%2Friscv-abi%2Fcall-llvm-intrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37e8e0571279265f8abfdd9dd93fbc58677029df/src%2Ftest%2Fcodegen%2Friscv-abi%2Fcall-llvm-intrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Friscv-abi%2Fcall-llvm-intrinsics.rs?ref=37e8e0571279265f8abfdd9dd93fbc58677029df", "patch": "@@ -0,0 +1,30 @@\n+// compile-flags: -C no-prepopulate-passes\n+\n+// only-riscv64\n+\n+#![feature(link_llvm_intrinsics)]\n+#![crate_type = \"lib\"]\n+\n+struct A;\n+\n+impl Drop for A {\n+    fn drop(&mut self) {\n+        println!(\"A\");\n+    }\n+}\n+\n+extern {\n+    #[link_name = \"llvm.sqrt.f32\"]\n+    fn sqrt(x: f32) -> f32;\n+}\n+\n+pub fn do_call() {\n+    let _a = A;\n+\n+    unsafe {\n+        // Ensure that we `call` LLVM intrinsics instead of trying to `invoke` them\n+        // CHECK: store float 4.000000e+00, float* %{{.}}, align 4\n+        // CHECK: call float @llvm.sqrt.f32(float %{{.}}\n+        sqrt(4.0);\n+    }\n+}"}]}