{"sha": "e98b0e8ee7d3ab6273625049e3e23118a0f15813", "node_id": "C_kwDOAAsO6NoAKGU5OGIwZThlZTdkM2FiNjI3MzYyNTA0OWUzZTIzMTE4YTBmMTU4MTM", "commit": {"author": {"name": "hdelc", "email": "hdelc02@gmail.com", "date": "2022-07-30T21:45:09Z"}, "committer": {"name": "hdelc", "email": "hdelc02@gmail.com", "date": "2022-08-01T17:11:12Z"}, "message": "Prevent ICE for doc_alias on match arm, statement, expression", "tree": {"sha": "a03646de14e7a350d7d2e1619bbfab978c32a849", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a03646de14e7a350d7d2e1619bbfab978c32a849"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e98b0e8ee7d3ab6273625049e3e23118a0f15813", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e98b0e8ee7d3ab6273625049e3e23118a0f15813", "html_url": "https://github.com/rust-lang/rust/commit/e98b0e8ee7d3ab6273625049e3e23118a0f15813", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e98b0e8ee7d3ab6273625049e3e23118a0f15813/comments", "author": {"login": "hdelc", "id": 62157015, "node_id": "MDQ6VXNlcjYyMTU3MDE1", "avatar_url": "https://avatars.githubusercontent.com/u/62157015?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hdelc", "html_url": "https://github.com/hdelc", "followers_url": "https://api.github.com/users/hdelc/followers", "following_url": "https://api.github.com/users/hdelc/following{/other_user}", "gists_url": "https://api.github.com/users/hdelc/gists{/gist_id}", "starred_url": "https://api.github.com/users/hdelc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hdelc/subscriptions", "organizations_url": "https://api.github.com/users/hdelc/orgs", "repos_url": "https://api.github.com/users/hdelc/repos", "events_url": "https://api.github.com/users/hdelc/events{/privacy}", "received_events_url": "https://api.github.com/users/hdelc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hdelc", "id": 62157015, "node_id": "MDQ6VXNlcjYyMTU3MDE1", "avatar_url": "https://avatars.githubusercontent.com/u/62157015?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hdelc", "html_url": "https://github.com/hdelc", "followers_url": "https://api.github.com/users/hdelc/followers", "following_url": "https://api.github.com/users/hdelc/following{/other_user}", "gists_url": "https://api.github.com/users/hdelc/gists{/gist_id}", "starred_url": "https://api.github.com/users/hdelc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hdelc/subscriptions", "organizations_url": "https://api.github.com/users/hdelc/orgs", "repos_url": "https://api.github.com/users/hdelc/repos", "events_url": "https://api.github.com/users/hdelc/events{/privacy}", "received_events_url": "https://api.github.com/users/hdelc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dcb444af0a417766dde9b7b8f537fa1ba1568daf", "url": "https://api.github.com/repos/rust-lang/rust/commits/dcb444af0a417766dde9b7b8f537fa1ba1568daf", "html_url": "https://github.com/rust-lang/rust/commit/dcb444af0a417766dde9b7b8f537fa1ba1568daf"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "2fcd85b2a53112cbee7e5f5abb4f7223a065ea74", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e98b0e8ee7d3ab6273625049e3e23118a0f15813/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e98b0e8ee7d3ab6273625049e3e23118a0f15813/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=e98b0e8ee7d3ab6273625049e3e23118a0f15813", "patch": "@@ -619,6 +619,9 @@ impl CheckAttrVisitor<'_> {\n             }\n             // we check the validity of params elsewhere\n             Target::Param => return false,\n+            Target::Expression => Some(\"expression\"),\n+            Target::Statement => Some(\"statement\"),\n+            Target::Arm => Some(\"match arm\"),\n             _ => None,\n         } {\n             tcx.sess.emit_err(errors::DocAliasBadLocation { span, attr_str, location });"}, {"sha": "10609e5d8f4d99661e962928ed32bc4516510c5f", "filename": "src/test/ui/rustdoc/check-doc-alias-attr-location.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e98b0e8ee7d3ab6273625049e3e23118a0f15813/src%2Ftest%2Fui%2Frustdoc%2Fcheck-doc-alias-attr-location.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e98b0e8ee7d3ab6273625049e3e23118a0f15813/src%2Ftest%2Fui%2Frustdoc%2Fcheck-doc-alias-attr-location.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frustdoc%2Fcheck-doc-alias-attr-location.rs?ref=e98b0e8ee7d3ab6273625049e3e23118a0f15813", "patch": "@@ -21,6 +21,12 @@ impl Foo for Bar {\n     type X = i32;\n     fn foo(#[doc(alias = \"qux\")] _x: u32) -> Self::X {\n         //~^ ERROR\n-        0\n+        #[doc(alias = \"stmt\")] //~ ERROR\n+        let x = 0;\n+        #[doc(alias = \"expr\")] //~ ERROR\n+        match x {\n+            #[doc(alias = \"arm\")] //~ ERROR\n+            _ => 0\n+        }\n     }\n }"}, {"sha": "19b2dd1e08429be9d87d064679d3f3fd8638632d", "filename": "src/test/ui/rustdoc/check-doc-alias-attr-location.stderr", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e98b0e8ee7d3ab6273625049e3e23118a0f15813/src%2Ftest%2Fui%2Frustdoc%2Fcheck-doc-alias-attr-location.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e98b0e8ee7d3ab6273625049e3e23118a0f15813/src%2Ftest%2Fui%2Frustdoc%2Fcheck-doc-alias-attr-location.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frustdoc%2Fcheck-doc-alias-attr-location.stderr?ref=e98b0e8ee7d3ab6273625049e3e23118a0f15813", "patch": "@@ -28,5 +28,23 @@ error: `#[doc(alias = \"...\")]` isn't allowed on type alias in implementation blo\n LL |     #[doc(alias = \"assoc\")]\n    |           ^^^^^^^^^^^^^^^\n \n-error: aborting due to 5 previous errors\n+error: `#[doc(alias = \"...\")]` isn't allowed on statement\n+  --> $DIR/check-doc-alias-attr-location.rs:24:15\n+   |\n+LL |         #[doc(alias = \"stmt\")]\n+   |               ^^^^^^^^^^^^^^\n+\n+error: `#[doc(alias = \"...\")]` isn't allowed on expression\n+  --> $DIR/check-doc-alias-attr-location.rs:26:15\n+   |\n+LL |         #[doc(alias = \"expr\")]\n+   |               ^^^^^^^^^^^^^^\n+\n+error: `#[doc(alias = \"...\")]` isn't allowed on match arm\n+  --> $DIR/check-doc-alias-attr-location.rs:28:19\n+   |\n+LL |             #[doc(alias = \"arm\")]\n+   |                   ^^^^^^^^^^^^^\n+\n+error: aborting due to 8 previous errors\n "}]}