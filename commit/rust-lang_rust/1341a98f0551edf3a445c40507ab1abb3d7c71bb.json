{"sha": "1341a98f0551edf3a445c40507ab1abb3d7c71bb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEzNDFhOThmMDU1MWVkZjNhNDQ1YzQwNTA3YWIxYWJiM2Q3YzcxYmI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-12-10T13:17:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-10T13:17:53Z"}, "message": "Merge #6796\n\n6796: Fix FileId computation in IncorrectCase fix r=jonas-schievink a=jonas-schievink\n\nFixes the sub-issue mentioned in https://github.com/rust-analyzer/rust-analyzer/issues/4058#issuecomment-741919659\r\n\r\nbors r+\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>", "tree": {"sha": "aeb3cb34a21785a8d92d2747c059f5d8c47e0c5d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aeb3cb34a21785a8d92d2747c059f5d8c47e0c5d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1341a98f0551edf3a445c40507ab1abb3d7c71bb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf0iABCRBK7hj4Ov3rIwAAdHIIACJzOJHXw2sWoMg8GR2k6fay\ngBYlTbOUdfOJkLjxDejaFR13DpNi2/Zxw0Q2uNLHXfgNvaPYOkm5hC4NYD6w+Lkh\ndHAYFxtMPuTr9PdtbmQ2xFhEYLuzB1n/fA1TPwMbxarjjNEZU6tvw0cYzk0KKXIB\nrQgpVe/OITGukIIC1n78HEprGUWomVLfLKYPuHoqOWsGX/wpKBYjBLgUobiuJntF\nGbfB6msyWpNllMOSpFgMhptuU/rDdnoTMGo9gsWq2eOCN/gEE8LKFQ67lZxdP1lM\n4RfkW/PuIKAOtP0pVtCgPIZmmje56PAR9GzNaydRMqpSXxUIOBrdYO05v42+9nA=\n=dd9K\n-----END PGP SIGNATURE-----\n", "payload": "tree aeb3cb34a21785a8d92d2747c059f5d8c47e0c5d\nparent 8d5da92e4c779e1222023295c3d29b18eafbdb99\nparent f57ce369880f952c97e8a063b5f0fe4abe1d84a4\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1607606273 +0000\ncommitter GitHub <noreply@github.com> 1607606273 +0000\n\nMerge #6796\n\n6796: Fix FileId computation in IncorrectCase fix r=jonas-schievink a=jonas-schievink\n\nFixes the sub-issue mentioned in https://github.com/rust-analyzer/rust-analyzer/issues/4058#issuecomment-741919659\r\n\r\nbors r+\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1341a98f0551edf3a445c40507ab1abb3d7c71bb", "html_url": "https://github.com/rust-lang/rust/commit/1341a98f0551edf3a445c40507ab1abb3d7c71bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1341a98f0551edf3a445c40507ab1abb3d7c71bb/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d5da92e4c779e1222023295c3d29b18eafbdb99", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d5da92e4c779e1222023295c3d29b18eafbdb99", "html_url": "https://github.com/rust-lang/rust/commit/8d5da92e4c779e1222023295c3d29b18eafbdb99"}, {"sha": "f57ce369880f952c97e8a063b5f0fe4abe1d84a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f57ce369880f952c97e8a063b5f0fe4abe1d84a4", "html_url": "https://github.com/rust-lang/rust/commit/f57ce369880f952c97e8a063b5f0fe4abe1d84a4"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "a900d7bae457fc326b931c28204af60b91b7f623", "filename": "crates/ide/src/diagnostics/fixes.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1341a98f0551edf3a445c40507ab1abb3d7c71bb/crates%2Fide%2Fsrc%2Fdiagnostics%2Ffixes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1341a98f0551edf3a445c40507ab1abb3d7c71bb/crates%2Fide%2Fsrc%2Fdiagnostics%2Ffixes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdiagnostics%2Ffixes.rs?ref=1341a98f0551edf3a445c40507ab1abb3d7c71bb", "patch": "@@ -6,7 +6,7 @@ use hir::{\n         Diagnostic, IncorrectCase, MissingFields, MissingOkInTailExpr, NoSuchField,\n         UnresolvedModule,\n     },\n-    HasSource, HirDisplay, Semantics, VariantDef,\n+    HasSource, HirDisplay, InFile, Semantics, VariantDef,\n };\n use ide_db::base_db::{AnchoredPathBuf, FileId};\n use ide_db::{\n@@ -110,9 +110,9 @@ impl DiagnosticWithFix for IncorrectCase {\n         let root = sema.db.parse_or_expand(self.file)?;\n         let name_node = self.ident.to_node(&root);\n \n-        let file_id = self.file.original_file(sema.db);\n-        let offset = name_node.syntax().text_range().start();\n-        let file_position = FilePosition { file_id, offset };\n+        let name_node = InFile::new(self.file, name_node.syntax());\n+        let frange = name_node.original_file_range(sema.db);\n+        let file_position = FilePosition { file_id: frange.file_id, offset: frange.range.start() };\n \n         let rename_changes =\n             rename_with_semantics(sema, file_position, &self.suggested_text).ok()?;"}]}