{"sha": "a3409c3a83fb1d8139bac8b3e438f56f2ac633a3", "node_id": "C_kwDOAAsO6NoAKGEzNDA5YzNhODNmYjFkODEzOWJhYzhiM2U0MzhmNTZmMmFjNjMzYTM", "commit": {"author": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-08-16T01:08:45Z"}, "committer": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-08-17T09:46:17Z"}, "message": "fix: escape keywords used as names in earlier editions", "tree": {"sha": "54781d22e9918a12b35b95bdbca7bd85793ccb44", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54781d22e9918a12b35b95bdbca7bd85793ccb44"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEkSbsQIURluxz4rzf4laYqTBYYXEFAmL8uOkACgkQ4laYqTBY\nYXGV+g//YgOel2u+h4zlT72ldY2JHN7QKyK4HuZdhsmFLV1C4I1vnKshE/LXpCOE\nZHt2Fnp7QJh9XogLKJ7r1UP/GbGBIXwmd7tjEOUjISgw3q1zHXm3FA/Q9q7YoBgO\nn1RI2D55jffqD7lUmy/KD3FOKl9RcvQLXh0V8sDYSVPVuW8kKHlJ9Xs2alPbcDZx\nEhjTjUiVVS7d7vX64x7KYIFpeEou89UKOcNeQllcyNHTMOhpvv7jDH7WOR6KyviS\noJ8Wo2+wNlfXDOGKiT+t73R97n9sgsW7HiCBk3J62ENiriQDFpbrjfw6f+qlHViH\naM549qXLf2MH8I3ExwOsm0paMTnqySzPSRWFBp4fkV4tDqWICZmoLkez7pjaEhtg\ntHEkAPSaI5e2TKVbMzoBFMqHyXUQYSMksnfsTutOvX9xIraCJVdcP989gcr4SCIa\npG8duq9WADWrqZ6fIm9tEeDeJlZkNnIYTVVxljR6eieIkvBg448cb2xss0ZpVnFL\n5k4qpMBaBP87OnzjeF1PDj8jhd392QcAyAyL6UzRqzVH/GuvHEIfD4kZGKIBL26z\nQVC7F5gZtTFb7G2uqh2rEQM/70SIXsPzaH0ks1wbHfuJFejqdUuxwgX8LEeSgr0i\n5LXO5qsBnJX2p3DvZq4aM7g8Ef4LV+RPM2LuVySzZdxYCld11oY=\n=yPl8\n-----END PGP SIGNATURE-----", "payload": "tree 54781d22e9918a12b35b95bdbca7bd85793ccb44\nparent 010f68cacfdddcc50234b54965e1326d7ad925ab\nauthor Ryo Yoshida <low.ryoshida@gmail.com> 1660612125 +0900\ncommitter Ryo Yoshida <low.ryoshida@gmail.com> 1660729577 +0900\n\nfix: escape keywords used as names in earlier editions\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3", "html_url": "https://github.com/rust-lang/rust/commit/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3/comments", "author": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "010f68cacfdddcc50234b54965e1326d7ad925ab", "url": "https://api.github.com/repos/rust-lang/rust/commits/010f68cacfdddcc50234b54965e1326d7ad925ab", "html_url": "https://github.com/rust-lang/rust/commit/010f68cacfdddcc50234b54965e1326d7ad925ab"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "a1bb353374be074a71c438b94b326bc4e8dc476a", "filename": "crates/hir-expand/src/name.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3/crates%2Fhir-expand%2Fsrc%2Fname.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3/crates%2Fhir-expand%2Fsrc%2Fname.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-expand%2Fsrc%2Fname.rs?ref=a3409c3a83fb1d8139bac8b3e438f56f2ac633a3", "patch": "@@ -90,10 +90,16 @@ impl Name {\n \n     /// Resolve a name from the text of token.\n     fn resolve(raw_text: &str) -> Name {\n-        // When `raw_text` starts with \"r#\" but the name does not coincide with any\n-        // keyword, we never need the prefix so we strip it.\n         match raw_text.strip_prefix(\"r#\") {\n+            // When `raw_text` starts with \"r#\" but the name does not coincide with any\n+            // keyword, we never need the prefix so we strip it.\n             Some(text) if !is_raw_identifier(text) => Name::new_text(SmolStr::new(text)),\n+            // Keywords (in the current edition) *can* be used as a name in earlier editions of\n+            // Rust, e.g. \"try\" in Rust 2015. Even in such cases, we keep track of them in their\n+            // escaped form.\n+            None if is_raw_identifier(raw_text) => {\n+                Name::new_text(SmolStr::from_iter([\"r#\", raw_text]))\n+            }\n             _ => Name::new_text(raw_text.into()),\n         }\n     }"}, {"sha": "2f4aa113170a6f6865a3b6e560db8aa2727cfcce", "filename": "crates/ide-db/src/search.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3/crates%2Fide-db%2Fsrc%2Fsearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3409c3a83fb1d8139bac8b3e438f56f2ac633a3/crates%2Fide-db%2Fsrc%2Fsearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-db%2Fsrc%2Fsearch.rs?ref=a3409c3a83fb1d8139bac8b3e438f56f2ac633a3", "patch": "@@ -402,7 +402,9 @@ impl<'a> FindUsages<'a> {\n                             .or_else(|| ty.as_builtin().map(|builtin| builtin.name()))\n                     })\n                 };\n-                self.def.name(sema.db).or_else(self_kw_refs).map(|it| it.to_smol_str())\n+                // We need to unescape the name in case it is written without \"r#\" in earlier\n+                // editions of Rust where it isn't a keyword.\n+                self.def.name(sema.db).or_else(self_kw_refs).map(|it| it.unescaped().to_smol_str())\n             }\n         };\n         let name = match &name {"}]}