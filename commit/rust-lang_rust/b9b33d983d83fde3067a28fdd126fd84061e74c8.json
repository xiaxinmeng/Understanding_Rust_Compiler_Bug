{"sha": "b9b33d983d83fde3067a28fdd126fd84061e74c8", "node_id": "C_kwDOAAsO6NoAKGI5YjMzZDk4M2Q4M2ZkZTMwNjdhMjhmZGQxMjZmZDg0MDYxZTc0Yzg", "commit": {"author": {"name": "DebugSteven", "email": "debugsteven@gmail.com", "date": "2022-12-05T23:18:43Z"}, "committer": {"name": "DebugSteven", "email": "debugsteven@gmail.com", "date": "2022-12-31T18:38:41Z"}, "message": "spawn x command and compare semvers", "tree": {"sha": "7038709fd8da993fdaabeffa5e4af30c5a51763c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7038709fd8da993fdaabeffa5e4af30c5a51763c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9b33d983d83fde3067a28fdd126fd84061e74c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9b33d983d83fde3067a28fdd126fd84061e74c8", "html_url": "https://github.com/rust-lang/rust/commit/b9b33d983d83fde3067a28fdd126fd84061e74c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9b33d983d83fde3067a28fdd126fd84061e74c8/comments", "author": {"login": "DebugSteven", "id": 10746702, "node_id": "MDQ6VXNlcjEwNzQ2NzAy", "avatar_url": "https://avatars.githubusercontent.com/u/10746702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DebugSteven", "html_url": "https://github.com/DebugSteven", "followers_url": "https://api.github.com/users/DebugSteven/followers", "following_url": "https://api.github.com/users/DebugSteven/following{/other_user}", "gists_url": "https://api.github.com/users/DebugSteven/gists{/gist_id}", "starred_url": "https://api.github.com/users/DebugSteven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DebugSteven/subscriptions", "organizations_url": "https://api.github.com/users/DebugSteven/orgs", "repos_url": "https://api.github.com/users/DebugSteven/repos", "events_url": "https://api.github.com/users/DebugSteven/events{/privacy}", "received_events_url": "https://api.github.com/users/DebugSteven/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DebugSteven", "id": 10746702, "node_id": "MDQ6VXNlcjEwNzQ2NzAy", "avatar_url": "https://avatars.githubusercontent.com/u/10746702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DebugSteven", "html_url": "https://github.com/DebugSteven", "followers_url": "https://api.github.com/users/DebugSteven/followers", "following_url": "https://api.github.com/users/DebugSteven/following{/other_user}", "gists_url": "https://api.github.com/users/DebugSteven/gists{/gist_id}", "starred_url": "https://api.github.com/users/DebugSteven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DebugSteven/subscriptions", "organizations_url": "https://api.github.com/users/DebugSteven/orgs", "repos_url": "https://api.github.com/users/DebugSteven/repos", "events_url": "https://api.github.com/users/DebugSteven/events{/privacy}", "received_events_url": "https://api.github.com/users/DebugSteven/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2cd3374e9a7ed637b1b5f1a85cb92a7928d712d", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2cd3374e9a7ed637b1b5f1a85cb92a7928d712d", "html_url": "https://github.com/rust-lang/rust/commit/b2cd3374e9a7ed637b1b5f1a85cb92a7928d712d"}], "stats": {"total": 45, "additions": 33, "deletions": 12}, "files": [{"sha": "8cafdc83d4f4d7ffd1981c08024b4d41df59066a", "filename": "Cargo.lock", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b9b33d983d83fde3067a28fdd126fd84061e74c8/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/b9b33d983d83fde3067a28fdd126fd84061e74c8/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=b9b33d983d83fde3067a28fdd126fd84061e74c8", "patch": "@@ -4805,9 +4805,9 @@ checksum = \"1ef965a420fe14fdac7dd018862966a4c14094f900e1650bbc71ddd7d580c8af\"\n \n [[package]]\n name = \"semver\"\n-version = \"1.0.12\"\n+version = \"1.0.14\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a2333e6df6d6598f2b1974829f853c2b4c5f4a6e503c10af918081aa6f8564e1\"\n+checksum = \"e25dfac463d778e353db5be2449d1cce89bd6fd23c9f1ea21310ce6e5a1b29c4\"\n dependencies = [\n  \"serde\",\n ]\n@@ -5309,6 +5309,7 @@ dependencies = [\n  \"lazy_static\",\n  \"miropt-test-tools\",\n  \"regex\",\n+ \"semver\",\n  \"termcolor\",\n  \"walkdir\",\n ]"}, {"sha": "5f5ae3a65efa81c34498c40c6de57fd59ddd81af", "filename": "src/tools/tidy/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b9b33d983d83fde3067a28fdd126fd84061e74c8/src%2Ftools%2Ftidy%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b9b33d983d83fde3067a28fdd126fd84061e74c8/src%2Ftools%2Ftidy%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2FCargo.toml?ref=b9b33d983d83fde3067a28fdd126fd84061e74c8", "patch": "@@ -11,6 +11,7 @@ miropt-test-tools = { path = \"../miropt-test-tools\" }\n lazy_static = \"1\"\n walkdir = \"2\"\n ignore = \"0.4.18\"\n+semver = \"1.0.14\"\n termcolor = \"1.1.3\"\n \n [[bin]]"}, {"sha": "bbb2662bdcf6898a4bfcdec6b9c4fbe5c5a6c644", "filename": "src/tools/tidy/src/x_version.rs", "status": "modified", "additions": 29, "deletions": 10, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/b9b33d983d83fde3067a28fdd126fd84061e74c8/src%2Ftools%2Ftidy%2Fsrc%2Fx_version.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9b33d983d83fde3067a28fdd126fd84061e74c8/src%2Ftools%2Ftidy%2Fsrc%2Fx_version.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fx_version.rs?ref=b9b33d983d83fde3067a28fdd126fd84061e74c8", "patch": "@@ -1,17 +1,36 @@\n-use std::process::Command;\n+use semver::{BuildMetadata, Prerelease, Version};\n+use std::io::ErrorKind;\n+use std::process::{Command, Stdio};\n \n-pub fn check(_bad: &mut bool) {\n-    let result = Command::new(\"x\").arg(\"--version\").output();\n-    let output = match result {\n-        Ok(output) => output,\n-        Err(_e) => todo!(),\n+pub fn check(bad: &mut bool) {\n+    let result = Command::new(\"x\")\n+        .arg(\"--version\")\n+        .stdout(Stdio::piped())\n+        .spawn();\n+    let child = match result {\n+        Ok(child) => child,\n+        Err(e) => match e.kind() {\n+            ErrorKind::NotFound => return (),\n+            _ => return tidy_error!(bad, \"{}\", e),\n+        },\n     };\n \n+    let output = child.wait_with_output().unwrap();\n+\n     if output.status.success() {\n         let version = String::from_utf8_lossy(&output.stdout);\n-        assert_eq!(\"0.1.0\", version.trim_end());\n+        let version = Version::parse(version.trim_end()).unwrap();\n+        let expected = Version {\n+            major: 0,\n+            minor: 1,\n+            patch: 0,\n+            pre: Prerelease::new(\"\").unwrap(),\n+            build: BuildMetadata::EMPTY,\n+        };\n+        if version < expected {\n+            return tidy_error!(bad, \"Current version of x is {version} Consider updating to the newer version of x by running `cargo install --path src/tools/x`\");\n+        }\n+    } else {\n+        return tidy_error!(bad, \"{}\", output.status);\n     }\n-    // FIXME: throw some kind of tidy error when the version of x isn't\n-    // greater than or equal to the version we'd expect.\n-    //tidy_error!(bad, \"Current version of x is {version} Consider updating to the newer version of x by running `cargo install --path src/tools/x`\")\n }"}]}