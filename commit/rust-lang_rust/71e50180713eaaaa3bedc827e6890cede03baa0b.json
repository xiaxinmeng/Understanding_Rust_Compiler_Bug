{"sha": "71e50180713eaaaa3bedc827e6890cede03baa0b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxZTUwMTgwNzEzZWFhYWEzYmVkYzgyN2U2ODkwY2VkZTAzYmFhMGI=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-30T11:26:02Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-11-12T10:03:52Z"}, "message": "ci: replace MINGW_URL with CUSTOM_MINGW=1\n\nThis commit replaces the mirrors base URL contained in the MINGW_URL\nwith a CUSTOM_MINGW=1 environment variable. The mirrors base URL will be\nfetched instead through the MIRRORS_BASE environment variable, defined\nin src/ci/shared.sh.", "tree": {"sha": "5187938a5e60f9c91d3dd7c55f9fb53a5fac400d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5187938a5e60f9c91d3dd7c55f9fb53a5fac400d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/71e50180713eaaaa3bedc827e6890cede03baa0b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl3Kg4oACgkQPgar6Auq\n8Zyc9BAAjBeCp6a5TBjfrxm0dK6ViTgxZoEiTMkHdFe2yMz8yI6Nls7xld2LDHO4\nm6QT/ZsiZRR2RWhV/eZ7MtUoTmtv03vKDSSYP0/ruED5oyfWFQ9sLsnS7PQoJQSK\nF6q+PYCRn374eh1hCxN+HEm5xUsJTeyuXxQoapmbqmfe68GpD1yCg67PVhmNXBxb\nY6zs1AS7QOqRPQ+y+JbMsVvWk7GOzE3dT/BgQEOAbbNl4IQ+1Ad9rmiTABU8Pki1\nHwNzdMuloH8GaJ77UzWbh/S587e+puMEpVwb97w8xn9X973FzBImKgyHeb/R1eTf\nBCVeE42sdBJ0ic3lLjPogeRTifjMBAu/JJ/NI6vqGeo07lRE6NkiVmQTbdL+IInB\ns3TCf+hp4c93c6FPfJOtzPWo7qj2WeSyuY7DosPSpJZeF250DDQetITz0hhKrQ0K\nGSXzpGZfzlAZITIxw5FQ8BWuRzRXmSm4ZsDKzjYbkChrm/nZcW1m9d5Ve1qjifZC\nzTLjVjeTcwM+YQCCgulZpH7dwzaXU0atUfjEXNqpnikCmbfL3J8oKZHxWju/Ns7f\nNEcNUGQG36lV60g0Snv8/8PFYe3ApRFHB7DhegWRKbJpbVm6i1ewgJjsNZAhXDZF\nDtMMs246lREgxpj90qKaDahojWuqG7SmZuG6LvQ6mbT9L1S2lxg=\n=7nXD\n-----END PGP SIGNATURE-----", "payload": "tree 5187938a5e60f9c91d3dd7c55f9fb53a5fac400d\nparent e3d998492abd7d61aba12cfa058fce28c998a3ff\nauthor Pietro Albini <pietro@pietroalbini.org> 1572434762 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1573553032 +0100\n\nci: replace MINGW_URL with CUSTOM_MINGW=1\n\nThis commit replaces the mirrors base URL contained in the MINGW_URL\nwith a CUSTOM_MINGW=1 environment variable. The mirrors base URL will be\nfetched instead through the MIRRORS_BASE environment variable, defined\nin src/ci/shared.sh.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/71e50180713eaaaa3bedc827e6890cede03baa0b", "html_url": "https://github.com/rust-lang/rust/commit/71e50180713eaaaa3bedc827e6890cede03baa0b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/71e50180713eaaaa3bedc827e6890cede03baa0b/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3d998492abd7d61aba12cfa058fce28c998a3ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3d998492abd7d61aba12cfa058fce28c998a3ff", "html_url": "https://github.com/rust-lang/rust/commit/e3d998492abd7d61aba12cfa058fce28c998a3ff"}], "stats": {"total": 20, "additions": 10, "deletions": 10}, "files": [{"sha": "f69808c3702bc5367d4a734d202f0984b3b4f909", "filename": "src/ci/azure-pipelines/auto.yml", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/71e50180713eaaaa3bedc827e6890cede03baa0b/src%2Fci%2Fazure-pipelines%2Fauto.yml", "raw_url": "https://github.com/rust-lang/rust/raw/71e50180713eaaaa3bedc827e6890cede03baa0b/src%2Fci%2Fazure-pipelines%2Fauto.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fauto.yml?ref=71e50180713eaaaa3bedc827e6890cede03baa0b", "patch": "@@ -284,7 +284,7 @@ jobs:\n         MSYS_BITS: 32\n         RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu\n         SCRIPT: make ci-mingw-subset-1\n-        MINGW_URL: https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc\n+        CUSTOM_MINGW: 1\n         MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n         MINGW_DIR: mingw32\n         # FIXME(#59637)\n@@ -294,14 +294,14 @@ jobs:\n         MSYS_BITS: 32\n         RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu\n         SCRIPT: make ci-mingw-subset-2\n-        MINGW_URL: https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc\n+        CUSTOM_MINGW: 1\n         MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n         MINGW_DIR: mingw32\n       x86_64-mingw-1:\n         MSYS_BITS: 64\n         SCRIPT: make ci-mingw-subset-1\n         RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu\n-        MINGW_URL: https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc\n+        CUSTOM_MINGW: 1\n         MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n         MINGW_DIR: mingw64\n         # FIXME(#59637)\n@@ -311,7 +311,7 @@ jobs:\n         MSYS_BITS: 64\n         SCRIPT: make ci-mingw-subset-2\n         RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu\n-        MINGW_URL: https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc\n+        CUSTOM_MINGW: 1\n         MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n         MINGW_DIR: mingw64\n \n@@ -340,7 +340,7 @@ jobs:\n         MSYS_BITS: 32\n         RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-full-tools --enable-profiler\n         SCRIPT: python x.py dist\n-        MINGW_URL: https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc\n+        CUSTOM_MINGW: 1\n         MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n         MINGW_DIR: mingw32\n         DIST_REQUIRE_ALL_TOOLS: 1\n@@ -349,7 +349,7 @@ jobs:\n         MSYS_BITS: 64\n         SCRIPT: python x.py dist\n         RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-full-tools --enable-profiler\n-        MINGW_URL: https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc\n+        CUSTOM_MINGW: 1\n         MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n         MINGW_DIR: mingw64\n         DIST_REQUIRE_ALL_TOOLS: 1"}, {"sha": "f0179994e8e4cb5c44d2c0feea09793c487dd0fe", "filename": "src/ci/scripts/install-clang.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/71e50180713eaaaa3bedc827e6890cede03baa0b/src%2Fci%2Fscripts%2Finstall-clang.sh", "raw_url": "https://github.com/rust-lang/rust/raw/71e50180713eaaaa3bedc827e6890cede03baa0b/src%2Fci%2Fscripts%2Finstall-clang.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-clang.sh?ref=71e50180713eaaaa3bedc827e6890cede03baa0b", "patch": "@@ -17,7 +17,7 @@ if isMacOS; then\n     # Configure `AR` specifically so rustbuild doesn't try to infer it as\n     # `clang-ar` by accident.\n     ciCommandSetEnv AR \"ar\"\n-elif isWindows && [[ -z ${MINGW_URL+x} ]]; then\n+elif isWindows && [[ ${CUSTOM_MINGW-0} -ne 1 ]]; then\n     # If we're compiling for MSVC then we, like most other distribution builders,\n     # switch to clang as the compiler. This'll allow us eventually to enable LTO\n     # amongst LLVM and rustc. Note that we only do this on MSVC as I don't think"}, {"sha": "8b11e59fb639dd277b0fbade5950a5363a7d0ff6", "filename": "src/ci/scripts/install-mingw.sh", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/71e50180713eaaaa3bedc827e6890cede03baa0b/src%2Fci%2Fscripts%2Finstall-mingw.sh", "raw_url": "https://github.com/rust-lang/rust/raw/71e50180713eaaaa3bedc827e6890cede03baa0b/src%2Fci%2Fscripts%2Finstall-mingw.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-mingw.sh?ref=71e50180713eaaaa3bedc827e6890cede03baa0b", "patch": "@@ -28,7 +28,7 @@ IFS=$'\\n\\t'\n source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n \n if isWindows; then\n-    if [[ -z \"${MINGW_URL+x}\" ]]; then\n+    if [[ \"${CUSTOM_MINGW-0}\" -ne 1 ]]; then\n         arch=i686\n         if [ \"$MSYS_BITS\" = \"64\" ]; then\n           arch=x86_64\n@@ -37,9 +37,9 @@ if isWindows; then\n             mingw-w64-$arch-gcc mingw-w64-$arch-python2\n         ciCommandAddPath \"${SYSTEM_WORKFOLDER}/msys2/mingw${MSYS_BITS}/bin\"\n     else\n-        curl -o mingw.7z \"${MINGW_URL}/${MINGW_ARCHIVE}\"\n+        curl -o mingw.7z \"${MIRRORS_BASE}/${MINGW_ARCHIVE}\"\n         7z x -y mingw.7z > /dev/null\n-        curl -o \"${MINGW_DIR}/bin/gdborig.exe\" \"${MINGW_URL}/2017-04-20-${MSYS_BITS}bit-gdborig.exe\"\n+        curl -o \"${MINGW_DIR}/bin/gdborig.exe\" \"${MIRRORS_BASE}/2017-04-20-${MSYS_BITS}bit-gdborig.exe\"\n         ciCommandAddPath \"$(pwd)/${MINGW_DIR}/bin\"\n     fi\n fi"}]}