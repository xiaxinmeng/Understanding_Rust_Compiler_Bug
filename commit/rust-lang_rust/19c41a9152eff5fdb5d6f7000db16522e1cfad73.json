{"sha": "19c41a9152eff5fdb5d6f7000db16522e1cfad73", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5YzQxYTkxNTJlZmY1ZmRiNWQ2ZjcwMDBkYjE2NTIyZTFjZmFkNzM=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-08-15T16:23:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-08-15T16:23:13Z"}, "message": "Merge #5768\n\n5768: Remove deprecated Path::from_ast\n r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "3aad42f8befaf43435e2e485498d432ef1419390", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3aad42f8befaf43435e2e485498d432ef1419390"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/19c41a9152eff5fdb5d6f7000db16522e1cfad73", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfOAvxCRBK7hj4Ov3rIwAAdHIIAARjVJKIcx/iq7BhcdeqakSk\nrVA34JL2eYc7JCuF9i1LDuEo379RJ1L1aTVvXOBWhUKMPFL5ft8/xod2LfZWpnhE\n9Xgg3ATfO4YBkPUqhkkYsBQ6wWsgVz7pE+Raw5rgmvLXMZ8QD2/+hk+jxyAc9itu\nk2w1WYfYcMDQySn4Ocj8QSQQ1fmXgKcLLLG4B2WctYux2QmzvMmynBWCSbTLQKgK\n8EuPQJNo+jzvafONRIUWqTg+zHPzce7gEOyQYFj7JcMO1zEBocm2my0Y2Tu3DFj+\np6vlWRDJTQ+oGZTeReXn9GLk6UNSy6o1LbWFqa7wiEXK2FPXv5bI7ZmaiSU8s3k=\n=YPL8\n-----END PGP SIGNATURE-----\n", "payload": "tree 3aad42f8befaf43435e2e485498d432ef1419390\nparent f0ad68b96292bf6f8a1380b9af9cadc1c9b1a5f6\nparent 2052d33b9b0e2254f53848501a9113aa12ddf4da\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1597508593 +0000\ncommitter GitHub <noreply@github.com> 1597508593 +0000\n\nMerge #5768\n\n5768: Remove deprecated Path::from_ast\n r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/19c41a9152eff5fdb5d6f7000db16522e1cfad73", "html_url": "https://github.com/rust-lang/rust/commit/19c41a9152eff5fdb5d6f7000db16522e1cfad73", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/19c41a9152eff5fdb5d6f7000db16522e1cfad73/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0ad68b96292bf6f8a1380b9af9cadc1c9b1a5f6", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0ad68b96292bf6f8a1380b9af9cadc1c9b1a5f6", "html_url": "https://github.com/rust-lang/rust/commit/f0ad68b96292bf6f8a1380b9af9cadc1c9b1a5f6"}, {"sha": "2052d33b9b0e2254f53848501a9113aa12ddf4da", "url": "https://api.github.com/repos/rust-lang/rust/commits/2052d33b9b0e2254f53848501a9113aa12ddf4da", "html_url": "https://github.com/rust-lang/rust/commit/2052d33b9b0e2254f53848501a9113aa12ddf4da"}], "stats": {"total": 38, "additions": 13, "deletions": 25}, "files": [{"sha": "5216862ba52d2f767ba0a3350f7d8d1e88d2bc93", "filename": "crates/assists/src/ast_transform.rs", "status": "modified", "additions": 13, "deletions": 19, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/19c41a9152eff5fdb5d6f7000db16522e1cfad73/crates%2Fassists%2Fsrc%2Fast_transform.rs", "raw_url": "https://github.com/rust-lang/rust/raw/19c41a9152eff5fdb5d6f7000db16522e1cfad73/crates%2Fassists%2Fsrc%2Fast_transform.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Fast_transform.rs?ref=19c41a9152eff5fdb5d6f7000db16522e1cfad73", "patch": "@@ -7,6 +7,17 @@ use syntax::{\n     ast::{self, AstNode},\n };\n \n+pub fn apply<'a, N: AstNode>(transformer: &dyn AstTransform<'a>, node: N) -> N {\n+    SyntaxRewriter::from_fn(|element| match element {\n+        syntax::SyntaxElement::Node(n) => {\n+            let replacement = transformer.get_substitution(&n)?;\n+            Some(replacement.into())\n+        }\n+        _ => None,\n+    })\n+    .rewrite_ast(&node)\n+}\n+\n pub trait AstTransform<'a> {\n     fn get_substitution(&self, node: &syntax::SyntaxNode) -> Option<syntax::SyntaxNode>;\n \n@@ -107,10 +118,7 @@ impl<'a> SubstituteTypeParams<'a> {\n             ast::Type::PathType(path_type) => path_type.path()?,\n             _ => return None,\n         };\n-        // FIXME: use `hir::Path::from_src` instead.\n-        #[allow(deprecated)]\n-        let path = hir::Path::from_ast(path)?;\n-        let resolution = self.source_scope.resolve_hir_path(&path)?;\n+        let resolution = self.source_scope.speculative_resolve(&path)?;\n         match resolution {\n             hir::PathResolution::TypeParam(tp) => Some(self.substs.get(&tp)?.syntax().clone()),\n             _ => None,\n@@ -146,10 +154,7 @@ impl<'a> QualifyPaths<'a> {\n             // don't try to qualify `Fn(Foo) -> Bar` paths, they are in prelude anyway\n             return None;\n         }\n-        // FIXME: use `hir::Path::from_src` instead.\n-        #[allow(deprecated)]\n-        let hir_path = hir::Path::from_ast(p.clone());\n-        let resolution = self.source_scope.resolve_hir_path(&hir_path?)?;\n+        let resolution = self.source_scope.speculative_resolve(&p)?;\n         match resolution {\n             PathResolution::Def(def) => {\n                 let found_path = from.find_use_path(self.source_scope.db.upcast(), def)?;\n@@ -175,17 +180,6 @@ impl<'a> QualifyPaths<'a> {\n     }\n }\n \n-pub fn apply<'a, N: AstNode>(transformer: &dyn AstTransform<'a>, node: N) -> N {\n-    SyntaxRewriter::from_fn(|element| match element {\n-        syntax::SyntaxElement::Node(n) => {\n-            let replacement = transformer.get_substitution(&n)?;\n-            Some(replacement.into())\n-        }\n-        _ => None,\n-    })\n-    .rewrite_ast(&node)\n-}\n-\n impl<'a> AstTransform<'a> for QualifyPaths<'a> {\n     fn get_substitution(&self, node: &syntax::SyntaxNode) -> Option<syntax::SyntaxNode> {\n         self.get_substitution_inner(node).or_else(|| self.previous.get_substitution(node))"}, {"sha": "99395667defcde5c9e23fc5d2ffa5ee48cd3f62f", "filename": "crates/hir_def/src/path.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/19c41a9152eff5fdb5d6f7000db16522e1cfad73/crates%2Fhir_def%2Fsrc%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/19c41a9152eff5fdb5d6f7000db16522e1cfad73/crates%2Fhir_def%2Fsrc%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fpath.rs?ref=19c41a9152eff5fdb5d6f7000db16522e1cfad73", "patch": "@@ -153,12 +153,6 @@ pub enum GenericArg {\n }\n \n impl Path {\n-    /// Converts an `ast::Path` to `Path`. Works with use trees.\n-    #[deprecated = \"Doesn't handle hygiene, don't add new calls, remove old ones\"]\n-    pub fn from_ast(path: ast::Path) -> Option<Path> {\n-        lower::lower_path(path, &Hygiene::new_unhygienic())\n-    }\n-\n     /// Converts an `ast::Path` to `Path`. Works with use trees.\n     /// It correctly handles `$crate` based path from macro call.\n     pub fn from_src(path: ast::Path, hygiene: &Hygiene) -> Option<Path> {"}]}