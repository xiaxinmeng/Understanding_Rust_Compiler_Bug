{"sha": "8228d8e17649bab2881ac77c31e32ba6e341fa64", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgyMjhkOGUxNzY0OWJhYjI4ODFhYzc3YzMxZTMyYmE2ZTM0MWZhNjQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-04-07T14:33:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-04-07T14:33:48Z"}, "message": "Auto merge of #49692 - sinkuu:main_fix, r=arielb1\n\nFix ICE with `main`'s return type containing lifetimes\n\nFixes #48890", "tree": {"sha": "b272d343aff42b18a4211cf72f627b2fdaec441f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b272d343aff42b18a4211cf72f627b2fdaec441f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8228d8e17649bab2881ac77c31e32ba6e341fa64", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8228d8e17649bab2881ac77c31e32ba6e341fa64", "html_url": "https://github.com/rust-lang/rust/commit/8228d8e17649bab2881ac77c31e32ba6e341fa64", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8228d8e17649bab2881ac77c31e32ba6e341fa64/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c2d7b2da322af89f310183cdca662a99ade6d22", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c2d7b2da322af89f310183cdca662a99ade6d22", "html_url": "https://github.com/rust-lang/rust/commit/8c2d7b2da322af89f310183cdca662a99ade6d22"}, {"sha": "40a1ee8efa69ae3cfa2532d047ea62f4ad28b1c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/40a1ee8efa69ae3cfa2532d047ea62f4ad28b1c1", "html_url": "https://github.com/rust-lang/rust/commit/40a1ee8efa69ae3cfa2532d047ea62f4ad28b1c1"}], "stats": {"total": 87, "additions": 79, "deletions": 8}, "files": [{"sha": "209f6dbfa485af40d37da07c08f6f34c709fb890", "filename": "src/librustc_mir/monomorphize/collector.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs?ref=8228d8e17649bab2881ac77c31e32ba6e341fa64", "patch": "@@ -212,8 +212,6 @@ use monomorphize::item::{MonoItemExt, DefPathBasedNames, InstantiationMode};\n \n use rustc_data_structures::bitvec::BitVector;\n \n-use std::iter;\n-\n #[derive(PartialEq, Eq, Hash, Clone, Copy, Debug)]\n pub enum MonoItemCollectionMode {\n     Eager,\n@@ -1061,13 +1059,15 @@ impl<'b, 'a, 'v> RootCollector<'b, 'a, 'v> {\n         // late-bound regions, since late-bound\n         // regions must appear in the argument\n         // listing.\n-        let main_ret_ty = main_ret_ty.no_late_bound_regions().unwrap();\n+        let main_ret_ty = self.tcx.erase_regions(\n+            &main_ret_ty.no_late_bound_regions().unwrap(),\n+        );\n \n         let start_instance = Instance::resolve(\n             self.tcx,\n             ty::ParamEnv::reveal_all(),\n             start_def_id,\n-            self.tcx.mk_substs(iter::once(Kind::from(main_ret_ty)))\n+            self.tcx.intern_substs(&[Kind::from(main_ret_ty)])\n         ).unwrap();\n \n         self.output.push(create_fn_mono_item(start_instance));"}, {"sha": "a513ebbf6c7f47bc81e1b3bf9c2eda8e2bb2edc6", "filename": "src/librustc_trans/base.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Flibrustc_trans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Flibrustc_trans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fbase.rs?ref=8228d8e17649bab2881ac77c31e32ba6e341fa64", "patch": "@@ -82,7 +82,6 @@ use std::str;\n use std::sync::Arc;\n use std::time::{Instant, Duration};\n use std::{i32, usize};\n-use std::iter;\n use std::sync::mpsc;\n use syntax_pos::Span;\n use syntax_pos::symbol::InternedString;\n@@ -553,7 +552,9 @@ fn maybe_create_entry_wrapper(cx: &CodegenCx) {\n         // late-bound regions, since late-bound\n         // regions must appear in the argument\n         // listing.\n-        let main_ret_ty = main_ret_ty.no_late_bound_regions().unwrap();\n+        let main_ret_ty = cx.tcx.erase_regions(\n+            &main_ret_ty.no_late_bound_regions().unwrap(),\n+        );\n \n         if declare::get_defined_value(cx, \"main\").is_some() {\n             // FIXME: We should be smart and show a better diagnostic here.\n@@ -580,8 +581,11 @@ fn maybe_create_entry_wrapper(cx: &CodegenCx) {\n \n         let (start_fn, args) = if use_start_lang_item {\n             let start_def_id = cx.tcx.require_lang_item(StartFnLangItem);\n-            let start_fn = callee::resolve_and_get_fn(cx, start_def_id, cx.tcx.mk_substs(\n-                iter::once(Kind::from(main_ret_ty))));\n+            let start_fn = callee::resolve_and_get_fn(\n+                cx,\n+                start_def_id,\n+                cx.tcx.intern_substs(&[Kind::from(main_ret_ty)]),\n+            );\n             (start_fn, vec![bx.pointercast(rust_main, Type::i8p(cx).ptr_to()),\n                             arg_argc, arg_argv])\n         } else {"}, {"sha": "bd6bcf88a0caf2a167046add186335e17d862b65", "filename": "src/test/run-fail/rfc-1937-termination-trait/termination-trait-for-box-dyn-error.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs?ref=8228d8e17649bab2881ac77c31e32ba6e341fa64", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// must-compile-successfully\n+// failure-status: 1\n+\n+#![feature(dyn_trait)]\n+\n+use std::error::Error;\n+use std::io;\n+\n+fn main() -> Result<(), Box<dyn Error>> {\n+    Err(Box::new(io::Error::new(io::ErrorKind::Other, \"returned Box<dyn Error> from main()\")))\n+}"}, {"sha": "9f01b0bff8955839d39d1b22c9205bee717e20ce", "filename": "src/test/run-fail/rfc-1937-termination-trait/termination-trait-for-str.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs?ref=8228d8e17649bab2881ac77c31e32ba6e341fa64", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// error-pattern: An error message for you\n+// failure-status: 1\n+\n+fn main() -> Result<(), &'static str> {\n+    Err(\"An error message for you\")\n+}"}, {"sha": "24c30a5abc22a0207284da443e1ba7fac4fefc90", "filename": "src/test/run-pass/rfc-1937-termination-trait/termination-trait-for-box-dyn-error.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-box-dyn-error.rs?ref=8228d8e17649bab2881ac77c31e32ba6e341fa64", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(dyn_trait)]\n+\n+use std::error::Error;\n+\n+fn main() -> Result<(), Box<dyn Error>> {\n+    Ok(())\n+}"}, {"sha": "2023ff75564f786ca28248aa41b9f789ef90b293", "filename": "src/test/run-pass/rfc-1937-termination-trait/termination-trait-for-str.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8228d8e17649bab2881ac77c31e32ba6e341fa64/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-str.rs?ref=8228d8e17649bab2881ac77c31e32ba6e341fa64", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() -> Result<(), &'static str> {\n+    Ok(())\n+}"}]}