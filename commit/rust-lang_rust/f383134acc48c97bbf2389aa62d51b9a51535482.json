{"sha": "f383134acc48c97bbf2389aa62d51b9a51535482", "node_id": "C_kwDOAAsO6NoAKGYzODMxMzRhY2M0OGM5N2JiZjIzODlhYTYyZDUxYjlhNTE1MzU0ODI", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-03-26T20:08:50Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-03-26T20:15:48Z"}, "message": "Use str and char's Debug impl to format literals", "tree": {"sha": "45fa148a3626dfc6d04b2702cdef7dafe29b4f92", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/45fa148a3626dfc6d04b2702cdef7dafe29b4f92"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f383134acc48c97bbf2389aa62d51b9a51535482", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmI/dHQACgkQ+boUO5X/\nbYIg+xAApNwrWeaO+X0zvoDQaRh6xU1u3IE/U3auawnnHw/TchzVjHWzKvxIvxaB\nlzlfmW6SyZ+hXbuwqEhYw60Gv9TPeBRx7fmoGzfcJ1m4MFLmGw5PHqg7OPVM1q6l\njcJaK/8soX8iQWz6PqJkzz/Nn7GooV2geRYwpHtdVE/b3WhTZwU3bpjqHRNdCtnu\n01kiygPFh/gSEiNEuXIfkev8tmAJN9TUZ6SV/5aOBuyXOc2zu5J6FCwVKdMNgtNr\nQ8R+kfqPyPIS1vguxTPDXg3EHLJeXY9ejmSgvCODlMSg2VGWEKQRFBIdtWb121qn\nYOzNKSeAGucxA0NHz/HrKcM5m0l4TPbpfpG/rDZ98iexrA/IlLMxj5tPx7JSDvVH\nyT2wFYjA1ZF/y167Qq5rMgnBe3QWUOlzPmALYtLdByvfHhI1HQQMhCH5gWjMeU8G\nICPVHdjO5/tX7KI1YM+kVy9zzGNopWJN5iQ27ZGOl8R5+WgZHGWmjvYZFvcvmphF\nDEfsUC/t7iql9HpYRxKu+eXa+Ikao4Vrs/s/RniOkMRDkEtuCQLDijdysHk6wljJ\naKZwLphZs/MEhDP1B93wZweJQZV8SZoGRl/wiUfYvspo/1aQ8LGdsYfRjsi+c3z6\nW3NT8LUpyeSVXyR+VVhFMGCfhx7yNbO+xVBOroUIV8TMwor8Krc=\n=HNL0\n-----END PGP SIGNATURE-----", "payload": "tree 45fa148a3626dfc6d04b2702cdef7dafe29b4f92\nparent f1fa84ce95db0cf9d06f2aa8b70764e7394291b1\nauthor David Tolnay <dtolnay@gmail.com> 1648325330 -0700\ncommitter David Tolnay <dtolnay@gmail.com> 1648325748 -0700\n\nUse str and char's Debug impl to format literals\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f383134acc48c97bbf2389aa62d51b9a51535482", "html_url": "https://github.com/rust-lang/rust/commit/f383134acc48c97bbf2389aa62d51b9a51535482", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f383134acc48c97bbf2389aa62d51b9a51535482/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1fa84ce95db0cf9d06f2aa8b70764e7394291b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1fa84ce95db0cf9d06f2aa8b70764e7394291b1", "html_url": "https://github.com/rust-lang/rust/commit/f1fa84ce95db0cf9d06f2aa8b70764e7394291b1"}], "stats": {"total": 32, "additions": 16, "deletions": 16}, "files": [{"sha": "9ebce47cf5ffe03c3088085d58eb408a901c3427", "filename": "compiler/rustc_expand/src/proc_macro_server.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f383134acc48c97bbf2389aa62d51b9a51535482/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f383134acc48c97bbf2389aa62d51b9a51535482/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs?ref=f383134acc48c97bbf2389aa62d51b9a51535482", "patch": "@@ -663,16 +663,16 @@ impl server::Literal for Rustc<'_, '_> {\n         self.lit(token::Float, Symbol::intern(n), Some(sym::f64))\n     }\n     fn string(&mut self, string: &str) -> Self::Literal {\n-        let mut escaped = String::new();\n-        for ch in string.chars() {\n-            escaped.extend(ch.escape_debug());\n-        }\n-        self.lit(token::Str, Symbol::intern(&escaped), None)\n+        let quoted = format!(\"{:?}\", string);\n+        assert!(quoted.starts_with('\"') && quoted.ends_with('\"'));\n+        let symbol = &quoted[1..quoted.len() - 1];\n+        self.lit(token::Str, Symbol::intern(symbol), None)\n     }\n     fn character(&mut self, ch: char) -> Self::Literal {\n-        let mut escaped = String::new();\n-        escaped.extend(ch.escape_unicode());\n-        self.lit(token::Char, Symbol::intern(&escaped), None)\n+        let quoted = format!(\"{:?}\", ch);\n+        assert!(quoted.starts_with('\\'') && quoted.ends_with('\\''));\n+        let symbol = &quoted[1..quoted.len() - 1];\n+        self.lit(token::Char, Symbol::intern(symbol), None)\n     }\n     fn byte_string(&mut self, bytes: &[u8]) -> Self::Literal {\n         let string = bytes"}, {"sha": "27391f8311176cdb17fdac88f274734228a87a2a", "filename": "src/test/ui/proc-macro/auxiliary/api/parse.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f383134acc48c97bbf2389aa62d51b9a51535482/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fapi%2Fparse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f383134acc48c97bbf2389aa62d51b9a51535482/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fapi%2Fparse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fapi%2Fparse.rs?ref=f383134acc48c97bbf2389aa62d51b9a51535482", "patch": "@@ -21,13 +21,13 @@ fn test_display_literal() {\n \n     assert_eq!(\n         Literal::string(\"a \\t \u2764 ' \\\" \\u{1}\").to_string(),\n-        \"\\\"a \\\\t \u2764 \\\\' \\\\\\\" \\\\u{1}\\\"\",\n+        \"\\\"a \\\\t \u2764 ' \\\\\\\" \\\\u{1}\\\"\",\n     );\n-    assert_eq!(Literal::character('a').to_string(), \"'\\\\u{61}'\");\n-    assert_eq!(Literal::character('\\t').to_string(), \"'\\\\u{9}'\");\n-    assert_eq!(Literal::character('\u2764').to_string(), \"'\\\\u{2764}'\");\n-    assert_eq!(Literal::character('\\'').to_string(), \"'\\\\u{27}'\");\n-    assert_eq!(Literal::character('\"').to_string(), \"'\\\\u{22}'\");\n+    assert_eq!(Literal::character('a').to_string(), \"'a'\");\n+    assert_eq!(Literal::character('\\t').to_string(), \"'\\\\t'\");\n+    assert_eq!(Literal::character('\u2764').to_string(), \"'\u2764'\");\n+    assert_eq!(Literal::character('\\'').to_string(), \"'\\\\''\");\n+    assert_eq!(Literal::character('\"').to_string(), \"'\\\"'\");\n     assert_eq!(Literal::character('\\u{1}').to_string(), \"'\\\\u{1}'\");\n }\n "}, {"sha": "d2cc5c6e2a3f7dcdae9a3fd4adc6a7591c13594a", "filename": "src/test/ui/proc-macro/quote-debug.stdout", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f383134acc48c97bbf2389aa62d51b9a51535482/src%2Ftest%2Fui%2Fproc-macro%2Fquote-debug.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/f383134acc48c97bbf2389aa62d51b9a51535482/src%2Ftest%2Fui%2Fproc-macro%2Fquote-debug.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fquote-debug.stdout?ref=f383134acc48c97bbf2389aa62d51b9a51535482", "patch": "@@ -22,7 +22,7 @@ fn main() {\n                                     crate::Span::recover_proc_macro_span(0)))),\n                         crate::TokenStream::from(crate::TokenTree::Ident(crate::Ident::new(\"hello\",\n                                     crate::Span::recover_proc_macro_span(1)))),\n-                        crate::TokenStream::from(crate::TokenTree::Punct(crate::Punct::new('\\u{3d}',\n+                        crate::TokenStream::from(crate::TokenTree::Punct(crate::Punct::new('=',\n                                     crate::Spacing::Alone))),\n                         crate::TokenStream::from(crate::TokenTree::Literal({\n                                     let mut iter =\n@@ -35,7 +35,7 @@ fn main() {\n                                            ::core::panicking::panic(\"internal error: entered unreachable code\")\n                                        }\n                                 })),\n-                        crate::TokenStream::from(crate::TokenTree::Punct(crate::Punct::new('\\u{3b}',\n+                        crate::TokenStream::from(crate::TokenTree::Punct(crate::Punct::new(';',\n                                     crate::Spacing::Alone)))].iter().cloned().collect::<crate::TokenStream>()\n }\n const _: () ="}]}