{"sha": "a2580db6420aa6ea3ab34c467bb795e9e39ba449", "node_id": "C_kwDOAAsO6NoAKGEyNTgwZGI2NDIwYWE2ZWEzYWIzNGM0NjdiYjc5NWU5ZTM5YmE0NDk", "commit": {"author": {"name": "timvisee", "email": "tim@visee.me", "date": "2023-04-17T19:16:02Z"}, "committer": {"name": "timvisee", "email": "tim@visee.me", "date": "2023-04-17T19:19:49Z"}, "message": "Use `clippy_utils::std_or_core` in manual slice size calculation lint", "tree": {"sha": "f1c2ca0d6bd832033db66a4fbc3dcdebc449f9a0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1c2ca0d6bd832033db66a4fbc3dcdebc449f9a0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a2580db6420aa6ea3ab34c467bb795e9e39ba449", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEenLwpVXnt3qRAcU+uNtyC8OD4XIFAmQ9m9UACgkQuNtyC8OD\n4XIPyg//SUfZ/K6jl+YtdzZD/YPlLtNC9ExIxK/WyPdha/Lu8jRncxx43Tw1gLTu\nd7UfrZWB2ufW42NPgI/PAU1dOcREIBYJk9gC4+kSUf3nvbUVvd2AKTQA/bgk52Y2\nCTBnMxSGZKgZbQJ6+bVN78XL1fofEse6RM5HQIDYbjHGuIfOOtV7sPMKccWEo9mz\nL2yCZC0TAHX1daxrGZ/JYD6evysuvI5je2rfSmcgyV9J2sVo1J1TiEYLCJWCKjL2\nT5eEkoLIsWepi0yHW58VYBUrXEKcBcXM0zLW4nQg4bDvIKtve4WgaDDIjw7yvdZE\n1WtXlbzP0tRpM8IUS2k9eWfj/SaFmWQ0LlWdX0d3XfNkWTMAZjmjmwUAj3vKIElj\nmkjAK/5Yhvzz4NQdOl6C3uTBxecGGsDS69cGAXGipR9cp2wbZE/5+32tk/vOcy42\npl3Qb7rT0Iexc6jaLGAh6d7cO+tmqTrbsboWgrIOgYlDgxvpQYhuj8bnNBZCPGUx\nereeFOyzfIDHT3wOCX61dJZEqpSfhb8PVh9UA1JO7ZTikzNn8uFhCQo8lUQSD/yG\nL9rupY4sO6OyeJ+5Q4/IKhRKHFkGRxKL0Nk0HnhEH7KatXdcLrdJFFnDgcGYpzbY\niBuEeJcGRpJ6H8QrZmraQ/5Xb4Pg61sCjuZWrRpZpIksH4Y6ABw=\n=3T2E\n-----END PGP SIGNATURE-----", "payload": "tree f1c2ca0d6bd832033db66a4fbc3dcdebc449f9a0\nparent b8fee8b5047f6a98992424c25f79468313044e1c\nauthor timvisee <tim@visee.me> 1681758962 +0200\ncommitter timvisee <tim@visee.me> 1681759189 +0200\n\nUse `clippy_utils::std_or_core` in manual slice size calculation lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a2580db6420aa6ea3ab34c467bb795e9e39ba449", "html_url": "https://github.com/rust-lang/rust/commit/a2580db6420aa6ea3ab34c467bb795e9e39ba449", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a2580db6420aa6ea3ab34c467bb795e9e39ba449/comments", "author": {"login": "timvisee", "id": 856222, "node_id": "MDQ6VXNlcjg1NjIyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/856222?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timvisee", "html_url": "https://github.com/timvisee", "followers_url": "https://api.github.com/users/timvisee/followers", "following_url": "https://api.github.com/users/timvisee/following{/other_user}", "gists_url": "https://api.github.com/users/timvisee/gists{/gist_id}", "starred_url": "https://api.github.com/users/timvisee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timvisee/subscriptions", "organizations_url": "https://api.github.com/users/timvisee/orgs", "repos_url": "https://api.github.com/users/timvisee/repos", "events_url": "https://api.github.com/users/timvisee/events{/privacy}", "received_events_url": "https://api.github.com/users/timvisee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "timvisee", "id": 856222, "node_id": "MDQ6VXNlcjg1NjIyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/856222?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timvisee", "html_url": "https://github.com/timvisee", "followers_url": "https://api.github.com/users/timvisee/followers", "following_url": "https://api.github.com/users/timvisee/following{/other_user}", "gists_url": "https://api.github.com/users/timvisee/gists{/gist_id}", "starred_url": "https://api.github.com/users/timvisee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timvisee/subscriptions", "organizations_url": "https://api.github.com/users/timvisee/orgs", "repos_url": "https://api.github.com/users/timvisee/repos", "events_url": "https://api.github.com/users/timvisee/events{/privacy}", "received_events_url": "https://api.github.com/users/timvisee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8fee8b5047f6a98992424c25f79468313044e1c", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8fee8b5047f6a98992424c25f79468313044e1c", "html_url": "https://github.com/rust-lang/rust/commit/b8fee8b5047f6a98992424c25f79468313044e1c"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "a5bb1c6f9bcf7aed88f3f75f3e0ce327fdd29e51", "filename": "clippy_lints/src/manual_slice_size_calculation.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a2580db6420aa6ea3ab34c467bb795e9e39ba449/clippy_lints%2Fsrc%2Fmanual_slice_size_calculation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a2580db6420aa6ea3ab34c467bb795e9e39ba449/clippy_lints%2Fsrc%2Fmanual_slice_size_calculation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmanual_slice_size_calculation.rs?ref=a2580db6420aa6ea3ab34c467bb795e9e39ba449", "patch": "@@ -1,7 +1,7 @@\n // run-rustfix\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::source::snippet_with_context;\n-use clippy_utils::{expr_or_init, in_constant};\n+use clippy_utils::{expr_or_init, in_constant, std_or_core};\n use rustc_errors::Applicability;\n use rustc_hir::{BinOpKind, Expr, ExprKind};\n use rustc_lint::{LateContext, LateLintPass};\n@@ -50,14 +50,15 @@ impl<'tcx> LateLintPass<'tcx> for ManualSliceSizeCalculation {\n             let ctxt = expr.span.ctxt();\n             let mut app = Applicability::MachineApplicable;\n             let val_name = snippet_with_context(cx, receiver.span, ctxt, \"slice\", &mut app).0;\n+            let Some(sugg) = std_or_core(cx) else { return };\n \n             span_lint_and_sugg(\n                 cx,\n                 MANUAL_SLICE_SIZE_CALCULATION,\n                     expr.span,\n                     \"manual slice size calculation\",\n                     \"try\",\n-                    format!(\"std::mem::size_of_val({val_name})\"),\n+                    format!(\"{sugg}::mem::size_of_val({val_name})\"),\n                     Applicability::MachineApplicable,\n                 );\n         }"}]}