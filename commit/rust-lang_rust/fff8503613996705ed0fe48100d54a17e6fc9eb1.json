{"sha": "fff8503613996705ed0fe48100d54a17e6fc9eb1", "node_id": "C_kwDOAAsO6NoAKGZmZjg1MDM2MTM5OTY3MDVlZDBmZTQ4MTAwZDU0YTE3ZTZmYzllYjE", "commit": {"author": {"name": "jyn", "email": "github@jyn.dev", "date": "2023-04-26T06:55:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-26T06:55:50Z"}, "message": "Rollup merge of #109379 - flba-eb:108596_fixtest_sigpipe, r=jyn514\n\nReplace `yes` command by `while-echo` in test `tests/ui/process/process-sigpipe.rs`\n\nThe `yes` command is not available on all platforms.\n\nFixes #108596.\n\nInviting `@mvf` as he contributed to this patch. Thanks! This issue has been discussed in https://github.com/rust-lang/rust/pull/106673 but was moved to #108596 to get going.\n\nCC `@gh-tr`\n\nr? `@workingjubilee`\n`@rustbot` label +O-neutrino\n\nNotes about the comments https://github.com/rust-lang/rust/pull/106673#discussion_r1117324265:\n- The `echo` command is `/proc/boot/echo` (not built-in)\n- `/bin/sh` is a symlink to `/proc/boot/ksh`\n```sh\n# ls -l /bin/sh /proc/boot/ksh /proc/boot/echo\nlrwxrwxrwx   1 root      root             14 Mar 20 07:52 /bin/sh -> /proc/boot/ksh\n-r-xr-xr-x   1 root      root           9390 Sep 12  2022 /proc/boot/echo\n-r-xr-xr-x   1 root      root         308114 Sep 12  2022 /proc/boot/ksh\n```", "tree": {"sha": "a5528b42a81ecc63c18608ccd6f0f122c07c0649", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a5528b42a81ecc63c18608ccd6f0f122c07c0649"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fff8503613996705ed0fe48100d54a17e6fc9eb1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkSMr2CRBK7hj4Ov3rIwAAXQUIAHu4YIFb+2QXEuQQKjsskLu+\nnNjEJqowxIFIPMmNFyDYEyKXLV2zdtVp/HWOBmHyzZB8rZnQfSR4UPh7DIvi2gTt\ntDAcMAhi26eHZgi+XIZwpUDnBicKnSNSBM4ahnt26DykkELwMUNbWNOz3ZTd02nu\nmgi1n9noj2y8QiL0lngFGh8TY30+nzmX1rPV/8XhUrQLaUwOe8loJkT3AqqieThj\neOo0pfYo8ub42v8vQIrq0FaMuvciWbpJD9/BzD4AF19TFtmpmPPcjGJAjZF7SZYE\nR/DbwMaEkwAg6fFCLu662Da7Fnd71F1ogtsSBmRr/QsmG4uE/YthYF/kUN7wJYs=\n=cqn+\n-----END PGP SIGNATURE-----\n", "payload": "tree a5528b42a81ecc63c18608ccd6f0f122c07c0649\nparent ab7e01e8b6683c172312a1b4dc20668ad5375ef5\nparent 3970793579f39d7610df1936c4ca996062e99c92\nauthor jyn <github@jyn.dev> 1682492150 -0500\ncommitter GitHub <noreply@github.com> 1682492150 -0500\n\nRollup merge of #109379 - flba-eb:108596_fixtest_sigpipe, r=jyn514\n\nReplace `yes` command by `while-echo` in test `tests/ui/process/process-sigpipe.rs`\n\nThe `yes` command is not available on all platforms.\n\nFixes #108596.\n\nInviting `@mvf` as he contributed to this patch. Thanks! This issue has been discussed in https://github.com/rust-lang/rust/pull/106673 but was moved to #108596 to get going.\n\nCC `@gh-tr`\n\nr? `@workingjubilee`\n`@rustbot` label +O-neutrino\n\nNotes about the comments https://github.com/rust-lang/rust/pull/106673#discussion_r1117324265:\n- The `echo` command is `/proc/boot/echo` (not built-in)\n- `/bin/sh` is a symlink to `/proc/boot/ksh`\n```sh\n# ls -l /bin/sh /proc/boot/ksh /proc/boot/echo\nlrwxrwxrwx   1 root      root             14 Mar 20 07:52 /bin/sh -> /proc/boot/ksh\n-r-xr-xr-x   1 root      root           9390 Sep 12  2022 /proc/boot/echo\n-r-xr-xr-x   1 root      root         308114 Sep 12  2022 /proc/boot/ksh\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fff8503613996705ed0fe48100d54a17e6fc9eb1", "html_url": "https://github.com/rust-lang/rust/commit/fff8503613996705ed0fe48100d54a17e6fc9eb1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fff8503613996705ed0fe48100d54a17e6fc9eb1/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ab7e01e8b6683c172312a1b4dc20668ad5375ef5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab7e01e8b6683c172312a1b4dc20668ad5375ef5", "html_url": "https://github.com/rust-lang/rust/commit/ab7e01e8b6683c172312a1b4dc20668ad5375ef5"}, {"sha": "3970793579f39d7610df1936c4ca996062e99c92", "url": "https://api.github.com/repos/rust-lang/rust/commits/3970793579f39d7610df1936c4ca996062e99c92", "html_url": "https://github.com/rust-lang/rust/commit/3970793579f39d7610df1936c4ca996062e99c92"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "4f4db11911594b6a6baad9992d3cf16359649d6c", "filename": "tests/ui/process/process-sigpipe.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/fff8503613996705ed0fe48100d54a17e6fc9eb1/tests%2Fui%2Fprocess%2Fprocess-sigpipe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fff8503613996705ed0fe48100d54a17e6fc9eb1/tests%2Fui%2Fprocess%2Fprocess-sigpipe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fprocess%2Fprocess-sigpipe.rs?ref=fff8503613996705ed0fe48100d54a17e6fc9eb1", "patch": "@@ -8,14 +8,14 @@\n // libstd ignores SIGPIPE, and other libraries may set signal masks.\n // Make sure that these behaviors don't get inherited to children\n // spawned via std::process, since they're needed for traditional UNIX\n-// filter behavior. This test checks that `yes | head` terminates\n+// filter behavior.\n+// This test checks that `while echo y ; do : ; done | head` terminates\n // (instead of running forever), and that it does not print an error\n // message about a broken pipe.\n \n // ignore-emscripten no threads support\n // ignore-vxworks no 'sh'\n // ignore-fuchsia no 'sh'\n-// ignore-nto no 'yes'\n \n use std::process;\n use std::thread;\n@@ -27,7 +27,11 @@ fn main() {\n         thread::sleep_ms(5000);\n         process::exit(1);\n     });\n-    let output = process::Command::new(\"sh\").arg(\"-c\").arg(\"yes | head\").output().unwrap();\n+    let output = process::Command::new(\"sh\")\n+        .arg(\"-c\")\n+        .arg(\"while echo y ; do : ; done | head\")\n+        .output()\n+        .unwrap();\n     assert!(output.status.success());\n     assert!(output.stderr.len() == 0);\n }"}]}