{"sha": "4f4d0586ad20c66a16d547581ca379beafece93a", "node_id": "C_kwDOAAsO6NoAKDRmNGQwNTg2YWQyMGM2NmExNmQ1NDc1ODFjYTM3OWJlYWZlY2U5M2E", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-24T04:54:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-24T04:54:39Z"}, "message": "Auto merge of #105893 - Ayush1325:remote-test-server-improve, r=Mark-Simulacrum\n\nUse u32 methods instead of manual shifting\n\nSwitch to `to_le_bytes()` and `from_le_bytes()` instead of manual shifting\n\nThis was suggested [`here`](https://github.com/rust-lang/rust/pull/105145#discussion_r1051418964)\n\nSigned-off-by: Ayush Singh <ayushsingh1325@gmail.com>", "tree": {"sha": "164ced8f8b6b0a56c82728e903f31a281e2bbcc9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/164ced8f8b6b0a56c82728e903f31a281e2bbcc9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f4d0586ad20c66a16d547581ca379beafece93a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f4d0586ad20c66a16d547581ca379beafece93a", "html_url": "https://github.com/rust-lang/rust/commit/4f4d0586ad20c66a16d547581ca379beafece93a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f4d0586ad20c66a16d547581ca379beafece93a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c0c6d6eb3b38931f9dd4f5466185591e91d51c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c0c6d6eb3b38931f9dd4f5466185591e91d51c9", "html_url": "https://github.com/rust-lang/rust/commit/6c0c6d6eb3b38931f9dd4f5466185591e91d51c9"}, {"sha": "51fe24873fbd255e80063a97ecd406726c1e6675", "url": "https://api.github.com/repos/rust-lang/rust/commits/51fe24873fbd255e80063a97ecd406726c1e6675", "html_url": "https://github.com/rust-lang/rust/commit/51fe24873fbd255e80063a97ecd406726c1e6675"}], "stats": {"total": 20, "additions": 8, "deletions": 12}, "files": [{"sha": "3d61a0675590c85125eb468ea7360e5bba7958e9", "filename": "src/tools/remote-test-server/src/main.rs", "status": "modified", "additions": 8, "deletions": 12, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4f4d0586ad20c66a16d547581ca379beafece93a/src%2Ftools%2Fremote-test-server%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f4d0586ad20c66a16d547581ca379beafece93a/src%2Ftools%2Fremote-test-server%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fremote-test-server%2Fsrc%2Fmain.rs?ref=4f4d0586ad20c66a16d547581ca379beafece93a", "patch": "@@ -365,13 +365,7 @@ fn my_copy(src: &mut dyn Read, which: u8, dst: &Mutex<dyn Write>) {\n     loop {\n         let n = t!(src.read(&mut b));\n         let mut dst = dst.lock().unwrap();\n-        t!(dst.write_all(&[\n-            which,\n-            (n >> 24) as u8,\n-            (n >> 16) as u8,\n-            (n >> 8) as u8,\n-            (n >> 0) as u8,\n-        ]));\n+        t!(dst.write_all(&create_header(which, n as u32)));\n         if n > 0 {\n             t!(dst.write_all(&b[..n]));\n         } else {\n@@ -383,19 +377,21 @@ fn my_copy(src: &mut dyn Read, which: u8, dst: &Mutex<dyn Write>) {\n fn batch_copy(buf: &[u8], which: u8, dst: &Mutex<dyn Write>) {\n     let n = buf.len();\n     let mut dst = dst.lock().unwrap();\n-    t!(dst.write_all(&[which, (n >> 24) as u8, (n >> 16) as u8, (n >> 8) as u8, (n >> 0) as u8,]));\n+    t!(dst.write_all(&create_header(which, n as u32)));\n     if n > 0 {\n         t!(dst.write_all(buf));\n         // Marking buf finished\n         t!(dst.write_all(&[which, 0, 0, 0, 0,]));\n     }\n }\n \n+const fn create_header(which: u8, n: u32) -> [u8; 5] {\n+    let bytes = n.to_be_bytes();\n+    [which, bytes[0], bytes[1], bytes[2], bytes[3]]\n+}\n+\n fn read_u32(r: &mut dyn Read) -> u32 {\n     let mut len = [0; 4];\n     t!(r.read_exact(&mut len));\n-    ((len[0] as u32) << 24)\n-        | ((len[1] as u32) << 16)\n-        | ((len[2] as u32) << 8)\n-        | ((len[3] as u32) << 0)\n+    u32::from_be_bytes(len)\n }"}]}