{"sha": "e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0YTliMzYxMjY3YjFiY2Q5ZWFkMzIwZjE5ZWYxNWE2ZmE0ZTQ4ZjI=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-14T05:23:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-14T05:23:11Z"}, "message": "Rollup merge of #74147 - dennis-hamester:fix/issue-74134, r=jyn514\n\nrustdoc: Allow linking from private items to private types\n\nFixes #74134\n\nAfter PR #72771 this would trigger an intra_doc_link_resolution_failure warning\nwhen rustdoc is invoked without --document-private-items. Links from private\nitems to private types are however never actually generated in that case and\nthus shouldn't produce a warning. These links are in fact a very useful tool to\ndocument crate internals.\n\nTests are added for all 4 combinations of public/private items and link\ntargets. Test 1 is the case mentioned above and fails without this commit. Tests\n2 - 4 passed before already but are added nonetheless to prevent regressions.", "tree": {"sha": "27f6749555466c0b9718ff1040ad180165822bd0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/27f6749555466c0b9718ff1040ad180165822bd0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfDUFACRBK7hj4Ov3rIwAAdHIIAAq+p8iudtolIKHIopvEBzEz\ny/EKfEy9WXnOkEVRnj2tnbpWQEH+f/9cOF5nqOkxw3NJzlnxAsyRATuXUMxZusvm\n6AXdXnYNLWNc931VvZ71sQAcKdDoeNZeSFtNofrlkxmT/SVX3ZPozjWfRPu3YsIF\n0LZya28G0IbRhH0W9zvJDIerCggGj/DtZ6eaNPMnVKVWlBy9vH8Tqwhum3kIDv3h\nDZDzJ317NaddepjkIv5FW/mun4w/JNyx2jjVqGR08zf63EWg92fCDwxavrbfL9Z8\nH/+R5C2YMlPA8WAfdXQlmZytpgy9oRVe96uOSbGOrWQPmq6zkUErmrZgsL9b3Dc=\n=muX9\n-----END PGP SIGNATURE-----\n", "payload": "tree 27f6749555466c0b9718ff1040ad180165822bd0\nparent 549aa03d862d45f5c33fae2ea2a2d2d537207bda\nparent 87895251ea372a8a776a229c45dd703b4e5b22eb\nauthor Manish Goregaokar <manishsmail@gmail.com> 1594704191 -0700\ncommitter GitHub <noreply@github.com> 1594704191 -0700\n\nRollup merge of #74147 - dennis-hamester:fix/issue-74134, r=jyn514\n\nrustdoc: Allow linking from private items to private types\n\nFixes #74134\n\nAfter PR #72771 this would trigger an intra_doc_link_resolution_failure warning\nwhen rustdoc is invoked without --document-private-items. Links from private\nitems to private types are however never actually generated in that case and\nthus shouldn't produce a warning. These links are in fact a very useful tool to\ndocument crate internals.\n\nTests are added for all 4 combinations of public/private items and link\ntargets. Test 1 is the case mentioned above and fails without this commit. Tests\n2 - 4 passed before already but are added nonetheless to prevent regressions.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2", "html_url": "https://github.com/rust-lang/rust/commit/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "549aa03d862d45f5c33fae2ea2a2d2d537207bda", "url": "https://api.github.com/repos/rust-lang/rust/commits/549aa03d862d45f5c33fae2ea2a2d2d537207bda", "html_url": "https://github.com/rust-lang/rust/commit/549aa03d862d45f5c33fae2ea2a2d2d537207bda"}, {"sha": "87895251ea372a8a776a229c45dd703b4e5b22eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/87895251ea372a8a776a229c45dd703b4e5b22eb", "html_url": "https://github.com/rust-lang/rust/commit/87895251ea372a8a776a229c45dd703b4e5b22eb"}], "stats": {"total": 52, "additions": 52, "deletions": 0}, "files": [{"sha": "f707c1a3e1a1086f8dd4de3430869a6927bb01cd", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2", "patch": "@@ -799,6 +799,7 @@ impl<'a, 'tcx> DocFolder for LinkCollector<'a, 'tcx> {\n \n                     let hir_id = self.cx.tcx.hir().as_local_hir_id(local);\n                     if !self.cx.tcx.privacy_access_levels(LOCAL_CRATE).is_exported(hir_id)\n+                        && (item.visibility == Visibility::Public)\n                         && !self.cx.render_options.document_private\n                     {\n                         let item_name = item.name.as_deref().unwrap_or(\"<unknown>\");"}, {"sha": "03f95f19d326e7b531896f9e2fa56e59de9f6343", "filename": "src/test/rustdoc-ui/issue-74134.public.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2/src%2Ftest%2Frustdoc-ui%2Fissue-74134.public.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2/src%2Ftest%2Frustdoc-ui%2Fissue-74134.public.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fissue-74134.public.stderr?ref=e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2", "patch": "@@ -0,0 +1,10 @@\n+warning: `[PrivateType]` public documentation for `public_item` links to a private item\n+  --> $DIR/issue-74134.rs:19:10\n+   |\n+LL |     /// [`PrivateType`]\n+   |          ^^^^^^^^^^^^^ this item is private\n+   |\n+   = note: `#[warn(intra_doc_link_resolution_failure)]` on by default\n+\n+warning: 1 warning emitted\n+"}, {"sha": "d561c2dd8901502736ab1001b06b3f671b65724f", "filename": "src/test/rustdoc-ui/issue-74134.rs", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2/src%2Ftest%2Frustdoc-ui%2Fissue-74134.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2/src%2Ftest%2Frustdoc-ui%2Fissue-74134.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fissue-74134.rs?ref=e4a9b361267b1bcd9ead320f19ef15a6fa4e48f2", "patch": "@@ -0,0 +1,41 @@\n+// revisions: public private\n+// [private]compile-flags: --document-private-items\n+// check-pass\n+\n+// There are 4 cases here:\n+// 1. public item  -> public type:  no warning\n+// 2. public item  -> private type: warning, if --document-private-items is not passed\n+// 3. private item -> public type:  no warning\n+// 4. private item -> private type: no warning\n+// All 4 cases are tested with and without --document-private-items.\n+//\n+// Case 4 without --document-private-items is the one described in issue #74134.\n+\n+struct PrivateType;\n+pub struct PublicType;\n+\n+pub struct Public {\n+    /// [`PublicType`]\n+    /// [`PrivateType`]\n+    //[public]~^ WARNING public documentation for `public_item` links to a private\n+    pub public_item: u32,\n+\n+    /// [`PublicType`]\n+    /// [`PrivateType`]\n+    private_item: u32,\n+}\n+\n+// The following cases are identical to the ones above, except that they are in a private\n+// module. Thus they all fall into cases 3 and 4 and should not produce a warning.\n+\n+mod private {\n+    pub struct Public {\n+        /// [`super::PublicType`]\n+        /// [`super::PrivateType`]\n+        pub public_item: u32,\n+\n+        /// [`super::PublicType`]\n+        /// [`super::PrivateType`]\n+        private_item: u32,\n+    }\n+}"}]}