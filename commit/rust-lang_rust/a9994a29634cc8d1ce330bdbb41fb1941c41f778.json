{"sha": "a9994a29634cc8d1ce330bdbb41fb1941c41f778", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5OTk0YTI5NjM0Y2M4ZDFjZTMzMGJkYmI0MWZiMTk0MWM0MWY3Nzg=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-01-07T06:15:39Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-01-07T19:34:14Z"}, "message": "Correctly initialize circular_buffer to a power-of-two bytes", "tree": {"sha": "8900a89ea5a825b1b1102eb06f2fb66517d0ade5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8900a89ea5a825b1b1102eb06f2fb66517d0ade5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a9994a29634cc8d1ce330bdbb41fb1941c41f778", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a9994a29634cc8d1ce330bdbb41fb1941c41f778", "html_url": "https://github.com/rust-lang/rust/commit/a9994a29634cc8d1ce330bdbb41fb1941c41f778", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a9994a29634cc8d1ce330bdbb41fb1941c41f778/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "12eb60c29d8b559f7de7890917094ec95999e847", "url": "https://api.github.com/repos/rust-lang/rust/commits/12eb60c29d8b559f7de7890917094ec95999e847", "html_url": "https://github.com/rust-lang/rust/commit/12eb60c29d8b559f7de7890917094ec95999e847"}], "stats": {"total": 39, "additions": 38, "deletions": 1}, "files": [{"sha": "bdf251248cd823aa46f18bfbefe157dc773746bd", "filename": "src/rt/circular_buffer.cpp", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a9994a29634cc8d1ce330bdbb41fb1941c41f778/src%2Frt%2Fcircular_buffer.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/a9994a29634cc8d1ce330bdbb41fb1941c41f778/src%2Frt%2Fcircular_buffer.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Fcircular_buffer.cpp?ref=a9994a29634cc8d1ce330bdbb41fb1941c41f778", "patch": "@@ -15,7 +15,8 @@ is_power_of_two(size_t value) {\n circular_buffer::circular_buffer(rust_dom *dom, size_t unit_sz) :\n     dom(dom),\n     unit_sz(unit_sz),\n-    _buffer_sz(INITIAL_CIRCULAR_BUFFFER_SIZE_IN_UNITS * unit_sz),\n+    _buffer_sz(next_power_of_two(\n+               INITIAL_CIRCULAR_BUFFFER_SIZE_IN_UNITS * unit_sz)),\n     _next(0),\n     _unread(0),\n     _buffer((uint8_t *)dom->calloc(_buffer_sz)) {"}, {"sha": "ce2751fab9b606c6a2b1f898669f87aa18f422d8", "filename": "src/test/run-pass/chan-poweroftwo.rs", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/a9994a29634cc8d1ce330bdbb41fb1941c41f778/src%2Ftest%2Frun-pass%2Fchan-poweroftwo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a9994a29634cc8d1ce330bdbb41fb1941c41f778/src%2Ftest%2Frun-pass%2Fchan-poweroftwo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fchan-poweroftwo.rs?ref=a9994a29634cc8d1ce330bdbb41fb1941c41f778", "patch": "@@ -0,0 +1,36 @@\n+// -*- rust -*-\n+\n+// Regression test for circular_buffer initialization\n+\n+use std;\n+\n+import std.option;\n+import std._uint;\n+import std._vec;\n+\n+// 12-byte unit for the channel buffer. Assuming that the default\n+// buffer size needs to hold 8 units, then the minimum buffer size\n+// needs to be 96. That's not a power of two so needs to be rounded up.\n+type record = rec(i32 val1, i32 val2, i32 val3);\n+\n+impure fn worker(chan[record] channel) {\n+    let record val = rec(val1=0i32, val2=0i32, val3=0i32);\n+    channel <| val;\n+}\n+\n+impure fn main() {\n+    let port[record] myport = port();\n+    auto mychan = chan(myport);\n+\n+    auto temp = spawn worker(mychan);\n+    auto val <- myport;\n+}\n+\n+// Local Variables:\n+// mode: rust;\n+// fill-column: 78;\n+// indent-tabs-mode: nil\n+// c-basic-offset: 4\n+// buffer-file-coding-system: utf-8-unix\n+// compile-command: \"make -k -C .. 2>&1 | sed -e 's/\\\\/x\\\\//x:\\\\//g'\";\n+// End:"}]}