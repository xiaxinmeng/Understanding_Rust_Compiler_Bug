{"sha": "4566414789310acb2617543f4b50beab4bb48e06", "node_id": "C_kwDOAAsO6NoAKDQ1NjY0MTQ3ODkzMTBhY2IyNjE3NTQzZjRiNTBiZWFiNGJiNDhlMDY", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-11-20T20:24:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-11-20T20:24:31Z"}, "message": "Merge #10810\n\n10810: feat: Add toggle to disable cache priming r=jonas-schievink a=lnicola\n\nEven if it doesn't prevent the rest of the features from working, cache priming tends to be quite CPU-intensive and can make people think that the load times are worse than they actually are.\r\n\r\nIt's also less useful in Code and `rust-tools` because the inlay hints and semantic highlighting trigger quite a bit of computation assuming you have a file open in the editor.\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "e5862136a04369e32bafc8a8a6e8e855e7e48e5e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e5862136a04369e32bafc8a8a6e8e855e7e48e5e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4566414789310acb2617543f4b50beab4bb48e06", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhmVl/CRBK7hj4Ov3rIwAAyq0IAIeQxyfnFo2pUperbTUZSCel\ncIVnM6uOwW7+6ozv80B/eA5Id7eAmkKdrIuYNFMkl7TBC3ZQuJ5E36vsKbQRhKiW\nNdvYadZztjxP6SKEXNs7EW/jwPfGKeMXj3lLdL+vFeSktKoBVkm4ZmnHpO82z0M5\naaMa5vYQeKZwTazkic7aZYd4suIo/Y2w0BKUlWTQejBnjDJtbLAPeAQBDHAZk6mO\nEROYAzfBHPCJlvb9igZXZYAbthzS2l4oN+clUjmad037rqSIvtilkRkQnvOXLSJw\njKqvRnZVYxv86F0rfXZ9wjlkHtdWtNHG9zt9BtGr5nLakOzYfxS42DglZyj+QHk=\n=XbtE\n-----END PGP SIGNATURE-----\n", "payload": "tree e5862136a04369e32bafc8a8a6e8e855e7e48e5e\nparent c9c6fa8f56a2b095b5f6b7dc66a4f1db4a9a9a30\nparent a68ce62f6a33d3e5777c1d64c946e0f1d9c7f457\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1637439871 +0000\ncommitter GitHub <noreply@github.com> 1637439871 +0000\n\nMerge #10810\n\n10810: feat: Add toggle to disable cache priming r=jonas-schievink a=lnicola\n\nEven if it doesn't prevent the rest of the features from working, cache priming tends to be quite CPU-intensive and can make people think that the load times are worse than they actually are.\r\n\r\nIt's also less useful in Code and `rust-tools` because the inlay hints and semantic highlighting trigger quite a bit of computation assuming you have a file open in the editor.\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4566414789310acb2617543f4b50beab4bb48e06", "html_url": "https://github.com/rust-lang/rust/commit/4566414789310acb2617543f4b50beab4bb48e06", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4566414789310acb2617543f4b50beab4bb48e06/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c9c6fa8f56a2b095b5f6b7dc66a4f1db4a9a9a30", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9c6fa8f56a2b095b5f6b7dc66a4f1db4a9a9a30", "html_url": "https://github.com/rust-lang/rust/commit/c9c6fa8f56a2b095b5f6b7dc66a4f1db4a9a9a30"}, {"sha": "a68ce62f6a33d3e5777c1d64c946e0f1d9c7f457", "url": "https://api.github.com/repos/rust-lang/rust/commits/a68ce62f6a33d3e5777c1d64c946e0f1d9c7f457", "html_url": "https://github.com/rust-lang/rust/commit/a68ce62f6a33d3e5777c1d64c946e0f1d9c7f457"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "5826b6b114c2b455e68eab0d2a08e4b5eacf5f74", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4566414789310acb2617543f4b50beab4bb48e06/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4566414789310acb2617543f4b50beab4bb48e06/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=4566414789310acb2617543f4b50beab4bb48e06", "patch": "@@ -58,6 +58,9 @@ config_data! {\n         /// Whether to allow import insertion to merge new imports into single path glob imports like `use std::fmt::*;`.\n         assist_allowMergingIntoGlobImports: bool           = \"true\",\n \n+        /// Warm up caches on project load.\n+        cache_warmup: bool = \"true\",\n+\n         /// Show function name and docs in parameter hints.\n         callInfo_full: bool                                = \"true\",\n \n@@ -545,6 +548,10 @@ impl Config {\n         )\n     }\n \n+    pub fn prefill_caches(&self) -> bool {\n+        self.data.cache_warmup\n+    }\n+\n     pub fn location_link(&self) -> bool {\n         try_or!(self.caps.text_document.as_ref()?.definition?.link_support?, false)\n     }"}, {"sha": "979b3b1522159679d2c1de1d81e5ca0bf2c9453e", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4566414789310acb2617543f4b50beab4bb48e06/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4566414789310acb2617543f4b50beab4bb48e06/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=4566414789310acb2617543f4b50beab4bb48e06", "patch": "@@ -433,7 +433,9 @@ impl GlobalState {\n                 for flycheck in &self.flycheck {\n                     flycheck.update();\n                 }\n-                self.prime_caches_queue.request_op();\n+                if self.config.prefill_caches() {\n+                    self.prime_caches_queue.request_op();\n+                }\n             }\n \n             if !was_quiescent || state_changed {"}, {"sha": "9f6f046014c23bc513afb9a4782950e03c796a9e", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4566414789310acb2617543f4b50beab4bb48e06/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/4566414789310acb2617543f4b50beab4bb48e06/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=4566414789310acb2617543f4b50beab4bb48e06", "patch": "@@ -23,6 +23,11 @@ Group inserted imports by the https://rust-analyzer.github.io/manual.html#auto-i\n --\n Whether to allow import insertion to merge new imports into single path glob imports like `use std::fmt::*;`.\n --\n+[[rust-analyzer.cache.warmup]]rust-analyzer.cache.warmup (default: `true`)::\n++\n+--\n+Warm up caches on project load.\n+--\n [[rust-analyzer.callInfo.full]]rust-analyzer.callInfo.full (default: `true`)::\n +\n --"}, {"sha": "52ba1327459da29ccbdcec749f07a3b2a98a856b", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4566414789310acb2617543f4b50beab4bb48e06/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/4566414789310acb2617543f4b50beab4bb48e06/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=4566414789310acb2617543f4b50beab4bb48e06", "patch": "@@ -445,6 +445,11 @@\n                     \"default\": true,\n                     \"type\": \"boolean\"\n                 },\n+                \"rust-analyzer.cache.warmup\": {\n+                    \"markdownDescription\": \"Warm up caches on project load.\",\n+                    \"default\": true,\n+                    \"type\": \"boolean\"\n+                },\n                 \"rust-analyzer.callInfo.full\": {\n                     \"markdownDescription\": \"Show function name and docs in parameter hints.\",\n                     \"default\": true,"}]}