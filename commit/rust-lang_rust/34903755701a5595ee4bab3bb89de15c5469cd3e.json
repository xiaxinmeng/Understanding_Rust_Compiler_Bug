{"sha": "34903755701a5595ee4bab3bb89de15c5469cd3e", "node_id": "C_kwDOAAsO6NoAKDM0OTAzNzU1NzAxYTU1OTVlZTRiYWIzYmI4OWRlMTVjNTQ2OWNkM2U", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-12-04T18:26:09Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2023-05-09T17:59:34Z"}, "message": "Implement SSA-based reference propagation.", "tree": {"sha": "86d662115d239932ad2f5f5ebddf431be78ce84a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86d662115d239932ad2f5f5ebddf431be78ce84a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34903755701a5595ee4bab3bb89de15c5469cd3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34903755701a5595ee4bab3bb89de15c5469cd3e", "html_url": "https://github.com/rust-lang/rust/commit/34903755701a5595ee4bab3bb89de15c5469cd3e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34903755701a5595ee4bab3bb89de15c5469cd3e/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7b831ac8a897273f78b9f47165cf8e54066ce4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7b831ac8a897273f78b9f47165cf8e54066ce4b", "html_url": "https://github.com/rust-lang/rust/commit/f7b831ac8a897273f78b9f47165cf8e54066ce4b"}], "stats": {"total": 2748, "additions": 2668, "deletions": 80}, "files": [{"sha": "55991facd89a35b5ded43137da3ae9d1b4887629", "filename": "compiler/rustc_middle/src/mir/mod.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -1524,6 +1524,19 @@ impl<V, T> ProjectionElem<V, T> {\n         }\n     }\n \n+    /// Returns `true` if the target of this projection always refers to the same memory region\n+    /// whatever the state of the program.\n+    pub fn is_stable_offset(&self) -> bool {\n+        match self {\n+            Self::Deref | Self::Index(_) => false,\n+            Self::Field(_, _)\n+            | Self::OpaqueCast(_)\n+            | Self::ConstantIndex { .. }\n+            | Self::Subslice { .. }\n+            | Self::Downcast(_, _) => true,\n+        }\n+    }\n+\n     /// Returns `true` if this is a `Downcast` projection with the given `VariantIdx`.\n     pub fn is_downcast_to(&self, v: VariantIdx) -> bool {\n         matches!(*self, Self::Downcast(_, x) if x == v)"}, {"sha": "171db6965ac18f9a9cd1ee90111655245a154b62", "filename": "compiler/rustc_mir_dataflow/src/impls/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fmod.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -26,7 +26,7 @@ pub use self::borrowed_locals::borrowed_locals;\n pub use self::borrowed_locals::MaybeBorrowedLocals;\n pub use self::liveness::MaybeLiveLocals;\n pub use self::liveness::MaybeTransitiveLiveLocals;\n-pub use self::storage_liveness::{MaybeRequiresStorage, MaybeStorageLive};\n+pub use self::storage_liveness::{MaybeRequiresStorage, MaybeStorageDead, MaybeStorageLive};\n \n /// `MaybeInitializedPlaces` tracks all places that might be\n /// initialized upon reaching a particular point in the control flow"}, {"sha": "9656148581f88159b83c0b005502f434c4f7f0d4", "filename": "compiler/rustc_mir_dataflow/src/impls/storage_liveness.rs", "status": "modified", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fstorage_liveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fstorage_liveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fstorage_liveness.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -74,6 +74,72 @@ impl<'tcx, 'a> crate::GenKillAnalysis<'tcx> for MaybeStorageLive<'a> {\n     }\n }\n \n+#[derive(Clone)]\n+pub struct MaybeStorageDead {\n+    always_live_locals: BitSet<Local>,\n+}\n+\n+impl MaybeStorageDead {\n+    pub fn new(always_live_locals: BitSet<Local>) -> Self {\n+        MaybeStorageDead { always_live_locals }\n+    }\n+}\n+\n+impl<'tcx> crate::AnalysisDomain<'tcx> for MaybeStorageDead {\n+    type Domain = BitSet<Local>;\n+\n+    const NAME: &'static str = \"maybe_storage_dead\";\n+\n+    fn bottom_value(&self, body: &mir::Body<'tcx>) -> Self::Domain {\n+        // bottom = live\n+        BitSet::new_empty(body.local_decls.len())\n+    }\n+\n+    fn initialize_start_block(&self, body: &mir::Body<'tcx>, on_entry: &mut Self::Domain) {\n+        assert_eq!(body.local_decls.len(), self.always_live_locals.domain_size());\n+        for local in body.vars_and_temps_iter() {\n+            if !self.always_live_locals.contains(local) {\n+                on_entry.insert(local);\n+            }\n+        }\n+    }\n+}\n+\n+impl<'tcx> crate::GenKillAnalysis<'tcx> for MaybeStorageDead {\n+    type Idx = Local;\n+\n+    fn statement_effect(\n+        &self,\n+        trans: &mut impl GenKill<Self::Idx>,\n+        stmt: &mir::Statement<'tcx>,\n+        _: Location,\n+    ) {\n+        match stmt.kind {\n+            StatementKind::StorageLive(l) => trans.kill(l),\n+            StatementKind::StorageDead(l) => trans.gen(l),\n+            _ => (),\n+        }\n+    }\n+\n+    fn terminator_effect(\n+        &self,\n+        _trans: &mut impl GenKill<Self::Idx>,\n+        _: &mir::Terminator<'tcx>,\n+        _: Location,\n+    ) {\n+        // Terminators have no effect\n+    }\n+\n+    fn call_return_effect(\n+        &self,\n+        _trans: &mut impl GenKill<Self::Idx>,\n+        _block: BasicBlock,\n+        _return_places: CallReturnPlaces<'_, 'tcx>,\n+    ) {\n+        // Nothing to do when a call returns successfully\n+    }\n+}\n+\n type BorrowedLocalsResults<'a, 'tcx> = ResultsRefCursor<'a, 'a, 'tcx, MaybeBorrowedLocals>;\n \n /// Dataflow analysis that determines whether each local requires storage at a"}, {"sha": "2fa5c0bca15bf7fbc0a2b4bba4a6060cb875df4c", "filename": "compiler/rustc_mir_transform/src/copy_prop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fcopy_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fcopy_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fcopy_prop.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -76,7 +76,7 @@ fn propagate_ssa<'tcx>(tcx: TyCtxt<'tcx>, body: &mut Body<'tcx>) {\n fn fully_moved_locals(ssa: &SsaLocals, body: &Body<'_>) -> BitSet<Local> {\n     let mut fully_moved = BitSet::new_filled(body.local_decls.len());\n \n-    for (_, rvalue) in ssa.assignments(body) {\n+    for (_, rvalue, _) in ssa.assignments(body) {\n         let (Rvalue::Use(Operand::Copy(place) | Operand::Move(place)) | Rvalue::CopyForDeref(place))\n             = rvalue\n         else { continue };"}, {"sha": "277237a5515a43c118b11dba91f1cddb4827d60e", "filename": "compiler/rustc_mir_transform/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Flib.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -84,6 +84,7 @@ mod match_branches;\n mod multiple_return_terminators;\n mod normalize_array_len;\n mod nrvo;\n+mod ref_prop;\n mod remove_noop_landing_pads;\n mod remove_storage_markers;\n mod remove_uninit_drops;\n@@ -559,6 +560,7 @@ fn run_optimization_passes<'tcx>(tcx: TyCtxt<'tcx>, body: &mut Body<'tcx>) {\n             &separate_const_switch::SeparateConstSwitch,\n             &simplify::SimplifyLocals::BeforeConstProp,\n             &copy_prop::CopyProp,\n+            &ref_prop::ReferencePropagation,\n             &const_prop::ConstProp,\n             &dataflow_const_prop::DataflowConstProp,\n             //"}, {"sha": "109a2c0aec6f253af416f3ace3d7335798952713", "filename": "compiler/rustc_mir_transform/src/normalize_array_len.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fnormalize_array_len.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fnormalize_array_len.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fnormalize_array_len.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -41,7 +41,7 @@ fn compute_slice_length<'tcx>(\n ) -> IndexVec<Local, Option<ty::Const<'tcx>>> {\n     let mut slice_lengths = IndexVec::from_elem(None, &body.local_decls);\n \n-    for (local, rvalue) in ssa.assignments(body) {\n+    for (local, rvalue, _) in ssa.assignments(body) {\n         match rvalue {\n             Rvalue::Cast(\n                 CastKind::Pointer(ty::adjustment::PointerCast::Unsize),"}, {"sha": "dfdf4caf8811170f8e69b546db7ad81d5611748c", "filename": "compiler/rustc_mir_transform/src/ref_prop.rs", "status": "added", "additions": 324, "deletions": 0, "changes": 324, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fref_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fref_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fref_prop.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,324 @@\n+use rustc_data_structures::fx::FxHashSet;\n+use rustc_index::bit_set::BitSet;\n+use rustc_index::IndexVec;\n+use rustc_middle::mir::visit::*;\n+use rustc_middle::mir::*;\n+use rustc_middle::ty::TyCtxt;\n+use rustc_mir_dataflow::impls::{borrowed_locals, MaybeStorageDead};\n+use rustc_mir_dataflow::storage::always_storage_live_locals;\n+use rustc_mir_dataflow::Analysis;\n+\n+use crate::ssa::SsaLocals;\n+use crate::MirPass;\n+\n+/// Propagate references using SSA analysis.\n+///\n+/// MIR building may produce a lot of borrow-dereference patterns.\n+///\n+/// This pass aims to transform the following pattern:\n+///   _1 = &raw? mut? PLACE;\n+///   _3 = *_1;\n+///   _4 = &raw? mut? *_1;\n+///\n+/// Into\n+///   _1 = &raw? mut? PLACE;\n+///   _3 = PLACE;\n+///   _4 = &raw? mut? PLACE;\n+///\n+/// where `PLACE` is a direct or an indirect place expression.\n+///\n+/// There are 3 properties that need to be upheld for this transformation to be legal:\n+/// - place stability: `PLACE` must refer to the same memory wherever it appears;\n+/// - pointer liveness: we must not introduce dereferences of dangling pointers;\n+/// - `&mut` borrow uniqueness.\n+///\n+/// # Stability\n+///\n+/// If `PLACE` is an indirect projection, if its of the form `(*LOCAL).PROJECTIONS` where:\n+/// - `LOCAL` is SSA;\n+/// - all projections in `PROJECTIONS` have a stable offset (no dereference and no indexing).\n+///\n+/// If `PLACE` is a direct projection of a local, we consider it as constant if:\n+/// - the local is always live, or it has a single `StorageLive` that dominates all uses;\n+/// - all projections have a stable offset.\n+///\n+/// # Liveness\n+///\n+/// When performing a substitution, we must take care not to introduce uses of dangling locals.\n+/// To ensure this, we walk the body with the `MaybeStorageDead` dataflow analysis:\n+/// - if we want to replace `*x` by reborrow `*y` and `y` may be dead, we allow replacement and\n+///   mark storage statements on `y` for removal;\n+/// - if we want to replace `*x` by non-reborrow `y` and `y` must be live, we allow replacement;\n+/// - if we want to replace `*x` by non-reborrow `y` and `y` may be dead, we do not replace.\n+///\n+/// # Uniqueness\n+///\n+/// For `&mut` borrows, we also need to preserve the uniqueness property:\n+/// we must avoid creating a state where we interleave uses of `*_1` and `_2`.\n+/// To do it, we only perform full substitution of mutable borrows:\n+/// we replace either all or none of the occurrences of `*_1`.\n+///\n+/// Some care has to be taken when `_1` is copied in other locals.\n+///   _1 = &raw? mut? _2;\n+///   _3 = *_1;\n+///   _4 = _1\n+///   _5 = *_4\n+/// In such cases, fully substituting `_1` means fully substituting all of the copies.\n+///\n+/// For immutable borrows, we do not need to preserve such uniqueness property,\n+/// so we perform all the possible substitutions without removing the `_1 = &_2` statement.\n+pub struct ReferencePropagation;\n+\n+impl<'tcx> MirPass<'tcx> for ReferencePropagation {\n+    fn is_enabled(&self, sess: &rustc_session::Session) -> bool {\n+        sess.mir_opt_level() >= 4\n+    }\n+\n+    #[instrument(level = \"trace\", skip(self, tcx, body))]\n+    fn run_pass(&self, tcx: TyCtxt<'tcx>, body: &mut Body<'tcx>) {\n+        debug!(def_id = ?body.source.def_id());\n+        propagate_ssa(tcx, body);\n+    }\n+}\n+\n+fn propagate_ssa<'tcx>(tcx: TyCtxt<'tcx>, body: &mut Body<'tcx>) {\n+    let param_env = tcx.param_env_reveal_all_normalized(body.source.def_id());\n+    let borrowed_locals = borrowed_locals(body);\n+    let ssa = SsaLocals::new(tcx, param_env, body, &borrowed_locals);\n+\n+    let mut replacer = compute_replacement(tcx, body, &ssa);\n+    debug!(?replacer.targets, ?replacer.allowed_replacements, ?replacer.storage_to_remove);\n+\n+    replacer.visit_body_preserves_cfg(body);\n+\n+    if replacer.any_replacement {\n+        crate::simplify::remove_unused_definitions(body);\n+    }\n+}\n+\n+#[derive(Copy, Clone, Debug, PartialEq, Eq)]\n+enum Value<'tcx> {\n+    /// Not a pointer, or we can't know.\n+    Unknown,\n+    /// We know the value to be a pointer to this place.\n+    /// The boolean indicates whether the reference is mutable, subject the uniqueness rule.\n+    Pointer(Place<'tcx>, bool),\n+}\n+\n+/// For each local, save the place corresponding to `*local`.\n+#[instrument(level = \"trace\", skip(tcx, body))]\n+fn compute_replacement<'tcx>(\n+    tcx: TyCtxt<'tcx>,\n+    body: &Body<'tcx>,\n+    ssa: &SsaLocals,\n+) -> Replacer<'tcx> {\n+    // Compute `MaybeStorageDead` dataflow to check that we only replace when the pointee is\n+    // definitely live.\n+    let always_live_locals = always_storage_live_locals(body);\n+    let mut maybe_dead = MaybeStorageDead::new(always_live_locals)\n+        .into_engine(tcx, body)\n+        .iterate_to_fixpoint()\n+        .into_results_cursor(body);\n+\n+    // Map for each local to the pointee.\n+    let mut targets = IndexVec::from_elem(Value::Unknown, &body.local_decls);\n+    // Set of locals for which we will remove their storage statement. This is useful for\n+    // reborrowed references.\n+    let mut storage_to_remove = BitSet::new_empty(body.local_decls.len());\n+\n+    let fully_replacable_locals = fully_replacable_locals(ssa);\n+\n+    let mut can_perform_opt = |target: Place<'tcx>, loc: Location| {\n+        maybe_dead.seek_after_primary_effect(loc);\n+        let maybe_dead = maybe_dead.contains(target.local);\n+\n+        if target.projection.first() == Some(&PlaceElem::Deref) {\n+            // We are creating a reborrow. As `place.local` is a reference, removing the\n+            // `StorageDead` is fine.\n+            if maybe_dead {\n+                storage_to_remove.insert(target.local);\n+            }\n+            true\n+        } else {\n+            // This is a proper dereference. We can only allow it if `target` is live.\n+            !maybe_dead\n+        }\n+    };\n+\n+    for (local, rvalue, location) in ssa.assignments(body) {\n+        debug!(?local);\n+\n+        // Only visit if we have something to do.\n+        let Value::Unknown = targets[local] else { bug!() };\n+\n+        let ty = body.local_decls[local].ty;\n+\n+        // If this is not a reference or pointer, do nothing.\n+        if !ty.is_any_ptr() {\n+            debug!(\"not a reference or pointer\");\n+            continue;\n+        }\n+\n+        // If this a mutable reference that we cannot fully replace, mark it as unknown.\n+        if ty.is_mutable_ptr() && !fully_replacable_locals.contains(local) {\n+            debug!(\"not fully replaceable\");\n+            continue;\n+        }\n+\n+        debug!(?rvalue);\n+        match rvalue {\n+            // This is a copy, just use the value we have in store for the previous one.\n+            // As we are visiting in `assignment_order`, ie. reverse postorder, `rhs` should\n+            // have been visited before.\n+            Rvalue::Use(Operand::Copy(place) | Operand::Move(place))\n+            | Rvalue::CopyForDeref(place) => {\n+                if let Some(rhs) = place.as_local() {\n+                    let target = targets[rhs];\n+                    if matches!(target, Value::Pointer(..)) {\n+                        targets[local] = target;\n+                    } else if ssa.is_ssa(rhs) {\n+                        let refmut = body.local_decls[rhs].ty.is_mutable_ptr();\n+                        targets[local] = Value::Pointer(tcx.mk_place_deref(rhs.into()), refmut);\n+                    }\n+                }\n+            }\n+            Rvalue::Ref(_, _, place) | Rvalue::AddressOf(_, place) => {\n+                let mut place = *place;\n+                // Try to see through `place` in order to collapse reborrow chains.\n+                if place.projection.first() == Some(&PlaceElem::Deref)\n+                    && let Value::Pointer(target, refmut) = targets[place.local]\n+                    // Only see through immutable reference and pointers, as we do not know yet if\n+                    // mutable references are fully replaced.\n+                    && !refmut\n+                    // Only collapse chain if the pointee is definitely live.\n+                    && can_perform_opt(target, location)\n+                {\n+                    place = target.project_deeper(&place.projection[1..], tcx);\n+                }\n+                assert_ne!(place.local, local);\n+                if ssa.is_constant_place(place) {\n+                    targets[local] = Value::Pointer(place, ty.is_mutable_ptr());\n+                }\n+            }\n+            // We do not know what to do, so keep as not-a-pointer.\n+            _ => {}\n+        }\n+    }\n+\n+    debug!(?targets);\n+\n+    let mut finder = ReplacementFinder {\n+        targets: &mut targets,\n+        can_perform_opt,\n+        allowed_replacements: FxHashSet::default(),\n+    };\n+    let reachable_blocks = traversal::reachable_as_bitset(body);\n+    for (bb, bbdata) in body.basic_blocks.iter_enumerated() {\n+        // Only visit reachable blocks as we rely on dataflow.\n+        if reachable_blocks.contains(bb) {\n+            finder.visit_basic_block_data(bb, bbdata);\n+        }\n+    }\n+\n+    let allowed_replacements = finder.allowed_replacements;\n+    return Replacer {\n+        tcx,\n+        targets,\n+        storage_to_remove,\n+        allowed_replacements,\n+        any_replacement: false,\n+    };\n+\n+    struct ReplacementFinder<'a, 'tcx, F> {\n+        targets: &'a mut IndexVec<Local, Value<'tcx>>,\n+        can_perform_opt: F,\n+        allowed_replacements: FxHashSet<(Local, Location)>,\n+    }\n+\n+    impl<'tcx, F> Visitor<'tcx> for ReplacementFinder<'_, 'tcx, F>\n+    where\n+        F: FnMut(Place<'tcx>, Location) -> bool,\n+    {\n+        fn visit_place(&mut self, place: &Place<'tcx>, ctxt: PlaceContext, loc: Location) {\n+            if matches!(ctxt, PlaceContext::NonUse(_)) {\n+                // There is no need to check liveness for non-uses.\n+                return;\n+            }\n+\n+            if let Value::Pointer(target, refmut) = self.targets[place.local]\n+                && place.projection.first() == Some(&PlaceElem::Deref)\n+            {\n+                let perform_opt = (self.can_perform_opt)(target, loc);\n+                if perform_opt {\n+                    self.allowed_replacements.insert((target.local, loc));\n+                } else if refmut {\n+                    // This mutable reference is not fully replacable, so drop it.\n+                    self.targets[place.local] = Value::Unknown;\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+/// Compute the set of locals that can be fully replaced.\n+///\n+/// We consider a local to be replacable iff it's only used in a `Deref` projection `*_local` or\n+/// non-use position (like storage statements and debuginfo).\n+fn fully_replacable_locals(ssa: &SsaLocals) -> BitSet<Local> {\n+    let mut replacable = BitSet::new_empty(ssa.num_locals());\n+\n+    // First pass: for each local, whether its uses can be fully replaced.\n+    for local in ssa.locals() {\n+        if ssa.num_direct_uses(local) == 0 {\n+            replacable.insert(local);\n+        }\n+    }\n+\n+    // Second pass: a local can only be fully replaced if all its copies can.\n+    ssa.meet_copy_equivalence(&mut replacable);\n+\n+    replacable\n+}\n+\n+/// Utility to help performing subtitution of `*pattern` by `target`.\n+struct Replacer<'tcx> {\n+    tcx: TyCtxt<'tcx>,\n+    targets: IndexVec<Local, Value<'tcx>>,\n+    storage_to_remove: BitSet<Local>,\n+    allowed_replacements: FxHashSet<(Local, Location)>,\n+    any_replacement: bool,\n+}\n+\n+impl<'tcx> MutVisitor<'tcx> for Replacer<'tcx> {\n+    fn tcx(&self) -> TyCtxt<'tcx> {\n+        self.tcx\n+    }\n+\n+    fn visit_place(&mut self, place: &mut Place<'tcx>, ctxt: PlaceContext, loc: Location) {\n+        if let Value::Pointer(target, _) = self.targets[place.local]\n+            && place.projection.first() == Some(&PlaceElem::Deref)\n+        {\n+            let perform_opt = matches!(ctxt, PlaceContext::NonUse(_))\n+                || self.allowed_replacements.contains(&(target.local, loc));\n+\n+            if perform_opt {\n+                *place = target.project_deeper(&place.projection[1..], self.tcx);\n+                self.any_replacement = true;\n+            }\n+        } else {\n+            self.super_place(place, ctxt, loc);\n+        }\n+    }\n+\n+    fn visit_statement(&mut self, stmt: &mut Statement<'tcx>, loc: Location) {\n+        match stmt.kind {\n+            StatementKind::StorageLive(l) | StatementKind::StorageDead(l)\n+                if self.storage_to_remove.contains(l) =>\n+            {\n+                stmt.make_nop();\n+            }\n+            // Do not remove assignments as they may still be useful for debuginfo.\n+            _ => self.super_statement(stmt, loc),\n+        }\n+    }\n+}"}, {"sha": "270bb540b80d9e7fc5be2512bc12c033517d7da2", "filename": "compiler/rustc_mir_transform/src/ssa.rs", "status": "modified", "additions": 89, "deletions": 41, "changes": 130, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fssa.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/compiler%2Frustc_mir_transform%2Fsrc%2Fssa.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fssa.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -6,6 +6,7 @@ use rustc_middle::middle::resolve_bound_vars::Set1;\n use rustc_middle::mir::visit::*;\n use rustc_middle::mir::*;\n use rustc_middle::ty::{ParamEnv, TyCtxt};\n+use rustc_mir_dataflow::storage::always_storage_live_locals;\n \n #[derive(Debug)]\n pub struct SsaLocals {\n@@ -17,6 +18,12 @@ pub struct SsaLocals {\n     assignment_order: Vec<Local>,\n     /// Copy equivalence classes between locals. See `copy_classes` for documentation.\n     copy_classes: IndexVec<Local, Local>,\n+    /// Number of \"direct\" uses of each local, ie. uses that are not dereferences.\n+    /// We ignore non-uses (Storage statements, debuginfo).\n+    direct_uses: IndexVec<Local, u32>,\n+    /// Set of \"StorageLive\" statements for each local. When the \"StorageLive\" statement does not\n+    /// dominate all uses of the local, we mark it as `Set1::Many`.\n+    storage_live: IndexVec<Local, Set1<LocationExtended>>,\n }\n \n /// We often encounter MIR bodies with 1 or 2 basic blocks. In those cases, it's unnecessary to\n@@ -26,23 +33,31 @@ struct SmallDominators {\n     inner: Option<Dominators<BasicBlock>>,\n }\n \n-trait DomExt {\n-    fn dominates(self, _other: Self, dominators: &SmallDominators) -> bool;\n-}\n-\n-impl DomExt for Location {\n-    fn dominates(self, other: Location, dominators: &SmallDominators) -> bool {\n-        if self.block == other.block {\n-            self.statement_index <= other.statement_index\n+impl SmallDominators {\n+    fn dominates(&self, first: Location, second: Location) -> bool {\n+        if first.block == second.block {\n+            first.statement_index <= second.statement_index\n+        } else if let Some(inner) = &self.inner {\n+            inner.dominates(first.block, second.block)\n         } else {\n-            dominators.dominates(self.block, other.block)\n+            first.block < second.block\n         }\n     }\n-}\n \n-impl SmallDominators {\n-    fn dominates(&self, dom: BasicBlock, node: BasicBlock) -> bool {\n-        if let Some(inner) = &self.inner { inner.dominates(dom, node) } else { dom < node }\n+    fn check_dominates(&mut self, set: &mut Set1<LocationExtended>, loc: Location) {\n+        let assign_dominates = match *set {\n+            Set1::Empty | Set1::Many => false,\n+            Set1::One(LocationExtended::Arg) => true,\n+            Set1::One(LocationExtended::Plain(assign)) => {\n+                self.dominates(assign.successor_within_block(), loc)\n+            }\n+        };\n+        // We are visiting a use that is not dominated by an assignment.\n+        // Either there is a cycle involved, or we are reading for uninitialized local.\n+        // Bail out.\n+        if !assign_dominates {\n+            *set = Set1::Many;\n+        }\n     }\n }\n \n@@ -59,7 +74,11 @@ impl SsaLocals {\n         let dominators =\n             if body.basic_blocks.len() > 2 { Some(body.basic_blocks.dominators()) } else { None };\n         let dominators = SmallDominators { inner: dominators };\n-        let mut visitor = SsaVisitor { assignments, assignment_order, dominators };\n+\n+        let direct_uses = IndexVec::from_elem(0, &body.local_decls);\n+        let storage_live = IndexVec::from_elem(Set1::Empty, &body.local_decls);\n+        let mut visitor =\n+            SsaVisitor { assignments, assignment_order, dominators, direct_uses, storage_live };\n \n         for (local, decl) in body.local_decls.iter_enumerated() {\n             if matches!(body.local_kind(local), LocalKind::Arg) {\n@@ -70,6 +89,10 @@ impl SsaLocals {\n             }\n         }\n \n+        for local in always_storage_live_locals(body).iter() {\n+            visitor.storage_live[local] = Set1::One(LocationExtended::Arg);\n+        }\n+\n         if body.basic_blocks.len() > 2 {\n             for (bb, data) in traversal::reverse_postorder(body) {\n                 visitor.visit_basic_block_data(bb, data);\n@@ -85,36 +108,66 @@ impl SsaLocals {\n         }\n \n         debug!(?visitor.assignments);\n+        debug!(?visitor.direct_uses);\n+        debug!(?visitor.storage_live);\n \n         visitor\n             .assignment_order\n             .retain(|&local| matches!(visitor.assignments[local], Set1::One(_)));\n         debug!(?visitor.assignment_order);\n \n-        let copy_classes = compute_copy_classes(&visitor, body);\n+        let copy_classes = compute_copy_classes(&mut visitor, body);\n \n         SsaLocals {\n             assignments: visitor.assignments,\n             assignment_order: visitor.assignment_order,\n+            direct_uses: visitor.direct_uses,\n+            storage_live: visitor.storage_live,\n             copy_classes,\n         }\n     }\n \n+    pub fn num_locals(&self) -> usize {\n+        self.assignments.len()\n+    }\n+\n+    pub fn locals(&self) -> impl Iterator<Item = Local> {\n+        self.assignments.indices()\n+    }\n+\n     pub fn is_ssa(&self, local: Local) -> bool {\n         matches!(self.assignments[local], Set1::One(_))\n     }\n \n+    /// Returns true iff we can use `p` as a pointee.\n+    pub fn is_constant_place(&self, p: Place<'_>) -> bool {\n+        // We only allow `Deref` as the first projection, to avoid surprises.\n+        if p.projection.first() == Some(&PlaceElem::Deref) {\n+            // `p == (*some_local).xxx`, it is constant only if `some_local` is constant.\n+            // We approximate constness using SSAness.\n+            self.is_ssa(p.local) && p.projection[1..].iter().all(PlaceElem::is_stable_offset)\n+        } else {\n+            matches!(self.storage_live[p.local], Set1::One(_))\n+                && p.projection[..].iter().all(PlaceElem::is_stable_offset)\n+        }\n+    }\n+\n+    /// Return the number of uses if a local that are not \"Deref\".\n+    pub fn num_direct_uses(&self, local: Local) -> u32 {\n+        self.direct_uses[local]\n+    }\n+\n     pub fn assignments<'a, 'tcx>(\n         &'a self,\n         body: &'a Body<'tcx>,\n-    ) -> impl Iterator<Item = (Local, &'a Rvalue<'tcx>)> + 'a {\n+    ) -> impl Iterator<Item = (Local, &'a Rvalue<'tcx>, Location)> + 'a {\n         self.assignment_order.iter().filter_map(|&local| {\n             if let Set1::One(LocationExtended::Plain(loc)) = self.assignments[local] {\n                 // `loc` must point to a direct assignment to `local`.\n                 let Either::Left(stmt) = body.stmt_at(loc) else { bug!() };\n                 let Some((target, rvalue)) = stmt.kind.as_assign() else { bug!() };\n                 assert_eq!(target.as_local(), Some(local));\n-                Some((local, rvalue))\n+                Some((local, rvalue, loc))\n             } else {\n                 None\n             }\n@@ -177,25 +230,8 @@ struct SsaVisitor {\n     dominators: SmallDominators,\n     assignments: IndexVec<Local, Set1<LocationExtended>>,\n     assignment_order: Vec<Local>,\n-}\n-\n-impl SsaVisitor {\n-    fn check_assignment_dominates(&mut self, local: Local, loc: Location) {\n-        let set = &mut self.assignments[local];\n-        let assign_dominates = match *set {\n-            Set1::Empty | Set1::Many => false,\n-            Set1::One(LocationExtended::Arg) => true,\n-            Set1::One(LocationExtended::Plain(assign)) => {\n-                assign.successor_within_block().dominates(loc, &self.dominators)\n-            }\n-        };\n-        // We are visiting a use that is not dominated by an assignment.\n-        // Either there is a cycle involved, or we are reading for uninitialized local.\n-        // Bail out.\n-        if !assign_dominates {\n-            *set = Set1::Many;\n-        }\n-    }\n+    direct_uses: IndexVec<Local, u32>,\n+    storage_live: IndexVec<Local, Set1<LocationExtended>>,\n }\n \n impl<'tcx> Visitor<'tcx> for SsaVisitor {\n@@ -207,14 +243,23 @@ impl<'tcx> Visitor<'tcx> for SsaVisitor {\n                     // Only record if SSA-like, to avoid growing the vector needlessly.\n                     self.assignment_order.push(local);\n                 }\n+                self.dominators.check_dominates(&mut self.storage_live[local], loc);\n             }\n             // Anything can happen with raw pointers, so remove them.\n             PlaceContext::NonMutatingUse(NonMutatingUseContext::AddressOf)\n-            | PlaceContext::MutatingUse(_) => self.assignments[local] = Set1::Many,\n+            | PlaceContext::MutatingUse(_) => {\n+                self.assignments[local] = Set1::Many;\n+                self.dominators.check_dominates(&mut self.storage_live[local], loc);\n+            }\n             // Immutable borrows are taken into account in `SsaLocals::new` by\n             // removing non-freeze locals.\n             PlaceContext::NonMutatingUse(_) => {\n-                self.check_assignment_dominates(local, loc);\n+                self.dominators.check_dominates(&mut self.assignments[local], loc);\n+                self.dominators.check_dominates(&mut self.storage_live[local], loc);\n+                self.direct_uses[local] += 1;\n+            }\n+            PlaceContext::NonUse(NonUseContext::StorageLive) => {\n+                self.storage_live[local].insert(LocationExtended::Plain(loc));\n             }\n             PlaceContext::NonUse(_) => {}\n         }\n@@ -224,11 +269,12 @@ impl<'tcx> Visitor<'tcx> for SsaVisitor {\n         if place.projection.first() == Some(&PlaceElem::Deref) {\n             // Do not do anything for storage statements and debuginfo.\n             if ctxt.is_use() {\n-                // A use through a `deref` only reads from the local, and cannot write to it.\n+                // Only change the context if it is a real use, not a \"use\" in debuginfo.\n                 let new_ctxt = PlaceContext::NonMutatingUse(NonMutatingUseContext::Projection);\n \n                 self.visit_projection(place.as_ref(), new_ctxt, loc);\n-                self.check_assignment_dominates(place.local, loc);\n+                self.dominators.check_dominates(&mut self.assignments[place.local], loc);\n+                self.dominators.check_dominates(&mut self.storage_live[place.local], loc);\n             }\n             return;\n         }\n@@ -237,7 +283,7 @@ impl<'tcx> Visitor<'tcx> for SsaVisitor {\n }\n \n #[instrument(level = \"trace\", skip(ssa, body))]\n-fn compute_copy_classes(ssa: &SsaVisitor, body: &Body<'_>) -> IndexVec<Local, Local> {\n+fn compute_copy_classes(ssa: &mut SsaVisitor, body: &Body<'_>) -> IndexVec<Local, Local> {\n     let mut copies = IndexVec::from_fn_n(|l| l, body.local_decls.len());\n \n     for &local in &ssa.assignment_order {\n@@ -267,9 +313,11 @@ fn compute_copy_classes(ssa: &SsaVisitor, body: &Body<'_>) -> IndexVec<Local, Lo\n         // We visit in `assignment_order`, ie. reverse post-order, so `rhs` has been\n         // visited before `local`, and we just have to copy the representing local.\n         copies[local] = copies[rhs];\n+        ssa.direct_uses[rhs] -= 1;\n     }\n \n     debug!(?copies);\n+    debug!(?ssa.direct_uses);\n \n     // Invariant: `copies` must point to the head of an equivalence class.\n     #[cfg(debug_assertions)]"}, {"sha": "7e79e15ccdabc66c1d8e6401ca1d0b036fc3afb3", "filename": "tests/mir-opt/reference_prop.dominate_storage.ReferencePropagation.diff", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.dominate_storage.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.dominate_storage.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.dominate_storage.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,38 @@\n+- // MIR for `dominate_storage` before ReferencePropagation\n++ // MIR for `dominate_storage` after ReferencePropagation\n+  \n+  fn dominate_storage() -> () {\n+      let mut _0: ();                      // return place in scope 0 at $DIR/reference_prop.rs:+0:23: +0:23\n+      let mut _1: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _2: &i32;                    // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _3: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _4: bool;                    // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _5: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _6: bool;                    // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+  \n+      bb0: {\n+          goto -> bb1;                     // scope 0 at $DIR/reference_prop.rs:+8:11: +8:20\n+      }\n+  \n+      bb1: {\n+          _1 = const 5_i32;                // scope 0 at $DIR/reference_prop.rs:+10:13: +10:18\n+          _2 = &_1;                        // scope 0 at $DIR/reference_prop.rs:+11:13: +11:19\n+          goto -> bb2;                     // scope 0 at $DIR/reference_prop.rs:+12:13: +12:22\n+      }\n+  \n+      bb2: {\n+          _5 = (*_2);                      // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          _0 = opaque::<i32>(_5) -> bb3;   // scope 0 at $DIR/reference_prop.rs:+16:13: +16:38\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:357:28: 357:34\n+                                           // + literal: Const { ty: fn(i32) {opaque::<i32>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb3: {\n+          StorageDead(_1);                 // scope 0 at $DIR/reference_prop.rs:+19:13: +19:27\n+          StorageLive(_1);                 // scope 0 at $DIR/reference_prop.rs:+20:13: +20:27\n+          _6 = const true;                 // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          switchInt(_6) -> [0: bb3, otherwise: bb1]; // scope 0 at $DIR/reference_prop.rs:+22:13: +22:47\n+      }\n+  }\n+  "}, {"sha": "9dac0b333b819a269c5c3cb9b8baea2bbadca10a", "filename": "tests/mir-opt/reference_prop.maybe_dead.ReferencePropagation.diff", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.maybe_dead.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.maybe_dead.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.maybe_dead.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,50 @@\n+- // MIR for `maybe_dead` before ReferencePropagation\n++ // MIR for `maybe_dead` after ReferencePropagation\n+  \n+  fn maybe_dead(_1: bool) -> () {\n+      let mut _0: ();                      // return place in scope 0 at $DIR/reference_prop.rs:+0:24: +0:24\n+      let mut _2: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _3: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _4: &i32;                    // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _5: &mut i32;                // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _6: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _7: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+  \n+      bb0: {\n+          StorageLive(_2);                 // scope 0 at $DIR/reference_prop.rs:+7:13: +7:27\n+          StorageLive(_3);                 // scope 0 at $DIR/reference_prop.rs:+8:13: +8:27\n+          _2 = const 5_i32;                // scope 0 at $DIR/reference_prop.rs:+9:13: +9:18\n+          _3 = const 5_i32;                // scope 0 at $DIR/reference_prop.rs:+10:13: +10:18\n+          _4 = &_2;                        // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          _5 = &mut _3;                    // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          (*_5) = const 7_i32;             // scope 0 at $DIR/reference_prop.rs:+14:13: +14:19\n+          switchInt(_1) -> [1: bb1, otherwise: bb2]; // scope 0 at $DIR/reference_prop.rs:+15:13: +15:46\n+      }\n+  \n+      bb1: {\n+          StorageDead(_2);                 // scope 0 at $DIR/reference_prop.rs:+18:13: +18:27\n+          StorageDead(_3);                 // scope 0 at $DIR/reference_prop.rs:+19:13: +19:27\n+          goto -> bb2;                     // scope 0 at $DIR/reference_prop.rs:+20:13: +20:22\n+      }\n+  \n+      bb2: {\n+          _6 = (*_4);                      // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          _0 = opaque::<i32>(_6) -> bb3;   // scope 0 at $DIR/reference_prop.rs:+25:13: +25:38\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:394:28: 394:34\n+                                           // + literal: Const { ty: fn(i32) {opaque::<i32>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb3: {\n+          _7 = (*_5);                      // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          _0 = opaque::<i32>(_7) -> bb4;   // scope 0 at $DIR/reference_prop.rs:+31:13: +31:43\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:400:33: 400:39\n+                                           // + literal: Const { ty: fn(i32) {opaque::<i32>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb4: {\n+          return;                          // scope 0 at $DIR/reference_prop.rs:+34:13: +34:21\n+      }\n+  }\n+  "}, {"sha": "994791072e11ec1e4a03f027a1fb262d92b279bb", "filename": "tests/mir-opt/reference_prop.multiple_storage.ReferencePropagation.diff", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.multiple_storage.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.multiple_storage.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.multiple_storage.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,27 @@\n+- // MIR for `multiple_storage` before ReferencePropagation\n++ // MIR for `multiple_storage` after ReferencePropagation\n+  \n+  fn multiple_storage() -> () {\n+      let mut _0: ();                      // return place in scope 0 at $DIR/reference_prop.rs:+0:23: +0:23\n+      let mut _1: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _2: &i32;                    // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _3: i32;                     // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+  \n+      bb0: {\n+          StorageLive(_1);                 // scope 0 at $DIR/reference_prop.rs:+6:13: +6:27\n+          _1 = const 5_i32;                // scope 0 at $DIR/reference_prop.rs:+7:13: +7:18\n+          _2 = &_1;                        // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          StorageDead(_1);                 // scope 0 at $DIR/reference_prop.rs:+9:13: +9:27\n+          StorageLive(_1);                 // scope 0 at $DIR/reference_prop.rs:+10:13: +10:27\n+          _3 = (*_2);                      // scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+          _0 = opaque::<i32>(_3) -> bb1;   // scope 0 at $DIR/reference_prop.rs:+14:13: +14:43\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:331:33: 331:39\n+                                           // + literal: Const { ty: fn(i32) {opaque::<i32>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb1: {\n+          return;                          // scope 0 at $DIR/reference_prop.rs:+18:13: +18:21\n+      }\n+  }\n+  "}, {"sha": "a7d505c69066b4b3b187b4a1e2d4db07ba84285e", "filename": "tests/mir-opt/reference_prop.read_through_raw.ReferencePropagation.diff", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.read_through_raw.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.read_through_raw.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.read_through_raw.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,24 @@\n+- // MIR for `read_through_raw` before ReferencePropagation\n++ // MIR for `read_through_raw` after ReferencePropagation\n+  \n+  fn read_through_raw(_1: &mut usize) -> usize {\n+      let mut _0: usize;                   // return place in scope 0 at $DIR/reference_prop.rs:+0:39: +0:44\n+      let mut _2: &mut usize;              // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _3: &mut usize;              // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _4: *mut usize;              // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+      let mut _5: *mut usize;              // in scope 0 at $SRC_DIR/core/src/intrinsics/mir.rs:LL:COL\n+  \n+      bb0: {\n+          _2 = &mut (*_1);                 // scope 0 at $DIR/reference_prop.rs:+10:13: +10:25\n+-         _3 = &mut (*_2);                 // scope 0 at $DIR/reference_prop.rs:+11:13: +11:26\n+-         _4 = &raw mut (*_2);             // scope 0 at $DIR/reference_prop.rs:+12:13: +12:30\n+-         _5 = &raw mut (*_3);             // scope 0 at $DIR/reference_prop.rs:+13:13: +13:30\n+-         _0 = (*_4);                      // scope 0 at $DIR/reference_prop.rs:+15:13: +15:22\n+-         _0 = (*_5);                      // scope 0 at $DIR/reference_prop.rs:+16:13: +16:22\n++         _3 = &mut (*_1);                 // scope 0 at $DIR/reference_prop.rs:+11:13: +11:26\n++         _0 = (*_2);                      // scope 0 at $DIR/reference_prop.rs:+15:13: +15:22\n++         _0 = (*_3);                      // scope 0 at $DIR/reference_prop.rs:+16:13: +16:22\n+          return;                          // scope 0 at $DIR/reference_prop.rs:+17:13: +17:21\n+      }\n+  }\n+  "}, {"sha": "12aea890e63829be23bf4fe1b7fa033efae3df8f", "filename": "tests/mir-opt/reference_prop.reference_propagation.ReferencePropagation.diff", "status": "added", "additions": 292, "deletions": 0, "changes": 292, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.reference_propagation.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,292 @@\n+- // MIR for `reference_propagation` before ReferencePropagation\n++ // MIR for `reference_propagation` after ReferencePropagation\n+  \n+  fn reference_propagation(_1: &T, _2: &T) -> () {\n+      debug single => _1;                  // in scope 0 at $DIR/reference_prop.rs:+0:39: +0:45\n+      debug multiple => _2;                // in scope 0 at $DIR/reference_prop.rs:+0:54: +0:66\n+      let mut _0: ();                      // return place in scope 0 at $DIR/reference_prop.rs:+0:75: +0:75\n+      let _3: ();                          // in scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+      let _4: usize;                       // in scope 0 at $DIR/reference_prop.rs:+3:13: +3:14\n+      let _7: ();                          // in scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+      let _8: usize;                       // in scope 0 at $DIR/reference_prop.rs:+10:13: +10:14\n+      let mut _11: &usize;                 // in scope 0 at $DIR/reference_prop.rs:+13:13: +13:16\n+      let _12: &usize;                     // in scope 0 at $DIR/reference_prop.rs:+13:13: +13:16\n+      let _14: ();                         // in scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+      let _15: usize;                      // in scope 0 at $DIR/reference_prop.rs:+20:13: +20:14\n+      let _19: ();                         // in scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+      let _20: usize;                      // in scope 0 at $DIR/reference_prop.rs:+28:13: +28:14\n+      let _24: ();                         // in scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+      let _25: usize;                      // in scope 0 at $DIR/reference_prop.rs:+36:13: +36:14\n+      let _28: ();                         // in scope 0 at $DIR/reference_prop.rs:+39:9: +39:18\n+      let mut _29: &usize;                 // in scope 0 at $DIR/reference_prop.rs:+39:16: +39:17\n+      let _30: ();                         // in scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+      let _31: usize;                      // in scope 0 at $DIR/reference_prop.rs:+44:13: +44:14\n+      let _37: ();                         // in scope 0 at $DIR/reference_prop.rs:+52:9: +52:19\n+      let mut _38: &usize;                 // in scope 0 at $DIR/reference_prop.rs:+52:16: +52:18\n+      let _39: ();                         // in scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+      let _40: &T;                         // in scope 0 at $DIR/reference_prop.rs:+57:13: +57:14\n+      let _42: &T;                         // in scope 0 at $DIR/reference_prop.rs:+63:13: +63:14\n+      let mut _43: &T;                     // in scope 0 at $DIR/reference_prop.rs:+64:20: +64:28\n+      let _44: &T;                         // in scope 0 at $DIR/reference_prop.rs:+64:20: +64:28\n+      scope 1 {\n+          debug a => _4;                   // in scope 1 at $DIR/reference_prop.rs:+3:13: +3:14\n+          let _5: &usize;                  // in scope 1 at $DIR/reference_prop.rs:+4:13: +4:14\n+          scope 2 {\n+              debug b => _5;               // in scope 2 at $DIR/reference_prop.rs:+4:13: +4:14\n+              let _6: usize;               // in scope 2 at $DIR/reference_prop.rs:+5:13: +5:14\n+              scope 3 {\n+                  debug c => _6;           // in scope 3 at $DIR/reference_prop.rs:+5:13: +5:14\n+              }\n+          }\n+      }\n+      scope 4 {\n+          debug a => _8;                   // in scope 4 at $DIR/reference_prop.rs:+10:13: +10:14\n+          let _9: usize;                   // in scope 4 at $DIR/reference_prop.rs:+11:13: +11:15\n+          scope 5 {\n+              debug a2 => _9;              // in scope 5 at $DIR/reference_prop.rs:+11:13: +11:15\n+              let mut _10: &usize;         // in scope 5 at $DIR/reference_prop.rs:+12:13: +12:18\n+              scope 6 {\n+                  debug b => _10;          // in scope 6 at $DIR/reference_prop.rs:+12:13: +12:18\n+                  let _13: usize;          // in scope 6 at $DIR/reference_prop.rs:+15:13: +15:14\n+                  scope 7 {\n+                      debug c => _13;      // in scope 7 at $DIR/reference_prop.rs:+15:13: +15:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 8 {\n+          debug a => _15;                  // in scope 8 at $DIR/reference_prop.rs:+20:13: +20:14\n+          let _16: &usize;                 // in scope 8 at $DIR/reference_prop.rs:+21:13: +21:14\n+          scope 9 {\n+              debug b => _16;              // in scope 9 at $DIR/reference_prop.rs:+21:13: +21:14\n+              let _17: &&usize;            // in scope 9 at $DIR/reference_prop.rs:+22:13: +22:14\n+              scope 10 {\n+                  debug d => _17;          // in scope 10 at $DIR/reference_prop.rs:+22:13: +22:14\n+                  let _18: usize;          // in scope 10 at $DIR/reference_prop.rs:+23:13: +23:14\n+                  scope 11 {\n+                      debug c => _18;      // in scope 11 at $DIR/reference_prop.rs:+23:13: +23:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 12 {\n+          debug a => _20;                  // in scope 12 at $DIR/reference_prop.rs:+28:13: +28:14\n+          let mut _21: &usize;             // in scope 12 at $DIR/reference_prop.rs:+29:13: +29:18\n+          scope 13 {\n+              debug b => _21;              // in scope 13 at $DIR/reference_prop.rs:+29:13: +29:18\n+              let _22: &mut &usize;        // in scope 13 at $DIR/reference_prop.rs:+30:13: +30:14\n+              scope 14 {\n+                  debug d => _22;          // in scope 14 at $DIR/reference_prop.rs:+30:13: +30:14\n+                  let _23: usize;          // in scope 14 at $DIR/reference_prop.rs:+31:13: +31:14\n+                  scope 15 {\n+                      debug c => _23;      // in scope 15 at $DIR/reference_prop.rs:+31:13: +31:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 16 {\n+          debug a => _25;                  // in scope 16 at $DIR/reference_prop.rs:+36:13: +36:14\n+          let _26: &usize;                 // in scope 16 at $DIR/reference_prop.rs:+37:13: +37:14\n+          scope 17 {\n+              debug b => _26;              // in scope 17 at $DIR/reference_prop.rs:+37:13: +37:14\n+              let _27: usize;              // in scope 17 at $DIR/reference_prop.rs:+38:13: +38:14\n+              scope 18 {\n+                  debug c => _27;          // in scope 18 at $DIR/reference_prop.rs:+38:13: +38:14\n+              }\n+          }\n+      }\n+      scope 19 {\n+          debug a => _31;                  // in scope 19 at $DIR/reference_prop.rs:+44:13: +44:14\n+          let _32: &usize;                 // in scope 19 at $DIR/reference_prop.rs:+45:13: +45:15\n+          scope 20 {\n+              debug b1 => _32;             // in scope 20 at $DIR/reference_prop.rs:+45:13: +45:15\n+              let _33: usize;              // in scope 20 at $DIR/reference_prop.rs:+46:13: +46:14\n+              scope 21 {\n+                  debug c => _33;          // in scope 21 at $DIR/reference_prop.rs:+46:13: +46:14\n+                  let _34: &usize;         // in scope 21 at $DIR/reference_prop.rs:+47:13: +47:15\n+                  scope 22 {\n+                      debug b2 => _34;     // in scope 22 at $DIR/reference_prop.rs:+47:13: +47:15\n+                      let _35: usize;      // in scope 22 at $DIR/reference_prop.rs:+48:13: +48:15\n+                      scope 23 {\n+                          debug c2 => _35; // in scope 23 at $DIR/reference_prop.rs:+48:13: +48:15\n+                          let _36: &usize; // in scope 23 at $DIR/reference_prop.rs:+49:13: +49:15\n+                          scope 24 {\n+                              debug b3 => _36; // in scope 24 at $DIR/reference_prop.rs:+49:13: +49:15\n+                          }\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 25 {\n+          debug a => _40;                  // in scope 25 at $DIR/reference_prop.rs:+57:13: +57:14\n+          let _41: T;                      // in scope 25 at $DIR/reference_prop.rs:+58:13: +58:14\n+          scope 26 {\n+              debug b => _41;              // in scope 26 at $DIR/reference_prop.rs:+58:13: +58:14\n+          }\n+      }\n+      scope 27 {\n+          debug a => _42;                  // in scope 27 at $DIR/reference_prop.rs:+63:13: +63:14\n+          let _45: T;                      // in scope 27 at $DIR/reference_prop.rs:+65:13: +65:14\n+          scope 28 {\n+              debug b => _45;              // in scope 28 at $DIR/reference_prop.rs:+65:13: +65:14\n+          }\n+      }\n+  \n+      bb0: {\n+-         StorageLive(_3);                 // scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+          StorageLive(_4);                 // scope 0 at $DIR/reference_prop.rs:+3:13: +3:14\n+          _4 = const 5_usize;              // scope 0 at $DIR/reference_prop.rs:+3:17: +3:24\n+          StorageLive(_5);                 // scope 1 at $DIR/reference_prop.rs:+4:13: +4:14\n+          _5 = &_4;                        // scope 1 at $DIR/reference_prop.rs:+4:17: +4:19\n+          StorageLive(_6);                 // scope 2 at $DIR/reference_prop.rs:+5:13: +5:14\n+-         _6 = (*_5);                      // scope 2 at $DIR/reference_prop.rs:+5:17: +5:19\n+-         _3 = const ();                   // scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n++         _6 = _4;                         // scope 2 at $DIR/reference_prop.rs:+5:17: +5:19\n+          StorageDead(_6);                 // scope 2 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_5);                 // scope 1 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_4);                 // scope 0 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageDead(_3);                 // scope 0 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageLive(_7);                 // scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageLive(_8);                 // scope 0 at $DIR/reference_prop.rs:+10:13: +10:14\n+          _8 = const 5_usize;              // scope 0 at $DIR/reference_prop.rs:+10:17: +10:24\n+          StorageLive(_9);                 // scope 4 at $DIR/reference_prop.rs:+11:13: +11:15\n+          _9 = const 7_usize;              // scope 4 at $DIR/reference_prop.rs:+11:18: +11:25\n+          StorageLive(_10);                // scope 5 at $DIR/reference_prop.rs:+12:13: +12:18\n+          _10 = &_8;                       // scope 5 at $DIR/reference_prop.rs:+12:21: +12:23\n+          StorageLive(_11);                // scope 6 at $DIR/reference_prop.rs:+13:13: +13:16\n+-         StorageLive(_12);                // scope 6 at $DIR/reference_prop.rs:+13:13: +13:16\n+-         _12 = &_9;                       // scope 6 at $DIR/reference_prop.rs:+13:13: +13:16\n+-         _11 = &(*_12);                   // scope 6 at $DIR/reference_prop.rs:+13:13: +13:16\n++         _11 = &_9;                       // scope 6 at $DIR/reference_prop.rs:+13:13: +13:16\n+          _10 = move _11;                  // scope 6 at $DIR/reference_prop.rs:+13:9: +13:16\n+          StorageDead(_11);                // scope 6 at $DIR/reference_prop.rs:+13:15: +13:16\n+-         StorageDead(_12);                // scope 6 at $DIR/reference_prop.rs:+13:16: +13:17\n+          StorageLive(_13);                // scope 6 at $DIR/reference_prop.rs:+15:13: +15:14\n+          _13 = (*_10);                    // scope 6 at $DIR/reference_prop.rs:+15:17: +15:19\n+-         _7 = const ();                   // scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageDead(_13);                // scope 6 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_10);                // scope 5 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_9);                 // scope 4 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_8);                 // scope 0 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageDead(_7);                 // scope 0 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageLive(_14);                // scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+          StorageLive(_15);                // scope 0 at $DIR/reference_prop.rs:+20:13: +20:14\n+          _15 = const 5_usize;             // scope 0 at $DIR/reference_prop.rs:+20:17: +20:24\n+          StorageLive(_16);                // scope 8 at $DIR/reference_prop.rs:+21:13: +21:14\n+          _16 = &_15;                      // scope 8 at $DIR/reference_prop.rs:+21:17: +21:19\n+          StorageLive(_17);                // scope 9 at $DIR/reference_prop.rs:+22:13: +22:14\n+          _17 = &_16;                      // scope 9 at $DIR/reference_prop.rs:+22:17: +22:19\n+          StorageLive(_18);                // scope 10 at $DIR/reference_prop.rs:+23:13: +23:14\n+-         _18 = (*_16);                    // scope 10 at $DIR/reference_prop.rs:+23:17: +23:19\n+-         _14 = const ();                  // scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n++         _18 = _15;                       // scope 10 at $DIR/reference_prop.rs:+23:17: +23:19\n+          StorageDead(_18);                // scope 10 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_17);                // scope 9 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_16);                // scope 8 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_15);                // scope 0 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageDead(_14);                // scope 0 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageLive(_19);                // scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageLive(_20);                // scope 0 at $DIR/reference_prop.rs:+28:13: +28:14\n+          _20 = const 5_usize;             // scope 0 at $DIR/reference_prop.rs:+28:17: +28:24\n+          StorageLive(_21);                // scope 12 at $DIR/reference_prop.rs:+29:13: +29:18\n+          _21 = &_20;                      // scope 12 at $DIR/reference_prop.rs:+29:21: +29:23\n+          StorageLive(_22);                // scope 13 at $DIR/reference_prop.rs:+30:13: +30:14\n+          _22 = &mut _21;                  // scope 13 at $DIR/reference_prop.rs:+30:17: +30:23\n+          StorageLive(_23);                // scope 14 at $DIR/reference_prop.rs:+31:13: +31:14\n+          _23 = (*_21);                    // scope 14 at $DIR/reference_prop.rs:+31:17: +31:19\n+-         _19 = const ();                  // scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageDead(_23);                // scope 14 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_22);                // scope 13 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_21);                // scope 12 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_20);                // scope 0 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageDead(_19);                // scope 0 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageLive(_24);                // scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageLive(_25);                // scope 0 at $DIR/reference_prop.rs:+36:13: +36:14\n+          _25 = const 7_usize;             // scope 0 at $DIR/reference_prop.rs:+36:17: +36:24\n+          StorageLive(_26);                // scope 16 at $DIR/reference_prop.rs:+37:13: +37:14\n+          _26 = &_25;                      // scope 16 at $DIR/reference_prop.rs:+37:17: +37:19\n+          StorageLive(_27);                // scope 17 at $DIR/reference_prop.rs:+38:13: +38:14\n+-         _27 = (*_26);                    // scope 17 at $DIR/reference_prop.rs:+38:17: +38:19\n++         _27 = _25;                       // scope 17 at $DIR/reference_prop.rs:+38:17: +38:19\n+          StorageLive(_28);                // scope 18 at $DIR/reference_prop.rs:+39:9: +39:18\n+          StorageLive(_29);                // scope 18 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _29 = _26;                       // scope 18 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _28 = opaque::<&usize>(move _29) -> bb1; // scope 18 at $DIR/reference_prop.rs:+39:9: +39:18\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:48:9: 48:15\n+                                           // + literal: Const { ty: fn(&usize) {opaque::<&usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb1: {\n+          StorageDead(_29);                // scope 18 at $DIR/reference_prop.rs:+39:17: +39:18\n+          StorageDead(_28);                // scope 18 at $DIR/reference_prop.rs:+39:18: +39:19\n+-         _24 = const ();                  // scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageDead(_27);                // scope 17 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_26);                // scope 16 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_25);                // scope 0 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageDead(_24);                // scope 0 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageLive(_30);                // scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageLive(_31);                // scope 0 at $DIR/reference_prop.rs:+44:13: +44:14\n+          _31 = const 7_usize;             // scope 0 at $DIR/reference_prop.rs:+44:17: +44:24\n+          StorageLive(_32);                // scope 19 at $DIR/reference_prop.rs:+45:13: +45:15\n+          _32 = &_31;                      // scope 19 at $DIR/reference_prop.rs:+45:18: +45:20\n+          StorageLive(_33);                // scope 20 at $DIR/reference_prop.rs:+46:13: +46:14\n+-         _33 = (*_32);                    // scope 20 at $DIR/reference_prop.rs:+46:17: +46:20\n++         _33 = _31;                       // scope 20 at $DIR/reference_prop.rs:+46:17: +46:20\n+          StorageLive(_34);                // scope 21 at $DIR/reference_prop.rs:+47:13: +47:15\n+          _34 = _32;                       // scope 21 at $DIR/reference_prop.rs:+47:18: +47:20\n+          StorageLive(_35);                // scope 22 at $DIR/reference_prop.rs:+48:13: +48:15\n+-         _35 = (*_34);                    // scope 22 at $DIR/reference_prop.rs:+48:18: +48:21\n++         _35 = _31;                       // scope 22 at $DIR/reference_prop.rs:+48:18: +48:21\n+          StorageLive(_36);                // scope 23 at $DIR/reference_prop.rs:+49:13: +49:15\n+          _36 = _34;                       // scope 23 at $DIR/reference_prop.rs:+49:18: +49:20\n+          StorageLive(_37);                // scope 24 at $DIR/reference_prop.rs:+52:9: +52:19\n+          StorageLive(_38);                // scope 24 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _38 = _36;                       // scope 24 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _37 = opaque::<&usize>(move _38) -> bb2; // scope 24 at $DIR/reference_prop.rs:+52:9: +52:19\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:61:9: 61:15\n+                                           // + literal: Const { ty: fn(&usize) {opaque::<&usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb2: {\n+          StorageDead(_38);                // scope 24 at $DIR/reference_prop.rs:+52:18: +52:19\n+          StorageDead(_37);                // scope 24 at $DIR/reference_prop.rs:+52:19: +52:20\n+-         _30 = const ();                  // scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageDead(_36);                // scope 23 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_35);                // scope 22 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_34);                // scope 21 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_33);                // scope 20 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_32);                // scope 19 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_31);                // scope 0 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageDead(_30);                // scope 0 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageLive(_39);                // scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+          StorageLive(_40);                // scope 0 at $DIR/reference_prop.rs:+57:13: +57:14\n+          _40 = &(*_1);                    // scope 0 at $DIR/reference_prop.rs:+57:17: +57:25\n+          StorageLive(_41);                // scope 25 at $DIR/reference_prop.rs:+58:13: +58:14\n+-         _41 = (*_40);                    // scope 25 at $DIR/reference_prop.rs:+58:17: +58:19\n+-         _39 = const ();                  // scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n++         _41 = (*_1);                     // scope 25 at $DIR/reference_prop.rs:+58:17: +58:19\n+          StorageDead(_41);                // scope 25 at $DIR/reference_prop.rs:+59:5: +59:6\n+          StorageDead(_40);                // scope 0 at $DIR/reference_prop.rs:+59:5: +59:6\n+-         StorageDead(_39);                // scope 0 at $DIR/reference_prop.rs:+59:5: +59:6\n+          StorageLive(_42);                // scope 0 at $DIR/reference_prop.rs:+63:13: +63:14\n+          _42 = &(*_2);                    // scope 0 at $DIR/reference_prop.rs:+63:17: +63:27\n+          StorageLive(_43);                // scope 27 at $DIR/reference_prop.rs:+64:20: +64:28\n+-         StorageLive(_44);                // scope 27 at $DIR/reference_prop.rs:+64:20: +64:28\n+-         _44 = &(*_1);                    // scope 27 at $DIR/reference_prop.rs:+64:20: +64:28\n+-         _43 = &(*_44);                   // scope 27 at $DIR/reference_prop.rs:+64:20: +64:28\n++         _43 = &(*_1);                    // scope 27 at $DIR/reference_prop.rs:+64:20: +64:28\n+          _2 = move _43;                   // scope 27 at $DIR/reference_prop.rs:+64:9: +64:28\n+          StorageDead(_43);                // scope 27 at $DIR/reference_prop.rs:+64:27: +64:28\n+-         StorageDead(_44);                // scope 27 at $DIR/reference_prop.rs:+64:28: +64:29\n+          StorageLive(_45);                // scope 27 at $DIR/reference_prop.rs:+65:13: +65:14\n+          _45 = (*_42);                    // scope 27 at $DIR/reference_prop.rs:+65:17: +65:19\n+          _0 = const ();                   // scope 0 at $DIR/reference_prop.rs:+62:5: +66:6\n+          StorageDead(_45);                // scope 27 at $DIR/reference_prop.rs:+66:5: +66:6\n+          StorageDead(_42);                // scope 0 at $DIR/reference_prop.rs:+66:5: +66:6\n+          return;                          // scope 0 at $DIR/reference_prop.rs:+67:2: +67:2\n+      }\n+  }\n+  "}, {"sha": "2e6097af2c98a8f05f1fcc794b4456568c69f3d6", "filename": "tests/mir-opt/reference_prop.reference_propagation_const_ptr.ReferencePropagation.diff", "status": "added", "additions": 334, "deletions": 0, "changes": 334, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation_const_ptr.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation_const_ptr.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.reference_propagation_const_ptr.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,334 @@\n+- // MIR for `reference_propagation_const_ptr` before ReferencePropagation\n++ // MIR for `reference_propagation_const_ptr` after ReferencePropagation\n+  \n+  fn reference_propagation_const_ptr(_1: *const T, _2: *const T) -> () {\n+      debug single => _1;                  // in scope 0 at $DIR/reference_prop.rs:+0:45: +0:51\n+      debug multiple => _2;                // in scope 0 at $DIR/reference_prop.rs:+0:63: +0:75\n+      let mut _0: ();                      // return place in scope 0 at $DIR/reference_prop.rs:+0:87: +0:87\n+      let _3: ();                          // in scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+      let _7: ();                          // in scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+      let mut _11: *const usize;           // in scope 0 at $DIR/reference_prop.rs:+13:13: +13:26\n+      let _13: ();                         // in scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+      let _18: ();                         // in scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+      let _23: ();                         // in scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+      let _27: ();                         // in scope 0 at $DIR/reference_prop.rs:+39:9: +39:18\n+      let mut _28: *const usize;           // in scope 0 at $DIR/reference_prop.rs:+39:16: +39:17\n+      let _29: ();                         // in scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+      let _36: ();                         // in scope 0 at $DIR/reference_prop.rs:+52:9: +52:19\n+      let mut _37: *const usize;           // in scope 0 at $DIR/reference_prop.rs:+52:16: +52:18\n+      let _38: ();                         // in scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+      let _41: ();                         // in scope 0 at $DIR/reference_prop.rs:+62:5: +66:6\n+      let mut _43: *const T;               // in scope 0 at $DIR/reference_prop.rs:+64:20: +64:38\n+      scope 1 {\n+          let _4: usize;                   // in scope 1 at $DIR/reference_prop.rs:+3:13: +3:14\n+          scope 2 {\n+              debug a => _4;               // in scope 2 at $DIR/reference_prop.rs:+3:13: +3:14\n+              let _5: *const usize;        // in scope 2 at $DIR/reference_prop.rs:+4:13: +4:14\n+              scope 3 {\n+                  debug b => _5;           // in scope 3 at $DIR/reference_prop.rs:+4:13: +4:14\n+                  let _6: usize;           // in scope 3 at $DIR/reference_prop.rs:+5:13: +5:14\n+                  scope 4 {\n+                      debug c => _6;       // in scope 4 at $DIR/reference_prop.rs:+5:13: +5:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 5 {\n+          let _8: usize;                   // in scope 5 at $DIR/reference_prop.rs:+10:13: +10:14\n+          scope 6 {\n+              debug a => _8;               // in scope 6 at $DIR/reference_prop.rs:+10:13: +10:14\n+              let _9: usize;               // in scope 6 at $DIR/reference_prop.rs:+11:13: +11:15\n+              scope 7 {\n+                  debug a2 => _9;          // in scope 7 at $DIR/reference_prop.rs:+11:13: +11:15\n+                  let mut _10: *const usize; // in scope 7 at $DIR/reference_prop.rs:+12:13: +12:18\n+                  scope 8 {\n+                      debug b => _10;      // in scope 8 at $DIR/reference_prop.rs:+12:13: +12:18\n+                      let _12: usize;      // in scope 8 at $DIR/reference_prop.rs:+15:13: +15:14\n+                      scope 9 {\n+                          debug c => _12;  // in scope 9 at $DIR/reference_prop.rs:+15:13: +15:14\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 10 {\n+          let _14: usize;                  // in scope 10 at $DIR/reference_prop.rs:+20:13: +20:14\n+          scope 11 {\n+              debug a => _14;              // in scope 11 at $DIR/reference_prop.rs:+20:13: +20:14\n+              let _15: *const usize;       // in scope 11 at $DIR/reference_prop.rs:+21:13: +21:14\n+              scope 12 {\n+                  debug b => _15;          // in scope 12 at $DIR/reference_prop.rs:+21:13: +21:14\n+                  let _16: &*const usize;  // in scope 12 at $DIR/reference_prop.rs:+22:13: +22:14\n+                  scope 13 {\n+                      debug d => _16;      // in scope 13 at $DIR/reference_prop.rs:+22:13: +22:14\n+                      let _17: usize;      // in scope 13 at $DIR/reference_prop.rs:+23:13: +23:14\n+                      scope 14 {\n+                          debug c => _17;  // in scope 14 at $DIR/reference_prop.rs:+23:13: +23:14\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 15 {\n+          let _19: usize;                  // in scope 15 at $DIR/reference_prop.rs:+28:13: +28:14\n+          scope 16 {\n+              debug a => _19;              // in scope 16 at $DIR/reference_prop.rs:+28:13: +28:14\n+              let mut _20: *const usize;   // in scope 16 at $DIR/reference_prop.rs:+29:13: +29:18\n+              scope 17 {\n+                  debug b => _20;          // in scope 17 at $DIR/reference_prop.rs:+29:13: +29:18\n+                  let _21: &mut *const usize; // in scope 17 at $DIR/reference_prop.rs:+30:13: +30:14\n+                  scope 18 {\n+                      debug d => _21;      // in scope 18 at $DIR/reference_prop.rs:+30:13: +30:14\n+                      let _22: usize;      // in scope 18 at $DIR/reference_prop.rs:+31:13: +31:14\n+                      scope 19 {\n+                          debug c => _22;  // in scope 19 at $DIR/reference_prop.rs:+31:13: +31:14\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 20 {\n+          let _24: usize;                  // in scope 20 at $DIR/reference_prop.rs:+36:13: +36:14\n+          scope 21 {\n+              debug a => _24;              // in scope 21 at $DIR/reference_prop.rs:+36:13: +36:14\n+              let _25: *const usize;       // in scope 21 at $DIR/reference_prop.rs:+37:13: +37:14\n+              scope 22 {\n+                  debug b => _25;          // in scope 22 at $DIR/reference_prop.rs:+37:13: +37:14\n+                  let _26: usize;          // in scope 22 at $DIR/reference_prop.rs:+38:13: +38:14\n+                  scope 23 {\n+                      debug c => _26;      // in scope 23 at $DIR/reference_prop.rs:+38:13: +38:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 24 {\n+          let _30: usize;                  // in scope 24 at $DIR/reference_prop.rs:+44:13: +44:14\n+          scope 25 {\n+              debug a => _30;              // in scope 25 at $DIR/reference_prop.rs:+44:13: +44:14\n+              let _31: *const usize;       // in scope 25 at $DIR/reference_prop.rs:+45:13: +45:15\n+              scope 26 {\n+                  debug b1 => _31;         // in scope 26 at $DIR/reference_prop.rs:+45:13: +45:15\n+                  let _32: usize;          // in scope 26 at $DIR/reference_prop.rs:+46:13: +46:14\n+                  scope 27 {\n+                      debug c => _32;      // in scope 27 at $DIR/reference_prop.rs:+46:13: +46:14\n+                      let _33: *const usize; // in scope 27 at $DIR/reference_prop.rs:+47:13: +47:15\n+                      scope 28 {\n+                          debug b2 => _33; // in scope 28 at $DIR/reference_prop.rs:+47:13: +47:15\n+                          let _34: usize;  // in scope 28 at $DIR/reference_prop.rs:+48:13: +48:15\n+                          scope 29 {\n+                              debug c2 => _34; // in scope 29 at $DIR/reference_prop.rs:+48:13: +48:15\n+                              let _35: *const usize; // in scope 29 at $DIR/reference_prop.rs:+49:13: +49:15\n+                              scope 30 {\n+                                  debug b3 => _35; // in scope 30 at $DIR/reference_prop.rs:+49:13: +49:15\n+                              }\n+                          }\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 31 {\n+          let _39: *const T;               // in scope 31 at $DIR/reference_prop.rs:+57:13: +57:14\n+          scope 32 {\n+              debug a => _39;              // in scope 32 at $DIR/reference_prop.rs:+57:13: +57:14\n+              let _40: T;                  // in scope 32 at $DIR/reference_prop.rs:+58:13: +58:14\n+              scope 33 {\n+                  debug b => _40;          // in scope 33 at $DIR/reference_prop.rs:+58:13: +58:14\n+              }\n+          }\n+      }\n+      scope 34 {\n+          let _42: *const T;               // in scope 34 at $DIR/reference_prop.rs:+63:13: +63:14\n+          scope 35 {\n+              debug a => _42;              // in scope 35 at $DIR/reference_prop.rs:+63:13: +63:14\n+              let _44: T;                  // in scope 35 at $DIR/reference_prop.rs:+65:13: +65:14\n+              scope 36 {\n+                  debug b => _44;          // in scope 36 at $DIR/reference_prop.rs:+65:13: +65:14\n+              }\n+          }\n+      }\n+      scope 37 {\n+          let _45: usize;                  // in scope 37 at $DIR/reference_prop.rs:+70:13: +70:14\n+          scope 38 {\n+              debug a => _45;              // in scope 38 at $DIR/reference_prop.rs:+70:13: +70:14\n+              let _46: *const usize;       // in scope 38 at $DIR/reference_prop.rs:+71:13: +71:14\n+              scope 39 {\n+                  debug b => _46;          // in scope 39 at $DIR/reference_prop.rs:+71:13: +71:14\n+                  let _47: *const usize;   // in scope 39 at $DIR/reference_prop.rs:+72:13: +72:14\n+                  scope 40 {\n+                      debug c => _47;      // in scope 40 at $DIR/reference_prop.rs:+72:13: +72:14\n+                      let _48: usize;      // in scope 40 at $DIR/reference_prop.rs:+73:13: +73:14\n+                      scope 41 {\n+                          debug e => _48;  // in scope 41 at $DIR/reference_prop.rs:+73:13: +73:14\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+  \n+      bb0: {\n+-         StorageLive(_3);                 // scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+          StorageLive(_4);                 // scope 1 at $DIR/reference_prop.rs:+3:13: +3:14\n+          _4 = const 5_usize;              // scope 1 at $DIR/reference_prop.rs:+3:17: +3:24\n+          StorageLive(_5);                 // scope 2 at $DIR/reference_prop.rs:+4:13: +4:14\n+          _5 = &raw const _4;              // scope 2 at $DIR/reference_prop.rs:+4:17: +4:29\n+          StorageLive(_6);                 // scope 3 at $DIR/reference_prop.rs:+5:13: +5:14\n+-         _6 = (*_5);                      // scope 3 at $DIR/reference_prop.rs:+5:17: +5:19\n+-         _3 = const ();                   // scope 1 at $DIR/reference_prop.rs:+2:5: +6:6\n++         _6 = _4;                         // scope 3 at $DIR/reference_prop.rs:+5:17: +5:19\n+          StorageDead(_6);                 // scope 3 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_5);                 // scope 2 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_4);                 // scope 1 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageDead(_3);                 // scope 0 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageLive(_7);                 // scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageLive(_8);                 // scope 5 at $DIR/reference_prop.rs:+10:13: +10:14\n+          _8 = const 5_usize;              // scope 5 at $DIR/reference_prop.rs:+10:17: +10:24\n+          StorageLive(_9);                 // scope 6 at $DIR/reference_prop.rs:+11:13: +11:15\n+          _9 = const 7_usize;              // scope 6 at $DIR/reference_prop.rs:+11:18: +11:25\n+          StorageLive(_10);                // scope 7 at $DIR/reference_prop.rs:+12:13: +12:18\n+          _10 = &raw const _8;             // scope 7 at $DIR/reference_prop.rs:+12:21: +12:33\n+          StorageLive(_11);                // scope 8 at $DIR/reference_prop.rs:+13:13: +13:26\n+          _11 = &raw const _9;             // scope 8 at $DIR/reference_prop.rs:+13:13: +13:26\n+          _10 = move _11;                  // scope 8 at $DIR/reference_prop.rs:+13:9: +13:26\n+          StorageDead(_11);                // scope 8 at $DIR/reference_prop.rs:+13:25: +13:26\n+          StorageLive(_12);                // scope 8 at $DIR/reference_prop.rs:+15:13: +15:14\n+          _12 = (*_10);                    // scope 8 at $DIR/reference_prop.rs:+15:17: +15:19\n+-         _7 = const ();                   // scope 5 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageDead(_12);                // scope 8 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_10);                // scope 7 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_9);                 // scope 6 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_8);                 // scope 5 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageDead(_7);                 // scope 0 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageLive(_13);                // scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+          StorageLive(_14);                // scope 10 at $DIR/reference_prop.rs:+20:13: +20:14\n+          _14 = const 5_usize;             // scope 10 at $DIR/reference_prop.rs:+20:17: +20:24\n+          StorageLive(_15);                // scope 11 at $DIR/reference_prop.rs:+21:13: +21:14\n+          _15 = &raw const _14;            // scope 11 at $DIR/reference_prop.rs:+21:17: +21:29\n+          StorageLive(_16);                // scope 12 at $DIR/reference_prop.rs:+22:13: +22:14\n+          _16 = &_15;                      // scope 12 at $DIR/reference_prop.rs:+22:17: +22:19\n+          StorageLive(_17);                // scope 13 at $DIR/reference_prop.rs:+23:13: +23:14\n+-         _17 = (*_15);                    // scope 13 at $DIR/reference_prop.rs:+23:17: +23:19\n+-         _13 = const ();                  // scope 10 at $DIR/reference_prop.rs:+19:5: +24:6\n++         _17 = _14;                       // scope 13 at $DIR/reference_prop.rs:+23:17: +23:19\n+          StorageDead(_17);                // scope 13 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_16);                // scope 12 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_15);                // scope 11 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_14);                // scope 10 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageDead(_13);                // scope 0 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageLive(_18);                // scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageLive(_19);                // scope 15 at $DIR/reference_prop.rs:+28:13: +28:14\n+          _19 = const 5_usize;             // scope 15 at $DIR/reference_prop.rs:+28:17: +28:24\n+          StorageLive(_20);                // scope 16 at $DIR/reference_prop.rs:+29:13: +29:18\n+          _20 = &raw const _19;            // scope 16 at $DIR/reference_prop.rs:+29:21: +29:33\n+          StorageLive(_21);                // scope 17 at $DIR/reference_prop.rs:+30:13: +30:14\n+          _21 = &mut _20;                  // scope 17 at $DIR/reference_prop.rs:+30:17: +30:23\n+          StorageLive(_22);                // scope 18 at $DIR/reference_prop.rs:+31:13: +31:14\n+          _22 = (*_20);                    // scope 18 at $DIR/reference_prop.rs:+31:17: +31:19\n+-         _18 = const ();                  // scope 15 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageDead(_22);                // scope 18 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_21);                // scope 17 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_20);                // scope 16 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_19);                // scope 15 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageDead(_18);                // scope 0 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageLive(_23);                // scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageLive(_24);                // scope 20 at $DIR/reference_prop.rs:+36:13: +36:14\n+          _24 = const 7_usize;             // scope 20 at $DIR/reference_prop.rs:+36:17: +36:24\n+          StorageLive(_25);                // scope 21 at $DIR/reference_prop.rs:+37:13: +37:14\n+          _25 = &raw const _24;            // scope 21 at $DIR/reference_prop.rs:+37:17: +37:29\n+          StorageLive(_26);                // scope 22 at $DIR/reference_prop.rs:+38:13: +38:14\n+-         _26 = (*_25);                    // scope 22 at $DIR/reference_prop.rs:+38:17: +38:19\n++         _26 = _24;                       // scope 22 at $DIR/reference_prop.rs:+38:17: +38:19\n+          StorageLive(_27);                // scope 23 at $DIR/reference_prop.rs:+39:9: +39:18\n+          StorageLive(_28);                // scope 23 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _28 = _25;                       // scope 23 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _27 = opaque::<*const usize>(move _28) -> bb1; // scope 23 at $DIR/reference_prop.rs:+39:9: +39:18\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:186:9: 186:15\n+                                           // + literal: Const { ty: fn(*const usize) {opaque::<*const usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb1: {\n+          StorageDead(_28);                // scope 23 at $DIR/reference_prop.rs:+39:17: +39:18\n+          StorageDead(_27);                // scope 23 at $DIR/reference_prop.rs:+39:18: +39:19\n+-         _23 = const ();                  // scope 20 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageDead(_26);                // scope 22 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_25);                // scope 21 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_24);                // scope 20 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageDead(_23);                // scope 0 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageLive(_29);                // scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageLive(_30);                // scope 24 at $DIR/reference_prop.rs:+44:13: +44:14\n+          _30 = const 7_usize;             // scope 24 at $DIR/reference_prop.rs:+44:17: +44:24\n+          StorageLive(_31);                // scope 25 at $DIR/reference_prop.rs:+45:13: +45:15\n+          _31 = &raw const _30;            // scope 25 at $DIR/reference_prop.rs:+45:18: +45:30\n+          StorageLive(_32);                // scope 26 at $DIR/reference_prop.rs:+46:13: +46:14\n+-         _32 = (*_31);                    // scope 26 at $DIR/reference_prop.rs:+46:17: +46:20\n++         _32 = _30;                       // scope 26 at $DIR/reference_prop.rs:+46:17: +46:20\n+          StorageLive(_33);                // scope 27 at $DIR/reference_prop.rs:+47:13: +47:15\n+          _33 = _31;                       // scope 27 at $DIR/reference_prop.rs:+47:18: +47:20\n+          StorageLive(_34);                // scope 28 at $DIR/reference_prop.rs:+48:13: +48:15\n+-         _34 = (*_33);                    // scope 28 at $DIR/reference_prop.rs:+48:18: +48:21\n++         _34 = _30;                       // scope 28 at $DIR/reference_prop.rs:+48:18: +48:21\n+          StorageLive(_35);                // scope 29 at $DIR/reference_prop.rs:+49:13: +49:15\n+          _35 = _33;                       // scope 29 at $DIR/reference_prop.rs:+49:18: +49:20\n+          StorageLive(_36);                // scope 30 at $DIR/reference_prop.rs:+52:9: +52:19\n+          StorageLive(_37);                // scope 30 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _37 = _35;                       // scope 30 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _36 = opaque::<*const usize>(move _37) -> bb2; // scope 30 at $DIR/reference_prop.rs:+52:9: +52:19\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:199:9: 199:15\n+                                           // + literal: Const { ty: fn(*const usize) {opaque::<*const usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb2: {\n+          StorageDead(_37);                // scope 30 at $DIR/reference_prop.rs:+52:18: +52:19\n+          StorageDead(_36);                // scope 30 at $DIR/reference_prop.rs:+52:19: +52:20\n+-         _29 = const ();                  // scope 24 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageDead(_35);                // scope 29 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_34);                // scope 28 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_33);                // scope 27 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_32);                // scope 26 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_31);                // scope 25 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_30);                // scope 24 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageDead(_29);                // scope 0 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageLive(_38);                // scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+          StorageLive(_39);                // scope 31 at $DIR/reference_prop.rs:+57:13: +57:14\n+          _39 = &raw const (*_1);          // scope 31 at $DIR/reference_prop.rs:+57:17: +57:35\n+          StorageLive(_40);                // scope 32 at $DIR/reference_prop.rs:+58:13: +58:14\n+-         _40 = (*_39);                    // scope 32 at $DIR/reference_prop.rs:+58:17: +58:19\n+-         _38 = const ();                  // scope 31 at $DIR/reference_prop.rs:+56:5: +59:6\n++         _40 = (*_1);                     // scope 32 at $DIR/reference_prop.rs:+58:17: +58:19\n+          StorageDead(_40);                // scope 32 at $DIR/reference_prop.rs:+59:5: +59:6\n+          StorageDead(_39);                // scope 31 at $DIR/reference_prop.rs:+59:5: +59:6\n+-         StorageDead(_38);                // scope 0 at $DIR/reference_prop.rs:+59:5: +59:6\n+-         StorageLive(_41);                // scope 0 at $DIR/reference_prop.rs:+62:5: +66:6\n+          StorageLive(_42);                // scope 34 at $DIR/reference_prop.rs:+63:13: +63:14\n+          _42 = &raw const (*_2);          // scope 34 at $DIR/reference_prop.rs:+63:17: +63:37\n+          StorageLive(_43);                // scope 35 at $DIR/reference_prop.rs:+64:20: +64:38\n+          _43 = &raw const (*_1);          // scope 35 at $DIR/reference_prop.rs:+64:20: +64:38\n+          _2 = move _43;                   // scope 35 at $DIR/reference_prop.rs:+64:9: +64:38\n+          StorageDead(_43);                // scope 35 at $DIR/reference_prop.rs:+64:37: +64:38\n+          StorageLive(_44);                // scope 35 at $DIR/reference_prop.rs:+65:13: +65:14\n+          _44 = (*_42);                    // scope 35 at $DIR/reference_prop.rs:+65:17: +65:19\n+-         _41 = const ();                  // scope 34 at $DIR/reference_prop.rs:+62:5: +66:6\n+          StorageDead(_44);                // scope 35 at $DIR/reference_prop.rs:+66:5: +66:6\n+          StorageDead(_42);                // scope 34 at $DIR/reference_prop.rs:+66:5: +66:6\n+-         StorageDead(_41);                // scope 0 at $DIR/reference_prop.rs:+66:5: +66:6\n+          StorageLive(_45);                // scope 37 at $DIR/reference_prop.rs:+70:13: +70:14\n+          _45 = const 13_usize;            // scope 37 at $DIR/reference_prop.rs:+70:17: +70:25\n+          StorageLive(_46);                // scope 38 at $DIR/reference_prop.rs:+71:13: +71:14\n+          _46 = &raw const _45;            // scope 38 at $DIR/reference_prop.rs:+71:17: +71:29\n+          StorageLive(_47);                // scope 39 at $DIR/reference_prop.rs:+72:13: +72:14\n+-         _47 = &raw const (*_46);         // scope 39 at $DIR/reference_prop.rs:+72:17: +72:30\n++         _47 = &raw const _45;            // scope 39 at $DIR/reference_prop.rs:+72:17: +72:30\n+          StorageLive(_48);                // scope 40 at $DIR/reference_prop.rs:+73:13: +73:14\n+-         _48 = (*_47);                    // scope 40 at $DIR/reference_prop.rs:+73:17: +73:19\n++         _48 = _45;                       // scope 40 at $DIR/reference_prop.rs:+73:17: +73:19\n+          _0 = const ();                   // scope 37 at $DIR/reference_prop.rs:+69:5: +74:6\n+          StorageDead(_48);                // scope 40 at $DIR/reference_prop.rs:+74:5: +74:6\n+          StorageDead(_47);                // scope 39 at $DIR/reference_prop.rs:+74:5: +74:6\n+          StorageDead(_46);                // scope 38 at $DIR/reference_prop.rs:+74:5: +74:6\n+          StorageDead(_45);                // scope 37 at $DIR/reference_prop.rs:+74:5: +74:6\n+          return;                          // scope 0 at $DIR/reference_prop.rs:+75:2: +75:2\n+      }\n+  }\n+  "}, {"sha": "f7bbd2a03f90dfe51ef80525022daff41119b547", "filename": "tests/mir-opt/reference_prop.reference_propagation_mut.ReferencePropagation.diff", "status": "added", "additions": 288, "deletions": 0, "changes": 288, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation_mut.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation_mut.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.reference_propagation_mut.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,288 @@\n+- // MIR for `reference_propagation_mut` before ReferencePropagation\n++ // MIR for `reference_propagation_mut` after ReferencePropagation\n+  \n+  fn reference_propagation_mut(_1: &mut T, _2: &mut T) -> () {\n+      debug single => _1;                  // in scope 0 at $DIR/reference_prop.rs:+0:43: +0:49\n+      debug multiple => _2;                // in scope 0 at $DIR/reference_prop.rs:+0:62: +0:74\n+      let mut _0: ();                      // return place in scope 0 at $DIR/reference_prop.rs:+0:87: +0:87\n+      let _3: ();                          // in scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+      let mut _4: usize;                   // in scope 0 at $DIR/reference_prop.rs:+3:13: +3:18\n+      let _7: ();                          // in scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+      let mut _8: usize;                   // in scope 0 at $DIR/reference_prop.rs:+10:13: +10:18\n+      let mut _11: &mut usize;             // in scope 0 at $DIR/reference_prop.rs:+13:13: +13:20\n+      let mut _12: &mut usize;             // in scope 0 at $DIR/reference_prop.rs:+13:13: +13:20\n+      let _14: ();                         // in scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+      let mut _15: usize;                  // in scope 0 at $DIR/reference_prop.rs:+20:13: +20:18\n+      let _19: ();                         // in scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+      let mut _20: usize;                  // in scope 0 at $DIR/reference_prop.rs:+28:13: +28:18\n+      let _24: ();                         // in scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+      let mut _25: usize;                  // in scope 0 at $DIR/reference_prop.rs:+36:13: +36:18\n+      let _28: ();                         // in scope 0 at $DIR/reference_prop.rs:+39:9: +39:18\n+      let mut _29: &mut usize;             // in scope 0 at $DIR/reference_prop.rs:+39:16: +39:17\n+      let _30: ();                         // in scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+      let mut _31: usize;                  // in scope 0 at $DIR/reference_prop.rs:+44:13: +44:18\n+      let _37: ();                         // in scope 0 at $DIR/reference_prop.rs:+52:9: +52:19\n+      let mut _38: &mut usize;             // in scope 0 at $DIR/reference_prop.rs:+52:16: +52:18\n+      let _39: ();                         // in scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+      let _40: &mut T;                     // in scope 0 at $DIR/reference_prop.rs:+57:13: +57:14\n+      let _42: &mut T;                     // in scope 0 at $DIR/reference_prop.rs:+63:13: +63:14\n+      let mut _43: &mut T;                 // in scope 0 at $DIR/reference_prop.rs:+64:20: +64:32\n+      let mut _44: &mut T;                 // in scope 0 at $DIR/reference_prop.rs:+64:20: +64:32\n+      scope 1 {\n+          debug a => _4;                   // in scope 1 at $DIR/reference_prop.rs:+3:13: +3:18\n+          let _5: &mut usize;              // in scope 1 at $DIR/reference_prop.rs:+4:13: +4:14\n+          scope 2 {\n+              debug b => _5;               // in scope 2 at $DIR/reference_prop.rs:+4:13: +4:14\n+              let _6: usize;               // in scope 2 at $DIR/reference_prop.rs:+5:13: +5:14\n+              scope 3 {\n+                  debug c => _6;           // in scope 3 at $DIR/reference_prop.rs:+5:13: +5:14\n+              }\n+          }\n+      }\n+      scope 4 {\n+          debug a => _8;                   // in scope 4 at $DIR/reference_prop.rs:+10:13: +10:18\n+          let mut _9: usize;               // in scope 4 at $DIR/reference_prop.rs:+11:13: +11:19\n+          scope 5 {\n+              debug a2 => _9;              // in scope 5 at $DIR/reference_prop.rs:+11:13: +11:19\n+              let mut _10: &mut usize;     // in scope 5 at $DIR/reference_prop.rs:+12:13: +12:18\n+              scope 6 {\n+                  debug b => _10;          // in scope 6 at $DIR/reference_prop.rs:+12:13: +12:18\n+                  let _13: usize;          // in scope 6 at $DIR/reference_prop.rs:+15:13: +15:14\n+                  scope 7 {\n+                      debug c => _13;      // in scope 7 at $DIR/reference_prop.rs:+15:13: +15:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 8 {\n+          debug a => _15;                  // in scope 8 at $DIR/reference_prop.rs:+20:13: +20:18\n+          let _16: &mut usize;             // in scope 8 at $DIR/reference_prop.rs:+21:13: +21:14\n+          scope 9 {\n+              debug b => _16;              // in scope 9 at $DIR/reference_prop.rs:+21:13: +21:14\n+              let _17: &&mut usize;        // in scope 9 at $DIR/reference_prop.rs:+22:13: +22:14\n+              scope 10 {\n+                  debug d => _17;          // in scope 10 at $DIR/reference_prop.rs:+22:13: +22:14\n+                  let _18: usize;          // in scope 10 at $DIR/reference_prop.rs:+23:13: +23:14\n+                  scope 11 {\n+                      debug c => _18;      // in scope 11 at $DIR/reference_prop.rs:+23:13: +23:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 12 {\n+          debug a => _20;                  // in scope 12 at $DIR/reference_prop.rs:+28:13: +28:18\n+          let mut _21: &mut usize;         // in scope 12 at $DIR/reference_prop.rs:+29:13: +29:18\n+          scope 13 {\n+              debug b => _21;              // in scope 13 at $DIR/reference_prop.rs:+29:13: +29:18\n+              let _22: &mut &mut usize;    // in scope 13 at $DIR/reference_prop.rs:+30:13: +30:14\n+              scope 14 {\n+                  debug d => _22;          // in scope 14 at $DIR/reference_prop.rs:+30:13: +30:14\n+                  let _23: usize;          // in scope 14 at $DIR/reference_prop.rs:+31:13: +31:14\n+                  scope 15 {\n+                      debug c => _23;      // in scope 15 at $DIR/reference_prop.rs:+31:13: +31:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 16 {\n+          debug a => _25;                  // in scope 16 at $DIR/reference_prop.rs:+36:13: +36:18\n+          let _26: &mut usize;             // in scope 16 at $DIR/reference_prop.rs:+37:13: +37:14\n+          scope 17 {\n+              debug b => _26;              // in scope 17 at $DIR/reference_prop.rs:+37:13: +37:14\n+              let _27: usize;              // in scope 17 at $DIR/reference_prop.rs:+38:13: +38:14\n+              scope 18 {\n+                  debug c => _27;          // in scope 18 at $DIR/reference_prop.rs:+38:13: +38:14\n+              }\n+          }\n+      }\n+      scope 19 {\n+          debug a => _31;                  // in scope 19 at $DIR/reference_prop.rs:+44:13: +44:18\n+          let _32: &mut usize;             // in scope 19 at $DIR/reference_prop.rs:+45:13: +45:15\n+          scope 20 {\n+              debug b1 => _32;             // in scope 20 at $DIR/reference_prop.rs:+45:13: +45:15\n+              let _33: usize;              // in scope 20 at $DIR/reference_prop.rs:+46:13: +46:14\n+              scope 21 {\n+                  debug c => _33;          // in scope 21 at $DIR/reference_prop.rs:+46:13: +46:14\n+                  let _34: &mut usize;     // in scope 21 at $DIR/reference_prop.rs:+47:13: +47:15\n+                  scope 22 {\n+                      debug b2 => _34;     // in scope 22 at $DIR/reference_prop.rs:+47:13: +47:15\n+                      let _35: usize;      // in scope 22 at $DIR/reference_prop.rs:+48:13: +48:15\n+                      scope 23 {\n+                          debug c2 => _35; // in scope 23 at $DIR/reference_prop.rs:+48:13: +48:15\n+                          let _36: &mut usize; // in scope 23 at $DIR/reference_prop.rs:+49:13: +49:15\n+                          scope 24 {\n+                              debug b3 => _36; // in scope 24 at $DIR/reference_prop.rs:+49:13: +49:15\n+                          }\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 25 {\n+          debug a => _40;                  // in scope 25 at $DIR/reference_prop.rs:+57:13: +57:14\n+          let _41: T;                      // in scope 25 at $DIR/reference_prop.rs:+58:13: +58:14\n+          scope 26 {\n+              debug b => _41;              // in scope 26 at $DIR/reference_prop.rs:+58:13: +58:14\n+          }\n+      }\n+      scope 27 {\n+          debug a => _42;                  // in scope 27 at $DIR/reference_prop.rs:+63:13: +63:14\n+          let _45: T;                      // in scope 27 at $DIR/reference_prop.rs:+65:13: +65:14\n+          scope 28 {\n+              debug b => _45;              // in scope 28 at $DIR/reference_prop.rs:+65:13: +65:14\n+          }\n+      }\n+  \n+      bb0: {\n+-         StorageLive(_3);                 // scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+          StorageLive(_4);                 // scope 0 at $DIR/reference_prop.rs:+3:13: +3:18\n+          _4 = const 5_usize;              // scope 0 at $DIR/reference_prop.rs:+3:21: +3:28\n+          StorageLive(_5);                 // scope 1 at $DIR/reference_prop.rs:+4:13: +4:14\n+          _5 = &mut _4;                    // scope 1 at $DIR/reference_prop.rs:+4:17: +4:23\n+          StorageLive(_6);                 // scope 2 at $DIR/reference_prop.rs:+5:13: +5:14\n+-         _6 = (*_5);                      // scope 2 at $DIR/reference_prop.rs:+5:17: +5:19\n+-         _3 = const ();                   // scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n++         _6 = _4;                         // scope 2 at $DIR/reference_prop.rs:+5:17: +5:19\n+          StorageDead(_6);                 // scope 2 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_5);                 // scope 1 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_4);                 // scope 0 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageDead(_3);                 // scope 0 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageLive(_7);                 // scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageLive(_8);                 // scope 0 at $DIR/reference_prop.rs:+10:13: +10:18\n+          _8 = const 5_usize;              // scope 0 at $DIR/reference_prop.rs:+10:21: +10:28\n+          StorageLive(_9);                 // scope 4 at $DIR/reference_prop.rs:+11:13: +11:19\n+          _9 = const 7_usize;              // scope 4 at $DIR/reference_prop.rs:+11:22: +11:29\n+          StorageLive(_10);                // scope 5 at $DIR/reference_prop.rs:+12:13: +12:18\n+          _10 = &mut _8;                   // scope 5 at $DIR/reference_prop.rs:+12:21: +12:27\n+          StorageLive(_11);                // scope 6 at $DIR/reference_prop.rs:+13:13: +13:20\n+-         StorageLive(_12);                // scope 6 at $DIR/reference_prop.rs:+13:13: +13:20\n+-         _12 = &mut _9;                   // scope 6 at $DIR/reference_prop.rs:+13:13: +13:20\n+-         _11 = &mut (*_12);               // scope 6 at $DIR/reference_prop.rs:+13:13: +13:20\n++         _11 = &mut _9;                   // scope 6 at $DIR/reference_prop.rs:+13:13: +13:20\n+          _10 = move _11;                  // scope 6 at $DIR/reference_prop.rs:+13:9: +13:20\n+          StorageDead(_11);                // scope 6 at $DIR/reference_prop.rs:+13:19: +13:20\n+-         StorageDead(_12);                // scope 6 at $DIR/reference_prop.rs:+13:20: +13:21\n+          StorageLive(_13);                // scope 6 at $DIR/reference_prop.rs:+15:13: +15:14\n+          _13 = (*_10);                    // scope 6 at $DIR/reference_prop.rs:+15:17: +15:19\n+-         _7 = const ();                   // scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageDead(_13);                // scope 6 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_10);                // scope 5 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_9);                 // scope 4 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_8);                 // scope 0 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageDead(_7);                 // scope 0 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageLive(_14);                // scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+          StorageLive(_15);                // scope 0 at $DIR/reference_prop.rs:+20:13: +20:18\n+          _15 = const 5_usize;             // scope 0 at $DIR/reference_prop.rs:+20:21: +20:28\n+          StorageLive(_16);                // scope 8 at $DIR/reference_prop.rs:+21:13: +21:14\n+          _16 = &mut _15;                  // scope 8 at $DIR/reference_prop.rs:+21:17: +21:23\n+          StorageLive(_17);                // scope 9 at $DIR/reference_prop.rs:+22:13: +22:14\n+          _17 = &_16;                      // scope 9 at $DIR/reference_prop.rs:+22:17: +22:19\n+          StorageLive(_18);                // scope 10 at $DIR/reference_prop.rs:+23:13: +23:14\n+          _18 = (*_16);                    // scope 10 at $DIR/reference_prop.rs:+23:17: +23:19\n+-         _14 = const ();                  // scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+          StorageDead(_18);                // scope 10 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_17);                // scope 9 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_16);                // scope 8 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_15);                // scope 0 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageDead(_14);                // scope 0 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageLive(_19);                // scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageLive(_20);                // scope 0 at $DIR/reference_prop.rs:+28:13: +28:18\n+          _20 = const 5_usize;             // scope 0 at $DIR/reference_prop.rs:+28:21: +28:28\n+          StorageLive(_21);                // scope 12 at $DIR/reference_prop.rs:+29:13: +29:18\n+          _21 = &mut _20;                  // scope 12 at $DIR/reference_prop.rs:+29:21: +29:27\n+          StorageLive(_22);                // scope 13 at $DIR/reference_prop.rs:+30:13: +30:14\n+          _22 = &mut _21;                  // scope 13 at $DIR/reference_prop.rs:+30:17: +30:23\n+          StorageLive(_23);                // scope 14 at $DIR/reference_prop.rs:+31:13: +31:14\n+          _23 = (*_21);                    // scope 14 at $DIR/reference_prop.rs:+31:17: +31:19\n+-         _19 = const ();                  // scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageDead(_23);                // scope 14 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_22);                // scope 13 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_21);                // scope 12 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_20);                // scope 0 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageDead(_19);                // scope 0 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageLive(_24);                // scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageLive(_25);                // scope 0 at $DIR/reference_prop.rs:+36:13: +36:18\n+          _25 = const 7_usize;             // scope 0 at $DIR/reference_prop.rs:+36:21: +36:28\n+          StorageLive(_26);                // scope 16 at $DIR/reference_prop.rs:+37:13: +37:14\n+          _26 = &mut _25;                  // scope 16 at $DIR/reference_prop.rs:+37:17: +37:23\n+          StorageLive(_27);                // scope 17 at $DIR/reference_prop.rs:+38:13: +38:14\n+          _27 = (*_26);                    // scope 17 at $DIR/reference_prop.rs:+38:17: +38:19\n+          StorageLive(_28);                // scope 18 at $DIR/reference_prop.rs:+39:9: +39:18\n+          StorageLive(_29);                // scope 18 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _29 = move _26;                  // scope 18 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _28 = opaque::<&mut usize>(move _29) -> bb1; // scope 18 at $DIR/reference_prop.rs:+39:9: +39:18\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:117:9: 117:15\n+                                           // + literal: Const { ty: fn(&mut usize) {opaque::<&mut usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb1: {\n+          StorageDead(_29);                // scope 18 at $DIR/reference_prop.rs:+39:17: +39:18\n+          StorageDead(_28);                // scope 18 at $DIR/reference_prop.rs:+39:18: +39:19\n+-         _24 = const ();                  // scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageDead(_27);                // scope 17 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_26);                // scope 16 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_25);                // scope 0 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageDead(_24);                // scope 0 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageLive(_30);                // scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageLive(_31);                // scope 0 at $DIR/reference_prop.rs:+44:13: +44:18\n+          _31 = const 7_usize;             // scope 0 at $DIR/reference_prop.rs:+44:21: +44:28\n+          StorageLive(_32);                // scope 19 at $DIR/reference_prop.rs:+45:13: +45:15\n+          _32 = &mut _31;                  // scope 19 at $DIR/reference_prop.rs:+45:18: +45:24\n+          StorageLive(_33);                // scope 20 at $DIR/reference_prop.rs:+46:13: +46:14\n+          _33 = (*_32);                    // scope 20 at $DIR/reference_prop.rs:+46:17: +46:20\n+          StorageLive(_34);                // scope 21 at $DIR/reference_prop.rs:+47:13: +47:15\n+          _34 = move _32;                  // scope 21 at $DIR/reference_prop.rs:+47:18: +47:20\n+          StorageLive(_35);                // scope 22 at $DIR/reference_prop.rs:+48:13: +48:15\n+          _35 = (*_34);                    // scope 22 at $DIR/reference_prop.rs:+48:18: +48:21\n+          StorageLive(_36);                // scope 23 at $DIR/reference_prop.rs:+49:13: +49:15\n+          _36 = move _34;                  // scope 23 at $DIR/reference_prop.rs:+49:18: +49:20\n+          StorageLive(_37);                // scope 24 at $DIR/reference_prop.rs:+52:9: +52:19\n+          StorageLive(_38);                // scope 24 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _38 = move _36;                  // scope 24 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _37 = opaque::<&mut usize>(move _38) -> bb2; // scope 24 at $DIR/reference_prop.rs:+52:9: +52:19\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:130:9: 130:15\n+                                           // + literal: Const { ty: fn(&mut usize) {opaque::<&mut usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb2: {\n+          StorageDead(_38);                // scope 24 at $DIR/reference_prop.rs:+52:18: +52:19\n+          StorageDead(_37);                // scope 24 at $DIR/reference_prop.rs:+52:19: +52:20\n+-         _30 = const ();                  // scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageDead(_36);                // scope 23 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_35);                // scope 22 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_34);                // scope 21 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_33);                // scope 20 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_32);                // scope 19 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_31);                // scope 0 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageDead(_30);                // scope 0 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageLive(_39);                // scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+          StorageLive(_40);                // scope 0 at $DIR/reference_prop.rs:+57:13: +57:14\n+          _40 = &mut (*_1);                // scope 0 at $DIR/reference_prop.rs:+57:17: +57:29\n+          StorageLive(_41);                // scope 25 at $DIR/reference_prop.rs:+58:13: +58:14\n+-         _41 = (*_40);                    // scope 25 at $DIR/reference_prop.rs:+58:17: +58:19\n+-         _39 = const ();                  // scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n++         _41 = (*_1);                     // scope 25 at $DIR/reference_prop.rs:+58:17: +58:19\n+          StorageDead(_41);                // scope 25 at $DIR/reference_prop.rs:+59:5: +59:6\n+          StorageDead(_40);                // scope 0 at $DIR/reference_prop.rs:+59:5: +59:6\n+-         StorageDead(_39);                // scope 0 at $DIR/reference_prop.rs:+59:5: +59:6\n+          StorageLive(_42);                // scope 0 at $DIR/reference_prop.rs:+63:13: +63:14\n+          _42 = &mut (*_2);                // scope 0 at $DIR/reference_prop.rs:+63:17: +63:31\n+          StorageLive(_43);                // scope 27 at $DIR/reference_prop.rs:+64:20: +64:32\n+-         StorageLive(_44);                // scope 27 at $DIR/reference_prop.rs:+64:20: +64:32\n+-         _44 = &mut (*_1);                // scope 27 at $DIR/reference_prop.rs:+64:20: +64:32\n+-         _43 = &mut (*_44);               // scope 27 at $DIR/reference_prop.rs:+64:20: +64:32\n++         _43 = &mut (*_1);                // scope 27 at $DIR/reference_prop.rs:+64:20: +64:32\n+          _2 = move _43;                   // scope 27 at $DIR/reference_prop.rs:+64:9: +64:32\n+          StorageDead(_43);                // scope 27 at $DIR/reference_prop.rs:+64:31: +64:32\n+-         StorageDead(_44);                // scope 27 at $DIR/reference_prop.rs:+64:32: +64:33\n+          StorageLive(_45);                // scope 27 at $DIR/reference_prop.rs:+65:13: +65:14\n+          _45 = (*_42);                    // scope 27 at $DIR/reference_prop.rs:+65:17: +65:19\n+          _0 = const ();                   // scope 0 at $DIR/reference_prop.rs:+62:5: +66:6\n+          StorageDead(_45);                // scope 27 at $DIR/reference_prop.rs:+66:5: +66:6\n+          StorageDead(_42);                // scope 0 at $DIR/reference_prop.rs:+66:5: +66:6\n+          return;                          // scope 0 at $DIR/reference_prop.rs:+67:2: +67:2\n+      }\n+  }\n+  "}, {"sha": "235964e953665e908e364acc6881a8ec5fe8b0db", "filename": "tests/mir-opt/reference_prop.reference_propagation_mut_ptr.ReferencePropagation.diff", "status": "added", "additions": 294, "deletions": 0, "changes": 294, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation_mut_ptr.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.reference_propagation_mut_ptr.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.reference_propagation_mut_ptr.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,294 @@\n+- // MIR for `reference_propagation_mut_ptr` before ReferencePropagation\n++ // MIR for `reference_propagation_mut_ptr` after ReferencePropagation\n+  \n+  fn reference_propagation_mut_ptr(_1: *mut T, _2: *mut T) -> () {\n+      debug single => _1;                  // in scope 0 at $DIR/reference_prop.rs:+0:43: +0:49\n+      debug multiple => _2;                // in scope 0 at $DIR/reference_prop.rs:+0:59: +0:71\n+      let mut _0: ();                      // return place in scope 0 at $DIR/reference_prop.rs:+0:81: +0:81\n+      let _3: ();                          // in scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+      let _7: ();                          // in scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+      let mut _11: *mut usize;             // in scope 0 at $DIR/reference_prop.rs:+13:13: +13:24\n+      let _13: ();                         // in scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+      let _18: ();                         // in scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+      let _23: ();                         // in scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+      let _27: ();                         // in scope 0 at $DIR/reference_prop.rs:+39:9: +39:18\n+      let mut _28: *mut usize;             // in scope 0 at $DIR/reference_prop.rs:+39:16: +39:17\n+      let _29: ();                         // in scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+      let _36: ();                         // in scope 0 at $DIR/reference_prop.rs:+52:9: +52:19\n+      let mut _37: *mut usize;             // in scope 0 at $DIR/reference_prop.rs:+52:16: +52:18\n+      let _38: ();                         // in scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+      let mut _42: *mut T;                 // in scope 0 at $DIR/reference_prop.rs:+64:20: +64:36\n+      scope 1 {\n+          let mut _4: usize;               // in scope 1 at $DIR/reference_prop.rs:+3:13: +3:18\n+          scope 2 {\n+              debug a => _4;               // in scope 2 at $DIR/reference_prop.rs:+3:13: +3:18\n+              let _5: *mut usize;          // in scope 2 at $DIR/reference_prop.rs:+4:13: +4:14\n+              scope 3 {\n+                  debug b => _5;           // in scope 3 at $DIR/reference_prop.rs:+4:13: +4:14\n+                  let _6: usize;           // in scope 3 at $DIR/reference_prop.rs:+5:13: +5:14\n+                  scope 4 {\n+                      debug c => _6;       // in scope 4 at $DIR/reference_prop.rs:+5:13: +5:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 5 {\n+          let mut _8: usize;               // in scope 5 at $DIR/reference_prop.rs:+10:13: +10:18\n+          scope 6 {\n+              debug a => _8;               // in scope 6 at $DIR/reference_prop.rs:+10:13: +10:18\n+              let mut _9: usize;           // in scope 6 at $DIR/reference_prop.rs:+11:13: +11:19\n+              scope 7 {\n+                  debug a2 => _9;          // in scope 7 at $DIR/reference_prop.rs:+11:13: +11:19\n+                  let mut _10: *mut usize; // in scope 7 at $DIR/reference_prop.rs:+12:13: +12:18\n+                  scope 8 {\n+                      debug b => _10;      // in scope 8 at $DIR/reference_prop.rs:+12:13: +12:18\n+                      let _12: usize;      // in scope 8 at $DIR/reference_prop.rs:+15:13: +15:14\n+                      scope 9 {\n+                          debug c => _12;  // in scope 9 at $DIR/reference_prop.rs:+15:13: +15:14\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 10 {\n+          let mut _14: usize;              // in scope 10 at $DIR/reference_prop.rs:+20:13: +20:18\n+          scope 11 {\n+              debug a => _14;              // in scope 11 at $DIR/reference_prop.rs:+20:13: +20:18\n+              let _15: *mut usize;         // in scope 11 at $DIR/reference_prop.rs:+21:13: +21:14\n+              scope 12 {\n+                  debug b => _15;          // in scope 12 at $DIR/reference_prop.rs:+21:13: +21:14\n+                  let _16: &*mut usize;    // in scope 12 at $DIR/reference_prop.rs:+22:13: +22:14\n+                  scope 13 {\n+                      debug d => _16;      // in scope 13 at $DIR/reference_prop.rs:+22:13: +22:14\n+                      let _17: usize;      // in scope 13 at $DIR/reference_prop.rs:+23:13: +23:14\n+                      scope 14 {\n+                          debug c => _17;  // in scope 14 at $DIR/reference_prop.rs:+23:13: +23:14\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 15 {\n+          let mut _19: usize;              // in scope 15 at $DIR/reference_prop.rs:+28:13: +28:18\n+          scope 16 {\n+              debug a => _19;              // in scope 16 at $DIR/reference_prop.rs:+28:13: +28:18\n+              let mut _20: *mut usize;     // in scope 16 at $DIR/reference_prop.rs:+29:13: +29:18\n+              scope 17 {\n+                  debug b => _20;          // in scope 17 at $DIR/reference_prop.rs:+29:13: +29:18\n+                  let _21: &mut *mut usize; // in scope 17 at $DIR/reference_prop.rs:+30:13: +30:14\n+                  scope 18 {\n+                      debug d => _21;      // in scope 18 at $DIR/reference_prop.rs:+30:13: +30:14\n+                      let _22: usize;      // in scope 18 at $DIR/reference_prop.rs:+31:13: +31:14\n+                      scope 19 {\n+                          debug c => _22;  // in scope 19 at $DIR/reference_prop.rs:+31:13: +31:14\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 20 {\n+          let mut _24: usize;              // in scope 20 at $DIR/reference_prop.rs:+36:13: +36:18\n+          scope 21 {\n+              debug a => _24;              // in scope 21 at $DIR/reference_prop.rs:+36:13: +36:18\n+              let _25: *mut usize;         // in scope 21 at $DIR/reference_prop.rs:+37:13: +37:14\n+              scope 22 {\n+                  debug b => _25;          // in scope 22 at $DIR/reference_prop.rs:+37:13: +37:14\n+                  let _26: usize;          // in scope 22 at $DIR/reference_prop.rs:+38:13: +38:14\n+                  scope 23 {\n+                      debug c => _26;      // in scope 23 at $DIR/reference_prop.rs:+38:13: +38:14\n+                  }\n+              }\n+          }\n+      }\n+      scope 24 {\n+          let mut _30: usize;              // in scope 24 at $DIR/reference_prop.rs:+44:13: +44:18\n+          scope 25 {\n+              debug a => _30;              // in scope 25 at $DIR/reference_prop.rs:+44:13: +44:18\n+              let _31: *mut usize;         // in scope 25 at $DIR/reference_prop.rs:+45:13: +45:15\n+              scope 26 {\n+                  debug b1 => _31;         // in scope 26 at $DIR/reference_prop.rs:+45:13: +45:15\n+                  let _32: usize;          // in scope 26 at $DIR/reference_prop.rs:+46:13: +46:14\n+                  scope 27 {\n+                      debug c => _32;      // in scope 27 at $DIR/reference_prop.rs:+46:13: +46:14\n+                      let _33: *mut usize; // in scope 27 at $DIR/reference_prop.rs:+47:13: +47:15\n+                      scope 28 {\n+                          debug b2 => _33; // in scope 28 at $DIR/reference_prop.rs:+47:13: +47:15\n+                          let _34: usize;  // in scope 28 at $DIR/reference_prop.rs:+48:13: +48:15\n+                          scope 29 {\n+                              debug c2 => _34; // in scope 29 at $DIR/reference_prop.rs:+48:13: +48:15\n+                              let _35: *mut usize; // in scope 29 at $DIR/reference_prop.rs:+49:13: +49:15\n+                              scope 30 {\n+                                  debug b3 => _35; // in scope 30 at $DIR/reference_prop.rs:+49:13: +49:15\n+                              }\n+                          }\n+                      }\n+                  }\n+              }\n+          }\n+      }\n+      scope 31 {\n+          let _39: *mut T;                 // in scope 31 at $DIR/reference_prop.rs:+57:13: +57:14\n+          scope 32 {\n+              debug a => _39;              // in scope 32 at $DIR/reference_prop.rs:+57:13: +57:14\n+              let _40: T;                  // in scope 32 at $DIR/reference_prop.rs:+58:13: +58:14\n+              scope 33 {\n+                  debug b => _40;          // in scope 33 at $DIR/reference_prop.rs:+58:13: +58:14\n+              }\n+          }\n+      }\n+      scope 34 {\n+          let _41: *mut T;                 // in scope 34 at $DIR/reference_prop.rs:+63:13: +63:14\n+          scope 35 {\n+              debug a => _41;              // in scope 35 at $DIR/reference_prop.rs:+63:13: +63:14\n+              let _43: T;                  // in scope 35 at $DIR/reference_prop.rs:+65:13: +65:14\n+              scope 36 {\n+                  debug b => _43;          // in scope 36 at $DIR/reference_prop.rs:+65:13: +65:14\n+              }\n+          }\n+      }\n+  \n+      bb0: {\n+-         StorageLive(_3);                 // scope 0 at $DIR/reference_prop.rs:+2:5: +6:6\n+          StorageLive(_4);                 // scope 1 at $DIR/reference_prop.rs:+3:13: +3:18\n+          _4 = const 5_usize;              // scope 1 at $DIR/reference_prop.rs:+3:21: +3:28\n+          StorageLive(_5);                 // scope 2 at $DIR/reference_prop.rs:+4:13: +4:14\n+          _5 = &raw mut _4;                // scope 2 at $DIR/reference_prop.rs:+4:17: +4:27\n+          StorageLive(_6);                 // scope 3 at $DIR/reference_prop.rs:+5:13: +5:14\n+-         _6 = (*_5);                      // scope 3 at $DIR/reference_prop.rs:+5:17: +5:19\n+-         _3 = const ();                   // scope 1 at $DIR/reference_prop.rs:+2:5: +6:6\n++         _6 = _4;                         // scope 3 at $DIR/reference_prop.rs:+5:17: +5:19\n+          StorageDead(_6);                 // scope 3 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_5);                 // scope 2 at $DIR/reference_prop.rs:+6:5: +6:6\n+          StorageDead(_4);                 // scope 1 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageDead(_3);                 // scope 0 at $DIR/reference_prop.rs:+6:5: +6:6\n+-         StorageLive(_7);                 // scope 0 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageLive(_8);                 // scope 5 at $DIR/reference_prop.rs:+10:13: +10:18\n+          _8 = const 5_usize;              // scope 5 at $DIR/reference_prop.rs:+10:21: +10:28\n+          StorageLive(_9);                 // scope 6 at $DIR/reference_prop.rs:+11:13: +11:19\n+          _9 = const 7_usize;              // scope 6 at $DIR/reference_prop.rs:+11:22: +11:29\n+          StorageLive(_10);                // scope 7 at $DIR/reference_prop.rs:+12:13: +12:18\n+          _10 = &raw mut _8;               // scope 7 at $DIR/reference_prop.rs:+12:21: +12:31\n+          StorageLive(_11);                // scope 8 at $DIR/reference_prop.rs:+13:13: +13:24\n+          _11 = &raw mut _9;               // scope 8 at $DIR/reference_prop.rs:+13:13: +13:24\n+          _10 = move _11;                  // scope 8 at $DIR/reference_prop.rs:+13:9: +13:24\n+          StorageDead(_11);                // scope 8 at $DIR/reference_prop.rs:+13:23: +13:24\n+          StorageLive(_12);                // scope 8 at $DIR/reference_prop.rs:+15:13: +15:14\n+          _12 = (*_10);                    // scope 8 at $DIR/reference_prop.rs:+15:17: +15:19\n+-         _7 = const ();                   // scope 5 at $DIR/reference_prop.rs:+9:5: +16:6\n+          StorageDead(_12);                // scope 8 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_10);                // scope 7 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_9);                 // scope 6 at $DIR/reference_prop.rs:+16:5: +16:6\n+          StorageDead(_8);                 // scope 5 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageDead(_7);                 // scope 0 at $DIR/reference_prop.rs:+16:5: +16:6\n+-         StorageLive(_13);                // scope 0 at $DIR/reference_prop.rs:+19:5: +24:6\n+          StorageLive(_14);                // scope 10 at $DIR/reference_prop.rs:+20:13: +20:18\n+          _14 = const 5_usize;             // scope 10 at $DIR/reference_prop.rs:+20:21: +20:28\n+          StorageLive(_15);                // scope 11 at $DIR/reference_prop.rs:+21:13: +21:14\n+          _15 = &raw mut _14;              // scope 11 at $DIR/reference_prop.rs:+21:17: +21:27\n+          StorageLive(_16);                // scope 12 at $DIR/reference_prop.rs:+22:13: +22:14\n+          _16 = &_15;                      // scope 12 at $DIR/reference_prop.rs:+22:17: +22:19\n+          StorageLive(_17);                // scope 13 at $DIR/reference_prop.rs:+23:13: +23:14\n+          _17 = (*_15);                    // scope 13 at $DIR/reference_prop.rs:+23:17: +23:19\n+-         _13 = const ();                  // scope 10 at $DIR/reference_prop.rs:+19:5: +24:6\n+          StorageDead(_17);                // scope 13 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_16);                // scope 12 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_15);                // scope 11 at $DIR/reference_prop.rs:+24:5: +24:6\n+          StorageDead(_14);                // scope 10 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageDead(_13);                // scope 0 at $DIR/reference_prop.rs:+24:5: +24:6\n+-         StorageLive(_18);                // scope 0 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageLive(_19);                // scope 15 at $DIR/reference_prop.rs:+28:13: +28:18\n+          _19 = const 5_usize;             // scope 15 at $DIR/reference_prop.rs:+28:21: +28:28\n+          StorageLive(_20);                // scope 16 at $DIR/reference_prop.rs:+29:13: +29:18\n+          _20 = &raw mut _19;              // scope 16 at $DIR/reference_prop.rs:+29:21: +29:31\n+          StorageLive(_21);                // scope 17 at $DIR/reference_prop.rs:+30:13: +30:14\n+          _21 = &mut _20;                  // scope 17 at $DIR/reference_prop.rs:+30:17: +30:23\n+          StorageLive(_22);                // scope 18 at $DIR/reference_prop.rs:+31:13: +31:14\n+          _22 = (*_20);                    // scope 18 at $DIR/reference_prop.rs:+31:17: +31:19\n+-         _18 = const ();                  // scope 15 at $DIR/reference_prop.rs:+27:5: +32:6\n+          StorageDead(_22);                // scope 18 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_21);                // scope 17 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_20);                // scope 16 at $DIR/reference_prop.rs:+32:5: +32:6\n+          StorageDead(_19);                // scope 15 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageDead(_18);                // scope 0 at $DIR/reference_prop.rs:+32:5: +32:6\n+-         StorageLive(_23);                // scope 0 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageLive(_24);                // scope 20 at $DIR/reference_prop.rs:+36:13: +36:18\n+          _24 = const 7_usize;             // scope 20 at $DIR/reference_prop.rs:+36:21: +36:28\n+          StorageLive(_25);                // scope 21 at $DIR/reference_prop.rs:+37:13: +37:14\n+          _25 = &raw mut _24;              // scope 21 at $DIR/reference_prop.rs:+37:17: +37:27\n+          StorageLive(_26);                // scope 22 at $DIR/reference_prop.rs:+38:13: +38:14\n+          _26 = (*_25);                    // scope 22 at $DIR/reference_prop.rs:+38:17: +38:19\n+          StorageLive(_27);                // scope 23 at $DIR/reference_prop.rs:+39:9: +39:18\n+          StorageLive(_28);                // scope 23 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _28 = _25;                       // scope 23 at $DIR/reference_prop.rs:+39:16: +39:17\n+          _27 = opaque::<*mut usize>(move _28) -> bb1; // scope 23 at $DIR/reference_prop.rs:+39:9: +39:18\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:263:9: 263:15\n+                                           // + literal: Const { ty: fn(*mut usize) {opaque::<*mut usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb1: {\n+          StorageDead(_28);                // scope 23 at $DIR/reference_prop.rs:+39:17: +39:18\n+          StorageDead(_27);                // scope 23 at $DIR/reference_prop.rs:+39:18: +39:19\n+-         _23 = const ();                  // scope 20 at $DIR/reference_prop.rs:+35:5: +40:6\n+          StorageDead(_26);                // scope 22 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_25);                // scope 21 at $DIR/reference_prop.rs:+40:5: +40:6\n+          StorageDead(_24);                // scope 20 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageDead(_23);                // scope 0 at $DIR/reference_prop.rs:+40:5: +40:6\n+-         StorageLive(_29);                // scope 0 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageLive(_30);                // scope 24 at $DIR/reference_prop.rs:+44:13: +44:18\n+          _30 = const 7_usize;             // scope 24 at $DIR/reference_prop.rs:+44:21: +44:28\n+          StorageLive(_31);                // scope 25 at $DIR/reference_prop.rs:+45:13: +45:15\n+          _31 = &raw mut _30;              // scope 25 at $DIR/reference_prop.rs:+45:18: +45:28\n+          StorageLive(_32);                // scope 26 at $DIR/reference_prop.rs:+46:13: +46:14\n+          _32 = (*_31);                    // scope 26 at $DIR/reference_prop.rs:+46:17: +46:20\n+          StorageLive(_33);                // scope 27 at $DIR/reference_prop.rs:+47:13: +47:15\n+          _33 = _31;                       // scope 27 at $DIR/reference_prop.rs:+47:18: +47:20\n+          StorageLive(_34);                // scope 28 at $DIR/reference_prop.rs:+48:13: +48:15\n+          _34 = (*_33);                    // scope 28 at $DIR/reference_prop.rs:+48:18: +48:21\n+          StorageLive(_35);                // scope 29 at $DIR/reference_prop.rs:+49:13: +49:15\n+          _35 = _33;                       // scope 29 at $DIR/reference_prop.rs:+49:18: +49:20\n+          StorageLive(_36);                // scope 30 at $DIR/reference_prop.rs:+52:9: +52:19\n+          StorageLive(_37);                // scope 30 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _37 = _35;                       // scope 30 at $DIR/reference_prop.rs:+52:16: +52:18\n+          _36 = opaque::<*mut usize>(move _37) -> bb2; // scope 30 at $DIR/reference_prop.rs:+52:9: +52:19\n+                                           // mir::Constant\n+                                           // + span: $DIR/reference_prop.rs:276:9: 276:15\n+                                           // + literal: Const { ty: fn(*mut usize) {opaque::<*mut usize>}, val: Value(<ZST>) }\n+      }\n+  \n+      bb2: {\n+          StorageDead(_37);                // scope 30 at $DIR/reference_prop.rs:+52:18: +52:19\n+          StorageDead(_36);                // scope 30 at $DIR/reference_prop.rs:+52:19: +52:20\n+-         _29 = const ();                  // scope 24 at $DIR/reference_prop.rs:+43:5: +53:6\n+          StorageDead(_35);                // scope 29 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_34);                // scope 28 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_33);                // scope 27 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_32);                // scope 26 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_31);                // scope 25 at $DIR/reference_prop.rs:+53:5: +53:6\n+          StorageDead(_30);                // scope 24 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageDead(_29);                // scope 0 at $DIR/reference_prop.rs:+53:5: +53:6\n+-         StorageLive(_38);                // scope 0 at $DIR/reference_prop.rs:+56:5: +59:6\n+          StorageLive(_39);                // scope 31 at $DIR/reference_prop.rs:+57:13: +57:14\n+          _39 = &raw mut (*_1);            // scope 31 at $DIR/reference_prop.rs:+57:17: +57:33\n+          StorageLive(_40);                // scope 32 at $DIR/reference_prop.rs:+58:13: +58:14\n+-         _40 = (*_39);                    // scope 32 at $DIR/reference_prop.rs:+58:17: +58:19\n+-         _38 = const ();                  // scope 31 at $DIR/reference_prop.rs:+56:5: +59:6\n++         _40 = (*_1);                     // scope 32 at $DIR/reference_prop.rs:+58:17: +58:19\n+          StorageDead(_40);                // scope 32 at $DIR/reference_prop.rs:+59:5: +59:6\n+          StorageDead(_39);                // scope 31 at $DIR/reference_prop.rs:+59:5: +59:6\n+-         StorageDead(_38);                // scope 0 at $DIR/reference_prop.rs:+59:5: +59:6\n+          StorageLive(_41);                // scope 34 at $DIR/reference_prop.rs:+63:13: +63:14\n+          _41 = &raw mut (*_2);            // scope 34 at $DIR/reference_prop.rs:+63:17: +63:35\n+          StorageLive(_42);                // scope 35 at $DIR/reference_prop.rs:+64:20: +64:36\n+          _42 = &raw mut (*_1);            // scope 35 at $DIR/reference_prop.rs:+64:20: +64:36\n+          _2 = move _42;                   // scope 35 at $DIR/reference_prop.rs:+64:9: +64:36\n+          StorageDead(_42);                // scope 35 at $DIR/reference_prop.rs:+64:35: +64:36\n+          StorageLive(_43);                // scope 35 at $DIR/reference_prop.rs:+65:13: +65:14\n+          _43 = (*_41);                    // scope 35 at $DIR/reference_prop.rs:+65:17: +65:19\n+          _0 = const ();                   // scope 34 at $DIR/reference_prop.rs:+62:5: +66:6\n+          StorageDead(_43);                // scope 35 at $DIR/reference_prop.rs:+66:5: +66:6\n+          StorageDead(_41);                // scope 34 at $DIR/reference_prop.rs:+66:5: +66:6\n+          return;                          // scope 0 at $DIR/reference_prop.rs:+67:2: +67:2\n+      }\n+  }\n+  "}, {"sha": "5625c20a420b8cbe92a701f13c6f20c9c4bcf99b", "filename": "tests/mir-opt/reference_prop.rs", "status": "added", "additions": 428, "deletions": 0, "changes": 428, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Freference_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Freference_prop.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,428 @@\n+// unit-test: ReferencePropagation\n+\n+#![feature(raw_ref_op)]\n+#![feature(core_intrinsics, custom_mir)]\n+\n+#[inline(never)]\n+fn opaque(_: impl Sized) {}\n+\n+fn reference_propagation<'a, T: Copy>(single: &'a T, mut multiple: &'a T) {\n+    // Propagation through a reference.\n+    {\n+        let a = 5_usize;\n+        let b = &a; // This borrow is only used once.\n+        let c = *b; // This should be optimized.\n+    }\n+\n+    // Propagation through a two references.\n+    {\n+        let a = 5_usize;\n+        let a2 = 7_usize;\n+        let mut b = &a;\n+        b = &a2;\n+        // `b` is assigned twice, so we cannot propagate it.\n+        let c = *b;\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    {\n+        let a = 5_usize;\n+        let b = &a;\n+        let d = &b;\n+        let c = *b; // `b` is immutably borrowed, we know its value, but cannot be removed.\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    {\n+        let a = 5_usize;\n+        let mut b = &a;\n+        let d = &mut b;\n+        let c = *b; // `b` is mutably borrowed, we cannot know its value.\n+    }\n+\n+    // Propagation through an escaping borrow.\n+    {\n+        let a = 7_usize;\n+        let b = &a;\n+        let c = *b;\n+        opaque(b); // `b` escapes here, so we can only replace immutable borrow\n+    }\n+\n+    // Propagation through a transitively escaping borrow.\n+    {\n+        let a = 7_usize;\n+        let b1 = &a;\n+        let c = *b1;\n+        let b2 = b1;\n+        let c2 = *b2;\n+        let b3 = b2;\n+        // `b3` escapes here, so we can only replace immutable borrow,\n+        // for either `b`, `b2` or `b3`.\n+        opaque(b3);\n+    }\n+\n+    // Propagation a reborrow of an argument.\n+    {\n+        let a = &*single;\n+        let b = *a; // This should be optimized as `*single`.\n+    }\n+\n+    // Propagation a reborrow of a mutated argument.\n+    {\n+        let a = &*multiple;\n+        multiple = &*single;\n+        let b = *a; // This should not be optimized.\n+    }\n+}\n+\n+fn reference_propagation_mut<'a, T: Copy>(single: &'a mut T, mut multiple: &'a mut T) {\n+    // Propagation through a reference.\n+    {\n+        let mut a = 5_usize;\n+        let b = &mut a; // This borrow is only used once.\n+        let c = *b; // This should be optimized.\n+    }\n+\n+    // Propagation through a two references.\n+    {\n+        let mut a = 5_usize;\n+        let mut a2 = 7_usize;\n+        let mut b = &mut a;\n+        b = &mut a2;\n+        // `b` is assigned twice, so we cannot propagate it.\n+        let c = *b;\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    {\n+        let mut a = 5_usize;\n+        let b = &mut a;\n+        let d = &b;\n+        let c = *b; // `b` is immutably borrowed, we know its value, but cannot be removed.\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    {\n+        let mut a = 5_usize;\n+        let mut b = &mut a;\n+        let d = &mut b;\n+        let c = *b; // `b` is mutably borrowed, we cannot know its value.\n+    }\n+\n+    // Propagation through an escaping borrow.\n+    {\n+        let mut a = 7_usize;\n+        let b = &mut a;\n+        let c = *b;\n+        opaque(b); // `b` escapes here, so we can only replace immutable borrow\n+    }\n+\n+    // Propagation through a transitively escaping borrow.\n+    {\n+        let mut a = 7_usize;\n+        let b1 = &mut a;\n+        let c = *b1;\n+        let b2 = b1;\n+        let c2 = *b2;\n+        let b3 = b2;\n+        // `b3` escapes here, so we can only replace immutable borrow,\n+        // for either `b`, `b2` or `b3`.\n+        opaque(b3);\n+    }\n+\n+    // Propagation a reborrow of an argument.\n+    {\n+        let a = &mut *single;\n+        let b = *a; // This should be optimized as `*single`.\n+    }\n+\n+    // Propagation a reborrow of a mutated argument.\n+    {\n+        let a = &mut *multiple;\n+        multiple = &mut *single;\n+        let b = *a; // This should not be optimized.\n+    }\n+}\n+\n+fn reference_propagation_const_ptr<T: Copy>(single: *const T, mut multiple: *const T) {\n+    // Propagation through a reference.\n+    unsafe {\n+        let a = 5_usize;\n+        let b = &raw const a; // This borrow is only used once.\n+        let c = *b; // This should be optimized.\n+    }\n+\n+    // Propagation through a two references.\n+    unsafe {\n+        let a = 5_usize;\n+        let a2 = 7_usize;\n+        let mut b = &raw const a;\n+        b = &raw const a2;\n+        // `b` is assigned twice, so we cannot propagate it.\n+        let c = *b;\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    unsafe {\n+        let a = 5_usize;\n+        let b = &raw const a;\n+        let d = &b;\n+        let c = *b; // `b` is immutably borrowed, we know its value, but cannot be removed.\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    unsafe {\n+        let a = 5_usize;\n+        let mut b = &raw const a;\n+        let d = &mut b;\n+        let c = *b; // `b` is mutably borrowed, we cannot know its value.\n+    }\n+\n+    // Propagation through an escaping borrow.\n+    unsafe {\n+        let a = 7_usize;\n+        let b = &raw const a;\n+        let c = *b;\n+        opaque(b); // `b` escapes here, so we can only replace immutable borrow\n+    }\n+\n+    // Propagation through a transitively escaping borrow.\n+    unsafe {\n+        let a = 7_usize;\n+        let b1 = &raw const a;\n+        let c = *b1;\n+        let b2 = b1;\n+        let c2 = *b2;\n+        let b3 = b2;\n+        // `b3` escapes here, so we can only replace immutable borrow,\n+        // for either `b`, `b2` or `b3`.\n+        opaque(b3);\n+    }\n+\n+    // Propagation a reborrow of an argument.\n+    unsafe {\n+        let a = &raw const *single;\n+        let b = *a; // This should be optimized as `*single`.\n+    }\n+\n+    // Propagation a reborrow of a mutated argument.\n+    unsafe {\n+        let a = &raw const *multiple;\n+        multiple = &raw const *single;\n+        let b = *a; // This should not be optimized.\n+    }\n+\n+    // Propagation through a reborrow.\n+    unsafe {\n+        let a = 13_usize;\n+        let b = &raw const a;\n+        let c = &raw const *b;\n+        let e = *c;\n+    }\n+}\n+\n+fn reference_propagation_mut_ptr<T: Copy>(single: *mut T, mut multiple: *mut T) {\n+    // Propagation through a reference.\n+    unsafe {\n+        let mut a = 5_usize;\n+        let b = &raw mut a; // This borrow is only used once.\n+        let c = *b; // This should be optimized.\n+    }\n+\n+    // Propagation through a two references.\n+    unsafe {\n+        let mut a = 5_usize;\n+        let mut a2 = 7_usize;\n+        let mut b = &raw mut a;\n+        b = &raw mut a2;\n+        // `b` is assigned twice, so we cannot propagate it.\n+        let c = *b;\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    unsafe {\n+        let mut a = 5_usize;\n+        let b = &raw mut a;\n+        let d = &b;\n+        let c = *b; // `b` is immutably borrowed, we know its value, but cannot be removed.\n+    }\n+\n+    // Propagation through a borrowed reference.\n+    unsafe {\n+        let mut a = 5_usize;\n+        let mut b = &raw mut a;\n+        let d = &mut b;\n+        let c = *b; // `b` is mutably borrowed, we cannot know its value.\n+    }\n+\n+    // Propagation through an escaping borrow.\n+    unsafe {\n+        let mut a = 7_usize;\n+        let b = &raw mut a;\n+        let c = *b;\n+        opaque(b); // `b` escapes here, so we can only replace immutable borrow\n+    }\n+\n+    // Propagation through a transitively escaping borrow.\n+    unsafe {\n+        let mut a = 7_usize;\n+        let b1 = &raw mut a;\n+        let c = *b1;\n+        let b2 = b1;\n+        let c2 = *b2;\n+        let b3 = b2;\n+        // `b3` escapes here, so we can only replace immutable borrow,\n+        // for either `b`, `b2` or `b3`.\n+        opaque(b3);\n+    }\n+\n+    // Propagation a reborrow of an argument.\n+    unsafe {\n+        let a = &raw mut *single;\n+        let b = *a; // This should be optimized as `*single`.\n+    }\n+\n+    // Propagation a reborrow of a mutated argument.\n+    unsafe {\n+        let a = &raw mut *multiple;\n+        multiple = &raw mut *single;\n+        let b = *a; // This should not be optimized.\n+    }\n+}\n+\n+#[custom_mir(dialect = \"runtime\", phase = \"post-cleanup\")]\n+fn read_through_raw(x: &mut usize) -> usize {\n+    use std::intrinsics::mir::*;\n+\n+    mir!(\n+        let r1: &mut usize;\n+        let r2: &mut usize;\n+        let p1: *mut usize;\n+        let p2: *mut usize;\n+\n+        {\n+            r1 = &mut *x;\n+            r2 = &mut *r1;\n+            p1 = &raw mut *r1;\n+            p2 = &raw mut *r2;\n+\n+            RET = *p1;\n+            RET = *p2;\n+            Return()\n+        }\n+    )\n+}\n+\n+#[custom_mir(dialect = \"runtime\", phase = \"post-cleanup\")]\n+fn multiple_storage() {\n+    use std::intrinsics::mir::*;\n+\n+    mir!(\n+        let x: i32;\n+        {\n+            StorageLive(x);\n+            x = 5;\n+            let z = &x;\n+            StorageDead(x);\n+            StorageLive(x);\n+            // As there are multiple `StorageLive` statements for `x`, we cannot know if this `z`'s\n+            // pointer address is the address of `x`, so do nothing.\n+            let y = *z;\n+            Call(RET, retblock, opaque(y))\n+        }\n+\n+        retblock = {\n+            Return()\n+        }\n+    )\n+}\n+\n+#[custom_mir(dialect = \"runtime\", phase = \"post-cleanup\")]\n+fn dominate_storage() {\n+    use std::intrinsics::mir::*;\n+\n+    mir!(\n+        let x: i32;\n+        let r: &i32;\n+        let c: i32;\n+        let d: bool;\n+        { Goto(bb0) }\n+        bb0 = {\n+            x = 5;\n+            r = &x;\n+            Goto(bb1)\n+        }\n+        bb1 = {\n+            let c = *r;\n+            Call(RET, bb2, opaque(c))\n+        }\n+        bb2 = {\n+            StorageDead(x);\n+            StorageLive(x);\n+            let d = true;\n+            match d { false => bb2, _ => bb0 }\n+        }\n+    )\n+}\n+\n+#[custom_mir(dialect = \"runtime\", phase = \"post-cleanup\")]\n+fn maybe_dead(m: bool) {\n+    use std::intrinsics::mir::*;\n+\n+    mir!(\n+        let x: i32;\n+        let y: i32;\n+        {\n+            StorageLive(x);\n+            StorageLive(y);\n+            x = 5;\n+            y = 5;\n+            let a = &x;\n+            let b = &mut y;\n+            // As we don't replace `b` in `bb2`, we cannot replace it here either.\n+            *b = 7;\n+            match m { true => bb1, _ => bb2 }\n+        }\n+        bb1 = {\n+            StorageDead(x);\n+            StorageDead(y);\n+            Goto(bb2)\n+        }\n+        bb2 = {\n+            // As `x` may be `StorageDead`, `a` may be dangling, so we do nothing.\n+            let z = *a;\n+            Call(RET, bb3, opaque(z))\n+        }\n+        bb3 = {\n+            // As `y` may be `StorageDead`, `b` may be dangling, so we do nothing.\n+            // This implies that we also do not substitute `b` in `bb0`.\n+            let t = *b;\n+            Call(RET, retblock, opaque(t))\n+        }\n+        retblock = {\n+            Return()\n+        }\n+    )\n+}\n+\n+fn main() {\n+    let mut x = 5_usize;\n+    let mut y = 7_usize;\n+    reference_propagation(&x, &y);\n+    reference_propagation_mut(&mut x, &mut y);\n+    reference_propagation_const_ptr(&raw const x, &raw const y);\n+    reference_propagation_mut_ptr(&raw mut x, &raw mut y);\n+    read_through_raw(&mut x);\n+    multiple_storage();\n+    dominate_storage();\n+    maybe_dead(true);\n+}\n+\n+// EMIT_MIR reference_prop.reference_propagation.ReferencePropagation.diff\n+// EMIT_MIR reference_prop.reference_propagation_mut.ReferencePropagation.diff\n+// EMIT_MIR reference_prop.reference_propagation_const_ptr.ReferencePropagation.diff\n+// EMIT_MIR reference_prop.reference_propagation_mut_ptr.ReferencePropagation.diff\n+// EMIT_MIR reference_prop.read_through_raw.ReferencePropagation.diff\n+// EMIT_MIR reference_prop.multiple_storage.ReferencePropagation.diff\n+// EMIT_MIR reference_prop.dominate_storage.ReferencePropagation.diff\n+// EMIT_MIR reference_prop.maybe_dead.ReferencePropagation.diff"}, {"sha": "be32f40f132277752b6ef37db089881dd66fa2c1", "filename": "tests/mir-opt/slice_filter.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Fslice_filter.rs?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -12,7 +12,9 @@ pub fn variant_b(input: &[(usize, usize, usize, usize)]) -> usize {\n     input.iter().filter(|&&(a, b, c, d)| a <= c && d <= b || c <= a && b <= d).count()\n }\n \n+// EMIT_MIR slice_filter.variant_a-{closure#0}.ReferencePropagation.diff\n // EMIT_MIR slice_filter.variant_a-{closure#0}.CopyProp.diff\n // EMIT_MIR slice_filter.variant_a-{closure#0}.DestinationPropagation.diff\n // EMIT_MIR slice_filter.variant_b-{closure#0}.CopyProp.diff\n+// EMIT_MIR slice_filter.variant_b-{closure#0}.ReferencePropagation.diff\n // EMIT_MIR slice_filter.variant_b-{closure#0}.DestinationPropagation.diff"}, {"sha": "a81553733a7dba0d6665118e65b7969023ebcdf1", "filename": "tests/mir-opt/slice_filter.variant_a-{closure#0}.DestinationPropagation.diff", "status": "modified", "additions": 52, "deletions": 36, "changes": 88, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.variant_a-%7Bclosure%230%7D.DestinationPropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.variant_a-%7Bclosure%230%7D.DestinationPropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Fslice_filter.variant_a-%7Bclosure%230%7D.DestinationPropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -30,10 +30,14 @@\n       let mut _27: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:38\n       let mut _28: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:38\n       scope 1 {\n-          debug a => _3;                   // in scope 1 at $DIR/slice_filter.rs:+0:27: +0:28\n-          debug b => _4;                   // in scope 1 at $DIR/slice_filter.rs:+0:30: +0:31\n-          debug c => _5;                   // in scope 1 at $DIR/slice_filter.rs:+0:33: +0:34\n-          debug d => _6;                   // in scope 1 at $DIR/slice_filter.rs:+0:36: +0:37\n+-         debug a => _3;                   // in scope 1 at $DIR/slice_filter.rs:+0:27: +0:28\n+-         debug b => _4;                   // in scope 1 at $DIR/slice_filter.rs:+0:30: +0:31\n+-         debug c => _5;                   // in scope 1 at $DIR/slice_filter.rs:+0:33: +0:34\n+-         debug d => _6;                   // in scope 1 at $DIR/slice_filter.rs:+0:36: +0:37\n++         debug a => _20;                  // in scope 1 at $DIR/slice_filter.rs:+0:27: +0:28\n++         debug b => _15;                  // in scope 1 at $DIR/slice_filter.rs:+0:30: +0:31\n++         debug c => _11;                  // in scope 1 at $DIR/slice_filter.rs:+0:33: +0:34\n++         debug d => _24;                  // in scope 1 at $DIR/slice_filter.rs:+0:36: +0:37\n           scope 2 (inlined cmp::impls::<impl PartialOrd for &usize>::le) { // at $DIR/slice_filter.rs:8:40: 8:46\n               debug self => _9;            // in scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n               debug other => _10;          // in scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n@@ -86,32 +90,38 @@\n   \n       bb0: {\n           _25 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:27: +0:28\n-          _3 = &((*_25).0: usize);         // scope 0 at $DIR/slice_filter.rs:+0:27: +0:28\n+-         _3 = &((*_25).0: usize);         // scope 0 at $DIR/slice_filter.rs:+0:27: +0:28\n++         _20 = &((*_25).0: usize);        // scope 0 at $DIR/slice_filter.rs:+0:27: +0:28\n           _26 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:30: +0:31\n-          _4 = &((*_26).1: usize);         // scope 0 at $DIR/slice_filter.rs:+0:30: +0:31\n+-         _4 = &((*_26).1: usize);         // scope 0 at $DIR/slice_filter.rs:+0:30: +0:31\n++         _15 = &((*_26).1: usize);        // scope 0 at $DIR/slice_filter.rs:+0:30: +0:31\n           _27 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:33: +0:34\n-          _5 = &((*_27).2: usize);         // scope 0 at $DIR/slice_filter.rs:+0:33: +0:34\n+-         _5 = &((*_27).2: usize);         // scope 0 at $DIR/slice_filter.rs:+0:33: +0:34\n++         _11 = &((*_27).2: usize);        // scope 0 at $DIR/slice_filter.rs:+0:33: +0:34\n           _28 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:36: +0:37\n-          _6 = &((*_28).3: usize);         // scope 0 at $DIR/slice_filter.rs:+0:36: +0:37\n+-         _6 = &((*_28).3: usize);         // scope 0 at $DIR/slice_filter.rs:+0:36: +0:37\n -         StorageLive(_7);                 // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n++         _24 = &((*_28).3: usize);        // scope 0 at $DIR/slice_filter.rs:+0:36: +0:37\n +         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n           StorageLive(_8);                 // scope 1 at $DIR/slice_filter.rs:+0:40: +0:46\n           StorageLive(_9);                 // scope 1 at $DIR/slice_filter.rs:+0:40: +0:41\n-          _9 = &_3;                        // scope 1 at $DIR/slice_filter.rs:+0:40: +0:41\n           StorageLive(_10);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n-          StorageLive(_11);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n-          _11 = _5;                        // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n-          _10 = &_11;                      // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n-          _29 = deref_copy (*_9);          // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          _30 = deref_copy (*_10);         // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         StorageLive(_11);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+-         _11 = _5;                        // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+-         _29 = deref_copy _3;             // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n++         _29 = deref_copy _20;            // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _30 = deref_copy _11;            // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_31);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _31 = (*_29);                    // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_32);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _32 = (*_30);                    // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _8 = Le(move _31, move _32);     // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_32);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_31);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          StorageDead(_11);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+-         StorageDead(_11);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n           StorageDead(_10);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n           StorageDead(_9);                 // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n           switchInt(move _8) -> [0: bb4, otherwise: bb5]; // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n@@ -127,21 +137,23 @@\n +         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n           StorageLive(_17);                // scope 1 at $DIR/slice_filter.rs:+0:60: +0:66\n           StorageLive(_18);                // scope 1 at $DIR/slice_filter.rs:+0:60: +0:61\n-          _18 = &_5;                       // scope 1 at $DIR/slice_filter.rs:+0:60: +0:61\n           StorageLive(_19);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n-          StorageLive(_20);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n-          _20 = _3;                        // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n-          _19 = &_20;                      // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n-          _33 = deref_copy (*_18);         // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          _34 = deref_copy (*_19);         // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         StorageLive(_20);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+-         _20 = _3;                        // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+-         _33 = deref_copy _5;             // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n++         _33 = deref_copy _11;            // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _34 = deref_copy _20;            // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_35);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _35 = (*_33);                    // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_36);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _36 = (*_34);                    // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _17 = Le(move _35, move _36);    // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_36);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_35);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          StorageDead(_20);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+-         StorageDead(_20);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n           StorageDead(_19);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n           StorageDead(_18);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n           switchInt(move _17) -> [0: bb6, otherwise: bb7]; // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n@@ -166,21 +178,23 @@\n -         StorageLive(_12);                // scope 1 at $DIR/slice_filter.rs:+0:50: +0:56\n +         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:50: +0:56\n           StorageLive(_13);                // scope 1 at $DIR/slice_filter.rs:+0:50: +0:51\n-          _13 = &_6;                       // scope 1 at $DIR/slice_filter.rs:+0:50: +0:51\n           StorageLive(_14);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n-          StorageLive(_15);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n-          _15 = _4;                        // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n-          _14 = &_15;                      // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n-          _37 = deref_copy (*_13);         // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          _38 = deref_copy (*_14);         // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         StorageLive(_15);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+-         _15 = _4;                        // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+-         _37 = deref_copy _6;             // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n++         _37 = deref_copy _24;            // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _38 = deref_copy _15;            // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_39);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _39 = (*_37);                    // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_40);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _40 = (*_38);                    // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _12 = Le(move _39, move _40);    // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_40);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_39);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          StorageDead(_15);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+-         StorageDead(_15);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n           StorageDead(_14);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n           StorageDead(_13);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n -         _7 = move _12;                   // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n@@ -202,13 +216,14 @@\n -         StorageLive(_21);                // scope 1 at $DIR/slice_filter.rs:+0:70: +0:76\n +         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:70: +0:76\n           StorageLive(_22);                // scope 1 at $DIR/slice_filter.rs:+0:70: +0:71\n-          _22 = &_4;                       // scope 1 at $DIR/slice_filter.rs:+0:70: +0:71\n           StorageLive(_23);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n-          StorageLive(_24);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n-          _24 = _6;                        // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n-          _23 = &_24;                      // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n-          _41 = deref_copy (*_22);         // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          _42 = deref_copy (*_23);         // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         StorageLive(_24);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+-         _24 = _6;                        // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+-         _41 = deref_copy _4;             // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n++         _41 = deref_copy _15;            // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _42 = deref_copy _24;            // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_43);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           _43 = (*_41);                    // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageLive(_44);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n@@ -217,7 +232,8 @@\n +         _0 = Le(move _43, move _44);     // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_44);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n           StorageDead(_43);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n-          StorageDead(_24);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+-         StorageDead(_24);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n++         nop;                             // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n           StorageDead(_23);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n           StorageDead(_22);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n -         _16 = move _21;                  // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76"}, {"sha": "18ea730595492030e01068d425191888680522af", "filename": "tests/mir-opt/slice_filter.variant_a-{closure#0}.ReferencePropagation.diff", "status": "added", "additions": 239, "deletions": 0, "changes": 239, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.variant_a-%7Bclosure%230%7D.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.variant_a-%7Bclosure%230%7D.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Fslice_filter.variant_a-%7Bclosure%230%7D.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,239 @@\n+- // MIR for `variant_a::{closure#0}` before ReferencePropagation\n++ // MIR for `variant_a::{closure#0}` after ReferencePropagation\n+  \n+  fn variant_a::{closure#0}(_1: &mut [closure@$DIR/slice_filter.rs:8:25: 8:39], _2: &&(usize, usize, usize, usize)) -> bool {\n+      let mut _0: bool;                    // return place in scope 0 at $DIR/slice_filter.rs:+0:40: +0:40\n+      let _3: &usize;                      // in scope 0 at $DIR/slice_filter.rs:+0:27: +0:28\n+      let _4: &usize;                      // in scope 0 at $DIR/slice_filter.rs:+0:30: +0:31\n+      let _5: &usize;                      // in scope 0 at $DIR/slice_filter.rs:+0:33: +0:34\n+      let _6: &usize;                      // in scope 0 at $DIR/slice_filter.rs:+0:36: +0:37\n+      let mut _7: bool;                    // in scope 0 at $DIR/slice_filter.rs:+0:40: +0:56\n+      let mut _8: bool;                    // in scope 0 at $DIR/slice_filter.rs:+0:40: +0:46\n+      let mut _9: &&usize;                 // in scope 0 at $DIR/slice_filter.rs:+0:40: +0:41\n+      let mut _10: &&usize;                // in scope 0 at $DIR/slice_filter.rs:+0:45: +0:46\n+      let _11: &usize;                     // in scope 0 at $DIR/slice_filter.rs:+0:45: +0:46\n+      let mut _12: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:50: +0:56\n+      let mut _13: &&usize;                // in scope 0 at $DIR/slice_filter.rs:+0:50: +0:51\n+      let mut _14: &&usize;                // in scope 0 at $DIR/slice_filter.rs:+0:55: +0:56\n+      let _15: &usize;                     // in scope 0 at $DIR/slice_filter.rs:+0:55: +0:56\n+      let mut _16: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:60: +0:76\n+      let mut _17: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:60: +0:66\n+      let mut _18: &&usize;                // in scope 0 at $DIR/slice_filter.rs:+0:60: +0:61\n+      let mut _19: &&usize;                // in scope 0 at $DIR/slice_filter.rs:+0:65: +0:66\n+      let _20: &usize;                     // in scope 0 at $DIR/slice_filter.rs:+0:65: +0:66\n+      let mut _21: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:70: +0:76\n+      let mut _22: &&usize;                // in scope 0 at $DIR/slice_filter.rs:+0:70: +0:71\n+      let mut _23: &&usize;                // in scope 0 at $DIR/slice_filter.rs:+0:75: +0:76\n+      let _24: &usize;                     // in scope 0 at $DIR/slice_filter.rs:+0:75: +0:76\n+      let mut _25: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:38\n+      let mut _26: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:38\n+      let mut _27: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:38\n+      let mut _28: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:38\n+      let mut _31: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      let mut _32: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      let mut _37: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      let mut _38: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      let mut _43: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      let mut _44: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      let mut _49: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      let mut _50: &usize;                 // in scope 0 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+      scope 1 {\n+          debug a => _3;                   // in scope 1 at $DIR/slice_filter.rs:+0:27: +0:28\n+          debug b => _4;                   // in scope 1 at $DIR/slice_filter.rs:+0:30: +0:31\n+          debug c => _5;                   // in scope 1 at $DIR/slice_filter.rs:+0:33: +0:34\n+          debug d => _6;                   // in scope 1 at $DIR/slice_filter.rs:+0:36: +0:37\n+          scope 2 (inlined cmp::impls::<impl PartialOrd for &usize>::le) { // at $DIR/slice_filter.rs:8:40: 8:46\n+              debug self => _9;            // in scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              debug other => _10;          // in scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _29: &usize;         // in scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _30: &usize;         // in scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              scope 3 (inlined cmp::impls::<impl PartialOrd for usize>::le) { // at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug self => _29;       // in scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug other => _30;      // in scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _33: usize;      // in scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _34: usize;      // in scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              }\n+          }\n+          scope 4 (inlined cmp::impls::<impl PartialOrd for &usize>::le) { // at $DIR/slice_filter.rs:8:60: 8:66\n+              debug self => _18;           // in scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              debug other => _19;          // in scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _35: &usize;         // in scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _36: &usize;         // in scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              scope 5 (inlined cmp::impls::<impl PartialOrd for usize>::le) { // at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug self => _35;       // in scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug other => _36;      // in scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _39: usize;      // in scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _40: usize;      // in scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              }\n+          }\n+          scope 6 (inlined cmp::impls::<impl PartialOrd for &usize>::le) { // at $DIR/slice_filter.rs:8:50: 8:56\n+              debug self => _13;           // in scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              debug other => _14;          // in scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _41: &usize;         // in scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _42: &usize;         // in scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              scope 7 (inlined cmp::impls::<impl PartialOrd for usize>::le) { // at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug self => _41;       // in scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug other => _42;      // in scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _45: usize;      // in scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _46: usize;      // in scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              }\n+          }\n+          scope 8 (inlined cmp::impls::<impl PartialOrd for &usize>::le) { // at $DIR/slice_filter.rs:8:70: 8:76\n+              debug self => _22;           // in scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              debug other => _23;          // in scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _47: &usize;         // in scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              let mut _48: &usize;         // in scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              scope 9 (inlined cmp::impls::<impl PartialOrd for usize>::le) { // at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug self => _47;       // in scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  debug other => _48;      // in scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _51: usize;      // in scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+                  let mut _52: usize;      // in scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+              }\n+          }\n+      }\n+  \n+      bb0: {\n+          _25 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:27: +0:28\n+          _3 = &((*_25).0: usize);         // scope 0 at $DIR/slice_filter.rs:+0:27: +0:28\n+          _26 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:30: +0:31\n+          _4 = &((*_26).1: usize);         // scope 0 at $DIR/slice_filter.rs:+0:30: +0:31\n+          _27 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:33: +0:34\n+          _5 = &((*_27).2: usize);         // scope 0 at $DIR/slice_filter.rs:+0:33: +0:34\n+          _28 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:36: +0:37\n+          _6 = &((*_28).3: usize);         // scope 0 at $DIR/slice_filter.rs:+0:36: +0:37\n+          StorageLive(_7);                 // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n+          StorageLive(_8);                 // scope 1 at $DIR/slice_filter.rs:+0:40: +0:46\n+          StorageLive(_9);                 // scope 1 at $DIR/slice_filter.rs:+0:40: +0:41\n+          _9 = &_3;                        // scope 1 at $DIR/slice_filter.rs:+0:40: +0:41\n+          StorageLive(_10);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+          StorageLive(_11);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+          _11 = _5;                        // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+          _10 = &_11;                      // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+-         _29 = deref_copy (*_9);          // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         _30 = deref_copy (*_10);         // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _29 = deref_copy _3;             // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _30 = deref_copy _11;            // scope 2 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_33);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _33 = (*_29);                    // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_34);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _34 = (*_30);                    // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _8 = Le(move _33, move _34);     // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_34);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_33);                // scope 3 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_11);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+          StorageDead(_10);                // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+          StorageDead(_9);                 // scope 1 at $DIR/slice_filter.rs:+0:45: +0:46\n+          switchInt(move _8) -> [0: bb4, otherwise: bb5]; // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n+      }\n+  \n+      bb1: {\n+          _0 = const true;                 // scope 1 at $DIR/slice_filter.rs:+0:40: +0:76\n+          goto -> bb3;                     // scope 1 at $DIR/slice_filter.rs:+0:40: +0:76\n+      }\n+  \n+      bb2: {\n+          StorageLive(_16);                // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n+          StorageLive(_17);                // scope 1 at $DIR/slice_filter.rs:+0:60: +0:66\n+          StorageLive(_18);                // scope 1 at $DIR/slice_filter.rs:+0:60: +0:61\n+          _18 = &_5;                       // scope 1 at $DIR/slice_filter.rs:+0:60: +0:61\n+          StorageLive(_19);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+          StorageLive(_20);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+          _20 = _3;                        // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+          _19 = &_20;                      // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+-         _35 = deref_copy (*_18);         // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         _36 = deref_copy (*_19);         // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _35 = deref_copy _5;             // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _36 = deref_copy _20;            // scope 4 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_39);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _39 = (*_35);                    // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_40);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _40 = (*_36);                    // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _17 = Le(move _39, move _40);    // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_40);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_39);                // scope 5 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_20);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+          StorageDead(_19);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+          StorageDead(_18);                // scope 1 at $DIR/slice_filter.rs:+0:65: +0:66\n+          switchInt(move _17) -> [0: bb6, otherwise: bb7]; // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n+      }\n+  \n+      bb3: {\n+          StorageDead(_16);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          StorageDead(_7);                 // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          return;                          // scope 0 at $DIR/slice_filter.rs:+0:76: +0:76\n+      }\n+  \n+      bb4: {\n+          _7 = const false;                // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n+          StorageDead(_12);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          StorageDead(_8);                 // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          goto -> bb2;                     // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n+      }\n+  \n+      bb5: {\n+          StorageLive(_12);                // scope 1 at $DIR/slice_filter.rs:+0:50: +0:56\n+          StorageLive(_13);                // scope 1 at $DIR/slice_filter.rs:+0:50: +0:51\n+          _13 = &_6;                       // scope 1 at $DIR/slice_filter.rs:+0:50: +0:51\n+          StorageLive(_14);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          StorageLive(_15);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          _15 = _4;                        // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          _14 = &_15;                      // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+-         _41 = deref_copy (*_13);         // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         _42 = deref_copy (*_14);         // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _41 = deref_copy _6;             // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _42 = deref_copy _15;            // scope 6 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_45);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _45 = (*_41);                    // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_46);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _46 = (*_42);                    // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _12 = Le(move _45, move _46);    // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_46);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_45);                // scope 7 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_15);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          StorageDead(_14);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          StorageDead(_13);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          _7 = move _12;                   // scope 1 at $DIR/slice_filter.rs:+0:40: +0:56\n+          StorageDead(_12);                // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          StorageDead(_8);                 // scope 1 at $DIR/slice_filter.rs:+0:55: +0:56\n+          switchInt(move _7) -> [0: bb2, otherwise: bb1]; // scope 1 at $DIR/slice_filter.rs:+0:40: +0:76\n+      }\n+  \n+      bb6: {\n+          _16 = const false;               // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n+          goto -> bb8;                     // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n+      }\n+  \n+      bb7: {\n+          StorageLive(_21);                // scope 1 at $DIR/slice_filter.rs:+0:70: +0:76\n+          StorageLive(_22);                // scope 1 at $DIR/slice_filter.rs:+0:70: +0:71\n+          _22 = &_4;                       // scope 1 at $DIR/slice_filter.rs:+0:70: +0:71\n+          StorageLive(_23);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          StorageLive(_24);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          _24 = _6;                        // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          _23 = &_24;                      // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+-         _47 = deref_copy (*_22);         // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+-         _48 = deref_copy (*_23);         // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _47 = deref_copy _4;             // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n++         _48 = deref_copy _24;            // scope 8 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_51);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _51 = (*_47);                    // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageLive(_52);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _52 = (*_48);                    // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          _21 = Le(move _51, move _52);    // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_52);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_51);                // scope 9 at $SRC_DIR/core/src/cmp.rs:LL:COL\n+          StorageDead(_24);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          StorageDead(_23);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          StorageDead(_22);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          _16 = move _21;                  // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n+          goto -> bb8;                     // scope 1 at $DIR/slice_filter.rs:+0:60: +0:76\n+      }\n+  \n+      bb8: {\n+          StorageDead(_21);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          StorageDead(_17);                // scope 1 at $DIR/slice_filter.rs:+0:75: +0:76\n+          _0 = move _16;                   // scope 1 at $DIR/slice_filter.rs:+0:40: +0:76\n+          goto -> bb3;                     // scope 1 at $DIR/slice_filter.rs:+0:40: +0:76\n+      }\n+  }\n+  "}, {"sha": "d1241c6b0245c6869de2a60361509569cc0406d3", "filename": "tests/mir-opt/slice_filter.variant_b-{closure#0}.ReferencePropagation.diff", "status": "added", "additions": 103, "deletions": 0, "changes": 103, "blob_url": "https://github.com/rust-lang/rust/blob/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.variant_b-%7Bclosure%230%7D.ReferencePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/34903755701a5595ee4bab3bb89de15c5469cd3e/tests%2Fmir-opt%2Fslice_filter.variant_b-%7Bclosure%230%7D.ReferencePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmir-opt%2Fslice_filter.variant_b-%7Bclosure%230%7D.ReferencePropagation.diff?ref=34903755701a5595ee4bab3bb89de15c5469cd3e", "patch": "@@ -0,0 +1,103 @@\n+- // MIR for `variant_b::{closure#0}` before ReferencePropagation\n++ // MIR for `variant_b::{closure#0}` after ReferencePropagation\n+  \n+  fn variant_b::{closure#0}(_1: &mut [closure@$DIR/slice_filter.rs:12:25: 12:41], _2: &&(usize, usize, usize, usize)) -> bool {\n+      let mut _0: bool;                    // return place in scope 0 at $DIR/slice_filter.rs:+0:42: +0:42\n+      let _3: usize;                       // in scope 0 at $DIR/slice_filter.rs:+0:29: +0:30\n+      let _4: usize;                       // in scope 0 at $DIR/slice_filter.rs:+0:32: +0:33\n+      let _5: usize;                       // in scope 0 at $DIR/slice_filter.rs:+0:35: +0:36\n+      let _6: usize;                       // in scope 0 at $DIR/slice_filter.rs:+0:38: +0:39\n+      let mut _7: bool;                    // in scope 0 at $DIR/slice_filter.rs:+0:42: +0:58\n+      let mut _8: bool;                    // in scope 0 at $DIR/slice_filter.rs:+0:42: +0:48\n+      let mut _9: usize;                   // in scope 0 at $DIR/slice_filter.rs:+0:42: +0:43\n+      let mut _10: usize;                  // in scope 0 at $DIR/slice_filter.rs:+0:47: +0:48\n+      let mut _11: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:52: +0:58\n+      let mut _12: usize;                  // in scope 0 at $DIR/slice_filter.rs:+0:52: +0:53\n+      let mut _13: usize;                  // in scope 0 at $DIR/slice_filter.rs:+0:57: +0:58\n+      let mut _14: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:62: +0:78\n+      let mut _15: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:62: +0:68\n+      let mut _16: usize;                  // in scope 0 at $DIR/slice_filter.rs:+0:62: +0:63\n+      let mut _17: usize;                  // in scope 0 at $DIR/slice_filter.rs:+0:67: +0:68\n+      let mut _18: bool;                   // in scope 0 at $DIR/slice_filter.rs:+0:72: +0:78\n+      let mut _19: usize;                  // in scope 0 at $DIR/slice_filter.rs:+0:72: +0:73\n+      let mut _20: usize;                  // in scope 0 at $DIR/slice_filter.rs:+0:77: +0:78\n+      let mut _21: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:40\n+      let mut _22: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:40\n+      let mut _23: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:40\n+      let mut _24: &(usize, usize, usize, usize); // in scope 0 at $DIR/slice_filter.rs:+0:26: +0:40\n+      scope 1 {\n+          debug a => _3;                   // in scope 1 at $DIR/slice_filter.rs:+0:29: +0:30\n+          debug b => _4;                   // in scope 1 at $DIR/slice_filter.rs:+0:32: +0:33\n+          debug c => _5;                   // in scope 1 at $DIR/slice_filter.rs:+0:35: +0:36\n+          debug d => _6;                   // in scope 1 at $DIR/slice_filter.rs:+0:38: +0:39\n+      }\n+  \n+      bb0: {\n+          _21 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:29: +0:30\n+          _3 = ((*_21).0: usize);          // scope 0 at $DIR/slice_filter.rs:+0:29: +0:30\n+          _22 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:32: +0:33\n+          _4 = ((*_22).1: usize);          // scope 0 at $DIR/slice_filter.rs:+0:32: +0:33\n+          _23 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:35: +0:36\n+          _5 = ((*_23).2: usize);          // scope 0 at $DIR/slice_filter.rs:+0:35: +0:36\n+          _24 = deref_copy (*_2);          // scope 0 at $DIR/slice_filter.rs:+0:38: +0:39\n+          _6 = ((*_24).3: usize);          // scope 0 at $DIR/slice_filter.rs:+0:38: +0:39\n+          StorageLive(_7);                 // scope 1 at $DIR/slice_filter.rs:+0:42: +0:58\n+          StorageLive(_8);                 // scope 1 at $DIR/slice_filter.rs:+0:42: +0:48\n+          _8 = Le(_3, _5);                 // scope 1 at $DIR/slice_filter.rs:+0:42: +0:48\n+          switchInt(move _8) -> [0: bb4, otherwise: bb5]; // scope 1 at $DIR/slice_filter.rs:+0:42: +0:58\n+      }\n+  \n+      bb1: {\n+          _0 = const true;                 // scope 1 at $DIR/slice_filter.rs:+0:42: +0:78\n+          goto -> bb3;                     // scope 1 at $DIR/slice_filter.rs:+0:42: +0:78\n+      }\n+  \n+      bb2: {\n+          StorageLive(_14);                // scope 1 at $DIR/slice_filter.rs:+0:62: +0:78\n+          StorageLive(_15);                // scope 1 at $DIR/slice_filter.rs:+0:62: +0:68\n+          _15 = Le(_5, _3);                // scope 1 at $DIR/slice_filter.rs:+0:62: +0:68\n+          switchInt(move _15) -> [0: bb6, otherwise: bb7]; // scope 1 at $DIR/slice_filter.rs:+0:62: +0:78\n+      }\n+  \n+      bb3: {\n+          StorageDead(_14);                // scope 1 at $DIR/slice_filter.rs:+0:77: +0:78\n+          StorageDead(_7);                 // scope 1 at $DIR/slice_filter.rs:+0:77: +0:78\n+          return;                          // scope 0 at $DIR/slice_filter.rs:+0:78: +0:78\n+      }\n+  \n+      bb4: {\n+          _7 = const false;                // scope 1 at $DIR/slice_filter.rs:+0:42: +0:58\n+          StorageDead(_11);                // scope 1 at $DIR/slice_filter.rs:+0:57: +0:58\n+          StorageDead(_8);                 // scope 1 at $DIR/slice_filter.rs:+0:57: +0:58\n+          goto -> bb2;                     // scope 1 at $DIR/slice_filter.rs:+0:42: +0:58\n+      }\n+  \n+      bb5: {\n+          StorageLive(_11);                // scope 1 at $DIR/slice_filter.rs:+0:52: +0:58\n+          _11 = Le(_6, _4);                // scope 1 at $DIR/slice_filter.rs:+0:52: +0:58\n+          _7 = move _11;                   // scope 1 at $DIR/slice_filter.rs:+0:42: +0:58\n+          StorageDead(_11);                // scope 1 at $DIR/slice_filter.rs:+0:57: +0:58\n+          StorageDead(_8);                 // scope 1 at $DIR/slice_filter.rs:+0:57: +0:58\n+          switchInt(move _7) -> [0: bb2, otherwise: bb1]; // scope 1 at $DIR/slice_filter.rs:+0:42: +0:78\n+      }\n+  \n+      bb6: {\n+          _14 = const false;               // scope 1 at $DIR/slice_filter.rs:+0:62: +0:78\n+          goto -> bb8;                     // scope 1 at $DIR/slice_filter.rs:+0:62: +0:78\n+      }\n+  \n+      bb7: {\n+          StorageLive(_18);                // scope 1 at $DIR/slice_filter.rs:+0:72: +0:78\n+          _18 = Le(_4, _6);                // scope 1 at $DIR/slice_filter.rs:+0:72: +0:78\n+          _14 = move _18;                  // scope 1 at $DIR/slice_filter.rs:+0:62: +0:78\n+          goto -> bb8;                     // scope 1 at $DIR/slice_filter.rs:+0:62: +0:78\n+      }\n+  \n+      bb8: {\n+          StorageDead(_18);                // scope 1 at $DIR/slice_filter.rs:+0:77: +0:78\n+          StorageDead(_15);                // scope 1 at $DIR/slice_filter.rs:+0:77: +0:78\n+          _0 = move _14;                   // scope 1 at $DIR/slice_filter.rs:+0:42: +0:78\n+          goto -> bb3;                     // scope 1 at $DIR/slice_filter.rs:+0:42: +0:78\n+      }\n+  }\n+  "}]}