{"sha": "3d9bbf9b86f9f41d9ea5fe649343f3d763003866", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkOWJiZjliODZmOWY0MWQ5ZWE1ZmU2NDkzNDNmM2Q3NjMwMDM4NjY=", "commit": {"author": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2020-11-30T20:52:30Z"}, "committer": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2020-12-01T03:31:08Z"}, "message": "Use simd_{floor,ceil} intrinsics for round.rs", "tree": {"sha": "e8c0b4790f515f16aa70e2111618f1d991a4c3cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e8c0b4790f515f16aa70e2111618f1d991a4c3cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d9bbf9b86f9f41d9ea5fe649343f3d763003866", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d9bbf9b86f9f41d9ea5fe649343f3d763003866", "html_url": "https://github.com/rust-lang/rust/commit/3d9bbf9b86f9f41d9ea5fe649343f3d763003866", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d9bbf9b86f9f41d9ea5fe649343f3d763003866/comments", "author": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e9cc3066a82941a15ceb60de7a55e0c163c25b2c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e9cc3066a82941a15ceb60de7a55e0c163c25b2c", "html_url": "https://github.com/rust-lang/rust/commit/e9cc3066a82941a15ceb60de7a55e0c163c25b2c"}], "stats": {"total": 91, "additions": 16, "deletions": 75}, "files": [{"sha": "b2edc3747efc2b8e4819304cd87d7c263d7dbd6b", "filename": "crates/core_simd/src/intrinsics.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3d9bbf9b86f9f41d9ea5fe649343f3d763003866/crates%2Fcore_simd%2Fsrc%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d9bbf9b86f9f41d9ea5fe649343f3d763003866/crates%2Fcore_simd%2Fsrc%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fintrinsics.rs?ref=3d9bbf9b86f9f41d9ea5fe649343f3d763003866", "patch": "@@ -39,4 +39,10 @@ extern \"platform-intrinsic\" {\n \n     /// fptoui/fptosi/uitofp/sitofp\n     pub(crate) fn simd_cast<T, U>(x: T) -> U;\n+\n+    // floor\n+    pub(crate) fn simd_floor<T>(x: T) -> T;\n+\n+    // ceil\n+    pub(crate) fn simd_ceil<T>(x: T) -> T;\n }"}, {"sha": "0529bbe0080cc0c10ed735ec37ec0dc878a9c310", "filename": "crates/core_simd/src/round.rs", "status": "modified", "additions": 10, "deletions": 75, "changes": 85, "blob_url": "https://github.com/rust-lang/rust/blob/3d9bbf9b86f9f41d9ea5fe649343f3d763003866/crates%2Fcore_simd%2Fsrc%2Fround.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d9bbf9b86f9f41d9ea5fe649343f3d763003866/crates%2Fcore_simd%2Fsrc%2Fround.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fround.rs?ref=3d9bbf9b86f9f41d9ea5fe649343f3d763003866", "patch": "@@ -1,60 +1,23 @@\n macro_rules! implement {\n     {\n         impl $type:ident {\n-            int_type = $int_type:ident,\n-            floor = $floor_intrinsic:literal,\n-            ceil = $ceil_intrinsic:literal,\n-            round = $round_intrinsic:literal,\n-            trunc = $trunc_intrinsic:literal,\n+            int_type = $int_type:ident\n         }\n     } => {\n         mod $type {\n-            #[allow(improper_ctypes)]\n-            extern \"C\" {\n-                #[link_name = $floor_intrinsic]\n-                fn floor_intrinsic(x: crate::$type) -> crate::$type;\n-                #[link_name = $ceil_intrinsic]\n-                fn ceil_intrinsic(x: crate::$type) -> crate::$type;\n-                #[link_name = $round_intrinsic]\n-                fn round_intrinsic(x: crate::$type) -> crate::$type;\n-                #[link_name = $trunc_intrinsic]\n-                fn trunc_intrinsic(x: crate::$type) -> crate::$type;\n-            }\n-\n             impl crate::$type {\n                 /// Returns the largest integer less than or equal to each lane.\n                 #[must_use = \"method returns a new vector and does not mutate the original value\"]\n                 #[inline]\n                 pub fn floor(self) -> Self {\n-                    unsafe { floor_intrinsic(self) }\n+                    unsafe { crate::intrinsics::simd_floor(self) }\n                 }\n \n                 /// Returns the smallest integer greater than or equal to each lane.\n                 #[must_use = \"method returns a new vector and does not mutate the original value\"]\n                 #[inline]\n                 pub fn ceil(self) -> Self {\n-                    unsafe { ceil_intrinsic(self) }\n-                }\n-\n-                /// Returns the nearest integer to each lane. Round half-way cases away from 0.0.\n-                #[must_use = \"method returns a new vector and does not mutate the original value\"]\n-                #[inline]\n-                pub fn round(self) -> Self {\n-                    unsafe { round_intrinsic(self) }\n-                }\n-\n-                /// Returns the integer part of each lane.\n-                #[must_use = \"method returns a new vector and does not mutate the original value\"]\n-                #[inline]\n-                pub fn trunc(self) -> Self {\n-                    unsafe { trunc_intrinsic(self) }\n-                }\n-\n-                /// Returns the fractional part of each lane.\n-                #[must_use = \"method returns a new vector and does not mutate the original value\"]\n-                #[inline]\n-                pub fn fract(self) -> Self {\n-                    self - self.trunc()\n+                    unsafe { crate::intrinsics::simd_ceil(self) }\n                 }\n \n                 /// Rounds toward zero and converts to the same-width integer type, assuming that\n@@ -84,70 +47,42 @@ macro_rules! implement {\n \n implement! {\n     impl f32x2 {\n-        int_type = i32x2,\n-        floor = \"llvm.floor.v2f32\",\n-        ceil = \"llvm.ceil.v2f32\",\n-        round = \"llvm.round.v2f32\",\n-        trunc = \"llvm.trunc.v2f32\",\n+        int_type = i32x2\n     }\n }\n \n implement! {\n     impl f32x4 {\n-        int_type = i32x4,\n-        floor = \"llvm.floor.v4f32\",\n-        ceil = \"llvm.ceil.v4f32\",\n-        round = \"llvm.round.v4f32\",\n-        trunc = \"llvm.trunc.v4f32\",\n+        int_type = i32x4\n     }\n }\n \n implement! {\n     impl f32x8 {\n-        int_type = i32x8,\n-        floor = \"llvm.floor.v8f32\",\n-        ceil = \"llvm.ceil.v8f32\",\n-        round = \"llvm.round.v8f32\",\n-        trunc = \"llvm.trunc.v8f32\",\n+        int_type = i32x8\n     }\n }\n \n implement! {\n     impl f32x16 {\n-        int_type = i32x16,\n-        floor = \"llvm.floor.v16f32\",\n-        ceil = \"llvm.ceil.v16f32\",\n-        round = \"llvm.round.v16f32\",\n-        trunc = \"llvm.trunc.v16f32\",\n+        int_type = i32x16\n     }\n }\n \n implement! {\n     impl f64x2 {\n-        int_type = i64x2,\n-        floor = \"llvm.floor.v2f64\",\n-        ceil = \"llvm.ceil.v2f64\",\n-        round = \"llvm.round.v2f64\",\n-        trunc = \"llvm.trunc.v2f64\",\n+        int_type = i64x2\n     }\n }\n \n implement! {\n     impl f64x4 {\n-        int_type = i64x4,\n-        floor = \"llvm.floor.v4f64\",\n-        ceil = \"llvm.ceil.v4f64\",\n-        round = \"llvm.round.v4f64\",\n-        trunc = \"llvm.trunc.v4f64\",\n+        int_type = i64x4\n     }\n }\n \n implement! {\n     impl f64x8 {\n-        int_type = i64x8,\n-        floor = \"llvm.floor.v8f64\",\n-        ceil = \"llvm.ceil.v8f64\",\n-        round = \"llvm.round.v8f64\",\n-        trunc = \"llvm.trunc.v8f64\",\n+        int_type = i64x8\n     }\n }"}]}