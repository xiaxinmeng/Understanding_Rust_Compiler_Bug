{"sha": "ea7eb49b478a5f656f62f3e3664009194408ecf0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhN2ViNDliNDc4YTVmNjU2ZjYyZjNlMzY2NDAwOTE5NDQwOGVjZjA=", "commit": {"author": {"name": "Wilco Kusee", "email": "wilcokusee@gmail.com", "date": "2019-01-13T10:53:43Z"}, "committer": {"name": "Wilco Kusee", "email": "wilcokusee@gmail.com", "date": "2019-01-13T10:53:43Z"}, "message": "Disable deprecated_cfg_attr lint for inner attributes", "tree": {"sha": "d9170b5226038be9c0bdcc40e210101ec0253ee5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d9170b5226038be9c0bdcc40e210101ec0253ee5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea7eb49b478a5f656f62f3e3664009194408ecf0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea7eb49b478a5f656f62f3e3664009194408ecf0", "html_url": "https://github.com/rust-lang/rust/commit/ea7eb49b478a5f656f62f3e3664009194408ecf0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea7eb49b478a5f656f62f3e3664009194408ecf0/comments", "author": {"login": "detrumi", "id": 5758008, "node_id": "MDQ6VXNlcjU3NTgwMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/5758008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/detrumi", "html_url": "https://github.com/detrumi", "followers_url": "https://api.github.com/users/detrumi/followers", "following_url": "https://api.github.com/users/detrumi/following{/other_user}", "gists_url": "https://api.github.com/users/detrumi/gists{/gist_id}", "starred_url": "https://api.github.com/users/detrumi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/detrumi/subscriptions", "organizations_url": "https://api.github.com/users/detrumi/orgs", "repos_url": "https://api.github.com/users/detrumi/repos", "events_url": "https://api.github.com/users/detrumi/events{/privacy}", "received_events_url": "https://api.github.com/users/detrumi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "detrumi", "id": 5758008, "node_id": "MDQ6VXNlcjU3NTgwMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/5758008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/detrumi", "html_url": "https://github.com/detrumi", "followers_url": "https://api.github.com/users/detrumi/followers", "following_url": "https://api.github.com/users/detrumi/following{/other_user}", "gists_url": "https://api.github.com/users/detrumi/gists{/gist_id}", "starred_url": "https://api.github.com/users/detrumi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/detrumi/subscriptions", "organizations_url": "https://api.github.com/users/detrumi/orgs", "repos_url": "https://api.github.com/users/detrumi/repos", "events_url": "https://api.github.com/users/detrumi/events{/privacy}", "received_events_url": "https://api.github.com/users/detrumi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0083e2b989152e3c24a0da6d8fdab48993b2e16", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0083e2b989152e3c24a0da6d8fdab48993b2e16", "html_url": "https://github.com/rust-lang/rust/commit/c0083e2b989152e3c24a0da6d8fdab48993b2e16"}], "stats": {"total": 54, "additions": 40, "deletions": 14}, "files": [{"sha": "a3f2cc6a23b9e18aafbef5f579ff1ce7691a37d0", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ea7eb49b478a5f656f62f3e3664009194408ecf0/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7eb49b478a5f656f62f3e3664009194408ecf0/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=ea7eb49b478a5f656f62f3e3664009194408ecf0", "patch": "@@ -511,18 +511,17 @@ impl EarlyLintPass for CfgAttrPass {\n             // check for `rustfmt_skip` and `rustfmt::skip`\n             if let Some(skip_item) = &items[1].meta_item();\n             if skip_item.name() == \"rustfmt_skip\" || skip_item.name() == \"skip\";\n+            // Only lint outer attributes, because custom inner attributes are unstable\n+            // Tracking issue: https://github.com/rust-lang/rust/issues/54726\n+            if let AttrStyle::Outer = attr.style;\n             then {\n-                let attr_style = match attr.style {\n-                    AttrStyle::Outer => \"#[\",\n-                    AttrStyle::Inner => \"#![\",\n-                };\n                 span_lint_and_sugg(\n                     cx,\n                     DEPRECATED_CFG_ATTR,\n                     attr.span,\n                     \"`cfg_attr` is deprecated for rustfmt and got replaced by tool_attributes\",\n                     \"use\",\n-                    format!(\"{}rustfmt::skip]\", attr_style),\n+                    \"#[rustfmt::skip]\".to_string(),\n                     Applicability::MachineApplicable,\n                 );\n             }"}, {"sha": "4e583a25b94c2a517555585caf76f5631e263847", "filename": "tests/ui/cfg_attr_rustfmt.fixed", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/ea7eb49b478a5f656f62f3e3664009194408ecf0/tests%2Fui%2Fcfg_attr_rustfmt.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/ea7eb49b478a5f656f62f3e3664009194408ecf0/tests%2Fui%2Fcfg_attr_rustfmt.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcfg_attr_rustfmt.fixed?ref=ea7eb49b478a5f656f62f3e3664009194408ecf0", "patch": "@@ -0,0 +1,31 @@\n+// run-rustfix\n+#![feature(stmt_expr_attributes)]\n+\n+#![allow(unused, clippy::no_effect)]\n+#![warn(clippy::deprecated_cfg_attr)]\n+\n+// This doesn't get linted, see known problems\n+#![cfg_attr(rustfmt, rustfmt_skip)]\n+\n+#[rustfmt::skip]\n+trait Foo\n+{\n+fn foo(\n+);\n+}\n+\n+fn skip_on_statements() {\n+    #[rustfmt::skip]\n+    5+3;\n+}\n+\n+#[rustfmt::skip]\n+fn main() {\n+    foo::f();\n+}\n+\n+mod foo {\n+    #![cfg_attr(rustfmt, rustfmt_skip)]\n+\n+    pub fn f() {}\n+}"}, {"sha": "9c0fcf6fb454c4ac00a89b8bcb1b5b34aa58e2cf", "filename": "tests/ui/cfg_attr_rustfmt.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ea7eb49b478a5f656f62f3e3664009194408ecf0/tests%2Fui%2Fcfg_attr_rustfmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7eb49b478a5f656f62f3e3664009194408ecf0/tests%2Fui%2Fcfg_attr_rustfmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcfg_attr_rustfmt.rs?ref=ea7eb49b478a5f656f62f3e3664009194408ecf0", "patch": "@@ -1,5 +1,7 @@\n+// run-rustfix\n #![feature(stmt_expr_attributes)]\n \n+#![allow(unused, clippy::no_effect)]\n #![warn(clippy::deprecated_cfg_attr)]\n \n // This doesn't get linted, see known problems"}, {"sha": "09971caceea89de25315756b306e18adaca94d10", "filename": "tests/ui/cfg_attr_rustfmt.stderr", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ea7eb49b478a5f656f62f3e3664009194408ecf0/tests%2Fui%2Fcfg_attr_rustfmt.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ea7eb49b478a5f656f62f3e3664009194408ecf0/tests%2Fui%2Fcfg_attr_rustfmt.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcfg_attr_rustfmt.stderr?ref=ea7eb49b478a5f656f62f3e3664009194408ecf0", "patch": "@@ -1,22 +1,16 @@\n error: `cfg_attr` is deprecated for rustfmt and got replaced by tool_attributes\n-  --> $DIR/cfg_attr_rustfmt.rs:16:5\n+  --> $DIR/cfg_attr_rustfmt.rs:18:5\n    |\n LL |     #[cfg_attr(rustfmt, rustfmt::skip)]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use: `#[rustfmt::skip]`\n    |\n    = note: `-D clippy::deprecated-cfg-attr` implied by `-D warnings`\n \n error: `cfg_attr` is deprecated for rustfmt and got replaced by tool_attributes\n-  --> $DIR/cfg_attr_rustfmt.rs:20:1\n+  --> $DIR/cfg_attr_rustfmt.rs:22:1\n    |\n LL | #[cfg_attr(rustfmt, rustfmt_skip)]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use: `#[rustfmt::skip]`\n \n-error: `cfg_attr` is deprecated for rustfmt and got replaced by tool_attributes\n-  --> $DIR/cfg_attr_rustfmt.rs:26:5\n-   |\n-LL |     #![cfg_attr(rustfmt, rustfmt_skip)]\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use: `#![rustfmt::skip]`\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n "}]}