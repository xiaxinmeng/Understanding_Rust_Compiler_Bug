{"sha": "6ee31e2af7b512bdcc85beabadf2e91152217040", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlZTMxZTJhZjdiNTEyYmRjYzg1YmVhYmFkZjJlOTExNTIyMTcwNDA=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-12-06T21:19:26Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-12-07T10:28:03Z"}, "message": "escape-upvar-ref: patch comment per arielb1", "tree": {"sha": "8259ec21cf610a3f58f88b8eee4d88a916bcd1f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8259ec21cf610a3f58f88b8eee4d88a916bcd1f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ee31e2af7b512bdcc85beabadf2e91152217040", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ee31e2af7b512bdcc85beabadf2e91152217040", "html_url": "https://github.com/rust-lang/rust/commit/6ee31e2af7b512bdcc85beabadf2e91152217040", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ee31e2af7b512bdcc85beabadf2e91152217040/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b657d378ee593b424f964293708f65a7da74ca9", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b657d378ee593b424f964293708f65a7da74ca9", "html_url": "https://github.com/rust-lang/rust/commit/8b657d378ee593b424f964293708f65a7da74ca9"}], "stats": {"total": 35, "additions": 21, "deletions": 14}, "files": [{"sha": "548a5ae59690c0bac938a6a1acf402d32ca71465", "filename": "src/test/ui/nll/closure-requirements/escape-upvar-ref.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6ee31e2af7b512bdcc85beabadf2e91152217040/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fescape-upvar-ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ee31e2af7b512bdcc85beabadf2e91152217040/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fescape-upvar-ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fescape-upvar-ref.rs?ref=6ee31e2af7b512bdcc85beabadf2e91152217040", "patch": "@@ -9,8 +9,15 @@\n // except according to those terms.\n \n // Test closure that:\n-// - captures a variable `y`\n-// - stores reference to `y` into another, longer-lived spot\n+//\n+// - captures a variable `y` by reference\n+// - stores that reference to `y` into another, longer-lived place (`p`)\n+//\n+// Both of these are upvars of reference type (the capture of `y` is\n+// of type `&'a i32`, the capture of `p` is of type `&mut &'b\n+// i32`). The closure thus computes a relationship between `'a` and\n+// `'b`.  This relationship is propagated to the closure creator,\n+// which reports an error.\n \n // compile-flags:-Znll -Zborrowck=mir -Zverbose\n "}, {"sha": "47ba66ade6533ed4bed408710cb97f1cf828cf3a", "filename": "src/test/ui/nll/closure-requirements/escape-upvar-ref.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/6ee31e2af7b512bdcc85beabadf2e91152217040/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fescape-upvar-ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6ee31e2af7b512bdcc85beabadf2e91152217040/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fescape-upvar-ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fescape-upvar-ref.stderr?ref=6ee31e2af7b512bdcc85beabadf2e91152217040", "patch": "@@ -1,7 +1,7 @@\n note: External requirements\n-  --> $DIR/escape-upvar-ref.rs:26:27\n+  --> $DIR/escape-upvar-ref.rs:33:27\n    |\n-26 |         let mut closure = || p = &y;\n+33 |         let mut closure = || p = &y;\n    |                           ^^^^^^^^^\n    |\n    = note: defining type: DefId(0/1:9 ~ escape_upvar_ref[317d]::test[0]::{{closure}}[0]) with closure substs [\n@@ -14,26 +14,26 @@ note: External requirements\n    = note: where '_#3r: '_#2r\n \n note: No external requirements\n-  --> $DIR/escape-upvar-ref.rs:20:1\n+  --> $DIR/escape-upvar-ref.rs:27:1\n    |\n-20 | / fn test() {\n-21 | |     let x = 44;\n-22 | |     let mut p = &x;\n-23 | |\n+27 | / fn test() {\n+28 | |     let x = 44;\n+29 | |     let mut p = &x;\n+30 | |\n ...  |\n-30 | |     deref(p);\n-31 | | }\n+37 | |     deref(p);\n+38 | | }\n    | |_^\n    |\n    = note: defining type: DefId(0/0:3 ~ escape_upvar_ref[317d]::test[0]) with substs []\n \n error[E0597]: borrowed value does not live long enough\n-  --> $DIR/escape-upvar-ref.rs:28:6\n+  --> $DIR/escape-upvar-ref.rs:35:6\n    |\n-25 |         let y = 22;\n+32 |         let y = 22;\n    |             - temporary value created here\n ...\n-28 |     } //~ ERROR borrowed value does not live long enough\n+35 |     } //~ ERROR borrowed value does not live long enough\n    |      ^ temporary value dropped here while still borrowed\n    |\n    = note: consider using a `let` binding to increase its lifetime"}]}