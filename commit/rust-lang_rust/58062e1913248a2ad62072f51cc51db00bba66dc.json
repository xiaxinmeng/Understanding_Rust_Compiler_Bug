{"sha": "58062e1913248a2ad62072f51cc51db00bba66dc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4MDYyZTE5MTMyNDhhMmFkNjIwNzJmNTFjYzUxZGIwMGJiYTY2ZGM=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-06-14T21:44:08Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-06-14T21:46:15Z"}, "message": "shim.rs: improve docs a bit", "tree": {"sha": "f57ca7458389c0917ce7f25fe2e06c68320d0166", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f57ca7458389c0917ce7f25fe2e06c68320d0166"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/58062e1913248a2ad62072f51cc51db00bba66dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/58062e1913248a2ad62072f51cc51db00bba66dc", "html_url": "https://github.com/rust-lang/rust/commit/58062e1913248a2ad62072f51cc51db00bba66dc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/58062e1913248a2ad62072f51cc51db00bba66dc/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26e17ae8892d0232e8f519e0c79cde44d5fd046b", "url": "https://api.github.com/repos/rust-lang/rust/commits/26e17ae8892d0232e8f519e0c79cde44d5fd046b", "html_url": "https://github.com/rust-lang/rust/commit/26e17ae8892d0232e8f519e0c79cde44d5fd046b"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "4908e63da8274dd3556330b9a8e0ef8179788296", "filename": "src/librustc_mir/shim.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/58062e1913248a2ad62072f51cc51db00bba66dc/src%2Flibrustc_mir%2Fshim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58062e1913248a2ad62072f51cc51db00bba66dc/src%2Flibrustc_mir%2Fshim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fshim.rs?ref=58062e1913248a2ad62072f51cc51db00bba66dc", "patch": "@@ -130,14 +130,28 @@ fn make_shim<'tcx>(tcx: TyCtxt<'tcx>, instance: ty::InstanceDef<'tcx>) -> Body<'\n \n #[derive(Copy, Clone, Debug, PartialEq)]\n enum Adjustment {\n+    /// Pass the receiver as-is.\n     Identity,\n+\n+    /// We get passed `&[mut] self` and call the target with `*self`.\n+    ///\n+    /// This either copies `self` (if `Self: Copy`, eg. for function items), or moves out of it\n+    /// (for `VtableShim`, which effectively is passed `&own Self`).\n     Deref,\n+\n+    /// We get passed `self: Self` and call the target with `&mut self`.\n+    ///\n+    /// In this case we need to ensure that the `Self` is dropped after the call, as the callee\n+    /// won't do it for us.\n     RefMut,\n }\n \n #[derive(Copy, Clone, Debug, PartialEq)]\n enum CallKind {\n+    /// Call the `FnPtr` that was passed as the receiver.\n     Indirect,\n+\n+    /// Call a known `FnDef`.\n     Direct(DefId),\n }\n \n@@ -722,7 +736,10 @@ fn build_call_shim<'tcx>(\n     });\n \n     let (callee, mut args) = match call_kind {\n+        // `FnPtr` call has no receiver. Args are untupled below.\n         CallKind::Indirect => (rcvr.unwrap(), vec![]),\n+\n+        // `FnDef` call with optional receiver.\n         CallKind::Direct(def_id) => {\n             let ty = tcx.type_of(def_id);\n             ("}]}