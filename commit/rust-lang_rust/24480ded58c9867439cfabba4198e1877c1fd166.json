{"sha": "24480ded58c9867439cfabba4198e1877c1fd166", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0NDgwZGVkNThjOTg2NzQzOWNmYWJiYTQxOThlMTg3N2MxZmQxNjY=", "commit": {"author": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-05-10T23:41:41Z"}, "committer": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-05-19T02:25:51Z"}, "message": "Add method-toggle to <details> for methods.\n\nThe makes the code for handling \"auto-hide\" settings more consistent.", "tree": {"sha": "0ef938a568893296c67a6fedc5d8205540619dd6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ef938a568893296c67a6fedc5d8205540619dd6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/24480ded58c9867439cfabba4198e1877c1fd166", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/24480ded58c9867439cfabba4198e1877c1fd166", "html_url": "https://github.com/rust-lang/rust/commit/24480ded58c9867439cfabba4198e1877c1fd166", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/24480ded58c9867439cfabba4198e1877c1fd166/comments", "author": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "491cf5561efb1f5ff33c3234ccd0bc5cacbebe3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/491cf5561efb1f5ff33c3234ccd0bc5cacbebe3e", "html_url": "https://github.com/rust-lang/rust/commit/491cf5561efb1f5ff33c3234ccd0bc5cacbebe3e"}], "stats": {"total": 25, "additions": 10, "deletions": 15}, "files": [{"sha": "318e1b44f86830f427b2a5fe1e2ae56a1f988beb", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/24480ded58c9867439cfabba4198e1877c1fd166/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24480ded58c9867439cfabba4198e1877c1fd166/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=24480ded58c9867439cfabba4198e1877c1fd166", "patch": "@@ -1352,8 +1352,11 @@ fn render_impl(\n         }\n         let w = if short_documented && trait_.is_some() { interesting } else { boring };\n \n-        if !doc_buffer.is_empty() {\n-            w.write_str(\"<details class=\\\"rustdoc-toggle\\\" open><summary>\");\n+        let toggled = !doc_buffer.is_empty();\n+        if toggled {\n+            let method_toggle_class =\n+                if item_type == ItemType::Method { \" method-toggle\" } else { \"\" };\n+            write!(w, \"<details class=\\\"rustdoc-toggle{}\\\" open><summary>\", method_toggle_class);\n         }\n         match *item.kind {\n             clean::MethodItem(..) | clean::TyMethodItem(_) => {\n@@ -1453,7 +1456,7 @@ fn render_impl(\n         }\n \n         w.push_buffer(info_buffer);\n-        if !doc_buffer.is_empty() {\n+        if toggled {\n             w.write_str(\"</summary>\");\n             w.push_buffer(doc_buffer);\n             w.push_str(\"</details>\");"}, {"sha": "83e6a529b0aa43116c0e9aec6cdecb3150b44440", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/24480ded58c9867439cfabba4198e1877c1fd166/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/24480ded58c9867439cfabba4198e1877c1fd166/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=24480ded58c9867439cfabba4198e1877c1fd166", "patch": "@@ -924,24 +924,16 @@ function hideThemeButtonState() {\n             });\n         }\n \n-        if (hideMethodDocs) {\n-            onEachLazy(document.getElementsByClassName(\"method\"), function(e) {\n-                var toggle = e.parentNode;\n-                if (toggle) {\n-                    toggle = toggle.parentNode;\n-                }\n-                if (toggle && toggle.tagName === \"DETAILS\") {\n-                    toggle.open = false;\n-                }\n-            });\n-        }\n-\n         onEachLazy(document.getElementsByTagName(\"details\"), function (e) {\n             var showLargeItem = !hideLargeItemContents && hasClass(e, \"type-contents-toggle\");\n             var showImplementor = !hideImplementors && hasClass(e, \"implementors-toggle\");\n             if (showLargeItem || showImplementor) {\n                 e.open = true;\n             }\n+            if (hideMethodDocs && hasClass(e, \"method-toggle\")) {\n+                e.open = false;\n+            }\n+\n         });\n \n         var currentType = document.getElementsByClassName(\"type-decl\")[0];"}]}