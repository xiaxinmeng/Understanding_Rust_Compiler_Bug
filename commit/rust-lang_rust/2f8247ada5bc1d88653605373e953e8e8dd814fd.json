{"sha": "2f8247ada5bc1d88653605373e953e8e8dd814fd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmODI0N2FkYTViYzFkODg2NTM2MDUzNzNlOTUzZThlOGRkODE0ZmQ=", "commit": {"author": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2016-08-05T16:50:02Z"}, "committer": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2016-08-05T16:50:23Z"}, "message": "Lint literal suffixes not separated by underscores (see #703)", "tree": {"sha": "900c1e987d9430a690f74307a282fa4dc1349d09", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/900c1e987d9430a690f74307a282fa4dc1349d09"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f8247ada5bc1d88653605373e953e8e8dd814fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f8247ada5bc1d88653605373e953e8e8dd814fd", "html_url": "https://github.com/rust-lang/rust/commit/2f8247ada5bc1d88653605373e953e8e8dd814fd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f8247ada5bc1d88653605373e953e8e8dd814fd/comments", "author": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "committer": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ab58331f220a77538eb02ad1bef828ca7230e7ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab58331f220a77538eb02ad1bef828ca7230e7ac", "html_url": "https://github.com/rust-lang/rust/commit/ab58331f220a77538eb02ad1bef828ca7230e7ac"}], "stats": {"total": 93, "additions": 77, "deletions": 16}, "files": [{"sha": "d83611f1fd30d2c3c11972c555e7f198d77895a1", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd", "patch": "@@ -281,6 +281,7 @@ All notable changes to this project will be documented in this file.\n [`unnecessary_operation`]: https://github.com/Manishearth/rust-clippy/wiki#unnecessary_operation\n [`unneeded_field_pattern`]: https://github.com/Manishearth/rust-clippy/wiki#unneeded_field_pattern\n [`unsafe_removed_from_name`]: https://github.com/Manishearth/rust-clippy/wiki#unsafe_removed_from_name\n+[`unseparated_literal_suffix`]: https://github.com/Manishearth/rust-clippy/wiki#unseparated_literal_suffix\n [`unstable_as_mut_slice`]: https://github.com/Manishearth/rust-clippy/wiki#unstable_as_mut_slice\n [`unstable_as_slice`]: https://github.com/Manishearth/rust-clippy/wiki#unstable_as_slice\n [`unused_collect`]: https://github.com/Manishearth/rust-clippy/wiki#unused_collect"}, {"sha": "0c8e391121984f06be79b32f06e3896c22f9c3e8", "filename": "README.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd", "patch": "@@ -17,7 +17,7 @@ Table of contents:\n \n ## Lints\n \n-There are 161 lints included in this crate:\n+There are 162 lints included in this crate:\n \n name                                                                                                                 | default | meaning\n ---------------------------------------------------------------------------------------------------------------------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n@@ -166,6 +166,7 @@ name\n [unnecessary_operation](https://github.com/Manishearth/rust-clippy/wiki#unnecessary_operation)                       | warn    | outer expressions with no effect\n [unneeded_field_pattern](https://github.com/Manishearth/rust-clippy/wiki#unneeded_field_pattern)                     | warn    | Struct fields are bound to a wildcard instead of using `..`\n [unsafe_removed_from_name](https://github.com/Manishearth/rust-clippy/wiki#unsafe_removed_from_name)                 | warn    | unsafe removed from name\n+[unseparated_literal_suffix](https://github.com/Manishearth/rust-clippy/wiki#unseparated_literal_suffix)             | allow   | literal suffixes should be separated with an underscore\n [unused_collect](https://github.com/Manishearth/rust-clippy/wiki#unused_collect)                                     | warn    | `collect()`ing an iterator without using the result; this is usually better written as a for loop\n [unused_label](https://github.com/Manishearth/rust-clippy/wiki#unused_label)                                         | warn    | unused label\n [unused_lifetimes](https://github.com/Manishearth/rust-clippy/wiki#unused_lifetimes)                                 | warn    | unused lifetimes in function definitions"}, {"sha": "08f5e6b242db9450702767e741906ec472b4555e", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd", "patch": "@@ -277,6 +277,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry) {\n         methods::RESULT_UNWRAP_USED,\n         methods::WRONG_PUB_SELF_CONVENTION,\n         misc::USED_UNDERSCORE_BINDING,\n+        misc_early::UNSEPARATED_LITERAL_SUFFIX,\n         mut_mut::MUT_MUT,\n         mutex_atomic::MUTEX_INTEGER,\n         non_expressive_names::SIMILAR_NAMES,"}, {"sha": "2c058f3bcc293306ad561c9fdd51ff67c3efc05a", "filename": "clippy_lints/src/misc_early.rs", "status": "modified", "additions": 59, "deletions": 11, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/clippy_lints%2Fsrc%2Fmisc_early.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/clippy_lints%2Fsrc%2Fmisc_early.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc_early.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd", "patch": "@@ -1,5 +1,6 @@\n use rustc::lint::*;\n use std::collections::HashMap;\n+use std::char;\n use syntax::ast::*;\n use syntax::codemap::Span;\n use syntax::visit::FnKind;\n@@ -79,14 +80,29 @@ declare_lint! {\n     \"letter digits in hex literals should be either completely upper- or lowercased\"\n }\n \n+/// **What it does:** Warns if literal suffixes are not separated by an underscore.\n+///\n+/// **Why is this bad?** It is much less readable.\n+///\n+/// **Known problems:** None.\n+///\n+/// **Example:**\n+/// ```rust\n+/// let y = 123832i32;\n+/// ```\n+declare_lint! {\n+    pub UNSEPARATED_LITERAL_SUFFIX, Allow,\n+    \"literal suffixes should be separated with an underscore\"\n+}\n+\n \n #[derive(Copy, Clone)]\n pub struct MiscEarly;\n \n impl LintPass for MiscEarly {\n     fn get_lints(&self) -> LintArray {\n         lint_array!(UNNEEDED_FIELD_PATTERN, DUPLICATE_UNDERSCORE_ARGUMENT, REDUNDANT_CLOSURE_CALL,\n-                    DOUBLE_NEG, MIXED_CASE_HEX_LITERALS)\n+                    DOUBLE_NEG, MIXED_CASE_HEX_LITERALS, UNSEPARATED_LITERAL_SUFFIX)\n     }\n }\n \n@@ -196,20 +212,52 @@ impl EarlyLintPass for MiscEarly {\n                 if_let_chain! {[\n                     let LitKind::Int(..) = lit.node,\n                     let Some(src) = snippet_opt(cx, lit.span),\n-                    src.starts_with(\"0x\")\n+                    let Some(firstch) = src.chars().next(),\n+                    char::to_digit(firstch, 10).is_some()\n                 ], {\n-                    let mut seen = (false, false);\n+                    let mut prev = '\\0';\n                     for ch in src.chars() {\n-                        match ch {\n-                            'a' ... 'f' => seen.0 = true,\n-                            'A' ... 'F' => seen.1 = true,\n-                            'i' | 'u'   => break,   // start of suffix already\n-                            _ => ()\n+                        if ch == 'i' || ch == 'u' {\n+                            if prev != '_' {\n+                                span_lint(cx, UNSEPARATED_LITERAL_SUFFIX, lit.span,\n+                                          \"integer type suffix should be separated by an underscore\");\n+                            }\n+                            break;\n                         }\n+                        prev = ch;\n                     }\n-                    if seen.0 && seen.1 {\n-                        span_lint(cx, MIXED_CASE_HEX_LITERALS, lit.span,\n-                                  \"inconsistent casing in hexadecimal literal\");\n+                    if src.starts_with(\"0x\") {\n+                        let mut seen = (false, false);\n+                        for ch in src.chars() {\n+                            match ch {\n+                                'a' ... 'f' => seen.0 = true,\n+                                'A' ... 'F' => seen.1 = true,\n+                                'i' | 'u'   => break,   // start of suffix already\n+                                _ => ()\n+                            }\n+                        }\n+                        if seen.0 && seen.1 {\n+                            span_lint(cx, MIXED_CASE_HEX_LITERALS, lit.span,\n+                                      \"inconsistent casing in hexadecimal literal\");\n+                        }\n+                    }\n+                }}\n+                if_let_chain! {[\n+                    let LitKind::Float(..) = lit.node,\n+                    let Some(src) = snippet_opt(cx, lit.span),\n+                    let Some(firstch) = src.chars().next(),\n+                    char::to_digit(firstch, 10).is_some()\n+                ], {\n+                    let mut prev = '\\0';\n+                    for ch in src.chars() {\n+                        if ch == 'f' {\n+                            if prev != '_' {\n+                                span_lint(cx, UNSEPARATED_LITERAL_SUFFIX, lit.span,\n+                                          \"float type suffix should be separated by an underscore\");\n+                            }\n+                            break;\n+                        }\n+                        prev = ch;\n                     }\n                 }}\n             }"}, {"sha": null, "filename": "tests/compile-fail/doc.rs", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fdoc.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd"}, {"sha": null, "filename": "tests/compile-fail/entry.rs", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fentry.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd"}, {"sha": "bee9688f58144c5bc5209f40daf348d2d139d5fa", "filename": "tests/compile-fail/filter_methods.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Ffilter_methods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Ffilter_methods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Ffilter_methods.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd", "patch": "@@ -8,17 +8,17 @@ fn main() {\n                               .map(|x| x * 2)\n                               .collect();\n \n-    let _: Vec<_> = vec![5i8; 6].into_iter() //~ERROR called `filter(p).flat_map(q)` on an `Iterator`\n+    let _: Vec<_> = vec![5_i8; 6].into_iter() //~ERROR called `filter(p).flat_map(q)` on an `Iterator`\n                                 .filter(|&x| x == 0)\n                                 .flat_map(|x| x.checked_mul(2))\n                                 .collect();\n \n-    let _: Vec<_> = vec![5i8; 6].into_iter() //~ERROR called `filter_map(p).flat_map(q)` on an `Iterator`\n+    let _: Vec<_> = vec![5_i8; 6].into_iter() //~ERROR called `filter_map(p).flat_map(q)` on an `Iterator`\n                                 .filter_map(|x| x.checked_mul(2))\n                                 .flat_map(|x| x.checked_mul(2))\n                                 .collect();\n \n-    let _: Vec<_> = vec![5i8; 6].into_iter() //~ERROR called `filter_map(p).map(q)` on an `Iterator`\n+    let _: Vec<_> = vec![5_i8; 6].into_iter() //~ERROR called `filter_map(p).map(q)` on an `Iterator`\n                                 .filter_map(|x| x.checked_mul(2))\n                                 .map(|x| x.checked_mul(2))\n                                 .collect();"}, {"sha": null, "filename": "tests/compile-fail/if_not_else.rs", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fif_not_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fif_not_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fif_not_else.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd"}, {"sha": "7645fb56e20029e7724b525b23517009b4b2b60e", "filename": "tests/compile-fail/literals.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fliterals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fliterals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fliterals.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd", "patch": "@@ -1,6 +1,7 @@\n #![feature(plugin)]\n #![plugin(clippy)]\n #![deny(mixed_case_hex_literals)]\n+#![deny(unseparated_literal_suffix)]\n #![allow(dead_code)]\n \n fn main() {\n@@ -12,4 +13,13 @@ fn main() {\n     let fail1 = 0xabCD;       //~ERROR inconsistent casing in hexadecimal literal\n     let fail2 = 0xabCD_u32;   //~ERROR inconsistent casing in hexadecimal literal\n     let fail2 = 0xabCD_isize; //~ERROR inconsistent casing in hexadecimal literal\n+\n+    let ok6 = 1234_i32;\n+    let ok7 = 1234_f32;\n+    let ok8 = 1234_isize;\n+    let fail3 = 1234i32;      //~ERROR integer type suffix should be separated\n+    let fail4 = 1234u32;      //~ERROR integer type suffix should be separated\n+    let fail5 = 1234isize;    //~ERROR integer type suffix should be separated\n+    let fail6 = 1234usize;    //~ERROR integer type suffix should be separated\n+    let fail7 = 1.5f32;       //~ERROR float type suffix should be separated\n }"}, {"sha": "1200e25cdbcea4689505d08a66bee2da2119649c", "filename": "tests/compile-fail/shadow.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f8247ada5bc1d88653605373e953e8e8dd814fd/tests%2Fcompile-fail%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fshadow.rs?ref=2f8247ada5bc1d88653605373e953e8e8dd814fd", "patch": "@@ -20,7 +20,7 @@ fn main() {\n     let y = 1;\n     let x = y; //~ERROR `x` is shadowed by `y`\n \n-    let o = Some(1u8);\n+    let o = Some(1_u8);\n \n     if let Some(p) = o { assert_eq!(1, p); }\n     match o {"}]}