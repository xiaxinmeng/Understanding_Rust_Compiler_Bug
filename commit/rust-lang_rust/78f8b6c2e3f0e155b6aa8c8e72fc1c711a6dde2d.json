{"sha": "78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4ZjhiNmMyZTNmMGUxNTViNmFhOGM4ZTcyZmMxYzcxMWE2ZGRlMmQ=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2016-05-17T22:02:04Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2016-05-17T22:02:04Z"}, "message": "Merge branch 'master' of github.com:rust-lang-nursery/rustfmt", "tree": {"sha": "ad2cb47b41019eb94ffc34db9b460305ec345a50", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ad2cb47b41019eb94ffc34db9b460305ec345a50"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d", "html_url": "https://github.com/rust-lang/rust/commit/78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff3ff5aa873efdb113758d4f6d950c07786e5e72", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff3ff5aa873efdb113758d4f6d950c07786e5e72", "html_url": "https://github.com/rust-lang/rust/commit/ff3ff5aa873efdb113758d4f6d950c07786e5e72"}, {"sha": "d0720a00a1f708bb495535d361a1a63f65234fc7", "url": "https://api.github.com/repos/rust-lang/rust/commits/d0720a00a1f708bb495535d361a1a63f65234fc7", "html_url": "https://github.com/rust-lang/rust/commit/d0720a00a1f708bb495535d361a1a63f65234fc7"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "fe521029cb5a75f3d5a1a17769357fd6ba4d5d7d", "filename": "src/rustfmt_diff.rs", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d/src%2Frustfmt_diff.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d/src%2Frustfmt_diff.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustfmt_diff.rs?ref=78f8b6c2e3f0e155b6aa8c8e72fc1c711a6dde2d", "patch": "@@ -1,6 +1,7 @@\n use std::collections::VecDeque;\n use diff;\n use term;\n+use std::io;\n \n #[derive(Debug, PartialEq)]\n pub enum DiffLine {\n@@ -87,8 +88,18 @@ pub fn make_diff(expected: &str, actual: &str, context_size: usize) -> Vec<Misma\n pub fn print_diff<F>(diff: Vec<Mismatch>, get_section_title: F)\n     where F: Fn(u32) -> String\n {\n-    let mut t = term::stdout().unwrap();\n+    if let Some(t) = term::stdout() {\n+        print_diff_fancy(diff, get_section_title, t);\n+    } else {\n+        print_diff_basic(diff, get_section_title);\n+    }\n+}\n \n+fn print_diff_fancy<F>(diff: Vec<Mismatch>,\n+                       get_section_title: F,\n+                       mut t: Box<term::Terminal<Output = io::Stdout>>)\n+    where F: Fn(u32) -> String\n+{\n     for mismatch in diff {\n         let title = get_section_title(mismatch.line_number);\n         writeln!(t, \"{}\", title).unwrap();\n@@ -112,3 +123,26 @@ pub fn print_diff<F>(diff: Vec<Mismatch>, get_section_title: F)\n         t.reset().unwrap();\n     }\n }\n+\n+pub fn print_diff_basic<F>(diff: Vec<Mismatch>, get_section_title: F)\n+    where F: Fn(u32) -> String\n+{\n+    for mismatch in diff {\n+        let title = get_section_title(mismatch.line_number);\n+        println!(\"{}\", title);\n+\n+        for line in mismatch.lines {\n+            match line {\n+                DiffLine::Context(ref str) => {\n+                    println!(\" {}\u23ce\", str);\n+                }\n+                DiffLine::Expected(ref str) => {\n+                    println!(\"+{}\u23ce\", str);\n+                }\n+                DiffLine::Resulting(ref str) => {\n+                    println!(\"-{}\u23ce\", str);\n+                }\n+            }\n+        }\n+    }\n+}"}]}