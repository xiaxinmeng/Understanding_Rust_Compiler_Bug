{"sha": "94879023ad6965ed6a2a3f0d50a961ef31e47c9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0ODc5MDIzYWQ2OTY1ZWQ2YTJhM2YwZDUwYTk2MWVmMzFlNDdjOWE=", "commit": {"author": {"name": "Tamir Duberstein", "email": "tamird@gmail.com", "date": "2018-04-08T02:50:19Z"}, "committer": {"name": "Tamir Duberstein", "email": "tamird@gmail.com", "date": "2018-04-08T22:57:59Z"}, "message": "rustbuild: canonicalize prefix `install_sh`\n\nTesting:\n```\n  $ git diff\n  diff --git a/config.toml.example b/config.toml.example\n  index 9dd3002506..b47bc490cd 100644\n  --- a/config.toml.example\n  +++ b/config.toml.example\n  @@ -196,7 +196,7 @@\n   [install]\n\n   # Instead of installing to /usr/local, install to this path instead.\n  -#prefix = \"/usr/local\"\n  +prefix = \"install-prefix\"\n\n   # Where to install system configuration files\n   # If this is a relative path, it will get installed in `prefix` above\n  $ mkdir install-prefix\n  $ ./x.py install -i --stage 0 --config config.toml.example\n  ...\n  $ ls install-prefix/\n  bin\tlib\tshare\n```\n\nCloses #36989.", "tree": {"sha": "bba675d54fa9ebe5abc9575c069cd95c6cc3c964", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bba675d54fa9ebe5abc9575c069cd95c6cc3c964"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94879023ad6965ed6a2a3f0d50a961ef31e47c9a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE/uKQcsWiEQj1Z6uEHB6YzI4Xu4kFAlrKnncACgkQHB6YzI4X\nu4lQnhAAuJTc1ClNNcJSdbFEqaAFyLxsjtYFg79Ul2p6WfESVnSjmBgpVf4gE5y+\nMtZwsckpeMpm8eZd5hA3QzGKRhiQMTlHQ/DYAM/y1YrHAkaRN8KSlI/ldkIxPaeX\nmBcv1KP/s4t+uwTII5Q3Y9jNebsWeOb+XcwkGjAMEIk7sVp5TnlgcfbjByWytZ8W\ngIFfGiBTCIVMEvOMBAHS3Mu3WiCK6cvk2kJ7s3QKu/u79lUC0MPigxkQbv+7yju7\nipzke36OnAMUrN0v/KJ0tSIUgfRwAP2i/LghZGv8Zc3coBim1s2xZFXPO888Bs4+\ntaXnnR50uPAfh80StB1XNB5QC1uRjmhw3+zdCOfJ1hwv+6AZJmgL8tUQU9mM5BfX\nVYKsfeao+x+f7n5jcgWfqOnhPCAfS/Z31fZUUp7T/ABus9aoLZHAhXdEh3mfqo2Y\nRyzB4IuMBp19HK9ggSacPHyLVwMxXn69Gl9VyjJR7SkapEmvqXmpNiDAvTLJS2oI\n5uCve8RP2sey/srsZKZEc2BKj7DronNVo319yISanGu8e18eR3DYnXBaeAHZtSpH\nOf8D4V+rcVaxAI/akqbvz9moz0BWExtlGWqRYjLJsZx2qaYn4MGodSlCSkzXYA6a\nVUVd4g4dvPbKd4ou2kB1Arzf7e3ufWi+YbFSnaAiu2djVnD7zYw=\n=wARr\n-----END PGP SIGNATURE-----", "payload": "tree bba675d54fa9ebe5abc9575c069cd95c6cc3c964\nparent b7da1aaff62c1394d56830dc975d24d99c7a4fd8\nauthor Tamir Duberstein <tamird@gmail.com> 1523155819 -0400\ncommitter Tamir Duberstein <tamird@gmail.com> 1523228279 -0400\n\nrustbuild: canonicalize prefix `install_sh`\n\nTesting:\n```\n  $ git diff\n  diff --git a/config.toml.example b/config.toml.example\n  index 9dd3002506..b47bc490cd 100644\n  --- a/config.toml.example\n  +++ b/config.toml.example\n  @@ -196,7 +196,7 @@\n   [install]\n\n   # Instead of installing to /usr/local, install to this path instead.\n  -#prefix = \"/usr/local\"\n  +prefix = \"install-prefix\"\n\n   # Where to install system configuration files\n   # If this is a relative path, it will get installed in `prefix` above\n  $ mkdir install-prefix\n  $ ./x.py install -i --stage 0 --config config.toml.example\n  ...\n  $ ls install-prefix/\n  bin\tlib\tshare\n```\n\nCloses #36989.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94879023ad6965ed6a2a3f0d50a961ef31e47c9a", "html_url": "https://github.com/rust-lang/rust/commit/94879023ad6965ed6a2a3f0d50a961ef31e47c9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94879023ad6965ed6a2a3f0d50a961ef31e47c9a/comments", "author": {"login": "tamird", "id": 1535036, "node_id": "MDQ6VXNlcjE1MzUwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1535036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tamird", "html_url": "https://github.com/tamird", "followers_url": "https://api.github.com/users/tamird/followers", "following_url": "https://api.github.com/users/tamird/following{/other_user}", "gists_url": "https://api.github.com/users/tamird/gists{/gist_id}", "starred_url": "https://api.github.com/users/tamird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tamird/subscriptions", "organizations_url": "https://api.github.com/users/tamird/orgs", "repos_url": "https://api.github.com/users/tamird/repos", "events_url": "https://api.github.com/users/tamird/events{/privacy}", "received_events_url": "https://api.github.com/users/tamird/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tamird", "id": 1535036, "node_id": "MDQ6VXNlcjE1MzUwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1535036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tamird", "html_url": "https://github.com/tamird", "followers_url": "https://api.github.com/users/tamird/followers", "following_url": "https://api.github.com/users/tamird/following{/other_user}", "gists_url": "https://api.github.com/users/tamird/gists{/gist_id}", "starred_url": "https://api.github.com/users/tamird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tamird/subscriptions", "organizations_url": "https://api.github.com/users/tamird/orgs", "repos_url": "https://api.github.com/users/tamird/repos", "events_url": "https://api.github.com/users/tamird/events{/privacy}", "received_events_url": "https://api.github.com/users/tamird/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7da1aaff62c1394d56830dc975d24d99c7a4fd8", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7da1aaff62c1394d56830dc975d24d99c7a4fd8", "html_url": "https://github.com/rust-lang/rust/commit/b7da1aaff62c1394d56830dc975d24d99c7a4fd8"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "d71fdb8a30c70d01be928a1fa2d0e30127b674c5", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/94879023ad6965ed6a2a3f0d50a961ef31e47c9a/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94879023ad6965ed6a2a3f0d50a961ef31e47c9a/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=94879023ad6965ed6a2a3f0d50a961ef31e47c9a", "patch": "@@ -72,7 +72,9 @@ fn install_sh(\n     let bindir_default = PathBuf::from(\"bin\");\n     let libdir_default = PathBuf::from(\"lib\");\n     let mandir_default = datadir_default.join(\"man\");\n-    let prefix = build.config.prefix.as_ref().unwrap_or(&prefix_default);\n+    let prefix = build.config.prefix.as_ref().map_or(prefix_default, |p| {\n+        fs::canonicalize(p).expect(&format!(\"could not canonicalize {}\", p.display()))\n+    });\n     let sysconfdir = build.config.sysconfdir.as_ref().unwrap_or(&sysconfdir_default);\n     let datadir = build.config.datadir.as_ref().unwrap_or(&datadir_default);\n     let docdir = build.config.docdir.as_ref().unwrap_or(&docdir_default);"}]}