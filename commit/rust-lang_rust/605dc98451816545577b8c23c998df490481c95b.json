{"sha": "605dc98451816545577b8c23c998df490481c95b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYwNWRjOTg0NTE4MTY1NDU1NzdiOGMyM2M5OThkZjQ5MDQ4MWM5NWI=", "commit": {"author": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-03-08T21:21:08Z"}, "committer": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-03-08T21:21:08Z"}, "message": "Omit unit struct hints", "tree": {"sha": "f253961081f924dc66b64efb74a9a992d6ceaf02", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f253961081f924dc66b64efb74a9a992d6ceaf02"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/605dc98451816545577b8c23c998df490481c95b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/605dc98451816545577b8c23c998df490481c95b", "html_url": "https://github.com/rust-lang/rust/commit/605dc98451816545577b8c23c998df490481c95b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/605dc98451816545577b8c23c998df490481c95b/comments", "author": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aff82cf7ac172f213cb5dcca637cb2c5332294c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/aff82cf7ac172f213cb5dcca637cb2c5332294c1", "html_url": "https://github.com/rust-lang/rust/commit/aff82cf7ac172f213cb5dcca637cb2c5332294c1"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "cf0cbdbd02a6c5bb9b7fb3565b842b72d3877a8b", "filename": "crates/ra_ide/src/inlay_hints.rs", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/605dc98451816545577b8c23c998df490481c95b/crates%2Fra_ide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/605dc98451816545577b8c23c998df490481c95b/crates%2Fra_ide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Finlay_hints.rs?ref=605dc98451816545577b8c23c998df490481c95b", "patch": "@@ -119,6 +119,12 @@ fn should_not_display_type_hint(db: &RootDatabase, bind_pat: &ast::BindPat, pat_\n         return true;\n     }\n \n+    if let Some(Adt::Struct(s)) = pat_ty.as_adt() {\n+        if s.fields(db).is_empty() && s.name(db).to_string() == bind_pat.syntax().to_string() {\n+            return true;\n+        }\n+    }\n+\n     for node in bind_pat.syntax().ancestors() {\n         match_ast! {\n             match node {\n@@ -943,4 +949,30 @@ fn main() {\n         \"###\n         );\n     }\n+\n+    #[test]\n+    fn unit_structs_have_no_type_hints() {\n+        let (analysis, file_id) = single_file(\n+            r#\"\n+enum CustomResult<T, E> {\n+    Ok(T),\n+    Err(E),\n+}\n+use CustomResult::*;\n+\n+struct SyntheticSyntax;\n+\n+fn main() {\n+    match Ok(()) {\n+        Ok(_) => (),\n+        Err(SyntheticSyntax) => (),\n+    }\n+}\"#,\n+        );\n+\n+        assert_debug_snapshot!(analysis.inlay_hints(file_id, Some(8)).unwrap(), @r###\"\n+        []\n+        \"###\n+        );\n+    }\n }"}]}