{"sha": "173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3M2NiZWNjNjZlZTFiYmI1NGMwMzlhMDBjM2I3NWI0Y2RmN2UyNzc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-03-21T02:39:29Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-04-12T15:45:45Z"}, "message": "rustdoc: smartly hide associated items of traits if there are too many of them", "tree": {"sha": "c7e9aabaf9aed47fb65a668a31c03b39aa051d7a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7e9aabaf9aed47fb65a668a31c03b39aa051d7a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "html_url": "https://github.com/rust-lang/rust/commit/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f146b9701df0e26dad61422089d3a7e9a49989c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/f146b9701df0e26dad61422089d3a7e9a49989c5", "html_url": "https://github.com/rust-lang/rust/commit/f146b9701df0e26dad61422089d3a7e9a49989c5"}], "stats": {"total": 42, "additions": 30, "deletions": 12}, "files": [{"sha": "8db78e7718dc1c1fc73398afd591b60a08dbcd67", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 24, "deletions": 6, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "patch": "@@ -443,17 +443,36 @@ fn item_trait(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, t: &clean::Tra\n         } else {\n             // FIXME: we should be using a derived_id for the Anchors here\n             w.write_str(\"{\\n\");\n+            let mut toggle = false;\n+\n+            // If there are too many associated types, hide _everything_\n+            if should_hide_fields(types.len()) {\n+                toggle = true;\n+                toggle_open(w, \"associated items\");\n+            }\n             for t in &types {\n                 render_assoc_item(w, t, AssocItemLink::Anchor(None), ItemType::Trait, cx);\n                 w.write_str(\";\\n\");\n             }\n+            // If there are too many associated constants, hide everything after them\n+            // We also do this if the types + consts is large because otherwise we could\n+            // render a bunch of types and _then_ a bunch of consts just because both were\n+            // _just_ under the limit\n+            if !toggle & should_hide_fields(types.len() + consts.len()) {\n+                toggle = true;\n+                toggle_open(w, \"associated constants and methods\");\n+            }\n             if !types.is_empty() && !consts.is_empty() {\n                 w.write_str(\"\\n\");\n             }\n             for t in &consts {\n                 render_assoc_item(w, t, AssocItemLink::Anchor(None), ItemType::Trait, cx);\n                 w.write_str(\";\\n\");\n             }\n+            if !toggle & should_hide_fields(required.len() + provided.len()) {\n+                toggle = true;\n+                toggle_open(w, \"methods\");\n+            }\n             if !consts.is_empty() && !required.is_empty() {\n                 w.write_str(\"\\n\");\n             }\n@@ -484,6 +503,9 @@ fn item_trait(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, t: &clean::Tra\n                     w.write_str(\"<div class=\\\"item-spacer\\\"></div>\");\n                 }\n             }\n+            if toggle {\n+                toggle_close(w);\n+            }\n             w.write_str(\"}\");\n         }\n         w.write_str(\"</pre>\")\n@@ -1284,9 +1306,7 @@ fn render_union(\n     write!(w, \" {{\\n{}\", tab);\n     let count_fields = fields\n         .iter()\n-        .filter(\n-            |f| if let clean::StructFieldItem(..) = *f.kind { true } else { false },\n-        )\n+        .filter(|f| if let clean::StructFieldItem(..) = *f.kind { true } else { false })\n         .count();\n     let toggle = should_hide_fields(count_fields);\n     if toggle {\n@@ -1343,9 +1363,7 @@ fn render_struct(\n             w.write_str(\" {\");\n             let count_fields = fields\n                 .iter()\n-                .filter(\n-                    |f| if let clean::StructFieldItem(..) = *f.kind { true } else { false },\n-                )\n+                .filter(|f| if let clean::StructFieldItem(..) = *f.kind { true } else { false })\n                 .count();\n             let has_visible_fields = count_fields > 0;\n             let toggle = should_hide_fields(count_fields);"}, {"sha": "309e55670b18a3bfc6a458a7aa85321168bffcdf", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "patch": "@@ -1058,8 +1058,8 @@ h3 > .collapse-toggle, h4 > .collapse-toggle {\n \tmargin-top: 3px;\n }\n \n-/* for enum and struct fields */\n-.enum > .toggle-wrapper + .docblock, .struct > .toggle-wrapper + .docblock, .union > .toggle-wrapper + .docblock {\n+/* for hiding fields/variants/associated items */\n+.enum > .toggle-wrapper + .docblock, .struct > .toggle-wrapper + .docblock, .union > .toggle-wrapper + .docblock, .trait > .toggle-wrapper + .docblock {\n \tmargin-left: 0px;\n }\n \n@@ -1785,7 +1785,7 @@ div.name.expand::before {\n .type-decl > pre > .docblock.attributes.top-attr {\n \tmargin-left: 1.8em !important;\n }\n-.type-decl > pre > .toggle-attributes {\n+.type-decl > pre .toggle-attributes {\n \tmargin-left: 2.2em;\n }\n .type-decl > pre > .docblock.attributes {"}, {"sha": "0404fa50b99f2f18c299a4aac82db114f3cd9d46", "filename": "src/librustdoc/html/static/themes/ayu.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css?ref=173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "patch": "@@ -218,7 +218,7 @@ a {\n \tcolor: #c5c5c5;\n }\n \n-.docblock:not(.type-decl) a:not(.srclink):not(.test-arrow),\n+.docblock:not(.type-decl) a:not(.srclink):not(.test-arrow):not(.collapse-toggle),\n .docblock-short a:not(.srclink):not(.test-arrow), .item-info a,\n #help a {\n \tcolor: #39AFD7;"}, {"sha": "15b485a966fdaec3bd9bf4f45ecfeffcce87b1c2", "filename": "src/librustdoc/html/static/themes/dark.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css?ref=173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "patch": "@@ -176,7 +176,7 @@ a {\n \tcolor: #ddd;\n }\n \n-.docblock:not(.type-decl) a:not(.srclink):not(.test-arrow),\n+.docblock:not(.type-decl) a:not(.srclink):not(.test-arrow):not(.collapse-toggle),\n .docblock-short a:not(.srclink):not(.test-arrow), .item-info a,\n #help a {\n \tcolor: #D2991D;"}, {"sha": "4c83879e234b78a4ec1b3d5f0e79f90aabe9a41c", "filename": "src/librustdoc/html/static/themes/light.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/173cbecc66ee1bbb54c039a00c3b75b4cdf7e277/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css?ref=173cbecc66ee1bbb54c039a00c3b75b4cdf7e277", "patch": "@@ -174,7 +174,7 @@ a {\n \tcolor: #000;\n }\n \n-.docblock:not(.type-decl) a:not(.srclink):not(.test-arrow),\n+.docblock:not(.type-decl) a:not(.srclink):not(.test-arrow):not(.collapse-toggle),\n .docblock-short a:not(.srclink):not(.test-arrow), .item-info a,\n #help a {\n \tcolor: #3873AD;"}]}