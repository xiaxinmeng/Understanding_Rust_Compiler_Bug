{"sha": "f2c191e9737c50659f0891dc36349c7b0539932f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyYzE5MWU5NzM3YzUwNjU5ZjA4OTFkYzM2MzQ5YzdiMDUzOTkzMmY=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-05-29T20:57:25Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-05-29T21:00:56Z"}, "message": "Add status buffer function to emacs integration\n\nAlso fix a minor race condition in the 'extend selection' initialization.", "tree": {"sha": "6ce3cefeaed5ca1a4f4142e0870f1baf1e1d5900", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ce3cefeaed5ca1a4f4142e0870f1baf1e1d5900"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2c191e9737c50659f0891dc36349c7b0539932f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2c191e9737c50659f0891dc36349c7b0539932f", "html_url": "https://github.com/rust-lang/rust/commit/f2c191e9737c50659f0891dc36349c7b0539932f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2c191e9737c50659f0891dc36349c7b0539932f/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cb21a219987eac0f8dc08f0c858e8a7154fccd04", "url": "https://api.github.com/repos/rust-lang/rust/commits/cb21a219987eac0f8dc08f0c858e8a7154fccd04", "html_url": "https://github.com/rust-lang/rust/commit/cb21a219987eac0f8dc08f0c858e8a7154fccd04"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "71bc20f17f6118e42d89cfc4772ecd168f5ea9d3", "filename": "editors/emacs/ra-emacs-lsp.el", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/f2c191e9737c50659f0891dc36349c7b0539932f/editors%2Femacs%2Fra-emacs-lsp.el", "raw_url": "https://github.com/rust-lang/rust/raw/f2c191e9737c50659f0891dc36349c7b0539932f/editors%2Femacs%2Fra-emacs-lsp.el", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Femacs%2Fra-emacs-lsp.el?ref=f2c191e9737c50659f0891dc36349c7b0539932f", "patch": "@@ -134,6 +134,13 @@\n                             '(rust-analyzer-extend-selection))))\n \n (with-eval-after-load 'expand-region\n+  ;; add the expansion for all existing rust-mode buffers. If expand-region is\n+  ;; loaded lazily, it might be loaded when the first rust buffer is opened, and\n+  ;; then it's too late for the hook for that buffer\n+  (dolist (buf (buffer-list))\n+    (with-current-buffer buf\n+      (when (eq 'rust-mode major-mode)\n+        (rust-analyzer--add-er-expansion))))\n   (add-hook 'rust-mode-hook 'rust-analyzer--add-er-expansion))\n \n ;; runnables\n@@ -170,5 +177,32 @@\n                          (rust-analyzer--select-runnable))))\n   (rust-analyzer-run (or runnable rust-analyzer--last-runnable)))\n \n+;; analyzer status buffer\n+(define-derived-mode rust-analyzer-status-mode special-mode \"Rust-Analyzer-Status\"\n+  \"Mode for the rust-analyzer status buffer.\")\n+\n+(defvar-local rust-analyzer--status-buffer-workspace nil)\n+\n+(defun rust-analyzer-status ()\n+  \"Displays status information for rust-analyzer.\"\n+  (interactive)\n+  (let* ((workspace (lsp-find-workspace 'rust-analyzer (buffer-file-name)))\n+         (buf (get-buffer-create (concat \"*rust-analyzer status \" (with-lsp-workspace workspace (lsp-workspace-root)) \"*\"))))\n+    (with-current-buffer buf\n+      (rust-analyzer-status-mode)\n+      (setq rust-analyzer--status-buffer-workspace workspace)\n+      (rust-analyzer-status-buffer-refresh))\n+    (pop-to-buffer buf)))\n+\n+(defun rust-analyzer-status-buffer-refresh ()\n+  (interactive)\n+  (when rust-analyzer--status-buffer-workspace\n+    (let ((inhibit-read-only t))\n+      (erase-buffer)\n+      (insert (with-lsp-workspace rust-analyzer--status-buffer-workspace\n+                (lsp-send-request (lsp-make-request\n+                                   \"rust-analyzer/analyzerStatus\")))))))\n+\n+\n (provide 'ra-emacs-lsp)\n ;;; ra-emacs-lsp.el ends here"}]}