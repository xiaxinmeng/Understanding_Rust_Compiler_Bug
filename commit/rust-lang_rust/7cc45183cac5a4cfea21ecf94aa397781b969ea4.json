{"sha": "7cc45183cac5a4cfea21ecf94aa397781b969ea4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdjYzQ1MTgzY2FjNWE0Y2ZlYTIxZWNmOTRhYTM5Nzc4MWI5NjllYTQ=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-06-19T12:29:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-19T12:29:18Z"}, "message": "Rollup merge of #72785 - petrochenkov:wholemsvc, r=matthewjasper\n\nlinker: MSVC supports linking static libraries as a whole archive", "tree": {"sha": "b5d564f67f1bfcdc78ef992b210bc714bffb6709", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5d564f67f1bfcdc78ef992b210bc714bffb6709"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7cc45183cac5a4cfea21ecf94aa397781b969ea4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe7K+eCRBK7hj4Ov3rIwAAdHIIAGZy2WYy0xblEmn/FD6Ozv74\ndiKtP0QrEH/PvYjk25347YJZtL1SpThp5efkTn+M7Q76wWBxeGpeyK8/RjwAnG7u\npO790nFJ1pbhnUslgX7P+F8Z7q9rn7aqmp1ghwGXpwAGOfXgOPaKhtMza44BJ5sL\n3fJxD6dncjStaDUpq5i6w3n30n8sKMNrY9V82MtsuF53BcJLsNJ+WhzcRYxf5593\nzXhwiloXmZE+11pl/kb4wGNRiIb6EmRtNz847smwFcp7kFlk0LaK5d+rMSSajwPJ\nhm9aY7vPOVtva7hzJdjtkWdbOIzHtUnmM2ebJP8W5EyCZxdKphshILHgLNkGwwA=\n=jEff\n-----END PGP SIGNATURE-----\n", "payload": "tree b5d564f67f1bfcdc78ef992b210bc714bffb6709\nparent 70622db43d5e0a58f8fe66ff15115e4fcbb5c274\nparent d1c275b350f9ae74be92114f4819d6afb55d6007\nauthor Ralf Jung <post@ralfj.de> 1592569758 +0200\ncommitter GitHub <noreply@github.com> 1592569758 +0200\n\nRollup merge of #72785 - petrochenkov:wholemsvc, r=matthewjasper\n\nlinker: MSVC supports linking static libraries as a whole archive\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7cc45183cac5a4cfea21ecf94aa397781b969ea4", "html_url": "https://github.com/rust-lang/rust/commit/7cc45183cac5a4cfea21ecf94aa397781b969ea4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7cc45183cac5a4cfea21ecf94aa397781b969ea4/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70622db43d5e0a58f8fe66ff15115e4fcbb5c274", "url": "https://api.github.com/repos/rust-lang/rust/commits/70622db43d5e0a58f8fe66ff15115e4fcbb5c274", "html_url": "https://github.com/rust-lang/rust/commit/70622db43d5e0a58f8fe66ff15115e4fcbb5c274"}, {"sha": "d1c275b350f9ae74be92114f4819d6afb55d6007", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1c275b350f9ae74be92114f4819d6afb55d6007", "html_url": "https://github.com/rust-lang/rust/commit/d1c275b350f9ae74be92114f4819d6afb55d6007"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "6011d422ca682c174549f72432a485e6e97f676a", "filename": "src/librustc_codegen_ssa/back/linker.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7cc45183cac5a4cfea21ecf94aa397781b969ea4/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7cc45183cac5a4cfea21ecf94aa397781b969ea4/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs?ref=7cc45183cac5a4cfea21ecf94aa397781b969ea4", "patch": "@@ -721,12 +721,14 @@ impl<'a> Linker for MsvcLinker<'a> {\n     }\n \n     fn link_whole_staticlib(&mut self, lib: Symbol, _search_path: &[PathBuf]) {\n-        // not supported?\n         self.link_staticlib(lib);\n+        self.cmd.arg(format!(\"/WHOLEARCHIVE:{}.lib\", lib));\n     }\n     fn link_whole_rlib(&mut self, path: &Path) {\n-        // not supported?\n         self.link_rlib(path);\n+        let mut arg = OsString::from(\"/WHOLEARCHIVE:\");\n+        arg.push(path);\n+        self.cmd.arg(arg);\n     }\n     fn optimize(&mut self) {\n         // Needs more investigation of `/OPT` arguments"}]}