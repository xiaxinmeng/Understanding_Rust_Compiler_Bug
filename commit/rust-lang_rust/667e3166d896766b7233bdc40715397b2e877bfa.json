{"sha": "667e3166d896766b7233bdc40715397b2e877bfa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2N2UzMTY2ZDg5Njc2NmI3MjMzYmRjNDA3MTUzOTdiMmU4NzdiZmE=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2017-03-24T23:13:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-03-24T23:13:09Z"}, "message": "Rollup merge of #40567 - clarcharr:rustdoc-sort, r=frewsxcv\n\nFix for #39596: sort Trait2 before Trait10.\n\nThis is a change discussed in #39596. Essentially, item names will be sorted as if they're (&str, u64) pairs instead of just `&str`, meaning that `\"Apple\" < \"Banana\"` and also `\"Fruit10\" > \"Fruit2\"`.\n\nSample sorting:\n\n1. Apple\n2. Banana\n3. Fruit\n4. Fruit0\n5. Fruit00\n6. Fruit1\n7. Fruit01\n8. Fruit2\n9. Fruit02\n10. Fruit20\n11. Fruit100\n12. Pear\n\nExamples of generated documentation:\nhttps://docs.charr.xyz/before-doc/test_sorting/\nhttps://docs.charr.xyz/after-doc/test_sorting/\n\nScreenshots of generated documentation:\nBefore: http://imgur.com/Ktb10ti\nAfter: http://imgur.com/CZJjqIN", "tree": {"sha": "3cadf0d882e3115333b958628484e2fb69c1214d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3cadf0d882e3115333b958628484e2fb69c1214d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/667e3166d896766b7233bdc40715397b2e877bfa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/667e3166d896766b7233bdc40715397b2e877bfa", "html_url": "https://github.com/rust-lang/rust/commit/667e3166d896766b7233bdc40715397b2e877bfa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/667e3166d896766b7233bdc40715397b2e877bfa/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8cf8fc9d8973a4d523c01dcba2ef991e0f2393d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/8cf8fc9d8973a4d523c01dcba2ef991e0f2393d7", "html_url": "https://github.com/rust-lang/rust/commit/8cf8fc9d8973a4d523c01dcba2ef991e0f2393d7"}, {"sha": "c09083c3d1b077df9adf3d6b4048677a15ba666e", "url": "https://api.github.com/repos/rust-lang/rust/commits/c09083c3d1b077df9adf3d6b4048677a15ba666e", "html_url": "https://github.com/rust-lang/rust/commit/c09083c3d1b077df9adf3d6b4048677a15ba666e"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "5c94032c6b9cf74df6fd754e13e4bd4b4079892a", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 49, "deletions": 1, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/667e3166d896766b7233bdc40715397b2e877bfa/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/667e3166d896766b7233bdc40715397b2e877bfa/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=667e3166d896766b7233bdc40715397b2e877bfa", "patch": "@@ -1700,6 +1700,23 @@ fn document_stability(w: &mut fmt::Formatter, cx: &Context, item: &clean::Item)\n     Ok(())\n }\n \n+fn name_key(name: &str) -> (&str, u64, usize) {\n+    // find number at end\n+    let split = name.bytes().rposition(|b| b < b'0' || b'9' < b).map_or(0, |s| s + 1);\n+\n+    // count leading zeroes\n+    let after_zeroes =\n+        name[split..].bytes().position(|b| b != b'0').map_or(name.len(), |extra| split + extra);\n+\n+    // sort leading zeroes last\n+    let num_zeroes = after_zeroes - split;\n+\n+    match name[split..].parse() {\n+        Ok(n) => (&name[..split], n, num_zeroes),\n+        Err(_) => (name, 0, num_zeroes),\n+    }\n+}\n+\n fn item_module(w: &mut fmt::Formatter, cx: &Context,\n                item: &clean::Item, items: &[clean::Item]) -> fmt::Result {\n     document(w, cx, item)?;\n@@ -1744,7 +1761,9 @@ fn item_module(w: &mut fmt::Formatter, cx: &Context,\n             (Some(stability::Stable), Some(stability::Unstable)) => return Ordering::Less,\n             _ => {}\n         }\n-        i1.name.cmp(&i2.name)\n+        let lhs = i1.name.as_ref().map_or(\"\", |s| &**s);\n+        let rhs = i2.name.as_ref().map_or(\"\", |s| &**s);\n+        name_key(lhs).cmp(&name_key(rhs))\n     }\n \n     indices.sort_by(|&i1, &i2| cmp(&items[i1], &items[i2], i1, i2));\n@@ -3198,3 +3217,32 @@ fn test_unique_id() {\n     reset_ids(true);\n     test();\n }\n+\n+#[cfg(test)]\n+#[test]\n+fn test_name_key() {\n+    assert_eq!(name_key(\"0\"), (\"\", 0, 1));\n+    assert_eq!(name_key(\"123\"), (\"\", 123, 0));\n+    assert_eq!(name_key(\"Fruit\"), (\"Fruit\", 0, 0));\n+    assert_eq!(name_key(\"Fruit0\"), (\"Fruit\", 0, 1));\n+    assert_eq!(name_key(\"Fruit0000\"), (\"Fruit\", 0, 4));\n+    assert_eq!(name_key(\"Fruit01\"), (\"Fruit\", 1, 1));\n+    assert_eq!(name_key(\"Fruit10\"), (\"Fruit\", 10, 0));\n+    assert_eq!(name_key(\"Fruit123\"), (\"Fruit\", 123, 0));\n+}\n+\n+#[cfg(test)]\n+#[test]\n+fn test_name_sorting() {\n+    let names = [\"Apple\",\n+                 \"Banana\",\n+                 \"Fruit\", \"Fruit0\", \"Fruit00\",\n+                 \"Fruit1\", \"Fruit01\",\n+                 \"Fruit2\", \"Fruit02\",\n+                 \"Fruit20\",\n+                 \"Fruit100\",\n+                 \"Pear\"];\n+    let mut sorted = names.to_owned();\n+    sorted.sort_by_key(|&s| name_key(s));\n+    assert_eq!(names, sorted);\n+}"}]}