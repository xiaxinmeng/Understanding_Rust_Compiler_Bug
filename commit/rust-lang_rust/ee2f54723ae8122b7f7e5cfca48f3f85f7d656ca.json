{"sha": "ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlMmY1NDcyM2FlODEyMmI3ZjdlNWNmY2E0OGYzZjg1ZjdkNjU2Y2E=", "commit": {"author": {"name": "Beno\u00eet CORTIER", "email": "benoit.cortier@fried-world.eu", "date": "2017-07-01T16:51:20Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2017-08-21T12:02:28Z"}, "message": "Finalize needless_borrowed_ref lint doc.\n\nMake sure the needless_borrowed_ref.stderr in examples is up to date\ntoo.", "tree": {"sha": "cfac89aae4d48732b49736632e5cef03ee8df90a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cfac89aae4d48732b49736632e5cef03ee8df90a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEYFTdM4NKd7XQft77pp+NIls619kFAlmay9cACgkQpp+NIls6\n19kdew/9GQy1wlt0C1bbJg57WHYOz0DqSUua+nkulxOAi2udrQnmOvw1wzjPa6dG\nFjh46md1JXf48di9rVYEBYNvohqEzNOFFw5+0ZTXGjUAva6/MPgfsZHhXNL0Dfkv\nLuha1tmzuF8jqwWfvQOqD3B/uTDiauM3r+qVUdn9WuvjWMNAaPq0MRhy3Gf1HV1b\no4srFma1TdEvW/4QffGCRUdIuI+TZRMcK7mnXLiuUHMJuCWcewD5quiIloPlgoCx\nLu/91fdci9+F80tMSBHAPIsIKyFehXnG7G1mkYnrKAWbvqoi2dyHQdatP7ifSVeE\nmSwurFuvhoK5S4BcDjt5oVWJAnA6amk2zWFME8xwPII2+DIm9PTcLi3U+kPKnFvE\nVVr/4LINFtQ4Wre4O5bjhkTbkhJd9Ot/zm1TuN9SeqFGDsA5baXqPC47F8KD0YkA\nFmAjOgJF5STr+VQA6BxDKSbfPvUZ3icZNH9mqeNR/r2X4Wt62dLrskgz4fG4QJ3J\nyEGiKmHLjB/fKNDzQsuLeF5ZLjRuXWiRSkxrx5Jsp6VT6kCr4xaePTw6a2fa8JLC\ny9TiHyrUS3cCjBqz0kzSsqEn+mf1YSgt6VYfbX6Xx2AkZuu+8AfBEBlomyTdAfJO\nbk/or3bUWF6BMWHhvGW4LHPL2U/oB89ErqbyVCIUvbtPszJL6PE=\n=7Gzj\n-----END PGP SIGNATURE-----", "payload": "tree cfac89aae4d48732b49736632e5cef03ee8df90a\nparent c00393163cf1aae888b654a46b5f400e2ded4d1f\nauthor Beno\u00eet CORTIER <benoit.cortier@fried-world.eu> 1498927880 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1503316948 +0200\n\nFinalize needless_borrowed_ref lint doc.\n\nMake sure the needless_borrowed_ref.stderr in examples is up to date\ntoo.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "html_url": "https://github.com/rust-lang/rust/commit/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca/comments", "author": {"login": "CBenoit", "id": 3809077, "node_id": "MDQ6VXNlcjM4MDkwNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/3809077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CBenoit", "html_url": "https://github.com/CBenoit", "followers_url": "https://api.github.com/users/CBenoit/followers", "following_url": "https://api.github.com/users/CBenoit/following{/other_user}", "gists_url": "https://api.github.com/users/CBenoit/gists{/gist_id}", "starred_url": "https://api.github.com/users/CBenoit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CBenoit/subscriptions", "organizations_url": "https://api.github.com/users/CBenoit/orgs", "repos_url": "https://api.github.com/users/CBenoit/repos", "events_url": "https://api.github.com/users/CBenoit/events{/privacy}", "received_events_url": "https://api.github.com/users/CBenoit/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c00393163cf1aae888b654a46b5f400e2ded4d1f", "url": "https://api.github.com/repos/rust-lang/rust/commits/c00393163cf1aae888b654a46b5f400e2ded4d1f", "html_url": "https://github.com/rust-lang/rust/commit/c00393163cf1aae888b654a46b5f400e2ded4d1f"}], "stats": {"total": 44, "additions": 25, "deletions": 19}, "files": [{"sha": "1451b19aecad3e72f9c8711d53e231e1d0cb1c03", "filename": "clippy_lints/src/needless_borrowed_ref.rs", "status": "modified", "additions": 21, "deletions": 12, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs?ref=ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "patch": "@@ -3,25 +3,33 @@\n //! This lint is **warn** by default\n \n use rustc::lint::*;\n-<<<<<<< HEAD\n-use rustc::hir::{MutImmutable, Pat, PatKind, BindingAnnotation};\n-=======\n-use rustc::hir::{MutImmutable, Pat, PatKind};\n-<<<<<<< HEAD\n->>>>>>> e30bf721... Improve needless_borrowed_ref and add suggestion to it.\n+use rustc::hir::{MutImmutable, Pat, PatKind, BindByRef};\n use rustc::ty;\n-=======\n->>>>>>> 4ae45c87... Improve needless_borrowed_ref lint: remove the hand rolled span part.\n use utils::{span_lint_and_then, in_macro, snippet};\n-use rustc::hir::BindingMode::BindByRef;\n \n /// **What it does:** Checks for useless borrowed references.\n ///\n-/// **Why is this bad?** It is completely useless and make the code look more\n-/// complex than it\n+/// **Why is this bad?** It is mostly useless and make the code look more complex than it\n /// actually is.\n ///\n-/// **Known problems:** None.\n+/// **Known problems:** It seems that the `&ref` pattern is sometimes useful.\n+/// For instance in the following snippet:\n+/// ```rust\n+/// enum Animal {\n+///     Cat(u64),\n+///     Dog(u64),\n+/// }\n+///\n+/// fn foo(a: &Animal, b: &Animal) {\n+///     match (a, b) {\n+///         (&Animal::Cat(v), k) | (k, &Animal::Cat(v)) => (), // lifetime mismatch error\n+///         (&Animal::Dog(ref c), &Animal::Dog(_)) => ()\n+///     }\n+/// }\n+/// ```\n+/// There is a lifetime mismatch error for `k` (indeed a and b have distinct lifetime).\n+/// This can be fixed by using the `&ref` pattern.\n+/// However, the code can also be fixed by much cleaner ways\n ///\n /// **Example:**\n /// ```rust\n@@ -75,3 +83,4 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessBorrowedRef {\n         }}\n     }\n }\n+"}, {"sha": "2b506af88f5a8ca16388952d594b070d5d259261", "filename": "clippy_tests/examples/needless_borrowed_ref.stderr", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_tests%2Fexamples%2Fneedless_borrowed_ref.stderr?ref=ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "patch": "@@ -1,5 +1,5 @@\n error: this pattern takes a reference on something that is being de-referenced\n- --> examples/needless_borrowed_ref.rs:8:34\n+ --> needless_borrowed_ref.rs:8:34\n   |\n 8 |     let _ = v.iter_mut().filter(|&ref a| a.is_empty());\n   |                                  ^^^^^^ help: try removing the `&ref` part and just keep `a`\n@@ -8,30 +8,27 @@ error: this pattern takes a reference on something that is being de-referenced\n   = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n \n error: this pattern takes a reference on something that is being de-referenced\n-  --> examples/needless_borrowed_ref.rs:13:17\n+  --> needless_borrowed_ref.rs:13:17\n    |\n 13 |     if let Some(&ref v) = thingy {\n    |                 ^^^^^^ help: try removing the `&ref` part and just keep `v`\n    |\n-   = note: `-D needless-borrowed-reference` implied by `-D warnings`\n    = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n \n error: this pattern takes a reference on something that is being de-referenced\n-  --> examples/needless_borrowed_ref.rs:42:27\n+  --> needless_borrowed_ref.rs:42:27\n    |\n 42 |         (&Animal::Cat(v), &ref k) | (&ref k, &Animal::Cat(v)) => (), // lifetime mismatch error if there is no '&ref'\n    |                           ^^^^^^ help: try removing the `&ref` part and just keep `k`\n    |\n-   = note: `-D needless-borrowed-reference` implied by `-D warnings`\n    = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n \n error: this pattern takes a reference on something that is being de-referenced\n-  --> examples/needless_borrowed_ref.rs:42:38\n+  --> needless_borrowed_ref.rs:42:38\n    |\n 42 |         (&Animal::Cat(v), &ref k) | (&ref k, &Animal::Cat(v)) => (), // lifetime mismatch error if there is no '&ref'\n    |                                      ^^^^^^ help: try removing the `&ref` part and just keep `k`\n    |\n-   = note: `-D needless-borrowed-reference` implied by `-D warnings`\n    = help: for further information visit https://github.com/Manishearth/rust-clippy/wiki#needless_borrowed_reference\n \n error: aborting due to previous error(s)"}]}