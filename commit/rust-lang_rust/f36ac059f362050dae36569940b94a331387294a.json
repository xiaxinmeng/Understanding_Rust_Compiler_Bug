{"sha": "f36ac059f362050dae36569940b94a331387294a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzNmFjMDU5ZjM2MjA1MGRhZTM2NTY5OTQwYjk0YTMzMTM4NzI5NGE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-15T22:14:56Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-15T22:14:56Z"}, "message": "Reduce some duplication", "tree": {"sha": "895770caf6ae51bf9fad7766924212ff5f326758", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/895770caf6ae51bf9fad7766924212ff5f326758"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f36ac059f362050dae36569940b94a331387294a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f36ac059f362050dae36569940b94a331387294a", "html_url": "https://github.com/rust-lang/rust/commit/f36ac059f362050dae36569940b94a331387294a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f36ac059f362050dae36569940b94a331387294a/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "892671926bcb5fd9cd5df6fd2b8c7efb5f25582d", "url": "https://api.github.com/repos/rust-lang/rust/commits/892671926bcb5fd9cd5df6fd2b8c7efb5f25582d", "html_url": "https://github.com/rust-lang/rust/commit/892671926bcb5fd9cd5df6fd2b8c7efb5f25582d"}], "stats": {"total": 20, "additions": 12, "deletions": 8}, "files": [{"sha": "71f7ce1b19f53f16adeb73f0f633bd21b198439c", "filename": "crates/ra_assists/src/assist_ctx.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassist_ctx.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassist_ctx.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassist_ctx.rs?ref=f36ac059f362050dae36569940b94a331387294a", "patch": "@@ -1,6 +1,5 @@\n //! This module defines `AssistCtx` -- the API surface that is exposed to assists.\n-\n-use hir::db::HirDatabase;\n+use hir::{db::HirDatabase, SourceAnalyzer};\n use ra_db::FileRange;\n use ra_fmt::{leading_indent, reindent};\n use ra_syntax::{\n@@ -113,6 +112,13 @@ impl<'a, DB: HirDatabase> AssistCtx<'a, DB> {\n     pub(crate) fn covering_element(&self) -> SyntaxElement {\n         find_covering_element(self.source_file.syntax(), self.frange.range)\n     }\n+    pub(crate) fn source_analyzer(\n+        &self,\n+        node: &SyntaxNode,\n+        offset: Option<TextUnit>,\n+    ) -> SourceAnalyzer {\n+        SourceAnalyzer::new(self.db, self.frange.file_id, node, offset)\n+    }\n \n     pub(crate) fn covering_node_for_range(&self, range: TextRange) -> SyntaxElement {\n         find_covering_element(self.source_file.syntax(), range)"}, {"sha": "562a096853cbf4da87fbfcbeed285f13158b2599", "filename": "crates/ra_assists/src/assists/add_explicit_type.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_explicit_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_explicit_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_explicit_type.rs?ref=f36ac059f362050dae36569940b94a331387294a", "patch": "@@ -40,7 +40,7 @@ pub(crate) fn add_explicit_type(ctx: AssistCtx<impl HirDatabase>) -> Option<Assi\n     }\n     // Infer type\n     let db = ctx.db;\n-    let analyzer = hir::SourceAnalyzer::new(db, ctx.frange.file_id, stmt.syntax(), None);\n+    let analyzer = ctx.source_analyzer(stmt.syntax(), None);\n     let ty = analyzer.type_of(db, &expr)?;\n     // Assist not applicable if the type is unknown\n     if is_unknown(&ty) {"}, {"sha": "91af161ee0891783bf6c13812d395d78f5b8d6f1", "filename": "crates/ra_assists/src/assists/add_missing_impl_members.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_missing_impl_members.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_missing_impl_members.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_missing_impl_members.rs?ref=f36ac059f362050dae36569940b94a331387294a", "patch": "@@ -100,8 +100,7 @@ fn add_missing_impl_members_inner(\n     let impl_item_list = impl_node.item_list()?;\n \n     let trait_def = {\n-        let file_id = ctx.frange.file_id;\n-        let analyzer = hir::SourceAnalyzer::new(ctx.db, file_id, impl_node.syntax(), None);\n+        let analyzer = ctx.source_analyzer(impl_node.syntax(), None);\n \n         resolve_target_trait_def(ctx.db, &analyzer, &impl_node)?\n     };"}, {"sha": "b851c20823be179fa7ac2b91f38eedf3cce8233b", "filename": "crates/ra_assists/src/assists/fill_match_arms.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Ffill_match_arms.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Ffill_match_arms.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassists%2Ffill_match_arms.rs?ref=f36ac059f362050dae36569940b94a331387294a", "patch": "@@ -47,8 +47,7 @@ pub(crate) fn fill_match_arms(ctx: AssistCtx<impl HirDatabase>) -> Option<Assist\n \n     let expr = match_expr.expr()?;\n     let enum_def = {\n-        let file_id = ctx.frange.file_id;\n-        let analyzer = hir::SourceAnalyzer::new(ctx.db, file_id, expr.syntax(), None);\n+        let analyzer = ctx.source_analyzer(expr.syntax(), None);\n         resolve_enum_def(ctx.db, &analyzer, &expr)?\n     };\n     let variant_list = enum_def.variant_list()?;"}, {"sha": "18a34502ccdd404da9204bdfe7000a1226f0cd6d", "filename": "crates/ra_assists/src/assists/inline_local_variable.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Finline_local_variable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f36ac059f362050dae36569940b94a331387294a/crates%2Fra_assists%2Fsrc%2Fassists%2Finline_local_variable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassists%2Finline_local_variable.rs?ref=f36ac059f362050dae36569940b94a331387294a", "patch": "@@ -45,7 +45,7 @@ pub(crate) fn inline_local_varialbe(ctx: AssistCtx<impl HirDatabase>) -> Option<\n     } else {\n         let_stmt.syntax().text_range()\n     };\n-    let analyzer = hir::SourceAnalyzer::new(ctx.db, ctx.frange.file_id, bind_pat.syntax(), None);\n+    let analyzer = ctx.source_analyzer(bind_pat.syntax(), None);\n     let refs = analyzer.find_all_refs(&bind_pat);\n \n     let mut wrap_in_parens = vec![true; refs.len()];"}]}