{"sha": "5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlNjFlNGNhZGM3MjE0MWY5ZTRjODBjYTg2MTU1MDlmMmVhZWI1MWY=", "commit": {"author": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-11-27T03:43:40Z"}, "committer": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-12-02T14:43:39Z"}, "message": "Suggest feature for const_mut_refs errors", "tree": {"sha": "dac937bf01989b136a15496ba4601aa779be35ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dac937bf01989b136a15496ba4601aa779be35ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "html_url": "https://github.com/rust-lang/rust/commit/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "681690db4e41505401a0ebbf3d1e4bec69ead702", "url": "https://api.github.com/repos/rust-lang/rust/commits/681690db4e41505401a0ebbf3d1e4bec69ead702", "html_url": "https://github.com/rust-lang/rust/commit/681690db4e41505401a0ebbf3d1e4bec69ead702"}], "stats": {"total": 60, "additions": 41, "deletions": 19}, "files": [{"sha": "182ba4625667abcae8a254bcdfa88b0a7faf94b9", "filename": "src/librustc_mir/transform/check_consts/ops.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs?ref=5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "patch": "@@ -197,9 +197,13 @@ impl NonConstOp for MutBorrow {\n     }\n \n     fn emit_error(&self, item: &Item<'_, '_>, span: Span) {\n-        let mut err = struct_span_err!(item.tcx.sess, span, E0017,\n-                                       \"references in {}s may only refer \\\n-                                        to immutable values\", item.const_kind());\n+        let mut err = feature_err(\n+            &item.tcx.sess.parse_sess,\n+            sym::const_mut_refs,\n+            span,\n+            &format!(\"references in {}s may only refer \\\n+                      to immutable values\", item.const_kind())\n+        );\n         err.span_label(span, format!(\"{}s require immutable values\",\n                                             item.const_kind()));\n         if item.tcx.sess.teach(&err.get_code().unwrap()) {"}, {"sha": "54b35073340fd3ca80582a816ed5f023e4689472", "filename": "src/test/ui/consts/const-eval/issue-65394.stderr", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-65394.stderr?ref=5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "patch": "@@ -1,8 +1,11 @@\n-error[E0017]: references in constants may only refer to immutable values\n+error[E0658]: references in constants may only refer to immutable values\n   --> $DIR/issue-65394.rs:8:13\n    |\n LL |     let r = &mut x;\n    |             ^^^^^^ constants require immutable values\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/57349\n+   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n error[E0493]: destructors cannot be evaluated at compile-time\n   --> $DIR/issue-65394.rs:7:9\n@@ -12,5 +15,5 @@ LL |     let mut x = Vec::<i32>::new();\n \n error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0017, E0493.\n-For more information about an error, try `rustc --explain E0017`.\n+Some errors have detailed explanations: E0493, E0658.\n+For more information about an error, try `rustc --explain E0493`."}, {"sha": "0809c77c1b604514d0451fcfc232f99309c699f9", "filename": "src/test/ui/consts/const-multi-ref.stderr", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-multi-ref.stderr?ref=5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "patch": "@@ -1,8 +1,11 @@\n-error[E0017]: references in constants may only refer to immutable values\n+error[E0658]: references in constants may only refer to immutable values\n   --> $DIR/const-multi-ref.rs:6:13\n    |\n LL |     let p = &mut a;\n    |             ^^^^^^ constants require immutable values\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/57349\n+   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n error[E0492]: cannot borrow a constant which may contain interior mutability, create a static instead\n   --> $DIR/const-multi-ref.rs:16:13\n@@ -12,5 +15,5 @@ LL |     let p = &a;\n \n error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0017, E0492.\n-For more information about an error, try `rustc --explain E0017`.\n+Some errors have detailed explanations: E0492, E0658.\n+For more information about an error, try `rustc --explain E0492`."}, {"sha": "7852874944b22c8bce3a9cab994c41af395c4cc6", "filename": "src/test/ui/consts/const_let_assign3.stderr", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_let_assign3.stderr?ref=5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "patch": "@@ -4,17 +4,23 @@ error[E0019]: constant function contains unimplemented expression type\n LL |         self.state = x;\n    |         ^^^^^^^^^^^^^^\n \n-error[E0017]: references in constants may only refer to immutable values\n+error[E0658]: references in constants may only refer to immutable values\n   --> $DIR/const_let_assign3.rs:16:5\n    |\n LL |     s.foo(3);\n    |     ^ constants require immutable values\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/57349\n+   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n-error[E0017]: references in constants may only refer to immutable values\n+error[E0658]: references in constants may only refer to immutable values\n   --> $DIR/const_let_assign3.rs:22:13\n    |\n LL |     let y = &mut x;\n    |             ^^^^^^ constants require immutable values\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/57349\n+   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n error[E0019]: constant contains unimplemented expression type\n   --> $DIR/const_let_assign3.rs:24:5\n@@ -24,5 +30,5 @@ LL |     *y = 42;\n \n error: aborting due to 4 previous errors\n \n-Some errors have detailed explanations: E0017, E0019.\n-For more information about an error, try `rustc --explain E0017`.\n+Some errors have detailed explanations: E0019, E0658.\n+For more information about an error, try `rustc --explain E0019`."}, {"sha": "41c7b62812c086048bb424814001d0018c41cf5e", "filename": "src/test/ui/consts/projection_qualif.stderr", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fprojection_qualif.stderr?ref=5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "patch": "@@ -1,8 +1,11 @@\n-error[E0017]: references in constants may only refer to immutable values\n+error[E0658]: references in constants may only refer to immutable values\n   --> $DIR/projection_qualif.rs:6:27\n    |\n LL |         let b: *mut u32 = &mut a;\n    |                           ^^^^^^ constants require immutable values\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/57349\n+   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n error[E0658]: dereferencing raw pointers in constants is unstable\n   --> $DIR/projection_qualif.rs:7:18\n@@ -21,5 +24,5 @@ LL |         unsafe { *b = 5; }\n \n error: aborting due to 3 previous errors\n \n-Some errors have detailed explanations: E0017, E0019, E0658.\n-For more information about an error, try `rustc --explain E0017`.\n+Some errors have detailed explanations: E0019, E0658.\n+For more information about an error, try `rustc --explain E0019`."}, {"sha": "e0074687874fe4fcb6dbf652545a5204ff37dcb4", "filename": "src/test/ui/consts/static_mut_containing_mut_ref2.stderr", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e61e4cadc72141f9e4c80ca8615509f2eaeb51f/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.stderr?ref=5e61e4cadc72141f9e4c80ca8615509f2eaeb51f", "patch": "@@ -1,8 +1,11 @@\n-error[E0017]: references in statics may only refer to immutable values\n+error[E0658]: references in statics may only refer to immutable values\n   --> $DIR/static_mut_containing_mut_ref2.rs:3:46\n    |\n LL | pub static mut STDERR_BUFFER: () = unsafe { *(&mut STDERR_BUFFER_SPACE) = 42; };\n    |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^ statics require immutable values\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/57349\n+   = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n error[E0019]: static contains unimplemented expression type\n   --> $DIR/static_mut_containing_mut_ref2.rs:3:45\n@@ -12,5 +15,5 @@ LL | pub static mut STDERR_BUFFER: () = unsafe { *(&mut STDERR_BUFFER_SPACE) = 4\n \n error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0017, E0019.\n-For more information about an error, try `rustc --explain E0017`.\n+Some errors have detailed explanations: E0019, E0658.\n+For more information about an error, try `rustc --explain E0019`."}]}