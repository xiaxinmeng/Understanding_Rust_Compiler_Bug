{"sha": "a5d4aeddc8e2ecf1279f2138788777a29fedc3c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1ZDRhZWRkYzhlMmVjZjEyNzlmMjEzODc4ODc3N2EyOWZlZGMzYzU=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2019-01-19T03:29:26Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2019-01-19T03:29:26Z"}, "message": "Address some comments", "tree": {"sha": "21afcda5a07aa59b1b58f53b0ea7df5158523335", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/21afcda5a07aa59b1b58f53b0ea7df5158523335"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5d4aeddc8e2ecf1279f2138788777a29fedc3c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5d4aeddc8e2ecf1279f2138788777a29fedc3c5", "html_url": "https://github.com/rust-lang/rust/commit/a5d4aeddc8e2ecf1279f2138788777a29fedc3c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5d4aeddc8e2ecf1279f2138788777a29fedc3c5/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13dc584db39e5f36755b7b051a908277f5e5505f", "url": "https://api.github.com/repos/rust-lang/rust/commits/13dc584db39e5f36755b7b051a908277f5e5505f", "html_url": "https://github.com/rust-lang/rust/commit/13dc584db39e5f36755b7b051a908277f5e5505f"}], "stats": {"total": 19, "additions": 7, "deletions": 12}, "files": [{"sha": "d1a3d7c1f81e038343f2249c821764b10a7abe59", "filename": "src/librustc_passes/ast_validation.rs", "status": "modified", "additions": 7, "deletions": 12, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/a5d4aeddc8e2ecf1279f2138788777a29fedc3c5/src%2Flibrustc_passes%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5d4aeddc8e2ecf1279f2138788777a29fedc3c5/src%2Flibrustc_passes%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Fast_validation.rs?ref=a5d4aeddc8e2ecf1279f2138788777a29fedc3c5", "patch": "@@ -6,6 +6,7 @@\n // This pass is supposed to perform only simple checks not requiring name resolution\n // or type checking or some other kind of complex analysis.\n \n+use std::mem;\n use rustc::lint;\n use rustc::session::Session;\n use syntax::ast::*;\n@@ -32,22 +33,16 @@ struct AstValidator<'a> {\n }\n \n impl<'a> AstValidator<'a> {\n-    fn with_banned_impl_trait<F>(&mut self, f: F)\n-        where F: FnOnce(&mut Self)\n-    {\n-        let old_is_impl_trait_banned = self.is_impl_trait_banned;\n-        self.is_impl_trait_banned = true;\n+    fn with_banned_impl_trait(&mut self, f: impl FnOnce(&mut Self)) {\n+        let old = mem::replace(&mut self.is_impl_trait_banned, true);\n         f(self);\n-        self.is_impl_trait_banned = old_is_impl_trait_banned;\n+        self.is_impl_trait_banned = old;\n     }\n \n-    fn with_impl_trait<F>(&mut self, outer_impl_trait: Option<Span>, f: F)\n-        where F: FnOnce(&mut Self)\n-    {\n-        let old_outer_impl_trait = self.outer_impl_trait;\n-        self.outer_impl_trait = outer_impl_trait;\n+    fn with_impl_trait(&mut self, outer_impl_trait: Option<Span>, f: impl FnOnce(&mut Self)) {\n+        let old = mem::replace(&mut self.outer_impl_trait, outer_impl_trait);\n         f(self);\n-        self.outer_impl_trait = old_outer_impl_trait;\n+        self.outer_impl_trait = old;\n     }\n \n     // Mirrors visit::walk_ty, but tracks relevant state"}]}