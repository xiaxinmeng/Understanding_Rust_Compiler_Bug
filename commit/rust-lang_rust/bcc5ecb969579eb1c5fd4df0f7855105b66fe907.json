{"sha": "bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjYzVlY2I5Njk1NzllYjFjNWZkNGRmMGY3ODU1MTA1YjY2ZmU5MDc=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-08-22T12:06:45Z"}, "committer": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-08-22T12:07:41Z"}, "message": "Suggest importing the right kind of macro.", "tree": {"sha": "c55c6b2719ad48867752d4027b1d36e7427bec3e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c55c6b2719ad48867752d4027b1d36e7427bec3e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "html_url": "https://github.com/rust-lang/rust/commit/bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e7f7fe462a54b1caeb804a974cd43ba9fd7bee5c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7f7fe462a54b1caeb804a974cd43ba9fd7bee5c", "html_url": "https://github.com/rust-lang/rust/commit/e7f7fe462a54b1caeb804a974cd43ba9fd7bee5c"}], "stats": {"total": 56, "additions": 53, "deletions": 3}, "files": [{"sha": "3cf042687562ba62dddc6eecbd0dbae3b7719cdc", "filename": "compiler/rustc_resolve/src/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs?ref=bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "patch": "@@ -950,9 +950,7 @@ impl<'a> Resolver<'a> {\n         self.add_typo_suggestion(err, suggestion, ident.span);\n \n         let import_suggestions =\n-            self.lookup_import_candidates(ident, Namespace::MacroNS, parent_scope, |res| {\n-                matches!(res, Res::Def(DefKind::Macro(MacroKind::Bang), _))\n-            });\n+            self.lookup_import_candidates(ident, Namespace::MacroNS, parent_scope, is_expected);\n         show_candidates(err, None, &import_suggestions, false, true);\n \n         if macro_kind == MacroKind::Derive && (ident.name == sym::Send || ident.name == sym::Sync) {"}, {"sha": "615b865e9f1e1e43e133bfcc37b8045c71245854", "filename": "src/test/ui/macros/issue-88228.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.rs?ref=bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "patch": "@@ -0,0 +1,22 @@\n+// compile-flags: -Z deduplicate-diagnostics=yes\n+// edition:2018\n+\n+mod hey {\n+    pub use Copy as Bla;\n+    pub use std::println as bla;\n+}\n+\n+#[derive(Bla)]\n+//~^ ERROR cannot find derive macro `Bla`\n+//~| NOTE consider importing this derive macro\n+struct A;\n+\n+#[derive(println)]\n+//~^ ERROR cannot find derive macro `println`\n+struct B;\n+\n+fn main() {\n+    bla!();\n+    //~^ ERROR cannot find macro `bla`\n+    //~| NOTE consider importing this macro\n+}"}, {"sha": "b164e39064c97be5067be82e278fa7822f242a4a", "filename": "src/test/ui/macros/issue-88228.stderr", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.stderr?ref=bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "patch": "@@ -0,0 +1,26 @@\n+error: cannot find macro `bla` in this scope\n+  --> $DIR/issue-88228.rs:19:5\n+   |\n+LL |     bla!();\n+   |     ^^^\n+   |\n+   = note: consider importing this macro:\n+           crate::hey::bla\n+\n+error: cannot find derive macro `println` in this scope\n+  --> $DIR/issue-88228.rs:14:10\n+   |\n+LL | #[derive(println)]\n+   |          ^^^^^^^\n+\n+error: cannot find derive macro `Bla` in this scope\n+  --> $DIR/issue-88228.rs:9:10\n+   |\n+LL | #[derive(Bla)]\n+   |          ^^^\n+   |\n+   = note: consider importing this derive macro:\n+           crate::hey::Bla\n+\n+error: aborting due to 3 previous errors\n+"}, {"sha": "3b160935a2f8d91d37fb2011485f587bb74eca40", "filename": "src/test/ui/proc-macro/derive-helper-shadowing.stderr", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bcc5ecb969579eb1c5fd4df0f7855105b66fe907/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr?ref=bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "patch": "@@ -16,6 +16,8 @@ error: cannot find attribute `empty_helper` in this scope\n LL |             #[derive(GenHelperUse)]\n    |                      ^^^^^^^^^^^^\n    |\n+   = note: consider importing this attribute macro:\n+           empty_helper\n    = note: this error originates in the derive macro `GenHelperUse` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: cannot find attribute `empty_helper` in this scope\n@@ -27,6 +29,8 @@ LL |         #[empty_helper]\n LL |             gen_helper_use!();\n    |             ------------------ in this macro invocation\n    |\n+   = note: consider importing this attribute macro:\n+           crate::empty_helper\n    = note: this error originates in the macro `gen_helper_use` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error[E0659]: `empty_helper` is ambiguous (name vs any other name during import resolution)"}]}