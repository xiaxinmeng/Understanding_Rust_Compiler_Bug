{"sha": "61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxZDNiNmRlZGIxZWMxZjNlM2NiZDNkNjZiMWEzNDUzMjI1YmMzN2M=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-02-19T17:12:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-02-19T17:12:11Z"}, "message": "Rollup merge of #69280 - ecstatic-morse:promote-shuffle-no-special-case, r=petrochenkov\n\nRemove special case for `simd_shuffle` arg promotion\n\nAfter rust-lang/stdarch#825, these intrinsics are now defined with `#[rustc_args_required_const(2)]`, so the special-case is no longer necessary.", "tree": {"sha": "9c36539ab8900cdb04acf03f709e7ceab3683182", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c36539ab8900cdb04acf03f709e7ceab3683182"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeTWxsCRBK7hj4Ov3rIwAAdHIIAFRW/9QkoQrKS5sUKIdeClVQ\nuw3bAiO2bVBY+A7qXeEIFJVznch60rS1he/XC/DOFewFSCLuF+Kdk6cB8sKHQdes\nkKrpdYxJVZxg4CV1oK2sv2gxmmBZW4ywFn8/8ciuF1FT1dhdZVBQ+tOMtApMOtT0\nD7JQ3xa90Elm5KiqU9U6l2ouKv201CVxSoxHMzbTHOSHez00WQBz2RS0+HHyhoCl\nfeYvHPYsMeJZMzux/U6jNEMzUV6lwYPZrWn1iDxmE6b3TTRvWgN5mUWTQMPlpTct\nX01GcUlt0NEQNWMZUr1tr1Bz6LKK9kRtJtO44B10cHyzdYJNH9QZeZQ1OIw+nHQ=\n=kcAN\n-----END PGP SIGNATURE-----\n", "payload": "tree 9c36539ab8900cdb04acf03f709e7ceab3683182\nparent c6ad1e2c2a0c7e48537617d36085f866fa6a65a3\nparent b43dc806ae3d5fd11ff0bdea288cf16f4b1e4c13\nauthor Dylan DPC <dylan.dpc@gmail.com> 1582132331 +0100\ncommitter GitHub <noreply@github.com> 1582132331 +0100\n\nRollup merge of #69280 - ecstatic-morse:promote-shuffle-no-special-case, r=petrochenkov\n\nRemove special case for `simd_shuffle` arg promotion\n\nAfter rust-lang/stdarch#825, these intrinsics are now defined with `#[rustc_args_required_const(2)]`, so the special-case is no longer necessary.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "html_url": "https://github.com/rust-lang/rust/commit/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6ad1e2c2a0c7e48537617d36085f866fa6a65a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6ad1e2c2a0c7e48537617d36085f866fa6a65a3", "html_url": "https://github.com/rust-lang/rust/commit/c6ad1e2c2a0c7e48537617d36085f866fa6a65a3"}, {"sha": "b43dc806ae3d5fd11ff0bdea288cf16f4b1e4c13", "url": "https://api.github.com/repos/rust-lang/rust/commits/b43dc806ae3d5fd11ff0bdea288cf16f4b1e4c13", "html_url": "https://github.com/rust-lang/rust/commit/b43dc806ae3d5fd11ff0bdea288cf16f4b1e4c13"}], "stats": {"total": 80, "additions": 39, "deletions": 41}, "files": [{"sha": "1cec5d30e9b9bda4d1da16c96a2e3f56921b1720", "filename": "src/librustc_mir/const_eval/eval_queries.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Flibrustc_mir%2Fconst_eval%2Feval_queries.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Flibrustc_mir%2Fconst_eval%2Feval_queries.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fconst_eval%2Feval_queries.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -72,8 +72,8 @@ fn eval_body_using_ecx<'mir, 'tcx>(\n     Ok(ret)\n }\n \n-/// The `InterpCx` is only meant to be used to do field and index projections into constants for\n-/// `simd_shuffle` and const patterns in match arms.\n+/// The `InterpCx` is only meant to be used to do field and index projections into promoteds\n+/// and const patterns in match arms.\n ///\n /// The function containing the `match` that is currently being analyzed may have generic bounds\n /// that inform us about the generic bounds of the constant. E.g., using an associated constant"}, {"sha": "a11ee57f46529ccaeda80b0d8bbd940d4e9eceba", "filename": "src/librustc_mir/transform/promote_consts.rs", "status": "modified", "additions": 5, "deletions": 19, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Flibrustc_mir%2Ftransform%2Fpromote_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Flibrustc_mir%2Ftransform%2Fpromote_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fpromote_consts.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -24,7 +24,6 @@ use rustc_span::{Span, DUMMY_SP};\n use syntax::ast::LitKind;\n \n use rustc_index::vec::{Idx, IndexVec};\n-use rustc_target::spec::abi::Abi;\n \n use std::cell::Cell;\n use std::{cmp, iter, mem, usize};\n@@ -106,11 +105,10 @@ pub enum Candidate {\n     /// Promotion of the `x` in `[x; 32]`.\n     Repeat(Location),\n \n-    /// Currently applied to function calls where the callee has the unstable\n-    /// `#[rustc_args_required_const]` attribute as well as the SIMD shuffle\n-    /// intrinsic. The intrinsic requires the arguments are indeed constant and\n-    /// the attribute currently provides the semantic requirement that arguments\n-    /// must be constant.\n+    /// Function calls where the callee has the unstable\n+    /// `#[rustc_args_required_const]` attribute. The attribute requires that\n+    /// the arguments be constant, usually because they are encoded as an\n+    /// immediate operand in a platform intrinsic.\n     Argument { bb: BasicBlock, index: usize },\n }\n \n@@ -218,17 +216,6 @@ impl<'tcx> Visitor<'tcx> for Collector<'_, 'tcx> {\n \n         if let TerminatorKind::Call { ref func, .. } = *kind {\n             if let ty::FnDef(def_id, _) = func.ty(self.body, self.tcx).kind {\n-                let fn_sig = self.tcx.fn_sig(def_id);\n-                if let Abi::RustIntrinsic | Abi::PlatformIntrinsic = fn_sig.abi() {\n-                    let name = self.tcx.item_name(def_id);\n-                    // FIXME(eddyb) use `#[rustc_args_required_const(2)]` for shuffles.\n-                    if name.as_str().starts_with(\"simd_shuffle\") {\n-                        self.candidates.push(Candidate::Argument { bb: location.block, index: 2 });\n-\n-                        return; // Don't double count `simd_shuffle` candidates\n-                    }\n-                }\n-\n                 if let Some(constant_args) = args_required_const(self.tcx, def_id) {\n                     for index in constant_args {\n                         self.candidates.push(Candidate::Argument { bb: location.block, index });\n@@ -730,8 +717,7 @@ pub fn validate_candidates(\n         .filter(|&candidate| {\n             validator.explicit = candidate.forces_explicit_promotion();\n \n-            // FIXME(eddyb) also emit the errors for shuffle indices\n-            // and `#[rustc_args_required_const]` arguments here.\n+            // FIXME(eddyb) also emit the errors for `#[rustc_args_required_const]` arguments here.\n \n             let is_promotable = validator.validate_candidate(candidate).is_ok();\n             match candidate {"}, {"sha": "c9c600efed8906faa4ba7d0c7099ed6ea1f2202c", "filename": "src/test/incremental/issue-61530.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fincremental%2Fissue-61530.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fincremental%2Fissue-61530.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental%2Fissue-61530.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -1,11 +1,12 @@\n-#![feature(repr_simd, platform_intrinsics)]\n+#![feature(repr_simd, platform_intrinsics, rustc_attrs)]\n \n // revisions:rpass1 rpass2\n \n #[repr(simd)]\n struct I32x2(i32, i32);\n \n extern \"platform-intrinsic\" {\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle2<T, U>(x: T, y: T, idx: [u32; 2]) -> U;\n }\n "}, {"sha": "8f7905b31ecde4866b8460f51ec5fa74a101c573", "filename": "src/test/ui/issues/issue-38074.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fissues%2Fissue-38074.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fissues%2Fissue-38074.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-38074.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -1,9 +1,10 @@\n // run-pass\n // ignore-emscripten FIXME(#45351)\n \n-#![feature(platform_intrinsics, repr_simd)]\n+#![feature(platform_intrinsics, repr_simd, rustc_attrs)]\n \n extern \"platform-intrinsic\" {\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle2<T, U>(x: T, y: T, idx: [u32; 2]) -> U;\n }\n "}, {"sha": "c9c9ab879f27e5594a1b96baa9dc1277b4aefc85", "filename": "src/test/ui/simd-intrinsic/simd-intrinsic-generic-elements.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-elements.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-elements.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-elements.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -42,9 +42,13 @@ extern \"platform-intrinsic\" {\n     fn simd_insert<T, E>(x: T, idx: u32, y: E) -> T;\n     fn simd_extract<T, E>(x: T, idx: u32) -> E;\n \n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle2<T, U>(x: T, y: T, idx: [u32; 2]) -> U;\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle3<T, U>(x: T, y: T, idx: [u32; 3]) -> U;\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle4<T, U>(x: T, y: T, idx: [u32; 4]) -> U;\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle8<T, U>(x: T, y: T, idx: [u32; 8]) -> U;\n }\n "}, {"sha": "29916f85902b255abc9941d196f6f39bd62f73a3", "filename": "src/test/ui/simd-intrinsic/simd-intrinsic-generic-elements.stderr", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-elements.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-elements.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-elements.stderr?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -1,89 +1,89 @@\n error[E0511]: invalid monomorphization of `simd_insert` intrinsic: expected SIMD input type, found non-SIMD `i32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:55:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:59:9\n    |\n LL |         simd_insert(0, 0, 0);\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_insert` intrinsic: expected inserted type `i32` (element of input `i32x4`), found `f64`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:57:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:61:9\n    |\n LL |         simd_insert(x, 0, 1.0);\n    |         ^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_extract` intrinsic: expected return type `i32` (element of input `i32x4`), found `f32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:59:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:63:9\n    |\n LL |         simd_extract::<_, f32>(x, 0);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle2` intrinsic: expected SIMD input type, found non-SIMD `i32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:62:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:66:9\n    |\n LL |         simd_shuffle2::<i32, i32>(0, 0, [0; 2]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle3` intrinsic: expected SIMD input type, found non-SIMD `i32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:64:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:68:9\n    |\n LL |         simd_shuffle3::<i32, i32>(0, 0, [0; 3]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle4` intrinsic: expected SIMD input type, found non-SIMD `i32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:66:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:70:9\n    |\n LL |         simd_shuffle4::<i32, i32>(0, 0, [0; 4]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle8` intrinsic: expected SIMD input type, found non-SIMD `i32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:68:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:72:9\n    |\n LL |         simd_shuffle8::<i32, i32>(0, 0, [0; 8]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle2` intrinsic: expected return element type `i32` (element of input `i32x4`), found `f32x2` with element type `f32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:71:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:75:9\n    |\n LL |         simd_shuffle2::<_, f32x2>(x, x, [0; 2]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle3` intrinsic: expected return element type `i32` (element of input `i32x4`), found `f32x3` with element type `f32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:73:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:77:9\n    |\n LL |         simd_shuffle3::<_, f32x3>(x, x, [0; 3]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle4` intrinsic: expected return element type `i32` (element of input `i32x4`), found `f32x4` with element type `f32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:75:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:79:9\n    |\n LL |         simd_shuffle4::<_, f32x4>(x, x, [0; 4]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle8` intrinsic: expected return element type `i32` (element of input `i32x4`), found `f32x8` with element type `f32`\n-  --> $DIR/simd-intrinsic-generic-elements.rs:77:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:81:9\n    |\n LL |         simd_shuffle8::<_, f32x8>(x, x, [0; 8]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle2` intrinsic: expected return type of length 2, found `i32x8` with length 8\n-  --> $DIR/simd-intrinsic-generic-elements.rs:80:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:84:9\n    |\n LL |         simd_shuffle2::<_, i32x8>(x, x, [0; 2]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle3` intrinsic: expected return type of length 3, found `i32x4` with length 4\n-  --> $DIR/simd-intrinsic-generic-elements.rs:82:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:86:9\n    |\n LL |         simd_shuffle3::<_, i32x4>(x, x, [0; 3]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle4` intrinsic: expected return type of length 4, found `i32x3` with length 3\n-  --> $DIR/simd-intrinsic-generic-elements.rs:84:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:88:9\n    |\n LL |         simd_shuffle4::<_, i32x3>(x, x, [0; 4]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0511]: invalid monomorphization of `simd_shuffle8` intrinsic: expected return type of length 8, found `i32x2` with length 2\n-  --> $DIR/simd-intrinsic-generic-elements.rs:86:9\n+  --> $DIR/simd-intrinsic-generic-elements.rs:90:9\n    |\n LL |         simd_shuffle8::<_, i32x2>(x, x, [0; 8]);\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"}, {"sha": "b03b0ef50895b34603e4f96afd4b7b10b84a7d0a", "filename": "src/test/ui/simd-intrinsic/simd-intrinsic-inlining-issue67557-ice.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-inlining-issue67557-ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-inlining-issue67557-ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-inlining-issue67557-ice.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -3,9 +3,10 @@\n //\n // run-pass\n // compile-flags: -Zmir-opt-level=3\n-#![feature(platform_intrinsics, repr_simd)]\n+#![feature(platform_intrinsics, repr_simd, rustc_attrs)]\n \n extern \"platform-intrinsic\" {\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle2<T, U>(x: T, y: T, idx: [u32; 2]) -> U;\n }\n "}, {"sha": "2741dc1333696a254b85c4c54434075ee880808e", "filename": "src/test/ui/simd-intrinsic/simd-intrinsic-inlining-issue67557.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-inlining-issue67557.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-inlining-issue67557.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-inlining-issue67557.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -3,9 +3,10 @@\n //\n // run-pass\n // compile-flags: -Zmir-opt-level=3\n-#![feature(platform_intrinsics, repr_simd)]\n+#![feature(platform_intrinsics, repr_simd, rustc_attrs)]\n \n extern \"platform-intrinsic\" {\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle2<T, U>(x: T, y: T, idx: [u32; 2]) -> U;\n }\n "}, {"sha": "abff59fea78e559495d7e5f1a68b82f8d720236a", "filename": "src/test/ui/simd/simd-intrinsic-generic-elements.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd%2Fsimd-intrinsic-generic-elements.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c/src%2Ftest%2Fui%2Fsimd%2Fsimd-intrinsic-generic-elements.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fsimd-intrinsic-generic-elements.rs?ref=61d3b6dedb1ec1f3e3cbd3d66b1a3453225bc37c", "patch": "@@ -1,7 +1,7 @@\n // run-pass\n // ignore-emscripten FIXME(#45351) hits an LLVM assert\n \n-#![feature(repr_simd, platform_intrinsics)]\n+#![feature(repr_simd, platform_intrinsics, rustc_attrs)]\n \n #[repr(simd)]\n #[derive(Copy, Clone, Debug, PartialEq)]\n@@ -25,9 +25,13 @@ extern \"platform-intrinsic\" {\n     fn simd_insert<T, E>(x: T, idx: u32, y: E) -> T;\n     fn simd_extract<T, E>(x: T, idx: u32) -> E;\n \n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle2<T, U>(x: T, y: T, idx: [u32; 2]) -> U;\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle3<T, U>(x: T, y: T, idx: [u32; 3]) -> U;\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle4<T, U>(x: T, y: T, idx: [u32; 4]) -> U;\n+    #[rustc_args_required_const(2)]\n     fn simd_shuffle8<T, U>(x: T, y: T, idx: [u32; 8]) -> U;\n }\n "}]}