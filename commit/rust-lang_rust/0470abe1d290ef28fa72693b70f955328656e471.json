{"sha": "0470abe1d290ef28fa72693b70f955328656e471", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0NzBhYmUxZDI5MGVmMjhmYTcyNjkzYjcwZjk1NTMyODY1NmU0NzE=", "commit": {"author": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-31T17:51:58Z"}, "committer": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-31T20:55:54Z"}, "message": "Allow some resources to be considered const.", "tree": {"sha": "f1c9803901c49433c66e12f7de203d02a987fd43", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1c9803901c49433c66e12f7de203d02a987fd43"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0470abe1d290ef28fa72693b70f955328656e471", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0470abe1d290ef28fa72693b70f955328656e471", "html_url": "https://github.com/rust-lang/rust/commit/0470abe1d290ef28fa72693b70f955328656e471", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0470abe1d290ef28fa72693b70f955328656e471/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3acc3c4d85e017edde2149eaabd44a78be5f7e17", "url": "https://api.github.com/repos/rust-lang/rust/commits/3acc3c4d85e017edde2149eaabd44a78be5f7e17", "html_url": "https://github.com/rust-lang/rust/commit/3acc3c4d85e017edde2149eaabd44a78be5f7e17"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "5fced36e4083ac3aeecbb8acbc5f533472fe374f", "filename": "src/rustc/middle/ty.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0470abe1d290ef28fa72693b70f955328656e471/src%2Frustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0470abe1d290ef28fa72693b70f955328656e471/src%2Frustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Fty.rs?ref=0470abe1d290ef28fa72693b70f955328656e471", "patch": "@@ -1526,7 +1526,10 @@ fn type_kind(cx: ctxt, ty: t) -> kind {\n         }\n         lowest\n       }\n-      ty_res(did, inner, tps) { kind_send_only() }\n+      ty_res(did, inner, tps) {\n+        let inner = subst(cx, tps, inner);\n+        (kind_const() & type_kind(cx, inner)) | kind_send_only()\n+      }\n       ty_param(_, did) {\n         // FIXME: type params shouldn't be implicitly copyable (#2449)\n         let k = param_bounds_to_kind(cx.ty_param_bounds.get(did.node));"}, {"sha": "320bc1d25f84bc66429235e72e0c445e1d1e2b36", "filename": "src/test/compile-fail/non-const.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0470abe1d290ef28fa72693b70f955328656e471/src%2Ftest%2Fcompile-fail%2Fnon-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0470abe1d290ef28fa72693b70f955328656e471/src%2Ftest%2Fcompile-fail%2Fnon-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fnon-const.rs?ref=0470abe1d290ef28fa72693b70f955328656e471", "patch": "@@ -3,6 +3,7 @@\n fn foo<T: const>(_x: T) { }\n \n resource r(_x: int) {}\n+resource r2(_x: @mut int) {}\n \n fn main() {\n     foo({f: 3});\n@@ -13,7 +14,8 @@ fn main() {\n     foo(~mut 1); //! ERROR missing `const`\n     foo(@1);\n     foo(@mut 1); //! ERROR missing `const`\n-    foo(r(1)); //! ERROR missing `const`\n+    foo(r(1)); // this is okay now.\n+    foo(r2(@mut 1)); //! ERROR missing `const`\n     foo(\"123\");\n     foo({f: {mut f: 1}}); //! ERROR missing `const`\n }"}]}