{"sha": "18122e0db06cb0411d994fe24e4dbbf3b8d35180", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE4MTIyZTBkYjA2Y2IwNDExZDk5NGZlMjRlNGRiYmYzYjhkMzUxODA=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2018-08-17T15:23:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-08-17T15:23:39Z"}, "message": "Rollup merge of #53357 - fukatani:pretty-print-btreemap, r=michaelwoerister\n\nPretty print btreemap for GDB\n\nMerge #53112 first, please.", "tree": {"sha": "150606ce42e09e3fdcdc7c8688203e1efde1ff30", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/150606ce42e09e3fdcdc7c8688203e1efde1ff30"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/18122e0db06cb0411d994fe24e4dbbf3b8d35180", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbduh7CRBK7hj4Ov3rIwAAdHIIAIp28ULLfn8gg3l0wt/WXahZ\nkRYOnUWLHp6/X/pp/8+cFb8iYKa+qoac6t5hXsbPfzbaxbKalDJHx2oXz9J/suMW\nfw8zQjsOKYZtU7CA2VwWYlCm+RtM/afqtMy8AkByyh+Pqt73qq9+MK2JUbimxGIj\nzy+e6SzPDNhPCFN54dSR3IUMplXUb6MNjeDo737LuPYYr0jZXs3JPrm7bfhxFCam\nNjTE4bOeVoY0MnLRIiWRtOxHOuZHUOaGZIstcEMJcFkp5iIPgUE3aIA0KX3tIA82\nVwFSX2BlPKdRoNm78yt6d4FxOqT4oVkfj0WVCaiKQYDCxNYgoKgany/owXZfPHo=\n=ZMzI\n-----END PGP SIGNATURE-----\n", "payload": "tree 150606ce42e09e3fdcdc7c8688203e1efde1ff30\nparent 25aca443e6091962eda3100bee4a9c427ef7a3e4\nparent 0d0c08f9bb75002138ed0b69b0058099ec41ccd1\nauthor Corey Farwell <coreyf@rwell.org> 1534519419 -0700\ncommitter GitHub <noreply@github.com> 1534519419 -0700\n\nRollup merge of #53357 - fukatani:pretty-print-btreemap, r=michaelwoerister\n\nPretty print btreemap for GDB\n\nMerge #53112 first, please.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/18122e0db06cb0411d994fe24e4dbbf3b8d35180", "html_url": "https://github.com/rust-lang/rust/commit/18122e0db06cb0411d994fe24e4dbbf3b8d35180", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/18122e0db06cb0411d994fe24e4dbbf3b8d35180/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "25aca443e6091962eda3100bee4a9c427ef7a3e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/25aca443e6091962eda3100bee4a9c427ef7a3e4", "html_url": "https://github.com/rust-lang/rust/commit/25aca443e6091962eda3100bee4a9c427ef7a3e4"}, {"sha": "0d0c08f9bb75002138ed0b69b0058099ec41ccd1", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d0c08f9bb75002138ed0b69b0058099ec41ccd1", "html_url": "https://github.com/rust-lang/rust/commit/0d0c08f9bb75002138ed0b69b0058099ec41ccd1"}], "stats": {"total": 63, "additions": 62, "deletions": 1}, "files": [{"sha": "1797f6708ac5b4745fcc2300fc3653b68c1320bc", "filename": "src/etc/debugger_pretty_printers_common.py", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/18122e0db06cb0411d994fe24e4dbbf3b8d35180/src%2Fetc%2Fdebugger_pretty_printers_common.py", "raw_url": "https://github.com/rust-lang/rust/raw/18122e0db06cb0411d994fe24e4dbbf3b8d35180/src%2Fetc%2Fdebugger_pretty_printers_common.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fdebugger_pretty_printers_common.py?ref=18122e0db06cb0411d994fe24e4dbbf3b8d35180", "patch": "@@ -49,6 +49,7 @@\n TYPE_KIND_OS_STRING         = 18\n TYPE_KIND_STD_VECDEQUE      = 19\n TYPE_KIND_STD_BTREESET      = 20\n+TYPE_KIND_STD_BTREEMAP      = 21\n \n ENCODED_ENUM_PREFIX = \"RUST$ENCODED$ENUM$\"\n ENUM_DISR_FIELD_NAME = \"RUST$ENUM$DISR\"\n@@ -75,6 +76,9 @@\n # std::collections::BTreeSet<> related constants\n STD_BTREESET_FIELD_NAMES = [\"map\"]\n \n+# std::collections::BTreeMap<> related constants\n+STD_BTREEMAP_FIELD_NAMES = [\"root\", \"length\"]\n+\n # std::String related constants\n STD_STRING_FIELD_NAMES = [\"vec\"]\n \n@@ -184,6 +188,11 @@ def __classify_struct(self):\n                 self.__conforms_to_field_layout(STD_BTREESET_FIELD_NAMES)):\n             return TYPE_KIND_STD_BTREESET\n \n+        # STD COLLECTION BTREEMAP\n+        if (unqualified_type_name.startswith(\"BTreeMap<\") and\n+                self.__conforms_to_field_layout(STD_BTREEMAP_FIELD_NAMES)):\n+            return TYPE_KIND_STD_BTREEMAP\n+\n         # STD STRING\n         if (unqualified_type_name.startswith(\"String\") and\n             self.__conforms_to_field_layout(STD_STRING_FIELD_NAMES)):\n@@ -380,6 +389,18 @@ def extract_length_and_ptr_from_std_btreeset(vec_val):\n     return (length, data_ptr)\n \n \n+def extract_length_and_ptr_from_std_btreemap(vec_val):\n+    assert vec_val.type.get_type_kind() == TYPE_KIND_STD_BTREEMAP\n+    root = vec_val.get_child_at_index(0)\n+    length = vec_val.get_child_at_index(1).as_integer()\n+    node = root.get_child_at_index(0)\n+    ptr = node.get_child_at_index(0)\n+    unique_ptr_val = ptr.get_child_at_index(0)\n+    data_ptr = unique_ptr_val.get_child_at_index(0)\n+    assert data_ptr.type.get_dwarf_type_kind() == DWARF_TYPE_CODE_PTR\n+    return (length, data_ptr)\n+\n+\n def extract_length_and_ptr_from_slice(slice_val):\n     assert (slice_val.type.get_type_kind() == TYPE_KIND_SLICE or\n             slice_val.type.get_type_kind() == TYPE_KIND_STR_SLICE)"}, {"sha": "216915dba5fe7c03116d1cf2906afd7bbafe392f", "filename": "src/etc/gdb_rust_pretty_printing.py", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/18122e0db06cb0411d994fe24e4dbbf3b8d35180/src%2Fetc%2Fgdb_rust_pretty_printing.py", "raw_url": "https://github.com/rust-lang/rust/raw/18122e0db06cb0411d994fe24e4dbbf3b8d35180/src%2Fetc%2Fgdb_rust_pretty_printing.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_rust_pretty_printing.py?ref=18122e0db06cb0411d994fe24e4dbbf3b8d35180", "patch": "@@ -130,6 +130,9 @@ def rust_pretty_printer_lookup_function(gdb_val):\n     if type_kind == rustpp.TYPE_KIND_STD_BTREESET:\n         return RustStdBTreeSetPrinter(val)\n \n+    if type_kind == rustpp.TYPE_KIND_STD_BTREEMAP:\n+        return RustStdBTreeMapPrinter(val)\n+\n     if type_kind == rustpp.TYPE_KIND_STD_STRING:\n         return RustStdStringPrinter(val)\n \n@@ -325,6 +328,32 @@ def children(self):\n             yield (str(index), gdb_ptr[index])\n \n \n+class RustStdBTreeMapPrinter(object):\n+    def __init__(self, val):\n+        self.__val = val\n+\n+    @staticmethod\n+    def display_hint():\n+        return \"map\"\n+\n+    def to_string(self):\n+        (length, data_ptr) = \\\n+            rustpp.extract_length_and_ptr_from_std_btreemap(self.__val)\n+        return (self.__val.type.get_unqualified_type_name() +\n+                (\"(len: %i)\" % length))\n+\n+    def children(self):\n+        (length, data_ptr) = \\\n+            rustpp.extract_length_and_ptr_from_std_btreemap(self.__val)\n+        keys = GdbValue(data_ptr.get_wrapped_value().dereference()).get_child_at_index(3)\n+        keys_ptr = keys.get_wrapped_value()\n+        vals = GdbValue(data_ptr.get_wrapped_value().dereference()).get_child_at_index(4)\n+        vals_ptr = vals.get_wrapped_value()\n+        for index in xrange(length):\n+            yield (str(index), keys_ptr[index])\n+            yield (str(index), vals_ptr[index])\n+\n+\n class RustStdStringPrinter(object):\n     def __init__(self, val):\n         self.__val = val\n@@ -338,6 +367,7 @@ def to_string(self):\n     def display_hint(self):\n         return \"string\"\n \n+\n class RustOsStringPrinter(object):\n     def __init__(self, val):\n         self.__val = val"}, {"sha": "8e37a884b34bbe24171fee585e1b98f1e8a394c3", "filename": "src/test/debuginfo/pretty-std-collections.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/18122e0db06cb0411d994fe24e4dbbf3b8d35180/src%2Ftest%2Fdebuginfo%2Fpretty-std-collections.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18122e0db06cb0411d994fe24e4dbbf3b8d35180/src%2Ftest%2Fdebuginfo%2Fpretty-std-collections.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fpretty-std-collections.rs?ref=18122e0db06cb0411d994fe24e4dbbf3b8d35180", "patch": "@@ -22,11 +22,15 @@\n // gdb-command: print btree_set\n // gdb-check:$1 = BTreeSet<i32>(len: 3) = {3, 5, 7}\n \n+// gdb-command: print btree_map\n+// gdb-check:$2 = BTreeMap<i32, i32>(len: 3) = {[3] = 3, [5] = 7, [7] = 4}\n+\n // gdb-command: print vec_deque\n-// gdb-check:$2 = VecDeque<i32>(len: 3, cap: 8) = {5, 3, 7}\n+// gdb-check:$3 = VecDeque<i32>(len: 3, cap: 8) = {5, 3, 7}\n \n #![allow(unused_variables)]\n use std::collections::BTreeSet;\n+use std::collections::BTreeMap;\n use std::collections::VecDeque;\n \n \n@@ -38,6 +42,12 @@ fn main() {\n     btree_set.insert(3);\n     btree_set.insert(7);\n \n+    // BTreeMap\n+    let mut btree_map = BTreeMap::new();\n+    btree_map.insert(5, 7);\n+    btree_map.insert(3, 3);\n+    btree_map.insert(7, 4);\n+\n     // VecDeque\n     let mut vec_deque = VecDeque::new();\n     vec_deque.push_back(5);"}]}