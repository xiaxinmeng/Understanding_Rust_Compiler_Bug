{"sha": "c24ba7e4f811e4b30d6d087f020835ccdf0ca445", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyNGJhN2U0ZjgxMWU0YjMwZDZkMDg3ZjAyMDgzNWNjZGYwY2E0NDU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-09T08:58:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-08-09T08:58:42Z"}, "message": "Rollup merge of #53110 - Xanewok:save-analysis-remap-path, r=nrc\n\nAccount for --remap-path-prefix in save-analysis\n\nFixes #52549.\n\nDidn't add a test since save-analysis is still unstable, only tested this locally. Should I add a test for that? If so, is run-make-fulldeps an appropriate format?\n\nSession is already created with remapped working directory, so use that instead of the actual cwd.\nThis was the only place affected, since the rest of the paths in save-analysis are directly derived from files in spans from `sess.codemap()`, which already creates remapped ones.\n\nr? @nrc", "tree": {"sha": "251efaed63cf780c2ee5aa57e9af6e71e3095c81", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/251efaed63cf780c2ee5aa57e9af6e71e3095c81"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c24ba7e4f811e4b30d6d087f020835ccdf0ca445", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbbAJDCRBK7hj4Ov3rIwAAdHIIAERnD28M1WJichERQ5qfeI1H\n8YoqF2sUldSk9L/IjnxzbE1A5LKaQ2KKOl0wErbyChSTt/bGpafoPqAYzjkr896P\n92I0gCTWVcZ/bZCEYYMEk+4JM/T4otQkhVcPDu7Ka76eBrKfHAX/eed9wJxuAg/3\nQKYpel3Mps8t8KQWywQK+Fz7k1cjk7wJyOXfuc1findqrHeG7R3OBdE5+1gjG8U6\nftdl+jt8MiGjy8EqV9EbgEHwCkLzqZLFpoYdutIzihZQ+l7nvdK6f5GpyHNBsdxc\nQARCR3qElASYLzSFxO+SZGrFPO4jn8D+pT72IaXJJYgt3onhl56SQwfFuEy1+Nw=\n=3NpM\n-----END PGP SIGNATURE-----\n", "payload": "tree 251efaed63cf780c2ee5aa57e9af6e71e3095c81\nparent dad5b6c554b034a5a366067a8aef31cef3772a61\nparent e8bb7bf35a0d5066a081cfa9a581849e34a91e02\nauthor kennytm <kennytm@gmail.com> 1533805122 +0800\ncommitter GitHub <noreply@github.com> 1533805122 +0800\n\nRollup merge of #53110 - Xanewok:save-analysis-remap-path, r=nrc\n\nAccount for --remap-path-prefix in save-analysis\n\nFixes #52549.\n\nDidn't add a test since save-analysis is still unstable, only tested this locally. Should I add a test for that? If so, is run-make-fulldeps an appropriate format?\n\nSession is already created with remapped working directory, so use that instead of the actual cwd.\nThis was the only place affected, since the rest of the paths in save-analysis are directly derived from files in spans from `sess.codemap()`, which already creates remapped ones.\n\nr? @nrc\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c24ba7e4f811e4b30d6d087f020835ccdf0ca445", "html_url": "https://github.com/rust-lang/rust/commit/c24ba7e4f811e4b30d6d087f020835ccdf0ca445", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c24ba7e4f811e4b30d6d087f020835ccdf0ca445/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dad5b6c554b034a5a366067a8aef31cef3772a61", "url": "https://api.github.com/repos/rust-lang/rust/commits/dad5b6c554b034a5a366067a8aef31cef3772a61", "html_url": "https://github.com/rust-lang/rust/commit/dad5b6c554b034a5a366067a8aef31cef3772a61"}, {"sha": "e8bb7bf35a0d5066a081cfa9a581849e34a91e02", "url": "https://api.github.com/repos/rust-lang/rust/commits/e8bb7bf35a0d5066a081cfa9a581849e34a91e02", "html_url": "https://github.com/rust-lang/rust/commit/e8bb7bf35a0d5066a081cfa9a581849e34a91e02"}], "stats": {"total": 8, "additions": 3, "deletions": 5}, "files": [{"sha": "e256f1761f146655aa8b76de226997cad52f949c", "filename": "src/librustc_save_analysis/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c24ba7e4f811e4b30d6d087f020835ccdf0ca445/src%2Flibrustc_save_analysis%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c24ba7e4f811e4b30d6d087f020835ccdf0ca445/src%2Flibrustc_save_analysis%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Flib.rs?ref=c24ba7e4f811e4b30d6d087f020835ccdf0ca445", "patch": "@@ -125,7 +125,7 @@ impl<'l, 'tcx: 'l> SaveContext<'l, 'tcx> {\n             result.push(ExternalCrateData {\n                 // FIXME: change file_name field to PathBuf in rls-data\n                 // https://github.com/nrc/rls-data/issues/7\n-                file_name: SpanUtils::make_path_string(&lo_loc.file.name),\n+                file_name: self.span_utils.make_path_string(&lo_loc.file.name),\n                 num: n.as_u32(),\n                 id: GlobalCrateId {\n                     name: self.tcx.crate_name(n).to_string(),"}, {"sha": "85dd2a3a20683e79dfe13a1ce40566c046bbc739", "filename": "src/librustc_save_analysis/span_utils.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c24ba7e4f811e4b30d6d087f020835ccdf0ca445/src%2Flibrustc_save_analysis%2Fspan_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c24ba7e4f811e4b30d6d087f020835ccdf0ca445/src%2Flibrustc_save_analysis%2Fspan_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Fspan_utils.rs?ref=c24ba7e4f811e4b30d6d087f020835ccdf0ca445", "patch": "@@ -13,7 +13,6 @@ use rustc::session::Session;\n use generated_code;\n \n use std::cell::Cell;\n-use std::env;\n \n use syntax::parse::lexer::{self, StringReader};\n use syntax::parse::token::{self, Token};\n@@ -36,11 +35,10 @@ impl<'a> SpanUtils<'a> {\n         }\n     }\n \n-    pub fn make_path_string(path: &FileName) -> String {\n+    pub fn make_path_string(&self, path: &FileName) -> String {\n         match *path {\n             FileName::Real(ref path) if !path.is_absolute() =>\n-                env::current_dir()\n-                    .unwrap()\n+                self.sess.working_dir.0\n                     .join(&path)\n                     .display()\n                     .to_string(),"}]}