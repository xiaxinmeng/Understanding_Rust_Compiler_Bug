{"sha": "2a60f090b9d39e5600dcbcf83229bbaec2f02176", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhNjBmMDkwYjlkMzllNTYwMGRjYmNmODMyMjliYmFlYzJmMDIxNzY=", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-06-27T23:15:16Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-06-30T18:28:15Z"}, "message": "Add suggestion for missing compile flag group", "tree": {"sha": "f877b21ba28cf7dc22d9e464e5fd2380d6f91139", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f877b21ba28cf7dc22d9e464e5fd2380d6f91139"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a60f090b9d39e5600dcbcf83229bbaec2f02176", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a60f090b9d39e5600dcbcf83229bbaec2f02176", "html_url": "https://github.com/rust-lang/rust/commit/2a60f090b9d39e5600dcbcf83229bbaec2f02176", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a60f090b9d39e5600dcbcf83229bbaec2f02176/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ddb78a34608848a60f6ca5b6ccfde8340302372", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ddb78a34608848a60f6ca5b6ccfde8340302372", "html_url": "https://github.com/rust-lang/rust/commit/3ddb78a34608848a60f6ca5b6ccfde8340302372"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "2ad2820fac0a87ce2e0ca867ef9087491c07fb87", "filename": "compiler/rustc_driver/src/lib.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/2a60f090b9d39e5600dcbcf83229bbaec2f02176/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a60f090b9d39e5600dcbcf83229bbaec2f02176/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver%2Fsrc%2Flib.rs?ref=2a60f090b9d39e5600dcbcf83229bbaec2f02176", "patch": "@@ -29,7 +29,7 @@ use rustc_middle::middle::cstore::MetadataLoader;\n use rustc_save_analysis as save;\n use rustc_save_analysis::DumpHandler;\n use rustc_serialize::json::{self, ToJson};\n-use rustc_session::config::nightly_options;\n+use rustc_session::config::{nightly_options, CG_OPTIONS, DB_OPTIONS};\n use rustc_session::config::{ErrorOutputType, Input, OutputType, PrintRequest, TrimmedDefPaths};\n use rustc_session::getopts;\n use rustc_session::lint::{Lint, LintId};\n@@ -1017,9 +1017,18 @@ pub fn handle_options(args: &[String]) -> Option<getopts::Matches> {\n     for option in config::rustc_optgroups() {\n         (option.apply)(&mut options);\n     }\n-    let matches = options\n-        .parse(args)\n-        .unwrap_or_else(|f| early_error(ErrorOutputType::default(), &f.to_string()));\n+    let matches = options.parse(args).unwrap_or_else(|e| {\n+        let msg = match e {\n+            getopts::Fail::UnrecognizedOption(ref opt) => CG_OPTIONS\n+                .iter()\n+                .map(|&(name, ..)| ('C', name))\n+                .chain(DB_OPTIONS.iter().map(|&(name, ..)| ('Z', name)))\n+                .find(|&(_, name)| *opt == name.replace(\"_\", \"-\"))\n+                .map(|(flag, _)| format!(\"{}. Did you mean `-{} {}`?\", e, flag, opt)),\n+            _ => None,\n+        };\n+        early_error(ErrorOutputType::default(), &msg.unwrap_or_else(|| e.to_string()));\n+    });\n \n     // For all options we just parsed, we check a few aspects:\n     //"}, {"sha": "7bbf47a3839513627649f5028e30655c38a945a3", "filename": "src/test/ui/invalid-compile-flags/codegen-option-without-group.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.rs?ref=2a60f090b9d39e5600dcbcf83229bbaec2f02176", "patch": "@@ -0,0 +1 @@\n+// compile-flags: --llvm-args"}, {"sha": "c5a0c29cad96581663e1e696062f97ffe577c4a7", "filename": "src/test/ui/invalid-compile-flags/codegen-option-without-group.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fcodegen-option-without-group.stderr?ref=2a60f090b9d39e5600dcbcf83229bbaec2f02176", "patch": "@@ -0,0 +1,2 @@\n+error: Unrecognized option: 'llvm-args'. Did you mean `-C llvm-args`?\n+"}, {"sha": "86e40c1785405453ccad899e229d9266b9c56b1b", "filename": "src/test/ui/invalid-compile-flags/debug-option-without-group.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.rs?ref=2a60f090b9d39e5600dcbcf83229bbaec2f02176", "patch": "@@ -0,0 +1 @@\n+// compile-flags: --unpretty=hir"}, {"sha": "0e57e31ad3dfa7e10217ced6fca01db944f682cc", "filename": "src/test/ui/invalid-compile-flags/debug-option-without-group.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2a60f090b9d39e5600dcbcf83229bbaec2f02176/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finvalid-compile-flags%2Fdebug-option-without-group.stderr?ref=2a60f090b9d39e5600dcbcf83229bbaec2f02176", "patch": "@@ -0,0 +1,2 @@\n+error: Unrecognized option: 'unpretty'. Did you mean `-Z unpretty`?\n+"}]}