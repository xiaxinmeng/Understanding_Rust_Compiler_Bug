{"sha": "2373599b82c4723ee738fe0408142d6bfcbb980c", "node_id": "C_kwDOAAsO6NoAKDIzNzM1OTliODJjNDcyM2VlNzM4ZmUwNDA4MTQyZDZiZmNiYjk4MGM", "commit": {"author": {"name": "Jeremy Fitzhardinge", "email": "jsgf@fb.com", "date": "2022-04-15T17:33:08Z"}, "committer": {"name": "Jeremy Fitzhardinge", "email": "jsgf@fb.com", "date": "2022-04-27T17:04:25Z"}, "message": "Add tests for --json unused-externs\n\nThere were none at all. These test for original functionality,\nbut this also adds a test that `-Dunused-crate-dependencies`\ncauses a compilation failure, which currently fails\n(https://github.com/rust-lang/rust/issues/96068). This is fixed in\nsubsequent changes.", "tree": {"sha": "7e5f49ba27c6186bffde0ddd4b2b0290e560b967", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e5f49ba27c6186bffde0ddd4b2b0290e560b967"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2373599b82c4723ee738fe0408142d6bfcbb980c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2373599b82c4723ee738fe0408142d6bfcbb980c", "html_url": "https://github.com/rust-lang/rust/commit/2373599b82c4723ee738fe0408142d6bfcbb980c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2373599b82c4723ee738fe0408142d6bfcbb980c/comments", "author": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0981b9857ed9a4c840221b089fc5103373c8595f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0981b9857ed9a4c840221b089fc5103373c8595f", "html_url": "https://github.com/rust-lang/rust/commit/0981b9857ed9a4c840221b089fc5103373c8595f"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "e9ab18ff63f394825c60026003bfd67d7bc1ecb0", "filename": "src/test/ui/unused-crate-deps/deny-attr.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-attr.rs?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1,9 @@\n+// Check for unused crate dep, no path\n+\n+// edition:2018\n+// aux-crate:bar=bar.rs\n+\n+#![deny(unused_crate_dependencies)]\n+//~^ ERROR external crate `bar` unused in\n+\n+fn main() {}"}, {"sha": "93694f6827f9c91752fa206771c70163049f9f50", "filename": "src/test/ui/unused-crate-deps/deny-attr.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-attr.stderr?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1,14 @@\n+error: external crate `bar` unused in `deny_attr`: remove the dependency or add `use bar as _;`\n+  --> $DIR/deny-attr.rs:6:1\n+   |\n+LL | #![deny(unused_crate_dependencies)]\n+   | ^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/deny-attr.rs:6:9\n+   |\n+LL | #![deny(unused_crate_dependencies)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}, {"sha": "9a95780bd08a5ef058a54c2e752d29b5a3d7da80", "filename": "src/test/ui/unused-crate-deps/deny-cmdline-json.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline-json.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline-json.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline-json.rs?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1,7 @@\n+// Check for unused crate dep, no path\n+\n+// edition:2018\n+// compile-flags: -Dunused-crate-dependencies  -Zunstable-options --json unused-externs --error-format=json\n+// aux-crate:bar=bar.rs\n+\n+fn main() {}"}, {"sha": "595619f3a8a4e728340efacf5b3a817dfa7e1199", "filename": "src/test/ui/unused-crate-deps/deny-cmdline-json.stderr", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline-json.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline-json.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline-json.stderr?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1 @@\n+{\"lint_level\":\"deny\",\"unused_extern_names\":[\"bar\"]}"}, {"sha": "17c6e1bf193ddf3480c5e92d7fe455c62b737cda", "filename": "src/test/ui/unused-crate-deps/deny-cmdline.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline.rs?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1,8 @@\n+// Check for unused crate dep, no path\n+\n+// edition:2018\n+// compile-flags: -Dunused-crate-dependencies\n+// aux-crate:bar=bar.rs\n+\n+fn main() {}\n+//~^ ERROR external crate `bar` unused in"}, {"sha": "0951dc670fe9ef9dabae1ee78313dad1240175cf", "filename": "src/test/ui/unused-crate-deps/deny-cmdline.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fdeny-cmdline.stderr?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1,10 @@\n+error: external crate `bar` unused in `deny_cmdline`: remove the dependency or add `use bar as _;`\n+  --> $DIR/deny-cmdline.rs:7:1\n+   |\n+LL | fn main() {}\n+   | ^\n+   |\n+   = note: requested on the command line with `-D unused-crate-dependencies`\n+\n+error: aborting due to previous error\n+"}, {"sha": "a845fe6fd240b3ce6aba31070ef6c87b9aaf6991", "filename": "src/test/ui/unused-crate-deps/warn-cmdline-json.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-json.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-json.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-json.rs?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1,8 @@\n+// Check for unused crate dep, no path\n+\n+// edition:2018\n+// check-pass\n+// compile-flags: -Wunused-crate-dependencies -Zunstable-options --json unused-externs --error-format=json\n+// aux-crate:bar=bar.rs\n+\n+fn main() {}"}, {"sha": "98dbd763927e6351b892af45a95b449f5aa8705a", "filename": "src/test/ui/unused-crate-deps/warn-cmdline-json.stderr", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-json.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2373599b82c4723ee738fe0408142d6bfcbb980c/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-json.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-json.stderr?ref=2373599b82c4723ee738fe0408142d6bfcbb980c", "patch": "@@ -0,0 +1 @@\n+{\"lint_level\":\"warn\",\"unused_extern_names\":[\"bar\"]}"}]}