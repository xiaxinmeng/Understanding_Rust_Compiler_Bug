{"sha": "ed8651c7b8f9a179b584124cde3994bb93433bb0", "node_id": "C_kwDOAAsO6NoAKGVkODY1MWM3YjhmOWExNzliNTg0MTI0Y2RlMzk5NGJiOTM0MzNiYjA", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-02-07T15:11:04Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-02-09T10:26:50Z"}, "message": "Use 'static RegionVid for ReError", "tree": {"sha": "e2fbcb1a40a1691cd43dfce37872f9ae94884db6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e2fbcb1a40a1691cd43dfce37872f9ae94884db6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ed8651c7b8f9a179b584124cde3994bb93433bb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ed8651c7b8f9a179b584124cde3994bb93433bb0", "html_url": "https://github.com/rust-lang/rust/commit/ed8651c7b8f9a179b584124cde3994bb93433bb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ed8651c7b8f9a179b584124cde3994bb93433bb0/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "861f4512353e83dbc67de34992058f44fc1b4648", "url": "https://api.github.com/repos/rust-lang/rust/commits/861f4512353e83dbc67de34992058f44fc1b4648", "html_url": "https://github.com/rust-lang/rust/commit/861f4512353e83dbc67de34992058f44fc1b4648"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "56930c89b2c6421e1a145e8150c0424011f32457", "filename": "compiler/rustc_borrowck/src/universal_regions.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ed8651c7b8f9a179b584124cde3994bb93433bb0/compiler%2Frustc_borrowck%2Fsrc%2Funiversal_regions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed8651c7b8f9a179b584124cde3994bb93433bb0/compiler%2Frustc_borrowck%2Fsrc%2Funiversal_regions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Funiversal_regions.rs?ref=ed8651c7b8f9a179b584124cde3994bb93433bb0", "patch": "@@ -167,6 +167,9 @@ struct UniversalRegionIndices<'tcx> {\n     /// contains an entry for `ReStatic` -- it might be nice to just\n     /// use a substs, and then handle `ReStatic` another way.\n     indices: FxHashMap<ty::Region<'tcx>, RegionVid>,\n+\n+    /// The vid assigned to `'static`. Used only for diagnostics.\n+    pub fr_static: RegionVid,\n }\n \n #[derive(Debug, PartialEq)]\n@@ -609,7 +612,7 @@ impl<'cx, 'tcx> UniversalRegionsBuilder<'cx, 'tcx> {\n         let subst_mapping =\n             iter::zip(identity_substs.regions(), fr_substs.regions().map(|r| r.to_region_vid()));\n \n-        UniversalRegionIndices { indices: global_mapping.chain(subst_mapping).collect() }\n+        UniversalRegionIndices { indices: global_mapping.chain(subst_mapping).collect(), fr_static }\n     }\n \n     fn compute_inputs_and_output(\n@@ -821,8 +824,11 @@ impl<'tcx> UniversalRegionIndices<'tcx> {\n     pub fn to_region_vid(&self, r: ty::Region<'tcx>) -> RegionVid {\n         if let ty::ReVar(..) = *r {\n             r.to_region_vid()\n-        } else if let ty::ReError(_) = *r {\n-            RegionVid::new(0)\n+        } else if r.is_error() {\n+            // We use the `'static` `RegionVid` because `ReError` doesn't actually exist in the\n+            // `UniversalRegionIndices`. This is fine because 1) it is a fallback only used if\n+            // errors are being emitted and 2) it leaves the happy path unaffected.\n+            self.fr_static\n         } else {\n             *self\n                 .indices"}]}