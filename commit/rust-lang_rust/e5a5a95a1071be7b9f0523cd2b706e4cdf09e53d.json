{"sha": "e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1YTVhOTVhMTA3MWJlN2I5ZjA1MjNjZDJiNzA2ZTRjZGYwOWU1M2Q=", "commit": {"author": {"name": "Machtan", "email": "jako3047@gmail.com", "date": "2016-11-08T13:28:46Z"}, "committer": {"name": "Machtan", "email": "jako3047@gmail.com", "date": "2016-11-08T13:28:46Z"}, "message": "Add '--version' flag and use version and help flags when called as 'cargo-clippy'", "tree": {"sha": "6497ed7d200938bf627248fc023fc3aa643fde5b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6497ed7d200938bf627248fc023fc3aa643fde5b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d", "html_url": "https://github.com/rust-lang/rust/commit/e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d/comments", "author": null, "committer": null, "parents": [{"sha": "3800bff4de9f081ef2f02b95d9ba4bae529c82af", "url": "https://api.github.com/repos/rust-lang/rust/commits/3800bff4de9f081ef2f02b95d9ba4bae529c82af", "html_url": "https://github.com/rust-lang/rust/commit/3800bff4de9f081ef2f02b95d9ba4bae529c82af"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "387cdb864eeefc52b62d443429fa0c8398234f99", "filename": "src/main.rs", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d/src%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d/src%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain.rs?ref=e5a5a95a1071be7b9f0523cd2b706e4cdf09e53d", "patch": "@@ -17,8 +17,9 @@ use rustc_driver::{driver, CompilerCalls, RustcDefaultCalls, Compilation};\n use rustc::session::{config, Session};\n use rustc::session::config::{Input, ErrorOutputType};\n use std::path::PathBuf;\n-use std::process::Command;\n+use std::process::{self, Command};\n use syntax::ast;\n+use std::io::{self, Write};\n \n use clippy_lints::utils::cargo;\n \n@@ -141,6 +142,12 @@ fn show_help() {\n     println!(\"{}\", CARGO_CLIPPY_HELP);\n }\n \n+#[allow(print_stdout)]\n+fn show_version() {\n+    println!(\"{}\", env!(\"CARGO_PKG_VERSION\"));\n+}\n+\n+#[cfg_attr(feature = \"cargo-clippy\", allow(print_stdout))]\n pub fn main() {\n     use std::env;\n \n@@ -154,7 +161,7 @@ pub fn main() {\n         return;\n     }\n     if std::env::args().any(|a| a == \"--version\" || a == \"-V\") {\n-        println!(\"{}\", env!(\"CARGO_PKG_VERSION\"));\n+        show_version();\n         return;\n     }\n \n@@ -165,7 +172,12 @@ pub fn main() {\n \n         let manifest_path_arg = std::env::args().skip(2).find(|val| val.starts_with(\"--manifest-path=\"));\n \n-        let mut metadata = cargo::metadata(manifest_path_arg.as_ref().map(AsRef::as_ref)).expect(\"could not obtain cargo metadata\");\n+        let mut metadata = if let Ok(metadata) = cargo::metadata(manifest_path_arg.as_ref().map(AsRef::as_ref)) {\n+            metadata\n+        } else {\n+            let _ = io::stderr().write_fmt(format_args!(\"error: Could not obtain cargo metadata.\"));\n+            process::exit(101);\n+        };\n \n         assert_eq!(metadata.version, 1);\n "}]}