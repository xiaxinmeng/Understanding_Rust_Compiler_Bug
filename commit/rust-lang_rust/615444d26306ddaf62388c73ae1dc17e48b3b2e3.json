{"sha": "615444d26306ddaf62388c73ae1dc17e48b3b2e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxNTQ0NGQyNjMwNmRkYWY2MjM4OGM3M2FlMWRjMTdlNDhiM2IyZTM=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-11-04T23:45:46Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-11-04T23:48:34Z"}, "message": "Stop extra buffering when stdout isn't a tty\n\nRight now if you're running a program with its output piped to some location and\nthe program decides to go awry, when you kill the program via some signal none\nof the program's last 4K of output will get printed to the screen. In theory the\nsolution to this would be to register a signal handler as part of the runtime\nwhich then flushes the output stream.\n\nI believe that the current behavior is far enough from what's expected that we\nshouldn't be providing this sort of \"super buffering\" by default when stdout\nisn't attached to a tty.", "tree": {"sha": "72784f8711c06637bafd38f93dcfdc23c6a5a423", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/72784f8711c06637bafd38f93dcfdc23c6a5a423"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/615444d26306ddaf62388c73ae1dc17e48b3b2e3", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/615444d26306ddaf62388c73ae1dc17e48b3b2e3", "html_url": "https://github.com/rust-lang/rust/commit/615444d26306ddaf62388c73ae1dc17e48b3b2e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/615444d26306ddaf62388c73ae1dc17e48b3b2e3/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "658637baf45b41e4cff049440bc07f267d810218", "url": "https://api.github.com/repos/rust-lang/rust/commits/658637baf45b41e4cff049440bc07f267d810218", "html_url": "https://github.com/rust-lang/rust/commit/658637baf45b41e4cff049440bc07f267d810218"}], "stats": {"total": 18, "additions": 5, "deletions": 13}, "files": [{"sha": "d33821a34b1eedca1c21800f576975b1dd47cb0b", "filename": "src/libstd/rt/io/stdio.rs", "status": "modified", "additions": 5, "deletions": 13, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/615444d26306ddaf62388c73ae1dc17e48b3b2e3/src%2Flibstd%2Frt%2Fio%2Fstdio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/615444d26306ddaf62388c73ae1dc17e48b3b2e3/src%2Flibstd%2Frt%2Fio%2Fstdio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Fio%2Fstdio.rs?ref=615444d26306ddaf62388c73ae1dc17e48b3b2e3", "patch": "@@ -30,7 +30,7 @@ use fmt;\n use libc;\n use option::{Option, Some, None};\n use result::{Ok, Err};\n-use rt::io::buffered::{LineBufferedWriter, BufferedWriter};\n+use rt::io::buffered::LineBufferedWriter;\n use rt::rtio::{IoFactory, RtioTTY, RtioFileStream, with_local_io,\n                CloseAsynchronously};\n use super::{Reader, Writer, io_error, IoError, OtherIoError};\n@@ -135,14 +135,7 @@ fn with_task_stdout(f: &fn(&mut Writer)) {\n             Some(ref mut handle) => f(*handle),\n             None => {\n                 let handle = stdout();\n-                let mut handle = if handle.isatty() {\n-                    ~LineBufferedWriter::new(handle) as ~Writer\n-                } else {\n-                    // The default capacity is very large, 64k, but this is just\n-                    // a stdout stream, and possibly per task, so let's not make\n-                    // this too expensive.\n-                    ~BufferedWriter::with_capacity(4096, handle) as ~Writer\n-                };\n+                let mut handle = ~LineBufferedWriter::new(handle) as ~Writer;\n                 f(handle);\n                 (*task).stdout_handle = Some(handle);\n             }\n@@ -152,10 +145,9 @@ fn with_task_stdout(f: &fn(&mut Writer)) {\n \n /// Flushes the local task's stdout handle.\n ///\n-/// By default, this stream is a buffering stream, flushing may be necessary to\n-/// ensure output is on the terminal screen. The buffering used is\n-/// line-buffering when stdout is attached to a terminal, and a fixed sized\n-/// buffer if it is not attached to a terminal.\n+/// By default, this stream is a line-buffering stream, so flushing may be\n+/// necessary to ensure that all output is printed to the screen (if there are\n+/// no newlines printed).\n ///\n /// Note that logging macros do not use this stream. Using the logging macros\n /// will emit output to stderr, and while they are line buffered the log"}]}