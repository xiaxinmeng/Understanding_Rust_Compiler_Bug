{"sha": "03a61134f22fae8574766313f6ffd39d1007c7fe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzYTYxMTM0ZjIyZmFlODU3NDc2NjMxM2Y2ZmZkMzlkMTAwN2M3ZmU=", "commit": {"author": {"name": "Jacob Rothstein", "email": "hi@jbr.me", "date": "2020-08-03T19:17:05Z"}, "committer": {"name": "Jacob Rothstein", "email": "hi@jbr.me", "date": "2020-08-03T19:17:05Z"}, "message": "do not add to `pub use` statements", "tree": {"sha": "22ec28220c7145ba924735c77bcb55e1c342392e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/22ec28220c7145ba924735c77bcb55e1c342392e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/03a61134f22fae8574766313f6ffd39d1007c7fe", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEBO7IuRBkkyf0dEJWw4uhjGz+FaUFAl8oYrEACgkQw4uhjGz+\nFaXdNA//RfHbkz/vt5n8cOuuMitQNEPThouY1YLi01MsDX2oGmxka4JDfinmbaKK\nJTIvalp8KXW489Ff6/8Xyh0z4wzSCZ8PkGx+RvBMzKfE39brKmmWxcCDEQlaBDYS\nSrtJWO0k/96w8sCB3tpCPQWIeoFrl+EvVcqvAVJ+A0Nr6DLbXn18PlYAkFjDVAaQ\n0phLNxvNlgzPBd7AEirJRgAB9ODXDIi5/5mA+v3bOet1ScaovjMTMlFLqt1mwrBI\nlbfqjTAe+x/5qF2/IyhSROOeeY4uQb4gBoW2yh8PWfB56SIlxpcPOZ+VmPdaEtMa\ns7cvJo9C6OfRUZ6Vl8cFiqXpcW+MGibOpz/5Ias55wb2ZBU8vFv4UkEid7qcsZWo\nSIPf61aKU/JjAyrptamcpufV+Uy4m4GYiv567/Jcs9vztmZFJsKyP5QcJEtAIStg\nacN5t/GNLNjdDK0oLTGoZeBnIpjj3K/U0MJdxgW8zSSdAhs0KSmeOGiGd5BfG51Q\npEVhXmMJwK2W3VD+471R95VCILmPrkCWZhoMvc5bMh5Tf00tFWdQeBFY5n4E9P5i\nAidlVQTKXADBcBkv2QmtQsXLFalwM5bCy9AmzsbCXh28mk0R2SwzTVnzEZ9E44wf\nODJPCedXKzXsu3ygICI+BlRX3htYSwidwQOxgyWGRkiQzjnDesQ=\n=WOvz\n-----END PGP SIGNATURE-----", "payload": "tree 22ec28220c7145ba924735c77bcb55e1c342392e\nparent 33e53d472158746c6a0150538bea348ce0e5a22d\nauthor Jacob Rothstein <hi@jbr.me> 1596482225 -0700\ncommitter Jacob Rothstein <hi@jbr.me> 1596482225 -0700\n\ndo not add to `pub use` statements\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/03a61134f22fae8574766313f6ffd39d1007c7fe", "html_url": "https://github.com/rust-lang/rust/commit/03a61134f22fae8574766313f6ffd39d1007c7fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/03a61134f22fae8574766313f6ffd39d1007c7fe/comments", "author": {"login": "jbr", "id": 13301, "node_id": "MDQ6VXNlcjEzMzAx", "avatar_url": "https://avatars.githubusercontent.com/u/13301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbr", "html_url": "https://github.com/jbr", "followers_url": "https://api.github.com/users/jbr/followers", "following_url": "https://api.github.com/users/jbr/following{/other_user}", "gists_url": "https://api.github.com/users/jbr/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbr/subscriptions", "organizations_url": "https://api.github.com/users/jbr/orgs", "repos_url": "https://api.github.com/users/jbr/repos", "events_url": "https://api.github.com/users/jbr/events{/privacy}", "received_events_url": "https://api.github.com/users/jbr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jbr", "id": 13301, "node_id": "MDQ6VXNlcjEzMzAx", "avatar_url": "https://avatars.githubusercontent.com/u/13301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbr", "html_url": "https://github.com/jbr", "followers_url": "https://api.github.com/users/jbr/followers", "following_url": "https://api.github.com/users/jbr/following{/other_user}", "gists_url": "https://api.github.com/users/jbr/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbr/subscriptions", "organizations_url": "https://api.github.com/users/jbr/orgs", "repos_url": "https://api.github.com/users/jbr/repos", "events_url": "https://api.github.com/users/jbr/events{/privacy}", "received_events_url": "https://api.github.com/users/jbr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33e53d472158746c6a0150538bea348ce0e5a22d", "url": "https://api.github.com/repos/rust-lang/rust/commits/33e53d472158746c6a0150538bea348ce0e5a22d", "html_url": "https://github.com/rust-lang/rust/commit/33e53d472158746c6a0150538bea348ce0e5a22d"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "da0a860c599fdb9776cd74af55ef004f18fa0b80", "filename": "crates/ra_assists/src/handlers/replace_qualified_name_with_use.rs", "status": "modified", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/03a61134f22fae8574766313f6ffd39d1007c7fe/crates%2Fra_assists%2Fsrc%2Fhandlers%2Freplace_qualified_name_with_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03a61134f22fae8574766313f6ffd39d1007c7fe/crates%2Fra_assists%2Fsrc%2Fhandlers%2Freplace_qualified_name_with_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fhandlers%2Freplace_qualified_name_with_use.rs?ref=03a61134f22fae8574766313f6ffd39d1007c7fe", "patch": "@@ -639,6 +639,48 @@ use std::fmt::{self, Display};\n \n fn main() {\n     fmt;\n+}\n+    \",\n+        );\n+    }\n+\n+    #[test]\n+    fn does_not_replace_pub_use() {\n+        check_assist(\n+            replace_qualified_name_with_use,\n+            r\"\n+pub use std::fmt;\n+\n+impl std::io<|> for Foo {\n+}\n+    \",\n+            r\"\n+use std::io;\n+\n+pub use std::fmt;\n+\n+impl io for Foo {\n+}\n+    \",\n+        );\n+    }\n+\n+    #[test]\n+    fn does_not_replace_pub_crate_use() {\n+        check_assist(\n+            replace_qualified_name_with_use,\n+            r\"\n+pub(crate) use std::fmt;\n+\n+impl std::io<|> for Foo {\n+}\n+    \",\n+            r\"\n+use std::io;\n+\n+pub(crate) use std::fmt;\n+\n+impl io for Foo {\n }\n     \",\n         );"}, {"sha": "32780fceb59b997c12c0e237eb6f43ec42cca320", "filename": "crates/ra_assists/src/utils/insert_use.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/03a61134f22fae8574766313f6ffd39d1007c7fe/crates%2Fra_assists%2Fsrc%2Futils%2Finsert_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03a61134f22fae8574766313f6ffd39d1007c7fe/crates%2Fra_assists%2Fsrc%2Futils%2Finsert_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Futils%2Finsert_use.rs?ref=03a61134f22fae8574766313f6ffd39d1007c7fe", "patch": "@@ -4,7 +4,7 @@\n \n use hir::{self, ModPath};\n use ra_syntax::{\n-    ast::{self, NameOwner},\n+    ast::{self, NameOwner, VisibilityOwner},\n     AstNode, Direction, SmolStr,\n     SyntaxKind::{PATH, PATH_SEGMENT},\n     SyntaxNode, T,\n@@ -378,6 +378,7 @@ fn best_action_for_target(\n     let best_action = container\n         .children()\n         .filter_map(ast::Use::cast)\n+        .filter(|u| u.visibility().is_none())\n         .filter_map(|it| it.use_tree())\n         .map(|u| walk_use_tree_for_best_action(&mut storage, None, u, target))\n         .fold(None, |best, a| match best {"}]}