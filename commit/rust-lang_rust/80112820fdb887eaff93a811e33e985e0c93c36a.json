{"sha": "80112820fdb887eaff93a811e33e985e0c93c36a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwMTEyODIwZmRiODg3ZWFmZjkzYTgxMWUzM2U5ODVlMGM5M2MzNmE=", "commit": {"author": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-02-13T18:02:21Z"}, "committer": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-02-14T08:27:20Z"}, "message": "[cargo-miri] Don't skip `rlib` crates", "tree": {"sha": "109e9e298b5233aa5b2205d5ea26ed7b01c2f175", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/109e9e298b5233aa5b2205d5ea26ed7b01c2f175"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/80112820fdb887eaff93a811e33e985e0c93c36a", "comment_count": 0, "verification": {"verified": false, "reason": "no_user", "signature": "-----BEGIN PGP SIGNATURE-----\n\niIsEABYIADMWIQRJ2jPMDdiQ+U4U42Z0+n/VuNoUuAUCYCje6BUceWQtaHVhbmdA\nb3V0bG9vay5jb20ACgkQdPp/1bjaFLipsAEAzCZH/R88Fr8PIXBL7aAiBlvl65ME\nsyfku70PdYuqvMMBAK4aE9OKRxY3CC5/GVg3wNNu9xmmTj0EE0tQ0+QV4QwK\n=LmIB\n-----END PGP SIGNATURE-----", "payload": "tree 109e9e298b5233aa5b2205d5ea26ed7b01c2f175\nparent 7ac8be8529d77c0f75e6459859e4831a81498aca\nauthor hyd-dev <yd-huang@outlook.com> 1613239341 +0800\ncommitter hyd-dev <yd-huang@outlook.com> 1613291240 +0800\n\n[cargo-miri] Don't skip `rlib` crates\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/80112820fdb887eaff93a811e33e985e0c93c36a", "html_url": "https://github.com/rust-lang/rust/commit/80112820fdb887eaff93a811e33e985e0c93c36a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/80112820fdb887eaff93a811e33e985e0c93c36a/comments", "author": null, "committer": null, "parents": [{"sha": "7ac8be8529d77c0f75e6459859e4831a81498aca", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ac8be8529d77c0f75e6459859e4831a81498aca", "html_url": "https://github.com/rust-lang/rust/commit/7ac8be8529d77c0f75e6459859e4831a81498aca"}], "stats": {"total": 34, "additions": 25, "deletions": 9}, "files": [{"sha": "f38e79732b27460dc70c690355d016fb551a66aa", "filename": "cargo-miri/bin.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/80112820fdb887eaff93a811e33e985e0c93c36a/cargo-miri%2Fbin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/80112820fdb887eaff93a811e33e985e0c93c36a/cargo-miri%2Fbin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbin.rs?ref=80112820fdb887eaff93a811e33e985e0c93c36a", "patch": "@@ -596,16 +596,13 @@ fn phase_cargo_rustc(args: env::Args) {\n     let target_crate = is_target_crate();\n     let print = get_arg_flag_value(\"--print\").is_some(); // whether this is cargo passing `--print` to get some infos\n \n-    // rlib and cdylib are just skipped, we cannot interpret them and do not need them\n+    // cdylib is just skipped, we cannot interpret it and do not need it\n     // for the rest of the build either.\n-    match get_arg_flag_value(\"--crate-type\").as_deref() {\n-        Some(\"rlib\") | Some(\"cdylib\") => {\n-            if verbose {\n-                eprint!(\"[cargo-miri rustc] (rlib/cdylib skipped)\");\n-            }\n-            return;\n+    if get_arg_flag_value(\"--crate-type\").as_deref() == Some(\"cdylib\") {\n+        if verbose {\n+            eprint!(\"[cargo-miri rustc] (cdylib skipped)\");\n         }\n-        _ => {},\n+        return;\n     }\n \n     let store_json = |info: CrateRunInfo| {"}, {"sha": "84b69f57333e2e6c2dab2da513612fd5bf8d13d8", "filename": "test-cargo-miri/Cargo.lock", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2FCargo.lock?ref=80112820fdb887eaff93a811e33e985e0c93c36a", "patch": "@@ -1,5 +1,7 @@\n # This file is automatically @generated by Cargo.\n # It is not intended for manual editing.\n+version = 3\n+\n [[package]]\n name = \"byteorder\"\n version = \"1.3.4\"\n@@ -13,6 +15,7 @@ dependencies = [\n  \"byteorder\",\n  \"issue_1567\",\n  \"rand\",\n+ \"rlib-dep\",\n  \"serde_derive\",\n ]\n \n@@ -140,6 +143,10 @@ dependencies = [\n  \"rand_core\",\n ]\n \n+[[package]]\n+name = \"rlib-dep\"\n+version = \"0.1.0\"\n+\n [[package]]\n name = \"serde_derive\"\n version = \"1.0.118\""}, {"sha": "ab44f6b304a7b5c5da30c793b6c67518a683c9eb", "filename": "test-cargo-miri/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2FCargo.toml?ref=80112820fdb887eaff93a811e33e985e0c93c36a", "patch": "@@ -9,6 +9,7 @@ edition = \"2018\"\n \n [dependencies]\n byteorder = \"1.0\"\n+rlib-dep.path = \"rlib-dep\"\n issue_1567 = { path =\"issue-1567\" }\n \n [dev-dependencies]"}, {"sha": "c12653e9c839ce7a9bc90f6c47c31d2863e2eac3", "filename": "test-cargo-miri/rlib-dep/Cargo.toml", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2Frlib-dep%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2Frlib-dep%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Frlib-dep%2FCargo.toml?ref=80112820fdb887eaff93a811e33e985e0c93c36a", "patch": "@@ -0,0 +1,8 @@\n+[package]\n+name = \"rlib-dep\"\n+version = \"0.1.0\"\n+authors = [\"Miri Team\"]\n+edition = \"2018\"\n+\n+[lib]\n+crate-type = [\"rlib\"]"}, {"sha": "efde2b58e199e042ffea44db102ae2cc8be609ed", "filename": "test-cargo-miri/rlib-dep/src/lib.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2Frlib-dep%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2Frlib-dep%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Frlib-dep%2Fsrc%2Flib.rs?ref=80112820fdb887eaff93a811e33e985e0c93c36a", "patch": "@@ -0,0 +1,3 @@\n+pub fn use_me() -> bool {\n+    true\n+}"}, {"sha": "46d76bce1277cf79e1441a4c5cedb0853124b956", "filename": "test-cargo-miri/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/80112820fdb887eaff93a811e33e985e0c93c36a/test-cargo-miri%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fsrc%2Flib.rs?ref=80112820fdb887eaff93a811e33e985e0c93c36a", "patch": "@@ -3,5 +3,5 @@\n /// assert!(cargo_miri_test::make_true());\n /// ```\n pub fn make_true() -> bool {\n-    true\n+    rlib_dep::use_me()\n }"}]}