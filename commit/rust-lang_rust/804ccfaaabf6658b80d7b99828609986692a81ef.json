{"sha": "804ccfaaabf6658b80d7b99828609986692a81ef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwNGNjZmFhYWJmNjY1OGI4MGQ3Yjk5ODI4NjA5OTg2NjkyYTgxZWY=", "commit": {"author": {"name": "Noble-Mushtak", "email": "noblemushtak.public@gmail.com", "date": "2021-09-07T21:48:03Z"}, "committer": {"name": "Noble-Mushtak", "email": "noblemushtak.public@gmail.com", "date": "2021-09-09T01:14:49Z"}, "message": "Fatal error for functions with more than 65535 arguments", "tree": {"sha": "f8397a2faedcc4d21f4b4efea9ea74040a099579", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f8397a2faedcc4d21f4b4efea9ea74040a099579"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/804ccfaaabf6658b80d7b99828609986692a81ef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/804ccfaaabf6658b80d7b99828609986692a81ef", "html_url": "https://github.com/rust-lang/rust/commit/804ccfaaabf6658b80d7b99828609986692a81ef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/804ccfaaabf6658b80d7b99828609986692a81ef/comments", "author": {"login": "Noble-Mushtak", "id": 11696563, "node_id": "MDQ6VXNlcjExNjk2NTYz", "avatar_url": "https://avatars.githubusercontent.com/u/11696563?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Noble-Mushtak", "html_url": "https://github.com/Noble-Mushtak", "followers_url": "https://api.github.com/users/Noble-Mushtak/followers", "following_url": "https://api.github.com/users/Noble-Mushtak/following{/other_user}", "gists_url": "https://api.github.com/users/Noble-Mushtak/gists{/gist_id}", "starred_url": "https://api.github.com/users/Noble-Mushtak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Noble-Mushtak/subscriptions", "organizations_url": "https://api.github.com/users/Noble-Mushtak/orgs", "repos_url": "https://api.github.com/users/Noble-Mushtak/repos", "events_url": "https://api.github.com/users/Noble-Mushtak/events{/privacy}", "received_events_url": "https://api.github.com/users/Noble-Mushtak/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Noble-Mushtak", "id": 11696563, "node_id": "MDQ6VXNlcjExNjk2NTYz", "avatar_url": "https://avatars.githubusercontent.com/u/11696563?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Noble-Mushtak", "html_url": "https://github.com/Noble-Mushtak", "followers_url": "https://api.github.com/users/Noble-Mushtak/followers", "following_url": "https://api.github.com/users/Noble-Mushtak/following{/other_user}", "gists_url": "https://api.github.com/users/Noble-Mushtak/gists{/gist_id}", "starred_url": "https://api.github.com/users/Noble-Mushtak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Noble-Mushtak/subscriptions", "organizations_url": "https://api.github.com/users/Noble-Mushtak/orgs", "repos_url": "https://api.github.com/users/Noble-Mushtak/repos", "events_url": "https://api.github.com/users/Noble-Mushtak/events{/privacy}", "received_events_url": "https://api.github.com/users/Noble-Mushtak/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97032a6dfacdd3548e4bff98c90a6b3875a14077", "url": "https://api.github.com/repos/rust-lang/rust/commits/97032a6dfacdd3548e4bff98c90a6b3875a14077", "html_url": "https://github.com/rust-lang/rust/commit/97032a6dfacdd3548e4bff98c90a6b3875a14077"}], "stats": {"total": 39, "additions": 39, "deletions": 0}, "files": [{"sha": "e9dce953c73888e3e80ea8258117bc3ac7a81878", "filename": "compiler/rustc_ast_passes/src/ast_validation.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/804ccfaaabf6658b80d7b99828609986692a81ef/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/804ccfaaabf6658b80d7b99828609986692a81ef/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs?ref=804ccfaaabf6658b80d7b99828609986692a81ef", "patch": "@@ -422,11 +422,25 @@ impl<'a> AstValidator<'a> {\n     }\n \n     fn check_fn_decl(&self, fn_decl: &FnDecl, self_semantic: SelfSemantic) {\n+        self.check_decl_num_args(fn_decl);\n         self.check_decl_cvaradic_pos(fn_decl);\n         self.check_decl_attrs(fn_decl);\n         self.check_decl_self_param(fn_decl, self_semantic);\n     }\n \n+    /// Emits fatal error if function declaration has more than `u16::MAX` arguments\n+    /// Error is fatal to prevent errors during typechecking\n+    fn check_decl_num_args(&self, fn_decl: &FnDecl) {\n+        let max_num_args: usize = u16::MAX.into();\n+        if fn_decl.inputs.len() > max_num_args {\n+            let Param { span, .. } = fn_decl.inputs[0];\n+            self.err_handler().span_fatal(\n+                span,\n+                &format!(\"function can not have more than {} arguments\", max_num_args),\n+            );\n+        }\n+    }\n+\n     fn check_decl_cvaradic_pos(&self, fn_decl: &FnDecl) {\n         match &*fn_decl.inputs {\n             [Param { ty, span, .. }] => {"}, {"sha": "e50cc586515a626d4a64284cc57c1c60bbbc7ff7", "filename": "src/test/ui/type/type-check/issue-88577-check-fn-with-more-than-65535-arguments.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/804ccfaaabf6658b80d7b99828609986692a81ef/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Fissue-88577-check-fn-with-more-than-65535-arguments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/804ccfaaabf6658b80d7b99828609986692a81ef/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Fissue-88577-check-fn-with-more-than-65535-arguments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Fissue-88577-check-fn-with-more-than-65535-arguments.rs?ref=804ccfaaabf6658b80d7b99828609986692a81ef", "patch": "@@ -0,0 +1,12 @@\n+macro_rules! many_args {\n+    ([$($t:tt)*]#$($h:tt)*) => {\n+        many_args!{[$($t)*$($t)*]$($h)*}\n+    };\n+    ([$($t:tt)*]) => {\n+        fn _f($($t: ()),*) {} //~ ERROR function can not have more than 65535 arguments\n+    }\n+}\n+\n+many_args!{[_]########## ######}\n+\n+fn main() {}"}, {"sha": "615fd2ccb04af04942a0d40d12aeffb7274f0a48", "filename": "src/test/ui/type/type-check/issue-88577-check-fn-with-more-than-65535-arguments.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/804ccfaaabf6658b80d7b99828609986692a81ef/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Fissue-88577-check-fn-with-more-than-65535-arguments.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/804ccfaaabf6658b80d7b99828609986692a81ef/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Fissue-88577-check-fn-with-more-than-65535-arguments.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Fissue-88577-check-fn-with-more-than-65535-arguments.stderr?ref=804ccfaaabf6658b80d7b99828609986692a81ef", "patch": "@@ -0,0 +1,13 @@\n+error: function can not have more than 65535 arguments\n+  --> $DIR/issue-88577-check-fn-with-more-than-65535-arguments.rs:6:24\n+   |\n+LL |           fn _f($($t: ()),*) {}\n+   |  ________________________^\n+LL | |     }\n+LL | | }\n+LL | |\n+LL | | many_args!{[_]########## ######}\n+   | |____________^\n+\n+error: aborting due to previous error\n+"}]}