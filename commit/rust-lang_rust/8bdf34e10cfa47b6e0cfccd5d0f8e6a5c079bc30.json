{"sha": "8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiZGYzNGUxMGNmYTQ3YjZlMGNmY2NkNWQwZjhlNmE1YzA3OWJjMzA=", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2020-11-23T18:26:35Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2020-12-22T16:51:56Z"}, "message": "Fix default initialized fields in suggestion\n\nThe default value for a field type does not necessarily match the\ndefault value for that field in the struct Default.", "tree": {"sha": "419d4f3896a00d405f993c1770b6493e3921114d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/419d4f3896a00d405f993c1770b6493e3921114d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30", "html_url": "https://github.com/rust-lang/rust/commit/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f9e4cbe0d297b0576e0aac55dd8a5a099b77340", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f9e4cbe0d297b0576e0aac55dd8a5a099b77340", "html_url": "https://github.com/rust-lang/rust/commit/1f9e4cbe0d297b0576e0aac55dd8a5a099b77340"}], "stats": {"total": 10, "additions": 2, "deletions": 8}, "files": [{"sha": "adcc17266d22e2ea2605a430673567305d5cf54c", "filename": "clippy_lints/src/default.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30/clippy_lints%2Fsrc%2Fdefault.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30/clippy_lints%2Fsrc%2Fdefault.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdefault.rs?ref=8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30", "patch": "@@ -165,12 +165,6 @@ impl LateLintPass<'_> for Default {\n                 let stmt = &block.stmts[stmt_idx];\n \n                 if let StmtKind::Local(preceding_local) = &stmt.kind {\n-                    // filter out fields like `= Default::default()`, because the FRU already covers them\n-                    let assigned_fields = assigned_fields\n-                        .into_iter()\n-                        .filter(|(_, rhs)| !is_expr_default(rhs, cx))\n-                        .collect::<Vec<(Symbol, &Expr<'_>)>>();\n-\n                     // if all fields of the struct are not assigned, add `.. Default::default()` to the suggestion.\n                     let ext_with_default = !fields_of_type(binding_type)\n                         .iter()"}, {"sha": "9a2bc778c3ff7ba5e03faccf7d69eda2e3f61d3a", "filename": "tests/ui/field_reassign_with_default.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30/tests%2Fui%2Ffield_reassign_with_default.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30/tests%2Fui%2Ffield_reassign_with_default.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffield_reassign_with_default.stderr?ref=8bdf34e10cfa47b6e0cfccd5d0f8e6a5c079bc30", "patch": "@@ -53,7 +53,7 @@ error: field assignment outside of initializer for an instance created with Defa\n LL |     a.i = Default::default();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-note: consider initializing the variable with `A::default()` and removing relevant reassignments\n+note: consider initializing the variable with `A { i: Default::default(), ..Default::default() }` and removing relevant reassignments\n   --> $DIR/field_reassign_with_default.rs:90:5\n    |\n LL |     let mut a: A = Default::default();\n@@ -65,7 +65,7 @@ error: field assignment outside of initializer for an instance created with Defa\n LL |     a.i = Default::default();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-note: consider initializing the variable with `A { j: 45, ..Default::default() }` and removing relevant reassignments\n+note: consider initializing the variable with `A { i: Default::default(), j: 45 }` and removing relevant reassignments\n   --> $DIR/field_reassign_with_default.rs:94:5\n    |\n LL |     let mut a: A = Default::default();"}]}