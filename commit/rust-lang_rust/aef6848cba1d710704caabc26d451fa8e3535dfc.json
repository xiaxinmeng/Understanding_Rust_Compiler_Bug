{"sha": "aef6848cba1d710704caabc26d451fa8e3535dfc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlZjY4NDhjYmExZDcxMDcwNGNhYWJjMjZkNDUxZmE4ZTM1MzVkZmM=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-05-18T17:35:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-18T17:35:46Z"}, "message": "Rollup merge of #85423 - jyn514:cmake, r=Mark-Simulacrum\n\nDon't require cmake on Windows when LLVM isn't being built\n\nPreviously, setting `download-ci-llvm = true` when cmake wasn't\ninstalled would give the following error:\n\n```\nfailed to execute command: \"cmake\" \"--help\"\nerror: The system cannot find the file specified. (os error 2)\n```", "tree": {"sha": "8814e3bd8389556a4ff1f050582d6abd5b4de914", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8814e3bd8389556a4ff1f050582d6abd5b4de914"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aef6848cba1d710704caabc26d451fa8e3535dfc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgo/rzCRBK7hj4Ov3rIwAAjFgIAH4iHVRQb4jvVSqMw7b3dDJO\nUie22G8FswGUMj9ow8evzsIXYHHsdrTbUPzf+7zSIoCYue8kTo5ntbzG7FHjfVTV\nv2xCwI8/WDg9mkKO79+ApOvymrs/zE8RFG3O1durkdvzhnIZ3Fjb51GaQUjHAfLz\nVXd6TMasoPETkYxXRsVuGSidipM2C1Le3VCJ7TR4hCdpSG6wdZVjBnr5SYRdc+Eq\nXoyy+G0KIozF7hY9bbgZwppPgIYEbihiuGeXIypAFRYWFDtYacVBVLAnddSNRZtv\n8bckR/0/sVZRQb47t3XycZehfusH52I2cmQpGomrU2QkNplYnCtvQx8bdlHAblw=\n=b5wp\n-----END PGP SIGNATURE-----\n", "payload": "tree 8814e3bd8389556a4ff1f050582d6abd5b4de914\nparent 6e05a71bf7acc08155bac8b4c495eee8dc5c8201\nparent 28c9c04325819662219340b21be55daf1d22ae4d\nauthor Ralf Jung <post@ralfj.de> 1621359346 +0200\ncommitter GitHub <noreply@github.com> 1621359346 +0200\n\nRollup merge of #85423 - jyn514:cmake, r=Mark-Simulacrum\n\nDon't require cmake on Windows when LLVM isn't being built\n\nPreviously, setting `download-ci-llvm = true` when cmake wasn't\ninstalled would give the following error:\n\n```\nfailed to execute command: \"cmake\" \"--help\"\nerror: The system cannot find the file specified. (os error 2)\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aef6848cba1d710704caabc26d451fa8e3535dfc", "html_url": "https://github.com/rust-lang/rust/commit/aef6848cba1d710704caabc26d451fa8e3535dfc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aef6848cba1d710704caabc26d451fa8e3535dfc/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6e05a71bf7acc08155bac8b4c495eee8dc5c8201", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e05a71bf7acc08155bac8b4c495eee8dc5c8201", "html_url": "https://github.com/rust-lang/rust/commit/6e05a71bf7acc08155bac8b4c495eee8dc5c8201"}, {"sha": "28c9c04325819662219340b21be55daf1d22ae4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/28c9c04325819662219340b21be55daf1d22ae4d", "html_url": "https://github.com/rust-lang/rust/commit/28c9c04325819662219340b21be55daf1d22ae4d"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "a28762ac485ecc03e1358219660b4bc126dfe138", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/aef6848cba1d710704caabc26d451fa8e3535dfc/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aef6848cba1d710704caabc26d451fa8e3535dfc/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=aef6848cba1d710704caabc26d451fa8e3535dfc", "patch": "@@ -93,7 +93,8 @@ pub fn check(build: &mut Build) {\n                     .unwrap_or(true)\n             })\n             .any(|build_llvm_ourselves| build_llvm_ourselves);\n-    if building_llvm || build.config.any_sanitizers_enabled() {\n+    let need_cmake = building_llvm || build.config.any_sanitizers_enabled();\n+    if need_cmake {\n         cmd_finder.must_have(\"cmake\");\n     }\n \n@@ -204,7 +205,7 @@ pub fn check(build: &mut Build) {\n             }\n         }\n \n-        if target.contains(\"msvc\") {\n+        if need_cmake && target.contains(\"msvc\") {\n             // There are three builds of cmake on windows: MSVC, MinGW, and\n             // Cygwin. The Cygwin build does not have generators for Visual\n             // Studio, so detect that here and error."}]}