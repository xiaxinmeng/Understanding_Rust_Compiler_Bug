{"sha": "4dc028743dad4d2d71842c2bb20029b412edaca7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkYzAyODc0M2RhZDRkMmQ3MTg0MmMyYmIyMDAyOWI0MTJlZGFjYTc=", "commit": {"author": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-10-25T17:37:07Z"}, "committer": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-10-25T17:37:07Z"}, "message": "Explain why we can encounter a `Goto` terminator that we want to promote", "tree": {"sha": "74091d7fa1d0ad8b2fb24797f2cb43d0992a83fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/74091d7fa1d0ad8b2fb24797f2cb43d0992a83fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4dc028743dad4d2d71842c2bb20029b412edaca7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4dc028743dad4d2d71842c2bb20029b412edaca7", "html_url": "https://github.com/rust-lang/rust/commit/4dc028743dad4d2d71842c2bb20029b412edaca7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4dc028743dad4d2d71842c2bb20029b412edaca7/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7629eff32cf23680074ae72144ed748139100fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7629eff32cf23680074ae72144ed748139100fe", "html_url": "https://github.com/rust-lang/rust/commit/f7629eff32cf23680074ae72144ed748139100fe"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "1d45850a080d510e8ff056d54cd7eb13c2697667", "filename": "src/librustc_mir/transform/promote_consts.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4dc028743dad4d2d71842c2bb20029b412edaca7/src%2Flibrustc_mir%2Ftransform%2Fpromote_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dc028743dad4d2d71842c2bb20029b412edaca7/src%2Flibrustc_mir%2Ftransform%2Fpromote_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fpromote_consts.rs?ref=4dc028743dad4d2d71842c2bb20029b412edaca7", "patch": "@@ -332,7 +332,13 @@ impl<'a, 'tcx> Promoter<'a, 'tcx> {\n                             let operand = Operand::Copy(promoted_place(ty, span));\n                             mem::replace(&mut args[index], operand)\n                         }\n-                        // already promoted out\n+                        // We expected a `TerminatorKind::Call` for which we'd like to promote an\n+                        // argument. Since `qualify_consts` saw a `TerminatorKind::Call` here, but\n+                        // we are seeing a `Goto`, that means that the `promote_temps` method\n+                        // already promoted this call away entirely. This case occurs when calling\n+                        // a function requiring a constant argument and as that constant value\n+                        // providing a value whose computation contains another call to a function\n+                        // requiring a constant argument.\n                         TerminatorKind::Goto { .. } => return,\n                         _ => bug!()\n                     }"}]}