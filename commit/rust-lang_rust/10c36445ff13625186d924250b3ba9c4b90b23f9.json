{"sha": "10c36445ff13625186d924250b3ba9c4b90b23f9", "node_id": "C_kwDOAAsO6NoAKDEwYzM2NDQ1ZmYxMzYyNTE4NmQ5MjQyNTBiM2JhOWM0YjkwYjIzZjk", "commit": {"author": {"name": "Tom Martin", "email": "tom.martin1239@gmail.com", "date": "2023-03-30T20:43:32Z"}, "committer": {"name": "Tom Martin", "email": "tom.martin1239@gmail.com", "date": "2023-03-30T20:43:32Z"}, "message": "Update non-derive macro error message to match suggestion\n\nIt's now split between two errors, one to remove the invalid derive macro\nand one suggesting adding a new non-derive macro", "tree": {"sha": "ffa3e8cd67887ced6af5916c12d5f61935377bae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ffa3e8cd67887ced6af5916c12d5f61935377bae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/10c36445ff13625186d924250b3ba9c4b90b23f9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE4EiFxdccn1fd6ae9c6cz+WKfWsUFAmQl9HQACgkQc6cz+WKf\nWsUBsRAAkvez3H6uSEvw8/f/MVYnD5q3Nh+ak7YJZtu8iAL7hXLydkUA1iSbNykw\nvzMDJDjsckrgNDPZLA/eobTWhupHzYcnZmAoPeLFuXe9TU0fLf/Qptkvp6T8MAEE\nrGqQVpm3IoyddbwBHOAO0pdkI80b+4XtJS/ZfS3T/ub27JANO8QtNysg8uUQkoOg\nTrpRK5DWtDM720UJwT6bw32rvFNwN31LB5+K7nuvoPikJ6YXVX+fte0AmBN7fpi5\njgvtiRepD2q/0+MJrtpGh0w24yeesvyHsJHuzTmInbceDzrt1qxEUbFF85yg+dI8\nr+fxemRHUThBev716XiC83q5+kBtH/k86Bf0/P1J5sFAdpp4cRgp5zW4a25KIMPp\nmaRf0pkXAG90vuhHOIrxw4m7vfCawmUaDe4QWXj6rPe2psHhzpVKroZBlo9qum/o\njX3TRSksJCf3D6tN6oJ/llMxuYaucmk01EJEty6vDe8NCQmQOC3EFkoUXhRwuh9U\nsEYOvekVln+MR30i9EvsGqxOpJtw93/KO+DJnbGtaymvrDx2bMvryCIJ1HguzY9N\ntvh8yyIrfvCjgRg/Ux5raa3ZafSIrsaIStUDilF9DEFaNPI2tHJG/7lrsx9g/t1d\nStRG6Hz9TTD+AXM/YHoxUulfDwhG/JbqUz8asyVRpU6hB8sxLjc=\n=r1Sm\n-----END PGP SIGNATURE-----", "payload": "tree ffa3e8cd67887ced6af5916c12d5f61935377bae\nparent 42f2be8a8c655695ecf2b56eebf023faf7d62463\nauthor Tom Martin <tom.martin1239@gmail.com> 1680209012 +0100\ncommitter Tom Martin <tom.martin1239@gmail.com> 1680209012 +0100\n\nUpdate non-derive macro error message to match suggestion\n\nIt's now split between two errors, one to remove the invalid derive macro\nand one suggesting adding a new non-derive macro\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/10c36445ff13625186d924250b3ba9c4b90b23f9", "html_url": "https://github.com/rust-lang/rust/commit/10c36445ff13625186d924250b3ba9c4b90b23f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/10c36445ff13625186d924250b3ba9c4b90b23f9/comments", "author": {"login": "NotStirred", "id": 16853282, "node_id": "MDQ6VXNlcjE2ODUzMjgy", "avatar_url": "https://avatars.githubusercontent.com/u/16853282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NotStirred", "html_url": "https://github.com/NotStirred", "followers_url": "https://api.github.com/users/NotStirred/followers", "following_url": "https://api.github.com/users/NotStirred/following{/other_user}", "gists_url": "https://api.github.com/users/NotStirred/gists{/gist_id}", "starred_url": "https://api.github.com/users/NotStirred/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NotStirred/subscriptions", "organizations_url": "https://api.github.com/users/NotStirred/orgs", "repos_url": "https://api.github.com/users/NotStirred/repos", "events_url": "https://api.github.com/users/NotStirred/events{/privacy}", "received_events_url": "https://api.github.com/users/NotStirred/received_events", "type": "User", "site_admin": false}, "committer": {"login": "NotStirred", "id": 16853282, "node_id": "MDQ6VXNlcjE2ODUzMjgy", "avatar_url": "https://avatars.githubusercontent.com/u/16853282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NotStirred", "html_url": "https://github.com/NotStirred", "followers_url": "https://api.github.com/users/NotStirred/followers", "following_url": "https://api.github.com/users/NotStirred/following{/other_user}", "gists_url": "https://api.github.com/users/NotStirred/gists{/gist_id}", "starred_url": "https://api.github.com/users/NotStirred/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NotStirred/subscriptions", "organizations_url": "https://api.github.com/users/NotStirred/orgs", "repos_url": "https://api.github.com/users/NotStirred/repos", "events_url": "https://api.github.com/users/NotStirred/events{/privacy}", "received_events_url": "https://api.github.com/users/NotStirred/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42f2be8a8c655695ecf2b56eebf023faf7d62463", "url": "https://api.github.com/repos/rust-lang/rust/commits/42f2be8a8c655695ecf2b56eebf023faf7d62463", "html_url": "https://github.com/rust-lang/rust/commit/42f2be8a8c655695ecf2b56eebf023faf7d62463"}], "stats": {"total": 60, "additions": 27, "deletions": 33}, "files": [{"sha": "082c051e21e54114d75a39495b8f36dcedbca1c6", "filename": "compiler/rustc_resolve/src/macros.rs", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/10c36445ff13625186d924250b3ba9c4b90b23f9/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/10c36445ff13625186d924250b3ba9c4b90b23f9/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs?ref=10c36445ff13625186d924250b3ba9c4b90b23f9", "patch": "@@ -549,15 +549,9 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             err.span_label(path.span, format!(\"not {} {}\", article, expected));\n \n             if kind == MacroKind::Derive && ext.macro_kind() != MacroKind::Derive {\n-                // Suggest removing the derive() as the macro isn't Derive\n-                let opening_span =\n-                    path.span.shrink_to_lo().with_lo(path.span.lo() - rustc_span::BytePos(7));\n-                let closing_span =\n-                    path.span.shrink_to_hi().with_hi(path.span.hi() + rustc_span::BytePos(1));\n-                err.span_help(\n-                    vec![opening_span, closing_span],\n-                    \"remove the surrounding \\\"derive()\\\":\",\n-                );\n+                // Suggest moving the macro our of the derive() as the macro isn't Derive\n+                err.span_help(path.span, \"Remove from the surrounding `derive()`\");\n+                err.help(format!(\"Add as non-Derive macro\\n`#[{}]`\", path_str));\n             }\n \n             err.emit();"}, {"sha": "cefe655b0f7849853757a96cfee59ed3c78fbe32", "filename": "tests/ui/macros/macro-path-prelude-fail-4.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/10c36445ff13625186d924250b3ba9c4b90b23f9/tests%2Fui%2Fmacros%2Fmacro-path-prelude-fail-4.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/10c36445ff13625186d924250b3ba9c4b90b23f9/tests%2Fui%2Fmacros%2Fmacro-path-prelude-fail-4.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmacros%2Fmacro-path-prelude-fail-4.stderr?ref=10c36445ff13625186d924250b3ba9c4b90b23f9", "patch": "@@ -2,13 +2,13 @@ error: expected derive macro, found built-in attribute `inline`\n   --> $DIR/macro-path-prelude-fail-4.rs:1:10\n    |\n LL | #[derive(inline)]\n-   |          ^^^^^^ not a derive macro\n+   |          ^^^^^^\n+   |          |\n+   |          not a derive macro\n+   |          help: Remove from the surrounding `derive()`\n    |\n-help: remove the surrounding \"derive()\":\n-  --> $DIR/macro-path-prelude-fail-4.rs:1:3\n-   |\n-LL | #[derive(inline)]\n-   |   ^^^^^^^      ^\n+   = help: Add as non-Derive macro\n+           `#[inline]`\n \n error: aborting due to previous error\n "}, {"sha": "01814a30237423940649b750791e97cdfa4cb974", "filename": "tests/ui/proc-macro/macro-namespace-reserved-2.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/10c36445ff13625186d924250b3ba9c4b90b23f9/tests%2Fui%2Fproc-macro%2Fmacro-namespace-reserved-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/10c36445ff13625186d924250b3ba9c4b90b23f9/tests%2Fui%2Fproc-macro%2Fmacro-namespace-reserved-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fproc-macro%2Fmacro-namespace-reserved-2.stderr?ref=10c36445ff13625186d924250b3ba9c4b90b23f9", "patch": "@@ -56,13 +56,13 @@ error: expected derive macro, found attribute macro `my_macro_attr`\n   --> $DIR/macro-namespace-reserved-2.rs:53:10\n    |\n LL | #[derive(my_macro_attr)]\n-   |          ^^^^^^^^^^^^^ not a derive macro\n-   |\n-help: remove the surrounding \"derive()\":\n-  --> $DIR/macro-namespace-reserved-2.rs:53:3\n+   |          ^^^^^^^^^^^^^\n+   |          |\n+   |          not a derive macro\n+   |          help: Remove from the surrounding `derive()`\n    |\n-LL | #[derive(my_macro_attr)]\n-   |   ^^^^^^^             ^\n+   = help: Add as non-Derive macro\n+           `#[my_macro_attr]`\n \n error: can't use a procedural macro from the same crate that defines it\n   --> $DIR/macro-namespace-reserved-2.rs:56:10\n@@ -92,13 +92,13 @@ error: expected derive macro, found macro `crate::my_macro`\n   --> $DIR/macro-namespace-reserved-2.rs:50:10\n    |\n LL | #[derive(crate::my_macro)]\n-   |          ^^^^^^^^^^^^^^^ not a derive macro\n-   |\n-help: remove the surrounding \"derive()\":\n-  --> $DIR/macro-namespace-reserved-2.rs:50:3\n+   |          ^^^^^^^^^^^^^^^\n+   |          |\n+   |          not a derive macro\n+   |          help: Remove from the surrounding `derive()`\n    |\n-LL | #[derive(crate::my_macro)]\n-   |   ^^^^^^^               ^\n+   = help: Add as non-Derive macro\n+           `#[crate::my_macro]`\n \n error: cannot find macro `my_macro_attr` in this scope\n   --> $DIR/macro-namespace-reserved-2.rs:28:5"}, {"sha": "c1ed2618b2af55b050797af492e78e61c8377dc0", "filename": "tests/ui/tool-attributes/tool-attributes-misplaced-2.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/10c36445ff13625186d924250b3ba9c4b90b23f9/tests%2Fui%2Ftool-attributes%2Ftool-attributes-misplaced-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/10c36445ff13625186d924250b3ba9c4b90b23f9/tests%2Fui%2Ftool-attributes%2Ftool-attributes-misplaced-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftool-attributes%2Ftool-attributes-misplaced-2.stderr?ref=10c36445ff13625186d924250b3ba9c4b90b23f9", "patch": "@@ -2,13 +2,13 @@ error: expected derive macro, found tool attribute `rustfmt::skip`\n   --> $DIR/tool-attributes-misplaced-2.rs:1:10\n    |\n LL | #[derive(rustfmt::skip)]\n-   |          ^^^^^^^^^^^^^ not a derive macro\n+   |          ^^^^^^^^^^^^^\n+   |          |\n+   |          not a derive macro\n+   |          help: Remove from the surrounding `derive()`\n    |\n-help: remove the surrounding \"derive()\":\n-  --> $DIR/tool-attributes-misplaced-2.rs:1:3\n-   |\n-LL | #[derive(rustfmt::skip)]\n-   |   ^^^^^^^             ^\n+   = help: Add as non-Derive macro\n+           `#[rustfmt::skip]`\n \n error: expected macro, found tool attribute `rustfmt::skip`\n   --> $DIR/tool-attributes-misplaced-2.rs:5:5"}]}