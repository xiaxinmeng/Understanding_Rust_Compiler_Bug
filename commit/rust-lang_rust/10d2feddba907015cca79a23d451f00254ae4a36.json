{"sha": "10d2feddba907015cca79a23d451f00254ae4a36", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEwZDJmZWRkYmE5MDcwMTVjY2E3OWEyM2Q0NTFmMDAyNTRhZTRhMzY=", "commit": {"author": {"name": "HMPerson1", "email": "hmperson1@gmail.com", "date": "2018-02-02T07:03:21Z"}, "committer": {"name": "HMPerson1", "email": "hmperson1@gmail.com", "date": "2018-02-02T07:03:21Z"}, "message": "Fix `const_static_lifetime`", "tree": {"sha": "7cba0affb32f3ec352eb9b1069f1a0c1f3ec379e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7cba0affb32f3ec352eb9b1069f1a0c1f3ec379e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/10d2feddba907015cca79a23d451f00254ae4a36", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFIBAABCAAyFiEE30PRORiHa0gkBHJnH7R33dJ4Ic4FAlp0DVEUHGhtcGVyc29u\nMUBnbWFpbC5jb20ACgkQH7R33dJ4Ic5kjgf+L0iUbgfJY82ZjwatDh7a+Z50Nn/C\nGvYNmp9yL9LWquAEMAzGJxV8JVoTpH74mT+evBTN1utEPkXiQOqiAkRX/T9JL7j6\nErZTgndk6Yu7fR5b85TtHTNK/6rYYRWHaXzPfDvjYpB9QscDqTtlazAabwN2cdvs\nDintxH5OON+sPRqW4hLv54B+pIaebgD0M2fYk6RJ2iiTKOLuqRJVehWORMxCPlQy\nJ0jkcSiFImnrRcyJ3HGBXKkX5m61yXn8Pf3PcXj0SMR3ox7XcycWLsOtL6ESMO4R\nQ2ylaHPfj5eZUDK81Cl0MY2UhbJ42IOI3yC5UWiY/3nzgOQwzJia/X7jrg==\n=MgSa\n-----END PGP SIGNATURE-----", "payload": "tree 7cba0affb32f3ec352eb9b1069f1a0c1f3ec379e\nparent ff83b3ecb9a9e791d1a0f389a2a3bf6a2d041fcf\nauthor HMPerson1 <hmperson1@gmail.com> 1517555001 -0500\ncommitter HMPerson1 <hmperson1@gmail.com> 1517555001 -0500\n\nFix `const_static_lifetime`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/10d2feddba907015cca79a23d451f00254ae4a36", "html_url": "https://github.com/rust-lang/rust/commit/10d2feddba907015cca79a23d451f00254ae4a36", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/10d2feddba907015cca79a23d451f00254ae4a36/comments", "author": {"login": "HMPerson1", "id": 2219904, "node_id": "MDQ6VXNlcjIyMTk5MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2219904?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HMPerson1", "html_url": "https://github.com/HMPerson1", "followers_url": "https://api.github.com/users/HMPerson1/followers", "following_url": "https://api.github.com/users/HMPerson1/following{/other_user}", "gists_url": "https://api.github.com/users/HMPerson1/gists{/gist_id}", "starred_url": "https://api.github.com/users/HMPerson1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HMPerson1/subscriptions", "organizations_url": "https://api.github.com/users/HMPerson1/orgs", "repos_url": "https://api.github.com/users/HMPerson1/repos", "events_url": "https://api.github.com/users/HMPerson1/events{/privacy}", "received_events_url": "https://api.github.com/users/HMPerson1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "HMPerson1", "id": 2219904, "node_id": "MDQ6VXNlcjIyMTk5MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2219904?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HMPerson1", "html_url": "https://github.com/HMPerson1", "followers_url": "https://api.github.com/users/HMPerson1/followers", "following_url": "https://api.github.com/users/HMPerson1/following{/other_user}", "gists_url": "https://api.github.com/users/HMPerson1/gists{/gist_id}", "starred_url": "https://api.github.com/users/HMPerson1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HMPerson1/subscriptions", "organizations_url": "https://api.github.com/users/HMPerson1/orgs", "repos_url": "https://api.github.com/users/HMPerson1/repos", "events_url": "https://api.github.com/users/HMPerson1/events{/privacy}", "received_events_url": "https://api.github.com/users/HMPerson1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff83b3ecb9a9e791d1a0f389a2a3bf6a2d041fcf", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff83b3ecb9a9e791d1a0f389a2a3bf6a2d041fcf", "html_url": "https://github.com/rust-lang/rust/commit/ff83b3ecb9a9e791d1a0f389a2a3bf6a2d041fcf"}], "stats": {"total": 52, "additions": 50, "deletions": 2}, "files": [{"sha": "2872cb127294f955c6921d5018fb6de80affb4bc", "filename": "clippy_lints/src/const_static_lifetime.rs", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/10d2feddba907015cca79a23d451f00254ae4a36/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/10d2feddba907015cca79a23d451f00254ae4a36/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs?ref=10d2feddba907015cca79a23d451f00254ae4a36", "patch": "@@ -1,4 +1,4 @@\n-use syntax::ast::{Item, ItemKind, Ty, TyKind};\n+use syntax::ast::*;\n use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n use utils::{in_macro, snippet, span_lint_and_then};\n \n@@ -86,4 +86,22 @@ impl EarlyLintPass for StaticConst {\n             }\n         }\n     }\n+\n+    fn check_trait_item(&mut self, cx: &EarlyContext, item: &TraitItem) {\n+        if !in_macro(item.span) {\n+            // Match only constants...\n+            if let TraitItemKind::Const(ref var_type, _) = item.node {\n+                self.visit_type(var_type, cx);\n+            }\n+        }\n+    }\n+\n+    fn check_impl_item(&mut self, cx: &EarlyContext, item: &ImplItem) {\n+        if !in_macro(item.span) {\n+            // Match only constants...\n+            if let ImplItemKind::Const(ref var_type, _) = item.node {\n+                self.visit_type(var_type, cx);\n+            }\n+        }\n+    }\n }"}, {"sha": "745821a1503c9e92484912a652175cdd7d5abea6", "filename": "tests/ui/const_static_lifetime.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/10d2feddba907015cca79a23d451f00254ae4a36/tests%2Fui%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/10d2feddba907015cca79a23d451f00254ae4a36/tests%2Fui%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.rs?ref=10d2feddba907015cca79a23d451f00254ae4a36", "patch": "@@ -35,3 +35,15 @@ fn main() {\n     println!(\"{:?}\", VAR_HEIGHT);\n     println!(\"{}\", false_positive);\n }\n+\n+trait Bar {\n+    const TRAIT_VAR: &'static str;\n+}\n+\n+impl Foo {\n+    const IMPL_VAR: &'static str = \"var\";\n+}\n+\n+impl Bar for Foo {\n+    const TRAIT_VAR: &'static str = \"foo\";\n+}"}, {"sha": "b1059d2ef012d8b269ee84c22289d428b812ef44", "filename": "tests/ui/const_static_lifetime.stderr", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/10d2feddba907015cca79a23d451f00254ae4a36/tests%2Fui%2Fconst_static_lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/10d2feddba907015cca79a23d451f00254ae4a36/tests%2Fui%2Fconst_static_lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.stderr?ref=10d2feddba907015cca79a23d451f00254ae4a36", "patch": "@@ -78,5 +78,23 @@ error: Constants have by default a `'static` lifetime\n 24 | const VAR_ARRAY: &'static [u8; 1] = b\"T\"; // ERROR Consider removing 'static.\n    |                  -^^^^^^^-------- help: consider removing `'static`: `&[u8; 1]`\n \n-error: aborting due to 13 previous errors\n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:40:23\n+   |\n+40 |     const TRAIT_VAR: &'static str;\n+   |                      -^^^^^^^---- help: consider removing `'static`: `&str`\n+\n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:44:22\n+   |\n+44 |     const IMPL_VAR: &'static str = \"var\";\n+   |                     -^^^^^^^---- help: consider removing `'static`: `&str`\n+\n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:48:23\n+   |\n+48 |     const TRAIT_VAR: &'static str = \"foo\";\n+   |                      -^^^^^^^---- help: consider removing `'static`: `&str`\n+\n+error: aborting due to 16 previous errors\n "}]}