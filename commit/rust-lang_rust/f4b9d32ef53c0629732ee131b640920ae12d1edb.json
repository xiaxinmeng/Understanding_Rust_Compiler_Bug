{"sha": "f4b9d32ef53c0629732ee131b640920ae12d1edb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0YjlkMzJlZjUzYzA2Mjk3MzJlZTEzMWI2NDA5MjBhZTEyZDFlZGI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-05T08:47:46Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-05T08:47:46Z"}, "message": "Auto merge of #80686 - GuillaumeGomez:error-doc-alias-same-name, r=jyn514\n\nError when #[doc(alias)] has same name as the item\n\nSomething I came across when reviewing some doc alias PRs.\n\nr? `@jyn514`", "tree": {"sha": "7e424be67db46374cd2ede1be8cea521b9c32baa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e424be67db46374cd2ede1be8cea521b9c32baa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4b9d32ef53c0629732ee131b640920ae12d1edb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4b9d32ef53c0629732ee131b640920ae12d1edb", "html_url": "https://github.com/rust-lang/rust/commit/f4b9d32ef53c0629732ee131b640920ae12d1edb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4b9d32ef53c0629732ee131b640920ae12d1edb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f412fb56b8d11c168e7ee49ee74e79c4ab2e5637", "url": "https://api.github.com/repos/rust-lang/rust/commits/f412fb56b8d11c168e7ee49ee74e79c4ab2e5637", "html_url": "https://github.com/rust-lang/rust/commit/f412fb56b8d11c168e7ee49ee74e79c4ab2e5637"}, {"sha": "9714ac08a5476ccfbbce859d3fb69905a64668e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/9714ac08a5476ccfbbce859d3fb69905a64668e1", "html_url": "https://github.com/rust-lang/rust/commit/9714ac08a5476ccfbbce859d3fb69905a64668e1"}], "stats": {"total": 37, "additions": 36, "deletions": 1}, "files": [{"sha": "420c002c5fc4647451f80d53e9953de08890f50d", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f4b9d32ef53c0629732ee131b640920ae12d1edb/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4b9d32ef53c0629732ee131b640920ae12d1edb/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=f4b9d32ef53c0629732ee131b640920ae12d1edb", "patch": "@@ -310,7 +310,7 @@ impl CheckAttrVisitor<'tcx> {\n                 .sess\n                 .struct_span_err(\n                     meta.name_value_literal_span().unwrap_or_else(|| meta.span()),\n-                    &format!(\"{:?} character isn't allowed in `#[doc(alias = \\\"...\\\")]`\", c,),\n+                    &format!(\"{:?} character isn't allowed in `#[doc(alias = \\\"...\\\")]`\", c),\n                 )\n                 .emit();\n             return false;\n@@ -358,6 +358,17 @@ impl CheckAttrVisitor<'tcx> {\n                 .emit();\n             return false;\n         }\n+        let item_name = self.tcx.hir().name(hir_id);\n+        if item_name.to_string() == doc_alias {\n+            self.tcx\n+                .sess\n+                .struct_span_err(\n+                    meta.span(),\n+                    &format!(\"`#[doc(alias = \\\"...\\\")]` is the same as the item's name\"),\n+                )\n+                .emit();\n+            return false;\n+        }\n         true\n     }\n "}, {"sha": "da97c26761862aab2ddb0ac100a78f7a186ce511", "filename": "src/test/rustdoc-ui/doc-alias-same-name.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-same-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-same-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-same-name.rs?ref=f4b9d32ef53c0629732ee131b640920ae12d1edb", "patch": "@@ -0,0 +1,4 @@\n+#![crate_type = \"lib\"]\n+\n+#[doc(alias = \"Foo\")] //~ ERROR\n+pub struct Foo;"}, {"sha": "5ba09a2eae1c71ebd4818b6ddc713d7fd1548172", "filename": "src/test/rustdoc-ui/doc-alias-same-name.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-same-name.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-same-name.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-same-name.stderr?ref=f4b9d32ef53c0629732ee131b640920ae12d1edb", "patch": "@@ -0,0 +1,8 @@\n+error: `#[doc(alias = \"...\")]` is the same as the item's name\n+  --> $DIR/doc-alias-same-name.rs:3:7\n+   |\n+LL | #[doc(alias = \"Foo\")]\n+   |       ^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}, {"sha": "da97c26761862aab2ddb0ac100a78f7a186ce511", "filename": "src/test/ui/doc-alias-same-name.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Fui%2Fdoc-alias-same-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Fui%2Fdoc-alias-same-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdoc-alias-same-name.rs?ref=f4b9d32ef53c0629732ee131b640920ae12d1edb", "patch": "@@ -0,0 +1,4 @@\n+#![crate_type = \"lib\"]\n+\n+#[doc(alias = \"Foo\")] //~ ERROR\n+pub struct Foo;"}, {"sha": "5ba09a2eae1c71ebd4818b6ddc713d7fd1548172", "filename": "src/test/ui/doc-alias-same-name.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Fui%2Fdoc-alias-same-name.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f4b9d32ef53c0629732ee131b640920ae12d1edb/src%2Ftest%2Fui%2Fdoc-alias-same-name.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdoc-alias-same-name.stderr?ref=f4b9d32ef53c0629732ee131b640920ae12d1edb", "patch": "@@ -0,0 +1,8 @@\n+error: `#[doc(alias = \"...\")]` is the same as the item's name\n+  --> $DIR/doc-alias-same-name.rs:3:7\n+   |\n+LL | #[doc(alias = \"Foo\")]\n+   |       ^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}