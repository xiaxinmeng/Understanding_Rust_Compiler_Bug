{"sha": "af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmNDJjYjU5ODFhMWY5NDExNmIxZGE4Y2ZlZWRiNmVmZGQ1YWViMDE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-12-20T15:55:38Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-12-20T15:55:38Z"}, "message": "Privitize impls", "tree": {"sha": "26c26735a3c535ad78264f2c1234434ca477fc85", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26c26735a3c535ad78264f2c1234434ca477fc85"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "html_url": "https://github.com/rust-lang/rust/commit/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7adb53319d963d0a40906a6847124974da1d5183", "url": "https://api.github.com/repos/rust-lang/rust/commits/7adb53319d963d0a40906a6847124974da1d5183", "html_url": "https://github.com/rust-lang/rust/commit/7adb53319d963d0a40906a6847124974da1d5183"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "4488e85020e7fc018604122adb4692475c681045", "filename": "crates/ra_hir_def/src/child_by_source.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Fchild_by_source.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Fchild_by_source.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fchild_by_source.rs?ref=af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "patch": "@@ -80,9 +80,9 @@ impl ChildBySource for ModuleId {\n \n         module_data.scope.declarations().for_each(|item| add_module_def(db, &mut res, item));\n \n-        for &impl_ in module_data.scope.impls.iter() {\n-            let src = impl_.lookup(db).source(db);\n-            res[keys::IMPL].insert(src, impl_)\n+        for imp in module_data.scope.impls() {\n+            let src = imp.lookup(db).source(db);\n+            res[keys::IMPL].insert(src, imp)\n         }\n \n         res"}, {"sha": "f51e97ef9d851ee28aa44a41478485b60a3a8ed7", "filename": "crates/ra_hir_def/src/item_scope.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Fitem_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Fitem_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fitem_scope.rs?ref=af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "patch": "@@ -10,7 +10,7 @@ use crate::{per_ns::PerNs, BuiltinType, ImplId, LocalImportId, MacroDefId, Modul\n #[derive(Debug, Default, PartialEq, Eq)]\n pub struct ItemScope {\n     items: FxHashMap<Name, Resolution>,\n-    pub(crate) impls: Vec<ImplId>,\n+    impls: Vec<ImplId>,\n     /// Macros visible in current module in legacy textual scope\n     ///\n     /// For macros invoked by an unqualified identifier like `bar!()`, `legacy_macros` will be searched in first.\n@@ -104,6 +104,10 @@ impl ItemScope {\n         self.legacy_macros.get(name).copied()\n     }\n \n+    pub(crate) fn define_impl(&mut self, imp: ImplId) {\n+        self.impls.push(imp)\n+    }\n+\n     pub(crate) fn push_res(\n         &mut self,\n         name: Name,"}, {"sha": "cef061837b6f9df804ecacf51902668f8425ee85", "filename": "crates/ra_hir_def/src/lang_item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Flang_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Flang_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Flang_item.rs?ref=af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "patch": "@@ -81,7 +81,7 @@ impl LangItems {\n         // Look for impl targets\n         let def_map = db.crate_def_map(module.krate);\n         let module_data = &def_map[module.local_id];\n-        for &impl_block in module_data.scope.impls.iter() {\n+        for impl_block in module_data.scope.impls() {\n             self.collect_lang_item(db, impl_block, LangItemTarget::ImplBlockId)\n         }\n "}, {"sha": "b064ccc9c9f1208cebfb70a1933b25a1f6bd267b", "filename": "crates/ra_hir_def/src/nameres/collector.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af42cb5981a1f94116b1da8cfeedb6efdd5aeb01/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Fcollector.rs?ref=af42cb5981a1f94116b1da8cfeedb6efdd5aeb01", "patch": "@@ -635,7 +635,9 @@ where\n                         let impl_id =\n                             ImplLoc { container, ast_id: AstId::new(self.file_id, ast_id) }\n                                 .intern(self.def_collector.db);\n-                        self.def_collector.def_map.modules[self.module_id].scope.impls.push(impl_id)\n+                        self.def_collector.def_map.modules[self.module_id]\n+                            .scope\n+                            .define_impl(impl_id)\n                     }\n                 }\n             }"}]}