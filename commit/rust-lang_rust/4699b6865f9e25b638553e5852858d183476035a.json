{"sha": "4699b6865f9e25b638553e5852858d183476035a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2OTliNjg2NWY5ZTI1YjYzODU1M2U1ODUyODU4ZDE4MzQ3NjAzNWE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-12-10T00:02:50Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-12-11T02:51:21Z"}, "message": "build: Use llvm-mc as our assembler\n\nLLVM's assembler understands .cfi pseudo-ops on the mac, which we need in\norder to generate frames that can be DWARF-unwound", "tree": {"sha": "8decddfb9ff341ce777410a4f17a38da04ea81ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8decddfb9ff341ce777410a4f17a38da04ea81ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4699b6865f9e25b638553e5852858d183476035a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4699b6865f9e25b638553e5852858d183476035a", "html_url": "https://github.com/rust-lang/rust/commit/4699b6865f9e25b638553e5852858d183476035a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4699b6865f9e25b638553e5852858d183476035a/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "638b51488f444213eb9430b34a833905274cd424", "url": "https://api.github.com/repos/rust-lang/rust/commits/638b51488f444213eb9430b34a833905274cd424", "html_url": "https://github.com/rust-lang/rust/commit/638b51488f444213eb9430b34a833905274cd424"}], "stats": {"total": 32, "additions": 26, "deletions": 6}, "files": [{"sha": "c0a56c7896861e1539f74df6b1a530f6bb1f0c0f", "filename": "Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4699b6865f9e25b638553e5852858d183476035a/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/4699b6865f9e25b638553e5852858d183476035a/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=4699b6865f9e25b638553e5852858d183476035a", "patch": "@@ -223,6 +223,7 @@ CFG_LLVM_INST_DIR_$(1):=$$(CFG_LLVM_INST_DIR_$(subst -,_,$(1)))\n \n # Any rules that depend on LLVM should depend on LLVM_CONFIG\n LLVM_CONFIG_$(1):=$$(CFG_LLVM_INST_DIR_$(1))/bin/llvm-config\n+LLVM_MC_$(1):=$$(CFG_LLVM_INST_DIR_$(1))/bin/llvm-mc\n LLVM_VERSION_$(1)=$$(shell \"$$(LLVM_CONFIG_$(1))\" --version)\n LLVM_BINDIR_$(1)=$$(shell \"$$(LLVM_CONFIG_$(1))\" --bindir)\n LLVM_INCDIR_$(1)=$$(shell \"$$(LLVM_CONFIG_$(1))\" --includedir)"}, {"sha": "4a70e545862d6385cd5b5996b0219cda63d78a5c", "filename": "mk/platform.mk", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4699b6865f9e25b638553e5852858d183476035a/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/4699b6865f9e25b638553e5852858d183476035a/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=4699b6865f9e25b638553e5852858d183476035a", "patch": "@@ -178,6 +178,7 @@ CFG_INFO := $(info cfg: using $(CFG_C_COMPILER))\n ifeq ($(CFG_C_COMPILER),clang)\n   CC=clang\n   CXX=clang++\n+  CPP=cpp\n   CFG_GCCISH_CFLAGS += -Wall -Werror -fno-rtti -g\n   CFG_GCCISH_LINK_FLAGS += -g\n   CFG_DEPEND_C = $(CFG_GCCISH_CROSS)$(CXX) $(CFG_GCCISH_CFLAGS) -MT \"$(1)\" \\\n@@ -202,6 +203,7 @@ else\n ifeq ($(CFG_C_COMPILER),gcc)\n   CC=gcc\n   CXX=g++\n+  CPP=cpp\n   CFG_GCCISH_CFLAGS += -Wall -Werror -fno-rtti -g\n   CFG_GCCISH_LINK_FLAGS += -g\n   CFG_DEPEND_C = $(CFG_GCCISH_CROSS)$(CXX) $(CFG_GCCISH_CFLAGS) -MT \"$(1)\" \\\n@@ -228,3 +230,16 @@ else\n endif\n endif\n \n+# We're using llvm-mc as our assembler because it supports\n+# .cfi pseudo-ops on mac\n+define CFG_MAKE_ASSEMBLER\n+  CFG_ASSEMBLE_$(1)=$$(CPP) $$(2) | \\\n+                    $$(LLVM_MC_$$(CFG_HOST_TRIPLE)) \\\n+                    -assemble \\\n+                    -filetype=obj \\\n+                    -triple=$(1) \\\n+                    -o=$$(1)\n+endef\n+\n+$(foreach target,$(CFG_TARGET_TRIPLES),\\\n+  $(eval $(call CFG_MAKE_ASSEMBLER,$(target))))\n\\ No newline at end of file"}, {"sha": "a9c35572dc35889465e9e15ceb67eb66deff5565", "filename": "mk/rt.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4699b6865f9e25b638553e5852858d183476035a/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/4699b6865f9e25b638553e5852858d183476035a/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=4699b6865f9e25b638553e5852858d183476035a", "patch": "@@ -136,9 +136,9 @@ rt/$(1)/%.o: rt/%.cpp $$(MKFILE_DEPS)\n \t@$$(call E, compile: $$@)\n \t$$(Q)$$(call CFG_COMPILE_C_$(1), $$@, $$(RUNTIME_INCS_$(1))) $$<\n \n-rt/$(1)/%.o: rt/%.S $$(MKFILE_DEPS)\n+rt/$(1)/%.o: rt/%.S $$(MKFILE_DEPS) $$(LLVM_CONFIG_$$(CFG_HOST_TRIPLE))\n \t@$$(call E, compile: $$@)\n-\t$$(Q)$$(call CFG_COMPILE_C_$(1), $$@, $$(RUNTIME_INCS_$(1))) $$<\n+\t$$(Q)$$(call CFG_ASSEMBLE_$(1),$$@,$$<)\n \n rt/$(1)/arch/$$(HOST_$(1))/libmorestack.a: \\\n \t\trt/$(1)/arch/$$(HOST_$(1))/morestack.o"}, {"sha": "7d1883833da2572833caf9a4203c9c15afaece5d", "filename": "src/rt/arch/i386/morestack.S", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4699b6865f9e25b638553e5852858d183476035a/src%2Frt%2Farch%2Fi386%2Fmorestack.S", "raw_url": "https://github.com/rust-lang/rust/raw/4699b6865f9e25b638553e5852858d183476035a/src%2Frt%2Farch%2Fi386%2Fmorestack.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fi386%2Fmorestack.S?ref=4699b6865f9e25b638553e5852858d183476035a", "patch": "@@ -27,8 +27,10 @@\n \n .globl UPCALL_NEW_STACK\n .globl UPCALL_DEL_STACK\n+#ifndef __APPLE__\n .globl RUST_GET_TASK\n .globl UPCALL_CALL_C_STACK\n+#endif\n .globl MORESTACK\n \n // FIXME: What about _WIN32?\t"}, {"sha": "d5212004f100faa66be036e2541d143d467a5654", "filename": "src/rt/arch/x86_64/morestack.S", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4699b6865f9e25b638553e5852858d183476035a/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "raw_url": "https://github.com/rust-lang/rust/raw/4699b6865f9e25b638553e5852858d183476035a/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S?ref=4699b6865f9e25b638553e5852858d183476035a", "patch": "@@ -91,7 +91,7 @@ MORESTACK:\n \tmovq UPCALL_NEW_STACK@GOTPCREL(%rip), %rsi\n \tmovq %rsp, %rdi\n #ifdef __APPLE__\n-\tcall UPCALL_CALL_C@GOTPCREL\n+\tcall UPCALL_CALL_C\n #endif\n #ifdef __linux__\n \tcall UPCALL_CALL_C@PLT\n@@ -124,7 +124,7 @@ MORESTACK:\n \tmovq UPCALL_DEL_STACK@GOTPCREL(%rip), %rsi\n \tmovq $0, %rdi\n #ifdef __APPLE__\n-\tcall UPCALL_CALL_C@GOTPCREL\n+\tcall UPCALL_CALL_C\n #endif\n #ifdef __linux__\n \tcall UPCALL_CALL_C@PLT"}, {"sha": "63aab911c00ae6ce25e92fc1f58b428808fddfa1", "filename": "src/rt/arch/x86_64/regs.h", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4699b6865f9e25b638553e5852858d183476035a/src%2Frt%2Farch%2Fx86_64%2Fregs.h", "raw_url": "https://github.com/rust-lang/rust/raw/4699b6865f9e25b638553e5852858d183476035a/src%2Frt%2Farch%2Fx86_64%2Fregs.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fregs.h?ref=4699b6865f9e25b638553e5852858d183476035a", "patch": "@@ -1,13 +1,15 @@\n #define RUSTRT_RBX   0\n #define RUSTRT_RSP   1\n #define RUSTRT_RBP   2\n-#define RUSTRT_ARG0  3 // RCX on Windows, RDI elsewhere\n+// RCX on Windows, RDI elsewhere\n+#define RUSTRT_ARG0  3\n #define RUSTRT_R12   4\n #define RUSTRT_R13   5\n #define RUSTRT_R14   6\n #define RUSTRT_R15   7\n #define RUSTRT_IP    8\n-#define RUSTRT_XXX   9 // Not used, just padding\n+// Not used, just padding\n+#define RUSTRT_XXX   9\n #define RUSTRT_XMM0 10\n #define RUSTRT_XMM1 12\n #define RUSTRT_XMM2 14"}]}