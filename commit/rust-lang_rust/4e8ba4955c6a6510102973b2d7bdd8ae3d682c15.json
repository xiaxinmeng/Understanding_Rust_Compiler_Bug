{"sha": "4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlOGJhNDk1NWM2YTY1MTAxMDI5NzNiMmQ3YmRkOGFlM2Q2ODJjMTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-12-17T08:13:07Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-12-17T08:13:07Z"}, "message": "auto merge of #19789 : nick29581/rust/assoc-ufcs2, r=nikomatsakis\n\nCloses #18433", "tree": {"sha": "16dc796c084efbd48c59cc72997d11935410233c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/16dc796c084efbd48c59cc72997d11935410233c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "html_url": "https://github.com/rust-lang/rust/commit/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4265e86844b6f328ed8a0d144d02a935706c35ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/4265e86844b6f328ed8a0d144d02a935706c35ee", "html_url": "https://github.com/rust-lang/rust/commit/4265e86844b6f328ed8a0d144d02a935706c35ee"}, {"sha": "743d6a413248a50bff762d1bfa46d31424be1b39", "url": "https://api.github.com/repos/rust-lang/rust/commits/743d6a413248a50bff762d1bfa46d31424be1b39", "html_url": "https://github.com/rust-lang/rust/commit/743d6a413248a50bff762d1bfa46d31424be1b39"}], "stats": {"total": 268, "additions": 243, "deletions": 25}, "files": [{"sha": "a37f9cb939d5e368b5816610fc00d881636e24d9", "filename": "src/librustc/middle/astencode.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fastencode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fastencode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fastencode.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -443,6 +443,10 @@ impl tr for def::Def {\n           def::DefTrait(did) => def::DefTrait(did.tr(dcx)),\n           def::DefTy(did, is_enum) => def::DefTy(did.tr(dcx), is_enum),\n           def::DefAssociatedTy(did) => def::DefAssociatedTy(did.tr(dcx)),\n+          def::DefAssociatedPath(def::TyParamProvenance::FromSelf(did), ident) =>\n+              def::DefAssociatedPath(def::TyParamProvenance::FromSelf(did.tr(dcx)), ident),\n+          def::DefAssociatedPath(def::TyParamProvenance::FromParam(did), ident) =>\n+              def::DefAssociatedPath(def::TyParamProvenance::FromParam(did.tr(dcx)), ident),\n           def::DefPrimTy(p) => def::DefPrimTy(p),\n           def::DefTyParam(s, did, v) => def::DefTyParam(s, did.tr(dcx), v),\n           def::DefUse(did) => def::DefUse(did.tr(dcx)),"}, {"sha": "8573dc747bb07b87d17dc8b64c56e05c75ed9667", "filename": "src/librustc/middle/def.rs", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fdef.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fdef.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fdef.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -28,6 +28,10 @@ pub enum Def {\n     DefVariant(ast::DefId /* enum */, ast::DefId /* variant */, bool /* is_structure */),\n     DefTy(ast::DefId, bool /* is_enum */),\n     DefAssociatedTy(ast::DefId),\n+    // A partially resolved path to an associated type `T::U` where `T` is a concrete\n+    // type (indicated by the DefId) which implements a trait which has an associated\n+    // type `U` (indicated by the Ident).\n+    DefAssociatedPath(TyParamProvenance, ast::Ident),\n     DefTrait(ast::DefId),\n     DefPrimTy(ast::PrimTy),\n     DefTyParam(ParamSpace, ast::DefId, uint),\n@@ -60,6 +64,12 @@ pub enum MethodProvenance {\n     FromImpl(ast::DefId),\n }\n \n+#[deriving(Clone, PartialEq, Eq, Encodable, Decodable, Hash, Show)]\n+pub enum TyParamProvenance {\n+    FromSelf(ast::DefId),\n+    FromParam(ast::DefId),\n+}\n+\n impl MethodProvenance {\n     pub fn map<F>(self, f: F) -> MethodProvenance where\n         F: FnOnce(ast::DefId) -> ast::DefId,\n@@ -73,14 +83,27 @@ impl MethodProvenance {\n \n impl Copy for MethodProvenance {}\n \n+impl TyParamProvenance {\n+    pub fn def_id(&self) -> ast::DefId {\n+        match *self {\n+            TyParamProvenance::FromSelf(ref did) => did.clone(),\n+            TyParamProvenance::FromParam(ref did) => did.clone(),\n+        }\n+    }\n+}\n+\n+impl Copy for TyParamProvenance {}\n+\n impl Def {\n     pub fn def_id(&self) -> ast::DefId {\n         match *self {\n             DefFn(id, _) | DefStaticMethod(id, _) | DefMod(id) |\n             DefForeignMod(id) | DefStatic(id, _) |\n             DefVariant(_, id, _) | DefTy(id, _) | DefAssociatedTy(id) |\n             DefTyParam(_, id, _) | DefUse(id) | DefStruct(id) | DefTrait(id) |\n-            DefMethod(id, _, _) | DefConst(id) => {\n+            DefMethod(id, _, _) | DefConst(id) |\n+            DefAssociatedPath(TyParamProvenance::FromSelf(id), _) |\n+            DefAssociatedPath(TyParamProvenance::FromParam(id), _) => {\n                 id\n             }\n             DefLocal(id) |"}, {"sha": "86b912a579f124333c3c94ddbef34d34dc2ef030", "filename": "src/librustc/middle/mem_categorization.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -595,7 +595,7 @@ impl<'t,'tcx,TYPER:Typer<'tcx>> MemCategorizationContext<'t,TYPER> {\n           def::DefTrait(_) | def::DefTy(..) | def::DefPrimTy(_) |\n           def::DefTyParam(..) | def::DefTyParamBinder(..) | def::DefRegion(_) |\n           def::DefLabel(_) | def::DefSelfTy(..) | def::DefMethod(..) |\n-          def::DefAssociatedTy(..) => {\n+          def::DefAssociatedTy(..) | def::DefAssociatedPath(..)=> {\n               Ok(Rc::new(cmt_ {\n                   id:id,\n                   span:span,"}, {"sha": "734453db693ec1fc950849ca41211ccf43f0fb67", "filename": "src/librustc/middle/resolve.rs", "status": "modified", "additions": 33, "deletions": 11, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -2027,7 +2027,7 @@ impl<'a> Resolver<'a> {\n                                                   is_public,\n                                                   DUMMY_SP)\n           }\n-          DefTy(..) | DefAssociatedTy(..) => {\n+          DefTy(..) | DefAssociatedTy(..) | DefAssociatedPath(..) => {\n               debug!(\"(building reduced graph for external \\\n                       crate) building type {}\", final_ident);\n \n@@ -3361,8 +3361,7 @@ impl<'a> Resolver<'a> {\n         let module_path_len = module_path.len();\n         assert!(module_path_len > 0);\n \n-        debug!(\"(resolving module path for import) processing `{}` rooted at \\\n-               `{}`\",\n+        debug!(\"(resolving module path for import) processing `{}` rooted at `{}`\",\n                self.names_to_string(module_path),\n                self.module_to_string(&*module_));\n \n@@ -4960,14 +4959,10 @@ impl<'a> Resolver<'a> {\n                             result_def =\n                                 Some((DefPrimTy(primitive_type), LastMod(AllPublic)));\n \n-                            if path.segments\n-                                   .iter()\n-                                   .any(|s| s.parameters.has_lifetimes()) {\n+                            if path.segments[0].parameters.has_lifetimes() {\n                                 span_err!(self.session, path.span, E0157,\n                                     \"lifetime parameters are not allowed on this type\");\n-                            } else if path.segments\n-                                          .iter()\n-                                          .any(|s| !s.parameters.is_empty()) {\n+                            } else if !path.segments[0].parameters.is_empty() {\n                                 span_err!(self.session, path.span, E0153,\n                                     \"type parameters are not allowed on this type\");\n                             }\n@@ -5309,6 +5304,34 @@ impl<'a> Resolver<'a> {\n             self.resolve_type(&*binding.ty);\n         }\n \n+        // A special case for sugared associated type paths `T::A` where `T` is\n+        // a type parameter and `A` is an associated type on some bound of `T`.\n+        if namespace == TypeNS && path.segments.len() == 2 {\n+            match self.resolve_identifier(path.segments[0].identifier,\n+                                          TypeNS,\n+                                          true,\n+                                          path.span) {\n+                Some((def, last_private)) => {\n+                    match def {\n+                        DefTyParam(_, did, _) => {\n+                            let def = DefAssociatedPath(TyParamProvenance::FromParam(did),\n+                                                        path.segments.last()\n+                                                            .unwrap().identifier);\n+                            return Some((def, last_private));\n+                        }\n+                        DefSelfTy(nid) => {\n+                            let def = DefAssociatedPath(TyParamProvenance::FromSelf(local_def(nid)),\n+                                                        path.segments.last()\n+                                                            .unwrap().identifier);\n+                            return Some((def, last_private));\n+                        }\n+                        _ => {}\n+                    }\n+                }\n+                _ => {}\n+            }\n+        }\n+\n         if path.global {\n             return self.resolve_crate_relative_path(path, namespace);\n         }\n@@ -5561,8 +5584,7 @@ impl<'a> Resolver<'a> {\n         let search_result = match namespace {\n             ValueNS => {\n                 let renamed = mtwt::resolve(ident);\n-                self.search_ribs(self.value_ribs.as_slice(),\n-                                 renamed, span)\n+                self.search_ribs(self.value_ribs.as_slice(), renamed, span)\n             }\n             TypeNS => {\n                 let name = ident.name;"}, {"sha": "1a4f06663ef3b694089e7ea544022df20ea6056b", "filename": "src/librustc_trans/save/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_trans%2Fsave%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_trans%2Fsave%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fsave%2Fmod.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -221,6 +221,7 @@ impl <'l, 'tcx> DxrVisitor<'l, 'tcx> {\n             def::DefStruct(_) => Some(recorder::StructRef),\n             def::DefTy(..) |\n             def::DefAssociatedTy(..) |\n+            def::DefAssociatedPath(..) |\n             def::DefTrait(_) => Some(recorder::TypeRef),\n             def::DefStatic(_, _) |\n             def::DefConst(_) |"}, {"sha": "ff2f686fff8769bc70fd3303e99eda68e3b51183", "filename": "src/librustc_trans/trans/callee.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_trans%2Ftrans%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_trans%2Ftrans%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fcallee.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -205,7 +205,7 @@ fn trans<'blk, 'tcx>(bcx: Block<'blk, 'tcx>, expr: &ast::Expr)\n             def::DefTy(..) | def::DefPrimTy(..) | def::DefAssociatedTy(..) |\n             def::DefUse(..) | def::DefTyParamBinder(..) |\n             def::DefRegion(..) | def::DefLabel(..) | def::DefTyParam(..) |\n-            def::DefSelfTy(..) => {\n+            def::DefSelfTy(..) | def::DefAssociatedPath(..) => {\n                 bcx.tcx().sess.span_bug(\n                     ref_expr.span,\n                     format!(\"cannot translate def {} \\"}, {"sha": "87eda76db29900353886e3d4c3f8e7195bdb35a5", "filename": "src/librustc_typeck/astconv.rs", "status": "modified", "additions": 67, "deletions": 9, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_typeck%2Fastconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_typeck%2Fastconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fastconv.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -74,6 +74,14 @@ pub trait AstConv<'tcx> {\n     fn get_item_ty(&self, id: ast::DefId) -> ty::Polytype<'tcx>;\n     fn get_trait_def(&self, id: ast::DefId) -> Rc<ty::TraitDef<'tcx>>;\n \n+    /// Return an (optional) substitution to convert bound type parameters that\n+    /// are in scope into free ones. This function should only return Some\n+    /// within a fn body.\n+    /// See ParameterEnvironment::free_substs for more information.\n+    fn get_free_substs(&self) -> Option<&Substs<'tcx>> {\n+        None\n+    }\n+\n     /// What type should we use when a type is omitted?\n     fn ty_infer(&self, span: Span) -> Ty<'tcx>;\n \n@@ -517,9 +525,9 @@ fn convert_parenthesized_parameters<'tcx,AC>(this: &AC,\n }\n \n \n-/// Instantiates the path for the given trait reference, assuming that it's bound to a valid trait\n-/// type. Returns the def_id for the defining trait. Fails if the type is a type other than a trait\n-/// type.\n+/// Instantiates the path for the given trait reference, assuming that it's\n+/// bound to a valid trait type. Returns the def_id for the defining trait.\n+/// Fails if the type is a type other than a trait type.\n pub fn instantiate_trait_ref<'tcx,AC,RS>(this: &AC,\n                                          rscope: &RS,\n                                          ast_trait_ref: &ast::TraitRef,\n@@ -846,18 +854,29 @@ fn qpath_to_ty<'tcx,AC,RS>(this: &AC,\n \n     debug!(\"qpath_to_ty: trait_ref={}\", trait_ref.repr(this.tcx()));\n \n+    if let Some(ty) = find_assoc_ty(this, &*trait_ref, qpath.item_name) {\n+        return ty;\n+    }\n+\n+    this.tcx().sess.span_bug(ast_ty.span,\n+                             \"this associated type didn't get added \\\n+                              as a parameter for some reason\")\n+}\n+\n+fn find_assoc_ty<'tcx, AC>(this: &AC,\n+                           trait_ref: &ty::TraitRef<'tcx>,\n+                           type_name: ast::Ident)\n+                           -> Option<Ty<'tcx>>\n+where AC: AstConv<'tcx> {\n     let trait_def = this.get_trait_def(trait_ref.def_id);\n \n     for ty_param_def in trait_def.generics.types.get_slice(AssocSpace).iter() {\n-        if ty_param_def.name == qpath.item_name.name {\n-            debug!(\"qpath_to_ty: corresponding ty_param_def={}\", ty_param_def);\n-            return trait_ref.substs.type_for_def(ty_param_def);\n+        if ty_param_def.name == type_name.name {\n+            return Some(trait_ref.substs.type_for_def(ty_param_def));\n         }\n     }\n \n-    this.tcx().sess.span_bug(ast_ty.span,\n-                             \"this associated type didn't get added \\\n-                              as a parameter for some reason\")\n+    None\n }\n \n // Parses the programmer's textual representation of a type into our\n@@ -1011,6 +1030,45 @@ pub fn ast_ty_to_ty<'tcx, AC: AstConv<'tcx>, RS: RegionScope>(\n                                                   .get()).as_slice());\n                         ty::mk_err()\n                     }\n+                    def::DefAssociatedPath(typ, assoc_ident) => {\n+                        // FIXME(#19541): in both branches we should consider\n+                        // associated types in super-traits.\n+                        let (assoc_tys, tp_name): (Vec<_>, _) = match typ {\n+                            def::TyParamProvenance::FromParam(did) |\n+                            def::TyParamProvenance::FromSelf(did) => {\n+                                let ty_param_defs = tcx.ty_param_defs.borrow();\n+                                let tp_def = &(*ty_param_defs)[did.node];\n+                                let assoc_tys = tp_def.bounds.trait_bounds.iter()\n+                                    .filter_map(|b| find_assoc_ty(this, &**b, assoc_ident))\n+                                    .collect();\n+                                (assoc_tys, token::get_name(tp_def.name).to_string())\n+                            }\n+                        };\n+\n+                        if assoc_tys.len() == 0 {\n+                            tcx.sess.span_err(ast_ty.span,\n+                                              format!(\"associated type `{}` not \\\n+                                                       found for type parameter `{}`\",\n+                                                      token::get_ident(assoc_ident),\n+                                                      tp_name).as_slice());\n+                            return ty::mk_err()\n+                        }\n+\n+                        if assoc_tys.len() > 1 {\n+                            tcx.sess.span_err(ast_ty.span,\n+                                              format!(\"ambiguous associated type \\\n+                                                       `{}` in bounds of `{}`\",\n+                                                      token::get_ident(assoc_ident),\n+                                                      tp_name).as_slice());\n+                        }\n+\n+                        let mut result_ty = assoc_tys[0];\n+                        if let Some(substs) = this.get_free_substs() {\n+                            result_ty = result_ty.subst(tcx, substs);\n+                        }\n+\n+                        result_ty\n+                    }\n                     _ => {\n                         tcx.sess.span_fatal(ast_ty.span,\n                                             format!(\"found value name used \\"}, {"sha": "28e0a1a0fac398fc1b599a0aca1ce57b01aecbde", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -1534,6 +1534,10 @@ impl<'a, 'tcx> AstConv<'tcx> for FnCtxt<'a, 'tcx> {\n         ty::lookup_trait_def(self.tcx(), id)\n     }\n \n+    fn get_free_substs(&self) -> Option<&Substs<'tcx>> {\n+        Some(&self.inh.param_env.free_substs)\n+    }\n+\n     fn ty_infer(&self, _span: Span) -> Ty<'tcx> {\n         self.infcx().next_ty_var()\n     }\n@@ -4865,6 +4869,7 @@ pub fn polytype_for_def<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n       def::DefTrait(_) |\n       def::DefTy(..) |\n       def::DefAssociatedTy(..) |\n+      def::DefAssociatedPath(..) |\n       def::DefPrimTy(_) |\n       def::DefTyParam(..)=> {\n         fcx.ccx.tcx.sess.span_bug(sp, \"expected value, found type\");\n@@ -4973,6 +4978,7 @@ pub fn instantiate_path<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n         def::DefTyParamBinder(..) |\n         def::DefTy(..) |\n         def::DefAssociatedTy(..) |\n+        def::DefAssociatedPath(..) |\n         def::DefTrait(..) |\n         def::DefPrimTy(..) |\n         def::DefTyParam(..) => {"}, {"sha": "e93d9db28cf4b18eb6e59168281a4e88cfe5f7df", "filename": "src/test/compile-fail/assoc-eq-1.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Fcompile-fail%2Fassoc-eq-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Fcompile-fail%2Fassoc-eq-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fassoc-eq-1.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -20,8 +20,6 @@ pub trait Foo {\n \n fn foo2<I: Foo>(x: I) {\n     let _: A = x.boo(); //~ERROR use of undeclared\n-    let _: I::A = x.boo(); //~ERROR failed to resolve\n-    //~^ERROR use of undeclared type name `I::A`\n }\n \n pub fn main() {}"}, {"sha": "41f5bc17b561bb9ee378a3405ff3fc6f4c2fcb18", "filename": "src/test/compile-fail/assoc-path-1.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Fcompile-fail%2Fassoc-path-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Fcompile-fail%2Fassoc-path-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fassoc-path-1.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that we have one and only one associated type per ref.\n+\n+#![feature(associated_types)]\n+\n+pub trait Foo {\n+    type A;\n+}\n+pub trait Bar {\n+    type A;\n+}\n+\n+pub fn f1<T>(a: T, x: T::A) {} //~ERROR associated type `A` not found\n+pub fn f2<T: Foo + Bar>(a: T, x: T::A) {} //~ERROR ambiguous associated type `A`\n+\n+pub fn main() {}\n+"}, {"sha": "caf8ab3695d1c38905eef27735b55ec50e3f3702", "filename": "src/test/compile-fail/assoc-path-2.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Fcompile-fail%2Fassoc-path-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Fcompile-fail%2Fassoc-path-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fassoc-path-2.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -0,0 +1,34 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test type checking of uses of associated types via sugary paths.\n+\n+#![feature(associated_types)]\n+\n+pub trait Foo {\n+    type A;\n+}\n+\n+impl Foo for int {\n+    type A = uint;\n+}\n+\n+pub fn f1<T: Foo>(a: T, x: T::A) {}\n+pub fn f2<T: Foo>(a: T) -> T::A {\n+    panic!();\n+}\n+\n+pub fn main() {\n+    f1(2i, 4i); //~ERROR the trait `Foo` is not implemented\n+    f1(2u, 4u); //~ERROR the trait `Foo` is not implemented\n+    f1(2u, 4i); //~ERROR the trait `Foo` is not implemented\n+\n+    let _: int = f2(2i); //~ERROR mismatched types: expected `int`, found `uint`\n+}"}, {"sha": "28c06f51cebc25d2ba7075a8d5448f9dd896325e", "filename": "src/test/run-pass/assoc-sugar-path.rs", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Frun-pass%2Fassoc-sugar-path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8ba4955c6a6510102973b2d7bdd8ae3d682c15/src%2Ftest%2Frun-pass%2Fassoc-sugar-path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fassoc-sugar-path.rs?ref=4e8ba4955c6a6510102973b2d7bdd8ae3d682c15", "patch": "@@ -0,0 +1,46 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test paths to associated types using the type-parameter-only sugar.\n+\n+#![feature(associated_types)]\n+\n+pub trait Foo {\n+    type A;\n+    fn boo(&self) -> Self::A;\n+}\n+\n+impl Foo for int {\n+    type A = uint;\n+    fn boo(&self) -> uint {\n+        5\n+    }\n+}\n+\n+// Using a type via a function.\n+pub fn bar<T: Foo>(a: T, x: T::A) -> T::A {\n+    let _: T::A = a.boo();\n+    x\n+}\n+\n+// Using a type via an impl.\n+trait C {\n+    fn f();\n+}\n+struct B<X>;\n+impl<T: Foo> C for B<T> {\n+    fn f() {\n+        let x: T::A = panic!();\n+    }\n+}\n+\n+pub fn main() {\n+    let z: uint = bar(2i, 4u);\n+}"}]}