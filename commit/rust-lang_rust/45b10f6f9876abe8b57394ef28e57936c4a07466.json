{"sha": "45b10f6f9876abe8b57394ef28e57936c4a07466", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ1YjEwZjZmOTg3NmFiZThiNTczOTRlZjI4ZTU3OTM2YzRhMDc0NjY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-03-21T04:33:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-21T04:33:18Z"}, "message": "Rollup merge of #70038 - DutchGhost:const-forget-tests, r=RalfJung\n\nRemove the call that makes miri fail\n\nFixes the concern raised in https://github.com/rust-lang/rust/pull/69645/files#r392884274\n\ncc @RalfJung", "tree": {"sha": "3843e237976cb7791dc6ac5f28d82637028194a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3843e237976cb7791dc6ac5f28d82637028194a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/45b10f6f9876abe8b57394ef28e57936c4a07466", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJedZkOCRBK7hj4Ov3rIwAAdHIIAICxcfbJJtXWhem2vRPOzbDO\nBPI80ug0CEKuKr6DsVH2gPt8iGr4b+6VfS5uUfvd+qpqjZDl4swkgH0PtMlRaeRx\nyvTwUTDvL6N4gCuKrKlrv94nU0jlsoQRxJI3VEnAIDI4Kl7OjV5cZlifXESnAkTH\nlwnxbiNvxZLtWe7zD0brZninv545M6zmFX2/cGkI2Rf6Soi43+yEvDgf/hy1SYkE\nianZih61fqnrgmtmE3PocQM46AF+NIlmh+YPzVvCSiUo1hROGUMu/VDwrIvsFPwg\njE7tnaTTlhMOeeFT2DnrNCXJwXrGccfnRW6VE/IAwBZF3Wi+xAba8kAZzwTCqII=\n=XNAG\n-----END PGP SIGNATURE-----\n", "payload": "tree 3843e237976cb7791dc6ac5f28d82637028194a6\nparent 801a25abc1899df538939a8c2a3907bbea62cf1c\nparent d6f3a433d9847b2c4c6c31f9ea985625b16dded1\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1584765198 +0100\ncommitter GitHub <noreply@github.com> 1584765198 +0100\n\nRollup merge of #70038 - DutchGhost:const-forget-tests, r=RalfJung\n\nRemove the call that makes miri fail\n\nFixes the concern raised in https://github.com/rust-lang/rust/pull/69645/files#r392884274\n\ncc @RalfJung\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/45b10f6f9876abe8b57394ef28e57936c4a07466", "html_url": "https://github.com/rust-lang/rust/commit/45b10f6f9876abe8b57394ef28e57936c4a07466", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/45b10f6f9876abe8b57394ef28e57936c4a07466/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "801a25abc1899df538939a8c2a3907bbea62cf1c", "url": "https://api.github.com/repos/rust-lang/rust/commits/801a25abc1899df538939a8c2a3907bbea62cf1c", "html_url": "https://github.com/rust-lang/rust/commit/801a25abc1899df538939a8c2a3907bbea62cf1c"}, {"sha": "d6f3a433d9847b2c4c6c31f9ea985625b16dded1", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6f3a433d9847b2c4c6c31f9ea985625b16dded1", "html_url": "https://github.com/rust-lang/rust/commit/d6f3a433d9847b2c4c6c31f9ea985625b16dded1"}], "stats": {"total": 40, "additions": 22, "deletions": 18}, "files": [{"sha": "59588d97787b7adc19a93b15b83868fe8f980614", "filename": "src/libcore/tests/mem.rs", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/45b10f6f9876abe8b57394ef28e57936c4a07466/src%2Flibcore%2Ftests%2Fmem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45b10f6f9876abe8b57394ef28e57936c4a07466/src%2Flibcore%2Ftests%2Fmem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fmem.rs?ref=45b10f6f9876abe8b57394ef28e57936c4a07466", "patch": "@@ -129,21 +129,3 @@ fn test_discriminant_send_sync() {\n     is_send_sync::<Discriminant<Regular>>();\n     is_send_sync::<Discriminant<NotSendSync>>();\n }\n-\n-#[test]\n-fn test_const_forget() {\n-    const _: () = forget(0i32);\n-    const _: () = forget(Vec::<Vec<Box<i32>>>::new());\n-\n-    // Writing this function signature without const-forget\n-    // triggers compiler errors:\n-    // 1) That we use a non-const fn inside a const fn\n-    // 2) without the forget, it complains about the destructor of Box\n-    const fn const_forget_box<T>(x: Box<T>) {\n-        forget(x);\n-    }\n-\n-    // Call the forget_box at runtime,\n-    // as we can't const-construct a box yet.\n-    const_forget_box(Box::new(0i32));\n-}"}, {"sha": "2dcb72a5a09cb1f747e9aad77e93862f4a026318", "filename": "src/test/ui/consts/const_forget.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/45b10f6f9876abe8b57394ef28e57936c4a07466/src%2Ftest%2Fui%2Fconsts%2Fconst_forget.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45b10f6f9876abe8b57394ef28e57936c4a07466/src%2Ftest%2Fui%2Fconsts%2Fconst_forget.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_forget.rs?ref=45b10f6f9876abe8b57394ef28e57936c4a07466", "patch": "@@ -0,0 +1,22 @@\n+// check-pass\n+\n+#![feature(const_forget)]\n+\n+use std::mem::forget;\n+\n+const _: () = forget(0i32);\n+const _: () = forget(Vec::<Vec<Box<i32>>>::new());\n+\n+// Writing this function signature without const-forget\n+// triggers compiler errors:\n+// 1) That we use a non-const fn inside a const fn\n+// 2) without the forget, it complains about the destructor of Box\n+//\n+// FIXME: this method cannot be called in const-eval yet, as Box isn't\n+// const constructable\n+#[allow(unused)]\n+const fn const_forget_box<T: ?Sized>(b: Box<T>) {\n+    forget(b);\n+}\n+\n+fn main() {}"}]}