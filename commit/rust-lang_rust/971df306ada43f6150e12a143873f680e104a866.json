{"sha": "971df306ada43f6150e12a143873f680e104a866", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3MWRmMzA2YWRhNDNmNjE1MGUxMmExNDM4NzNmNjgwZTEwNGE4NjY=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-12-07T19:26:33Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-07T19:26:33Z"}, "message": "Merge #2494\n\n2494: Get the right analyzer for impls r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "913c24e889f3db8044b4b9f11bc3969e7eb02e34", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/913c24e889f3db8044b4b9f11bc3969e7eb02e34"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/971df306ada43f6150e12a143873f680e104a866", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd6/zpCRBK7hj4Ov3rIwAAdHIIAJYFZJo2FzGCxIqvJM6030wI\nv8kxlt4nzDiCpyIh3x0DzvfoA/51mfS3ZyB2UYv6ZFZARRx+Fu4cdGMGuE+9ci+a\nsAsy1tmhBUWUUUL24Ilv7O2sGbHSfhfPLrVv/w2Y575cu6Pp9q1ehX2239QT+/Q1\nM9oLZDmmgnSkM/ra+7rDAI8lBQfT+HTjS1Ltlew8th/ZPji/uaFI/3XsHsecKqGv\nDkYEtBYl4LIhJbgP2ATw0Q+OaextDzMl2G19NRmK2LKmNt3hRnCadY5tB6ViTvDk\nS9HvIwtMoOlE99+JpljE9hwxq7YGHM2Eu2HodkfJ6ky/Ow90bD8m+ItTmKUxVTw=\n=POS5\n-----END PGP SIGNATURE-----\n", "payload": "tree 913c24e889f3db8044b4b9f11bc3969e7eb02e34\nparent a3eb8787452a04400784ba8fed38303232595695\nparent 88c5b1282a5770097c6c768b24bedfc3a6944e08\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1575746793 +0000\ncommitter GitHub <noreply@github.com> 1575746793 +0000\n\nMerge #2494\n\n2494: Get the right analyzer for impls r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/971df306ada43f6150e12a143873f680e104a866", "html_url": "https://github.com/rust-lang/rust/commit/971df306ada43f6150e12a143873f680e104a866", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/971df306ada43f6150e12a143873f680e104a866/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3eb8787452a04400784ba8fed38303232595695", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3eb8787452a04400784ba8fed38303232595695", "html_url": "https://github.com/rust-lang/rust/commit/a3eb8787452a04400784ba8fed38303232595695"}, {"sha": "88c5b1282a5770097c6c768b24bedfc3a6944e08", "url": "https://api.github.com/repos/rust-lang/rust/commits/88c5b1282a5770097c6c768b24bedfc3a6944e08", "html_url": "https://github.com/rust-lang/rust/commit/88c5b1282a5770097c6c768b24bedfc3a6944e08"}], "stats": {"total": 364, "additions": 272, "deletions": 92}, "files": [{"sha": "4578a0ba8e91aa80b16facfbd5b98c377f4efc84", "filename": "crates/ra_hir/src/code_model.rs", "status": "modified", "additions": 17, "deletions": 6, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -15,9 +15,9 @@ use hir_def::{\n     per_ns::PerNs,\n     resolver::HasResolver,\n     type_ref::{Mutability, TypeRef},\n-    AdtId, AstItemDef, ConstId, ContainerId, DefWithBodyId, EnumId, FunctionId, GenericParamId,\n-    HasModule, ImplId, LocalEnumVariantId, LocalImportId, LocalModuleId, LocalStructFieldId,\n-    Lookup, ModuleId, StaticId, StructId, TraitId, TypeAliasId, UnionId,\n+    AdtId, AstItemDef, ConstId, ContainerId, DefWithBodyId, EnumId, FunctionId, HasModule, ImplId,\n+    LocalEnumVariantId, LocalImportId, LocalModuleId, LocalStructFieldId, Lookup, ModuleId,\n+    StaticId, StructId, TraitId, TypeAliasId, TypeParamId, UnionId,\n };\n use hir_expand::{\n     diagnostics::DiagnosticSink,\n@@ -856,8 +856,19 @@ impl Local {\n }\n \n #[derive(Clone, Copy, Debug, PartialEq, Eq, Hash)]\n-pub struct GenericParam {\n-    pub(crate) id: GenericParamId,\n+pub struct TypeParam {\n+    pub(crate) id: TypeParamId,\n+}\n+\n+impl TypeParam {\n+    pub fn name(self, db: &impl HirDatabase) -> Name {\n+        let params = db.generic_params(self.id.parent);\n+        params.types[self.id.local_id].name.clone()\n+    }\n+\n+    pub fn module(self, db: &impl HirDatabase) -> Module {\n+        self.id.parent.module(db).into()\n+    }\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n@@ -1100,7 +1111,7 @@ impl HirDisplay for Type {\n pub enum ScopeDef {\n     ModuleDef(ModuleDef),\n     MacroDef(MacroDef),\n-    GenericParam(GenericParam),\n+    GenericParam(TypeParam),\n     ImplSelfType(ImplBlock),\n     AdtSelfType(Adt),\n     Local(Local),"}, {"sha": "b09582f93c8b5ef212071f66b589e0bc65bf939f", "filename": "crates/ra_hir/src/code_model/src.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Fcode_model%2Fsrc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Fcode_model%2Fsrc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model%2Fsrc.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -10,7 +10,7 @@ use ra_syntax::ast;\n \n use crate::{\n     db::DefDatabase, Const, Enum, EnumVariant, FieldSource, Function, ImplBlock, Import, MacroDef,\n-    Module, Static, Struct, StructField, Trait, TypeAlias, Union,\n+    Module, Static, Struct, StructField, Trait, TypeAlias, TypeParam, Union,\n };\n \n pub use hir_expand::InFile;\n@@ -129,3 +129,11 @@ impl HasSource for Import {\n         src.with_value(ptr.map_left(|it| it.to_node(&root)).map_right(|it| it.to_node(&root)))\n     }\n }\n+\n+impl HasSource for TypeParam {\n+    type Ast = Either<ast::TraitDef, ast::TypeParam>;\n+    fn source(self, db: &impl DefDatabase) -> InFile<Self::Ast> {\n+        let child_source = self.id.parent.child_source(db);\n+        child_source.map(|it| it[self.id.local_id].clone())\n+    }\n+}"}, {"sha": "68e59fc1ec27ae606a828a969b79451165a22cfc", "filename": "crates/ra_hir/src/from_source.rs", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Ffrom_source.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Ffrom_source.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Ffrom_source.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -1,7 +1,7 @@\n //! FIXME: write short doc here\n use hir_def::{\n     child_by_source::ChildBySource, dyn_map::DynMap, keys, nameres::ModuleSource, AstItemDef,\n-    EnumVariantId, LocationCtx, ModuleId, VariantId,\n+    EnumVariantId, GenericDefId, LocationCtx, ModuleId, VariantId,\n };\n use hir_expand::{name::AsName, AstId, MacroDefId, MacroDefKind};\n use ra_syntax::{\n@@ -12,7 +12,7 @@ use ra_syntax::{\n use crate::{\n     db::{AstDatabase, DefDatabase, HirDatabase},\n     Const, DefWithBody, Enum, EnumVariant, FieldSource, Function, ImplBlock, InFile, Local,\n-    MacroDef, Module, Static, Struct, StructField, Trait, TypeAlias, Union,\n+    MacroDef, Module, Static, Struct, StructField, Trait, TypeAlias, TypeParam, Union,\n };\n \n pub trait FromSource: Sized {\n@@ -177,6 +177,23 @@ impl Local {\n     }\n }\n \n+impl TypeParam {\n+    pub fn from_source(db: &impl HirDatabase, src: InFile<ast::TypeParam>) -> Option<Self> {\n+        let file_id = src.file_id;\n+        let parent: GenericDefId = src.value.syntax().ancestors().find_map(|it| {\n+            let res = match_ast! {\n+                match it {\n+                    ast::FnDef(value) => { Function::from_source(db, InFile { value, file_id})?.id.into() },\n+                    _ => return None,\n+                }\n+            };\n+            Some(res)\n+        })?;\n+        let &id = parent.child_by_source(db)[keys::TYPE_PARAM].get(&src)?;\n+        Some(TypeParam { id })\n+    }\n+}\n+\n impl Module {\n     pub fn from_declaration(db: &impl DefDatabase, src: InFile<ast::Module>) -> Option<Self> {\n         let parent_declaration = src.value.syntax().ancestors().skip(1).find_map(ast::Module::cast);"}, {"sha": "9eb34b5dcdd9543cc539f2dc4e4c61547f4f8173", "filename": "crates/ra_hir/src/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Flib.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -42,9 +42,9 @@ pub mod from_source;\n pub use crate::{\n     code_model::{\n         src::HasSource, Adt, AssocItem, AttrDef, Const, Container, Crate, CrateDependency,\n-        DefWithBody, Docs, Enum, EnumVariant, FieldSource, Function, GenericDef, GenericParam,\n-        HasAttrs, ImplBlock, Import, Local, MacroDef, Module, ModuleDef, ScopeDef, Static, Struct,\n-        StructField, Trait, Type, TypeAlias, Union, VariantDef,\n+        DefWithBody, Docs, Enum, EnumVariant, FieldSource, Function, GenericDef, HasAttrs,\n+        ImplBlock, Import, Local, MacroDef, Module, ModuleDef, ScopeDef, Static, Struct,\n+        StructField, Trait, Type, TypeAlias, TypeParam, Union, VariantDef,\n     },\n     from_source::FromSource,\n     source_binder::{PathResolution, ScopeEntryWithSyntax, SourceAnalyzer},"}, {"sha": "b80aaeb9011fd572c14b49d86d629a107b6c67cc", "filename": "crates/ra_hir/src/source_binder.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -36,8 +36,8 @@ use crate::{\n         method_resolution::{self, implements_trait},\n         InEnvironment, TraitEnvironment, Ty,\n     },\n-    Adt, AssocItem, Const, DefWithBody, Enum, EnumVariant, FromSource, Function, GenericParam,\n-    Local, MacroDef, Name, Path, ScopeDef, Static, Struct, Trait, Type, TypeAlias,\n+    Adt, AssocItem, Const, DefWithBody, Enum, EnumVariant, FromSource, Function, ImplBlock, Local,\n+    MacroDef, Name, Path, ScopeDef, Static, Struct, Trait, Type, TypeAlias, TypeParam,\n };\n \n fn try_get_resolver_for_node(db: &impl HirDatabase, node: InFile<&SyntaxNode>) -> Option<Resolver> {\n@@ -59,6 +59,10 @@ fn try_get_resolver_for_node(db: &impl HirDatabase, node: InFile<&SyntaxNode>) -\n                 let src = node.with_value(it);\n                 Some(Enum::from_source(db, src)?.id.resolver(db))\n             },\n+            ast::ImplBlock(it) => {\n+                let src = node.with_value(it);\n+                Some(ImplBlock::from_source(db, src)?.id.resolver(db))\n+            },\n             _ => match node.value.kind() {\n                 FN_DEF | CONST_DEF | STATIC_DEF => {\n                     let def = def_with_body_from_child_node(db, node)?;\n@@ -108,7 +112,7 @@ pub enum PathResolution {\n     /// A local binding (only value namespace)\n     Local(Local),\n     /// A generic parameter\n-    GenericParam(GenericParam),\n+    TypeParam(TypeParam),\n     SelfType(crate::ImplBlock),\n     Macro(MacroDef),\n     AssocItem(crate::AssocItem),\n@@ -262,7 +266,7 @@ impl SourceAnalyzer {\n     ) -> Option<PathResolution> {\n         let types = self.resolver.resolve_path_in_type_ns_fully(db, &path).map(|ty| match ty {\n             TypeNs::SelfType(it) => PathResolution::SelfType(it.into()),\n-            TypeNs::GenericParam(id) => PathResolution::GenericParam(GenericParam { id }),\n+            TypeNs::GenericParam(id) => PathResolution::TypeParam(TypeParam { id }),\n             TypeNs::AdtSelfType(it) | TypeNs::AdtId(it) => {\n                 PathResolution::Def(Adt::from(it).into())\n             }\n@@ -334,7 +338,7 @@ impl SourceAnalyzer {\n                 resolver::ScopeDef::PerNs(it) => it.into(),\n                 resolver::ScopeDef::ImplSelfType(it) => ScopeDef::ImplSelfType(it.into()),\n                 resolver::ScopeDef::AdtSelfType(it) => ScopeDef::AdtSelfType(it.into()),\n-                resolver::ScopeDef::GenericParam(id) => ScopeDef::GenericParam(GenericParam { id }),\n+                resolver::ScopeDef::GenericParam(id) => ScopeDef::GenericParam(TypeParam { id }),\n                 resolver::ScopeDef::Local(pat_id) => {\n                     let parent = self.resolver.body_owner().unwrap().into();\n                     ScopeDef::Local(Local { parent, pat_id })"}, {"sha": "976cf72d09c72ef86dedf4085ee76882e6a6274f", "filename": "crates/ra_hir_def/src/generics.rs", "status": "modified", "additions": 99, "deletions": 29, "changes": 128, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fgenerics.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -4,28 +4,38 @@\n //! in rustc.\n use std::sync::Arc;\n \n-use hir_expand::name::{self, AsName, Name};\n-use ra_arena::Arena;\n+use either::Either;\n+use hir_expand::{\n+    name::{self, AsName, Name},\n+    InFile,\n+};\n+use ra_arena::{map::ArenaMap, Arena};\n+use ra_db::FileId;\n use ra_syntax::ast::{self, NameOwner, TypeBoundsOwner, TypeParamsOwner};\n \n use crate::{\n+    child_by_source::ChildBySource,\n     db::DefDatabase,\n+    dyn_map::DynMap,\n+    keys,\n+    src::HasChildSource,\n     src::HasSource,\n     type_ref::{TypeBound, TypeRef},\n-    AdtId, AstItemDef, GenericDefId, LocalGenericParamId, Lookup,\n+    AdtId, AstItemDef, GenericDefId, LocalTypeParamId, Lookup, TypeParamId,\n };\n \n /// Data about a generic parameter (to a function, struct, impl, ...).\n #[derive(Clone, PartialEq, Eq, Debug)]\n-pub struct GenericParamData {\n+pub struct TypeParamData {\n     pub name: Name,\n     pub default: Option<TypeRef>,\n }\n \n /// Data about the generic parameters of a function, struct, impl, etc.\n #[derive(Clone, PartialEq, Eq, Debug)]\n pub struct GenericParams {\n-    pub params: Arena<LocalGenericParamId, GenericParamData>,\n+    pub types: Arena<LocalTypeParamId, TypeParamData>,\n+    // lifetimes: Arena<LocalLifetimeParamId, LifetimeParamData>,\n     pub where_predicates: Vec<WherePredicate>,\n }\n \n@@ -39,66 +49,102 @@ pub struct WherePredicate {\n     pub bound: TypeBound,\n }\n \n+type SourceMap = ArenaMap<LocalTypeParamId, Either<ast::TraitDef, ast::TypeParam>>;\n+\n impl GenericParams {\n     pub(crate) fn generic_params_query(\n         db: &impl DefDatabase,\n         def: GenericDefId,\n     ) -> Arc<GenericParams> {\n-        Arc::new(GenericParams::new(db, def.into()))\n+        let (params, _source_map) = GenericParams::new(db, def.into());\n+        Arc::new(params)\n     }\n \n-    fn new(db: &impl DefDatabase, def: GenericDefId) -> GenericParams {\n-        let mut generics = GenericParams { params: Arena::default(), where_predicates: Vec::new() };\n+    fn new(db: &impl DefDatabase, def: GenericDefId) -> (GenericParams, InFile<SourceMap>) {\n+        let mut generics = GenericParams { types: Arena::default(), where_predicates: Vec::new() };\n+        let mut sm = ArenaMap::default();\n         // FIXME: add `: Sized` bound for everything except for `Self` in traits\n-        match def {\n-            GenericDefId::FunctionId(it) => generics.fill(&it.lookup(db).source(db).value),\n-            GenericDefId::AdtId(AdtId::StructId(it)) => generics.fill(&it.source(db).value),\n-            GenericDefId::AdtId(AdtId::UnionId(it)) => generics.fill(&it.source(db).value),\n-            GenericDefId::AdtId(AdtId::EnumId(it)) => generics.fill(&it.source(db).value),\n+        let file_id = match def {\n+            GenericDefId::FunctionId(it) => {\n+                let src = it.lookup(db).source(db);\n+                generics.fill(&mut sm, &src.value);\n+                src.file_id\n+            }\n+            GenericDefId::AdtId(AdtId::StructId(it)) => {\n+                let src = it.source(db);\n+                generics.fill(&mut sm, &src.value);\n+                src.file_id\n+            }\n+            GenericDefId::AdtId(AdtId::UnionId(it)) => {\n+                let src = it.source(db);\n+                generics.fill(&mut sm, &src.value);\n+                src.file_id\n+            }\n+            GenericDefId::AdtId(AdtId::EnumId(it)) => {\n+                let src = it.source(db);\n+                generics.fill(&mut sm, &src.value);\n+                src.file_id\n+            }\n             GenericDefId::TraitId(it) => {\n+                let src = it.source(db);\n+\n                 // traits get the Self type as an implicit first type parameter\n-                generics.params.alloc(GenericParamData { name: name::SELF_TYPE, default: None });\n-                generics.fill(&it.source(db).value);\n+                let self_param_id =\n+                    generics.types.alloc(TypeParamData { name: name::SELF_TYPE, default: None });\n+                sm.insert(self_param_id, Either::Left(src.value.clone()));\n                 // add super traits as bounds on Self\n                 // i.e., trait Foo: Bar is equivalent to trait Foo where Self: Bar\n                 let self_param = TypeRef::Path(name::SELF_TYPE.into());\n-                generics.fill_bounds(&it.source(db).value, self_param);\n+                generics.fill_bounds(&src.value, self_param);\n+\n+                generics.fill(&mut sm, &src.value);\n+                src.file_id\n+            }\n+            GenericDefId::TypeAliasId(it) => {\n+                let src = it.lookup(db).source(db);\n+                generics.fill(&mut sm, &src.value);\n+                src.file_id\n             }\n-            GenericDefId::TypeAliasId(it) => generics.fill(&it.lookup(db).source(db).value),\n             // Note that we don't add `Self` here: in `impl`s, `Self` is not a\n             // type-parameter, but rather is a type-alias for impl's target\n             // type, so this is handled by the resolver.\n-            GenericDefId::ImplId(it) => generics.fill(&it.source(db).value),\n-            GenericDefId::EnumVariantId(_) | GenericDefId::ConstId(_) => {}\n-        }\n+            GenericDefId::ImplId(it) => {\n+                let src = it.source(db);\n+                generics.fill(&mut sm, &src.value);\n+                src.file_id\n+            }\n+            // We won't be using this ID anyway\n+            GenericDefId::EnumVariantId(_) | GenericDefId::ConstId(_) => FileId(!0).into(),\n+        };\n \n-        generics\n+        (generics, InFile::new(file_id, sm))\n     }\n \n-    fn fill(&mut self, node: &impl TypeParamsOwner) {\n+    fn fill(&mut self, sm: &mut SourceMap, node: &dyn TypeParamsOwner) {\n         if let Some(params) = node.type_param_list() {\n-            self.fill_params(params)\n+            self.fill_params(sm, params)\n         }\n         if let Some(where_clause) = node.where_clause() {\n             self.fill_where_predicates(where_clause);\n         }\n     }\n \n-    fn fill_bounds(&mut self, node: &impl ast::TypeBoundsOwner, type_ref: TypeRef) {\n+    fn fill_bounds(&mut self, node: &dyn ast::TypeBoundsOwner, type_ref: TypeRef) {\n         for bound in\n             node.type_bound_list().iter().flat_map(|type_bound_list| type_bound_list.bounds())\n         {\n             self.add_where_predicate_from_bound(bound, type_ref.clone());\n         }\n     }\n \n-    fn fill_params(&mut self, params: ast::TypeParamList) {\n+    fn fill_params(&mut self, sm: &mut SourceMap, params: ast::TypeParamList) {\n         for type_param in params.type_params() {\n             let name = type_param.name().map_or_else(Name::missing, |it| it.as_name());\n             // FIXME: Use `Path::from_src`\n             let default = type_param.default_type().map(TypeRef::from_ast);\n-            let param = GenericParamData { name: name.clone(), default };\n-            self.params.alloc(param);\n+            let param = TypeParamData { name: name.clone(), default };\n+            let param_id = self.types.alloc(param);\n+            sm.insert(param_id, Either::Right(type_param.clone()));\n \n             let type_ref = TypeRef::Path(name.into());\n             self.fill_bounds(&type_param, type_ref);\n@@ -127,7 +173,31 @@ impl GenericParams {\n         self.where_predicates.push(WherePredicate { type_ref, bound });\n     }\n \n-    pub fn find_by_name(&self, name: &Name) -> Option<LocalGenericParamId> {\n-        self.params.iter().find_map(|(id, p)| if &p.name == name { Some(id) } else { None })\n+    pub fn find_by_name(&self, name: &Name) -> Option<LocalTypeParamId> {\n+        self.types.iter().find_map(|(id, p)| if &p.name == name { Some(id) } else { None })\n+    }\n+}\n+\n+impl HasChildSource for GenericDefId {\n+    type ChildId = LocalTypeParamId;\n+    type Value = Either<ast::TraitDef, ast::TypeParam>;\n+    fn child_source(&self, db: &impl DefDatabase) -> InFile<SourceMap> {\n+        let (_, sm) = GenericParams::new(db, *self);\n+        sm\n+    }\n+}\n+\n+impl ChildBySource for GenericDefId {\n+    fn child_by_source(&self, db: &impl DefDatabase) -> DynMap {\n+        let mut res = DynMap::default();\n+        let arena_map = self.child_source(db);\n+        let arena_map = arena_map.as_ref();\n+        for (local_id, src) in arena_map.value.iter() {\n+            let id = TypeParamId { parent: *self, local_id };\n+            if let Either::Right(type_param) = src {\n+                res[keys::TYPE_PARAM].insert(arena_map.with_value(type_param.clone()), id)\n+            }\n+        }\n+        res\n     }\n }"}, {"sha": "be702a4f8082180d7fbc722d7c903c339e63c6fa", "filename": "crates/ra_hir_def/src/keys.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Fkeys.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Fkeys.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fkeys.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -8,7 +8,7 @@ use rustc_hash::FxHashMap;\n \n use crate::{\n     dyn_map::{DynMap, Policy},\n-    ConstId, EnumVariantId, FunctionId, StaticId, StructFieldId, TypeAliasId,\n+    ConstId, EnumVariantId, FunctionId, StaticId, StructFieldId, TypeAliasId, TypeParamId,\n };\n \n type Key<K, V> = crate::dyn_map::Key<InFile<K>, V, AstPtrPolicy<K, V>>;\n@@ -20,6 +20,7 @@ pub const ENUM_VARIANT: Key<ast::EnumVariant, EnumVariantId> = Key::new();\n pub const TYPE_ALIAS: Key<ast::TypeAliasDef, TypeAliasId> = Key::new();\n pub const TUPLE_FIELD: Key<ast::TupleFieldDef, StructFieldId> = Key::new();\n pub const RECORD_FIELD: Key<ast::RecordFieldDef, StructFieldId> = Key::new();\n+pub const TYPE_PARAM: Key<ast::TypeParam, TypeParamId> = Key::new();\n \n /// XXX: AST Nodes and SyntaxNodes have identity equality semantics: nodes are\n /// equal if they point to exactly the same object."}, {"sha": "569da4f284ebf66df5debc82480e477553d37f82", "filename": "crates/ra_hir_def/src/lib.rs", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Flib.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -318,14 +318,14 @@ macro_rules! impl_froms {\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n-pub struct GenericParamId {\n+pub struct TypeParamId {\n     pub parent: GenericDefId,\n-    pub local_id: LocalGenericParamId,\n+    pub local_id: LocalTypeParamId,\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n-pub struct LocalGenericParamId(RawId);\n-impl_arena_id!(LocalGenericParamId);\n+pub struct LocalTypeParamId(RawId);\n+impl_arena_id!(LocalTypeParamId);\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n pub enum ContainerId {\n@@ -525,6 +525,20 @@ impl HasModule for DefWithBodyId {\n     }\n }\n \n+impl HasModule for GenericDefId {\n+    fn module(&self, db: &impl db::DefDatabase) -> ModuleId {\n+        match self {\n+            GenericDefId::FunctionId(it) => it.lookup(db).module(db),\n+            GenericDefId::AdtId(it) => it.module(db),\n+            GenericDefId::TraitId(it) => it.module(db),\n+            GenericDefId::TypeAliasId(it) => it.lookup(db).module(db),\n+            GenericDefId::ImplId(it) => it.module(db),\n+            GenericDefId::EnumVariantId(it) => it.parent.module(db),\n+            GenericDefId::ConstId(it) => it.lookup(db).module(db),\n+        }\n+    }\n+}\n+\n impl HasModule for StaticLoc {\n     fn module(&self, _db: &impl db::DefDatabase) -> ModuleId {\n         self.container"}, {"sha": "4c859e497f44fb9f5ffe31f4e68a2a1eee201a40", "filename": "crates/ra_hir_def/src/resolver.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Fresolver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_def%2Fsrc%2Fresolver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fresolver.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -18,8 +18,8 @@ use crate::{\n     path::{Path, PathKind},\n     per_ns::PerNs,\n     AdtId, AstItemDef, ConstId, ContainerId, DefWithBodyId, EnumId, EnumVariantId, FunctionId,\n-    GenericDefId, GenericParamId, HasModule, ImplId, LocalModuleId, Lookup, ModuleDefId, ModuleId,\n-    StaticId, StructId, TraitId, TypeAliasId,\n+    GenericDefId, HasModule, ImplId, LocalModuleId, Lookup, ModuleDefId, ModuleId, StaticId,\n+    StructId, TraitId, TypeAliasId, TypeParamId,\n };\n \n #[derive(Debug, Clone, Default)]\n@@ -59,7 +59,7 @@ enum Scope {\n #[derive(Debug, Clone, PartialEq, Eq, Hash)]\n pub enum TypeNs {\n     SelfType(ImplId),\n-    GenericParam(GenericParamId),\n+    GenericParam(TypeParamId),\n     AdtId(AdtId),\n     AdtSelfType(AdtId),\n     // Yup, enum variants are added to the types ns, but any usage of variant as\n@@ -157,7 +157,7 @@ impl Resolver {\n                     if let Some(local_id) = params.find_by_name(first_name) {\n                         let idx = if path.segments.len() == 1 { None } else { Some(1) };\n                         return Some((\n-                            TypeNs::GenericParam(GenericParamId { local_id, parent: *def }),\n+                            TypeNs::GenericParam(TypeParamId { local_id, parent: *def }),\n                             idx,\n                         ));\n                     }\n@@ -252,7 +252,7 @@ impl Resolver {\n \n                 Scope::GenericParams { params, def } if n_segments > 1 => {\n                     if let Some(local_id) = params.find_by_name(first_name) {\n-                        let ty = TypeNs::GenericParam(GenericParamId { local_id, parent: *def });\n+                        let ty = TypeNs::GenericParam(TypeParamId { local_id, parent: *def });\n                         return Some(ResolveValueResult::Partial(ty, 1));\n                     }\n                 }\n@@ -399,7 +399,7 @@ pub enum ScopeDef {\n     PerNs(PerNs),\n     ImplSelfType(ImplId),\n     AdtSelfType(AdtId),\n-    GenericParam(GenericParamId),\n+    GenericParam(TypeParamId),\n     Local(PatId),\n }\n \n@@ -431,10 +431,10 @@ impl Scope {\n                 }\n             }\n             Scope::GenericParams { params, def } => {\n-                for (local_id, param) in params.params.iter() {\n+                for (local_id, param) in params.types.iter() {\n                     f(\n                         param.name.clone(),\n-                        ScopeDef::GenericParam(GenericParamId { local_id, parent: *def }),\n+                        ScopeDef::GenericParam(TypeParamId { local_id, parent: *def }),\n                     )\n                 }\n             }\n@@ -481,7 +481,7 @@ impl Resolver {\n \n     fn push_generic_params_scope(self, db: &impl DefDatabase, def: GenericDefId) -> Resolver {\n         let params = db.generic_params(def);\n-        if params.params.is_empty() {\n+        if params.types.is_empty() {\n             self\n         } else {\n             self.push_scope(Scope::GenericParams { def, params })"}, {"sha": "aeb211a91cca86d55537a28d2212358abdeb7fea", "filename": "crates/ra_hir_ty/src/utils.rs", "status": "modified", "additions": 12, "deletions": 14, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_ty%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_hir_ty%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Futils.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -5,10 +5,10 @@ use std::sync::Arc;\n use hir_def::{\n     adt::VariantData,\n     db::DefDatabase,\n-    generics::{GenericParamData, GenericParams},\n+    generics::{GenericParams, TypeParamData},\n     resolver::{HasResolver, TypeNs},\n     type_ref::TypeRef,\n-    ContainerId, GenericDefId, GenericParamId, Lookup, TraitId, TypeAliasId, VariantId,\n+    ContainerId, GenericDefId, Lookup, TraitId, TypeAliasId, TypeParamId, VariantId,\n };\n use hir_expand::name::{self, Name};\n \n@@ -96,23 +96,21 @@ pub(crate) struct Generics {\n }\n \n impl Generics {\n-    pub(crate) fn iter<'a>(&'a self) -> impl Iterator<Item = (u32, &'a GenericParamData)> + 'a {\n+    pub(crate) fn iter<'a>(&'a self) -> impl Iterator<Item = (u32, &'a TypeParamData)> + 'a {\n         self.parent_generics\n             .as_ref()\n             .into_iter()\n-            .flat_map(|it| it.params.params.iter())\n-            .chain(self.params.params.iter())\n+            .flat_map(|it| it.params.types.iter())\n+            .chain(self.params.types.iter())\n             .enumerate()\n             .map(|(i, (_local_id, p))| (i as u32, p))\n     }\n \n-    pub(crate) fn iter_parent<'a>(\n-        &'a self,\n-    ) -> impl Iterator<Item = (u32, &'a GenericParamData)> + 'a {\n+    pub(crate) fn iter_parent<'a>(&'a self) -> impl Iterator<Item = (u32, &'a TypeParamData)> + 'a {\n         self.parent_generics\n             .as_ref()\n             .into_iter()\n-            .flat_map(|it| it.params.params.iter())\n+            .flat_map(|it| it.params.types.iter())\n             .enumerate()\n             .map(|(i, (_local_id, p))| (i as u32, p))\n     }\n@@ -123,20 +121,20 @@ impl Generics {\n     /// (total, parents, child)\n     pub(crate) fn len_split(&self) -> (usize, usize, usize) {\n         let parent = self.parent_generics.as_ref().map_or(0, |p| p.len());\n-        let child = self.params.params.len();\n+        let child = self.params.types.len();\n         (parent + child, parent, child)\n     }\n-    pub(crate) fn param_idx(&self, param: GenericParamId) -> u32 {\n+    pub(crate) fn param_idx(&self, param: TypeParamId) -> u32 {\n         self.find_param(param).0\n     }\n-    pub(crate) fn param_name(&self, param: GenericParamId) -> Name {\n+    pub(crate) fn param_name(&self, param: TypeParamId) -> Name {\n         self.find_param(param).1.name.clone()\n     }\n-    fn find_param(&self, param: GenericParamId) -> (u32, &GenericParamData) {\n+    fn find_param(&self, param: TypeParamId) -> (u32, &TypeParamData) {\n         if param.parent == self.def {\n             let (idx, (_local_id, data)) = self\n                 .params\n-                .params\n+                .types\n                 .iter()\n                 .enumerate()\n                 .find(|(_, (idx, _))| *idx == param.local_id)"}, {"sha": "6a6b49afdf141a6fd4f3adf9cf8959028f80272e", "filename": "crates/ra_ide/src/display/navigation_target.rs", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fdisplay%2Fnavigation_target.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fdisplay%2Fnavigation_target.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fdisplay%2Fnavigation_target.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -6,7 +6,7 @@ use ra_db::{FileId, SourceDatabase};\n use ra_syntax::{\n     ast::{self, DocCommentsOwner, NameOwner},\n     match_ast, AstNode, SmolStr,\n-    SyntaxKind::{self, BIND_PAT},\n+    SyntaxKind::{self, BIND_PAT, TYPE_PARAM},\n     TextRange,\n };\n \n@@ -351,6 +351,26 @@ impl ToNav for hir::Local {\n     }\n }\n \n+impl ToNav for hir::TypeParam {\n+    fn to_nav(&self, db: &RootDatabase) -> NavigationTarget {\n+        let src = self.source(db);\n+        let range = match src.value {\n+            Either::Left(it) => it.syntax().text_range(),\n+            Either::Right(it) => it.syntax().text_range(),\n+        };\n+        NavigationTarget {\n+            file_id: src.file_id.original_file(db),\n+            name: self.name(db).to_string().into(),\n+            kind: TYPE_PARAM,\n+            full_range: range,\n+            focus_range: None,\n+            container_name: None,\n+            description: None,\n+            docs: None,\n+        }\n+    }\n+}\n+\n pub(crate) fn docs_from_symbol(db: &RootDatabase, symbol: &FileSymbol) -> Option<String> {\n     let parse = db.parse(symbol.file_id);\n     let node = symbol.ptr.to_node(parse.tree().syntax());"}, {"sha": "1b968134d6e1de0c2c933578ae03957050a4bc43", "filename": "crates/ra_ide/src/goto_definition.rs", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -64,9 +64,11 @@ pub(crate) fn reference_definition(\n \n     let name_kind = classify_name_ref(db, name_ref).map(|d| d.kind);\n     match name_kind {\n-        Some(Macro(mac)) => return Exact(mac.to_nav(db)),\n-        Some(Field(field)) => return Exact(field.to_nav(db)),\n-        Some(AssocItem(assoc)) => return Exact(assoc.to_nav(db)),\n+        Some(Macro(it)) => return Exact(it.to_nav(db)),\n+        Some(Field(it)) => return Exact(it.to_nav(db)),\n+        Some(TypeParam(it)) => return Exact(it.to_nav(db)),\n+        Some(AssocItem(it)) => return Exact(it.to_nav(db)),\n+        Some(Local(it)) => return Exact(it.to_nav(db)),\n         Some(Def(def)) => match NavigationTarget::from_def(db, def) {\n             Some(nav) => return Exact(nav),\n             None => return Approximate(vec![]),\n@@ -77,10 +79,6 @@ pub(crate) fn reference_definition(\n             // us to the actual type\n             return Exact(imp.to_nav(db));\n         }\n-        Some(Local(local)) => return Exact(local.to_nav(db)),\n-        Some(GenericParam(_)) => {\n-            // FIXME: go to the generic param def\n-        }\n         None => {}\n     };\n \n@@ -723,4 +721,17 @@ mod tests {\n             \"foo FN_DEF FileId(1) [359; 376) [362; 365)\",\n         );\n     }\n+\n+    #[test]\n+    fn goto_for_type_param() {\n+        check_goto(\n+            \"\n+            //- /lib.rs\n+            struct Foo<T> {\n+                t: <|>T,\n+            }\n+            \",\n+            \"T TYPE_PARAM FileId(1) [11; 12)\",\n+        );\n+    }\n }"}, {"sha": "d372ca758ea80841ef7dd5b221100944fd436b1b", "filename": "crates/ra_ide/src/hover.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fhover.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -138,7 +138,7 @@ fn hover_text_from_name_kind(\n             *no_fallback = true;\n             None\n         }\n-        GenericParam(_) | SelfType(_) => {\n+        TypeParam(_) | SelfType(_) => {\n             // FIXME: Hover for generic param\n             None\n         }"}, {"sha": "e3ecde50dd8073544a520d2173c5ae6b64fdd6c2", "filename": "crates/ra_ide/src/references.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Freferences.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Freferences.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Freferences.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -85,7 +85,7 @@ pub(crate) fn find_all_refs(\n         NameKind::Def(def) => NavigationTarget::from_def(db, def)?,\n         NameKind::SelfType(imp) => imp.to_nav(db),\n         NameKind::Local(local) => local.to_nav(db),\n-        NameKind::GenericParam(_) => return None,\n+        NameKind::TypeParam(_) => return None,\n     };\n \n     let search_scope = {"}, {"sha": "c1f091ec080af61dcac04c9af7012a967084e61d", "filename": "crates/ra_ide/src/references/classify.rs", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Freferences%2Fclassify.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Freferences%2Fclassify.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Freferences%2Fclassify.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -110,6 +110,15 @@ pub(crate) fn classify_name(db: &RootDatabase, name: InFile<&ast::Name>) -> Opti\n                     kind: NameKind::Macro(def),\n                 })\n             },\n+            ast::TypeParam(it) => {\n+                let src = name.with_value(it);\n+                let def = hir::TypeParam::from_source(db, src)?;\n+                Some(NameDefinition {\n+                    visibility: None,\n+                    container: def.module(db),\n+                    kind: NameKind::TypeParam(def),\n+                })\n+            },\n             _ => None,\n         }\n     }\n@@ -168,9 +177,8 @@ pub(crate) fn classify_name_ref(\n             let kind = NameKind::Local(local);\n             Some(NameDefinition { kind, container, visibility: None })\n         }\n-        PathResolution::GenericParam(par) => {\n-            // FIXME: get generic param def\n-            let kind = NameKind::GenericParam(par);\n+        PathResolution::TypeParam(par) => {\n+            let kind = NameKind::TypeParam(par);\n             Some(NameDefinition { kind, container, visibility })\n         }\n         PathResolution::Macro(def) => {"}, {"sha": "8c67c88639f9b48ea028e91a495d2de6f5704d10", "filename": "crates/ra_ide/src/references/name_definition.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Freferences%2Fname_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Freferences%2Fname_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Freferences%2Fname_definition.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -4,8 +4,8 @@\n //! Note that the reference search is possible for not all of the classified items.\n \n use hir::{\n-    Adt, AssocItem, GenericParam, HasSource, ImplBlock, Local, MacroDef, Module, ModuleDef,\n-    StructField, VariantDef,\n+    Adt, AssocItem, HasSource, ImplBlock, Local, MacroDef, Module, ModuleDef, StructField,\n+    TypeParam, VariantDef,\n };\n use ra_syntax::{ast, ast::VisibilityOwner};\n \n@@ -19,7 +19,7 @@ pub enum NameKind {\n     Def(ModuleDef),\n     SelfType(ImplBlock),\n     Local(Local),\n-    GenericParam(GenericParam),\n+    TypeParam(TypeParam),\n }\n \n #[derive(PartialEq, Eq)]"}, {"sha": "4166a8f90d47f31a0177354edd67b39ebaba5542", "filename": "crates/ra_ide/src/snapshots/highlighting.html", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlighting.html", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlighting.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlighting.html?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -9,6 +9,7 @@\n .parameter          { color: #94BFF3; }\n .builtin            { color: #DD6718; }\n .text               { color: #DCDCCC; }\n+.type               { color: #7CB8BB; }\n .attribute          { color: #94BFF3; }\n .literal            { color: #BFEBBF; }\n .macro              { color: #94BFF3; }\n@@ -45,4 +46,12 @@\n     <span class=\"keyword\">let</span> <span class=\"variable\">z</span> = &<span class=\"variable.mut\">y</span>;\n \n     <span class=\"variable.mut\">y</span>;\n+}\n+\n+<span class=\"keyword\">enum</span> <span class=\"type\">E</span>&lt;<span class=\"type\">X</span>&gt; {\n+    <span class=\"constant\">V</span>(<span class=\"type\">X</span>)\n+}\n+\n+<span class=\"keyword\">impl</span>&lt;<span class=\"type\">X</span>&gt; <span class=\"type\">E</span>&lt;<span class=\"type\">X</span>&gt; {\n+    <span class=\"keyword\">fn</span> <span class=\"function\">new</span>&lt;<span class=\"type\">T</span>&gt;() -&gt; <span class=\"type\">E</span>&lt;<span class=\"type\">T</span>&gt; {}\n }</code></pre>\n\\ No newline at end of file"}, {"sha": "9dfbc8047529a877c0fbda47e715e69a4a745d88", "filename": "crates/ra_ide/src/snapshots/rainbow_highlighting.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Frainbow_highlighting.html", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Frainbow_highlighting.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Frainbow_highlighting.html?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -9,6 +9,7 @@\n .parameter          { color: #94BFF3; }\n .builtin            { color: #DD6718; }\n .text               { color: #DCDCCC; }\n+.type               { color: #7CB8BB; }\n .attribute          { color: #94BFF3; }\n .literal            { color: #BFEBBF; }\n .macro              { color: #94BFF3; }"}, {"sha": "7ecb1a027243070b4cab7ce6dc6e6ea36a1c745a", "filename": "crates/ra_ide/src/syntax_highlighting.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/971df306ada43f6150e12a143873f680e104a866/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting.rs?ref=971df306ada43f6150e12a143873f680e104a866", "patch": "@@ -225,8 +225,7 @@ fn highlight_name(db: &RootDatabase, name_kind: NameKind) -> &'static str {\n         Def(hir::ModuleDef::Trait(_)) => \"type\",\n         Def(hir::ModuleDef::TypeAlias(_)) => \"type\",\n         Def(hir::ModuleDef::BuiltinType(_)) => \"type\",\n-        SelfType(_) => \"type\",\n-        GenericParam(_) => \"type\",\n+        SelfType(_) | TypeParam(_) => \"type\",\n         Local(local) => {\n             if local.is_mut(db) {\n                 \"variable.mut\"\n@@ -255,6 +254,7 @@ pre                 { color: #DCDCCC; background: #3F3F3F; font-size: 22px; padd\n .parameter          { color: #94BFF3; }\n .builtin            { color: #DD6718; }\n .text               { color: #DCDCCC; }\n+.type               { color: #7CB8BB; }\n .attribute          { color: #94BFF3; }\n .literal            { color: #BFEBBF; }\n .macro              { color: #94BFF3; }\n@@ -303,6 +303,14 @@ fn main() {\n \n     y;\n }\n+\n+enum E<X> {\n+    V(X)\n+}\n+\n+impl<X> E<X> {\n+    fn new<T>() -> E<T> {}\n+}\n \"#\n             .trim(),\n         );"}]}