{"sha": "0f334c3642257f711e0c397fec11707d86e14e70", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmMzM0YzM2NDIyNTdmNzExZTBjMzk3ZmVjMTE3MDdkODZlMTRlNzA=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-01-06T17:54:27Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-01-08T17:03:27Z"}, "message": "Check is_anon outside of can_reconstruct_query_key.", "tree": {"sha": "384d3b394855effe22c1b2884c688515f1aafe90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/384d3b394855effe22c1b2884c688515f1aafe90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f334c3642257f711e0c397fec11707d86e14e70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f334c3642257f711e0c397fec11707d86e14e70", "html_url": "https://github.com/rust-lang/rust/commit/0f334c3642257f711e0c397fec11707d86e14e70", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f334c3642257f711e0c397fec11707d86e14e70/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fcc537d181f5f2176ec144d277e93ec92b39085", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fcc537d181f5f2176ec144d277e93ec92b39085", "html_url": "https://github.com/rust-lang/rust/commit/5fcc537d181f5f2176ec144d277e93ec92b39085"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "b775846bba4528e272dcb1fee2279c4132f3f4cc", "filename": "compiler/rustc_middle/src/dep_graph/dep_node.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0f334c3642257f711e0c397fec11707d86e14e70/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f334c3642257f711e0c397fec11707d86e14e70/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs?ref=0f334c3642257f711e0c397fec11707d86e14e70", "patch": "@@ -230,7 +230,7 @@ pub mod dep_kind {\n         is_anon: true,\n         is_eval_always: false,\n \n-        can_reconstruct_query_key: || false,\n+        can_reconstruct_query_key: || true,\n         force_from_dep_node: |_, _| false,\n         try_load_from_on_disk_cache: |_, _| {},\n     };\n@@ -257,7 +257,6 @@ pub mod dep_kind {\n \n                 #[inline(always)]\n                 fn can_reconstruct_query_key() -> bool {\n-                    !is_anon &&\n                     <query_keys::$variant<'_> as DepNodeParams<TyCtxt<'_>>>\n                         ::can_reconstruct_query_key()\n                 }\n@@ -267,6 +266,10 @@ pub mod dep_kind {\n                 }\n \n                 fn force_from_dep_node(tcx: TyCtxt<'_>, dep_node: &DepNode) -> bool {\n+                    if is_anon {\n+                        return false;\n+                    }\n+\n                     if !can_reconstruct_query_key() {\n                         return false;\n                     }\n@@ -285,6 +288,10 @@ pub mod dep_kind {\n                 }\n \n                 fn try_load_from_on_disk_cache(tcx: TyCtxt<'_>, dep_node: &DepNode) {\n+                    if is_anon {\n+                        return\n+                    }\n+\n                     if !can_reconstruct_query_key() {\n                         return\n                     }"}]}