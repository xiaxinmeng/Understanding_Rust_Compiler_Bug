{"sha": "fe52a6518628cd026a8c7e64c59183ca3c4b9144", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlNTJhNjUxODYyOGNkMDI2YThjN2U2NGM1OTE4M2NhM2M0YjkxNDQ=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-12-26T22:15:20Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-12-26T22:15:20Z"}, "message": "Use package name for top-level directory in bare tarballs\n\nThis fixes a bug introduced by #79788.", "tree": {"sha": "460d0a0cb5c565f7e323d2b68d0dc17bf02bfbde", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/460d0a0cb5c565f7e323d2b68d0dc17bf02bfbde"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe52a6518628cd026a8c7e64c59183ca3c4b9144", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe52a6518628cd026a8c7e64c59183ca3c4b9144", "html_url": "https://github.com/rust-lang/rust/commit/fe52a6518628cd026a8c7e64c59183ca3c4b9144", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe52a6518628cd026a8c7e64c59183ca3c4b9144/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89524d0f8e28080197a85e06d143b7d6f131b67e", "url": "https://api.github.com/repos/rust-lang/rust/commits/89524d0f8e28080197a85e06d143b7d6f131b67e", "html_url": "https://github.com/rust-lang/rust/commit/89524d0f8e28080197a85e06d143b7d6f131b67e"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "32c8e791bfc6bfdaf7cf880884e0b290de1aa5ba", "filename": "src/bootstrap/tarball.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fe52a6518628cd026a8c7e64c59183ca3c4b9144/src%2Fbootstrap%2Ftarball.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe52a6518628cd026a8c7e64c59183ca3c4b9144/src%2Fbootstrap%2Ftarball.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftarball.rs?ref=fe52a6518628cd026a8c7e64c59183ca3c4b9144", "patch": "@@ -241,10 +241,16 @@ impl<'a> Tarball<'a> {\n     }\n \n     pub(crate) fn bare(self) -> PathBuf {\n+        // Bare tarballs should have the top level directory match the package\n+        // name, not \"image\". We rename the image directory just before passing\n+        // into rust-installer.\n+        let dest = self.temp_dir.join(self.package_name());\n+        t!(std::fs::rename(&self.image_dir, &dest));\n+\n         self.run(|this, cmd| {\n             cmd.arg(\"tarball\")\n                 .arg(\"--input\")\n-                .arg(&this.image_dir)\n+                .arg(&dest)\n                 .arg(\"--output\")\n                 .arg(crate::dist::distdir(this.builder).join(this.package_name()));\n         })"}]}