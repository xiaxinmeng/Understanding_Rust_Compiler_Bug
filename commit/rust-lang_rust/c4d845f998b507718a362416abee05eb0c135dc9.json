{"sha": "c4d845f998b507718a362416abee05eb0c135dc9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0ZDg0NWY5OThiNTA3NzE4YTM2MjQxNmFiZWUwNWViMGMxMzVkYzk=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-08-28T02:09:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-08-28T02:09:31Z"}, "message": "Merge pull request #2972 from crw5996/fix-optional-arg-condensing\n\nFix optional arg condensing", "tree": {"sha": "704acfeb2b4bce7b62809101547323768c9a948d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/704acfeb2b4bce7b62809101547323768c9a948d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4d845f998b507718a362416abee05eb0c135dc9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbhK7bCRBK7hj4Ov3rIwAAdHIIAGYvGLuKTCztvgnV87aZbiQe\nbA68YvqwUqk6SzhFRAMpJ8hRtycQ8/lLELZBHn7Xrm95Q5BQzAn9sTlsjVfuvJZs\najOnAJ7mvQGvWGWQfuz0p/GBkmIusC1jNk0j6escECy8zOTie0MNihTIZg5B+8F2\nY61lVQmwPiXzKLMQhxD9SVDuHwdufuj+d0GCRrTGUaup6pgwh8c4Pdm+XPukiQj5\n+hwD177AAir2BqZSjc797YEOC4wVemBmzpqAR8VGOPSmy//HaApuvKWxDnqoPfrU\nOJE6bxjYqMysivRtlArgTchv2vXmmVoHKQHjLzKJykyJgfTAVy+0o9Q3wCMicKM=\n=Kvwi\n-----END PGP SIGNATURE-----\n", "payload": "tree 704acfeb2b4bce7b62809101547323768c9a948d\nparent 448460958347cc633c9aea993253be076fda1580\nparent 8c7afaf03b0395723a4647e20b1fa149cf258cf8\nauthor Nick Cameron <nrc@ncameron.org> 1535422171 +1200\ncommitter GitHub <noreply@github.com> 1535422171 +1200\n\nMerge pull request #2972 from crw5996/fix-optional-arg-condensing\n\nFix optional arg condensing"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4d845f998b507718a362416abee05eb0c135dc9", "html_url": "https://github.com/rust-lang/rust/commit/c4d845f998b507718a362416abee05eb0c135dc9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4d845f998b507718a362416abee05eb0c135dc9/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "448460958347cc633c9aea993253be076fda1580", "url": "https://api.github.com/repos/rust-lang/rust/commits/448460958347cc633c9aea993253be076fda1580", "html_url": "https://github.com/rust-lang/rust/commit/448460958347cc633c9aea993253be076fda1580"}, {"sha": "8c7afaf03b0395723a4647e20b1fa149cf258cf8", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c7afaf03b0395723a4647e20b1fa149cf258cf8", "html_url": "https://github.com/rust-lang/rust/commit/8c7afaf03b0395723a4647e20b1fa149cf258cf8"}], "stats": {"total": 45, "additions": 28, "deletions": 17}, "files": [{"sha": "d5c4802904b65ed9747d90099e413d556b7b4400", "filename": "src/patterns.rs", "status": "modified", "additions": 16, "deletions": 17, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/c4d845f998b507718a362416abee05eb0c135dc9/src%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d845f998b507718a362416abee05eb0c135dc9/src%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fpatterns.rs?ref=c4d845f998b507718a362416abee05eb0c135dc9", "patch": "@@ -336,29 +336,28 @@ fn rewrite_tuple_pat(\n         ));\n         pat_vec.insert(pos, dotdot);\n     }\n-\n     if pat_vec.is_empty() {\n         return Some(format!(\"{}()\", path_str.unwrap_or_default()));\n     }\n-\n     let wildcard_suffix_len = count_wildcard_suffix_len(context, &pat_vec, span, shape);\n-    let (pat_vec, span) = if context.config.condense_wildcard_suffixes() && wildcard_suffix_len >= 2\n-    {\n-        let new_item_count = 1 + pat_vec.len() - wildcard_suffix_len;\n-        let sp = pat_vec[new_item_count - 1].span();\n-        let snippet = context.snippet(sp);\n-        let lo = sp.lo() + BytePos(snippet.find_uncommented(\"_\").unwrap() as u32);\n-        pat_vec[new_item_count - 1] = TuplePatField::Dotdot(mk_sp(lo, lo + BytePos(1)));\n-        (\n-            &pat_vec[..new_item_count],\n-            mk_sp(span.lo(), lo + BytePos(1)),\n-        )\n-    } else {\n-        (&pat_vec[..], span)\n-    };\n+    let (pat_vec, span, condensed) =\n+        if context.config.condense_wildcard_suffixes() && wildcard_suffix_len >= 2 {\n+            let new_item_count = 1 + pat_vec.len() - wildcard_suffix_len;\n+            let sp = pat_vec[new_item_count - 1].span();\n+            let snippet = context.snippet(sp);\n+            let lo = sp.lo() + BytePos(snippet.find_uncommented(\"_\").unwrap() as u32);\n+            pat_vec[new_item_count - 1] = TuplePatField::Dotdot(mk_sp(lo, lo + BytePos(1)));\n+            (\n+                &pat_vec[..new_item_count],\n+                mk_sp(span.lo(), lo + BytePos(1)),\n+                true,\n+            )\n+        } else {\n+            (&pat_vec[..], span, false)\n+        };\n \n     // add comma if `(x,)`\n-    let add_comma = path_str.is_none() && pat_vec.len() == 1 && dotdot_pos.is_none();\n+    let add_comma = path_str.is_none() && pat_vec.len() == 1 && dotdot_pos.is_none() && !condensed;\n     let path_str = path_str.unwrap_or_default();\n     let pat_ref_vec = pat_vec.iter().collect::<Vec<_>>();\n "}, {"sha": "525e070a57eee7df83adfed1cb4437b578010326", "filename": "tests/source/issue-2955.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c4d845f998b507718a362416abee05eb0c135dc9/tests%2Fsource%2Fissue-2955.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d845f998b507718a362416abee05eb0c135dc9/tests%2Fsource%2Fissue-2955.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-2955.rs?ref=c4d845f998b507718a362416abee05eb0c135dc9", "patch": "@@ -0,0 +1,6 @@\n+// rustfmt-condense_wildcard_suffixes: true\n+fn main() {\n+    match (1, 2, 3) {\n+        (_, _, _) => (),\n+    }\n+}"}, {"sha": "799cd36e29ac28cc47aa9287a81d7d213b1bd6c0", "filename": "tests/target/issue-2955.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c4d845f998b507718a362416abee05eb0c135dc9/tests%2Ftarget%2Fissue-2955.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d845f998b507718a362416abee05eb0c135dc9/tests%2Ftarget%2Fissue-2955.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2955.rs?ref=c4d845f998b507718a362416abee05eb0c135dc9", "patch": "@@ -0,0 +1,6 @@\n+// rustfmt-condense_wildcard_suffixes: true\n+fn main() {\n+    match (1, 2, 3) {\n+        (..) => (),\n+    }\n+}"}]}