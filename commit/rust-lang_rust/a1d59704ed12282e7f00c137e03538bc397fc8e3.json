{"sha": "a1d59704ed12282e7f00c137e03538bc397fc8e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExZDU5NzA0ZWQxMjI4MmU3ZjAwYzEzN2UwMzUzOGJjMzk3ZmM4ZTM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-09T22:06:38Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-09T22:06:38Z"}, "message": "rustc: Add more creader logging", "tree": {"sha": "b8e459d16844c3e98fcb9358d48b02b3da1aeb45", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b8e459d16844c3e98fcb9358d48b02b3da1aeb45"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a1d59704ed12282e7f00c137e03538bc397fc8e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a1d59704ed12282e7f00c137e03538bc397fc8e3", "html_url": "https://github.com/rust-lang/rust/commit/a1d59704ed12282e7f00c137e03538bc397fc8e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a1d59704ed12282e7f00c137e03538bc397fc8e3/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb181527b46452925c92350cbb885fdae0756495", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb181527b46452925c92350cbb885fdae0756495", "html_url": "https://github.com/rust-lang/rust/commit/eb181527b46452925c92350cbb885fdae0756495"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "a24180238b70b358a696df00992462ddbfe2e2c1", "filename": "src/rustc/metadata/creader.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a1d59704ed12282e7f00c137e03538bc397fc8e3/src%2Frustc%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1d59704ed12282e7f00c137e03538bc397fc8e3/src%2Frustc%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmetadata%2Fcreader.rs?ref=a1d59704ed12282e7f00c137e03538bc397fc8e3", "patch": "@@ -28,6 +28,7 @@ fn read_crates(sess: session::session, crate: ast::crate) {\n                                    visit_item: bind visit_item(e, _)\n                                       with *visit::default_simple_visitor()});\n     visit::visit_crate(crate, (), v);\n+    dump_crates(e.crate_cache);\n     warn_if_multiple_versions(sess, copy e.crate_cache);\n }\n \n@@ -38,6 +39,21 @@ type cache_entry = {\n     metas: @[@ast::meta_item]\n };\n \n+fn dump_crates(crate_cache: [cache_entry]) {\n+    #debug(\"resolved crates:\");\n+    for crate_cache.each {|entry|\n+        #debug(\"cnum: %?\", entry.cnum);\n+        #debug(\"span: %?\", entry.span);\n+        #debug(\"hash: %?\", entry.hash);\n+        let attrs = [\n+            attr::mk_attr(attr::mk_list_item(\"link\", *entry.metas))\n+        ];\n+        for attr::find_linkage_attrs(attrs).each {|attr|\n+            #debug(\"meta: %s\", pprust::attr_to_str(attr));\n+        }\n+    }\n+}\n+\n fn warn_if_multiple_versions(sess: session::session,\n                              crate_cache: [cache_entry]) {\n     import either::*;\n@@ -78,6 +94,7 @@ type env = @{sess: session::session,\n fn visit_view_item(e: env, i: @ast::view_item) {\n     alt i.node {\n       ast::view_item_use(ident, meta_items, id) {\n+        #debug(\"resolving use stmt. ident: %?, meta: %?\", ident, meta_items);\n         let cnum = resolve_crate(e, ident, meta_items, \"\", i.span);\n         cstore::add_use_stmt_cnum(e.sess.cstore, id, cnum);\n       }"}]}