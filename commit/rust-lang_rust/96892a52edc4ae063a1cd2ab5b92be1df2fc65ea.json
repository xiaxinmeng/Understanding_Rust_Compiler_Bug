{"sha": "96892a52edc4ae063a1cd2ab5b92be1df2fc65ea", "node_id": "C_kwDOAAsO6NoAKDk2ODkyYTUyZWRjNGFlMDYzYTFjZDJhYjViOTJiZTFkZjJmYzY1ZWE", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2023-06-01T16:29:18Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2023-06-01T16:29:18Z"}, "message": "Fix bug where private item with intermediate doc hidden re-export was not inlined", "tree": {"sha": "acab3bc7d5f5523b35135efa2c5ba4875aa15991", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/acab3bc7d5f5523b35135efa2c5ba4875aa15991"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea", "html_url": "https://github.com/rust-lang/rust/commit/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fabf9298633ca64450fa2af535252dc44a3b1080", "url": "https://api.github.com/repos/rust-lang/rust/commits/fabf9298633ca64450fa2af535252dc44a3b1080", "html_url": "https://github.com/rust-lang/rust/commit/fabf9298633ca64450fa2af535252dc44a3b1080"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "60da1d6577490703746f926629d983a8a34d8422", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=96892a52edc4ae063a1cd2ab5b92be1df2fc65ea", "patch": "@@ -2180,7 +2180,8 @@ fn get_all_import_attributes<'hir>(\n             // This is the \"original\" reexport so we get all its attributes without filtering them.\n             attrs = import_attrs.iter().map(|attr| (Cow::Borrowed(attr), Some(def_id))).collect();\n             first = false;\n-        } else {\n+        // We don't add attributes of an intermediate re-export if it has `#[doc(hidden)]`.\n+        } else if !cx.tcx.is_doc_hidden(def_id) {\n             add_without_unwanted_attributes(&mut attrs, import_attrs, is_inline, Some(def_id));\n         }\n     }"}, {"sha": "1689445b9ef7c6baffe5329be86c6e679b75f751", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96892a52edc4ae063a1cd2ab5b92be1df2fc65ea/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=96892a52edc4ae063a1cd2ab5b92be1df2fc65ea", "patch": "@@ -246,7 +246,7 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n         glob: bool,\n         please_inline: bool,\n     ) -> bool {\n-        debug!(\"maybe_inline_local res: {:?}\", res);\n+        debug!(\"maybe_inline_local (renamed: {renamed:?}) res: {res:?}\");\n \n         if renamed == Some(kw::Underscore) {\n             // We never inline `_` reexports.\n@@ -308,6 +308,7 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n                     .cache\n                     .effective_visibilities\n                     .is_directly_public(tcx, item_def_id.to_def_id()) &&\n+                !tcx.is_doc_hidden(item_def_id) &&\n                 !inherits_doc_hidden(tcx, item_def_id, None)\n             {\n                 // The imported item is public and not `doc(hidden)` so no need to inline it."}]}