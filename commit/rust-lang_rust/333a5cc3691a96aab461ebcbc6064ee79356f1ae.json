{"sha": "333a5cc3691a96aab461ebcbc6064ee79356f1ae", "node_id": "C_kwDOAAsO6NoAKDMzM2E1Y2MzNjkxYTk2YWFiNDYxZWJjYmM2MDY0ZWU3OTM1NmYxYWU", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2021-12-27T12:09:20Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2022-01-08T03:53:13Z"}, "message": "mangling_v0: Skip extern blocks during mangling", "tree": {"sha": "2c04ee555d77447a5a31621badf49e336edce551", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2c04ee555d77447a5a31621badf49e336edce551"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/333a5cc3691a96aab461ebcbc6064ee79356f1ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/333a5cc3691a96aab461ebcbc6064ee79356f1ae", "html_url": "https://github.com/rust-lang/rust/commit/333a5cc3691a96aab461ebcbc6064ee79356f1ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/333a5cc3691a96aab461ebcbc6064ee79356f1ae/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b8daf8c58267a5d9fae2021a311dfbbda11b02f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b8daf8c58267a5d9fae2021a311dfbbda11b02f", "html_url": "https://github.com/rust-lang/rust/commit/1b8daf8c58267a5d9fae2021a311dfbbda11b02f"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "fbb9e28d182f83a3aab7bd32d8e9112892afbfdf", "filename": "compiler/rustc_symbol_mangling/src/v0.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/333a5cc3691a96aab461ebcbc6064ee79356f1ae/compiler%2Frustc_symbol_mangling%2Fsrc%2Fv0.rs", "raw_url": "https://github.com/rust-lang/rust/raw/333a5cc3691a96aab461ebcbc6064ee79356f1ae/compiler%2Frustc_symbol_mangling%2Fsrc%2Fv0.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_symbol_mangling%2Fsrc%2Fv0.rs?ref=333a5cc3691a96aab461ebcbc6064ee79356f1ae", "patch": "@@ -771,9 +771,9 @@ impl<'tcx> Printer<'tcx> for &mut SymbolMangler<'tcx> {\n         disambiguated_data: &DisambiguatedDefPathData,\n     ) -> Result<Self::Path, Self::Error> {\n         let ns = match disambiguated_data.data {\n-            // FIXME: It shouldn't be necessary to add anything for extern block segments,\n-            // but we add 't' for backward compatibility.\n-            DefPathData::ForeignMod => 't',\n+            // Extern block segments can be skipped, names from extern blocks\n+            // are effectively living in their parent modules.\n+            DefPathData::ForeignMod => return print_prefix(self),\n \n             // Uppercase categories are more stable than lowercase ones.\n             DefPathData::TypeNs(_) => 't',"}, {"sha": "8f5b07769caff860f7b25d69278f101ef957ac8d", "filename": "src/test/ui/symbol-names/foreign-types.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/333a5cc3691a96aab461ebcbc6064ee79356f1ae/src%2Ftest%2Fui%2Fsymbol-names%2Fforeign-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/333a5cc3691a96aab461ebcbc6064ee79356f1ae/src%2Ftest%2Fui%2Fsymbol-names%2Fforeign-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fforeign-types.rs?ref=333a5cc3691a96aab461ebcbc6064ee79356f1ae", "patch": "@@ -1,5 +1,5 @@\n // build-fail\n-// compile-flags: -Z symbol-mangling-version=v0\n+// compile-flags: -C symbol-mangling-version=v0\n \n #![feature(extern_types)]\n #![feature(rustc_attrs)]"}, {"sha": "fcffdd2a8ec15f148e496e4ae0a2cbc754929492", "filename": "src/test/ui/symbol-names/foreign-types.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/333a5cc3691a96aab461ebcbc6064ee79356f1ae/src%2Ftest%2Fui%2Fsymbol-names%2Fforeign-types.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/333a5cc3691a96aab461ebcbc6064ee79356f1ae/src%2Ftest%2Fui%2Fsymbol-names%2Fforeign-types.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fforeign-types.stderr?ref=333a5cc3691a96aab461ebcbc6064ee79356f1ae", "patch": "@@ -1,4 +1,4 @@\n-error: symbol-name(_RMCsCRATE_HASH_13foreign_typesINtB<REF>_5CheckNvNtB<REF>_011ForeignTypeE)\n+error: symbol-name(_RMCsCRATE_HASH_13foreign_typesINtB<REF>_5CheckNvB<REF>_11ForeignTypeE)\n   --> $DIR/foreign-types.rs:13:1\n    |\n LL | #[rustc_symbol_name]"}]}