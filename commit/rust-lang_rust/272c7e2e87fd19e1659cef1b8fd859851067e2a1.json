{"sha": "272c7e2e87fd19e1659cef1b8fd859851067e2a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3MmM3ZTJlODdmZDE5ZTE2NTljZWYxYjhmZDg1OTg1MTA2N2UyYTE=", "commit": {"author": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2011-06-15T01:51:35Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-06-16T18:47:54Z"}, "message": "Translate the swap operator.", "tree": {"sha": "ce639a0e449accca0795a2a89a0354d934d446db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce639a0e449accca0795a2a89a0354d934d446db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/272c7e2e87fd19e1659cef1b8fd859851067e2a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/272c7e2e87fd19e1659cef1b8fd859851067e2a1", "html_url": "https://github.com/rust-lang/rust/commit/272c7e2e87fd19e1659cef1b8fd859851067e2a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/272c7e2e87fd19e1659cef1b8fd859851067e2a1/comments", "author": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc33a5fe50f1bd4dd0e64b7e2e18d1b4bba1900e", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc33a5fe50f1bd4dd0e64b7e2e18d1b4bba1900e", "html_url": "https://github.com/rust-lang/rust/commit/bc33a5fe50f1bd4dd0e64b7e2e18d1b4bba1900e"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "df8743214a78b32d0e3ade3aaa46dfde752bd5db", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/272c7e2e87fd19e1659cef1b8fd859851067e2a1/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/272c7e2e87fd19e1659cef1b8fd859851067e2a1/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=272c7e2e87fd19e1659cef1b8fd859851067e2a1", "patch": "@@ -5585,6 +5585,24 @@ fn trans_expr_out(&@block_ctxt cx, &@ast::expr e, out_method output) ->\n                          rhs_res.val, t);\n             ret res(copy_res.bcx, C_nil());\n         }\n+        case (ast::expr_swap(?dst, ?src, _)) {\n+            auto lhs_res = trans_lval(cx, dst);\n+            assert (lhs_res.is_mem);\n+            // FIXME Fill in lhs_res.res.bcx.sp\n+\n+            auto rhs_res = trans_lval(lhs_res.res.bcx, src);\n+            auto t = ty::expr_ty(cx.fcx.lcx.ccx.tcx, src);\n+            auto tmp_res = alloc_ty(rhs_res.res.bcx, t);\n+\n+            // Swap through a temporary.\n+            auto move1_res = memmove_ty(tmp_res.bcx, tmp_res.val,\n+                                        lhs_res.res.val, t);\n+            auto move2_res = memmove_ty(move1_res.bcx, lhs_res.res.val,\n+                                        rhs_res.res.val, t);\n+            auto move3_res = memmove_ty(move2_res.bcx, rhs_res.res.val,\n+                                        tmp_res.val, t);\n+            ret res(move3_res.bcx, C_nil());\n+        }\n         case (ast::expr_assign_op(?op, ?dst, ?src, _)) {\n             auto t = ty::expr_ty(cx.fcx.lcx.ccx.tcx, src);\n             auto lhs_res = trans_lval(cx, dst);"}]}