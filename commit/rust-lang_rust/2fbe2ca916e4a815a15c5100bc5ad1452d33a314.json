{"sha": "2fbe2ca916e4a815a15c5100bc5ad1452d33a314", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmYmUyY2E5MTZlNGE4MTVhMTVjNTEwMGJjNWFkMTQ1MmQzM2EzMTQ=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-06-05T16:47:10Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-06-05T16:47:10Z"}, "message": "Simplify commit check", "tree": {"sha": "fce88e0a3b0b6bc123ff56a12aa76b13f6970185", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fce88e0a3b0b6bc123ff56a12aa76b13f6970185"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2fbe2ca916e4a815a15c5100bc5ad1452d33a314", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2fbe2ca916e4a815a15c5100bc5ad1452d33a314", "html_url": "https://github.com/rust-lang/rust/commit/2fbe2ca916e4a815a15c5100bc5ad1452d33a314", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2fbe2ca916e4a815a15c5100bc5ad1452d33a314/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "28d0d0c38b791bf60a83b34e7bb3eec165a2734c", "url": "https://api.github.com/repos/rust-lang/rust/commits/28d0d0c38b791bf60a83b34e7bb3eec165a2734c", "html_url": "https://github.com/rust-lang/rust/commit/28d0d0c38b791bf60a83b34e7bb3eec165a2734c"}], "stats": {"total": 37, "additions": 15, "deletions": 22}, "files": [{"sha": "7632889689f3644fcd3a7022a0966e168a8377c8", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 15, "deletions": 22, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/2fbe2ca916e4a815a15c5100bc5ad1452d33a314/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fbe2ca916e4a815a15c5100bc5ad1452d33a314/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=2fbe2ca916e4a815a15c5100bc5ad1452d33a314", "patch": "@@ -107,33 +107,26 @@ pub(crate) fn update_llvm_submodule(build: &Build) {\n     }\n \n     // check_submodule\n-    let buf;\n-    let checked_out = if build.config.fast_submodules {\n-        buf = output(\n+    if build.config.fast_submodules {\n+        let checked_out_hash = output(\n             Command::new(\"git\")\n                 .args(&[\"rev-parse\", \"HEAD\"])\n                 .current_dir(build.config.src.join(llvm_project)),\n         );\n-        Some(buf.trim_end())\n-    } else {\n-        None\n-    };\n+        // update_submodules\n+        let recorded = output(\n+            Command::new(\"git\")\n+                .args(&[\"ls-tree\", \"HEAD\"])\n+                .arg(llvm_project)\n+                .current_dir(&build.config.src),\n+        );\n+        let actual_hash = recorded\n+            .split_whitespace()\n+            .nth(2)\n+            .unwrap_or_else(|| panic!(\"unexpected output `{}`\", recorded));\n \n-    // update_submodules\n-    let recorded = output(\n-        Command::new(\"git\")\n-            .args(&[\"ls-tree\", \"HEAD\"])\n-            .arg(llvm_project)\n-            .current_dir(&build.config.src),\n-    );\n-    let hash = recorded\n-        .split_whitespace()\n-        .nth(2)\n-        .unwrap_or_else(|| panic!(\"unexpected output `{}`\", recorded));\n-\n-    // update_submodule\n-    if let Some(llvm_hash) = checked_out {\n-        if hash == llvm_hash {\n+        // update_submodule\n+        if actual_hash == checked_out_hash.trim_end() {\n             // already checked out\n             return;\n         }"}]}