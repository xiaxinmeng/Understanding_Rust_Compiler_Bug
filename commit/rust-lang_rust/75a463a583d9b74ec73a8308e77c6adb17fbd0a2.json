{"sha": "75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "node_id": "C_kwDOAAsO6NoAKDc1YTQ2M2E1ODNkOWI3NGVjNzNhODMwOGU3N2M2YWRiMTdmYmQwYTI", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2022-02-08T17:24:50Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2022-02-08T17:24:50Z"}, "message": "Update Cranelift to 0.81.0", "tree": {"sha": "43a29eec1a02cb7b766828e2931d3bf2bd5ff092", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/43a29eec1a02cb7b766828e2931d3bf2bd5ff092"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "html_url": "https://github.com/rust-lang/rust/commit/75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "583333a2b2d50219580a2a0b8553b87b954d2df7", "url": "https://api.github.com/repos/rust-lang/rust/commits/583333a2b2d50219580a2a0b8553b87b954d2df7", "html_url": "https://github.com/rust-lang/rust/commit/583333a2b2d50219580a2a0b8553b87b954d2df7"}], "stats": {"total": 84, "additions": 33, "deletions": 51}, "files": [{"sha": "f15e319e3b80709b1a335215e499656a3f10132d", "filename": "Cargo.lock", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "patch": "@@ -33,18 +33,18 @@ checksum = \"baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd\"\n \n [[package]]\n name = \"cranelift-bforest\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9516ba6b2ba47b4cbf63b713f75b432fafa0a0e0464ec8381ec76e6efe931ab3\"\n+checksum = \"71447555acc6c875c52c407d572fc1327dc5c34cba72b4b2e7ad048aa4e4fd19\"\n dependencies = [\n  \"cranelift-entity\",\n ]\n \n [[package]]\n name = \"cranelift-codegen\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"489e5d0081f7edff6be12d71282a8bf387b5df64d5592454b75d662397f2d642\"\n+checksum = \"ec9a10261891a7a919b0d4f6aa73582e88441d9a8f6173c88efbe4a5a362ea67\"\n dependencies = [\n  \"cranelift-bforest\",\n  \"cranelift-codegen-meta\",\n@@ -59,30 +59,30 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-codegen-meta\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"d36ee1140371bb0f69100e734b30400157a4adf7b86148dee8b0a438763ead48\"\n+checksum = \"815755d76fcbcf6e17ab888545b28ab775f917cb12ce0797e60cd41a2288692c\"\n dependencies = [\n  \"cranelift-codegen-shared\",\n ]\n \n [[package]]\n name = \"cranelift-codegen-shared\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"981da52d8f746af1feb96290c83977ff8d41071a7499e991d8abae0d4869f564\"\n+checksum = \"23ea92f2a67335a2e4d3c9c65624c3b14ae287d595b0650822c41824febab66b\"\n \n [[package]]\n name = \"cranelift-entity\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a2906740053dd3bcf95ce53df0fd9b5649c68ae4bd9adada92b406f059eae461\"\n+checksum = \"bd25847875e388c500ad3624b4d2e14067955c93185194a7222246a25b91c975\"\n \n [[package]]\n name = \"cranelift-frontend\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"b7cb156de1097f567d46bf57a0cd720a72c3e15e1a2bd8b1041ba2fc894471b7\"\n+checksum = \"308bcfb7eb47bdf5ff6e1ace262af4ed39ec19f204c751fffb037e0e82a0c8bf\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"log\",\n@@ -92,9 +92,9 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-jit\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"8e0f0e20dbcac1e6c3caef955e004598a9a6a5f310e591e2c629ec15c7fa6bfa\"\n+checksum = \"f560b3a314b8d15facf411e5d29b917c3e787a2bbc3fcdc5183bc0c5b7d4fe01\"\n dependencies = [\n  \"anyhow\",\n  \"cranelift-codegen\",\n@@ -110,19 +110,19 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-module\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"93460fc789770f2a63163bfb5f2b851635ce29d91526f2e96854bcc4ed53a778\"\n+checksum = \"3a57aba9e603d694d1430ff38bd914bae23ef9c2e44b25a65e318905807e654c\"\n dependencies = [\n  \"anyhow\",\n  \"cranelift-codegen\",\n ]\n \n [[package]]\n name = \"cranelift-native\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"166028ca0343a6ee7bddac0e70084e142b23f99c701bd6f6ea9123afac1a7a46\"\n+checksum = \"12cdc799aee673be2317e631d4569a1ba0a7e77a07a7ce45557086d2e02e9514\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"libc\",\n@@ -131,9 +131,9 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-object\"\n-version = \"0.80.0\"\n+version = \"0.81.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"263618594523ad29349fd43d93bfeb04d2bbdfd5df9fcf04190582dbdcff3220\"\n+checksum = \"502a7333836052fcdf4425d7f7a21264d99f862d32b9c3a0e47cd920487a9b60\"\n dependencies = [\n  \"anyhow\",\n  \"cranelift-codegen\",\n@@ -230,9 +230,9 @@ dependencies = [\n \n [[package]]\n name = \"regalloc\"\n-version = \"0.0.33\"\n+version = \"0.0.34\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7d808cff91dfca7b239d40b972ba628add94892b1d9e19a842aedc5cfae8ab1a\"\n+checksum = \"62446b1d3ebf980bdc68837700af1d77b37bc430e524bf95319c6eada2a4cc02\"\n dependencies = [\n  \"log\",\n  \"rustc-hash\","}, {"sha": "178404af42d677406b189edeb1e047d566fe7c30", "filename": "Cargo.toml", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "patch": "@@ -8,12 +8,12 @@ crate-type = [\"dylib\"]\n \n [dependencies]\n # These have to be in sync with each other\n-cranelift-codegen = { version = \"0.80.0\", features = [\"unwind\", \"all-arch\"] }\n-cranelift-frontend = \"0.80.0\"\n-cranelift-module = \"0.80.0\"\n-cranelift-native = \"0.80.0\"\n-cranelift-jit = { version = \"0.80.0\", optional = true }\n-cranelift-object = \"0.80.0\"\n+cranelift-codegen = { version = \"0.81.0\", features = [\"unwind\", \"all-arch\"] }\n+cranelift-frontend = \"0.81.0\"\n+cranelift-module = \"0.81.0\"\n+cranelift-native = \"0.81.0\"\n+cranelift-jit = { version = \"0.81.0\", optional = true }\n+cranelift-object = \"0.81.0\"\n target-lexicon = \"0.12.0\"\n gimli = { version = \"0.26.0\", default-features = false, features = [\"write\"]}\n object = { version = \"0.27.0\", default-features = false, features = [\"std\", \"read_core\", \"write\", \"archive\", \"coff\", \"elf\", \"macho\", \"pe\"] }"}, {"sha": "82247b47888e77f2021a6f328a34d347c577000f", "filename": "src/allocator.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fallocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fallocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fallocator.rs?ref=75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "patch": "@@ -3,7 +3,6 @@\n \n use crate::prelude::*;\n \n-use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_ast::expand::allocator::{AllocatorKind, AllocatorTy, ALLOCATOR_METHODS};\n \n /// Returns whether an allocator shim was created\n@@ -91,9 +90,7 @@ fn codegen_inner(\n             bcx.seal_all_blocks();\n             bcx.finalize();\n         }\n-        module\n-            .define_function(func_id, &mut ctx, &mut NullTrapSink {}, &mut NullStackMapSink {})\n-            .unwrap();\n+        module.define_function(func_id, &mut ctx).unwrap();\n         unwind_context.add_function(func_id, &ctx, module.isa());\n     }\n \n@@ -130,8 +127,6 @@ fn codegen_inner(\n         bcx.seal_all_blocks();\n         bcx.finalize();\n     }\n-    module\n-        .define_function(func_id, &mut ctx, &mut NullTrapSink {}, &mut NullStackMapSink {})\n-        .unwrap();\n+    module.define_function(func_id, &mut ctx).unwrap();\n     unwind_context.add_function(func_id, &ctx, module.isa());\n }"}, {"sha": "1dc9cbda2d5eb6fa34e1117e678637daf8bb9d96", "filename": "src/base.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "patch": "@@ -1,6 +1,5 @@\n //! Codegen of a single function\n \n-use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_ast::InlineAsmOptions;\n use rustc_index::vec::IndexVec;\n use rustc_middle::ty::adjustment::PointerCast;\n@@ -175,9 +174,7 @@ fn compile_fn<'tcx>(\n     // Define function\n     tcx.sess.time(\"define function\", || {\n         context.want_disasm = crate::pretty_clif::should_write_ir(tcx);\n-        module\n-            .define_function(func_id, context, &mut NullTrapSink {}, &mut NullStackMapSink {})\n-            .unwrap()\n+        module.define_function(func_id, context).unwrap()\n     });\n \n     // Write optimized function to file for debugging"}, {"sha": "9e07528313dd8911d2f5cd2056818afe8ab646c1", "filename": "src/driver/jit.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fdriver%2Fjit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fdriver%2Fjit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver%2Fjit.rs?ref=75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "patch": "@@ -7,7 +7,6 @@ use std::lazy::SyncOnceCell;\n use std::os::raw::{c_char, c_int};\n use std::sync::{mpsc, Mutex};\n \n-use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_codegen_ssa::CrateInfo;\n use rustc_middle::mir::mono::MonoItem;\n use rustc_session::Session;\n@@ -381,12 +380,5 @@ fn codegen_shim<'tcx>(cx: &mut CodegenCx<'tcx>, module: &mut JITModule, inst: In\n     let ret_vals = trampoline_builder.func.dfg.inst_results(call_inst).to_vec();\n     trampoline_builder.ins().return_(&ret_vals);\n \n-    module\n-        .define_function(\n-            func_id,\n-            &mut cx.cached_context,\n-            &mut NullTrapSink {},\n-            &mut NullStackMapSink {},\n-        )\n-        .unwrap();\n+    module.define_function(func_id, &mut cx.cached_context).unwrap();\n }"}, {"sha": "9ce727279c27c876095a3e41f01698800ee57609", "filename": "src/main_shim.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fmain_shim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75a463a583d9b74ec73a8308e77c6adb17fbd0a2/src%2Fmain_shim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain_shim.rs?ref=75a463a583d9b74ec73a8308e77c6adb17fbd0a2", "patch": "@@ -1,4 +1,3 @@\n-use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_hir::LangItem;\n use rustc_middle::ty::subst::GenericArg;\n use rustc_middle::ty::AssocKind;\n@@ -152,8 +151,7 @@ pub(crate) fn maybe_create_entry_wrapper(\n             bcx.seal_all_blocks();\n             bcx.finalize();\n         }\n-        m.define_function(cmain_func_id, &mut ctx, &mut NullTrapSink {}, &mut NullStackMapSink {})\n-            .unwrap();\n+        m.define_function(cmain_func_id, &mut ctx).unwrap();\n         unwind_context.add_function(cmain_func_id, &ctx, m.isa());\n     }\n }"}]}