{"sha": "6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmOWIzMGM2YzExYjA1ZmRiMjk5YmNhYjk3YjUwMDJhODEzYzBiYWM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-26T01:18:57Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-26T04:35:10Z"}, "message": "configure: Make rustlibdir non-configurable\n\nTrying to reduce the complexity of installation", "tree": {"sha": "4abd955727b4010d5bac1b9a69e4df7ce6d4dfbf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4abd955727b4010d5bac1b9a69e4df7ce6d4dfbf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "html_url": "https://github.com/rust-lang/rust/commit/6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e509cd6e2bb4157bdad682a4c76e47da9bedf2c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/e509cd6e2bb4157bdad682a4c76e47da9bedf2c5", "html_url": "https://github.com/rust-lang/rust/commit/e509cd6e2bb4157bdad682a4c76e47da9bedf2c5"}], "stats": {"total": 25, "additions": 11, "deletions": 14}, "files": [{"sha": "e875a9a09230923044213d4bf6dcb4497206c6ba", "filename": "configure", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/configure", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -401,7 +401,8 @@ valopt infodir \"${CFG_PREFIX}/share/info\" \"install additional info\"\n valopt mandir \"${CFG_PREFIX}/share/man\" \"install man pages in PATH\"\n \n # On windows we just store the libraries in the bin directory because\n-# there's no rpath\n+# there's no rpath. This is where the build system itself puts libraries;\n+# --libdir is used to configure the installation directory.\n # FIXME: Thise needs to parameterized over target triples. Do it in platform.mk\n CFG_LIBDIR_RELATIVE=lib\n if [ \"$CFG_OSTYPE\" = \"pc-mingw32\" ]\n@@ -410,7 +411,6 @@ then\n fi\n \n valopt libdir \"${CFG_PREFIX}/${CFG_LIBDIR_RELATIVE}\" \"install libraries\"\n-valopt rustlibdir \"rustlib\" \"subdirectory name for rustc's libraries\"\n \n if [ $HELP -eq 1 ]\n then\n@@ -777,10 +777,10 @@ do\n             make_dir $h/stage$i/test\n \n             # target bin dir\n-            make_dir $h/stage$i/$CFG_LIBDIR_RELATIVE/$CFG_RUSTLIBDIR/$t/bin\n+            make_dir $h/stage$i/$CFG_LIBDIR_RELATIVE/rustlib/$t/bin\n \n             # target lib dir\n-            make_dir $h/stage$i/$CFG_LIBDIR_RELATIVE/$CFG_RUSTLIBDIR/$t/lib\n+            make_dir $h/stage$i/$CFG_LIBDIR_RELATIVE/rustlib/$t/lib\n         done\n     done\n \n@@ -1039,7 +1039,6 @@ putvar CFG_HOST\n putvar CFG_TARGET\n putvar CFG_C_COMPILER\n putvar CFG_LIBDIR\n-putvar CFG_RUSTLIBDIR\n putvar CFG_LIBDIR_RELATIVE\n putvar CFG_DISABLE_MANAGE_SUBMODULES\n putvar CFG_ANDROID_CROSS_PATH"}, {"sha": "60549e299cce2375bb27a1488bad3f519ed2d522", "filename": "mk/dist.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -200,7 +200,7 @@ dist-install-dir-$(1): PREPARE_MAN_CMD=$(DEFAULT_PREPARE_MAN_CMD)\n dist-install-dir-$(1): PREPARE_CLEAN=true\n dist-install-dir-$(1): prepare-base-dir-$(1)\n \t$$(Q)(cd $$(PREPARE_DEST_DIR)/ && find -type f | sed 's/^\\.\\///') \\\n-      > $$(PREPARE_DEST_DIR)/$$(CFG_LIBDIR_RELATIVE)/$$(CFG_RUSTLIBDIR)/manifest\n+      > $$(PREPARE_DEST_DIR)/$$(CFG_LIBDIR_RELATIVE)/rustlib/manifest\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)COPYRIGHT $$(PREPARE_DEST_DIR)\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)LICENSE-APACHE $$(PREPARE_DEST_DIR)\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)LICENSE-MIT $$(PREPARE_DEST_DIR)"}, {"sha": "38943f1f7739fabf5e373d6fe3735644a6d045f9", "filename": "mk/main.mk", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -281,7 +281,6 @@ export CFG_LLVM_ROOT\n export CFG_ENABLE_MINGW_CROSS\n export CFG_PREFIX\n export CFG_LIBDIR\n-export CFG_RUSTLIBDIR\n export CFG_LIBDIR_RELATIVE\n export CFG_DISABLE_INJECT_STD_VERSION\n \n@@ -302,7 +301,7 @@ HBIN$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/bin\n HLIB$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/$$(CFG_LIBDIR_RELATIVE)\n \n # Destinations of artifacts for target architectures\n-TROOT$(1)_T_$(2)_H_$(3) = $$(HLIB$(1)_H_$(3))/$$(CFG_RUSTLIBDIR)/$(2)\n+TROOT$(1)_T_$(2)_H_$(3) = $$(HLIB$(1)_H_$(3))/rustlib/$(2)\n TBIN$(1)_T_$(2)_H_$(3) = $$(TROOT$(1)_T_$(2)_H_$(3))/bin\n TLIB$(1)_T_$(2)_H_$(3) = $$(TROOT$(1)_T_$(2)_H_$(3))/lib\n "}, {"sha": "ae76ecc594ce41cda5ed2a545e20920dceb35341", "filename": "mk/prepare.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fprepare.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fprepare.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fprepare.mk?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -121,8 +121,8 @@ endef\n # $(4) tag\n define DEF_PREPARE_TARGET_N\n # Rebind PREPARE_*_LIB_DIR to point to rustlib, then install the libs for the targets\n-prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_WORKING_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_LIB_DIR)/$$(CFG_RUSTLIBDIR)/$(2)/lib\n-prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_LIB_DIR)/$$(CFG_RUSTLIBDIR)/$(2)/lib\n+prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_WORKING_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_LIB_DIR)/rustlib/$(2)/lib\n+prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_LIB_DIR)/rustlib/$(2)/lib\n prepare-target-$(2)-host-$(3)-$(1)-$(4): prepare-maybe-clean-$(4) \\\n         $$(foreach crate,$$(TARGET_CRATES), \\\n           $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate)) \\"}, {"sha": "080e733724d46f4f2f7f079208deaa35eddf7c24", "filename": "mk/stage0.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fstage0.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Fstage0.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fstage0.mk?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -15,7 +15,7 @@ $(SNAPSHOT_RUSTC_POST_CLEANUP):\t\t\t\t\t\t\\\n #   Note: the variable \"SNAPSHOT_FILE\" is generally not set, and so\n #   we generally only pass one argument to this script.\n ifdef CFG_ENABLE_LOCAL_RUST\n-\t$(Q)$(S)src/etc/local_stage0.sh $(CFG_BUILD) $(CFG_LOCAL_RUST_ROOT) $(CFG_RUSTLIBDIR)\n+\t$(Q)$(S)src/etc/local_stage0.sh $(CFG_BUILD) $(CFG_LOCAL_RUST_ROOT) rustlib\n else\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/get-snapshot.py $(CFG_BUILD) $(SNAPSHOT_FILE)\n ifdef CFG_ENABLE_PAX_FLAGS"}, {"sha": "b0ae685faa899e649777fe44579b0d553e41c325", "filename": "mk/tests.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -104,7 +104,7 @@ ifdef CFG_WINDOWSY_$(1)\n                stage2/$$(CFG_LIBDIR_RELATIVE), \\\n                $$(if $$(findstring stage3,$$(1)), \\\n                     stage3/$$(CFG_LIBDIR_RELATIVE), \\\n-               )))))/$$(CFG_RUSTLIBDIR)/$$(CFG_BUILD)/lib\n+               )))))/rustlib/$$(CFG_BUILD)/lib\n   CFG_RUN_TEST_$(1)=$$(call CFG_RUN_$(1),$$(call CFG_TESTLIB_$(1),$$(1),$$(3)),$$(1))\n endif\n "}, {"sha": "e6d20b932b39ef7fd795c1f23965ae6852f77c72", "filename": "src/etc/install.sh", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/src%2Fetc%2Finstall.sh", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/src%2Fetc%2Finstall.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Finstall.sh?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -237,7 +237,6 @@ need_ok \"failed to remove install probe\"\n \n # First, uninstall from the installation prefix.\n # Errors are warnings - try to rm everything in the manifest even if some fail.\n-# FIXME: Hardcoded 'rustlib' ignores CFG_RUSTLIBDIR\n if [ -f \"${CFG_PREFIX}/lib/rustlib/manifest\" ]\n then\n     # Iterate through installed manifest and remove files"}, {"sha": "31252ab4f82af68aa12e6c87177e6b5490ba3c67", "filename": "src/librustc/metadata/filesearch.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/src%2Flibrustc%2Fmetadata%2Ffilesearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f9b30c6c11b05fdb299bcab97b5002a813c0bac/src%2Flibrustc%2Fmetadata%2Ffilesearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Ffilesearch.rs?ref=6f9b30c6c11b05fdb299bcab97b5002a813c0bac", "patch": "@@ -242,5 +242,5 @@ pub fn libdir() -> ~str {\n // The name of rustc's own place to organize libraries.\n // Used to be \"rustc\", now the default is \"rustlib\"\n pub fn rustlibdir() -> ~str {\n-    (env!(\"CFG_RUSTLIBDIR\")).to_owned()\n+    ~\"rustlib\"\n }"}]}