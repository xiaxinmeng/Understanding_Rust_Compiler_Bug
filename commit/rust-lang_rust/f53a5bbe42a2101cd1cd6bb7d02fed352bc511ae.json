{"sha": "f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY1M2E1YmJlNDJhMjEwMWNkMWNkNmJiN2QwMmZlZDM1MmJjNTExYWU=", "commit": {"author": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2016-02-09T21:58:58Z"}, "committer": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2016-02-09T21:58:58Z"}, "message": "Rollup merge of #31473 - raindev:error-handling-case-study, r=steveklabnik\n\nRemove unnecessary cloning and conversions. Expand tab characters left in code examples.", "tree": {"sha": "f13e52536ad399a643e148c9074e5c218a45e986", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f13e52536ad399a643e148c9074e5c218a45e986"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae", "html_url": "https://github.com/rust-lang/rust/commit/f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae/comments", "author": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fc1c1183f32810a5b61ee9ee27a5683f14737994", "url": "https://api.github.com/repos/rust-lang/rust/commits/fc1c1183f32810a5b61ee9ee27a5683f14737994", "html_url": "https://github.com/rust-lang/rust/commit/fc1c1183f32810a5b61ee9ee27a5683f14737994"}, {"sha": "422cf2d34a1ec50a66ac71fd1f68ccf3ce0e38fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/422cf2d34a1ec50a66ac71fd1f68ccf3ce0e38fb", "html_url": "https://github.com/rust-lang/rust/commit/422cf2d34a1ec50a66ac71fd1f68ccf3ce0e38fb"}], "stats": {"total": 89, "additions": 44, "deletions": 45}, "files": [{"sha": "affea7926a2f92524ed3e3bfe32ab30848cc5bae", "filename": "src/doc/book/error-handling.md", "status": "modified", "additions": 44, "deletions": 45, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae/src%2Fdoc%2Fbook%2Ferror-handling.md", "raw_url": "https://github.com/rust-lang/rust/raw/f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae/src%2Fdoc%2Fbook%2Ferror-handling.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fbook%2Ferror-handling.md?ref=f53a5bbe42a2101cd1cd6bb7d02fed352bc511ae", "patch": "@@ -1592,7 +1592,7 @@ fn print_usage(program: &str, opts: Options) {\n \n fn main() {\n     let args: Vec<String> = env::args().collect();\n-    let program = args[0].clone();\n+    let program = &args[0];\n \n     let mut opts = Options::new();\n     opts.optflag(\"h\", \"help\", \"Show this usage message.\");\n@@ -1605,10 +1605,10 @@ fn main() {\n         print_usage(&program, opts);\n         return;\n     }\n-    let data_path = args[1].clone();\n-    let city = args[2].clone();\n+    let data_path = &args[1];\n+    let city = &args[2];\n \n-\t// Do stuff with information\n+    // Do stuff with information\n }\n ```\n \n@@ -1640,7 +1640,6 @@ sure to add `extern crate csv;` to the top of your file.)\n \n ```rust,ignore\n use std::fs::File;\n-use std::path::Path;\n \n // This struct represents the data in each row of the CSV file.\n // Type based decoding absolves us of a lot of the nitty gritty error\n@@ -1666,7 +1665,7 @@ fn print_usage(program: &str, opts: Options) {\n \n fn main() {\n     let args: Vec<String> = env::args().collect();\n-    let program = args[0].clone();\n+    let program = &args[0];\n \n     let mut opts = Options::new();\n     opts.optflag(\"h\", \"help\", \"Show this usage message.\");\n@@ -1678,25 +1677,24 @@ fn main() {\n \n     if matches.opt_present(\"h\") {\n         print_usage(&program, opts);\n-\t\treturn;\n-\t}\n+        return;\n+    }\n \n-\tlet data_file = args[1].clone();\n-\tlet data_path = Path::new(&data_file);\n-\tlet city = args[2].clone();\n+    let data_path = &args[1];\n+    let city: &str = &args[2];\n \n-\tlet file = File::open(data_path).unwrap();\n-\tlet mut rdr = csv::Reader::from_reader(file);\n+    let file = File::open(data_path).unwrap();\n+    let mut rdr = csv::Reader::from_reader(file);\n \n-\tfor row in rdr.decode::<Row>() {\n-\t\tlet row = row.unwrap();\n+    for row in rdr.decode::<Row>() {\n+        let row = row.unwrap();\n \n-\t\tif row.city == city {\n-\t\t\tprintln!(\"{}, {}: {:?}\",\n-\t\t\t\trow.city, row.country,\n-\t\t\t\trow.population.expect(\"population count\"));\n-\t\t}\n-\t}\n+        if row.city == city {\n+            println!(\"{}, {}: {:?}\",\n+                row.city, row.country,\n+                row.population.expect(\"population count\"));\n+        }\n+    }\n }\n ```\n \n@@ -1745,6 +1743,8 @@ Note that we opt to handle the possibility of a missing population count by\n simply ignoring that row.\n \n ```rust,ignore\n+use std::path::Path;\n+\n struct Row {\n     // unchanged\n }\n@@ -1782,27 +1782,26 @@ fn search<P: AsRef<Path>>(file_path: P, city: &str) -> Vec<PopulationCount> {\n }\n \n fn main() {\n-\tlet args: Vec<String> = env::args().collect();\n-\tlet program = args[0].clone();\n+    let args: Vec<String> = env::args().collect();\n+    let program = &args[0];\n \n-\tlet mut opts = Options::new();\n-\topts.optflag(\"h\", \"help\", \"Show this usage message.\");\n+    let mut opts = Options::new();\n+    opts.optflag(\"h\", \"help\", \"Show this usage message.\");\n \n-\tlet matches = match opts.parse(&args[1..]) {\n-\t\tOk(m)  => { m }\n-\t\tErr(e) => { panic!(e.to_string()) }\n-\t};\n-\tif matches.opt_present(\"h\") {\n-\t\tprint_usage(&program, opts);\n-\t\treturn;\n-\t}\n+    let matches = match opts.parse(&args[1..]) {\n+        Ok(m)  => { m }\n+        Err(e) => { panic!(e.to_string()) }\n+    };\n+    if matches.opt_present(\"h\") {\n+        print_usage(&program, opts);\n+        return;\n+    }\n \n-\tlet data_file = args[1].clone();\n-\tlet data_path = Path::new(&data_file);\n-\tlet city = args[2].clone();\n-\tfor pop in search(&data_path, &city) {\n-\t\tprintln!(\"{}, {}: {:?}\", pop.city, pop.country, pop.count);\n-\t}\n+    let data_path = &args[1];\n+    let city = &args[2];\n+    for pop in search(data_path, city) {\n+        println!(\"{}, {}: {:?}\", pop.city, pop.country, pop.count);\n+    }\n }\n \n ```\n@@ -1912,7 +1911,7 @@ First, here's the new usage:\n \n ```rust,ignore\n fn print_usage(program: &str, opts: Options) {\n-\tprintln!(\"{}\", opts.usage(&format!(\"Usage: {} [options] <city>\", program)));\n+    println!(\"{}\", opts.usage(&format!(\"Usage: {} [options] <city>\", program)));\n }\n ```\n The next part is going to be only a little harder:\n@@ -1924,16 +1923,16 @@ opts.optopt(\"f\", \"file\", \"Choose an input file, instead of using STDIN.\", \"NAME\"\n opts.optflag(\"h\", \"help\", \"Show this usage message.\");\n ...\n let file = matches.opt_str(\"f\");\n-let data_file = file.as_ref().map(Path::new);\n+let data_file = &file.as_ref().map(Path::new);\n \n let city = if !matches.free.is_empty() {\n-\tmatches.free[0].clone()\n+    &matches.free[0]\n } else {\n-\tprint_usage(&program, opts);\n-\treturn;\n+    print_usage(&program, opts);\n+    return;\n };\n \n-match search(&data_file, &city) {\n+match search(data_file, city) {\n     Ok(pops) => {\n         for pop in pops {\n             println!(\"{}, {}: {:?}\", pop.city, pop.country, pop.count);"}]}