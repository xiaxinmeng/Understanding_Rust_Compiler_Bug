{"sha": "cd241b33cb8379311286f53c4afc6e671ddfded1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkMjQxYjMzY2I4Mzc5MzExMjg2ZjUzYzRhZmM2ZTY3MWRkZmRlZDE=", "commit": {"author": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-05-13T08:24:29Z"}, "committer": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-05-13T08:24:29Z"}, "message": "Trigger `wrong_self_convention` only if it has implicit self", "tree": {"sha": "557a4bbeb566a57bdd11becd7f2714b6036bd02b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/557a4bbeb566a57bdd11becd7f2714b6036bd02b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cd241b33cb8379311286f53c4afc6e671ddfded1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cd241b33cb8379311286f53c4afc6e671ddfded1", "html_url": "https://github.com/rust-lang/rust/commit/cd241b33cb8379311286f53c4afc6e671ddfded1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cd241b33cb8379311286f53c4afc6e671ddfded1/comments", "author": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa15a5442a975180a367373e563b7f8c626b5344", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa15a5442a975180a367373e563b7f8c626b5344", "html_url": "https://github.com/rust-lang/rust/commit/aa15a5442a975180a367373e563b7f8c626b5344"}], "stats": {"total": 66, "additions": 56, "deletions": 10}, "files": [{"sha": "e0d29682146b66f9b3e8b2e0dcbccdad8231081e", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 14, "deletions": 10, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/cd241b33cb8379311286f53c4afc6e671ddfded1/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd241b33cb8379311286f53c4afc6e671ddfded1/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=cd241b33cb8379311286f53c4afc6e671ddfded1", "patch": "@@ -1838,16 +1838,18 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n                     }\n                 }\n \n-                wrong_self_convention::check(\n-                    cx,\n-                    &name,\n-                    item.vis.node.is_pub(),\n-                    self_ty,\n-                    first_arg_ty,\n-                    first_arg.pat.span,\n-                    implements_trait,\n-                    false\n-                );\n+                if sig.decl.implicit_self.has_implicit_self() {\n+                    wrong_self_convention::check(\n+                        cx,\n+                        &name,\n+                        item.vis.node.is_pub(),\n+                        self_ty,\n+                        first_arg_ty,\n+                        first_arg.pat.span,\n+                        implements_trait,\n+                        false\n+                    );\n+                }\n             }\n         }\n \n@@ -1903,7 +1905,9 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n \n         if_chain! {\n             if let TraitItemKind::Fn(ref sig, _) = item.kind;\n+            if sig.decl.implicit_self.has_implicit_self();\n             if let Some(first_arg_ty) = sig.decl.inputs.iter().next();\n+\n             then {\n                 let first_arg_span = first_arg_ty.span;\n                 let first_arg_ty = hir_ty_to_ty(cx.tcx, first_arg_ty);"}, {"sha": "b2c6503de49957738112e1fd7e69a69ac43795c6", "filename": "tests/ui/wrong_self_convention2.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/cd241b33cb8379311286f53c4afc6e671ddfded1/tests%2Fui%2Fwrong_self_convention2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd241b33cb8379311286f53c4afc6e671ddfded1/tests%2Fui%2Fwrong_self_convention2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwrong_self_convention2.rs?ref=cd241b33cb8379311286f53c4afc6e671ddfded1", "patch": "@@ -42,3 +42,26 @@ mod issue7032 {\n         }\n     }\n }\n+\n+mod issue7179 {\n+    pub struct S(i32);\n+\n+    impl S {\n+        // don't trigger (`s` is not `self`)\n+        pub fn from_be(s: Self) -> Self {\n+            S(i32::from_be(s.0))\n+        }\n+\n+        // lint\n+        pub fn from_be_self(self) -> Self {\n+            S(i32::from_be(self.0))\n+        }\n+    }\n+\n+    trait T {\n+        // don't trigger (`s` is not `self`)\n+        fn from_be(s: Self) -> Self;\n+        // lint\n+        fn from_be_self(self) -> Self;\n+    }\n+}"}, {"sha": "d2d74ce099e3da46a3134b20385a2ac82ff4f519", "filename": "tests/ui/wrong_self_convention2.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cd241b33cb8379311286f53c4afc6e671ddfded1/tests%2Fui%2Fwrong_self_convention2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cd241b33cb8379311286f53c4afc6e671ddfded1/tests%2Fui%2Fwrong_self_convention2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwrong_self_convention2.stderr?ref=cd241b33cb8379311286f53c4afc6e671ddfded1", "patch": "@@ -0,0 +1,19 @@\n+error: methods called `from_*` usually take no `self`\n+  --> $DIR/wrong_self_convention2.rs:56:29\n+   |\n+LL |         pub fn from_be_self(self) -> Self {\n+   |                             ^^^^\n+   |\n+   = note: `-D clippy::wrong-self-convention` implied by `-D warnings`\n+   = help: consider choosing a less ambiguous name\n+\n+error: methods called `from_*` usually take no `self`\n+  --> $DIR/wrong_self_convention2.rs:65:25\n+   |\n+LL |         fn from_be_self(self) -> Self;\n+   |                         ^^^^\n+   |\n+   = help: consider choosing a less ambiguous name\n+\n+error: aborting due to 2 previous errors\n+"}]}