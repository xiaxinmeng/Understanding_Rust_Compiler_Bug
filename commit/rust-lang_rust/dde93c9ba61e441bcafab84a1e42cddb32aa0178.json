{"sha": "dde93c9ba61e441bcafab84a1e42cddb32aa0178", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRkZTkzYzliYTYxZTQ0MWJjYWZhYjg0YTFlNDJjZGRiMzJhYTAxNzg=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-08-04T13:22:16Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-08-16T14:42:30Z"}, "message": "rustdoc: clean `QPath::LangItem`\n\nThis commit adds support for cleaning `QPath::LangItem` and\n`hir::GenericBound::LangItemTrait` in rustdoc. `QPath::LangItem`\ndoes not require lowering, and `hir::GenericBound::LangItemTrait`\nis lowered to a `GenericBound::TraitBound`.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "a75313886a64cef9fa0e0dfeb077bde4616723a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a75313886a64cef9fa0e0dfeb077bde4616723a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dde93c9ba61e441bcafab84a1e42cddb32aa0178", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl85RdYACgkQJZLnbIc4\nH9mMChAArdhaqjkXTZZC8d7uADThyZ9C+WPvX0P5WqUcjSym8qSl9ndQRO0zpG2f\n/hVWypuC5BRZXeuo3Q4qyP8iWAvMtA/YCNHFCMcU6R6bmI1o1NFzpTRQICQJdoQN\nq4X/58m4Wf1COlYA9NtmZ6PzUnelFprSUfLuKWg6FQbJlOp+TsuqEEH/FYRmmWMh\nQHOI4a9Oe0+3REGrDoEoM0NUrVeB7rqJivxueAIeeNZu3f+iCGrf/o8VZ9MwBs59\nhOn9D7QARnrkSJ59VA2ZLqqSqMves3TL2CyrR/RWLMfeWGuhdDQ7oPg7tTaoMUV8\nxNgGdyRIieKEWyXbzcJthUxFCbwIwFy07kvOd2qj81VC011sX+p+HE3jj08YPfiw\nKTcObuuAQtK+8cFB9fq2mcHkuQwfbQMUFnXY2eyvkGFkLPqeG0WYDHqehbI1a7TC\noTbzb1mY4iJlULuglMVU+ayAHEhu3P6f8Mn+LJ1G2qtt5KF1/GBmHNH6Kurlr21x\nJfq9IH7bfwdXTXVwhA3t2Xk4Q6YYpVsr6km4Qf2/M6MwsJMjv/bC8DGjYksjNeII\nlUQU0d4enuW93ZIrLXT+C+go3lIwFrrj/ULTYoj7LDawUqW07bjFZsix7BSgJfk6\nFo6YUyQsoZC9F2l/mGCqeXQjE7t6PzVGmXJ74OjjViU1p4aDMN0=\n=+6IA\n-----END PGP SIGNATURE-----", "payload": "tree a75313886a64cef9fa0e0dfeb077bde4616723a9\nparent 8367af469b9005c8f5c1777a48548a80e4658076\nauthor David Wood <david@davidtw.co> 1596547336 +0100\ncommitter David Wood <david@davidtw.co> 1597588950 +0100\n\nrustdoc: clean `QPath::LangItem`\n\nThis commit adds support for cleaning `QPath::LangItem` and\n`hir::GenericBound::LangItemTrait` in rustdoc. `QPath::LangItem`\ndoes not require lowering, and `hir::GenericBound::LangItemTrait`\nis lowered to a `GenericBound::TraitBound`.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dde93c9ba61e441bcafab84a1e42cddb32aa0178", "html_url": "https://github.com/rust-lang/rust/commit/dde93c9ba61e441bcafab84a1e42cddb32aa0178", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dde93c9ba61e441bcafab84a1e42cddb32aa0178/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8367af469b9005c8f5c1777a48548a80e4658076", "url": "https://api.github.com/repos/rust-lang/rust/commits/8367af469b9005c8f5c1777a48548a80e4658076", "html_url": "https://github.com/rust-lang/rust/commit/8367af469b9005c8f5c1777a48548a80e4658076"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "bf385fd79b0f2e4c7f58a30b66ecae890da61118", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/dde93c9ba61e441bcafab84a1e42cddb32aa0178/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dde93c9ba61e441bcafab84a1e42cddb32aa0178/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=dde93c9ba61e441bcafab84a1e42cddb32aa0178", "patch": "@@ -17,6 +17,7 @@ use rustc_hir::def::{CtorKind, DefKind, Res};\n use rustc_hir::def_id::{CrateNum, DefId, CRATE_DEF_INDEX};\n use rustc_index::vec::{Idx, IndexVec};\n use rustc_infer::infer::region_constraints::{Constraint, RegionConstraintData};\n+use rustc_middle::bug;\n use rustc_middle::middle::resolve_lifetime as rl;\n use rustc_middle::middle::stability;\n use rustc_middle::ty::fold::TypeFolder;\n@@ -291,6 +292,22 @@ impl Clean<GenericBound> for hir::GenericBound<'_> {\n     fn clean(&self, cx: &DocContext<'_>) -> GenericBound {\n         match *self {\n             hir::GenericBound::Outlives(lt) => GenericBound::Outlives(lt.clean(cx)),\n+            hir::GenericBound::LangItemTrait(lang_item, span, _, generic_args) => {\n+                let def_id = cx.tcx.require_lang_item(lang_item, Some(span));\n+\n+                let trait_ref = ty::TraitRef::identity(cx.tcx, def_id);\n+\n+                let generic_args = generic_args.clean(cx);\n+                let bindings = match generic_args {\n+                    GenericArgs::AngleBracketed { bindings, .. } => bindings,\n+                    _ => bug!(\"clean: parenthesized `GenericBound::LangItemTrait`\"),\n+                };\n+\n+                GenericBound::TraitBound(\n+                    PolyTrait { trait_: (trait_ref, &*bindings).clean(cx), generic_params: vec![] },\n+                    hir::TraitBoundModifier::None,\n+                )\n+            }\n             hir::GenericBound::Trait(ref t, modifier) => {\n                 GenericBound::TraitBound(t.clean(cx), modifier)\n             }\n@@ -1504,6 +1521,9 @@ impl Clean<Type> for hir::Ty<'_> {\n                     trait_: box resolve_type(cx, trait_path.clean(cx), self.hir_id),\n                 }\n             }\n+            TyKind::Path(hir::QPath::LangItem(..)) => {\n+                bug!(\"clean: requiring documentation of lang item\")\n+            }\n             TyKind::TraitObject(ref bounds, ref lifetime) => {\n                 match bounds[0].clean(cx).trait_ {\n                     ResolvedPath { path, param_names: None, did, is_generic } => {"}, {"sha": "a502a27948e29f2bad24c68c4b7edd7a3d162cf8", "filename": "src/librustdoc/clean/utils.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/dde93c9ba61e441bcafab84a1e42cddb32aa0178/src%2Flibrustdoc%2Fclean%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dde93c9ba61e441bcafab84a1e42cddb32aa0178/src%2Flibrustdoc%2Fclean%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Futils.rs?ref=dde93c9ba61e441bcafab84a1e42cddb32aa0178", "patch": "@@ -335,6 +335,7 @@ pub fn qpath_to_string(p: &hir::QPath<'_>) -> String {\n     let segments = match *p {\n         hir::QPath::Resolved(_, ref path) => &path.segments,\n         hir::QPath::TypeRelative(_, ref segment) => return segment.ident.to_string(),\n+        hir::QPath::LangItem(lang_item, ..) => return lang_item.name().to_string(),\n     };\n \n     let mut s = String::new();"}]}