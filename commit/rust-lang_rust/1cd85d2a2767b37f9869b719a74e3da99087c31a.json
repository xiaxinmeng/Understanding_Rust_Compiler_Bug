{"sha": "1cd85d2a2767b37f9869b719a74e3da99087c31a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjZDg1ZDJhMjc2N2IzN2Y5ODY5YjcxOWE3NGUzZGE5OTA4N2MzMWE=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-01-21T18:11:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-01-21T18:11:24Z"}, "message": "Merge pull request #599 from solson/rustup\n\nUpdate to latest rustc master", "tree": {"sha": "314faa2194a2b23207eb5f21d32b890b63a0c62f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/314faa2194a2b23207eb5f21d32b890b63a0c62f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1cd85d2a2767b37f9869b719a74e3da99087c31a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcRgtMCRBK7hj4Ov3rIwAAdHIIACLA0CgfEKaXRxwiFJ0MZEpT\nBpJ6TFWA85YpgRZND1pIkLu2MUXGh0iI9mpub5DEvugeCrgCrhBY6IrITBPOTNkJ\nnS34eEE14gEP605YSCMPmffQuH96fvatB/Xbg+SQOU24YN1zr3BjKG1itIKZBmIc\neA5zWJfGmUpd57UM7GlnOpa70rPuCpSgm7v8fet0xc+KQJA/HyDHBXUmCrGW5YCj\ne6b/boQRHr7lHX9jp6zOUxmHcD+b39I/ojt8E6G7cVRcowHoY++PRauI/AQbTJjW\nZMNRs5QBT/N1o2YUpXHykF7KP8f/r+XMlJ6cqz7q+oKvS6ASbT3cBJukE6Lb6mU=\n=eUAc\n-----END PGP SIGNATURE-----\n", "payload": "tree 314faa2194a2b23207eb5f21d32b890b63a0c62f\nparent 97f4cff8e904c268569d37922a27835209deff5d\nparent 6943ba8a633d0437a3e60c3d4dcdc07ab218c18d\nauthor Ralf Jung <post@ralfj.de> 1548094284 +0000\ncommitter GitHub <noreply@github.com> 1548094284 +0000\n\nMerge pull request #599 from solson/rustup\n\nUpdate to latest rustc master"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1cd85d2a2767b37f9869b719a74e3da99087c31a", "html_url": "https://github.com/rust-lang/rust/commit/1cd85d2a2767b37f9869b719a74e3da99087c31a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1cd85d2a2767b37f9869b719a74e3da99087c31a/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97f4cff8e904c268569d37922a27835209deff5d", "url": "https://api.github.com/repos/rust-lang/rust/commits/97f4cff8e904c268569d37922a27835209deff5d", "html_url": "https://github.com/rust-lang/rust/commit/97f4cff8e904c268569d37922a27835209deff5d"}, {"sha": "6943ba8a633d0437a3e60c3d4dcdc07ab218c18d", "url": "https://api.github.com/repos/rust-lang/rust/commits/6943ba8a633d0437a3e60c3d4dcdc07ab218c18d", "html_url": "https://github.com/rust-lang/rust/commit/6943ba8a633d0437a3e60c3d4dcdc07ab218c18d"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "a34e137694cba1d61015e889a4475d13741a1185", "filename": "benches/helpers/miri_helper.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1cd85d2a2767b37f9869b719a74e3da99087c31a/benches%2Fhelpers%2Fmiri_helper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cd85d2a2767b37f9869b719a74e3da99087c31a/benches%2Fhelpers%2Fmiri_helper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/benches%2Fhelpers%2Fmiri_helper.rs?ref=1cd85d2a2767b37f9869b719a74e3da99087c31a", "patch": "@@ -6,6 +6,7 @@ extern crate test;\n \n use self::miri::eval_main;\n use self::rustc_driver::{driver, Compilation};\n+use rustc::hir::def_id::LOCAL_CRATE;\n use std::cell::RefCell;\n use std::rc::Rc;\n use crate::test::Bencher;\n@@ -44,10 +45,9 @@ pub fn run(filename: &str, bencher: &mut Bencher) {\n         state.session.abort_if_errors();\n \n         let tcx = state.tcx.unwrap();\n-        let (entry_node_id, _, _) = state.session.entry_fn.borrow().expect(\n+        let (entry_def_id, _) = tcx.entry_fn(LOCAL_CRATE).expect(\n             \"no main or start function found\",\n         );\n-        let entry_def_id = tcx.hir().local_def_id(entry_node_id);\n \n         bencher.borrow_mut().iter(|| {\n             eval_main(tcx, entry_def_id, false);"}, {"sha": "a34ac2b2521621cbe69b160357de7f2a0f97c668", "filename": "rust-version", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1cd85d2a2767b37f9869b719a74e3da99087c31a/rust-version", "raw_url": "https://github.com/rust-lang/rust/raw/1cd85d2a2767b37f9869b719a74e3da99087c31a/rust-version", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-version?ref=1cd85d2a2767b37f9869b719a74e3da99087c31a", "patch": "@@ -1 +1 @@\n-nightly-2018-12-26\n+nightly-2019-01-21"}, {"sha": "45902dc6722f363491ca646b60f954f3817b55c8", "filename": "src/bin/miri-rustc-tests.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1cd85d2a2767b37f9869b719a74e3da99087c31a/src%2Fbin%2Fmiri-rustc-tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cd85d2a2767b37f9869b719a74e3da99087c31a/src%2Fbin%2Fmiri-rustc-tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fmiri-rustc-tests.rs?ref=1cd85d2a2767b37f9869b719a74e3da99087c31a", "patch": "@@ -23,6 +23,7 @@ use rustc::hir::{self, itemlikevisit};\n use rustc_codegen_utils::codegen_backend::CodegenBackend;\n use rustc::ty::TyCtxt;\n use syntax::ast;\n+use rustc::hir::def_id::LOCAL_CRATE;\n \n struct MiriCompilerCalls {\n     default: Box<RustcDefaultCalls>,\n@@ -104,8 +105,7 @@ fn after_analysis<'a, 'tcx>(state: &mut CompileState<'a, 'tcx>) {\n             fn visit_impl_item(&mut self, _impl_item: &'hir hir::ImplItem) {}\n         }\n         state.hir_crate.unwrap().visit_all_item_likes(&mut Visitor(tcx, state));\n-    } else if let Some((entry_node_id, _, _)) = *state.session.entry_fn.borrow() {\n-        let entry_def_id = tcx.hir().local_def_id(entry_node_id);\n+    } else if let Some((entry_def_id, _)) = tcx.entry_fn(LOCAL_CRATE) {\n         miri::eval_main(tcx, entry_def_id, /*validate*/true);\n \n         state.session.abort_if_errors();"}, {"sha": "acfc429ed805ce36e37ba2017c08e3c44f3c019f", "filename": "src/bin/miri.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1cd85d2a2767b37f9869b719a74e3da99087c31a/src%2Fbin%2Fmiri.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cd85d2a2767b37f9869b719a74e3da99087c31a/src%2Fbin%2Fmiri.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fmiri.rs?ref=1cd85d2a2767b37f9869b719a74e3da99087c31a", "patch": "@@ -24,6 +24,7 @@ use rustc_driver::{Compilation, CompilerCalls, RustcDefaultCalls};\n use rustc_driver::driver::{CompileState, CompileController};\n use rustc::session::config::{self, Input, ErrorOutputType};\n use rustc_codegen_utils::codegen_backend::CodegenBackend;\n+use rustc::hir::def_id::LOCAL_CRATE;\n use syntax::ast;\n \n struct MiriCompilerCalls {\n@@ -113,8 +114,8 @@ fn after_analysis<'a, 'tcx>(\n \n     let tcx = state.tcx.unwrap();\n \n-    let (entry_node_id, _, _) = state.session.entry_fn.borrow().expect(\"no main function found!\");\n-    let entry_def_id = tcx.hir().local_def_id(entry_node_id);\n+\n+    let (entry_def_id, _) = tcx.entry_fn(LOCAL_CRATE).expect(\"no main function found!\");\n \n     miri::eval_main(tcx, entry_def_id, validate);\n "}]}