{"sha": "ee4461a996dba7a1c7064fdc04934e9b7f01f7f3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlNDQ2MWE5OTZkYmE3YTFjNzA2NGZkYzA0OTM0ZTliN2YwMWY3ZjM=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-01-24T21:10:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-24T21:10:04Z"}, "message": "Rollup merge of #81302 - LeSeulArtichaut:80777-trait-render, r=jyn514\n\nFix rendering of stabilization version for trait implementors\n\nRustdoc compares an item's stabilization version with its parent's to not render it if they are the same. Here, the implementor was compared with itself, resulting in the stabilization version never getting shown.\n\nThis probably needs a test.\n\nFixes #80777.\nr? `@jyn514`", "tree": {"sha": "bc42be3d2993c685d696c2120e6619ef23985b81", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc42be3d2993c685d696c2120e6619ef23985b81"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgDeItCRBK7hj4Ov3rIwAAdHIIAKu672/E3BVp2L47AWb3rEsP\nbZA79uYueSwYYyOFJEWUPHnXLB7ev2gvkz3bp1NyOvt4mMFNkj+jW/BHp+iE94Un\nlMfF0MQl6vRgOFX1dRv8ezdLnxmWRcXTs9eOXU45PdBh0Vu1FRo3CjgfRDOuYsPY\nCp+8UNQ6eqSfXQ5f7cnI1wpkUNSa2MelSfL9aG5ULGSXnRXeRvOanjLhD8lbITaV\nXk/1QufqKVL/0ESQr00e2mUH34fbZvFA2qakNA+tlCBaefkFgnMPEElKp4+nzsHW\nbv3+S7keWaZTTQZoOsGvVGAPrM0BqK8P3fioyzRGBHCPcjY/lsmfNWrWwqu8eJg=\n=qXkX\n-----END PGP SIGNATURE-----\n", "payload": "tree bc42be3d2993c685d696c2120e6619ef23985b81\nparent 9089dd2248c2bdca89140f6af514b5fcbb1b97da\nparent 20a460e1cf23262b46a7e9672a02c5f07b91eff5\nauthor Jonas Schievink <jonasschievink@gmail.com> 1611522604 +0100\ncommitter GitHub <noreply@github.com> 1611522604 +0100\n\nRollup merge of #81302 - LeSeulArtichaut:80777-trait-render, r=jyn514\n\nFix rendering of stabilization version for trait implementors\n\nRustdoc compares an item's stabilization version with its parent's to not render it if they are the same. Here, the implementor was compared with itself, resulting in the stabilization version never getting shown.\n\nThis probably needs a test.\n\nFixes #80777.\nr? `@jyn514`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3", "html_url": "https://github.com/rust-lang/rust/commit/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9089dd2248c2bdca89140f6af514b5fcbb1b97da", "url": "https://api.github.com/repos/rust-lang/rust/commits/9089dd2248c2bdca89140f6af514b5fcbb1b97da", "html_url": "https://github.com/rust-lang/rust/commit/9089dd2248c2bdca89140f6af514b5fcbb1b97da"}, {"sha": "20a460e1cf23262b46a7e9672a02c5f07b91eff5", "url": "https://api.github.com/repos/rust-lang/rust/commits/20a460e1cf23262b46a7e9672a02c5f07b91eff5", "html_url": "https://github.com/rust-lang/rust/commit/20a460e1cf23262b46a7e9672a02c5f07b91eff5"}], "stats": {"total": 70, "additions": 40, "deletions": 30}, "files": [{"sha": "ef45c98e406291d18d00595dec06a70bcaac34d9", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 21, "deletions": 30, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=ee4461a996dba7a1c7064fdc04934e9b7f01f7f3", "patch": "@@ -2474,7 +2474,7 @@ fn item_function(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, f: &clean::\n fn render_implementor(\n     cx: &Context<'_>,\n     implementor: &Impl,\n-    parent: &clean::Item,\n+    trait_: &clean::Item,\n     w: &mut Buffer,\n     implementor_dups: &FxHashMap<Symbol, (DefId, bool)>,\n     aliases: &[String],\n@@ -2494,11 +2494,11 @@ fn render_implementor(\n         w,\n         cx,\n         implementor,\n-        parent,\n+        trait_,\n         AssocItemLink::Anchor(None),\n         RenderMode::Normal,\n-        implementor.impl_item.stable_since(cx.tcx()).as_deref(),\n-        implementor.impl_item.const_stable_since(cx.tcx()).as_deref(),\n+        trait_.stable_since(cx.tcx()).as_deref(),\n+        trait_.const_stable_since(cx.tcx()).as_deref(),\n         false,\n         Some(use_absolute),\n         false,\n@@ -2937,34 +2937,25 @@ fn render_stability_since_raw(\n     containing_ver: Option<&str>,\n     containing_const_ver: Option<&str>,\n ) {\n-    let ver = ver.and_then(|inner| if !inner.is_empty() { Some(inner) } else { None });\n-\n-    let const_ver = const_ver.and_then(|inner| if !inner.is_empty() { Some(inner) } else { None });\n+    let ver = ver.filter(|inner| !inner.is_empty());\n+    let const_ver = const_ver.filter(|inner| !inner.is_empty());\n \n-    if let Some(v) = ver {\n-        if let Some(cv) = const_ver {\n-            if const_ver != containing_const_ver {\n-                write!(\n-                    w,\n-                    \"<span class=\\\"since\\\" title=\\\"Stable since Rust version {0}, const since {1}\\\">{0} (const: {1})</span>\",\n-                    v, cv\n-                );\n-            } else if ver != containing_ver {\n-                write!(\n-                    w,\n-                    \"<span class=\\\"since\\\" title=\\\"Stable since Rust version {0}\\\">{0}</span>\",\n-                    v\n-                );\n-            }\n-        } else {\n-            if ver != containing_ver {\n-                write!(\n-                    w,\n-                    \"<span class=\\\"since\\\" title=\\\"Stable since Rust version {0}\\\">{0}</span>\",\n-                    v\n-                );\n-            }\n+    match (ver, const_ver) {\n+        (Some(v), Some(cv)) if const_ver != containing_const_ver => {\n+            write!(\n+                w,\n+                \"<span class=\\\"since\\\" title=\\\"Stable since Rust version {0}, const since {1}\\\">{0} (const: {1})</span>\",\n+                v, cv\n+            );\n+        }\n+        (Some(v), _) if ver != containing_ver => {\n+            write!(\n+                w,\n+                \"<span class=\\\"since\\\" title=\\\"Stable since Rust version {0}\\\">{0}</span>\",\n+                v\n+            );\n         }\n+        _ => {}\n     }\n }\n "}, {"sha": "0a065d8095bf238a11538909a8b5b653221d97b4", "filename": "src/test/rustdoc/implementor-stable-version.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3/src%2Ftest%2Frustdoc%2Fimplementor-stable-version.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee4461a996dba7a1c7064fdc04934e9b7f01f7f3/src%2Ftest%2Frustdoc%2Fimplementor-stable-version.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fimplementor-stable-version.rs?ref=ee4461a996dba7a1c7064fdc04934e9b7f01f7f3", "patch": "@@ -0,0 +1,19 @@\n+#![crate_name = \"foo\"]\n+\n+#![feature(staged_api)]\n+\n+#[stable(feature = \"bar\", since = \"OLD 1.0\")]\n+pub trait Bar {}\n+\n+#[stable(feature = \"baz\", since = \"OLD 1.0\")]\n+pub trait Baz {}\n+\n+pub struct Foo;\n+\n+// @has foo/trait.Bar.html '//div[@id=\"implementors-list\"]//span[@class=\"since\"]' 'NEW 2.0'\n+#[stable(feature = \"foobar\", since = \"NEW 2.0\")]\n+impl Bar for Foo {}\n+\n+// @!has foo/trait.Baz.html '//div[@id=\"implementors-list\"]//span[@class=\"since\"]' 'OLD 1.0'\n+#[stable(feature = \"foobaz\", since = \"OLD 1.0\")]\n+impl Baz for Foo {}"}]}