{"sha": "5f03ca48d8348197b52697f54a34e471b0edd79f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmMDNjYTQ4ZDgzNDgxOTdiNTI2OTdmNTRhMzRlNDcxYjBlZGQ3OWY=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-08-04T22:56:40Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-08-04T22:56:40Z"}, "message": "Add a fast path in ty::occurs_check_fails\n\nUse type_contains_vars in occurs_check_fails to avoid doing\nany work most of the time. This fixes a performance regression.\n(No one else noticed yet that typechecking just got 4x slower, right?\nWell, now it isn't anymore. :-})", "tree": {"sha": "2c874cde285abe0feb8d7acb98331e61a7b9f842", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2c874cde285abe0feb8d7acb98331e61a7b9f842"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f03ca48d8348197b52697f54a34e471b0edd79f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f03ca48d8348197b52697f54a34e471b0edd79f", "html_url": "https://github.com/rust-lang/rust/commit/5f03ca48d8348197b52697f54a34e471b0edd79f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f03ca48d8348197b52697f54a34e471b0edd79f/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2baaeab784a1f5c95deb8bd0c3a9745a969431cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/2baaeab784a1f5c95deb8bd0c3a9745a969431cc", "html_url": "https://github.com/rust-lang/rust/commit/2baaeab784a1f5c95deb8bd0c3a9745a969431cc"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "00f2e6a1b86b2de32456ca8c622c1a856b2e15f8", "filename": "src/comp/middle/ty.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5f03ca48d8348197b52697f54a34e471b0edd79f/src%2Fcomp%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f03ca48d8348197b52697f54a34e471b0edd79f/src%2Fcomp%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fty.rs?ref=5f03ca48d8348197b52697f54a34e471b0edd79f", "patch": "@@ -2015,6 +2015,10 @@ fn is_lval(expr: &@ast::expr) -> bool {\n \n fn occurs_check_fails(tcx: &ctxt, sp: &option::t[span], vid: int, rt: &t)\n     -> bool {\n+    if (!type_contains_vars(tcx, rt)) {\n+        // Fast path\n+        ret false;\n+    }\n     // Occurs check!\n     if ivec::member(vid, vars_in_type(tcx, rt)) {\n         alt sp {\n@@ -2754,7 +2758,7 @@ mod unify {\n               none. { *unresolved = some(vid); ret ty::mk_var(tcx, vid); }\n               some(rt) {\n                 if occurs_check_fails(tcx, sp, vid, rt) {\n-                 // Return the type unchanged, so we can error out downstream\n+      // Return the type unchanged, so we can error out downstream\n                     ret rt;\n                 }\n                 ret fold_ty(tcx,"}]}