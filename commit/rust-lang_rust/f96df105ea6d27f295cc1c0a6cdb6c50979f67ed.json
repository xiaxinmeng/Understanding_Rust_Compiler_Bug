{"sha": "f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5NmRmMTA1ZWE2ZDI3ZjI5NWNjMWMwYTZjZGI2YzUwOTc5ZjY3ZWQ=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-10T17:37:41Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-10T17:37:41Z"}, "message": "Merge #956\n\n956: Add async keyword r=c410-f3r a=c410-f3r\n\nFixes #954.\n\nCo-authored-by: Caio <c410.f3r@gmail.com>", "tree": {"sha": "a1bb4699afbd53d1ccbfd3585fa15169f971571c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a1bb4699afbd53d1ccbfd3585fa15169f971571c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "html_url": "https://github.com/rust-lang/rust/commit/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "543f2ec8f63ca39182c2c33cbfd093bc008560e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/543f2ec8f63ca39182c2c33cbfd093bc008560e7", "html_url": "https://github.com/rust-lang/rust/commit/543f2ec8f63ca39182c2c33cbfd093bc008560e7"}, {"sha": "cc9721996c4680e257db76aafea12a9565196d92", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc9721996c4680e257db76aafea12a9565196d92", "html_url": "https://github.com/rust-lang/rust/commit/cc9721996c4680e257db76aafea12a9565196d92"}], "stats": {"total": 74, "additions": 72, "deletions": 2}, "files": [{"sha": "53bb26c5ff6e4a7b50bc744ab3b797f20d47eae0", "filename": "crates/ra_parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -93,6 +93,11 @@ pub(super) fn atom_expr(p: &mut Parser, r: Restrictions) -> Option<(CompletedMar\n             }\n         }\n \n+        ASYNC_KW if la == L_CURLY => {\n+            let m = p.start();\n+            p.bump();\n+            block_expr(p, Some(m))\n+        }\n         MATCH_KW => match_expr(p),\n         UNSAFE_KW if la == L_CURLY => {\n             let m = p.start();"}, {"sha": "a057c81675631b5f04c88e62bc7d0fa9fc4ea16a", "filename": "crates/ra_parser/src/grammar/items.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -86,9 +86,15 @@ pub(super) fn maybe_item(p: &mut Parser, flavor: ItemFlavor) -> MaybeItem {\n     }\n \n     let mut has_mods = false;\n+\n     // modifiers\n+    // test_err async_without_semicolon\n+    // fn foo() { let _ = async {} }\n     has_mods |= p.eat(CONST_KW);\n-\n+    if p.at(ASYNC_KW) && p.nth(1) != L_CURLY {\n+        p.eat(ASYNC_KW);\n+        has_mods = true;\n+    }\n     // test_err unsafe_block_in_mod\n     // fn foo(){} unsafe { } fn bar(){}\n     if p.at(UNSAFE_KW) && p.nth(1) != L_CURLY {\n@@ -110,6 +116,9 @@ pub(super) fn maybe_item(p: &mut Parser, flavor: ItemFlavor) -> MaybeItem {\n \n     // items\n     let kind = match p.current() {\n+        // test async_fn\n+        // async fn foo() {}\n+\n         // test extern_fn\n         // extern fn foo() {}\n "}, {"sha": "03247ae38cd323c254ce65f06f1ad9770f8e328f", "filename": "crates/ra_parser/src/syntax_kind/generated.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -66,6 +66,7 @@ pub enum SyntaxKind {\n     SHR,\n     SHLEQ,\n     SHREQ,\n+    ASYNC_KW,\n     USE_KW,\n     FN_KW,\n     STRUCT_KW,\n@@ -233,6 +234,7 @@ use self::SyntaxKind::*;\n impl SyntaxKind {\n     pub fn is_keyword(self) -> bool {\n         match self {\n+            | ASYNC_KW\n             | USE_KW\n             | FN_KW\n             | STRUCT_KW\n@@ -403,6 +405,7 @@ impl SyntaxKind {\n             SHR => &SyntaxInfo { name: \"SHR\" },\n             SHLEQ => &SyntaxInfo { name: \"SHLEQ\" },\n             SHREQ => &SyntaxInfo { name: \"SHREQ\" },\n+            ASYNC_KW => &SyntaxInfo { name: \"ASYNC_KW\" },\n             USE_KW => &SyntaxInfo { name: \"USE_KW\" },\n             FN_KW => &SyntaxInfo { name: \"FN_KW\" },\n             STRUCT_KW => &SyntaxInfo { name: \"STRUCT_KW\" },\n@@ -570,6 +573,7 @@ impl SyntaxKind {\n     }\n     pub fn from_keyword(ident: &str) -> Option<SyntaxKind> {\n         let kw = match ident {\n+            \"async\" => ASYNC_KW,\n             \"use\" => USE_KW,\n             \"fn\" => FN_KW,\n             \"struct\" => STRUCT_KW,"}, {"sha": "66f1339c10937a156aea98d76f7218e1df0c25a4", "filename": "crates/ra_syntax/src/grammar.ron", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -59,6 +59,7 @@ Grammar(\n         [\">>=\", \"SHREQ\"],\n     ],\n     keywords: [\n+        \"async\",\n         \"use\",\n         \"fn\",\n         \"struct\","}, {"sha": "1e91bff4e7d83b662f500d05976d24f37fff0d3e", "filename": "crates/ra_syntax/tests/data/lexer/0011_keywords.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Flexer%2F0011_keywords.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Flexer%2F0011_keywords.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Flexer%2F0011_keywords.rs?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -1,3 +1,3 @@\n-fn use struct trait enum impl true false as extern crate\n+async fn use struct trait enum impl true false as extern crate\n mod pub self super in where for loop while if match const\n static mut type ref let else move return"}, {"sha": "22c00eefb62bd818bc9c99029b999064d33f6224", "filename": "crates/ra_syntax/tests/data/lexer/0011_keywords.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Flexer%2F0011_keywords.txt", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Flexer%2F0011_keywords.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Flexer%2F0011_keywords.txt?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -1,3 +1,5 @@\n+ASYNC_KW 5 \"async\"\n+WHITESPACE 1 \" \"\n FN_KW 2 \"fn\"\n WHITESPACE 1 \" \"\n USE_KW 3 \"use\""}, {"sha": "9a423248c2747e2b87cec11a0cadb586683ca6c5", "filename": "crates/ra_syntax/tests/data/parser/inline/err/0007_async_without_semicolon.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0007_async_without_semicolon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0007_async_without_semicolon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0007_async_without_semicolon.rs?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -0,0 +1 @@\n+fn foo() { let _ = async {} }"}, {"sha": "bb9a2d0295da02b4df5f5a6a283df3700b9799ed", "filename": "crates/ra_syntax/tests/data/parser/inline/err/0007_async_without_semicolon.txt", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0007_async_without_semicolon.txt", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0007_async_without_semicolon.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0007_async_without_semicolon.txt?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -0,0 +1,31 @@\n+SOURCE_FILE@[0; 30)\n+  FN_DEF@[0; 29)\n+    FN_KW@[0; 2)\n+    WHITESPACE@[2; 3)\n+    NAME@[3; 6)\n+      IDENT@[3; 6) \"foo\"\n+    PARAM_LIST@[6; 8)\n+      L_PAREN@[6; 7)\n+      R_PAREN@[7; 8)\n+    WHITESPACE@[8; 9)\n+    BLOCK@[9; 29)\n+      L_CURLY@[9; 10)\n+      WHITESPACE@[10; 11)\n+      LET_STMT@[11; 27)\n+        LET_KW@[11; 14)\n+        WHITESPACE@[14; 15)\n+        PLACEHOLDER_PAT@[15; 16)\n+          UNDERSCORE@[15; 16)\n+        WHITESPACE@[16; 17)\n+        EQ@[17; 18)\n+        WHITESPACE@[18; 19)\n+        BLOCK_EXPR@[19; 27)\n+          ASYNC_KW@[19; 24)\n+          WHITESPACE@[24; 25)\n+          BLOCK@[25; 27)\n+            L_CURLY@[25; 26)\n+            R_CURLY@[26; 27)\n+            err: `expected SEMI`\n+      WHITESPACE@[27; 28)\n+      R_CURLY@[28; 29)\n+  WHITESPACE@[29; 30)"}, {"sha": "f4adcb62b3b828b2ed2972ab2e40e63b402e4850", "filename": "crates/ra_syntax/tests/data/parser/inline/ok/0124_async_fn.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0124_async_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0124_async_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0124_async_fn.rs?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -0,0 +1 @@\n+async fn foo() {}"}, {"sha": "d1a706ecc355ce253ce2968ab970c0bedfde49bd", "filename": "crates/ra_syntax/tests/data/parser/inline/ok/0124_async_fn.txt", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0124_async_fn.txt", "raw_url": "https://github.com/rust-lang/rust/raw/f96df105ea6d27f295cc1c0a6cdb6c50979f67ed/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0124_async_fn.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0124_async_fn.txt?ref=f96df105ea6d27f295cc1c0a6cdb6c50979f67ed", "patch": "@@ -0,0 +1,16 @@\n+SOURCE_FILE@[0; 18)\n+  FN_DEF@[0; 17)\n+    ASYNC_KW@[0; 5)\n+    WHITESPACE@[5; 6)\n+    FN_KW@[6; 8)\n+    WHITESPACE@[8; 9)\n+    NAME@[9; 12)\n+      IDENT@[9; 12) \"foo\"\n+    PARAM_LIST@[12; 14)\n+      L_PAREN@[12; 13)\n+      R_PAREN@[13; 14)\n+    WHITESPACE@[14; 15)\n+    BLOCK@[15; 17)\n+      L_CURLY@[15; 16)\n+      R_CURLY@[16; 17)\n+  WHITESPACE@[17; 18)"}]}