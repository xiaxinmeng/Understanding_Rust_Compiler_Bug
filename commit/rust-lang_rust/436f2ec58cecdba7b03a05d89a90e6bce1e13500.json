{"sha": "436f2ec58cecdba7b03a05d89a90e6bce1e13500", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQzNmYyZWM1OGNlY2RiYTdiMDNhMDVkODlhOTBlNmJjZTFlMTM1MDA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-03-10T05:47:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-10T05:47:55Z"}, "message": "Rollup merge of #69836 - JohnTitor:immediate-outputs, r=nagisa\n\nCheck if output is immediate value\n\nFixes #62046\n\nr? @nagisa", "tree": {"sha": "56fef9d057cfc9f7f93aece0d55a9050605249ff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/56fef9d057cfc9f7f93aece0d55a9050605249ff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/436f2ec58cecdba7b03a05d89a90e6bce1e13500", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeZyoLCRBK7hj4Ov3rIwAAdHIIABboZ6+E48nb1nVeABSOFjXR\ngm3QoNsv9SNLYASAI+Fy34sblGTnkxhK64uIROCDkjXGm7fzXoCZi/D75ulKRllE\nt0/M3oJkxPR6nYvv9lNGjYb/Jc1hokCWS7CkrhTYuKNDFS9luESm5sZUOBdk5gbU\nNy0XAoGM8DOrBoTyc769BhotVfBzNdSru2y5hZ/dTr6bvQJqKo29Mamzrn95KwCi\nkC4M8qQdww/FnviiJipqCk7DTL5ySM2Mx1v53JefJoQzVGGtERvzZ+b+L4oA6U33\nKz7rM+J048xTdDmSXHpdtCOxBdm71M0Q8qqjVBbxSix4YRH8VqWwjFPDvRCEaqE=\n=79Hb\n-----END PGP SIGNATURE-----\n", "payload": "tree 56fef9d057cfc9f7f93aece0d55a9050605249ff\nparent 08095f4978b1dbf1aba584969e314a3caac705a2\nparent d32924f89d1324386588bd23b0437cdeca1e0fc8\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1583819275 +0100\ncommitter GitHub <noreply@github.com> 1583819275 +0100\n\nRollup merge of #69836 - JohnTitor:immediate-outputs, r=nagisa\n\nCheck if output is immediate value\n\nFixes #62046\n\nr? @nagisa\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/436f2ec58cecdba7b03a05d89a90e6bce1e13500", "html_url": "https://github.com/rust-lang/rust/commit/436f2ec58cecdba7b03a05d89a90e6bce1e13500", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/436f2ec58cecdba7b03a05d89a90e6bce1e13500/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08095f4978b1dbf1aba584969e314a3caac705a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/08095f4978b1dbf1aba584969e314a3caac705a2", "html_url": "https://github.com/rust-lang/rust/commit/08095f4978b1dbf1aba584969e314a3caac705a2"}, {"sha": "d32924f89d1324386588bd23b0437cdeca1e0fc8", "url": "https://api.github.com/repos/rust-lang/rust/commits/d32924f89d1324386588bd23b0437cdeca1e0fc8", "html_url": "https://github.com/rust-lang/rust/commit/d32924f89d1324386588bd23b0437cdeca1e0fc8"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "7975a70ab269c9d40ff0bcb69c8c9156a7b08e8c", "filename": "src/librustc_codegen_llvm/asm.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/436f2ec58cecdba7b03a05d89a90e6bce1e13500/src%2Flibrustc_codegen_llvm%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/436f2ec58cecdba7b03a05d89a90e6bce1e13500/src%2Flibrustc_codegen_llvm%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fasm.rs?ref=436f2ec58cecdba7b03a05d89a90e6bce1e13500", "patch": "@@ -29,11 +29,17 @@ impl AsmBuilderMethods<'tcx> for Builder<'a, 'll, 'tcx> {\n         let mut indirect_outputs = vec![];\n         for (i, (out, &place)) in ia.outputs.iter().zip(&outputs).enumerate() {\n             if out.is_rw {\n-                inputs.push(self.load_operand(place).immediate());\n+                let operand = self.load_operand(place);\n+                if let OperandValue::Immediate(_) = operand.val {\n+                    inputs.push(operand.immediate());\n+                }\n                 ext_constraints.push(i.to_string());\n             }\n             if out.is_indirect {\n-                indirect_outputs.push(self.load_operand(place).immediate());\n+                let operand = self.load_operand(place);\n+                if let OperandValue::Immediate(_) = operand.val {\n+                    indirect_outputs.push(operand.immediate());\n+                }\n             } else {\n                 output_types.push(place.layout.llvm_type(self.cx()));\n             }"}, {"sha": "105dadd5fd373f420bd7fd441c4fac80b095028f", "filename": "src/test/ui/asm/issue-62046.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/436f2ec58cecdba7b03a05d89a90e6bce1e13500/src%2Ftest%2Fui%2Fasm%2Fissue-62046.rs", "raw_url": "https://github.com/rust-lang/rust/raw/436f2ec58cecdba7b03a05d89a90e6bce1e13500/src%2Ftest%2Fui%2Fasm%2Fissue-62046.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-62046.rs?ref=436f2ec58cecdba7b03a05d89a90e6bce1e13500", "patch": "@@ -0,0 +1,11 @@\n+// build-fail\n+// ignore-emscripten no asm! support\n+\n+#![feature(asm)]\n+\n+fn main() {\n+    unsafe {\n+        asm!(\"nop\" : \"+r\"(\"r15\"));\n+        //~^ malformed inline assembly\n+    }\n+}"}, {"sha": "a38a300548d4836dca4104fefdce751a41458d16", "filename": "src/test/ui/asm/issue-62046.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/436f2ec58cecdba7b03a05d89a90e6bce1e13500/src%2Ftest%2Fui%2Fasm%2Fissue-62046.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/436f2ec58cecdba7b03a05d89a90e6bce1e13500/src%2Ftest%2Fui%2Fasm%2Fissue-62046.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-62046.stderr?ref=436f2ec58cecdba7b03a05d89a90e6bce1e13500", "patch": "@@ -0,0 +1,11 @@\n+error[E0668]: malformed inline assembly\n+  --> $DIR/issue-62046.rs:8:9\n+   |\n+LL |         asm!(\"nop\" : \"+r\"(\"r15\"));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0668`."}]}