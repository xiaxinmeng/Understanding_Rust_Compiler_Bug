{"sha": "66fb62baf7a655e0b08f2d61f7e186ac0ac18045", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2ZmI2MmJhZjdhNjU1ZTBiMDhmMmQ2MWY3ZTE4NmFjMGFjMTgwNDU=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas@schievink.net", "date": "2016-07-10T23:21:12Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas@schievink.net", "date": "2016-07-10T23:21:12Z"}, "message": "Get rid of `node_levels` and `node_lint_levels`", "tree": {"sha": "da98a92c464553668b168e5d1993bd2b1a5d251d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da98a92c464553668b168e5d1993bd2b1a5d251d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/66fb62baf7a655e0b08f2d61f7e186ac0ac18045", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/66fb62baf7a655e0b08f2d61f7e186ac0ac18045", "html_url": "https://github.com/rust-lang/rust/commit/66fb62baf7a655e0b08f2d61f7e186ac0ac18045", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/66fb62baf7a655e0b08f2d61f7e186ac0ac18045/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5d29a3b594719d0303bdffccb8470ebb10b0d3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5d29a3b594719d0303bdffccb8470ebb10b0d3e", "html_url": "https://github.com/rust-lang/rust/commit/f5d29a3b594719d0303bdffccb8470ebb10b0d3e"}], "stats": {"total": 13, "additions": 0, "deletions": 13}, "files": [{"sha": "ce3d72de9ae99a5378cfbbf598833ae4e7cda408", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/66fb62baf7a655e0b08f2d61f7e186ac0ac18045/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/66fb62baf7a655e0b08f2d61f7e186ac0ac18045/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=66fb62baf7a655e0b08f2d61f7e186ac0ac18045", "patch": "@@ -35,7 +35,6 @@ use lint::{Default, CommandLine, Node, Allow, Warn, Deny, Forbid};\n use lint::builtin;\n use util::nodemap::FnvHashMap;\n \n-use std::cell::RefCell;\n use std::cmp;\n use std::default::Default as StdDefault;\n use std::mem;\n@@ -311,10 +310,6 @@ pub struct LateContext<'a, 'tcx: 'a> {\n     /// levels, this stack keeps track of the previous lint levels of whatever\n     /// was modified.\n     level_stack: Vec<(LintId, LevelSource)>,\n-\n-    /// Level of lints for certain NodeIds, stored here because the body of\n-    /// the lint needs to run in trans.\n-    node_levels: RefCell<FnvHashMap<(ast::NodeId, LintId), LevelSource>>,\n }\n \n /// Context for lint checking of the AST, after expansion, before lowering to\n@@ -664,7 +659,6 @@ impl<'a, 'tcx> LateContext<'a, 'tcx> {\n             access_levels: access_levels,\n             lints: lint_store,\n             level_stack: vec![],\n-            node_levels: RefCell::new(FnvHashMap()),\n         }\n     }\n \n@@ -1202,8 +1196,6 @@ pub fn check_crate<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n         }\n     }\n \n-    *tcx.node_lint_levels.borrow_mut() = cx.node_levels.into_inner();\n-\n     // Put the lint store back in the session.\n     mem::replace(&mut *tcx.sess.lint_store.borrow_mut(), cx.lints);\n }"}, {"sha": "56938a7a838588d0e0c5d757b1eab9e877e4b763", "filename": "src/librustc/ty/context.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/66fb62baf7a655e0b08f2d61f7e186ac0ac18045/src%2Flibrustc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/66fb62baf7a655e0b08f2d61f7e186ac0ac18045/src%2Flibrustc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcontext.rs?ref=66fb62baf7a655e0b08f2d61f7e186ac0ac18045", "patch": "@@ -12,7 +12,6 @@\n \n use dep_graph::{DepGraph, DepTrackingMap};\n use session::Session;\n-use lint;\n use middle;\n use middle::cstore::LOCAL_CRATE;\n use hir::def::DefMap;\n@@ -415,9 +414,6 @@ pub struct GlobalCtxt<'tcx> {\n     /// Cache used by const_eval when decoding extern const fns\n     pub extern_const_fns: RefCell<DefIdMap<NodeId>>,\n \n-    pub node_lint_levels: RefCell<FnvHashMap<(NodeId, lint::LintId),\n-                                              lint::LevelSource>>,\n-\n     /// Maps any item's def-id to its stability index.\n     pub stability: RefCell<stability::Index<'tcx>>,\n \n@@ -726,7 +722,6 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n             populated_external_primitive_impls: RefCell::new(DefIdSet()),\n             extern_const_statics: RefCell::new(DefIdMap()),\n             extern_const_fns: RefCell::new(DefIdMap()),\n-            node_lint_levels: RefCell::new(FnvHashMap()),\n             stability: RefCell::new(stability),\n             selection_cache: traits::SelectionCache::new(),\n             evaluation_cache: traits::EvaluationCache::new(),"}]}