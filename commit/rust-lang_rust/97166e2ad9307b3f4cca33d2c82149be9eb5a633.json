{"sha": "97166e2ad9307b3f4cca33d2c82149be9eb5a633", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3MTY2ZTJhZDkzMDdiM2Y0Y2NhMzNkMmM4MjE0OWJlOWViNWE2MzM=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-02-10T11:28:13Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-02-10T11:37:27Z"}, "message": "Add **Copy Run Command Line** command for vscode\n\nThis is useful when you want to, e.g., run a specific test in a terminal\nwith `--release`.", "tree": {"sha": "8632550e4386b11b09deaacb38bf67929fe03f93", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8632550e4386b11b09deaacb38bf67929fe03f93"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/97166e2ad9307b3f4cca33d2c82149be9eb5a633", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/97166e2ad9307b3f4cca33d2c82149be9eb5a633", "html_url": "https://github.com/rust-lang/rust/commit/97166e2ad9307b3f4cca33d2c82149be9eb5a633", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/97166e2ad9307b3f4cca33d2c82149be9eb5a633/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "36465b34b3b7f991ebf85680924acdb809b0494e", "url": "https://api.github.com/repos/rust-lang/rust/commits/36465b34b3b7f991ebf85680924acdb809b0494e", "html_url": "https://github.com/rust-lang/rust/commit/36465b34b3b7f991ebf85680924acdb809b0494e"}], "stats": {"total": 39, "additions": 31, "deletions": 8}, "files": [{"sha": "55825456ec55fb15642d7ab201073a4cf2380277", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=97166e2ad9307b3f4cca33d2c82149be9eb5a633", "patch": "@@ -133,6 +133,11 @@\n                 \"title\": \"Run\",\n                 \"category\": \"Rust Analyzer\"\n             },\n+            {\n+                \"command\": \"rust-analyzer.copyRunCommandLine\",\n+                \"title\": \"Copy Run Command Line\",\n+                \"category\": \"Rust Analyzer\"\n+            },\n             {\n                 \"command\": \"rust-analyzer.debug\",\n                 \"title\": \"Debug\","}, {"sha": "e3a23c0d20af5d26abffba78256beed40c963ba0", "filename": "editors/code/src/commands.ts", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fsrc%2Fcommands.ts", "raw_url": "https://github.com/rust-lang/rust/raw/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fsrc%2Fcommands.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fcommands.ts?ref=97166e2ad9307b3f4cca33d2c82149be9eb5a633", "patch": "@@ -5,7 +5,7 @@ import * as ra from './lsp_ext';\n import { Ctx, Cmd } from './ctx';\n import { applySnippetWorkspaceEdit, applySnippetTextEdits } from './snippets';\n import { spawnSync } from 'child_process';\n-import { RunnableQuickPick, selectRunnable, createTask } from './run';\n+import { RunnableQuickPick, selectRunnable, createTask, createArgs } from './run';\n import { AstInspector } from './ast_inspector';\n import { isRustDocument, sleep, isRustEditor } from './util';\n import { startDebugSession, makeDebugConfig } from './debug';\n@@ -572,6 +572,18 @@ export function runSingle(ctx: Ctx): Cmd {\n     };\n }\n \n+export function copyRunCommandLine(ctx: Ctx) {\n+    let prevRunnable: RunnableQuickPick | undefined;\n+    return async () => {\n+        const item = await selectRunnable(ctx, prevRunnable);\n+        if (!item) return;\n+        const args = createArgs(item.runnable);\n+        const commandLine = [\"cargo\", ...args].join(\" \");\n+        await vscode.env.clipboard.writeText(commandLine);\n+        await vscode.window.showInformationMessage(\"Cargo invocation copied to the clipboard.\");\n+    };\n+}\n+\n export function debug(ctx: Ctx): Cmd {\n     let prevDebuggee: RunnableQuickPick | undefined;\n "}, {"sha": "43cae5c7fe7c67f48a8cf17c78acd0d6a120edcf", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=97166e2ad9307b3f4cca33d2c82149be9eb5a633", "patch": "@@ -108,6 +108,7 @@ async function tryActivate(context: vscode.ExtensionContext) {\n     ctx.registerCommand('viewHir', commands.viewHir);\n     ctx.registerCommand('expandMacro', commands.expandMacro);\n     ctx.registerCommand('run', commands.run);\n+    ctx.registerCommand('copyRunCommandLine', commands.copyRunCommandLine);\n     ctx.registerCommand('debug', commands.debug);\n     ctx.registerCommand('newDebugConfig', commands.newDebugConfig);\n     ctx.registerCommand('openDocs', commands.openDocs);"}, {"sha": "f42baed1655a4cbf02d5e33476e1476c76be8d41", "filename": "editors/code/src/run.ts", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fsrc%2Frun.ts", "raw_url": "https://github.com/rust-lang/rust/raw/97166e2ad9307b3f4cca33d2c82149be9eb5a633/editors%2Fcode%2Fsrc%2Frun.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Frun.ts?ref=97166e2ad9307b3f4cca33d2c82149be9eb5a633", "patch": "@@ -128,13 +128,7 @@ export async function createTask(runnable: ra.Runnable, config: Config): Promise\n         throw `Unexpected runnable kind: ${runnable.kind}`;\n     }\n \n-    const args = [...runnable.args.cargoArgs]; // should be a copy!\n-    if (runnable.args.cargoExtraArgs) {\n-        args.push(...runnable.args.cargoExtraArgs); // Append user-specified cargo options.\n-    }\n-    if (runnable.args.executableArgs.length > 0) {\n-        args.push('--', ...runnable.args.executableArgs);\n-    }\n+    const args = createArgs(runnable);\n \n     const definition: tasks.CargoTaskDefinition = {\n         type: tasks.TASK_TYPE,\n@@ -151,3 +145,14 @@ export async function createTask(runnable: ra.Runnable, config: Config): Promise\n \n     return cargoTask;\n }\n+\n+export function createArgs(runnable: ra.Runnable): string[] {\n+    const args = [...runnable.args.cargoArgs]; // should be a copy!\n+    if (runnable.args.cargoExtraArgs) {\n+        args.push(...runnable.args.cargoExtraArgs); // Append user-specified cargo options.\n+    }\n+    if (runnable.args.executableArgs.length > 0) {\n+        args.push('--', ...runnable.args.executableArgs);\n+    }\n+    return args;\n+}"}]}