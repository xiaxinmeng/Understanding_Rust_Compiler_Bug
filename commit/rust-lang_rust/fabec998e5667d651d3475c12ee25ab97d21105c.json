{"sha": "fabec998e5667d651d3475c12ee25ab97d21105c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhYmVjOTk4ZTU2NjdkNjUxZDM0NzVjMTJlZTI1YWI5N2QyMTEwNWM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-16T05:56:36Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-16T05:56:36Z"}, "message": "auto merge of #9857 : brson/rust/mainsched, r=alexcrichton\n\n...al work\r\n\r\nThis is causing really awful scheduler behavior where the main thread scheduler is\r\ncontinually waking up, stealing work, discovering it can't actually run the work,\r\nand sending it off to another scheduler.\r\n\r\nNo test cases because we don't have suitable instrumentation for it.", "tree": {"sha": "cfe7a7fda00903a99ecdf9bab0f98eeb85fe356f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cfe7a7fda00903a99ecdf9bab0f98eeb85fe356f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fabec998e5667d651d3475c12ee25ab97d21105c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fabec998e5667d651d3475c12ee25ab97d21105c", "html_url": "https://github.com/rust-lang/rust/commit/fabec998e5667d651d3475c12ee25ab97d21105c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fabec998e5667d651d3475c12ee25ab97d21105c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3d75ec56931c3c6b27707e003a00385b5f01ecbc", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d75ec56931c3c6b27707e003a00385b5f01ecbc", "html_url": "https://github.com/rust-lang/rust/commit/3d75ec56931c3c6b27707e003a00385b5f01ecbc"}, {"sha": "818ebf2ed6c6f61d0a2ec86cb104c4467b28d75e", "url": "https://api.github.com/repos/rust-lang/rust/commits/818ebf2ed6c6f61d0a2ec86cb104c4467b28d75e", "html_url": "https://github.com/rust-lang/rust/commit/818ebf2ed6c6f61d0a2ec86cb104c4467b28d75e"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "9ea7b734d248cd8f0219340b176c7e7c7725cd6c", "filename": "src/libstd/rt/mod.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/fabec998e5667d651d3475c12ee25ab97d21105c/src%2Flibstd%2Frt%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fabec998e5667d651d3475c12ee25ab97d21105c/src%2Flibstd%2Frt%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Fmod.rs?ref=fabec998e5667d651d3475c12ee25ab97d21105c", "patch": "@@ -310,8 +310,14 @@ fn run_(main: ~fn(), use_main_sched: bool) -> int {\n                                                      sleepers.clone(),\n                                                      false,\n                                                      Some(friend_handle));\n-        let main_handle = main_sched.make_handle();\n-        handles.push(main_handle);\n+        let mut main_handle = main_sched.make_handle();\n+        // Allow the scheduler to exit when the main task exits.\n+        // Note: sending the shutdown message also prevents the scheduler\n+        // from pushing itself to the sleeper list, which is used for\n+        // waking up schedulers for work stealing; since this is a\n+        // non-work-stealing scheduler it should not be adding itself\n+        // to the list.\n+        main_handle.send_shutdown();\n         Some(main_sched)\n     } else {\n         None"}]}