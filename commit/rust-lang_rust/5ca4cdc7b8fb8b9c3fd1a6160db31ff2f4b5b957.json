{"sha": "5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjYTRjZGM3YjhmYjhiOWMzZmQxYTYxNjBkYjMxZmYyZjRiNWI5NTc=", "commit": {"author": {"name": "Kevin Ballard", "email": "kevin@sb.org", "date": "2013-08-15T06:40:28Z"}, "committer": {"name": "Kevin Ballard", "email": "kevin@sb.org", "date": "2013-08-15T08:33:10Z"}, "message": "Remove inappropriate .to_c_str() in C_cstr()\n\nLLVMConstStringInContext() doesn't need a null-terminated string. It\ntakes a length instead. Using .to_c_str() here triggers an ICE whenever\nthe string literal embeds a null, as in \"\\x00\".", "tree": {"sha": "5d359043430260f6d188a914a61bc62b90ac0519", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5d359043430260f6d188a914a61bc62b90ac0519"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957", "html_url": "https://github.com/rust-lang/rust/commit/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957/comments", "author": {"login": "lilyball", "id": 714, "node_id": "MDQ6VXNlcjcxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lilyball", "html_url": "https://github.com/lilyball", "followers_url": "https://api.github.com/users/lilyball/followers", "following_url": "https://api.github.com/users/lilyball/following{/other_user}", "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}", "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions", "organizations_url": "https://api.github.com/users/lilyball/orgs", "repos_url": "https://api.github.com/users/lilyball/repos", "events_url": "https://api.github.com/users/lilyball/events{/privacy}", "received_events_url": "https://api.github.com/users/lilyball/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lilyball", "id": 714, "node_id": "MDQ6VXNlcjcxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lilyball", "html_url": "https://github.com/lilyball", "followers_url": "https://api.github.com/users/lilyball/followers", "following_url": "https://api.github.com/users/lilyball/following{/other_user}", "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}", "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions", "organizations_url": "https://api.github.com/users/lilyball/orgs", "repos_url": "https://api.github.com/users/lilyball/repos", "events_url": "https://api.github.com/users/lilyball/events{/privacy}", "received_events_url": "https://api.github.com/users/lilyball/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f744cf157ef7c85736796eca937aa43cbd681a0a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f744cf157ef7c85736796eca937aa43cbd681a0a", "html_url": "https://github.com/rust-lang/rust/commit/f744cf157ef7c85736796eca937aa43cbd681a0a"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "c2f7986a2508442b3d09dc08d75acd0160feef3a", "filename": "src/librustc/middle/trans/common.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs?ref=5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957", "patch": "@@ -36,7 +36,7 @@ use std::c_str::ToCStr;\n use std::cast::transmute;\n use std::cast;\n use std::hashmap::{HashMap};\n-use std::libc::{c_uint, c_longlong, c_ulonglong};\n+use std::libc::{c_uint, c_longlong, c_ulonglong, c_char};\n use std::vec;\n use syntax::ast::ident;\n use syntax::ast_map::{path, path_elt};\n@@ -760,8 +760,8 @@ pub fn C_cstr(cx: &mut CrateContext, s: @str) -> ValueRef {\n             None => ()\n         }\n \n-        let sc = do s.with_c_str |buf| {\n-            llvm::LLVMConstStringInContext(cx.llcx, buf, s.len() as c_uint, False)\n+        let sc = do s.as_imm_buf |buf, buflen| {\n+            llvm::LLVMConstStringInContext(cx.llcx, buf as *c_char, buflen as c_uint, False)\n         };\n \n         let gsym = token::gensym(\"str\");"}, {"sha": "47d5b7ff3a53f9ae5b72793068a0b84f919b3fd8", "filename": "src/librustc/middle/trans/tvec.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftvec.rs?ref=5ca4cdc7b8fb8b9c3fd1a6160db31ff2f4b5b957", "patch": "@@ -265,7 +265,7 @@ pub fn trans_lit_str(bcx: @mut Block,\n         Ignore => bcx,\n         SaveIn(lldest) => {\n             unsafe {\n-                let bytes = str_lit.len(); // count null-terminator too\n+                let bytes = str_lit.len();\n                 let llbytes = C_uint(bcx.ccx(), bytes);\n                 let llcstr = C_cstr(bcx.ccx(), str_lit);\n                 let llcstr = llvm::LLVMConstPointerCast(llcstr, Type::i8p().to_ref());"}]}