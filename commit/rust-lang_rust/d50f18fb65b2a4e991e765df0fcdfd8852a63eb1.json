{"sha": "d50f18fb65b2a4e991e765df0fcdfd8852a63eb1", "node_id": "C_kwDOAAsO6NoAKGQ1MGYxOGZiNjViMmE0ZTk5MWU3NjVkZjBmY2RmZDg4NTJhNjNlYjE", "commit": {"author": {"name": "TJ DeVries", "email": "devries.timothyj@gmail.com", "date": "2021-12-01T16:43:52Z"}, "committer": {"name": "TJ DeVries", "email": "devries.timothyj@gmail.com", "date": "2021-12-01T16:43:52Z"}, "message": "fixup: properly handle all associated items", "tree": {"sha": "9bdad171d12e3eefd8173427673d552fd16be1f9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9bdad171d12e3eefd8173427673d552fd16be1f9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1", "html_url": "https://github.com/rust-lang/rust/commit/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1/comments", "author": {"login": "tjdevries", "id": 4466899, "node_id": "MDQ6VXNlcjQ0NjY4OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4466899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tjdevries", "html_url": "https://github.com/tjdevries", "followers_url": "https://api.github.com/users/tjdevries/followers", "following_url": "https://api.github.com/users/tjdevries/following{/other_user}", "gists_url": "https://api.github.com/users/tjdevries/gists{/gist_id}", "starred_url": "https://api.github.com/users/tjdevries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tjdevries/subscriptions", "organizations_url": "https://api.github.com/users/tjdevries/orgs", "repos_url": "https://api.github.com/users/tjdevries/repos", "events_url": "https://api.github.com/users/tjdevries/events{/privacy}", "received_events_url": "https://api.github.com/users/tjdevries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tjdevries", "id": 4466899, "node_id": "MDQ6VXNlcjQ0NjY4OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4466899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tjdevries", "html_url": "https://github.com/tjdevries", "followers_url": "https://api.github.com/users/tjdevries/followers", "following_url": "https://api.github.com/users/tjdevries/following{/other_user}", "gists_url": "https://api.github.com/users/tjdevries/gists{/gist_id}", "starred_url": "https://api.github.com/users/tjdevries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tjdevries/subscriptions", "organizations_url": "https://api.github.com/users/tjdevries/orgs", "repos_url": "https://api.github.com/users/tjdevries/repos", "events_url": "https://api.github.com/users/tjdevries/events{/privacy}", "received_events_url": "https://api.github.com/users/tjdevries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09c7e22ec2705a91ee9da28c9e38810fab97eb3d", "url": "https://api.github.com/repos/rust-lang/rust/commits/09c7e22ec2705a91ee9da28c9e38810fab97eb3d", "html_url": "https://github.com/rust-lang/rust/commit/09c7e22ec2705a91ee9da28c9e38810fab97eb3d"}], "stats": {"total": 55, "additions": 33, "deletions": 22}, "files": [{"sha": "e691bfb06f10037ac99bb0ba3507a31dfdf9b9e4", "filename": "crates/ide/src/moniker.rs", "status": "modified", "additions": 33, "deletions": 22, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1/crates%2Fide%2Fsrc%2Fmoniker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d50f18fb65b2a4e991e765df0fcdfd8852a63eb1/crates%2Fide%2Fsrc%2Fmoniker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fmoniker.rs?ref=d50f18fb65b2a4e991e765df0fcdfd8852a63eb1", "patch": "@@ -107,18 +107,16 @@ pub(crate) fn def_to_moniker(\n     let mut path = vec![];\n     path.extend(module.path_to_root(db).into_iter().filter_map(|x| x.name(db)));\n \n-    match def {\n-        Definition::Field(it) => path.push(it.parent_def(db).name(db)),\n-        Definition::Function(it) => {\n-            // Ensure that trait functions are properly namespaced with the trait name\n-            if let Some(assoc) = it.as_assoc_item(db) {\n-                let container = assoc.container(db);\n-                if let AssocItemContainer::Trait(parent_trait) = container {\n-                    path.push(parent_trait.name(db));\n-                }\n-            }\n+    // Handle associated items within a trait\n+    if let Some(assoc) = def.as_assoc_item(db) {\n+        let container = assoc.container(db);\n+        if let AssocItemContainer::Trait(parent_trait) = container {\n+            path.push(parent_trait.name(db));\n         }\n-        _ => (),\n+    }\n+\n+    if let Definition::Field(it) = def {\n+        path.push(it.parent_def(db).name(db));\n     }\n \n     path.push(def.name(db)?);\n@@ -208,11 +206,6 @@ pub mod module {\n     fn moniker_for_trait() {\n         check_moniker(\n             r#\"\n-//- /lib.rs crate:main deps:foo\n-use foo::module::func;\n-fn main() {\n-    func();\n-}\n //- /foo/lib.rs crate:foo@CratesIo:0.1.0,https://a.b/foo.git\n pub mod module {\n     pub trait MyTrait {\n@@ -224,19 +217,37 @@ pub mod module {\n             r#\"PackageInformation { name: \"foo\", repo: \"https://a.b/foo.git\", version: \"0.1.0\" }\"#,\n             MonikerKind::Export,\n         );\n+    }\n+\n+    #[test]\n+    fn moniker_for_trait_constant() {\n         check_moniker(\n             r#\"\n-//- /lib.rs crate:main deps:foo\n-use foo::module::func;\n-fn main() {\n-    func();\n+//- /foo/lib.rs crate:foo@CratesIo:0.1.0,https://a.b/foo.git\n+pub mod module {\n+    pub trait MyTrait {\n+        const MY_CONST$0: u8;\n+    }\n }\n+\"#,\n+            \"foo::module::MyTrait::MY_CONST\",\n+            r#\"PackageInformation { name: \"foo\", repo: \"https://a.b/foo.git\", version: \"0.1.0\" }\"#,\n+            MonikerKind::Export,\n+        );\n+    }\n+\n+    #[test]\n+    fn moniker_for_trait_type() {\n+        check_moniker(\n+            r#\"\n //- /foo/lib.rs crate:foo@CratesIo:0.1.0,https://a.b/foo.git\n pub mod module {\n-    pub fn func$0() {}\n+    pub trait MyTrait {\n+        type MyType$0;\n+    }\n }\n \"#,\n-            \"foo::module::func\",\n+            \"foo::module::MyTrait::MyType\",\n             r#\"PackageInformation { name: \"foo\", repo: \"https://a.b/foo.git\", version: \"0.1.0\" }\"#,\n             MonikerKind::Export,\n         );"}]}