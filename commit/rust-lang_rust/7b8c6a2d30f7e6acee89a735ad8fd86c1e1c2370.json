{"sha": "7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiOGM2YTJkMzBmN2U2YWNlZTg5YTczNWFkOGZkODZjMWUxYzIzNzA=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-06-07T22:13:28Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-06-24T19:27:49Z"}, "message": "Add E0607", "tree": {"sha": "9b0b222278cead9e0d8164fe78115cf39ac7dd8f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9b0b222278cead9e0d8164fe78115cf39ac7dd8f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "html_url": "https://github.com/rust-lang/rust/commit/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "30effc14e4ae23a682495ceadf7f56039b02e747", "url": "https://api.github.com/repos/rust-lang/rust/commits/30effc14e4ae23a682495ceadf7f56039b02e747", "html_url": "https://github.com/rust-lang/rust/commit/30effc14e4ae23a682495ceadf7f56039b02e747"}], "stats": {"total": 51, "additions": 42, "deletions": 9}, "files": [{"sha": "52962e1e478c07adfd0c11e4e7ea68f55f620927", "filename": "src/librustc_typeck/check/cast.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs?ref=7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "patch": "@@ -225,14 +225,10 @@ impl<'a, 'gcx, 'tcx> CastCheck<'tcx> {\n                                 .emit();\n             }\n             CastError::SizedUnsizedCast => {\n-                fcx.type_error_message(self.span,\n-                                       |actual| {\n-                                           format!(\"cannot cast thin pointer `{}` to fat pointer \\\n-                                                    `{}`\",\n-                                                   actual,\n-                                                   fcx.ty_to_string(self.cast_ty))\n-                                       },\n-                                       self.expr_ty)\n+                struct_span_err!(fcx.tcx.sess, self.span, E0607,\n+                                 \"cannot cast thin pointer `{}` to fat pointer `{}`\",\n+                                 self.expr_ty,\n+                                 fcx.ty_to_string(self.cast_ty)).emit();\n             }\n         }\n     }"}, {"sha": "ae13e236743dd525f5f6ee86668100c893e98be0", "filename": "src/librustc_typeck/diagnostics.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Flibrustc_typeck%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Flibrustc_typeck%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fdiagnostics.rs?ref=7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "patch": "@@ -4270,6 +4270,29 @@ let y: u32 = *x as u32; // We dereference it first and then cast it.\n ```\n \"##,\n \n+E0607: r##\"\n+A cast between a thin and a fat pointer was attempted.\n+\n+Erroneous code example:\n+\n+```compile_fail,E0607\n+let v = 0 as *const u8;\n+v as *const [u8];\n+```\n+\n+First: what are thin and fat pointers?\n+\n+Thin pointers are \"simple\" pointers that simply reference a memory address.\n+\n+Fat pointers are pointers referencing Dynamically Sized Types (also called DST).\n+They don't have a statically known size, therefore they can only exist behind\n+some kind of pointers that contain additional information. Slices and trait\n+objects are DSTs.\n+\n+So in order to fix this error, don't try to cast directly between thin and fat\n+pointers.\n+\"##,\n+\n E0609: r##\"\n Attempted to access a non-existent field in a struct.\n "}, {"sha": "fa761f2c17896149398c421df6984145b72df3b3", "filename": "src/test/compile-fail/E0607.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Ftest%2Fcompile-fail%2FE0607.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Ftest%2Fcompile-fail%2FE0607.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0607.rs?ref=7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let v = 0 as *const u8;\n+    v as *const [u8]; //~ ERROR E0607\n+}"}, {"sha": "50e1815057928537328387b9eb9da1309e8038a1", "filename": "src/test/ui/mismatched_types/cast-rfc0401.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Ftest%2Fui%2Fmismatched_types%2Fcast-rfc0401.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370/src%2Ftest%2Fui%2Fmismatched_types%2Fcast-rfc0401.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Fcast-rfc0401.stderr?ref=7b8c6a2d30f7e6acee89a735ad8fd86c1e1c2370", "patch": "@@ -156,7 +156,7 @@ error[E0606]: casting `usize` as `*const [u8]` is invalid\n 61 |     let _ = 42usize as *const [u8];\n    |             ^^^^^^^^^^^^^^^^^^^^^^\n \n-error: cannot cast thin pointer `*const u8` to fat pointer `*const [u8]`\n+error[E0607]: cannot cast thin pointer `*const u8` to fat pointer `*const [u8]`\n   --> $DIR/cast-rfc0401.rs:62:13\n    |\n 62 |     let _ = v as *const [u8];"}]}