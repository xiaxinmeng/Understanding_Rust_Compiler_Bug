{"sha": "08ce8bb70320f23d16a89797fc906529118213da", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4Y2U4YmI3MDMyMGYyM2QxNmE4OTc5N2ZjOTA2NTI5MTE4MjEzZGE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-13T16:00:58Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-13T16:00:58Z"}, "message": "Auto merge of #7215 - ThibsG:WrongSelfFix7179, r=Manishearth\n\nTrigger [`wrong_self_convention`] only if it has implicit self\n\nLint [`wrong_self_convention`] only if the impl or trait has `self` _per s\u00e9_.\n\nFixes: #7179\n\nchangelog: trigger [`wrong_self_convention`] only if it has implicit self", "tree": {"sha": "78974ade0a1129342c1816d311aba6129da9d472", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/78974ade0a1129342c1816d311aba6129da9d472"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/08ce8bb70320f23d16a89797fc906529118213da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/08ce8bb70320f23d16a89797fc906529118213da", "html_url": "https://github.com/rust-lang/rust/commit/08ce8bb70320f23d16a89797fc906529118213da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/08ce8bb70320f23d16a89797fc906529118213da/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fd9975249094443ba4584d8946f6d0827ff5271", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fd9975249094443ba4584d8946f6d0827ff5271", "html_url": "https://github.com/rust-lang/rust/commit/1fd9975249094443ba4584d8946f6d0827ff5271"}, {"sha": "cd241b33cb8379311286f53c4afc6e671ddfded1", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd241b33cb8379311286f53c4afc6e671ddfded1", "html_url": "https://github.com/rust-lang/rust/commit/cd241b33cb8379311286f53c4afc6e671ddfded1"}], "stats": {"total": 66, "additions": 56, "deletions": 10}, "files": [{"sha": "e0d29682146b66f9b3e8b2e0dcbccdad8231081e", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 14, "deletions": 10, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/08ce8bb70320f23d16a89797fc906529118213da/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08ce8bb70320f23d16a89797fc906529118213da/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=08ce8bb70320f23d16a89797fc906529118213da", "patch": "@@ -1838,16 +1838,18 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n                     }\n                 }\n \n-                wrong_self_convention::check(\n-                    cx,\n-                    &name,\n-                    item.vis.node.is_pub(),\n-                    self_ty,\n-                    first_arg_ty,\n-                    first_arg.pat.span,\n-                    implements_trait,\n-                    false\n-                );\n+                if sig.decl.implicit_self.has_implicit_self() {\n+                    wrong_self_convention::check(\n+                        cx,\n+                        &name,\n+                        item.vis.node.is_pub(),\n+                        self_ty,\n+                        first_arg_ty,\n+                        first_arg.pat.span,\n+                        implements_trait,\n+                        false\n+                    );\n+                }\n             }\n         }\n \n@@ -1903,7 +1905,9 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n \n         if_chain! {\n             if let TraitItemKind::Fn(ref sig, _) = item.kind;\n+            if sig.decl.implicit_self.has_implicit_self();\n             if let Some(first_arg_ty) = sig.decl.inputs.iter().next();\n+\n             then {\n                 let first_arg_span = first_arg_ty.span;\n                 let first_arg_ty = hir_ty_to_ty(cx.tcx, first_arg_ty);"}, {"sha": "b2c6503de49957738112e1fd7e69a69ac43795c6", "filename": "tests/ui/wrong_self_convention2.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/08ce8bb70320f23d16a89797fc906529118213da/tests%2Fui%2Fwrong_self_convention2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08ce8bb70320f23d16a89797fc906529118213da/tests%2Fui%2Fwrong_self_convention2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwrong_self_convention2.rs?ref=08ce8bb70320f23d16a89797fc906529118213da", "patch": "@@ -42,3 +42,26 @@ mod issue7032 {\n         }\n     }\n }\n+\n+mod issue7179 {\n+    pub struct S(i32);\n+\n+    impl S {\n+        // don't trigger (`s` is not `self`)\n+        pub fn from_be(s: Self) -> Self {\n+            S(i32::from_be(s.0))\n+        }\n+\n+        // lint\n+        pub fn from_be_self(self) -> Self {\n+            S(i32::from_be(self.0))\n+        }\n+    }\n+\n+    trait T {\n+        // don't trigger (`s` is not `self`)\n+        fn from_be(s: Self) -> Self;\n+        // lint\n+        fn from_be_self(self) -> Self;\n+    }\n+}"}, {"sha": "d2d74ce099e3da46a3134b20385a2ac82ff4f519", "filename": "tests/ui/wrong_self_convention2.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/08ce8bb70320f23d16a89797fc906529118213da/tests%2Fui%2Fwrong_self_convention2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/08ce8bb70320f23d16a89797fc906529118213da/tests%2Fui%2Fwrong_self_convention2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwrong_self_convention2.stderr?ref=08ce8bb70320f23d16a89797fc906529118213da", "patch": "@@ -0,0 +1,19 @@\n+error: methods called `from_*` usually take no `self`\n+  --> $DIR/wrong_self_convention2.rs:56:29\n+   |\n+LL |         pub fn from_be_self(self) -> Self {\n+   |                             ^^^^\n+   |\n+   = note: `-D clippy::wrong-self-convention` implied by `-D warnings`\n+   = help: consider choosing a less ambiguous name\n+\n+error: methods called `from_*` usually take no `self`\n+  --> $DIR/wrong_self_convention2.rs:65:25\n+   |\n+LL |         fn from_be_self(self) -> Self;\n+   |                         ^^^^\n+   |\n+   = help: consider choosing a less ambiguous name\n+\n+error: aborting due to 2 previous errors\n+"}]}