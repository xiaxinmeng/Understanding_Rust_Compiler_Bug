{"sha": "9de6beeae28841d7a8b6bc06d6b66a30c723939d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkZTZiZWVhZTI4ODQxZDdhOGI2YmMwNmQ2YjY2YTMwYzcyMzkzOWQ=", "commit": {"author": {"name": "Kevyn Grasso", "email": "kevgrasso@gmail.com", "date": "2018-11-12T20:50:27Z"}, "committer": {"name": "Kevyn Grasso", "email": "kevgrasso@gmail.com", "date": "2018-12-14T01:16:03Z"}, "message": "debug logging, added conditional error message, tests updated", "tree": {"sha": "e8b3eda32b8e2dc2ea07edc119ff4fc1ed321c63", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e8b3eda32b8e2dc2ea07edc119ff4fc1ed321c63"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9de6beeae28841d7a8b6bc06d6b66a30c723939d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9de6beeae28841d7a8b6bc06d6b66a30c723939d", "html_url": "https://github.com/rust-lang/rust/commit/9de6beeae28841d7a8b6bc06d6b66a30c723939d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9de6beeae28841d7a8b6bc06d6b66a30c723939d/comments", "author": {"login": "kevgrasso", "id": 480789, "node_id": "MDQ6VXNlcjQ4MDc4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/480789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kevgrasso", "html_url": "https://github.com/kevgrasso", "followers_url": "https://api.github.com/users/kevgrasso/followers", "following_url": "https://api.github.com/users/kevgrasso/following{/other_user}", "gists_url": "https://api.github.com/users/kevgrasso/gists{/gist_id}", "starred_url": "https://api.github.com/users/kevgrasso/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kevgrasso/subscriptions", "organizations_url": "https://api.github.com/users/kevgrasso/orgs", "repos_url": "https://api.github.com/users/kevgrasso/repos", "events_url": "https://api.github.com/users/kevgrasso/events{/privacy}", "received_events_url": "https://api.github.com/users/kevgrasso/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kevgrasso", "id": 480789, "node_id": "MDQ6VXNlcjQ4MDc4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/480789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kevgrasso", "html_url": "https://github.com/kevgrasso", "followers_url": "https://api.github.com/users/kevgrasso/followers", "following_url": "https://api.github.com/users/kevgrasso/following{/other_user}", "gists_url": "https://api.github.com/users/kevgrasso/gists{/gist_id}", "starred_url": "https://api.github.com/users/kevgrasso/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kevgrasso/subscriptions", "organizations_url": "https://api.github.com/users/kevgrasso/orgs", "repos_url": "https://api.github.com/users/kevgrasso/repos", "events_url": "https://api.github.com/users/kevgrasso/events{/privacy}", "received_events_url": "https://api.github.com/users/kevgrasso/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "286dc37d1bd30ecd419e889c7f3888575deac5fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/286dc37d1bd30ecd419e889c7f3888575deac5fc", "html_url": "https://github.com/rust-lang/rust/commit/286dc37d1bd30ecd419e889c7f3888575deac5fc"}], "stats": {"total": 28, "additions": 24, "deletions": 4}, "files": [{"sha": "e449fece6b474a2b33ccc7ddf9041df7c1deab41", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/9de6beeae28841d7a8b6bc06d6b66a30c723939d/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9de6beeae28841d7a8b6bc06d6b66a30c723939d/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=9de6beeae28841d7a8b6bc06d6b66a30c723939d", "patch": "@@ -3010,6 +3010,7 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n         // Visit all direct subpatterns of this pattern.\n         let outer_pat_id = pat.id;\n         pat.walk(&mut |pat| {\n+            debug!(\"resolve_pattern pat={:?} node={:?}\", pat, pat.node);\n             match pat.node {\n                 PatKind::Ident(bmode, ident, ref opt_pat) => {\n                     // First try to resolve the identifier as some existing\n@@ -3166,6 +3167,7 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n                  format!(\"not found in {}\", mod_str),\n                  item_span)\n             };\n+\n             let code = DiagnosticId::Error(code.into());\n             let mut err = this.session.struct_span_err_with_code(base_span, &base_msg, code);\n \n@@ -3189,11 +3191,22 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n                 return (err, Vec::new());\n             }\n             if is_self_value(path, ns) {\n+                debug!(\"smart_resolve_path_fragment E0424 source:{:?}\", source);\n+\n                 __diagnostic_used!(E0424);\n                 err.code(DiagnosticId::Error(\"E0424\".into()));\n-                err.span_label(span, format!(\"`self` value is a keyword \\\n-                                               only available in \\\n-                                               methods with `self` parameter\"));\n+                err.span_label(span, match source {\n+                    PathSource::Pat => {\n+                        format!(\"`self` value is a keyword \\\n+                                and may not be bound to \\\n+                                variables or shadowed\")\n+                    }\n+                    _ => {\n+                        format!(\"`self` value is a keyword \\\n+                                only available in methods \\\n+                                with `self` parameter\")\n+                    }\n+                });\n                 return (err, Vec::new());\n             }\n "}, {"sha": "20d42da1c0c40f5a96026c40777b2046d1f55f2c", "filename": "src/test/ui/error-codes/E0424.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9de6beeae28841d7a8b6bc06d6b66a30c723939d/src%2Ftest%2Fui%2Ferror-codes%2FE0424.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9de6beeae28841d7a8b6bc06d6b66a30c723939d/src%2Ftest%2Fui%2Ferror-codes%2FE0424.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0424.rs?ref=9de6beeae28841d7a8b6bc06d6b66a30c723939d", "patch": "@@ -19,4 +19,5 @@ impl Foo {\n }\n \n fn main () {\n+    let self = \"self\"; //~ ERROR E0424\n }"}, {"sha": "5eccd7d2283fedfb32226e272f1676937256a89b", "filename": "src/test/ui/error-codes/E0424.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9de6beeae28841d7a8b6bc06d6b66a30c723939d/src%2Ftest%2Fui%2Ferror-codes%2FE0424.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9de6beeae28841d7a8b6bc06d6b66a30c723939d/src%2Ftest%2Fui%2Ferror-codes%2FE0424.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0424.stderr?ref=9de6beeae28841d7a8b6bc06d6b66a30c723939d", "patch": "@@ -4,6 +4,12 @@ error[E0424]: expected value, found module `self`\n LL |         self.bar(); //~ ERROR E0424\n    |         ^^^^ `self` value is a keyword only available in methods with `self` parameter\n \n-error: aborting due to previous error\n+error[E0424]: expected unit struct/variant or constant, found module `self`\n+  --> $DIR/E0424.rs:22:9\n+   |\n+LL |     let self = \"self\"; //~ ERROR E0424\n+   |         ^^^^ `self` value is a keyword and may not be bound to variables or shadowed\n+\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0424`."}]}