{"sha": "50e410c240bc8f147e7bf1efb5741d41c67e6328", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwZTQxMGMyNDBiYzhmMTQ3ZTdiZjFlZmI1NzQxZDQxYzY3ZTYzMjg=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2018-10-10T22:59:20Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2018-10-10T22:59:20Z"}, "message": "Rollup merge of #54870 - flip1995:stabilize_tool_lints, r=Manishearth\n\nFixes #47311.\nr? @nrc", "tree": {"sha": "b9dc45ca13fbd2063b9283881d790ec790e6f45d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9dc45ca13fbd2063b9283881d790ec790e6f45d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50e410c240bc8f147e7bf1efb5741d41c67e6328", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50e410c240bc8f147e7bf1efb5741d41c67e6328", "html_url": "https://github.com/rust-lang/rust/commit/50e410c240bc8f147e7bf1efb5741d41c67e6328", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50e410c240bc8f147e7bf1efb5741d41c67e6328/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742", "html_url": "https://github.com/rust-lang/rust/commit/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742"}, {"sha": "ffe15277ff182b1981b2d46264882bca31b89d13", "url": "https://api.github.com/repos/rust-lang/rust/commits/ffe15277ff182b1981b2d46264882bca31b89d13", "html_url": "https://github.com/rust-lang/rust/commit/ffe15277ff182b1981b2d46264882bca31b89d13"}], "stats": {"total": 128, "additions": 11, "deletions": 117}, "files": [{"sha": "5c0d33b5ab0c492f6b3712165e5496cee3bf4fbd", "filename": "src/doc/unstable-book/src/language-features/tool-lints.md", "status": "removed", "additions": 0, "deletions": 35, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Ftool-lints.md", "raw_url": "https://github.com/rust-lang/rust/raw/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Ftool-lints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Ftool-lints.md?ref=8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742", "patch": "@@ -1,35 +0,0 @@\n-# `tool_lints`\n-\n-The tracking issue for this feature is: [#44690]\n-\n-[#44690]: https://github.com/rust-lang/rust/issues/44690\n-\n-------------------------\n-\n-Tool lints let you use scoped lints, to `allow`, `warn`, `deny` or `forbid` lints of\n-certain tools.\n-\n-Currently `clippy` is the only available lint tool.\n-\n-It is recommended for lint tools to implement the scoped lints like this:\n-\n-- `#[_(TOOL_NAME::lintname)]`: for lint names\n-- `#[_(TOOL_NAME::lintgroup)]`: for groups of lints\n-- `#[_(TOOL_NAME::all)]`: for (almost[^1]) all lints\n-\n-## An example\n-\n-```rust\n-#![feature(tool_lints)]\n-\n-#![warn(clippy::pedantic)]\n-\n-#[allow(clippy::filter_map)]\n-fn main() {\n-    let v = vec![0; 10];\n-    let _ = v.into_iter().filter(|&x| x < 1).map(|x| x + 1).collect::<Vec<_>>();\n-    println!(\"No filter_map()!\");\n-}\n-```\n-\n-[^1]: Some defined lint groups can be excluded here."}, {"sha": "950754a07ab09787b94e05db5ca8b381a2e9ae29", "filename": "src/librustc/lint/levels.rs", "status": "modified", "additions": 3, "deletions": 24, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Flibrustc%2Flint%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Flibrustc%2Flint%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Flevels.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -18,11 +18,10 @@ use lint::context::CheckLintNameResult;\n use lint::{self, Lint, LintId, Level, LintSource};\n use rustc_data_structures::stable_hasher::{HashStable, ToStableHashKey,\n                                            StableHasher, StableHasherResult};\n-use session::{config::nightly_options, Session};\n+use session::Session;\n use syntax::ast;\n use syntax::attr;\n use syntax::source_map::MultiSpan;\n-use syntax::feature_gate;\n use syntax::symbol::Symbol;\n use util::nodemap::FxHashMap;\n \n@@ -228,28 +227,14 @@ impl<'a> LintLevelsBuilder<'a> {\n                     }\n                 };\n                 let tool_name = if let Some(lint_tool) = word.is_scoped() {\n-                    let gate_feature = !self.sess.features_untracked().tool_lints;\n-                    let known_tool = attr::is_known_lint_tool(lint_tool);\n-                    if gate_feature {\n-                        feature_gate::emit_feature_err(\n-                            &sess.parse_sess,\n-                            \"tool_lints\",\n-                            word.span,\n-                            feature_gate::GateIssue::Language,\n-                            &format!(\"scoped lint `{}` is experimental\", word.ident),\n-                        );\n-                    }\n-                    if !known_tool {\n+                    if !attr::is_known_lint_tool(lint_tool) {\n                         span_err!(\n                             sess,\n                             lint_tool.span,\n                             E0710,\n                             \"an unknown tool name found in scoped lint: `{}`\",\n                             word.ident\n                         );\n-                    }\n-\n-                    if gate_feature || !known_tool {\n                         continue;\n                     }\n \n@@ -299,13 +284,7 @@ impl<'a> LintLevelsBuilder<'a> {\n                                     \"change it to\",\n                                     new_lint_name.to_string(),\n                                     Applicability::MachineApplicable,\n-                                );\n-\n-                                if nightly_options::is_nightly_build() {\n-                                    err.emit();\n-                                } else {\n-                                    err.cancel();\n-                                }\n+                                ).emit();\n \n                                 let src = LintSource::Node(Symbol::intern(&new_lint_name), li.span);\n                                 for id in ids {"}, {"sha": "b86b92fb29e60529d9a38f436d01d887c29c9832", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -433,9 +433,6 @@ declare_features! (\n     // #[doc(alias = \"...\")]\n     (active, doc_alias, \"1.27.0\", Some(50146), None),\n \n-    // Scoped lints\n-    (active, tool_lints, \"1.28.0\", Some(44690), None),\n-\n     // Allows irrefutable patterns in if-let and while-let statements (RFC 2086)\n     (active, irrefutable_let_patterns, \"1.27.0\", Some(44495), None),\n \n@@ -682,6 +679,8 @@ declare_features! (\n     (accepted, pattern_parentheses, \"1.31.0\", Some(51087), None),\n     // Allows the definition of `const fn` functions.\n     (accepted, min_const_fn, \"1.31.0\", Some(53555), None),\n+    // Scoped lints\n+    (accepted, tool_lints, \"1.31.0\", Some(44690), None),\n );\n \n // If you change this, please modify src/doc/unstable-book as well. You must"}, {"sha": "2705c03598a0d2c2bb84560dadc96478e7740b2e", "filename": "src/test/run-pass/tool_lints.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Frun-pass%2Ftool_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Frun-pass%2Ftool_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftool_lints.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(tool_lints)]\n+\n #![deny(unknown_lints)]\n \n #[allow(clippy::almost_swapped)]"}, {"sha": "57df3e072a8dc988c56737177fd5e532223e10cd", "filename": "src/test/run-pass/tool_lints_2018_preview.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Frun-pass%2Ftool_lints_2018_preview.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Frun-pass%2Ftool_lints_2018_preview.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftool_lints_2018_preview.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(tool_lints)]\n+\n #![feature(rust_2018_preview)]\n #![deny(unknown_lints)]\n "}, {"sha": "11b70d1d7809cb20176513fe0e1c89982a46a228", "filename": "src/test/ui-fulldeps/lint_tool_test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui-fulldeps%2Flint_tool_test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui-fulldeps%2Flint_tool_test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Flint_tool_test.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -11,8 +11,8 @@\n // aux-build:lint_tool_test.rs\n // ignore-stage1\n // compile-flags: --cfg foo\n+\n #![feature(plugin)]\n-#![feature(tool_lints)]\n #![plugin(lint_tool_test)]\n #![allow(dead_code)]\n #![cfg_attr(foo, warn(test_lint))]"}, {"sha": "c311eb7ed7ae13b39bbb15fd61c1b2f0d1afd486", "filename": "src/test/ui/feature-gates/feature-gate-tool_lints-fail.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints-fail.rs?ref=8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742", "patch": "@@ -1,12 +0,0 @@\n-// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-#[warn(clippy::assign_ops)] //~ ERROR scoped lint `clippy::assign_ops` is experimental\n-fn main() {}"}, {"sha": "33ee79cd2011ab23bb1a0e27e8f1ac794a4e5713", "filename": "src/test/ui/feature-gates/feature-gate-tool_lints-fail.stderr", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints-fail.stderr?ref=8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742", "patch": "@@ -1,11 +0,0 @@\n-error[E0658]: scoped lint `clippy::assign_ops` is experimental (see issue #44690)\n-  --> $DIR/feature-gate-tool_lints-fail.rs:11:8\n-   |\n-LL | #[warn(clippy::assign_ops)] //~ ERROR scoped lint `clippy::assign_ops` is experimental\n-   |        ^^^^^^^^^^^^^^^^^^\n-   |\n-   = help: add #![feature(tool_lints)] to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "3ef67982be9a4c1025c36b0b835159a84fa841aa", "filename": "src/test/ui/feature-gates/feature-gate-tool_lints.rs", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints.rs?ref=8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742", "patch": "@@ -1,15 +0,0 @@\n-// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-#[warn(clippy::decimal_literal_representation)]\n-//~^ ERROR scoped lint `clippy::decimal_literal_representation` is experimental\n-fn main() {\n-    let a = 65_535;\n-}"}, {"sha": "8019b1e6a28f6d89fa3171f91a5880892dc2e366", "filename": "src/test/ui/feature-gates/feature-gate-tool_lints.stderr", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-tool_lints.stderr?ref=8ebc6d6dbbfe1ccc9a72d003d13c3d267c91c742", "patch": "@@ -1,11 +0,0 @@\n-error[E0658]: scoped lint `clippy::decimal_literal_representation` is experimental (see issue #44690)\n-  --> $DIR/feature-gate-tool_lints.rs:11:8\n-   |\n-LL | #[warn(clippy::decimal_literal_representation)]\n-   |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = help: add #![feature(tool_lints)] to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "4134fca1ce6caa31be3d148495cd73e50bef8388", "filename": "src/test/ui/tool_lints-fail.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui%2Ftool_lints-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui%2Ftool_lints-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftool_lints-fail.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -10,7 +10,7 @@\n \n // Don't allow tool_lints, which aren't scoped\n \n-#![feature(tool_lints)]\n+\n #![deny(unknown_lints)]\n \n #![deny(clippy)] //~ ERROR: unknown lint: `clippy`"}, {"sha": "001f2f11e5cb358c17d94222d0ba3fa9214fb956", "filename": "src/test/ui/tool_lints.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui%2Ftool_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui%2Ftool_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftool_lints.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(tool_lints)]\n+\n \n #[warn(foo::bar)]\n //~^ ERROR an unknown tool name found in scoped lint: `foo::bar`"}, {"sha": "a1d6c27e518e514268c2221e2e611ea450161d77", "filename": "src/test/ui/unknown-lint-tool-name.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui%2Funknown-lint-tool-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e410c240bc8f147e7bf1efb5741d41c67e6328/src%2Ftest%2Fui%2Funknown-lint-tool-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funknown-lint-tool-name.rs?ref=50e410c240bc8f147e7bf1efb5741d41c67e6328", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(tool_lints)]\n+\n \n #![deny(foo::bar)] //~ ERROR an unknown tool name found in scoped lint: `foo::bar`\n "}]}