{"sha": "82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "node_id": "C_kwDOAAsO6NoAKDgyMjE1Y2U2NDY4MGE2ZjBiZjU1YTQyZWJhNmU3YThmZjc1NmM1M2Y", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-03-10T18:00:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-10T18:00:08Z"}, "message": "Rollup merge of #94740 - GuillaumeGomez:unify-impl-blocks, r=notriddle\n\nUnify impl blocks by wrapping them into a div\n\nThe blanket and \"auto traits\" sections are wrapped into a `div` with an ID. This PR fixes this incoherence by wrapping each impl section (the \"deref impl\" and the \"inherent impl\" sections were missing it). It'll also make some tests simpler to write.\n\nr? `````@notriddle`````", "tree": {"sha": "cc9de5885d56279f3d1e19d81b0185775e3d5337", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cc9de5885d56279f3d1e19d81b0185775e3d5337"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiKjyoCRBK7hj4Ov3rIwAAnysIAERXe1hNW3+XzsNakgDFmP9I\nirahNBwCtjGWuTBUhzDaK2FG4wkbjarq7BFYR46TKMcgYEj8rsKBMThgp3AQaSEr\n0DZolguL4d8Bitm2LG+WG/DjoQWZoEiIE/tPCUWrdZXbBZwsGhJitSgVoqBU81Lb\nBOkt+5jpmtQBtsBoX1TPqB8tjlHmYF2mQxJSKhVdU9/CErZ9/YTRoT4IEydp7Qwp\nahwsq2BIhvB3t0olJ6MD4CIZ+uC8tHCcyj8EkF2mpV/eqxwPLIxDWMPQcjnHmbzC\nYLjTh0IGwhNmvNUYt+vCkxhgYdgCnjHqnKKu4dpylkYpsDNg+tmuW4p5fxxW/yw=\n=2lLo\n-----END PGP SIGNATURE-----\n", "payload": "tree cc9de5885d56279f3d1e19d81b0185775e3d5337\nparent f1a677789ae12780fcc49fb449be8b336528b080\nparent fbd9c284d7f018db07da8aa6e03cffdf0ce1786b\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1646935208 +0100\ncommitter GitHub <noreply@github.com> 1646935208 +0100\n\nRollup merge of #94740 - GuillaumeGomez:unify-impl-blocks, r=notriddle\n\nUnify impl blocks by wrapping them into a div\n\nThe blanket and \"auto traits\" sections are wrapped into a `div` with an ID. This PR fixes this incoherence by wrapping each impl section (the \"deref impl\" and the \"inherent impl\" sections were missing it). It'll also make some tests simpler to write.\n\nr? `````@notriddle`````\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "html_url": "https://github.com/rust-lang/rust/commit/82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1a677789ae12780fcc49fb449be8b336528b080", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1a677789ae12780fcc49fb449be8b336528b080", "html_url": "https://github.com/rust-lang/rust/commit/f1a677789ae12780fcc49fb449be8b336528b080"}, {"sha": "fbd9c284d7f018db07da8aa6e03cffdf0ce1786b", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbd9c284d7f018db07da8aa6e03cffdf0ce1786b", "html_url": "https://github.com/rust-lang/rust/commit/fbd9c284d7f018db07da8aa6e03cffdf0ce1786b"}], "stats": {"total": 41, "additions": 24, "deletions": 17}, "files": [{"sha": "f2856690d257a91eeecdf30c6e07e1c35e830614", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -1460,6 +1460,7 @@ fn init_id_map() -> FxHashMap<String, usize> {\n     map.insert(\"provided-methods\".to_owned(), 1);\n     map.insert(\"implementors\".to_owned(), 1);\n     map.insert(\"synthetic-implementors\".to_owned(), 1);\n+    map.insert(\"implementations-list\".to_owned(), 1);\n     map.insert(\"trait-implementations-list\".to_owned(), 1);\n     map.insert(\"synthetic-implementations-list\".to_owned(), 1);\n     map.insert(\"blanket-implementations-list\".to_owned(), 1);"}, {"sha": "26f29a3524b00cf03763b36d98f60623374251f8", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -1065,14 +1065,15 @@ fn render_assoc_items_inner(\n     let (non_trait, traits): (Vec<_>, _) = v.iter().partition(|i| i.inner_impl().trait_.is_none());\n     if !non_trait.is_empty() {\n         let mut tmp_buf = Buffer::empty_from(w);\n-        let render_mode = match what {\n+        let (render_mode, id) = match what {\n             AssocItemRender::All => {\n                 tmp_buf.write_str(\n                     \"<h2 id=\\\"implementations\\\" class=\\\"small-section-header\\\">\\\n-                         Implementations<a href=\\\"#implementations\\\" class=\\\"anchor\\\"></a>\\\n-                    </h2>\",\n+                         Implementations\\\n+                         <a href=\\\"#implementations\\\" class=\\\"anchor\\\"></a>\\\n+                     </h2>\",\n                 );\n-                RenderMode::Normal\n+                (RenderMode::Normal, \"implementations-list\".to_owned())\n             }\n             AssocItemRender::DerefFor { trait_, type_, deref_mut_ } => {\n                 let id =\n@@ -1090,7 +1091,7 @@ fn render_assoc_items_inner(\n                     trait_ = trait_.print(cx),\n                     type_ = type_.print(cx),\n                 );\n-                RenderMode::ForDeref { mut_: deref_mut_ }\n+                (RenderMode::ForDeref { mut_: deref_mut_ }, cx.derive_id(id))\n             }\n         };\n         let mut impls_buf = Buffer::empty_from(w);\n@@ -1115,7 +1116,9 @@ fn render_assoc_items_inner(\n         }\n         if !impls_buf.is_empty() {\n             w.push_buffer(tmp_buf);\n+            write!(w, \"<div id=\\\"{}\\\">\", id);\n             w.push_buffer(impls_buf);\n+            w.write_str(\"</div>\");\n         }\n     }\n \n@@ -1146,7 +1149,8 @@ fn render_assoc_items_inner(\n             write!(\n                 w,\n                 \"<h2 id=\\\"trait-implementations\\\" class=\\\"small-section-header\\\">\\\n-                     Trait Implementations<a href=\\\"#trait-implementations\\\" class=\\\"anchor\\\"></a>\\\n+                     Trait Implementations\\\n+                     <a href=\\\"#trait-implementations\\\" class=\\\"anchor\\\"></a>\\\n                  </h2>\\\n                  <div id=\\\"trait-implementations-list\\\">{}</div>\",\n                 impls"}, {"sha": "90592335d5ddfa83cfa03112873620992a04047f", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -741,7 +741,7 @@ function hideThemeButtonState() {\n         } else {\n             addClass(innerToggle, \"will-expand\");\n             onEachLazy(document.getElementsByClassName(\"rustdoc-toggle\"), function(e) {\n-                if (e.parentNode.id !== MAIN_ID ||\n+                if (e.parentNode.id !== \"implementations-list\" ||\n                     (!hasClass(e, \"implementors-toggle\") &&\n                      !hasClass(e, \"type-contents-toggle\")))\n                 {"}, {"sha": "af76d2ea42760c7fcbc3159f8566529858abc68b", "filename": "src/test/rustdoc-gui/docblock-table-overflow.goml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Fdocblock-table-overflow.goml", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Fdocblock-table-overflow.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fdocblock-table-overflow.goml?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -12,10 +12,10 @@ assert-property: (\".top-doc .docblock table\", {\"scrollWidth\": \"1573\"})\n \n // Logically, the \".docblock\" and the \"<p>\" should have the same scroll width.\n compare-elements-property: (\n-    \"#implementations + details .docblock\",\n-    \"#implementations + details .docblock > p\",\n+    \"#implementations-list > details .docblock\",\n+    \"#implementations-list > details .docblock > p\",\n     [\"scrollWidth\"],\n )\n-assert-property: (\"#implementations + details .docblock\", {\"scrollWidth\": \"801\"})\n+assert-property: (\"#implementations-list > details .docblock\", {\"scrollWidth\": \"801\"})\n // However, since there is overflow in the <table>, its scroll width is bigger.\n-assert-property: (\"#implementations + details .docblock table\", {\"scrollWidth\": \"1573\"})\n+assert-property: (\"#implementations-list > details .docblock table\", {\"scrollWidth\": \"1573\"})"}, {"sha": "861f6928362c28e841541b3d91620b56c828fd85", "filename": "src/test/rustdoc-gui/hash-item-expansion.goml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Fhash-item-expansion.goml", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Fhash-item-expansion.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fhash-item-expansion.goml?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -3,9 +3,9 @@ goto: file://|DOC_PATH|/test_docs/struct.Foo.html#method.borrow\n // In the blanket implementations list, \"Borrow\" is the second one, hence the \":nth(2)\".\n assert-attribute: (\"#blanket-implementations-list > details:nth-child(2)\", {\"open\": \"\"})\n // We first check that the impl block is open by default.\n-assert-attribute: (\"#implementations + details\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list details\", {\"open\": \"\"})\n // To ensure that we will click on the currently hidden method.\n assert-text: (\".sidebar-elems section .block li > a\", \"must_use\")\n click: \".sidebar-elems section .block li > a\"\n // We check that the impl block was opened as expected so that we can see the method.\n-assert-attribute: (\"#implementations + details\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list > details\", {\"open\": \"\"})"}, {"sha": "6df2661e6c2bb800f67dc40e8878f3a2312263ba", "filename": "src/test/rustdoc-gui/impl-default-expansion.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Fimpl-default-expansion.goml", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Fimpl-default-expansion.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fimpl-default-expansion.goml?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -1,3 +1,3 @@\n // This test ensures that the impl blocks are open by default.\n goto: file://|DOC_PATH|/test_docs/struct.Foo.html\n-assert-attribute: (\"#main-content > details.implementors-toggle\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list details.implementors-toggle\", {\"open\": \"\"})"}, {"sha": "ee6bc3cf7675c3d1dbf4428db04f2c2a9ce73328", "filename": "src/test/rustdoc-gui/toggle-docs-mobile.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs-mobile.goml", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs-mobile.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs-mobile.goml?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -14,7 +14,7 @@ assert-attribute: (\".top-doc\", {\"open\": \"\"})\n // Assert the position of the toggle on the top doc block.\n assert-position: (\".top-doc summary::before\", {\"x\": 4})\n // Assert the position of the toggle on the impl block.\n-assert-position: (\"#implementations + details > summary::before\", {\"x\": 4})\n+assert-position: (\"#implementations-list > details > summary::before\", {\"x\": 4})\n // Assert the position of the toggle on a method.\n assert-position: (\n     \"#trait-implementations-list .impl-items .method-toggle > summary::before\","}, {"sha": "f98111484f315b428bc6f3632d3fbe843a304be0", "filename": "src/test/rustdoc-gui/toggle-docs.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -24,7 +24,7 @@ wait-for: 50\n assert-text: (\"#toggle-all-docs\", \"[+]\")\n // We check that all <details> are collapsed (except for the impl block ones).\n assert-attribute-false: (\"details.rustdoc-toggle:not(.implementors-toggle)\", {\"open\": \"\"}, ALL)\n-assert-attribute: (\"details.rustdoc-toggle.implementors-toggle\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list > details.implementors-toggle\", {\"open\": \"\"})\n // We now check that the other impl blocks are collapsed.\n assert-attribute-false: (\n     \"#blanket-implementations-list > details.rustdoc-toggle.implementors-toggle\","}, {"sha": "84c9e4ac0cd8449200f19b4252e8c825a3adc312", "filename": "src/test/rustdoc/duplicate_impls/issue-33054.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc%2Fduplicate_impls%2Fissue-33054.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82215ce64680a6f0bf55a42eba6e7a8ff756c53f/src%2Ftest%2Frustdoc%2Fduplicate_impls%2Fissue-33054.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fduplicate_impls%2Fissue-33054.rs?ref=82215ce64680a6f0bf55a42eba6e7a8ff756c53f", "patch": "@@ -1,8 +1,10 @@\n+// ignore-tidy-linelength\n+\n // @has issue_33054/impls/struct.Foo.html\n // @has - '//h3[@class=\"code-header in-band\"]' 'impl Foo'\n // @has - '//h3[@class=\"code-header in-band\"]' 'impl Bar for Foo'\n // @count - '//*[@id=\"trait-implementations-list\"]//*[@class=\"impl has-srclink\"]' 1\n-// @count - '//*[@id=\"main-content\"]/details/summary/*[@class=\"impl has-srclink\"]' 1\n+// @count - '//*[@id=\"main-content\"]/div[@id=\"implementations-list\"]/details/summary/*[@class=\"impl has-srclink\"]' 1\n // @has issue_33054/impls/bar/trait.Bar.html\n // @has - '//h3[@class=\"code-header in-band\"]' 'impl Bar for Foo'\n // @count - '//*[@class=\"struct\"]' 1"}]}