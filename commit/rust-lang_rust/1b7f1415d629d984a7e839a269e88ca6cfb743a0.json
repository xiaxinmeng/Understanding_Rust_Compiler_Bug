{"sha": "1b7f1415d629d984a7e839a269e88ca6cfb743a0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiN2YxNDE1ZDYyOWQ5ODRhN2U4MzlhMjY5ZTg4Y2E2Y2ZiNzQzYTA=", "commit": {"author": {"name": "Stefan Plantikow", "email": "stefan.plantikow@googlemail.com", "date": "2011-12-01T02:33:39Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-12-02T20:23:50Z"}, "message": "build: added CFG_INSTALL_SNAP for automatically activating test snapshots\n\nThis is only guaranteed to work when building in the top-level dir", "tree": {"sha": "18dd32def2c070f5ddb3bd442c8831af16be2d38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/18dd32def2c070f5ddb3bd442c8831af16be2d38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b7f1415d629d984a7e839a269e88ca6cfb743a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b7f1415d629d984a7e839a269e88ca6cfb743a0", "html_url": "https://github.com/rust-lang/rust/commit/1b7f1415d629d984a7e839a269e88ca6cfb743a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b7f1415d629d984a7e839a269e88ca6cfb743a0/comments", "author": {"login": "boggle", "id": 50886, "node_id": "MDQ6VXNlcjUwODg2", "avatar_url": "https://avatars.githubusercontent.com/u/50886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/boggle", "html_url": "https://github.com/boggle", "followers_url": "https://api.github.com/users/boggle/followers", "following_url": "https://api.github.com/users/boggle/following{/other_user}", "gists_url": "https://api.github.com/users/boggle/gists{/gist_id}", "starred_url": "https://api.github.com/users/boggle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/boggle/subscriptions", "organizations_url": "https://api.github.com/users/boggle/orgs", "repos_url": "https://api.github.com/users/boggle/repos", "events_url": "https://api.github.com/users/boggle/events{/privacy}", "received_events_url": "https://api.github.com/users/boggle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68a82e44684a25314ded58349815bf6d1bc3c74a", "url": "https://api.github.com/repos/rust-lang/rust/commits/68a82e44684a25314ded58349815bf6d1bc3c74a", "html_url": "https://github.com/rust-lang/rust/commit/68a82e44684a25314ded58349815bf6d1bc3c74a"}], "stats": {"total": 43, "additions": 41, "deletions": 2}, "files": [{"sha": "c917fb6311cf65aa769e7b5835ddce64b7bb33aa", "filename": "mk/snap.mk", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1b7f1415d629d984a7e839a269e88ca6cfb743a0/mk%2Fsnap.mk", "raw_url": "https://github.com/rust-lang/rust/raw/1b7f1415d629d984a7e839a269e88ca6cfb743a0/mk%2Fsnap.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fsnap.mk?ref=1b7f1415d629d984a7e839a269e88ca6cfb743a0", "patch": "@@ -2,8 +2,13 @@ define DEF_SNAP_FOR_STAGE_H\n # $(1) stage\n # $(2) triple\n \n+ifdef CFG_INSTALL_SNAP\n+snap-stage$(1)-H-$(2): $$(HSREQ$(1)_H_$(2))\n+\t$(S)src/etc/make-snapshot.py stage$(1) $(2) install\n+else\n snap-stage$(1)-H-$(2): $$(HSREQ$(1)_H_$(2))\n \t$(S)src/etc/make-snapshot.py stage$(1) $(2)\n+endif\n \n endef\n "}, {"sha": "13ea73046fbb1cf9ac8325d12fe03b53a69403d5", "filename": "src/etc/make-snapshot.py", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1b7f1415d629d984a7e839a269e88ca6cfb743a0/src%2Fetc%2Fmake-snapshot.py", "raw_url": "https://github.com/rust-lang/rust/raw/1b7f1415d629d984a7e839a269e88ca6cfb743a0/src%2Fetc%2Fmake-snapshot.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmake-snapshot.py?ref=1b7f1415d629d984a7e839a269e88ca6cfb743a0", "patch": "@@ -1,4 +1,8 @@\n #!/usr/bin/env python\n \n import snapshot, sys\n-print(snapshot.make_snapshot(sys.argv[1], sys.argv[2]))\n+\n+if len(sys.argv) == 2:\n+    print(snapshot.make_snapshot(sys.argv[1], sys.argv[2], \"\"))\n+else:\n+    print(snapshot.make_snapshot(sys.argv[1], sys.argv[2], sys.argv[3]))"}, {"sha": "db0d5f97aaf7de8edb2ea96ddc9c5018315d7ae2", "filename": "src/etc/snapshot.py", "status": "modified", "additions": 31, "deletions": 1, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/1b7f1415d629d984a7e839a269e88ca6cfb743a0/src%2Fetc%2Fsnapshot.py", "raw_url": "https://github.com/rust-lang/rust/raw/1b7f1415d629d984a7e839a269e88ca6cfb743a0/src%2Fetc%2Fsnapshot.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fsnapshot.py?ref=1b7f1415d629d984a7e839a269e88ca6cfb743a0", "patch": "@@ -111,7 +111,7 @@ def hash_file(x):\n     return scrub(h.hexdigest())\n \n \n-def make_snapshot(stage, triple):\n+def make_snapshot(stage, triple, flag):\n     kernel = get_kernel(triple)\n     platform = get_platform(triple)\n     rev = local_rev_short_sha()\n@@ -132,4 +132,34 @@ def make_snapshot(stage, triple):\n     file1 = full_snapshot_name(date, rev, platform, h)\n \n     shutil.move(file0, file1)\n+\n+    if flag == \"install\":\n+      # FIXME this is an ugly quick hack; pls make it better\n+      path  = file1\n+      comps = path.split(\"-\")\n+      parts = { 'year': comps[2], \\\n+                'month': comps[3], \\\n+                'date': comps[4], \\\n+                'check': comps[5], \\\n+                'plat': comps[6], \\\n+                'arch': comps[7], \\\n+                'sha': comps[8].split(\".\")[0] }\n+\n+      shutil.move(path, \"dl/\" + path)\n+      shutil.move('src/snapshots.txt', 'src/snapshots-old.txt')\n+\n+      newf = open('src/snapshots.txt', 'w')\n+      newf.write(\"T %(year)s-%(month)s-%(date)s %(check)s\\n\" % parts)\n+      newf.write(\"  %(plat)s-%(arch)s %(sha)s\\n\\n\" % parts)\n+\n+      oldf = open('src/snapshots-old.txt', 'r')\n+      for line in oldf:\n+        newf.write(line)\n+      oldf.close()\n+\n+      newf.close()\n+\n+      os.remove('src/snapshots-old.txt')\n+\n+\n     return file1"}]}