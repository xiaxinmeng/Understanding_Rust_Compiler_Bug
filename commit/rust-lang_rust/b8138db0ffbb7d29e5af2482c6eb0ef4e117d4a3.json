{"sha": "b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "node_id": "C_kwDOAAsO6NoAKGI4MTM4ZGIwZmZiYjdkMjllNWFmMjQ4MmM2ZWIwZWY0ZTExN2Q0YTM", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2022-07-08T15:45:55Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2022-07-20T10:40:51Z"}, "message": "Use FxIndexMap instead of otherwise unused StableMap for WEAK_ITEMS_REFS.", "tree": {"sha": "98c0fd494cf0a9fa07044b8fa1b68adf379d4ac0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98c0fd494cf0a9fa07044b8fa1b68adf379d4ac0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "html_url": "https://github.com/rust-lang/rust/commit/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "748cb1f01d623f2afd0d8b84fda7e2c8f7a11c7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/748cb1f01d623f2afd0d8b84fda7e2c8f7a11c7b", "html_url": "https://github.com/rust-lang/rust/commit/748cb1f01d623f2afd0d8b84fda7e2c8f7a11c7b"}], "stats": {"total": 22, "additions": 11, "deletions": 11}, "files": [{"sha": "13b3e954e1f5889d906536bbfaf912b65a469eb6", "filename": "compiler/rustc_hir/src/lang_items.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs?ref=b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "patch": "@@ -11,7 +11,7 @@ use crate::def_id::DefId;\n use crate::{MethodKind, Target};\n \n use rustc_ast as ast;\n-use rustc_data_structures::fx::FxHashMap;\n+use rustc_data_structures::fx::FxIndexMap;\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n use rustc_macros::HashStable_Generic;\n use rustc_span::symbol::{kw, sym, Symbol};\n@@ -134,8 +134,8 @@ macro_rules! language_item_table {\n         }\n \n         /// A mapping from the name of the lang item to its order and the form it must be of.\n-        pub static ITEM_REFS: LazyLock<FxHashMap<Symbol, (usize, Target)>> = LazyLock::new(|| {\n-            let mut item_refs = FxHashMap::default();\n+        pub static ITEM_REFS: LazyLock<FxIndexMap<Symbol, (usize, Target)>> = LazyLock::new(|| {\n+            let mut item_refs = FxIndexMap::default();\n             $( item_refs.insert($module::$name, (LangItem::$variant as usize, $target)); )*\n             item_refs\n         });"}, {"sha": "b6a85c0472e02e43f851927a8b66053128d487ef", "filename": "compiler/rustc_hir/src/weak_lang_items.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/compiler%2Frustc_hir%2Fsrc%2Fweak_lang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/compiler%2Frustc_hir%2Fsrc%2Fweak_lang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fweak_lang_items.rs?ref=b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "patch": "@@ -4,16 +4,16 @@ use crate::def_id::DefId;\n use crate::{lang_items, LangItem, LanguageItems};\n \n use rustc_ast as ast;\n-use rustc_data_structures::stable_map::StableMap;\n+use rustc_data_structures::fx::FxIndexMap;\n use rustc_span::symbol::{sym, Symbol};\n \n use std::sync::LazyLock;\n \n macro_rules! weak_lang_items {\n     ($($name:ident, $item:ident, $sym:ident;)*) => (\n \n-pub static WEAK_ITEMS_REFS: LazyLock<StableMap<Symbol, LangItem>> = LazyLock::new(|| {\n-    let mut map = StableMap::default();\n+pub static WEAK_ITEMS_REFS: LazyLock<FxIndexMap<Symbol, LangItem>> = LazyLock::new(|| {\n+    let mut map = FxIndexMap::default();\n     $(map.insert(sym::$name, LangItem::$item);)*\n     map\n });"}, {"sha": "c48b4ecf87a3ad0a637430be0a4e47675146318a", "filename": "compiler/rustc_passes/src/weak_lang_items.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs?ref=b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "patch": "@@ -68,7 +68,7 @@ fn verify<'tcx>(tcx: TyCtxt<'tcx>, items: &lang_items::LanguageItems) {\n         }\n     }\n \n-    for (name, item) in WEAK_ITEMS_REFS.clone().into_sorted_vector().into_iter() {\n+    for (name, &item) in WEAK_ITEMS_REFS.iter() {\n         if missing.contains(&item) && required(tcx, item) && items.require(item).is_err() {\n             if item == LangItem::PanicImpl {\n                 tcx.sess.err(\"`#[panic_handler]` function required, but not found\");"}, {"sha": "54b5e66fc2100e612f2d4335f076618eb1d23efc", "filename": "src/test/ui/extern-flag/empty-extern-arg.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/src%2Ftest%2Fui%2Fextern-flag%2Fempty-extern-arg.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/src%2Ftest%2Fui%2Fextern-flag%2Fempty-extern-arg.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextern-flag%2Fempty-extern-arg.stderr?ref=b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "patch": "@@ -1,11 +1,11 @@\n error: extern location for std does not exist: \n \n+error: `#[panic_handler]` function required, but not found\n+\n error: language item required, but not found: `eh_personality`\n    |\n    = note: this can occur when a binary crate with `#![no_std]` is compiled for a target where `eh_personality` is defined in the standard library\n    = help: you may be able to compile for a target that doesn't need `eh_personality`, specify a target with `--target` or in `.cargo/config`\n \n-error: `#[panic_handler]` function required, but not found\n-\n error: aborting due to 3 previous errors\n "}, {"sha": "202f3309d035e9d59958ae22d43f687f8b5c03fc", "filename": "src/test/ui/panic-handler/weak-lang-item.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/src%2Ftest%2Fui%2Fpanic-handler%2Fweak-lang-item.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3/src%2Ftest%2Fui%2Fpanic-handler%2Fweak-lang-item.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanic-handler%2Fweak-lang-item.stderr?ref=b8138db0ffbb7d29e5af2482c6eb0ef4e117d4a3", "patch": "@@ -10,13 +10,13 @@ help: you can use `as` to change the binding name of the import\n LL | extern crate core as other_core;\n    |\n \n+error: `#[panic_handler]` function required, but not found\n+\n error: language item required, but not found: `eh_personality`\n    |\n    = note: this can occur when a binary crate with `#![no_std]` is compiled for a target where `eh_personality` is defined in the standard library\n    = help: you may be able to compile for a target that doesn't need `eh_personality`, specify a target with `--target` or in `.cargo/config`\n \n-error: `#[panic_handler]` function required, but not found\n-\n error: aborting due to 3 previous errors\n \n For more information about this error, try `rustc --explain E0259`."}]}