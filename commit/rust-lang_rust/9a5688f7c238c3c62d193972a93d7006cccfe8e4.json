{"sha": "9a5688f7c238c3c62d193972a93d7006cccfe8e4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhNTY4OGY3YzIzOGMzYzYyZDE5Mzk3MmE5M2Q3MDA2Y2NjZmU4ZTQ=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-09-26T02:05:22Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-09-26T02:05:22Z"}, "message": "Merge pull request #354 from nrc/max-fn\n\nUse vertical formatting when function args width > limit", "tree": {"sha": "8ff7c87b3d9090ffd8cc59b49ebff96630880f1a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8ff7c87b3d9090ffd8cc59b49ebff96630880f1a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a5688f7c238c3c62d193972a93d7006cccfe8e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a5688f7c238c3c62d193972a93d7006cccfe8e4", "html_url": "https://github.com/rust-lang/rust/commit/9a5688f7c238c3c62d193972a93d7006cccfe8e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a5688f7c238c3c62d193972a93d7006cccfe8e4/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e161de0daa6d13642942883454a5676c7e7a3793", "url": "https://api.github.com/repos/rust-lang/rust/commits/e161de0daa6d13642942883454a5676c7e7a3793", "html_url": "https://github.com/rust-lang/rust/commit/e161de0daa6d13642942883454a5676c7e7a3793"}, {"sha": "d161b8df72877eae5f99f84bfe20b9efdda2cf73", "url": "https://api.github.com/repos/rust-lang/rust/commits/d161b8df72877eae5f99f84bfe20b9efdda2cf73", "html_url": "https://github.com/rust-lang/rust/commit/d161b8df72877eae5f99f84bfe20b9efdda2cf73"}], "stats": {"total": 204, "additions": 158, "deletions": 46}, "files": [{"sha": "6ad6123408a65e20579d521352c580a689ca4ff6", "filename": "src/chains.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -126,7 +126,10 @@ pub fn rewrite_chain(mut expr: &ast::Expr,\n         &connector[..]\n     };\n \n-    Some(format!(\"{}{}{}\", parent_rewrite, first_connector, rewrites.join(&connector)))\n+    Some(format!(\"{}{}{}\",\n+                 parent_rewrite,\n+                 first_connector,\n+                 rewrites.join(&connector)))\n }\n \n fn pop_expr_chain<'a>(expr: &'a ast::Expr) -> Option<&'a ast::Expr> {\n@@ -151,7 +154,13 @@ fn rewrite_chain_expr(expr: &ast::Expr,\n     match expr.node {\n         ast::Expr_::ExprMethodCall(ref method_name, ref types, ref expressions) => {\n             let inner = &RewriteContext { block_indent: offset, ..*context };\n-            rewrite_method_call(method_name.node, types, expressions, span, inner, width, offset)\n+            rewrite_method_call(method_name.node,\n+                                types,\n+                                expressions,\n+                                span,\n+                                inner,\n+                                width,\n+                                offset)\n         }\n         ast::Expr_::ExprField(_, ref field) => {\n             Some(format!(\".{}\", field.node))"}, {"sha": "f5ba982ecc0e0cce4ed50cfc63f878cdb033092e", "filename": "src/comment.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomment.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -343,8 +343,10 @@ mod test {\n     #[test]\n     fn test_uncommented() {\n         assert_eq!(&uncommented(\"abc/*...*/\"), \"abc\");\n-        assert_eq!(&uncommented(\"// .... /* \\n../* /* *** / */ */a/* // */c\\n\"), \"..ac\\n\");\n-        assert_eq!(&uncommented(\"abc \\\" /* */\\\" qsdf\"), \"abc \\\" /* */\\\" qsdf\");\n+        assert_eq!(&uncommented(\"// .... /* \\n../* /* *** / */ */a/* // */c\\n\"),\n+                   \"..ac\\n\");\n+        assert_eq!(&uncommented(\"abc \\\" /* */\\\" qsdf\"),\n+                   \"abc \\\" /* */\\\" qsdf\");\n     }\n \n     #[test]\n@@ -365,7 +367,9 @@ mod test {\n         check(\"/*/ */test\", \"test\", Some(6));\n         check(\"//test\\ntest\", \"test\", Some(7));\n         check(\"/* comment only */\", \"whatever\", None);\n-        check(\"/* comment */ some text /* more commentary */ result\", \"result\", Some(46));\n+        check(\"/* comment */ some text /* more commentary */ result\",\n+              \"result\",\n+              Some(46));\n         check(\"sup // sup\", \"p\", Some(2));\n         check(\"sup\", \"x\", None);\n         check(r#\"\u03c0? /**/ \u03c0 is nice!\"#, r#\"\u03c0 is nice\"#, Some(9));"}, {"sha": "4779d0e9b98c704e2ea3452046b0eed5990f319f", "filename": "src/config.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -215,9 +215,11 @@ macro_rules! create_config {\n \n create_config! {\n     max_width: usize, \"Maximum width of each line\",\n-    ideal_width: usize, \"Ideal width of each line\",\n-    leeway: usize, \"Leeway of line width\",\n+    ideal_width: usize, \"Ideal width of each line (only used for comments)\",\n+    leeway: usize, \"Leeway of line width (deprecated)\",\n     tab_spaces: usize, \"Number of spaces per tab\",\n+    list_width: usize, \"Maximum width in a struct literal or function \\\n+                        call before faling back to vertical formatting\",\n     newline_style: NewlineStyle, \"Unix or Windows line endings\",\n     fn_brace_style: BraceStyle, \"Brace style for functions\",\n     fn_return_indent: ReturnIndent, \"Location of return type in function declaration\",\n@@ -256,6 +258,7 @@ impl Default for Config {\n             ideal_width: 80,\n             leeway: 5,\n             tab_spaces: 4,\n+            list_width: 50,\n             newline_style: NewlineStyle::Unix,\n             fn_brace_style: BraceStyle::SameLineWhere,\n             fn_return_indent: ReturnIndent::WithArgs,"}, {"sha": "79e03e644e4dd10c3ffca13666c26512b00f7b92", "filename": "src/expr.rs", "status": "modified", "additions": 49, "deletions": 14, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -32,7 +32,11 @@ impl Rewrite for ast::Expr {\n     fn rewrite(&self, context: &RewriteContext, width: usize, offset: Indent) -> Option<String> {\n         match self.node {\n             ast::Expr_::ExprVec(ref expr_vec) => {\n-                rewrite_array(expr_vec.iter().map(|e| &**e), self.span, context, width, offset)\n+                rewrite_array(expr_vec.iter().map(|e| &**e),\n+                              self.span,\n+                              context,\n+                              width,\n+                              offset)\n             }\n             ast::Expr_::ExprLit(ref l) => {\n                 match l.node {\n@@ -158,7 +162,10 @@ impl Rewrite for ast::Expr {\n                                                                        offset))\n             }\n             ast::Expr_::ExprRet(None) => {\n-                wrap_str(\"return\".to_owned(), context.config.max_width, width, offset)\n+                wrap_str(\"return\".to_owned(),\n+                         context.config.max_width,\n+                         width,\n+                         offset)\n             }\n             ast::Expr_::ExprRet(Some(ref expr)) => {\n                 rewrite_unary_prefix(context, \"return \", &expr, width, offset)\n@@ -176,7 +183,10 @@ impl Rewrite for ast::Expr {\n             ast::Expr_::ExprIndex(..) |\n             ast::Expr_::ExprInlineAsm(..) |\n             ast::Expr_::ExprRepeat(..) => {\n-                wrap_str(context.snippet(self.span), context.config.max_width, width, offset)\n+                wrap_str(context.snippet(self.span),\n+                         context.config.max_width,\n+                         width,\n+                         offset)\n             }\n         }\n     }\n@@ -507,7 +517,13 @@ impl<'a> Rewrite for Loop<'a> {\n         // FIXME: this drops any comment between \"loop\" and the block.\n         self.block\n             .rewrite(context, width, offset)\n-            .map(|result| format!(\"{}{}{} {}\", label_string, self.keyword, pat_expr_string, result))\n+            .map(|result| {\n+                format!(\"{}{}{} {}\",\n+                        label_string,\n+                        self.keyword,\n+                        pat_expr_string,\n+                        result)\n+            })\n     }\n }\n \n@@ -639,7 +655,10 @@ fn single_line_if_else(context: &RewriteContext,\n         let fits_line = fixed_cost + pat_expr_str.len() + if_str.len() + else_str.len() <= width;\n \n         if fits_line && !if_str.contains('\\n') && !else_str.contains('\\n') {\n-            return Some(format!(\"if {} {{ {} }} else {{ {} }}\", pat_expr_str, if_str, else_str));\n+            return Some(format!(\"if {} {{ {} }} else {{ {} }}\",\n+                                pat_expr_str,\n+                                if_str,\n+                                else_str));\n         }\n     }\n \n@@ -1108,7 +1127,9 @@ fn rewrite_paren(context: &RewriteContext,\n                  width: usize,\n                  offset: Indent)\n                  -> Option<String> {\n-    debug!(\"rewrite_paren, width: {}, offset: {:?}\", width, offset);\n+    debug!(\"rewrite_paren, width: {}, offset: {:?}\",\n+           width,\n+           offset);\n     // 1 is for opening paren, 2 is for opening+closing, we want to keep the closing\n     // paren on the same line as the subexpr.\n     let subexpr_str = subexpr.rewrite(context, try_opt!(width.checked_sub(2)), offset + 1);\n@@ -1124,7 +1145,9 @@ fn rewrite_struct_lit<'a>(context: &RewriteContext,\n                           width: usize,\n                           offset: Indent)\n                           -> Option<String> {\n-    debug!(\"rewrite_struct_lit: width {}, offset {:?}\", width, offset);\n+    debug!(\"rewrite_struct_lit: width {}, offset {:?}\",\n+           width,\n+           offset);\n     assert!(!fields.is_empty() || base.is_some());\n \n     enum StructLitField<'a> {\n@@ -1229,10 +1252,15 @@ fn rewrite_struct_lit<'a>(context: &RewriteContext,\n                                   .block_indent(context.config)\n                                   .to_string(context.config);\n         let outer_indent = context.block_indent.to_string(context.config);\n-        Some(format!(\"{} {{\\n{}{}\\n{}}}\", path_str, inner_indent, fields_str, outer_indent))\n+        Some(format!(\"{} {{\\n{}{}\\n{}}}\",\n+                     path_str,\n+                     inner_indent,\n+                     fields_str,\n+                     outer_indent))\n     };\n \n-    match (context.config.struct_lit_style, context.config.struct_lit_multiline_style) {\n+    match (context.config.struct_lit_style,\n+           context.config.struct_lit_multiline_style) {\n         (StructLitStyle::Block, _) if fields_str.contains('\\n') || fields_str.len() > h_budget =>\n             format_on_newline(),\n         (StructLitStyle::Block, MultilineStyle::ForceMulti) => format_on_newline(),\n@@ -1250,8 +1278,9 @@ fn rewrite_field(context: &RewriteContext,\n                  -> Option<String> {\n     let name = &field.ident.node.to_string();\n     let overhead = name.len() + 2;\n-    let expr = field.expr\n-                    .rewrite(context, try_opt!(width.checked_sub(overhead)), offset + overhead);\n+    let expr = field.expr.rewrite(context,\n+                                  try_opt!(width.checked_sub(overhead)),\n+                                  offset + overhead);\n     expr.map(|s| format!(\"{}: {}\", name, s))\n }\n \n@@ -1261,7 +1290,9 @@ fn rewrite_tuple_lit(context: &RewriteContext,\n                      width: usize,\n                      offset: Indent)\n                      -> Option<String> {\n-    debug!(\"rewrite_tuple_lit: width: {}, offset: {:?}\", width, offset);\n+    debug!(\"rewrite_tuple_lit: width: {}, offset: {:?}\",\n+           width,\n+           offset);\n     let indent = offset + 1;\n     // In case of length 1, need a trailing comma\n     if items.len() == 1 {\n@@ -1352,7 +1383,9 @@ fn rewrite_unary_prefix(context: &RewriteContext,\n                         width: usize,\n                         offset: Indent)\n                         -> Option<String> {\n-    expr.rewrite(context, try_opt!(width.checked_sub(prefix.len())), offset + prefix.len())\n+    expr.rewrite(context,\n+                 try_opt!(width.checked_sub(prefix.len())),\n+                 offset + prefix.len())\n         .map(|r| format!(\"{}{}\", prefix, r))\n }\n \n@@ -1385,7 +1418,9 @@ fn rewrite_assignment(context: &RewriteContext,\n \n     // 1 = space between lhs and operator.\n     let max_width = try_opt!(width.checked_sub(operator_str.len() + 1));\n-    let lhs_str = format!(\"{} {}\", try_opt!(lhs.rewrite(context, max_width, offset)), operator_str);\n+    let lhs_str = format!(\"{} {}\",\n+                          try_opt!(lhs.rewrite(context, max_width, offset)),\n+                          operator_str);\n \n     rewrite_assign_rhs(&context, lhs_str, rhs, width, offset)\n }"}, {"sha": "f3f952bd00ca5eebc554b05ccd0e71e8629787e9", "filename": "src/filemap.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Ffilemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Ffilemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ffilemap.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -115,7 +115,8 @@ fn write_file(text: &StringBuffer,\n             try!(write_system_newlines(&mut v, text, config));\n             let fmt_text = String::from_utf8(v).unwrap();\n             let diff = make_diff(&ori_text, &fmt_text, 3);\n-            print_diff(diff, |line_num| format!(\"\\nDiff at line {}:\", line_num));\n+            print_diff(diff,\n+                       |line_num| format!(\"\\nDiff at line {}:\", line_num));\n         }\n         WriteMode::Return => {\n             // io::Write is not implemented for String, working around with"}, {"sha": "90123cf63e158c115063a1044f8bada76a021849", "filename": "src/issues.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fissues.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fissues.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fissues.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -224,12 +224,14 @@ impl BadIssueSeeker {\n fn find_unnumbered_issue() {\n     fn check_fail(text: &str, failing_pos: usize) {\n         let mut seeker = BadIssueSeeker::new(ReportTactic::Unnumbered, ReportTactic::Unnumbered);\n-        assert_eq!(Some(failing_pos), text.chars().position(|c| seeker.inspect(c).is_some()));\n+        assert_eq!(Some(failing_pos),\n+                   text.chars().position(|c| seeker.inspect(c).is_some()));\n     }\n \n     fn check_pass(text: &str) {\n         let mut seeker = BadIssueSeeker::new(ReportTactic::Unnumbered, ReportTactic::Unnumbered);\n-        assert_eq!(None, text.chars().position(|c| seeker.inspect(c).is_some()));\n+        assert_eq!(None,\n+                   text.chars().position(|c| seeker.inspect(c).is_some()));\n     }\n \n     check_fail(\"TODO\\n\", 4);\n@@ -256,11 +258,17 @@ fn find_issue() {\n                          ReportTactic::Always,\n                          ReportTactic::Never));\n \n-    assert!(!is_bad_issue(\"TODO: no number\\n\", ReportTactic::Never, ReportTactic::Always));\n+    assert!(!is_bad_issue(\"TODO: no number\\n\",\n+                          ReportTactic::Never,\n+                          ReportTactic::Always));\n \n-    assert!(is_bad_issue(\"This is a FIXME(#1)\\n\", ReportTactic::Never, ReportTactic::Always));\n+    assert!(is_bad_issue(\"This is a FIXME(#1)\\n\",\n+                         ReportTactic::Never,\n+                         ReportTactic::Always));\n \n-    assert!(!is_bad_issue(\"bad FIXME\\n\", ReportTactic::Always, ReportTactic::Never));\n+    assert!(!is_bad_issue(\"bad FIXME\\n\",\n+                          ReportTactic::Always,\n+                          ReportTactic::Never));\n }\n \n #[test]"}, {"sha": "efd2c852c3ea561ecf69b5f929da0c3ed60bbc5d", "filename": "src/items.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -307,7 +307,9 @@ impl<'a> FmtVisitor<'a> {\n \n         let context = self.get_context();\n         let ret_str = fd.output\n-                        .rewrite(&context, self.config.max_width - indent.width(), indent)\n+                        .rewrite(&context,\n+                                 self.config.max_width - indent.width(),\n+                                 indent)\n                         .unwrap();\n \n         // Args.\n@@ -948,7 +950,7 @@ impl<'a> FmtVisitor<'a> {\n             item.item = ty;\n         }\n \n-        let fmt = ListFormatting::for_fn(h_budget, offset, self.config);\n+        let fmt = ListFormatting::for_item(h_budget, offset, self.config);\n         let list_str = try_opt!(write_list(&items, &fmt));\n \n         Some(format!(\"<{}>\", list_str))\n@@ -1011,7 +1013,9 @@ impl<'a> FmtVisitor<'a> {\n         // 9 = \" where \".len() + \" {\".len()\n         if density == Density::Tall || preds_str.contains('\\n') ||\n            indent.width() + 9 + preds_str.len() > self.config.max_width {\n-            Some(format!(\"\\n{}where {}\", (indent + extra_indent).to_string(self.config), preds_str))\n+            Some(format!(\"\\n{}where {}\",\n+                         (indent + extra_indent).to_string(self.config),\n+                         preds_str))\n         } else {\n             Some(format!(\" where {}\", preds_str))\n         }\n@@ -1041,7 +1045,10 @@ impl Rewrite for ast::Arg {\n     fn rewrite(&self, context: &RewriteContext, width: usize, offset: Indent) -> Option<String> {\n         if is_named_arg(self) {\n             if let ast::Ty_::TyInfer = self.ty.node {\n-                wrap_str(pprust::pat_to_string(&self.pat), context.config.max_width, width, offset)\n+                wrap_str(pprust::pat_to_string(&self.pat),\n+                         context.config.max_width,\n+                         width,\n+                         offset)\n             } else {\n                 let mut result = pprust::pat_to_string(&self.pat);\n                 result.push_str(\": \");"}, {"sha": "73184a0bdc1a6a16fde3074c8dc717c69adb23c7", "filename": "src/lib.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -115,7 +115,8 @@ impl Indent {\n \n     pub fn to_string(&self, config: &Config) -> String {\n         let (num_tabs, num_spaces) = if config.hard_tabs {\n-            (self.block_indent / config.tab_spaces, self.alignment)\n+            (self.block_indent / config.tab_spaces,\n+             self.alignment)\n         } else {\n             (0, self.block_indent + self.alignment)\n         };\n@@ -146,7 +147,8 @@ impl Sub for Indent {\n     type Output = Indent;\n \n     fn sub(self, rhs: Indent) -> Indent {\n-        Indent::new(self.block_indent - rhs.block_indent, self.alignment - rhs.alignment)\n+        Indent::new(self.block_indent - rhs.block_indent,\n+                    self.alignment - rhs.alignment)\n     }\n }\n "}, {"sha": "ef3372bf0b6002f5d77d71769ceddc9da27d478d", "filename": "src/lists.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Flists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Flists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flists.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -26,6 +26,8 @@ pub enum ListTactic {\n     Horizontal,\n     // Try Horizontal layout, if that fails then vertical\n     HorizontalVertical,\n+    // HorizontalVertical with a soft limit of n characters.\n+    LimitedHorizontalVertical(usize),\n     // Pack as many items as possible per row over (possibly) many rows.\n     Mixed,\n }\n@@ -59,6 +61,19 @@ pub struct ListFormatting<'a> {\n \n impl<'a> ListFormatting<'a> {\n     pub fn for_fn(width: usize, offset: Indent, config: &'a Config) -> ListFormatting<'a> {\n+        ListFormatting {\n+            tactic: ListTactic::LimitedHorizontalVertical(config.list_width),\n+            separator: \",\",\n+            trailing_separator: SeparatorTactic::Never,\n+            indent: offset,\n+            h_width: width,\n+            v_width: width,\n+            ends_with_newline: false,\n+            config: config,\n+        }\n+    }\n+\n+    pub fn for_item(width: usize, offset: Indent, config: &'a Config) -> ListFormatting<'a> {\n         ListFormatting {\n             tactic: ListTactic::HorizontalVertical,\n             separator: \",\",\n@@ -118,6 +133,13 @@ pub fn write_list<'b>(items: &[ListItem], formatting: &ListFormatting<'b>) -> Op\n     let fits_single = total_width + total_sep_len <= formatting.h_width;\n \n     // Check if we need to fallback from horizontal listing, if possible.\n+    if let ListTactic::LimitedHorizontalVertical(limit) = tactic {\n+        if total_width > limit {\n+            tactic = ListTactic::Vertical;\n+        } else {\n+            tactic = ListTactic::HorizontalVertical;\n+        }\n+    }\n     if tactic == ListTactic::HorizontalVertical {\n         debug!(\"write_list: total_width: {}, total_sep_len: {}, h_width: {}\",\n                total_width,"}, {"sha": "163a9f12f24fac314f9de930929dc3d65a877da3", "filename": "src/macros.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -103,7 +103,10 @@ pub fn rewrite_macro(mac: &ast::Mac,\n         }\n         MacroStyle::Braces => {\n             // Skip macro invocations with braces, for now.\n-            wrap_str(context.snippet(mac.span), context.config.max_width, width, offset)\n+            wrap_str(context.snippet(mac.span),\n+                     context.config.max_width,\n+                     width,\n+                     offset)\n         }\n     }\n }"}, {"sha": "135e6c3815b159f66e9f38e0092dc57361c1f2a0", "filename": "src/missed_spans.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fmissed_spans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fmissed_spans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmissed_spans.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -16,7 +16,8 @@ impl<'a> FmtVisitor<'a> {\n     // TODO these format_missing methods are ugly. Refactor and add unit tests\n     // for the central whitespace stripping loop.\n     pub fn format_missing(&mut self, end: BytePos) {\n-        self.format_missing_inner(end, |this, last_snippet, _| this.buffer.push_str(last_snippet))\n+        self.format_missing_inner(end,\n+                                  |this, last_snippet, _| this.buffer.push_str(last_snippet))\n     }\n \n     pub fn format_missing_with_indent(&mut self, end: BytePos) {"}, {"sha": "3f96bea9d44a15b5ada09a8cb255287c3baa88c2", "filename": "src/modules.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fmodules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fmodules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmodules.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -25,7 +25,10 @@ pub fn list_files<'a>(krate: &'a ast::Crate,\n                       -> HashMap<PathBuf, &'a ast::Mod> {\n     let mut result = HashMap::new();\n     let root_filename: PathBuf = codemap.span_to_filename(krate.span).into();\n-    list_submodules(&krate.module, root_filename.parent().unwrap(), codemap, &mut result);\n+    list_submodules(&krate.module,\n+                    root_filename.parent().unwrap(),\n+                    codemap,\n+                    &mut result);\n     result.insert(root_filename, &krate.module);\n     result\n }"}, {"sha": "33446765c8c72ccc80e318dd2ef3adebc05cfb0b", "filename": "src/types.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -205,7 +205,9 @@ fn rewrite_segment(segment: &ast::PathSegment,\n                                  .collect::<Vec<_>>();\n \n             let next_span_lo = param_list.last().unwrap().get_span().hi + BytePos(1);\n-            let list_lo = span_after(codemap::mk_sp(*span_lo, span_hi), \"<\", context.codemap);\n+            let list_lo = span_after(codemap::mk_sp(*span_lo, span_hi),\n+                                     \"<\",\n+                                     context.codemap);\n             let separator = get_path_separator(context.codemap, *span_lo, list_lo);\n \n             // 1 for <\n@@ -230,7 +232,7 @@ fn rewrite_segment(segment: &ast::PathSegment,\n                                      list_lo,\n                                      span_hi);\n \n-            let fmt = ListFormatting::for_fn(list_width, offset + extra_offset, context.config);\n+            let fmt = ListFormatting::for_item(list_width, offset + extra_offset, context.config);\n             let list_str = try_opt!(write_list(&items.collect::<Vec<_>>(), &fmt));\n \n             // Update position of last bracket.\n@@ -363,7 +365,8 @@ impl Rewrite for ast::TyParamBound {\n                 tref.rewrite(context, width, offset)\n             }\n             ast::TyParamBound::TraitTyParamBound(ref tref, ast::TraitBoundModifier::Maybe) => {\n-                Some(format!(\"?{}\", try_opt!(tref.rewrite(context, width - 1, offset + 1))))\n+                Some(format!(\"?{}\",\n+                             try_opt!(tref.rewrite(context, width - 1, offset + 1))))\n             }\n             ast::TyParamBound::RegionTyParamBound(ref l) => {\n                 Some(pprust::lifetime_to_string(l))"}, {"sha": "5faff9e6d111ff0302c166e1d936f3d7be94b76d", "filename": "src/visitor.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -316,7 +316,9 @@ impl<'a> FmtVisitor<'a> {\n     }\n \n     fn format_mod(&mut self, m: &ast::Mod, s: Span, ident: ast::Ident) {\n-        debug!(\"FmtVisitor::format_mod: ident: {:?}, span: {:?}\", ident, s);\n+        debug!(\"FmtVisitor::format_mod: ident: {:?}, span: {:?}\",\n+               ident,\n+               s);\n \n         // Decide whether this is an inline mod or an external mod.\n         let local_file_name = self.codemap.span_to_filename(s);\n@@ -354,7 +356,9 @@ impl<'a> FmtVisitor<'a> {\n             overflow_indent: Indent::empty(),\n         };\n         // 1 = \";\"\n-        match vp.rewrite(&context, self.config.max_width - offset.width() - 1, offset) {\n+        match vp.rewrite(&context,\n+                         self.config.max_width - offset.width() - 1,\n+                         offset) {\n             Some(ref s) if s.is_empty() => {\n                 // Format up to last newline\n                 let prev_span = codemap::mk_sp(self.last_pos, span.lo);"}, {"sha": "346bbcd9123771074980bed1f96583fc6045f6b9", "filename": "tests/system.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/tests%2Fsystem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/tests%2Fsystem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsystem.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -89,7 +89,9 @@ fn self_tests() {\n         warnings += format_report.warning_count();\n     }\n \n-    assert!(warnings == 0, \"Rustfmt's code generated {} warnings\", warnings);\n+    assert!(warnings == 0,\n+            \"Rustfmt's code generated {} warnings\",\n+            warnings);\n }\n \n // For each file, run rustfmt and collect the output.\n@@ -122,7 +124,8 @@ fn print_mismatches(result: HashMap<String, Vec<Mismatch>>) {\n     let mut t = term::stdout().unwrap();\n \n     for (file_name, diff) in result {\n-        print_diff(diff, |line_num| format!(\"\\nMismatch at {}:{}:\", file_name, line_num));\n+        print_diff(diff,\n+                   |line_num| format!(\"\\nMismatch at {}:{}:\", file_name, line_num));\n     }\n \n     assert!(t.reset().unwrap());"}, {"sha": "72acae8dbd9acbe496fd7e417e847f8cd84268f3", "filename": "tests/target/closure.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/tests%2Ftarget%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/tests%2Ftarget%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fclosure.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -9,7 +9,8 @@ fn main() {\n                      b: WithType, // argument\n                      // ignored\n                      _| {\n-        (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb)\n+        (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n+         bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb)\n     };\n \n     let block_body = move |xxxxxxxxxxxxxxxxxxxxxxxxxxxxx,"}, {"sha": "f2c929dde6d3825e84f52df51f928afb262a3b67", "filename": "tests/target/tuple.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9a5688f7c238c3c62d193972a93d7006cccfe8e4/tests%2Ftarget%2Ftuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5688f7c238c3c62d193972a93d7006cccfe8e4/tests%2Ftarget%2Ftuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ftuple.rs?ref=9a5688f7c238c3c62d193972a93d7006cccfe8e4", "patch": "@@ -2,7 +2,9 @@\n \n fn foo() {\n     let a = (a, a, a, a, a);\n-    let aaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa, aaaaaaaaaaaaaa, aaaaaaaaaaaaaa);\n+    let aaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n+                            aaaaaaaaaaaaaa,\n+                            aaaaaaaaaaaaaa);\n     let aaaaaaaaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n                                   aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n                                   aaaaaaaaaaaaaaaaaaaaaaaaa,\n@@ -24,6 +26,7 @@ fn a() {\n }\n \n fn b() {\n-    ((bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n+    ((bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb,\n+      bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n      bbbbbbbbbbbbbbbbbb)\n }"}]}