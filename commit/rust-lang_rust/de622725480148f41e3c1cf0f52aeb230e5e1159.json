{"sha": "de622725480148f41e3c1cf0f52aeb230e5e1159", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlNjIyNzI1NDgwMTQ4ZjQxZTNjMWNmMGY1MmFlYjIzMGU1ZTExNTk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-11-19T15:26:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-19T15:26:42Z"}, "message": "Rollup merge of #79156 - jyn514:relative-llvm, r=Mark-Simulacrum\n\nAllow using `download-ci-llvm` from directories other than the root\n\nPreviously, bootstrap.py would attempt to find the LLVM commit from\n`src/llvm-project`. However, it assumed it was always being run from the\ntop-level directory, which isn't always the case.\n\nBefore:\n\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds//rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n\ncurl: (22) The requested URL returned error: 404\nfailed to run: curl -# -y 30 -Y 10 --connect-timeout 30 --retry 3 -Sf -o /tmp/tmppyh4w8 https://ci-artifacts.rust-lang.org/rustc-builds//rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\nBuild completed unsuccessfully in 0:00:02\n```\n\nAfter:\n\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/430feb24a46993e5073c1bb1b39da190d83fa2bf/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n ###################################################################################################################################################################### 100.0%\nextracting /home/joshua/rustc/src/bootstrap/build/cache/llvm-430feb24a46993e5073c1bb1b39da190d83fa2bf-False/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n```\n\nr? ```@Mark-Simulacrum```\ncc ```@pnkfelix```", "tree": {"sha": "3eff85d5a7152e2936d30253fef830a9e117ad7b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3eff85d5a7152e2936d30253fef830a9e117ad7b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de622725480148f41e3c1cf0f52aeb230e5e1159", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfto6yCRBK7hj4Ov3rIwAAdHIIAF4RewY9avAtakf1H8E6QLGU\nlxtg7d3+FMOmTbpaBbwIohyR0PhNClohW8o07xqyyFEpk7jgvVuWSIQIv3w2UAWZ\nNYQvJhv1CfyH2WAkm64LNfyqLePAkKVt0PamWOxC8/XdKh/NhkOyaQ8u4Q8XO1yx\n6Bn7FwqlwLDXOvmpC8uBBTk0IlgUd95Pq4JPnXg42mPA8Qkyt26CD5pGwzLq3PZ8\nKwAol6ETIthf9B4hotHu9xYgcVoMcUVtc+/TvxylPiUN6r3b+XYb63sAOiBXOC8Q\nI1hxL29apGfH5l98iDkBjodWCLXQXgUBuuc1kd72WHKij16HHuznL68U+a9IaEY=\n=gl2A\n-----END PGP SIGNATURE-----\n", "payload": "tree 3eff85d5a7152e2936d30253fef830a9e117ad7b\nparent 3b857a5a3aa49b3ec1f69ad0e62812e7ae26d7b9\nparent 5163912e564e754fdab395af66b5589cc3df2f1b\nauthor Dylan DPC <dylan.dpc@gmail.com> 1605799602 +0100\ncommitter GitHub <noreply@github.com> 1605799602 +0100\n\nRollup merge of #79156 - jyn514:relative-llvm, r=Mark-Simulacrum\n\nAllow using `download-ci-llvm` from directories other than the root\n\nPreviously, bootstrap.py would attempt to find the LLVM commit from\n`src/llvm-project`. However, it assumed it was always being run from the\ntop-level directory, which isn't always the case.\n\nBefore:\n\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds//rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n\ncurl: (22) The requested URL returned error: 404\nfailed to run: curl -# -y 30 -Y 10 --connect-timeout 30 --retry 3 -Sf -o /tmp/tmppyh4w8 https://ci-artifacts.rust-lang.org/rustc-builds//rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\nBuild completed unsuccessfully in 0:00:02\n```\n\nAfter:\n\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/430feb24a46993e5073c1bb1b39da190d83fa2bf/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n ###################################################################################################################################################################### 100.0%\nextracting /home/joshua/rustc/src/bootstrap/build/cache/llvm-430feb24a46993e5073c1bb1b39da190d83fa2bf-False/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n```\n\nr? ```@Mark-Simulacrum```\ncc ```@pnkfelix```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de622725480148f41e3c1cf0f52aeb230e5e1159", "html_url": "https://github.com/rust-lang/rust/commit/de622725480148f41e3c1cf0f52aeb230e5e1159", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de622725480148f41e3c1cf0f52aeb230e5e1159/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b857a5a3aa49b3ec1f69ad0e62812e7ae26d7b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b857a5a3aa49b3ec1f69ad0e62812e7ae26d7b9", "html_url": "https://github.com/rust-lang/rust/commit/3b857a5a3aa49b3ec1f69ad0e62812e7ae26d7b9"}, {"sha": "5163912e564e754fdab395af66b5589cc3df2f1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5163912e564e754fdab395af66b5589cc3df2f1b", "html_url": "https://github.com/rust-lang/rust/commit/5163912e564e754fdab395af66b5589cc3df2f1b"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "a819e1b6e2f1ebe1c53e520fa13a35cf756fea74", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/de622725480148f41e3c1cf0f52aeb230e5e1159/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/de622725480148f41e3c1cf0f52aeb230e5e1159/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=de622725480148f41e3c1cf0f52aeb230e5e1159", "patch": "@@ -437,12 +437,15 @@ def download_stage0(self):\n             #\n             # This works even in a repository that has not yet initialized\n             # submodules.\n+            top_level = subprocess.check_output([\n+                \"git\", \"rev-parse\", \"--show-toplevel\",\n+            ]).decode(sys.getdefaultencoding()).strip()\n             llvm_sha = subprocess.check_output([\n                 \"git\", \"log\", \"--author=bors\", \"--format=%H\", \"-n1\",\n                 \"-m\", \"--first-parent\",\n                 \"--\",\n-                \"src/llvm-project\",\n-                \"src/bootstrap/download-ci-llvm-stamp\",\n+                \"{}/src/llvm-project\".format(top_level),\n+                \"{}/src/bootstrap/download-ci-llvm-stamp\".format(top_level),\n             ]).decode(sys.getdefaultencoding()).strip()\n             llvm_assertions = self.get_toml('assertions', 'llvm') == 'true'\n             if self.program_out_of_date(self.llvm_stamp(), llvm_sha + str(llvm_assertions)):"}]}