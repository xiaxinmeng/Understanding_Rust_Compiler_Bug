{"sha": "0a858dc859f828af2c578bcf23418dd14c767f3c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBhODU4ZGM4NTlmODI4YWYyYzU3OGJjZjIzNDE4ZGQxNGM3NjdmM2M=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2018-10-17T22:51:01Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2018-10-17T22:51:01Z"}, "message": "Don't warn about parentheses on `match (return)`", "tree": {"sha": "9abacf91bc6ddd2cebddc7f4d0aa8b08d02439e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9abacf91bc6ddd2cebddc7f4d0aa8b08d02439e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a858dc859f828af2c578bcf23418dd14c767f3c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a858dc859f828af2c578bcf23418dd14c767f3c", "html_url": "https://github.com/rust-lang/rust/commit/0a858dc859f828af2c578bcf23418dd14c767f3c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a858dc859f828af2c578bcf23418dd14c767f3c/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ea8eb55cd9f4547b332f43c9f723de30187c223", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ea8eb55cd9f4547b332f43c9f723de30187c223", "html_url": "https://github.com/rust-lang/rust/commit/5ea8eb55cd9f4547b332f43c9f723de30187c223"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "4cf2072e792ca3ee6a50420f4df9c27177f71f67", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/0a858dc859f828af2c578bcf23418dd14c767f3c/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a858dc859f828af2c578bcf23418dd14c767f3c/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=0a858dc859f828af2c578bcf23418dd14c767f3c", "patch": "@@ -276,10 +276,13 @@ impl UnusedParens {\n                                 cx: &EarlyContext,\n                                 value: &ast::Expr,\n                                 msg: &str,\n-                                struct_lit_needs_parens: bool) {\n+                                followed_by_block: bool) {\n         if let ast::ExprKind::Paren(ref inner) = value.node {\n-            let necessary = struct_lit_needs_parens &&\n-                            parser::contains_exterior_struct_lit(&inner);\n+            let necessary = followed_by_block && if let ast::ExprKind::Ret(_) = inner.node {\n+                true\n+            } else {\n+                parser::contains_exterior_struct_lit(&inner)\n+            };\n             if !necessary {\n                 let pattern = pprust::expr_to_string(value);\n                 Self::remove_outer_parens(cx, value.span, &pattern, msg);\n@@ -343,7 +346,7 @@ impl LintPass for UnusedParens {\n impl EarlyLintPass for UnusedParens {\n     fn check_expr(&mut self, cx: &EarlyContext, e: &ast::Expr) {\n         use syntax::ast::ExprKind::*;\n-        let (value, msg, struct_lit_needs_parens) = match e.node {\n+        let (value, msg, followed_by_block) = match e.node {\n             If(ref cond, ..) => (cond, \"`if` condition\", true),\n             While(ref cond, ..) => (cond, \"`while` condition\", true),\n             IfLet(_, ref cond, ..) => (cond, \"`if let` head expression\", true),\n@@ -380,7 +383,7 @@ impl EarlyLintPass for UnusedParens {\n                 return;\n             }\n         };\n-        self.check_unused_parens_expr(cx, &value, msg, struct_lit_needs_parens);\n+        self.check_unused_parens_expr(cx, &value, msg, followed_by_block);\n     }\n \n     fn check_pat(&mut self, cx: &EarlyContext, p: &ast::Pat) {"}, {"sha": "fc8dbb743e1f332eb08ae78269457727d485a954", "filename": "src/test/ui/lint/no-unused-parens-return-block.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0a858dc859f828af2c578bcf23418dd14c767f3c/src%2Ftest%2Fui%2Flint%2Fno-unused-parens-return-block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a858dc859f828af2c578bcf23418dd14c767f3c/src%2Ftest%2Fui%2Flint%2Fno-unused-parens-return-block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fno-unused-parens-return-block.rs?ref=0a858dc859f828af2c578bcf23418dd14c767f3c", "patch": "@@ -0,0 +1,6 @@\n+// run-pass\n+\n+fn main() {\n+    match (return) {} // ok\n+    if (return) {} // ok\n+}"}]}