{"sha": "0e5b62c8d83046595f1be9231af3564644c4cfc1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlNWI2MmM4ZDgzMDQ2NTk1ZjFiZTkyMzFhZjM1NjQ2NDRjNGNmYzE=", "commit": {"author": {"name": "llogiq", "email": "bogusandre@gmail.com", "date": "2015-06-11T14:53:23Z"}, "committer": {"name": "llogiq", "email": "bogusandre@gmail.com", "date": "2015-06-11T14:53:23Z"}, "message": "also included String::from in cmp_owned and fixed deprecation in test", "tree": {"sha": "10163eaf7654d6ae66160a346edf64a9d5e5a4ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/10163eaf7654d6ae66160a346edf64a9d5e5a4ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e5b62c8d83046595f1be9231af3564644c4cfc1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e5b62c8d83046595f1be9231af3564644c4cfc1", "html_url": "https://github.com/rust-lang/rust/commit/0e5b62c8d83046595f1be9231af3564644c4cfc1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e5b62c8d83046595f1be9231af3564644c4cfc1/comments", "author": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "committer": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "url": "https://api.github.com/repos/rust-lang/rust/commits/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8", "html_url": "https://github.com/rust-lang/rust/commit/23caf3cccc598dbe3228e407cc5864e9c5b6d5b8"}], "stats": {"total": 14, "additions": 10, "deletions": 4}, "files": [{"sha": "ec609fd26186d5164705ed77c5f7425047a3066d", "filename": "src/misc.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0e5b62c8d83046595f1be9231af3564644c4cfc1/src%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e5b62c8d83046595f1be9231af3564644c4cfc1/src%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmisc.rs?ref=0e5b62c8d83046595f1be9231af3564644c4cfc1", "patch": "@@ -7,8 +7,8 @@ use rustc::lint::{Context, LintPass, LintArray, Lint, Level};\n use rustc::middle::ty::{self, expr_ty, ty_str, ty_ptr, ty_rptr, ty_float};\n use syntax::codemap::{Span, Spanned};\n \n-\n use types::span_note_and_lint;\n+use utils::match_path;\n \n pub fn walk_ty<'t>(ty: ty::Ty<'t>) -> ty::Ty<'t> {\n \tmatch ty.sty {\n@@ -248,8 +248,8 @@ fn check_to_owned(cx: &Context, expr: &Expr, other_span: Span) {\n \t\t},\n \t\t&ExprCall(ref path, _) => {\n \t\t\tif let &ExprPath(None, ref path) = &path.node {\n-\t\t\t\tif path.segments.iter().zip([\"String\", \"from_str\"].iter()).all(\n-\t\t\t\t\t\t|(seg, name)| &seg.identifier.as_str() == name) {\n+\t\t\t\tif match_path(path, &[\"String\", \"from_str\"]) ||\n+\t\t\t\t\t\tmatch_path(path, &[\"String\", \"from\"]) {\n \t\t\t\t\tcx.span_lint(CMP_OWNED, expr.span, &format!(\n \t\t\t\t\t\"this creates an owned instance just for comparison. \\\n \t\t\t\t\tConsider using {}.as_slice() to compare without allocation\","}, {"sha": "d7399e6d3aad16ebd8617454edf6e2f7849f31ec", "filename": "tests/compile-fail/cmp_owned.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0e5b62c8d83046595f1be9231af3564644c4cfc1/tests%2Fcompile-fail%2Fcmp_owned.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e5b62c8d83046595f1be9231af3564644c4cfc1/tests%2Fcompile-fail%2Fcmp_owned.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fcmp_owned.rs?ref=0e5b62c8d83046595f1be9231af3564644c4cfc1", "patch": "@@ -13,5 +13,11 @@ fn main() {\n \t\n \tx != \"foo\".to_owned(); //~ERROR this creates an owned instance\n \t\n-\tx != String::from_str(\"foo\"); //~ERROR this creates an owned instance\n+\t#[allow(deprecated)] // for from_str\n+\tfn old_timey(x : &str) {\n+\t\tx != String::from_str(\"foo\"); //~ERROR this creates an owned instance\n+\t}\n+\told_timey(x);\n+\t\n+\tx != String::from(\"foo\"); //~ERROR this creates an owned instance\n }"}]}