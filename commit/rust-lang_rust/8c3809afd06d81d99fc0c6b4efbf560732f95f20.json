{"sha": "8c3809afd06d81d99fc0c6b4efbf560732f95f20", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjMzgwOWFmZDA2ZDgxZDk5ZmMwYzZiNGVmYmY1NjA3MzJmOTVmMjA=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-06-02T01:31:09Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-06-02T01:32:05Z"}, "message": "stdlib: Add some functions to getopts to deal with optional arguments more easily", "tree": {"sha": "f15a941f2f8404320388a4fc6238b7c2437c381e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f15a941f2f8404320388a4fc6238b7c2437c381e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8c3809afd06d81d99fc0c6b4efbf560732f95f20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8c3809afd06d81d99fc0c6b4efbf560732f95f20", "html_url": "https://github.com/rust-lang/rust/commit/8c3809afd06d81d99fc0c6b4efbf560732f95f20", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8c3809afd06d81d99fc0c6b4efbf560732f95f20/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "24c9d7e5f85aa9324dbb2313101cf4c0d9826dc3", "url": "https://api.github.com/repos/rust-lang/rust/commits/24c9d7e5f85aa9324dbb2313101cf4c0d9826dc3", "html_url": "https://github.com/rust-lang/rust/commit/24c9d7e5f85aa9324dbb2313101cf4c0d9826dc3"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "febccbeb76f694d7c257dfcb77631e8e75c705b0", "filename": "src/lib/getopts.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/8c3809afd06d81d99fc0c6b4efbf560732f95f20/src%2Flib%2Fgetopts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c3809afd06d81d99fc0c6b4efbf560732f95f20/src%2Flib%2Fgetopts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Fgetopts.rs?ref=8c3809afd06d81d99fc0c6b4efbf560732f95f20", "patch": "@@ -15,6 +15,7 @@ export opt;\n export reqopt;\n export optopt;\n export optflag;\n+export optflagopt;\n export optmulti;\n \n export getopts;\n@@ -32,6 +33,7 @@ export opt_present;\n export opt_str;\n export opt_strs;\n export opt_maybe_str;\n+export opt_default;\n \n tag name { long(str); short(char); }\n tag hasarg { yes; no; maybe; }\n@@ -55,6 +57,9 @@ fn optopt(str name) -> opt {\n fn optflag(str name) -> opt {\n     ret rec(name=mkname(name), hasarg=no, occur=optional);\n }\n+fn optflagopt(str name) -> opt {\n+    ret rec(name=mkname(name), hasarg=maybe, occur=optional);\n+}\n fn optmulti(str name) -> opt {\n     ret rec(name=mkname(name), hasarg=yes, occur=multi);\n }\n@@ -272,6 +277,18 @@ fn opt_maybe_str(match m, str nm) -> option::t[str] {\n     };\n }\n \n+/// Returns none if the option was not present, `def` if the option was\n+/// present but no argument was provided, and the argument if the option was\n+/// present and an argument was provided.\n+fn opt_default(match m, str nm, str def) -> option::t[str] {\n+    auto vals = opt_vals(m, nm);\n+    if (vec::len[optval](vals) == 0u) { ret none[str]; }\n+    ret alt (vals.(0)) {\n+        case (val(?s)) { some[str](s) }\n+        case (_) { some[str](def) }\n+    }\n+}\n+\n // Local Variables:\n // mode: rust;\n // fill-column: 78;"}]}