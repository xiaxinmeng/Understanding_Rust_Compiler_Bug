{"sha": "9ed883f3735e15deb04e9123b6f3fd3aef68d8cd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllZDg4M2YzNzM1ZTE1ZGViMDRlOTEyM2I2ZjNmZDNhZWY2OGQ4Y2Q=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-11-26T12:33:47Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-11-26T12:33:47Z"}, "message": "Publish diagnostics on file open\n\nDiagnostics are sometimes only showing up when typing.\nThis should fix that.", "tree": {"sha": "f234e1cb10f8f94c845f4939119d40a18e5f2069", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f234e1cb10f8f94c845f4939119d40a18e5f2069"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ed883f3735e15deb04e9123b6f3fd3aef68d8cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ed883f3735e15deb04e9123b6f3fd3aef68d8cd", "html_url": "https://github.com/rust-lang/rust/commit/9ed883f3735e15deb04e9123b6f3fd3aef68d8cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ed883f3735e15deb04e9123b6f3fd3aef68d8cd/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db6988d4e7646c09dc882fddcd5d9cf74f467276", "url": "https://api.github.com/repos/rust-lang/rust/commits/db6988d4e7646c09dc882fddcd5d9cf74f467276", "html_url": "https://github.com/rust-lang/rust/commit/db6988d4e7646c09dc882fddcd5d9cf74f467276"}], "stats": {"total": 17, "additions": 9, "deletions": 8}, "files": [{"sha": "470c2e2284e70e905f82c51274002f03a2392b37", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/9ed883f3735e15deb04e9123b6f3fd3aef68d8cd/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ed883f3735e15deb04e9123b6f3fd3aef68d8cd/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=9ed883f3735e15deb04e9123b6f3fd3aef68d8cd", "patch": "@@ -348,13 +348,7 @@ impl GlobalState {\n         }\n \n         if self.status == Status::Ready && (state_changed || prev_status == Status::Loading) {\n-            let subscriptions = self\n-                .mem_docs\n-                .keys()\n-                .map(|path| self.vfs.read().0.file_id(&path).unwrap())\n-                .collect::<Vec<_>>();\n-\n-            self.update_file_notifications_on_threadpool(subscriptions);\n+            self.update_file_notifications_on_threadpool();\n \n             // Refresh semantic tokens if the client supports it.\n             if self.config.semantic_tokens_refresh {\n@@ -498,6 +492,7 @@ impl GlobalState {\n                         .write()\n                         .0\n                         .set_file_contents(path, Some(params.text_document.text.into_bytes()));\n+                    this.update_file_notifications_on_threadpool();\n                 }\n                 Ok(())\n             })?\n@@ -606,7 +601,13 @@ impl GlobalState {\n             .finish();\n         Ok(())\n     }\n-    fn update_file_notifications_on_threadpool(&mut self, subscriptions: Vec<FileId>) {\n+    fn update_file_notifications_on_threadpool(&mut self) {\n+        let subscriptions = self\n+            .mem_docs\n+            .keys()\n+            .map(|path| self.vfs.read().0.file_id(&path).unwrap())\n+            .collect::<Vec<_>>();\n+\n         log::trace!(\"updating notifications for {:?}\", subscriptions);\n         if self.config.publish_diagnostics {\n             let snapshot = self.snapshot();"}]}