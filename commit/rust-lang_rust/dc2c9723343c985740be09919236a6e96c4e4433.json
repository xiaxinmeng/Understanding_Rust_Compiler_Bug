{"sha": "dc2c9723343c985740be09919236a6e96c4e4433", "node_id": "C_kwDOAAsO6NoAKGRjMmM5NzIzMzQzYzk4NTc0MGJlMDk5MTkyMzZhNmU5NmM0ZTQ0MzM", "commit": {"author": {"name": "cynecx", "email": "me@cynecx.net", "date": "2021-10-24T19:59:53Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-11-29T10:08:53Z"}, "message": "rustdoc: rework source sidebar", "tree": {"sha": "20ce27b6a75a1208fa48eb7cedd765263188355a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20ce27b6a75a1208fa48eb7cedd765263188355a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dc2c9723343c985740be09919236a6e96c4e4433", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dc2c9723343c985740be09919236a6e96c4e4433", "html_url": "https://github.com/rust-lang/rust/commit/dc2c9723343c985740be09919236a6e96c4e4433", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dc2c9723343c985740be09919236a6e96c4e4433/comments", "author": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "501b3d2b1fd22df4881692be417004237d54ac8d", "url": "https://api.github.com/repos/rust-lang/rust/commits/501b3d2b1fd22df4881692be417004237d54ac8d", "html_url": "https://github.com/rust-lang/rust/commit/501b3d2b1fd22df4881692be417004237d54ac8d"}], "stats": {"total": 104, "additions": 57, "deletions": 47}, "files": [{"sha": "c71d9fc6adf3e8cfd670df943e516e8b09140aa6", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 48, "deletions": 31, "changes": 79, "blob_url": "https://github.com/rust-lang/rust/blob/dc2c9723343c985740be09919236a6e96c4e4433/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/dc2c9723343c985740be09919236a6e96c4e4433/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=dc2c9723343c985740be09919236a6e96c4e4433", "patch": "@@ -334,7 +334,7 @@ nav.sub {\n }\n \n .source .sidebar {\n-\twidth: 0px;\n+\twidth: 50px;\n \tmin-width: 0px;\n \tmax-width: 300px;\n \tflex-grow: 0;\n@@ -343,6 +343,24 @@ nav.sub {\n \tborder-right: 1px solid;\n \ttransition: width .5s;\n \toverflow-x: hidden;\n+\t/* The sidebar is by default hidden  */\n+\toverflow-y: hidden;\n+}\n+\n+.source .sidebar > *:not(:first-child) {\n+\ttransition: opacity 0.5s, visibility 0.2s;\n+\topacity: 0;\n+\tvisibility: hidden;\n+}\n+\n+.source .sidebar.expanded {\n+\toverflow-y: auto;\n+\twidth: 300px !important;\n+}\n+\n+.source .sidebar.expanded > * {\n+\topacity: 1;\n+\tvisibility: visible;\n }\n \n /* Improve the scrollbar display on firefox */\n@@ -375,23 +393,15 @@ nav.sub {\n }\n \n .logo-container {\n-\theight: 100px;\n-\twidth: 100px;\n-\tposition: relative;\n-\tmargin: 20px auto;\n-\tdisplay: block;\n+\tdisplay: flex;\n \tmargin-top: 10px;\n+\tmargin-bottom: 10px;\n+\tjustify-content: center;\n }\n \n .logo-container > img {\n-\tmax-width: 100px;\n-\tmax-height: 100px;\n-\theight: 100%;\n-\tposition: absolute;\n-\tleft: 50%;\n-\ttop: 50%;\n-\ttransform: translate(-50%, -50%);\n-\tdisplay: block;\n+\theight: 100px;\n+\twidth: 100px;\n }\n \n .sidebar .location {\n@@ -1347,19 +1357,18 @@ pre.rust {\n }\n \n #sidebar-toggle {\n-\tposition: fixed;\n-\ttop: 30px;\n-\tleft: 300px;\n-\tz-index: 10;\n-\tpadding: 3px;\n-\tborder-top-right-radius: 3px;\n-\tborder-bottom-right-radius: 3px;\n+\tposition: sticky;\n+\ttop: 0;\n+\tleft: 0;\n \tcursor: pointer;\n \tfont-weight: bold;\n-\ttransition: left .5s;\n \tfont-size: 1.2em;\n-\tborder: 1px solid;\n-\tborder-left: 0;\n+\tborder-bottom: 1px solid;\n+\tdisplay: flex;\n+\theight: 40px;\n+\tjustify-content: center;\n+\talign-items: center;\n+\tz-index: 10;\n }\n #source-sidebar {\n \twidth: 300px;\n@@ -1700,6 +1709,7 @@ details.rustdoc-toggle[open] > summary.hideme::after {\n \t\tleft: 0;\n \t\tmargin: 0;\n \t\tz-index: 11;\n+\t\twidth: 0;\n \t}\n \n \t.sidebar.mobile {\n@@ -1726,12 +1736,6 @@ details.rustdoc-toggle[open] > summary.hideme::after {\n \t\tpadding: 0;\n \t}\n \n-\t.rustdoc.source .sidebar .logo-container {\n-\t\twidth: 100%;\n-\t\theight: 45px;\n-\t\tmargin: 0 auto;\n-\t}\n-\n \t.rustdoc:not(.source) .sidebar .logo-container {\n \t\twidth: 35px;\n \t\theight: 35px;\n@@ -1892,12 +1896,25 @@ details.rustdoc-toggle[open] > summary.hideme::after {\n \t\tmargin: 10px;\n \t}\n \n-\t#sidebar-toggle {\n+\t.sidebar.expanded #sidebar-toggle {\n+\t\tfont-size: 1.5rem;\n+\t}\n+\n+\t.sidebar:not(.expanded) #sidebar-toggle {\n+\t\tposition: fixed;\n+\t\tleft: 1px;\n \t\ttop: 100px;\n \t\twidth: 30px;\n \t\tfont-size: 1.5rem;\n \t\ttext-align: center;\n \t\tpadding: 0;\n+\t\tz-index: 10;\n+\t\tborder-top-right-radius: 3px;\n+\t\tborder-bottom-right-radius: 3px;\n+\t\tcursor: pointer;\n+\t\tfont-weight: bold;\n+\t\tborder: 1px solid;\n+\t\tborder-left: 0;\n \t}\n \n \t#source-sidebar {"}, {"sha": "fb30bf79a6d24c3aebb646a4d613e1698f6b7705", "filename": "src/librustdoc/html/static/js/source-script.js", "status": "modified", "additions": 9, "deletions": 16, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/dc2c9723343c985740be09919236a6e96c4e4433/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/dc2c9723343c985740be09919236a6e96c4e4433/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js?ref=dc2c9723343c985740be09919236a6e96c4e4433", "patch": "@@ -78,15 +78,13 @@ function createDirEntry(elem, parent, fullPath, currentFile, hasFoundFile) {\n \n function toggleSidebar() {\n     var sidebar = document.querySelector(\"nav.sidebar\");\n-    var child = this.children[0].children[0];\n+    var child = this.children[0];\n     if (child.innerText === \">\") {\n-        sidebar.style.width = \"300px\";\n-        this.style.left = \"\";\n+        sidebar.classList.add(\"expanded\");\n         child.innerText = \"<\";\n         updateLocalStorage(\"rustdoc-source-sidebar-show\", \"true\");\n     } else {\n-        sidebar.style.width = \"0\";\n-        this.style.left = \"0\";\n+        sidebar.classList.remove(\"expanded\");\n         child.innerText = \">\";\n         updateLocalStorage(\"rustdoc-source-sidebar-show\", \"false\");\n     }\n@@ -97,20 +95,15 @@ function createSidebarToggle() {\n     sidebarToggle.id = \"sidebar-toggle\";\n     sidebarToggle.onclick = toggleSidebar;\n \n-    var inner1 = document.createElement(\"div\");\n-    inner1.style.position = \"relative\";\n+    var inner = document.createElement(\"div\");\n \n-    var inner2 = document.createElement(\"div\");\n-    inner2.style.paddingTop = \"3px\";\n     if (getCurrentValue(\"rustdoc-source-sidebar-show\") === \"true\") {\n-        inner2.innerText = \"<\";\n+        inner.innerText = \"<\";\n     } else {\n-        inner2.innerText = \">\";\n-        sidebarToggle.style.left = \"0\";\n+        inner.innerText = \">\";\n     }\n \n-    inner1.appendChild(inner2);\n-    sidebarToggle.appendChild(inner1);\n+    sidebarToggle.appendChild(inner);\n     return sidebarToggle;\n }\n \n@@ -128,9 +121,9 @@ function createSourceSidebar() {\n     var sidebar = document.createElement(\"div\");\n     sidebar.id = \"source-sidebar\";\n     if (getCurrentValue(\"rustdoc-source-sidebar-show\") !== \"true\") {\n-        main.style.width = \"0px\";\n+        main.classList.remove(\"expanded\");\n     } else {\n-        main.style.width = \"300px\";\n+        main.classList.add(\"expanded\");\n     }\n \n     var currentFile = getCurrentFilePath();"}]}