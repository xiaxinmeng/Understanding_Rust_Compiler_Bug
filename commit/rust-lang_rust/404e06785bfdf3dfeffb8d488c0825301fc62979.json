{"sha": "404e06785bfdf3dfeffb8d488c0825301fc62979", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwNGUwNjc4NWJmZGYzZGZlZmZiOGQ0ODhjMDgyNTMwMWZjNjI5Nzk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-04-18T23:04:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-18T23:04:49Z"}, "message": "Rollup merge of #71276 - RalfJung:miri-unleash-box, r=ecstatic-morse\n\nmiri-unleashed: test that we detect heap allocations\n\nThis removes the second-to-last use of `IS_SUPPORTED_IN_MIRI = false`.\n\nr? @ecstatic-morse @oli-obk", "tree": {"sha": "c76653a660ed08b536d3fd82a6537f0b1608dd90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c76653a660ed08b536d3fd82a6537f0b1608dd90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/404e06785bfdf3dfeffb8d488c0825301fc62979", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJem4eSCRBK7hj4Ov3rIwAAdHIIAFk3idDbO5aU2RoSRtFBKrmj\nUaJzeXaAUrTgBS/j53ffLoE4rZDqhl5N0ZoMDq5zisFZ8HvU2wrMB2i4xmrsz2FJ\nkg83O6Cv6mVBQvBz4mLCJpMJ3sUdYU21u9CqWZhC5xWXGzVHOoTlxPVMd/7Z36/c\nS9oMKTuRz/1/L3HI5qW4LzKXWoP1RtCOotWcgI1/fFZ+O80/w9k3JkKWX8bX7CFo\nqjZOdQDXXFww83/njklFRmnM6evwZ1Q76Rc8wkVvWFZnqPEOdjiapAI04pRPIj/E\nSmwOXsRQRvsDKix8eDgKWEgBJIQxQ4AuEWG6zPNIGxmhgGzHxNJIMnz8kAxsIa4=\n=Mks5\n-----END PGP SIGNATURE-----\n", "payload": "tree c76653a660ed08b536d3fd82a6537f0b1608dd90\nparent 2af681b731a90c5b194fc69682e8a5850cfb25aa\nparent cf3470a5fc8fc08018f4fe42b2c03a1b96a90029\nauthor Dylan DPC <dylan.dpc@gmail.com> 1587251089 +0200\ncommitter GitHub <noreply@github.com> 1587251089 +0200\n\nRollup merge of #71276 - RalfJung:miri-unleash-box, r=ecstatic-morse\n\nmiri-unleashed: test that we detect heap allocations\n\nThis removes the second-to-last use of `IS_SUPPORTED_IN_MIRI = false`.\n\nr? @ecstatic-morse @oli-obk\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/404e06785bfdf3dfeffb8d488c0825301fc62979", "html_url": "https://github.com/rust-lang/rust/commit/404e06785bfdf3dfeffb8d488c0825301fc62979", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/404e06785bfdf3dfeffb8d488c0825301fc62979/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2af681b731a90c5b194fc69682e8a5850cfb25aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/2af681b731a90c5b194fc69682e8a5850cfb25aa", "html_url": "https://github.com/rust-lang/rust/commit/2af681b731a90c5b194fc69682e8a5850cfb25aa"}, {"sha": "cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "html_url": "https://github.com/rust-lang/rust/commit/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "1f916d5fc1d999d95ef30dfc578c1a44930084c7", "filename": "src/librustc_mir/transform/check_consts/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fmod.rs?ref=404e06785bfdf3dfeffb8d488c0825301fc62979", "patch": "@@ -13,7 +13,7 @@ use std::fmt;\n \n pub use self::qualifs::Qualif;\n \n-pub mod ops;\n+mod ops;\n pub mod qualifs;\n mod resolver;\n pub mod validation;"}, {"sha": "b5e62aa20130b1eb0bdebfdaa3ad111cdcf5da70", "filename": "src/librustc_mir/transform/check_consts/ops.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs?ref=404e06785bfdf3dfeffb8d488c0825301fc62979", "patch": "@@ -113,8 +113,6 @@ impl NonConstOp for FnCallUnstable {\n #[derive(Debug)]\n pub struct HeapAllocation;\n impl NonConstOp for HeapAllocation {\n-    const IS_SUPPORTED_IN_MIRI: bool = false;\n-\n     fn emit_error(&self, item: &Item<'_, '_>, span: Span) {\n         let mut err = struct_span_err!(\n             item.tcx.sess,"}, {"sha": "049727684d0eb96f7fbaf0d3882e9a7e82370da5", "filename": "src/test/ui/consts/miri_unleashed/box.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.rs", "raw_url": "https://github.com/rust-lang/rust/raw/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.rs?ref=404e06785bfdf3dfeffb8d488c0825301fc62979", "patch": "@@ -0,0 +1,14 @@\n+// compile-flags: -Zunleash-the-miri-inside-of-you\n+#![feature(const_mut_refs, box_syntax)]\n+#![deny(const_err)]\n+\n+use std::mem::ManuallyDrop;\n+\n+fn main() {}\n+\n+static TEST_BAD: &mut i32 = {\n+    &mut *(box 0)\n+    //~^ WARN skipping const check\n+    //~| ERROR could not evaluate static initializer\n+    //~| NOTE heap allocations\n+};"}, {"sha": "d1b404ea737cafdb2826cf27d0650f150f1a4b9d", "filename": "src/test/ui/consts/miri_unleashed/box.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/404e06785bfdf3dfeffb8d488c0825301fc62979/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.stderr?ref=404e06785bfdf3dfeffb8d488c0825301fc62979", "patch": "@@ -0,0 +1,15 @@\n+warning: skipping const checks\n+  --> $DIR/box.rs:10:11\n+   |\n+LL |     &mut *(box 0)\n+   |           ^^^^^^^\n+\n+error[E0080]: could not evaluate static initializer\n+  --> $DIR/box.rs:10:11\n+   |\n+LL |     &mut *(box 0)\n+   |           ^^^^^^^ \"heap allocations via `box` keyword\" needs an rfc before being allowed inside constants\n+\n+error: aborting due to previous error; 1 warning emitted\n+\n+For more information about this error, try `rustc --explain E0080`."}]}