{"sha": "873d312d62a7ed426e125a601fe56b60fe087ca3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3M2QzMTJkNjJhN2VkNDI2ZTEyNWE2MDFmZTU2YjYwZmUwODdjYTM=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-03-03T08:42:27Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-03-03T11:31:16Z"}, "message": "Rollup merge of #22969 - dotdash:no_alloca_zeroed, r=huonw\n\n Its only user was lvalue_scratch_datum which is called with zero=true\nanymore, so it's effectively unused.", "tree": {"sha": "1531864d076ee206c268c8731b2417b321a23b35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1531864d076ee206c268c8731b2417b321a23b35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/873d312d62a7ed426e125a601fe56b60fe087ca3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/873d312d62a7ed426e125a601fe56b60fe087ca3", "html_url": "https://github.com/rust-lang/rust/commit/873d312d62a7ed426e125a601fe56b60fe087ca3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/873d312d62a7ed426e125a601fe56b60fe087ca3/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "90686df18cddb600ddfca6fa209cb046d8c4293d", "url": "https://api.github.com/repos/rust-lang/rust/commits/90686df18cddb600ddfca6fa209cb046d8c4293d", "html_url": "https://github.com/rust-lang/rust/commit/90686df18cddb600ddfca6fa209cb046d8c4293d"}, {"sha": "f580412e952957dc1d91884338f2edc7866d1d17", "url": "https://api.github.com/repos/rust-lang/rust/commits/f580412e952957dc1d91884338f2edc7866d1d17", "html_url": "https://github.com/rust-lang/rust/commit/f580412e952957dc1d91884338f2edc7866d1d17"}], "stats": {"total": 32, "additions": 5, "deletions": 27}, "files": [{"sha": "c93140a72145686ae3dac7ee01a8142ddd111910", "filename": "src/librustc_trans/trans/adt.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/873d312d62a7ed426e125a601fe56b60fe087ca3/src%2Flibrustc_trans%2Ftrans%2Fadt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/873d312d62a7ed426e125a601fe56b60fe087ca3/src%2Flibrustc_trans%2Ftrans%2Fadt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fadt.rs?ref=873d312d62a7ed426e125a601fe56b60fe087ca3", "patch": "@@ -1000,7 +1000,7 @@ pub fn trans_drop_flag_ptr<'blk, 'tcx>(mut bcx: Block<'blk, 'tcx>, r: &Repr<'tcx\n             let fcx = bcx.fcx;\n             let custom_cleanup_scope = fcx.push_custom_cleanup_scope();\n             let scratch = unpack_datum!(bcx, datum::lvalue_scratch_datum(\n-                bcx, tcx.types.bool, \"drop_flag\", false,\n+                bcx, tcx.types.bool, \"drop_flag\",\n                 cleanup::CustomScope(custom_cleanup_scope), (), |_, bcx, _| bcx\n             ));\n             bcx = fold_variants(bcx, r, val, |variant_cx, st, value| {"}, {"sha": "2949dfb67c57d0c9eafc8f4678cb03bf65ad5f72", "filename": "src/librustc_trans/trans/base.rs", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/873d312d62a7ed426e125a601fe56b60fe087ca3/src%2Flibrustc_trans%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/873d312d62a7ed426e125a601fe56b60fe087ca3/src%2Flibrustc_trans%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fbase.rs?ref=873d312d62a7ed426e125a601fe56b60fe087ca3", "patch": "@@ -1203,21 +1203,6 @@ pub fn alloca_no_lifetime(cx: Block, ty: Type, name: &str) -> ValueRef {\n     Alloca(cx, ty, name)\n }\n \n-pub fn alloca_zeroed<'blk, 'tcx>(cx: Block<'blk, 'tcx>, ty: Ty<'tcx>,\n-                                 name: &str) -> ValueRef {\n-    let llty = type_of::type_of(cx.ccx(), ty);\n-    if cx.unreachable.get() {\n-        unsafe {\n-            return llvm::LLVMGetUndef(llty.ptr_to().to_ref());\n-        }\n-    }\n-    let p = alloca_no_lifetime(cx, llty, name);\n-    let b = cx.fcx.ccx.builder();\n-    b.position_before(cx.fcx.alloca_insert_pt.get().unwrap());\n-    memzero(&b, p, ty);\n-    p\n-}\n-\n // Creates the alloca slot which holds the pointer to the slot for the final return value\n pub fn make_return_slot_pointer<'a, 'tcx>(fcx: &FunctionContext<'a, 'tcx>,\n                                           output_type: Ty<'tcx>) -> ValueRef {\n@@ -1547,7 +1532,6 @@ fn create_datums_for_fn_args_under_call_abi<'blk, 'tcx>(\n                                   datum::lvalue_scratch_datum(bcx,\n                                                               arg_ty,\n                                                               \"tupled_args\",\n-                                                              false,\n                                                               tuple_args_scope_id,\n                                                               (),\n                                                               |(),"}, {"sha": "e181df545e6fc06aa63f4b0e2a39f2ea835d9dea", "filename": "src/librustc_trans/trans/datum.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/873d312d62a7ed426e125a601fe56b60fe087ca3/src%2Flibrustc_trans%2Ftrans%2Fdatum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/873d312d62a7ed426e125a601fe56b60fe087ca3/src%2Flibrustc_trans%2Ftrans%2Fdatum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fdatum.rs?ref=873d312d62a7ed426e125a601fe56b60fe087ca3", "patch": "@@ -195,24 +195,18 @@ pub fn immediate_rvalue_bcx<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n \n /// Allocates temporary space on the stack using alloca() and returns a by-ref Datum pointing to\n /// it. The memory will be dropped upon exit from `scope`. The callback `populate` should\n-/// initialize the memory. If `zero` is true, the space will be zeroed when it is allocated; this\n-/// is not necessary unless `bcx` does not dominate the end of `scope`.\n+/// initialize the memory.\n pub fn lvalue_scratch_datum<'blk, 'tcx, A, F>(bcx: Block<'blk, 'tcx>,\n                                               ty: Ty<'tcx>,\n                                               name: &str,\n-                                              zero: bool,\n                                               scope: cleanup::ScopeId,\n                                               arg: A,\n                                               populate: F)\n                                               -> DatumBlock<'blk, 'tcx, Lvalue> where\n     F: FnOnce(A, Block<'blk, 'tcx>, ValueRef) -> Block<'blk, 'tcx>,\n {\n-    let scratch = if zero {\n-        alloca_zeroed(bcx, ty, name)\n-    } else {\n-        let llty = type_of::type_of(bcx.ccx(), ty);\n-        alloca(bcx, llty, name)\n-    };\n+    let llty = type_of::type_of(bcx.ccx(), ty);\n+    let scratch = alloca(bcx, llty, name);\n \n     // Subtle. Populate the scratch memory *before* scheduling cleanup.\n     let bcx = populate(arg, bcx, scratch);\n@@ -383,7 +377,7 @@ impl<'tcx> Datum<'tcx, Rvalue> {\n \n             ByValue => {\n                 lvalue_scratch_datum(\n-                    bcx, self.ty, name, false, scope, self,\n+                    bcx, self.ty, name, scope, self,\n                     |this, bcx, llval| this.store_to(bcx, llval))\n             }\n         }"}]}