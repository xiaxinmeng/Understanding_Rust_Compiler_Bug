{"sha": "ffa493ab57fbb44f16efae2515abdde6876cc5c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZmYTQ5M2FiNTdmYmI0NGYxNmVmYWUyNTE1YWJkZGU2ODc2Y2M1Yzk=", "commit": {"author": {"name": "Jeremy Fitzhardinge", "email": "jeremy@goop.org", "date": "2020-05-17T08:48:01Z"}, "committer": {"name": "Jeremy Fitzhardinge", "email": "jeremy@goop.org", "date": "2020-05-26T05:47:55Z"}, "message": "Implement warning for unused dependencies.\n\nThis will print a diagnostic for crates which are mentioned as `--extern`\narguments on the command line, but are never referenced from the source.\n\nThis diagnostic is controlled by `-Wunused-crate-dependencies` or\n`#![warn(unused_crate_dependencies)]` and is \"allow\" by default.\n\nThere are cases where certain crates need to be linked in but are not\ndirectly referenced - for example if they are providing symbols for C\nlinkage. In this case the warning can be suppressed with\n`use needed_crate as _;`.\n\nThanks to @petrochenkov for simplified core.\n\nResolves issue #57274", "tree": {"sha": "bf998e9f4d9e3253f175e8f0a797da44f36ddb5d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf998e9f4d9e3253f175e8f0a797da44f36ddb5d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ffa493ab57fbb44f16efae2515abdde6876cc5c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ffa493ab57fbb44f16efae2515abdde6876cc5c9", "html_url": "https://github.com/rust-lang/rust/commit/ffa493ab57fbb44f16efae2515abdde6876cc5c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ffa493ab57fbb44f16efae2515abdde6876cc5c9/comments", "author": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f93bb2a50b37bc8bafe4d960e2afd839eaa854ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/f93bb2a50b37bc8bafe4d960e2afd839eaa854ed", "html_url": "https://github.com/rust-lang/rust/commit/f93bb2a50b37bc8bafe4d960e2afd839eaa854ed"}], "stats": {"total": 188, "additions": 188, "deletions": 0}, "files": [{"sha": "ee27342541c93178a4b4fcf432866cdc19c32a00", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -276,6 +276,7 @@ fn register_builtins(store: &mut LintStore, no_interleave_lints: bool) {\n         UNUSED_ALLOCATION,\n         UNUSED_DOC_COMMENTS,\n         UNUSED_EXTERN_CRATES,\n+        UNUSED_CRATE_DEPENDENCIES,\n         UNUSED_FEATURES,\n         UNUSED_LABELS,\n         UNUSED_PARENS,"}, {"sha": "db29e9538999a4276cb3c8a377065275c490a690", "filename": "src/librustc_metadata/creader.rs", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Flibrustc_metadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Flibrustc_metadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcreader.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -5,6 +5,7 @@ use crate::rmeta::{CrateDep, CrateMetadata, CrateNumMap, CrateRoot, MetadataBlob\n \n use rustc_ast::expand::allocator::{global_allocator_spans, AllocatorKind};\n use rustc_ast::{ast, attr};\n+use rustc_data_structures::fx::FxHashSet;\n use rustc_data_structures::svh::Svh;\n use rustc_data_structures::sync::Lrc;\n use rustc_errors::struct_span_err;\n@@ -18,6 +19,7 @@ use rustc_middle::middle::cstore::{\n };\n use rustc_middle::ty::TyCtxt;\n use rustc_session::config::{self, CrateType};\n+use rustc_session::lint;\n use rustc_session::output::validate_crate_name;\n use rustc_session::search_paths::PathKind;\n use rustc_session::{CrateDisambiguator, Session};\n@@ -49,6 +51,7 @@ pub struct CrateLoader<'a> {\n     local_crate_name: Symbol,\n     // Mutable output.\n     cstore: CStore,\n+    used_extern_options: FxHashSet<Symbol>,\n }\n \n pub enum LoadedMacro {\n@@ -205,6 +208,7 @@ impl<'a> CrateLoader<'a> {\n                 allocator_kind: None,\n                 has_global_allocator: false,\n             },\n+            used_extern_options: Default::default(),\n         }\n     }\n \n@@ -445,6 +449,9 @@ impl<'a> CrateLoader<'a> {\n         dep_kind: DepKind,\n         dep: Option<(&'b CratePaths, &'b CrateDep)>,\n     ) -> CrateNum {\n+        if dep.is_none() {\n+            self.used_extern_options.insert(name);\n+        }\n         self.maybe_resolve_crate(name, span, dep_kind, dep).unwrap_or_else(|err| err.report())\n     }\n \n@@ -839,6 +846,26 @@ impl<'a> CrateLoader<'a> {\n         });\n     }\n \n+    fn report_unused_deps(&mut self, krate: &ast::Crate) {\n+        // Make a point span rather than covering the whole file\n+        let span = krate.span.shrink_to_lo();\n+        // Complain about anything left over\n+        for (name, _) in self.sess.opts.externs.iter() {\n+            if !self.used_extern_options.contains(&Symbol::intern(name)) {\n+                self.sess.parse_sess.buffer_lint(\n+                    lint::builtin::UNUSED_CRATE_DEPENDENCIES,\n+                    span,\n+                    ast::CRATE_NODE_ID,\n+                    &format!(\n+                        \"external crate `{}` unused in `{}`: remove the dependency or add `use {} as _;`\",\n+                        name,\n+                        self.local_crate_name,\n+                        name),\n+                );\n+            }\n+        }\n+    }\n+\n     pub fn postprocess(&mut self, krate: &ast::Crate) {\n         self.inject_profiler_runtime();\n         self.inject_allocator_crate(krate);\n@@ -847,6 +874,8 @@ impl<'a> CrateLoader<'a> {\n         if log_enabled!(log::Level::Info) {\n             dump_crates(&self.cstore);\n         }\n+\n+        self.report_unused_deps(krate);\n     }\n \n     pub fn process_extern_crate("}, {"sha": "66d89087991819645d239cf5586b4bb15efbff7e", "filename": "src/librustc_session/lint/builtin.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Flibrustc_session%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Flibrustc_session%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Flint%2Fbuiltin.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -71,6 +71,12 @@ declare_lint! {\n     \"extern crates that are never used\"\n }\n \n+declare_lint! {\n+    pub UNUSED_CRATE_DEPENDENCIES,\n+    Allow,\n+    \"crate dependencies that are never used\"\n+}\n+\n declare_lint! {\n     pub UNUSED_QUALIFICATIONS,\n     Allow,\n@@ -523,6 +529,7 @@ declare_lint_pass! {\n         UNCONDITIONAL_PANIC,\n         UNUSED_IMPORTS,\n         UNUSED_EXTERN_CRATES,\n+        UNUSED_CRATE_DEPENDENCIES,\n         UNUSED_QUALIFICATIONS,\n         UNKNOWN_LINTS,\n         UNUSED_VARIABLES,"}, {"sha": "1d3824e7a44f69d27f0db29e04a9ffdd5e95a0b3", "filename": "src/test/ui/unused-crate-deps/auxiliary/bar.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fauxiliary%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fauxiliary%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fauxiliary%2Fbar.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1 @@\n+pub const BAR: &str = \"bar\";"}, {"sha": "0ef03eb9edf0f9444030eef105d1697712672817", "filename": "src/test/ui/unused-crate-deps/auxiliary/foo.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fauxiliary%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fauxiliary%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fauxiliary%2Ffoo.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,5 @@\n+// edition:2018\n+// aux-crate:bar=bar.rs\n+\n+pub const FOO: &str = \"foo\";\n+pub use bar::BAR;"}, {"sha": "c1545dca99f57b3a0fa9f891c3281dc16eaa1577", "filename": "src/test/ui/unused-crate-deps/libfib.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Flibfib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Flibfib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Flibfib.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,21 @@\n+// Test warnings for a library crate\n+\n+// check-pass\n+// aux-crate:bar=bar.rs\n+// compile-flags:--crate-type lib -Wunused-crate-dependencies\n+\n+pub fn fib(n: u32) -> Vec<u32> {\n+//~^ WARNING external crate `bar` unused in\n+let mut prev = 0;\n+    let mut cur = 1;\n+    let mut v = vec![];\n+\n+    for _ in 0..n {\n+        v.push(prev);\n+        let n = prev + cur;\n+        prev = cur;\n+        cur = n;\n+    }\n+\n+    v\n+}"}, {"sha": "15833126bd6201ddda75e3b529eb26f8dc08473c", "filename": "src/test/ui/unused-crate-deps/libfib.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Flibfib.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Flibfib.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Flibfib.stderr?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,10 @@\n+warning: external crate `bar` unused in `libfib`: remove the dependency or add `use bar as _;`\n+  --> $DIR/libfib.rs:7:1\n+   |\n+LL | pub fn fib(n: u32) -> Vec<u32> {\n+   | ^\n+   |\n+   = note: requested on the command line with `-W unused-crate-dependencies`\n+\n+warning: 1 warning emitted\n+"}, {"sha": "8904d04bc14f75ba1c1a084dd89195b2b92215f3", "filename": "src/test/ui/unused-crate-deps/suppress.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fsuppress.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fsuppress.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fsuppress.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,11 @@\n+// Suppress by using crate\n+\n+// edition:2018\n+// check-pass\n+// aux-crate:bar=bar.rs\n+\n+#![warn(unused_crate_dependencies)]\n+\n+use bar as _;\n+\n+fn main() {}"}, {"sha": "1b7cb9b970e4908d0ca713e952b4e808ecd55975", "filename": "src/test/ui/unused-crate-deps/unused-aliases.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Funused-aliases.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Funused-aliases.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Funused-aliases.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,13 @@\n+// Warn about unused aliased for the crate\n+\n+// edition:2018\n+// check-pass\n+// aux-crate:bar=bar.rs\n+// aux-crate:barbar=bar.rs\n+\n+#![warn(unused_crate_dependencies)]\n+//~^ WARNING external crate `barbar` unused in\n+\n+use bar as _;\n+\n+fn main() {}"}, {"sha": "c8c6c4507b0c51427136d656ba9de8cdbdcd3a43", "filename": "src/test/ui/unused-crate-deps/unused-aliases.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Funused-aliases.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Funused-aliases.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Funused-aliases.stderr?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,14 @@\n+warning: external crate `barbar` unused in `unused_aliases`: remove the dependency or add `use barbar as _;`\n+  --> $DIR/unused-aliases.rs:8:1\n+   |\n+LL | #![warn(unused_crate_dependencies)]\n+   | ^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/unused-aliases.rs:8:9\n+   |\n+LL | #![warn(unused_crate_dependencies)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+warning: 1 warning emitted\n+"}, {"sha": "f15c87fa0b2499647edd82dcd7879dd7b0716863", "filename": "src/test/ui/unused-crate-deps/use_extern_crate_2015.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fuse_extern_crate_2015.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fuse_extern_crate_2015.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fuse_extern_crate_2015.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,13 @@\n+// Suppress by using crate\n+\n+// edition:2015\n+// check-pass\n+// aux-crate:bar=bar.rs\n+\n+#![warn(unused_crate_dependencies)]\n+\n+extern crate bar;\n+\n+fn main() {\n+    println!(\"bar {}\", bar::BAR);\n+}"}, {"sha": "1acb307ab21b3714fd35f4cb22fa6b3964fbe94c", "filename": "src/test/ui/unused-crate-deps/warn-attr.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-attr.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,10 @@\n+// Check for unused crate dep, no path\n+\n+// edition:2018\n+// check-pass\n+// aux-crate:bar=bar.rs\n+\n+#![warn(unused_crate_dependencies)]\n+//~^ WARNING external crate `bar` unused in\n+\n+fn main() {}"}, {"sha": "0d38315704b11fb25e6bc7be22774c0714d4f4d4", "filename": "src/test/ui/unused-crate-deps/warn-attr.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-attr.stderr?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,14 @@\n+warning: external crate `bar` unused in `warn_attr`: remove the dependency or add `use bar as _;`\n+  --> $DIR/warn-attr.rs:7:1\n+   |\n+LL | #![warn(unused_crate_dependencies)]\n+   | ^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/warn-attr.rs:7:9\n+   |\n+LL | #![warn(unused_crate_dependencies)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+warning: 1 warning emitted\n+"}, {"sha": "c609529a6c6fbea18c446692a4ac6709081b5e5e", "filename": "src/test/ui/unused-crate-deps/warn-cmdline-static.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-static.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-static.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-static.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,10 @@\n+// Check for unused crate dep, no path\n+\n+// edition:2018\n+// check-pass\n+// compile-flags: -Wunused-crate-dependencies\n+// aux-crate:bar=bar.rs\n+// no-prefer-dynamic\n+\n+fn main() {}\n+//~^ WARNING external crate `bar` unused in"}, {"sha": "65956461d643928fa5a319c7ae533f3dc7e15ded", "filename": "src/test/ui/unused-crate-deps/warn-cmdline-static.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-static.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-static.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline-static.stderr?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,10 @@\n+warning: external crate `bar` unused in `warn_cmdline_static`: remove the dependency or add `use bar as _;`\n+  --> $DIR/warn-cmdline-static.rs:9:1\n+   |\n+LL | fn main() {}\n+   | ^\n+   |\n+   = note: requested on the command line with `-W unused-crate-dependencies`\n+\n+warning: 1 warning emitted\n+"}, {"sha": "3bae61c3ea2ccd2c67a247c3cbc04a85de0b8d1f", "filename": "src/test/ui/unused-crate-deps/warn-cmdline.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline.rs?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,9 @@\n+// Check for unused crate dep, no path\n+\n+// edition:2018\n+// check-pass\n+// compile-flags: -Wunused-crate-dependencies\n+// aux-crate:bar=bar.rs\n+\n+fn main() {}\n+//~^ WARNING external crate `bar` unused in"}, {"sha": "ea675ba9a1eb184560f8379ea4571e2d2b1e9ec4", "filename": "src/test/ui/unused-crate-deps/warn-cmdline.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ffa493ab57fbb44f16efae2515abdde6876cc5c9/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused-crate-deps%2Fwarn-cmdline.stderr?ref=ffa493ab57fbb44f16efae2515abdde6876cc5c9", "patch": "@@ -0,0 +1,10 @@\n+warning: external crate `bar` unused in `warn_cmdline`: remove the dependency or add `use bar as _;`\n+  --> $DIR/warn-cmdline.rs:8:1\n+   |\n+LL | fn main() {}\n+   | ^\n+   |\n+   = note: requested on the command line with `-W unused-crate-dependencies`\n+\n+warning: 1 warning emitted\n+"}]}