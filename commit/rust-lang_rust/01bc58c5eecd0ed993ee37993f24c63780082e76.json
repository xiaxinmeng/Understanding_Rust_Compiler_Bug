{"sha": "01bc58c5eecd0ed993ee37993f24c63780082e76", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxYmM1OGM1ZWVjZDBlZDk5M2VlMzc5OTNmMjRjNjM3ODAwODJlNzY=", "commit": {"author": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-05-13T21:42:55Z"}, "committer": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-05-13T21:42:55Z"}, "message": "remove compiletest's dependency on `filetime`", "tree": {"sha": "9df7c1a2c59508756a963ebc2ac974106491cf95", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9df7c1a2c59508756a963ebc2ac974106491cf95"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/01bc58c5eecd0ed993ee37993f24c63780082e76", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFKBAABCAA0FiEELriChyEaiMu0yCg7viIhAz7bw3QFAlzZ5PwWHGFydXNzZWxs\nMTIzQGdtYWlsLmNvbQAKCRC+IiEDPtvDdN7OCACHDgFZVHteW0BeVMCB9VPeb6Bf\nDwSRQSjXoDL/XiTsHCgjyj2UOt48v8fN4n4sazQr4MUu6OGteOSNR4bOAqz/Q1bg\nQqNhTN8INwASGrC/cwRGQDrZwWXSYtztDzeNozlekC51a0/WUmhWq5KdO3QBq3er\n4IDAn8mg/1FOxKeH3Ne2BY+hwXnaEl8Jvu9ngkGWMBd2gpGsJHZaCsT4rly93U5R\nxmrfDuuMfyF88JkHD3T5Og8C45Q+cJh39kx1Kc0UK0pBMyaBOYDH6744lBeJ7EAE\nVUDN3hDLNqTDZTJgnqqxCy/8yH5V8y55zsgsYNx8StX6fagMPJ4TfwOYiZlT\n=Qfqi\n-----END PGP SIGNATURE-----", "payload": "tree 9df7c1a2c59508756a963ebc2ac974106491cf95\nparent a9ec99f4201ec33026a468ef1289f98a95b4d71a\nauthor Andy Russell <arussell123@gmail.com> 1557783775 -0400\ncommitter Andy Russell <arussell123@gmail.com> 1557783775 -0400\n\nremove compiletest's dependency on `filetime`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/01bc58c5eecd0ed993ee37993f24c63780082e76", "html_url": "https://github.com/rust-lang/rust/commit/01bc58c5eecd0ed993ee37993f24c63780082e76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/01bc58c5eecd0ed993ee37993f24c63780082e76/comments", "author": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "committer": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9ec99f4201ec33026a468ef1289f98a95b4d71a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9ec99f4201ec33026a468ef1289f98a95b4d71a", "html_url": "https://github.com/rust-lang/rust/commit/a9ec99f4201ec33026a468ef1289f98a95b4d71a"}], "stats": {"total": 32, "additions": 17, "deletions": 15}, "files": [{"sha": "b6dc3bdb89bd4a737958648e569c236aebd0cdd6", "filename": "Cargo.lock", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/01bc58c5eecd0ed993ee37993f24c63780082e76/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/01bc58c5eecd0ed993ee37993f24c63780082e76/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=01bc58c5eecd0ed993ee37993f24c63780082e76", "patch": "@@ -459,7 +459,6 @@ version = \"0.0.0\"\n dependencies = [\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.5.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.3.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "e759ad1f35dde426d8efd05251d1728c76e5e93c", "filename": "src/tools/compiletest/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/01bc58c5eecd0ed993ee37993f24c63780082e76/src%2Ftools%2Fcompiletest%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/01bc58c5eecd0ed993ee37993f24c63780082e76/src%2Ftools%2Fcompiletest%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2FCargo.toml?ref=01bc58c5eecd0ed993ee37993f24c63780082e76", "patch": "@@ -7,7 +7,6 @@ edition = \"2018\"\n [dependencies]\n diff = \"0.1.10\"\n env_logger = { version = \"0.5\", default-features = false }\n-filetime = \"0.2\"\n getopts = \"0.2\"\n log = \"0.4\"\n regex = \"1.0\""}, {"sha": "442e58bfd74e1408c1ff9b9e31c5ed018ff507de", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/01bc58c5eecd0ed993ee37993f24c63780082e76/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01bc58c5eecd0ed993ee37993f24c63780082e76/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=01bc58c5eecd0ed993ee37993f24c63780082e76", "patch": "@@ -9,14 +9,14 @@ use crate::common::CompareMode;\n use crate::common::{expected_output_path, output_base_dir, output_relative_path, UI_EXTENSIONS};\n use crate::common::{Config, TestPaths};\n use crate::common::{DebugInfoBoth, DebugInfoGdb, DebugInfoLldb, Mode, Pretty};\n-use filetime::FileTime;\n use getopts::Options;\n use std::env;\n use std::ffi::OsString;\n use std::fs;\n use std::io::{self, ErrorKind};\n use std::path::{Path, PathBuf};\n use std::process::Command;\n+use std::time::SystemTime;\n use test::ColorConfig;\n use crate::util::logv;\n use walkdir::WalkDir;\n@@ -752,31 +752,36 @@ fn up_to_date(\n \n #[derive(Debug, PartialEq, PartialOrd, Ord, Eq)]\n struct Stamp {\n-    time: FileTime,\n+    time: SystemTime,\n     file: PathBuf,\n }\n \n impl Stamp {\n     fn from_path(p: &Path) -> Self {\n+        let time = fs::metadata(p)\n+            .and_then(|metadata| metadata.modified())\n+            .unwrap_or(SystemTime::UNIX_EPOCH);\n+\n         Stamp {\n-            time: mtime(&p),\n+            time,\n             file: p.into(),\n         }\n     }\n \n-    fn from_dir(path: &Path) -> impl Iterator<Item=Stamp> {\n+    fn from_dir(path: &Path) -> impl Iterator<Item = Stamp> {\n         WalkDir::new(path)\n             .into_iter()\n             .map(|entry| entry.unwrap())\n             .filter(|entry| entry.file_type().is_file())\n-            .map(|entry| Stamp::from_path(entry.path()))\n-    }\n-}\n+            .map(|entry| {\n+                let time = (|| -> io::Result<_> { entry.metadata()?.modified() })();\n \n-fn mtime(path: &Path) -> FileTime {\n-    fs::metadata(path)\n-        .map(|f| FileTime::from_last_modification_time(&f))\n-        .unwrap_or_else(|_| FileTime::zero())\n+                Stamp {\n+                    time: time.unwrap_or(SystemTime::UNIX_EPOCH),\n+                    file: entry.path().into(),\n+                }\n+            })\n+    }\n }\n \n fn make_test_name("}, {"sha": "22c2f0a05379b204d8968edbdb526dd0cb53729e", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/01bc58c5eecd0ed993ee37993f24c63780082e76/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01bc58c5eecd0ed993ee37993f24c63780082e76/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=01bc58c5eecd0ed993ee37993f24c63780082e76", "patch": "@@ -9,7 +9,6 @@ use crate::common::{Config, TestPaths};\n use crate::common::{Incremental, MirOpt, RunMake, Ui, JsDocTest, Assembly};\n use diff;\n use crate::errors::{self, Error, ErrorKind};\n-use filetime::FileTime;\n use crate::header::TestProps;\n use crate::json;\n use regex::{Captures, Regex};\n@@ -3032,7 +3031,7 @@ impl<'test> TestCx<'test> {\n     }\n \n     fn check_mir_test_timestamp(&self, test_name: &str, output_file: &Path) {\n-        let t = |file| FileTime::from_last_modification_time(&fs::metadata(file).unwrap());\n+        let t = |file| fs::metadata(file).unwrap().modified().unwrap();\n         let source_file = &self.testpaths.file;\n         let output_time = t(output_file);\n         let source_time = t(source_file);"}]}