{"sha": "a28907af8ca93077601053cf168ac2429855c394", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyODkwN2FmOGNhOTMwNzc2MDEwNTNjZjE2OGFjMjQyOTg1NWMzOTQ=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-15T07:42:54Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-15T07:42:54Z"}, "message": "Privatize modules", "tree": {"sha": "e4930115d3f0249ea3f6f899a9b10b2a62a12bef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4930115d3f0249ea3f6f899a9b10b2a62a12bef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a28907af8ca93077601053cf168ac2429855c394", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a28907af8ca93077601053cf168ac2429855c394", "html_url": "https://github.com/rust-lang/rust/commit/a28907af8ca93077601053cf168ac2429855c394", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a28907af8ca93077601053cf168ac2429855c394/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c7a2aef30cb35347af646dea5a5611af1224676", "url": "https://api.github.com/repos/rust-lang/rust/commits/9c7a2aef30cb35347af646dea5a5611af1224676", "html_url": "https://github.com/rust-lang/rust/commit/9c7a2aef30cb35347af646dea5a5611af1224676"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "1caa2e8759dc8cb94dad9a6426459aefb08ca0e6", "filename": "crates/ra_hir/src/test_db.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a28907af8ca93077601053cf168ac2429855c394/crates%2Fra_hir%2Fsrc%2Ftest_db.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a28907af8ca93077601053cf168ac2429855c394/crates%2Fra_hir%2Fsrc%2Ftest_db.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Ftest_db.rs?ref=a28907af8ca93077601053cf168ac2429855c394", "patch": "@@ -81,7 +81,7 @@ impl TestDB {\n         let crate_graph = self.crate_graph();\n         for krate in crate_graph.iter().next() {\n             let crate_def_map = self.crate_def_map(krate);\n-            for (module_id, _) in crate_def_map.modules.iter() {\n+            for module_id in crate_def_map.modules() {\n                 let module_id = ModuleId { krate, module_id };\n                 let module = crate::Module::from(module_id);\n                 module.diagnostics("}, {"sha": "5fc592150088aa4beda7b9ab193b0f00bae4a495", "filename": "crates/ra_hir_def/src/nameres.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a28907af8ca93077601053cf168ac2429855c394/crates%2Fra_hir_def%2Fsrc%2Fnameres.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a28907af8ca93077601053cf168ac2429855c394/crates%2Fra_hir_def%2Fsrc%2Fnameres.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fnameres.rs?ref=a28907af8ca93077601053cf168ac2429855c394", "patch": "@@ -87,7 +87,7 @@ pub struct CrateDefMap {\n     prelude: Option<ModuleId>,\n     extern_prelude: FxHashMap<Name, ModuleDefId>,\n     root: CrateModuleId,\n-    pub modules: Arena<CrateModuleId, ModuleData>,\n+    modules: Arena<CrateModuleId, ModuleData>,\n \n     /// Some macros are not well-behavior, which leads to infinite loop\n     /// e.g. macro_rules! foo { ($ty:ty) => { foo!($ty); } }\n@@ -259,6 +259,10 @@ impl CrateDefMap {\n         (res.resolved_def, res.segment_index)\n     }\n \n+    pub fn modules(&self) -> impl Iterator<Item = CrateModuleId> + '_ {\n+        self.modules.iter().map(|(id, _data)| id)\n+    }\n+\n     pub fn modules_for_file(&self, file_id: FileId) -> impl Iterator<Item = CrateModuleId> + '_ {\n         self.modules\n             .iter()"}]}