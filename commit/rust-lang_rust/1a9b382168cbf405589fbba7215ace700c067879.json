{"sha": "1a9b382168cbf405589fbba7215ace700c067879", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhOWIzODIxNjhjYmY0MDU1ODlmYmJhNzIxNWFjZTcwMGMwNjc4Nzk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-06T03:42:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-06T03:42:31Z"}, "message": "Auto merge of #40805 - vadimcn:msys-mingw, r=alexcrichton\n\n[Windows] Enable building rustc with \"pthreads\" flavor of mingw.\n\nTested on mingw-w64 packaged with msys2.\n\nr? @alexcrichton\n\ncc #40123", "tree": {"sha": "ecaaf285c2c836cbfabfd40a82fcbd993f5c111f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecaaf285c2c836cbfabfd40a82fcbd993f5c111f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a9b382168cbf405589fbba7215ace700c067879", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a9b382168cbf405589fbba7215ace700c067879", "html_url": "https://github.com/rust-lang/rust/commit/1a9b382168cbf405589fbba7215ace700c067879", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a9b382168cbf405589fbba7215ace700c067879/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6cd15a0e8fecce04fd99b77b25099bf374bb0f56", "url": "https://api.github.com/repos/rust-lang/rust/commits/6cd15a0e8fecce04fd99b77b25099bf374bb0f56", "html_url": "https://github.com/rust-lang/rust/commit/6cd15a0e8fecce04fd99b77b25099bf374bb0f56"}, {"sha": "ad3f6e056cdae847c3784ece2ebd8b52baa130e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad3f6e056cdae847c3784ece2ebd8b52baa130e2", "html_url": "https://github.com/rust-lang/rust/commit/ad3f6e056cdae847c3784ece2ebd8b52baa130e2"}], "stats": {"total": 189, "additions": 89, "deletions": 100}, "files": [{"sha": "9f9d3471640ff37fc7fda03740d64987a37e4bad", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -163,12 +163,13 @@ def download_stage0(self):\n         if not os.path.exists(rustc_cache):\n             os.makedirs(rustc_cache)\n \n+        channel = self.stage0_rustc_channel()\n+\n         if self.rustc().startswith(self.bin_root()) and \\\n                 (not os.path.exists(self.rustc()) or self.rustc_out_of_date()):\n             self.print_what_it_means_to_bootstrap()\n             if os.path.exists(self.bin_root()):\n                 shutil.rmtree(self.bin_root())\n-            channel = self.stage0_rustc_channel()\n             filename = \"rust-std-{}-{}.tar.gz\".format(channel, self.build)\n             url = \"https://static.rust-lang.org/dist/\" + self.stage0_rustc_date()\n             tarball = os.path.join(rustc_cache, filename)\n@@ -189,6 +190,14 @@ def download_stage0(self):\n             with open(self.rustc_stamp(), 'w') as f:\n                 f.write(self.stage0_rustc_date())\n \n+            if \"pc-windows-gnu\" in self.build:\n+                filename = \"rust-mingw-{}-{}.tar.gz\".format(channel, self.build)\n+                url = \"https://static.rust-lang.org/dist/\" + self.stage0_rustc_date()\n+                tarball = os.path.join(rustc_cache, filename)\n+                if not os.path.exists(tarball):\n+                    get(\"{}/{}\".format(url, filename), tarball, verbose=self.verbose)\n+                unpack(tarball, self.bin_root(), match=\"rust-mingw\", verbose=self.verbose)\n+\n         if self.cargo().startswith(self.bin_root()) and \\\n                 (not os.path.exists(self.cargo()) or self.cargo_out_of_date()):\n             self.print_what_it_means_to_bootstrap()"}, {"sha": "394ff97d84533872d535b598db50de8b8158de34", "filename": "src/etc/make-win-dist.py", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Fetc%2Fmake-win-dist.py", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Fetc%2Fmake-win-dist.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmake-win-dist.py?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -51,7 +51,7 @@ def make_win_dist(rust_root, plat_root, target_triple):\n \n     target_tools = [\"gcc.exe\", \"ld.exe\", \"ar.exe\", \"dlltool.exe\"]\n \n-    rustc_dlls = [\"libstdc++-6.dll\"]\n+    rustc_dlls = [\"libstdc++-6.dll\", \"libwinpthread-1.dll\"]\n     if target_triple.startswith(\"i686-\"):\n         rustc_dlls.append(\"libgcc_s_dw2-1.dll\")\n     else:\n@@ -67,6 +67,7 @@ def make_win_dist(rust_root, plat_root, target_triple):\n                     \"libstdc++.a\",\n                     \"libiconv.a\",\n                     \"libmoldname.a\",\n+                    \"libpthread.a\",\n                     # Windows import libs\n                     \"libadvapi32.a\",\n                     \"libbcrypt.a\","}, {"sha": "7d5887e699fd7fdb2329291736ca32a7130ec1f6", "filename": "src/librustc_llvm/build.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fbuild.rs?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -259,4 +259,10 @@ fn main() {\n             println!(\"cargo:rustc-link-lib={}\", stdcppname);\n         }\n     }\n+\n+    // LLVM requires symbols from this library, but apparently they're not printeds\n+    // during llvm-config?\n+    if target.contains(\"windows\") {\n+        println!(\"cargo:rustc-link-lib=ole32\");\n+    }\n }"}, {"sha": "32c9183ece999ff742f7d33f1dd9b0b92fddda20", "filename": "src/librustc_llvm/ffi.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_llvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_llvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fffi.rs?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -1662,10 +1662,3 @@ extern \"C\" {\n     pub fn LLVMRustUnsetComdat(V: ValueRef);\n     pub fn LLVMRustSetModulePIELevel(M: ModuleRef);\n }\n-\n-\n-// LLVM requires symbols from this library, but apparently they're not printed\n-// during llvm-config?\n-#[cfg(windows)]\n-#[link(name = \"ole32\")]\n-extern \"C\" {}"}, {"sha": "12a1ffa2767255aa325b6f3eff380d6fad49ca44", "filename": "src/librustc_trans/back/link.rs", "status": "modified", "additions": 6, "deletions": 25, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_trans%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_trans%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flink.rs?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -734,9 +734,10 @@ fn link_natively(sess: &Session,\n     }\n \n     {\n-        let mut linker = trans.linker_info.to_linker(&mut cmd, &sess);\n+        let mut linker = trans.linker_info.to_linker(cmd, &sess);\n         link_args(&mut *linker, sess, crate_type, tmpdir,\n                   objects, out_filename, outputs, trans);\n+        cmd = linker.finalize();\n     }\n     cmd.args(&sess.target.target.options.late_link_args);\n     for obj in &sess.target.target.options.post_link_objects {\n@@ -1021,38 +1022,18 @@ fn add_local_native_libraries(cmd: &mut Linker, sess: &Session) {\n         }\n     });\n \n-    let pair = sess.cstore.used_libraries().into_iter().filter(|l| {\n+    let relevant_libs = sess.cstore.used_libraries().into_iter().filter(|l| {\n         relevant_lib(sess, l)\n-    }).partition(|lib| {\n-        lib.kind == NativeLibraryKind::NativeStatic\n     });\n-    let (staticlibs, others): (Vec<_>, Vec<_>) = pair;\n-\n-    // Some platforms take hints about whether a library is static or dynamic.\n-    // For those that support this, we ensure we pass the option if the library\n-    // was flagged \"static\" (most defaults are dynamic) to ensure that if\n-    // libfoo.a and libfoo.so both exist that the right one is chosen.\n-    cmd.hint_static();\n \n     let search_path = archive_search_paths(sess);\n-    for l in staticlibs {\n-        // Here we explicitly ask that the entire archive is included into the\n-        // result artifact. For more details see #15460, but the gist is that\n-        // the linker will strip away any unused objects in the archive if we\n-        // don't otherwise explicitly reference them. This can occur for\n-        // libraries which are just providing bindings, libraries with generic\n-        // functions, etc.\n-        cmd.link_whole_staticlib(&l.name.as_str(), &search_path);\n-    }\n-\n-    cmd.hint_dynamic();\n-\n-    for lib in others {\n+    for lib in relevant_libs {\n         match lib.kind {\n             NativeLibraryKind::NativeUnknown => cmd.link_dylib(&lib.name.as_str()),\n             NativeLibraryKind::NativeFramework => cmd.link_framework(&lib.name.as_str()),\n             NativeLibraryKind::NativeStaticNobundle => cmd.link_staticlib(&lib.name.as_str()),\n-            NativeLibraryKind::NativeStatic => bug!(),\n+            NativeLibraryKind::NativeStatic => cmd.link_whole_staticlib(&lib.name.as_str(),\n+                                                                        &search_path)\n         }\n     }\n }"}, {"sha": "a178d17a7c2d371f01e17ce87fc7cd22a41efab7", "filename": "src/librustc_trans/back/linker.rs", "status": "modified", "additions": 62, "deletions": 65, "changes": 127, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_trans%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibrustc_trans%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flinker.rs?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -43,7 +43,7 @@ impl<'a, 'tcx> LinkerInfo {\n     }\n \n     pub fn to_linker(&'a self,\n-                     cmd: &'a mut Command,\n+                     cmd: Command,\n                      sess: &'a Session) -> Box<Linker+'a> {\n         if sess.target.target.options.is_like_msvc {\n             Box::new(MsvcLinker {\n@@ -61,7 +61,8 @@ impl<'a, 'tcx> LinkerInfo {\n             Box::new(GnuLinker {\n                 cmd: cmd,\n                 sess: sess,\n-                info: self\n+                info: self,\n+                hinted_static: false,\n             }) as Box<Linker>\n         }\n     }\n@@ -93,30 +94,49 @@ pub trait Linker {\n     fn no_default_libraries(&mut self);\n     fn build_dylib(&mut self, out_filename: &Path);\n     fn args(&mut self, args: &[String]);\n-    fn hint_static(&mut self);\n-    fn hint_dynamic(&mut self);\n-    fn whole_archives(&mut self);\n-    fn no_whole_archives(&mut self);\n     fn export_symbols(&mut self, tmpdir: &Path, crate_type: CrateType);\n     fn subsystem(&mut self, subsystem: &str);\n+    // Should have been finalize(self), but we don't support self-by-value on trait objects (yet?).\n+    fn finalize(&mut self) -> Command;\n }\n \n pub struct GnuLinker<'a> {\n-    cmd: &'a mut Command,\n+    cmd: Command,\n     sess: &'a Session,\n-    info: &'a LinkerInfo\n+    info: &'a LinkerInfo,\n+    hinted_static: bool, // Keeps track of the current hinting mode.\n }\n \n impl<'a> GnuLinker<'a> {\n     fn takes_hints(&self) -> bool {\n         !self.sess.target.target.options.is_like_osx\n     }\n+\n+    // Some platforms take hints about whether a library is static or dynamic.\n+    // For those that support this, we ensure we pass the option if the library\n+    // was flagged \"static\" (most defaults are dynamic) to ensure that if\n+    // libfoo.a and libfoo.so both exist that the right one is chosen.\n+    fn hint_static(&mut self) {\n+        if !self.takes_hints() { return }\n+        if !self.hinted_static {\n+            self.cmd.arg(\"-Wl,-Bstatic\");\n+            self.hinted_static = true;\n+        }\n+    }\n+\n+    fn hint_dynamic(&mut self) {\n+        if !self.takes_hints() { return }\n+        if self.hinted_static {\n+            self.cmd.arg(\"-Wl,-Bdynamic\");\n+            self.hinted_static = false;\n+        }\n+    }\n }\n \n impl<'a> Linker for GnuLinker<'a> {\n-    fn link_dylib(&mut self, lib: &str) { self.cmd.arg(\"-l\").arg(lib); }\n-    fn link_staticlib(&mut self, lib: &str) { self.cmd.arg(\"-l\").arg(lib); }\n-    fn link_rlib(&mut self, lib: &Path) { self.cmd.arg(lib); }\n+    fn link_dylib(&mut self, lib: &str) { self.hint_dynamic(); self.cmd.arg(\"-l\").arg(lib); }\n+    fn link_staticlib(&mut self, lib: &str) { self.hint_static(); self.cmd.arg(\"-l\").arg(lib); }\n+    fn link_rlib(&mut self, lib: &Path) { self.hint_static(); self.cmd.arg(lib); }\n     fn include_path(&mut self, path: &Path) { self.cmd.arg(\"-L\").arg(path); }\n     fn framework_path(&mut self, path: &Path) { self.cmd.arg(\"-F\").arg(path); }\n     fn output_filename(&mut self, path: &Path) { self.cmd.arg(\"-o\").arg(path); }\n@@ -125,14 +145,23 @@ impl<'a> Linker for GnuLinker<'a> {\n     fn args(&mut self, args: &[String]) { self.cmd.args(args); }\n \n     fn link_rust_dylib(&mut self, lib: &str, _path: &Path) {\n+        self.hint_dynamic();\n         self.cmd.arg(\"-l\").arg(lib);\n     }\n \n     fn link_framework(&mut self, framework: &str) {\n+        self.hint_dynamic();\n         self.cmd.arg(\"-framework\").arg(framework);\n     }\n \n+    // Here we explicitly ask that the entire archive is included into the\n+    // result artifact. For more details see #15460, but the gist is that\n+    // the linker will strip away any unused objects in the archive if we\n+    // don't otherwise explicitly reference them. This can occur for\n+    // libraries which are just providing bindings, libraries with generic\n+    // functions, etc.\n     fn link_whole_staticlib(&mut self, lib: &str, search_path: &[PathBuf]) {\n+        self.hint_static();\n         let target = &self.sess.target.target;\n         if !target.options.is_like_osx {\n             self.cmd.arg(\"-Wl,--whole-archive\")\n@@ -148,6 +177,7 @@ impl<'a> Linker for GnuLinker<'a> {\n     }\n \n     fn link_whole_rlib(&mut self, lib: &Path) {\n+        self.hint_static();\n         if self.sess.target.target.options.is_like_osx {\n             let mut v = OsString::from(\"-Wl,-force_load,\");\n             v.push(lib);\n@@ -228,26 +258,6 @@ impl<'a> Linker for GnuLinker<'a> {\n         }\n     }\n \n-    fn whole_archives(&mut self) {\n-        if !self.takes_hints() { return }\n-        self.cmd.arg(\"-Wl,--whole-archive\");\n-    }\n-\n-    fn no_whole_archives(&mut self) {\n-        if !self.takes_hints() { return }\n-        self.cmd.arg(\"-Wl,--no-whole-archive\");\n-    }\n-\n-    fn hint_static(&mut self) {\n-        if !self.takes_hints() { return }\n-        self.cmd.arg(\"-Wl,-Bstatic\");\n-    }\n-\n-    fn hint_dynamic(&mut self) {\n-        if !self.takes_hints() { return }\n-        self.cmd.arg(\"-Wl,-Bdynamic\");\n-    }\n-\n     fn export_symbols(&mut self, tmpdir: &Path, crate_type: CrateType) {\n         // If we're compiling a dylib, then we let symbol visibility in object\n         // files to take care of whether they're exported or not.\n@@ -311,10 +321,17 @@ impl<'a> Linker for GnuLinker<'a> {\n     fn subsystem(&mut self, subsystem: &str) {\n         self.cmd.arg(&format!(\"-Wl,--subsystem,{}\", subsystem));\n     }\n+\n+    fn finalize(&mut self) -> Command {\n+        self.hint_dynamic(); // Reset to default before returning the composed command line.\n+        let mut cmd = Command::new(\"\");\n+        ::std::mem::swap(&mut cmd, &mut self.cmd);\n+        cmd\n+    }\n }\n \n pub struct MsvcLinker<'a> {\n-    cmd: &'a mut Command,\n+    cmd: Command,\n     sess: &'a Session,\n     info: &'a LinkerInfo\n }\n@@ -416,22 +433,6 @@ impl<'a> Linker for MsvcLinker<'a> {\n         self.cmd.arg(\"/DEBUG\");\n     }\n \n-    fn whole_archives(&mut self) {\n-        // hints not supported?\n-    }\n-    fn no_whole_archives(&mut self) {\n-        // hints not supported?\n-    }\n-\n-    // On windows static libraries are of the form `foo.lib` and dynamic\n-    // libraries are not linked against directly, but rather through their\n-    // import libraries also called `foo.lib`. As a result there's no\n-    // possibility for a native library to appear both dynamically and\n-    // statically in the same folder so we don't have to worry about hints like\n-    // we do on Unix platforms.\n-    fn hint_static(&mut self) {}\n-    fn hint_dynamic(&mut self) {}\n-\n     // Currently the compiler doesn't use `dllexport` (an LLVM attribute) to\n     // export symbols from a dynamic library. When building a dynamic library,\n     // however, we're going to want some symbols exported, so this function\n@@ -492,10 +493,16 @@ impl<'a> Linker for MsvcLinker<'a> {\n             self.cmd.arg(\"/ENTRY:mainCRTStartup\");\n         }\n     }\n+\n+    fn finalize(&mut self) -> Command {\n+        let mut cmd = Command::new(\"\");\n+        ::std::mem::swap(&mut cmd, &mut self.cmd);\n+        cmd\n+    }\n }\n \n pub struct EmLinker<'a> {\n-    cmd: &'a mut Command,\n+    cmd: Command,\n     sess: &'a Session,\n     info: &'a LinkerInfo\n }\n@@ -591,22 +598,6 @@ impl<'a> Linker for EmLinker<'a> {\n         bug!(\"building dynamic library is unsupported on Emscripten\")\n     }\n \n-    fn whole_archives(&mut self) {\n-        // noop\n-    }\n-\n-    fn no_whole_archives(&mut self) {\n-        // noop\n-    }\n-\n-    fn hint_static(&mut self) {\n-        // noop\n-    }\n-\n-    fn hint_dynamic(&mut self) {\n-        // noop\n-    }\n-\n     fn export_symbols(&mut self, _tmpdir: &Path, crate_type: CrateType) {\n         let symbols = &self.info.exports[&crate_type];\n \n@@ -640,6 +631,12 @@ impl<'a> Linker for EmLinker<'a> {\n     fn subsystem(&mut self, _subsystem: &str) {\n         // noop\n     }\n+\n+    fn finalize(&mut self) -> Command {\n+        let mut cmd = Command::new(\"\");\n+        ::std::mem::swap(&mut cmd, &mut self.cmd);\n+        cmd\n+    }\n }\n \n fn exported_symbols(scx: &SharedCrateContext,"}, {"sha": "9b8099d55a024eea1e7e8f80a2f6049c76c6aed4", "filename": "src/libunwind/build.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibunwind%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibunwind%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2Fbuild.rs?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -35,7 +35,8 @@ fn main() {\n     } else if target.contains(\"dragonfly\") {\n         println!(\"cargo:rustc-link-lib=gcc_pic\");\n     } else if target.contains(\"windows-gnu\") {\n-        println!(\"cargo:rustc-link-lib=gcc_eh\");\n+        println!(\"cargo:rustc-link-lib=static-nobundle=gcc_eh\");\n+        println!(\"cargo:rustc-link-lib=static-nobundle=pthread\");\n     } else if target.contains(\"fuchsia\") {\n         println!(\"cargo:rustc-link-lib=unwind\");\n     }"}, {"sha": "d4d52322adab0e5955b8ab98d1210e060337c64a", "filename": "src/libunwind/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibunwind%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a9b382168cbf405589fbba7215ace700c067879/src%2Flibunwind%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2Flib.rs?ref=1a9b382168cbf405589fbba7215ace700c067879", "patch": "@@ -17,6 +17,7 @@\n #![feature(cfg_target_vendor)]\n #![feature(staged_api)]\n #![feature(unwind_attributes)]\n+#![feature(static_nobundle)]\n \n #![cfg_attr(not(target_env = \"msvc\"), feature(libc))]\n "}]}