{"sha": "22860464129e8a3454015ed0d689ff9e69db106a", "node_id": "C_kwDOAAsO6NoAKDIyODYwNDY0MTI5ZThhMzQ1NDAxNWVkMGQ2ODlmZjllNjlkYjEwNmE", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-06-02T06:07:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-06-02T06:07:39Z"}, "message": "Rollup merge of #112190 - nnethercote:improve-comments-TyCtxt-GlobalCtxt, r=compiler-errors\n\nImprove comments on `TyCtxt` and `GlobalCtxt`.\n\nBy adding some non-obvious information that took me a little while to figure out.\n\nr? `@compiler-errors`", "tree": {"sha": "09a497f288fc741329ee9407cf9a7417aa065a27", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09a497f288fc741329ee9407cf9a7417aa065a27"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/22860464129e8a3454015ed0d689ff9e69db106a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkeYcrCRBK7hj4Ov3rIwAAC4wIAKEmRfssyfCcu2QsY4u0Bvjr\nsmVck3VLh32aTwCQDzfNeV4dXTPsPrKx3ChdH/rctYdun5Ctmy3jTBrR1aAqkmDX\nezZuJq2zcT1bVL9YC7RsKvpuTvRy0zOwQ+XHhrqOYrrTssINEuyy9y/FoiLssUIg\nbcw9lL8R/Mz/Qf83ieXkx8v06EQFDyZUjGyew03kOlwRlZpkvJ0TKlB9/Ougzsm5\nMMtvju3omuysAOcFmeIATsRV1kikyAANI8ouS6m7Hh87N2f2TBuET1YspaZQsT8C\nB86sKsBJhEK3e4CwjwGae+qHHVMo/TW5XJog+DxZ6zqpGovMxzH7z04ikQysh1E=\n=gR29\n-----END PGP SIGNATURE-----\n", "payload": "tree 09a497f288fc741329ee9407cf9a7417aa065a27\nparent 71982341b4d36865f6f24fd8f0a5e58ebd359d99\nparent c625880a416ebea68c956590694cd13bbae53148\nauthor Michael Goulet <michael@errs.io> 1685686059 -0700\ncommitter GitHub <noreply@github.com> 1685686059 -0700\n\nRollup merge of #112190 - nnethercote:improve-comments-TyCtxt-GlobalCtxt, r=compiler-errors\n\nImprove comments on `TyCtxt` and `GlobalCtxt`.\n\nBy adding some non-obvious information that took me a little while to figure out.\n\nr? `@compiler-errors`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/22860464129e8a3454015ed0d689ff9e69db106a", "html_url": "https://github.com/rust-lang/rust/commit/22860464129e8a3454015ed0d689ff9e69db106a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/22860464129e8a3454015ed0d689ff9e69db106a/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71982341b4d36865f6f24fd8f0a5e58ebd359d99", "url": "https://api.github.com/repos/rust-lang/rust/commits/71982341b4d36865f6f24fd8f0a5e58ebd359d99", "html_url": "https://github.com/rust-lang/rust/commit/71982341b4d36865f6f24fd8f0a5e58ebd359d99"}, {"sha": "c625880a416ebea68c956590694cd13bbae53148", "url": "https://api.github.com/repos/rust-lang/rust/commits/c625880a416ebea68c956590694cd13bbae53148", "html_url": "https://github.com/rust-lang/rust/commit/c625880a416ebea68c956590694cd13bbae53148"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "673d09cddf4abb94537a70b4e0287844ed34adbf", "filename": "compiler/rustc_middle/src/ty/context.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/22860464129e8a3454015ed0d689ff9e69db106a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22860464129e8a3454015ed0d689ff9e69db106a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs?ref=22860464129e8a3454015ed0d689ff9e69db106a", "patch": "@@ -478,6 +478,17 @@ impl<'tcx> TyCtxtFeed<'tcx, LocalDefId> {\n /// [rustc dev guide] for more details.\n ///\n /// [rustc dev guide]: https://rustc-dev-guide.rust-lang.org/ty.html\n+///\n+/// An implementation detail: `TyCtxt` is a wrapper type for [GlobalCtxt],\n+/// which is the struct that actually holds all the data. `TyCtxt` derefs to\n+/// `GlobalCtxt`, and in practice `TyCtxt` is passed around everywhere, and all\n+/// operations are done via `TyCtxt`. A `TyCtxt` is obtained for a `GlobalCtxt`\n+/// by calling `enter` with a closure `f`. That function creates both the\n+/// `TyCtxt`, and an `ImplicitCtxt` around it that is put into TLS. Within `f`:\n+/// - The `ImplicitCtxt` is available implicitly via TLS.\n+/// - The `TyCtxt` is available explicitly via the `tcx` parameter, and also\n+///   implicitly within the `ImplicitCtxt`. Explicit access is preferred when\n+///   possible.\n #[derive(Copy, Clone)]\n #[rustc_diagnostic_item = \"TyCtxt\"]\n #[rustc_pass_by_value]\n@@ -493,6 +504,7 @@ impl<'tcx> Deref for TyCtxt<'tcx> {\n     }\n }\n \n+/// See [TyCtxt] for details about this type.\n pub struct GlobalCtxt<'tcx> {\n     pub arena: &'tcx WorkerLocal<Arena<'tcx>>,\n     pub hir_arena: &'tcx WorkerLocal<hir::Arena<'tcx>>,"}]}