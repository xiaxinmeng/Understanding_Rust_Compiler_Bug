{"sha": "b2005117bc475700f117ab01cf72fb46f1fe2d69", "node_id": "C_kwDOAAsO6NoAKGIyMDA1MTE3YmM0NzU3MDBmMTE3YWIwMWNmNzJmYjQ2ZjFmZTJkNjk", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-09-29T12:15:35Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-11-24T07:57:44Z"}, "message": "Allow features like const_try in d_m_b_i_c", "tree": {"sha": "5c8a33e171a4fd4ae960945803b65c48100076cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c8a33e171a4fd4ae960945803b65c48100076cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2005117bc475700f117ab01cf72fb46f1fe2d69", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEQ7Fl7qPq2YcWF1dqAn35M4hird0FAmGd8HgACgkQAn35M4hi\nrd0Bjg/+NNdq2jeu2zkwzs5YoF9DllfRsvXznxmGEfLFq0ecJ4mWV25+iSWOCGzx\n2iRo780xX/nCG8wdBvCwP9QEBsH4zcv+PhOi8cpY8IT/aVQono0QXUlNiV6PFxWv\n5oxmlMA06DtHgwzh2TvugCyFofT8vzi2LONcqqe9lnnx6kEzG80IcampHMSFoaiP\nofb0iO9ypWpHqr05FEZ7FGQYeXq64JTsualNLnHG69AgLwza7LJfdufeu7CEni3y\nDdvf2qUOBJLSozosgt7ytFow4y12qqtL32UeqUywngG4XeXH3zBHPumejJYFlqe3\nsDfqvxIC3fz2LvO49kjdKhmF6rClTH9uGzJHIXt7zP95nmIhaJRu2kIqV97O5B+l\ndIEAtSlIwSgpREiH/bkYuQBtJo1WEAw2Jzg0g7EIC4NmzrsKKPP0Ba3VhI7roHi7\nKmzir20nV4Bzv2+R0Bjv4w80mArNTTkRPEaMvkq4m7WpW8DmhT5fE6kFWWxvlj4m\nleBRfTe+4rGO1gBXEFo6mMYfLNx75I7UirzUhY7YpHFNQbo1x/EkJS1Hjem3Qm38\nDKYbvlohEFw8dlBmk6ve7Ak/yK1/KSuJ4aFiLkzMRAlJ0sQxZEovWrKC4Uj78BgK\nUFlfMEGrMMbmf6ggA5HBJyXyJbdJQCR7Oevb6OTCwoIEOkJb3xM=\n=bMvE\n-----END PGP SIGNATURE-----", "payload": "tree 5c8a33e171a4fd4ae960945803b65c48100076cb\nparent e0c2ff7ccc0b0ffe095bbf7e1ae358d96bb9152f\nauthor Deadbeef <ent3rm4n@gmail.com> 1632917735 +0000\ncommitter Deadbeef <ent3rm4n@gmail.com> 1637740664 +0800\n\nAllow features like const_try in d_m_b_i_c\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2005117bc475700f117ab01cf72fb46f1fe2d69", "html_url": "https://github.com/rust-lang/rust/commit/b2005117bc475700f117ab01cf72fb46f1fe2d69", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2005117bc475700f117ab01cf72fb46f1fe2d69/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e0c2ff7ccc0b0ffe095bbf7e1ae358d96bb9152f", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0c2ff7ccc0b0ffe095bbf7e1ae358d96bb9152f", "html_url": "https://github.com/rust-lang/rust/commit/e0c2ff7ccc0b0ffe095bbf7e1ae358d96bb9152f"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "9ccf76b5700c201a84cdcf36c2cf9ff62b8e53e4", "filename": "compiler/rustc_passes/src/check_const.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b2005117bc475700f117ab01cf72fb46f1fe2d69/compiler%2Frustc_passes%2Fsrc%2Fcheck_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2005117bc475700f117ab01cf72fb46f1fe2d69/compiler%2Frustc_passes%2Fsrc%2Fcheck_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_const.rs?ref=b2005117bc475700f117ab01cf72fb46f1fe2d69", "patch": "@@ -173,6 +173,12 @@ impl<'tcx> CheckConstVisitor<'tcx> {\n                 None => return true,\n             };\n \n+            // If the function belongs to a trait, then it must enable the const_trait_impl\n+            // feature to use that trait function (with a const default body).\n+            if tcx.trait_of_item(def_id).is_some() {\n+                return true;\n+            }\n+\n             // If this crate is not using stability attributes, or this function is not claiming to be a\n             // stable `const fn`, that is all that is required.\n             if !tcx.features().staged_api || tcx.has_attr(def_id, sym::rustc_const_unstable) {"}, {"sha": "cbfdf89b7bd191817c4080cd2cce8b6bc7c9cfac", "filename": "src/test/ui/rfc-2632-const-trait-impl/trait-default-body-stability.rs", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/b2005117bc475700f117ab01cf72fb46f1fe2d69/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Ftrait-default-body-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2005117bc475700f117ab01cf72fb46f1fe2d69/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Ftrait-default-body-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Ftrait-default-body-stability.rs?ref=b2005117bc475700f117ab01cf72fb46f1fe2d69", "patch": "@@ -0,0 +1,51 @@\n+// check-pass\n+\n+#![feature(staged_api)]\n+#![feature(const_trait_impl)]\n+#![feature(const_fn_trait_bound)]\n+#![feature(const_t_try)]\n+#![feature(const_try)]\n+#![feature(try_trait_v2)]\n+\n+#![stable(feature = \"foo\", since = \"1.0\")]\n+\n+use std::ops::{ControlFlow, FromResidual, Try};\n+\n+#[stable(feature = \"foo\", since = \"1.0\")]\n+pub struct T;\n+\n+#[stable(feature = \"foo\", since = \"1.0\")]\n+#[rustc_const_unstable(feature = \"const_t_try\", issue = \"none\")]\n+impl const Try for T {\n+    type Output = T;\n+    type Residual = T;\n+\n+    fn from_output(t: T) -> T {\n+        t\n+    }\n+\n+    fn branch(self) -> ControlFlow<T, T> {\n+        ControlFlow::Continue(self)\n+    }\n+}\n+\n+#[stable(feature = \"foo\", since = \"1.0\")]\n+#[rustc_const_unstable(feature = \"const_t_try\", issue = \"none\")]\n+impl const FromResidual for T {\n+    fn from_residual(t: T) -> T {\n+        t\n+    }\n+}\n+\n+#[stable(feature = \"foo\", since = \"1.0\")]\n+pub trait Tr {\n+    #[default_method_body_is_const]\n+    #[stable(feature = \"foo\", since = \"1.0\")]\n+    fn bar() -> T {\n+        T?\n+        // Should be allowed.\n+        // Must enable unstable features to call this trait fn in const contexts.\n+    }\n+}\n+\n+fn main() {}"}]}