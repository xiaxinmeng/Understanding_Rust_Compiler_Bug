{"sha": "68e162d3643516240b6b1fd2e6ba27e4fd8c091a", "node_id": "C_kwDOAAsO6NoAKDY4ZTE2MmQzNjQzNTE2MjQwYjZiMWZkMmU2YmEyN2U0ZmQ4YzA5MWE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-06-10T13:24:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-06-10T13:24:44Z"}, "message": "Rollup merge of #112483 - tgross35:py2-dep-warning, r=Mark-Simulacrum\n\nAdd deprecation warning to python versions <3.6 in x.py\n\nIntroduced based on conversation on Zulip. This is a repeat of #110439 with two changes:\n\n- Warning rather than exit\n- Can be suppressed via an environment variable\n\nThe min to not get the warning is set to 3.6 because that's a fairly recent \"old\" version (went EOL in 2021) and it's the first version to support useful modern features like f-strings and type hints.\n\ncc `@Nilstrieb` (author of #110439) and `@Mark-Simulacrum` (reviewer of that PR)", "tree": {"sha": "eb4d9a4ac2e20df64f776ad9c5b7960d65b02063", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eb4d9a4ac2e20df64f776ad9c5b7960d65b02063"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68e162d3643516240b6b1fd2e6ba27e4fd8c091a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkhHmcCRBK7hj4Ov3rIwAAt9MIAH68cyGm3XCMe2KcE5f90//y\n5B4ZYW09gPs+QFOtKsJsZvpkWL7aOBzRK0oML1Tgno+iVFxI8sBTjtBz0saHGZlS\ndqAa40SHy9S3qJ5ta0+xD5+sYjp9oy12nw50fWegI3Sj21gnqJgVrt8PdZuXzd2f\n9cSzroVXU1JhQehg7bUMgQYJ49VvdGbyDCsRAAYOOmHt7uZHGUlDNe30I+2i3Lxz\n56SNRkJixtS+KVrPBdap0CqmRK5qIOphwEU6ebxkAuxjU5mkyCt4B+sAYOi4FH1l\nUM2T2Xc+iOIYLbEEfpKP64Bd1raGQirZk9pSrKDE9X3ceK8NMtx3PrvRqoOTPSg=\n=go8s\n-----END PGP SIGNATURE-----\n", "payload": "tree eb4d9a4ac2e20df64f776ad9c5b7960d65b02063\nparent 312e67633313836ef89bc1f6b299f43e2fa7c155\nparent cec95d74dd61cbe4dfef677f6b2e6436ba216fce\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1686403484 +0200\ncommitter GitHub <noreply@github.com> 1686403484 +0200\n\nRollup merge of #112483 - tgross35:py2-dep-warning, r=Mark-Simulacrum\n\nAdd deprecation warning to python versions <3.6 in x.py\n\nIntroduced based on conversation on Zulip. This is a repeat of #110439 with two changes:\n\n- Warning rather than exit\n- Can be suppressed via an environment variable\n\nThe min to not get the warning is set to 3.6 because that's a fairly recent \"old\" version (went EOL in 2021) and it's the first version to support useful modern features like f-strings and type hints.\n\ncc `@Nilstrieb` (author of #110439) and `@Mark-Simulacrum` (reviewer of that PR)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68e162d3643516240b6b1fd2e6ba27e4fd8c091a", "html_url": "https://github.com/rust-lang/rust/commit/68e162d3643516240b6b1fd2e6ba27e4fd8c091a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68e162d3643516240b6b1fd2e6ba27e4fd8c091a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "312e67633313836ef89bc1f6b299f43e2fa7c155", "url": "https://api.github.com/repos/rust-lang/rust/commits/312e67633313836ef89bc1f6b299f43e2fa7c155", "html_url": "https://github.com/rust-lang/rust/commit/312e67633313836ef89bc1f6b299f43e2fa7c155"}, {"sha": "cec95d74dd61cbe4dfef677f6b2e6436ba216fce", "url": "https://api.github.com/repos/rust-lang/rust/commits/cec95d74dd61cbe4dfef677f6b2e6436ba216fce", "html_url": "https://github.com/rust-lang/rust/commit/cec95d74dd61cbe4dfef677f6b2e6436ba216fce"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "7163df5cfe99b0d63419d31ef0de2796208a438b", "filename": "x.py", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/68e162d3643516240b6b1fd2e6ba27e4fd8c091a/x.py", "raw_url": "https://github.com/rust-lang/rust/raw/68e162d3643516240b6b1fd2e6ba27e4fd8c091a/x.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/x.py?ref=68e162d3643516240b6b1fd2e6ba27e4fd8c091a", "patch": "@@ -9,12 +9,17 @@\n if __name__ == '__main__':\n     import os\n     import sys\n+    import warnings\n+    from inspect import cleandoc\n+\n+    major = sys.version_info.major\n+    minor = sys.version_info.minor\n \n     # If this is python2, check if python3 is available and re-execute with that\n     # interpreter. Only python3 allows downloading CI LLVM.\n     #\n     # This matters if someone's system `python` is python2.\n-    if sys.version_info.major < 3:\n+    if major < 3:\n         try:\n             os.execvp(\"py\", [\"py\", \"-3\"] + sys.argv)\n         except OSError:\n@@ -24,6 +29,19 @@\n                 # Python 3 isn't available, fall back to python 2\n                 pass\n \n+    # soft deprecation of old python versions\n+    skip_check = os.environ.get(\"RUST_IGNORE_OLD_PYTHON\") == \"1\"\n+    if major < 3 or (major == 3 and minor < 6):\n+        msg = cleandoc(\"\"\"\n+            Using python {}.{} but >= 3.6 is recommended. Your python version\n+            should continue to work for the near future, but this will\n+            eventually change. If python >= 3.6 is not available on your system,\n+            please file an issue to help us understand timelines.\n+\n+            This message can be suppressed by setting `RUST_IGNORE_OLD_PYTHON=1`\n+        \"\"\".format(major, minor))\n+        warnings.warn(msg)\n+\n     rust_dir = os.path.dirname(os.path.abspath(__file__))\n     # For the import below, have Python search in src/bootstrap first.\n     sys.path.insert(0, os.path.join(rust_dir, \"src\", \"bootstrap\"))"}]}