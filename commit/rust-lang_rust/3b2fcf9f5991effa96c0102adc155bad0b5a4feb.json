{"sha": "3b2fcf9f5991effa96c0102adc155bad0b5a4feb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiMmZjZjlmNTk5MWVmZmE5NmMwMTAyYWRjMTU1YmFkMGI1YTRmZWI=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-03-25T04:04:01Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-03-27T04:29:35Z"}, "message": "librustc: Fix bug with newtype structs containing dtors", "tree": {"sha": "e8d49983f9ede1d02f614a4af6d3c0ec023c8c8d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e8d49983f9ede1d02f614a4af6d3c0ec023c8c8d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b2fcf9f5991effa96c0102adc155bad0b5a4feb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b2fcf9f5991effa96c0102adc155bad0b5a4feb", "html_url": "https://github.com/rust-lang/rust/commit/3b2fcf9f5991effa96c0102adc155bad0b5a4feb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b2fcf9f5991effa96c0102adc155bad0b5a4feb/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a376f46862cef319ca6bb59b9b571e5e0ae55d8d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a376f46862cef319ca6bb59b9b571e5e0ae55d8d", "html_url": "https://github.com/rust-lang/rust/commit/a376f46862cef319ca6bb59b9b571e5e0ae55d8d"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "f81973e169daa20aef10dfffe94b8c79c572eab7", "filename": "src/librustc/middle/trans/datum.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3b2fcf9f5991effa96c0102adc155bad0b5a4feb/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdatum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b2fcf9f5991effa96c0102adc155bad0b5a4feb/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdatum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdatum.rs?ref=3b2fcf9f5991effa96c0102adc155bad0b5a4feb", "patch": "@@ -679,7 +679,6 @@ pub impl Datum {\n                 }\n \n                 let repr = adt::represent_type(ccx, self.ty);\n-                fail_unless!(adt::is_newtypeish(repr));\n                 let ty = ty::subst(ccx.tcx, substs, variants[0].args[0]);\n                 return match self.mode {\n                     ByRef => {\n@@ -719,7 +718,6 @@ pub impl Datum {\n                 }\n \n                 let repr = adt::represent_type(ccx, self.ty);\n-                fail_unless!(adt::is_newtypeish(repr));\n                 let ty = fields[0].mt.ty;\n                 return match self.mode {\n                     ByRef => {"}, {"sha": "f4a059018d2092b046b9d1cbdb191ec708e5b1c5", "filename": "src/test/run-pass/newtype-struct-with-dtor.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/3b2fcf9f5991effa96c0102adc155bad0b5a4feb/src%2Ftest%2Frun-pass%2Fnewtype-struct-with-dtor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b2fcf9f5991effa96c0102adc155bad0b5a4feb/src%2Ftest%2Frun-pass%2Fnewtype-struct-with-dtor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fnewtype-struct-with-dtor.rs?ref=3b2fcf9f5991effa96c0102adc155bad0b5a4feb", "patch": "@@ -0,0 +1,17 @@\n+use core::libc::c_int;\n+use core::libc;\n+\n+pub struct Fd(c_int);\n+\n+impl Drop for Fd {\n+    fn finalize(&self) {\n+        unsafe {\n+            libc::close(**self);\n+        }\n+    }\n+}\n+\n+fn main() {\n+}\n+\n+"}]}