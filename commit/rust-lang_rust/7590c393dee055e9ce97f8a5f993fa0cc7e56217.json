{"sha": "7590c393dee055e9ce97f8a5f993fa0cc7e56217", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1OTBjMzkzZGVlMDU1ZTljZTk3ZjhhNWY5OTNmYTBjYzdlNTYyMTc=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-04-30T18:53:40Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-05-07T18:08:08Z"}, "message": "Improve doc alias JS code", "tree": {"sha": "c2d3c73eefcd6cbca2c404dc9cedbb7ce7a72106", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2d3c73eefcd6cbca2c404dc9cedbb7ce7a72106"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7590c393dee055e9ce97f8a5f993fa0cc7e56217", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7590c393dee055e9ce97f8a5f993fa0cc7e56217", "html_url": "https://github.com/rust-lang/rust/commit/7590c393dee055e9ce97f8a5f993fa0cc7e56217", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7590c393dee055e9ce97f8a5f993fa0cc7e56217/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d80ac14fe69676c34efdec0c1cc589d28cd03ab1", "url": "https://api.github.com/repos/rust-lang/rust/commits/d80ac14fe69676c34efdec0c1cc589d28cd03ab1", "html_url": "https://github.com/rust-lang/rust/commit/d80ac14fe69676c34efdec0c1cc589d28cd03ab1"}], "stats": {"total": 73, "additions": 50, "deletions": 23}, "files": [{"sha": "411d2d44059b202857d83ffdc2f4983bd62d7a02", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 50, "deletions": 23, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/7590c393dee055e9ce97f8a5f993fa0cc7e56217/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/7590c393dee055e9ce97f8a5f993fa0cc7e56217/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=7590c393dee055e9ce97f8a5f993fa0cc7e56217", "patch": "@@ -963,6 +963,50 @@ function getSearchElement() {\n                 return itemTypes[ty.ty] + ty.path + ty.name;\n             }\n \n+            function handleAliases(ret, query, filterCrates) {\n+                if (ALIASES) {\n+                    var aliases = [];\n+                    if (filterCrates !== undefined &&\n+                            ALIASES[filterCrates] &&\n+                            ALIASES[filterCrates][query.search]) {\n+                        aliases = ALIASES[filterCrates][query.search];\n+                    } else {\n+                        Object.keys(ALIASES).forEach(function(crate) {\n+                            if (ALIASES[crate][query.search]) {\n+                                for (var i = 0; i < ALIASES[crate][query.search].length; ++i) {\n+                                    aliases.push(ALIASES[crate][query.search][i]);\n+                                }\n+                            }\n+                        });\n+                    }\n+                    aliases.sort(function(aaa, bbb) {\n+                        if (aaa.path < bbb.path) {\n+                            return 1;\n+                        } else if (aaa.path === bbb.path) {\n+                            return 0;\n+                        }\n+                        return -1;\n+                    });\n+                    for (var i = 0; i < aliases.length; ++i) {\n+                        var alias = aliases[i];\n+                        alias.is_alias = true;\n+                        if (typeof alias.parent === \"number\") {\n+                            alias.parent = rawSearchIndex[alias.crate].p[alias.parent];\n+                        }\n+                        alias.alias = query.raw;\n+                        alias.path = alias.p || alias.crate;\n+                        var res = buildHrefAndPath(aliases[i]);\n+                        alias.displayPath = pathSplitter(res[0]);\n+                        alias.fullPath = alias.displayPath + alias.name;\n+                        alias.href = res[1];\n+                        ret.others.unshift(alias);\n+                        if (ret.others.length > MAX_RESULTS) {\n+                            ret.others.pop();\n+                        }\n+                    }\n+                }\n+            }\n+\n             // quoted values mean literal search\n             var nSearchWords = searchWords.length;\n             var i;\n@@ -1190,23 +1234,7 @@ function getSearchElement() {\n                 \"returned\": sortResults(results_returned, true),\n                 \"others\": sortResults(results),\n             };\n-            if (ALIASES && ALIASES[window.currentCrate] &&\n-                    ALIASES[window.currentCrate][query.raw]) {\n-                var aliases = ALIASES[window.currentCrate][query.raw];\n-                for (i = 0; i < aliases.length; ++i) {\n-                    aliases[i].is_alias = true;\n-                    aliases[i].alias = query.raw;\n-                    aliases[i].path = aliases[i].p;\n-                    var res = buildHrefAndPath(aliases[i]);\n-                    aliases[i].displayPath = pathSplitter(res[0]);\n-                    aliases[i].fullPath = aliases[i].displayPath + aliases[i].name;\n-                    aliases[i].href = res[1];\n-                    ret.others.unshift(aliases[i]);\n-                    if (ret.others.length > MAX_RESULTS) {\n-                        ret.others.pop();\n-                    }\n-                }\n-            }\n+            handleAliases(ret, query, filterCrates);\n             return ret;\n         }\n \n@@ -1599,13 +1627,12 @@ function getSearchElement() {\n                     \"returned\": mergeArrays(results.returned),\n                     \"others\": mergeArrays(results.others),\n                 };\n-            } else {\n-                return {\n-                    \"in_args\": results.in_args[0],\n-                    \"returned\": results.returned[0],\n-                    \"others\": results.others[0],\n-                };\n             }\n+            return {\n+                \"in_args\": results.in_args[0],\n+                \"returned\": results.returned[0],\n+                \"others\": results.others[0],\n+            };\n         }\n \n         function getFilterCrates() {"}]}