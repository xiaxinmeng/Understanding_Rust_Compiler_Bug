{"sha": "3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlMmJiM2ZkODEzYTRlYTA3NjY4ZTJhNjc4YjhjN2NjODg3OGZjODI=", "commit": {"author": {"name": "Pascal Hertleif", "email": "killercup@gmail.com", "date": "2016-08-28T19:08:14Z"}, "committer": {"name": "Pascal Hertleif", "email": "killercup@gmail.com", "date": "2016-08-28T19:11:02Z"}, "message": "Actually scroll lint panels into view\n\nThe trick to writing horrible hacks such as this is to recognize angular\nas a technology stack that may be endearing to some as one can do easy\nstuff quickly. But fundamentally, it is built on top of crazy shit.\n\nLike: Yes, I just wrote a directive that for some reason automatically\nhas access to the scope of the repeated item, and fires an event each\ntime the last `np-repeat` item was seen (delayed by one render loop\ncycle, of course). And \u2013 obviously \u2013 when defining the directive it is\nin camelCase  but when using it in the template it has to by in\ndash-case.\n\nGreat times.", "tree": {"sha": "9226e88e89abb69b37cc5e0f9d7f460281c9527e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9226e88e89abb69b37cc5e0f9d7f460281c9527e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82", "html_url": "https://github.com/rust-lang/rust/commit/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82/comments", "author": {"login": "killercup", "id": 20063, "node_id": "MDQ6VXNlcjIwMDYz", "avatar_url": "https://avatars.githubusercontent.com/u/20063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killercup", "html_url": "https://github.com/killercup", "followers_url": "https://api.github.com/users/killercup/followers", "following_url": "https://api.github.com/users/killercup/following{/other_user}", "gists_url": "https://api.github.com/users/killercup/gists{/gist_id}", "starred_url": "https://api.github.com/users/killercup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killercup/subscriptions", "organizations_url": "https://api.github.com/users/killercup/orgs", "repos_url": "https://api.github.com/users/killercup/repos", "events_url": "https://api.github.com/users/killercup/events{/privacy}", "received_events_url": "https://api.github.com/users/killercup/received_events", "type": "User", "site_admin": false}, "committer": {"login": "killercup", "id": 20063, "node_id": "MDQ6VXNlcjIwMDYz", "avatar_url": "https://avatars.githubusercontent.com/u/20063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killercup", "html_url": "https://github.com/killercup", "followers_url": "https://api.github.com/users/killercup/followers", "following_url": "https://api.github.com/users/killercup/following{/other_user}", "gists_url": "https://api.github.com/users/killercup/gists{/gist_id}", "starred_url": "https://api.github.com/users/killercup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killercup/subscriptions", "organizations_url": "https://api.github.com/users/killercup/orgs", "repos_url": "https://api.github.com/users/killercup/repos", "events_url": "https://api.github.com/users/killercup/events{/privacy}", "received_events_url": "https://api.github.com/users/killercup/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "816cf56b8969e239216cfe8968b1b6931d334574", "url": "https://api.github.com/repos/rust-lang/rust/commits/816cf56b8969e239216cfe8968b1b6931d334574", "html_url": "https://github.com/rust-lang/rust/commit/816cf56b8969e239216cfe8968b1b6931d334574"}], "stats": {"total": 47, "additions": 34, "deletions": 13}, "files": [{"sha": "04196eef396089d0453cb999a4f2682682efc673", "filename": "util/gh-pages/index.html", "status": "modified", "additions": 34, "deletions": 13, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82/util%2Fgh-pages%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82/util%2Fgh-pages%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fgh-pages%2Findex.html?ref=3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82", "patch": "@@ -62,7 +62,8 @@ <h1>ALL the Clippy Lints</h1>\n                 </div>\n             </div>\n \n-            <article class=\"panel panel-default\" id=\"{{lint.id}}\" ng-repeat=\"lint in data | filter:byLevels | filter:search | orderBy:'id' track by lint.id\">\n+            <article class=\"panel panel-default\" id=\"{{lint.id}}\"\n+                ng-repeat=\"lint in data | filter:byLevels | filter:search | orderBy:'id' track by lint.id\" on-finish-render=\"ngRepeatFinished\">\n                 <header class=\"panel-heading\" ng-click=\"open[lint.id] = !open[lint.id]\">\n                     <button class=\"btn btn-default btn-sm pull-right\" style=\"margin-top: -6px;\">\n                         <span ng-show=\"open[lint.id]\">&minus;</span>\n@@ -96,7 +97,7 @@ <h4 class=\"list-group-item-heading\">\n     <a href=\"https://github.com/Manishearth/rust-clippy\">\n         <img style=\"position: absolute; top: 0; right: 0; border: 0;\" src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png\"/>\n     </a>\n-    \n+\n     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/markdown-it/7.0.0/markdown-it.min.js\"></script>\n     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js\"></script>\n     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/languages/rust.min.js\"></script>\n@@ -122,8 +123,17 @@ <h4 class=\"list-group-item-heading\">\n \n         function scrollToLint(lintId) {\n             var target = document.getElementById(lintId);\n-            if (!target) { return; }\n-            document.body.scrollTop = target.offsetTop;\n+            if (!target) {\n+                return;\n+            }\n+            target.scrollIntoView();\n+        }\n+\n+        function scrollToLintByURL($scope) {\n+            var removeListener = $scope.$on('ngRepeatFinished', function(ngRepeatFinishedEvent) {\n+                scrollToLint(window.location.hash.slice(1));\n+                removeListener();\n+            });\n         }\n \n         angular.module(\"clippy\", [])\n@@ -136,6 +146,18 @@ <h4 class=\"list-group-item-heading\">\n                 );\n             };\n         })\n+        .directive('onFinishRender', function ($timeout) {\n+            return {\n+                restrict: 'A',\n+                link: function (scope, element, attr) {\n+                    if (scope.$last === true) {\n+                        $timeout(function () {\n+                            scope.$emit(attr.onFinishRender);\n+                        });\n+                    }\n+                }\n+            };\n+        })\n         .controller(\"lintList\", function ($scope, $http, $timeout) {\n             // Level filter\n             var LEVEL_FILTERS_DEFAULT = {Allow: true, Warn: true, Deny: true, Deprecated: true};\n@@ -149,17 +171,17 @@ <h4 class=\"list-group-item-heading\">\n             $scope.loading = true;\n \n             if (window.location.hash.length > 1) {\n+                $scope.search = window.location.hash.slice(1);\n                 $scope.open[window.location.hash.slice(1)] = true;\n+                scrollToLintByURL($scope);\n             }\n \n             $http.get('./lints.json')\n             .success(function (data) {\n                 $scope.data = data;\n                 $scope.loading = false;\n \n-                $timeout(function () {\n-                    scrollToLint(window.location.hash.slice(1));\n-                }, 100);\n+                scrollToLintByURL($scope);\n             })\n             .error(function (data) {\n                 $scope.error = data;\n@@ -169,17 +191,16 @@ <h4 class=\"list-group-item-heading\">\n             window.addEventListener('hashchange', function () {\n                 // trigger re-render\n                 $timeout(function () {\n-                    $scope.search = \"\";\n                     $scope.levels = LEVEL_FILTERS_DEFAULT;\n-                    // quick n dirty: wait for re-render to finish\n-                    $timeout(function () {\n-                        scrollToLint(window.location.hash.slice(1));\n-                    }, 100);\n+                    $scope.search = window.location.hash.slice(1);\n+                    $scope.open[window.location.hash.slice(1)] = true;\n+\n+                    scrollToLintByURL($scope);\n                 });\n                 return true;\n             }, false);\n         });\n     })();\n     </script>\n </body>\n-</html>\n\\ No newline at end of file\n+</html>"}]}