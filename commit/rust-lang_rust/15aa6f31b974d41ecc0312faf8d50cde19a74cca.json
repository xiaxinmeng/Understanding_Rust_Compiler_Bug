{"sha": "15aa6f31b974d41ecc0312faf8d50cde19a74cca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1YWE2ZjMxYjk3NGQ0MWVjYzAzMTJmYWY4ZDUwY2RlMTlhNzRjY2E=", "commit": {"author": {"name": "Gus Wynn", "email": "guswynn@gmail.com", "date": "2020-09-10T21:58:45Z"}, "committer": {"name": "Gus Wynn", "email": "guswynn@gmail.com", "date": "2020-09-10T23:39:04Z"}, "message": "add debug-logging to config.toml", "tree": {"sha": "002a0fb25a7d750594e28f5f1825020fda971ec8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/002a0fb25a7d750594e28f5f1825020fda971ec8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/15aa6f31b974d41ecc0312faf8d50cde19a74cca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/15aa6f31b974d41ecc0312faf8d50cde19a74cca", "html_url": "https://github.com/rust-lang/rust/commit/15aa6f31b974d41ecc0312faf8d50cde19a74cca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/15aa6f31b974d41ecc0312faf8d50cde19a74cca/comments", "author": {"login": "guswynn", "id": 5404303, "node_id": "MDQ6VXNlcjU0MDQzMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5404303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guswynn", "html_url": "https://github.com/guswynn", "followers_url": "https://api.github.com/users/guswynn/followers", "following_url": "https://api.github.com/users/guswynn/following{/other_user}", "gists_url": "https://api.github.com/users/guswynn/gists{/gist_id}", "starred_url": "https://api.github.com/users/guswynn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guswynn/subscriptions", "organizations_url": "https://api.github.com/users/guswynn/orgs", "repos_url": "https://api.github.com/users/guswynn/repos", "events_url": "https://api.github.com/users/guswynn/events{/privacy}", "received_events_url": "https://api.github.com/users/guswynn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "guswynn", "id": 5404303, "node_id": "MDQ6VXNlcjU0MDQzMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5404303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guswynn", "html_url": "https://github.com/guswynn", "followers_url": "https://api.github.com/users/guswynn/followers", "following_url": "https://api.github.com/users/guswynn/following{/other_user}", "gists_url": "https://api.github.com/users/guswynn/gists{/gist_id}", "starred_url": "https://api.github.com/users/guswynn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guswynn/subscriptions", "organizations_url": "https://api.github.com/users/guswynn/orgs", "repos_url": "https://api.github.com/users/guswynn/repos", "events_url": "https://api.github.com/users/guswynn/events{/privacy}", "received_events_url": "https://api.github.com/users/guswynn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4bdc07ff5a70175dbcdff7331c557245ddb012f", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4bdc07ff5a70175dbcdff7331c557245ddb012f", "html_url": "https://github.com/rust-lang/rust/commit/b4bdc07ff5a70175dbcdff7331c557245ddb012f"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "b740793a3e554db22825cfca32298dada3de7814", "filename": "compiler/rustc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/15aa6f31b974d41ecc0312faf8d50cde19a74cca/compiler%2Frustc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/15aa6f31b974d41ecc0312faf8d50cde19a74cca/compiler%2Frustc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc%2FCargo.toml?ref=15aa6f31b974d41ecc0312faf8d50cde19a74cca", "patch": "@@ -19,3 +19,4 @@ features = ['unprefixed_malloc_on_supported_platforms']\n [features]\n jemalloc = ['jemalloc-sys']\n llvm = ['rustc_driver/llvm']\n+release_max_level_info = ['rustc_driver/release_max_level_info']"}, {"sha": "6f0d7bc4d58e866ed39866ef11087884a7072ff8", "filename": "compiler/rustc_driver/Cargo.toml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/15aa6f31b974d41ecc0312faf8d50cde19a74cca/compiler%2Frustc_driver%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/15aa6f31b974d41ecc0312faf8d50cde19a74cca/compiler%2Frustc_driver%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver%2FCargo.toml?ref=15aa6f31b974d41ecc0312faf8d50cde19a74cca", "patch": "@@ -9,7 +9,7 @@ crate-type = [\"dylib\"]\n \n [dependencies]\n libc = \"0.2\"\n-tracing = { version = \"0.1.18\", features = [\"release_max_level_info\"]  }\n+tracing = { version = \"0.1.18\" }\n tracing-subscriber = { version = \"0.2.10\", default-features = false, features = [\"fmt\", \"env-filter\", \"smallvec\", \"parking_lot\", \"ansi\"] }\n rustc_middle = { path = \"../rustc_middle\" }\n rustc_ast_pretty = { path = \"../rustc_ast_pretty\" }\n@@ -38,3 +38,4 @@ winapi = { version = \"0.3\", features = [\"consoleapi\", \"debugapi\", \"processenv\"]\n \n [features]\n llvm = ['rustc_interface/llvm']\n+release_max_level_info = ['tracing/release_max_level_info']"}, {"sha": "a162c543a50c371780fa991d95ab51abbaba1d8a", "filename": "config.toml.example", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/15aa6f31b974d41ecc0312faf8d50cde19a74cca/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/15aa6f31b974d41ecc0312faf8d50cde19a74cca/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=15aa6f31b974d41ecc0312faf8d50cde19a74cca", "patch": "@@ -329,6 +329,12 @@\n # Defaults to rust.debug-assertions value\n #debug-assertions-std = false\n \n+# Whether or not to leave debug! and trace! calls in the rust binary.\n+# Overrides the `debug-assertions` option, if defined.\n+# \n+# Defaults to rust.debug-assertions value\n+#debug-logging = true\n+\n # Debuginfo level for most of Rust code, corresponds to the `-C debuginfo=N` option of `rustc`.\n # `0` - no debug info\n # `1` - line tables only - sufficient to generate backtraces that include line"}, {"sha": "49a0855b97884f28f83913d8fdf320f60240f1cc", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/15aa6f31b974d41ecc0312faf8d50cde19a74cca/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/15aa6f31b974d41ecc0312faf8d50cde19a74cca/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=15aa6f31b974d41ecc0312faf8d50cde19a74cca", "patch": "@@ -100,6 +100,7 @@ pub struct Config {\n     pub rust_codegen_units_std: Option<u32>,\n     pub rust_debug_assertions: bool,\n     pub rust_debug_assertions_std: bool,\n+    pub rust_debug_logging: bool,\n     pub rust_debuginfo_level_rustc: u32,\n     pub rust_debuginfo_level_std: u32,\n     pub rust_debuginfo_level_tools: u32,\n@@ -381,6 +382,7 @@ struct Rust {\n     codegen_units_std: Option<u32>,\n     debug_assertions: Option<bool>,\n     debug_assertions_std: Option<bool>,\n+    debug_logging: Option<bool>,\n     debuginfo_level: Option<u32>,\n     debuginfo_level_rustc: Option<u32>,\n     debuginfo_level_std: Option<u32>,\n@@ -591,6 +593,7 @@ impl Config {\n         let mut debug = None;\n         let mut debug_assertions = None;\n         let mut debug_assertions_std = None;\n+        let mut debug_logging = None;\n         let mut debuginfo_level = None;\n         let mut debuginfo_level_rustc = None;\n         let mut debuginfo_level_std = None;\n@@ -634,6 +637,7 @@ impl Config {\n             debug = rust.debug;\n             debug_assertions = rust.debug_assertions;\n             debug_assertions_std = rust.debug_assertions_std;\n+            debug_logging = rust.debug_logging;\n             debuginfo_level = rust.debuginfo_level;\n             debuginfo_level_rustc = rust.debuginfo_level_rustc;\n             debuginfo_level_std = rust.debuginfo_level_std;\n@@ -737,6 +741,8 @@ impl Config {\n         config.rust_debug_assertions_std =\n             debug_assertions_std.unwrap_or(config.rust_debug_assertions);\n \n+        config.rust_debug_logging = debug_logging.unwrap_or(config.rust_debug_assertions);\n+\n         let with_defaults = |debuginfo_level_specific: Option<u32>| {\n             debuginfo_level_specific.or(debuginfo_level).unwrap_or(if debug == Some(true) {\n                 1"}, {"sha": "3c2663f6d9f57b2a5b1f8b892fe8eef3b0ff2301", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/15aa6f31b974d41ecc0312faf8d50cde19a74cca/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/15aa6f31b974d41ecc0312faf8d50cde19a74cca/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=15aa6f31b974d41ecc0312faf8d50cde19a74cca", "patch": "@@ -541,6 +541,16 @@ impl Build {\n         if self.config.llvm_enabled() {\n             features.push_str(\" llvm\");\n         }\n+\n+        // If debug logging is on, then we want the default for tracing:\n+        // https://github.com/tokio-rs/tracing/blob/3dd5c03d907afdf2c39444a29931833335171554/tracing/src/level_filters.rs#L26\n+        // which is everything (including debug/trace/etc.)\n+        // if its unset, if debug_assertions is on, then debug_logging will also be on\n+        // as well as tracing *ignoring* this feature when debug_assertions is on\n+        if !self.config.rust_debug_logging {\n+            features.push_str(\" release_max_level_info\");\n+        }\n+\n         features\n     }\n "}]}