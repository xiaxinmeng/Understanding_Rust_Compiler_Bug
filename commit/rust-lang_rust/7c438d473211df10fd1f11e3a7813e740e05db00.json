{"sha": "7c438d473211df10fd1f11e3a7813e740e05db00", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdjNDM4ZDQ3MzIxMWRmMTBmZDFmMTFlM2E3ODEzZTc0MGUwNWRiMDA=", "commit": {"author": {"name": "Hideki Sekine", "email": "sekineh@me.com", "date": "2018-08-08T09:29:17Z"}, "committer": {"name": "Hideki Sekine", "email": "sekineh@me.com", "date": "2018-08-08T09:29:17Z"}, "message": "[CI] run-make/thumb: remove hacky workaround.", "tree": {"sha": "3ba3016832b703492abf472d242ba630e4fd1249", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ba3016832b703492abf472d242ba630e4fd1249"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7c438d473211df10fd1f11e3a7813e740e05db00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7c438d473211df10fd1f11e3a7813e740e05db00", "html_url": "https://github.com/rust-lang/rust/commit/7c438d473211df10fd1f11e3a7813e740e05db00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7c438d473211df10fd1f11e3a7813e740e05db00/comments", "author": {"login": "sekineh", "id": 3956266, "node_id": "MDQ6VXNlcjM5NTYyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3956266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekineh", "html_url": "https://github.com/sekineh", "followers_url": "https://api.github.com/users/sekineh/followers", "following_url": "https://api.github.com/users/sekineh/following{/other_user}", "gists_url": "https://api.github.com/users/sekineh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekineh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekineh/subscriptions", "organizations_url": "https://api.github.com/users/sekineh/orgs", "repos_url": "https://api.github.com/users/sekineh/repos", "events_url": "https://api.github.com/users/sekineh/events{/privacy}", "received_events_url": "https://api.github.com/users/sekineh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sekineh", "id": 3956266, "node_id": "MDQ6VXNlcjM5NTYyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3956266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekineh", "html_url": "https://github.com/sekineh", "followers_url": "https://api.github.com/users/sekineh/followers", "following_url": "https://api.github.com/users/sekineh/following{/other_user}", "gists_url": "https://api.github.com/users/sekineh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekineh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekineh/subscriptions", "organizations_url": "https://api.github.com/users/sekineh/orgs", "repos_url": "https://api.github.com/users/sekineh/repos", "events_url": "https://api.github.com/users/sekineh/events{/privacy}", "received_events_url": "https://api.github.com/users/sekineh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "633832ffc2ba1c63b5ef797ab62bd7388c26ac4f", "url": "https://api.github.com/repos/rust-lang/rust/commits/633832ffc2ba1c63b5ef797ab62bd7388c26ac4f", "html_url": "https://github.com/rust-lang/rust/commit/633832ffc2ba1c63b5ef797ab62bd7388c26ac4f"}], "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "d38a9594d86a09bbd12f4fb8a35eff3b6ac6bef0", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7c438d473211df10fd1f11e3a7813e740e05db00/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7c438d473211df10fd1f11e3a7813e740e05db00/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=7c438d473211df10fd1f11e3a7813e740e05db00", "patch": "@@ -975,9 +975,19 @@ impl Step for Compiletest {\n             builder.ensure(compile::Rustc { compiler, target });\n         }\n \n-        if builder.no_std(target) != Some(true) {\n+        if builder.no_std(target) == Some(true) {\n+            // the `test` doesn't compile for no-std targets\n+            builder.ensure(compile::Std { compiler, target });\n+        } else {\n             builder.ensure(compile::Test { compiler, target });\n         }\n+\n+        if builder.no_std(target) == Some(true) {\n+            // for no_std run-make (e.g. thumb*), \n+            // we need a host compiler which is called by cargo.\n+            builder.ensure(compile::Std { compiler, target: compiler.host });\n+        }\n+\n         builder.ensure(native::TestHelpers { target });\n         builder.ensure(RemoteCopyLibs { compiler, target });\n "}, {"sha": "38f437f150e0de55774dce4b87fd6a4da5bf43b0", "filename": "src/test/run-make/thumb-none-cortex-m/Makefile", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7c438d473211df10fd1f11e3a7813e740e05db00/src%2Ftest%2Frun-make%2Fthumb-none-cortex-m%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/7c438d473211df10fd1f11e3a7813e740e05db00/src%2Ftest%2Frun-make%2Fthumb-none-cortex-m%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-cortex-m%2FMakefile?ref=7c438d473211df10fd1f11e3a7813e740e05db00", "patch": "@@ -11,13 +11,8 @@ TMP_DIR := /tmp/safe_place\n CRATE := cortex-m\n RUSTC := $(RUSTC_ORIGINAL)\n LD_LIBRARY_PATH := $(HOST_RPATH_DIR)\n-HOST := x86_64-unknown-linux-gnu\n \n all:\n-\t# Workaround for error[E0463]: can't find crate for `core`\n-\t-ln -sv $(SRC)/build/tmp/dist/rust-std-*-$(TARGET)/rust-std-$(TARGET)/lib/rustlib/$(TARGET)/lib/*.rlib $(SRC)/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/$(TARGET)/lib/\n-\t# Workaround for error[E0463]: can't find crate for `std`\n-\t-ln -sv $(SRC)/build/tmp/dist/rust-std-*-$(HOST)/rust-std-$(HOST)/lib/rustlib/$(HOST)/lib/*.rlib $(SRC)/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/$(HOST)/lib/\n \tenv > env.txt\n \tmkdir -p $(TMP_DIR)\n \t-cd $(TMP_DIR) && rm -rf $(CRATE)"}]}