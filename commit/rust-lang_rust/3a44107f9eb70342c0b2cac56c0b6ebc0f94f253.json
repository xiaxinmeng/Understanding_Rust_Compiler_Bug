{"sha": "3a44107f9eb70342c0b2cac56c0b6ebc0f94f253", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhNDQxMDdmOWViNzAzNDJjMGIyY2FjNTZjMGI2ZWJjMGY5NGYyNTM=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2015-01-21T16:10:02Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2015-01-21T17:25:53Z"}, "message": "debuginfo: Fix issue with associated types and struct fields", "tree": {"sha": "8d0a963e9545dae25169754f1657218517ce6525", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8d0a963e9545dae25169754f1657218517ce6525"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253", "html_url": "https://github.com/rust-lang/rust/commit/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6869645e86c91544b8737b89809bdf10bef536d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/6869645e86c91544b8737b89809bdf10bef536d9", "html_url": "https://github.com/rust-lang/rust/commit/6869645e86c91544b8737b89809bdf10bef536d9"}], "stats": {"total": 160, "additions": 159, "deletions": 1}, "files": [{"sha": "79de3b5b33b90a36b5d5ecc402044566f07ea39d", "filename": "src/librustc_trans/trans/debuginfo.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs?ref=3a44107f9eb70342c0b2cac56c0b6ebc0f94f253", "patch": "@@ -2068,7 +2068,13 @@ fn prepare_struct_metadata<'a, 'tcx>(cx: &CrateContext<'a, 'tcx>,\n                                                   unique_type_id,\n                                                   containing_scope);\n \n-    let fields = ty::struct_fields(cx.tcx(), def_id, substs);\n+    let mut fields = ty::struct_fields(cx.tcx(), def_id, substs);\n+\n+    // The `Ty` values returned by `ty::struct_fields` can still contain\n+    // `ty_projection` variants, so normalize those away.\n+    for field in fields.iter_mut() {\n+        field.mt.ty = monomorphize::normalize_associated_type(cx.tcx(), &field.mt.ty);\n+    }\n \n     create_and_register_recursive_type_forward_declaration(\n         cx,"}, {"sha": "6a624e39e326775c93c0bf3d9a2522a3ad8984d4", "filename": "src/test/debuginfo/associated-types.rs", "status": "added", "additions": 152, "deletions": 0, "changes": 152, "blob_url": "https://github.com/rust-lang/rust/blob/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253/src%2Ftest%2Fdebuginfo%2Fassociated-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a44107f9eb70342c0b2cac56c0b6ebc0f94f253/src%2Ftest%2Fdebuginfo%2Fassociated-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fassociated-types.rs?ref=3a44107f9eb70342c0b2cac56c0b6ebc0f94f253", "patch": "@@ -0,0 +1,152 @@\n+// Copyright 2013-2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// ignore-android: FIXME(#10381)\n+// min-lldb-version: 310\n+\n+// compile-flags:-g\n+\n+// === GDB TESTS ===================================================================================\n+// gdb-command:run\n+\n+// gdb-command:print arg\n+// gdb-check:$1 = {b = -1, b1 = 0}\n+// gdb-command:continue\n+\n+// gdb-command:print inferred\n+// gdb-check:$2 = 1\n+// gdb-command:print explicitly\n+// gdb-check:$3 = 1\n+// gdb-command:continue\n+\n+// gdb-command:print arg\n+// gdb-check:$4 = 2\n+// gdb-command:continue\n+\n+// gdb-command:print arg\n+// gdb-check:$5 = {4, 5}\n+// gdb-command:continue\n+\n+// gdb-command:print a\n+// gdb-check:$6 = 6\n+// gdb-command:print b\n+// gdb-check:$7 = 7\n+// gdb-command:continue\n+\n+// gdb-command:print a\n+// gdb-check:$8 = 8\n+// gdb-command:print b\n+// gdb-check:$9 = 9\n+// gdb-command:continue\n+\n+// === LLDB TESTS ==================================================================================\n+// lldb-command:run\n+\n+// lldb-command:print arg\n+// lldb-check:[...]$0 = Struct<i32> { b: -1, b1: 0 }\n+// lldb-command:continue\n+\n+// lldb-command:print inferred\n+// lldb-check:[...]$1 = 1\n+// lldb-command:print explicitly\n+// lldb-check:[...]$2 = 1\n+// lldb-command:continue\n+\n+// lldb-command:print arg\n+// lldb-check:[...]$3 = 2\n+// lldb-command:continue\n+\n+// lldb-command:print arg\n+// lldb-check:[...]$4 = (4, 5)\n+// lldb-command:continue\n+\n+// lldb-command:print a\n+// lldb-check:[...]$5 = 6\n+// lldb-command:print b\n+// lldb-check:[...]$6 = 7\n+// lldb-command:continue\n+\n+// lldb-command:print a\n+// lldb-check:[...]$7 = 8\n+// lldb-command:print b\n+// lldb-check:[...]$8 = 9\n+// lldb-command:continue\n+\n+#![allow(unused_variables)]\n+#![allow(dead_code)]\n+#![omit_gdb_pretty_printer_section]\n+\n+trait TraitWithAssocType {\n+    type Type;\n+\n+    fn get_value(&self) -> Self::Type;\n+}\n+impl TraitWithAssocType for i32 {\n+    type Type = i64;\n+\n+    fn get_value(&self) -> i64 { *self as i64 }\n+}\n+\n+struct Struct<T: TraitWithAssocType> {\n+    b: T,\n+    b1: T::Type,\n+}\n+\n+enum Enum<T: TraitWithAssocType> {\n+    Variant1(T, T::Type),\n+    Variant2(T::Type, T)\n+}\n+\n+fn assoc_struct<T: TraitWithAssocType>(arg: Struct<T>) {\n+    zzz(); // #break\n+}\n+\n+fn assoc_local<T: TraitWithAssocType>(x: T) {\n+    let inferred = x.get_value();\n+    let explicitly: T::Type = x.get_value();\n+\n+    zzz(); // #break\n+}\n+\n+fn assoc_arg<T: TraitWithAssocType>(arg: T::Type) {\n+    zzz(); // #break\n+}\n+\n+fn assoc_return_value<T: TraitWithAssocType>(arg: T) -> T::Type {\n+    return arg.get_value();\n+}\n+\n+fn assoc_tuple<T: TraitWithAssocType>(arg: (T, T::Type)) {\n+    zzz(); // #break\n+}\n+\n+fn assoc_enum<T: TraitWithAssocType>(arg: Enum<T>) {\n+\n+    match arg {\n+        Enum::Variant1(a, b) => {\n+            zzz(); // #break\n+        }\n+        Enum::Variant2(a, b) => {\n+            zzz(); // #break\n+        }\n+    }\n+}\n+\n+fn main() {\n+    assoc_struct(Struct { b: -1i32, b1: 0i64 });\n+    assoc_local(1i32);\n+    assoc_arg::<i32>(2i64);\n+    assoc_return_value(3i32);\n+    assoc_tuple((4i32, 5i64));\n+    assoc_enum(Enum::Variant1(6i32, 7i64));\n+    assoc_enum(Enum::Variant2(8i64, 9i32));\n+}\n+\n+fn zzz() { () }\n\\ No newline at end of file"}]}