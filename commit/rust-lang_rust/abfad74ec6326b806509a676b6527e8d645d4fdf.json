{"sha": "abfad74ec6326b806509a676b6527e8d645d4fdf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFiZmFkNzRlYzYzMjZiODA2NTA5YTY3NmI2NTI3ZThkNjQ1ZDRmZGY=", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2021-04-16T18:50:51Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2021-06-05T05:19:43Z"}, "message": "Make *const (), *mut () okay for FFI", "tree": {"sha": "5201a814bf6b3f03d2c571b6846f7acc41aba19e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5201a814bf6b3f03d2c571b6846f7acc41aba19e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/abfad74ec6326b806509a676b6527e8d645d4fdf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmC7CW8ACgkQ+boUO5X/\nbYKmLg//ZLzzQ05kvGFUpMIkCdPLmO2MWwx443BtyWqmnDi+SI+vKes1McBINfSY\nArMjRx2sY2zmP4ZFXW67Y/TLghVm99d3exYd+DiMhyuziKTx0sL1p366drDgdH2H\nB60HqfhimBHf3uXYHAjGtN+GSvay1HslakHPqBcgQ4ZLF/qleZ3DedKrGIqwRNxi\nQZE0O7DBGA4GE+mnHoyN2bKH1EPyFMCE3aQa9DAa+b7DUi58mUUhxVr/ikfA6D0u\nahYrKjP9Jkt0tRSZiC15eOJexf54vU/nW5SEZAsh5+MnpV7/zR8Nc/ATXnKK3/U6\nsYhQ6xnekNIV0Z1Bg5IcjkDvnmvvIMlxvHrQyKH2UoFLyjyHjSIJiwYM/Rp5RoYs\nbu1PuFoTqxFa2UbPM1Jk4m2FxlU2BFGPSzTrFFO0XSSmmX0Eg2TFX/k1cveIiN9z\n6yOn0PzQx0fEf6+Fq17ufG+YPQALmjbA6/kyOchjHMBOwaI7eG1vHAGasSOhyT8l\nNy9rdT4ci90qjcM9kPbJ6rmyLK4Keb0mBL2R8MaSqOoSuWlGviGXsEuY5oqGImZ2\nSLjRhSvnTZs9JzcmDXOlMggAmZHRMteBo8YfcJZh8FFgqg18q6hGJiDSu7aCd7x9\n5El7ypGbome84kcbJL9qAWOWkqIRTk5Q3XAAW1TmG9egUtpG0u0=\n=v+W/\n-----END PGP SIGNATURE-----", "payload": "tree 5201a814bf6b3f03d2c571b6846f7acc41aba19e\nparent c17e3e2c09ad984341d34fff9cd67d706d46157d\nauthor David Tolnay <dtolnay@gmail.com> 1618599051 -0700\ncommitter David Tolnay <dtolnay@gmail.com> 1622870383 -0700\n\nMake *const (), *mut () okay for FFI\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/abfad74ec6326b806509a676b6527e8d645d4fdf", "html_url": "https://github.com/rust-lang/rust/commit/abfad74ec6326b806509a676b6527e8d645d4fdf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/abfad74ec6326b806509a676b6527e8d645d4fdf/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c17e3e2c09ad984341d34fff9cd67d706d46157d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c17e3e2c09ad984341d34fff9cd67d706d46157d", "html_url": "https://github.com/rust-lang/rust/commit/c17e3e2c09ad984341d34fff9cd67d706d46157d"}], "stats": {"total": 22, "additions": 11, "deletions": 11}, "files": [{"sha": "4e3bbc58559d9cddf4f2fd6b502d85dd6a1bed5e", "filename": "compiler/rustc_lint/src/types.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/abfad74ec6326b806509a676b6527e8d645d4fdf/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/abfad74ec6326b806509a676b6527e8d645d4fdf/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs?ref=abfad74ec6326b806509a676b6527e8d645d4fdf", "patch": "@@ -1060,6 +1060,15 @@ impl<'a, 'tcx> ImproperCTypesVisitor<'a, 'tcx> {\n                 FfiSafe\n             }\n \n+            ty::RawPtr(ty::TypeAndMut { ty, .. })\n+                if match ty.kind() {\n+                    ty::Tuple(tuple) => tuple.is_empty(),\n+                    _ => false,\n+                } =>\n+            {\n+                FfiSafe\n+            }\n+\n             ty::RawPtr(ty::TypeAndMut { ty, .. }) | ty::Ref(_, ty, _) => {\n                 self.check_type_for_ffi(cache, ty)\n             }"}, {"sha": "9165e14b7ffe34892fc078e9b4709756b67a5549", "filename": "src/test/ui/lint/lint-ctypes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/abfad74ec6326b806509a676b6527e8d645d4fdf/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/abfad74ec6326b806509a676b6527e8d645d4fdf/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs?ref=abfad74ec6326b806509a676b6527e8d645d4fdf", "patch": "@@ -47,7 +47,7 @@ pub struct ZeroSizeWithPhantomData(::std::marker::PhantomData<i32>);\n extern \"C\" {\n     pub fn ptr_type1(size: *const Foo); //~ ERROR: uses type `Foo`\n     pub fn ptr_type2(size: *const Foo); //~ ERROR: uses type `Foo`\n-    pub fn ptr_unit(p: *const ()); //~ ERROR: uses type `()`\n+    pub fn ptr_unit(p: *const ());\n     pub fn ptr_tuple(p: *const ((),)); //~ ERROR: uses type `((),)`\n     pub fn slice_type(p: &[u32]); //~ ERROR: uses type `[u32]`\n     pub fn str_type(p: &str); //~ ERROR: uses type `str`"}, {"sha": "342b6bfc6f87a225871d4841590504975a5107bf", "filename": "src/test/ui/lint/lint-ctypes.stderr", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/abfad74ec6326b806509a676b6527e8d645d4fdf/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/abfad74ec6326b806509a676b6527e8d645d4fdf/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr?ref=abfad74ec6326b806509a676b6527e8d645d4fdf", "patch": "@@ -31,15 +31,6 @@ note: the type is defined here\n LL | pub struct Foo;\n    | ^^^^^^^^^^^^^^^\n \n-error: `extern` block uses type `()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:50:24\n-   |\n-LL |     pub fn ptr_unit(p: *const ());\n-   |                        ^^^^^^^^^ not FFI-safe\n-   |\n-   = help: consider using a struct instead\n-   = note: tuples have unspecified layout\n-\n error: `extern` block uses type `((),)`, which is not FFI-safe\n   --> $DIR/lint-ctypes.rs:51:25\n    |\n@@ -267,5 +258,5 @@ LL |     pub static static_u128_array_type: [u128; 16];\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n-error: aborting due to 28 previous errors\n+error: aborting due to 27 previous errors\n "}]}