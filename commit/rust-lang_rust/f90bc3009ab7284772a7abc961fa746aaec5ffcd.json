{"sha": "f90bc3009ab7284772a7abc961fa746aaec5ffcd", "node_id": "C_kwDOAAsO6NoAKGY5MGJjMzAwOWFiNzI4NDc3MmE3YWJjOTYxZmE3NDZhYWVjNWZmY2Q", "commit": {"author": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2022-09-25T15:54:15Z"}, "committer": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2022-09-26T16:20:11Z"}, "message": "Enable stack probing on x86_64\n\nCranelift now supports inline stack probes on x86_64", "tree": {"sha": "20a374d500baae613ab82bbbe34498c877ae68ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20a374d500baae613ab82bbbe34498c877ae68ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f90bc3009ab7284772a7abc961fa746aaec5ffcd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f90bc3009ab7284772a7abc961fa746aaec5ffcd", "html_url": "https://github.com/rust-lang/rust/commit/f90bc3009ab7284772a7abc961fa746aaec5ffcd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f90bc3009ab7284772a7abc961fa746aaec5ffcd/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0035f09c5a25d230b594374239a0c61301137946", "url": "https://api.github.com/repos/rust-lang/rust/commits/0035f09c5a25d230b594374239a0c61301137946", "html_url": "https://github.com/rust-lang/rust/commit/0035f09c5a25d230b594374239a0c61301137946"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "629d79d501240217d17ac3a6294ff338ed29300c", "filename": "src/lib.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f90bc3009ab7284772a7abc961fa746aaec5ffcd/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f90bc3009ab7284772a7abc961fa746aaec5ffcd/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=f90bc3009ab7284772a7abc961fa746aaec5ffcd", "patch": "@@ -251,7 +251,6 @@ fn build_isa(sess: &Session, backend_config: &BackendConfig) -> Box<dyn isa::Tar\n \n     let mut flags_builder = settings::builder();\n     flags_builder.enable(\"is_pic\").unwrap();\n-    flags_builder.set(\"enable_probestack\", \"false\").unwrap(); // __cranelift_probestack is not provided\n     let enable_verifier = if backend_config.enable_verifier { \"true\" } else { \"false\" };\n     flags_builder.set(\"enable_verifier\", enable_verifier).unwrap();\n     flags_builder.set(\"regalloc_checker\", enable_verifier).unwrap();\n@@ -279,6 +278,15 @@ fn build_isa(sess: &Session, backend_config: &BackendConfig) -> Box<dyn isa::Tar\n         }\n     }\n \n+    if target_triple.architecture == target_lexicon::Architecture::X86_64 {\n+        // Windows depends on stack probes to grow the committed part of the stack\n+        flags_builder.enable(\"enable_probestack\").unwrap();\n+        flags_builder.set(\"probestack_strategy\", \"inline\").unwrap();\n+    } else {\n+        // __cranelift_probestack is not provided and inline stack probes are only supported on x86_64\n+        flags_builder.set(\"enable_probestack\", \"false\").unwrap();\n+    }\n+\n     let flags = settings::Flags::new(flags_builder);\n \n     let isa_builder = match sess.opts.cg.target_cpu.as_deref() {"}]}