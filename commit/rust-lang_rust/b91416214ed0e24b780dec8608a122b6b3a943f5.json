{"sha": "b91416214ed0e24b780dec8608a122b6b3a943f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5MTQxNjIxNGVkMGUyNGI3ODBkZWM4NjA4YTEyMmI2YjNhOTQzZjU=", "commit": {"author": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-06-30T02:36:27Z"}, "committer": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-06-30T07:45:39Z"}, "message": "add a contains_managed intrinsic", "tree": {"sha": "b1f057ce808fc8eb5565ec7987ea50f45ecae660", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1f057ce808fc8eb5565ec7987ea50f45ecae660"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b91416214ed0e24b780dec8608a122b6b3a943f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b91416214ed0e24b780dec8608a122b6b3a943f5", "html_url": "https://github.com/rust-lang/rust/commit/b91416214ed0e24b780dec8608a122b6b3a943f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b91416214ed0e24b780dec8608a122b6b3a943f5/comments", "author": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b883d6a54c460f8357b1107b3599108eb1f8580b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b883d6a54c460f8357b1107b3599108eb1f8580b", "html_url": "https://github.com/rust-lang/rust/commit/b883d6a54c460f8357b1107b3599108eb1f8580b"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "5dcd6927fa101866228658daa7d29ae0214ac55d", "filename": "src/librustc/middle/trans/foreign.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs?ref=b91416214ed0e24b780dec8608a122b6b3a943f5", "patch": "@@ -751,6 +751,12 @@ pub fn trans_intrinsic(ccx: @mut CrateContext,\n                   C_bool(ty::type_needs_drop(ccx.tcx, tp_ty)),\n                   fcx.llretptr.get());\n         }\n+        \"contains_managed\" => {\n+            let tp_ty = substs.tys[0];\n+            Store(bcx,\n+                  C_bool(ty::type_contents(ccx.tcx, tp_ty).contains_managed()),\n+                  fcx.llretptr.get());\n+        }\n         \"visit_tydesc\" => {\n             let td = get_param(decl, first_real_arg);\n             let visitor = get_param(decl, first_real_arg + 1u);"}, {"sha": "5544751529cea891bcf3bd982d9f906e8ad1fbc5", "filename": "src/librustc/middle/trans/type_use.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs?ref=b91416214ed0e24b780dec8608a122b6b3a943f5", "patch": "@@ -127,7 +127,7 @@ pub fn type_uses_for(ccx: @mut CrateContext, fn_id: def_id, n_tps: uint)\n                     \"uninit\"   | \"init\" | \"transmute\" | \"move_val\" |\n                     \"move_val_init\" => use_repr,\n \n-                    \"get_tydesc\" | \"needs_drop\" => use_tydesc,\n+                    \"get_tydesc\" | \"needs_drop\" | \"contains_managed\" => use_tydesc,\n \n                     \"visit_tydesc\"  | \"forget\" | \"frame_address\" |\n                     \"morestack_addr\" => 0,"}, {"sha": "8a280374ebf53f7707d5954d743a68a23c317199", "filename": "src/librustc/middle/typeck/check/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs?ref=b91416214ed0e24b780dec8608a122b6b3a943f5", "patch": "@@ -3540,7 +3540,7 @@ pub fn check_intrinsic_type(ccx: @mut CrateCtxt, it: @ast::foreign_item) {\n                ty::mk_nil())\n             }\n             \"needs_drop\" => (1u, ~[], ty::mk_bool()),\n-\n+            \"contains_managed\" => (1u, ~[], ty::mk_bool()),\n             \"atomic_xchg\"     | \"atomic_xadd\"     | \"atomic_xsub\"     |\n             \"atomic_xchg_acq\" | \"atomic_xadd_acq\" | \"atomic_xsub_acq\" |\n             \"atomic_xchg_rel\" | \"atomic_xadd_rel\" | \"atomic_xsub_rel\" => {"}, {"sha": "500143fb5777341a8957112b5a3c3bea858fd4df", "filename": "src/libstd/unstable/intrinsics.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibstd%2Funstable%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b91416214ed0e24b780dec8608a122b6b3a943f5/src%2Flibstd%2Funstable%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Fintrinsics.rs?ref=b91416214ed0e24b780dec8608a122b6b3a943f5", "patch": "@@ -308,6 +308,10 @@ pub extern \"rust-intrinsic\" {\n     /// Returns `true` if a type requires drop glue.\n     pub fn needs_drop<T>() -> bool;\n \n+    /// Returns `true` if a type is managed (will be allocated on the local heap)\n+    #[cfg(not(stage0))]\n+    pub fn contains_managed<T>() -> bool;\n+\n     #[cfg(not(stage0))]\n     pub fn visit_tydesc(td: *TyDesc, tv: @TyVisitor);\n "}]}