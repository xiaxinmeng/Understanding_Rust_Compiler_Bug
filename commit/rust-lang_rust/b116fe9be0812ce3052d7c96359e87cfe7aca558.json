{"sha": "b116fe9be0812ce3052d7c96359e87cfe7aca558", "node_id": "C_kwDOAAsO6NoAKGIxMTZmZTliZTA4MTJjZTMwNTJkN2M5NjM1OWU4N2NmZTdhY2E1NTg", "commit": {"author": {"name": "Isobel Redelmeier", "email": "iredelmeier@gmail.com", "date": "2022-11-21T21:40:32Z"}, "committer": {"name": "Isobel Redelmeier", "email": "iredelmeier@gmail.com", "date": "2022-11-21T21:40:32Z"}, "message": "Fix: Handle empty `checkOnSave/target` values\n\nThis fixes a regression introduced by #13290, in which failing to set\n`checkOnSave/target` (or `checkOnSave/targets`) would lead to an invalid\nconfig.", "tree": {"sha": "142d9efca6de68eb1321d70aed42de1f27e6315a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/142d9efca6de68eb1321d70aed42de1f27e6315a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b116fe9be0812ce3052d7c96359e87cfe7aca558", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEa56ovjbIZ1JZE06i8tZHttoEujsFAmN78FAACgkQ8tZHttoE\nujv8MQ//VW2khWaHcvt5fEzVV3VJImc4JAO5MAmSfQ4JFtZVE3iW6zvxBiMHlV5F\nePOyjTpD7qSvtc0iG8dtbkz+q3hPuhUD1dahcWjT1fVIUxrTpjWT8slBDkFZ0E+X\n7+Tc+tHL8r+B13ViGIefHLrWtz4Ix3kzoIgFAIsqPoeaQu1oOUd4pzuOeFpm+2B/\ncjqVGBlUwmh7qOZOb+8jE4FPXsdsrQnNoOK+SMxMrlpaOmGBKgMcEbYBKqTzfLnK\noRrNJpxehBOYt/ELHJtLhfqWoA0Lw6/1cJcm+3kZcVK9OVw65cn3DuKlb5Q/RP24\neFixN00t1ff4JYTWCvL8G/FpnckNsKKkNIoAu+j42PWA0Y6HLb4BB3KVX5Txl74U\nQLGoIDAVGIbyif+ATPnRwz/FS7R6MlLt7sJFnnJ19esJlNrn/A+ONdKpi+Kko1dS\nGo9M/SNp1SqUus3vBgLRB08ns+MyNdNUwsHrZ/r8sFpiXOetl4finSwlXjJ8lot1\noqWS9/cbeal7xq0ICxN4DQ3JVLsJIHf1jpFQBlxSqnKn1zqDEkIp9pgAsyCH2H/5\n4fUGpk86rUGTEQEg6dMzVdfyHPYSsXCZEkdsOaC6i0vEkQG07RGH/AVyQFsliET3\nBPdxd4riGoUAKr9PNmn+gI2p8w5Sc628kVXwKgIr618YLW7+Lfs=\n=vD+y\n-----END PGP SIGNATURE-----", "payload": "tree 142d9efca6de68eb1321d70aed42de1f27e6315a\nparent 26562973b3482a635416b2b663a13016d4d90e20\nauthor Isobel Redelmeier <iredelmeier@gmail.com> 1669066832 -0500\ncommitter Isobel Redelmeier <iredelmeier@gmail.com> 1669066832 -0500\n\nFix: Handle empty `checkOnSave/target` values\n\nThis fixes a regression introduced by #13290, in which failing to set\n`checkOnSave/target` (or `checkOnSave/targets`) would lead to an invalid\nconfig.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b116fe9be0812ce3052d7c96359e87cfe7aca558", "html_url": "https://github.com/rust-lang/rust/commit/b116fe9be0812ce3052d7c96359e87cfe7aca558", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b116fe9be0812ce3052d7c96359e87cfe7aca558/comments", "author": {"login": "iredelmeier", "id": 3298606, "node_id": "MDQ6VXNlcjMyOTg2MDY=", "avatar_url": "https://avatars.githubusercontent.com/u/3298606?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iredelmeier", "html_url": "https://github.com/iredelmeier", "followers_url": "https://api.github.com/users/iredelmeier/followers", "following_url": "https://api.github.com/users/iredelmeier/following{/other_user}", "gists_url": "https://api.github.com/users/iredelmeier/gists{/gist_id}", "starred_url": "https://api.github.com/users/iredelmeier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iredelmeier/subscriptions", "organizations_url": "https://api.github.com/users/iredelmeier/orgs", "repos_url": "https://api.github.com/users/iredelmeier/repos", "events_url": "https://api.github.com/users/iredelmeier/events{/privacy}", "received_events_url": "https://api.github.com/users/iredelmeier/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iredelmeier", "id": 3298606, "node_id": "MDQ6VXNlcjMyOTg2MDY=", "avatar_url": "https://avatars.githubusercontent.com/u/3298606?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iredelmeier", "html_url": "https://github.com/iredelmeier", "followers_url": "https://api.github.com/users/iredelmeier/followers", "following_url": "https://api.github.com/users/iredelmeier/following{/other_user}", "gists_url": "https://api.github.com/users/iredelmeier/gists{/gist_id}", "starred_url": "https://api.github.com/users/iredelmeier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iredelmeier/subscriptions", "organizations_url": "https://api.github.com/users/iredelmeier/orgs", "repos_url": "https://api.github.com/users/iredelmeier/repos", "events_url": "https://api.github.com/users/iredelmeier/events{/privacy}", "received_events_url": "https://api.github.com/users/iredelmeier/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26562973b3482a635416b2b663a13016d4d90e20", "url": "https://api.github.com/repos/rust-lang/rust/commits/26562973b3482a635416b2b663a13016d4d90e20", "html_url": "https://github.com/rust-lang/rust/commit/26562973b3482a635416b2b663a13016d4d90e20"}], "stats": {"total": 27, "additions": 19, "deletions": 8}, "files": [{"sha": "6c0d712a4f473fd18221130027264ebc19a36566", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/b116fe9be0812ce3052d7c96359e87cfe7aca558/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b116fe9be0812ce3052d7c96359e87cfe7aca558/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=b116fe9be0812ce3052d7c96359e87cfe7aca558", "patch": "@@ -182,7 +182,7 @@ config_data! {\n         /// `[\"aarch64-apple-darwin\", \"x86_64-apple-darwin\"]`.\n         ///\n         /// Aliased as `\"checkOnSave.targets\"`.\n-        checkOnSave_target | checkOnSave_targets: CheckOnSaveTargets           = \"[]\",\n+        checkOnSave_target | checkOnSave_targets: Option<CheckOnSaveTargets>           = \"null\",\n \n         /// Toggles the additional completions that automatically add imports when completed.\n         /// Note that your client must specify the `additionalTextEdits` LSP client capability to truly have this feature enabled.\n@@ -1153,10 +1153,15 @@ impl Config {\n             }\n             Some(_) | None => FlycheckConfig::CargoCommand {\n                 command: self.data.checkOnSave_command.clone(),\n-                target_triples: match &self.data.checkOnSave_target.0[..] {\n-                    [] => self.data.cargo_target.clone().into_iter().collect(),\n-                    targets => targets.into(),\n-                },\n+                target_triples: self\n+                    .data\n+                    .checkOnSave_target\n+                    .clone()\n+                    .and_then(|targets| match &targets.0[..] {\n+                        [] => None,\n+                        targets => Some(targets.into()),\n+                    })\n+                    .unwrap_or_else(|| self.data.cargo_target.clone().into_iter().collect()),\n                 all_targets: self.data.checkOnSave_allTargets,\n                 no_default_features: self\n                     .data\n@@ -2126,8 +2131,11 @@ fn field_props(field: &str, ty: &str, doc: &[&str], default: &str) -> serde_json\n                 \"The command will be executed in the project root.\"\n             ],\n         },\n-        \"CheckOnSaveTargets\" => set! {\n+        \"Option<CheckOnSaveTargets>\" => set! {\n             \"anyOf\": [\n+                {\n+                    \"type\": \"null\"\n+                },\n                 {\n                     \"type\": \"string\",\n                 },"}, {"sha": "db41c7bf109e2628947b9bb165acd936aab8ed17", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b116fe9be0812ce3052d7c96359e87cfe7aca558/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/b116fe9be0812ce3052d7c96359e87cfe7aca558/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=b116fe9be0812ce3052d7c96359e87cfe7aca558", "patch": "@@ -190,7 +190,7 @@ cargo check --workspace --message-format=json --all-targets\n ```\n .\n --\n-[[rust-analyzer.checkOnSave.target]]rust-analyzer.checkOnSave.target (default: `[]`)::\n+[[rust-analyzer.checkOnSave.target]]rust-analyzer.checkOnSave.target (default: `null`)::\n +\n --\n Check for specific targets. Defaults to `#rust-analyzer.cargo.target#` if empty."}, {"sha": "a3385a3868b6dae2076f4cefedda81c7c2a587a1", "filename": "editors/code/package.json", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b116fe9be0812ce3052d7c96359e87cfe7aca558/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/b116fe9be0812ce3052d7c96359e87cfe7aca558/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=b116fe9be0812ce3052d7c96359e87cfe7aca558", "patch": "@@ -640,8 +640,11 @@\n                 },\n                 \"rust-analyzer.checkOnSave.target\": {\n                     \"markdownDescription\": \"Check for specific targets. Defaults to `#rust-analyzer.cargo.target#` if empty.\\n\\nCan be a single target, e.g. `\\\"x86_64-unknown-linux-gnu\\\"` or a list of targets, e.g.\\n`[\\\"aarch64-apple-darwin\\\", \\\"x86_64-apple-darwin\\\"]`.\\n\\nAliased as `\\\"checkOnSave.targets\\\"`.\",\n-                    \"default\": [],\n+                    \"default\": null,\n                     \"anyOf\": [\n+                        {\n+                            \"type\": \"null\"\n+                        },\n                         {\n                             \"type\": \"string\"\n                         },"}]}