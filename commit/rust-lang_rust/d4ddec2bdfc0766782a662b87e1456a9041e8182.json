{"sha": "d4ddec2bdfc0766782a662b87e1456a9041e8182", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ0ZGRlYzJiZGZjMDc2Njc4MmE2NjJiODdlMTQ1NmE5MDQxZTgxODI=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-06-24T14:14:58Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-06-24T14:54:21Z"}, "message": "Shrink arenas after building ItemTree", "tree": {"sha": "1e7e758e14b609fcec6aae19bd5001290286ec47", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e7e758e14b609fcec6aae19bd5001290286ec47"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d4ddec2bdfc0766782a662b87e1456a9041e8182", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d4ddec2bdfc0766782a662b87e1456a9041e8182", "html_url": "https://github.com/rust-lang/rust/commit/d4ddec2bdfc0766782a662b87e1456a9041e8182", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d4ddec2bdfc0766782a662b87e1456a9041e8182/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94169ee504bf1a5e59530c1ab1f5f5550ae45914", "url": "https://api.github.com/repos/rust-lang/rust/commits/94169ee504bf1a5e59530c1ab1f5f5550ae45914", "html_url": "https://github.com/rust-lang/rust/commit/94169ee504bf1a5e59530c1ab1f5f5550ae45914"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "3169aa5b8cc4d25f4f8a058784af309b3a144f46", "filename": "crates/ra_arena/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d4ddec2bdfc0766782a662b87e1456a9041e8182/crates%2Fra_arena%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4ddec2bdfc0766782a662b87e1456a9041e8182/crates%2Fra_arena%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_arena%2Fsrc%2Flib.rs?ref=d4ddec2bdfc0766782a662b87e1456a9041e8182", "patch": "@@ -116,6 +116,9 @@ impl<T> Arena<T> {\n     ) -> impl Iterator<Item = (Idx<T>, &T)> + ExactSizeIterator + DoubleEndedIterator {\n         self.data.iter().enumerate().map(|(idx, value)| (Idx::from_raw(RawId(idx as u32)), value))\n     }\n+    pub fn shrink_to_fit(&mut self) {\n+        self.data.shrink_to_fit();\n+    }\n }\n \n impl<T> Default for Arena<T> {"}, {"sha": "31f3c4bd8315a538d3bb793bc66cba0dfd31f290", "filename": "crates/ra_hir_def/src/item_tree.rs", "status": "modified", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/d4ddec2bdfc0766782a662b87e1456a9041e8182/crates%2Fra_hir_def%2Fsrc%2Fitem_tree.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4ddec2bdfc0766782a662b87e1456a9041e8182/crates%2Fra_hir_def%2Fsrc%2Fitem_tree.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fitem_tree.rs?ref=d4ddec2bdfc0766782a662b87e1456a9041e8182", "patch": "@@ -184,6 +184,7 @@ impl ItemTree {\n         if let Some(attrs) = top_attrs {\n             item_tree.attrs.insert(AttrOwner::TopLevel, attrs);\n         }\n+        item_tree.shrink_to_fit();\n         Arc::new(item_tree)\n     }\n \n@@ -196,6 +197,51 @@ impl ItemTree {\n         }\n     }\n \n+    fn shrink_to_fit(&mut self) {\n+        if let Some(data) = &mut self.data {\n+            let ItemTreeData {\n+                imports,\n+                extern_crates,\n+                functions,\n+                structs,\n+                fields,\n+                unions,\n+                enums,\n+                variants,\n+                consts,\n+                statics,\n+                traits,\n+                impls,\n+                type_aliases,\n+                mods,\n+                macro_calls,\n+                exprs,\n+                vis,\n+                generics,\n+            } = &mut **data;\n+\n+            imports.shrink_to_fit();\n+            extern_crates.shrink_to_fit();\n+            functions.shrink_to_fit();\n+            structs.shrink_to_fit();\n+            fields.shrink_to_fit();\n+            unions.shrink_to_fit();\n+            enums.shrink_to_fit();\n+            variants.shrink_to_fit();\n+            consts.shrink_to_fit();\n+            statics.shrink_to_fit();\n+            traits.shrink_to_fit();\n+            impls.shrink_to_fit();\n+            type_aliases.shrink_to_fit();\n+            mods.shrink_to_fit();\n+            macro_calls.shrink_to_fit();\n+            exprs.shrink_to_fit();\n+\n+            vis.arena.shrink_to_fit();\n+            generics.arena.shrink_to_fit();\n+        }\n+    }\n+\n     /// Returns an iterator over all items located at the top level of the `HirFileId` this\n     /// `ItemTree` was created from.\n     pub fn top_level_items(&self) -> &[ModItem] {"}]}