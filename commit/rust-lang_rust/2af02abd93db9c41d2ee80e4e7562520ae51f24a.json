{"sha": "2af02abd93db9c41d2ee80e4e7562520ae51f24a", "node_id": "C_kwDOAAsO6NoAKDJhZjAyYWJkOTNkYjljNDFkMmVlODBlNGU3NTYyNTIwYWU1MWYyNGE", "commit": {"author": {"name": "Chase Wilson", "email": "me@chasewilson.dev", "date": "2021-12-14T19:40:16Z"}, "committer": {"name": "Chase Wilson", "email": "me@chasewilson.dev", "date": "2021-12-14T19:40:16Z"}, "message": "Minor cleanup", "tree": {"sha": "fd978fffc05e5b4e5eac5ccf76047696eca9066b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd978fffc05e5b4e5eac5ccf76047696eca9066b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2af02abd93db9c41d2ee80e4e7562520ae51f24a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJHBAABCAAxFiEEWoxo69mZszIDaIeeZdBeU2cJKAEFAmG48ycTHG1lQGNoYXNl\nd2lsc29uLmRldgAKCRBl0F5TZwkoAWIgD/4gNDgSC0lyd50GSPF4g8zUZI33a7Ub\nHSAWfv3xECG0JKoft6c5+qD0vgp9t2vxgXPp+qUkL8T7Fpx3WfSwvI2JGzUPWZmx\ndKt4kilURPRVexxicvf5OHnbn7QjbEkKXXaT1I8LhhBsNf4BVrzUhabhxjfPoa7c\nfqm01+FG1e6Jhif7WxlXHOllBcFoNsWxC+FJk2B2jd5e7tig5drp4Zel/fMH3Xkl\nq5XOk39eTKY+f9wiWMQnMLLy/ccPlhBcRxAewTgKNPre1WVyKmAaiw63SI9fy2kW\non7+plSEZp5UBJ8Qmrfr6QHocU5wkuNPKR4amyVgvMZdiG1J3fN758O5zoVX0sSD\nsTuDcLpgmG3WnTRxqxqLIKUjlxP9SCbPRaFRRVtQr/hwlZ1DKq7BstP01ZMGqJkk\nDSuz+hIm24m03sMEEDHoeq9kKpi89HzAWtDjCCeVQN82E7KMnAEZ+uJBi5YYTGtK\nGQqg2p9CLELTM/Reust44OPDSSf6Aq067rleIxZBSMWFhrwO2qyLnp4sNsyVVlll\nqWEjHuzVjKIKp8C7olRhdVMoAihwJVM+d3MGTemskKhX8t9We/jJoyBVyfGPHizY\nK0ZaOX4r/fmjPoTjFTqXF6yjZhI1l4ieUkT0FZkRD5+D9Gnw4tu0pIo9pZqfegbn\nKoZ/+iFLGdUyyw==\n=+J0h\n-----END PGP SIGNATURE-----", "payload": "tree fd978fffc05e5b4e5eac5ccf76047696eca9066b\nparent 2b46c7c90615b9486841ff8e71c126ce95a3fd8a\nauthor Chase Wilson <me@chasewilson.dev> 1639510816 -0600\ncommitter Chase Wilson <me@chasewilson.dev> 1639510816 -0600\n\nMinor cleanup\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2af02abd93db9c41d2ee80e4e7562520ae51f24a", "html_url": "https://github.com/rust-lang/rust/commit/2af02abd93db9c41d2ee80e4e7562520ae51f24a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2af02abd93db9c41d2ee80e4e7562520ae51f24a/comments", "author": {"login": "Kixiron", "id": 25047011, "node_id": "MDQ6VXNlcjI1MDQ3MDEx", "avatar_url": "https://avatars.githubusercontent.com/u/25047011?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kixiron", "html_url": "https://github.com/Kixiron", "followers_url": "https://api.github.com/users/Kixiron/followers", "following_url": "https://api.github.com/users/Kixiron/following{/other_user}", "gists_url": "https://api.github.com/users/Kixiron/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kixiron/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kixiron/subscriptions", "organizations_url": "https://api.github.com/users/Kixiron/orgs", "repos_url": "https://api.github.com/users/Kixiron/repos", "events_url": "https://api.github.com/users/Kixiron/events{/privacy}", "received_events_url": "https://api.github.com/users/Kixiron/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Kixiron", "id": 25047011, "node_id": "MDQ6VXNlcjI1MDQ3MDEx", "avatar_url": "https://avatars.githubusercontent.com/u/25047011?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kixiron", "html_url": "https://github.com/Kixiron", "followers_url": "https://api.github.com/users/Kixiron/followers", "following_url": "https://api.github.com/users/Kixiron/following{/other_user}", "gists_url": "https://api.github.com/users/Kixiron/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kixiron/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kixiron/subscriptions", "organizations_url": "https://api.github.com/users/Kixiron/orgs", "repos_url": "https://api.github.com/users/Kixiron/repos", "events_url": "https://api.github.com/users/Kixiron/events{/privacy}", "received_events_url": "https://api.github.com/users/Kixiron/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b46c7c90615b9486841ff8e71c126ce95a3fd8a", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b46c7c90615b9486841ff8e71c126ce95a3fd8a", "html_url": "https://github.com/rust-lang/rust/commit/2b46c7c90615b9486841ff8e71c126ce95a3fd8a"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "727c0ba63cbb64b30511df583c8af65656bc43b7", "filename": "compiler/rustc_middle/src/ty/layout.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2af02abd93db9c41d2ee80e4e7562520ae51f24a/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2af02abd93db9c41d2ee80e4e7562520ae51f24a/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs?ref=2af02abd93db9c41d2ee80e4e7562520ae51f24a", "patch": "@@ -347,10 +347,6 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n \n         let mut inverse_memory_index: Vec<u32> = (0..fields.len() as u32).collect();\n \n-        // `ReprOptions.layout_seed` is a deterministic seed that we can use to\n-        // randomize field ordering with\n-        let mut rng = Xoshiro128StarStar::seed_from_u64(repr.field_shuffle_seed);\n-\n         let optimize = !repr.inhibit_struct_field_reordering_opt();\n         if optimize {\n             let end =\n@@ -364,6 +360,10 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n             // the field ordering to try and catch some code making assumptions about layouts\n             // we don't guarantee\n             if repr.can_randomize_type_layout() {\n+                // `ReprOptions.layout_seed` is a deterministic seed that we can use to\n+                // randomize field ordering with\n+                let mut rng = Xoshiro128StarStar::seed_from_u64(repr.field_shuffle_seed);\n+\n                 // Shuffle the ordering of the fields\n                 optimizing.shuffle(&mut rng);\n "}, {"sha": "10232dc9cb60e01e44666b26691b43997ff9267e", "filename": "compiler/rustc_middle/src/ty/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2af02abd93db9c41d2ee80e4e7562520ae51f24a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2af02abd93db9c41d2ee80e4e7562520ae51f24a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs?ref=2af02abd93db9c41d2ee80e4e7562520ae51f24a", "patch": "@@ -1608,9 +1608,9 @@ bitflags! {\n         // the seed stored in `ReprOptions.layout_seed`\n         const RANDOMIZE_LAYOUT   = 1 << 5;\n         // Any of these flags being set prevent field reordering optimisation.\n-        const IS_UNOPTIMISABLE   = ReprFlags::IS_C.bits |\n-                                   ReprFlags::IS_SIMD.bits |\n-                                   ReprFlags::IS_LINEAR.bits;\n+        const IS_UNOPTIMISABLE   = ReprFlags::IS_C.bits\n+                                 | ReprFlags::IS_SIMD.bits\n+                                 | ReprFlags::IS_LINEAR.bits;\n     }\n }\n "}]}