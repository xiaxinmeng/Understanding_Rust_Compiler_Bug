{"sha": "9fc384fcf9e8d028aec1dd11da15c702667e4205", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmYzM4NGZjZjllOGQwMjhhZWMxZGQxMWRhMTVjNzAyNjY3ZTQyMDU=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-09-24T19:05:50Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-09-28T17:44:45Z"}, "message": "Print non-std frames to stdout in `backtrace-api` test", "tree": {"sha": "5a0e8f59d4130e0ec2f69f6972df711b2a8a37c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a0e8f59d4130e0ec2f69f6972df711b2a8a37c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9fc384fcf9e8d028aec1dd11da15c702667e4205", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl9yIQ0ACgkQtAh+UQ6Y\nsWSYeA/9EEHnG9I6EUX5VUIebjCCEpURvGRFxy7dJTKhn/f5N+vJJ70/7TuMLIZR\nVFSMvBB8eAGoc6pyd9Vrrr+i6iYBiR+A1RGhti+E6FcT7tpg3+U/IkwmkoM10cpw\n7S4sj2zEc823B9ZDh1UP8kEYRNWT22GRx/5sEWNvC6C7m+C8kxhIuD6IwL+1FZ8R\njRC4mBPvQF7iFtPGLaTwtW2xc65NDKap+jV+atSACuM+dUKU+ldQKrRNdCNa+CeJ\nVGqpZ2s+S+hSV9cqpt9DLy5J72VuGyfK2Jg6wAZlf+AuM10PcJZzb5Gx0bFMDLAq\np2n1BdNQGANKGF4MSw9A7W7kO6A2mSqkktHr6sXwuiPGaFzNTDcgS3QxMExlsWfA\nB3p2bQ1NujHteewKJ9NaLpBdJzef6B7CNyhPfij0i/2lmNlAuHAZIqV+Lq8yA1fT\nQL4eaM3JU6LiBdAVJ07MOjiOO+vkjEiinZU5BS6VemmwcpiXxp1tulBo5d/PjOoo\n2onzaMsoVvSk2SRBnwF1I8tR/z34CqX9srwtC8EW4CUyaWAP3LC5LaK1uS8gb4Zv\nQrdiA0sbmG/J1Ux7t2JR6p44SyCJQtIjBW5qfvm0/cDRFcXZBYS/kDRTQDUVahym\nUzvJLXTLq40jTK9TOlfwQY0tlUOplPxTd/9l9TqlYifombKByf0=\n=8vWf\n-----END PGP SIGNATURE-----", "payload": "tree 5a0e8f59d4130e0ec2f69f6972df711b2a8a37c2\nparent ef43c5a614fe1b9556e4291f7f11cbe0e3d9a125\nauthor Aaron Hill <aa1ronham@gmail.com> 1600974350 -0400\ncommitter Aaron Hill <aa1ronham@gmail.com> 1601315085 -0400\n\nPrint non-std frames to stdout in `backtrace-api` test\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9fc384fcf9e8d028aec1dd11da15c702667e4205", "html_url": "https://github.com/rust-lang/rust/commit/9fc384fcf9e8d028aec1dd11da15c702667e4205", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9fc384fcf9e8d028aec1dd11da15c702667e4205/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef43c5a614fe1b9556e4291f7f11cbe0e3d9a125", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef43c5a614fe1b9556e4291f7f11cbe0e3d9a125", "html_url": "https://github.com/rust-lang/rust/commit/ef43c5a614fe1b9556e4291f7f11cbe0e3d9a125"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "73a3f6242d5b89903d650f9d8a425d0088c522f2", "filename": "tests/run-pass/backtrace-api.rs", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/9fc384fcf9e8d028aec1dd11da15c702667e4205/tests%2Frun-pass%2Fbacktrace-api.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fc384fcf9e8d028aec1dd11da15c702667e4205/tests%2Frun-pass%2Fbacktrace-api.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fbacktrace-api.rs?ref=9fc384fcf9e8d028aec1dd11da15c702667e4205", "patch": "@@ -14,12 +14,26 @@ struct MiriFrame {\n     colno: u32\n }\n \n+fn func_a() -> Box<[*mut ()]> { func_b::<u8>() }\n+fn func_b<T>() -> Box<[*mut ()]> { func_c() }\n+fn func_c() -> Box<[*mut ()]> { unsafe { miri_get_backtrace() } }\n+\n fn main() {\n-    let frames = unsafe { miri_get_backtrace() };\n+    let mut seen_main = false;\n+    let frames = func_a();\n     for frame in frames.into_iter() {\n         let miri_frame = unsafe { miri_resolve_frame(*frame, 0) };\n         let name = String::from_utf8(miri_frame.name.into()).unwrap();\n         let filename = String::from_utf8(miri_frame.filename.into()).unwrap();\n-        eprintln!(\"{}:{}:{} ({})\", filename, miri_frame.lineno, miri_frame.colno, name);\n+\n+        // Print every frame to stderr.\n+        let out = format!(\"{}:{}:{} ({})\", filename, miri_frame.lineno, miri_frame.colno, name);\n+        eprintln!(\"{}\", out);\n+        // Print the 'main' frame (and everything before it) to stdout, skipping\n+        // the printing of internal (and possibly fragile) libstd frames.\n+        if !seen_main {\n+            println!(\"{}\", out);\n+            seen_main = name == \"main\";\n+        }\n     }\n }"}, {"sha": "b96def8093a4449798a1a4f29d552d10f4de4e6f", "filename": "tests/run-pass/backtrace-api.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9fc384fcf9e8d028aec1dd11da15c702667e4205/tests%2Frun-pass%2Fbacktrace-api.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9fc384fcf9e8d028aec1dd11da15c702667e4205/tests%2Frun-pass%2Fbacktrace-api.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fbacktrace-api.stderr?ref=9fc384fcf9e8d028aec1dd11da15c702667e4205", "patch": "@@ -1,4 +1,7 @@\n-$DIR/backtrace-api.rs:18:27 (main)\n+$DIR/backtrace-api.rs:19:42 (func_c)\n+$DIR/backtrace-api.rs:18:36 (func_b::<u8>)\n+$DIR/backtrace-api.rs:17:33 (func_a)\n+$DIR/backtrace-api.rs:23:18 (main)\n RUSTLIB/src/rust/library/core/src/ops/function.rs:LL:COL (<fn() as std::ops::FnOnce<()>>::call_once - shim(fn()))\n RUSTLIB/src/rust/library/std/src/sys_common/backtrace.rs:LL:COL (std::sys_common::backtrace::__rust_begin_short_backtrace::<fn(), ()>)\n RUSTLIB/src/rust/library/std/src/rt.rs:LL:COL (std::rt::lang_start::<()>::{{closure}}#0)"}, {"sha": "0d8aaa7a3261ccf403da2f5f5e0d4561a70cf4f5", "filename": "tests/run-pass/backtrace-api.stdout", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9fc384fcf9e8d028aec1dd11da15c702667e4205/tests%2Frun-pass%2Fbacktrace-api.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/9fc384fcf9e8d028aec1dd11da15c702667e4205/tests%2Frun-pass%2Fbacktrace-api.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fbacktrace-api.stdout?ref=9fc384fcf9e8d028aec1dd11da15c702667e4205", "patch": "@@ -0,0 +1,4 @@\n+$DIR/backtrace-api.rs:19:42 (func_c)\n+$DIR/backtrace-api.rs:18:36 (func_b::<u8>)\n+$DIR/backtrace-api.rs:17:33 (func_a)\n+$DIR/backtrace-api.rs:23:18 (main)"}]}