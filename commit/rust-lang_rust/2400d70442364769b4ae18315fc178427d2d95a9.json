{"sha": "2400d70442364769b4ae18315fc178427d2d95a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0MDBkNzA0NDIzNjQ3NjliNGFlMTgzMTVmYzE3ODQyN2QyZDk1YTk=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2020-05-09T22:22:26Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2020-05-09T22:22:26Z"}, "message": "Update cargo-metadata", "tree": {"sha": "95a2ac4b2b8ab3f510305e69ffd46d98190098e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/95a2ac4b2b8ab3f510305e69ffd46d98190098e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2400d70442364769b4ae18315fc178427d2d95a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2400d70442364769b4ae18315fc178427d2d95a9", "html_url": "https://github.com/rust-lang/rust/commit/2400d70442364769b4ae18315fc178427d2d95a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2400d70442364769b4ae18315fc178427d2d95a9/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8295a9340c1fbda805497035054ead0b10c0d88e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8295a9340c1fbda805497035054ead0b10c0d88e", "html_url": "https://github.com/rust-lang/rust/commit/8295a9340c1fbda805497035054ead0b10c0d88e"}], "stats": {"total": 69, "additions": 28, "deletions": 41}, "files": [{"sha": "c185add1222973b4397d17ea5cb6609a666fcf14", "filename": "Cargo.lock", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -89,9 +89,9 @@ dependencies = [\n \n [[package]]\n name = \"cargo_metadata\"\n-version = \"0.9.1\"\n+version = \"0.10.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"46e3374c604fb39d1a2f35ed5e4a4e30e60d01fab49446e08f1b3e9a90aef202\"\n+checksum = \"b8de60b887edf6d74370fc8eb177040da4847d971d6234c7b13a6da324ef0caf\"\n dependencies = [\n  \"semver\",\n  \"serde\",\n@@ -1515,18 +1515,18 @@ checksum = \"388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3\"\n \n [[package]]\n name = \"serde\"\n-version = \"1.0.106\"\n+version = \"1.0.107\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"36df6ac6412072f67cf767ebbde4133a5b2e88e76dc6187fa7104cd16f783399\"\n+checksum = \"eba7550f2cdf88ffc23ab0f1607133486c390a8c0f89b57e589b9654ee15e04d\"\n dependencies = [\n  \"serde_derive\",\n ]\n \n [[package]]\n name = \"serde_derive\"\n-version = \"1.0.106\"\n+version = \"1.0.107\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9e549e3abf4fb8621bd1609f11dfc9f5e50320802273b12f3811a67e6716ea6c\"\n+checksum = \"10be45e22e5597d4b88afcc71f9d7bfadcd604bf0c78a3ab4582b8d2b37f39f3\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\","}, {"sha": "578a45894dbe048a52777efda0fc834a282861dc", "filename": "crates/ra_flycheck/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_flycheck%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_flycheck%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_flycheck%2FCargo.toml?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -11,7 +11,7 @@ doctest = false\n crossbeam-channel = \"0.4.0\"\n lsp-types = { version = \"0.74.0\", features = [\"proposed\"] }\n log = \"0.4.8\"\n-cargo_metadata = \"0.9.1\"\n+cargo_metadata = \"0.10.0\"\n serde_json = \"1.0.48\"\n jod-thread = \"0.1.1\"\n ra_env = { path = \"../ra_env\" }"}, {"sha": "39b02ca94d1becf38b803de286c4315aede8a5a8", "filename": "crates/ra_flycheck/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_flycheck%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_flycheck%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_flycheck%2Fsrc%2Flib.rs?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -205,6 +205,8 @@ impl FlycheckThread {\n             }\n \n             CheckEvent::Msg(Message::BuildScriptExecuted(_msg)) => {}\n+            CheckEvent::Msg(Message::BuildFinished(_)) => {}\n+            CheckEvent::Msg(Message::TextLine(_)) => {}\n             CheckEvent::Msg(Message::Unknown) => {}\n         }\n     }"}, {"sha": "bb30032785167f63f379eb3f01dd8dbb322cd83e", "filename": "crates/ra_proc_macro_srv/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_proc_macro_srv%2FCargo.toml?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -18,7 +18,7 @@ memmap = \"0.7\"\n test_utils = { path = \"../test_utils\" }\n \n [dev-dependencies]\n-cargo_metadata = \"0.9.1\"\n+cargo_metadata = \"0.10.0\"\n difference = \"2.0.0\"\n # used as proc macro test target\n-serde_derive = \"=1.0.106\"\n+serde_derive = \"1.0.106\""}, {"sha": "bc010cfe99d68e9aa96577509e2046aee28eff7c", "filename": "crates/ra_proc_macro_srv/src/tests/fixtures/test_serialize_proc_macro.txt", "status": "modified", "additions": 5, "deletions": 16, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Ffixtures%2Ftest_serialize_proc_macro.txt", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Ffixtures%2Ftest_serialize_proc_macro.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Ffixtures%2Ftest_serialize_proc_macro.txt?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -20,26 +20,15 @@ SUBTREE $\n   PUNCH   = [alone] 4294967295\n   SUBTREE {} 4294967295\n     PUNCH   # [alone] 4294967295\n-    SUBTREE [] 4294967295\n-      IDENT   allow 4294967295\n-      SUBTREE () 4294967295\n-        IDENT   unknown_lints 4294967295\n-    PUNCH   # [alone] 4294967295\n-    SUBTREE [] 4294967295\n-      IDENT   cfg_attr 4294967295\n-      SUBTREE () 4294967295\n-        IDENT   feature 4294967295\n-        PUNCH   = [alone] 4294967295\n-        LITERAL \"cargo-clippy\" 0\n-        PUNCH   , [alone] 4294967295\n-        IDENT   allow 4294967295\n-        SUBTREE () 4294967295\n-          IDENT   useless_attribute 4294967295\n-    PUNCH   # [alone] 4294967295\n     SUBTREE [] 4294967295\n       IDENT   allow 4294967295\n       SUBTREE () 4294967295\n         IDENT   rust_2018_idioms 4294967295\n+        PUNCH   , [alone] 4294967295\n+        IDENT   clippy 4294967295\n+        PUNCH   : [joint] 4294967295\n+        PUNCH   : [alone] 4294967295\n+        IDENT   useless_attribute 4294967295\n     IDENT   extern 4294967295\n     IDENT   crate 4294967295\n     IDENT   serde 4294967295"}, {"sha": "82cefbb29a77882e917c2702f9560610a53e0a9e", "filename": "crates/ra_proc_macro_srv/src/tests/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Fmod.rs?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -10,7 +10,7 @@ fn test_derive_serialize_proc_macro() {\n     assert_expand(\n         \"serde_derive\",\n         \"Serialize\",\n-        \"1.0.106\",\n+        \"1.0\",\n         r##\"struct Foo {}\"##,\n         include_str!(\"fixtures/test_serialize_proc_macro.txt\"),\n     );\n@@ -21,7 +21,7 @@ fn test_derive_serialize_proc_macro_failed() {\n     assert_expand(\n         \"serde_derive\",\n         \"Serialize\",\n-        \"1.0.106\",\n+        \"1.0\",\n         r##\"\n     struct {}\n \"##,\n@@ -37,7 +37,7 @@ SUBTREE $\n \n #[test]\n fn test_derive_proc_macro_list() {\n-    let res = list(\"serde_derive\", \"1.0.106\").join(\"\\n\");\n+    let res = list(\"serde_derive\", \"1.0\").join(\"\\n\");\n \n     assert_eq_text!(\n         &res,"}, {"sha": "71436eee08cc390166d4590a8c9081502ab6a584", "filename": "crates/ra_proc_macro_srv/src/tests/utils.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_proc_macro_srv%2Fsrc%2Ftests%2Futils.rs?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -8,7 +8,7 @@ use std::str::FromStr;\n use test_utils::assert_eq_text;\n \n mod fixtures {\n-    use cargo_metadata::{parse_messages, Message};\n+    use cargo_metadata::Message;\n     use std::process::Command;\n \n     // Use current project metadata to get the proc-macro dylib path\n@@ -19,12 +19,12 @@ mod fixtures {\n             .unwrap()\n             .stdout;\n \n-        for message in parse_messages(command.as_slice()) {\n+        for message in Message::parse_stream(command.as_slice()) {\n             match message.unwrap() {\n                 Message::CompilerArtifact(artifact) => {\n                     if artifact.target.kind.contains(&\"proc-macro\".to_string()) {\n                         let repr = format!(\"{} {}\", crate_name, version);\n-                        if artifact.package_id.repr.starts_with(&repr) {\n+                        if artifact.package_id.repr.starts_with(dbg!(&repr)) {\n                             return artifact.filenames[0].clone();\n                         }\n                     }"}, {"sha": "946deed5d189a163aaf877ada1ad9f7bd532424a", "filename": "crates/ra_project_model/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_project_model%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_project_model%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2FCargo.toml?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -11,7 +11,7 @@ doctest = false\n log = \"0.4.8\"\n rustc-hash = \"1.1.0\"\n \n-cargo_metadata = \"0.9.1\"\n+cargo_metadata = \"0.10.0\"\n \n ra_arena = { path = \"../ra_arena\" }\n ra_cfg = { path = \"../ra_cfg\" }"}, {"sha": "9152a6d9d02dbce92640c20e967303ea1f04fde3", "filename": "crates/ra_project_model/src/cargo_workspace.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2400d70442364769b4ae18315fc178427d2d95a9/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs?ref=2400d70442364769b4ae18315fc178427d2d95a9", "patch": "@@ -162,7 +162,7 @@ impl CargoWorkspace {\n             meta.current_dir(parent);\n         }\n         if let Some(target) = cargo_features.target.as_ref() {\n-            meta.other_options(&[String::from(\"--filter-platform\"), target.clone()]);\n+            meta.other_options(vec![String::from(\"--filter-platform\"), target.clone()]);\n         }\n         let meta = meta.exec().with_context(|| {\n             format!(\"Failed to run `cargo metadata --manifest-path {}`\", cargo_toml.display())\n@@ -305,19 +305,13 @@ pub fn load_extern_resources(\n \n     let mut res = ExternResources::default();\n \n-    for message in cargo_metadata::parse_messages(output.stdout.as_slice()) {\n+    for message in cargo_metadata::Message::parse_stream(output.stdout.as_slice()) {\n         if let Ok(message) = message {\n             match message {\n                 Message::BuildScriptExecuted(BuildScript { package_id, out_dir, cfgs, .. }) => {\n                     res.out_dirs.insert(package_id.clone(), out_dir);\n-                    res.cfgs.insert(\n-                        package_id,\n-                        // FIXME: Current `cargo_metadata` uses `PathBuf` instead of `String`,\n-                        // change when https://github.com/oli-obk/cargo_metadata/pulls/112 reaches crates.io\n-                        cfgs.iter().filter_map(|c| c.to_str().map(|s| s.to_owned())).collect(),\n-                    );\n+                    res.cfgs.insert(package_id, cfgs);\n                 }\n-\n                 Message::CompilerArtifact(message) => {\n                     if message.target.kind.contains(&\"proc-macro\".to_string()) {\n                         let package_id = message.package_id;\n@@ -330,6 +324,8 @@ pub fn load_extern_resources(\n                 }\n                 Message::CompilerMessage(_) => (),\n                 Message::Unknown => (),\n+                Message::BuildFinished(_) => {}\n+                Message::TextLine(_) => {}\n             }\n         }\n     }"}]}