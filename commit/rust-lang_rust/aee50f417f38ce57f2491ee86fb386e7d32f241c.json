{"sha": "aee50f417f38ce57f2491ee86fb386e7d32f241c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlZTUwZjQxN2YzOGNlNTdmMjQ5MWVlODZmYjM4NmU3ZDMyZjI0MWM=", "commit": {"author": {"name": "Trinity Pointard", "email": "trinity.pointard@gmail.com", "date": "2021-06-15T09:47:17Z"}, "committer": {"name": "Trinity Pointard", "email": "trinity.pointard@gmail.com", "date": "2021-06-15T09:47:17Z"}, "message": "fix rustdoc stack overflow on mutually recursive Deref\n\nfix #85095", "tree": {"sha": "532c5c2422f1d0de6440402dd177cf4b8114606d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/532c5c2422f1d0de6440402dd177cf4b8114606d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aee50f417f38ce57f2491ee86fb386e7d32f241c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aee50f417f38ce57f2491ee86fb386e7d32f241c", "html_url": "https://github.com/rust-lang/rust/commit/aee50f417f38ce57f2491ee86fb386e7d32f241c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aee50f417f38ce57f2491ee86fb386e7d32f241c/comments", "author": {"login": "trinity-1686a", "id": 35889323, "node_id": "MDQ6VXNlcjM1ODg5MzIz", "avatar_url": "https://avatars.githubusercontent.com/u/35889323?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trinity-1686a", "html_url": "https://github.com/trinity-1686a", "followers_url": "https://api.github.com/users/trinity-1686a/followers", "following_url": "https://api.github.com/users/trinity-1686a/following{/other_user}", "gists_url": "https://api.github.com/users/trinity-1686a/gists{/gist_id}", "starred_url": "https://api.github.com/users/trinity-1686a/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trinity-1686a/subscriptions", "organizations_url": "https://api.github.com/users/trinity-1686a/orgs", "repos_url": "https://api.github.com/users/trinity-1686a/repos", "events_url": "https://api.github.com/users/trinity-1686a/events{/privacy}", "received_events_url": "https://api.github.com/users/trinity-1686a/received_events", "type": "User", "site_admin": false}, "committer": {"login": "trinity-1686a", "id": 35889323, "node_id": "MDQ6VXNlcjM1ODg5MzIz", "avatar_url": "https://avatars.githubusercontent.com/u/35889323?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trinity-1686a", "html_url": "https://github.com/trinity-1686a", "followers_url": "https://api.github.com/users/trinity-1686a/followers", "following_url": "https://api.github.com/users/trinity-1686a/following{/other_user}", "gists_url": "https://api.github.com/users/trinity-1686a/gists{/gist_id}", "starred_url": "https://api.github.com/users/trinity-1686a/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trinity-1686a/subscriptions", "organizations_url": "https://api.github.com/users/trinity-1686a/orgs", "repos_url": "https://api.github.com/users/trinity-1686a/repos", "events_url": "https://api.github.com/users/trinity-1686a/events{/privacy}", "received_events_url": "https://api.github.com/users/trinity-1686a/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9089771daf6b1f1824446cca3306d7c18084eae0", "url": "https://api.github.com/repos/rust-lang/rust/commits/9089771daf6b1f1824446cca3306d7c18084eae0", "html_url": "https://github.com/rust-lang/rust/commit/9089771daf6b1f1824446cca3306d7c18084eae0"}], "stats": {"total": 42, "additions": 39, "deletions": 3}, "files": [{"sha": "7e53cf231a14efa72f2cce300ca92fcc2a30aa09", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/aee50f417f38ce57f2491ee86fb386e7d32f241c/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aee50f417f38ce57f2491ee86fb386e7d32f241c/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=aee50f417f38ce57f2491ee86fb386e7d32f241c", "patch": "@@ -1960,13 +1960,19 @@ fn sidebar_assoc_items(cx: &Context<'_>, out: &mut Buffer, it: &clean::Item) {\n                 .filter(|i| i.inner_impl().trait_.is_some())\n                 .find(|i| i.inner_impl().trait_.def_id_full(cache) == cx.cache.deref_trait_did)\n             {\n-                sidebar_deref_methods(cx, out, impl_, v);\n+                sidebar_deref_methods(cx, out, impl_, v, FxHashSet::default());\n             }\n         }\n     }\n }\n \n-fn sidebar_deref_methods(cx: &Context<'_>, out: &mut Buffer, impl_: &Impl, v: &Vec<Impl>) {\n+fn sidebar_deref_methods(\n+    cx: &Context<'_>,\n+    out: &mut Buffer,\n+    impl_: &Impl,\n+    v: &Vec<Impl>,\n+    mut already_seen: FxHashSet<DefId>,\n+) {\n     let c = cx.cache();\n \n     debug!(\"found Deref: {:?}\", impl_);\n@@ -2032,7 +2038,15 @@ fn sidebar_deref_methods(cx: &Context<'_>, out: &mut Buffer, impl_: &Impl, v: &V\n                     .filter(|i| i.inner_impl().trait_.is_some())\n                     .find(|i| i.inner_impl().trait_.def_id_full(c) == c.deref_trait_did)\n                 {\n-                    sidebar_deref_methods(cx, out, target_deref_impl, target_impls);\n+                    if already_seen.insert(target_did.clone()) {\n+                        sidebar_deref_methods(\n+                            cx,\n+                            out,\n+                            target_deref_impl,\n+                            target_impls,\n+                            already_seen,\n+                        );\n+                    }\n                 }\n             }\n         }"}, {"sha": "5c4a1da9e596d13355434657e2662e5a8a289c22", "filename": "src/test/rustdoc/issue-85095.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/aee50f417f38ce57f2491ee86fb386e7d32f241c/src%2Ftest%2Frustdoc%2Fissue-85095.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aee50f417f38ce57f2491ee86fb386e7d32f241c/src%2Ftest%2Frustdoc%2Fissue-85095.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-85095.rs?ref=aee50f417f38ce57f2491ee86fb386e7d32f241c", "patch": "@@ -0,0 +1,22 @@\n+use std::ops::Deref;\n+\n+pub struct A;\n+pub struct B;\n+\n+// @has issue_85095/struct.A.html '//code' 'impl Deref for A'\n+impl Deref for A {\n+    type Target = B;\n+\n+    fn deref(&self) -> &Self::Target {\n+        panic!()\n+    }\n+}\n+\n+// @has issue_85095/struct.B.html '//code' 'impl Deref for B'\n+impl Deref for B {\n+    type Target = A;\n+\n+    fn deref(&self) -> &Self::Target {\n+        panic!()\n+    }\n+}"}]}