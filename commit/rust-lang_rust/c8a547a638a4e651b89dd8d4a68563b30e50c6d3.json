{"sha": "c8a547a638a4e651b89dd8d4a68563b30e50c6d3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4YTU0N2E2MzhhNGU2NTFiODlkZDhkNGE2ODU2M2IzMGU1MGM2ZDM=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2016-01-08T14:45:26Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2016-01-08T14:45:26Z"}, "message": "Also store MIR of closures in crate metadata.", "tree": {"sha": "175fc7c975407ba3d378a43967e4e63b921f8ceb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/175fc7c975407ba3d378a43967e4e63b921f8ceb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c8a547a638a4e651b89dd8d4a68563b30e50c6d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c8a547a638a4e651b89dd8d4a68563b30e50c6d3", "html_url": "https://github.com/rust-lang/rust/commit/c8a547a638a4e651b89dd8d4a68563b30e50c6d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c8a547a638a4e651b89dd8d4a68563b30e50c6d3/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "64a8ffeffaae2fe72994fb0832ae525346b8a3c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/64a8ffeffaae2fe72994fb0832ae525346b8a3c0", "html_url": "https://github.com/rust-lang/rust/commit/64a8ffeffaae2fe72994fb0832ae525346b8a3c0"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "22da853dfedb5325902a4b0d629f56a3940fc7d1", "filename": "src/librustc_metadata/encoder.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c8a547a638a4e651b89dd8d4a68563b30e50c6d3/src%2Flibrustc_metadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8a547a638a4e651b89dd8d4a68563b30e50c6d3/src%2Flibrustc_metadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fencoder.rs?ref=c8a547a638a4e651b89dd8d4a68563b30e50c6d3", "patch": "@@ -806,18 +806,18 @@ fn encode_inlined_item(ecx: &EncodeContext,\n     let eii: &mut EncodeInlinedItem = &mut *eii;\n     eii(ecx, rbml_w, ii);\n \n-    encode_mir(ecx, rbml_w, ii);\n-}\n-\n-fn encode_mir(ecx: &EncodeContext, rbml_w: &mut Encoder, ii: InlinedItemRef) {\n-    let id = match ii {\n+    let node_id = match ii {\n         InlinedItemRef::Item(item) => item.id,\n         InlinedItemRef::TraitItem(_, trait_item) => trait_item.id,\n         InlinedItemRef::ImplItem(_, impl_item) => impl_item.id,\n         InlinedItemRef::Foreign(foreign_item) => foreign_item.id\n     };\n \n-    if let Some(mir) = ecx.mir_map.get(&id) {\n+    encode_mir(ecx, rbml_w, node_id);\n+}\n+\n+fn encode_mir(ecx: &EncodeContext, rbml_w: &mut Encoder, node_id: NodeId) {\n+    if let Some(mir) = ecx.mir_map.get(&node_id) {\n         rbml_w.start_tag(tag_mir as usize);\n         rbml_w.emit_opaque(|opaque_encoder| {\n             tls::enter_encoding_context(ecx, opaque_encoder, |_, opaque_encoder| {\n@@ -1436,6 +1436,9 @@ fn my_visit_expr(expr: &hir::Expr,\n \n             ecx.tcx.map.with_path(expr.id, |path| encode_path(rbml_w, path));\n \n+            assert!(ecx.mir_map.contains_key(&expr.id));\n+            encode_mir(ecx, rbml_w, expr.id);\n+\n             rbml_w.end_tag();\n         }\n         _ => { }"}]}