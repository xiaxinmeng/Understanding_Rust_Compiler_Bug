{"sha": "89c36194db0e9ed60986f8490e8a2820ddcf064c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5YzM2MTk0ZGIwZTllZDYwOTg2Zjg0OTBlOGEyODIwZGRjZjA2NGM=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2019-08-09T11:18:09Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2019-08-09T11:18:09Z"}, "message": "Force single thread mode for libtest", "tree": {"sha": "fb6e674c0ec2fb5ada86117485afff7903dd0663", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fb6e674c0ec2fb5ada86117485afff7903dd0663"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/89c36194db0e9ed60986f8490e8a2820ddcf064c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/89c36194db0e9ed60986f8490e8a2820ddcf064c", "html_url": "https://github.com/rust-lang/rust/commit/89c36194db0e9ed60986f8490e8a2820ddcf064c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/89c36194db0e9ed60986f8490e8a2820ddcf064c/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dbac2192072a2a8b964be9858d06570da1cc86ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbac2192072a2a8b964be9858d06570da1cc86ba", "html_url": "https://github.com/rust-lang/rust/commit/dbac2192072a2a8b964be9858d06570da1cc86ba"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "19cead46ff718891c0d75ec1e76e44999adbe0c9", "filename": "patches/0018-test-Force-single-thread-mode.patch", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/89c36194db0e9ed60986f8490e8a2820ddcf064c/patches%2F0018-test-Force-single-thread-mode.patch", "raw_url": "https://github.com/rust-lang/rust/raw/89c36194db0e9ed60986f8490e8a2820ddcf064c/patches%2F0018-test-Force-single-thread-mode.patch", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/patches%2F0018-test-Force-single-thread-mode.patch?ref=89c36194db0e9ed60986f8490e8a2820ddcf064c", "patch": "@@ -0,0 +1,34 @@\n+From e275a6ac96bedda2d57296914f2bb736e1e4154c Mon Sep 17 00:00:00 2001\n+From: bjorn3 <bjorn3@users.noreply.github.com>\n+Date: Fri, 9 Aug 2019 13:16:55 +0200\n+Subject: [PATCH] [test] Force single thread mode\n+\n+---\n+ src/libtest/lib.rs | 11 +----------\n+ 1 file changed, 1 insertion(+), 10 deletions(-)\n+\n+diff --git a/src/libtest/lib.rs b/src/libtest/lib.rs\n+index 8d74d9a..c7a3c23 100644\n+--- a/src/libtest/lib.rs\n++++ b/src/libtest/lib.rs\n+@@ -1419,16 +1419,7 @@ pub fn run_test(\n+                 .unwrap();\n+         };\n+ \n+-        // If the platform is single-threaded we're just going to run\n+-        // the test synchronously, regardless of the concurrency\n+-        // level.\n+-        let supports_threads = !cfg!(target_os = \"emscripten\") && !cfg!(target_arch = \"wasm32\");\n+-        if concurrency == Concurrent::Yes && supports_threads {\n+-            let cfg = thread::Builder::new().name(name.as_slice().to_owned());\n+-            cfg.spawn(runtest).unwrap();\n+-        } else {\n+-            runtest();\n+-        }\n++        runtest();\n+     }\n+ \n+     match testfn {\n+-- \n+2.20.1\n+"}]}