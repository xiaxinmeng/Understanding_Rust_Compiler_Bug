{"sha": "3011538b80a52aedb2d7374798ffa35ea742d475", "node_id": "C_kwDOAAsO6NoAKDMwMTE1MzhiODBhNTJhZWRiMmQ3Mzc0Nzk4ZmZhMzVlYTc0MmQ0NzU", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-10-11T09:37:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-11T09:37:55Z"}, "message": "Rollup merge of #102898 - notriddle:notriddle/sidebar-block, r=GuillaumeGomez\n\nrustdoc: remove unneeded `<div>` wrapper from sidebar DOM\n\nWhen this was added, the sidebar had a bit more complex style. It can be removed, now.\n\nPreview: https://notriddle.com/notriddle-rustdoc-demos/sidebar-block/std/index.html", "tree": {"sha": "5003688052141d525b0e9c626a1e24c4c8fc916d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5003688052141d525b0e9c626a1e24c4c8fc916d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3011538b80a52aedb2d7374798ffa35ea742d475", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjRTlzCRBK7hj4Ov3rIwAACw0IAJadXcsonkvoFfQ5HV0Gfx5E\nmeNa5XXF/seLpcE6B0+ZmBaiFkJZVVzgyV2V+qpqqA+46NLq7jZkwfA6V4Ky+CPb\nFR/r1NwA9srZXhh2zBbEtrcZVCOqBbVyVkwzwYLeqPGuYDexq6Bh3pj+N62XYn3P\n1fymF3iVKmX51g8lPLiCsExQ3+6+gzxZCprFtQHFmBhTqU6awdXRRjSBOqcU30El\njxf7w2OWnN3uXpsefYlcMXPfXDXSlERYZMt8miGqBe/gDq38AR437rxa8HtHbsbn\nJbuehBuWZysxXaE+O+oaOh6xe3V9p+8Fxmg5zg9+IKztP0NfbiY3JXTLXaejzUE=\n=ZEgf\n-----END PGP SIGNATURE-----\n", "payload": "tree 5003688052141d525b0e9c626a1e24c4c8fc916d\nparent 98764c0c7292d866d795f69ccd286d0599e06361\nparent 44f466cb08650a721d06dece85385506633d55fc\nauthor Yuki Okushi <jtitor@2k36.org> 1665481075 +0900\ncommitter GitHub <noreply@github.com> 1665481075 +0900\n\nRollup merge of #102898 - notriddle:notriddle/sidebar-block, r=GuillaumeGomez\n\nrustdoc: remove unneeded `<div>` wrapper from sidebar DOM\n\nWhen this was added, the sidebar had a bit more complex style. It can be removed, now.\n\nPreview: https://notriddle.com/notriddle-rustdoc-demos/sidebar-block/std/index.html\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3011538b80a52aedb2d7374798ffa35ea742d475", "html_url": "https://github.com/rust-lang/rust/commit/3011538b80a52aedb2d7374798ffa35ea742d475", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3011538b80a52aedb2d7374798ffa35ea742d475/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98764c0c7292d866d795f69ccd286d0599e06361", "url": "https://api.github.com/repos/rust-lang/rust/commits/98764c0c7292d866d795f69ccd286d0599e06361", "html_url": "https://github.com/rust-lang/rust/commit/98764c0c7292d866d795f69ccd286d0599e06361"}, {"sha": "44f466cb08650a721d06dece85385506633d55fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/44f466cb08650a721d06dece85385506633d55fc", "html_url": "https://github.com/rust-lang/rust/commit/44f466cb08650a721d06dece85385506633d55fc"}], "stats": {"total": 83, "additions": 35, "deletions": 48}, "files": [{"sha": "1e162bf314b8701ab08475797834aae2e35ccaf7", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 7, "deletions": 17, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=3011538b80a52aedb2d7374798ffa35ea742d475", "patch": "@@ -1853,12 +1853,12 @@ fn print_sidebar(cx: &Context<'_>, it: &clean::Item, buffer: &mut Buffer) {\n \n     buffer.write_str(\"<div class=\\\"sidebar-elems\\\">\");\n     if it.is_crate() {\n-        write!(buffer, \"<div class=\\\"block\\\"><ul>\");\n+        write!(buffer, \"<ul class=\\\"block\\\">\");\n         if let Some(ref version) = cx.cache().crate_version {\n             write!(buffer, \"<li class=\\\"version\\\">Version {}</li>\", Escape(version));\n         }\n         write!(buffer, \"<li><a id=\\\"all-types\\\" href=\\\"all.html\\\">All Items</a></li>\");\n-        buffer.write_str(\"</ul></div>\");\n+        buffer.write_str(\"</ul>\");\n     }\n \n     match *it.kind {\n@@ -2258,8 +2258,7 @@ fn extract_for_impl_name(item: &clean::Item, cx: &Context<'_>) -> Option<(String\n     }\n }\n \n-/// Don't call this function directly!!! Use `print_sidebar_title` or `print_sidebar_block` instead!\n-fn print_sidebar_title_inner(buf: &mut Buffer, id: &str, title: &str) {\n+fn print_sidebar_title(buf: &mut Buffer, id: &str, title: &str) {\n     write!(\n         buf,\n         \"<h3 class=\\\"sidebar-title\\\">\\\n@@ -2269,25 +2268,18 @@ fn print_sidebar_title_inner(buf: &mut Buffer, id: &str, title: &str) {\n     );\n }\n \n-fn print_sidebar_title(buf: &mut Buffer, id: &str, title: &str) {\n-    buf.push_str(\"<div class=\\\"block\\\">\");\n-    print_sidebar_title_inner(buf, id, title);\n-    buf.push_str(\"</div>\");\n-}\n-\n fn print_sidebar_block(\n     buf: &mut Buffer,\n     id: &str,\n     title: &str,\n     items: impl Iterator<Item = impl fmt::Display>,\n ) {\n-    buf.push_str(\"<div class=\\\"block\\\">\");\n-    print_sidebar_title_inner(buf, id, title);\n-    buf.push_str(\"<ul>\");\n+    print_sidebar_title(buf, id, title);\n+    buf.push_str(\"<ul class=\\\"block\\\">\");\n     for item in items {\n         write!(buf, \"<li>{}</li>\", item);\n     }\n-    buf.push_str(\"</ul></div>\");\n+    buf.push_str(\"</ul>\");\n }\n \n fn sidebar_trait(cx: &Context<'_>, buf: &mut Buffer, it: &clean::Item, t: &clean::Trait) {\n@@ -2676,9 +2668,7 @@ pub(crate) fn sidebar_module_like(buf: &mut Buffer, item_sections_in_use: FxHash\n         write!(\n             buf,\n             \"<section>\\\n-                 <div class=\\\"block\\\">\\\n-                     <ul>{}</ul>\\\n-                 </div>\\\n+                 <ul class=\\\"block\\\">{}</ul>\\\n              </section>\",\n             sidebar\n         );"}, {"sha": "661aed71298d98ae2ea1bc2f50d9ce2e5a246973", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=3011538b80a52aedb2d7374798ffa35ea742d475", "patch": "@@ -501,13 +501,14 @@ img {\n \twidth: 100px;\n }\n \n-.block ul, .block li {\n+ul.block, .block li {\n \tpadding: 0;\n \tmargin: 0;\n \tlist-style: none;\n }\n \n .block a,\n+.sidebar h3 a,\n h2.location a {\n \tdisplay: block;\n \tpadding: 0.25rem;\n@@ -767,7 +768,7 @@ h2.small-section-header > .anchor {\n \ttext-decoration: underline;\n }\n \n-.block a.current.crate { font-weight: 500; }\n+.crate.block a.current { font-weight: 500; }\n \n /*  In most contexts we use `overflow-wrap: anywhere` to ensure that we can wrap\n \tas much as needed on mobile (see"}, {"sha": "0180c0ead8d3924c54c59a3f14e66024a883031f", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 11, "deletions": 15, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=3011538b80a52aedb2d7374798ffa35ea742d475", "patch": "@@ -442,12 +442,10 @@ function loadCss(cssFileName) {\n                 return;\n             }\n \n-            const div = document.createElement(\"div\");\n-            div.className = \"block \" + shortty;\n             const h3 = document.createElement(\"h3\");\n             h3.innerHTML = `<a href=\"index.html#${id}\">${longty}</a>`;\n-            div.appendChild(h3);\n             const ul = document.createElement(\"ul\");\n+            ul.className = \"block \" + shortty;\n \n             for (const item of filtered) {\n                 const name = item[0];\n@@ -473,8 +471,8 @@ function loadCss(cssFileName) {\n                 li.appendChild(link);\n                 ul.appendChild(li);\n             }\n-            div.appendChild(ul);\n-            sidebar.appendChild(div);\n+            sidebar.appendChild(h3);\n+            sidebar.appendChild(ul);\n         }\n \n         if (sidebar) {\n@@ -592,27 +590,25 @@ function loadCss(cssFileName) {\n             return;\n         }\n         // Draw a convenient sidebar of known crates if we have a listing\n-        const div = document.createElement(\"div\");\n-        div.className = \"block crate\";\n-        div.innerHTML = \"<h3>Crates</h3>\";\n+        const h3 = document.createElement(\"h3\");\n+        h3.innerHTML = \"Crates\";\n         const ul = document.createElement(\"ul\");\n-        div.appendChild(ul);\n+        ul.className = \"block crate\";\n \n         for (const crate of window.ALL_CRATES) {\n-            let klass = \"crate\";\n-            if (window.rootPath !== \"./\" && crate === window.currentCrate) {\n-                klass += \" current\";\n-            }\n             const link = document.createElement(\"a\");\n             link.href = window.rootPath + crate + \"/index.html\";\n-            link.className = klass;\n+            if (window.rootPath !== \"./\" && crate === window.currentCrate) {\n+                link.className = \"current\";\n+            }\n             link.textContent = crate;\n \n             const li = document.createElement(\"li\");\n             li.appendChild(link);\n             ul.appendChild(li);\n         }\n-        sidebarElems.appendChild(div);\n+        sidebarElems.appendChild(h3);\n+        sidebarElems.appendChild(ul);\n     }\n \n "}, {"sha": "9a77d8bbd15417a4b5b1b70f504f82d8e38742b1", "filename": "src/test/rustdoc-gui/headings.goml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fheadings.goml?ref=3011538b80a52aedb2d7374798ffa35ea742d475", "patch": "@@ -106,8 +106,8 @@ assert-css: (\"h6#sub-heading-for-enum-impl-item-doc\", {\"border-bottom-width\": \"0\n assert-css: (\"h6#sub-sub-heading-for-enum-impl-item-doc\", {\"font-size\": \"14px\"})\n assert-css: (\"h6#sub-sub-heading-for-enum-impl-item-doc\", {\"border-bottom-width\": \"0px\"})\n \n-assert-text: (\".sidebar .mod h3\", \"Modules\")\n-assert-css: (\".sidebar .mod h3\", {\"border-bottom-width\": \"0px\"}, ALL)\n+assert-text: (\"//ul[@class='block mod']/preceding-sibling::h3\", \"Modules\")\n+assert-css: (\"//ul[@class='block mod']/preceding-sibling::h3\", {\"border-bottom-width\": \"0px\"}, ALL)\n \n goto: \"file://\" + |DOC_PATH| + \"/test_docs/union.HeavilyDocumentedUnion.html\"\n "}, {"sha": "54193234af9dd50abd582876e1346320dff0bac3", "filename": "src/test/rustdoc-gui/sidebar.goml", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml", "raw_url": "https://github.com/rust-lang/rust/raw/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml?ref=3011538b80a52aedb2d7374798ffa35ea742d475", "patch": "@@ -12,7 +12,7 @@ assert-count: (\".sidebar .location\", 1)\n assert-text: (\"#all-types\", \"All Items\")\n assert-css: (\"#all-types\", {\"color\": \"rgb(53, 109, 164)\"})\n // We check that we have the crates list and that the \"current\" on is \"test_docs\".\n-assert-text: (\".sidebar-elems .crate > ul > li > a.current\", \"test_docs\")\n+assert-text: (\".sidebar-elems ul.crate > li > a.current\", \"test_docs\")\n // And we're also supposed to have the list of items in the current module.\n assert-text: (\".sidebar-elems section ul > li:nth-child(1)\", \"Re-exports\")\n assert-text: (\".sidebar-elems section ul > li:nth-child(2)\", \"Modules\")\n@@ -41,21 +41,21 @@ assert-property: (\"html\", {\"scrollTop\": \"0\"})\n // We now go back to the crate page to click on the \"lib2\" crate link.\n goto: \"file://\" + |DOC_PATH| + \"/test_docs/index.html\"\n assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n-assert-css: (\".sidebar-elems .crate > ul > li:first-child > a\", {\"color\": \"rgb(53, 109, 164)\"})\n-click: \".sidebar-elems .crate > ul > li:first-child > a\"\n+assert-css: (\".sidebar-elems ul.crate > li:first-child > a\", {\"color\": \"rgb(53, 109, 164)\"})\n+click: \".sidebar-elems ul.crate > li:first-child > a\"\n \n // PAGE: lib2/index.html\n goto: \"file://\" + |DOC_PATH| + \"/lib2/index.html\"\n assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n assert-text: (\".sidebar > .location\", \"Crate lib2\")\n // We check that we have the crates list and that the \"current\" on is now \"lib2\".\n-assert-text: (\".sidebar-elems .crate > ul > li > a.current\", \"lib2\")\n+assert-text: (\".sidebar-elems ul.crate > li > a.current\", \"lib2\")\n // We now go to the \"foobar\" function page.\n-assert-text: (\".sidebar-elems > section .block ul > li:nth-child(1)\", \"Modules\")\n-assert-text: (\".sidebar-elems > section .block ul > li:nth-child(2)\", \"Structs\")\n-assert-text: (\".sidebar-elems > section .block ul > li:nth-child(3)\", \"Traits\")\n-assert-text: (\".sidebar-elems > section .block ul > li:nth-child(4)\", \"Functions\")\n-assert-text: (\".sidebar-elems > section .block ul > li:nth-child(5)\", \"Type Definitions\")\n+assert-text: (\".sidebar-elems > section ul.block > li:nth-child(1)\", \"Modules\")\n+assert-text: (\".sidebar-elems > section ul.block > li:nth-child(2)\", \"Structs\")\n+assert-text: (\".sidebar-elems > section ul.block > li:nth-child(3)\", \"Traits\")\n+assert-text: (\".sidebar-elems > section ul.block > li:nth-child(4)\", \"Functions\")\n+assert-text: (\".sidebar-elems > section ul.block > li:nth-child(5)\", \"Type Definitions\")\n assert-text: (\"#functions + .item-table .item-left > a\", \"foobar\")\n click: \"#functions + .item-table .item-left > a\"\n \n@@ -90,7 +90,7 @@ assert-property: (\".sidebar-elems section .block li > a\", {\"offsetHeight\": 29})\n // appropriate anchor in index.html.\n goto: \"file://\" + |DOC_PATH| + \"/test_docs/struct.Foo.html\"\n assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n-click: \".block.mod h3 a\"\n+click: \"//ul[@class='block mod']/preceding-sibling::h3/a\"\n // PAGE: index.html\n assert-css: (\"#modules\", {\"background-color\": \"rgb(253, 255, 211)\"})\n "}, {"sha": "782198956a0f353aecd7ea267b7a06d6a9b99db9", "filename": "src/test/rustdoc/strip-enum-variant.no-not-shown.html", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc%2Fstrip-enum-variant.no-not-shown.html", "raw_url": "https://github.com/rust-lang/rust/raw/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc%2Fstrip-enum-variant.no-not-shown.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fstrip-enum-variant.no-not-shown.html?ref=3011538b80a52aedb2d7374798ffa35ea742d475", "patch": "@@ -1 +1 @@\n-<ul><li><a href=\"#variant.Shown\">Shown</a></li></ul>\n\\ No newline at end of file\n+<ul class=\"block\"><li><a href=\"#variant.Shown\">Shown</a></li></ul>\n\\ No newline at end of file"}, {"sha": "8753a7dc613a855b6012028a768ce21524403862", "filename": "src/test/rustdoc/strip-enum-variant.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc%2Fstrip-enum-variant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3011538b80a52aedb2d7374798ffa35ea742d475/src%2Ftest%2Frustdoc%2Fstrip-enum-variant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fstrip-enum-variant.rs?ref=3011538b80a52aedb2d7374798ffa35ea742d475", "patch": "@@ -3,7 +3,7 @@\n // @!has - '//code' 'NotShown'\n // @has - '//code' '// some variants omitted'\n // Also check that `NotShown` isn't displayed in the sidebar.\n-// @snapshot no-not-shown - '//*[@class=\"sidebar-elems\"]/section/*[@class=\"block\"][1]/ul'\n+// @snapshot no-not-shown - '//*[@class=\"sidebar-elems\"]/section/*[@class=\"block\"][1]'\n pub enum MyThing {\n     Shown,\n     #[doc(hidden)]"}]}