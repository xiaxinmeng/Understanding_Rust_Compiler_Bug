{"sha": "3fa99f9cf5c68b106e100961c8c63930c2f7f471", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmYTk5ZjljZjVjNjhiMTA2ZTEwMDk2MWM4YzYzOTMwYzJmN2Y0NzE=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-10-16T04:54:08Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-10-16T05:27:46Z"}, "message": "Use subgraphs to render multiple MIR bodies", "tree": {"sha": "e3b7aa7f8d9e9c3e8627dc3be328f124cbc4008f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e3b7aa7f8d9e9c3e8627dc3be328f124cbc4008f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3fa99f9cf5c68b106e100961c8c63930c2f7f471", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3fa99f9cf5c68b106e100961c8c63930c2f7f471", "html_url": "https://github.com/rust-lang/rust/commit/3fa99f9cf5c68b106e100961c8c63930c2f7f471", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3fa99f9cf5c68b106e100961c8c63930c2f7f471/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cbf69296cb217633e1ca4da4eb65437ae4b23759", "url": "https://api.github.com/repos/rust-lang/rust/commits/cbf69296cb217633e1ca4da4eb65437ae4b23759", "html_url": "https://github.com/rust-lang/rust/commit/cbf69296cb217633e1ca4da4eb65437ae4b23759"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "ff2946d3a690e1cdbbe56a118d354c5957b34b47", "filename": "src/librustc_mir/util/graphviz.rs", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/3fa99f9cf5c68b106e100961c8c63930c2f7f471/src%2Flibrustc_mir%2Futil%2Fgraphviz.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fa99f9cf5c68b106e100961c8c63930c2f7f471/src%2Flibrustc_mir%2Futil%2Fgraphviz.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fgraphviz.rs?ref=3fa99f9cf5c68b106e100961c8c63930c2f7f471", "patch": "@@ -16,10 +16,22 @@ pub fn write_mir_graphviz<W>(\n where\n     W: Write,\n {\n-    for def_id in dump_mir_def_ids(tcx, single) {\n+    let def_ids = dump_mir_def_ids(tcx, single);\n+\n+    let use_subgraphs = def_ids.len() > 1;\n+    if use_subgraphs {\n+        writeln!(w, \"digraph __crate__ {{\")?;\n+    }\n+\n+    for def_id in def_ids {\n         let body = &tcx.optimized_mir(def_id);\n-        write_mir_fn_graphviz(tcx, def_id, body, w)?;\n+        write_mir_fn_graphviz(tcx, def_id, body, use_subgraphs, w)?;\n     }\n+\n+    if use_subgraphs {\n+        writeln!(w, \"}}\")?;\n+    }\n+\n     Ok(())\n }\n \n@@ -38,12 +50,16 @@ pub fn write_mir_fn_graphviz<'tcx, W>(\n     tcx: TyCtxt<'tcx>,\n     def_id: DefId,\n     body: &Body<'_>,\n+    subgraph: bool,\n     w: &mut W,\n ) -> io::Result<()>\n where\n     W: Write,\n {\n-    writeln!(w, \"digraph Mir_{} {{\", graphviz_safe_def_name(def_id))?;\n+    let kind = if subgraph { \"subgraph\" } else { \"digraph\" };\n+    let cluster = if subgraph { \"cluster_\" } else { \"\" }; // Prints a border around MIR\n+    let def_name = graphviz_safe_def_name(def_id);\n+    writeln!(w, \"{} {}Mir_{} {{\", kind, cluster, def_name)?;\n \n     // Global graph properties\n     writeln!(w, r#\"    graph [fontname=\"monospace\"];\"#)?;"}, {"sha": "89f298846d2f5ad6bc909384279d9d7922231d42", "filename": "src/librustc_mir/util/pretty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3fa99f9cf5c68b106e100961c8c63930c2f7f471/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fa99f9cf5c68b106e100961c8c63930c2f7f471/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fpretty.rs?ref=3fa99f9cf5c68b106e100961c8c63930c2f7f471", "patch": "@@ -145,7 +145,7 @@ fn dump_matched_mir_node<'tcx, F>(\n         let _: io::Result<()> = try {\n             let mut file =\n                 create_dump_file(tcx, \"dot\", pass_num, pass_name, disambiguator, source)?;\n-            write_mir_fn_graphviz(tcx, source.def_id(), body, &mut file)?;\n+            write_mir_fn_graphviz(tcx, source.def_id(), body, false, &mut file)?;\n         };\n     }\n }"}]}