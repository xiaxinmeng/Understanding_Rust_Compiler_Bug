{"sha": "5ffff5ccf2c67ce08104011cae65edb4907f5739", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmZmZmNWNjZjJjNjdjZTA4MTA0MDExY2FlNjVlZGI0OTA3ZjU3Mzk=", "commit": {"author": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2021-08-22T00:56:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-08-22T00:56:29Z"}, "message": "Rollup merge of #88072 - kit-981:feature/build-ios-toolchain-on-linux, r=Mark-Simulacrum\n\nAllow the iOS toolchain to be built on Linux\n\nThe iOS toolchain can be built on Linux with minor changes. The compilation will invoke `xcrun` to find the path to the iPhone SDK but a fake `xcrun` executable can be used.\n\n```\n#!/bin/sh\necho \"/path/to/sdk\"\n```\n\nThe iOS toolchain can then be built and linked with rustup.\n\n```\n$ ./x.py build --stage 2 --host x86_64-unknown-linux-gnu \\\n  \t --target aarch64-apple-ios\n$ rustup toolchain link stage1 build/x86_64-unknown-linux-gnu/stage1\n```\n\nIt's possible to take this toolchain and compile an iOS executable with it. This requires the ld64 linker and an iOS SDK. The ld64 linker can be taken from [cctools](https://github.com/tpoechtrager/cctools-port). A project's .cargo/config can then be edited to use the linker for this target.\n\n```\n[target.aarch64-apple-ios]\nlinker = \"/path/to/cctools/bin/arm-apple-darwin-ld\"\nrustflags = [\n    \"-C\",\n    \"\"\"\nlink-args=\n    -F/path/to/sdk/System/Library/Frameworks\n    -L/path/to/sdk/usr/lib\n    -L/path/to/sdk/usr/lib/system/\n    -adhoc_codesign\n    \"\"\",\n]\n```", "tree": {"sha": "d753020aaba8a13432bf24669cea533ef600e2cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d753020aaba8a13432bf24669cea533ef600e2cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ffff5ccf2c67ce08104011cae65edb4907f5739", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhIaC9CRBK7hj4Ov3rIwAAD74IABMyyUPj8iDTwv74lMqvC4lU\nzvdwyJLE7OT/71u4a2lshH3VJ3SXR6C9EdxvfYFK+0l5bXHSd9vDLyAVFyEE+DZD\n8iXTMNYuHkrlb60FH/Saa4oO2BJ/8hu7xlJ9cgp7XQ90THwOUyIgYvK2ir8XzsMg\njFStwi/0zMg/Ha/y7TwN7awUSwGmAzFLa4lnH5E48fOalIxblSTgYrrNwgbwtaav\nrcPlC5mreCXb7OTR+mxlOEx5IIDGfCEOgn8g2RGjpFvfqhMxjY1pNTv65zq3xtDL\nvubzg6TQrjyvWyRa65IzmIOWsl/YX2S1kqYiExPNOb+ua4pXZB7nnUiSTZYQvNs=\n=Cw5y\n-----END PGP SIGNATURE-----\n", "payload": "tree d753020aaba8a13432bf24669cea533ef600e2cb\nparent 9e8b143e6aa8af519108cb3375860acdf82ed963\nparent 79e402e9e0e87a5e5a174c012dfded53dec85769\nauthor Jack Huey <31162821+jackh726@users.noreply.github.com> 1629593789 -0400\ncommitter GitHub <noreply@github.com> 1629593789 -0400\n\nRollup merge of #88072 - kit-981:feature/build-ios-toolchain-on-linux, r=Mark-Simulacrum\n\nAllow the iOS toolchain to be built on Linux\n\nThe iOS toolchain can be built on Linux with minor changes. The compilation will invoke `xcrun` to find the path to the iPhone SDK but a fake `xcrun` executable can be used.\n\n```\n#!/bin/sh\necho \"/path/to/sdk\"\n```\n\nThe iOS toolchain can then be built and linked with rustup.\n\n```\n$ ./x.py build --stage 2 --host x86_64-unknown-linux-gnu \\\n  \t --target aarch64-apple-ios\n$ rustup toolchain link stage1 build/x86_64-unknown-linux-gnu/stage1\n```\n\nIt's possible to take this toolchain and compile an iOS executable with it. This requires the ld64 linker and an iOS SDK. The ld64 linker can be taken from [cctools](https://github.com/tpoechtrager/cctools-port). A project's .cargo/config can then be edited to use the linker for this target.\n\n```\n[target.aarch64-apple-ios]\nlinker = \"/path/to/cctools/bin/arm-apple-darwin-ld\"\nrustflags = [\n    \"-C\",\n    \"\"\"\nlink-args=\n    -F/path/to/sdk/System/Library/Frameworks\n    -L/path/to/sdk/usr/lib\n    -L/path/to/sdk/usr/lib/system/\n    -adhoc_codesign\n    \"\"\",\n]\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ffff5ccf2c67ce08104011cae65edb4907f5739", "html_url": "https://github.com/rust-lang/rust/commit/5ffff5ccf2c67ce08104011cae65edb4907f5739", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ffff5ccf2c67ce08104011cae65edb4907f5739/comments", "author": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e8b143e6aa8af519108cb3375860acdf82ed963", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e8b143e6aa8af519108cb3375860acdf82ed963", "html_url": "https://github.com/rust-lang/rust/commit/9e8b143e6aa8af519108cb3375860acdf82ed963"}, {"sha": "79e402e9e0e87a5e5a174c012dfded53dec85769", "url": "https://api.github.com/repos/rust-lang/rust/commits/79e402e9e0e87a5e5a174c012dfded53dec85769", "html_url": "https://github.com/rust-lang/rust/commit/79e402e9e0e87a5e5a174c012dfded53dec85769"}], "stats": {"total": 5, "additions": 0, "deletions": 5}, "files": [{"sha": "74e50c606107fec6be26387e99acd6f5356d931a", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5ffff5ccf2c67ce08104011cae65edb4907f5739/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ffff5ccf2c67ce08104011cae65edb4907f5739/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=5ffff5ccf2c67ce08104011cae65edb4907f5739", "patch": "@@ -166,11 +166,6 @@ pub fn check(build: &mut Build) {\n     }\n \n     for target in &build.targets {\n-        // Can't compile for iOS unless we're on macOS\n-        if target.contains(\"apple-ios\") && !build.build.contains(\"apple-darwin\") {\n-            panic!(\"the iOS target is only supported on macOS\");\n-        }\n-\n         build\n             .config\n             .target_config"}]}