{"sha": "e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxZmMzYTZmNDRiMjA4MWIzZGM4NmI2NTY5YzNhNGYxNWI5ZWRkNWQ=", "commit": {"author": {"name": "Robert Clipsham", "email": "robert@octarineparrot.com", "date": "2014-07-11T09:11:14Z"}, "committer": {"name": "Robert Clipsham", "email": "robert@octarineparrot.com", "date": "2014-07-15T14:17:03Z"}, "message": "Add low level support for polling with librustuv.\n\n * Adds functions for using arbitrary sockets with libuv\n * Adds types and functions required to support this.", "tree": {"sha": "d14d1635f9f26d649353155e4ae24281f9db0029", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d14d1635f9f26d649353155e4ae24281f9db0029"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d", "html_url": "https://github.com/rust-lang/rust/commit/e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d/comments", "author": {"login": "mrmonday", "id": 165689, "node_id": "MDQ6VXNlcjE2NTY4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/165689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrmonday", "html_url": "https://github.com/mrmonday", "followers_url": "https://api.github.com/users/mrmonday/followers", "following_url": "https://api.github.com/users/mrmonday/following{/other_user}", "gists_url": "https://api.github.com/users/mrmonday/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrmonday/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrmonday/subscriptions", "organizations_url": "https://api.github.com/users/mrmonday/orgs", "repos_url": "https://api.github.com/users/mrmonday/repos", "events_url": "https://api.github.com/users/mrmonday/events{/privacy}", "received_events_url": "https://api.github.com/users/mrmonday/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mrmonday", "id": 165689, "node_id": "MDQ6VXNlcjE2NTY4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/165689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrmonday", "html_url": "https://github.com/mrmonday", "followers_url": "https://api.github.com/users/mrmonday/followers", "following_url": "https://api.github.com/users/mrmonday/following{/other_user}", "gists_url": "https://api.github.com/users/mrmonday/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrmonday/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrmonday/subscriptions", "organizations_url": "https://api.github.com/users/mrmonday/orgs", "repos_url": "https://api.github.com/users/mrmonday/repos", "events_url": "https://api.github.com/users/mrmonday/events{/privacy}", "received_events_url": "https://api.github.com/users/mrmonday/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e11e094c0a90e1a518ea996f826abdf3ad0e4cbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/e11e094c0a90e1a518ea996f826abdf3ad0e4cbb", "html_url": "https://github.com/rust-lang/rust/commit/e11e094c0a90e1a518ea996f826abdf3ad0e4cbb"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "ba7ebee01a14f0bb5203a7f0128ac6422578350c", "filename": "src/librustuv/uvll.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d/src%2Flibrustuv%2Fuvll.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d/src%2Flibrustuv%2Fuvll.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustuv%2Fuvll.rs?ref=e1fc3a6f44b2081b3dc86b6569c3a4f15b9edd5d", "patch": "@@ -107,20 +107,32 @@ pub struct uv_buf_t {\n     pub len: uv_buf_len_t,\n }\n \n+#[cfg(unix)]\n+pub type uv_os_socket_t = c_int;\n+\n // see libuv/include/uv-win.h\n #[cfg(windows)]\n pub struct uv_buf_t {\n     pub len: uv_buf_len_t,\n     pub base: *mut u8,\n }\n \n+#[cfg(windows)]\n+pub type uv_os_socket_t = libc::SOCKET;\n+\n #[repr(C)]\n pub enum uv_run_mode {\n     RUN_DEFAULT = 0,\n     RUN_ONCE,\n     RUN_NOWAIT,\n }\n \n+#[repr(C)]\n+pub enum uv_poll_event {\n+    UV_READABLE = 1,\n+    UV_WRITABLE = 2,\n+}\n+\n pub struct uv_process_options_t {\n     pub exit_cb: uv_exit_cb,\n     pub file: *const libc::c_char,\n@@ -148,6 +160,7 @@ pub type uv_loop_t = c_void;\n pub type uv_idle_t = c_void;\n pub type uv_tcp_t = c_void;\n pub type uv_udp_t = c_void;\n+pub type uv_poll_t = c_void;\n pub type uv_connect_t = c_void;\n pub type uv_connection_t = c_void;\n pub type uv_write_t = c_void;\n@@ -231,6 +244,9 @@ pub type uv_udp_recv_cb = extern \"C\" fn(handle: *mut uv_udp_t,\n                                         addr: *const sockaddr,\n                                         flags: c_uint);\n pub type uv_close_cb = extern \"C\" fn(handle: *mut uv_handle_t);\n+pub type uv_poll_cb = extern \"C\" fn(handle: *mut uv_poll_t,\n+                                    status: c_int,\n+                                    events: c_int);\n pub type uv_walk_cb = extern \"C\" fn(handle: *mut uv_handle_t,\n                                     arg: *mut c_void);\n pub type uv_async_cb = extern \"C\" fn(handle: *mut uv_async_t);\n@@ -649,6 +665,11 @@ extern {\n     pub fn uv_fs_lstat(handle: *mut uv_loop_t, req: *mut uv_fs_t,\n                        file: *const c_char, cb: uv_fs_cb) -> c_int;\n \n+    // poll bindings\n+    pub fn uv_poll_init_socket(l: *mut uv_loop_t, h: *mut uv_poll_t, s: uv_os_socket_t) -> c_int;\n+    pub fn uv_poll_start(h: *mut uv_poll_t, events: c_int, cb: uv_poll_cb) -> c_int;\n+    pub fn uv_poll_stop(h: *mut uv_poll_t) -> c_int;\n+\n     // getaddrinfo\n     pub fn uv_getaddrinfo(loop_: *mut uv_loop_t, req: *mut uv_getaddrinfo_t,\n                           getaddrinfo_cb: uv_getaddrinfo_cb,"}]}