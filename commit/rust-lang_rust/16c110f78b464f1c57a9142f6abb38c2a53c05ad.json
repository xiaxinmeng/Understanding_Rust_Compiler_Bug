{"sha": "16c110f78b464f1c57a9142f6abb38c2a53c05ad", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2YzExMGY3OGI0NjRmMWM1N2E5MTQyZjZhYmIzOGMyYTUzYzA1YWQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-09-26T08:44:28Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-09-26T08:46:38Z"}, "message": "Fix issue #44731.\n\nAlso excludes `impl Trait` from everybody_loops if it appears in the path.", "tree": {"sha": "68dfc4382c0e2e18dc178c0254c56c78e40a94b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/68dfc4382c0e2e18dc178c0254c56c78e40a94b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/16c110f78b464f1c57a9142f6abb38c2a53c05ad", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlnKE+4ACgkQ/vbIBR0O\nATxTzxAAuIzxlzn+kSIirZ+f1RR5482i0YtMPhdBgDKembQB8W0ZJ+6NXsWIH/4y\n07xQJ4HMTradoERGDa4B3I6B/BthQQAiP2s9C2iAWBcCkYCThIF/ZMk3v8wQ611j\njSZeSVIrei3Pxcxe0NdvgsqetXknvtcYwtGDrug2QbL6Hwh/vWoqcXxC0cACRd3Y\nWUYBnOissWybraa0ug8vG9jZ5Py0pkEXZ/OnVeD4veQ/A8P3gixTRMsaI8NCH4VV\n3Or9yAvsU64owZrDqkiv8tHTe7lYkf8ZQgW39hGaPmrjeT5nmr+Qf/ApqXgWthso\niXqNx0+z336HiAjASLtwMIikiLeLMrUgGSRvABBowaTvWVfAINAsRs0QAV1y23l2\neUcIKk3ZcTiMohTKKmZOMcUW4w03DBGOadRBrcusO1fJZHlyCrhs57Px/jisiQ6b\nu4GRdOuRTyh/VbYEw055Ql1D/KhKQTgLPoeTaboNQ3Vmd2ir32N5PAPe3DLLCt3+\nfAPPFLAleOQJ8bDn96xEmlC5lq2rhDKL33u0voO82IINLNnZFWeyYFqs4ciaUs8O\n3gpML4J0VwQX5lL0oP2DYrlIfepRYH0XI42FwrIUXjEqA059U/eGdMelF/XYZKxJ\nwIwsXZq6ULnhUdtU3YTvYe1g77B4W6GXcnYJuOLwKhut5MmYYyI=\n=4xGc\n-----END PGP SIGNATURE-----", "payload": "tree 68dfc4382c0e2e18dc178c0254c56c78e40a94b8\nparent 82ae9682ca3f41f982b881c377a12bb081fead93\nauthor kennytm <kennytm@gmail.com> 1506415468 +0800\ncommitter kennytm <kennytm@gmail.com> 1506415598 +0800\n\nFix issue #44731.\n\nAlso excludes `impl Trait` from everybody_loops if it appears in the path.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/16c110f78b464f1c57a9142f6abb38c2a53c05ad", "html_url": "https://github.com/rust-lang/rust/commit/16c110f78b464f1c57a9142f6abb38c2a53c05ad", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/16c110f78b464f1c57a9142f6abb38c2a53c05ad/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "82ae9682ca3f41f982b881c377a12bb081fead93", "url": "https://api.github.com/repos/rust-lang/rust/commits/82ae9682ca3f41f982b881c377a12bb081fead93", "html_url": "https://github.com/rust-lang/rust/commit/82ae9682ca3f41f982b881c377a12bb081fead93"}], "stats": {"total": 69, "additions": 68, "deletions": 1}, "files": [{"sha": "e6d89f77f2163aaf9961ea68ca447fd77593c576", "filename": "src/librustc_driver/pretty.rs", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/16c110f78b464f1c57a9142f6abb38c2a53c05ad/src%2Flibrustc_driver%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/16c110f78b464f1c57a9142f6abb38c2a53c05ad/src%2Flibrustc_driver%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fpretty.rs?ref=16c110f78b464f1c57a9142f6abb38c2a53c05ad", "patch": "@@ -659,10 +659,26 @@ impl ReplaceBodyWithLoop {\n                     ast::TyKind::Ptr(ast::MutTy { ty: ref subty, .. }) |\n                     ast::TyKind::Rptr(_, ast::MutTy { ty: ref subty, .. }) |\n                     ast::TyKind::Paren(ref subty) => involves_impl_trait(subty),\n-                    ast::TyKind::Tup(ref tys) => tys.iter().any(|subty| involves_impl_trait(subty)),\n+                    ast::TyKind::Tup(ref tys) => any_involves_impl_trait(tys.iter()),\n+                    ast::TyKind::Path(_, ref path) => path.segments.iter().any(|seg| {\n+                        match seg.parameters.as_ref().map(|p| &**p) {\n+                            None => false,\n+                            Some(&ast::PathParameters::AngleBracketed(ref data)) =>\n+                                any_involves_impl_trait(data.types.iter()) ||\n+                                any_involves_impl_trait(data.bindings.iter().map(|b| &b.ty)),\n+                            Some(&ast::PathParameters::Parenthesized(ref data)) =>\n+                                any_involves_impl_trait(data.inputs.iter()) ||\n+                                any_involves_impl_trait(data.output.iter()),\n+                        }\n+                    }),\n                     _ => false,\n                 }\n             }\n+\n+            fn any_involves_impl_trait<'a, I: Iterator<Item = &'a P<ast::Ty>>>(mut it: I) -> bool {\n+                it.any(|subty| involves_impl_trait(subty))\n+            }\n+\n             involves_impl_trait(ty)\n         } else {\n             false"}, {"sha": "4670c5386c83c358ac7b52e6c7db983a87c71959", "filename": "src/test/rustdoc/issue-43869.rs", "status": "modified", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/16c110f78b464f1c57a9142f6abb38c2a53c05ad/src%2Ftest%2Frustdoc%2Fissue-43869.rs", "raw_url": "https://github.com/rust-lang/rust/raw/16c110f78b464f1c57a9142f6abb38c2a53c05ad/src%2Ftest%2Frustdoc%2Fissue-43869.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-43869.rs?ref=16c110f78b464f1c57a9142f6abb38c2a53c05ad", "patch": "@@ -26,7 +26,58 @@ pub fn j() -> impl Iterator<Item=u8> + Clone {\n     Some(1u8).into_iter()\n }\n \n+pub fn k() -> [impl Clone; 2] {\n+    [123u32, 456u32]\n+}\n+\n+pub fn l() -> (impl Clone, impl Default) {\n+    (789u32, -123i32)\n+}\n+\n+pub fn m() -> &'static impl Clone {\n+    &1u8\n+}\n+\n+pub fn n() -> *const impl Clone {\n+    &1u8\n+}\n+\n+pub fn o() -> &'static [impl Clone] {\n+    b\":)\"\n+}\n+\n+// issue #44731\n+pub fn test_44731_0() -> Box<impl Iterator<Item=u8>> {\n+    Box::new(g())\n+}\n+\n+pub fn test_44731_1() -> Result<Box<impl Clone>, ()> {\n+    Ok(Box::new(j()))\n+}\n+\n+pub fn test_44731_2() -> Box<Fn(impl Clone)> {\n+    Box::new(|_: u32| {})\n+}\n+\n+pub fn test_44731_3() -> Box<Fn() -> impl Clone> {\n+    Box::new(|| 0u32)\n+}\n+\n+pub fn test_44731_4() -> Box<Iterator<Item=impl Clone>> {\n+    Box::new(g())\n+}\n+\n // @has issue_43869/fn.g.html\n // @has issue_43869/fn.h.html\n // @has issue_43869/fn.i.html\n // @has issue_43869/fn.j.html\n+// @has issue_43869/fn.k.html\n+// @has issue_43869/fn.l.html\n+// @has issue_43869/fn.m.html\n+// @has issue_43869/fn.n.html\n+// @has issue_43869/fn.o.html\n+// @has issue_43869/fn.test_44731_0.html\n+// @has issue_43869/fn.test_44731_1.html\n+// @has issue_43869/fn.test_44731_2.html\n+// @has issue_43869/fn.test_44731_3.html\n+// @has issue_43869/fn.test_44731_4.html"}]}