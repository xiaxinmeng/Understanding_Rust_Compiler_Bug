{"sha": "6f92031233770dadde40bcaa140c73537c87206c", "node_id": "C_kwDOAAsO6NoAKDZmOTIwMzEyMzM3NzBkYWRkZTQwYmNhYTE0MGM3MzUzN2M4NzIwNmM", "commit": {"author": {"name": "mejrs", "email": "59372212+mejrs@users.noreply.github.com", "date": "2023-01-15T23:08:30Z"}, "committer": {"name": "mejrs", "email": "59372212+mejrs@users.noreply.github.com", "date": "2023-02-23T00:14:10Z"}, "message": "Restore behavior when primary bundle is missing", "tree": {"sha": "b9dac0f014be3cfaf727fe9111498b9af3167507", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9dac0f014be3cfaf727fe9111498b9af3167507"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f92031233770dadde40bcaa140c73537c87206c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f92031233770dadde40bcaa140c73537c87206c", "html_url": "https://github.com/rust-lang/rust/commit/6f92031233770dadde40bcaa140c73537c87206c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f92031233770dadde40bcaa140c73537c87206c/comments", "author": {"login": "mejrs", "id": 59372212, "node_id": "MDQ6VXNlcjU5MzcyMjEy", "avatar_url": "https://avatars.githubusercontent.com/u/59372212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mejrs", "html_url": "https://github.com/mejrs", "followers_url": "https://api.github.com/users/mejrs/followers", "following_url": "https://api.github.com/users/mejrs/following{/other_user}", "gists_url": "https://api.github.com/users/mejrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/mejrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mejrs/subscriptions", "organizations_url": "https://api.github.com/users/mejrs/orgs", "repos_url": "https://api.github.com/users/mejrs/repos", "events_url": "https://api.github.com/users/mejrs/events{/privacy}", "received_events_url": "https://api.github.com/users/mejrs/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mejrs", "id": 59372212, "node_id": "MDQ6VXNlcjU5MzcyMjEy", "avatar_url": "https://avatars.githubusercontent.com/u/59372212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mejrs", "html_url": "https://github.com/mejrs", "followers_url": "https://api.github.com/users/mejrs/followers", "following_url": "https://api.github.com/users/mejrs/following{/other_user}", "gists_url": "https://api.github.com/users/mejrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/mejrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mejrs/subscriptions", "organizations_url": "https://api.github.com/users/mejrs/orgs", "repos_url": "https://api.github.com/users/mejrs/repos", "events_url": "https://api.github.com/users/mejrs/events{/privacy}", "received_events_url": "https://api.github.com/users/mejrs/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fdbc4329cb781c7768ffa6d76c8fa2d032d3fe20", "url": "https://api.github.com/repos/rust-lang/rust/commits/fdbc4329cb781c7768ffa6d76c8fa2d032d3fe20", "html_url": "https://github.com/rust-lang/rust/commit/fdbc4329cb781c7768ffa6d76c8fa2d032d3fe20"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "ed35eb1b6c4ad8f567180cc9119ff7aa8c097938", "filename": "compiler/rustc_errors/src/translation.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6f92031233770dadde40bcaa140c73537c87206c/compiler%2Frustc_errors%2Fsrc%2Ftranslation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f92031233770dadde40bcaa140c73537c87206c/compiler%2Frustc_errors%2Fsrc%2Ftranslation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Ftranslation.rs?ref=6f92031233770dadde40bcaa140c73537c87206c", "patch": "@@ -1,4 +1,4 @@\n-use crate::error::TranslateError;\n+use crate::error::{TranslateError, TranslateErrorKind};\n use crate::snippet::Style;\n use crate::{DiagnosticArg, DiagnosticMessage, FluentBundle};\n use rustc_data_structures::sync::Lrc;\n@@ -95,6 +95,16 @@ pub trait Translate {\n                 // The primary bundle was present and translation succeeded\n                 Some(Ok(t)) => t,\n \n+                // If `translate_with_bundle` returns `Err` with the primary bundle, this is likely\n+                // just that the primary bundle doesn't contain the message being translated, so\n+                // proceed to the fallback bundle.\n+                Some(Err(\n+                    primary @ TranslateError::One {\n+                        kind: TranslateErrorKind::MessageMissing, ..\n+                    },\n+                )) => translate_with_bundle(self.fallback_fluent_bundle())\n+                    .map_err(|fallback| primary.and(fallback))?,\n+\n                 // Always yeet out for errors on debug (unless\n                 // `RUSTC_TRANSLATION_NO_DEBUG_ASSERT` is set in the environment - this allows\n                 // local runs of the test suites, of builds with debug assertions, to test the\n@@ -106,9 +116,8 @@ pub trait Translate {\n                     do yeet primary\n                 }\n \n-                // If `translate_with_bundle` returns `Err` with the primary bundle, this is likely\n-                // just that the primary bundle doesn't contain the message being translated or\n-                // something else went wrong) so proceed to the fallback bundle.\n+                // ..otherwise, for end users, an error about this wouldn't be useful or actionable, so\n+                // just hide it and try with the fallback bundle.\n                 Some(Err(primary)) => translate_with_bundle(self.fallback_fluent_bundle())\n                     .map_err(|fallback| primary.and(fallback))?,\n "}]}