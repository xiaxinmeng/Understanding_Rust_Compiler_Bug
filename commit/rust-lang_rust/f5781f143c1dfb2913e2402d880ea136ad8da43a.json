{"sha": "f5781f143c1dfb2913e2402d880ea136ad8da43a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY1NzgxZjE0M2MxZGZiMjkxM2UyNDAyZDg4MGVhMTM2YWQ4ZGE0M2E=", "commit": {"author": {"name": "Jonathan S", "email": "gereeter+code@gmail.com", "date": "2015-11-04T06:20:31Z"}, "committer": {"name": "Jonathan S", "email": "gereeter+code@gmail.com", "date": "2015-11-05T02:38:03Z"}, "message": "Remove use of RefCell<DefMap> in check_static_recursion", "tree": {"sha": "1bd825374fcf83e6eabd3769cac849232bdfc533", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1bd825374fcf83e6eabd3769cac849232bdfc533"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5781f143c1dfb2913e2402d880ea136ad8da43a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5781f143c1dfb2913e2402d880ea136ad8da43a", "html_url": "https://github.com/rust-lang/rust/commit/f5781f143c1dfb2913e2402d880ea136ad8da43a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5781f143c1dfb2913e2402d880ea136ad8da43a/comments", "author": {"login": "gereeter", "id": 2328242, "node_id": "MDQ6VXNlcjIzMjgyNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/2328242?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gereeter", "html_url": "https://github.com/gereeter", "followers_url": "https://api.github.com/users/gereeter/followers", "following_url": "https://api.github.com/users/gereeter/following{/other_user}", "gists_url": "https://api.github.com/users/gereeter/gists{/gist_id}", "starred_url": "https://api.github.com/users/gereeter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gereeter/subscriptions", "organizations_url": "https://api.github.com/users/gereeter/orgs", "repos_url": "https://api.github.com/users/gereeter/repos", "events_url": "https://api.github.com/users/gereeter/events{/privacy}", "received_events_url": "https://api.github.com/users/gereeter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gereeter", "id": 2328242, "node_id": "MDQ6VXNlcjIzMjgyNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/2328242?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gereeter", "html_url": "https://github.com/gereeter", "followers_url": "https://api.github.com/users/gereeter/followers", "following_url": "https://api.github.com/users/gereeter/following{/other_user}", "gists_url": "https://api.github.com/users/gereeter/gists{/gist_id}", "starred_url": "https://api.github.com/users/gereeter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gereeter/subscriptions", "organizations_url": "https://api.github.com/users/gereeter/orgs", "repos_url": "https://api.github.com/users/gereeter/repos", "events_url": "https://api.github.com/users/gereeter/events{/privacy}", "received_events_url": "https://api.github.com/users/gereeter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a69a00941ddb06254abe8633a4f721fd0576266", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a69a00941ddb06254abe8633a4f721fd0576266", "html_url": "https://github.com/rust-lang/rust/commit/8a69a00941ddb06254abe8633a4f721fd0576266"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "dd49010c4367232cd7b6b1eee144a0b1beb97935", "filename": "src/librustc/middle/check_static_recursion.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f5781f143c1dfb2913e2402d880ea136ad8da43a/src%2Flibrustc%2Fmiddle%2Fcheck_static_recursion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5781f143c1dfb2913e2402d880ea136ad8da43a/src%2Flibrustc%2Fmiddle%2Fcheck_static_recursion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_static_recursion.rs?ref=f5781f143c1dfb2913e2402d880ea136ad8da43a", "patch": "@@ -27,7 +27,7 @@ use std::cell::RefCell;\n \n struct CheckCrateVisitor<'a, 'ast: 'a> {\n     sess: &'a Session,\n-    def_map: &'a RefCell<DefMap>,\n+    def_map: &'a DefMap,\n     ast_map: &'a ast_map::Map<'ast>,\n     // `discriminant_map` is a cache that associates the `NodeId`s of local\n     // variant definitions with the discriminant expression that applies to\n@@ -92,7 +92,7 @@ impl<'a, 'ast: 'a> Visitor<'ast> for CheckCrateVisitor<'a, 'ast> {\n \n pub fn check_crate<'ast>(sess: &Session,\n                          krate: &'ast hir::Crate,\n-                         def_map: &RefCell<DefMap>,\n+                         def_map: &DefMap,\n                          ast_map: &ast_map::Map<'ast>) {\n     let mut visitor = CheckCrateVisitor {\n         sess: sess,\n@@ -108,7 +108,7 @@ struct CheckItemRecursionVisitor<'a, 'ast: 'a> {\n     root_span: &'a Span,\n     sess: &'a Session,\n     ast_map: &'a ast_map::Map<'ast>,\n-    def_map: &'a RefCell<DefMap>,\n+    def_map: &'a DefMap,\n     discriminant_map: &'a RefCell<NodeMap<Option<&'ast hir::Expr>>>,\n     idstack: Vec<ast::NodeId>,\n }\n@@ -237,7 +237,7 @@ impl<'a, 'ast: 'a> Visitor<'ast> for CheckItemRecursionVisitor<'a, 'ast> {\n     fn visit_expr(&mut self, e: &'ast hir::Expr) {\n         match e.node {\n             hir::ExprPath(..) => {\n-                match self.def_map.borrow().get(&e.id).map(|d| d.base_def) {\n+                match self.def_map.get(&e.id).map(|d| d.base_def) {\n                     Some(DefStatic(def_id, _)) |\n                     Some(DefAssociatedConst(def_id)) |\n                     Some(DefConst(def_id)) => {"}, {"sha": "558ecf85511c822e3a30d56a996656aea0f417a8", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f5781f143c1dfb2913e2402d880ea136ad8da43a/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5781f143c1dfb2913e2402d880ea136ad8da43a/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=f5781f143c1dfb2913e2402d880ea136ad8da43a", "patch": "@@ -718,7 +718,7 @@ pub fn phase_3_run_analysis_passes<'tcx, F, R>(sess: &'tcx Session,\n          middle::check_loop::check_crate(sess, krate));\n \n     time(time_passes, \"static item recursion checking\", ||\n-         middle::check_static_recursion::check_crate(sess, krate, &def_map, &ast_map));\n+         middle::check_static_recursion::check_crate(sess, krate, &def_map.borrow(), &ast_map));\n \n     ty::ctxt::create_and_enter(sess,\n                                arenas,"}]}