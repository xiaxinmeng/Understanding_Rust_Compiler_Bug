{"sha": "09e44b22f2fcd3487df58fa4de80a6f9c8816d49", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5ZTQ0YjIyZjJmY2QzNDg3ZGY1OGZhNGRlODBhNmY5Yzg4MTZkNDk=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-01-12T04:30:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-01-12T04:30:27Z"}, "message": "Merge pull request #2351 from topecongiro/issue-2256\n\nUse correct BytePos when recovering comments on removed import", "tree": {"sha": "cc8f8c5f2fd2dcc270aabebdbc933a6b9db3ab1a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cc8f8c5f2fd2dcc270aabebdbc933a6b9db3ab1a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/09e44b22f2fcd3487df58fa4de80a6f9c8816d49", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaWDnjCRBK7hj4Ov3rIwAAdHIIAGzcn5sJzyTTI/WFYvGImEto\nP5S08iDIKiGyFDioL7ZogYbu/Qow65jSBAN558qZ6A3jJ7vTg88tcLH0cvxXK189\nrJ2c1ifnHAAL5SXyWhGLIO9pjuRsFJY7tHGni2Mp5V4/P3stt8nxmDRIOX/DIJ0E\nKrmtY6dgVr6lgGa7er0JD3CRWXmufLCVBFYvyHzDR5wf0FHUKB+Vifh64N0u5+Hq\nttrmANp4f/nO4RH+kimaaWvFpn/gK/UiNKDVB5B0rCP5Fl4zNDf7D8IUVGQxB/U/\n/OZkIsXtkYglEe7+3CLGFCKdLQkdGI0b41ymQdEXSc2VQEECWVvrKnipilaYX1o=\n=bYpm\n-----END PGP SIGNATURE-----\n", "payload": "tree cc8f8c5f2fd2dcc270aabebdbc933a6b9db3ab1a\nparent be0000380b68169faebcd9d6f2f1aa2930f51381\nparent 949708f617ae7e815da8ebd69b7128c5ae184299\nauthor Nick Cameron <nrc@ncameron.org> 1515731427 +1300\ncommitter GitHub <noreply@github.com> 1515731427 +1300\n\nMerge pull request #2351 from topecongiro/issue-2256\n\nUse correct BytePos when recovering comments on removed import "}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/09e44b22f2fcd3487df58fa4de80a6f9c8816d49", "html_url": "https://github.com/rust-lang/rust/commit/09e44b22f2fcd3487df58fa4de80a6f9c8816d49", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/09e44b22f2fcd3487df58fa4de80a6f9c8816d49/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be0000380b68169faebcd9d6f2f1aa2930f51381", "url": "https://api.github.com/repos/rust-lang/rust/commits/be0000380b68169faebcd9d6f2f1aa2930f51381", "html_url": "https://github.com/rust-lang/rust/commit/be0000380b68169faebcd9d6f2f1aa2930f51381"}, {"sha": "949708f617ae7e815da8ebd69b7128c5ae184299", "url": "https://api.github.com/repos/rust-lang/rust/commits/949708f617ae7e815da8ebd69b7128c5ae184299", "html_url": "https://github.com/rust-lang/rust/commit/949708f617ae7e815da8ebd69b7128c5ae184299"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "c49a95b6ff796b725f058ebc728d86d1876de86c", "filename": "src/imports.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/09e44b22f2fcd3487df58fa4de80a6f9c8816d49/src%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09e44b22f2fcd3487df58fa4de80a6f9c8816d49/src%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fimports.rs?ref=09e44b22f2fcd3487df58fa4de80a6f9c8816d49", "patch": "@@ -314,11 +314,14 @@ impl<'a> FmtVisitor<'a> {\n             Some(ref s) if s.is_empty() => {\n                 // Format up to last newline\n                 let prev_span = mk_sp(self.last_pos, source!(self, span).lo());\n-                let span_end = match self.snippet(prev_span).rfind('\\n') {\n-                    Some(offset) => self.last_pos + BytePos(offset as u32),\n-                    None => source!(self, span).lo(),\n-                };\n+                let trimmed_snippet = self.snippet(prev_span).trim_right();\n+                let span_end = self.last_pos + BytePos(trimmed_snippet.len() as u32);\n                 self.format_missing(span_end);\n+                // We have an excessive newline from the removed import.\n+                if self.buffer.ends_with('\\n') {\n+                    self.buffer.pop();\n+                    self.line_number -= 1;\n+                }\n                 self.last_pos = source!(self, span).hi();\n             }\n             Some(ref s) => {"}, {"sha": "b505b96e2b317a9857acd5ce93fda94f6e763f9d", "filename": "tests/source/issue-2256.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/09e44b22f2fcd3487df58fa4de80a6f9c8816d49/tests%2Fsource%2Fissue-2256.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09e44b22f2fcd3487df58fa4de80a6f9c8816d49/tests%2Fsource%2Fissue-2256.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-2256.rs?ref=09e44b22f2fcd3487df58fa4de80a6f9c8816d49", "patch": "@@ -0,0 +1,12 @@\n+// \u3053\u3093\u306b\u3061\u306f\n+use std::{};\n+use std::borrow::Cow;\n+\n+/* comment */ use std::{};\n+/* comment */ use std::{};\n+\n+\n+\n+\n+\n+/* comment */ use std::{};"}, {"sha": "4b546223f949d4a9784b57f3b5f708fc4dd4f2f9", "filename": "tests/target/issue-2256.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/09e44b22f2fcd3487df58fa4de80a6f9c8816d49/tests%2Ftarget%2Fissue-2256.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09e44b22f2fcd3487df58fa4de80a6f9c8816d49/tests%2Ftarget%2Fissue-2256.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2256.rs?ref=09e44b22f2fcd3487df58fa4de80a6f9c8816d49", "patch": "@@ -0,0 +1,7 @@\n+// \u3053\u3093\u306b\u3061\u306f\n+use std::borrow::Cow;\n+\n+/* comment */\n+/* comment */\n+\n+/* comment */"}]}