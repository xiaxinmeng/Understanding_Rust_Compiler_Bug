{"sha": "d672fea64a599337d010d35278bb0746c097d8b9", "node_id": "C_kwDOAAsO6NoAKGQ2NzJmZWE2NGE1OTkzMzdkMDEwZDM1Mjc4YmIwNzQ2YzA5N2Q4Yjk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-07-16T22:34:22Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-07-16T22:54:46Z"}, "message": "Use typeck_results to avoid duplicate ast_ty_to_ty call", "tree": {"sha": "4a2be7e966441d2cab88ea97e11abba6ece159a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a2be7e966441d2cab88ea97e11abba6ece159a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d672fea64a599337d010d35278bb0746c097d8b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d672fea64a599337d010d35278bb0746c097d8b9", "html_url": "https://github.com/rust-lang/rust/commit/d672fea64a599337d010d35278bb0746c097d8b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d672fea64a599337d010d35278bb0746c097d8b9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7210e46dc69a4b197a313d093fe145722c248b7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7210e46dc69a4b197a313d093fe145722c248b7d", "html_url": "https://github.com/rust-lang/rust/commit/7210e46dc69a4b197a313d093fe145722c248b7d"}], "stats": {"total": 72, "additions": 27, "deletions": 45}, "files": [{"sha": "c7bfb379a163dc0444e221775709417b6d3a90b4", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/checks.rs", "status": "modified", "additions": 5, "deletions": 13, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -1791,19 +1791,11 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             .flat_map(|a| a.args.iter())\n                         {\n                             if let hir::GenericArg::Type(hir_ty) = &arg {\n-                                if let hir::TyKind::Path(hir::QPath::TypeRelative(..)) =\n-                                    &hir_ty.kind\n-                                {\n-                                    // Avoid ICE with associated types. As this is best\n-                                    // effort only, it's ok to ignore the case. It\n-                                    // would trigger in `is_send::<T::AssocType>();`\n-                                    // from `typeck-default-trait-impl-assoc-type.rs`.\n-                                } else {\n-                                    let ty = <dyn AstConv<'_>>::ast_ty_to_ty(self, hir_ty);\n-                                    let ty = self.resolve_vars_if_possible(ty);\n-                                    if ty == predicate.self_ty() {\n-                                        error.obligation.cause.span = hir_ty.span;\n-                                    }\n+                                let ty = self.resolve_vars_if_possible(\n+                                    self.typeck_results.borrow().node_type(hir_ty.hir_id),\n+                                );\n+                                if ty == predicate.self_ty() {\n+                                    error.obligation.cause.span = hir_ty.span;\n                                 }\n                             }\n                         }"}, {"sha": "025a5008d0f11f0d1aacfb8d041554be1dd149fc", "filename": "src/test/ui/kindck/kindck-copy.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Fkindck%2Fkindck-copy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Fkindck%2Fkindck-copy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fkindck%2Fkindck-copy.stderr?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -91,10 +91,10 @@ LL | fn assert_copy<T:Copy>() { }\n    |                  ^^^^ required by this bound in `assert_copy`\n \n error[E0277]: the trait bound `Box<dyn Dummy>: Copy` is not satisfied\n-  --> $DIR/kindck-copy.rs:42:5\n+  --> $DIR/kindck-copy.rs:42:19\n    |\n LL |     assert_copy::<Box<dyn Dummy>>();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `Box<dyn Dummy>`\n+   |                   ^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `Box<dyn Dummy>`\n    |\n note: required by a bound in `assert_copy`\n   --> $DIR/kindck-copy.rs:5:18\n@@ -103,10 +103,10 @@ LL | fn assert_copy<T:Copy>() { }\n    |                  ^^^^ required by this bound in `assert_copy`\n \n error[E0277]: the trait bound `Box<dyn Dummy + Send>: Copy` is not satisfied\n-  --> $DIR/kindck-copy.rs:43:5\n+  --> $DIR/kindck-copy.rs:43:19\n    |\n LL |     assert_copy::<Box<dyn Dummy + Send>>();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `Box<dyn Dummy + Send>`\n+   |                   ^^^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `Box<dyn Dummy + Send>`\n    |\n note: required by a bound in `assert_copy`\n   --> $DIR/kindck-copy.rs:5:18"}, {"sha": "2cd51a439988db0102d10499e56f5e6aad70064b", "filename": "src/test/ui/not-panic/not-panic-safe.stderr", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Fnot-panic%2Fnot-panic-safe.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Fnot-panic%2Fnot-panic-safe.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnot-panic%2Fnot-panic-safe.stderr?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -1,8 +1,11 @@\n error[E0277]: the type `&mut i32` may not be safely transferred across an unwind boundary\n-  --> $DIR/not-panic-safe.rs:8:5\n+  --> $DIR/not-panic-safe.rs:8:14\n    |\n LL |     assert::<&mut i32>();\n-   |     ^^^^^^^^^^^^^^^^^^ `&mut i32` may not be safely transferred across an unwind boundary\n+   |              -^^^^^^^\n+   |              |\n+   |              `&mut i32` may not be safely transferred across an unwind boundary\n+   |              help: consider removing the leading `&`-reference\n    |\n    = help: the trait `UnwindSafe` is not implemented for `&mut i32`\n    = note: `UnwindSafe` is implemented for `&i32`, but not for `&mut i32`"}, {"sha": "56a68f3a2312c92f33d47fe4aba3f390344338ae", "filename": "src/test/ui/traits/issue-32963.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftraits%2Fissue-32963.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftraits%2Fissue-32963.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fissue-32963.rs?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -7,6 +7,5 @@ fn size_of_copy<T: Copy+?Sized>() -> usize { mem::size_of::<T>() }\n fn main() {\n     size_of_copy::<dyn Misc + Copy>();\n     //~^ ERROR only auto traits can be used as additional traits in a trait object\n-    //~| ERROR only auto traits can be used as additional traits in a trait object\n     //~| ERROR the trait bound `dyn Misc: Copy` is not satisfied\n }"}, {"sha": "bad45e54d64288053c9e35355542f3b95019a5a7", "filename": "src/test/ui/traits/issue-32963.stderr", "status": "modified", "additions": 3, "deletions": 14, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftraits%2Fissue-32963.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftraits%2Fissue-32963.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fissue-32963.stderr?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -9,30 +9,19 @@ LL |     size_of_copy::<dyn Misc + Copy>();\n    = help: consider creating a new trait with all of these as supertraits and using that trait here instead: `trait NewTrait: Misc + Copy {}`\n    = note: auto-traits like `Send` and `Sync` are traits that have special properties; for more information on them, visit <https://doc.rust-lang.org/reference/special-types-and-traits.html#auto-traits>\n \n-error[E0225]: only auto traits can be used as additional traits in a trait object\n-  --> $DIR/issue-32963.rs:8:31\n-   |\n-LL |     size_of_copy::<dyn Misc + Copy>();\n-   |                        ----   ^^^^ additional non-auto trait\n-   |                        |\n-   |                        first non-auto trait\n-   |\n-   = help: consider creating a new trait with all of these as supertraits and using that trait here instead: `trait NewTrait: Misc + Copy {}`\n-   = note: auto-traits like `Send` and `Sync` are traits that have special properties; for more information on them, visit <https://doc.rust-lang.org/reference/special-types-and-traits.html#auto-traits>\n-\n error[E0277]: the trait bound `dyn Misc: Copy` is not satisfied\n-  --> $DIR/issue-32963.rs:8:5\n+  --> $DIR/issue-32963.rs:8:20\n    |\n LL |     size_of_copy::<dyn Misc + Copy>();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `dyn Misc`\n+   |                    ^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `dyn Misc`\n    |\n note: required by a bound in `size_of_copy`\n   --> $DIR/issue-32963.rs:5:20\n    |\n LL | fn size_of_copy<T: Copy+?Sized>() -> usize { mem::size_of::<T>() }\n    |                    ^^^^ required by this bound in `size_of_copy`\n \n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n Some errors have detailed explanations: E0225, E0277.\n For more information about an error, try `rustc --explain E0225`."}, {"sha": "d4d9b4967478ada0cedd6115bc14d1a5638b3b4b", "filename": "src/test/ui/traits/suggest-where-clause.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftraits%2Fsuggest-where-clause.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftraits%2Fsuggest-where-clause.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fsuggest-where-clause.stderr?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -85,10 +85,10 @@ LL | pub const fn size_of<T>() -> usize {\n    |                      ^ required by this bound in `std::mem::size_of`\n \n error[E0277]: the size for values of type `[&U]` cannot be known at compilation time\n-  --> $DIR/suggest-where-clause.rs:31:5\n+  --> $DIR/suggest-where-clause.rs:31:20\n    |\n LL |     mem::size_of::<[&U]>();\n-   |     ^^^^^^^^^^^^^^^^^^^^ doesn't have a size known at compile-time\n+   |                    ^^^^ doesn't have a size known at compile-time\n    |\n    = help: the trait `Sized` is not implemented for `[&U]`\n note: required by a bound in `std::mem::size_of`"}, {"sha": "468a14762c0d70e14504c26b6e1993f745896b7a", "filename": "src/test/ui/typeck/typeck-default-trait-impl-assoc-type.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-default-trait-impl-assoc-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-default-trait-impl-assoc-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-default-trait-impl-assoc-type.stderr?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -1,8 +1,8 @@\n error[E0277]: `<T as Trait>::AssocType` cannot be sent between threads safely\n-  --> $DIR/typeck-default-trait-impl-assoc-type.rs:11:5\n+  --> $DIR/typeck-default-trait-impl-assoc-type.rs:11:15\n    |\n LL |     is_send::<T::AssocType>();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^ `<T as Trait>::AssocType` cannot be sent between threads safely\n+   |               ^^^^^^^^^^^^ `<T as Trait>::AssocType` cannot be sent between threads safely\n    |\n    = help: the trait `Send` is not implemented for `<T as Trait>::AssocType`\n note: required by a bound in `is_send`"}, {"sha": "a3b32d2c1c8ceeabc6986304b9878eb2dac09496", "filename": "src/test/ui/unboxed-closures/unboxed-closure-sugar-default.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-default.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-default.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-default.stderr?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -1,8 +1,8 @@\n error[E0277]: the trait bound `dyn Foo<(isize,), isize, Output = ()>: Eq<dyn Foo<(isize,), Output = ()>>` is not satisfied\n-  --> $DIR/unboxed-closure-sugar-default.rs:21:5\n+  --> $DIR/unboxed-closure-sugar-default.rs:21:10\n    |\n LL |     eq::<dyn Foo<(isize,), isize, Output=()>, dyn Foo(isize)>();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Eq<dyn Foo<(isize,), Output = ()>>` is not implemented for `dyn Foo<(isize,), isize, Output = ()>`\n+   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Eq<dyn Foo<(isize,), Output = ()>>` is not implemented for `dyn Foo<(isize,), isize, Output = ()>`\n    |\n note: required by a bound in `eq`\n   --> $DIR/unboxed-closure-sugar-default.rs:14:40"}, {"sha": "acf0227a79b8c523702c3245721656ab39707e1a", "filename": "src/test/ui/unboxed-closures/unboxed-closure-sugar-equiv.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-equiv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-equiv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-equiv.rs?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -42,7 +42,7 @@ fn test<'a,'b>() {\n     // Errors expected:\n     eq::< dyn Foo<(),Output=()>,\n           dyn Foo(char)                                               >();\n-    //~^^ ERROR E0277\n+    //~^ ERROR E0277\n }\n \n fn main() { }"}, {"sha": "bccbf307ae15734e6212a7e1f7e3b2b6d17b1313", "filename": "src/test/ui/unboxed-closures/unboxed-closure-sugar-equiv.stderr", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-equiv.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d672fea64a599337d010d35278bb0746c097d8b9/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-equiv.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funboxed-closures%2Funboxed-closure-sugar-equiv.stderr?ref=d672fea64a599337d010d35278bb0746c097d8b9", "patch": "@@ -1,9 +1,8 @@\n error[E0277]: the trait bound `dyn Foo<(char,), Output = ()>: Eq<dyn Foo<(), Output = ()>>` is not satisfied\n-  --> $DIR/unboxed-closure-sugar-equiv.rs:43:5\n+  --> $DIR/unboxed-closure-sugar-equiv.rs:44:11\n    |\n-LL | /     eq::< dyn Foo<(),Output=()>,\n-LL | |           dyn Foo(char)                                               >();\n-   | |_______________________________________________________________________^ the trait `Eq<dyn Foo<(), Output = ()>>` is not implemented for `dyn Foo<(char,), Output = ()>`\n+LL |           dyn Foo(char)                                               >();\n+   |           ^^^^^^^^^^^^^ the trait `Eq<dyn Foo<(), Output = ()>>` is not implemented for `dyn Foo<(char,), Output = ()>`\n    |\n note: required by a bound in `eq`\n   --> $DIR/unboxed-closure-sugar-equiv.rs:16:28"}]}