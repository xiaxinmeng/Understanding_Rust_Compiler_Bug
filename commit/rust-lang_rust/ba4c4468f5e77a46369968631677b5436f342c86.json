{"sha": "ba4c4468f5e77a46369968631677b5436f342c86", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJhNGM0NDY4ZjVlNzdhNDYzNjk5Njg2MzE2NzdiNTQzNmYzNDJjODY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-25T15:44:03Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-25T15:44:03Z"}, "message": "Auto merge of #75908 - pietroalbini:ci-bump-llvm, r=Mark-Simulacrum\n\nBump LLVM on CI to 10.0.0\n\nThis PR bumps the LLVM version we use on our macOS and Windows CI to 10.0.0, fixing a breakage we noticed today:\n\n```\n2020-08-25T14:24:28.5939568Z FAILED: lib/Support/CMakeFiles/LLVMSupport.dir/AMDGPUMetadata.cpp.obj\n2020-08-25T14:24:28.5940317Z D:\\a\\rust\\rust\\build\\bootstrap\\debug\\sccache-plus-cl.exe  /nologo -TP -DGTEST_HAS_RTTI=0 -DUNICODE -D_CRT_NONSTDC_NO_DEPRECATE -D_CRT_NONSTDC_NO_WARNINGS -D_CRT_SECURE_NO_DEPRECATE -D_CRT_SECURE_NO_WARNINGS -D_HAS_EXCEPTIONS=0 -D_SCL_SECURE_NO_DEPRECATE -D_SCL_SECURE_NO_WARNINGS -D_UNICODE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -Ilib\\Support -ID:\\a\\rust\\rust\\src\\llvm-project\\llvm\\lib\\Support -Iinclude -ID:\\a\\rust\\rust\\src\\llvm-project\\llvm\\include -nologo -MT -Brepro --target=x86_64-pc-windows-msvc /Zc:inline /Zc:strictStrings /Oi /Zc:rvalueCast /Brepro /W4  -Wextra -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wmissing-field-initializers -Wno-noexcept-type -Wno-comment /Gw /MT /O2 /Ob2 -UNDEBUG -std:c++14  /EHs-c- /GR- /showIncludes /Folib\\Support\\CMakeFiles\\LLVMSupport.dir\\AMDGPUMetadata.cpp.obj /Fdlib\\Support\\CMakeFiles\\LLVMSupport.dir\\LLVMSupport.pdb -c D:\\a\\rust\\rust\\src\\llvm-project\\llvm\\lib\\Support\\AMDGPUMetadata.cpp\n2020-08-25T14:24:28.5940861Z clang-cl: warning: argument unused during compilation: '-Brepro' [-Wunused-command-line-argument]\n2020-08-25T14:24:28.5941076Z clang-cl: warning: argument unused during compilation: '-Brepro' [-Wunused-command-line-argument]\n2020-08-25T14:24:28.5941321Z In file included from D:\\a\\rust\\rust\\src\\llvm-project\\llvm\\lib\\Support\\AMDGPUMetadata.cpp:15:\n2020-08-25T14:24:28.5941545Z In file included from D:\\a\\rust\\rust\\src\\llvm-project\\llvm\\include\\llvm/ADT/Twine.h:12:\n2020-08-25T14:24:28.5941774Z In file included from D:\\a\\rust\\rust\\src\\llvm-project\\llvm\\include\\llvm/ADT/SmallVector.h:16:\n2020-08-25T14:24:28.5942016Z In file included from D:\\a\\rust\\rust\\src\\llvm-project\\llvm\\include\\llvm/ADT/iterator_range.h:21:\n2020-08-25T14:24:28.5942257Z In file included from C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Enterprise\\VC\\Tools\\MSVC\\14.27.29110\\include\\iterator:9:\n2020-08-25T14:24:28.5942542Z C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Enterprise\\VC\\Tools\\MSVC\\14.27.29110\\include\\yvals_core.h(494,2): error: STL1000: Unexpected compiler version, expected Clang 10.0.0 or newer.\n```\n\nI uploaded both the new tarballs to our mirrors bucket.", "tree": {"sha": "8163f917f9c5993289dc6f313a26eb02d7389c90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8163f917f9c5993289dc6f313a26eb02d7389c90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba4c4468f5e77a46369968631677b5436f342c86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba4c4468f5e77a46369968631677b5436f342c86", "html_url": "https://github.com/rust-lang/rust/commit/ba4c4468f5e77a46369968631677b5436f342c86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba4c4468f5e77a46369968631677b5436f342c86/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "589056385948de7d3fac7b9365a3c79ce0f36758", "url": "https://api.github.com/repos/rust-lang/rust/commits/589056385948de7d3fac7b9365a3c79ce0f36758", "html_url": "https://github.com/rust-lang/rust/commit/589056385948de7d3fac7b9365a3c79ce0f36758"}, {"sha": "2c011096d2f5196ef1c322c8754a975ac4078375", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c011096d2f5196ef1c322c8754a975ac4078375", "html_url": "https://github.com/rust-lang/rust/commit/2c011096d2f5196ef1c322c8754a975ac4078375"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "969443ac0949bf6ab837373bccc03dea2bb6de58", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-clang.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ba4c4468f5e77a46369968631677b5436f342c86/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ba4c4468f5e77a46369968631677b5436f342c86/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh?ref=ba4c4468f5e77a46369968631677b5436f342c86", "patch": "@@ -4,7 +4,7 @@ set -ex\n \n source shared.sh\n \n-LLVM=llvmorg-9.0.0\n+LLVM=llvmorg-10.0.0\n \n mkdir llvm-project\n cd llvm-project"}, {"sha": "a1481f22f509de74548a95cc1041d34dc862649b", "filename": "src/ci/scripts/install-clang.sh", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ba4c4468f5e77a46369968631677b5436f342c86/src%2Fci%2Fscripts%2Finstall-clang.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ba4c4468f5e77a46369968631677b5436f342c86/src%2Fci%2Fscripts%2Finstall-clang.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-clang.sh?ref=ba4c4468f5e77a46369968631677b5436f342c86", "patch": "@@ -8,11 +8,14 @@ IFS=$'\\n\\t'\n \n source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n \n+# Update both macOS's and Windows's tarballs when bumping the version here.\n+LLVM_VERSION=\"10.0.0\"\n+\n if isMacOS; then\n-    curl -f \"${MIRRORS_BASE}/clang%2Bllvm-9.0.0-x86_64-darwin-apple.tar.xz\" | tar xJf -\n+    curl -f \"${MIRRORS_BASE}/clang%2Bllvm-${LLVM_VERSION}-x86_64-apple-darwin.tar.xz\" | tar xJf -\n \n-    ciCommandSetEnv CC \"$(pwd)/clang+llvm-9.0.0-x86_64-darwin-apple/bin/clang\"\n-    ciCommandSetEnv CXX \"$(pwd)/clang+llvm-9.0.0-x86_64-darwin-apple/bin/clang++\"\n+    ciCommandSetEnv CC \"$(pwd)/clang+llvm-${LLVM_VERSION}-x86_64-apple-darwin/bin/clang\"\n+    ciCommandSetEnv CXX \"$(pwd)/clang+llvm-${LLVM_VERSION}-x86_64-apple-darwin/bin/clang++\"\n \n     # macOS 10.15 onwards doesn't have libraries in /usr/include anymore: those\n     # are now located deep into the filesystem, under Xcode's own files. The\n@@ -33,8 +36,10 @@ elif isWindows && [[ ${CUSTOM_MINGW-0} -ne 1 ]]; then\n     #\n     # Note that the LLVM installer is an NSIS installer\n     #\n-    # Original downloaded here came from\n-    # http://releases.llvm.org/9.0.0/LLVM-9.0.0-win64.exe\n+    # Original downloaded here came from:\n+    #\n+    #   https://github.com/llvm/llvm-project/releases/download/llvmorg-10.0.0/LLVM-10.0.0-win64.exe\n+    #\n     # That installer was run through `wine ./installer.exe /S /NCRC` on Linux\n     # and then the resulting installation directory (found in\n     # `$HOME/.wine/drive_c/Program Files/LLVM`) was packaged up into a tarball.\n@@ -45,7 +50,7 @@ elif isWindows && [[ ${CUSTOM_MINGW-0} -ne 1 ]]; then\n \n     mkdir -p citools\n     cd citools\n-    curl -f \"${MIRRORS_BASE}/LLVM-9.0.0-win64.tar.gz\" | tar xzf -\n+    curl -f \"${MIRRORS_BASE}/LLVM-${LLVM_VERSION}-win64.tar.gz\" | tar xzf -\n     ciCommandSetEnv RUST_CONFIGURE_ARGS \\\n         \"${RUST_CONFIGURE_ARGS} --set llvm.clang-cl=$(pwd)/clang-rust/bin/clang-cl.exe\"\n fi"}]}