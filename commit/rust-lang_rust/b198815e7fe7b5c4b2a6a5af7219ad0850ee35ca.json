{"sha": "b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca", "node_id": "C_kwDOAAsO6NoAKGIxOTg4MTVlN2ZlN2I1YzRiMmE2YTVhZjcyMTlhZDA4NTBlZTM1Y2E", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-15T09:32:10Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-15T09:32:10Z"}, "message": "Auto merge of #14775 - hecatia-elegua:doc-alias-methods, r=Veykril\n\nfeat: add #[doc(alias(..))]-based method completions\n\n![Screenshot showing a completion when you type a doc alias instead of a real name](https://github.com/rust-lang/rust-analyzer/assets/108802164/e7c69bb9-3da6-4d8f-a09b-fece1bdd1c0e)", "tree": {"sha": "a765d3f3a45a1f20f4479f46f2434d12aa8ab0a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a765d3f3a45a1f20f4479f46f2434d12aa8ab0a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca", "html_url": "https://github.com/rust-lang/rust/commit/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc0341812795410fab08c535c41a0ecf7d7cb510", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc0341812795410fab08c535c41a0ecf7d7cb510", "html_url": "https://github.com/rust-lang/rust/commit/bc0341812795410fab08c535c41a0ecf7d7cb510"}, {"sha": "2a182f3f1f2c7b1a5359885b3b55e20885fe4183", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a182f3f1f2c7b1a5359885b3b55e20885fe4183", "html_url": "https://github.com/rust-lang/rust/commit/2a182f3f1f2c7b1a5359885b3b55e20885fe4183"}], "stats": {"total": 70, "additions": 68, "deletions": 2}, "files": [{"sha": "87346f501d2bb15e89feea29cabf89544ecd319d", "filename": "crates/ide-completion/src/completions.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca/crates%2Fide-completion%2Fsrc%2Fcompletions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca/crates%2Fide-completion%2Fsrc%2Fcompletions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Fcompletions.rs?ref=b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca", "patch": "@@ -295,9 +295,12 @@ impl Completions {\n             Visible::Editable => true,\n             Visible::No => return,\n         };\n+        let doc_aliases = ctx.doc_aliases(&func);\n         self.add(\n             render_fn(\n-                RenderContext::new(ctx).private_editable(is_private_editable),\n+                RenderContext::new(ctx)\n+                    .private_editable(is_private_editable)\n+                    .doc_aliases(doc_aliases),\n                 path_ctx,\n                 local_name,\n                 func,\n@@ -322,9 +325,12 @@ impl Completions {\n             Visible::Editable => true,\n             Visible::No => return,\n         };\n+        let doc_aliases = ctx.doc_aliases(&func);\n         self.add(\n             render_method(\n-                RenderContext::new(ctx).private_editable(is_private_editable),\n+                RenderContext::new(ctx)\n+                    .private_editable(is_private_editable)\n+                    .doc_aliases(doc_aliases),\n                 dot_access,\n                 receiver,\n                 local_name,\n@@ -349,10 +355,12 @@ impl Completions {\n             Visible::Editable => true,\n             Visible::No => return,\n         };\n+        let doc_aliases = ctx.doc_aliases(&func);\n         self.add(\n             render_method(\n                 RenderContext::new(ctx)\n                     .private_editable(is_private_editable)\n+                    .doc_aliases(doc_aliases)\n                     .import_to_add(Some(import)),\n                 dot_access,\n                 None,"}, {"sha": "3824720839eb9ebdea5a4bb460419cd9be9299dc", "filename": "crates/ide-completion/src/tests/special.rs", "status": "modified", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca/crates%2Fide-completion%2Fsrc%2Ftests%2Fspecial.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca/crates%2Fide-completion%2Fsrc%2Ftests%2Fspecial.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Fspecial.rs?ref=b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca", "patch": "@@ -1106,6 +1106,62 @@ fn here_we_go() {\n     );\n }\n \n+#[test]\n+fn completes_struct_fn_name_via_doc_alias_in_fn_body() {\n+    check(\n+        r#\"\n+struct Foo;\n+impl Foo {\n+    #[doc(alias = \"qux\")]\n+    fn bar() -> u8 { 1 }\n+}\n+\n+fn here_we_go() {\n+    Foo::q$0\n+}\n+\"#,\n+        expect![[r#\"\n+            fn bar() (alias qux) fn() -> u8\n+        \"#]],\n+    );\n+}\n+\n+#[test]\n+fn completes_method_name_via_doc_alias_in_fn_body() {\n+    check(\n+        r#\"\n+struct Foo {\n+    bar: u8\n+}\n+impl Foo {\n+    #[doc(alias = \"qux\")]\n+    fn baz(&self) -> u8 {\n+        self.bar\n+    }\n+}\n+\n+fn here_we_go() {\n+    let foo = Foo { field: 42 };\n+    foo.q$0\n+}\n+\"#,\n+        expect![[r#\"\n+            fd bar               u8\n+            me baz() (alias qux) fn(&self) -> u8\n+            sn box               Box::new(expr)\n+            sn call              function(expr)\n+            sn dbg               dbg!(expr)\n+            sn dbgr              dbg!(&expr)\n+            sn let               let\n+            sn letm              let mut\n+            sn match             match expr {}\n+            sn ref               &expr\n+            sn refm              &mut expr\n+            sn unsafe            unsafe {}\n+        \"#]],\n+    );\n+}\n+\n #[test]\n fn completes_fn_name_via_doc_alias_in_fn_body() {\n     check("}, {"sha": "f230cba2bf828cd1a6a9901b261f2de5532d9d91", "filename": "crates/rust-analyzer/tests/slow-tests/tidy.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca/crates%2Frust-analyzer%2Ftests%2Fslow-tests%2Ftidy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca/crates%2Frust-analyzer%2Ftests%2Fslow-tests%2Ftidy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Ftests%2Fslow-tests%2Ftidy.rs?ref=b198815e7fe7b5c4b2a6a5af7219ad0850ee35ca", "patch": "@@ -257,6 +257,8 @@ fn check_dbg(path: &Path, text: &str) {\n         \"ide-db/src/generated/lints.rs\",\n         // test for doc test for remove_dbg\n         \"src/tests/generated.rs\",\n+        // `expect!` string can contain `dbg!` (due to .dbg postfix)\n+        \"ide-completion/src/tests/special.rs\",\n     ];\n     if need_dbg.iter().any(|p| path.ends_with(p)) {\n         return;"}]}