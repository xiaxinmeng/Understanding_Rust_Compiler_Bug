{"sha": "5f5fa084ec89d692c251e28ca8923a75b29cb1af", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmNWZhMDg0ZWM4OWQ2OTJjMjUxZTI4Y2E4OTIzYTc1YjI5Y2IxYWY=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-06-21T14:14:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-06-21T14:14:40Z"}, "message": "Merge pull request #2864 from flip1995/issue-2862\n\nFix panic on map_clone lint", "tree": {"sha": "67a15061c72751e22e08935d15ac6ecaed4ed0a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/67a15061c72751e22e08935d15ac6ecaed4ed0a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f5fa084ec89d692c251e28ca8923a75b29cb1af", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbK7LQCRBK7hj4Ov3rIwAAdHIIAAZFtbN3Pm+tFtZPSiwAVsqh\nt4ZK/TCxCAO+8m5HOIebAyAvGjiQeGxBobZaK5bMPvPS+KhZBatYCCS4M20PimCR\nwCXv0ebtNK5KHDKculXH74EulKTgl8x6ZtexHujzSNP8bWPCH/fMPwO1jOQ251fW\nF5JInKONFrUoUpdgNGAWIaan6DDomGGJeTKq7rn9DVdpbCiav7a84X9ve4vgCzhG\ncj/YzQQ0GlI3gQcdfAvMEBvwyejzmYfPm/GEzBGDOcvmm5d1ZymupOeE10tYxKhg\nG1T2JkirAzqGFhcmvTolvDCc+9TXf6H6nRcrOBmWm4SCcMCb+O9Qhp/taDYdPuQ=\n=Y6Td\n-----END PGP SIGNATURE-----\n", "payload": "tree 67a15061c72751e22e08935d15ac6ecaed4ed0a2\nparent 25510cfb13c374d98ab0171b530d0bd887eac2c6\nparent 6224e19b80dbf5d8060d80161b128105bbf02ed1\nauthor Oliver Schneider <github35764891676564198441@oli-obk.de> 1529590480 +0200\ncommitter GitHub <noreply@github.com> 1529590480 +0200\n\nMerge pull request #2864 from flip1995/issue-2862\n\nFix panic on map_clone lint"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f5fa084ec89d692c251e28ca8923a75b29cb1af", "html_url": "https://github.com/rust-lang/rust/commit/5f5fa084ec89d692c251e28ca8923a75b29cb1af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f5fa084ec89d692c251e28ca8923a75b29cb1af/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "25510cfb13c374d98ab0171b530d0bd887eac2c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/25510cfb13c374d98ab0171b530d0bd887eac2c6", "html_url": "https://github.com/rust-lang/rust/commit/25510cfb13c374d98ab0171b530d0bd887eac2c6"}, {"sha": "6224e19b80dbf5d8060d80161b128105bbf02ed1", "url": "https://api.github.com/repos/rust-lang/rust/commits/6224e19b80dbf5d8060d80161b128105bbf02ed1", "html_url": "https://github.com/rust-lang/rust/commit/6224e19b80dbf5d8060d80161b128105bbf02ed1"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "2befba5767d7a4e16bee62b6c9d1e0b367dad098", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5f5fa084ec89d692c251e28ca8923a75b29cb1af/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f5fa084ec89d692c251e28ca8923a75b29cb1af/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=5f5fa084ec89d692c251e28ca8923a75b29cb1af", "patch": "@@ -36,7 +36,6 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n                     ExprClosure(_, ref decl, closure_eid, _, _) => {\n                         let body = cx.tcx.hir.body(closure_eid);\n                         let closure_expr = remove_blocks(&body.value);\n-                        let ty = cx.tables.pat_ty(&body.arguments[0].pat);\n                         if_chain! {\n                             // nothing special in the argument, besides reference bindings\n                             // (e.g. .map(|&x| x) )\n@@ -45,6 +44,8 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n                             // the method is being called on a known type (option or iterator)\n                             if let Some(type_name) = get_type_name(cx, expr, &args[0]);\n                             then {\n+                                // We know that body.arguments is not empty at this point\n+                                let ty = cx.tables.pat_ty(&body.arguments[0].pat);\n                                 // look for derefs, for .map(|x| *x)\n                                 if only_derefs(cx, &*closure_expr, arg_ident) &&\n                                     // .cloned() only removes one level of indirection, don't lint on more"}, {"sha": "b35df667f27ab45540a8054dc2adbdc93ace661f", "filename": "tests/run-pass/issue-2862.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5f5fa084ec89d692c251e28ca8923a75b29cb1af/tests%2Frun-pass%2Fissue-2862.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f5fa084ec89d692c251e28ca8923a75b29cb1af/tests%2Frun-pass%2Fissue-2862.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fissue-2862.rs?ref=5f5fa084ec89d692c251e28ca8923a75b29cb1af", "patch": "@@ -0,0 +1,14 @@\n+pub trait FooMap {\n+    fn map<B, F: Fn() -> B>(&self, f: F) -> B;\n+}\n+\n+impl FooMap for bool {\n+    fn map<B, F: Fn() -> B>(&self, f: F) -> B {\n+        f()\n+    }\n+}\n+\n+fn main() {\n+    let a = true;\n+    a.map(|| false);\n+}"}]}