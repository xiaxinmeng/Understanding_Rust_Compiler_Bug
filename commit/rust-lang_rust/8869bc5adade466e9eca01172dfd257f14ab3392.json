{"sha": "8869bc5adade466e9eca01172dfd257f14ab3392", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg4NjliYzVhZGFkZTQ2NmU5ZWNhMDExNzJkZmQyNTdmMTRhYjMzOTI=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-04-25T07:06:49Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-04-25T07:06:49Z"}, "message": "Do not suggest use over extern crate w/ alias.\n\nThis commit stops `unused_extern_crates` lints from occuring on `extern\ncrate` statements that alias the crate as the suggestion to change to a\n`use` statement would result in the aliased name no longer being added\nto the prelude, thereby causing compilation errors if other imports\nexpected this to be the case.", "tree": {"sha": "b3295e30a83f60281b88919e1b65e27fae307a57", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b3295e30a83f60281b88919e1b65e27fae307a57"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8869bc5adade466e9eca01172dfd257f14ab3392", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlzBXQIACgkQAXYLT59T\n8VRm3A/9GISUZYzpKqpGGKcI53Rc0zaAOjZa0WNlAWowHXbTLmlDYxU0ND7jsW75\nKsnkhxfdEPgrZI9/FWcL2WWoNT6nNoHCLKC/lCkIrXt/bJVeVb6NILo5AgA0sKpe\nPmokvtkE6PGd+4dICBaNpELx0wfOW38m9q3NI+3JzJO3joTQsVVwQh8vDmqsFRJK\nNs9prz32vwr7/q94OafVQ6GRl6E5xm9pjyaIZ61OXRf8FP5R0zSmBnKOjAZGJg71\nOPUwooSkLIigfJLA2QnL7upCm5G12EuhxxtPzrC0lHrTfugvK7pcWb6xL8Dc+5KS\nckoZhTKeRuPEk4KejMXTzcxycU3BkbQZakFMgYyKhHwF5q5xYiiGIydFGKlGfYbG\nDGBrFTJ8CNhCIAfatjM4R4LyrO6qDMYDcAmMCoA7ms6cOOebfCJs+fX4q5wGkOll\n5zlEg7Z2/Ofu46hMG67u+IzuHWVffoC1IQSKPytbKIrLA3MaJJZ+1iOnTYFvI+bI\nz78z0f9CS+iTDLlZ7Jy88sMwTLvW+SupsEEwrJg4GCaossB9ShO+V+m4Dx7bZWr9\nYhZXMobXLNoCPHa0MD+dCl/8pNx//fe+IaBKmDTIE+7IXOP3IGWlFrXYy5E0uvVu\njoiYQdGKkHy9b7ZJDWx4kXl0WLqNN0FNtSeTTLttD7AFUF1Dy3k=\n=qe9q\n-----END PGP SIGNATURE-----", "payload": "tree b3295e30a83f60281b88919e1b65e27fae307a57\nparent 8a47e088458866b6dd8aa28acc9db1e9e22be997\nauthor David Wood <david@davidtw.co> 1556176009 +0100\ncommitter David Wood <david@davidtw.co> 1556176009 +0100\n\nDo not suggest use over extern crate w/ alias.\n\nThis commit stops `unused_extern_crates` lints from occuring on `extern\ncrate` statements that alias the crate as the suggestion to change to a\n`use` statement would result in the aliased name no longer being added\nto the prelude, thereby causing compilation errors if other imports\nexpected this to be the case.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8869bc5adade466e9eca01172dfd257f14ab3392", "html_url": "https://github.com/rust-lang/rust/commit/8869bc5adade466e9eca01172dfd257f14ab3392", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8869bc5adade466e9eca01172dfd257f14ab3392/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a47e088458866b6dd8aa28acc9db1e9e22be997", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a47e088458866b6dd8aa28acc9db1e9e22be997", "html_url": "https://github.com/rust-lang/rust/commit/8a47e088458866b6dd8aa28acc9db1e9e22be997"}], "stats": {"total": 107, "additions": 41, "deletions": 66}, "files": [{"sha": "3c3509f24ce1eb97000433d6245363ec14f114dd", "filename": "src/librustc_typeck/check_unused.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Flibrustc_typeck%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Flibrustc_typeck%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck_unused.rs?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -158,6 +158,13 @@ fn unused_crates_lint<'tcx>(tcx: TyCtxt<'_, 'tcx, 'tcx>) {\n             continue;\n         }\n \n+        // If the extern crate is renamed, then we cannot suggest replacing it with a use as this\n+        // would not insert the new name into the prelude, where other imports in the crate may be\n+        // expecting it.\n+        if extern_crate.orig_name.is_some() {\n+            continue;\n+        }\n+\n         // If the extern crate has any attributes, they may have funky\n         // semantics we can't faithfully represent using `use` (most\n         // notably `#[macro_use]`). Ignore it."}, {"sha": "26150c7d4a16b77de5f4a76803006e4b48e3bf24", "filename": "src/test/ui/imports/extern-crate-used.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -5,10 +5,14 @@\n \n #![deny(unused_extern_crates)]\n \n-extern crate core as iso1; //~ ERROR `extern crate` is not idiomatic in the new edition\n-extern crate core as iso2; //~ ERROR `extern crate` is not idiomatic in the new edition\n-extern crate core as iso3; //~ ERROR `extern crate` is not idiomatic in the new edition\n-extern crate core as iso4; //~ ERROR `extern crate` is not idiomatic in the new edition\n+// Shouldn't suggest changing to `use`, as new name\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use the new name in\n+// other modules. See #57672.\n+extern crate core as iso1;\n+extern crate core as iso2;\n+extern crate core as iso3;\n+extern crate core as iso4;\n \n // Doesn't introduce its extern prelude entry, so it's still considered unused.\n extern crate core; //~ ERROR unused extern crate"}, {"sha": "397bfa02902c94df7528429b07a8e60dfd17e853", "filename": "src/test/ui/imports/extern-crate-used.stderr", "status": "modified", "additions": 5, "deletions": 29, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -1,38 +1,14 @@\n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:8:1\n+error: unused extern crate\n+  --> $DIR/extern-crate-used.rs:18:1\n    |\n-LL | extern crate core as iso1;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+LL | extern crate core;\n+   | ^^^^^^^^^^^^^^^^^^ help: remove it\n    |\n note: lint level defined here\n   --> $DIR/extern-crate-used.rs:6:9\n    |\n LL | #![deny(unused_extern_crates)]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:9:1\n-   |\n-LL | extern crate core as iso2;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:10:1\n-   |\n-LL | extern crate core as iso3;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:11:1\n-   |\n-LL | extern crate core as iso4;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: unused extern crate\n-  --> $DIR/extern-crate-used.rs:14:1\n-   |\n-LL | extern crate core;\n-   | ^^^^^^^^^^^^^^^^^^ help: remove it\n-\n-error: aborting due to 5 previous errors\n+error: aborting due to previous error\n "}, {"sha": "e51ce5d1d5b83e48bfc48e65be4538175ec9178b", "filename": "src/test/ui/rust-2018/extern-crate-idiomatic-in-2018.fixed", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.fixed?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -12,8 +12,11 @@\n \n //~^ ERROR unused extern crate\n \n-use edition_lint_paths as bar;\n-//~^ ERROR `extern crate` is not idiomatic in the new edition\n+// Shouldn't suggest changing to `use`, as `bar`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `bar` in other\n+// modules. See #57672.\n+extern crate edition_lint_paths as bar;\n \n fn main() {\n     // This is not considered to *use* the `extern crate` in Rust 2018:"}, {"sha": "debbf085d618293d1ed901a4e535cf6f21414fbc", "filename": "src/test/ui/rust-2018/extern-crate-idiomatic-in-2018.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.rs?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -12,8 +12,11 @@\n extern crate edition_lint_paths;\n //~^ ERROR unused extern crate\n \n+// Shouldn't suggest changing to `use`, as `bar`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `bar` in other\n+// modules. See #57672.\n extern crate edition_lint_paths as bar;\n-//~^ ERROR `extern crate` is not idiomatic in the new edition\n \n fn main() {\n     // This is not considered to *use* the `extern crate` in Rust 2018:"}, {"sha": "13980c70a82aa219082d4271dd59b17112c8f498", "filename": "src/test/ui/rust-2018/extern-crate-idiomatic-in-2018.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.stderr?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -11,11 +11,5 @@ LL | #![deny(rust_2018_idioms)]\n    |         ^^^^^^^^^^^^^^^^\n    = note: #[deny(unused_extern_crates)] implied by #[deny(rust_2018_idioms)]\n \n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-idiomatic-in-2018.rs:15:1\n-   |\n-LL | extern crate edition_lint_paths as bar;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n "}, {"sha": "14575d18c236aa3275b669bdaae93c6bd1f1c887", "filename": "src/test/ui/rust-2018/remove-extern-crate.fixed", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -7,7 +7,11 @@\n #![warn(rust_2018_idioms)]\n \n \n-use core as another_name;\n+// Shouldn't suggest changing to `use`, as `another_name`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `another_name` in other\n+// modules. See #57672.\n+extern crate core as another_name;\n use remove_extern_crate;\n #[macro_use]\n extern crate remove_extern_crate as something_else;"}, {"sha": "0ee85f34e40d99c98bbdb9bbc1649af77bcec8b5", "filename": "src/test/ui/rust-2018/remove-extern-crate.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -7,6 +7,10 @@\n #![warn(rust_2018_idioms)]\n \n extern crate core;\n+// Shouldn't suggest changing to `use`, as `another_name`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `another_name` in other\n+// modules. See #57672.\n extern crate core as another_name;\n use remove_extern_crate;\n #[macro_use]"}, {"sha": "5de0dfe961338701d99e17fa1cfac2b5d848cf08", "filename": "src/test/ui/rust-2018/remove-extern-crate.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -12,13 +12,7 @@ LL | #![warn(rust_2018_idioms)]\n    = note: #[warn(unused_extern_crates)] implied by #[warn(rust_2018_idioms)]\n \n warning: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/remove-extern-crate.rs:10:1\n-   |\n-LL | extern crate core as another_name;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-warning: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/remove-extern-crate.rs:28:5\n+  --> $DIR/remove-extern-crate.rs:32:5\n    |\n LL |     extern crate core;\n    |     ^^^^^^^^^^^^^^^^^^ help: convert it to a `use`"}, {"sha": "1773f72fc741c4476a7507f3d20b31abacaf83ea", "filename": "src/test/ui/suggestions/issue-57672.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8869bc5adade466e9eca01172dfd257f14ab3392/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.rs?ref=8869bc5adade466e9eca01172dfd257f14ab3392", "patch": "@@ -1,11 +1,11 @@\n // aux-build:foo.rs\n // compile-flags:--extern foo\n+// compile-pass\n // edition:2018\n \n #![deny(unused_extern_crates)]\n \n extern crate foo as foo_renamed;\n-//~^ ERROR `extern crate` is not idiomatic in the new edition\n \n pub mod m {\n     pub use foo_renamed::Foo;"}, {"sha": "c9e4c373799e133c07dac73b0b57672ec9e7d96e", "filename": "src/test/ui/suggestions/issue-57672.stderr", "status": "removed", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/8a47e088458866b6dd8aa28acc9db1e9e22be997/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a47e088458866b6dd8aa28acc9db1e9e22be997/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.stderr?ref=8a47e088458866b6dd8aa28acc9db1e9e22be997", "patch": "@@ -1,14 +0,0 @@\n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/issue-57672.rs:7:1\n-   |\n-LL | extern crate foo as foo_renamed;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-   |\n-note: lint level defined here\n-  --> $DIR/issue-57672.rs:5:9\n-   |\n-LL | #![deny(unused_extern_crates)]\n-   |         ^^^^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to previous error\n-"}]}