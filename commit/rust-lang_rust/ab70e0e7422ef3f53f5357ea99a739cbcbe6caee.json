{"sha": "ab70e0e7422ef3f53f5357ea99a739cbcbe6caee", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFiNzBlMGU3NDIyZWYzZjUzZjUzNTdlYTk5YTczOWNiY2JlNmNhZWU=", "commit": {"author": {"name": "Konrad Borowski", "email": "konrad@borowski.pw", "date": "2018-12-29T17:07:10Z"}, "committer": {"name": "Konrad Borowski", "email": "konrad@borowski.pw", "date": "2018-12-29T17:08:53Z"}, "message": "Use an FxHashSet for valid idents in documentation lint", "tree": {"sha": "da756ae4c937df81df53ebfc061e66386ec3230e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da756ae4c937df81df53ebfc061e66386ec3230e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee", "html_url": "https://github.com/rust-lang/rust/commit/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee/comments", "author": {"login": "xfix", "id": 1297598, "node_id": "MDQ6VXNlcjEyOTc1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xfix", "html_url": "https://github.com/xfix", "followers_url": "https://api.github.com/users/xfix/followers", "following_url": "https://api.github.com/users/xfix/following{/other_user}", "gists_url": "https://api.github.com/users/xfix/gists{/gist_id}", "starred_url": "https://api.github.com/users/xfix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xfix/subscriptions", "organizations_url": "https://api.github.com/users/xfix/orgs", "repos_url": "https://api.github.com/users/xfix/repos", "events_url": "https://api.github.com/users/xfix/events{/privacy}", "received_events_url": "https://api.github.com/users/xfix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xfix", "id": 1297598, "node_id": "MDQ6VXNlcjEyOTc1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xfix", "html_url": "https://github.com/xfix", "followers_url": "https://api.github.com/users/xfix/followers", "following_url": "https://api.github.com/users/xfix/following{/other_user}", "gists_url": "https://api.github.com/users/xfix/gists{/gist_id}", "starred_url": "https://api.github.com/users/xfix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xfix/subscriptions", "organizations_url": "https://api.github.com/users/xfix/orgs", "repos_url": "https://api.github.com/users/xfix/repos", "events_url": "https://api.github.com/users/xfix/events{/privacy}", "received_events_url": "https://api.github.com/users/xfix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d60841205d10293d6759df1948acda4c607c7eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d60841205d10293d6759df1948acda4c607c7eb", "html_url": "https://github.com/rust-lang/rust/commit/4d60841205d10293d6759df1948acda4c607c7eb"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "a3504e7e3303d777220ae1111ce6e7402a2ed1c0", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=ab70e0e7422ef3f53f5357ea99a739cbcbe6caee", "patch": "@@ -12,6 +12,7 @@ use itertools::Itertools;\n use pulldown_cmark;\n use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n use rustc::{declare_tool_lint, lint_array};\n+use rustc_data_structures::fx::FxHashSet;\n use syntax::ast;\n use syntax::source_map::{BytePos, Span};\n use syntax_pos::Pos;\n@@ -43,11 +44,11 @@ declare_clippy_lint! {\n \n #[derive(Clone)]\n pub struct Doc {\n-    valid_idents: Vec<String>,\n+    valid_idents: FxHashSet<String>,\n }\n \n impl Doc {\n-    pub fn new(valid_idents: Vec<String>) -> Self {\n+    pub fn new(valid_idents: FxHashSet<String>) -> Self {\n         Self { valid_idents }\n     }\n }\n@@ -144,7 +145,7 @@ pub fn strip_doc_comment_decoration(comment: &str, span: Span) -> (String, Vec<(\n     panic!(\"not a doc-comment: {}\", comment);\n }\n \n-pub fn check_attrs<'a>(cx: &EarlyContext<'_>, valid_idents: &[String], attrs: &'a [ast::Attribute]) {\n+pub fn check_attrs<'a>(cx: &EarlyContext<'_>, valid_idents: &FxHashSet<String>, attrs: &'a [ast::Attribute]) {\n     let mut doc = String::new();\n     let mut spans = vec![];\n \n@@ -192,7 +193,7 @@ pub fn check_attrs<'a>(cx: &EarlyContext<'_>, valid_idents: &[String], attrs: &'\n \n fn check_doc<'a, Events: Iterator<Item = (usize, pulldown_cmark::Event<'a>)>>(\n     cx: &EarlyContext<'_>,\n-    valid_idents: &[String],\n+    valid_idents: &FxHashSet<String>,\n     docs: Events,\n     spans: &[(usize, Span)],\n ) {\n@@ -237,14 +238,14 @@ fn check_doc<'a, Events: Iterator<Item = (usize, pulldown_cmark::Event<'a>)>>(\n     }\n }\n \n-fn check_text(cx: &EarlyContext<'_>, valid_idents: &[String], text: &str, span: Span) {\n+fn check_text(cx: &EarlyContext<'_>, valid_idents: &FxHashSet<String>, text: &str, span: Span) {\n     for word in text.split(|c: char| c.is_whitespace() || c == '\\'') {\n         // Trim punctuation as in `some comment (see foo::bar).`\n         //                                                   ^^\n         // Or even as in `_foo bar_` which is emphasized.\n         let word = word.trim_matches(|c: char| !c.is_alphanumeric());\n \n-        if valid_idents.iter().any(|i| i == word) {\n+        if valid_idents.contains(word) {\n             continue;\n         }\n "}, {"sha": "cfa99b0b75a0a6de722d06be6cf4a79709c74e67", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab70e0e7422ef3f53f5357ea99a739cbcbe6caee/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=ab70e0e7422ef3f53f5357ea99a739cbcbe6caee", "patch": "@@ -425,7 +425,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n     reg.register_late_lint_pass(box new_without_default::NewWithoutDefault::default());\n     reg.register_late_lint_pass(box blacklisted_name::BlackListedName::new(conf.blacklisted_names.clone()));\n     reg.register_late_lint_pass(box functions::Functions::new(conf.too_many_arguments_threshold));\n-    reg.register_early_lint_pass(box doc::Doc::new(conf.doc_valid_idents.clone()));\n+    reg.register_early_lint_pass(box doc::Doc::new(conf.doc_valid_idents.iter().cloned().collect()));\n     reg.register_late_lint_pass(box neg_multiply::NegMultiply);\n     reg.register_early_lint_pass(box unsafe_removed_from_name::UnsafeNameRemoval);\n     reg.register_late_lint_pass(box mem_discriminant::MemDiscriminant);"}]}