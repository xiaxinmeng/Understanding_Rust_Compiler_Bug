{"sha": "9db4d9c6fd783dfed799f724e7122b9d50087d6e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkYjRkOWM2ZmQ3ODNkZmVkNzk5ZjcyNGU3MTIyYjlkNTAwODdkNmU=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-08-25T07:49:44Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-08-29T07:01:27Z"}, "message": "Add CFG_USE_SNAP_LIBS_FOR_STAGE1 hack to makefiles", "tree": {"sha": "4b1eccb2991fabb79abf76a3e57c716c3e33f722", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b1eccb2991fabb79abf76a3e57c716c3e33f722"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9db4d9c6fd783dfed799f724e7122b9d50087d6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9db4d9c6fd783dfed799f724e7122b9d50087d6e", "html_url": "https://github.com/rust-lang/rust/commit/9db4d9c6fd783dfed799f724e7122b9d50087d6e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9db4d9c6fd783dfed799f724e7122b9d50087d6e/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4eb86d4978d06f97422021beac0c9c2cc57aa79b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4eb86d4978d06f97422021beac0c9c2cc57aa79b", "html_url": "https://github.com/rust-lang/rust/commit/4eb86d4978d06f97422021beac0c9c2cc57aa79b"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "9ab91c40a0f4aba9ef81a6ac034f84787b2690ba", "filename": "Makefile.in", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9db4d9c6fd783dfed799f724e7122b9d50087d6e/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/9db4d9c6fd783dfed799f724e7122b9d50087d6e/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=9db4d9c6fd783dfed799f724e7122b9d50087d6e", "patch": "@@ -57,6 +57,13 @@ else\n   CFG_STDLIB_DEFAULT = $(2)/$(CFG_STDLIB)\n endif\n \n+# Uncomment this to temporarily use the snapshot's runtime for stage1.\n+# This is useful when making incompatible changes to the parts of the\n+# runtime used directly by the compiler -- the binaries built by the\n+# snapshot won't know about the changes yet. Don't leave this on. Turn\n+# it on, shapshot, and turn it off again.\n+# CFG_USE_SNAP_LIBS_FOR_STAGE1 = 1\n+\n # version-string calculation\n CFG_GIT_DIR := $(CFG_SRC_DIR).git\n CFG_VERSION = prerelease"}, {"sha": "dc3778968ea515da4a87f4b2705491100fa9fe97", "filename": "mk/stageN.mk", "status": "modified", "additions": 23, "deletions": 3, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/9db4d9c6fd783dfed799f724e7122b9d50087d6e/mk%2FstageN.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9db4d9c6fd783dfed799f724e7122b9d50087d6e/mk%2FstageN.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2FstageN.mk?ref=9db4d9c6fd783dfed799f724e7122b9d50087d6e", "patch": "@@ -8,6 +8,15 @@\n # new rustrt in stage0/lib/.\n \n define LIBGEN\n+\n+ifdef CFG_USE_SNAP_LIBS_FOR_STAGE1\n+ifeq ($(2), 0)\n+RUNTIME_SOURCE = stage0/$(CFG_RUNTIME)\n+stage$(2)/lib/$$(CFG_STDLIB): stage0/$$(CFG_STDLIB)\n+\t@$$(call E, cp: $$@)\n+\t$$(Q)cp $$< $$@\n+else\n+RUNTIME_SOURCE = rt/$(CFG_RUNTIME)\n stage$(2)/lib/$$(CFG_STDLIB): $$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n                               stage$(2)/rustc$$(X)               \\\n                               stage$(2)/$$(CFG_RUNTIME)          \\\n@@ -16,6 +25,8 @@ stage$(2)/lib/$$(CFG_STDLIB): $$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n                               $$(SREQ$(1))\n \t@$$(call E, compile_and_link: $$@)\n \t$$(STAGE$(2))  --lib -o $$@ $$<\n+endif\n+endif\n \n stage$(2)/lib/libstd.rlib: $$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n                            stage$(2)/rustc$$(X)               \\\n@@ -26,7 +37,7 @@ stage$(2)/lib/libstd.rlib: $$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n \t@$$(call E, compile_and_link: $$@)\n \t$$(STAGE$(2)) --lib --static -o $$@ $$<\n \n-stage$(2)/lib/$$(CFG_RUNTIME): rt/$$(CFG_RUNTIME)\n+stage$(2)/lib/$$(CFG_RUNTIME): $$(RUNTIME_SOURCE)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n@@ -58,11 +69,20 @@ stage$(2)/rustc$$(X): $$(COMPILER_CRATE) $$(COMPILER_INPUTS)          \\\n \t@$$(call E, compile_and_link: $$@)\n \t$$(STAGE$(1)) -L stage$(2) -o $$@ $$<\n \n-stage$(2)/$$(CFG_RUNTIME): rt/$$(CFG_RUNTIME)\n+RUNTIME_SOURCE = rt/$(CFG_RUNTIME)\n+STDLIB_SOURCE = stage$(1)/lib/$$(CFG_STDLIB)\n+ifdef CFG_USE_SNAP_LIBS_FOR_STAGE1\n+  ifeq ($(2), 1)\n+    RUNTIME_SOURCE = stage0/$(CFG_RUNTIME)\n+    STDLIB_SOURCE = stage0/$(CFG_STDLIB)\n+  endif\n+endif\n+\n+stage$(2)/$$(CFG_RUNTIME): $$(RUNTIME_SOURCE)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-stage$(2)/$$(CFG_STDLIB): stage$(1)/lib/$$(CFG_STDLIB)\n+stage$(2)/$$(CFG_STDLIB): $$(STDLIB_SOURCE)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n "}]}