{"sha": "513a263e81eff098762e1531bc4d13366da0e554", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxM2EyNjNlODFlZmYwOTg3NjJlMTUzMWJjNGQxMzM2NmRhMGU1NTQ=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-01-03T20:18:53Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-01-03T20:18:53Z"}, "message": "Merge pull request #1392 from Lenny222/list\n\nlist: add \"is_not_empty\" requirement to \"head\" and \"tail\" (analogous to \"vec\")", "tree": {"sha": "eff25c9c3e15e57d4d308f0a6028b2d625fb1b8a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eff25c9c3e15e57d4d308f0a6028b2d625fb1b8a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/513a263e81eff098762e1531bc4d13366da0e554", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/513a263e81eff098762e1531bc4d13366da0e554", "html_url": "https://github.com/rust-lang/rust/commit/513a263e81eff098762e1531bc4d13366da0e554", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/513a263e81eff098762e1531bc4d13366da0e554/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e88d5ae92af1ebfb1d23e027db7133c669cca69", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e88d5ae92af1ebfb1d23e027db7133c669cca69", "html_url": "https://github.com/rust-lang/rust/commit/4e88d5ae92af1ebfb1d23e027db7133c669cca69"}, {"sha": "ab2a643f278d09c3fcc140ecb4c7cecbf1aff3c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab2a643f278d09c3fcc140ecb4c7cecbf1aff3c4", "html_url": "https://github.com/rust-lang/rust/commit/ab2a643f278d09c3fcc140ecb4c7cecbf1aff3c4"}], "stats": {"total": 103, "additions": 87, "deletions": 16}, "files": [{"sha": "78301c812023283ff9e209e82b31b75320c351c9", "filename": "src/comp/middle/last_use.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/513a263e81eff098762e1531bc4d13366da0e554/src%2Fcomp%2Fmiddle%2Flast_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/513a263e81eff098762e1531bc4d13366da0e554/src%2Fcomp%2Fmiddle%2Flast_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Flast_use.rs?ref=513a263e81eff098762e1531bc4d13366da0e554", "patch": "@@ -1,7 +1,7 @@\n import syntax::{visit, ast_util};\n import syntax::ast::*;\n import syntax::codemap::span;\n-import std::list::{list, nil, cons, tail};\n+import std::list::{is_not_empty, list, nil, cons, tail};\n import core::{vec, option};\n import std::list;\n \n@@ -192,7 +192,9 @@ fn visit_block(tp: block_type, cx: ctx, visit: block()) {\n     visit();\n     local.second = true;\n     visit();\n-    cx.blocks = tail(cx.blocks);\n+    let cx_blocks = cx.blocks;\n+    check is_not_empty(cx_blocks);\n+    cx.blocks = tail(cx_blocks);\n     cx.current = join_branches(local.exits);\n }\n "}, {"sha": "939884c0ddfaa33188836367916ea4a07f864709", "filename": "src/comp/middle/resolve.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/513a263e81eff098762e1531bc4d13366da0e554/src%2Fcomp%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/513a263e81eff098762e1531bc4d13366da0e554/src%2Fcomp%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fresolve.rs?ref=513a263e81eff098762e1531bc4d13366da0e554", "patch": "@@ -266,6 +266,7 @@ fn map_crate(e: @env, c: @ast::crate) {\n             let imp = follow_import(*e, sc, *path, vi.span);\n             if option::is_some(imp) {\n                 let glob = {def: option::get(imp), item: vi};\n+                check list::is_not_empty(sc);\n                 alt list::head(sc) {\n                   scope_item(i) {\n                     e.mod_map.get(i.id).glob_imports += [glob];\n@@ -461,6 +462,7 @@ fn visit_block_with_scope(b: ast::blk, sc: scopes, v: vt<scopes>) {\n }\n \n fn visit_decl_with_scope(d: @decl, sc: scopes, v: vt<scopes>) {\n+    check list::is_not_empty(sc);\n     let loc_pos = alt list::head(sc) {\n       scope_block(_, _, pos) { pos }\n       _ { @mutable 0u }"}, {"sha": "f6b46ed7d2e86f4538e947445570da5cffa14912", "filename": "src/libstd/list.rs", "status": "modified", "additions": 31, "deletions": 4, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/513a263e81eff098762e1531bc4d13366da0e554/src%2Flibstd%2Flist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/513a263e81eff098762e1531bc4d13366da0e554/src%2Flibstd%2Flist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flist.rs?ref=513a263e81eff098762e1531bc4d13366da0e554", "patch": "@@ -97,6 +97,27 @@ fn has<copy T>(ls: list<T>, elt: T) -> bool {\n     ret false;\n }\n \n+/*\n+Function: is_empty\n+\n+Returns true if the list is empty.\n+*/\n+pure fn is_empty<copy T>(ls: list<T>) -> bool {\n+    alt ls {\n+        nil. { true }\n+        _ { false }\n+    }\n+}\n+\n+/*\n+Function: is_not_empty\n+\n+Returns true if the list is not empty.\n+*/\n+pure fn is_not_empty<copy T>(ls: list<T>) -> bool {\n+    ret !is_empty(ls);\n+}\n+\n /*\n Function: len\n \n@@ -112,17 +133,23 @@ Function: tail\n \n Returns all but the first element of a list\n */\n-pure fn tail<copy T>(ls: list<T>) -> list<T> {\n-    alt ls { cons(_, tl) { ret *tl; } nil. { fail \"list empty\" } }\n+pure fn tail<copy T>(ls: list<T>) : is_not_empty(ls) -> list<T> {\n+    alt ls {\n+        cons(_, tl) { ret *tl; }\n+        nil. { fail \"list empty\" }\n+    }\n }\n \n /*\n Function: head\n \n Returns the first element of a list\n */\n-pure fn head<copy T>(ls: list<T>) -> T {\n-    alt ls { cons(hd, _) { ret hd; } nil. { fail \"list empty\" } }\n+pure fn head<copy T>(ls: list<T>) : is_not_empty(ls) -> T {\n+    alt ls {\n+        cons(hd, _) { ret hd; }\n+        nil. { fail \"list empty\" }\n+    }\n }\n \n /*"}, {"sha": "27f3b530154dbcd29d6e7881827f334bf798a60d", "filename": "src/test/run-pass/non-boolean-pure-fns.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/513a263e81eff098762e1531bc4d13366da0e554/src%2Ftest%2Frun-pass%2Fnon-boolean-pure-fns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/513a263e81eff098762e1531bc4d13366da0e554/src%2Ftest%2Frun-pass%2Fnon-boolean-pure-fns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fnon-boolean-pure-fns.rs?ref=513a263e81eff098762e1531bc4d13366da0e554", "patch": "@@ -14,7 +14,10 @@ pure fn nonempty_list<copy T>(ls: list<T>) -> bool { pure_length(ls) > 0u }\n // knowledge that ls is a cons node. Future work.\n // Also, this is pretty contrived since nonempty_list\n // could be a \"tag refinement\", if we implement those.\n-fn safe_head<copy T>(ls: list<T>) : nonempty_list(ls) -> T { head(ls) }\n+fn safe_head<copy T>(ls: list<T>) : nonempty_list(ls) -> T {\n+    check is_not_empty(ls);\n+    ret head(ls);\n+}\n \n fn main() {\n     let mylist = cons(@1u, @nil);"}, {"sha": "035b18f805125e060a218c85cbfa1f57fe417c73", "filename": "src/test/run-pass/unchecked-predicates.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/513a263e81eff098762e1531bc4d13366da0e554/src%2Ftest%2Frun-pass%2Funchecked-predicates.rs", "raw_url": "https://github.com/rust-lang/rust/raw/513a263e81eff098762e1531bc4d13366da0e554/src%2Ftest%2Frun-pass%2Funchecked-predicates.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Funchecked-predicates.rs?ref=513a263e81eff098762e1531bc4d13366da0e554", "patch": "@@ -1,12 +1,17 @@\n // Uses foldl to exhibit the unchecked block syntax.\n+// TODO: since list's head/tail require the predicate \"is_not_empty\" now and\n+// we have unit tests for list, this test might me not necessary anymore?\n use std;\n \n import std::list::*;\n \n // Can't easily be written as a \"pure fn\" because there's\n // no syntax for specifying that f is pure.\n fn pure_foldl<copy T, copy U>(ls: list<T>, u: U, f: block(T, U) -> U) -> U {\n-    alt ls { nil. { u } cons(hd, tl) { f(hd, pure_foldl(*tl, f(hd, u), f)) } }\n+    alt ls {\n+        nil. { u }\n+        cons(hd, tl) { f(hd, pure_foldl(*tl, f(hd, u), f)) }\n+    }\n }\n \n // Shows how to use an \"unchecked\" block to call a general\n@@ -22,7 +27,10 @@ pure fn nonempty_list<copy T>(ls: list<T>) -> bool { pure_length(ls) > 0u }\n // knowledge that ls is a cons node. Future work.\n // Also, this is pretty contrived since nonempty_list\n // could be a \"tag refinement\", if we implement those.\n-fn safe_head<copy T>(ls: list<T>) : nonempty_list(ls) -> T { head(ls) }\n+fn safe_head<copy T>(ls: list<T>) : nonempty_list(ls) -> T {\n+    check is_not_empty(ls);\n+    ret head(ls)\n+}\n \n fn main() {\n     let mylist = cons(@1u, @nil);"}, {"sha": "b96bc9cd16a56b9ae856a00995d3fc1c17d66b18", "filename": "src/test/stdtest/list.rs", "status": "modified", "additions": 36, "deletions": 7, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/513a263e81eff098762e1531bc4d13366da0e554/src%2Ftest%2Fstdtest%2Flist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/513a263e81eff098762e1531bc4d13366da0e554/src%2Ftest%2Fstdtest%2Flist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fstdtest%2Flist.rs?ref=513a263e81eff098762e1531bc4d13366da0e554", "patch": "@@ -2,17 +2,38 @@ import core::*;\n \n use std;\n import std::list;\n-import std::list::head;\n-import std::list::tail;\n-import std::list::from_vec;\n+import std::list::{from_vec, head, is_empty, is_not_empty, tail};\n import option;\n \n+#[test]\n+fn test_is_empty() {\n+    let empty : list::list<int> = from_vec([]);\n+    let full1 = from_vec([1]);\n+    let full2 = from_vec(['r', 'u']);\n+\n+    assert is_empty(empty);\n+    assert !is_empty(full1);\n+    assert !is_empty(full2);\n+\n+    assert !is_not_empty(empty);\n+    assert is_not_empty(full1);\n+    assert is_not_empty(full2);\n+}\n+\n #[test]\n fn test_from_vec() {\n     let l = from_vec([0, 1, 2]);\n+\n+    check is_not_empty(l);\n     assert (head(l) == 0);\n-    assert (head(tail(l)) == 1);\n-    assert (head(tail(tail(l))) == 2);\n+\n+    let tail_l = tail(l);\n+    check is_not_empty(tail_l);\n+    assert (head(tail_l) == 1);\n+\n+    let tail_tail_l = tail(tail_l);\n+    check is_not_empty(tail_tail_l);\n+    assert (head(tail_tail_l) == 2);\n }\n \n #[test]\n@@ -24,9 +45,17 @@ fn test_from_vec_empty() {\n #[test]\n fn test_from_vec_mut() {\n     let l = from_vec([mutable 0, 1, 2]);\n+\n+    check is_not_empty(l);\n     assert (head(l) == 0);\n-    assert (head(tail(l)) == 1);\n-    assert (head(tail(tail(l))) == 2);\n+\n+    let tail_l = tail(l);\n+    check is_not_empty(tail_l);\n+    assert (head(tail_l) == 1);\n+\n+    let tail_tail_l = tail(tail_l);\n+    check is_not_empty(tail_tail_l);\n+    assert (head(tail_tail_l) == 2);\n }\n \n #[test]"}]}