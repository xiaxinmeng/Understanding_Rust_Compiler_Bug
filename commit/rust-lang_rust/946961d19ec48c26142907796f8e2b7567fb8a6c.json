{"sha": "946961d19ec48c26142907796f8e2b7567fb8a6c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0Njk2MWQxOWVjNDhjMjYxNDI5MDc3OTZmOGUyYjc1NjdmYjhhNmM=", "commit": {"author": {"name": "daxpedda", "email": "daxpedda@gmail.com", "date": "2019-12-05T10:06:13Z"}, "committer": {"name": "daxpedda", "email": "daxpedda@gmail.com", "date": "2019-12-05T10:06:13Z"}, "message": "Change to only detect in external macros.", "tree": {"sha": "4dce76b0ce0c017b3b4e2b5ba6961a1379ae8aee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4dce76b0ce0c017b3b4e2b5ba6961a1379ae8aee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/946961d19ec48c26142907796f8e2b7567fb8a6c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE3qx/rJh59vdc2+v9Q9YqPqOI5G8FAl3o1pUACgkQQ9YqPqOI\n5G8QPBAAmOq4lGafnDZaQr5mJ0qEQ4DHIHceNr1rByYGMfvnOtJDCoMvdndt3aEn\n6fNST4m9r+Z9ZIMtReHR1EXK5sDqENWfSc/KLQmnLoBJiUmQ4XV1H9uF9gKTWMo4\nIGhEdBrmsSz6n3EUc/JJLAyLiCOLzDuMS2MXctumEwcA0Y54ntzuBZsKVIZhUKKq\nGroaeoYWADRkUCJz22+3xeG0qGnSxGI28kicgCI9nek8tEtCH70jQMV42akjuQ47\nM4d0qc2DdmoXvZzEIwj9DadGpnIMZJeiqqRAhssa8azEyT0xixYTR9tCiG1wogrJ\ne9fRVmOS/q5j9hvcAnkTTRyykaGDQmMjxHahoYs+n1hyqA6BLhG6I5VEwyNp0zAm\nBdVCBfehqmwLdZw/qJVLmydQlXCMvyiwx1yV6mr8AZYO/6QwDZIaDYnOooRup8Sw\nbu055qf7Xl4T3QLaML2vp3Iiw4lqEzmbt/EUxOqnULi5A9Ug5EO3kY4jNTcZciyk\nJWEhf8sU9zKB/rvsGTVxHT3TS2QoxW0iVO1cOOD3ASj7fH70yKnJVgEfBB31AQyb\nysbXjs6Zu2D/u8oc7WKxXHtOoONFrpgPTff/p8PBH9PlSGsZBEhMRgTNi4fwHKoE\nTO5TRm1zLK5h0dj54SQUMiiDbAR/oyDcXy/j6XwGifJPAZvj/lk=\n=mt3R\n-----END PGP SIGNATURE-----", "payload": "tree 4dce76b0ce0c017b3b4e2b5ba6961a1379ae8aee\nparent d11b958faf4e1b9fe791eff9485a4abec28ca541\nauthor daxpedda <daxpedda@gmail.com> 1575540373 +0100\ncommitter daxpedda <daxpedda@gmail.com> 1575540373 +0100\n\nChange to only detect in external macros.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/946961d19ec48c26142907796f8e2b7567fb8a6c", "html_url": "https://github.com/rust-lang/rust/commit/946961d19ec48c26142907796f8e2b7567fb8a6c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/946961d19ec48c26142907796f8e2b7567fb8a6c/comments", "author": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d11b958faf4e1b9fe791eff9485a4abec28ca541", "url": "https://api.github.com/repos/rust-lang/rust/commits/d11b958faf4e1b9fe791eff9485a4abec28ca541", "html_url": "https://github.com/rust-lang/rust/commit/d11b958faf4e1b9fe791eff9485a4abec28ca541"}], "stats": {"total": 38, "additions": 21, "deletions": 17}, "files": [{"sha": "d0f0bd6d94c144c8173a3949ffa9032028cc2993", "filename": "clippy_lints/src/strings.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/946961d19ec48c26142907796f8e2b7567fb8a6c/clippy_lints%2Fsrc%2Fstrings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/946961d19ec48c26142907796f8e2b7567fb8a6c/clippy_lints%2Fsrc%2Fstrings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fstrings.rs?ref=946961d19ec48c26142907796f8e2b7567fb8a6c", "patch": "@@ -1,16 +1,14 @@\n use rustc::declare_lint_pass;\n use rustc::hir::*;\n-use rustc::lint::{LateContext, LateLintPass, LintArray, LintPass};\n+use rustc::lint::{in_external_macro, LateContext, LateLintPass, LintArray, LintContext, LintPass};\n use rustc_errors::Applicability;\n use rustc_session::declare_tool_lint;\n use syntax::source_map::Spanned;\n \n use if_chain::if_chain;\n \n use crate::utils::SpanlessEq;\n-use crate::utils::{\n-    get_parent_expr, in_macro, is_allowed, match_type, paths, span_lint, span_lint_and_sugg, walk_ptrs_ty,\n-};\n+use crate::utils::{get_parent_expr, is_allowed, match_type, paths, span_lint, span_lint_and_sugg, walk_ptrs_ty};\n \n declare_clippy_lint! {\n     /// **What it does:** Checks for string appends of the form `x = x + y` (without\n@@ -82,7 +80,7 @@ declare_lint_pass!(StringAdd => [STRING_ADD, STRING_ADD_ASSIGN]);\n \n impl<'a, 'tcx> LateLintPass<'a, 'tcx> for StringAdd {\n     fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, e: &'tcx Expr) {\n-        if in_macro(e.span) {\n+        if in_external_macro(cx.sess(), e.span) {\n             return;\n         }\n "}, {"sha": "504d6733abfe0f5f885f06893938e1b2f5360559", "filename": "tests/ui/auxiliary/macro_rules.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/946961d19ec48c26142907796f8e2b7567fb8a6c/tests%2Fui%2Fauxiliary%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/946961d19ec48c26142907796f8e2b7567fb8a6c/tests%2Fui%2Fauxiliary%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauxiliary%2Fmacro_rules.rs?ref=946961d19ec48c26142907796f8e2b7567fb8a6c", "patch": "@@ -31,3 +31,11 @@ macro_rules! try_err {\n         }\n     };\n }\n+\n+#[macro_export]\n+macro_rules! string_add {\n+    () => {\n+        let y = \"\".to_owned();\n+        let z = y + \"...\";\n+    };\n+}"}, {"sha": "30fd17c59e518ed931dd82d8ed01c5e64865cf62", "filename": "tests/ui/string_add.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/946961d19ec48c26142907796f8e2b7567fb8a6c/tests%2Fui%2Fstring_add.rs", "raw_url": "https://github.com/rust-lang/rust/raw/946961d19ec48c26142907796f8e2b7567fb8a6c/tests%2Fui%2Fstring_add.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstring_add.rs?ref=946961d19ec48c26142907796f8e2b7567fb8a6c", "patch": "@@ -1,3 +1,8 @@\n+// aux-build:macro_rules.rs\n+\n+#[macro_use]\n+extern crate macro_rules;\n+\n #[warn(clippy::string_add)]\n #[allow(clippy::string_add_assign, unused)]\n fn main() {\n@@ -17,12 +22,5 @@ fn main() {\n     x = x + 1;\n     assert_eq!(2, x);\n \n-    macro_rules! mac {\n-        () => {\n-            let y = \"\".to_owned();\n-            let z = y + \"...\";\n-        };\n-    }\n-\n-    mac!();\n+    string_add!();\n }"}, {"sha": "3987641c75a30c04ce8dd03626eae79188722ee4", "filename": "tests/ui/string_add.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/946961d19ec48c26142907796f8e2b7567fb8a6c/tests%2Fui%2Fstring_add.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/946961d19ec48c26142907796f8e2b7567fb8a6c/tests%2Fui%2Fstring_add.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstring_add.stderr?ref=946961d19ec48c26142907796f8e2b7567fb8a6c", "patch": "@@ -1,27 +1,27 @@\n error: manual implementation of an assign operation\n-  --> $DIR/string_add.rs:8:9\n+  --> $DIR/string_add.rs:13:9\n    |\n LL |         x = x + \".\";\n    |         ^^^^^^^^^^^ help: replace it with: `x += \".\"`\n    |\n    = note: `-D clippy::assign-op-pattern` implied by `-D warnings`\n \n error: you added something to a string. Consider using `String::push_str()` instead\n-  --> $DIR/string_add.rs:8:13\n+  --> $DIR/string_add.rs:13:13\n    |\n LL |         x = x + \".\";\n    |             ^^^^^^^\n    |\n    = note: `-D clippy::string-add` implied by `-D warnings`\n \n error: you added something to a string. Consider using `String::push_str()` instead\n-  --> $DIR/string_add.rs:12:13\n+  --> $DIR/string_add.rs:17:13\n    |\n LL |     let z = y + \"...\";\n    |             ^^^^^^^^^\n \n error: manual implementation of an assign operation\n-  --> $DIR/string_add.rs:17:5\n+  --> $DIR/string_add.rs:22:5\n    |\n LL |     x = x + 1;\n    |     ^^^^^^^^^ help: replace it with: `x += 1`"}]}