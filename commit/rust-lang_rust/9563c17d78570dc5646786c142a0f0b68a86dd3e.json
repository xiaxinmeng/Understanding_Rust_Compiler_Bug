{"sha": "9563c17d78570dc5646786c142a0f0b68a86dd3e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1NjNjMTdkNzg1NzBkYzU2NDY3ODZjMTQyYTBmMGI2OGE4NmRkM2U=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-01T02:00:19Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-01T05:47:40Z"}, "message": "Have 'make install' do something close to useful\n\nWe'll copy the files to the right location. Still need to rpath.\n\nIssue #529", "tree": {"sha": "67309235f45a899b0775fa41377a7c9c2cf38514", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/67309235f45a899b0775fa41377a7c9c2cf38514"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9563c17d78570dc5646786c142a0f0b68a86dd3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9563c17d78570dc5646786c142a0f0b68a86dd3e", "html_url": "https://github.com/rust-lang/rust/commit/9563c17d78570dc5646786c142a0f0b68a86dd3e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9563c17d78570dc5646786c142a0f0b68a86dd3e/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42287d0fd36ce914e59174aa56f3dfafda4bc01b", "url": "https://api.github.com/repos/rust-lang/rust/commits/42287d0fd36ce914e59174aa56f3dfafda4bc01b", "html_url": "https://github.com/rust-lang/rust/commit/42287d0fd36ce914e59174aa56f3dfafda4bc01b"}], "stats": {"total": 75, "additions": 69, "deletions": 6}, "files": [{"sha": "39bb0d0e1b6d726f9f3454d6bec8b44a2fb30f24", "filename": "Makefile.in", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9563c17d78570dc5646786c142a0f0b68a86dd3e/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/9563c17d78570dc5646786c142a0f0b68a86dd3e/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=9563c17d78570dc5646786c142a0f0b68a86dd3e", "patch": "@@ -163,16 +163,16 @@ LLC := $(CFG_LLVM_BINDIR)/llc$(X)\n \n define SREQ\n \n-# Destinations of artifacts for target architectures\n-TARGET_ROOT$(1)$(2) = stage$(1)/lib/rustc/$(2)\n-TARGET_BIN$(1)$(2) = $$(TARGET_ROOT$(1)$(2))/bin\n-TARGET_LIB$(1)$(2) = $$(TARGET_ROOT$(1)$(2))/lib\n-\n # Destinations of artifacts for the host compiler\n HOST_ROOT$(1) = stage$(1)\n HOST_BIN$(1) = $$(HOST_ROOT$(1))/bin\n HOST_LIB$(1) = $$(HOST_ROOT$(1))/lib\n \n+# Destinations of artifacts for target architectures\n+TARGET_ROOT$(1)$(2) = $$(HOST_LIB$(1))/rustc/$(2)\n+TARGET_BIN$(1)$(2) = $$(TARGET_ROOT$(1)$(2))/bin\n+TARGET_LIB$(1)$(2) = $$(TARGET_ROOT$(1)$(2))/lib\n+\n # The target locations of artifacts for the host architecture (used for\n # promoting target binaries to host binaries)\n TARGET_HOST_ROOT$(1) = $$(TARGET_ROOT$(1)$$(CFG_HOST_TRIPLE))\n@@ -318,3 +318,8 @@ ifneq ($(findstring clean,$(MAKECMDGOALS)),)\n   CFG_INFO := $(info cfg: including clean rules)\n   include $(CFG_SRC_DIR)/mk/clean.mk\n endif\n+\n+ifneq ($(findstring install,$(MAKECMDGOALS)),)\n+  CFG_INFO := $(info cfg: including install rules)\n+  include $(CFG_SRC_DIR)/mk/install.mk\n+endif\n\\ No newline at end of file"}, {"sha": "b54654e7a4e2e7332dd2a28b4dd568fc16b5c197", "filename": "configure", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9563c17d78570dc5646786c142a0f0b68a86dd3e/configure", "raw_url": "https://github.com/rust-lang/rust/raw/9563c17d78570dc5646786c142a0f0b68a86dd3e/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=9563c17d78570dc5646786c142a0f0b68a86dd3e", "patch": "@@ -339,6 +339,11 @@ else\n     CFG_C_COMPILER=\"gcc\"\n fi\n \n+if [ -z \"$CFG_PREFIX\" ]\n+then\n+    CFG_PREFIX=/usr/local\n+fi\n+\n if [ ! -z \"$CFG_LLVM_TRIPLE\" ]\n then\n     if [ $CFG_HOST_TRIPLE != $CFG_LLVM_TRIPLE ]\n@@ -357,8 +362,8 @@ CFG_TARGET_TRIPLES=\"${CFG_HOST_TRIPLE}\"\n putvar CFG_HOST_TRIPLE\n putvar CFG_TARGET_TRIPLES\n \n-\n putvar CFG_C_COMPILER\n+putvar CFG_PREFIX\n \n putvar CFG_LLVM_ROOT\n putvar CFG_LLVM_INCDIR"}, {"sha": "903c07d8c0d3fcc085e7a5cb55089a9b92ec4ef4", "filename": "mk/install.mk", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/9563c17d78570dc5646786c142a0f0b68a86dd3e/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9563c17d78570dc5646786c142a0f0b68a86dd3e/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=9563c17d78570dc5646786c142a0f0b68a86dd3e", "patch": "@@ -0,0 +1,53 @@\n+ifdef VERBOSE\n+ INSTALL = cp $(1)/$(3) $(2)/$(3)\n+else\n+ INSTALL = @$(call E, install $(2)/$(3)) && cp $(1)/$(3) $(2)/$(3)\n+endif\n+\n+ISTAGE = 1\n+\n+PREFIX_ROOT = $(CFG_PREFIX)\n+PREFIX_BIN = $(PREFIX_ROOT)/bin\n+PREFIX_LIB = $(PREFIX_ROOT)/lib\n+\n+HB = $(HOST_BIN$(ISTAGE))\n+HL = $(HOST_LIB$(ISTAGE))\n+PHB = $(PREFIX_BIN)\n+PHL = $(PREFIX_LIB)\n+\n+define INSTALL_TARGET_N\n+\n+PREFIX_TARGET_ROOT$(1) = $$(PREFIX_LIB)/rustc/$(1)\n+PREFIX_TARGET_BIN$(1) = $$(PREFIX_TARGET_ROOT$(1))/bin\n+PREFIX_TARGET_LIB$(1) = $$(PREFIX_TARGET_ROOT$(1))/lib\n+\n+TB$(1) = $$(TARGET_BIN$$(ISTAGE)$(1))\n+TL$(1) = $$(TARGET_LIB$$(ISTAGE)$(1))\n+PTB$(1) = $$(PREFIX_TARGET_BIN$(1))\n+PTL$(1) = $$(PREFIX_TARGET_LIB$(1))\n+\n+install-target$(1): $$(SREQ$$(ISTAGE)$(1))\n+\t$(Q)mkdir -p $$(PREFIX_TARGET_LIB$(1))\n+\t$(Q)$(call INSTALL,$$(TL$(1)),$$(PTL$(1)),$$(CFG_RUNTIME))\n+\t$(Q)$(call INSTALL,$$(TL$(1)),$$(PTL$(1)),$$(CFG_STDLIB))\n+\t$(Q)$(call INSTALL,$$(TL$(1)),$$(PTL$(1)),intrinsics.bc)\n+\t$(Q)$(call INSTALL,$$(TL$(1)),$$(PTL$(1)),main.o)\n+endef\n+\n+$(foreach target,$(CFG_TARGET_TRIPLES), \\\n+ $(eval $(call INSTALL_TARGET_N,$(target))))\n+\n+INSTALL_TARGET_RULES = $(foreach target,$(CFG_TARGET_TRIPLES), \\\n+ install-target$(target))\n+\n+install: install-host install-targets\n+\n+install-host: $(SREQ$(ISTAGE)$(CFG_HOST_TRIPLE))\n+\t$(Q)mkdir -p $(PREFIX_BIN)\n+\t$(Q)mkdir -p $(PREFIX_LIB)\n+\t$(Q)$(call INSTALL,$(HB),$(PHB),rustc$(X))\n+\t$(Q)$(call INSTALL,$(HL),$(PHL),$(CFG_RUNTIME))\n+\t$(Q)$(call INSTALL,$(HL),$(PHL),$(CFG_STDLIB))\n+\t$(Q)$(call INSTALL,$(HL),$(PHL),$(CFG_RUSTLLVM))\n+\n+install-targets: $(INSTALL_TARGET_RULES)"}]}