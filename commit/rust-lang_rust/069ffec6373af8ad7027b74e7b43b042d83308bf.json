{"sha": "069ffec6373af8ad7027b74e7b43b042d83308bf", "node_id": "C_kwDOAAsO6NoAKDA2OWZmZWM2MzczYWY4YWQ3MDI3Yjc0ZTdiNDNiMDQyZDgzMzA4YmY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-18T10:28:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-18T10:28:01Z"}, "message": "Rollup merge of #91858 - semarie:runpath, r=petrochenkov\n\npass -Wl,-z,origin to set DF_ORIGIN when using rpath\n\nDF_ORIGIN flag signifies that the object being loaded may make reference to the $ORIGIN substitution string.\n\nSome implementations are just ignoring [DF_ORIGIN](http://www.sco.com/developers/gabi/latest/ch5.dynamic.html#df_flags) and do [substitution](http://www.sco.com/developers/gabi/latest/ch5.dynamic.html#substitution) for $ORIGIN if present (whatever DF_ORIGIN presence or not) like glibc. But some others mandate the present of DF_ORIGIN for the substitution (like OpenBSD).\n\nSet the flag inconditionally if rpath is wanted.\n\nOne possible fallout is if the linker rejects `-z origin` option.", "tree": {"sha": "b63574c9a1a8720ce24a54ae2e8726e749b70747", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b63574c9a1a8720ce24a54ae2e8726e749b70747"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/069ffec6373af8ad7027b74e7b43b042d83308bf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhvbexCRBK7hj4Ov3rIwAAsvUIAHV7QkzZk0Mnl+8BKDGhz4yw\nbt7FKlYUJcQcK6lIQFWr6U8YLWdiHiEWy4qtA/O0dYlLpvzQuoEkQZJQFT5J+0WW\nh4BVb+7AZdNwkNTCwHpnRS89YpeRlu/AMbDwx4DS9FLbZAjc/Ho/O+ljbPsB1Dbv\nJkWJ41jxPZe5bW8wGZHAtuRsXBavV6Fuo4bEgJ+a96jt0uWNcAuG10FJXK60S9o/\njxhhpvOXwQ60jbnKOXRoq/a6d6KGRAYeHGpAUn7Y30rhcARrt0C/3hff3zGckSlh\niklo6pM97toh4N5YYX01Yy1pxrBz5IJTRESnlJnl4KPCtTtuLBjBaQqSI95Ws9A=\n=Y/B3\n-----END PGP SIGNATURE-----\n", "payload": "tree b63574c9a1a8720ce24a54ae2e8726e749b70747\nparent 208ced64db20bd947a2ba5c90f37936fd3ab352b\nparent c3da28eade867f731d8169a8c143e33353006e29\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1639823281 +0100\ncommitter GitHub <noreply@github.com> 1639823281 +0100\n\nRollup merge of #91858 - semarie:runpath, r=petrochenkov\n\npass -Wl,-z,origin to set DF_ORIGIN when using rpath\n\nDF_ORIGIN flag signifies that the object being loaded may make reference to the $ORIGIN substitution string.\n\nSome implementations are just ignoring [DF_ORIGIN](http://www.sco.com/developers/gabi/latest/ch5.dynamic.html#df_flags) and do [substitution](http://www.sco.com/developers/gabi/latest/ch5.dynamic.html#substitution) for $ORIGIN if present (whatever DF_ORIGIN presence or not) like glibc. But some others mandate the present of DF_ORIGIN for the substitution (like OpenBSD).\n\nSet the flag inconditionally if rpath is wanted.\n\nOne possible fallout is if the linker rejects `-z origin` option.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/069ffec6373af8ad7027b74e7b43b042d83308bf", "html_url": "https://github.com/rust-lang/rust/commit/069ffec6373af8ad7027b74e7b43b042d83308bf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/069ffec6373af8ad7027b74e7b43b042d83308bf/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "208ced64db20bd947a2ba5c90f37936fd3ab352b", "url": "https://api.github.com/repos/rust-lang/rust/commits/208ced64db20bd947a2ba5c90f37936fd3ab352b", "html_url": "https://github.com/rust-lang/rust/commit/208ced64db20bd947a2ba5c90f37936fd3ab352b"}, {"sha": "c3da28eade867f731d8169a8c143e33353006e29", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3da28eade867f731d8169a8c143e33353006e29", "html_url": "https://github.com/rust-lang/rust/commit/c3da28eade867f731d8169a8c143e33353006e29"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "0b5656c9ad12786771b15b09fee80cb54e31a6a7", "filename": "compiler/rustc_codegen_ssa/src/back/rpath.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/069ffec6373af8ad7027b74e7b43b042d83308bf/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/069ffec6373af8ad7027b74e7b43b042d83308bf/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Frpath.rs?ref=069ffec6373af8ad7027b74e7b43b042d83308bf", "patch": "@@ -23,9 +23,12 @@ pub fn get_rpath_flags(config: &mut RPathConfig<'_>) -> Vec<String> {\n     let rpaths = get_rpaths(config);\n     let mut flags = rpaths_to_flags(&rpaths);\n \n-    // Use DT_RUNPATH instead of DT_RPATH if available\n     if config.linker_is_gnu {\n+        // Use DT_RUNPATH instead of DT_RPATH if available\n         flags.push(\"-Wl,--enable-new-dtags\".to_owned());\n+\n+        // Set DF_ORIGIN for substitute $ORIGIN\n+        flags.push(\"-Wl,-z,origin\".to_owned());\n     }\n \n     flags"}, {"sha": "bbd2c087ccabbc8858f47eaae444a61d99fe1e1b", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/069ffec6373af8ad7027b74e7b43b042d83308bf/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/069ffec6373af8ad7027b74e7b43b042d83308bf/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=069ffec6373af8ad7027b74e7b43b042d83308bf", "patch": "@@ -1176,6 +1176,7 @@ impl<'a> Builder<'a> {\n                 rustflags.arg(\"-Zosx-rpath-install-name\");\n                 Some(\"-Wl,-rpath,@loader_path/../lib\")\n             } else if !target.contains(\"windows\") {\n+                rustflags.arg(\"-Clink-args=-Wl,-z,origin\");\n                 Some(\"-Wl,-rpath,$ORIGIN/../lib\")\n             } else {\n                 None"}]}