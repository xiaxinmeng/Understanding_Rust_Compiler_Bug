{"sha": "7db08eeb0057de86ea2bdbd4c3a085cb8516b653", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkYjA4ZWViMDA1N2RlODZlYTJiZGJkNGMzYTA4NWNiODUxNmI2NTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-22T05:02:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-22T05:02:50Z"}, "message": "Auto merge of #87250 - robojumper:87199-sized-relaxation, r=nikomatsakis\n\nFix implicit Sized relaxation when attempting to relax other, unsupported trait\n\nFixes #87199.\n\nDo note that this bug fix causes code like the `ref_arg::<[i32]>(&[5]);` line in the test case in combination with an affected function to no longer compile.", "tree": {"sha": "e316a0d57d088d13f9fd22aba0556f3bd003c29d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e316a0d57d088d13f9fd22aba0556f3bd003c29d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7db08eeb0057de86ea2bdbd4c3a085cb8516b653", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7db08eeb0057de86ea2bdbd4c3a085cb8516b653", "html_url": "https://github.com/rust-lang/rust/commit/7db08eeb0057de86ea2bdbd4c3a085cb8516b653", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7db08eeb0057de86ea2bdbd4c3a085cb8516b653/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8024983ea73e1d1c16720a424d39fd1c239eee68", "url": "https://api.github.com/repos/rust-lang/rust/commits/8024983ea73e1d1c16720a424d39fd1c239eee68", "html_url": "https://github.com/rust-lang/rust/commit/8024983ea73e1d1c16720a424d39fd1c239eee68"}, {"sha": "3dbe0cebd876572d7ff692041a825ed4b0a4316a", "url": "https://api.github.com/repos/rust-lang/rust/commits/3dbe0cebd876572d7ff692041a825ed4b0a4316a", "html_url": "https://github.com/rust-lang/rust/commit/3dbe0cebd876572d7ff692041a825ed4b0a4316a"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "f55e274ef8ea3f4a039c5e27696a0777e76aa794", "filename": "compiler/rustc_typeck/src/astconv/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7db08eeb0057de86ea2bdbd4c3a085cb8516b653/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7db08eeb0057de86ea2bdbd4c3a085cb8516b653/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs?ref=7db08eeb0057de86ea2bdbd4c3a085cb8516b653", "patch": "@@ -838,6 +838,7 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n                              this does nothing because the given bound is not \\\n                              a default; only `?Sized` is supported\",\n                         );\n+                        return false;\n                     }\n                 }\n             }"}, {"sha": "a80a64a2f87eed2f5beb3cc925f164912b770531", "filename": "src/test/ui/issues/issue-87199.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7db08eeb0057de86ea2bdbd4c3a085cb8516b653/src%2Ftest%2Fui%2Fissues%2Fissue-87199.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7db08eeb0057de86ea2bdbd4c3a085cb8516b653/src%2Ftest%2Fui%2Fissues%2Fissue-87199.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-87199.rs?ref=7db08eeb0057de86ea2bdbd4c3a085cb8516b653", "patch": "@@ -0,0 +1,20 @@\n+// Regression test for issue #87199, where attempting to relax a bound\n+// other than the only supported `?Sized` would still cause the compiler\n+// to assume that the `Sized` bound was relaxed.\n+\n+// check-fail\n+\n+// Check that these function definitions only emit warnings, not errors\n+fn arg<T: ?Send>(_: T) {}\n+//~^ warning: default bound relaxed for a type parameter, but this does nothing\n+fn ref_arg<T: ?Send>(_: &T) {}\n+//~^ warning: default bound relaxed for a type parameter, but this does nothing\n+fn ret() -> impl Iterator<Item = ()> + ?Send { std::iter::empty() }\n+//~^ warning: default bound relaxed for a type parameter, but this does nothing\n+\n+// Check that there's no `?Sized` relaxation!\n+fn main() {\n+    ref_arg::<i32>(&5);\n+    ref_arg::<[i32]>(&[5]);\n+    //~^ the size for values of type `[i32]` cannot be known\n+}"}, {"sha": "e3a8e82a09fd694c042ba133f7b15717ea5e8112", "filename": "src/test/ui/issues/issue-87199.stderr", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/7db08eeb0057de86ea2bdbd4c3a085cb8516b653/src%2Ftest%2Fui%2Fissues%2Fissue-87199.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7db08eeb0057de86ea2bdbd4c3a085cb8516b653/src%2Ftest%2Fui%2Fissues%2Fissue-87199.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-87199.stderr?ref=7db08eeb0057de86ea2bdbd4c3a085cb8516b653", "patch": "@@ -0,0 +1,36 @@\n+warning: default bound relaxed for a type parameter, but this does nothing because the given bound is not a default; only `?Sized` is supported\n+  --> $DIR/issue-87199.rs:8:8\n+   |\n+LL | fn arg<T: ?Send>(_: T) {}\n+   |        ^\n+\n+warning: default bound relaxed for a type parameter, but this does nothing because the given bound is not a default; only `?Sized` is supported\n+  --> $DIR/issue-87199.rs:10:12\n+   |\n+LL | fn ref_arg<T: ?Send>(_: &T) {}\n+   |            ^\n+\n+warning: default bound relaxed for a type parameter, but this does nothing because the given bound is not a default; only `?Sized` is supported\n+  --> $DIR/issue-87199.rs:12:13\n+   |\n+LL | fn ret() -> impl Iterator<Item = ()> + ?Send { std::iter::empty() }\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0277]: the size for values of type `[i32]` cannot be known at compilation time\n+  --> $DIR/issue-87199.rs:18:22\n+   |\n+LL | fn ref_arg<T: ?Send>(_: &T) {}\n+   |            - required by this bound in `ref_arg`\n+...\n+LL |     ref_arg::<[i32]>(&[5]);\n+   |                      ^^^^ doesn't have a size known at compile-time\n+   |\n+   = help: the trait `Sized` is not implemented for `[i32]`\n+help: consider relaxing the implicit `Sized` restriction\n+   |\n+LL | fn ref_arg<T: ?Send + ?Sized>(_: &T) {}\n+   |                     ^^^^^^^^\n+\n+error: aborting due to previous error; 3 warnings emitted\n+\n+For more information about this error, try `rustc --explain E0277`."}]}