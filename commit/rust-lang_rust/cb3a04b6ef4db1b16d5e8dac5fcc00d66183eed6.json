{"sha": "cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6", "node_id": "C_kwDOAAsO6NoAKGNiM2EwNGI2ZWY0ZGIxYjE2ZDVlOGRhYzVmY2MwMGQ2NjE4M2VlZDY", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-11-12T15:53:12Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-11-12T16:23:09Z"}, "message": "rustdoc: avoid excessive HTML generated in example sources", "tree": {"sha": "19eef1eb2d81bb7704e5366b1fc08a45f9a6f911", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/19eef1eb2d81bb7704e5366b1fc08a45f9a6f911"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6", "html_url": "https://github.com/rust-lang/rust/commit/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba4ae13528428cf770701ea5d9203cbf64b5a1cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba4ae13528428cf770701ea5d9203cbf64b5a1cd", "html_url": "https://github.com/rust-lang/rust/commit/ba4ae13528428cf770701ea5d9203cbf64b5a1cd"}], "stats": {"total": 21, "additions": 9, "deletions": 12}, "files": [{"sha": "1fe52353449bae38a24b9aa5c36fae10cd572c67", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6", "patch": "@@ -2899,11 +2899,7 @@ fn render_call_locations(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Ite\n             cx,\n             &cx.root_path(),\n             highlight::DecorationInfo(decoration_info),\n-            sources::SourceContext::Embedded {\n-                url: &call_data.url,\n-                offset: line_min,\n-                needs_expansion,\n-            },\n+            sources::SourceContext::Embedded { offset: line_min, needs_expansion },\n         );\n         write!(w, \"</div></div>\");\n "}, {"sha": "50135d6019006633eb804053085c1b8bf95a2b51", "filename": "src/librustdoc/html/sources.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6/src%2Flibrustdoc%2Fhtml%2Fsources.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6/src%2Flibrustdoc%2Fhtml%2Fsources.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fsources.rs?ref=cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6", "patch": "@@ -256,9 +256,9 @@ where\n     }\n }\n \n-pub(crate) enum SourceContext<'a> {\n+pub(crate) enum SourceContext {\n     Standalone,\n-    Embedded { url: &'a str, offset: usize, needs_expansion: bool },\n+    Embedded { offset: usize, needs_expansion: bool },\n }\n \n /// Wrapper struct to render the source code of a file. This will do things like\n@@ -270,7 +270,7 @@ pub(crate) fn print_src(\n     context: &Context<'_>,\n     root_path: &str,\n     decoration_info: highlight::DecorationInfo,\n-    source_context: SourceContext<'_>,\n+    source_context: SourceContext,\n ) {\n     let lines = s.lines().count();\n     let mut line_numbers = Buffer::empty_from(buf);\n@@ -286,12 +286,12 @@ pub(crate) fn print_src(\n                 writeln!(line_numbers, \"<a href=\\\"#{line}\\\" id=\\\"{line}\\\">{line}</a>\")\n             }\n         }\n-        SourceContext::Embedded { url, offset, needs_expansion } => {\n+        SourceContext::Embedded { offset, needs_expansion } => {\n             extra =\n                 if needs_expansion { Some(r#\"<span class=\"expand\">&varr;</span>\"#) } else { None };\n             for line_number in 1..=lines {\n                 let line = line_number + offset;\n-                writeln!(line_numbers, \"<a href=\\\"{root_path}{url}#{line}\\\">{line}</a>\")\n+                writeln!(line_numbers, \"<span>{line}</span>\")\n             }\n         }\n     }"}, {"sha": "bbcce726668525dd552d2900a11d3db6acf94716", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=cb3a04b6ef4db1b16d5e8dac5fcc00d66183eed6", "patch": "@@ -575,7 +575,7 @@ ul.block, .block li {\n \tborder-color: var(--example-line-numbers-border-color);\n }\n \n-.src-line-numbers a {\n+.src-line-numbers a, .src-line-numbers span {\n \tcolor: var(--src-line-numbers-span-color);\n }\n .src-line-numbers :target {\n@@ -2061,7 +2061,8 @@ in storage.js\n \tpadding: 14px 0;\n }\n \n-.scraped-example .code-wrapper .src-line-numbers a {\n+.scraped-example .code-wrapper .src-line-numbers a,\n+.scraped-example .code-wrapper .src-line-numbers span {\n \tpadding: 0 14px;\n }\n "}]}