{"sha": "0327b5dac5010e8b64dea9b4535c2d0ed51e0988", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzMjdiNWRhYzUwMTBlOGI2NGRlYTliNDUzNWMyZDBlZDUxZTA5ODg=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2020-12-11T05:33:19Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-11T05:33:19Z"}, "message": "Rollup merge of #79917 - sivadeilra:asm_symbols, r=petrochenkov\n\nUse Symbol for inline asm register class names\n\nThis takes care of one \"FIXME\":\n// FIXME: use direct symbol comparison for register class names\n\nInstead of using string literals, this uses Symbol for register\nclass names.\n\nThis is part of work I am doing to improve how Symbol interning works.", "tree": {"sha": "52e498243a32317c889ff5fd7d3cb37d3154f564", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/52e498243a32317c889ff5fd7d3cb37d3154f564"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0327b5dac5010e8b64dea9b4535c2d0ed51e0988", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf0wSfCRBK7hj4Ov3rIwAAdHIIAH2Hu7/GCM66ueuoF1XelBhO\nGbVRxC2UGWIPYasxefyeK8iet3wUcmdZcoNljNumbkc0e6FiR6QNF1yavzMRHsjw\nzIDp6em94LmwLMiZtqMeh0nMwaci9sJzkF6XrZpQt9RxpbqPVbeW28THyFViEG0E\nj709E2mWcFKGH0HiYe/6tbV4vA6GTqLWrV77WeCXzGudVMCF4DMePOvA5vqJN47Q\nRDJGd7tl/xr095ofPwjDZoUaXJzWcbFucLRcZXMzDi4/NWR1D5Px56F3WUkSjdXz\nOFYhKLuxEimKWaUmqKBgMsyidvGPLsstsa9hv+9S2HHrfcKX56rJD7vtOcOyVKo=\n=e3Kg\n-----END PGP SIGNATURE-----\n", "payload": "tree 52e498243a32317c889ff5fd7d3cb37d3154f564\nparent 3a46a6b9974db88e1690f254cbc2f3a1d6384d28\nparent 40ed0f68574db71ec71afe77a9882ee723cc46a1\nauthor Tyler Mandry <tmandry@gmail.com> 1607664799 -0800\ncommitter GitHub <noreply@github.com> 1607664799 -0800\n\nRollup merge of #79917 - sivadeilra:asm_symbols, r=petrochenkov\n\nUse Symbol for inline asm register class names\n\nThis takes care of one \"FIXME\":\n// FIXME: use direct symbol comparison for register class names\n\nInstead of using string literals, this uses Symbol for register\nclass names.\n\nThis is part of work I am doing to improve how Symbol interning works.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0327b5dac5010e8b64dea9b4535c2d0ed51e0988", "html_url": "https://github.com/rust-lang/rust/commit/0327b5dac5010e8b64dea9b4535c2d0ed51e0988", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0327b5dac5010e8b64dea9b4535c2d0ed51e0988/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a46a6b9974db88e1690f254cbc2f3a1d6384d28", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a46a6b9974db88e1690f254cbc2f3a1d6384d28", "html_url": "https://github.com/rust-lang/rust/commit/3a46a6b9974db88e1690f254cbc2f3a1d6384d28"}, {"sha": "40ed0f68574db71ec71afe77a9882ee723cc46a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/40ed0f68574db71ec71afe77a9882ee723cc46a1", "html_url": "https://github.com/rust-lang/rust/commit/40ed0f68574db71ec71afe77a9882ee723cc46a1"}], "stats": {"total": 74, "additions": 45, "deletions": 29}, "files": [{"sha": "b60d466c3a79c7ee8d8d16b19640e431711ada99", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/0327b5dac5010e8b64dea9b4535c2d0ed51e0988/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0327b5dac5010e8b64dea9b4535c2d0ed51e0988/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=0327b5dac5010e8b64dea9b4535c2d0ed51e0988", "patch": "@@ -460,6 +460,9 @@ symbols! {\n         document_private_items,\n         dotdot_in_tuple_patterns,\n         dotdoteq_in_patterns,\n+        dreg,\n+        dreg_low16,\n+        dreg_low8,\n         drop,\n         drop_in_place,\n         drop_types_in_const,\n@@ -544,6 +547,7 @@ symbols! {\n         format_args_capture,\n         format_args_nl,\n         freeze,\n+        freg,\n         frem_fast,\n         from,\n         from_desugaring,\n@@ -627,6 +631,7 @@ symbols! {\n         iter,\n         keyword,\n         kind,\n+        kreg,\n         label,\n         label_break_value,\n         lang,\n@@ -652,6 +657,7 @@ symbols! {\n         lint_reasons,\n         literal,\n         llvm_asm,\n+        local,\n         local_inner_macros,\n         log10f32,\n         log10f64,\n@@ -854,6 +860,9 @@ symbols! {\n         pub_restricted,\n         pure,\n         pushpop_unsafe,\n+        qreg,\n+        qreg_low4,\n+        qreg_low8,\n         quad_precision_float,\n         question_mark,\n         quote,\n@@ -875,6 +884,13 @@ symbols! {\n         reexport_test_harness_main,\n         reference,\n         reflect,\n+        reg,\n+        reg16,\n+        reg32,\n+        reg64,\n+        reg_abcd,\n+        reg_byte,\n+        reg_thumb,\n         register_attr,\n         register_tool,\n         relaxed_adts,\n@@ -1060,6 +1076,8 @@ symbols! {\n         spotlight,\n         sqrtf32,\n         sqrtf64,\n+        sreg,\n+        sreg_low16,\n         sse4a_target_feature,\n         stable,\n         staged_api,\n@@ -1215,6 +1233,8 @@ symbols! {\n         volatile_load,\n         volatile_set_memory,\n         volatile_store,\n+        vreg,\n+        vreg_low16,\n         warn,\n         wasm_import_module,\n         wasm_target_feature,\n@@ -1226,6 +1246,9 @@ symbols! {\n         wrapping_mul,\n         wrapping_sub,\n         write_bytes,\n+        xmm_reg,\n+        ymm_reg,\n+        zmm_reg,\n     }\n }\n "}, {"sha": "3c65c84b0de41b7fe0d5198018a1ddf1e699b45f", "filename": "compiler/rustc_target/src/asm/mod.rs", "status": "modified", "additions": 22, "deletions": 29, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/0327b5dac5010e8b64dea9b4535c2d0ed51e0988/compiler%2Frustc_target%2Fsrc%2Fasm%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0327b5dac5010e8b64dea9b4535c2d0ed51e0988/compiler%2Frustc_target%2Fsrc%2Fasm%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fasm%2Fmod.rs?ref=0327b5dac5010e8b64dea9b4535c2d0ed51e0988", "patch": "@@ -20,16 +20,16 @@ macro_rules! def_reg_class {\n         }\n \n         impl $arch_regclass {\n-            pub fn name(self) -> &'static str {\n+            pub fn name(self) -> rustc_span::Symbol {\n                 match self {\n-                    $(Self::$class => stringify!($class),)*\n+                    $(Self::$class => rustc_span::symbol::sym::$class,)*\n                 }\n             }\n \n-            pub fn parse(_arch: super::InlineAsmArch, name: &str) -> Result<Self, &'static str> {\n+            pub fn parse(_arch: super::InlineAsmArch, name: rustc_span::Symbol) -> Result<Self, &'static str> {\n                 match name {\n                     $(\n-                        stringify!($class) => Ok(Self::$class),\n+                        rustc_span::sym::$class => Ok(Self::$class),\n                     )*\n                     _ => Err(\"unknown register class\"),\n                 }\n@@ -327,7 +327,7 @@ pub enum InlineAsmRegClass {\n }\n \n impl InlineAsmRegClass {\n-    pub fn name(self) -> &'static str {\n+    pub fn name(self) -> Symbol {\n         match self {\n             Self::X86(r) => r.name(),\n             Self::Arm(r) => r.name(),\n@@ -422,29 +422,22 @@ impl InlineAsmRegClass {\n     }\n \n     pub fn parse(arch: InlineAsmArch, name: Symbol) -> Result<Self, &'static str> {\n-        // FIXME: use direct symbol comparison for register class names\n-        name.with(|name| {\n-            Ok(match arch {\n-                InlineAsmArch::X86 | InlineAsmArch::X86_64 => {\n-                    Self::X86(X86InlineAsmRegClass::parse(arch, name)?)\n-                }\n-                InlineAsmArch::Arm => Self::Arm(ArmInlineAsmRegClass::parse(arch, name)?),\n-                InlineAsmArch::AArch64 => {\n-                    Self::AArch64(AArch64InlineAsmRegClass::parse(arch, name)?)\n-                }\n-                InlineAsmArch::RiscV32 | InlineAsmArch::RiscV64 => {\n-                    Self::RiscV(RiscVInlineAsmRegClass::parse(arch, name)?)\n-                }\n-                InlineAsmArch::Nvptx64 => Self::Nvptx(NvptxInlineAsmRegClass::parse(arch, name)?),\n-                InlineAsmArch::Hexagon => {\n-                    Self::Hexagon(HexagonInlineAsmRegClass::parse(arch, name)?)\n-                }\n-                InlineAsmArch::Mips | InlineAsmArch::Mips64 => {\n-                    Self::Mips(MipsInlineAsmRegClass::parse(arch, name)?)\n-                }\n-                InlineAsmArch::SpirV => Self::SpirV(SpirVInlineAsmRegClass::parse(arch, name)?),\n-                InlineAsmArch::Wasm32 => Self::Wasm(WasmInlineAsmRegClass::parse(arch, name)?),\n-            })\n+        Ok(match arch {\n+            InlineAsmArch::X86 | InlineAsmArch::X86_64 => {\n+                Self::X86(X86InlineAsmRegClass::parse(arch, name)?)\n+            }\n+            InlineAsmArch::Arm => Self::Arm(ArmInlineAsmRegClass::parse(arch, name)?),\n+            InlineAsmArch::AArch64 => Self::AArch64(AArch64InlineAsmRegClass::parse(arch, name)?),\n+            InlineAsmArch::RiscV32 | InlineAsmArch::RiscV64 => {\n+                Self::RiscV(RiscVInlineAsmRegClass::parse(arch, name)?)\n+            }\n+            InlineAsmArch::Nvptx64 => Self::Nvptx(NvptxInlineAsmRegClass::parse(arch, name)?),\n+            InlineAsmArch::Hexagon => Self::Hexagon(HexagonInlineAsmRegClass::parse(arch, name)?),\n+            InlineAsmArch::Mips | InlineAsmArch::Mips64 => {\n+                Self::Mips(MipsInlineAsmRegClass::parse(arch, name)?)\n+            }\n+            InlineAsmArch::SpirV => Self::SpirV(SpirVInlineAsmRegClass::parse(arch, name)?),\n+            InlineAsmArch::Wasm32 => Self::Wasm(WasmInlineAsmRegClass::parse(arch, name)?),\n         })\n     }\n \n@@ -484,7 +477,7 @@ impl fmt::Display for InlineAsmRegOrRegClass {\n     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n         match self {\n             Self::Reg(r) => write!(f, \"\\\"{}\\\"\", r.name()),\n-            Self::RegClass(r) => f.write_str(r.name()),\n+            Self::RegClass(r) => write!(f, \"{}\", r.name()),\n         }\n     }\n }"}]}