{"sha": "f9532ba8d7ffec4bbd2698c048c383910fe714c4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5NTMyYmE4ZDdmZmVjNGJiZDI2OThjMDQ4YzM4MzkxMGZlNzE0YzQ=", "commit": {"author": {"name": "David Barsky", "email": "me@davidbarsky.com", "date": "2018-04-19T23:14:11Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-04-19T23:14:11Z"}, "message": "Implemented rough draft of `check` write mode. (#2539)\n\n* Add rough draft of `check` mode. Not unit tested.\r\n\r\n* Added assert-cli; simple test case for `--write-mode=check`\r\n\r\n* Lightly documented `check` WriteMode\r\n\r\n* wrote clearer phrasing for config::options::WriteMode::Check\r\n\r\n* Implemented default for WriteMode where default is Overwrite\r\n\r\n* Simplified exit code handling\r\n\r\n* updated README.md as per @nrc' comment\r\n\r\n* collapsed exit-code handling\r\n\r\n* Removed write_mode from Summary, introduced partial option parsing earlier\r\n\r\n* Handle write-mode parsing in a slightly better way.", "tree": {"sha": "caa71e485a98a2deb40f5aabc3dfe86cdccdfab9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/caa71e485a98a2deb40f5aabc3dfe86cdccdfab9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f9532ba8d7ffec4bbd2698c048c383910fe714c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f9532ba8d7ffec4bbd2698c048c383910fe714c4", "html_url": "https://github.com/rust-lang/rust/commit/f9532ba8d7ffec4bbd2698c048c383910fe714c4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f9532ba8d7ffec4bbd2698c048c383910fe714c4/comments", "author": {"login": "davidbarsky", "id": 2067774, "node_id": "MDQ6VXNlcjIwNjc3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2067774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidbarsky", "html_url": "https://github.com/davidbarsky", "followers_url": "https://api.github.com/users/davidbarsky/followers", "following_url": "https://api.github.com/users/davidbarsky/following{/other_user}", "gists_url": "https://api.github.com/users/davidbarsky/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidbarsky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidbarsky/subscriptions", "organizations_url": "https://api.github.com/users/davidbarsky/orgs", "repos_url": "https://api.github.com/users/davidbarsky/repos", "events_url": "https://api.github.com/users/davidbarsky/events{/privacy}", "received_events_url": "https://api.github.com/users/davidbarsky/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe29b2a9724967bd39bdab8c200814be132527e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe29b2a9724967bd39bdab8c200814be132527e6", "html_url": "https://github.com/rust-lang/rust/commit/fe29b2a9724967bd39bdab8c200814be132527e6"}], "stats": {"total": 327, "additions": 252, "deletions": 75}, "files": [{"sha": "ee76b0204769368be9bdb5b629101b02115cf6fd", "filename": "Cargo.lock", "status": "modified", "additions": 178, "deletions": 59, "changes": 237, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -6,6 +6,19 @@ dependencies = [\n  \"memchr 2.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"assert_cli\"\n+version = \"0.5.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"colored 1.6.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"difference 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"environment 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"error-chain 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"skeptic 0.13.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"atty\"\n version = \"0.2.8\"\n@@ -18,7 +31,7 @@ dependencies = [\n \n [[package]]\n name = \"backtrace\"\n-version = \"0.3.5\"\n+version = \"0.3.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"backtrace-sys 0.1.16 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -33,57 +46,92 @@ name = \"backtrace-sys\"\n version = \"0.1.16\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"cc 1.0.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"cc 1.0.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.40 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"bitflags\"\n+version = \"0.9.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"bitflags\"\n version = \"1.0.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"bytecount\"\n+version = \"0.2.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"byteorder\"\n version = \"1.2.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"cargo_metadata\"\n+version = \"0.3.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"error-chain 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"semver 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_derive 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"cargo_metadata\"\n version = \"0.5.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"error-chain 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"semver 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_derive 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_json 1.0.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_derive 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"cc\"\n-version = \"1.0.9\"\n+version = \"1.0.10\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"cfg-if\"\n version = \"0.1.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"colored\"\n+version = \"1.6.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"lazy_static 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"derive-new\"\n-version = \"0.5.2\"\n+version = \"0.5.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"proc-macro2 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"quote 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.12.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"proc-macro2 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"quote 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.13.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"diff\"\n version = \"0.1.11\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"difference\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"dtoa\"\n version = \"0.4.2\"\n@@ -104,7 +152,7 @@ dependencies = [\n \n [[package]]\n name = \"env_logger\"\n-version = \"0.5.7\"\n+version = \"0.5.8\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"atty 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -114,12 +162,17 @@ dependencies = [\n  \"termcolor 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"environment\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"error-chain\"\n version = \"0.11.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"backtrace 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"backtrace 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -141,6 +194,11 @@ name = \"getopts\"\n version = \"0.2.17\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"glob\"\n+version = \"0.2.11\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"humantime\"\n version = \"1.1.1\"\n@@ -171,6 +229,11 @@ dependencies = [\n  \"winapi-build 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"lazy_static\"\n+version = \"0.2.11\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"lazy_static\"\n version = \"1.0.0\"\n@@ -232,33 +295,25 @@ dependencies = [\n \n [[package]]\n name = \"proc-macro2\"\n-version = \"0.2.3\"\n+version = \"0.3.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n-name = \"proc-macro2\"\n-version = \"0.3.6\"\n+name = \"pulldown-cmark\"\n+version = \"0.1.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"bitflags 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"quick-error\"\n version = \"1.2.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n-[[package]]\n-name = \"quote\"\n-version = \"0.4.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"proc-macro2 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"quote\"\n version = \"0.5.1\"\n@@ -297,19 +352,27 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"aho-corasick 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"memchr 2.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"regex-syntax 0.5.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"regex-syntax 0.5.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"thread_local 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"utf8-ranges 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"regex-syntax\"\n-version = \"0.5.3\"\n+version = \"0.5.5\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"ucd-util 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"remove_dir_all\"\n+version = \"0.5.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"winapi 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"rustc-ap-rustc_cratesio_shim\"\n version = \"103.0.0\"\n@@ -390,38 +453,57 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n name = \"rustfmt-nightly\"\n version = \"0.4.2\"\n dependencies = [\n+ \"assert_cli 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cargo_metadata 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"derive-new 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"derive-new 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"env_logger 0.5.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"env_logger 0.5.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.7.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.40 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"regex 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-ap-syntax 103.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_derive 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_json 1.0.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_derive 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"term 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"toml 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicode-segmentation 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"winapi 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"same-file\"\n+version = \"0.1.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"kernel32-sys 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"scoped-tls\"\n version = \"0.1.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"semver\"\n+version = \"0.8.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"semver-parser 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"semver\"\n version = \"0.9.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"semver-parser 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -431,23 +513,23 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"serde\"\n-version = \"1.0.37\"\n+version = \"1.0.39\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"serde_derive\"\n-version = \"1.0.37\"\n+version = \"1.0.39\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_derive_internals 0.23.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_derive_internals 0.23.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"syn 0.13.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"serde_derive_internals\"\n-version = \"0.23.0\"\n+version = \"0.23.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -456,13 +538,28 @@ dependencies = [\n \n [[package]]\n name = \"serde_json\"\n-version = \"1.0.13\"\n+version = \"1.0.15\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"dtoa 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itoa 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num-traits 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"skeptic\"\n+version = \"0.13.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"bytecount 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"cargo_metadata 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"error-chain 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"glob 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"pulldown-cmark 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"tempdir 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"walkdir 1.0.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -477,22 +574,21 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"syn\"\n-version = \"0.12.15\"\n+version = \"0.13.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"proc-macro2 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"quote 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"proc-macro2 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"quote 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n-name = \"syn\"\n-version = \"0.13.1\"\n+name = \"tempdir\"\n+version = \"0.3.7\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"proc-macro2 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"quote 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rand 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"remove_dir_all 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -545,7 +641,7 @@ name = \"toml\"\n version = \"0.4.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"serde 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -586,6 +682,16 @@ name = \"void\"\n version = \"1.0.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"walkdir\"\n+version = \"1.0.7\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"kernel32-sys 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"same-file 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"winapi\"\n version = \"0.2.8\"\n@@ -625,28 +731,37 @@ dependencies = [\n \n [metadata]\n \"checksum aho-corasick 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d6531d44de723825aa81398a6415283229725a00fa30713812ab9323faa82fc4\"\n+\"checksum assert_cli 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"72342c21057a3cb5f7c2d849bf7999a83795434dd36d74fa8c24680581bd1930\"\n \"checksum atty 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"af80143d6f7608d746df1520709e5d141c96f240b0e62b0aa41bdfb53374d9d4\"\n-\"checksum backtrace 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ebbbf59b1c43eefa8c3ede390fcc36820b4999f7914104015be25025e0d62af2\"\n+\"checksum backtrace 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ebbe525f66f42d207968308ee86bc2dd60aa5fab535b22e616323a173d097d8e\"\n \"checksum backtrace-sys 0.1.16 (registry+https://github.com/rust-lang/crates.io-index)\" = \"44585761d6161b0f57afc49482ab6bd067e4edef48c12a152c237eb0203f7661\"\n+\"checksum bitflags 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4efd02e230a02e18f92fc2735f44597385ed02ad8f831e7c1c1156ee5e1ab3a5\"\n \"checksum bitflags 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b3c30d3802dfb7281680d6285f2ccdaa8c2d8fee41f93805dba5c4cf50dc23cf\"\n+\"checksum bytecount 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"af27422163679dea46a1a7239dffff64d3dcdc3ba5fe9c49c789fbfe0eb949de\"\n \"checksum byteorder 1.2.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"73b5bdfe7ee3ad0b99c9801d58807a9dbc9e09196365b0203853b99889ab3c87\"\n+\"checksum cargo_metadata 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1f56ec3e469bca7c276f2eea015aa05c5e381356febdbb0683c2580189604537\"\n \"checksum cargo_metadata 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6ebd6272a2ca4fd39dbabbd6611eb03df45c2259b3b80b39a9ff8fbdcf42a4b3\"\n-\"checksum cc 1.0.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2b4911e4bdcb4100c7680e7e854ff38e23f1b34d4d9e079efae3da2801341ffc\"\n+\"checksum cc 1.0.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8b9d2900f78631a5876dc5d6c9033ede027253efcd33dd36b1309fc6cab97ee0\"\n \"checksum cfg-if 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d4c819a1287eb618df47cc647173c5c4c66ba19d888a6e50d605672aed3140de\"\n-\"checksum derive-new 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6fcb923bab47a948f1b01cec2f758fdebba95c9ebc255458654b2b88efe59d71\"\n+\"checksum colored 1.6.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b0aa3473e85a3161b59845d6096b289bb577874cafeaf75ea1b1beaa6572c7fc\"\n+\"checksum derive-new 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ceed73957c449214f8440eec8ad7fa282b67dc9eacbb24a3085b15d60397a17a\"\n \"checksum diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3c2b69f912779fbb121ceb775d74d51e915af17aaebc38d28a592843a2dd0a3a\"\n+\"checksum difference 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b3304d19798a8e067e48d8e69b2c37f0b5e9b4e462504ad9e27e9f3fce02bba8\"\n \"checksum dtoa 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"09c3753c3db574d215cba4ea76018483895d7bff25a31b49ba45db21c48e50ab\"\n \"checksum either 1.5.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3be565ca5c557d7f59e7cfcf1844f9e3033650c929c6566f511e8005f205c1d0\"\n \"checksum ena 0.9.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f8b449f3b18c89d2dbe40548d2ee4fa58ea0a08b761992da6ecb9788e4688834\"\n-\"checksum env_logger 0.5.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0f475037312b91d34dbc3142a1ad3980ef0d070c7a855ce238afdd5e987cfecc\"\n+\"checksum env_logger 0.5.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"be27f8ea102a7182093a80d98f0b78623b580eda8791cbe8e2345fe6e57567a6\"\n+\"checksum environment 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1f4b14e20978669064c33b4c1e0fb4083412e40fe56cbea2eae80fd7591503ee\"\n \"checksum error-chain 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ff511d5dc435d703f4971bc399647c9bc38e20cb41452e3b9feb4765419ed3f3\"\n \"checksum fuchsia-zircon 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2e9763c69ebaae630ba35f74888db465e49e259ba1bc0eda7d06f4a067615d82\"\n \"checksum fuchsia-zircon-sys 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3dcaa9ae7725d12cdb85b3ad99a434db70b468c09ded17e012d86b5c1010f7a7\"\n \"checksum getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b900c08c1939860ce8b54dc6a89e26e00c04c380fd0e09796799bd7f12861e05\"\n+\"checksum glob 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8be18de09a56b60ed0edf84bc9df007e30040691af7acd1c41874faac5895bfb\"\n \"checksum humantime 1.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0484fda3e7007f2a4a0d9c3a703ca38c71c54c55602ce4660c419fd32e188c9e\"\n \"checksum itertools 0.7.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f58856976b776fedd95533137617a02fb25719f40e7d9b01c7043cd65474f450\"\n \"checksum itoa 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c069bbec61e1ca5a596166e55dfe4773ff745c3d16b700013bcaff9a6df2c682\"\n \"checksum kernel32-sys 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7507624b29483431c0ba2d82aece8ca6cdba9382bff4ddd0f7490560c056098d\"\n+\"checksum lazy_static 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"76f033c7ad61445c5b347c7382dd1237847eb1bce590fe50365dcb33d546be73\"\n \"checksum lazy_static 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c8f31047daa365f19be14b47c29df4f7c3b581832407daabe6ae77397619237d\"\n \"checksum libc 0.2.40 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6fd41f331ac7c5b8ac259b8bf82c75c0fb2e469bbf37d2becbba9a6a2221965b\"\n \"checksum log 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"89f010e843f2b1a31dbd316b3b8d443758bc634bed37aabade59c686d644e0a2\"\n@@ -655,34 +770,37 @@ dependencies = [\n \"checksum owning_ref 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cdf84f41639e037b484f93433aa3897863b561ed65c6e59c7073d7c561710f37\"\n \"checksum parking_lot 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9fd9d732f2de194336fb02fe11f9eed13d9e76f13f4315b4d88a14ca411750cd\"\n \"checksum parking_lot_core 0.2.13 (registry+https://github.com/rust-lang/crates.io-index)\" = \"538ef00b7317875071d5e00f603f24d16f0b474c1a5fc0ccb8b454ca72eafa79\"\n-\"checksum proc-macro2 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cd07deb3c6d1d9ff827999c7f9b04cdfd66b1b17ae508e14fe47b620f2282ae0\"\n \"checksum proc-macro2 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"49b6a521dc81b643e9a51e0d1cf05df46d5a2f3c0280ea72bcb68276ba64a118\"\n+\"checksum pulldown-cmark 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d6fdf85cda6cadfae5428a54661d431330b312bc767ddbc57adbedc24da66e32\"\n \"checksum quick-error 1.2.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eda5fe9b71976e62bc81b781206aaa076401769b2143379d3eb2118388babac4\"\n-\"checksum quote 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1eca14c727ad12702eb4b6bfb5a232287dcf8385cb8ca83a3eeaf6519c44c408\"\n \"checksum quote 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7b0ff51282f28dc1b53fd154298feaa2e77c5ea0dba68e1fd8b03b72fbe13d2a\"\n \"checksum rand 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eba5f8cb59cc50ed56be8880a5c7b496bfd9bd26394e176bc67884094145c2c5\"\n \"checksum redox_syscall 0.1.37 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0d92eecebad22b767915e4d529f89f28ee96dbbf5a4810d2b844373f136417fd\"\n \"checksum redox_termios 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7e891cfe48e9100a70a3b6eb652fef28920c117d366339687bd5576160db0f76\"\n \"checksum regex 0.2.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"aec3f58d903a7d2a9dc2bf0e41a746f4530e0cab6b615494e058f67a3ef947fb\"\n-\"checksum regex-syntax 0.5.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b2550876c31dc914696a6c2e01cbce8afba79a93c8ae979d2fe051c0230b3756\"\n+\"checksum regex-syntax 0.5.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bd90079345f4a4c3409214734ae220fd773c6f2e8a543d07370c6c1c369cfbfb\"\n+\"checksum remove_dir_all 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dfc5b3ce5d5ea144bb04ebd093a9e14e9765bcfec866aecda9b6dec43b3d1e24\"\n \"checksum rustc-ap-rustc_cratesio_shim 103.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"463834ac5ea777cb56c073586675fac37292f8425aafb3757efca7e6a76545aa\"\n \"checksum rustc-ap-rustc_data_structures 103.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5d256eeab1b8639c2a1fd341e54f3613f8150bc262e4ec9361a29bbcb162906d\"\n \"checksum rustc-ap-rustc_errors 103.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cf6dd73033bb512845a6df347174c65ad430c92ecd35527e24d8bb186f5664ee\"\n \"checksum rustc-ap-serialize 103.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"356d338dbe538c7d6428296872d5d68da8f091e34eb89bca3b3f245ed0785e5e\"\n \"checksum rustc-ap-syntax 103.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0f02edede4ba70963a7dac2308876f03f76f9edd48a035e5abc8fa37c57a77c8\"\n \"checksum rustc-ap-syntax_pos 103.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ad8e50d4c38121fa8ded3ffbf94926ec74c95f24316c3b80de84fbfb42c005cf\"\n \"checksum rustc-demangle 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"11fb43a206a04116ffd7cfcf9bcb941f8eb6cc7ff667272246b0a1c74259a3cb\"\n+\"checksum same-file 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d931a44fdaa43b8637009e7632a02adc4f2b2e0733c08caa4cf00e8da4a117a7\"\n \"checksum scoped-tls 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8674d439c964889e2476f474a3bf198cc9e199e77499960893bac5de7e9218a4\"\n+\"checksum semver 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bee2bc909ab2d8d60dab26e8cad85b25d795b14603a0dcb627b78b9d30b6454b\"\n \"checksum semver 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403\"\n \"checksum semver-parser 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3\"\n-\"checksum serde 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d3bcee660dcde8f52c3765dd9ca5ee36b4bf35470a738eb0bd5a8752b0389645\"\n-\"checksum serde_derive 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f1711ab8b208541fa8de00425f6a577d90f27bb60724d2bb5fd911314af9668f\"\n-\"checksum serde_derive_internals 0.23.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"89b340a48245bc03ddba31d0ff1709c118df90edc6adabaca4aac77aea181cce\"\n-\"checksum serde_json 1.0.13 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5c508584d9913df116b91505eec55610a2f5b16e9ed793c46e4d0152872b3e74\"\n+\"checksum serde 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\" = \"53e6b6859395f46cf528414659ce43e70902b2277519707c3bd91797b3320330\"\n+\"checksum serde_derive 1.0.39 (registry+https://github.com/rust-lang/crates.io-index)\" = \"16e97f8dc5b2dabc0183e0cde24b1a53835e5bb3d2c9e0fdb077f895bba7f2a9\"\n+\"checksum serde_derive_internals 0.23.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9d30c4596450fd7bbda79ef15559683f9a79ac0193ea819db90000d7e1cae794\"\n+\"checksum serde_json 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7bf1cbb1387028a13739cb018ee0d9b3db534f22ca3c84a5904f7eadfde14e75\"\n+\"checksum skeptic 0.13.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c8431f8fca168e2db4be547bd8329eac70d095dff1444fee4b0fa0fabc7df75a\"\n \"checksum smallvec 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"44db0ecb22921ef790d17ae13a3f6d15784183ff5f2a01aa32098c7498d2b4b9\"\n \"checksum stable_deref_trait 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"15132e0e364248108c5e2c02e3ab539be8d6f5d52a01ca9bbf27ed657316f02b\"\n-\"checksum syn 0.12.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c97c05b8ebc34ddd6b967994d5c6e9852fa92f8b82b3858c39451f97346dcce5\"\n \"checksum syn 0.13.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"91b52877572087400e83d24b9178488541e3d535259e04ff17a63df1e5ceff59\"\n+\"checksum tempdir 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"15f2b5fb00ccdf689e0149d1b1b3c03fead81c2b37735d812fa8bddbbf41b6d8\"\n \"checksum term 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fa63644f74ce96fbeb9b794f66aff2a52d601cbd5e80f4b97123e3899f4570f1\"\n \"checksum term 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5e6b677dd1e8214ea1ef4297f85dbcbed8e8cdddb561040cc998ca2551c37561\"\n \"checksum termcolor 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"adc4587ead41bf016f11af03e55a624c06568b5a19db4e90fde573d805074f83\"\n@@ -696,6 +814,7 @@ dependencies = [\n \"checksum unreachable 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"382810877fe448991dfc7f0dd6e3ae5d58088fd0ea5e35189655f84e6814fa56\"\n \"checksum utf8-ranges 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"662fab6525a98beff2921d7f61a39e7d59e0b425ebc7d0d9e66d316e55124122\"\n \"checksum void 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6a02e4885ed3bc0f2de90ea6dd45ebcbb66dacffe03547fadbb0eeae2770887d\"\n+\"checksum walkdir 1.0.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bb08f9e670fab86099470b97cd2b252d6527f0b3cc1401acdb595ffc9dd288ff\"\n \"checksum winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"167dc9d6949a9b857f3451275e911c3f44255842c1f7a76f33c55103a909087a\"\n \"checksum winapi 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"04e3bd221fcbe8a271359c04f21a76db7d0c6028862d1bb5512d85e1e2eb5bb3\"\n \"checksum winapi-build 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2d315eee3b34aca4797b2da6b13ed88266e6d612562a0c46390af8299fc699bc\""}, {"sha": "e989e123dbb3389db3392f9185dac66cfb06e715", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -50,6 +50,7 @@ rustc-ap-syntax = \"103.0.0\"\n \n [dev-dependencies]\n lazy_static = \"1.0.0\"\n+assert_cli = \"0.5\"\n \n [target.'cfg(unix)'.dependencies]\n libc = \"0.2.11\""}, {"sha": "020d6bf3b20813ae26c4fd7cf7f3b309c09fc382", "filename": "README.md", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -106,14 +106,17 @@ read data from stdin. Alternatively, you can use `cargo fmt` to format all\n binary and library targets of your crate.\n \n You'll probably want to specify the write mode. Currently, there are modes for\n-`diff`, `replace`, `overwrite`, `display`, `coverage`, `checkstyle`, and `plain`.\n+`check`, `diff`, `replace`, `overwrite`, `display`, `coverage`, `checkstyle`, and `plain`.\n \n * `overwrite` Is the default and overwrites the original files _without_ creating backups.\n * `replace` Overwrites the original files after creating backups of the files.\n * `display` Will print the formatted files to stdout.\n * `plain` Also writes to stdout, but with no metadata.\n * `diff` Will print a diff between the original files and formatted files to stdout.\n          Will also exit with an error code if there are any differences.\n+* `check` Checks if the program's formatting matches what rustfmt would do. Silently exits\n+          with code 0 if so, emits a diff and exits with code 1 if not. This option is\n+          designed to be run in CI-like where a non-zero exit signifies incorrect formatting.\n * `checkstyle` Will output the lines that need to be corrected as a checkstyle XML file,\n   that can be used by tools like Jenkins.\n "}, {"sha": "ff0961fd2e2194e66a129558c3c4cf79b65bf911", "filename": "src/bin/main.rs", "status": "modified", "additions": 17, "deletions": 10, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fbin%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fbin%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fmain.rs?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -30,7 +30,7 @@ use rustfmt::{run, FileName, Input, Summary};\n type FmtError = Box<error::Error + Send + Sync>;\n type FmtResult<T> = std::result::Result<T, FmtError>;\n \n-const WRITE_MODE_LIST: &str = \"[replace|overwrite|display|plain|diff|coverage|checkstyle]\";\n+const WRITE_MODE_LIST: &str = \"[replace|overwrite|display|plain|diff|coverage|checkstyle|check]\";\n \n /// Rustfmt operations.\n enum Operation {\n@@ -303,6 +303,7 @@ fn execute(opts: &Options) -> FmtResult<Summary> {\n             let mut out = &mut stdout();\n             checkstyle::output_header(&mut out, config.write_mode())?;\n             let mut error_summary = Summary::default();\n+\n             for file in files {\n                 if !file.exists() {\n                     eprintln!(\"Error: file `{}` does not exist\", file.to_str().unwrap());\n@@ -350,22 +351,28 @@ fn execute(opts: &Options) -> FmtResult<Summary> {\n     }\n }\n \n+fn determine_write_mode(opts: &Options) -> WriteMode {\n+    let matches = opts.parse(env::args().skip(1)).unwrap();\n+    let options = CliOptions::from_matches(&matches).unwrap();\n+    match options.write_mode {\n+        Some(m) => m,\n+        None => WriteMode::default(),\n+    }\n+}\n+\n fn main() {\n     env_logger::init();\n-\n     let opts = make_opts();\n+    // Only handles arguments passed in through the CLI.\n+    let write_mode = determine_write_mode(&opts);\n \n     let exit_code = match execute(&opts) {\n         Ok(summary) => {\n-            if summary.has_operational_errors() {\n+            if summary.has_operational_errors()\n+                || summary.has_diff && write_mode == WriteMode::Check\n+                || summary.has_parsing_errors() || summary.has_formatting_errors()\n+            {\n                 1\n-            } else if summary.has_parsing_errors() {\n-                2\n-            } else if summary.has_formatting_errors() {\n-                3\n-            } else if summary.has_diff {\n-                // should only happen in diff mode\n-                4\n             } else {\n                 assert!(summary.has_no_errors());\n                 0"}, {"sha": "274a40a2ae7d3dc2fa4e516e9e926d60c72fa7cb", "filename": "src/config/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fconfig%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fconfig%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig%2Fmod.rs?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -120,7 +120,7 @@ create_config! {\n     // Control options (changes the operation of rustfmt, rather than the formatting)\n     write_mode: WriteMode, WriteMode::Overwrite, false,\n         \"What Write Mode to use when none is supplied: \\\n-         Replace, Overwrite, Display, Plain, Diff, Coverage\";\n+         Replace, Overwrite, Display, Plain, Diff, Coverage, Check\";\n     color: Color, Color::Auto, false,\n         \"What Color option to use when none is supplied: Always, Never, Auto\";\n     required_version: String, env!(\"CARGO_PKG_VERSION\").to_owned(), false,"}, {"sha": "0bb53f046ac66b38ded5e540cf36e9f447854872", "filename": "src/config/options.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fconfig%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fconfig%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig%2Foptions.rs?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -183,6 +183,9 @@ configuration_option_enum! { WriteMode:\n     Checkstyle,\n     // Output the changed lines (for internal value only)\n     Modified,\n+    // Checks if a diff can be generated. If so, rustfmt outputs a diff and quits with exit code 1.\n+    // This option is designed to be run in CI where a non-zero exit signifies non-standard code formatting.\n+    Check,\n }\n \n configuration_option_enum! { Color:\n@@ -250,6 +253,12 @@ impl ::std::str::FromStr for WidthHeuristics {\n     }\n }\n \n+impl Default for WriteMode {\n+    fn default() -> WriteMode {\n+        WriteMode::Overwrite\n+    }\n+}\n+\n /// A set of directories, files and modules that rustfmt should ignore.\n #[derive(Default, Deserialize, Serialize, Clone, Debug)]\n pub struct IgnoreList(HashSet<PathBuf>);"}, {"sha": "3654ea89df4fce6c4b446e07a4fa338a277607d1", "filename": "src/config/summary.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fconfig%2Fsummary.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Fconfig%2Fsummary.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig%2Fsummary.rs?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -104,10 +104,7 @@ impl Summary {\n     pub fn print_exit_codes() {\n         let exit_codes = r#\"Exit Codes:\n     0 = No errors\n-    1 = Encountered operational errors e.g. an IO error\n-    2 = Failed to reformat code because of parsing errors\n-    3 = Code is valid, but it is impossible to format it properly\n-    4 = Formatted code differs from existing code (write-mode diff only)\"#;\n+    1 = Encountered error in formatting code\"#;\n         println!(\"{}\", exit_codes);\n     }\n }"}, {"sha": "ce9134b131e8365def2ea8ce6194207a4af0bf50", "filename": "src/filemap.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Ffilemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Ffilemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ffilemap.rs?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -178,6 +178,19 @@ where\n             let diff = create_diff(filename, text, config)?;\n             output_checkstyle_file(out, filename, diff)?;\n         }\n+        WriteMode::Check => {\n+            let filename = filename_to_path();\n+            if let Ok((ori, fmt)) = source_and_formatted_text(text, filename, config) {\n+                let mismatch = make_diff(&ori, &fmt, 3);\n+                let has_diff = !mismatch.is_empty();\n+                print_diff(\n+                    mismatch,\n+                    |line_num| format!(\"Diff in {} at line {}:\", filename.display(), line_num),\n+                    config.color(),\n+                );\n+                return Ok(has_diff);\n+            }\n+        }\n     }\n \n     // when we are not in diff mode, don't indicate differing files"}, {"sha": "ddb3ebeb2e9acfd7c239c9ba7f2583e04c567cf9", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -14,6 +14,7 @@\n #![allow(stable_features)]\n #![feature(match_default_bindings)]\n #![feature(type_ascription)]\n+#![feature(unicode_internals)]\n \n #[macro_use]\n extern crate derive_new;"}, {"sha": "b9b51853a2d77cf969f62d4a5785116468f9fe22", "filename": "tests/lib.rs", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/f9532ba8d7ffec4bbd2698c048c383910fe714c4/tests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9532ba8d7ffec4bbd2698c048c383910fe714c4/tests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Flib.rs?ref=f9532ba8d7ffec4bbd2698c048c383910fe714c4", "patch": "@@ -8,6 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+extern crate assert_cli;\n #[macro_use]\n extern crate lazy_static;\n #[macro_use]\n@@ -862,3 +863,29 @@ fn configuration_snippet_tests() {\n     println!(\"Ran {} configurations tests.\", blocks.len());\n     assert_eq!(failures, 0, \"{} configurations tests failed\", failures);\n }\n+\n+#[test]\n+fn verify_check_works() {\n+    assert_cli::Assert::command(&[\n+        \"cargo\",\n+        \"run\",\n+        \"--bin=rustfmt\",\n+        \"--\",\n+        \"--write-mode=check\",\n+        \"src/bin/main.rs\",\n+    ]).succeeds()\n+        .unwrap();\n+}\n+\n+#[test]\n+fn verify_diff_works() {\n+    assert_cli::Assert::command(&[\n+        \"cargo\",\n+        \"run\",\n+        \"--bin=rustfmt\",\n+        \"--\",\n+        \"--write-mode=diff\",\n+        \"src/bin/main.rs\",\n+    ]).succeeds()\n+        .unwrap();\n+}"}]}