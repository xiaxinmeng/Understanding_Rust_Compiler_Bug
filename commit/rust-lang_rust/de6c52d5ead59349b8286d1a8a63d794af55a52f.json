{"sha": "de6c52d5ead59349b8286d1a8a63d794af55a52f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlNmM1MmQ1ZWFkNTkzNDliODI4NmQxYThhNjNkNzk0YWY1NWE1MmY=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-05-21T12:13:56Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-05-31T23:44:04Z"}, "message": "make region-param-def encoding more DRY\n\nwe used to have two separate routines, one in tyencode/tydecode, and one\nin encode/decode.", "tree": {"sha": "690f8fbaabba0dcf0b9973a4e7e5b753067f56be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/690f8fbaabba0dcf0b9973a4e7e5b753067f56be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de6c52d5ead59349b8286d1a8a63d794af55a52f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de6c52d5ead59349b8286d1a8a63d794af55a52f", "html_url": "https://github.com/rust-lang/rust/commit/de6c52d5ead59349b8286d1a8a63d794af55a52f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de6c52d5ead59349b8286d1a8a63d794af55a52f/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8770d0f34a9bee2691517ab95803a277c453dfda", "url": "https://api.github.com/repos/rust-lang/rust/commits/8770d0f34a9bee2691517ab95803a277c453dfda", "html_url": "https://github.com/rust-lang/rust/commit/8770d0f34a9bee2691517ab95803a277c453dfda"}], "stats": {"total": 58, "additions": 7, "deletions": 51}, "files": [{"sha": "1131e409aa05048d7a9770408d8f9d07831c88c6", "filename": "src/librustc_metadata/decoder.rs", "status": "modified", "additions": 4, "deletions": 23, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/de6c52d5ead59349b8286d1a8a63d794af55a52f/src%2Flibrustc_metadata%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de6c52d5ead59349b8286d1a8a63d794af55a52f/src%2Flibrustc_metadata%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fdecoder.rs?ref=de6c52d5ead59349b8286d1a8a63d794af55a52f", "patch": "@@ -1662,31 +1662,12 @@ fn doc_generics<'a, 'tcx>(base_doc: rbml::Doc,\n     }\n \n     let mut regions = subst::VecPerParamSpace::empty();\n-    for rp_doc in reader::tagged_docs(doc, tag_region_param_def) {\n-        let ident_str_doc = reader::get_doc(rp_doc,\n-                                            tag_region_param_def_ident);\n-        let name = item_name(&token::get_ident_interner(), ident_str_doc);\n-        let def_id_doc = reader::get_doc(rp_doc,\n-                                         tag_region_param_def_def_id);\n-        let def_id = translated_def_id(cdata, def_id_doc);\n-\n-        let doc = reader::get_doc(rp_doc, tag_region_param_def_space);\n-        let space = subst::ParamSpace::from_uint(reader::doc_as_u64(doc) as usize);\n-\n-        let doc = reader::get_doc(rp_doc, tag_region_param_def_index);\n-        let index = reader::doc_as_u64(doc) as u32;\n-\n-        let bounds = reader::tagged_docs(rp_doc, tag_items_data_region).map(|p| {\n+    for p in reader::tagged_docs(doc, tag_region_param_def) {\n+        let bd =\n             TyDecoder::with_doc(tcx, cdata.cnum, p,\n                                 &mut |did| translate_def_id(cdata, did))\n-            .parse_region()\n-        }).collect();\n-\n-        regions.push(space, ty::RegionParameterDef { name: name,\n-                                                     def_id: def_id,\n-                                                     space: space,\n-                                                     index: index,\n-                                                     bounds: bounds });\n+            .parse_region_param_def();\n+        regions.push(bd.space, bd);\n     }\n \n     ty::Generics { types: types, regions: regions }"}, {"sha": "b14be158197e8ab379e45bcbf679dfe59e1d6536", "filename": "src/librustc_metadata/encoder.rs", "status": "modified", "additions": 2, "deletions": 27, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/de6c52d5ead59349b8286d1a8a63d794af55a52f/src%2Flibrustc_metadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de6c52d5ead59349b8286d1a8a63d794af55a52f/src%2Flibrustc_metadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fencoder.rs?ref=de6c52d5ead59349b8286d1a8a63d794af55a52f", "patch": "@@ -203,15 +203,6 @@ fn encode_type<'a, 'tcx>(ecx: &EncodeContext<'a, 'tcx>,\n     rbml_w.end_tag();\n }\n \n-fn encode_region(ecx: &EncodeContext,\n-                 rbml_w: &mut Encoder,\n-                 r: ty::Region) {\n-    rbml_w.start_tag(tag_items_data_region);\n-    tyencode::enc_region(rbml_w.writer, &ecx.ty_str_ctxt(), r);\n-    rbml_w.mark_stable_position();\n-    rbml_w.end_tag();\n-}\n-\n fn encode_disr_val(_: &EncodeContext,\n                    rbml_w: &mut Encoder,\n                    disr_val: ty::Disr) {\n@@ -535,24 +526,8 @@ fn encode_generics<'a, 'tcx>(rbml_w: &mut Encoder,\n     // Region parameters\n     for param in &generics.regions {\n         rbml_w.start_tag(tag_region_param_def);\n-\n-        rbml_w.start_tag(tag_region_param_def_ident);\n-        encode_name(rbml_w, param.name);\n-        rbml_w.end_tag();\n-\n-        rbml_w.wr_tagged_u64(tag_region_param_def_def_id,\n-                             def_to_u64(param.def_id));\n-\n-        rbml_w.wr_tagged_u64(tag_region_param_def_space,\n-                             param.space.to_uint() as u64);\n-\n-        rbml_w.wr_tagged_u64(tag_region_param_def_index,\n-                             param.index as u64);\n-\n-        for &bound_region in &param.bounds {\n-            encode_region(ecx, rbml_w, bound_region);\n-        }\n-\n+        tyencode::enc_region_param_def(rbml_w.writer, &ecx.ty_str_ctxt(), param);\n+        rbml_w.mark_stable_position();\n         rbml_w.end_tag();\n     }\n "}, {"sha": "797af8964a14da196088b5a6acc0f8eff4cea786", "filename": "src/librustc_metadata/tydecode.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/de6c52d5ead59349b8286d1a8a63d794af55a52f/src%2Flibrustc_metadata%2Ftydecode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de6c52d5ead59349b8286d1a8a63d794af55a52f/src%2Flibrustc_metadata%2Ftydecode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Ftydecode.rs?ref=de6c52d5ead59349b8286d1a8a63d794af55a52f", "patch": "@@ -636,7 +636,7 @@ impl<'a,'tcx> TyDecoder<'a,'tcx> {\n             def_id: def_id,\n             space: space,\n             index: index,\n-            bounds: bounds\n+            bounds: bounds,\n         }\n     }\n "}]}