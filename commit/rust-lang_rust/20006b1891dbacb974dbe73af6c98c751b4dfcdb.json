{"sha": "20006b1891dbacb974dbe73af6c98c751b4dfcdb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMDA2YjE4OTFkYmFjYjk3NGRiZTczYWY2Yzk4Yzc1MWI0ZGZjZGI=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-03-23T01:15:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-23T01:15:42Z"}, "message": "Rollup merge of #83356 - camelid:rustdoc-option-to-enum, r=GuillaumeGomez\n\nrustdoc: Replace pair of `Option`s with an enum\n\nThey are never both `None` or both `Some`, so it makes more sense to use\nan enum so that we \"make impossible states impossible\".", "tree": {"sha": "6a7beb3688984159bf539c42025a3b2d13e25e7e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a7beb3688984159bf539c42025a3b2d13e25e7e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20006b1891dbacb974dbe73af6c98c751b4dfcdb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgWUE+CRBK7hj4Ov3rIwAAdHIIAIk7u42qIaw7SAPdxXow0yuf\nYBEJJ40sRAlh5h7tLzfJ9ENvBToXuzPbRbLU3GyIwkSHunNNX3/yjzLCHNYdT+rs\nvMVgoxyzRfbvAfSOYQnzxX0oEhQQndmSJX8W1YCtALWMWfQkbJOXqGH37JNdlHN5\nCt6CmsJqMsbi2D+k+Q0xZOUqm/OzjotOTTGTF6xJXpbTI4ctErpWiIhNaSw1eZ85\nUfD11a/pZJL/csudm9pPt4+gVQPF7IvOcBvN1X9AvhQHMyu4+m8vVgJaGomaDypR\nX/EGCUodTY/msHfsqptZkVtP2XPh9+HnTSJIEnw231seqH4VAXQUi9KsD5l4Bgg=\n=x6ze\n-----END PGP SIGNATURE-----\n", "payload": "tree 6a7beb3688984159bf539c42025a3b2d13e25e7e\nparent a34cc6bbabefbc8e5dee9343f770b61016d4c6af\nparent f820fd2bc05afa4f5a7d6003c2c847bf85725cca\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1616462142 +0900\ncommitter GitHub <noreply@github.com> 1616462142 +0900\n\nRollup merge of #83356 - camelid:rustdoc-option-to-enum, r=GuillaumeGomez\n\nrustdoc: Replace pair of `Option`s with an enum\n\nThey are never both `None` or both `Some`, so it makes more sense to use\nan enum so that we \"make impossible states impossible\".\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20006b1891dbacb974dbe73af6c98c751b4dfcdb", "html_url": "https://github.com/rust-lang/rust/commit/20006b1891dbacb974dbe73af6c98c751b4dfcdb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20006b1891dbacb974dbe73af6c98c751b4dfcdb/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a34cc6bbabefbc8e5dee9343f770b61016d4c6af", "url": "https://api.github.com/repos/rust-lang/rust/commits/a34cc6bbabefbc8e5dee9343f770b61016d4c6af", "html_url": "https://github.com/rust-lang/rust/commit/a34cc6bbabefbc8e5dee9343f770b61016d4c6af"}, {"sha": "f820fd2bc05afa4f5a7d6003c2c847bf85725cca", "url": "https://api.github.com/repos/rust-lang/rust/commits/f820fd2bc05afa4f5a7d6003c2c847bf85725cca", "html_url": "https://github.com/rust-lang/rust/commit/f820fd2bc05afa4f5a7d6003c2c847bf85725cca"}], "stats": {"total": 19, "additions": 11, "deletions": 8}, "files": [{"sha": "b39f9f878921a9b9b2fac73ffe3ba9739e2d53a5", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/20006b1891dbacb974dbe73af6c98c751b4dfcdb/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20006b1891dbacb974dbe73af6c98c751b4dfcdb/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=20006b1891dbacb974dbe73af6c98c751b4dfcdb", "patch": "@@ -690,25 +690,29 @@ crate fn find_testable_code<T: doctest::Tester>(\n }\n \n crate struct ExtraInfo<'tcx> {\n-    hir_id: Option<HirId>,\n-    item_did: Option<DefId>,\n+    id: ExtraInfoId,\n     sp: Span,\n     tcx: TyCtxt<'tcx>,\n }\n \n+enum ExtraInfoId {\n+    Hir(HirId),\n+    Def(DefId),\n+}\n+\n impl<'tcx> ExtraInfo<'tcx> {\n     crate fn new(tcx: TyCtxt<'tcx>, hir_id: HirId, sp: Span) -> ExtraInfo<'tcx> {\n-        ExtraInfo { hir_id: Some(hir_id), item_did: None, sp, tcx }\n+        ExtraInfo { id: ExtraInfoId::Hir(hir_id), sp, tcx }\n     }\n \n     crate fn new_did(tcx: TyCtxt<'tcx>, did: DefId, sp: Span) -> ExtraInfo<'tcx> {\n-        ExtraInfo { hir_id: None, item_did: Some(did), sp, tcx }\n+        ExtraInfo { id: ExtraInfoId::Def(did), sp, tcx }\n     }\n \n     fn error_invalid_codeblock_attr(&self, msg: &str, help: &str) {\n-        let hir_id = match (self.hir_id, self.item_did) {\n-            (Some(h), _) => h,\n-            (None, Some(item_did)) => {\n+        let hir_id = match self.id {\n+            ExtraInfoId::Hir(hir_id) => hir_id,\n+            ExtraInfoId::Def(item_did) => {\n                 match item_did.as_local() {\n                     Some(item_did) => self.tcx.hir().local_def_id_to_hir_id(item_did),\n                     None => {\n@@ -717,7 +721,6 @@ impl<'tcx> ExtraInfo<'tcx> {\n                     }\n                 }\n             }\n-            (None, None) => return,\n         };\n         self.tcx.struct_span_lint_hir(\n             crate::lint::INVALID_CODEBLOCK_ATTRIBUTES,"}]}