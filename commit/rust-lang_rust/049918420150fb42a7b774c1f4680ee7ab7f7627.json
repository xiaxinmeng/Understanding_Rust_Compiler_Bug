{"sha": "049918420150fb42a7b774c1f4680ee7ab7f7627", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0OTkxODQyMDE1MGZiNDJhN2I3NzRjMWY0NjgwZWU3YWI3Zjc2Mjc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2019-05-11T06:19:35Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2019-05-11T06:40:42Z"}, "message": "Ignore desugarings in macro checks", "tree": {"sha": "fa7979dd3a8bdfcbbd505bfaf66a78cb835c7144", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa7979dd3a8bdfcbbd505bfaf66a78cb835c7144"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/049918420150fb42a7b774c1f4680ee7ab7f7627", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/049918420150fb42a7b774c1f4680ee7ab7f7627", "html_url": "https://github.com/rust-lang/rust/commit/049918420150fb42a7b774c1f4680ee7ab7f7627", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/049918420150fb42a7b774c1f4680ee7ab7f7627/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5661e5947f20030cf6f5d6c5715e81253fabd1a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/5661e5947f20030cf6f5d6c5715e81253fabd1a5", "html_url": "https://github.com/rust-lang/rust/commit/5661e5947f20030cf6f5d6c5715e81253fabd1a5"}], "stats": {"total": 27, "additions": 21, "deletions": 6}, "files": [{"sha": "7ebaeb0951f7477ebe2f22a049446c2ffec6df99", "filename": "clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/049918420150fb42a7b774c1f4680ee7ab7f7627/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/049918420150fb42a7b774c1f4680ee7ab7f7627/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=049918420150fb42a7b774c1f4680ee7ab7f7627", "patch": "@@ -40,6 +40,7 @@ use rustc_data_structures::sync::Lrc;\n use rustc_errors::Applicability;\n use syntax::ast::{self, LitKind};\n use syntax::attr;\n+use syntax::ext::hygiene::ExpnFormat;\n use syntax::source_map::{Span, DUMMY_SP};\n use syntax::symbol::{keywords, Symbol};\n \n@@ -90,7 +91,15 @@ pub fn in_constant(cx: &LateContext<'_, '_>, id: HirId) -> bool {\n \n /// Returns `true` if this `expn_info` was expanded by any macro.\n pub fn in_macro(span: Span) -> bool {\n-    span.ctxt().outer().expn_info().is_some()\n+    if let Some(info) = span.ctxt().outer().expn_info() {\n+        if let ExpnFormat::CompilerDesugaring(..) = info.format {\n+            false\n+        } else {\n+            true\n+        }\n+    } else {\n+        false\n+    }\n }\n \n // If the snippet is empty, it's an attribute that was inserted during macro"}, {"sha": "f5342be631b04888fb1ceddd7fe49fa3ff6f16a4", "filename": "tests/ui/into_iter_on_ref.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/049918420150fb42a7b774c1f4680ee7ab7f7627/tests%2Fui%2Finto_iter_on_ref.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/049918420150fb42a7b774c1f4680ee7ab7f7627/tests%2Fui%2Finto_iter_on_ref.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finto_iter_on_ref.fixed?ref=049918420150fb42a7b774c1f4680ee7ab7f7627", "patch": "@@ -10,7 +10,7 @@ fn main() {\n     for _ in &[1, 2, 3] {}\n     for _ in vec![X, X] {}\n     for _ in &vec![X, X] {}\n-    for _ in [1, 2, 3].into_iter() {} //~ ERROR equivalent to .iter()\n+    for _ in [1, 2, 3].iter() {} //~ ERROR equivalent to .iter()\n \n     let _ = [1, 2, 3].iter(); //~ ERROR equivalent to .iter()\n     let _ = vec![1, 2, 3].into_iter();"}, {"sha": "931e4880f938b47c0ffb6277a75f3d01f1b41d62", "filename": "tests/ui/into_iter_on_ref.stderr", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/049918420150fb42a7b774c1f4680ee7ab7f7627/tests%2Fui%2Finto_iter_on_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/049918420150fb42a7b774c1f4680ee7ab7f7627/tests%2Fui%2Finto_iter_on_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finto_iter_on_ref.stderr?ref=049918420150fb42a7b774c1f4680ee7ab7f7627", "patch": "@@ -1,15 +1,21 @@\n error: this .into_iter() call is equivalent to .iter() and will not move the array\n-  --> $DIR/into_iter_on_ref.rs:15:23\n+  --> $DIR/into_iter_on_ref.rs:13:24\n    |\n-LL |     let _ = [1, 2, 3].into_iter(); //~ ERROR equivalent to .iter()\n-   |                       ^^^^^^^^^ help: call directly: `iter`\n+LL |     for _ in [1, 2, 3].into_iter() {} //~ ERROR equivalent to .iter()\n+   |                        ^^^^^^^^^ help: call directly: `iter`\n    |\n note: lint level defined here\n   --> $DIR/into_iter_on_ref.rs:4:9\n    |\n LL | #![deny(clippy::into_iter_on_array)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n+error: this .into_iter() call is equivalent to .iter() and will not move the array\n+  --> $DIR/into_iter_on_ref.rs:15:23\n+   |\n+LL |     let _ = [1, 2, 3].into_iter(); //~ ERROR equivalent to .iter()\n+   |                       ^^^^^^^^^ help: call directly: `iter`\n+\n error: this .into_iter() call is equivalent to .iter() and will not move the Vec\n   --> $DIR/into_iter_on_ref.rs:17:30\n    |\n@@ -168,5 +174,5 @@ error: this .into_iter() call is equivalent to .iter() and will not move the Pat\n LL |     let _ = std::path::PathBuf::from(\"12/34\").into_iter(); //~ ERROR equivalent to .iter()\n    |                                               ^^^^^^^^^ help: call directly: `iter`\n \n-error: aborting due to 27 previous errors\n+error: aborting due to 28 previous errors\n "}]}