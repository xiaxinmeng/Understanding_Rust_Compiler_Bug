{"sha": "d264e954dc885bcb9cc5cc35cbbff862dffff6db", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyNjRlOTU0ZGM4ODViY2I5Y2M1Y2MzNWNiYmZmODYyZGZmZmY2ZGI=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-08T09:46:55Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-25T14:08:32Z"}, "message": "ci: extract enabling ipv6 on docker into a script", "tree": {"sha": "86fd45af5ac9aacab1472bc0369f858e1defa50e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86fd45af5ac9aacab1472bc0369f858e1defa50e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d264e954dc885bcb9cc5cc35cbbff862dffff6db", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl2zAeAACgkQPgar6Auq\n8ZzdqhAAwJcyTwpgH7eRZuMtz1WaRUYrrNEoB5FeFUYSdf7PBc6OCyu5qWmZOnse\npOfrtnIJ/Owi5Y41rpI4Ct1AkUu7f1db+2fxb4fAix2BydRXHBL1WoU9sew39E8M\nw7ihMZ0ePxM75J2Cyxp0ns7ERmdBPgcoI9KDFqZzz4YxIYE3Ruv4mZSeJ0QuOmth\n8s8e2QarXqNGuiWLPW9Xv9j5GmH1fempmqRrNwu9LwyoNZg/lmwisJHh1aHayCgK\n1TtFqsbskXXf8NXqTdOpQuZ0XDJJILtYhd8+ntIkSvA/WIC0fMe5cIGxzslOQjCY\n2jfKMET3O8ivv7w+rABCVQzAdZVTZPn4vyJIrAufvRf7HoUBUUODGAxaPPej7OJZ\n8BwPvqZ87l0PfQalM0L8vmho7qJYODAW7+LFxRtmJBKOW0f5UYnKWnPfWbUpZ5Ty\nloXKYY70fXJSOyNCrTKkdx1YMAoRD5ndI3IRS7zGiVVGVBM1RxuJZec6Va4O1TWQ\nVwO3PA+EMvMFEnIyehuWSjYdgpmGOqvjejhsGbDuM+CAQR0+IRKYCMfoY82dDFz7\nxPFdK6m7yw/LvPLArSqPhRAOG4RoqCOLKvipz6pekmkZvXbyM2agLr3lFHKjm6jc\nI5W9ddJa6XiqcjvUzoDcFsBDqo2Tg3Ra0x7HUdS72vvjQrcBv20=\n=UZl/\n-----END PGP SIGNATURE-----", "payload": "tree 86fd45af5ac9aacab1472bc0369f858e1defa50e\nparent bc9a0dc1b347d5d2ff361d0d501e3836f30affe0\nauthor Pietro Albini <pietro@pietroalbini.org> 1570528015 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1572012512 +0200\n\nci: extract enabling ipv6 on docker into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d264e954dc885bcb9cc5cc35cbbff862dffff6db", "html_url": "https://github.com/rust-lang/rust/commit/d264e954dc885bcb9cc5cc35cbbff862dffff6db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d264e954dc885bcb9cc5cc35cbbff862dffff6db/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "html_url": "https://github.com/rust-lang/rust/commit/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0"}], "stats": {"total": 28, "additions": 19, "deletions": 9}, "files": [{"sha": "0562b28ca9cb7ea52532362ada8d0445bd75d798", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d264e954dc885bcb9cc5cc35cbbff862dffff6db/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/d264e954dc885bcb9cc5cc35cbbff862dffff6db/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=d264e954dc885bcb9cc5cc35cbbff862dffff6db", "patch": "@@ -111,15 +111,11 @@ steps:\n   displayName: Install ninja\n   condition: and(succeeded(), not(variables.SKIP_JOB))\n \n-# Looks like docker containers have IPv6 disabled by default, so let's turn it\n-# on since libstd tests require it\n-- bash: |\n-    set -e\n-    sudo mkdir -p /etc/docker\n-    echo '{\"ipv6\":true,\"fixed-cidr-v6\":\"fd9a:8454:6789:13f7::/64\"}' | sudo tee /etc/docker/daemon.json\n-    sudo service docker restart\n-  displayName: Enable IPv6\n-  condition: and(succeeded(), not(variables.SKIP_JOB), eq(variables['Agent.OS'], 'Linux'))\n+- bash: src/ci/scripts/enable-docker-ipv6.sh\n+  env:\n+    AGENT_OS: $(Agent.OS)\n+  displayName: Enable IPv6 on Docker\n+  condition: and(succeeded(), not(variables.SKIP_JOB))\n \n # Disable automatic line ending conversion (again). On Windows, when we're\n # installing dependencies, something switches the git configuration directory or"}, {"sha": "35bb0ad7d29a4e85e8a5139390329a6e472ddae3", "filename": "src/ci/scripts/enable-docker-ipv6.sh", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d264e954dc885bcb9cc5cc35cbbff862dffff6db/src%2Fci%2Fscripts%2Fenable-docker-ipv6.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d264e954dc885bcb9cc5cc35cbbff862dffff6db/src%2Fci%2Fscripts%2Fenable-docker-ipv6.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fenable-docker-ipv6.sh?ref=d264e954dc885bcb9cc5cc35cbbff862dffff6db", "patch": "@@ -0,0 +1,14 @@\n+#!/bin/bash\n+# Looks like docker containers have IPv6 disabled by default, so let's turn it\n+# on since libstd tests require it\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n+\n+if isLinux; then\n+    sudo mkdir -p /etc/docker\n+    echo '{\"ipv6\":true,\"fixed-cidr-v6\":\"fd9a:8454:6789:13f7::/64\"}' | sudo tee /etc/docker/daemon.json\n+    sudo service docker restart\n+fi"}]}