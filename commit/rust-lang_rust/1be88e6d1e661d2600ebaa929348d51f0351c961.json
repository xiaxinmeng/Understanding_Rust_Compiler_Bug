{"sha": "1be88e6d1e661d2600ebaa929348d51f0351c961", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiZTg4ZTZkMWU2NjFkMjYwMGViYWE5MjkzNDhkNTFmMDM1MWM5NjE=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-05-16T10:43:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-16T10:43:03Z"}, "message": "Rollup merge of #72216 - doctorn:require-lang-item, r=lcnr\n\nRemove `lang_items\\(\\).*\\.unwrap\\(\\)`\n\nFollows up #72170 to remove the remaining uses of `lang_items\\(\\).*\\.unwrap\\(\\)` (avoids a bunch of potential ICEs when working in `#![no_core]`).\n\nResolves #72195", "tree": {"sha": "880014475911ed89131f7fb2b7ec6d755feed3af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/880014475911ed89131f7fb2b7ec6d755feed3af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1be88e6d1e661d2600ebaa929348d51f0351c961", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJev8O3CRBK7hj4Ov3rIwAAdHIIAFr2BcY2DBL2ZeXbiKwUpL+Q\npblkW4qxQMecLLkvJwAQ2u4dDkPxOh6yIvFIrdaXeTd/xZdA9FzDjBlXaIBHpCzg\n5RnbuoekN5kzGKj0qs32gyq+ZFmJXjAYnC4z6RmWDbzZ2yfAkqhoZZzfheB4J+UE\nbiUKPA5+eC1WG7t6hyA2ofOXCnw6GBmdga/dwswSUxBjjCJnf/9tiBERhD1H9Sso\n+9xIHaM8ZUohuFgSrvv5ni8+9bX7KtEcb3TbwIh98J89I2malziFpf/6yXWEW7R6\nB0O9s4OWu510RERphqzTZOjAE7nbhQTZItmR+o+2xtVEw3gV5Q85KwD+lLk+KYE=\n=6OfS\n-----END PGP SIGNATURE-----\n", "payload": "tree 880014475911ed89131f7fb2b7ec6d755feed3af\nparent e8f0fb1f1359d042e165b92a9c1053424b77a459\nparent 00268be9da13215398d779b2e344ffa3e300693c\nauthor Dylan DPC <dylan.dpc@gmail.com> 1589625783 +0200\ncommitter GitHub <noreply@github.com> 1589625783 +0200\n\nRollup merge of #72216 - doctorn:require-lang-item, r=lcnr\n\nRemove `lang_items\\(\\).*\\.unwrap\\(\\)`\n\nFollows up #72170 to remove the remaining uses of `lang_items\\(\\).*\\.unwrap\\(\\)` (avoids a bunch of potential ICEs when working in `#![no_core]`).\n\nResolves #72195\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1be88e6d1e661d2600ebaa929348d51f0351c961", "html_url": "https://github.com/rust-lang/rust/commit/1be88e6d1e661d2600ebaa929348d51f0351c961", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1be88e6d1e661d2600ebaa929348d51f0351c961/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e8f0fb1f1359d042e165b92a9c1053424b77a459", "url": "https://api.github.com/repos/rust-lang/rust/commits/e8f0fb1f1359d042e165b92a9c1053424b77a459", "html_url": "https://github.com/rust-lang/rust/commit/e8f0fb1f1359d042e165b92a9c1053424b77a459"}, {"sha": "00268be9da13215398d779b2e344ffa3e300693c", "url": "https://api.github.com/repos/rust-lang/rust/commits/00268be9da13215398d779b2e344ffa3e300693c", "html_url": "https://github.com/rust-lang/rust/commit/00268be9da13215398d779b2e344ffa3e300693c"}], "stats": {"total": 61, "additions": 34, "deletions": 27}, "files": [{"sha": "28edd87a3add5e055ebbeac083bb8f87ae559e2f", "filename": "src/librustc_mir/monomorphize/mod.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_mir%2Fmonomorphize%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_mir%2Fmonomorphize%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fmod.rs?ref=1be88e6d1e661d2600ebaa929348d51f0351c961", "patch": "@@ -2,6 +2,8 @@ use rustc_middle::traits;\n use rustc_middle::ty::adjustment::CustomCoerceUnsized;\n use rustc_middle::ty::{self, Ty, TyCtxt};\n \n+use rustc_hir::lang_items::CoerceUnsizedTraitLangItem;\n+\n pub mod collector;\n pub mod partitioning;\n \n@@ -10,7 +12,7 @@ pub fn custom_coerce_unsize_info<'tcx>(\n     source_ty: Ty<'tcx>,\n     target_ty: Ty<'tcx>,\n ) -> CustomCoerceUnsized {\n-    let def_id = tcx.lang_items().coerce_unsized_trait().unwrap();\n+    let def_id = tcx.require_lang_item(CoerceUnsizedTraitLangItem, None);\n \n     let trait_ref = ty::Binder::bind(ty::TraitRef {\n         def_id,"}, {"sha": "28ec2ca13d5af7f83e740ffe671f8b35942134f7", "filename": "src/librustc_mir_build/hair/pattern/const_to_pat.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_mir_build%2Fhair%2Fpattern%2Fconst_to_pat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_mir_build%2Fhair%2Fpattern%2Fconst_to_pat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir_build%2Fhair%2Fpattern%2Fconst_to_pat.rs?ref=1be88e6d1e661d2600ebaa929348d51f0351c961", "patch": "@@ -141,7 +141,8 @@ impl<'a, 'tcx> ConstToPat<'a, 'tcx> {\n                 // code at the moment, because types like `for <'a> fn(&'a ())` do\n                 // not *yet* implement `PartialEq`. So for now we leave this here.\n                 let ty_is_partial_eq: bool = {\n-                    let partial_eq_trait_id = self.tcx().require_lang_item(EqTraitLangItem, None);\n+                    let partial_eq_trait_id =\n+                        self.tcx().require_lang_item(EqTraitLangItem, Some(self.span));\n                     let obligation: PredicateObligation<'_> = predicate_for_trait_def(\n                         self.tcx(),\n                         self.param_env,"}, {"sha": "eb63505b69b413a73a8d0f8783a88c57a727012c", "filename": "src/librustc_trait_selection/traits/structural_match.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_trait_selection%2Ftraits%2Fstructural_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_trait_selection%2Ftraits%2Fstructural_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trait_selection%2Ftraits%2Fstructural_match.rs?ref=1be88e6d1e661d2600ebaa929348d51f0351c961", "patch": "@@ -4,6 +4,7 @@ use crate::traits::{self, ConstPatternStructural, TraitEngine};\n \n use rustc_data_structures::fx::FxHashSet;\n use rustc_hir as hir;\n+use rustc_hir::lang_items::{StructuralPeqTraitLangItem, StructuralTeqTraitLangItem};\n use rustc_middle::ty::{self, AdtDef, Ty, TyCtxt, TypeFoldable, TypeVisitor};\n use rustc_span::Span;\n \n@@ -69,7 +70,7 @@ pub fn type_marked_structural(\n     let mut fulfillment_cx = traits::FulfillmentContext::new();\n     let cause = ObligationCause::new(span, id, ConstPatternStructural);\n     // require `#[derive(PartialEq)]`\n-    let structural_peq_def_id = infcx.tcx.lang_items().structural_peq_trait().unwrap();\n+    let structural_peq_def_id = infcx.tcx.require_lang_item(StructuralPeqTraitLangItem, Some(span));\n     fulfillment_cx.register_bound(\n         infcx,\n         ty::ParamEnv::empty(),\n@@ -80,7 +81,7 @@ pub fn type_marked_structural(\n     // for now, require `#[derive(Eq)]`. (Doing so is a hack to work around\n     // the type `for<'a> fn(&'a ())` failing to implement `Eq` itself.)\n     let cause = ObligationCause::new(span, id, ConstPatternStructural);\n-    let structural_teq_def_id = infcx.tcx.lang_items().structural_teq_trait().unwrap();\n+    let structural_teq_def_id = infcx.tcx.require_lang_item(StructuralTeqTraitLangItem, Some(span));\n     fulfillment_cx.register_bound(\n         infcx,\n         ty::ParamEnv::empty(),"}, {"sha": "87a6f119acb09a6b34a26b774ce9b29d189a8e04", "filename": "src/librustc_typeck/check/closure.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcheck%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcheck%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fclosure.rs?ref=1be88e6d1e661d2600ebaa929348d51f0351c961", "patch": "@@ -6,7 +6,7 @@ use crate::astconv::AstConv;\n use crate::middle::region;\n use rustc_hir as hir;\n use rustc_hir::def_id::DefId;\n-use rustc_hir::lang_items;\n+use rustc_hir::lang_items::{FutureTraitLangItem, GeneratorTraitLangItem};\n use rustc_infer::infer::type_variable::{TypeVariableOrigin, TypeVariableOriginKind};\n use rustc_infer::infer::LateBoundRegionConversionTime;\n use rustc_infer::infer::{InferOk, InferResult};\n@@ -245,7 +245,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         let trait_ref = projection.to_poly_trait_ref(tcx);\n \n         let is_fn = tcx.fn_trait_kind_from_lang_item(trait_ref.def_id()).is_some();\n-        let gen_trait = tcx.require_lang_item(lang_items::GeneratorTraitLangItem, cause_span);\n+        let gen_trait = tcx.require_lang_item(GeneratorTraitLangItem, cause_span);\n         let is_gen = gen_trait == trait_ref.def_id();\n         if !is_fn && !is_gen {\n             debug!(\"deduce_sig_from_projection: not fn or generator\");\n@@ -678,7 +678,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         // Check that this is a projection from the `Future` trait.\n         let trait_ref = predicate.projection_ty.trait_ref(self.tcx);\n-        let future_trait = self.tcx.lang_items().future_trait().unwrap();\n+        let future_trait = self.tcx.require_lang_item(FutureTraitLangItem, Some(cause_span));\n         if trait_ref.def_id != future_trait {\n             debug!(\"deduce_future_output_from_projection: not a future\");\n             return None;"}, {"sha": "9694ce9450c27ec3565e9686ba3e3b35c4e3e404", "filename": "src/librustc_typeck/check/demand.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs?ref=1be88e6d1e661d2600ebaa929348d51f0351c961", "patch": "@@ -7,7 +7,7 @@ use rustc_trait_selection::traits::{self, ObligationCause};\n use rustc_ast::util::parser::PREC_POSTFIX;\n use rustc_errors::{Applicability, DiagnosticBuilder};\n use rustc_hir as hir;\n-use rustc_hir::lang_items::DerefTraitLangItem;\n+use rustc_hir::lang_items::{CloneTraitLangItem, DerefTraitLangItem};\n use rustc_hir::{is_range_literal, Node};\n use rustc_middle::ty::adjustment::AllowTwoPhase;\n use rustc_middle::ty::{self, AssocItem, Ty, TypeAndMut};\n@@ -456,8 +456,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 };\n                 if self.can_coerce(ref_ty, expected) {\n                     let mut sugg_sp = sp;\n-                    if let hir::ExprKind::MethodCall(segment, _sp, args) = &expr.kind {\n-                        let clone_trait = self.tcx.lang_items().clone_trait().unwrap();\n+                    if let hir::ExprKind::MethodCall(ref segment, sp, ref args) = expr.kind {\n+                        let clone_trait = self.tcx.require_lang_item(CloneTraitLangItem, Some(sp));\n                         if let ([arg], Some(true), sym::clone) = (\n                             &args[..],\n                             self.tables.borrow().type_dependent_def_id(expr.hir_id).map(|did| {\n@@ -635,7 +635,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             _ if sp == expr.span && !is_macro => {\n                 // Check for `Deref` implementations by constructing a predicate to\n                 // prove: `<T as Deref>::Output == U`\n-                let deref_trait = self.tcx.require_lang_item(DerefTraitLangItem, Some(expr.span));\n+                let deref_trait = self.tcx.require_lang_item(DerefTraitLangItem, Some(sp));\n                 let item_def_id = self\n                     .tcx\n                     .associated_items(deref_trait)"}, {"sha": "6bf836015d226b6596885d95304c96388b544958", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=1be88e6d1e661d2600ebaa929348d51f0351c961", "patch": "@@ -100,7 +100,9 @@ use rustc_hir::def::{CtorOf, DefKind, Res};\n use rustc_hir::def_id::{CrateNum, DefId, DefIdMap, DefIdSet, LocalDefId, LOCAL_CRATE};\n use rustc_hir::intravisit::{self, NestedVisitorMap, Visitor};\n use rustc_hir::itemlikevisit::ItemLikeVisitor;\n-use rustc_hir::lang_items;\n+use rustc_hir::lang_items::{\n+    FutureTraitLangItem, PinTypeLangItem, SizedTraitLangItem, VaListTypeLangItem,\n+};\n use rustc_hir::{ExprKind, GenericArg, HirIdMap, Item, ItemKind, Node, PatKind, QPath};\n use rustc_index::bit_set::BitSet;\n use rustc_index::vec::Idx;\n@@ -1335,10 +1337,8 @@ fn check_fn<'a, 'tcx>(\n     // C-variadic fns also have a `VaList` input that's not listed in `fn_sig`\n     // (as it's created inside the body itself, not passed in from outside).\n     let maybe_va_list = if fn_sig.c_variadic {\n-        let va_list_did = tcx.require_lang_item(\n-            lang_items::VaListTypeLangItem,\n-            Some(body.params.last().unwrap().span),\n-        );\n+        let va_list_did =\n+            tcx.require_lang_item(VaListTypeLangItem, Some(body.params.last().unwrap().span));\n         let region = tcx.mk_region(ty::ReScope(region::Scope {\n             id: body.value.hir_id.local_id,\n             data: region::ScopeData::CallSite,\n@@ -3296,7 +3296,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         code: traits::ObligationCauseCode<'tcx>,\n     ) {\n         if !ty.references_error() {\n-            let lang_item = self.tcx.require_lang_item(lang_items::SizedTraitLangItem, None);\n+            let lang_item = self.tcx.require_lang_item(SizedTraitLangItem, None);\n             self.require_type_meets(ty, span, code, lang_item);\n         }\n     }\n@@ -5135,7 +5135,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             _ => {}\n         }\n         let boxed_found = self.tcx.mk_box(found);\n-        let new_found = self.tcx.mk_lang_item(boxed_found, lang_items::PinTypeLangItem).unwrap();\n+        let new_found = self.tcx.mk_lang_item(boxed_found, PinTypeLangItem).unwrap();\n         if let (true, Ok(snippet)) = (\n             self.can_coerce(new_found, expected),\n             self.sess().source_map().span_to_snippet(expr.span),\n@@ -5292,7 +5292,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 let sp = expr.span;\n                 // Check for `Future` implementations by constructing a predicate to\n                 // prove: `<T as Future>::Output == U`\n-                let future_trait = self.tcx.lang_items().future_trait().unwrap();\n+                let future_trait = self.tcx.require_lang_item(FutureTraitLangItem, Some(sp));\n                 let item_def_id = self\n                     .tcx\n                     .associated_items(future_trait)"}, {"sha": "efa3cd9955b49610ad1537568bb145f130dbf4e5", "filename": "src/librustc_typeck/coherence/builtin.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcoherence%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1be88e6d1e661d2600ebaa929348d51f0351c961/src%2Flibrustc_typeck%2Fcoherence%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcoherence%2Fbuiltin.rs?ref=1be88e6d1e661d2600ebaa929348d51f0351c961", "patch": "@@ -4,7 +4,9 @@\n use rustc_errors::struct_span_err;\n use rustc_hir as hir;\n use rustc_hir::def_id::{DefId, LocalDefId};\n-use rustc_hir::lang_items::UnsizeTraitLangItem;\n+use rustc_hir::lang_items::{\n+    CoerceUnsizedTraitLangItem, DispatchFromDynTraitLangItem, UnsizeTraitLangItem,\n+};\n use rustc_hir::ItemKind;\n use rustc_infer::infer;\n use rustc_infer::infer::outlives::env::OutlivesEnvironment;\n@@ -145,11 +147,11 @@ fn visit_implementation_of_coerce_unsized(tcx: TyCtxt<'tcx>, impl_did: LocalDefI\n fn visit_implementation_of_dispatch_from_dyn(tcx: TyCtxt<'_>, impl_did: LocalDefId) {\n     debug!(\"visit_implementation_of_dispatch_from_dyn: impl_did={:?}\", impl_did);\n \n-    let dispatch_from_dyn_trait = tcx.lang_items().dispatch_from_dyn_trait().unwrap();\n-\n     let impl_hir_id = tcx.hir().as_local_hir_id(impl_did);\n     let span = tcx.hir().span(impl_hir_id);\n \n+    let dispatch_from_dyn_trait = tcx.require_lang_item(DispatchFromDynTraitLangItem, Some(span));\n+\n     let source = tcx.type_of(impl_did);\n     assert!(!source.has_escaping_bound_vars());\n     let target = {\n@@ -314,22 +316,23 @@ fn visit_implementation_of_dispatch_from_dyn(tcx: TyCtxt<'_>, impl_did: LocalDef\n \n pub fn coerce_unsized_info(tcx: TyCtxt<'tcx>, impl_did: DefId) -> CoerceUnsizedInfo {\n     debug!(\"compute_coerce_unsized_info(impl_did={:?})\", impl_did);\n-    let coerce_unsized_trait = tcx.lang_items().coerce_unsized_trait().unwrap();\n+\n+    // this provider should only get invoked for local def-ids\n+    let impl_hir_id = tcx.hir().as_local_hir_id(impl_did.expect_local());\n+    let span = tcx.hir().span(impl_hir_id);\n+\n+    let coerce_unsized_trait = tcx.require_lang_item(CoerceUnsizedTraitLangItem, Some(span));\n \n     let unsize_trait = tcx.lang_items().require(UnsizeTraitLangItem).unwrap_or_else(|err| {\n         tcx.sess.fatal(&format!(\"`CoerceUnsized` implementation {}\", err));\n     });\n \n-    // this provider should only get invoked for local def-ids\n-    let impl_hir_id = tcx.hir().as_local_hir_id(impl_did.expect_local());\n-\n     let source = tcx.type_of(impl_did);\n     let trait_ref = tcx.impl_trait_ref(impl_did).unwrap();\n     assert_eq!(trait_ref.def_id, coerce_unsized_trait);\n     let target = trait_ref.substs.type_at(1);\n     debug!(\"visit_implementation_of_coerce_unsized: {:?} -> {:?} (bound)\", source, target);\n \n-    let span = tcx.hir().span(impl_hir_id);\n     let param_env = tcx.param_env(impl_did);\n     assert!(!source.has_escaping_bound_vars());\n "}]}