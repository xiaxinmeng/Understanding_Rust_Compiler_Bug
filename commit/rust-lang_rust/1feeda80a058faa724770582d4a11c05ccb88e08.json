{"sha": "1feeda80a058faa724770582d4a11c05ccb88e08", "node_id": "C_kwDOAAsO6NoAKDFmZWVkYTgwYTA1OGZhYTcyNDc3MDU4MmQ0YTExYzA1Y2NiODhlMDg", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-11-30T10:13:19Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-11-30T10:13:19Z"}, "message": "Simplify --no-headless option for rustdoc-gui tester", "tree": {"sha": "9cd636c5e7de6581f0984fde309cc9b06d80eb56", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9cd636c5e7de6581f0984fde309cc9b06d80eb56"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1feeda80a058faa724770582d4a11c05ccb88e08", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1feeda80a058faa724770582d4a11c05ccb88e08", "html_url": "https://github.com/rust-lang/rust/commit/1feeda80a058faa724770582d4a11c05ccb88e08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1feeda80a058faa724770582d4a11c05ccb88e08/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9981e56d3b820f429fac62b4ff916f2a871340b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/9981e56d3b820f429fac62b4ff916f2a871340b4", "html_url": "https://github.com/rust-lang/rust/commit/9981e56d3b820f429fac62b4ff916f2a871340b4"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "3feb4940d87f837d27422e478eab9044509fdfec", "filename": "src/tools/rustdoc-gui/tester.js", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1feeda80a058faa724770582d4a11c05ccb88e08/src%2Ftools%2Frustdoc-gui%2Ftester.js", "raw_url": "https://github.com/rust-lang/rust/raw/1feeda80a058faa724770582d4a11c05ccb88e08/src%2Ftools%2Frustdoc-gui%2Ftester.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustdoc-gui%2Ftester.js?ref=1feeda80a058faa724770582d4a11c05ccb88e08", "patch": "@@ -172,11 +172,16 @@ async function main(argv) {\n     }\n     files.sort();\n \n+    if (no_headless) {\n+        opts[\"jobs\"] = 1;\n+        console.log(\"`--no-headless` option is active, disabling concurrency for running tests.\");\n+    }\n+\n     console.log(`Running ${files.length} rustdoc-gui (${opts[\"jobs\"]} concurrently) ...`);\n \n     if (opts[\"jobs\"] < 1) {\n         process.setMaxListeners(files.length + 1);\n-    } else {\n+    } else if (!no_headless) {\n         process.setMaxListeners(opts[\"jobs\"] + 1);\n     }\n \n@@ -217,9 +222,7 @@ async function main(argv) {\n                 tests_queue.splice(tests_queue.indexOf(callback), 1);\n             });\n         tests_queue.push(callback);\n-        if (no_headless) {\n-            await tests_queue[i];\n-        } else if (opts[\"jobs\"] > 0 && tests_queue.length >= opts[\"jobs\"]) {\n+        if (opts[\"jobs\"] > 0 && tests_queue.length >= opts[\"jobs\"]) {\n             await Promise.race(tests_queue);\n         }\n     }"}]}