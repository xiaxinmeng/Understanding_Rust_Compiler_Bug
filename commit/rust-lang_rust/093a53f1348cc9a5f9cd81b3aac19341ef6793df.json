{"sha": "093a53f1348cc9a5f9cd81b3aac19341ef6793df", "node_id": "C_kwDOAAsO6NoAKDA5M2E1M2YxMzQ4Y2M5YTVmOWNkODFiM2FhYzE5MzQxZWY2NzkzZGY", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-03-01T18:10:20Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-01T18:10:20Z"}, "message": "Rollup merge of #108462 - pommicket:fix-vecdeque-zst-overflow, r=Amanieu\n\nFix `VecDeque::append` capacity overflow for ZSTs\n\nFixes #108454.", "tree": {"sha": "c62cc125e2ce159413f81233f37ff0d6a929c46e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c62cc125e2ce159413f81233f37ff0d6a929c46e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/093a53f1348cc9a5f9cd81b3aac19341ef6793df", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj/5UMCRBK7hj4Ov3rIwAAXAsIACq22KKLbwrOUxj2I49Tonv2\nvVmOKlbU1uA/HU4jl5pA18AYJy6HAadIKTd6bgjd5WZ+RH+Y382rM1alqvP22L9y\nggJckLbG6ezSjxG6dLvgTEvSLpbeDUDPhgjHlj/zOKadKk+KxntdgSGWxapdC6eM\nbaxNtWVWj5cLsr/xG1/EvzWx4TKCCtlTXRGeZ6eW539/CYyporJzs5GojSasCI8u\nA+aEJq69+O/xViSW+YMcVp0p/9tIwVbAPq0+RI7lh+pLsoB8RWkC5kyQZQ0dYl4c\nFPvYbs+zpoynkWYinGhlfIYO1+TqEx/QC9nRR3csF9Fg6nNWC3aNnikno/oHtbk=\n=6FJ4\n-----END PGP SIGNATURE-----\n", "payload": "tree c62cc125e2ce159413f81233f37ff0d6a929c46e\nparent 27fa7b5e6d2eaeba5daf6354df9de0d03cdf795c\nparent 12f959ba39ad353ce07971aaf8cef564f86b068d\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1677694220 +0530\ncommitter GitHub <noreply@github.com> 1677694220 +0530\n\nRollup merge of #108462 - pommicket:fix-vecdeque-zst-overflow, r=Amanieu\n\nFix `VecDeque::append` capacity overflow for ZSTs\n\nFixes #108454.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/093a53f1348cc9a5f9cd81b3aac19341ef6793df", "html_url": "https://github.com/rust-lang/rust/commit/093a53f1348cc9a5f9cd81b3aac19341ef6793df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/093a53f1348cc9a5f9cd81b3aac19341ef6793df/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27fa7b5e6d2eaeba5daf6354df9de0d03cdf795c", "url": "https://api.github.com/repos/rust-lang/rust/commits/27fa7b5e6d2eaeba5daf6354df9de0d03cdf795c", "html_url": "https://github.com/rust-lang/rust/commit/27fa7b5e6d2eaeba5daf6354df9de0d03cdf795c"}, {"sha": "12f959ba39ad353ce07971aaf8cef564f86b068d", "url": "https://api.github.com/repos/rust-lang/rust/commits/12f959ba39ad353ce07971aaf8cef564f86b068d", "html_url": "https://github.com/rust-lang/rust/commit/12f959ba39ad353ce07971aaf8cef564f86b068d"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "8317ac431a5e1b5ba24091cd391a57302cebe55d", "filename": "library/alloc/src/collections/vec_deque/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/093a53f1348cc9a5f9cd81b3aac19341ef6793df/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/093a53f1348cc9a5f9cd81b3aac19341ef6793df/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs?ref=093a53f1348cc9a5f9cd81b3aac19341ef6793df", "patch": "@@ -1924,7 +1924,7 @@ impl<T, A: Allocator> VecDeque<T, A> {\n     #[stable(feature = \"append\", since = \"1.4.0\")]\n     pub fn append(&mut self, other: &mut Self) {\n         if T::IS_ZST {\n-            self.len += other.len;\n+            self.len = self.len.checked_add(other.len).expect(\"capacity overflow\");\n             other.len = 0;\n             other.head = 0;\n             return;"}, {"sha": "5a0b852e8d5e2b94fe3cfd52002512a0969ddbfe", "filename": "library/alloc/tests/vec_deque.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/093a53f1348cc9a5f9cd81b3aac19341ef6793df/library%2Falloc%2Ftests%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/093a53f1348cc9a5f9cd81b3aac19341ef6793df/library%2Falloc%2Ftests%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fvec_deque.rs?ref=093a53f1348cc9a5f9cd81b3aac19341ef6793df", "patch": "@@ -1045,6 +1045,20 @@ fn test_append_double_drop() {\n     assert_eq!(count_b, 1);\n }\n \n+#[test]\n+#[should_panic]\n+fn test_append_zst_capacity_overflow() {\n+    let mut v = Vec::with_capacity(usize::MAX);\n+    // note: using resize instead of set_len here would\n+    //       be *extremely* slow in unoptimized builds.\n+    // SAFETY: `v` has capacity `usize::MAX`, and no initialization\n+    //         is needed for empty tuples.\n+    unsafe { v.set_len(usize::MAX) };\n+    let mut v = VecDeque::from(v);\n+    let mut w = vec![()].into();\n+    v.append(&mut w);\n+}\n+\n #[test]\n fn test_retain() {\n     let mut buf = VecDeque::new();"}]}