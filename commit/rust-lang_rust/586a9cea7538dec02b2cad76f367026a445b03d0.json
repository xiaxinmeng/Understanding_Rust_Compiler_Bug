{"sha": "586a9cea7538dec02b2cad76f367026a445b03d0", "node_id": "C_kwDOAAsO6NoAKDU4NmE5Y2VhNzUzOGRlYzAyYjJjYWQ3NmYzNjcwMjZhNDQ1YjAzZDA", "commit": {"author": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-10-09T06:25:54Z"}, "committer": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-10-09T06:28:42Z"}, "message": "Move template initialization into its own file.", "tree": {"sha": "dea8e42eb475c3b2295a9dd2fd6597f694a66377", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dea8e42eb475c3b2295a9dd2fd6597f694a66377"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/586a9cea7538dec02b2cad76f367026a445b03d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/586a9cea7538dec02b2cad76f367026a445b03d0", "html_url": "https://github.com/rust-lang/rust/commit/586a9cea7538dec02b2cad76f367026a445b03d0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/586a9cea7538dec02b2cad76f367026a445b03d0/comments", "author": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a938005e1dcd385ceec40841004c410409950b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a938005e1dcd385ceec40841004c410409950b5", "html_url": "https://github.com/rust-lang/rust/commit/7a938005e1dcd385ceec40841004c410409950b5"}], "stats": {"total": 38, "additions": 23, "deletions": 15}, "files": [{"sha": "011d3cfcf72d7a1171356fdaff2c57d5a84f6ec0", "filename": "src/librustdoc/html/render/context.rs", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs?ref=586a9cea7538dec02b2cad76f367026a445b03d0", "patch": "@@ -1,6 +1,5 @@\n use std::cell::RefCell;\n use std::collections::BTreeMap;\n-use std::error::Error as StdError;\n use std::io;\n use std::path::{Path, PathBuf};\n use std::rc::Rc;\n@@ -16,6 +15,7 @@ use rustc_span::symbol::sym;\n \n use super::cache::{build_index, ExternalLocation};\n use super::print_item::{full_path, item_path, print_item};\n+use super::templates;\n use super::write_shared::write_shared;\n use super::{\n     collect_spans_and_sources, print_sidebar, settings, AllTypes, LinkFromSrc, NameDoc, StylePath,\n@@ -33,7 +33,6 @@ use crate::formats::FormatRenderer;\n use crate::html::escape::Escape;\n use crate::html::format::Buffer;\n use crate::html::markdown::{self, plain_text_summary, ErrorCodes, IdMap};\n-use crate::html::static_files::{PAGE, PRINT_ITEM};\n use crate::html::{layout, sources};\n \n /// Major driving force in all rustdoc rendering. This contains information\n@@ -416,16 +415,7 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n         };\n         let mut issue_tracker_base_url = None;\n         let mut include_sources = true;\n-\n-        let mut templates = tera::Tera::default();\n-        templates.add_raw_template(\"page.html\", PAGE).map_err(|e| Error {\n-            file: \"page.html\".into(),\n-            error: format!(\"{}: {}\", e, e.source().map(|e| e.to_string()).unwrap_or_default()),\n-        })?;\n-        templates.add_raw_template(\"print_item.html\", PRINT_ITEM).map_err(|e| Error {\n-            file: \"print_item.html\".into(),\n-            error: format!(\"{}: {}\", e, e.source().map(|e| e.to_string()).unwrap_or_default()),\n-        })?;\n+        let templates = templates::load()?;\n \n         // Crawl the crate attributes looking for attributes which control how we're\n         // going to emit HTML"}, {"sha": "e4c0ab6f10f48bec84baa1d59cd637254015b683", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=586a9cea7538dec02b2cad76f367026a445b03d0", "patch": "@@ -31,6 +31,7 @@ mod tests;\n mod context;\n mod print_item;\n mod span_map;\n+mod templates;\n mod write_shared;\n \n crate use context::*;"}, {"sha": "d1f182394479a5ea81952068dd5a50feafbe57de", "filename": "src/librustdoc/html/render/templates.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Frender%2Ftemplates.rs", "raw_url": "https://github.com/rust-lang/rust/raw/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Frender%2Ftemplates.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Ftemplates.rs?ref=586a9cea7538dec02b2cad76f367026a445b03d0", "patch": "@@ -0,0 +1,20 @@\n+use std::error::Error as StdError;\n+\n+use crate::error::Error;\n+\n+pub(crate) fn load() -> Result<tera::Tera, Error> {\n+    let mut templates = tera::Tera::default();\n+\n+    macro_rules! include_template {\n+        ($file:literal, $fullpath:literal) => {\n+            templates.add_raw_template($file, include_str!($fullpath)).map_err(|e| Error {\n+                file: $file.into(),\n+                error: format!(\"{}: {}\", e, e.source().map(|e| e.to_string()).unwrap_or_default()),\n+            })?\n+        };\n+    }\n+\n+    include_template!(\"page.html\", \"../templates/page.html\");\n+    include_template!(\"print_item.html\", \"../templates/print_item.html\");\n+    Ok(templates)\n+}"}, {"sha": "ccc25e6cc495fae43b31844288cfdbd3c728c341", "filename": "src/librustdoc/html/static_files.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "raw_url": "https://github.com/rust-lang/rust/raw/586a9cea7538dec02b2cad76f367026a445b03d0/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs?ref=586a9cea7538dec02b2cad76f367026a445b03d0", "patch": "@@ -70,9 +70,6 @@ crate static RUST_FAVICON_SVG: &[u8] = include_bytes!(\"static/images/favicon.svg\n crate static RUST_FAVICON_PNG_16: &[u8] = include_bytes!(\"static/images/favicon-16x16.png\");\n crate static RUST_FAVICON_PNG_32: &[u8] = include_bytes!(\"static/images/favicon-32x32.png\");\n \n-crate static PAGE: &str = include_str!(\"templates/page.html\");\n-crate static PRINT_ITEM: &str = include_str!(\"templates/print_item.html\");\n-\n /// The built-in themes given to every documentation site.\n crate mod themes {\n     /// The \"light\" theme, selected by default when no setting is available. Used as the basis for"}]}