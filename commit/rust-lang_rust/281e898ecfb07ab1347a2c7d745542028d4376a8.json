{"sha": "281e898ecfb07ab1347a2c7d745542028d4376a8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4MWU4OThlY2ZiMDdhYjEzNDdhMmM3ZDc0NTU0MjAyOGQ0Mzc2YTg=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-11-07T01:45:10Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-11-13T18:44:14Z"}, "message": "Bless back-compat breakages\n\nThis PR BREAKS CODE THAT WAS ACCEPTED ON STABLE. It's arguably a bug\nthat this was accepted in the first place, but here we are. See #62272\nfor more info.", "tree": {"sha": "bb9e6fc0b6f54a228d1d4dce2a5064debffec1ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bb9e6fc0b6f54a228d1d4dce2a5064debffec1ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/281e898ecfb07ab1347a2c7d745542028d4376a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/281e898ecfb07ab1347a2c7d745542028d4376a8", "html_url": "https://github.com/rust-lang/rust/commit/281e898ecfb07ab1347a2c7d745542028d4376a8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/281e898ecfb07ab1347a2c7d745542028d4376a8/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ce8ca45d63a65e0c0eaaa4a29f8ce3ccf5350b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ce8ca45d63a65e0c0eaaa4a29f8ce3ccf5350b9", "html_url": "https://github.com/rust-lang/rust/commit/3ce8ca45d63a65e0c0eaaa4a29f8ce3ccf5350b9"}], "stats": {"total": 55, "additions": 45, "deletions": 10}, "files": [{"sha": "d820c7051612456a128f108dfcdc0aeaa26b00eb", "filename": "src/test/ui/consts/const-eval/issue-52442.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-52442.rs", "raw_url": "https://github.com/rust-lang/rust/raw/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-52442.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-52442.rs?ref=281e898ecfb07ab1347a2c7d745542028d4376a8", "patch": "@@ -1,5 +1,6 @@\n fn main() {\n     [();  { &loop { break } as *const _ as usize } ];\n     //~^ ERROR casting pointers to integers in constants is unstable\n+    //~| ERROR `loop` is not allowed in a `const`\n     //~| ERROR evaluation of constant value failed\n }"}, {"sha": "fa2272f8d634df64d97f83ad3d57631e29734e4b", "filename": "src/test/ui/consts/const-eval/issue-52442.stderr", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-52442.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-52442.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-52442.stderr?ref=281e898ecfb07ab1347a2c7d745542028d4376a8", "patch": "@@ -1,3 +1,9 @@\n+error[E0744]: `loop` is not allowed in a `const`\n+  --> $DIR/issue-52442.rs:2:14\n+   |\n+LL |     [();  { &loop { break } as *const _ as usize } ];\n+   |              ^^^^^^^^^^^^^^\n+\n error[E0658]: casting pointers to integers in constants is unstable\n   --> $DIR/issue-52442.rs:2:13\n    |\n@@ -13,7 +19,7 @@ error[E0080]: evaluation of constant value failed\n LL |     [();  { &loop { break } as *const _ as usize } ];\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ \"pointer-to-integer cast\" needs an rfc before being allowed inside constants\n \n-error: aborting due to 2 previous errors\n+error: aborting due to 3 previous errors\n \n-Some errors have detailed explanations: E0080, E0658.\n+Some errors have detailed explanations: E0080, E0658, E0744.\n For more information about an error, try `rustc --explain E0080`."}, {"sha": "19abd91252db9725abc28b2a6e80bd58383b9625", "filename": "src/test/ui/consts/const-eval/issue-62272.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-62272.rs", "raw_url": "https://github.com/rust-lang/rust/raw/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-62272.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-62272.rs?ref=281e898ecfb07ab1347a2c7d745542028d4376a8", "patch": "@@ -1,9 +1,11 @@\n-// run-pass\n+// `loop`s unconditionally-broken-from used to be allowed in constants, but are now forbidden by\n+// the HIR const-checker.\n+//\n+// See https://github.com/rust-lang/rust/pull/66170 and\n+// https://github.com/rust-lang/rust/issues/62272.\n \n-// Tests that `loop`s unconditionally-broken-from are allowed in constants.\n-\n-const FOO: () = loop { break; };\n+const FOO: () = loop { break; }; //~ ERROR `loop` is not allowed in a `const`\n \n fn main() {\n-    [FOO; { let x; loop { x = 5; break; } x }];\n+    [FOO; { let x; loop { x = 5; break; } x }]; //~ ERROR `loop` is not allowed in a `const`\n }"}, {"sha": "573d04f5e47861b2bf214f47253594cf2e3a216b", "filename": "src/test/ui/consts/const-eval/issue-62272.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-62272.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-62272.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fissue-62272.stderr?ref=281e898ecfb07ab1347a2c7d745542028d4376a8", "patch": "@@ -0,0 +1,15 @@\n+error[E0744]: `loop` is not allowed in a `const`\n+  --> $DIR/issue-62272.rs:7:17\n+   |\n+LL | const FOO: () = loop { break; };\n+   |                 ^^^^^^^^^^^^^^^\n+\n+error[E0744]: `loop` is not allowed in a `const`\n+  --> $DIR/issue-62272.rs:10:20\n+   |\n+LL |     [FOO; { let x; loop { x = 5; break; } x }];\n+   |                    ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0744`."}, {"sha": "45e3cf438888e64344cd353c8e17054d09416e9d", "filename": "src/test/ui/consts/const-labeled-break.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-labeled-break.rs", "raw_url": "https://github.com/rust-lang/rust/raw/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-labeled-break.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-labeled-break.rs?ref=281e898ecfb07ab1347a2c7d745542028d4376a8", "patch": "@@ -1,10 +1,12 @@\n-// build-pass\n-\n // Using labeled break in a while loop has caused an illegal instruction being\n // generated, and an ICE later.\n //\n // See https://github.com/rust-lang/rust/issues/51350 for more information.\n+//\n+// It is now forbidden by the HIR const-checker.\n+//\n+// See https://github.com/rust-lang/rust/pull/66170.\n \n-const CRASH: () = 'a: while break 'a {};\n+const CRASH: () = 'a: while break 'a {}; //~ ERROR `while` is not allowed in a `const`\n \n fn main() {}"}, {"sha": "ec32386439fdcb23b03e8ce60b318d5b6c7cd165", "filename": "src/test/ui/consts/const-labeled-break.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-labeled-break.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/281e898ecfb07ab1347a2c7d745542028d4376a8/src%2Ftest%2Fui%2Fconsts%2Fconst-labeled-break.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-labeled-break.stderr?ref=281e898ecfb07ab1347a2c7d745542028d4376a8", "patch": "@@ -0,0 +1,9 @@\n+error[E0744]: `while` is not allowed in a `const`\n+  --> $DIR/const-labeled-break.rs:10:19\n+   |\n+LL | const CRASH: () = 'a: while break 'a {};\n+   |                   ^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0744`."}]}