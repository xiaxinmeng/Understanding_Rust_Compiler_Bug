{"sha": "2338903260e60e470268d92b7e4894d18a598d59", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzMzg5MDMyNjBlNjBlNDcwMjY4ZDkyYjdlNDg5NGQxOGE1OThkNTk=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-08-13T06:09:00Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-08-13T18:18:00Z"}, "message": "fn type: structure, and talk a bit more about ABIs and how to create them", "tree": {"sha": "1945d72b16f7b14405a12f6bbb6d8769334c62e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1945d72b16f7b14405a12f6bbb6d8769334c62e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2338903260e60e470268d92b7e4894d18a598d59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2338903260e60e470268d92b7e4894d18a598d59", "html_url": "https://github.com/rust-lang/rust/commit/2338903260e60e470268d92b7e4894d18a598d59", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2338903260e60e470268d92b7e4894d18a598d59/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5989bf48724031b72326a5b731a15fca101339e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/5989bf48724031b72326a5b731a15fca101339e2", "html_url": "https://github.com/rust-lang/rust/commit/5989bf48724031b72326a5b731a15fca101339e2"}], "stats": {"total": 57, "additions": 48, "deletions": 9}, "files": [{"sha": "565cf62c824ead4b7fda98b98415dce97e1774f3", "filename": "library/std/src/primitive_docs.rs", "status": "modified", "additions": 48, "deletions": 9, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/2338903260e60e470268d92b7e4894d18a598d59/library%2Fstd%2Fsrc%2Fprimitive_docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2338903260e60e470268d92b7e4894d18a598d59/library%2Fstd%2Fsrc%2Fprimitive_docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fprimitive_docs.rs?ref=2338903260e60e470268d92b7e4894d18a598d59", "patch": "@@ -1060,6 +1060,8 @@ mod prim_ref {}\n /// not be null, so if you want to pass a function pointer over FFI and be able to accommodate null\n /// pointers, make your type `Option<fn()>` with your required signature.\n ///\n+/// ### Safety\n+///\n /// Plain function pointers are obtained by casting either plain functions, or closures that don't\n /// capture an environment:\n ///\n@@ -1097,23 +1099,60 @@ mod prim_ref {}\n /// let really_safe_ptr: unsafe fn(usize) -> usize = add_one;\n /// ```\n ///\n-/// On top of that, function pointers can vary based on what ABI they use. This is achieved by\n-/// adding the `extern` keyword to the type name, followed by the ABI in question. For example,\n-/// `fn()` is different from `extern \"C\" fn()`, which itself is different from `extern \"stdcall\"\n-/// fn()`, and so on for the various ABIs that Rust supports. Non-`extern` functions have an ABI\n-/// of `\"Rust\"`, and `extern` functions without an explicit ABI have an ABI of `\"C\"`. For more\n-/// information, see [the nomicon's section on foreign calling conventions][nomicon-abi].\n+/// ### ABI\n+///\n+/// On top of that, function pointers can vary based on what ABI they use. This\n+/// is achieved by adding the `extern` keyword before the type, followed by the\n+/// ABI in question. The default ABI is \"Rust\", i.e., `fn()` is the exact same\n+/// type as `extern \"Rust\" fn()`. A pointer to a function with C ABI would have\n+/// type `extern \"C\" fn()`.\n+///\n+/// `extern \"ABI\" { ... }` blocks declare functions with ABI \"ABI\". The default\n+/// here is \"C\", i.e., functions declared in an `extern {...}` block have \"C\"\n+/// ABI.\n+///\n+/// For more information and a list of supported ABIs, see [the nomicon's\n+/// section on foreign calling conventions][nomicon-abi].\n ///\n-/// [nomicon-abi]: ../nomicon/ffi.html#foreign-calling-conventions\n+/// ### Variadic functions\n ///\n /// Extern function declarations with the \"C\" or \"cdecl\" ABIs can also be *variadic*, allowing them\n-/// to be called with a variable number of arguments. Normal rust functions, even those with an\n+/// to be called with a variable number of arguments. Normal Rust functions, even those with an\n /// `extern \"ABI\"`, cannot be variadic. For more information, see [the nomicon's section on\n /// variadic functions][nomicon-variadic].\n ///\n /// [nomicon-variadic]: ../nomicon/ffi.html#variadic-functions\n ///\n-/// These markers can be combined, so `unsafe extern \"stdcall\" fn()` is a valid type.\n+/// ### Creating function pointers\n+///\n+/// When `bar` is the name of a function, then the expression `bar` is *not* a\n+/// function pointer. Rather, it denotes a value of an unnameable type that\n+/// uniquely identifies the function `bar`. The value is zero-sized because the\n+/// type already identifies the function. This has the advantage that \"calling\"\n+/// the value (it implements the `Fn*` traits) does not require dynamic\n+/// dispatch.\n+///\n+/// This zero-sized type *coerces* to a regular function pointer. For example:\n+///\n+/// ```rust\n+/// use std::mem;\n+///\n+/// fn bar(x: i32) {}\n+///\n+/// let not_bar_ptr = bar; // `not_bar_ptr` is zero-sized, uniquely identifying `bar`\n+/// assert_eq!(mem::size_of_val(&not_bar_ptr), 0);\n+///\n+/// let bar_ptr: fn(i32) = not_bar_ptr; // force coercion to function pointer\n+/// assert_eq!(mem::size_of_val(&bar_ptr), mem::size_of::<usize>());\n+///\n+/// let footgun = &bar; // this is a shared reference to the zero-sized type identifying `bar`\n+/// ```\n+///\n+/// The last line shows that `&bar` is not a function pointer either. Rather, it\n+/// is a reference to the function-specific ZST. `&bar` is basically never what you\n+/// want when `bar` is a function.\n+///\n+/// ### Traits\n ///\n /// Function pointers implement the following traits:\n ///"}]}