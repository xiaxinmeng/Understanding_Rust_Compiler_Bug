{"sha": "3fe137a5b5d83883377787d37272513c5d61485c", "node_id": "C_kwDOAAsO6NoAKDNmZTEzN2E1YjVkODM4ODMzNzc3ODdkMzcyNzI1MTNjNWQ2MTQ4NWM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-25T11:29:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-25T11:29:50Z"}, "message": "Auto merge of #12382 - Veykril:ontype, r=lnicola\n\ninternal: Make autoclosing angle brackets configurable, disabled by default\n\ncc https://github.com/rust-lang/rust-analyzer/issues/12379", "tree": {"sha": "5e850c467d0827614a8d9da460d91b230f89b47f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e850c467d0827614a8d9da460d91b230f89b47f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3fe137a5b5d83883377787d37272513c5d61485c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3fe137a5b5d83883377787d37272513c5d61485c", "html_url": "https://github.com/rust-lang/rust/commit/3fe137a5b5d83883377787d37272513c5d61485c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3fe137a5b5d83883377787d37272513c5d61485c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d7c147406eff20783abba6ff1fe250ecc44cf800", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7c147406eff20783abba6ff1fe250ecc44cf800", "html_url": "https://github.com/rust-lang/rust/commit/d7c147406eff20783abba6ff1fe250ecc44cf800"}, {"sha": "f02c915eb537487c0b4217f816c0dc9f34b94146", "url": "https://api.github.com/repos/rust-lang/rust/commits/f02c915eb537487c0b4217f816c0dc9f34b94146", "html_url": "https://github.com/rust-lang/rust/commit/f02c915eb537487c0b4217f816c0dc9f34b94146"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "e02a6919203bce8028048e8d6e2e6eb84e510c8f", "filename": "crates/ide/src/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Fide%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Fide%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Flib.rs?ref=3fe137a5b5d83883377787d37272513c5d61485c", "patch": "@@ -342,11 +342,16 @@ impl Analysis {\n         &self,\n         position: FilePosition,\n         char_typed: char,\n+        autoclose: bool,\n     ) -> Cancellable<Option<SourceChange>> {\n         // Fast path to not even parse the file.\n         if !typing::TRIGGER_CHARS.contains(char_typed) {\n             return Ok(None);\n         }\n+        if char_typed == '<' && !autoclose {\n+            return Ok(None);\n+        }\n+\n         self.with_db(|db| typing::on_char_typed(db, position, char_typed))\n     }\n "}, {"sha": "9118f3c699c0c334e9dcb0c8b42368099942cefd", "filename": "crates/ide/src/typing.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Fide%2Fsrc%2Ftyping.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Fide%2Fsrc%2Ftyping.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Ftyping.rs?ref=3fe137a5b5d83883377787d37272513c5d61485c", "patch": "@@ -92,7 +92,7 @@ fn on_char_typed_inner(\n         '<' => on_left_angle_typed(&file.tree(), offset),\n         '>' => conv(on_right_angle_typed(&file.tree(), offset)),\n         '{' => conv(on_opening_brace_typed(file, offset)),\n-        _ => unreachable!(),\n+        _ => return None,\n     };\n \n     fn conv(text_edit: Option<TextEdit>) -> Option<ExtendedTextEdit> {"}, {"sha": "110575e85cb959cdec12b0693382fd43bb456180", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=3fe137a5b5d83883377787d37272513c5d61485c", "patch": "@@ -386,6 +386,9 @@ config_data! {\n         /// Show documentation.\n         signatureInfo_documentation_enable: bool                       = \"true\",\n \n+        /// Whether to insert closing angle brackets when typing an opening angle bracket of a generic argument list.\n+        typing_autoClosingAngleBrackets_enable: bool = \"false\",\n+\n         /// Workspace symbol search kind.\n         workspace_symbol_search_kind: WorkspaceSymbolSearchKindDef = \"\\\"only_types\\\"\",\n         /// Limits the number of items returned from a workspace symbol search (Defaults to 128).\n@@ -1220,6 +1223,10 @@ impl Config {\n             n => n,\n         }\n     }\n+\n+    pub fn typing_autoclose_angle(&self) -> bool {\n+        self.data.typing_autoClosingAngleBrackets_enable\n+    }\n }\n // Deserialization definitions\n "}, {"sha": "6567157bcbb3a3ac307c79b08600a4dac6d6e2cd", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fe137a5b5d83883377787d37272513c5d61485c/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=3fe137a5b5d83883377787d37272513c5d61485c", "patch": "@@ -299,7 +299,8 @@ pub(crate) fn handle_on_type_formatting(\n         return Ok(None);\n     }\n \n-    let edit = snap.analysis.on_char_typed(position, char_typed)?;\n+    let edit =\n+        snap.analysis.on_char_typed(position, char_typed, snap.config.typing_autoclose_angle())?;\n     let edit = match edit {\n         Some(it) => it,\n         None => return Ok(None),"}, {"sha": "389124ed8bf5e7216e9eebf1b7d37a94bb16ad78", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3fe137a5b5d83883377787d37272513c5d61485c/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/3fe137a5b5d83883377787d37272513c5d61485c/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=3fe137a5b5d83883377787d37272513c5d61485c", "patch": "@@ -593,6 +593,11 @@ Show full signature of the callable. Only shows parameters if disabled.\n --\n Show documentation.\n --\n+[[rust-analyzer.typing.autoClosingAngleBrackets.enable]]rust-analyzer.typing.autoClosingAngleBrackets.enable (default: `false`)::\n++\n+--\n+Whether to insert closing angle brackets when typing an opening angle bracket of a generic argument list.\n+--\n [[rust-analyzer.workspace.symbol.search.kind]]rust-analyzer.workspace.symbol.search.kind (default: `\"only_types\"`)::\n +\n --"}, {"sha": "1c87f0ad82a1b5693d013701f417a8cde5c2c48a", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3fe137a5b5d83883377787d37272513c5d61485c/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/3fe137a5b5d83883377787d37272513c5d61485c/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=3fe137a5b5d83883377787d37272513c5d61485c", "patch": "@@ -1068,6 +1068,11 @@\n                     \"default\": true,\n                     \"type\": \"boolean\"\n                 },\n+                \"rust-analyzer.typing.autoClosingAngleBrackets.enable\": {\n+                    \"markdownDescription\": \"Whether to insert closing angle brackets when typing an opening angle bracket of a generic argument list.\",\n+                    \"default\": false,\n+                    \"type\": \"boolean\"\n+                },\n                 \"rust-analyzer.workspace.symbol.search.kind\": {\n                     \"markdownDescription\": \"Workspace symbol search kind.\",\n                     \"default\": \"only_types\","}]}