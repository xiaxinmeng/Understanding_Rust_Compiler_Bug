{"sha": "938637033c093af6e85580589a7ac677ecb448cd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzODYzNzAzM2MwOTNhZjZlODU1ODA1ODlhN2FjNjc3ZWNiNDQ4Y2Q=", "commit": {"author": {"name": "Erik Desjardins", "email": "erikdesjardins@users.noreply.github.com", "date": "2021-03-07T19:03:35Z"}, "committer": {"name": "Erik Desjardins", "email": "erikdesjardins@users.noreply.github.com", "date": "2021-03-07T22:56:09Z"}, "message": "add codegen tests for some issues closed by LLVM 12", "tree": {"sha": "963d5e044ae69b04c1e8435984f706ff08283498", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/963d5e044ae69b04c1e8435984f706ff08283498"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/938637033c093af6e85580589a7ac677ecb448cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/938637033c093af6e85580589a7ac677ecb448cd", "html_url": "https://github.com/rust-lang/rust/commit/938637033c093af6e85580589a7ac677ecb448cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/938637033c093af6e85580589a7ac677ecb448cd/comments", "author": {"login": "erikdesjardins", "id": 7673145, "node_id": "MDQ6VXNlcjc2NzMxNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7673145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erikdesjardins", "html_url": "https://github.com/erikdesjardins", "followers_url": "https://api.github.com/users/erikdesjardins/followers", "following_url": "https://api.github.com/users/erikdesjardins/following{/other_user}", "gists_url": "https://api.github.com/users/erikdesjardins/gists{/gist_id}", "starred_url": "https://api.github.com/users/erikdesjardins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erikdesjardins/subscriptions", "organizations_url": "https://api.github.com/users/erikdesjardins/orgs", "repos_url": "https://api.github.com/users/erikdesjardins/repos", "events_url": "https://api.github.com/users/erikdesjardins/events{/privacy}", "received_events_url": "https://api.github.com/users/erikdesjardins/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erikdesjardins", "id": 7673145, "node_id": "MDQ6VXNlcjc2NzMxNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7673145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erikdesjardins", "html_url": "https://github.com/erikdesjardins", "followers_url": "https://api.github.com/users/erikdesjardins/followers", "following_url": "https://api.github.com/users/erikdesjardins/following{/other_user}", "gists_url": "https://api.github.com/users/erikdesjardins/gists{/gist_id}", "starred_url": "https://api.github.com/users/erikdesjardins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erikdesjardins/subscriptions", "organizations_url": "https://api.github.com/users/erikdesjardins/orgs", "repos_url": "https://api.github.com/users/erikdesjardins/repos", "events_url": "https://api.github.com/users/erikdesjardins/events{/privacy}", "received_events_url": "https://api.github.com/users/erikdesjardins/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66ec64ccf31883cd2c28d045912a76179c0c6ed2", "url": "https://api.github.com/repos/rust-lang/rust/commits/66ec64ccf31883cd2c28d045912a76179c0c6ed2", "html_url": "https://github.com/rust-lang/rust/commit/66ec64ccf31883cd2c28d045912a76179c0c6ed2"}], "stats": {"total": 76, "additions": 76, "deletions": 0}, "files": [{"sha": "6ba4d707f42b14088a21591427e311862d1db77b", "filename": "src/test/codegen/issue-73031.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/938637033c093af6e85580589a7ac677ecb448cd/src%2Ftest%2Fcodegen%2Fissue-73031.rs", "raw_url": "https://github.com/rust-lang/rust/raw/938637033c093af6e85580589a7ac677ecb448cd/src%2Ftest%2Fcodegen%2Fissue-73031.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fissue-73031.rs?ref=938637033c093af6e85580589a7ac677ecb448cd", "patch": "@@ -0,0 +1,27 @@\n+// min-llvm-version: 12.0.0\n+// compile-flags: -O\n+#![crate_type = \"lib\"]\n+\n+// Test that LLVM can eliminate the unreachable `All::None` branch.\n+\n+pub enum All {\n+    None,\n+    Foo,\n+    Bar,\n+}\n+\n+// CHECK-LABEL: @issue_73031\n+#[no_mangle]\n+pub fn issue_73031(a: &mut All, q: i32) -> i32 {\n+    *a = if q == 5 {\n+        All::Foo\n+    } else {\n+        All::Bar\n+    };\n+    match *a {\n+        // CHECK-NOT: panic\n+        All::None => panic!(),\n+        All::Foo => 1,\n+        All::Bar => 2,\n+    }\n+}"}, {"sha": "49e4d4c7ec56da3ff0761a26b55a4a0044b68101", "filename": "src/test/codegen/issue-75546.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/938637033c093af6e85580589a7ac677ecb448cd/src%2Ftest%2Fcodegen%2Fissue-75546.rs", "raw_url": "https://github.com/rust-lang/rust/raw/938637033c093af6e85580589a7ac677ecb448cd/src%2Ftest%2Fcodegen%2Fissue-75546.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fissue-75546.rs?ref=938637033c093af6e85580589a7ac677ecb448cd", "patch": "@@ -0,0 +1,16 @@\n+// min-llvm-version: 12.0.0\n+// compile-flags: -O\n+#![crate_type = \"lib\"]\n+\n+// Test that LLVM can eliminate the impossible `i == 0` check.\n+\n+// CHECK-LABEL: @issue_75546\n+#[no_mangle]\n+pub fn issue_75546() {\n+    let mut i = 1u32;\n+    while i < u32::MAX {\n+        // CHECK-NOT: panic\n+        if i == 0 { panic!(); }\n+        i += 1;\n+    }\n+}"}, {"sha": "95042579adb6b65f20c909bfc650c22d390c4f67", "filename": "src/test/codegen/issue-77812.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/938637033c093af6e85580589a7ac677ecb448cd/src%2Ftest%2Fcodegen%2Fissue-77812.rs", "raw_url": "https://github.com/rust-lang/rust/raw/938637033c093af6e85580589a7ac677ecb448cd/src%2Ftest%2Fcodegen%2Fissue-77812.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fissue-77812.rs?ref=938637033c093af6e85580589a7ac677ecb448cd", "patch": "@@ -0,0 +1,33 @@\n+// min-llvm-version: 12.0.0\n+// compile-flags: -O\n+#![crate_type = \"lib\"]\n+\n+// Test that LLVM can eliminate the unreachable `Variant::Zero` branch.\n+\n+#[derive(Copy, Clone, Eq, PartialEq)]\n+pub enum Variant {\n+    Zero,\n+    One,\n+    Two,\n+}\n+\n+extern {\n+    fn exf1();\n+    fn exf2();\n+}\n+\n+pub static mut GLOBAL: Variant = Variant::Zero;\n+\n+// CHECK-LABEL: @issue_77812\n+#[no_mangle]\n+pub unsafe fn issue_77812() {\n+    let g = GLOBAL;\n+    if g != Variant::Zero {\n+        match g {\n+            Variant::One => exf1(),\n+            Variant::Two => exf2(),\n+            // CHECK-NOT: panic\n+            Variant::Zero => panic!(),\n+        }\n+    }\n+}"}]}