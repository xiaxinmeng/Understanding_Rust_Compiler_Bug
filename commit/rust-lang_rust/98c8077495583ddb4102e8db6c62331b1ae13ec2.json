{"sha": "98c8077495583ddb4102e8db6c62331b1ae13ec2", "node_id": "C_kwDOAAsO6NoAKDk4YzgwNzc0OTU1ODNkZGI0MTAyZThkYjZjNjIzMzFiMWFlMTNlYzI", "commit": {"author": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2023-02-03T09:11:11Z"}, "committer": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2023-02-03T09:11:11Z"}, "message": "fix: support non-ascii characters in case conversion", "tree": {"sha": "aab2656e75145b667fa62b3b7ddc8bd0f59d2822", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aab2656e75145b667fa62b3b7ddc8bd0f59d2822"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/98c8077495583ddb4102e8db6c62331b1ae13ec2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEkSbsQIURluxz4rzf4laYqTBYYXEFAmPcz/0ACgkQ4laYqTBY\nYXEsMw//brM/AjSSc8X1fPtgjRjThnc9XjX21Ltf6KHdecuwQDs1hxJTWt8QL8OT\nwvpdrovM4UzUZ41V8zaMHIl0FR/iXxxgIEFu3GpMi68WTVMY5aE6eTqNncC9DIsw\npiCLFjBWkVmXxj3PGzibmH0noB7ekO7bjB0MYyG7kbHtyf66ueVyaogLv0OqdI8s\nWmANXlSNNTsS1OJqzozjInzC+PHP868AyBie2YlgrDFSHDe1/vBgs6vIdclctbS3\nSj0ErKeZVI57E3FtrCJG+/T/OedtLbnT24loNVRQ/4t2Fw9d5nRV2GTOgoxf7vqB\nqS1gehyyJiRPIa9ixRAoAoK/av/YjlOOWKqKlgGqK3gZX6dBogU6DXEerpq4GDq5\n+dI8PSEsnCIw09r0nbuJu4Uz9ZnkAwwZYyxF4ytfdqlnnN3NAyS1ifQpdcGVmZQC\n/W5NXX0Hc7jGvdFzdsvDJzbsMif9pjKtiF3mFI3X+eCXVm/wrTwLb3FEk/w3CJ7O\nGiVALVOTeurBG5OB+MtqAYw82xhcbWniG6EpHifbcg5f2IHOxFJER7yRbtaai3pW\nE7O/98v0Z88pERn69+IXHss5THr7ywd0FETOQmvXX2YkMwb7hhZP8KxAj8X2v4Uf\nFwGwEX0QUusgwgEJ5+Duk5wgWhPGgDP648uJFv9OibxT4jhzKvM=\n=yxCE\n-----END PGP SIGNATURE-----", "payload": "tree aab2656e75145b667fa62b3b7ddc8bd0f59d2822\nparent 04850a192cd82f94ddbd3f4b202d0e4ea3e62daa\nauthor Ryo Yoshida <low.ryoshida@gmail.com> 1675415471 +0900\ncommitter Ryo Yoshida <low.ryoshida@gmail.com> 1675415471 +0900\n\nfix: support non-ascii characters in case conversion\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/98c8077495583ddb4102e8db6c62331b1ae13ec2", "html_url": "https://github.com/rust-lang/rust/commit/98c8077495583ddb4102e8db6c62331b1ae13ec2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/98c8077495583ddb4102e8db6c62331b1ae13ec2/comments", "author": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04850a192cd82f94ddbd3f4b202d0e4ea3e62daa", "url": "https://api.github.com/repos/rust-lang/rust/commits/04850a192cd82f94ddbd3f4b202d0e4ea3e62daa", "html_url": "https://github.com/rust-lang/rust/commit/04850a192cd82f94ddbd3f4b202d0e4ea3e62daa"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "2c136896209242b391e769d5e0e3c37d663f7e75", "filename": "crates/hir-ty/src/diagnostics/decl_check/case_conv.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/98c8077495583ddb4102e8db6c62331b1ae13ec2/crates%2Fhir-ty%2Fsrc%2Fdiagnostics%2Fdecl_check%2Fcase_conv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98c8077495583ddb4102e8db6c62331b1ae13ec2/crates%2Fhir-ty%2Fsrc%2Fdiagnostics%2Fdecl_check%2Fcase_conv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fdiagnostics%2Fdecl_check%2Fcase_conv.rs?ref=98c8077495583ddb4102e8db6c62331b1ae13ec2", "patch": "@@ -162,6 +162,7 @@ mod tests {\n         check(to_lower_snake_case, \"a\", expect![[\"\"]]);\n         check(to_lower_snake_case, \"abc\", expect![[\"\"]]);\n         check(to_lower_snake_case, \"foo__bar\", expect![[\"foo_bar\"]]);\n+        check(to_lower_snake_case, \"\u0394\", expect![\"\u03b4\"]);\n     }\n \n     #[test]\n@@ -195,5 +196,6 @@ mod tests {\n         check(to_upper_snake_case, \"X86_64\", expect![[\"\"]]);\n         check(to_upper_snake_case, \"FOO_BAr\", expect![[\"FOO_BAR\"]]);\n         check(to_upper_snake_case, \"FOO__BAR\", expect![[\"FOO_BAR\"]]);\n+        check(to_upper_snake_case, \"\u00df\", expect![\"SS\"]);\n     }\n }"}, {"sha": "bd24d7d28bac936545cddd7eb79db6a273972914", "filename": "crates/stdx/src/lib.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/98c8077495583ddb4102e8db6c62331b1ae13ec2/crates%2Fstdx%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98c8077495583ddb4102e8db6c62331b1ae13ec2/crates%2Fstdx%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fstdx%2Fsrc%2Flib.rs?ref=98c8077495583ddb4102e8db6c62331b1ae13ec2", "patch": "@@ -2,9 +2,9 @@\n \n #![warn(rust_2018_idioms, unused_lifetimes, semicolon_in_expressions_from_macros)]\n \n+use std::io as sio;\n use std::process::Command;\n use std::{cmp::Ordering, ops, time::Instant};\n-use std::{io as sio, iter};\n \n mod macros;\n pub mod hash;\n@@ -39,15 +39,19 @@ Uncomment `default = [ \"backtrace\" ]` in `crates/stdx/Cargo.toml`.\n }\n \n pub fn to_lower_snake_case(s: &str) -> String {\n-    to_snake_case(s, char::to_ascii_lowercase)\n+    to_snake_case(s, char::to_lowercase)\n }\n pub fn to_upper_snake_case(s: &str) -> String {\n-    to_snake_case(s, char::to_ascii_uppercase)\n+    to_snake_case(s, char::to_uppercase)\n }\n \n // Code partially taken from rust/compiler/rustc_lint/src/nonstandard_style.rs\n // commit: 9626f2b\n-fn to_snake_case<F: Fn(&char) -> char>(mut s: &str, change_case: F) -> String {\n+fn to_snake_case<F, I>(mut s: &str, change_case: F) -> String\n+where\n+    F: Fn(char) -> I,\n+    I: Iterator<Item = char>,\n+{\n     let mut words = vec![];\n \n     // Preserve leading underscores\n@@ -75,7 +79,7 @@ fn to_snake_case<F: Fn(&char) -> char>(mut s: &str, change_case: F) -> String {\n             }\n \n             last_upper = ch.is_uppercase();\n-            buf.extend(iter::once(change_case(&ch)));\n+            buf.extend(change_case(ch));\n         }\n \n         words.push(buf);"}]}