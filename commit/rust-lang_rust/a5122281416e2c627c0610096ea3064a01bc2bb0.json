{"sha": "a5122281416e2c627c0610096ea3064a01bc2bb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1MTIyMjgxNDE2ZTJjNjI3YzA2MTAwOTZlYTMwNjRhMDFiYzJiYjA=", "commit": {"author": {"name": "Tom Tromey", "email": "tom@tromey.com", "date": "2017-11-09T21:04:12Z"}, "committer": {"name": "Tom Tromey", "email": "tom@tromey.com", "date": "2017-11-15T08:43:24Z"}, "message": "Allow minimum system LLVM version in tests\n\nThis adds a \"min-system-llvm-version\" directive, so that a test can\nindicate that it will either work with rust-llvm or with some minimal\nsystem LLVM.  This makes it simpler to write a test that requires an\nLLVM patch that landed upstream and was then backported to rust-llvm.", "tree": {"sha": "aa3a0b8f231628fdb0f173f0fd4ada238d730999", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa3a0b8f231628fdb0f173f0fd4ada238d730999"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5122281416e2c627c0610096ea3064a01bc2bb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5122281416e2c627c0610096ea3064a01bc2bb0", "html_url": "https://github.com/rust-lang/rust/commit/a5122281416e2c627c0610096ea3064a01bc2bb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5122281416e2c627c0610096ea3064a01bc2bb0/comments", "author": {"login": "tromey", "id": 1557670, "node_id": "MDQ6VXNlcjE1NTc2NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tromey", "html_url": "https://github.com/tromey", "followers_url": "https://api.github.com/users/tromey/followers", "following_url": "https://api.github.com/users/tromey/following{/other_user}", "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}", "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tromey/subscriptions", "organizations_url": "https://api.github.com/users/tromey/orgs", "repos_url": "https://api.github.com/users/tromey/repos", "events_url": "https://api.github.com/users/tromey/events{/privacy}", "received_events_url": "https://api.github.com/users/tromey/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tromey", "id": 1557670, "node_id": "MDQ6VXNlcjE1NTc2NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tromey", "html_url": "https://github.com/tromey", "followers_url": "https://api.github.com/users/tromey/followers", "following_url": "https://api.github.com/users/tromey/following{/other_user}", "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}", "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tromey/subscriptions", "organizations_url": "https://api.github.com/users/tromey/orgs", "repos_url": "https://api.github.com/users/tromey/repos", "events_url": "https://api.github.com/users/tromey/events{/privacy}", "received_events_url": "https://api.github.com/users/tromey/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f93a4928c2168bcc475b4fe77ba9f9e5494ffe1c", "url": "https://api.github.com/repos/rust-lang/rust/commits/f93a4928c2168bcc475b4fe77ba9f9e5494ffe1c", "html_url": "https://github.com/rust-lang/rust/commit/f93a4928c2168bcc475b4fe77ba9f9e5494ffe1c"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "430c02ccbf805bb5031ee3986dfb156a22ac381f", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a5122281416e2c627c0610096ea3064a01bc2bb0/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5122281416e2c627c0610096ea3064a01bc2bb0/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=a5122281416e2c627c0610096ea3064a01bc2bb0", "patch": "@@ -150,6 +150,14 @@ impl EarlyProps {\n                     // Ignore if actual version is smaller the minimum required\n                     // version\n                     &actual_version[..] < min_version\n+                } else if line.starts_with(\"min-system-llvm-version\") {\n+                    let min_version = line.trim_right()\n+                        .rsplit(' ')\n+                        .next()\n+                        .expect(\"Malformed llvm version directive\");\n+                    // Ignore if using system LLVM and actual version\n+                    // is smaller the minimum required version\n+                    !(config.system_llvm && &actual_version[..] < min_version)\n                 } else {\n                     false\n                 }"}]}