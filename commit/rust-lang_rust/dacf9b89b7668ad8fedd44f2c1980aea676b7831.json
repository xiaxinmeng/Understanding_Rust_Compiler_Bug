{"sha": "dacf9b89b7668ad8fedd44f2c1980aea676b7831", "node_id": "C_kwDOAAsO6NoAKGRhY2Y5Yjg5Yjc2NjhhZDhmZWRkNDRmMmMxOTgwYWVhNjc2Yjc4MzE", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-11-13T20:37:42Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-11-13T20:37:42Z"}, "message": "Extend GUI test for theme settings", "tree": {"sha": "4fc5aadbcda20d1ecb39adc62b4faaba3792b42f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4fc5aadbcda20d1ecb39adc62b4faaba3792b42f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dacf9b89b7668ad8fedd44f2c1980aea676b7831", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dacf9b89b7668ad8fedd44f2c1980aea676b7831", "html_url": "https://github.com/rust-lang/rust/commit/dacf9b89b7668ad8fedd44f2c1980aea676b7831", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dacf9b89b7668ad8fedd44f2c1980aea676b7831/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4074aae052ca58c98c9f5949195edc20ccf4b82d", "url": "https://api.github.com/repos/rust-lang/rust/commits/4074aae052ca58c98c9f5949195edc20ccf4b82d", "html_url": "https://github.com/rust-lang/rust/commit/4074aae052ca58c98c9f5949195edc20ccf4b82d"}], "stats": {"total": 47, "additions": 41, "deletions": 6}, "files": [{"sha": "cc47f1f450c5a79b65b8c7527ef3ba97e769c278", "filename": "src/test/rustdoc-gui/theme-change.goml", "status": "modified", "additions": 41, "deletions": 6, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/dacf9b89b7668ad8fedd44f2c1980aea676b7831/src%2Ftest%2Frustdoc-gui%2Ftheme-change.goml", "raw_url": "https://github.com/rust-lang/rust/raw/dacf9b89b7668ad8fedd44f2c1980aea676b7831/src%2Ftest%2Frustdoc-gui%2Ftheme-change.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftheme-change.goml?ref=dacf9b89b7668ad8fedd44f2c1980aea676b7831", "patch": "@@ -2,31 +2,66 @@\n goto: \"file://\" + |DOC_PATH| + \"/test_docs/index.html\"\n local-storage: {\"rustdoc-use-system-theme\": \"false\", \"rustdoc-theme\": \"dark\"}\n reload:\n+\n+store-value: (background_light, \"rgb(255, 255, 255)\")\n+store-value: (background_dark, \"rgb(53, 53, 53)\")\n+store-value: (background_ayu, \"rgb(15, 20, 25)\")\n+\n click: \"#settings-menu\"\n wait-for: \"#theme-ayu\"\n click: \"#theme-ayu\"\n // should be the ayu theme so let's check the color.\n-wait-for-css: (\"body\", { \"background-color\": \"rgb(15, 20, 25)\" })\n+wait-for-css: (\"body\", { \"background-color\": |background_ayu| })\n assert-local-storage: { \"rustdoc-theme\": \"ayu\" }\n click: \"#theme-light\"\n // should be the light theme so let's check the color.\n-wait-for-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n+wait-for-css: (\"body\", { \"background-color\": |background_light| })\n assert-local-storage: { \"rustdoc-theme\": \"light\" }\n click: \"#theme-dark\"\n // Should be the dark theme so let's check the color.\n-wait-for-css: (\"body\", { \"background-color\": \"rgb(53, 53, 53)\" })\n+wait-for-css: (\"body\", { \"background-color\": |background_dark| })\n assert-local-storage: { \"rustdoc-theme\": \"dark\" }\n \n+local-storage: {\n+    \"rustdoc-preferred-light-theme\": \"light\",\n+    \"rustdoc-preferred-dark-theme\": \"light\",\n+}\n goto: \"file://\" + |DOC_PATH| + \"/settings.html\"\n+\n wait-for: \"#settings\"\n click: \"#theme-light\"\n-wait-for-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n+wait-for-css: (\"body\", { \"background-color\": |background_light| })\n assert-local-storage: { \"rustdoc-theme\": \"light\" }\n \n click: \"#theme-dark\"\n-wait-for-css: (\"body\", { \"background-color\": \"rgb(53, 53, 53)\" })\n+wait-for-css: (\"body\", { \"background-color\": |background_dark| })\n assert-local-storage: { \"rustdoc-theme\": \"dark\" }\n \n click: \"#theme-ayu\"\n-wait-for-css: (\"body\", { \"background-color\": \"rgb(15, 20, 25)\" })\n+wait-for-css: (\"body\", { \"background-color\": |background_ayu| })\n assert-local-storage: { \"rustdoc-theme\": \"ayu\" }\n+\n+assert-local-storage-false: { \"rustdoc-use-system-theme\": \"true\" }\n+click: \"#theme-system-preference\"\n+wait-for: \".setting-line:not(.hidden) #preferred-light-theme\"\n+assert-local-storage: { \"rustdoc-use-system-theme\": \"true\" }\n+// We click on both preferred light and dark themes to be sure that there is a change.\n+click: \"#preferred-light-theme-dark\"\n+click: \"#preferred-dark-theme-dark\"\n+wait-for-css: (\"body\", { \"background-color\": |background_dark| })\n+\n+reload:\n+// Ensure that the \"preferred themes\" are still displayed.\n+wait-for: \".setting-line:not(.hidden) #preferred-light-theme\"\n+click: \"#theme-light\"\n+wait-for-css: (\"body\", { \"background-color\": |background_light| })\n+assert-local-storage: { \"rustdoc-theme\": \"light\" }\n+// Ensure it's now hidden again\n+wait-for: \".setting-line.hidden #preferred-light-theme\"\n+// And ensure the theme was rightly set.\n+wait-for-css: (\"body\", { \"background-color\": |background_light| })\n+assert-local-storage: { \"rustdoc-theme\": \"light\" }\n+\n+reload:\n+wait-for: \"#settings\"\n+assert: \".setting-line.hidden #preferred-light-theme\""}]}