{"sha": "18caf88956ecf454e24307e598b8ac9967f10b07", "node_id": "C_kwDOAAsO6NoAKDE4Y2FmODg5NTZlY2Y0NTRlMjQzMDdlNTk4YjhhYzk5NjdmMTBiMDc", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-02T05:27:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-02T05:27:32Z"}, "message": "Auto merge of #107879 - icedrocket:update-llvm, r=cuviper\n\nUpdate LLVM submodule\n\nFixes #105626", "tree": {"sha": "bdbde06d9ce62e4de233cda1d46d8c8a27e7e1c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bdbde06d9ce62e4de233cda1d46d8c8a27e7e1c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/18caf88956ecf454e24307e598b8ac9967f10b07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/18caf88956ecf454e24307e598b8ac9967f10b07", "html_url": "https://github.com/rust-lang/rust/commit/18caf88956ecf454e24307e598b8ac9967f10b07", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/18caf88956ecf454e24307e598b8ac9967f10b07/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "864b6258fc7b493aec01f980b31ff23901c0edae", "url": "https://api.github.com/repos/rust-lang/rust/commits/864b6258fc7b493aec01f980b31ff23901c0edae", "html_url": "https://github.com/rust-lang/rust/commit/864b6258fc7b493aec01f980b31ff23901c0edae"}, {"sha": "565de58dd705e6b4dc1adda0f96b102360276ef5", "url": "https://api.github.com/repos/rust-lang/rust/commits/565de58dd705e6b4dc1adda0f96b102360276ef5", "html_url": "https://github.com/rust-lang/rust/commit/565de58dd705e6b4dc1adda0f96b102360276ef5"}], "stats": {"total": 45, "additions": 35, "deletions": 10}, "files": [{"sha": "5a105007f21fce4a26b27fb7ad46346ed6c98b09", "filename": "src/bootstrap/config/tests.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/18caf88956ecf454e24307e598b8ac9967f10b07/src%2Fbootstrap%2Fconfig%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18caf88956ecf454e24307e598b8ac9967f10b07/src%2Fbootstrap%2Fconfig%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig%2Ftests.rs?ref=18caf88956ecf454e24307e598b8ac9967f10b07", "patch": "@@ -11,6 +11,11 @@ fn parse(config: &str) -> Config {\n \n #[test]\n fn download_ci_llvm() {\n+    if crate::native::is_ci_llvm_modified(&parse(\"\")) {\n+        eprintln!(\"Detected LLVM as non-available: running in CI and modified LLVM in this change\");\n+        return;\n+    }\n+\n     let parse_llvm = |s| parse(s).llvm_from_ci;\n     let if_available = parse_llvm(\"llvm.download-ci-llvm = \\\"if-available\\\"\");\n "}, {"sha": "5987b641b3927c24104e7644a78f50674ea05f0d", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/18caf88956ecf454e24307e598b8ac9967f10b07/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18caf88956ecf454e24307e598b8ac9967f10b07/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=18caf88956ecf454e24307e598b8ac9967f10b07", "patch": "@@ -216,21 +216,24 @@ pub(crate) fn is_ci_llvm_available(config: &Config, asserts: bool) -> bool {\n         }\n     }\n \n-    if CiEnv::is_ci() {\n+    if is_ci_llvm_modified(config) {\n+        eprintln!(\"Detected LLVM as non-available: running in CI and modified LLVM in this change\");\n+        return false;\n+    }\n+\n+    true\n+}\n+\n+/// Returns true if we're running in CI with modified LLVM (and thus can't download it)\n+pub(crate) fn is_ci_llvm_modified(config: &Config) -> bool {\n+    CiEnv::is_ci() && {\n         // We assume we have access to git, so it's okay to unconditionally pass\n         // `true` here.\n         let llvm_sha = detect_llvm_sha(config, true);\n         let head_sha = output(config.git().arg(\"rev-parse\").arg(\"HEAD\"));\n         let head_sha = head_sha.trim();\n-        if llvm_sha == head_sha {\n-            eprintln!(\n-                \"Detected LLVM as non-available: running in CI and modified LLVM in this change\"\n-            );\n-            return false;\n-        }\n+        llvm_sha == head_sha\n     }\n-\n-    true\n }\n \n #[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]"}, {"sha": "fd949f3034f8a422ecfffa889c2823485dde4bdd", "filename": "src/llvm-project", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fllvm-project?ref=18caf88956ecf454e24307e598b8ac9967f10b07", "patch": "@@ -1 +1 @@\n-Subproject commit 477e7285b12f876ad105188cfcfc8adda7dc29aa\n+Subproject commit fd949f3034f8a422ecfffa889c2823485dde4bdd"}, {"sha": "f97edd510c9e66635a196e42739af9873f3a6667", "filename": "tests/ui/numbers-arithmetic/issue-105626.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/18caf88956ecf454e24307e598b8ac9967f10b07/tests%2Fui%2Fnumbers-arithmetic%2Fissue-105626.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18caf88956ecf454e24307e598b8ac9967f10b07/tests%2Fui%2Fnumbers-arithmetic%2Fissue-105626.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fnumbers-arithmetic%2Fissue-105626.rs?ref=18caf88956ecf454e24307e598b8ac9967f10b07", "patch": "@@ -0,0 +1,17 @@\n+// run-pass\n+// only-x86\n+// min-system-llvm-version: 16\n+// compile-flags: -Ctarget-feature=+sse2\n+\n+use std::hint::black_box;\n+\n+fn main() {\n+    let n: i64 = black_box(0x3fffffdfffffff);\n+    let r = f32::from_bits(0x5a7fffff);\n+\n+    assert_ne!((n as f64) as f32, n as f32);\n+\n+    // FIXME: these assertions fail if only x87 is enabled\n+    assert_eq!(n as i64 as f32, r);\n+    assert_eq!(n as u64 as f32, r);\n+}"}]}