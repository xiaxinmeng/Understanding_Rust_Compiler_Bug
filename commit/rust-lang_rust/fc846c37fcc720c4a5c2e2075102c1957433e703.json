{"sha": "fc846c37fcc720c4a5c2e2075102c1957433e703", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjODQ2YzM3ZmNjNzIwYzRhNWMyZTIwNzUxMDJjMTk1NzQzM2U3MDM=", "commit": {"author": {"name": "Tim Nielens", "email": "tim.nielens@gmail.com", "date": "2020-10-11T22:06:21Z"}, "committer": {"name": "Tim Nielens", "email": "tim.nielens@gmail.com", "date": "2020-10-14T20:16:48Z"}, "message": "manual_unwrap_or / use consts::constant_simple helper", "tree": {"sha": "060f6bd3666390f39fc042fcc9f0ba6274b541fe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/060f6bd3666390f39fc042fcc9f0ba6274b541fe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc846c37fcc720c4a5c2e2075102c1957433e703", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc846c37fcc720c4a5c2e2075102c1957433e703", "html_url": "https://github.com/rust-lang/rust/commit/fc846c37fcc720c4a5c2e2075102c1957433e703", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc846c37fcc720c4a5c2e2075102c1957433e703/comments", "author": {"login": "tnielens", "id": 11885535, "node_id": "MDQ6VXNlcjExODg1NTM1", "avatar_url": "https://avatars.githubusercontent.com/u/11885535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tnielens", "html_url": "https://github.com/tnielens", "followers_url": "https://api.github.com/users/tnielens/followers", "following_url": "https://api.github.com/users/tnielens/following{/other_user}", "gists_url": "https://api.github.com/users/tnielens/gists{/gist_id}", "starred_url": "https://api.github.com/users/tnielens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tnielens/subscriptions", "organizations_url": "https://api.github.com/users/tnielens/orgs", "repos_url": "https://api.github.com/users/tnielens/repos", "events_url": "https://api.github.com/users/tnielens/events{/privacy}", "received_events_url": "https://api.github.com/users/tnielens/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tnielens", "id": 11885535, "node_id": "MDQ6VXNlcjExODg1NTM1", "avatar_url": "https://avatars.githubusercontent.com/u/11885535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tnielens", "html_url": "https://github.com/tnielens", "followers_url": "https://api.github.com/users/tnielens/followers", "following_url": "https://api.github.com/users/tnielens/following{/other_user}", "gists_url": "https://api.github.com/users/tnielens/gists{/gist_id}", "starred_url": "https://api.github.com/users/tnielens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tnielens/subscriptions", "organizations_url": "https://api.github.com/users/tnielens/orgs", "repos_url": "https://api.github.com/users/tnielens/repos", "events_url": "https://api.github.com/users/tnielens/events{/privacy}", "received_events_url": "https://api.github.com/users/tnielens/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d4eeeabcda6d6d25738e1e8e2b64580daefc4b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d4eeeabcda6d6d25738e1e8e2b64580daefc4b9", "html_url": "https://github.com/rust-lang/rust/commit/6d4eeeabcda6d6d25738e1e8e2b64580daefc4b9"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "ced941fac1a48b7520d26d6f170e20854cf44a30", "filename": "clippy_lints/src/manual_unwrap_or.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/fc846c37fcc720c4a5c2e2075102c1957433e703/clippy_lints%2Fsrc%2Fmanual_unwrap_or.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc846c37fcc720c4a5c2e2075102c1957433e703/clippy_lints%2Fsrc%2Fmanual_unwrap_or.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmanual_unwrap_or.rs?ref=fc846c37fcc720c4a5c2e2075102c1957433e703", "patch": "@@ -1,3 +1,4 @@\n+use crate::consts::constant_simple;\n use crate::utils;\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n@@ -18,15 +19,17 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// match int_option {\n+    /// let foo: Option<i32> = None;\n+    /// match foo {\n     ///     Some(v) => v,\n     ///     None => 1,\n-    /// }\n+    /// };\n     /// ```\n     ///\n     /// Use instead:\n     /// ```rust\n-    /// int_option.unwrap_or(1)\n+    /// let foo: Option<i32> = None;\n+    /// foo.unwrap_or(1);\n     /// ```\n     pub MANUAL_UNWRAP_OR,\n     complexity,\n@@ -84,7 +87,7 @@ fn lint_option_unwrap_or_case<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'tc\n         then {\n             let reindented_none_body =\n                 utils::reindent_multiline(none_body_snippet.into(), true, Some(indent));\n-            let eager_eval = utils::eager_or_lazy::is_eagerness_candidate(cx, none_arm.body);\n+            let eager_eval = constant_simple(cx, cx.typeck_results(), none_arm.body).is_some();\n             let method = if eager_eval {\n                 \"unwrap_or\"\n             } else {"}, {"sha": "a9cc8678c9d17e25d71e541f40893762a3d25190", "filename": "tests/ui/manual_unwrap_or.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fc846c37fcc720c4a5c2e2075102c1957433e703/tests%2Fui%2Fmanual_unwrap_or.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/fc846c37fcc720c4a5c2e2075102c1957433e703/tests%2Fui%2Fmanual_unwrap_or.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_unwrap_or.fixed?ref=fc846c37fcc720c4a5c2e2075102c1957433e703", "patch": "@@ -9,7 +9,7 @@ fn unwrap_or() {\n     Some(1).unwrap_or(42);\n \n     // richer none expr\n-    Some(1).unwrap_or_else(|| 1 + 42);\n+    Some(1).unwrap_or(1 + 42);\n \n     // multiline case\n     Some(1).unwrap_or_else(|| {"}, {"sha": "8f6835ed78d290002a7f7d3e335196d3d828a6c2", "filename": "tests/ui/manual_unwrap_or.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fc846c37fcc720c4a5c2e2075102c1957433e703/tests%2Fui%2Fmanual_unwrap_or.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fc846c37fcc720c4a5c2e2075102c1957433e703/tests%2Fui%2Fmanual_unwrap_or.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_unwrap_or.stderr?ref=fc846c37fcc720c4a5c2e2075102c1957433e703", "patch": "@@ -18,14 +18,14 @@ LL | |         Some(i) => i,\n LL | |     };\n    | |_____^ help: replace with: `Some(1).unwrap_or(42)`\n \n-error: this pattern reimplements `Option::unwrap_or_else`\n+error: this pattern reimplements `Option::unwrap_or`\n   --> $DIR/manual_unwrap_or.rs:18:5\n    |\n LL | /     match Some(1) {\n LL | |         Some(i) => i,\n LL | |         None => 1 + 42,\n LL | |     };\n-   | |_____^ help: replace with: `Some(1).unwrap_or_else(|| 1 + 42)`\n+   | |_____^ help: replace with: `Some(1).unwrap_or(1 + 42)`\n \n error: this pattern reimplements `Option::unwrap_or_else`\n   --> $DIR/manual_unwrap_or.rs:24:5"}]}