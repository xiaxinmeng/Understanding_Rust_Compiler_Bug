{"sha": "e45c83ca2313977850a971a4ca22610c191f1dc0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0NWM4M2NhMjMxMzk3Nzg1MGE5NzFhNGNhMjI2MTBjMTkxZjFkYzA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-06-13T12:51:57Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-06-13T12:51:57Z"}, "message": "Rollup merge of #61757 - sfackler:deprecate-once-init, r=alexcrichton\n\nDeprecate ONCE_INIT in future 1.38 release\n\nOnce::new() has been a stable const fn for a while now.\n\nCloses #61746", "tree": {"sha": "d4b875f986aa29b3a20c45284fa3a08223a48e13", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4b875f986aa29b3a20c45284fa3a08223a48e13"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e45c83ca2313977850a971a4ca22610c191f1dc0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdAkbtCRBK7hj4Ov3rIwAAdHIIAHt3VsXAMMYtLGBnWrFxkZzQ\nXJffJ9OMWdYj6cWRimWGa3uWaEAHwYhzOKM23IivrSaIAXpAC/gNTAJdJ19Ee+oY\nS7nGcK89h5VXKYj6b9Lby+leWUsa0veDdWYq2MTroH95AeTa5C6tSegAlQgaJXOC\nlEHjHNIbNik7dlb1xYenSFW0wZAWCVVXa0r6+OW4w/Qviz+IJ4d8uX/qYxri9JDx\nCF5RkKsCR8NYPiyu4ry7fIzMm/knhjSONk9TjZnV9ylCuXoL0myFhPOGNi4YTU4J\nIbmh9KwgkwLe+SXbsC1PmEq5+xzdTUSC5Ud6CUiAzYZ0Nnl2m7XJMgenkRbi5f4=\n=jo2S\n-----END PGP SIGNATURE-----\n", "payload": "tree d4b875f986aa29b3a20c45284fa3a08223a48e13\nparent ca06f8896b62c58fe366bdecf2c237d8a195fd0f\nparent 72e99f57c5118430361d23ed8e8815c1dd7271a5\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1560430317 +0200\ncommitter GitHub <noreply@github.com> 1560430317 +0200\n\nRollup merge of #61757 - sfackler:deprecate-once-init, r=alexcrichton\n\nDeprecate ONCE_INIT in future 1.38 release\n\nOnce::new() has been a stable const fn for a while now.\n\nCloses #61746\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e45c83ca2313977850a971a4ca22610c191f1dc0", "html_url": "https://github.com/rust-lang/rust/commit/e45c83ca2313977850a971a4ca22610c191f1dc0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e45c83ca2313977850a971a4ca22610c191f1dc0/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca06f8896b62c58fe366bdecf2c237d8a195fd0f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca06f8896b62c58fe366bdecf2c237d8a195fd0f", "html_url": "https://github.com/rust-lang/rust/commit/ca06f8896b62c58fe366bdecf2c237d8a195fd0f"}, {"sha": "72e99f57c5118430361d23ed8e8815c1dd7271a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/72e99f57c5118430361d23ed8e8815c1dd7271a5", "html_url": "https://github.com/rust-lang/rust/commit/72e99f57c5118430361d23ed8e8815c1dd7271a5"}], "stats": {"total": 14, "additions": 10, "deletions": 4}, "files": [{"sha": "395270f5bb53aeb08b3b8c9efc83d1b53bd0c194", "filename": "src/librustc_metadata/dynamic_lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Flibrustc_metadata%2Fdynamic_lib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Flibrustc_metadata%2Fdynamic_lib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fdynamic_lib.rs?ref=e45c83ca2313977850a971a4ca22610c191f1dc0", "patch": "@@ -161,8 +161,8 @@ mod dl {\n     pub fn check_for_errors_in<T, F>(f: F) -> Result<T, String> where\n         F: FnOnce() -> T,\n     {\n-        use std::sync::{Mutex, Once, ONCE_INIT};\n-        static INIT: Once = ONCE_INIT;\n+        use std::sync::{Mutex, Once};\n+        static INIT: Once = Once::new();\n         static mut LOCK: *mut Mutex<()> = 0 as *mut _;\n         unsafe {\n             INIT.call_once(|| {"}, {"sha": "fd6e46fd61dc581d7c331de0aecba4c16a6ece5f", "filename": "src/libstd/sync/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Flibstd%2Fsync%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Flibstd%2Fsync%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fmod.rs?ref=e45c83ca2313977850a971a4ca22610c191f1dc0", "patch": "@@ -163,6 +163,7 @@ pub use self::condvar::{Condvar, WaitTimeoutResult};\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub use self::mutex::{Mutex, MutexGuard};\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+#[allow(deprecated)]\n pub use self::once::{Once, OnceState, ONCE_INIT};\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub use crate::sys_common::poison::{PoisonError, TryLockError, TryLockResult, LockResult};"}, {"sha": "e529b8c4227fa7a1d4c6c5ca14f0cb070529380e", "filename": "src/libstd/sync/once.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Flibstd%2Fsync%2Fonce.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Flibstd%2Fsync%2Fonce.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fonce.rs?ref=e45c83ca2313977850a971a4ca22610c191f1dc0", "patch": "@@ -115,6 +115,11 @@ pub struct OnceState {\n /// static START: Once = ONCE_INIT;\n /// ```\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+#[rustc_deprecated(\n+    since = \"1.38.0\",\n+    reason = \"the `new` function is now preferred\",\n+    suggestion = \"Once::new()\",\n+)]\n pub const ONCE_INIT: Once = Once::new();\n \n // Four states that a Once can be in, encoded into the lower bits of `state` in"}, {"sha": "2e2b480e0660225e07e6764e2108aa41ead777f7", "filename": "src/test/run-pass/issues/issue-39367.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Ftest%2Frun-pass%2Fissues%2Fissue-39367.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e45c83ca2313977850a971a4ca22610c191f1dc0/src%2Ftest%2Frun-pass%2Fissues%2Fissue-39367.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissues%2Fissue-39367.rs?ref=e45c83ca2313977850a971a4ca22610c191f1dc0", "patch": "@@ -11,13 +11,13 @@ fn arena() -> &'static ArenaSet<Vec<u8>> {\n         ArenaSet(vec![], &Z)\n     }\n     unsafe {\n-        use std::sync::{Once, ONCE_INIT};\n+        use std::sync::Once;\n         fn require_sync<T: Sync>(_: &T) { }\n         unsafe fn __stability() -> &'static ArenaSet<Vec<u8>> {\n             use std::mem::transmute;\n             static mut DATA: *const ArenaSet<Vec<u8>> = 0 as *const ArenaSet<Vec<u8>>;\n \n-            static mut ONCE: Once = ONCE_INIT;\n+            static mut ONCE: Once = Once::new();\n             ONCE.call_once(|| {\n                 DATA = transmute\n                     ::<Box<ArenaSet<Vec<u8>>>, *const ArenaSet<Vec<u8>>>"}]}