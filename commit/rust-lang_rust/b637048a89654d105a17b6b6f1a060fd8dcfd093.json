{"sha": "b637048a89654d105a17b6b6f1a060fd8dcfd093", "node_id": "C_kwDOAAsO6NoAKGI2MzcwNDhhODk2NTRkMTA1YTE3YjZiNmYxYTA2MGZkOGRjZmQwOTM", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-05-31T01:02:40Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-06-06T18:43:20Z"}, "message": "Add -Ztrait-solver=next-coherence", "tree": {"sha": "88b89acd0b4c593de3b1541c7386f1527dd9284d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88b89acd0b4c593de3b1541c7386f1527dd9284d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b637048a89654d105a17b6b6f1a060fd8dcfd093", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b637048a89654d105a17b6b6f1a060fd8dcfd093", "html_url": "https://github.com/rust-lang/rust/commit/b637048a89654d105a17b6b6f1a060fd8dcfd093", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b637048a89654d105a17b6b6f1a060fd8dcfd093/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e0acff796a9221bc4d6769e3db5bf158647ef0e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0acff796a9221bc4d6769e3db5bf158647ef0e1", "html_url": "https://github.com/rust-lang/rust/commit/e0acff796a9221bc4d6769e3db5bf158647ef0e1"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "4ee543bbfb6dce09b943f5a739cb768f6ed7c9d2", "filename": "compiler/rustc_middle/src/ty/context.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs?ref=b637048a89654d105a17b6b6f1a060fd8dcfd093", "patch": "@@ -2337,6 +2337,14 @@ impl<'tcx> TyCtxt<'tcx> {\n         self.sess.opts.unstable_opts.trait_solver == rustc_session::config::TraitSolver::Next\n     }\n \n+    pub fn next_trait_solver_in_coherence(self) -> bool {\n+        matches!(\n+            self.sess.opts.unstable_opts.trait_solver,\n+            rustc_session::config::TraitSolver::Next\n+                | rustc_session::config::TraitSolver::NextCoherence\n+        )\n+    }\n+\n     pub fn lower_impl_trait_in_trait_to_assoc_ty(self) -> bool {\n         self.sess.opts.unstable_opts.lower_impl_trait_in_trait_to_assoc_ty\n     }"}, {"sha": "24291301a3293a68903279c162e69dedd98dc6a3", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=b637048a89654d105a17b6b6f1a060fd8dcfd093", "patch": "@@ -610,6 +610,8 @@ pub enum TraitSolver {\n     Chalk,\n     /// Experimental trait solver in `rustc_trait_selection::solve`\n     Next,\n+    /// Use the new trait solver during coherence\n+    NextCoherence,\n }\n \n pub enum Input {"}, {"sha": "201066e3950172e5c2bccf6c9e568e8479ac3562", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=b637048a89654d105a17b6b6f1a060fd8dcfd093", "patch": "@@ -986,6 +986,7 @@ mod parse {\n             Some(\"classic\") => *slot = TraitSolver::Classic,\n             Some(\"chalk\") => *slot = TraitSolver::Chalk,\n             Some(\"next\") => *slot = TraitSolver::Next,\n+            Some(\"next-coherence\") => *slot = TraitSolver::NextCoherence,\n             // default trait solver is subject to change..\n             Some(\"default\") => *slot = TraitSolver::Classic,\n             _ => return false,"}, {"sha": "2c793ea33dc8877cda61c5b5c2f0a6b298f153bd", "filename": "compiler/rustc_trait_selection/src/traits/coherence.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fcoherence.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fcoherence.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fcoherence.rs?ref=b637048a89654d105a17b6b6f1a060fd8dcfd093", "patch": "@@ -182,6 +182,7 @@ fn overlap<'tcx>(\n         .with_opaque_type_inference(DefiningAnchor::Bubble)\n         .skip_leak_check(skip_leak_check.is_yes())\n         .intercrate(true)\n+        .with_next_trait_solver(tcx.next_trait_solver_in_coherence())\n         .build();\n     let selcx = &mut SelectionContext::new(&infcx);\n     if track_ambiguity_causes.is_yes() {"}, {"sha": "1ddff3b66d54d474524a20294c27d7383fdc2883", "filename": "compiler/rustc_trait_selection/src/traits/engine.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fengine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b637048a89654d105a17b6b6f1a060fd8dcfd093/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fengine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fengine.rs?ref=b637048a89654d105a17b6b6f1a060fd8dcfd093", "patch": "@@ -35,6 +35,7 @@ impl<'tcx> TraitEngineExt<'tcx> for dyn TraitEngine<'tcx> {\n     fn new(tcx: TyCtxt<'tcx>) -> Box<Self> {\n         match tcx.sess.opts.unstable_opts.trait_solver {\n             TraitSolver::Classic => Box::new(FulfillmentContext::new()),\n+            TraitSolver::NextCoherence => Box::new(FulfillmentContext::new()),\n             TraitSolver::Chalk => Box::new(ChalkFulfillmentContext::new()),\n             TraitSolver::Next => Box::new(NextFulfillmentCtxt::new()),\n         }\n@@ -43,6 +44,7 @@ impl<'tcx> TraitEngineExt<'tcx> for dyn TraitEngine<'tcx> {\n     fn new_in_snapshot(tcx: TyCtxt<'tcx>) -> Box<Self> {\n         match tcx.sess.opts.unstable_opts.trait_solver {\n             TraitSolver::Classic => Box::new(FulfillmentContext::new_in_snapshot()),\n+            TraitSolver::NextCoherence => Box::new(FulfillmentContext::new_in_snapshot()),\n             TraitSolver::Chalk => Box::new(ChalkFulfillmentContext::new_in_snapshot()),\n             TraitSolver::Next => Box::new(NextFulfillmentCtxt::new()),\n         }"}]}