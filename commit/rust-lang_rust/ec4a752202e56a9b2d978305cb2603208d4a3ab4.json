{"sha": "ec4a752202e56a9b2d978305cb2603208d4a3ab4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVjNGE3NTIyMDJlNTZhOWIyZDk3ODMwNWNiMjYwMzIwOGQ0YTNhYjQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-08-28T13:12:16Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-08-28T13:12:16Z"}, "message": "Auto merge of #53493 - matthewjasper:hair-spans, r=nikomatsakis\n\nUse smaller span for adjustments on block expressions\n\nWhen returning a mutable reference don't use the entire body of the function as the span for the adjustments at the end.\n\nThe error [in this case](https://github.com/rust-lang/rust/compare/master...matthewjasper:hair-spans?expand=1#diff-ecef8b1f15622fb48a803c9b61605c78) is worse, but neither error message is really what we want. I have some ideas on how to get a better error message that will have to wait for a future PR.", "tree": {"sha": "eac6806c2bda8972bc3628c5b9f0aa99fcd00542", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eac6806c2bda8972bc3628c5b9f0aa99fcd00542"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ec4a752202e56a9b2d978305cb2603208d4a3ab4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ec4a752202e56a9b2d978305cb2603208d4a3ab4", "html_url": "https://github.com/rust-lang/rust/commit/ec4a752202e56a9b2d978305cb2603208d4a3ab4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ec4a752202e56a9b2d978305cb2603208d4a3ab4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83ddc33347cade429fdb47509818e775a67c1af6", "url": "https://api.github.com/repos/rust-lang/rust/commits/83ddc33347cade429fdb47509818e775a67c1af6", "html_url": "https://github.com/rust-lang/rust/commit/83ddc33347cade429fdb47509818e775a67c1af6"}, {"sha": "7f7fadaee6358191fce04debb63bf0bfe0cb2a9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f7fadaee6358191fce04debb63bf0bfe0cb2a9e", "html_url": "https://github.com/rust-lang/rust/commit/7f7fadaee6358191fce04debb63bf0bfe0cb2a9e"}], "stats": {"total": 327, "additions": 143, "deletions": 184}, "files": [{"sha": "8be1f52a9cdfc7d39151dc272fea046ddd3865a6", "filename": "src/librustc_mir/hair/cx/expr.rs", "status": "modified", "additions": 27, "deletions": 1, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -78,7 +78,7 @@ fn apply_adjustment<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n                                     mut expr: Expr<'tcx>,\n                                     adjustment: &Adjustment<'tcx>)\n                                     -> Expr<'tcx> {\n-    let Expr { temp_lifetime, span, .. } = expr;\n+    let Expr { temp_lifetime, mut span, .. } = expr;\n     let kind = match adjustment.kind {\n         Adjust::ReifyFnPointer => {\n             ExprKind::ReifyFnPointer { source: expr.to_ref() }\n@@ -96,6 +96,25 @@ fn apply_adjustment<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n             ExprKind::Cast { source: expr.to_ref() }\n         }\n         Adjust::Deref(None) => {\n+            // Adjust the span from the block, to the last expression of the\n+            // block. This is a better span when returning a mutable reference\n+            // with too short a lifetime. The error message will use the span\n+            // from the assignment to the return place, which should only point\n+            // at the returned value, not the entire function body.\n+            //\n+            // fn return_short_lived<'a>(x: &'a mut i32) -> &'static mut i32 {\n+            //      x\n+            //   // ^ error message points at this expression.\n+            // }\n+            //\n+            // We don't need to do this adjustment in the next match arm since\n+            // deref coercions always start with a built-in deref.\n+            if let ExprKind::Block { body } = expr.kind {\n+                if let Some(ref last_expr) = body.expr {\n+                    span = last_expr.span;\n+                    expr.span = span;\n+                }\n+            }\n             ExprKind::Deref { arg: expr.to_ref() }\n         }\n         Adjust::Deref(Some(deref)) => {\n@@ -180,6 +199,13 @@ fn apply_adjustment<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n             ExprKind::Use { source: cast_expr.to_ref() }\n         }\n         Adjust::Unsize => {\n+            // See the above comment for Adjust::Deref\n+            if let ExprKind::Block { body } = expr.kind {\n+                if let Some(ref last_expr) = body.expr {\n+                    span = last_expr.span;\n+                    expr.span = span;\n+                }\n+            }\n             ExprKind::Unsize { source: expr.to_ref() }\n         }\n     };"}, {"sha": "16cf4fd1b32e4edae0cbb86b6ee2e03a768a6257", "filename": "src/test/ui/issues/issue-17718-const-bad-values.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.rs?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -15,6 +15,5 @@ static mut S: usize = 3;\n const C2: &'static mut usize = unsafe { &mut S };\n //~^ ERROR: constants cannot refer to statics\n //~| ERROR: references in constants may only refer to immutable values\n-//~| ERROR: references in constants may only refer to immutable values\n \n fn main() {}"}, {"sha": "85424e5b73e545e8cb6748a40852d4d965e3592a", "filename": "src/test/ui/issues/issue-17718-const-bad-values.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -16,13 +16,7 @@ error[E0017]: references in constants may only refer to immutable values\n LL | const C2: &'static mut usize = unsafe { &mut S };\n    |                                         ^^^^^^ constants require immutable values\n \n-error[E0017]: references in constants may only refer to immutable values\n-  --> $DIR/issue-17718-const-bad-values.rs:15:32\n-   |\n-LL | const C2: &'static mut usize = unsafe { &mut S };\n-   |                                ^^^^^^^^^^^^^^^^^ constants require immutable values\n-\n-error: aborting due to 4 previous errors\n+error: aborting due to 3 previous errors\n \n Some errors occurred: E0013, E0017.\n For more information about an error, try `rustc --explain E0013`."}, {"sha": "3f098fa37ce5c9b48b48730a75772ae35e05bd23", "filename": "src/test/ui/issues/issue-46471-1.stderr", "status": "modified", "additions": 7, "deletions": 10, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fissues%2Fissue-46471-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fissues%2Fissue-46471-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-46471-1.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -12,16 +12,13 @@ LL | }\n error[E0597]: `z` does not live long enough (Mir)\n   --> $DIR/issue-46471-1.rs:16:9\n    |\n-LL |       let y = {\n-   |  _____________-\n-LL | |         let mut z = 0;\n-LL | |         &mut z\n-   | |         ^^^^^^ borrowed value does not live long enough\n-LL | |     };\n-   | |     -\n-   | |     |\n-   | |_____`z` dropped here while still borrowed\n-   |       borrow later used here\n+LL |         &mut z\n+   |         ^^^^^^\n+   |         |\n+   |         borrowed value does not live long enough\n+   |         borrow later used here\n+LL |     };\n+   |     - `z` dropped here while still borrowed\n \n error: aborting due to 2 previous errors\n "}, {"sha": "40dd9e25a17392c4b19d000c39c656a1ee5c526d", "filename": "src/test/ui/match/match-ref-mut-invariance.nll.stderr", "status": "modified", "additions": 7, "deletions": 10, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fmatch%2Fmatch-ref-mut-invariance.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fmatch%2Fmatch-ref-mut-invariance.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fmatch-ref-mut-invariance.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -5,17 +5,14 @@ LL |         match self.0 { ref mut x => x } //~ ERROR mismatched types\n    |                                     ^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/match-ref-mut-invariance.rs:19:49\n+  --> $DIR/match-ref-mut-invariance.rs:20:9\n    |\n-LL |   impl<'b> S<'b> {\n-   |        -- lifetime `'b` defined here\n-LL |       fn bar<'a>(&'a mut self) -> &'a mut &'a i32 {\n-   |  ____________--___________________________________^\n-   | |            |\n-   | |            lifetime `'a` defined here\n-LL | |         match self.0 { ref mut x => x } //~ ERROR mismatched types\n-LL | |     }\n-   | |_____^ returning this value requires that `'a` must outlive `'b`\n+LL | impl<'b> S<'b> {\n+   |      -- lifetime `'b` defined here\n+LL |     fn bar<'a>(&'a mut self) -> &'a mut &'a i32 {\n+   |            -- lifetime `'a` defined here\n+LL |         match self.0 { ref mut x => x } //~ ERROR mismatched types\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ returning this value requires that `'a` must outlive `'b`\n \n error: aborting due to previous error\n "}, {"sha": "5314f37a3f88cad4fb428597b9ebe3986b626411", "filename": "src/test/ui/match/match-ref-mut-let-invariance.nll.stderr", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fmatch%2Fmatch-ref-mut-let-invariance.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fmatch%2Fmatch-ref-mut-let-invariance.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fmatch-ref-mut-let-invariance.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -5,18 +5,15 @@ LL |         x //~ ERROR mismatched types\n    |         ^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/match-ref-mut-let-invariance.rs:19:49\n+  --> $DIR/match-ref-mut-let-invariance.rs:21:9\n    |\n-LL |   impl<'b> S<'b> {\n-   |        -- lifetime `'b` defined here\n-LL |       fn bar<'a>(&'a mut self) -> &'a mut &'a i32 {\n-   |  ____________--___________________________________^\n-   | |            |\n-   | |            lifetime `'a` defined here\n-LL | |         let ref mut x = self.0;\n-LL | |         x //~ ERROR mismatched types\n-LL | |     }\n-   | |_____^ returning this value requires that `'a` must outlive `'b`\n+LL | impl<'b> S<'b> {\n+   |      -- lifetime `'b` defined here\n+LL |     fn bar<'a>(&'a mut self) -> &'a mut &'a i32 {\n+   |            -- lifetime `'a` defined here\n+LL |         let ref mut x = self.0;\n+LL |         x //~ ERROR mismatched types\n+   |         ^ returning this value requires that `'a` must outlive `'b`\n \n error: aborting due to previous error\n "}, {"sha": "7ef6572a5d79973316e20a878a5e3389995e23e2", "filename": "src/test/ui/nll/mir_check_cast_unsize.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fnll%2Fmir_check_cast_unsize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fnll%2Fmir_check_cast_unsize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fmir_check_cast_unsize.rs?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -15,9 +15,9 @@\n use std::fmt::Debug;\n \n fn bar<'a>(x: &'a u32) -> &'static dyn Debug {\n-    //~^ ERROR unsatisfied lifetime constraints\n     x\n-    //~^ WARNING not reporting region error due to nll\n+    //~^ ERROR unsatisfied lifetime constraints\n+    //~| WARNING not reporting region error due to nll\n }\n \n fn main() {}"}, {"sha": "a965e611f992a42d5bf00e48b9fe1978dd98a8ac", "filename": "src/test/ui/nll/mir_check_cast_unsize.stderr", "status": "modified", "additions": 6, "deletions": 11, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fnll%2Fmir_check_cast_unsize.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fnll%2Fmir_check_cast_unsize.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fmir_check_cast_unsize.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -1,21 +1,16 @@\n warning: not reporting region error due to nll\n-  --> $DIR/mir_check_cast_unsize.rs:19:5\n+  --> $DIR/mir_check_cast_unsize.rs:18:5\n    |\n LL |     x\n    |     ^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/mir_check_cast_unsize.rs:17:46\n+  --> $DIR/mir_check_cast_unsize.rs:18:5\n    |\n-LL |   fn bar<'a>(x: &'a u32) -> &'static dyn Debug {\n-   |  ________--____________________________________^\n-   | |        |\n-   | |        lifetime `'a` defined here\n-LL | |     //~^ ERROR unsatisfied lifetime constraints\n-LL | |     x\n-LL | |     //~^ WARNING not reporting region error due to nll\n-LL | | }\n-   | |_^ returning this value requires that `'a` must outlive `'static`\n+LL | fn bar<'a>(x: &'a u32) -> &'static dyn Debug {\n+   |        -- lifetime `'a` defined here\n+LL |     x\n+   |     ^ returning this value requires that `'a` must outlive `'static`\n \n error: aborting due to previous error\n "}, {"sha": "2dc0a10f425ae0c370ed18c8436c140cec60a544", "filename": "src/test/ui/object-lifetime/object-lifetime-default-elision.nll.stderr", "status": "modified", "additions": 8, "deletions": 13, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fobject-lifetime%2Fobject-lifetime-default-elision.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fobject-lifetime%2Fobject-lifetime-default-elision.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fobject-lifetime%2Fobject-lifetime-default-elision.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -5,20 +5,15 @@ LL |     ss\n    |     ^^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/object-lifetime-default-elision.rs:64:53\n+  --> $DIR/object-lifetime-default-elision.rs:81:5\n    |\n-LL |   fn load3<'a,'b>(ss: &'a SomeTrait) -> &'b SomeTrait {\n-   |  __________--_--______________________________________^\n-   | |          |  |\n-   | |          |  lifetime `'b` defined here\n-   | |          lifetime `'a` defined here\n-LL | |     // Under old rules, the fully elaborated types of input/output were:\n-LL | |     //\n-LL | |     // for<'a,'b,'c>fn(&'a (SomeTrait+'c)) -> &'b (SomeTrait+'a)\n-...  |\n-LL | |         //~| ERROR cannot infer\n-LL | | }\n-   | |_^ returning this value requires that `'a` must outlive `'b`\n+LL | fn load3<'a,'b>(ss: &'a SomeTrait) -> &'b SomeTrait {\n+   |          -- -- lifetime `'b` defined here\n+   |          |\n+   |          lifetime `'a` defined here\n+...\n+LL |     ss\n+   |     ^^ returning this value requires that `'a` must outlive `'b`\n \n error: aborting due to previous error\n "}, {"sha": "19279b53c1c8b5650f18b19dd0dda3dc38c5498e", "filename": "src/test/ui/object-lifetime/object-lifetime-default-from-box-error.nll.stderr", "status": "modified", "additions": 6, "deletions": 11, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fobject-lifetime%2Fobject-lifetime-default-from-box-error.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fobject-lifetime%2Fobject-lifetime-default-from-box-error.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fobject-lifetime%2Fobject-lifetime-default-from-box-error.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -11,18 +11,13 @@ LL |     ss.r = b; //~ ERROR 41:12: 41:13: explicit lifetime required in the typ\n    |            ^\n \n error[E0621]: explicit lifetime required in the type of `ss`\n-  --> $DIR/object-lifetime-default-from-box-error.rs:24:48\n+  --> $DIR/object-lifetime-default-from-box-error.rs:28:5\n    |\n-LL |   fn load(ss: &mut SomeStruct) -> Box<SomeTrait> {\n-   |  _____________---------------____________________^\n-   | |             |\n-   | |             help: add explicit lifetime `'static` to the type of `ss`: `&mut SomeStruct<'static>`\n-LL | |     // `Box<SomeTrait>` defaults to a `'static` bound, so this return\n-LL | |     // is illegal.\n-LL | |\n-LL | |     ss.r //~ ERROR explicit lifetime required in the type of `ss` [E0621]\n-LL | | }\n-   | |_^ lifetime `'static` required\n+LL | fn load(ss: &mut SomeStruct) -> Box<SomeTrait> {\n+   |             --------------- help: add explicit lifetime `'static` to the type of `ss`: `&mut SomeStruct<'static>`\n+...\n+LL |     ss.r //~ ERROR explicit lifetime required in the type of `ss` [E0621]\n+   |     ^^^^ lifetime `'static` required\n \n error[E0507]: cannot move out of borrowed content\n   --> $DIR/object-lifetime-default-from-box-error.rs:28:5"}, {"sha": "f0def1888b9cdcfc8bcf870966d530aa44bfd382", "filename": "src/test/ui/regions/region-object-lifetime-in-coercion.nll.stderr", "status": "modified", "additions": 18, "deletions": 30, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregion-object-lifetime-in-coercion.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregion-object-lifetime-in-coercion.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregion-object-lifetime-in-coercion.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -31,43 +31,31 @@ LL |     let x: Box<Foo + 'static> = Box::new(v);\n    |                                 ^^^^^^^^^^^ lifetime `'static` required\n \n error[E0621]: explicit lifetime required in the type of `v`\n-  --> $DIR/region-object-lifetime-in-coercion.rs:23:38\n+  --> $DIR/region-object-lifetime-in-coercion.rs:24:5\n    |\n-LL |   fn b(v: &[u8]) -> Box<Foo + 'static> {\n-   |  _________-----________________________^\n-   | |         |\n-   | |         help: add explicit lifetime `'static` to the type of `v`: `&'static [u8]`\n-LL | |     Box::new(v)\n-LL | |         //~^ ERROR explicit lifetime required in the type of `v` [E0621]\n-LL | | }\n-   | |_^ lifetime `'static` required\n+LL | fn b(v: &[u8]) -> Box<Foo + 'static> {\n+   |         ----- help: add explicit lifetime `'static` to the type of `v`: `&'static [u8]`\n+LL |     Box::new(v)\n+   |     ^^^^^^^^^^^ lifetime `'static` required\n \n error[E0621]: explicit lifetime required in the type of `v`\n-  --> $DIR/region-object-lifetime-in-coercion.rs:28:28\n+  --> $DIR/region-object-lifetime-in-coercion.rs:31:5\n    |\n-LL |   fn c(v: &[u8]) -> Box<Foo> {\n-   |  _________-----______________^\n-   | |         |\n-   | |         help: add explicit lifetime `'static` to the type of `v`: `&'static [u8]`\n-LL | |     // same as previous case due to RFC 599\n-LL | |\n-LL | |     Box::new(v)\n-LL | |         //~^ ERROR explicit lifetime required in the type of `v` [E0621]\n-LL | | }\n-   | |_^ lifetime `'static` required\n+LL | fn c(v: &[u8]) -> Box<Foo> {\n+   |         ----- help: add explicit lifetime `'static` to the type of `v`: `&'static [u8]`\n+...\n+LL |     Box::new(v)\n+   |     ^^^^^^^^^^^ lifetime `'static` required\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/region-object-lifetime-in-coercion.rs:35:41\n+  --> $DIR/region-object-lifetime-in-coercion.rs:36:5\n    |\n-LL |   fn d<'a,'b>(v: &'a [u8]) -> Box<Foo+'b> {\n-   |  ______--_--______________________________^\n-   | |      |  |\n-   | |      |  lifetime `'b` defined here\n-   | |      lifetime `'a` defined here\n-LL | |     Box::new(v)\n-LL | |         //~^ ERROR cannot infer an appropriate lifetime due to conflicting\n-LL | | }\n-   | |_^ returning this value requires that `'a` must outlive `'b`\n+LL | fn d<'a,'b>(v: &'a [u8]) -> Box<Foo+'b> {\n+   |      -- -- lifetime `'b` defined here\n+   |      |\n+   |      lifetime `'a` defined here\n+LL |     Box::new(v)\n+   |     ^^^^^^^^^^^ returning this value requires that `'a` must outlive `'b`\n \n error: aborting due to 4 previous errors\n "}, {"sha": "85724cfabd814f8ddf0afcb5764b65c0b9118825", "filename": "src/test/ui/regions/regions-close-object-into-object-2.nll.stderr", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-close-object-into-object-2.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-close-object-into-object-2.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-close-object-into-object-2.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -5,15 +5,12 @@ LL |     box B(&*v) as Box<X> //~ ERROR cannot infer\n    |           ^^^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/regions-close-object-into-object-2.rs:19:57\n+  --> $DIR/regions-close-object-into-object-2.rs:20:5\n    |\n-LL |   fn g<'a, T: 'static>(v: Box<A<T>+'a>) -> Box<X+'static> {\n-   |  ______--_________________________________________________^\n-   | |      |\n-   | |      lifetime `'a` defined here\n-LL | |     box B(&*v) as Box<X> //~ ERROR cannot infer\n-LL | | }\n-   | |_^ returning this value requires that `'a` must outlive `'static`\n+LL | fn g<'a, T: 'static>(v: Box<A<T>+'a>) -> Box<X+'static> {\n+   |      -- lifetime `'a` defined here\n+LL |     box B(&*v) as Box<X> //~ ERROR cannot infer\n+   |     ^^^^^^^^^^^^^^^^^^^^ returning this value requires that `'a` must outlive `'static`\n \n error[E0597]: `*v` does not live long enough\n   --> $DIR/regions-close-object-into-object-2.rs:20:11"}, {"sha": "3dc8df3608f06a108d163e056aea13c026cc3862", "filename": "src/test/ui/regions/regions-close-object-into-object-4.nll.stderr", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-close-object-into-object-4.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-close-object-into-object-4.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-close-object-into-object-4.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -28,17 +28,6 @@ warning: not reporting region error due to nll\n LL |     box B(&*v) as Box<X> //~ ERROR cannot infer\n    |     ^^^^^^^^^^\n \n-error: unsatisfied lifetime constraints\n-  --> $DIR/regions-close-object-into-object-4.rs:19:51\n-   |\n-LL |   fn i<'a, T, U>(v: Box<A<U>+'a>) -> Box<X+'static> {\n-   |  ______--___________________________________________^\n-   | |      |\n-   | |      lifetime `'a` defined here\n-LL | |     box B(&*v) as Box<X> //~ ERROR cannot infer\n-LL | | }\n-   | |_^ returning this value requires that `'a` must outlive `'static`\n-\n error[E0310]: the parameter type `U` may not live long enough\n   --> $DIR/regions-close-object-into-object-4.rs:20:5\n    |\n@@ -47,6 +36,14 @@ LL |     box B(&*v) as Box<X> //~ ERROR cannot infer\n    |\n    = help: consider adding an explicit lifetime bound `U: 'static`...\n \n+error: unsatisfied lifetime constraints\n+  --> $DIR/regions-close-object-into-object-4.rs:20:5\n+   |\n+LL | fn i<'a, T, U>(v: Box<A<U>+'a>) -> Box<X+'static> {\n+   |      -- lifetime `'a` defined here\n+LL |     box B(&*v) as Box<X> //~ ERROR cannot infer\n+   |     ^^^^^^^^^^^^^^^^^^^^ returning this value requires that `'a` must outlive `'static`\n+\n error[E0310]: the parameter type `U` may not live long enough\n   --> $DIR/regions-close-object-into-object-4.rs:20:9\n    |"}, {"sha": "f19feed175272661108e4a5a0b7bb1a2a2967062", "filename": "src/test/ui/regions/regions-proc-bound-capture.nll.stderr", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-proc-bound-capture.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-proc-bound-capture.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-proc-bound-capture.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -5,16 +5,13 @@ LL |     Box::new(move|| { *x }) //~ ERROR explicit lifetime required in the typ\n    |              ^^^^^^^^^^^^^\n \n error[E0621]: explicit lifetime required in the type of `x`\n-  --> $DIR/regions-proc-bound-capture.rs:17:62\n+  --> $DIR/regions-proc-bound-capture.rs:19:5\n    |\n-LL |   fn static_proc(x: &isize) -> Box<FnMut()->(isize) + 'static> {\n-   |  ___________________------_____________________________________^\n-   | |                   |\n-   | |                   help: add explicit lifetime `'static` to the type of `x`: `&'static isize`\n-LL | |     // This is illegal, because the region bound on `proc` is 'static.\n-LL | |     Box::new(move|| { *x }) //~ ERROR explicit lifetime required in the type of `x` [E0621]\n-LL | | }\n-   | |_^ lifetime `'static` required\n+LL | fn static_proc(x: &isize) -> Box<FnMut()->(isize) + 'static> {\n+   |                   ------ help: add explicit lifetime `'static` to the type of `x`: `&'static isize`\n+LL |     // This is illegal, because the region bound on `proc` is 'static.\n+LL |     Box::new(move|| { *x }) //~ ERROR explicit lifetime required in the type of `x` [E0621]\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^ lifetime `'static` required\n \n error: aborting due to previous error\n "}, {"sha": "89575ca9bc809097171f44e5f56fb55826b0497b", "filename": "src/test/ui/regions/regions-reborrow-from-shorter-mut-ref-mut-ref.nll.stderr", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-reborrow-from-shorter-mut-ref-mut-ref.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-reborrow-from-shorter-mut-ref-mut-ref.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-reborrow-from-shorter-mut-ref-mut-ref.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -5,16 +5,14 @@ LL |     &mut ***p //~ ERROR 14:5: 14:14: lifetime mismatch [E0623]\n    |     ^^^^^^^^^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/regions-reborrow-from-shorter-mut-ref-mut-ref.rs:13:85\n+  --> $DIR/regions-reborrow-from-shorter-mut-ref-mut-ref.rs:14:5\n    |\n-LL |   fn copy_borrowed_ptr<'a, 'b, 'c>(p: &'a mut &'b mut &'c mut isize) -> &'b mut isize {\n-   |  ______________________--__--_________________________________________________________^\n-   | |                      |   |\n-   | |                      |   lifetime `'b` defined here\n-   | |                      lifetime `'a` defined here\n-LL | |     &mut ***p //~ ERROR 14:5: 14:14: lifetime mismatch [E0623]\n-LL | | }\n-   | |_^ function was supposed to return data with lifetime `'b` but it is returning data with lifetime `'a`\n+LL | fn copy_borrowed_ptr<'a, 'b, 'c>(p: &'a mut &'b mut &'c mut isize) -> &'b mut isize {\n+   |                      --  -- lifetime `'b` defined here\n+   |                      |\n+   |                      lifetime `'a` defined here\n+LL |     &mut ***p //~ ERROR 14:5: 14:14: lifetime mismatch [E0623]\n+   |     ^^^^^^^^^ function was supposed to return data with lifetime `'b` but it is returning data with lifetime `'a`\n \n error: aborting due to previous error\n "}, {"sha": "9c57813f26be6a67069a93c669bb70bada1c8283", "filename": "src/test/ui/regions/regions-reborrow-from-shorter-mut-ref.nll.stderr", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-reborrow-from-shorter-mut-ref.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-reborrow-from-shorter-mut-ref.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-reborrow-from-shorter-mut-ref.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -5,16 +5,14 @@ LL |     &mut **p //~ ERROR 16:5: 16:13: lifetime mismatch [E0623]\n    |     ^^^^^^^^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/regions-reborrow-from-shorter-mut-ref.rs:15:73\n+  --> $DIR/regions-reborrow-from-shorter-mut-ref.rs:16:5\n    |\n-LL |   fn copy_borrowed_ptr<'a, 'b>(p: &'a mut &'b mut isize) -> &'b mut isize {\n-   |  ______________________--__--_____________________________________________^\n-   | |                      |   |\n-   | |                      |   lifetime `'b` defined here\n-   | |                      lifetime `'a` defined here\n-LL | |     &mut **p //~ ERROR 16:5: 16:13: lifetime mismatch [E0623]\n-LL | | }\n-   | |_^ function was supposed to return data with lifetime `'b` but it is returning data with lifetime `'a`\n+LL | fn copy_borrowed_ptr<'a, 'b>(p: &'a mut &'b mut isize) -> &'b mut isize {\n+   |                      --  -- lifetime `'b` defined here\n+   |                      |\n+   |                      lifetime `'a` defined here\n+LL |     &mut **p //~ ERROR 16:5: 16:13: lifetime mismatch [E0623]\n+   |     ^^^^^^^^ function was supposed to return data with lifetime `'b` but it is returning data with lifetime `'a`\n \n error: aborting due to previous error\n "}, {"sha": "01db25a07f76e6bf7634411ef83ac37490005f27", "filename": "src/test/ui/regions/regions-trait-object-subtyping.nll.stderr", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-trait-object-subtyping.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fregions%2Fregions-trait-object-subtyping.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-trait-object-subtyping.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -11,18 +11,15 @@ LL |     x //~ ERROR mismatched types\n    |     ^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/regions-trait-object-subtyping.rs:23:51\n+  --> $DIR/regions-trait-object-subtyping.rs:25:5\n    |\n-LL |   fn foo3<'a,'b>(x: &'a mut Dummy) -> &'b mut Dummy {\n-   |  _________--_--_____________________________________^\n-   | |         |  |\n-   | |         |  lifetime `'b` defined here\n-   | |         lifetime `'a` defined here\n-LL | |     // Without knowing 'a:'b, we can't coerce\n-LL | |     x //~ ERROR lifetime bound not satisfied\n-LL | |      //~^ ERROR cannot infer an appropriate lifetime\n-LL | | }\n-   | |_^ returning this value requires that `'a` must outlive `'b`\n+LL | fn foo3<'a,'b>(x: &'a mut Dummy) -> &'b mut Dummy {\n+   |         -- -- lifetime `'b` defined here\n+   |         |\n+   |         lifetime `'a` defined here\n+LL |     // Without knowing 'a:'b, we can't coerce\n+LL |     x //~ ERROR lifetime bound not satisfied\n+   |     ^ returning this value requires that `'a` must outlive `'b`\n \n error: unsatisfied lifetime constraints\n   --> $DIR/regions-trait-object-subtyping.rs:32:5"}, {"sha": "f8e5e3914eb3cc2fcb64216e89a2be526ce97eae", "filename": "src/test/ui/span/regions-close-over-type-parameter-2.nll.stderr", "status": "modified", "additions": 6, "deletions": 11, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-type-parameter-2.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-type-parameter-2.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-type-parameter-2.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -1,17 +1,12 @@\n error[E0597]: `tmp0` does not live long enough\n   --> $DIR/regions-close-over-type-parameter-2.rs:33:20\n    |\n-LL |       let _ = {\n-   |  _____________-\n-LL | |         let tmp0 = 3;\n-LL | |         let tmp1 = &tmp0;\n-   | |                    ^^^^^ borrowed value does not live long enough\n-LL | |         repeater3(tmp1)\n-LL | |     };\n-   | |     -\n-   | |     |\n-   | |_____`tmp0` dropped here while still borrowed\n-   |       borrow later used here\n+LL |         let tmp1 = &tmp0;\n+   |                    ^^^^^ borrowed value does not live long enough\n+LL |         repeater3(tmp1)\n+   |         --------------- borrow later used here\n+LL |     };\n+   |     - `tmp0` dropped here while still borrowed\n \n error: aborting due to previous error\n "}, {"sha": "58939b0f64f5a99603fabb5d02f1c1dd1544eb6e", "filename": "src/test/ui/underscore-lifetime/dyn-trait-underscore.nll.stderr", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Funderscore-lifetime%2Fdyn-trait-underscore.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src%2Ftest%2Fui%2Funderscore-lifetime%2Fdyn-trait-underscore.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funderscore-lifetime%2Fdyn-trait-underscore.nll.stderr?ref=ec4a752202e56a9b2d978305cb2603208d4a3ab4", "patch": "@@ -23,16 +23,13 @@ LL |     Box::new(items.iter()) //~ ERROR cannot infer an appropriate lifetime\n    |     ^^^^^^^^^^^^^^^^^^^^^^\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/dyn-trait-underscore.rs:16:52\n+  --> $DIR/dyn-trait-underscore.rs:18:5\n    |\n-LL |   fn a<T>(items: &[T]) -> Box<dyn Iterator<Item=&T>> {\n-   |  ________________-___________________________________^\n-   | |                |\n-   | |                let's call the lifetime of this reference `'1`\n-LL | |     //                      ^^^^^^^^^^^^^^^^^^^^^ bound *here* defaults to `'static`\n-LL | |     Box::new(items.iter()) //~ ERROR cannot infer an appropriate lifetime\n-LL | | }\n-   | |_^ returning this value requires that `'1` must outlive `'static`\n+LL | fn a<T>(items: &[T]) -> Box<dyn Iterator<Item=&T>> {\n+   |                - let's call the lifetime of this reference `'1`\n+LL |     //                      ^^^^^^^^^^^^^^^^^^^^^ bound *here* defaults to `'static`\n+LL |     Box::new(items.iter()) //~ ERROR cannot infer an appropriate lifetime\n+   |     ^^^^^^^^^^^^^^^^^^^^^^ returning this value requires that `'1` must outlive `'static`\n \n error: aborting due to previous error\n "}]}