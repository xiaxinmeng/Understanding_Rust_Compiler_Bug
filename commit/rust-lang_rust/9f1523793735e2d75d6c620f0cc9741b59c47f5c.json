{"sha": "9f1523793735e2d75d6c620f0cc9741b59c47f5c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmMTUyMzc5MzczNWUyZDc1ZDZjNjIwZjBjYzk3NDFiNTljNDdmNWM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-11-08T03:47:24Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-11-08T05:19:01Z"}, "message": "Attempt to fix tools.mk under cross-compile", "tree": {"sha": "2f5d2e789709f145fe58bf60abeed8ad523654a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f5d2e789709f145fe58bf60abeed8ad523654a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f1523793735e2d75d6c620f0cc9741b59c47f5c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f1523793735e2d75d6c620f0cc9741b59c47f5c", "html_url": "https://github.com/rust-lang/rust/commit/9f1523793735e2d75d6c620f0cc9741b59c47f5c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f1523793735e2d75d6c620f0cc9741b59c47f5c/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0fc952372a1010bc567b1c183105e4fd3f395af0", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fc952372a1010bc567b1c183105e4fd3f395af0", "html_url": "https://github.com/rust-lang/rust/commit/0fc952372a1010bc567b1c183105e4fd3f395af0"}], "stats": {"total": 125, "additions": 68, "deletions": 57}, "files": [{"sha": "b95faed380bedcb2e3b9e4ab1a40c021f38ebe5f", "filename": "mk/tools.mk", "status": "modified", "additions": 68, "deletions": 57, "changes": 125, "blob_url": "https://github.com/rust-lang/rust/blob/9f1523793735e2d75d6c620f0cc9741b59c47f5c/mk%2Ftools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9f1523793735e2d75d6c620f0cc9741b59c47f5c/mk%2Ftools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftools.mk?ref=9f1523793735e2d75d6c620f0cc9741b59c47f5c", "patch": "@@ -22,7 +22,7 @@ RUSTI_INPUTS := $(wildcard $(S)src/librusti/*.rs)\n \n # FIXME: These are only built for the host arch. Eventually we'll\n # have tools that need to built for other targets.\n-define TOOLS_STAGE_N\n+define TOOLS_STAGE_N_TARGET\n \n $$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBFUZZER):          \\\n \t\t$$(FUZZER_LIB) $$(FUZZER_INPUTS)\t\t\t\\\n@@ -39,6 +39,64 @@ $$(TBIN$(1)_T_$(4)_H_$(3))/fuzzer$$(X):\t\t\t\t\\\n \t@$$(call E, compile_and_link: $$@)\n \t$$(STAGE$(1)_T_$(4)_H_$(3)) --cfg fuzzer -o $$@ $$<\n \n+$$(TBIN$(1)_T_$(4)_H_$(3))/compiletest$$(X):\t\t\t\\\n+\t\t$$(COMPILETEST_CRATE) $$(COMPILETEST_INPUTS)\t\\\n+\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)      \\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$<\n+\n+$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBCARGO):\t\t\\\n+\t\t$$(CARGO_LIB) $$(CARGO_INPUTS)\t\t\t\t\\\n+\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTC)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$< && touch $$@\n+\n+$$(TBIN$(1)_T_$(4)_H_$(3))/cargo$$(X):\t\t\t\t\\\n+\t\t$$(DRIVER_CRATE) \t\t\t\t\t\t\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBCARGO)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(4)_H_$(3)) --cfg cargo -o $$@ $$<\n+\n+$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTDOC):\t\t\\\n+\t\t$$(RUSTDOC_LIB) $$(RUSTDOC_INPUTS)\t\t\t\\\n+\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTC)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$< && touch $$@\n+\n+$$(TBIN$(1)_T_$(4)_H_$(3))/rustdoc$$(X):\t\t\t\\\n+\t\t$$(DRIVER_CRATE) \t\t\t\t\t\t\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTDOC)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(4)_H_$(3)) --cfg rustdoc -o $$@ $$<\n+\n+$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTI):\t\t\\\n+\t\t$$(RUSTI_LIB) $$(RUSTI_INPUTS)\t\t\t\\\n+\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTC)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$< && touch $$@\n+\n+$$(TBIN$(1)_T_$(4)_H_$(3))/rusti$$(X):\t\t\t\\\n+\t\t$$(DRIVER_CRATE) \t\t\t\t\t\t\t\\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTI)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(4)_H_$(3)) --cfg rusti -o $$@ $$<\n+\n+endef\n+\n+define TOOLS_STAGE_N_HOST\n+\n+\n # Promote the stageN target to stageN+1 host\n # FIXME: Shouldn't need to depend on host/librustc.so once\n # rpath is working\n@@ -59,34 +117,12 @@ $$(HBIN$(2)_H_$(4))/fuzzer$$(X):\t\t\t\t\\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-$$(TBIN$(1)_T_$(4)_H_$(3))/compiletest$$(X):\t\t\t\\\n-\t\t$$(COMPILETEST_CRATE) $$(COMPILETEST_INPUTS)\t\\\n-\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)      \\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$<\n-\n $$(HBIN$(2)_H_$(4))/compiletest$$(X):\t\t\t\t\\\n \t\t$$(TBIN$(1)_T_$(4)_H_$(3))/compiletest$$(X)\t\\\n \t\t$$(HSREQ$(2)_H_$(4))\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBCARGO):\t\t\\\n-\t\t$$(CARGO_LIB) $$(CARGO_INPUTS)\t\t\t\t\\\n-\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTC)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$< && touch $$@\n-\n-$$(TBIN$(1)_T_$(4)_H_$(3))/cargo$$(X):\t\t\t\t\\\n-\t\t$$(DRIVER_CRATE) \t\t\t\t\t\t\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBCARGO)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(4)_H_$(3)) --cfg cargo -o $$@ $$<\n \n $$(HLIB$(2)_H_$(4))/$$(CFG_LIBCARGO):\t\t\t\t\\\n \t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBCARGO)\t\\\n@@ -105,21 +141,6 @@ $$(HBIN$(2)_H_$(4))/cargo$$(X):\t\t\t\t\t\\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTDOC):\t\t\\\n-\t\t$$(RUSTDOC_LIB) $$(RUSTDOC_INPUTS)\t\t\t\\\n-\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTC)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$< && touch $$@\n-\n-$$(TBIN$(1)_T_$(4)_H_$(3))/rustdoc$$(X):\t\t\t\\\n-\t\t$$(DRIVER_CRATE) \t\t\t\t\t\t\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTDOC)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(4)_H_$(3)) --cfg rustdoc -o $$@ $$<\n-\n $$(HLIB$(2)_H_$(4))/$$(CFG_LIBRUSTDOC):\t\t\t\t\t\\\n \t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTDOC)\t\\\n \t\t$$(HLIB$(2)_H_$(4))/$$(CFG_LIBRUSTC)\t\t\t\\\n@@ -137,21 +158,6 @@ $$(HBIN$(2)_H_$(4))/rustdoc$$(X):\t\t\t\t\\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTI):\t\t\\\n-\t\t$$(RUSTI_LIB) $$(RUSTI_INPUTS)\t\t\t\\\n-\t\t$$(TSREQ$(1)_T_$(4)_H_$(3))\t\t\t\t\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_CORELIB)\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_STDLIB)\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTC)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(4)_H_$(3)) -o $$@ $$< && touch $$@\n-\n-$$(TBIN$(1)_T_$(4)_H_$(3))/rusti$$(X):\t\t\t\\\n-\t\t$$(DRIVER_CRATE) \t\t\t\t\t\t\t\\\n-\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTI)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(4)_H_$(3)) --cfg rusti -o $$@ $$<\n-\n $$(HLIB$(2)_H_$(4))/$$(CFG_LIBRUSTI):\t\t\t\t\t\\\n \t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$$(CFG_LIBRUSTI)\t\\\n \t\t$$(HLIB$(2)_H_$(4))/$$(CFG_LIBRUSTC)\t\t\t\\\n@@ -169,10 +175,15 @@ $$(HBIN$(2)_H_$(4))/rusti$$(X):\t\t\t\t\\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-\n endef\n \n $(foreach host,$(CFG_TARGET_TRIPLES),\t\t\t\t\\\n- $(eval $(call TOOLS_STAGE_N,0,1,$(host),$(host)))\t\\\n- $(eval $(call TOOLS_STAGE_N,1,2,$(host),$(host)))\t\\\n- $(eval $(call TOOLS_STAGE_N,2,3,$(host),$(host))))\n+$(foreach target,$(CFG_TARGET_TRIPLES),\t\t\t\t\\\n+ $(eval $(call TOOLS_STAGE_N_TARGET,0,1,$(target),$(host)))\t\\\n+ $(eval $(call TOOLS_STAGE_N_TARGET,1,2,$(target),$(host)))\t\\\n+ $(eval $(call TOOLS_STAGE_N_TARGET,2,3,$(target),$(host)))))\n+\n+$(foreach host,$(CFG_TARGET_TRIPLES),\t\t\t\t\\\n+ $(eval $(call TOOLS_STAGE_N_HOST,0,1,$(host),$(host)))\t\\\n+ $(eval $(call TOOLS_STAGE_N_HOST,1,2,$(host),$(host)))\t\\\n+ $(eval $(call TOOLS_STAGE_N_HOST,2,3,$(host),$(host))))"}]}