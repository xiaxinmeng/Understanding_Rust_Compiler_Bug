{"sha": "f4ca42f573e3a8bd9bb5099efa0285855b77367f", "node_id": "C_kwDOAAsO6NoAKGY0Y2E0MmY1NzNlM2E4YmQ5YmI1MDk5ZWZhMDI4NTg1NWI3NzM2N2Y", "commit": {"author": {"name": "Urgau", "email": "urgau@numericable.fr", "date": "2023-05-06T16:26:53Z"}, "committer": {"name": "Urgau", "email": "urgau@numericable.fr", "date": "2023-05-06T16:40:47Z"}, "message": "Fix --check-cfg bug with args order when parsing", "tree": {"sha": "8a5288d1d17c6e1fe09e9d3953723ac93f37da0e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a5288d1d17c6e1fe09e9d3953723ac93f37da0e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4ca42f573e3a8bd9bb5099efa0285855b77367f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4ca42f573e3a8bd9bb5099efa0285855b77367f", "html_url": "https://github.com/rust-lang/rust/commit/f4ca42f573e3a8bd9bb5099efa0285855b77367f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4ca42f573e3a8bd9bb5099efa0285855b77367f/comments", "author": {"login": "Urgau", "id": 3616612, "node_id": "MDQ6VXNlcjM2MTY2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3616612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Urgau", "html_url": "https://github.com/Urgau", "followers_url": "https://api.github.com/users/Urgau/followers", "following_url": "https://api.github.com/users/Urgau/following{/other_user}", "gists_url": "https://api.github.com/users/Urgau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Urgau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Urgau/subscriptions", "organizations_url": "https://api.github.com/users/Urgau/orgs", "repos_url": "https://api.github.com/users/Urgau/repos", "events_url": "https://api.github.com/users/Urgau/events{/privacy}", "received_events_url": "https://api.github.com/users/Urgau/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Urgau", "id": 3616612, "node_id": "MDQ6VXNlcjM2MTY2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3616612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Urgau", "html_url": "https://github.com/Urgau", "followers_url": "https://api.github.com/users/Urgau/followers", "following_url": "https://api.github.com/users/Urgau/following{/other_user}", "gists_url": "https://api.github.com/users/Urgau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Urgau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Urgau/subscriptions", "organizations_url": "https://api.github.com/users/Urgau/orgs", "repos_url": "https://api.github.com/users/Urgau/repos", "events_url": "https://api.github.com/users/Urgau/events{/privacy}", "received_events_url": "https://api.github.com/users/Urgau/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b94c232192b0fa0314b5afa18e366356e210c4c", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b94c232192b0fa0314b5afa18e366356e210c4c", "html_url": "https://github.com/rust-lang/rust/commit/4b94c232192b0fa0314b5afa18e366356e210c4c"}], "stats": {"total": 65, "additions": 64, "deletions": 1}, "files": [{"sha": "51354c2b127990f8329aa21a20d1712b5c843fe6", "filename": "compiler/rustc_interface/src/interface.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f4ca42f573e3a8bd9bb5099efa0285855b77367f/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4ca42f573e3a8bd9bb5099efa0285855b77367f/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Finterface.rs?ref=f4ca42f573e3a8bd9bb5099efa0285855b77367f", "patch": "@@ -173,12 +173,21 @@ pub fn parse_check_cfg(specs: Vec<String>) -> CheckCfg {\n                                         let expected_values = check_cfg\n                                             .expecteds\n                                             .entry(ident.name.to_string())\n+                                            .and_modify(|expected_values| match expected_values {\n+                                                ExpectedValues::Some(_) => {}\n+                                                ExpectedValues::Any => {\n+                                                    // handle the case where names(...) was done\n+                                                    // before values by changing to a list\n+                                                    *expected_values =\n+                                                        ExpectedValues::Some(FxHashSet::default());\n+                                                }\n+                                            })\n                                             .or_insert_with(|| {\n                                                 ExpectedValues::Some(FxHashSet::default())\n                                             });\n \n                                         let ExpectedValues::Some(expected_values) = expected_values else {\n-                                            bug!(\"shoudn't be possible\")\n+                                            bug!(\"`expected_values` should be a list a values\")\n                                         };\n \n                                         for val in values {"}, {"sha": "91b81428b38a4d4785c2a14382067c9029cd94c2", "filename": "tests/ui/check-cfg/order-independant.names_after.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f4ca42f573e3a8bd9bb5099efa0285855b77367f/tests%2Fui%2Fcheck-cfg%2Forder-independant.names_after.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f4ca42f573e3a8bd9bb5099efa0285855b77367f/tests%2Fui%2Fcheck-cfg%2Forder-independant.names_after.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcheck-cfg%2Forder-independant.names_after.stderr?ref=f4ca42f573e3a8bd9bb5099efa0285855b77367f", "patch": "@@ -0,0 +1,19 @@\n+warning: unexpected `cfg` condition value\n+  --> $DIR/order-independant.rs:8:7\n+   |\n+LL | #[cfg(a)]\n+   |       ^- help: specify a config value: `= \"b\"`\n+   |\n+   = note: expected values for `a` are: `b`\n+   = note: `#[warn(unexpected_cfgs)]` on by default\n+\n+warning: unexpected `cfg` condition value\n+  --> $DIR/order-independant.rs:12:7\n+   |\n+LL | #[cfg(a = \"unk\")]\n+   |       ^^^^^^^^^\n+   |\n+   = note: expected values for `a` are: `b`\n+\n+warning: 2 warnings emitted\n+"}, {"sha": "91b81428b38a4d4785c2a14382067c9029cd94c2", "filename": "tests/ui/check-cfg/order-independant.names_before.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f4ca42f573e3a8bd9bb5099efa0285855b77367f/tests%2Fui%2Fcheck-cfg%2Forder-independant.names_before.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f4ca42f573e3a8bd9bb5099efa0285855b77367f/tests%2Fui%2Fcheck-cfg%2Forder-independant.names_before.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcheck-cfg%2Forder-independant.names_before.stderr?ref=f4ca42f573e3a8bd9bb5099efa0285855b77367f", "patch": "@@ -0,0 +1,19 @@\n+warning: unexpected `cfg` condition value\n+  --> $DIR/order-independant.rs:8:7\n+   |\n+LL | #[cfg(a)]\n+   |       ^- help: specify a config value: `= \"b\"`\n+   |\n+   = note: expected values for `a` are: `b`\n+   = note: `#[warn(unexpected_cfgs)]` on by default\n+\n+warning: unexpected `cfg` condition value\n+  --> $DIR/order-independant.rs:12:7\n+   |\n+LL | #[cfg(a = \"unk\")]\n+   |       ^^^^^^^^^\n+   |\n+   = note: expected values for `a` are: `b`\n+\n+warning: 2 warnings emitted\n+"}, {"sha": "ce056b8dcd6f858c7159488ed47d4bc46399f41d", "filename": "tests/ui/check-cfg/order-independant.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f4ca42f573e3a8bd9bb5099efa0285855b77367f/tests%2Fui%2Fcheck-cfg%2Forder-independant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4ca42f573e3a8bd9bb5099efa0285855b77367f/tests%2Fui%2Fcheck-cfg%2Forder-independant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcheck-cfg%2Forder-independant.rs?ref=f4ca42f573e3a8bd9bb5099efa0285855b77367f", "patch": "@@ -0,0 +1,16 @@\n+// check-pass\n+// revisions: names_before names_after\n+// compile-flags: -Z unstable-options\n+// compile-flags: --check-cfg=names(names_before,names_after)\n+// [names_before]compile-flags: --check-cfg=names(a) --check-cfg=values(a,\"b\")\n+// [names_after]compile-flags: --check-cfg=values(a,\"b\") --check-cfg=names(a)\n+\n+#[cfg(a)]\n+//~^ WARNING unexpected `cfg` condition value\n+fn my_cfg() {}\n+\n+#[cfg(a = \"unk\")]\n+//~^ WARNING unexpected `cfg` condition value\n+fn my_cfg() {}\n+\n+fn main() {}"}]}