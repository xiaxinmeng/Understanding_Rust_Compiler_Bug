{"sha": "01c6256178fb126d668045f3a1297e0f3491e985", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxYzYyNTYxNzhmYjEyNmQ2NjgwNDVmM2ExMjk3ZTBmMzQ5MWU5ODU=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-07-02T12:59:50Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-07-28T03:11:18Z"}, "message": "Change debuginfo to default to 1 if `debug = true` is set\n\nFrom [a conversation in discord](https://discordapp.com/channels/442252698964721669/443151243398086667/719200989269327882):\n\n> Linking seems to consume all available RAM, leading to the OS to swap memory to disk and slowing down everything in the process\nCompiling itself doesn't seem to take up as much RAM, and I'm only looking to check whether a minimal testcase can be compiled by rustc, where the runtime performance isn't much of an issue\n\n> do you have debug = true or debuginfo-level = 2 in config.toml?\n> if so I think that results in over 2GB of debuginfo nowadays and is likely the culprit\n> which might mean we're giving out bad advice :(\n\nAnecdotally, this sped up my stage 1 build from 15 to 10 minutes.\n\nThis still adds line numbers, it only removes variable and type information.\n\n- Improve wording for debuginfo description\n\nCo-authored-by: Teymour Aldridge <42674621+teymour-aldridge@users.noreply.github.com>", "tree": {"sha": "0f3068a5ac3aa8ae4f1fadf49276e340f1456114", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f3068a5ac3aa8ae4f1fadf49276e340f1456114"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/01c6256178fb126d668045f3a1297e0f3491e985", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/01c6256178fb126d668045f3a1297e0f3491e985", "html_url": "https://github.com/rust-lang/rust/commit/01c6256178fb126d668045f3a1297e0f3491e985", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/01c6256178fb126d668045f3a1297e0f3491e985/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7dcfcd45bd019acf8c914c204ccae519c420adc", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7dcfcd45bd019acf8c914c204ccae519c420adc", "html_url": "https://github.com/rust-lang/rust/commit/f7dcfcd45bd019acf8c914c204ccae519c420adc"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "5d198abe1c7d8f673d6654c5d682db4dee438035", "filename": "config.toml.example", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/01c6256178fb126d668045f3a1297e0f3491e985/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/01c6256178fb126d668045f3a1297e0f3491e985/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=01c6256178fb126d668045f3a1297e0f3491e985", "patch": "@@ -341,7 +341,10 @@\n # Debuginfo for tests run with compiletest is not controlled by this option\n # and needs to be enabled separately with `debuginfo-level-tests`.\n #\n-# Defaults to 2 if debug is true\n+# Note that debuginfo-level = 2 generates several gigabytes of debuginfo\n+# and will slow down the linking process significantly.\n+#\n+# Defaults to 1 if debug is true\n #debuginfo-level = 0\n \n # Debuginfo level for the compiler."}, {"sha": "d64ca95d24392ab1221c90d6974eb122bf42d955", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/01c6256178fb126d668045f3a1297e0f3491e985/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01c6256178fb126d668045f3a1297e0f3491e985/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=01c6256178fb126d668045f3a1297e0f3491e985", "patch": "@@ -734,7 +734,7 @@ impl Config {\n \n         let with_defaults = |debuginfo_level_specific: Option<u32>| {\n             debuginfo_level_specific.or(debuginfo_level).unwrap_or(if debug == Some(true) {\n-                2\n+                1\n             } else {\n                 0\n             })"}]}