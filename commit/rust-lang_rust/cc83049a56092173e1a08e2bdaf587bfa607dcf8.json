{"sha": "cc83049a56092173e1a08e2bdaf587bfa607dcf8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjODMwNDlhNTYwOTIxNzNlMWEwOGUyYmRhZjU4N2JmYTYwN2RjZjg=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-03-26T20:08:59Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-03-29T03:56:45Z"}, "message": "Fix warning about unused imports in import lists\n\nBefore, if anything in a list was used, the entire list was considered to be\nused. This corrects this and also warns on a span of the actual unused import\ninstead of the entire list.", "tree": {"sha": "b1df2f4624f5987877c29cad9784b9f58ef84e36", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1df2f4624f5987877c29cad9784b9f58ef84e36"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc83049a56092173e1a08e2bdaf587bfa607dcf8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc83049a56092173e1a08e2bdaf587bfa607dcf8", "html_url": "https://github.com/rust-lang/rust/commit/cc83049a56092173e1a08e2bdaf587bfa607dcf8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc83049a56092173e1a08e2bdaf587bfa607dcf8/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a6cd2b21e240d3b075b30d598e661b038fe6fbe", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a6cd2b21e240d3b075b30d598e661b038fe6fbe", "html_url": "https://github.com/rust-lang/rust/commit/7a6cd2b21e240d3b075b30d598e661b038fe6fbe"}], "stats": {"total": 26, "additions": 15, "deletions": 11}, "files": [{"sha": "7a16b69b80c976d34d812b9abd49dbc48c92eb5c", "filename": "src/librustc/middle/resolve.rs", "status": "modified", "additions": 6, "deletions": 10, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/cc83049a56092173e1a08e2bdaf587bfa607dcf8/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc83049a56092173e1a08e2bdaf587bfa607dcf8/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve.rs?ref=cc83049a56092173e1a08e2bdaf587bfa607dcf8", "patch": "@@ -1425,7 +1425,6 @@ pub impl Resolver {\n \n                     // Build up the import directives.\n                     let module_ = self.get_module_from_parent(parent);\n-                    let state = @mut ImportState();\n                     match view_path.node {\n                         view_path_simple(binding, full_path, _, _) => {\n                             let source_ident = *full_path.idents.last();\n@@ -1435,28 +1434,25 @@ pub impl Resolver {\n                                                         module_,\n                                                         module_path,\n                                                         subclass,\n-                                                        view_path.span,\n-                                                        state);\n+                                                        view_path.span);\n                         }\n                         view_path_list(_, ref source_idents, _) => {\n-                            for (*source_idents).each |source_ident| {\n+                            for source_idents.each |source_ident| {\n                                 let name = source_ident.node.name;\n                                 let subclass = @SingleImport(name, name);\n                                 self.build_import_directive(privacy,\n                                                             module_,\n                                                             copy module_path,\n                                                             subclass,\n-                                                            view_path.span,\n-                                                            state);\n+                                                            source_ident.span);\n                             }\n                         }\n                         view_path_glob(_, _) => {\n                             self.build_import_directive(privacy,\n                                                         module_,\n                                                         module_path,\n                                                         @GlobImport,\n-                                                        view_path.span,\n-                                                        state);\n+                                                        view_path.span);\n                         }\n                     }\n                 }\n@@ -1842,8 +1838,7 @@ pub impl Resolver {\n                               module_: @mut Module,\n                               +module_path: ~[ident],\n                               subclass: @ImportDirectiveSubclass,\n-                              span: span,\n-                              state: @mut ImportState) {\n+                              span: span) {\n         let directive = @ImportDirective(privacy, module_path,\n                                          subclass, span);\n         module_.imports.push(directive);\n@@ -1867,6 +1862,7 @@ pub impl Resolver {\n                     }\n                     None => {\n                         debug!(\"(building import directive) creating new\");\n+                        let state = @mut ImportState();\n                         let resolution = @mut ImportResolution(privacy,\n                                                                span,\n                                                                state);"}, {"sha": "6afb80fc192a088783944e44b374aa493b8bcdc8", "filename": "src/test/compile-fail/unused-imports-warn.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cc83049a56092173e1a08e2bdaf587bfa607dcf8/src%2Ftest%2Fcompile-fail%2Funused-imports-warn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc83049a56092173e1a08e2bdaf587bfa607dcf8/src%2Ftest%2Fcompile-fail%2Funused-imports-warn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Funused-imports-warn.rs?ref=cc83049a56092173e1a08e2bdaf587bfa607dcf8", "patch": "@@ -17,14 +17,19 @@ use core::either::Right;        //~ ERROR unused import\n use core::util::*;              // shouldn't get errors for not using\n                                 // everything imported\n \n-// Should only get one error instead of two errors here\n+// Should get errors for both 'Some' and 'None'\n use core::option::{Some, None}; //~ ERROR unused import\n+                                //^~ ERROR unused import\n \n use core::io::ReaderUtil;       //~ ERROR unused import\n // Be sure that if we just bring some methods into scope that they're also\n // counted as being used.\n use core::io::WriterUtil;\n \n+// Make sure this import is warned about when at least one of its imported names\n+// is unused\n+use core::vec::{filter, map};         //~ ERROR unused import\n+\n mod foo {\n     pub struct Point{x: int, y: int}\n     pub struct Square{p: Point, h: uint, w: uint}\n@@ -51,4 +56,7 @@ fn main() {\n     let a = 3;\n     ignore(a);\n     io::stdout().write_str(~\"a\");\n+    let _a = do map(~[2]) |&x| {\n+      x + 2\n+    };\n }"}]}