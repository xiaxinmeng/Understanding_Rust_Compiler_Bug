{"sha": "5bbf8cf331f9c6140117bb6c2ac385d2e451d26e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViYmY4Y2YzMzFmOWM2MTQwMTE3YmI2YzJhYzM4NWQyZTQ1MWQyNmU=", "commit": {"author": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2021-05-07T21:49:24Z"}, "committer": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2021-05-07T21:49:24Z"}, "message": "Revert SGX inline asm syntax\n\nThis was erroneously changed in #83387", "tree": {"sha": "f2cfc32804fc3ef4e6677a9b942c3cec4a1b14b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f2cfc32804fc3ef4e6677a9b942c3cec4a1b14b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e", "html_url": "https://github.com/rust-lang/rust/commit/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e/comments", "author": null, "committer": null, "parents": [{"sha": "ca712bc4255cd0912e00ec2eee5b6a547385c2b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca712bc4255cd0912e00ec2eee5b6a547385c2b0", "html_url": "https://github.com/rust-lang/rust/commit/ca712bc4255cd0912e00ec2eee5b6a547385c2b0"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "4ce482e23cbfb98e80f1d256b08994a7b69babe1", "filename": "library/std/src/os/fortanix_sgx/arch.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e/library%2Fstd%2Fsrc%2Fos%2Ffortanix_sgx%2Farch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e/library%2Fstd%2Fsrc%2Fos%2Ffortanix_sgx%2Farch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Ffortanix_sgx%2Farch.rs?ref=5bbf8cf331f9c6140117bb6c2ac385d2e451d26e", "patch": "@@ -33,13 +33,13 @@ pub fn egetkey(request: &Align512<[u8; 512]>) -> Result<Align16<[u8; 16]>, u32>\n \n         asm!(\n             // rbx is reserved by LLVM\n-            \"xchg {0}, rbx\",\n+            \"xchg %rbx, {0}\",\n             \"enclu\",\n-            \"mov rbx, {0}\",\n+            \"mov {0}, %rbx\",\n             inout(reg) request => _,\n             inlateout(\"eax\") ENCLU_EGETKEY => error,\n             in(\"rcx\") out.as_mut_ptr(),\n-            options(nostack),\n+            options(att_syntax, nostack),\n         );\n \n         match error {\n@@ -64,14 +64,14 @@ pub fn ereport(\n \n         asm!(\n             // rbx is reserved by LLVM\n-            \"xchg {0}, rbx\",\n+            \"xchg %rbx, {0}\",\n             \"enclu\",\n-            \"mov rbx, {0}\",\n+            \"mov {0}, %rbx\",\n             inout(reg) targetinfo => _,\n             in(\"eax\") ENCLU_EREPORT,\n             in(\"rcx\") reportdata,\n             in(\"rdx\") report.as_mut_ptr(),\n-            options(preserves_flags, nostack),\n+            options(att_syntax, preserves_flags, nostack),\n         );\n \n         report.assume_init()"}, {"sha": "52e8bec937c79b917e9533a9d9ff758539dfc377", "filename": "library/std/src/sys/sgx/abi/mem.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5bbf8cf331f9c6140117bb6c2ac385d2e451d26e/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fabi%2Fmem.rs?ref=5bbf8cf331f9c6140117bb6c2ac385d2e451d26e", "patch": "@@ -36,9 +36,9 @@ pub fn image_base() -> u64 {\n     let base: u64;\n     unsafe {\n         asm!(\n-            \"lea {}, qword ptr [rip + IMAGE_BASE]\",\n+            \"lea IMAGE_BASE(%rip), {}\",\n             lateout(reg) base,\n-            options(nostack, preserves_flags, nomem, pure),\n+            options(att_syntax, nostack, preserves_flags, nomem, pure),\n         )\n     };\n     base"}]}