{"sha": "83f147b3baf21acfc367a6da1045d212cd3957e4", "node_id": "C_kwDOAAsO6NoAKDgzZjE0N2IzYmFmMjFhY2ZjMzY3YTZkYTEwNDVkMjEyY2QzOTU3ZTQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-09-28T08:58:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-09-28T08:58:41Z"}, "message": "Auto merge of #89293 - TaKO8Ki:fix-confusing-error-for-path-separator-to-refer-to-an-struct-item, r=estebank\n\nSuggest using the path separator for tuple struct\n\nFix confusing error message `constructor is not visible here due to private fields` for tuple struct\n\ncloses #83450", "tree": {"sha": "cfde71072b82197f6f93ba50c16abef38054706c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cfde71072b82197f6f93ba50c16abef38054706c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/83f147b3baf21acfc367a6da1045d212cd3957e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/83f147b3baf21acfc367a6da1045d212cd3957e4", "html_url": "https://github.com/rust-lang/rust/commit/83f147b3baf21acfc367a6da1045d212cd3957e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/83f147b3baf21acfc367a6da1045d212cd3957e4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b10746ef08041885989eccd2dd6cd3c2f6f0f49", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b10746ef08041885989eccd2dd6cd3c2f6f0f49", "html_url": "https://github.com/rust-lang/rust/commit/7b10746ef08041885989eccd2dd6cd3c2f6f0f49"}, {"sha": "564cb87e270f70310e25ae9f459c642e949e8213", "url": "https://api.github.com/repos/rust-lang/rust/commits/564cb87e270f70310e25ae9f459c642e949e8213", "html_url": "https://github.com/rust-lang/rust/commit/564cb87e270f70310e25ae9f459c642e949e8213"}], "stats": {"total": 53, "additions": 52, "deletions": 1}, "files": [{"sha": "84219873d55b4e9eb5b3f4139bb03aa17079e915", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/83f147b3baf21acfc367a6da1045d212cd3957e4/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83f147b3baf21acfc367a6da1045d212cd3957e4/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=83f147b3baf21acfc367a6da1045d212cd3957e4", "patch": "@@ -1026,9 +1026,15 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n \n                 self.suggest_using_enum_variant(err, source, def_id, span);\n             }\n-            (Res::Def(DefKind::Struct, def_id), _) if ns == ValueNS => {\n+            (Res::Def(DefKind::Struct, def_id), source) if ns == ValueNS => {\n                 let (ctor_def, ctor_vis, fields) =\n                     if let Some(struct_ctor) = self.r.struct_constructors.get(&def_id).cloned() {\n+                        if let PathSource::Expr(Some(parent)) = source {\n+                            if let ExprKind::Field(..) | ExprKind::MethodCall(..) = parent.kind {\n+                                bad_struct_syntax_suggestion(def_id);\n+                                return true;\n+                            }\n+                        }\n                         struct_ctor\n                     } else {\n                         bad_struct_syntax_suggestion(def_id);"}, {"sha": "c8bc3e79fe2f0a69a199cc0417a227969ae9c8ba", "filename": "src/test/ui/resolve/suggest-path-for-tuple-struct.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/83f147b3baf21acfc367a6da1045d212cd3957e4/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83f147b3baf21acfc367a6da1045d212cd3957e4/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.rs?ref=83f147b3baf21acfc367a6da1045d212cd3957e4", "patch": "@@ -0,0 +1,26 @@\n+mod module {\n+    pub struct SomeTupleStruct(u8);\n+    pub struct SomeRegularStruct {\n+        foo: u8\n+    }\n+\n+    impl SomeTupleStruct {\n+        pub fn new() -> Self {\n+            Self(0)\n+        }\n+    }\n+    impl SomeRegularStruct {\n+        pub fn new() -> Self {\n+            Self { foo: 0 }\n+        }\n+    }\n+}\n+\n+use module::{SomeTupleStruct, SomeRegularStruct};\n+\n+fn main() {\n+    let _ = SomeTupleStruct.new();\n+    //~^ ERROR expected value, found struct `SomeTupleStruct`\n+    let _ = SomeRegularStruct.new();\n+    //~^ ERROR expected value, found struct `SomeRegularStruct`\n+}"}, {"sha": "957045ca74bb21049501376fe784bcb04a2901ab", "filename": "src/test/ui/resolve/suggest-path-for-tuple-struct.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/83f147b3baf21acfc367a6da1045d212cd3957e4/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/83f147b3baf21acfc367a6da1045d212cd3957e4/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.stderr?ref=83f147b3baf21acfc367a6da1045d212cd3957e4", "patch": "@@ -0,0 +1,19 @@\n+error[E0423]: expected value, found struct `SomeTupleStruct`\n+  --> $DIR/suggest-path-for-tuple-struct.rs:22:13\n+   |\n+LL |     let _ = SomeTupleStruct.new();\n+   |             ^^^^^^^^^^^^^^^----\n+   |             |\n+   |             help: use the path separator to refer to an item: `SomeTupleStruct::new`\n+\n+error[E0423]: expected value, found struct `SomeRegularStruct`\n+  --> $DIR/suggest-path-for-tuple-struct.rs:24:13\n+   |\n+LL |     let _ = SomeRegularStruct.new();\n+   |             ^^^^^^^^^^^^^^^^^----\n+   |             |\n+   |             help: use the path separator to refer to an item: `SomeRegularStruct::new`\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0423`."}]}