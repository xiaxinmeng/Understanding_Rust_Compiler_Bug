{"sha": "37df5e0b917a9c66f586a40e899fca8727efaac5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3ZGY1ZTBiOTE3YTljNjZmNTg2YTQwZTg5OWZjYTg3MjdlZmFhYzU=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2017-12-05T12:09:16Z"}, "committer": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2017-12-05T22:34:02Z"}, "message": "adjust libcore", "tree": {"sha": "41dd736a1eea6d398504a8f76bd3d92c2dc7d2b4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/41dd736a1eea6d398504a8f76bd3d92c2dc7d2b4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37df5e0b917a9c66f586a40e899fca8727efaac5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37df5e0b917a9c66f586a40e899fca8727efaac5", "html_url": "https://github.com/rust-lang/rust/commit/37df5e0b917a9c66f586a40e899fca8727efaac5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37df5e0b917a9c66f586a40e899fca8727efaac5/comments", "author": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b9fbb2ab85914820da703182a5c51acf59088cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b9fbb2ab85914820da703182a5c51acf59088cf", "html_url": "https://github.com/rust-lang/rust/commit/6b9fbb2ab85914820da703182a5c51acf59088cf"}], "stats": {"total": 24, "additions": 16, "deletions": 8}, "files": [{"sha": "4a66506fec729dffefc920797b1b3013e6f27972", "filename": "src/libcore/cell.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/37df5e0b917a9c66f586a40e899fca8727efaac5/src%2Flibcore%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37df5e0b917a9c66f586a40e899fca8727efaac5/src%2Flibcore%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fcell.rs?ref=37df5e0b917a9c66f586a40e899fca8727efaac5", "patch": "@@ -1084,9 +1084,11 @@ impl<'b, T: ?Sized> RefMut<'b, T> {\n     pub fn map<U: ?Sized, F>(orig: RefMut<'b, T>, f: F) -> RefMut<'b, U>\n         where F: FnOnce(&mut T) -> &mut U\n     {\n+        // FIXME: fix borrow-check\n+        let RefMut { value, borrow } = orig;\n         RefMut {\n-            value: f(orig.value),\n-            borrow: orig.borrow,\n+            value: f(value),\n+            borrow: borrow,\n         }\n     }\n }"}, {"sha": "1f7651b75cc83f63db52b04a07c1ee4539417b1d", "filename": "src/libcore/iter/mod.rs", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/37df5e0b917a9c66f586a40e899fca8727efaac5/src%2Flibcore%2Fiter%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37df5e0b917a9c66f586a40e899fca8727efaac5/src%2Flibcore%2Fiter%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fiter%2Fmod.rs?ref=37df5e0b917a9c66f586a40e899fca8727efaac5", "patch": "@@ -1776,12 +1776,18 @@ impl<I: Iterator> Iterator for Peekable<I> {\n \n     #[inline]\n     fn nth(&mut self, n: usize) -> Option<I::Item> {\n-        match self.peeked.take() {\n-            // the .take() below is just to avoid \"move into pattern guard\"\n-            Some(ref mut v) if n == 0 => v.take(),\n-            Some(None) => None,\n-            Some(Some(_)) => self.iter.nth(n - 1),\n-            None => self.iter.nth(n),\n+        // FIXME: merge these when borrow-checking gets better.\n+        if n == 0 {\n+            match self.peeked.take() {\n+                Some(v) => v,\n+                None => self.iter.nth(n),\n+            }\n+        } else {\n+            match self.peeked.take() {\n+                Some(None) => None,\n+                Some(Some(_)) => self.iter.nth(n - 1),\n+                None => self.iter.nth(n),\n+            }\n         }\n     }\n "}]}