{"sha": "9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmOGVlY2EzYmZhZjhlZmE1NWM5YWI5YWZhMjJiNmE5ODk2YTkwNjM=", "commit": {"author": {"name": "Arpad Borsos", "email": "swatinem@swatinem.de", "date": "2021-04-18T21:01:47Z"}, "committer": {"name": "Arpad Borsos", "email": "swatinem@swatinem.de", "date": "2021-04-19T07:38:22Z"}, "message": "rustdoc: Convert sub-variant toggle to HTML\n\nInstead of creating a JS toggle, this injects details/summary for\nsub-variants of enums. This also fixes the CSS so that the toggle button\ndoes not jump when expanding/collapsing.", "tree": {"sha": "eb33b0a45855ecf288118f90f1954b84e5b237d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eb33b0a45855ecf288118f90f1954b84e5b237d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZNNjbpmzULCa7LeL/HvKd4JLMpgFAmB9M3EACgkQ/HvKd4JL\nMph/yA//VlWpgUf7/KKSpAXxwB3bSPxkGPoBKh+6SHONsLHbUqSmhLd0AonUqqkL\nrqGpd3VA/KnoAQMvZybjvrMxTOGbkUccBfXMZ9m0YpWqZgYt20LRKWTCRdUMfmBz\nQNd2iMAY6QKId4b7St+24iJWR+sEfqw/oeSh1XkgeJsBtQ9NcGdDPVH50I4xqnqQ\nGvEnvKwip0P0ZOxPl3jMzBjGG1Q+0aZab8J4mkVWFSZM8sD1cG9QrnGwwSpilfZy\nXuoBV++5mU5MU8E6T6WLNS5DKWifzcztx7Ym4MehxlI2HQJGnVEYhZncLEUe+JgT\nnZBp7JZ8+zijE+9132frv+KzbWVC0E5LPDvBLDIYUotKmLdJ0h3ZrHaYYaz+XhFq\n0/D2S7G0QB039zSr7w8WWhkHb3Dhlar2p47/UkmNAC0ZkD1vi0bh80PrqLHOlNtZ\n/SldLy6gysezHgrqQnbO4XqN+++YbJqFVB0sSls1XgfGryBWorm4UiF3kj8SZq4z\nylUcv7Fv17JQyK4oVn0gjXsjd7ix+JD8BIxKmoeaUb9YEQ4aiokMp+9aqJDqpdJl\napV033nf+xTodc+AHCx+19V8oGY9TlhgWQvIrTmLkQM9rYHYnJ8PbNwUkQ/M9JEK\nWNhaQlCI5yxomvEy0MmQzrPmiieMGJf9kg3sMQVneqx1GMSCDvU=\n=tMiI\n-----END PGP SIGNATURE-----", "payload": "tree eb33b0a45855ecf288118f90f1954b84e5b237d6\nparent 0cc00c48d2c8f7344028cf007d1ee551b886b602\nauthor Arpad Borsos <swatinem@swatinem.de> 1618779707 +0200\ncommitter Arpad Borsos <swatinem@swatinem.de> 1618817902 +0200\n\nrustdoc: Convert sub-variant toggle to HTML\n\nInstead of creating a JS toggle, this injects details/summary for\nsub-variants of enums. This also fixes the CSS so that the toggle button\ndoes not jump when expanding/collapsing.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "html_url": "https://github.com/rust-lang/rust/commit/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/comments", "author": {"login": "Swatinem", "id": 580492, "node_id": "MDQ6VXNlcjU4MDQ5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/580492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swatinem", "html_url": "https://github.com/Swatinem", "followers_url": "https://api.github.com/users/Swatinem/followers", "following_url": "https://api.github.com/users/Swatinem/following{/other_user}", "gists_url": "https://api.github.com/users/Swatinem/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swatinem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swatinem/subscriptions", "organizations_url": "https://api.github.com/users/Swatinem/orgs", "repos_url": "https://api.github.com/users/Swatinem/repos", "events_url": "https://api.github.com/users/Swatinem/events{/privacy}", "received_events_url": "https://api.github.com/users/Swatinem/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Swatinem", "id": 580492, "node_id": "MDQ6VXNlcjU4MDQ5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/580492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swatinem", "html_url": "https://github.com/Swatinem", "followers_url": "https://api.github.com/users/Swatinem/followers", "following_url": "https://api.github.com/users/Swatinem/following{/other_user}", "gists_url": "https://api.github.com/users/Swatinem/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swatinem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swatinem/subscriptions", "organizations_url": "https://api.github.com/users/Swatinem/orgs", "repos_url": "https://api.github.com/users/Swatinem/repos", "events_url": "https://api.github.com/users/Swatinem/events{/privacy}", "received_events_url": "https://api.github.com/users/Swatinem/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0cc00c48d2c8f7344028cf007d1ee551b886b602", "url": "https://api.github.com/repos/rust-lang/rust/commits/0cc00c48d2c8f7344028cf007d1ee551b886b602", "html_url": "https://github.com/rust-lang/rust/commit/0cc00c48d2c8f7344028cf007d1ee551b886b602"}], "stats": {"total": 26, "additions": 19, "deletions": 7}, "files": [{"sha": "8e77d3d014fab07383ebd6411e5f2cb6c7907348", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "patch": "@@ -934,6 +934,7 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n \n             use crate::clean::Variant;\n             if let clean::VariantItem(Variant::Struct(ref s)) = *variant.kind {\n+                toggle_open(w, \"fields\");\n                 let variant_id = cx.derive_id(format!(\n                     \"{}.{}.fields\",\n                     ItemType::Variant,\n@@ -967,6 +968,7 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n                     }\n                 }\n                 w.write_str(\"</div></div>\");\n+                toggle_close(w);\n             }\n             render_stability_since(w, variant, it, cx.tcx());\n         }"}, {"sha": "ab341a647a820bce5e0dc32a680fb68c87d2eea8", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "patch": "@@ -428,6 +428,15 @@ function hideThemeButtonState() {\n         handleHashes(ev);\n     }\n \n+    function openParentDetails(elem) {\n+        while (elem) {\n+            if (elem.tagName === \"DETAILS\") {\n+                elem.open = true;\n+            }\n+            elem = elem.parentNode;\n+        }\n+    }\n+\n     function expandSection(id) {\n         var elem = document.getElementById(id);\n         if (elem && isHidden(elem)) {\n@@ -442,6 +451,8 @@ function hideThemeButtonState() {\n                     // The element is not visible, we need to make it appear!\n                     collapseDocs(collapses[0], \"show\");\n                 }\n+                // In case this is a sub-variant, toggle the <details> open.\n+                openParentDetails(h3.parentNode);\n             }\n         }\n     }\n@@ -2418,7 +2429,7 @@ function hideThemeButtonState() {\n             if (hasClass(relatedDoc, \"item-info\")) {\n                 relatedDoc = relatedDoc.nextElementSibling;\n             }\n-            if (hasClass(relatedDoc, \"docblock\") || hasClass(relatedDoc, \"sub-variant\")) {\n+            if (hasClass(relatedDoc, \"docblock\")) {\n                 if (mode === \"toggle\") {\n                     if (hasClass(relatedDoc, \"hidden-by-usual-hider\")) {\n                         action = \"show\";\n@@ -2727,8 +2738,6 @@ function hideThemeButtonState() {\n                 if (hasClass(e, \"type-decl\")) {\n                     // We do something special for these\n                     return;\n-                } else if (hasClass(e, \"sub-variant\")) {\n-                    otherMessage = \"&nbsp;Show&nbsp;fields\";\n                 } else if (hasClass(e, \"non-exhaustive\")) {\n                     otherMessage = \"&nbsp;This&nbsp;\";\n                     if (hasClass(e, \"non-exhaustive-struct\")) {\n@@ -2760,7 +2769,6 @@ function hideThemeButtonState() {\n         }\n \n         onEachLazy(document.getElementsByClassName(\"docblock\"), buildToggleWrapper);\n-        onEachLazy(document.getElementsByClassName(\"sub-variant\"), buildToggleWrapper);\n \n         autoCollapse(getSettingValue(\"collapse\") === \"true\");\n "}, {"sha": "243df79ac4229e5e3df25d8d9ada3a0402fa2f82", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "patch": "@@ -1031,10 +1031,11 @@ h3 > .collapse-toggle, h4 > .collapse-toggle {\n }\n \n .sub-variant, .sub-variant > h3 {\n-\tmargin-top: 1px !important;\n+\tmargin-top: 0px !important;\n+\tpadding-top: 1px;\n }\n \n-#main > .sub-variant > h3 {\n+#main > details > .sub-variant > h3 {\n \tfont-size: 15px;\n \tmargin-left: 25px;\n \tmargin-bottom: 5px;"}, {"sha": "8986f72636a40bfd594e53e0e4d15e816b631bf6", "filename": "src/test/rustdoc/item-hide-threshold.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Ftest%2Frustdoc%2Fitem-hide-threshold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063/src%2Ftest%2Frustdoc%2Fitem-hide-threshold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fitem-hide-threshold.rs?ref=9f8eeca3bfaf8efa55c9ab9afa22b6a9896a9063", "patch": "@@ -62,7 +62,8 @@ pub struct PrivStruct {\n }\n \n // @has 'item_hide_threshold/enum.Enum.html'\n-// @count - '//details[@class=\"rustdoc-toggle type-contents-toggle\"]' 0\n+// @count - '//details[@class=\"rustdoc-toggle type-contents-toggle\"]' 1\n+// @has - '//details[@class=\"rustdoc-toggle type-contents-toggle\"]' 'Show fields'\n pub enum Enum {\n     A, B, C,\n     D {"}]}