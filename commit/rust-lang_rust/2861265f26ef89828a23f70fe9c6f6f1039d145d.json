{"sha": "2861265f26ef89828a23f70fe9c6f6f1039d145d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4NjEyNjVmMjZlZjg5ODI4YTIzZjcwZmU5YzZmNmYxMDM5ZDE0NWQ=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-07-21T13:52:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-21T13:52:44Z"}, "message": "Rollup merge of #87187 - oxalica:fix-nixos-detect, r=nagisa\n\nFix NixOS detection\n\nUse `/etc/os-release` instead of `/etc/NIXOS` for detection.\nThe latter one does not exist on NixOS when using tmpfs as root.", "tree": {"sha": "bbd18566f4d576897c4c54748964033d218945dc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bbd18566f4d576897c4c54748964033d218945dc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2861265f26ef89828a23f70fe9c6f6f1039d145d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg+CasCRBK7hj4Ov3rIwAADn4IABkF/Eu2h07DRS34bAeLlhCv\njHtFiCPqDvVuBUejZeoF1TsrwXFApxq45MRFvOJ7cC+/92KL6qPnRs3u4noxmOgf\nednKUmXOi6WisgzSD76VAPVvABAn7si8o4YTDmW3fN+mL0wEugEM2vRT6/cTsHSe\nZ5hrZAonnD0DtFqvZnJ8K4y731RbObRsAZw72A4KKJVI7jVYOh/zgQDL3jci6cwB\nnmlZCLT0q2oscj8Kl7i67cNQYpk4uwIn5qrfsIfnx81ZPU9oB+D+tcrgkevyyiYP\n/D/q7EsR2EuUkWxmdyeJyEWaghmdsXFykxRhD5UFOiYJfpfO63X3VqTdVyNRWfU=\n=8EVa\n-----END PGP SIGNATURE-----\n", "payload": "tree bbd18566f4d576897c4c54748964033d218945dc\nparent cf932aa584f2ba1a1744f3ef0b21f14387276fb6\nparent 919a8a5028e4b94370e9c3f6b19cda48f9c97f7b\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1626875564 +0200\ncommitter GitHub <noreply@github.com> 1626875564 +0200\n\nRollup merge of #87187 - oxalica:fix-nixos-detect, r=nagisa\n\nFix NixOS detection\n\nUse `/etc/os-release` instead of `/etc/NIXOS` for detection.\nThe latter one does not exist on NixOS when using tmpfs as root.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2861265f26ef89828a23f70fe9c6f6f1039d145d", "html_url": "https://github.com/rust-lang/rust/commit/2861265f26ef89828a23f70fe9c6f6f1039d145d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2861265f26ef89828a23f70fe9c6f6f1039d145d/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cf932aa584f2ba1a1744f3ef0b21f14387276fb6", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf932aa584f2ba1a1744f3ef0b21f14387276fb6", "html_url": "https://github.com/rust-lang/rust/commit/cf932aa584f2ba1a1744f3ef0b21f14387276fb6"}, {"sha": "919a8a5028e4b94370e9c3f6b19cda48f9c97f7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b", "html_url": "https://github.com/rust-lang/rust/commit/919a8a5028e4b94370e9c3f6b19cda48f9c97f7b"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "d2cf929aa266f82a0b9618b68aa528a92a7de65c", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2861265f26ef89828a23f70fe9c6f6f1039d145d/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/2861265f26ef89828a23f70fe9c6f6f1039d145d/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=2861265f26ef89828a23f70fe9c6f6f1039d145d", "patch": "@@ -580,7 +580,13 @@ def fix_bin_or_dylib(self, fname):\n         if ostype != \"Linux\":\n             return\n \n-        if not os.path.exists(\"/etc/NIXOS\"):\n+        # Use `/etc/os-release` instead of `/etc/NIXOS`.\n+        # The latter one does not exist on NixOS when using tmpfs as root.\n+        try:\n+            with open(\"/etc/os-release\", \"r\") as f:\n+                if not any(line.strip() == \"ID=nixos\" for line in f):\n+                    return\n+        except FileNotFoundError:\n             return\n         if os.path.exists(\"/lib\"):\n             return"}]}