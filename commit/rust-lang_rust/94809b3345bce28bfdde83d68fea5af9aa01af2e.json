{"sha": "94809b3345bce28bfdde83d68fea5af9aa01af2e", "node_id": "C_kwDOAAsO6NoAKDk0ODA5YjMzNDViY2UyOGJmZGRlODNkNjhmZWE1YWY5YWEwMWFmMmU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-01-29T19:03:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-29T19:03:35Z"}, "message": "Rollup merge of #106763 - lenko-d:106659-Print_why_a_test_was_ignored_if_its_the_only_test_specified, r=Mark-Simulacrum\n\nprint why a test was ignored if its the only test specified\n\nFixes [#106659](https://github.com/rust-lang/rust/issues/106659)", "tree": {"sha": "d2a4ba35431875b036eec6637afd0ddc6e5a18d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2a4ba35431875b036eec6637afd0ddc6e5a18d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94809b3345bce28bfdde83d68fea5af9aa01af2e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj1sMHCRBK7hj4Ov3rIwAAyUkIAGz5GZi9CK/HYOxr9bZhPjyZ\nSTV8Y4bK+Ws5/8hVZHYcMtlZFtTYLpWOytdejIGqjjN56ASXN8mD3eIRrbtLir2m\nkN5AsdPcdLPU3gceWDrbQroHP2vojjGPDV14qCAh3OMvbh+FSBn5A92ZHXoCiHfj\nOoV4IleWOq1s9IxwC6oypfx8uKOQIEPOYweln07cQgV3in0EDNvcxN8aQguUXhUA\nthr5/bRh0YWZa+2b8ICpW1kmQrr2nG1+QzAPzvftLtOFZsnIiLLltGJX8qlktt39\ngVQ5t/mDmLMG5eCwgrjG71/MXgsWMZUL5eym9CHdawzEI7/hj2gs07dETCRlH4A=\n=3/UA\n-----END PGP SIGNATURE-----\n", "payload": "tree d2a4ba35431875b036eec6637afd0ddc6e5a18d0\nparent 869160215113c17cdcc419b8ed8ae24be927058c\nparent 002dbbeafa39d0375ba45d2e9f7bc2d4ae248c59\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1675019015 +0100\ncommitter GitHub <noreply@github.com> 1675019015 +0100\n\nRollup merge of #106763 - lenko-d:106659-Print_why_a_test_was_ignored_if_its_the_only_test_specified, r=Mark-Simulacrum\n\nprint why a test was ignored if its the only test specified\n\nFixes [#106659](https://github.com/rust-lang/rust/issues/106659)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94809b3345bce28bfdde83d68fea5af9aa01af2e", "html_url": "https://github.com/rust-lang/rust/commit/94809b3345bce28bfdde83d68fea5af9aa01af2e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94809b3345bce28bfdde83d68fea5af9aa01af2e/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "869160215113c17cdcc419b8ed8ae24be927058c", "url": "https://api.github.com/repos/rust-lang/rust/commits/869160215113c17cdcc419b8ed8ae24be927058c", "html_url": "https://github.com/rust-lang/rust/commit/869160215113c17cdcc419b8ed8ae24be927058c"}, {"sha": "002dbbeafa39d0375ba45d2e9f7bc2d4ae248c59", "url": "https://api.github.com/repos/rust-lang/rust/commits/002dbbeafa39d0375ba45d2e9f7bc2d4ae248c59", "html_url": "https://github.com/rust-lang/rust/commit/002dbbeafa39d0375ba45d2e9f7bc2d4ae248c59"}], "stats": {"total": 82, "additions": 54, "deletions": 28}, "files": [{"sha": "45fd87bea9bb5ac72437553c8c2de59c01741239", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 54, "deletions": 28, "changes": 82, "blob_url": "https://github.com/rust-lang/rust/blob/94809b3345bce28bfdde83d68fea5af9aa01af2e/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94809b3345bce28bfdde83d68fea5af9aa01af2e/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=94809b3345bce28bfdde83d68fea5af9aa01af2e", "patch": "@@ -926,7 +926,7 @@ pub fn make_test_description<R: Read>(\n     cfg: Option<&str>,\n ) -> test::TestDesc {\n     let mut ignore = false;\n-    let ignore_message = None;\n+    let mut ignore_message = None;\n     let mut should_fail = false;\n \n     let rustc_has_profiler_support = env::var_os(\"RUSTC_PROFILER_SUPPORT\").is_some();\n@@ -966,41 +966,67 @@ pub fn make_test_description<R: Read>(\n         if revision.is_some() && revision != cfg {\n             return;\n         }\n+        macro_rules! reason {\n+            ($e:expr) => {\n+                ignore |= match $e {\n+                    true => {\n+                        ignore_message = Some(stringify!($e));\n+                        true\n+                    }\n+                    false => ignore,\n+                }\n+            };\n+        }\n         ignore = match config.parse_cfg_name_directive(ln, \"ignore\") {\n-            ParsedNameDirective::Match => true,\n+            ParsedNameDirective::Match => {\n+                ignore_message = Some(\"cfg -> ignore => Match\");\n+                true\n+            }\n             ParsedNameDirective::NoMatch => ignore,\n         };\n+\n         if config.has_cfg_prefix(ln, \"only\") {\n             ignore = match config.parse_cfg_name_directive(ln, \"only\") {\n                 ParsedNameDirective::Match => ignore,\n-                ParsedNameDirective::NoMatch => true,\n+                ParsedNameDirective::NoMatch => {\n+                    ignore_message = Some(\"cfg -> only => NoMatch\");\n+                    true\n+                }\n             };\n         }\n-        ignore |= ignore_llvm(config, ln);\n-        ignore |=\n-            config.run_clang_based_tests_with.is_none() && config.parse_needs_matching_clang(ln);\n-        ignore |= !has_asm_support && config.parse_name_directive(ln, \"needs-asm-support\");\n-        ignore |= !rustc_has_profiler_support && config.parse_needs_profiler_support(ln);\n-        ignore |= !config.run_enabled() && config.parse_name_directive(ln, \"needs-run-enabled\");\n-        ignore |= !rustc_has_sanitizer_support\n-            && config.parse_name_directive(ln, \"needs-sanitizer-support\");\n-        ignore |= !has_asan && config.parse_name_directive(ln, \"needs-sanitizer-address\");\n-        ignore |= !has_cfi && config.parse_name_directive(ln, \"needs-sanitizer-cfi\");\n-        ignore |= !has_kcfi && config.parse_name_directive(ln, \"needs-sanitizer-kcfi\");\n-        ignore |= !has_lsan && config.parse_name_directive(ln, \"needs-sanitizer-leak\");\n-        ignore |= !has_msan && config.parse_name_directive(ln, \"needs-sanitizer-memory\");\n-        ignore |= !has_tsan && config.parse_name_directive(ln, \"needs-sanitizer-thread\");\n-        ignore |= !has_hwasan && config.parse_name_directive(ln, \"needs-sanitizer-hwaddress\");\n-        ignore |= !has_memtag && config.parse_name_directive(ln, \"needs-sanitizer-memtag\");\n-        ignore |= !has_shadow_call_stack\n-            && config.parse_name_directive(ln, \"needs-sanitizer-shadow-call-stack\");\n-        ignore |= !config.can_unwind() && config.parse_name_directive(ln, \"needs-unwind\");\n-        ignore |= config.target == \"wasm32-unknown-unknown\"\n-            && config.parse_name_directive(ln, directives::CHECK_RUN_RESULTS);\n-        ignore |= config.debugger == Some(Debugger::Cdb) && ignore_cdb(config, ln);\n-        ignore |= config.debugger == Some(Debugger::Gdb) && ignore_gdb(config, ln);\n-        ignore |= config.debugger == Some(Debugger::Lldb) && ignore_lldb(config, ln);\n-        ignore |= !has_rust_lld && config.parse_name_directive(ln, \"needs-rust-lld\");\n+\n+        reason!(ignore_llvm(config, ln));\n+        reason!(\n+            config.run_clang_based_tests_with.is_none() && config.parse_needs_matching_clang(ln)\n+        );\n+        reason!(!has_asm_support && config.parse_name_directive(ln, \"needs-asm-support\"));\n+        reason!(!rustc_has_profiler_support && config.parse_needs_profiler_support(ln));\n+        reason!(!config.run_enabled() && config.parse_name_directive(ln, \"needs-run-enabled\"));\n+        reason!(\n+            !rustc_has_sanitizer_support\n+                && config.parse_name_directive(ln, \"needs-sanitizer-support\")\n+        );\n+        reason!(!has_asan && config.parse_name_directive(ln, \"needs-sanitizer-address\"));\n+        reason!(!has_cfi && config.parse_name_directive(ln, \"needs-sanitizer-cfi\"));\n+        reason!(!has_kcfi && config.parse_name_directive(ln, \"needs-sanitizer-kcfi\"));\n+        reason!(!has_lsan && config.parse_name_directive(ln, \"needs-sanitizer-leak\"));\n+        reason!(!has_msan && config.parse_name_directive(ln, \"needs-sanitizer-memory\"));\n+        reason!(!has_tsan && config.parse_name_directive(ln, \"needs-sanitizer-thread\"));\n+        reason!(!has_hwasan && config.parse_name_directive(ln, \"needs-sanitizer-hwaddress\"));\n+        reason!(!has_memtag && config.parse_name_directive(ln, \"needs-sanitizer-memtag\"));\n+        reason!(\n+            !has_shadow_call_stack\n+                && config.parse_name_directive(ln, \"needs-sanitizer-shadow-call-stack\")\n+        );\n+        reason!(!config.can_unwind() && config.parse_name_directive(ln, \"needs-unwind\"));\n+        reason!(\n+            config.target == \"wasm32-unknown-unknown\"\n+                && config.parse_name_directive(ln, directives::CHECK_RUN_RESULTS)\n+        );\n+        reason!(config.debugger == Some(Debugger::Cdb) && ignore_cdb(config, ln));\n+        reason!(config.debugger == Some(Debugger::Gdb) && ignore_gdb(config, ln));\n+        reason!(config.debugger == Some(Debugger::Lldb) && ignore_lldb(config, ln));\n+        reason!(!has_rust_lld && config.parse_name_directive(ln, \"needs-rust-lld\"));\n         should_fail |= config.parse_name_directive(ln, \"should-fail\");\n     });\n "}]}