{"sha": "4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57", "node_id": "C_kwDOAAsO6NoAKDRhMGVjNTBmMGQ2ZTcxOWViMTJhYWEyOTY2YzVhOTNjMjM4ZTJiNTc", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-03-25T20:46:36Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-03-25T20:46:36Z"}, "message": "Update issue-15149.rs", "tree": {"sha": "ed67d39a8265d2b30ce114759b16ba7c7354cfef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed67d39a8265d2b30ce114759b16ba7c7354cfef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmI+KiwACgkQcTRy8vRW\nJ956bg//b/QSUEgwBMFVnZhYoSvK++7DGUVTtlM20DJXPkOgUr40H+TD9QswH3F1\nwXhnCGcrClpz+GV2Iooz7iNqJaKUFn/a/7eQ2Knur+eUzWrdyN1ndq3DXstXegNS\nfSi5WIOwdA0TSho4zeY3QLWrL3gLZpXWn0AMjiTjpxg7gRwQZ/+PmEL9YGbXs+bG\nHLSFPdXg/Brr0A/aswm8k7Gj2FxVu/XtGKBHFHmoE7Gk0FOUkeJ8OioaEkrOCztz\nyMmQ3xNa20oTGcg3MKbFsDTEHlmyxdgxPW9HuL0UD/7yBMEKA89OXhFRJRmRJxep\nCul1wVj66i7XvWvW/XcBKfAzjTTpqDSOSYhkCLhgrjCG51i1WvPoNLRhAYRI1LZO\nzvIWlgKUnO9d4B6aP7FgKppsztjahjM+QpVbVrc+QcP2SMJk+MgDxc2tQKs/3ObU\n/+Th5kofcP5P2EkckPt1p1jU2utmkWfwl5xikeKPBi/GUMO4tue7CcctfqnpQCv4\nUvFbZHvVY/t428BPnXNsDmpadzT4u6wJT4b6Czoadho++yOc2Wo0DDsEVQ6/fbuv\n2PbHdNrBD4VVg8vy1sVH6LJcCaN1kExcqpkXJpopPuVxXvCLLbZ2WJo39e6UF5S/\nDsViNoWrhTULcwl2NjMlXe/KGo1zANSF3gVYEpyn6/xNA0Vna+A=\n=gD9w\n-----END PGP SIGNATURE-----", "payload": "tree ed67d39a8265d2b30ce114759b16ba7c7354cfef\nparent 7200afaadb8a0afcf09906023eb68480a1edec3c\nauthor Chris Denton <christophersdenton@gmail.com> 1648241196 +0000\ncommitter Chris Denton <christophersdenton@gmail.com> 1648241196 +0000\n\nUpdate issue-15149.rs\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57", "html_url": "https://github.com/rust-lang/rust/commit/4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7200afaadb8a0afcf09906023eb68480a1edec3c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7200afaadb8a0afcf09906023eb68480a1edec3c", "html_url": "https://github.com/rust-lang/rust/commit/7200afaadb8a0afcf09906023eb68480a1edec3c"}], "stats": {"total": 27, "additions": 14, "deletions": 13}, "files": [{"sha": "064472f5785a1f80823eca178058754472deaf48", "filename": "src/test/ui-fulldeps/issue-15149.rs", "status": "modified", "additions": 14, "deletions": 13, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57/src%2Ftest%2Fui-fulldeps%2Fissue-15149.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57/src%2Ftest%2Fui-fulldeps%2Fissue-15149.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fissue-15149.rs?ref=4a0ec50f0d6e719eb12aaa2966c5a93c238e2b57", "patch": "@@ -5,10 +5,11 @@\n // ignore-cross-compile\n \n use std::env;\n+use std::ffi::OsStr;\n use std::fs;\n+use std::path::PathBuf;\n use std::process;\n use std::str;\n-use std::path::PathBuf;\n \n fn main() {\n     // If we're the child, make sure we were invoked correctly\n@@ -18,8 +19,8 @@ fn main() {\n         // checking that it ends_with the executable name. This\n         // is needed because of Windows, which has a different behavior.\n         // See #15149 for more info.\n-        return assert!(args[0].ends_with(&format!(\"mytest{}\",\n-                                                  env::consts::EXE_SUFFIX)));\n+        let my_path = env::current_exe().unwrap();\n+        return assert_eq!(my_path.file_stem(), Some(OsStr::new(\"mytest\")));\n     }\n \n     test();\n@@ -28,14 +29,13 @@ fn main() {\n fn test() {\n     // If we're the parent, copy our own binary to a new directory.\n     let my_path = env::current_exe().unwrap();\n-    let my_dir  = my_path.parent().unwrap();\n+    let my_dir = my_path.parent().unwrap();\n \n     let child_dir = PathBuf::from(env::var_os(\"RUST_TEST_TMPDIR\").unwrap());\n     let child_dir = child_dir.join(\"issue-15140-child\");\n     fs::create_dir_all(&child_dir).unwrap();\n \n-    let child_path = child_dir.join(&format!(\"mytest{}\",\n-                                             env::consts::EXE_SUFFIX));\n+    let child_path = child_dir.join(&format!(\"mytest{}\", env::consts::EXE_SUFFIX));\n     fs::copy(&my_path, &child_path).unwrap();\n \n     // Append the new directory to our own PATH.\n@@ -45,12 +45,13 @@ fn test() {\n         env::join_paths(paths).unwrap()\n     };\n \n-    let child_output = process::Command::new(\"mytest\").env(\"PATH\", &path)\n-                                                      .arg(\"child\")\n-                                                      .output().unwrap();\n+    let child_output =\n+        process::Command::new(\"mytest\").env(\"PATH\", &path).arg(\"child\").output().unwrap();\n \n-    assert!(child_output.status.success(),\n-            \"child assertion failed\\n child stdout:\\n {}\\n child stderr:\\n {}\",\n-            str::from_utf8(&child_output.stdout).unwrap(),\n-            str::from_utf8(&child_output.stderr).unwrap());\n+    assert!(\n+        child_output.status.success(),\n+        \"child assertion failed\\n child stdout:\\n {}\\n child stderr:\\n {}\",\n+        str::from_utf8(&child_output.stdout).unwrap(),\n+        str::from_utf8(&child_output.stderr).unwrap()\n+    );\n }"}]}