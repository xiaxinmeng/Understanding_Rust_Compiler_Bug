{"sha": "e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4MDA4MGRlYjYwZTc4ZTdhNTdiZTRkNjkzY2E4ZTk2Y2IxNGExYjI=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-09-24T08:30:54Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-09-24T08:30:54Z"}, "message": "Merge pull request #359 from eefriedman/rewrite-addrof\n\nAdd support for formatting AddrOf (unary \"&\").", "tree": {"sha": "2b3a911ae1463facdfc634f23fa206ab15ba44a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b3a911ae1463facdfc634f23fa206ab15ba44a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "html_url": "https://github.com/rust-lang/rust/commit/e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d941fe20b4a9c6c15ed3307abec0f7d04c03db52", "url": "https://api.github.com/repos/rust-lang/rust/commits/d941fe20b4a9c6c15ed3307abec0f7d04c03db52", "html_url": "https://github.com/rust-lang/rust/commit/d941fe20b4a9c6c15ed3307abec0f7d04c03db52"}, {"sha": "19e887c3097488b8d4d911b9423ffba1dec99987", "url": "https://api.github.com/repos/rust-lang/rust/commits/19e887c3097488b8d4d911b9423ffba1dec99987", "html_url": "https://github.com/rust-lang/rust/commit/19e887c3097488b8d4d911b9423ffba1dec99987"}], "stats": {"total": 48, "additions": 36, "deletions": 12}, "files": [{"sha": "f385012dadd5144d95b8ab041f064e313d2f491b", "filename": "src/chains.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "patch": "@@ -150,10 +150,7 @@ fn rewrite_chain_expr(expr: &ast::Expr,\n                       -> Option<String> {\n     match expr.node {\n         ast::Expr_::ExprMethodCall(ref method_name, ref types, ref expressions) => {\n-            let inner = &RewriteContext {\n-                block_indent: offset,\n-                ..*context\n-            };\n+            let inner = &RewriteContext { block_indent: offset, ..*context };\n             rewrite_method_call(method_name.node, types, expressions, span, inner, width, offset)\n         }\n         ast::Expr_::ExprField(_, ref field) => {"}, {"sha": "a2be6ee8fd1ddf68b65d2f7a9d56cfb2b4b35de7", "filename": "src/expr.rs", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "patch": "@@ -163,12 +163,14 @@ impl Rewrite for ast::Expr {\n             ast::Expr_::ExprRet(Some(ref expr)) => {\n                 rewrite_unary_prefix(context, \"return \", &expr, width, offset)\n             }\n+            ast::Expr_::ExprAddrOf(mutability, ref expr) => {\n+                rewrite_expr_addrof(context, mutability, &expr, width, offset)\n+            }\n             // We do not format these expressions yet, but they should still\n             // satisfy our width restrictions.\n             ast::Expr_::ExprBox(..) |\n             ast::Expr_::ExprCast(..) |\n             ast::Expr_::ExprIndex(..) |\n-            ast::Expr_::ExprAddrOf(..) |\n             ast::Expr_::ExprInlineAsm(..) |\n             ast::Expr_::ExprRepeat(..) => {\n                 wrap_str(context.snippet(self.span), context.config.max_width, width, offset)\n@@ -684,11 +686,7 @@ fn rewrite_match_arm_comment(context: &RewriteContext,\n     if !missed_str.is_empty() {\n         result.push('\\n');\n         result.push_str(arm_indent_str);\n-        result.push_str(&rewrite_comment(&missed_str,\n-                                         false,\n-                                         width,\n-                                         arm_indent,\n-                                         context.config));\n+        result.push_str(&rewrite_comment(&missed_str, false, width, arm_indent, context.config));\n     }\n     return result;\n }\n@@ -746,7 +744,8 @@ fn rewrite_match(context: &RewriteContext,\n     let last_comment = context.snippet(mk_sp(arm_end_pos(&arms[arms.len() - 1]), span.hi));\n     result.push_str(&rewrite_match_arm_comment(context,\n                                                &last_comment,\n-                                               width, arm_indent,\n+                                               width,\n+                                               arm_indent,\n                                                &arm_indent_str));\n     result.push('\\n');\n     result.push_str(&(context.block_indent + context.overflow_indent).to_string(context.config));\n@@ -1414,3 +1413,16 @@ pub fn rewrite_assign_rhs<S: Into<String>>(context: &RewriteContext,\n \n     Some(result)\n }\n+\n+fn rewrite_expr_addrof(context: &RewriteContext,\n+                       mutability: ast::Mutability,\n+                       expr: &ast::Expr,\n+                       width: usize,\n+                       offset: Indent)\n+                       -> Option<String> {\n+    let operator_str = match mutability {\n+        ast::Mutability::MutImmutable => \"&\",\n+        ast::Mutability::MutMutable => \"&mut \",\n+    };\n+    rewrite_unary_prefix(context, operator_str, expr, width, offset)\n+}"}, {"sha": "60e5c7e5b56704d95e09f6e5a44f4f3202e945d1", "filename": "src/lists.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/src%2Flists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/src%2Flists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flists.rs?ref=e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "patch": "@@ -200,7 +200,10 @@ pub fn write_list<'b>(items: &[ListItem], formatting: &ListFormatting<'b>) -> Op\n             let block_mode = tactic != ListTactic::Vertical;\n             // Width restriction is only relevant in vertical mode.\n             let max_width = formatting.v_width;\n-            result.push_str(&rewrite_comment(comment, block_mode, max_width, formatting.indent,\n+            result.push_str(&rewrite_comment(comment,\n+                                             block_mode,\n+                                             max_width,\n+                                             formatting.indent,\n                                              formatting.config));\n \n             if tactic == ListTactic::Vertical {"}, {"sha": "fc34f799d7d558eb04e93542a83ae0128648777b", "filename": "tests/source/expr.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "patch": "@@ -298,3 +298,8 @@ fn returns() {\n \n     return aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa + aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa;\n }\n+\n+fn addrof() {\n+    &    mut(aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa+bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb);\n+    &    (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa+bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb);\n+}"}, {"sha": "34205819f60965ea2484c9906b12d37c6d2e2166", "filename": "tests/target/expr.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e80080deb60e78e7a57be4d693ca8e96cb14a1b2/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=e80080deb60e78e7a57be4d693ca8e96cb14a1b2", "patch": "@@ -306,3 +306,10 @@ fn returns() {\n     return aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa +\n            aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa;\n }\n+\n+fn addrof() {\n+    &mut (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa +\n+          bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb);\n+    &(aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa +\n+      bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb);\n+}"}]}