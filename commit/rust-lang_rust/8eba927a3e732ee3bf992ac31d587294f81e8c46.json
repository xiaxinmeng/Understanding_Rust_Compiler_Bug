{"sha": "8eba927a3e732ee3bf992ac31d587294f81e8c46", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlYmE5MjdhM2U3MzJlZTNiZjk5MmFjMzFkNTg3Mjk0ZjgxZThjNDY=", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-03-14T21:43:10Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-03-14T21:45:00Z"}, "message": "Make nameWithoutUndescores lowercased\n\nThis basically fixes a search bug introduced by earlier changes.", "tree": {"sha": "6e38db901ac710c6c4f434085ff43f2efd050ee7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e38db901ac710c6c4f434085ff43f2efd050ee7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8eba927a3e732ee3bf992ac31d587294f81e8c46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8eba927a3e732ee3bf992ac31d587294f81e8c46", "html_url": "https://github.com/rust-lang/rust/commit/8eba927a3e732ee3bf992ac31d587294f81e8c46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8eba927a3e732ee3bf992ac31d587294f81e8c46/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f57d71533eb6199b04f62bb54c8f19d655d3c824", "url": "https://api.github.com/repos/rust-lang/rust/commits/f57d71533eb6199b04f62bb54c8f19d655d3c824", "html_url": "https://github.com/rust-lang/rust/commit/f57d71533eb6199b04f62bb54c8f19d655d3c824"}], "stats": {"total": 29, "additions": 15, "deletions": 14}, "files": [{"sha": "fe1791e4b0723ca1ce5365e943f574e01b4067d5", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 15, "deletions": 14, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/8eba927a3e732ee3bf992ac31d587294f81e8c46/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/8eba927a3e732ee3bf992ac31d587294f81e8c46/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=8eba927a3e732ee3bf992ac31d587294f81e8c46", "patch": "@@ -1304,11 +1304,11 @@ function defocusSearchBar() {\n \n                     if (searchWords[j].indexOf(split[i]) > -1 ||\n                         searchWords[j].indexOf(val) > -1 ||\n-                        ty.nameWithoutUnderscores.indexOf(val) > -1)\n+                        ty.normalizedName.indexOf(val) > -1)\n                     {\n                         // filter type: ... queries\n                         if (typePassesFilter(typeFilter, ty.ty) && results[fullId] === undefined) {\n-                            index = ty.nameWithoutUnderscores.indexOf(val);\n+                            index = ty.normalizedName.indexOf(val);\n                         }\n                     }\n                     if ((lev = levenshtein(searchWords[j], val)) <= MAX_LEV_DISTANCE) {\n@@ -1846,7 +1846,7 @@ function defocusSearchBar() {\n                 var crateSize = 0;\n \n                 searchWords.push(crate);\n-                var nameWithoutUnderscores = crate.indexOf(\"_\") === -1\n+                var normalizedName = crate.indexOf(\"_\") === -1\n                     ? crate\n                     : crate.replace(/_/g, \"\");\n                 // This object should have exactly the same set of fields as the \"row\"\n@@ -1861,7 +1861,7 @@ function defocusSearchBar() {\n                     parent: undefined,\n                     type: null,\n                     id: id,\n-                    nameWithoutUnderscores: nameWithoutUnderscores,\n+                    normalizedName: normalizedName,\n                 };\n                 id += 1;\n                 searchIndex.push(crateRow);\n@@ -1904,9 +1904,16 @@ function defocusSearchBar() {\n                 for (i = 0; i < len; ++i) {\n                     // This object should have exactly the same set of fields as the \"crateRow\"\n                     // object defined above.\n-                    var nameWithoutUnderscores = itemNames[i].indexOf(\"_\") === -1\n-                        ? itemNames[i]\n-                        : itemNames[i].replace(/_/g, \"\");\n+                    if (typeof itemNames[i] === \"string\") {\n+                        var word = itemNames[i].toLowerCase();\n+                        searchWords.push(word);\n+                    } else {\n+                        var word = \"\";\n+                        searchWords.push(\"\");\n+                    }\n+                    var normalizedName = word.indexOf(\"_\") === -1\n+                        ? word\n+                        : word.replace(/_/g, \"\");\n                     var row = {\n                         crate: crate,\n                         ty: itemTypes[i],\n@@ -1916,16 +1923,10 @@ function defocusSearchBar() {\n                         parent: itemParentIdxs[i] > 0 ? paths[itemParentIdxs[i] - 1] : undefined,\n                         type: itemFunctionSearchTypes[i],\n                         id: id,\n-                        nameWithoutUnderscores: nameWithoutUnderscores,\n+                        normalizedName: normalizedName,\n                     };\n                     id += 1;\n                     searchIndex.push(row);\n-                    if (typeof row.name === \"string\") {\n-                        var word = row.name.toLowerCase();\n-                        searchWords.push(word);\n-                    } else {\n-                        searchWords.push(\"\");\n-                    }\n                     lastPath = row.path;\n                     crateSize += 1;\n                 }"}]}