{"sha": "b42ff20c560fb53982b3f77d3fed5c459a01b545", "node_id": "C_kwDOAAsO6NoAKGI0MmZmMjBjNTYwZmI1Mzk4MmIzZjc3ZDNmZWQ1YzQ1OWEwMWI1NDU", "commit": {"author": {"name": "jyn", "email": "github@jyn.dev", "date": "2023-05-26T04:56:15Z"}, "committer": {"name": "jyn", "email": "github@jyn.dev", "date": "2023-05-26T05:00:58Z"}, "message": "Revert \"Enable incremental independent of stage\"\n\nThis reverts commit 827f656ebb1230f31af6d968c4bfe69a79914ffc.\n\nIncremental is not sound to use across stages. Arbitrary changes to the compiler can invalidate the\nincremental cache - even changes to normal queries, not incremental itself! - and we do not\ncurrently enable `incremental-verify-ich` in bootstrap. Since 2018, we highly recommend and nudge\nusers towards stage 1 builds instead of stage 2, and using `keep-stage` for anything other than\nlibstd is very rare.\n\nI don't think the risk of unsoundness is worth the very minor speedup when building libstd. Disable\nincremental to avoid spurious panics and miscompilations when building with the stage 1 and 2\nsysroot.", "tree": {"sha": "c2f6176cb1caef55cd97bb15ca68bbdede49ce44", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2f6176cb1caef55cd97bb15ca68bbdede49ce44"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b42ff20c560fb53982b3f77d3fed5c459a01b545", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b42ff20c560fb53982b3f77d3fed5c459a01b545", "html_url": "https://github.com/rust-lang/rust/commit/b42ff20c560fb53982b3f77d3fed5c459a01b545", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b42ff20c560fb53982b3f77d3fed5c459a01b545/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0004b3b984b19646c1f78b09ba497b7bd6e882c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/0004b3b984b19646c1f78b09ba497b7bd6e882c1", "html_url": "https://github.com/rust-lang/rust/commit/0004b3b984b19646c1f78b09ba497b7bd6e882c1"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "685824278ff25c623cb7061c75bcf96298d2c64d", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b42ff20c560fb53982b3f77d3fed5c459a01b545/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b42ff20c560fb53982b3f77d3fed5c459a01b545/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=b42ff20c560fb53982b3f77d3fed5c459a01b545", "patch": "@@ -1783,7 +1783,10 @@ impl<'a> Builder<'a> {\n             cargo.env(\"RUSTC_TLS_MODEL_INITIAL_EXEC\", \"1\");\n         }\n \n-        if self.config.incremental {\n+        // Ignore incremental modes except for stage0, since we're\n+        // not guaranteeing correctness across builds if the compiler\n+        // is changing under your feet.\n+        if self.config.incremental && compiler.stage == 0 {\n             cargo.env(\"CARGO_INCREMENTAL\", \"1\");\n         } else {\n             // Don't rely on any default setting for incr. comp. in Cargo"}]}