{"sha": "c842f02dee81e52f3b63a8b46021a8e18f143a7e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4NDJmMDJkZWU4MWU1MmYzYjYzYThiNDYwMjFhOGUxOGYxNDNhN2U=", "commit": {"author": {"name": "cad97", "email": "cad97@cad97.com", "date": "2019-12-15T22:59:09Z"}, "committer": {"name": "cad97", "email": "cad97@cad97.com", "date": "2019-12-16T00:57:18Z"}, "message": "Use pointer offset instead of deref for A/Rc::into_raw", "tree": {"sha": "c2f565bc500dc56739e35539291e704a1624a31c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2f565bc500dc56739e35539291e704a1624a31c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c842f02dee81e52f3b63a8b46021a8e18f143a7e", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEmUwn3EfMuUCMTZdmXaDxJC0iucgFAl321nEACgkQXaDxJC0i\nucg6Dwf9E3uOAvsusqOv/JYDmqheGvE3v36QMS9kr2FfV+oJLRFK1tWENTax9BTM\nBFJB16Osor31QN/eGw1wcBQMShlHWt2TR7V4E2kyVUMRETKz2PnelYe14YteTQFZ\neoQYSkj7KOLZKas38jnWqOMrRTA7GOvNsBnceVOzaGZKhmwcVNRyD0V3vUXZteBm\nc9b0Qs/oLCnxx6IOipYb3JMXY3XSRgPJE3hOFmO1+gorGIzoaKp2qUvnh/zTySEV\nqtdKeLDyMLq59pLM96IdTE61yc92hRFF91LkBqbD+A/QMPu7MrKQZCzyeBfk0De/\n+mGNok7lg7W96VmeBsjPf/PvbDQDTw==\n=t/Gb\n-----END PGP SIGNATURE-----", "payload": "tree c2f565bc500dc56739e35539291e704a1624a31c\nparent 7dbfb0a8ca4ab74ee3111e57a024f9e6257ce37c\nauthor cad97 <cad97@cad97.com> 1576450749 -0500\ncommitter cad97 <cad97@cad97.com> 1576457838 -0500\n\nUse pointer offset instead of deref for A/Rc::into_raw\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c842f02dee81e52f3b63a8b46021a8e18f143a7e", "html_url": "https://github.com/rust-lang/rust/commit/c842f02dee81e52f3b63a8b46021a8e18f143a7e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c842f02dee81e52f3b63a8b46021a8e18f143a7e/comments", "author": {"login": "CAD97", "id": 5992217, "node_id": "MDQ6VXNlcjU5OTIyMTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5992217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CAD97", "html_url": "https://github.com/CAD97", "followers_url": "https://api.github.com/users/CAD97/followers", "following_url": "https://api.github.com/users/CAD97/following{/other_user}", "gists_url": "https://api.github.com/users/CAD97/gists{/gist_id}", "starred_url": "https://api.github.com/users/CAD97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CAD97/subscriptions", "organizations_url": "https://api.github.com/users/CAD97/orgs", "repos_url": "https://api.github.com/users/CAD97/repos", "events_url": "https://api.github.com/users/CAD97/events{/privacy}", "received_events_url": "https://api.github.com/users/CAD97/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CAD97", "id": 5992217, "node_id": "MDQ6VXNlcjU5OTIyMTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5992217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CAD97", "html_url": "https://github.com/CAD97", "followers_url": "https://api.github.com/users/CAD97/followers", "following_url": "https://api.github.com/users/CAD97/following{/other_user}", "gists_url": "https://api.github.com/users/CAD97/gists{/gist_id}", "starred_url": "https://api.github.com/users/CAD97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CAD97/subscriptions", "organizations_url": "https://api.github.com/users/CAD97/orgs", "repos_url": "https://api.github.com/users/CAD97/repos", "events_url": "https://api.github.com/users/CAD97/events{/privacy}", "received_events_url": "https://api.github.com/users/CAD97/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7dbfb0a8ca4ab74ee3111e57a024f9e6257ce37c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7dbfb0a8ca4ab74ee3111e57a024f9e6257ce37c", "html_url": "https://github.com/rust-lang/rust/commit/7dbfb0a8ca4ab74ee3111e57a024f9e6257ce37c"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "0205c40829930e2cd34b77235629f85ce5e33a5b", "filename": "src/liballoc/rc.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c842f02dee81e52f3b63a8b46021a8e18f143a7e/src%2Fliballoc%2Frc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c842f02dee81e52f3b63a8b46021a8e18f143a7e/src%2Fliballoc%2Frc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Frc.rs?ref=c842f02dee81e52f3b63a8b46021a8e18f143a7e", "patch": "@@ -571,9 +571,14 @@ impl<T: ?Sized> Rc<T> {\n     /// ```\n     #[stable(feature = \"rc_raw\", since = \"1.17.0\")]\n     pub fn into_raw(this: Self) -> *const T {\n-        let ptr: *const T = &*this;\n+        let ptr: *mut RcBox<T> = NonNull::as_ptr(this.ptr);\n+        let fake_ptr = ptr as *mut T;\n         mem::forget(this);\n-        ptr\n+\n+        unsafe {\n+            let offset = data_offset(&(*ptr).value);\n+            set_data_ptr(fake_ptr, (ptr as *mut u8).offset(offset))\n+        }\n     }\n \n     /// Constructs an `Rc` from a raw pointer."}, {"sha": "de56cb300d38c1f4c5d471faf4e3c216552428ca", "filename": "src/liballoc/sync.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c842f02dee81e52f3b63a8b46021a8e18f143a7e/src%2Fliballoc%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c842f02dee81e52f3b63a8b46021a8e18f143a7e/src%2Fliballoc%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fsync.rs?ref=c842f02dee81e52f3b63a8b46021a8e18f143a7e", "patch": "@@ -551,9 +551,14 @@ impl<T: ?Sized> Arc<T> {\n     /// ```\n     #[stable(feature = \"rc_raw\", since = \"1.17.0\")]\n     pub fn into_raw(this: Self) -> *const T {\n-        let ptr: *const T = &*this;\n+        let ptr: *mut ArcInner<T> = NonNull::as_ptr(this.ptr);\n+        let fake_ptr = ptr as *mut T;\n         mem::forget(this);\n-        ptr\n+\n+        unsafe {\n+            let offset = data_offset(&(*ptr).data);\n+            set_data_ptr(fake_ptr, (ptr as *mut u8).offset(offset))\n+        }\n     }\n \n     /// Constructs an `Arc` from a raw pointer."}]}