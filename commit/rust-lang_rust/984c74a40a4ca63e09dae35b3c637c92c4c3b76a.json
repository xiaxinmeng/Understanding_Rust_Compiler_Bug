{"sha": "984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk4NGM3NGE0MGE0Y2E2M2UwOWRhZTM1YjNjNjM3YzkyYzRjM2I3NmE=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-11-12T13:22:16Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-12-03T17:18:32Z"}, "message": "Move cgu_reuse_tracker to librustc_session", "tree": {"sha": "67885bf4af13c7b2f5f9026dff21549df7b93c93", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/67885bf4af13c7b2f5f9026dff21549df7b93c93"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "html_url": "https://github.com/rust-lang/rust/commit/984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c761ec1ac9019aa73ccef3001ce7a90c369b429d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c761ec1ac9019aa73ccef3001ce7a90c369b429d", "html_url": "https://github.com/rust-lang/rust/commit/c761ec1ac9019aa73ccef3001ce7a90c369b429d"}], "stats": {"total": 22, "additions": 14, "deletions": 8}, "files": [{"sha": "7bdef057fd17801abd73fb4f4440b45e9968d140", "filename": "Cargo.lock", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -3205,6 +3205,7 @@ dependencies = [\n  \"rustc_fs_util\",\n  \"rustc_index\",\n  \"rustc_macros\",\n+ \"rustc_session\",\n  \"rustc_target\",\n  \"scoped-tls\",\n  \"serialize\",\n@@ -3518,6 +3519,7 @@ dependencies = [\n  \"rustc_fs_util\",\n  \"rustc_incremental\",\n  \"rustc_index\",\n+ \"rustc_session\",\n  \"rustc_target\",\n  \"serialize\",\n  \"syntax\",\n@@ -3634,6 +3636,7 @@ dependencies = [\n  \"rustc\",\n  \"rustc_data_structures\",\n  \"rustc_fs_util\",\n+ \"rustc_session\",\n  \"serialize\",\n  \"syntax\",\n  \"syntax_pos\",\n@@ -3890,7 +3893,6 @@ version = \"0.0.0\"\n dependencies = [\n  \"log\",\n  \"rustc_data_structures\",\n- \"libserialize\",\n  \"rustc_errors\",\n  \"serialize\",\n  \"syntax_pos\","}, {"sha": "a1321d50f28bb99bab97983b352781e41b0a916a", "filename": "src/librustc/dep_graph/mod.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc%2Fdep_graph%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc%2Fdep_graph%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fmod.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -5,7 +5,6 @@ mod prev;\n mod query;\n mod safe;\n mod serialized;\n-pub mod cgu_reuse_tracker;\n \n pub use self::dep_node::{DepNode, DepKind, DepConstructor, WorkProductId, RecoverKey, label_strs};\n pub use self::graph::{DepGraph, WorkProduct, DepNodeIndex, DepNodeColor, TaskDeps, hash_result};"}, {"sha": "fa32e666e89f7f60d5a790586e0d892359ba37d7", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -1,7 +1,7 @@\n pub use self::code_stats::{DataTypeKind, SizeKind, FieldInfo, VariantInfo};\n use self::code_stats::CodeStats;\n \n-use crate::dep_graph::cgu_reuse_tracker::CguReuseTracker;\n+use rustc_session::cgu_reuse_tracker::CguReuseTracker;\n use rustc_data_structures::fingerprint::Fingerprint;\n use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n "}, {"sha": "858dd59b26148f57159d59e90ca865b623872122", "filename": "src/librustc_codegen_llvm/back/lto.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -10,7 +10,7 @@ use rustc_codegen_ssa::back::lto::{SerializedModule, LtoModuleCodegen, ThinShare\n use rustc_codegen_ssa::traits::*;\n use errors::{FatalError, Handler};\n use rustc::dep_graph::WorkProduct;\n-use rustc::dep_graph::cgu_reuse_tracker::CguReuse;\n+use rustc_session::cgu_reuse_tracker::CguReuse;\n use rustc::hir::def_id::LOCAL_CRATE;\n use rustc::middle::exported_symbols::SymbolExportLevel;\n use rustc::session::config::{self, Lto};"}, {"sha": "2ff5872370fd10ccbe467b1859b38a672abc89b7", "filename": "src/librustc_codegen_llvm/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_llvm%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_llvm%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Flib.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -43,6 +43,7 @@ extern crate smallvec;\n extern crate syntax;\n extern crate syntax_pos;\n extern crate rustc_errors as errors;\n+extern crate rustc_session;\n \n use rustc_codegen_ssa::traits::*;\n use rustc_codegen_ssa::back::write::{CodegenContext, ModuleConfig, FatLTOInput};"}, {"sha": "53d3c51b5f8c096c17e943c98a429176ff349582", "filename": "src/librustc_codegen_ssa/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_ssa%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_ssa%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2FCargo.toml?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -32,3 +32,4 @@ rustc_incremental = { path = \"../librustc_incremental\" }\n rustc_index = { path = \"../librustc_index\" }\n rustc_target = { path = \"../librustc_target\" }\n rustc_error_codes = { path = \"../librustc_error_codes\" }\n+rustc_session = { path = \"../librustc_session\" }"}, {"sha": "283295cadfcc54bd6edc1fe0d0b95af48590d12b", "filename": "src/librustc_codegen_ssa/back/write.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -10,7 +10,7 @@ use crate::traits::*;\n use rustc_incremental::{copy_cgu_workproducts_to_incr_comp_cache_dir,\n                         in_incr_comp_dir, in_incr_comp_dir_sess};\n use rustc::dep_graph::{WorkProduct, WorkProductId, WorkProductFileKind};\n-use rustc::dep_graph::cgu_reuse_tracker::CguReuseTracker;\n+use rustc_session::cgu_reuse_tracker::CguReuseTracker;\n use rustc::middle::cstore::EncodedMetadata;\n use rustc::session::config::{self, OutputFilenames, OutputType, Passes, Lto,\n                              Sanitizer, SwitchWithOptPath};"}, {"sha": "04e9159ff9116760e2c8623d081b4ae57b21b869", "filename": "src/librustc_codegen_ssa/base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_ssa%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_codegen_ssa%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fbase.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -25,8 +25,8 @@ use crate::mir::operand::OperandValue;\n use crate::mir::place::PlaceRef;\n use crate::traits::*;\n \n-use rustc::dep_graph::cgu_reuse_tracker::CguReuse;\n use rustc::hir;\n+use rustc_session::cgu_reuse_tracker::CguReuse;\n use rustc::hir::def_id::{DefId, LOCAL_CRATE};\n use rustc::middle::cstore::EncodedMetadata;\n use rustc::middle::lang_items::StartFnLangItem;"}, {"sha": "8dac7263f4d2c1c2a8f7cb7d690d5773886915b5", "filename": "src/librustc_incremental/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_incremental%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_incremental%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2FCargo.toml?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -19,3 +19,4 @@ rustc_serialize = { path = \"../libserialize\", package = \"serialize\" }\n syntax = { path = \"../libsyntax\" }\n syntax_pos = { path = \"../libsyntax_pos\" }\n rustc_fs_util = { path = \"../librustc_fs_util\" }\n+rustc_session = { path = \"../librustc_session\" }"}, {"sha": "c2e3fa8f28d2f6449aa4e2b9acebe35ec3356b1b", "filename": "src/librustc_incremental/assert_module_sources.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_incremental%2Fassert_module_sources.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_incremental%2Fassert_module_sources.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fassert_module_sources.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -22,7 +22,7 @@\n //! was re-used.\n \n use rustc::hir::def_id::LOCAL_CRATE;\n-use rustc::dep_graph::cgu_reuse_tracker::*;\n+use rustc_session::cgu_reuse_tracker::*;\n use rustc::mir::mono::CodegenUnitNameBuilder;\n use rustc::ty::TyCtxt;\n use std::collections::BTreeSet;"}, {"sha": "193cf01dc74a9e9b36d52f65c5638916cebc5cae", "filename": "src/librustc_session/cgu_reuse_tracker.rs", "status": "renamed", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_session%2Fcgu_reuse_tracker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_session%2Fcgu_reuse_tracker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fcgu_reuse_tracker.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -5,6 +5,7 @@\n use rustc_data_structures::fx::FxHashMap;\n use std::sync::{Arc, Mutex};\n use syntax_pos::Span;\n+use log::debug;\n \n #[derive(Copy, Clone, Debug, PartialEq, PartialOrd)]\n pub enum CguReuse {\n@@ -93,7 +94,7 @@ impl CguReuseTracker {\n         }\n     }\n \n-    pub fn check_expected_reuse(&self, diag: &errors::Handler) {\n+    pub fn check_expected_reuse(&self, diag: &rustc_errors::Handler) {\n         if let Some(ref data) = self.data {\n             let data = data.lock().unwrap();\n ", "previous_filename": "src/librustc/dep_graph/cgu_reuse_tracker.rs"}, {"sha": "0125b2b0ff32617b424cc1b655ba73f8405fb0c8", "filename": "src/librustc_session/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_session%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984c74a40a4ca63e09dae35b3c637c92c4c3b76a/src%2Flibrustc_session%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Flib.rs?ref=984c74a40a4ca63e09dae35b3c637c92c4c3b76a", "patch": "@@ -0,0 +1 @@\n+pub mod cgu_reuse_tracker;"}]}