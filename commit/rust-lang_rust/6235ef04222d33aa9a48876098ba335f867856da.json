{"sha": "6235ef04222d33aa9a48876098ba335f867856da", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyMzVlZjA0MjIyZDMzYWE5YTQ4ODc2MDk4YmEzMzVmODY3ODU2ZGE=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-03-05T21:40:43Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-03-09T16:45:44Z"}, "message": "Add missing items in the sidebar for functions", "tree": {"sha": "8d296cb3d1270883eed5ef69ac56c3682abc20c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8d296cb3d1270883eed5ef69ac56c3682abc20c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6235ef04222d33aa9a48876098ba335f867856da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6235ef04222d33aa9a48876098ba335f867856da", "html_url": "https://github.com/rust-lang/rust/commit/6235ef04222d33aa9a48876098ba335f867856da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6235ef04222d33aa9a48876098ba335f867856da/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a628543891c94e0e9b7d1ac57dc7add832dcefea", "url": "https://api.github.com/repos/rust-lang/rust/commits/a628543891c94e0e9b7d1ac57dc7add832dcefea", "html_url": "https://github.com/rust-lang/rust/commit/a628543891c94e0e9b7d1ac57dc7add832dcefea"}], "stats": {"total": 126, "additions": 71, "deletions": 55}, "files": [{"sha": "96bba956c5d55449c65a086c039f35c113f93459", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 23, "deletions": 28, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/6235ef04222d33aa9a48876098ba335f867856da/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6235ef04222d33aa9a48876098ba335f867856da/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=6235ef04222d33aa9a48876098ba335f867856da", "patch": "@@ -3500,11 +3500,9 @@ impl<'a> fmt::Display for Sidebar<'a> {\n         let cx = self.cx;\n         let it = self.item;\n         let parentlen = cx.current.len() - if it.is_mod() {1} else {0};\n-        let mut should_close = false;\n \n         if it.is_struct() || it.is_trait() || it.is_primitive() || it.is_union()\n-            || it.is_enum() || it.is_mod() || it.is_typedef()\n-        {\n+            || it.is_enum() || it.is_mod() || it.is_typedef() {\n             write!(fmt, \"<p class='location'>\")?;\n             match it.inner {\n                 clean::StructItem(..) => write!(fmt, \"Struct \")?,\n@@ -3523,30 +3521,29 @@ impl<'a> fmt::Display for Sidebar<'a> {\n             }\n             write!(fmt, \"{}\", it.name.as_ref().unwrap())?;\n             write!(fmt, \"</p>\")?;\n+        }\n \n-            if it.is_crate() {\n-                if let Some(ref version) = cache().crate_version {\n-                    write!(fmt,\n-                           \"<div class='block version'>\\\n-                            <p>Version {}</p>\\\n-                            </div>\",\n-                           version)?;\n-                }\n+        if it.is_crate() {\n+            if let Some(ref version) = cache().crate_version {\n+                write!(fmt,\n+                       \"<div class='block version'>\\\n+                        <p>Version {}</p>\\\n+                        </div>\",\n+                       version)?;\n             }\n+        }\n \n-            write!(fmt, \"<div class=\\\"sidebar-elems\\\">\")?;\n-            should_close = true;\n-            match it.inner {\n-                clean::StructItem(ref s) => sidebar_struct(fmt, it, s)?,\n-                clean::TraitItem(ref t) => sidebar_trait(fmt, it, t)?,\n-                clean::PrimitiveItem(ref p) => sidebar_primitive(fmt, it, p)?,\n-                clean::UnionItem(ref u) => sidebar_union(fmt, it, u)?,\n-                clean::EnumItem(ref e) => sidebar_enum(fmt, it, e)?,\n-                clean::TypedefItem(ref t, _) => sidebar_typedef(fmt, it, t)?,\n-                clean::ModuleItem(ref m) => sidebar_module(fmt, it, &m.items)?,\n-                clean::ForeignTypeItem => sidebar_foreign_type(fmt, it)?,\n-                _ => (),\n-            }\n+        write!(fmt, \"<div class=\\\"sidebar-elems\\\">\")?;\n+        match it.inner {\n+            clean::StructItem(ref s) => sidebar_struct(fmt, it, s)?,\n+            clean::TraitItem(ref t) => sidebar_trait(fmt, it, t)?,\n+            clean::PrimitiveItem(ref p) => sidebar_primitive(fmt, it, p)?,\n+            clean::UnionItem(ref u) => sidebar_union(fmt, it, u)?,\n+            clean::EnumItem(ref e) => sidebar_enum(fmt, it, e)?,\n+            clean::TypedefItem(ref t, _) => sidebar_typedef(fmt, it, t)?,\n+            clean::ModuleItem(ref m) => sidebar_module(fmt, it, &m.items)?,\n+            clean::ForeignTypeItem => sidebar_foreign_type(fmt, it)?,\n+            _ => (),\n         }\n \n         // The sidebar is designed to display sibling functions, modules and\n@@ -3586,10 +3583,8 @@ impl<'a> fmt::Display for Sidebar<'a> {\n             write!(fmt, \"<script defer src=\\\"{path}sidebar-items.js\\\"></script>\",\n                    path = relpath)?;\n         }\n-        if should_close {\n-            // Closes sidebar-elems div.\n-            write!(fmt, \"</div>\")?;\n-        }\n+        // Closes sidebar-elems div.\n+        write!(fmt, \"</div>\")?;\n \n         Ok(())\n     }"}, {"sha": "3f74ffbbe0b160ab302af07df2f341642bd59de9", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 29, "deletions": 27, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/6235ef04222d33aa9a48876098ba335f867856da/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/6235ef04222d33aa9a48876098ba335f867856da/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=6235ef04222d33aa9a48876098ba335f867856da", "patch": "@@ -1457,36 +1457,38 @@\n         // Draw a convenient sidebar of known crates if we have a listing\n         if (rootPath === '../') {\n             var sidebar = document.getElementsByClassName('sidebar-elems')[0];\n-            var div = document.createElement('div');\n-            div.className = 'block crate';\n-            div.innerHTML = '<h3>Crates</h3>';\n-            var ul = document.createElement('ul');\n-            div.appendChild(ul);\n-\n-            var crates = [];\n-            for (var crate in rawSearchIndex) {\n-                if (!rawSearchIndex.hasOwnProperty(crate)) {\n-                    continue;\n+            if (sidebar) {\n+                var div = document.createElement('div');\n+                div.className = 'block crate';\n+                div.innerHTML = '<h3>Crates</h3>';\n+                var ul = document.createElement('ul');\n+                div.appendChild(ul);\n+\n+                var crates = [];\n+                for (var crate in rawSearchIndex) {\n+                    if (!rawSearchIndex.hasOwnProperty(crate)) {\n+                        continue;\n+                    }\n+                    crates.push(crate);\n                 }\n-                crates.push(crate);\n-            }\n-            crates.sort();\n-            for (var i = 0; i < crates.length; ++i) {\n-                var klass = 'crate';\n-                if (crates[i] === window.currentCrate) {\n-                    klass += ' current';\n+                crates.sort();\n+                for (var i = 0; i < crates.length; ++i) {\n+                    var klass = 'crate';\n+                    if (crates[i] === window.currentCrate) {\n+                        klass += ' current';\n+                    }\n+                    var link = document.createElement('a');\n+                    link.href = '../' + crates[i] + '/index.html';\n+                    link.title = rawSearchIndex[crates[i]].doc;\n+                    link.className = klass;\n+                    link.textContent = crates[i];\n+\n+                    var li = document.createElement('li');\n+                    li.appendChild(link);\n+                    ul.appendChild(li);\n                 }\n-                var link = document.createElement('a');\n-                link.href = '../' + crates[i] + '/index.html';\n-                link.title = rawSearchIndex[crates[i]].doc;\n-                link.className = klass;\n-                link.textContent = crates[i];\n-\n-                var li = document.createElement('li');\n-                li.appendChild(link);\n-                ul.appendChild(li);\n+                sidebar.appendChild(div);\n             }\n-            sidebar.appendChild(div);\n         }\n     }\n "}, {"sha": "4da277a204b71838d7edbf8819f696047bc0ec8b", "filename": "src/test/rustdoc/fn-sidebar.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/6235ef04222d33aa9a48876098ba335f867856da/src%2Ftest%2Frustdoc%2Ffn-sidebar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6235ef04222d33aa9a48876098ba335f867856da/src%2Ftest%2Frustdoc%2Ffn-sidebar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ffn-sidebar.rs?ref=6235ef04222d33aa9a48876098ba335f867856da", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_name = \"foo\"]\n+\n+// @has foo/fn.bar.html\n+// @has - '//*[@class=\"sidebar-elems\"]' ''\n+pub fn bar() {}\n+\n+// @has foo/constant.BAR.html\n+// @has - '//*[@class=\"sidebar-elems\"]' ''\n+pub const BAR: u32 = 0;"}]}