{"sha": "86b9d49cbe9fe4b97bbe120d3902f82af9f7993a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2YjlkNDljYmU5ZmU0Yjk3YmJlMTIwZDM5MDJmODJhZjlmNzk5M2E=", "commit": {"author": {"name": "Oliver Middleton", "email": "olliemail27@gmail.com", "date": "2020-01-06T23:57:02Z"}, "committer": {"name": "Oliver Middleton", "email": "olliemail27@gmail.com", "date": "2020-01-06T23:57:02Z"}, "message": "rustdoc: Remove more `#[doc(cfg(..))]` duplicates", "tree": {"sha": "5359e7e0e1ee3e23d6143ac494e5d3eac4f08afe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5359e7e0e1ee3e23d6143ac494e5d3eac4f08afe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a", "html_url": "https://github.com/rust-lang/rust/commit/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a/comments", "author": {"login": "ollie27", "id": 7189418, "node_id": "MDQ6VXNlcjcxODk0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7189418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ollie27", "html_url": "https://github.com/ollie27", "followers_url": "https://api.github.com/users/ollie27/followers", "following_url": "https://api.github.com/users/ollie27/following{/other_user}", "gists_url": "https://api.github.com/users/ollie27/gists{/gist_id}", "starred_url": "https://api.github.com/users/ollie27/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ollie27/subscriptions", "organizations_url": "https://api.github.com/users/ollie27/orgs", "repos_url": "https://api.github.com/users/ollie27/repos", "events_url": "https://api.github.com/users/ollie27/events{/privacy}", "received_events_url": "https://api.github.com/users/ollie27/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ollie27", "id": 7189418, "node_id": "MDQ6VXNlcjcxODk0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7189418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ollie27", "html_url": "https://github.com/ollie27", "followers_url": "https://api.github.com/users/ollie27/followers", "following_url": "https://api.github.com/users/ollie27/following{/other_user}", "gists_url": "https://api.github.com/users/ollie27/gists{/gist_id}", "starred_url": "https://api.github.com/users/ollie27/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ollie27/subscriptions", "organizations_url": "https://api.github.com/users/ollie27/orgs", "repos_url": "https://api.github.com/users/ollie27/repos", "events_url": "https://api.github.com/users/ollie27/events{/privacy}", "received_events_url": "https://api.github.com/users/ollie27/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd8377d37e9bc47f9a5a982c41705a7800cbb51d", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd8377d37e9bc47f9a5a982c41705a7800cbb51d", "html_url": "https://github.com/rust-lang/rust/commit/cd8377d37e9bc47f9a5a982c41705a7800cbb51d"}], "stats": {"total": 139, "additions": 120, "deletions": 19}, "files": [{"sha": "84e6ff648a38ff9d7652a05225a8ef980aac9c7d", "filename": "src/librustdoc/clean/cfg.rs", "status": "modified", "additions": 38, "deletions": 16, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a/src%2Flibrustdoc%2Fclean%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a/src%2Flibrustdoc%2Fclean%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fcfg.rs?ref=86b9d49cbe9fe4b97bbe120d3902f82af9f7993a", "patch": "@@ -202,23 +202,34 @@ impl ops::Not for Cfg {\n \n impl ops::BitAndAssign for Cfg {\n     fn bitand_assign(&mut self, other: Cfg) {\n-        if *self == other {\n-            return;\n-        }\n         match (self, other) {\n             (&mut Cfg::False, _) | (_, Cfg::True) => {}\n             (s, Cfg::False) => *s = Cfg::False,\n             (s @ &mut Cfg::True, b) => *s = b,\n-            (&mut Cfg::All(ref mut a), Cfg::All(ref mut b)) => a.append(b),\n-            (&mut Cfg::All(ref mut a), ref mut b) => a.push(mem::replace(b, Cfg::True)),\n+            (&mut Cfg::All(ref mut a), Cfg::All(ref mut b)) => {\n+                for c in b.drain(..) {\n+                    if !a.contains(&c) {\n+                        a.push(c);\n+                    }\n+                }\n+            }\n+            (&mut Cfg::All(ref mut a), ref mut b) => {\n+                if !a.contains(b) {\n+                    a.push(mem::replace(b, Cfg::True));\n+                }\n+            }\n             (s, Cfg::All(mut a)) => {\n                 let b = mem::replace(s, Cfg::True);\n-                a.push(b);\n+                if !a.contains(&b) {\n+                    a.push(b);\n+                }\n                 *s = Cfg::All(a);\n             }\n             (s, b) => {\n-                let a = mem::replace(s, Cfg::True);\n-                *s = Cfg::All(vec![a, b]);\n+                if *s != b {\n+                    let a = mem::replace(s, Cfg::True);\n+                    *s = Cfg::All(vec![a, b]);\n+                }\n             }\n         }\n     }\n@@ -234,23 +245,34 @@ impl ops::BitAnd for Cfg {\n \n impl ops::BitOrAssign for Cfg {\n     fn bitor_assign(&mut self, other: Cfg) {\n-        if *self == other {\n-            return;\n-        }\n         match (self, other) {\n             (&mut Cfg::True, _) | (_, Cfg::False) => {}\n             (s, Cfg::True) => *s = Cfg::True,\n             (s @ &mut Cfg::False, b) => *s = b,\n-            (&mut Cfg::Any(ref mut a), Cfg::Any(ref mut b)) => a.append(b),\n-            (&mut Cfg::Any(ref mut a), ref mut b) => a.push(mem::replace(b, Cfg::True)),\n+            (&mut Cfg::Any(ref mut a), Cfg::Any(ref mut b)) => {\n+                for c in b.drain(..) {\n+                    if !a.contains(&c) {\n+                        a.push(c);\n+                    }\n+                }\n+            }\n+            (&mut Cfg::Any(ref mut a), ref mut b) => {\n+                if !a.contains(b) {\n+                    a.push(mem::replace(b, Cfg::True));\n+                }\n+            }\n             (s, Cfg::Any(mut a)) => {\n                 let b = mem::replace(s, Cfg::True);\n-                a.push(b);\n+                if !a.contains(&b) {\n+                    a.push(b);\n+                }\n                 *s = Cfg::Any(a);\n             }\n             (s, b) => {\n-                let a = mem::replace(s, Cfg::True);\n-                *s = Cfg::Any(vec![a, b]);\n+                if *s != b {\n+                    let a = mem::replace(s, Cfg::True);\n+                    *s = Cfg::Any(vec![a, b]);\n+                }\n             }\n         }\n     }"}, {"sha": "d090bf325038f53def6469ba94aef723fa69bc40", "filename": "src/librustdoc/clean/cfg/tests.rs", "status": "modified", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a/src%2Flibrustdoc%2Fclean%2Fcfg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a/src%2Flibrustdoc%2Fclean%2Fcfg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fcfg%2Ftests.rs?ref=86b9d49cbe9fe4b97bbe120d3902f82af9f7993a", "patch": "@@ -87,6 +87,12 @@ fn test_cfg_and() {\n         x &= word_cfg(\"test3\");\n         assert_eq!(x, word_cfg(\"test3\"));\n \n+        x &= word_cfg(\"test3\");\n+        assert_eq!(x, word_cfg(\"test3\"));\n+\n+        x &= word_cfg(\"test4\");\n+        assert_eq!(x, Cfg::All(vec![word_cfg(\"test3\"), word_cfg(\"test4\")]));\n+\n         x &= word_cfg(\"test4\");\n         assert_eq!(x, Cfg::All(vec![word_cfg(\"test3\"), word_cfg(\"test4\")]));\n \n@@ -105,6 +111,18 @@ fn test_cfg_and() {\n             ])\n         );\n \n+        x &= Cfg::All(vec![word_cfg(\"test6\"), word_cfg(\"test7\")]);\n+        assert_eq!(\n+            x,\n+            Cfg::All(vec![\n+                word_cfg(\"test3\"),\n+                word_cfg(\"test4\"),\n+                word_cfg(\"test5\"),\n+                word_cfg(\"test6\"),\n+                word_cfg(\"test7\"),\n+            ])\n+        );\n+\n         let mut y = Cfg::Any(vec![word_cfg(\"a\"), word_cfg(\"b\")]);\n         y &= x;\n         assert_eq!(\n@@ -119,6 +137,14 @@ fn test_cfg_and() {\n             ])\n         );\n \n+        let mut z = word_cfg(\"test8\");\n+        z &= Cfg::All(vec![word_cfg(\"test9\"), word_cfg(\"test10\")]);\n+        assert_eq!(z, Cfg::All(vec![word_cfg(\"test9\"), word_cfg(\"test10\"), word_cfg(\"test8\")]));\n+\n+        let mut z = word_cfg(\"test11\");\n+        z &= Cfg::All(vec![word_cfg(\"test11\"), word_cfg(\"test12\")]);\n+        assert_eq!(z, Cfg::All(vec![word_cfg(\"test11\"), word_cfg(\"test12\")]));\n+\n         assert_eq!(\n             word_cfg(\"a\") & word_cfg(\"b\") & word_cfg(\"c\"),\n             Cfg::All(vec![word_cfg(\"a\"), word_cfg(\"b\"), word_cfg(\"c\")])\n@@ -145,6 +171,12 @@ fn test_cfg_or() {\n         x |= word_cfg(\"test3\");\n         assert_eq!(x, word_cfg(\"test3\"));\n \n+        x |= word_cfg(\"test3\");\n+        assert_eq!(x, word_cfg(\"test3\"));\n+\n+        x |= word_cfg(\"test4\");\n+        assert_eq!(x, Cfg::Any(vec![word_cfg(\"test3\"), word_cfg(\"test4\")]));\n+\n         x |= word_cfg(\"test4\");\n         assert_eq!(x, Cfg::Any(vec![word_cfg(\"test3\"), word_cfg(\"test4\")]));\n \n@@ -163,6 +195,18 @@ fn test_cfg_or() {\n             ])\n         );\n \n+        x |= Cfg::Any(vec![word_cfg(\"test6\"), word_cfg(\"test7\")]);\n+        assert_eq!(\n+            x,\n+            Cfg::Any(vec![\n+                word_cfg(\"test3\"),\n+                word_cfg(\"test4\"),\n+                word_cfg(\"test5\"),\n+                word_cfg(\"test6\"),\n+                word_cfg(\"test7\"),\n+            ])\n+        );\n+\n         let mut y = Cfg::All(vec![word_cfg(\"a\"), word_cfg(\"b\")]);\n         y |= x;\n         assert_eq!(\n@@ -177,6 +221,14 @@ fn test_cfg_or() {\n             ])\n         );\n \n+        let mut z = word_cfg(\"test8\");\n+        z |= Cfg::Any(vec![word_cfg(\"test9\"), word_cfg(\"test10\")]);\n+        assert_eq!(z, Cfg::Any(vec![word_cfg(\"test9\"), word_cfg(\"test10\"), word_cfg(\"test8\")]));\n+\n+        let mut z = word_cfg(\"test11\");\n+        z |= Cfg::Any(vec![word_cfg(\"test11\"), word_cfg(\"test12\")]);\n+        assert_eq!(z, Cfg::Any(vec![word_cfg(\"test11\"), word_cfg(\"test12\")]));\n+\n         assert_eq!(\n             word_cfg(\"a\") | word_cfg(\"b\") | word_cfg(\"c\"),\n             Cfg::Any(vec![word_cfg(\"a\"), word_cfg(\"b\"), word_cfg(\"c\")])"}, {"sha": "9ccc5d7882eb8d5e781d7bef316eeb20c3b386ba", "filename": "src/test/rustdoc/duplicate-cfg.rs", "status": "modified", "additions": 30, "deletions": 3, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a/src%2Ftest%2Frustdoc%2Fduplicate-cfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86b9d49cbe9fe4b97bbe120d3902f82af9f7993a/src%2Ftest%2Frustdoc%2Fduplicate-cfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fduplicate-cfg.rs?ref=86b9d49cbe9fe4b97bbe120d3902f82af9f7993a", "patch": "@@ -1,15 +1,42 @@\n+// ignore-tidy-linelength\n+\n #![crate_name = \"foo\"]\n #![feature(doc_cfg)]\n \n-// @has 'foo/index.html'\n-// @!has '-' '//*[@class=\"stab portability\"]' 'feature=\"sync\" and'\n-// @has '-' '//*[@class=\"stab portability\"]' 'feature=\"sync\"'\n+// @has 'foo/struct.Foo.html'\n+// @has '-' '//*[@class=\"stab portability\"]' 'This is supported on feature=\"sync\" only.'\n #[doc(cfg(feature = \"sync\"))]\n #[doc(cfg(feature = \"sync\"))]\n pub struct Foo;\n \n+// @has 'foo/bar/struct.Bar.html'\n+// @has '-' '//*[@class=\"stab portability\"]' 'This is supported on feature=\"sync\" only.'\n #[doc(cfg(feature = \"sync\"))]\n pub mod bar {\n     #[doc(cfg(feature = \"sync\"))]\n     pub struct Bar;\n }\n+\n+// @has 'foo/baz/struct.Baz.html'\n+// @has '-' '//*[@class=\"stab portability\"]' 'This is supported on feature=\"sync\" and feature=\"send\" only.'\n+#[doc(cfg(all(feature = \"sync\", feature = \"send\")))]\n+pub mod baz {\n+    #[doc(cfg(feature = \"sync\"))]\n+    pub struct Baz;\n+}\n+\n+// @has 'foo/qux/struct.Qux.html'\n+// @has '-' '//*[@class=\"stab portability\"]' 'This is supported on feature=\"sync\" and feature=\"send\" only.'\n+#[doc(cfg(feature = \"sync\"))]\n+pub mod qux {\n+    #[doc(cfg(all(feature = \"sync\", feature = \"send\")))]\n+    pub struct Qux;\n+}\n+\n+// @has 'foo/quux/struct.Quux.html'\n+// @has '-' '//*[@class=\"stab portability\"]' 'This is supported on feature=\"sync\" and feature=\"send\" and foo and bar only.'\n+#[doc(cfg(all(feature = \"sync\", feature = \"send\", foo)))]\n+pub mod quux {\n+    #[doc(cfg(all(feature = \"send\", feature = \"sync\", bar)))]\n+    pub struct Quux;\n+}"}]}