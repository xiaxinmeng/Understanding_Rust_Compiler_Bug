{"sha": "bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJmZjA2YWZiYzVlYjk4MGNiZmEyZmE0ZjM1ZTBjNDMxODI4ZDM0NzE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-10-08T19:36:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-10-08T19:36:11Z"}, "message": "Auto merge of #37027 - alexcrichton:less-deps-in-bootstrap, r=japaric\n\nrustbuild: Optimize build times slightly\n\nAs the entry point for building the Rust compiler, a good user experience hinges\non this compiling quickly to get to the meat of the problem. To that end use\n`#[cfg]`-specific dependencies to avoid building Windows crates on Unix and drop\nthe `regex` crate for now which was easily replacable with some string\nsearching.", "tree": {"sha": "2bf8c3f99b61f5bbd3085b20d8bf8ac046aa9a0b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2bf8c3f99b61f5bbd3085b20d8bf8ac046aa9a0b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "html_url": "https://github.com/rust-lang/rust/commit/bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4344f147aad2ae8ea9c955642f42c812173feb14", "url": "https://api.github.com/repos/rust-lang/rust/commits/4344f147aad2ae8ea9c955642f42c812173feb14", "html_url": "https://github.com/rust-lang/rust/commit/4344f147aad2ae8ea9c955642f42c812173feb14"}, {"sha": "d17f0b0dd79bbf0cdee8f4b80f91ab53ec5e4328", "url": "https://api.github.com/repos/rust-lang/rust/commits/d17f0b0dd79bbf0cdee8f4b80f91ab53ec5e4328", "html_url": "https://github.com/rust-lang/rust/commit/d17f0b0dd79bbf0cdee8f4b80f91ab53ec5e4328"}], "stats": {"total": 147, "additions": 32, "deletions": 115}, "files": [{"sha": "a32ba02457edf2008aa6a1b46c7d18623521f736", "filename": "src/Cargo.lock", "status": "modified", "additions": 3, "deletions": 67, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "patch": "@@ -6,14 +6,6 @@ dependencies = [\n  \"libc 0.0.0\",\n ]\n \n-[[package]]\n-name = \"aho-corasick\"\n-version = \"0.5.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"memchr 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"alloc\"\n version = \"0.0.0\"\n@@ -56,7 +48,6 @@ dependencies = [\n  \"libc 0.2.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"md5 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num_cpus 0.2.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"regex 0.1.73 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-serialize 0.3.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"toml 0.1.30 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -99,7 +90,7 @@ dependencies = [\n name = \"compiletest\"\n version = \"0.0.0\"\n dependencies = [\n- \"env_logger 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"env_logger 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serialize 0.0.0\",\n ]\n@@ -110,11 +101,10 @@ version = \"0.0.0\"\n \n [[package]]\n name = \"env_logger\"\n-version = \"0.3.4\"\n+version = \"0.3.5\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"log 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"regex 0.1.73 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -221,14 +211,6 @@ name = \"md5\"\n version = \"0.1.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n-[[package]]\n-name = \"memchr\"\n-version = \"0.1.11\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"libc 0.2.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"num_cpus\"\n version = \"0.2.13\"\n@@ -279,23 +261,6 @@ dependencies = [\n  \"core 0.0.0\",\n ]\n \n-[[package]]\n-name = \"regex\"\n-version = \"0.1.73\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"aho-corasick 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"memchr 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"regex-syntax 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"thread_local 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"utf8-ranges 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n-[[package]]\n-name = \"regex-syntax\"\n-version = \"0.3.4\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-\n [[package]]\n name = \"rustbook\"\n version = \"0.0.0\"\n@@ -720,23 +685,6 @@ dependencies = [\n  \"test 0.0.0\",\n ]\n \n-[[package]]\n-name = \"thread-id\"\n-version = \"2.0.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"kernel32-sys 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"libc 0.2.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n-[[package]]\n-name = \"thread_local\"\n-version = \"0.2.6\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"thread-id 2.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"tidy\"\n version = \"0.1.0\"\n@@ -771,11 +719,6 @@ dependencies = [\n  \"matches 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n-[[package]]\n-name = \"utf8-ranges\"\n-version = \"0.1.3\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-\n [[package]]\n name = \"winapi\"\n version = \"0.2.8\"\n@@ -787,9 +730,8 @@ version = \"0.1.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [metadata]\n-\"checksum aho-corasick 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2b3fb52b09c1710b961acb35390d514be82e4ac96a9969a8e38565a29b878dc9\"\n \"checksum cmake 0.1.17 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dfcf5bcece56ef953b8ea042509e9dcbdfe97820b7e20d86beb53df30ed94978\"\n-\"checksum env_logger 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"82dcb9ceed3868a03b335657b85a159736c961900f7e7747d3b0b97b9ccb5ccb\"\n+\"checksum env_logger 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"15abd780e45b3ea4f76b4e9a26ff4843258dd8a3eed2775a0e7368c2e7936c2f\"\n \"checksum filetime 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5363ab8e4139b8568a6237db5248646e5a8a2f89bd5ccb02092182b11fd3e922\"\n \"checksum gcc 0.3.35 (git+https://github.com/alexcrichton/gcc-rs)\" = \"<none>\"\n \"checksum gcc 0.3.35 (registry+https://github.com/rust-lang/crates.io-index)\" = \"91ecd03771effb0c968fd6950b37e89476a578aaf1c70297d8e92b6516ec3312\"\n@@ -800,17 +742,11 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum log 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ab83497bf8bf4ed2a74259c1c802351fcd67a65baa86394b6ba73c36f4838054\"\n \"checksum matches 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"15305656809ce5a4805b1ff2946892810992197ce1270ff79baded852187942e\"\n \"checksum md5 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a5539a8dee9b4ae308c9c406a379838b435a8f2c84cf9fedc6d5a576be9888db\"\n-\"checksum memchr 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d8b629fb514376c675b98c1421e80b151d3817ac42d7c667717d282761418d20\"\n \"checksum num_cpus 0.2.13 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cee7e88156f3f9e19bdd598f8d6c9db7bf4078f99f8381f43a55b09648d1a6e3\"\n-\"checksum regex 0.1.73 (registry+https://github.com/rust-lang/crates.io-index)\" = \"56b7ee9f764ecf412c6e2fff779bca4b22980517ae335a21aeaf4e32625a5df2\"\n-\"checksum regex-syntax 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"31040aad7470ad9d8c46302dcffba337bb4289ca5da2e3cd6e37b64109a85199\"\n \"checksum rustc-serialize 0.3.19 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6159e4e6e559c81bd706afe9c8fd68f547d3e851ce12e76b1de7914bab61691b\"\n-\"checksum thread-id 2.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a9539db560102d1cef46b8b78ce737ff0bb64e7e18d35b2a5688f7d097d0ff03\"\n-\"checksum thread_local 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"55dd963dbaeadc08aa7266bf7f91c3154a7805e32bb94b820b769d2ef3b4744d\"\n \"checksum toml 0.1.30 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0590d72182e50e879c4da3b11c6488dae18fccb1ae0c7a3eda18e16795844796\"\n \"checksum unicode-bidi 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c1f7ceb96afdfeedee42bade65a0d585a6a0106f681b6749c8ff4daa8df30b3f\"\n \"checksum unicode-normalization 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"26643a2f83bac55f1976fb716c10234485f9202dcd65cfbdf9da49867b271172\"\n \"checksum url 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"afe9ec54bc4db14bc8744b7fed060d785ac756791450959b2248443319d5b119\"\n-\"checksum utf8-ranges 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a1ca13c08c41c9c3e04224ed9ff80461d97e121589ff27c753a16cb10830ae0f\"\n \"checksum winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"167dc9d6949a9b857f3451275e911c3f44255842c1f7a76f33c55103a909087a\"\n \"checksum winapi-build 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2d315eee3b34aca4797b2da6b13ed88266e6d612562a0c46390af8299fc699bc\""}, {"sha": "c96690754387bad2db75660f9e36c3bd97754470", "filename": "src/bootstrap/Cargo.toml", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Fbootstrap%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Fbootstrap%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.toml?ref=bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "patch": "@@ -27,9 +27,10 @@ num_cpus = \"0.2\"\n toml = \"0.1\"\n getopts = \"0.2\"\n rustc-serialize = \"0.3\"\n-winapi = \"0.2\"\n-kernel32-sys = \"0.2\"\n gcc = { git = \"https://github.com/alexcrichton/gcc-rs\" }\n libc = \"0.2\"\n md5 = \"0.1\"\n-regex = \"0.1.73\"\n+\n+[target.'cfg(windows)'.dependencies]\n+winapi = \"0.2\"\n+kernel32-sys = \"0.2\""}, {"sha": "8676f5cc4a1ed3ff82fe62d8f426c6530db8b9ee", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 23, "deletions": 42, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "patch": "@@ -25,7 +25,6 @@ use std::process::Command;\n \n use {Build, Compiler};\n use util::{cp_r, libdir, is_dylib, cp_filtered, copy};\n-use regex::{RegexSet, quote};\n \n pub fn package_vers(build: &Build) -> &str {\n     match &build.config.channel[..] {\n@@ -315,49 +314,31 @@ pub fn rust_src(build: &Build) {\n         \"mk\"\n     ];\n \n-    // Exclude paths matching these wildcard expressions\n-    let excludes = [\n-        // exclude-vcs\n-        \"CVS\", \"RCS\", \"SCCS\", \".git\", \".gitignore\", \".gitmodules\", \".gitattributes\", \".cvsignore\",\n-        \".svn\", \".arch-ids\", \"{arch}\", \"=RELEASE-ID\", \"=meta-update\", \"=update\", \".bzr\",\n-        \".bzrignore\", \".bzrtags\", \".hg\", \".hgignore\", \".hgrags\", \"_darcs\",\n-        // extensions\n-        \"*~\", \"*.pyc\",\n-        // misc\n-        \"llvm/test/*/*.ll\",\n-        \"llvm/test/*/*.td\",\n-        \"llvm/test/*/*.s\",\n-        \"llvm/test/*/*/*.ll\",\n-        \"llvm/test/*/*/*.td\",\n-        \"llvm/test/*/*/*.s\"\n-    ];\n-\n-    // Construct a set of regexes for efficiently testing whether paths match one of the above\n-    // expressions.\n-    let regex_set = t!(RegexSet::new(\n-        // This converts a wildcard expression to a regex\n-        excludes.iter().map(|&s| {\n-            // Prefix ensures that matching starts on a path separator boundary\n-            r\"^(.*[\\\\/])?\".to_owned() + (\n-                // Escape the expression to produce a regex matching exactly that string\n-                &quote(s)\n-                // Replace slashes with a pattern matching either forward or backslash\n-                .replace(r\"/\", r\"[\\\\/]\")\n-                // Replace wildcards with a pattern matching a single path segment, ie. containing\n-                // no slashes.\n-                .replace(r\"\\*\", r\"[^\\\\/]*\")\n-            // Suffix anchors to the end of the path\n-            ) + \"$\"\n-        })\n-    ));\n-\n-    // Create a filter which skips files which match the regex set or contain invalid unicode\n     let filter_fn = move |path: &Path| {\n-        if let Some(path) = path.to_str() {\n-            !regex_set.is_match(path)\n-        } else {\n-            false\n+        let spath = match path.to_str() {\n+            Some(path) => path,\n+            None => return false,\n+        };\n+        if spath.ends_with(\"~\") || spath.ends_with(\".pyc\") {\n+            return false\n         }\n+        if spath.contains(\"llvm/test\") || spath.contains(\"llvm\\\\test\") {\n+            if spath.ends_with(\".ll\") ||\n+               spath.ends_with(\".td\") ||\n+               spath.ends_with(\".s\") {\n+                return false\n+            }\n+        }\n+\n+        let excludes = [\n+            \"CVS\", \"RCS\", \"SCCS\", \".git\", \".gitignore\", \".gitmodules\",\n+            \".gitattributes\", \".cvsignore\", \".svn\", \".arch-ids\", \"{arch}\",\n+            \"=RELEASE-ID\", \"=meta-update\", \"=update\", \".bzr\", \".bzrignore\",\n+            \".bzrtags\", \".hg\", \".hgignore\", \".hgrags\", \"_darcs\",\n+        ];\n+        !path.iter()\n+             .map(|s| s.to_str().unwrap())\n+             .any(|s| excludes.contains(&s))\n     };\n \n     // Copy the directories using our filter"}, {"sha": "12938b8326e79805de9c2e34d5471497c3b3b80d", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "patch": "@@ -26,7 +26,6 @@ extern crate md5;\n extern crate num_cpus;\n extern crate rustc_serialize;\n extern crate toml;\n-extern crate regex;\n \n use std::collections::HashMap;\n use std::env;"}, {"sha": "e05d57365f8754fa35e27a60fec27a533d64a3b2", "filename": "src/tools/compiletest/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Ftools%2Fcompiletest%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bff06afbc5eb980cbfa2fa4f35e0c431828d3471/src%2Ftools%2Fcompiletest%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2FCargo.toml?ref=bff06afbc5eb980cbfa2fa4f35e0c431828d3471", "patch": "@@ -12,5 +12,5 @@ opt-level = 2\n \n [dependencies]\n log = \"0.3\"\n-env_logger = \"0.3\"\n-serialize = { path = \"../../libserialize\" }\n\\ No newline at end of file\n+env_logger = { version = \"0.3.5\", default-features = false }\n+serialize = { path = \"../../libserialize\" }"}]}