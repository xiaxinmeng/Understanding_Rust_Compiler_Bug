{"sha": "56207b8fafac6f6697751084f0914e1dbc0381ce", "node_id": "C_kwDOAAsO6NoAKDU2MjA3YjhmYWZhYzZmNjY5Nzc1MTA4NGYwOTE0ZTFkYmMwMzgxY2U", "commit": {"author": {"name": "Tom Martin", "email": "tom.martin1239@gmail.com", "date": "2023-04-02T18:01:52Z"}, "committer": {"name": "Tom Martin", "email": "tom.martin1239@gmail.com", "date": "2023-04-02T18:01:52Z"}, "message": "Skip help messages if macro span is from macro", "tree": {"sha": "b24bc75a4eee793098e5c69fc3632b4067c17f97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b24bc75a4eee793098e5c69fc3632b4067c17f97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56207b8fafac6f6697751084f0914e1dbc0381ce", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE4EiFxdccn1fd6ae9c6cz+WKfWsUFAmQpw0AACgkQc6cz+WKf\nWsXNFQ/+M7MmxfP641uLv5yzP5GVUmiNZcwM8qBvXIoY5Rt3Nwqr7TsgNl0g4Bqj\n4kS/3AJaME+dJ2ZsRAY9OTw4Zfj+3bkVKf74lIJadAtyhbEnKokORBRtuxCLxDCa\nB7g2L07l3NDRTA1o/lcK40q+SB7jAZRpSGGci3RWp27W4EMJMVnTK1gzGm4w6Drk\nLvxkRZHfagrAS1r+JIdm+UFd2soIDLsicuyv9r8BeOy3pvrpXGY65aB5n3BZ1EUW\naT6h0MrJZofmOkxREmFtrGO25TGych/mYH/bANX4IXDwOgggO7nk7fCmlTzrXjrA\nglMH7fe++JtCHhhbWxxvQsj+zJ1iGoy20v+BxzwKnUOHu34Mu8vR2cqUdRJ8e2+G\nEpHRIR9uEe4DJazXZT6Vo7PZNSS79M+RsHodWh24L58Tme280cotJlrfAb/YWac9\nHHKkooVNUvs2JUAk9IKPthTbTYORbqr7jRSZputAxlR6K0vjlgigtR8NlKc4iNfE\nsDf+uyeb+Emsm44likhglnvJ1llP5P1kKGJBflMMgJgvsR9ZuhPsPWQBybPfyDpa\n9taTAQ+VY/ChRg9b1XHIMxWLpOp/rY05FaiFOOVqa7AVP86q+IjP69ah9y2PfCwj\ntegqYzYYtgNNY4CArhE5DiFKl2sryLUZam8wz5Yq20pBsuJpIHo=\n=Ca6h\n-----END PGP SIGNATURE-----", "payload": "tree b24bc75a4eee793098e5c69fc3632b4067c17f97\nparent 86230dcde6f68e049c0eb67e805d410fe0872422\nauthor Tom Martin <tom.martin1239@gmail.com> 1680458512 +0100\ncommitter Tom Martin <tom.martin1239@gmail.com> 1680458512 +0100\n\nSkip help messages if macro span is from macro\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56207b8fafac6f6697751084f0914e1dbc0381ce", "html_url": "https://github.com/rust-lang/rust/commit/56207b8fafac6f6697751084f0914e1dbc0381ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56207b8fafac6f6697751084f0914e1dbc0381ce/comments", "author": {"login": "NotStirred", "id": 16853282, "node_id": "MDQ6VXNlcjE2ODUzMjgy", "avatar_url": "https://avatars.githubusercontent.com/u/16853282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NotStirred", "html_url": "https://github.com/NotStirred", "followers_url": "https://api.github.com/users/NotStirred/followers", "following_url": "https://api.github.com/users/NotStirred/following{/other_user}", "gists_url": "https://api.github.com/users/NotStirred/gists{/gist_id}", "starred_url": "https://api.github.com/users/NotStirred/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NotStirred/subscriptions", "organizations_url": "https://api.github.com/users/NotStirred/orgs", "repos_url": "https://api.github.com/users/NotStirred/repos", "events_url": "https://api.github.com/users/NotStirred/events{/privacy}", "received_events_url": "https://api.github.com/users/NotStirred/received_events", "type": "User", "site_admin": false}, "committer": {"login": "NotStirred", "id": 16853282, "node_id": "MDQ6VXNlcjE2ODUzMjgy", "avatar_url": "https://avatars.githubusercontent.com/u/16853282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NotStirred", "html_url": "https://github.com/NotStirred", "followers_url": "https://api.github.com/users/NotStirred/followers", "following_url": "https://api.github.com/users/NotStirred/following{/other_user}", "gists_url": "https://api.github.com/users/NotStirred/gists{/gist_id}", "starred_url": "https://api.github.com/users/NotStirred/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NotStirred/subscriptions", "organizations_url": "https://api.github.com/users/NotStirred/orgs", "repos_url": "https://api.github.com/users/NotStirred/repos", "events_url": "https://api.github.com/users/NotStirred/events{/privacy}", "received_events_url": "https://api.github.com/users/NotStirred/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "86230dcde6f68e049c0eb67e805d410fe0872422", "url": "https://api.github.com/repos/rust-lang/rust/commits/86230dcde6f68e049c0eb67e805d410fe0872422", "html_url": "https://github.com/rust-lang/rust/commit/86230dcde6f68e049c0eb67e805d410fe0872422"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "b595dc068018b236ddf9e61e418d27f5d1dabd45", "filename": "compiler/rustc_resolve/src/macros.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/56207b8fafac6f6697751084f0914e1dbc0381ce/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56207b8fafac6f6697751084f0914e1dbc0381ce/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs?ref=56207b8fafac6f6697751084f0914e1dbc0381ce", "patch": "@@ -548,10 +548,12 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n \n             err.span_label(path.span, format!(\"not {} {}\", article, expected));\n \n-            if kind == MacroKind::Derive && ext.macro_kind() != MacroKind::Derive {\n+            if !path.span.from_expansion() {\n                 // Suggest moving the macro out of the derive() as the macro isn't Derive\n-                err.span_help(path.span, \"Remove from the surrounding `derive()`\");\n-                err.help(format!(\"Add as non-Derive macro\\n`#[{}]`\", path_str));\n+                if kind == MacroKind::Derive && ext.macro_kind() != MacroKind::Derive {\n+                    err.span_help(path.span, \"Remove from the surrounding `derive()`\");\n+                    err.help(format!(\"Add as non-Derive macro\\n`#[{}]`\", path_str));\n+                }\n             }\n \n             err.emit();"}]}