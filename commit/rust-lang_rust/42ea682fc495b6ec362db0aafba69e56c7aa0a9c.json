{"sha": "42ea682fc495b6ec362db0aafba69e56c7aa0a9c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyZWE2ODJmYzQ5NWI2ZWMzNjJkYjBhYWZiYTY5ZTU2YzdhYTBhOWM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-09T07:31:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-09T07:31:49Z"}, "message": "Auto merge of #32781 - michaelwoerister:dont-use-svh-in-debuginfo, r=alexcrichton\n\nUse crate name/disambiguator instead of SVH for debuginfo typeid.", "tree": {"sha": "7f95c90b4e3652ee29e7356b44a93ddce5abb2ec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f95c90b4e3652ee29e7356b44a93ddce5abb2ec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/42ea682fc495b6ec362db0aafba69e56c7aa0a9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/42ea682fc495b6ec362db0aafba69e56c7aa0a9c", "html_url": "https://github.com/rust-lang/rust/commit/42ea682fc495b6ec362db0aafba69e56c7aa0a9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/42ea682fc495b6ec362db0aafba69e56c7aa0a9c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c22302f53f77aa7be34b89bd8b8aafc1b0e673c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/c22302f53f77aa7be34b89bd8b8aafc1b0e673c3", "html_url": "https://github.com/rust-lang/rust/commit/c22302f53f77aa7be34b89bd8b8aafc1b0e673c3"}, {"sha": "e2921d510dca1def06896bf64afc4d80aa73c608", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2921d510dca1def06896bf64afc4d80aa73c608", "html_url": "https://github.com/rust-lang/rust/commit/e2921d510dca1def06896bf64afc4d80aa73c608"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "8471b6a274c266d5270fb8135a7c57c180d01054", "filename": "src/librustc_trans/debuginfo/metadata.rs", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/42ea682fc495b6ec362db0aafba69e56c7aa0a9c/src%2Flibrustc_trans%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42ea682fc495b6ec362db0aafba69e56c7aa0a9c/src%2Flibrustc_trans%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fdebuginfo%2Fmetadata.rs?ref=42ea682fc495b6ec362db0aafba69e56c7aa0a9c", "patch": "@@ -326,7 +326,7 @@ impl<'tcx> TypeMap<'tcx> {\n                                             output: &mut String) {\n             // First, find out the 'real' def_id of the type. Items inlined from\n             // other crates have to be mapped back to their source.\n-            let source_def_id = if let Some(node_id) = cx.tcx().map.as_local_node_id(def_id) {\n+            let def_id = if let Some(node_id) = cx.tcx().map.as_local_node_id(def_id) {\n                 match cx.external_srcs().borrow().get(&node_id).cloned() {\n                     Some(source_def_id) => {\n                         // The given def_id identifies the inlined copy of a\n@@ -339,19 +339,21 @@ impl<'tcx> TypeMap<'tcx> {\n                 def_id\n             };\n \n-            // Get the crate hash as first part of the identifier.\n-            let crate_hash = if source_def_id.is_local() {\n-                cx.link_meta().crate_hash.clone()\n+            // Get the crate name/disambiguator as first part of the identifier.\n+            let crate_name = if def_id.is_local() {\n+                cx.tcx().crate_name.clone()\n             } else {\n-                cx.sess().cstore.crate_hash(source_def_id.krate)\n+                cx.sess().cstore.original_crate_name(def_id.krate)\n             };\n+            let crate_disambiguator = cx.tcx().crate_disambiguator(def_id.krate);\n \n-            output.push_str(crate_hash.as_str());\n+            output.push_str(&crate_name[..]);\n             output.push_str(\"/\");\n+            output.push_str(&crate_disambiguator[..]);\n+            output.push_str(\"/\");\n+            // Add the def-index as the second part\n             output.push_str(&format!(\"{:x}\", def_id.index.as_usize()));\n \n-            // Maybe check that there is no self type here.\n-\n             let tps = substs.types.get_slice(subst::TypeSpace);\n             if !tps.is_empty() {\n                 output.push('<');"}]}