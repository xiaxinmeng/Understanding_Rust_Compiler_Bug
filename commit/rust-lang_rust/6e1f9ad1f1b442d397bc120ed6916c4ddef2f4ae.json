{"sha": "6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlMWY5YWQxZjFiNDQyZDM5N2JjMTIwZWQ2OTE2YzRkZGVmMmY0YWU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-12T03:27:08Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-12T03:45:18Z"}, "message": "rustc: Don't allow empty link_name when nolink attribute is present\n\nCloses #1326", "tree": {"sha": "fcbbd58ab4689d6e73502b86c5ba3c1b1f9e8a4d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fcbbd58ab4689d6e73502b86c5ba3c1b1f9e8a4d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "html_url": "https://github.com/rust-lang/rust/commit/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09869cd0560c47f13c9740c121eac1a051b34bf4", "url": "https://api.github.com/repos/rust-lang/rust/commits/09869cd0560c47f13c9740c121eac1a051b34bf4", "html_url": "https://github.com/rust-lang/rust/commit/09869cd0560c47f13c9740c121eac1a051b34bf4"}], "stats": {"total": 32, "additions": 19, "deletions": 13}, "files": [{"sha": "de7fe882aa13198b1dc826b0920c1eef6309c018", "filename": "src/comp/metadata/creader.rs", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Fcomp%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Fcomp%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fcreader.rs?ref=6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "patch": "@@ -57,17 +57,20 @@ fn visit_item(e: env, i: @ast::item) {\n         }\n \n         let cstore = e.sess.get_cstore();\n-        let native_name = i.ident;\n+        let native_name =\n+            alt attr::get_meta_item_value_str_by_name(i.attrs, \"link_name\") {\n+              some(nn) {\n+                if nn == \"\" {\n+                    e.sess.span_fatal(\n+                        i.span,\n+                        \"empty #[link_name] not allowed; use #[nolink].\");\n+                }\n+                nn\n+              }\n+              none. { i.ident }\n+            };\n         let already_added = false;\n         if vec::len(attr::find_attrs_by_name(i.attrs, \"nolink\")) == 0u {\n-            alt attr::get_meta_item_value_str_by_name(i.attrs, \"link_name\") {\n-              some(nn) { native_name = nn; }\n-              none. { }\n-            }\n-            if native_name == \"\" {\n-                e.sess.span_fatal(i.span,\n-                    \"empty #[link_name] not allowed; use #[nolink].\");\n-            }\n             already_added = !cstore::add_used_library(cstore, native_name);\n         }\n         let link_args = attr::find_attrs_by_name(i.attrs, \"link_args\");"}, {"sha": "596db37bea9aeebf75aaefd6553e960453f0f726", "filename": "src/libstd/freebsd_os.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Ffreebsd_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Ffreebsd_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ffreebsd_os.rs?ref=6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "patch": "@@ -24,7 +24,6 @@ export fsync_fd;\n // FIXME Somehow merge stuff duplicated here and macosx_os.rs. Made difficult\n // by https://github.com/graydon/rust/issues#issue/268\n \n-#[link_name = \"\"]               // FIXME remove after #[nolink] is snapshotted\n #[nolink]\n #[abi = \"cdecl\"]\n native mod libc {"}, {"sha": "965d8f1eaff85e08c8bb8b1f7f1dcd8d86e89432", "filename": "src/libstd/linux_os.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Flinux_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Flinux_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flinux_os.rs?ref=6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "patch": "@@ -24,7 +24,6 @@ export fsync_fd;\n // FIXME Somehow merge stuff duplicated here and macosx_os.rs. Made difficult\n // by https://github.com/graydon/rust/issues#issue/268\n \n-#[link_name = \"\"]               // FIXME remove after #[nolink] is snapshotted\n #[nolink]\n #[abi = \"cdecl\"]\n native mod libc {"}, {"sha": "9cca6fe77e180e157f5aceb7f54c00b913e813e0", "filename": "src/libstd/macos_os.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Fmacos_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Fmacos_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fmacos_os.rs?ref=6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "patch": "@@ -18,7 +18,6 @@ export fsync_fd;\n // FIXME Refactor into unix_os module or some such. Doesn't\n // seem to work right now.\n \n-#[link_name = \"\"] // FIXME: Remove after snapshotting\n #[nolink]\n #[abi = \"cdecl\"]\n native mod libc {"}, {"sha": "ff45648cdba6c187da210a37638aa72af76fb0c9", "filename": "src/libstd/win32_os.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Fwin32_os.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Flibstd%2Fwin32_os.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fwin32_os.rs?ref=6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "patch": "@@ -2,7 +2,6 @@ import core::option;\n import core::ctypes::*;\n \n #[abi = \"cdecl\"]\n-#[link_name = \"\"]               // FIXME remove after #[nolink] is snapshotted\n #[nolink]\n native mod libc {\n     fn read(fd: fd_t, buf: *u8, count: size_t) -> ssize_t;"}, {"sha": "567208f7897e6e4b80bb797bd021f55ec48b3248", "filename": "src/test/compile-fail/empty-linkname2.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Ftest%2Fcompile-fail%2Fempty-linkname2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae/src%2Ftest%2Fcompile-fail%2Fempty-linkname2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fempty-linkname2.rs?ref=6e1f9ad1f1b442d397bc120ed6916c4ddef2f4ae", "patch": "@@ -0,0 +1,7 @@\n+// error-pattern:empty #[link_name] not allowed; use #[nolink].\n+// Issue #1326\n+\n+#[link_name = \"\"]\n+#[nolink]\n+native mod foo {\n+}"}]}