{"sha": "f1e3a5a24be0429b046726f6f945595f5513f093", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxZTNhNWEyNGJlMDQyOWIwNDY3MjZmNmY5NDU1OTVmNTUxM2YwOTM=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-07-05T17:02:43Z"}, "committer": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-07-05T17:02:43Z"}, "message": "Only display difference of features, not all features", "tree": {"sha": "79fbdedcac02c921b316fde42e45e489ded03617", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/79fbdedcac02c921b316fde42e45e489ded03617"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1e3a5a24be0429b046726f6f945595f5513f093", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1e3a5a24be0429b046726f6f945595f5513f093", "html_url": "https://github.com/rust-lang/rust/commit/f1e3a5a24be0429b046726f6f945595f5513f093", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1e3a5a24be0429b046726f6f945595f5513f093/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "82a132874070bff23fa8b372dd4702ac738be9eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/82a132874070bff23fa8b372dd4702ac738be9eb", "html_url": "https://github.com/rust-lang/rust/commit/82a132874070bff23fa8b372dd4702ac738be9eb"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "ec904eb21344ad921f73f3bdf6bc6a3899ba32b9", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 22, "deletions": 4, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/f1e3a5a24be0429b046726f6f945595f5513f093/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1e3a5a24be0429b046726f6f945595f5513f093/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=f1e3a5a24be0429b046726f6f945595f5513f093", "patch": "@@ -13,6 +13,7 @@ use std::env;\n use std::iter;\n use std::path::PathBuf;\n use std::process::{Command, exit};\n+use std::collections::HashSet;\n \n use Mode;\n use Compiler;\n@@ -183,12 +184,29 @@ impl Step for ToolBuild {\n                       typically means that something was recompiled because \\\n                       a transitive dependency has different features activated \\\n                       than in a previous build:\\n\");\n+            println!(\"the following dependencies are duplicated although they \\\n+                      have the same features enabled:\");\n+            for (id, cur, prev) in &duplicates {\n+                println!(\"  {}\", id);\n+                if cur.2 == prev.2 {\n+                    // same features\n+                    println!(\"    `{}` ({:?})\\n    `{}` ({:?})\", cur.0, cur.1, prev.0, prev.1);\n+                }\n+            }\n+            println!(\"the following dependencies have different features:\");\n             for (id, cur, prev) in duplicates {\n                 println!(\"  {}\", id);\n-                println!(\"    `{}` enabled features {:?} at {:?}\",\n-                         cur.0, cur.2, cur.1);\n-                println!(\"    `{}` enabled features {:?} at {:?}\",\n-                         prev.0, prev.2, prev.1);\n+                if cur.2 == prev.2 {\n+                    continue;\n+                }\n+                let cur_features: HashSet<_> = cur.2.into_iter().collect();\n+                let prev_features: HashSet<_> = prev.2.into_iter().collect();\n+                let cur_extra: Vec<_> = cur_features.difference(&prev_features).collect();\n+                let prev_extra: Vec<_> = prev_features.difference(&cur_features).collect();\n+                println!(\"    `{}` additionally enabled features {:?} at {:?}\",\n+                         cur.0, cur_extra, cur.1);\n+                println!(\"    `{}` additionally enabled features {:?} at {:?}\",\n+                         prev.0, prev_extra, prev.1);\n             }\n             println!(\"\");\n             panic!(\"tools should not compile multiple copies of the same crate\");"}]}