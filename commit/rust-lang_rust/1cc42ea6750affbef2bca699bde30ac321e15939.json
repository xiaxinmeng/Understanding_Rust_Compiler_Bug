{"sha": "1cc42ea6750affbef2bca699bde30ac321e15939", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjYzQyZWE2NzUwYWZmYmVmMmJjYTY5OWJkZTMwYWMzMjFlMTU5Mzk=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-05-25T02:30:25Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-05-25T18:12:41Z"}, "message": "Add support for suggesting as_ref to Result accesses", "tree": {"sha": "8cb9303cd2ab5f669fcfee45293030b57ca8cabe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8cb9303cd2ab5f669fcfee45293030b57ca8cabe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1cc42ea6750affbef2bca699bde30ac321e15939", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1cc42ea6750affbef2bca699bde30ac321e15939", "html_url": "https://github.com/rust-lang/rust/commit/1cc42ea6750affbef2bca699bde30ac321e15939", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1cc42ea6750affbef2bca699bde30ac321e15939/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b0963653ef2479333d7b37843633fb5d5902f03", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b0963653ef2479333d7b37843633fb5d5902f03", "html_url": "https://github.com/rust-lang/rust/commit/4b0963653ef2479333d7b37843633fb5d5902f03"}], "stats": {"total": 57, "additions": 54, "deletions": 3}, "files": [{"sha": "f060e1931829e433b69aeab36d3dd27744e39e67", "filename": "src/librustc_mir/borrow_check/move_errors.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Flibrustc_mir%2Fborrow_check%2Fmove_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Flibrustc_mir%2Fborrow_check%2Fmove_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmove_errors.rs?ref=1cc42ea6750affbef2bca699bde30ac321e15939", "patch": "@@ -319,10 +319,16 @@ impl<'a, 'gcx, 'tcx> MirBorrowckCtxt<'a, 'gcx, 'tcx> {\n                         original_path.ty(self.mir, self.infcx.tcx).ty,\n                     );\n                     let snippet = self.infcx.tcx.sess.source_map().span_to_snippet(span).unwrap();\n-                    if orig_path_ty.starts_with(\"std::option::Option\") {\n+                    let is_option = orig_path_ty.starts_with(\"std::option::Option\");\n+                    let is_result = orig_path_ty.starts_with(\"std::result::Result\");\n+                    if  is_option || is_result {\n                         err.span_suggestion(\n                             span,\n-                            \"consider borrowing the `Option`'s content\",\n+                            &format!(\"consider borrowing the `{}`'s content\", if is_option {\n+                                \"Option\"\n+                            } else {\n+                                \"Result\"\n+                            }),\n                             format!(\"{}.as_ref()\", snippet),\n                             Applicability::MaybeIncorrect,\n                         );"}, {"sha": "f163cd104ffa53c4be0f740228c0e6faa0bb686c", "filename": "src/test/ui/suggestions/option-content-move.fixed", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.fixed?ref=1cc42ea6750affbef2bca699bde30ac321e15939", "patch": "@@ -18,4 +18,22 @@ impl LipogramCorpora {\n     }\n }\n \n+pub struct LipogramCorpora2 {\n+    selections: Vec<(char, Result<String, String>)>,\n+}\n+\n+impl LipogramCorpora2 {\n+    pub fn validate_all(&mut self) -> Result<(), char> {\n+        for selection in &self.selections {\n+            if selection.1.is_ok() {\n+                if selection.1.as_ref().unwrap().contains(selection.0) {\n+                //~^ ERROR cannot move out of borrowed content\n+                    return Err(selection.0);\n+                }\n+            }\n+        }\n+        Ok(())\n+    }\n+}\n+\n fn main() {}"}, {"sha": "350486a802d312217dc882c3653ba50f85bc339c", "filename": "src/test/ui/suggestions/option-content-move.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.rs?ref=1cc42ea6750affbef2bca699bde30ac321e15939", "patch": "@@ -18,4 +18,22 @@ impl LipogramCorpora {\n     }\n }\n \n+pub struct LipogramCorpora2 {\n+    selections: Vec<(char, Result<String, String>)>,\n+}\n+\n+impl LipogramCorpora2 {\n+    pub fn validate_all(&mut self) -> Result<(), char> {\n+        for selection in &self.selections {\n+            if selection.1.is_ok() {\n+                if selection.1.unwrap().contains(selection.0) {\n+                //~^ ERROR cannot move out of borrowed content\n+                    return Err(selection.0);\n+                }\n+            }\n+        }\n+        Ok(())\n+    }\n+}\n+\n fn main() {}"}, {"sha": "0a325ac54eaf10f23384f5f2692846376233c32a", "filename": "src/test/ui/suggestions/option-content-move.stderr", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1cc42ea6750affbef2bca699bde30ac321e15939/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Foption-content-move.stderr?ref=1cc42ea6750affbef2bca699bde30ac321e15939", "patch": "@@ -7,6 +7,15 @@ LL |                 if selection.1.unwrap().contains(selection.0) {\n    |                    cannot move out of borrowed content\n    |                    help: consider borrowing the `Option`'s content: `selection.1.as_ref()`\n \n-error: aborting due to previous error\n+error[E0507]: cannot move out of borrowed content\n+  --> $DIR/option-content-move.rs:29:20\n+   |\n+LL |                 if selection.1.unwrap().contains(selection.0) {\n+   |                    ^^^^^^^^^^^\n+   |                    |\n+   |                    cannot move out of borrowed content\n+   |                    help: consider borrowing the `Result`'s content: `selection.1.as_ref()`\n+\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0507`."}]}