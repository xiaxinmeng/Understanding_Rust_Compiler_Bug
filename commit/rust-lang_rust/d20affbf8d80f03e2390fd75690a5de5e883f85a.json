{"sha": "d20affbf8d80f03e2390fd75690a5de5e883f85a", "node_id": "C_kwDOAAsO6NoAKGQyMGFmZmJmOGQ4MGYwM2UyMzkwZmQ3NTY5MGE1ZGU1ZTg4M2Y4NWE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-01-10T10:03:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-10T10:03:05Z"}, "message": "Rollup merge of #92357 - GuillaumeGomez:fix-doc-comment-backline-removal, r=camelid\n\nFix invalid removal of newlines from doc comments\n\nFixes https://github.com/rust-lang/rust/issues/91201.\n\nBefore:\n\n![Screenshot from 2021-12-28 17-02-11](https://user-images.githubusercontent.com/3050060/147585187-c8e67531-c1b4-457d-9d30-d5b44bf91fea.png)\n\nAfter:\n\n![Screenshot from 2021-12-28 17-02-25](https://user-images.githubusercontent.com/3050060/147585190-30aa0398-1fc7-4fe7-9e8b-5c475d4f9613.png)\n\nr? `@camelid`", "tree": {"sha": "9a047ff4a7ec362e99334ddc4e74d0936eb78f9f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a047ff4a7ec362e99334ddc4e74d0936eb78f9f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d20affbf8d80f03e2390fd75690a5de5e883f85a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh3ARZCRBK7hj4Ov3rIwAAorgIAGYbKXaUUloKLTDEv+Uzwrn7\nqG9BXkc1P5MVrl3SswyKTeIkq5CgPnvx96xNmeSJvuM1nJKOMUgffmMXkBFP53Io\nJl4+kObPuz/VMSSmj5YpVKiprBJG0qPDX28uifALu1CPDTFfPBHqAfwYLxM76iDw\nAbh253Ze3MuGBIeOu58GAuv2pLrNmYvdFtiCDz+d7NnzeOG6/s9vIkND8bMrGSPo\nYPzfnbtScT4KW0tenN4hD5r+V+Rp5C2DcLjo58hd1/AGxUhCYZEfuUu1cgPxwBVb\nGx7mfH00X7wlzjmtv1+HaLJBMq0dyKo/sTRnMWgSitAvmVKpusr2e5FA1bxdM98=\n=qgf1\n-----END PGP SIGNATURE-----\n", "payload": "tree 9a047ff4a7ec362e99334ddc4e74d0936eb78f9f\nparent 6466f89fc5df36b4c841fca9d10e27c50dd744b5\nparent c6ee7bbe5197dbdec59acaab9b479f0610dfa5e1\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1641808985 +0100\ncommitter GitHub <noreply@github.com> 1641808985 +0100\n\nRollup merge of #92357 - GuillaumeGomez:fix-doc-comment-backline-removal, r=camelid\n\nFix invalid removal of newlines from doc comments\n\nFixes https://github.com/rust-lang/rust/issues/91201.\n\nBefore:\n\n![Screenshot from 2021-12-28 17-02-11](https://user-images.githubusercontent.com/3050060/147585187-c8e67531-c1b4-457d-9d30-d5b44bf91fea.png)\n\nAfter:\n\n![Screenshot from 2021-12-28 17-02-25](https://user-images.githubusercontent.com/3050060/147585190-30aa0398-1fc7-4fe7-9e8b-5c475d4f9613.png)\n\nr? `@camelid`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d20affbf8d80f03e2390fd75690a5de5e883f85a", "html_url": "https://github.com/rust-lang/rust/commit/d20affbf8d80f03e2390fd75690a5de5e883f85a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d20affbf8d80f03e2390fd75690a5de5e883f85a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6466f89fc5df36b4c841fca9d10e27c50dd744b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/6466f89fc5df36b4c841fca9d10e27c50dd744b5", "html_url": "https://github.com/rust-lang/rust/commit/6466f89fc5df36b4c841fca9d10e27c50dd744b5"}, {"sha": "c6ee7bbe5197dbdec59acaab9b479f0610dfa5e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6ee7bbe5197dbdec59acaab9b479f0610dfa5e1", "html_url": "https://github.com/rust-lang/rust/commit/c6ee7bbe5197dbdec59acaab9b479f0610dfa5e1"}], "stats": {"total": 21, "additions": 12, "deletions": 9}, "files": [{"sha": "0a391123dd381da28d81bc0be306ef6c74280014", "filename": "compiler/rustc_ast/src/util/comments.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d20affbf8d80f03e2390fd75690a5de5e883f85a/compiler%2Frustc_ast%2Fsrc%2Futil%2Fcomments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d20affbf8d80f03e2390fd75690a5de5e883f85a/compiler%2Frustc_ast%2Fsrc%2Futil%2Fcomments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Futil%2Fcomments.rs?ref=d20affbf8d80f03e2390fd75690a5de5e883f85a", "patch": "@@ -34,18 +34,11 @@ pub fn beautify_doc_string(data: Symbol) -> Symbol {\n             i += 1;\n         }\n \n-        while i < j && lines[i].trim().is_empty() {\n-            i += 1;\n-        }\n         // like the first, a last line of all stars should be omitted\n         if j > i && !lines[j - 1].is_empty() && lines[j - 1].chars().all(|c| c == '*') {\n             j -= 1;\n         }\n \n-        while j > i && lines[j - 1].trim().is_empty() {\n-            j -= 1;\n-        }\n-\n         if i != 0 || j != lines.len() { Some((i, j)) } else { None }\n     }\n "}, {"sha": "8ff114b993edbeb5cd285e76fbfc09c050137d96", "filename": "src/test/rustdoc/mixing-doc-comments-and-attrs.S1_top-doc.html", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d20affbf8d80f03e2390fd75690a5de5e883f85a/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.S1_top-doc.html", "raw_url": "https://github.com/rust-lang/rust/raw/d20affbf8d80f03e2390fd75690a5de5e883f85a/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.S1_top-doc.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.S1_top-doc.html?ref=d20affbf8d80f03e2390fd75690a5de5e883f85a", "patch": "@@ -1,4 +1,4 @@\n-<div class=\"docblock\"><p>Hello world!\n-Goodbye!\n+<div class=\"docblock\"><p>Hello world!</p>\n+<p>Goodbye!\n Hello again!</p>\n </div>\n\\ No newline at end of file"}, {"sha": "a4ee4b141863724123eb7fa733f2c8c46883c603", "filename": "src/test/rustdoc/mixing-doc-comments-and-attrs.S3_top-doc.html", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d20affbf8d80f03e2390fd75690a5de5e883f85a/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.S3_top-doc.html", "raw_url": "https://github.com/rust-lang/rust/raw/d20affbf8d80f03e2390fd75690a5de5e883f85a/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.S3_top-doc.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.S3_top-doc.html?ref=d20affbf8d80f03e2390fd75690a5de5e883f85a", "patch": "@@ -0,0 +1,3 @@\n+<div class=\"docblock\"><p>Par 1</p>\n+<p>Par 2</p>\n+</div>\n\\ No newline at end of file"}, {"sha": "a27c5ae6d0128c95d21a6f8dc791bfd8ca9542ad", "filename": "src/test/rustdoc/mixing-doc-comments-and-attrs.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d20affbf8d80f03e2390fd75690a5de5e883f85a/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d20affbf8d80f03e2390fd75690a5de5e883f85a/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fmixing-doc-comments-and-attrs.rs?ref=d20affbf8d80f03e2390fd75690a5de5e883f85a", "patch": "@@ -16,3 +16,10 @@ pub struct S1;\n #[doc = \"Goodbye!\"]\n /// Hello again!\n pub struct S2;\n+\n+// @has 'foo/struct.S3.html'\n+// @snapshot S3_top-doc - '//details[@class=\"rustdoc-toggle top-doc\"]/div[@class=\"docblock\"]'\n+/** Par 1\n+*/ ///\n+/// Par 2\n+pub struct S3;"}]}