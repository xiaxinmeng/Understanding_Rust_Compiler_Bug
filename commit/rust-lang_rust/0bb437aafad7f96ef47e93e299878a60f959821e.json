{"sha": "0bb437aafad7f96ef47e93e299878a60f959821e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiYjQzN2FhZmFkN2Y5NmVmNDdlOTNlMjk5ODc4YTYwZjk1OTgyMWU=", "commit": {"author": {"name": "auREAX", "email": "mark@xn--hwg34fba.ws", "date": "2012-10-04T01:46:32Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-10-04T18:56:24Z"}, "message": "Add GRSecurity compatibility with --enable-pax-marks configure flag; add GRSecurity autodetection code to configure.", "tree": {"sha": "35bfae664bf7b5243c5861a200347019d2113310", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/35bfae664bf7b5243c5861a200347019d2113310"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0bb437aafad7f96ef47e93e299878a60f959821e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0bb437aafad7f96ef47e93e299878a60f959821e", "html_url": "https://github.com/rust-lang/rust/commit/0bb437aafad7f96ef47e93e299878a60f959821e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0bb437aafad7f96ef47e93e299878a60f959821e/comments", "author": null, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5585514c02b1f7c7df2503e3e75814994ccdb8b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/5585514c02b1f7c7df2503e3e75814994ccdb8b7", "html_url": "https://github.com/rust-lang/rust/commit/5585514c02b1f7c7df2503e3e75814994ccdb8b7"}], "stats": {"total": 63, "additions": 63, "deletions": 0}, "files": [{"sha": "07e22bed8d6d0d6f5816a03ece9a2508d90b423e", "filename": "configure", "status": "modified", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/0bb437aafad7f96ef47e93e299878a60f959821e/configure", "raw_url": "https://github.com/rust-lang/rust/raw/0bb437aafad7f96ef47e93e299878a60f959821e/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=0bb437aafad7f96ef47e93e299878a60f959821e", "patch": "@@ -295,6 +295,7 @@ opt manage-submodules 1 \"let the build manage the git submodules\"\n opt mingw-cross 0 \"cross-compile for win32 using mingw\"\n opt clang 0 \"prefer clang to gcc for building the runtime\"\n opt local-rust 0 \"use an installed rustc rather than downloading a snapshot\"\n+opt pax-marks 0 \"apply PaX markings to rustc binaries (required for GRSecurity/PaX-patched kernels)\"\n valopt prefix \"/usr/local\" \"set installation prefix\"\n valopt local-rust-root \"/usr/local\" \"set prefix for local rust binary\"\n valopt llvm-root \"\" \"set LLVM root\"\n@@ -343,6 +344,8 @@ probe CFG_PDFLATEX         pdflatex\n probe CFG_XETEX            xetex\n probe CFG_LUATEX           luatex\n probe CFG_NODE             nodejs node\n+probe CFG_PAXCTL           paxctl /sbin/paxctl\n+probe CFG_ZCAT             zcat\n \n if [ ! -z \"$CFG_PANDOC\" ]\n then\n@@ -354,6 +357,52 @@ then\n     fi\n fi\n \n+if [ \"$CFG_OSTYPE\" = \"unknown-linux-gnu\" ]\n+then\n+    if [ ! -z \"$CFG_ENABLE_PAX_MARKS\" -a -z \"$CFG_PAXCTL\" ]\n+    then\n+        err \"enabled PaX markings but no paxctl binary found\"\n+    fi\n+\n+    if [ -z \"$CFG_DISABLE_PAX_MARKS\" ]\n+    then\n+        # GRSecurity/PaX detection. This can be very flaky.\n+        GRSEC_DETECTED=\n+\n+        # /dev/grsec only exists if CONFIG_GRKERNSEC_NO_RBAC is not set.\n+        # /proc is normally only available to root and users in the CONFIG_GRKERNSEC_PROC_GID group,\n+        # and /proc/sys/kernel/grsecurity is not available if \u00c7ONFIG_GRKERNSEC_SYSCTL is not set.\n+        if [ -e /dev/grsec -o -d /proc/sys/kernel/grsecurity ]\n+        then\n+            GRSEC_DETECTED=1\n+        # /proc/config.gz is normally only available to root, and only if CONFIG_IKCONFIG_PROC has been set.\n+        elif [ -r /proc/config.gz -a ! -z \"$CFG_ZCAT\" ]\n+        then\n+            if \"$CFG_ZCAT\" /proc/config.gz | grep --quiet \"CONFIG_GRKERNSEC=y\"\n+            then\n+                GRSEC_DETECTED=1\n+            fi\n+        # Flaky.\n+        elif grep --quiet grsec /proc/version\n+        then\n+            GRSEC_DETECTED=1\n+        fi\n+\n+        if [ ! -z \"$GRSEC_DETECTED\" ]\n+        then\n+            step_msg \"GRSecurity: yes\"\n+            if [ ! -z \"$CFG_PAXCTL\" ]\n+            then\n+                CFG_ENABLE_PAX_MARKS=1\n+            else\n+                warn \"GRSecurity kernel detected but no paxctl binary found: not setting CFG_ENABLE_PAX_MARKS\"\n+            fi\n+        else\n+            step_msg \"GRSecurity: no\"\n+        fi\n+    fi\n+fi\n+\n if [ ! -z \"$CFG_ENABLE_LOCAL_RUST\" ]\n then\n     if [ ! -f ${CFG_LOCAL_RUST_ROOT}/bin/rustc ]\n@@ -699,6 +748,12 @@ putvar CFG_C_COMPILER\n putvar CFG_LIBDIR\n putvar CFG_DISABLE_MANAGE_SUBMODULES\n \n+if [ ! -z \"$CFG_ENABLE_PAX_MARKS\" ]\n+then\n+    putvar CFG_ENABLE_PAX_MARKS\n+    putvar CFG_PAXCTL\n+fi\n+\n if [ ! -z $BAD_PANDOC ]\n then\n     CFG_PANDOC="}, {"sha": "fae6b3742f81580799b435e23de66ce2a3cbad48", "filename": "mk/stage0.mk", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0bb437aafad7f96ef47e93e299878a60f959821e/mk%2Fstage0.mk", "raw_url": "https://github.com/rust-lang/rust/raw/0bb437aafad7f96ef47e93e299878a60f959821e/mk%2Fstage0.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fstage0.mk?ref=0bb437aafad7f96ef47e93e299878a60f959821e", "patch": "@@ -12,6 +12,10 @@ ifdef CFG_ENABLE_LOCAL_RUST\n \t$(Q)$(S)src/etc/local_stage0.sh $(CFG_HOST_TRIPLE) $(CFG_LOCAL_RUST_ROOT)\n else \n \t$(Q)$(S)src/etc/get-snapshot.py $(CFG_HOST_TRIPLE) $(SNAPSHOT_FILE)\n+ifdef CFG_ENABLE_PAX_MARKS\n+\t@$(call E, apply PaX markings: $@)\n+\t@\"$(CFG_PAXCTL)\" -cm \"$@\"\n+endif\n endif \n \t$(Q)touch $@\n "}, {"sha": "458d2a4ac63bfb3eb0e9b7790d18f3359552d331", "filename": "mk/target.mk", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0bb437aafad7f96ef47e93e299878a60f959821e/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/0bb437aafad7f96ef47e93e299878a60f959821e/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=0bb437aafad7f96ef47e93e299878a60f959821e", "patch": "@@ -29,6 +29,10 @@ $$(TBIN$(1)_T_$(2)_H_$(3))/rustc$$(X):\t\t\t\t\\\n \t\t$$(TLIBRUSTC_DEFAULT$(1)_T_$(2)_H_$(3))\n \t@$$(call E, compile_and_link: $$@)\n \t$$(STAGE$(1)_T_$(2)_H_$(3)) -o $$@ $$<\n+ifdef CFG_ENABLE_PAX_MARKS\n+\t@$$(call E, apply PaX markings: $$@)\n+\t@\"$(CFG_PAXCTL)\" -cm \"$$@\"\n+endif\n \n $$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_LIBRUSTC):\t\t\\\n \t\t$$(COMPILER_CRATE) $$(COMPILER_INPUTS)\t\t\\"}]}