{"sha": "e2ab98df085d4f2703f0a4beab4c6432c353f7fa", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUyYWI5OGRmMDg1ZDRmMjcwM2YwYTRiZWFiNGM2NDMyYzM1M2Y3ZmE=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-06-22T17:29:04Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-06-22T17:29:39Z"}, "message": "Stop using old version of `syn` in `rustc-workspace-hack`\n\nNone of the tools seem to need syn 0.15.35, so we can just build syn\n1.0.\n\nThis was causing an issue with clippy's `compile-test` program: since\nmultiple versions of `syn` would exist in the build directory, we would\nnon-deterministically pick one based on filesystem iteration order. If\nthe pre-1.0 version of `syn` was picked, a strange build error would\noccur (see\nhttps://github.com/rust-lang/rust/pull/73594#issuecomment-647671463)\n\nTo prevent this kind of issue from happening again, we now panic if we\nfind multiple versions of a crate in the build directly, instead of\nsilently picking the first version we find.", "tree": {"sha": "b4dbee3b6bb7a2bdbd861fb3add5f57fa8165488", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4dbee3b6bb7a2bdbd861fb3add5f57fa8165488"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e2ab98df085d4f2703f0a4beab4c6432c353f7fa", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl7w6yEACgkQtAh+UQ6Y\nsWR4rg/8D6rdpHFhNK7em+w0YR6kvoIvFFLPVcWhmQNa2lyhnjLs9ThtqYyrP2Kd\ncaThw/YdAR8Z0efuCDU7eSkC4TPQyxdAev3ttv8Q0LV7Y++9WLhUTuIfjseTmRqk\nDXY3klAw9WYYh6O0rEseAR5kw7CoRGF3InUoVHfZrtiDq2k1r3kfCLd0xWQeKkrl\nhdEiUh44SdBRzvn3fnkw5NLMONFurCauS5dV8SQW3VvHkW+RAd/z25aoxHcr9Be7\neYRFELpleGYUFiHEgj99U4QRfA6kTWiqeA0nb6Oa1+ZH9kb5Dzm05Hr6y7bBplxF\nRO8+xO4CImF75zf+aLFl9vdmAL70icPLt3ht/F4kH6dMHjhsj7Mf54EaTvBvCz1m\nDRbp4NeIHQOVDshXiQ95WOmW/ppihXjGeqgt93PPX0hKkptIWpmq89a+MclanhDi\ngWcvuO8pj1T2sMeHirZWjQcr8oYoPc+aZvnKTB25rhlj3j78onqFMqBExM+avFpJ\nH7xHxcgJRkr2g46H2+Fpm1LsZCoDJEc6mK0w01X4aVwI4E7cQ1IRB1LOn2CpWQOT\nvWRErn3Uxw7ylp5YHfzib9J1UtwMwFqAHj0iOnb6N+G0nic206l2N1eHHTDPC7sA\nF7UdIQvt+Bs3E8qcCUlo6UBSr/TIKDVqY69q+BJ+NdXFzu+KY5A=\n=mST5\n-----END PGP SIGNATURE-----", "payload": "tree b4dbee3b6bb7a2bdbd861fb3add5f57fa8165488\nparent d3feb8baafc0ce1e1e04e237f1d059862e3173fb\nauthor Aaron Hill <aa1ronham@gmail.com> 1592846944 -0400\ncommitter Aaron Hill <aa1ronham@gmail.com> 1592846979 -0400\n\nStop using old version of `syn` in `rustc-workspace-hack`\n\nNone of the tools seem to need syn 0.15.35, so we can just build syn\n1.0.\n\nThis was causing an issue with clippy's `compile-test` program: since\nmultiple versions of `syn` would exist in the build directory, we would\nnon-deterministically pick one based on filesystem iteration order. If\nthe pre-1.0 version of `syn` was picked, a strange build error would\noccur (see\nhttps://github.com/rust-lang/rust/pull/73594#issuecomment-647671463)\n\nTo prevent this kind of issue from happening again, we now panic if we\nfind multiple versions of a crate in the build directly, instead of\nsilently picking the first version we find.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e2ab98df085d4f2703f0a4beab4c6432c353f7fa", "html_url": "https://github.com/rust-lang/rust/commit/e2ab98df085d4f2703f0a4beab4c6432c353f7fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e2ab98df085d4f2703f0a4beab4c6432c353f7fa/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3feb8baafc0ce1e1e04e237f1d059862e3173fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3feb8baafc0ce1e1e04e237f1d059862e3173fb", "html_url": "https://github.com/rust-lang/rust/commit/d3feb8baafc0ce1e1e04e237f1d059862e3173fb"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "9b406d4a1f61c83da062b183816797bd6fcdceeb", "filename": "Cargo.lock", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e2ab98df085d4f2703f0a4beab4c6432c353f7fa/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/e2ab98df085d4f2703f0a4beab4c6432c353f7fa/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=e2ab98df085d4f2703f0a4beab4c6432c353f7fa", "patch": "@@ -3532,7 +3532,6 @@ dependencies = [\n  \"serde_json\",\n  \"smallvec 0.6.10\",\n  \"smallvec 1.4.0\",\n- \"syn 0.15.35\",\n  \"syn 1.0.11\",\n  \"url 2.1.0\",\n  \"winapi 0.3.8\","}, {"sha": "368fa6a98c5d6fd7c11614a7a86846a21360c368", "filename": "src/tools/clippy/tests/compile-test.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e2ab98df085d4f2703f0a4beab4c6432c353f7fa/src%2Ftools%2Fclippy%2Ftests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e2ab98df085d4f2703f0a4beab4c6432c353f7fa/src%2Ftools%2Fclippy%2Ftests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fcompile-test.rs?ref=e2ab98df085d4f2703f0a4beab4c6432c353f7fa", "patch": "@@ -49,7 +49,9 @@ fn third_party_crates() -> String {\n         if let Some(name) = path.file_name().and_then(OsStr::to_str) {\n             for dep in CRATES {\n                 if name.starts_with(&format!(\"lib{}-\", dep)) && name.ends_with(\".rlib\") {\n-                    crates.entry(dep).or_insert(path);\n+                    if let Some(old) = crates.insert(dep, path.clone()) {\n+                        panic!(\"Found multiple rlibs for crate `{}`: `{:?}` and `{:?}\", dep, old, path);\n+                    }\n                     break;\n                 }\n             }"}, {"sha": "351e2d4481c0fafc2c98e08f476afa2cd6caef9b", "filename": "src/tools/rustc-workspace-hack/Cargo.toml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e2ab98df085d4f2703f0a4beab4c6432c353f7fa/src%2Ftools%2Frustc-workspace-hack%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e2ab98df085d4f2703f0a4beab4c6432c353f7fa/src%2Ftools%2Frustc-workspace-hack%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustc-workspace-hack%2FCargo.toml?ref=e2ab98df085d4f2703f0a4beab4c6432c353f7fa", "patch": "@@ -69,8 +69,7 @@ serde = { version = \"1.0.82\", features = ['derive'] }\n serde_json = { version = \"1.0.31\", features = [\"raw_value\"] }\n smallvec-0_6 = { package = \"smallvec\", version = \"0.6\", features = ['union', 'may_dangle'] }\n smallvec = { version = \"1.0\", features = ['union', 'may_dangle'] }\n-syn = { version = \"0.15\", features = ['full', 'extra-traits'] }\n-syn-1 = { package = \"syn\", version = \"1\", features = ['fold', 'full', 'extra-traits', 'visit'] }\n+syn = { version = \"1\", features = ['fold', 'full', 'extra-traits', 'visit'] }\n url = { version = \"2.0\", features = ['serde'] }\n \n [target.'cfg(not(windows))'.dependencies]"}]}