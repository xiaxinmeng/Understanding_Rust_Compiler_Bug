{"sha": "3954c70537cc78dc4a8e28c6ffa0a8ae5198387a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5NTRjNzA1MzdjYzc4ZGM0YThlMjhjNmZmYTBhOGFlNTE5ODM4N2E=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-02-21T04:36:46Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-02-21T04:36:46Z"}, "message": "Auto merge of #39990 - CryZe:emscripten-no-vectorization, r=alexcrichton\n\nTurn off Vectorization for Emscripten\n\nWhen targeting Emscripten, rustc emits Vector Instructions by default. However Web Assembly doesn't support Vector Instructions yet, which causes Binaryen to fail converting the intermediate asm.js code to Web Assembly. While asm.js kind of supports Vector Instructions, they aren't supported by any browser other than Firefox, often meaning that they need to be emulated very slowly. So it should just be turned off\nfor all Emscripten targets.\n\nFixes #38558", "tree": {"sha": "4bdbf803a3e02022aa24cef4c873df79a98a51a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bdbf803a3e02022aa24cef4c873df79a98a51a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3954c70537cc78dc4a8e28c6ffa0a8ae5198387a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3954c70537cc78dc4a8e28c6ffa0a8ae5198387a", "html_url": "https://github.com/rust-lang/rust/commit/3954c70537cc78dc4a8e28c6ffa0a8ae5198387a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3954c70537cc78dc4a8e28c6ffa0a8ae5198387a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a17e5e2949db53c9c1e3a697e41c254e31c0bdf3", "url": "https://api.github.com/repos/rust-lang/rust/commits/a17e5e2949db53c9c1e3a697e41c254e31c0bdf3", "html_url": "https://github.com/rust-lang/rust/commit/a17e5e2949db53c9c1e3a697e41c254e31c0bdf3"}, {"sha": "275e9bb51b61c685f39abb107d2eefb8b8e8515d", "url": "https://api.github.com/repos/rust-lang/rust/commits/275e9bb51b61c685f39abb107d2eefb8b8e8515d", "html_url": "https://github.com/rust-lang/rust/commit/275e9bb51b61c685f39abb107d2eefb8b8e8515d"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "40a69721495b8394ec797c0bb09d3f265a6600a9", "filename": "src/librustc_trans/back/write.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3954c70537cc78dc4a8e28c6ffa0a8ae5198387a/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3954c70537cc78dc4a8e28c6ffa0a8ae5198387a/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fwrite.rs?ref=3954c70537cc78dc4a8e28c6ffa0a8ae5198387a", "patch": "@@ -315,11 +315,15 @@ impl ModuleConfig {\n         // Copy what clang does by turning on loop vectorization at O2 and\n         // slp vectorization at O3. Otherwise configure other optimization aspects\n         // of this pass manager builder.\n+        // Turn off vectorization for emscripten, as it's not very well supported.\n         self.vectorize_loop = !sess.opts.cg.no_vectorize_loops &&\n                              (sess.opts.optimize == config::OptLevel::Default ||\n-                              sess.opts.optimize == config::OptLevel::Aggressive);\n+                              sess.opts.optimize == config::OptLevel::Aggressive) &&\n+                             !sess.target.target.options.is_like_emscripten;\n+\n         self.vectorize_slp = !sess.opts.cg.no_vectorize_slp &&\n-                            sess.opts.optimize == config::OptLevel::Aggressive;\n+                            sess.opts.optimize == config::OptLevel::Aggressive &&\n+                            !sess.target.target.options.is_like_emscripten;\n \n         self.merge_functions = sess.opts.optimize == config::OptLevel::Default ||\n                                sess.opts.optimize == config::OptLevel::Aggressive;"}]}