{"sha": "bbc534bcccfc1904104a1fa275a6a873a7675cd1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiYzUzNGJjY2NmYzE5MDQxMDRhMWZhMjc1YTZhODczYTc2NzVjZDE=", "commit": {"author": {"name": "Elly Jones", "email": "elly@leptoquark.net", "date": "2011-12-21T04:41:22Z"}, "committer": {"name": "Elly Jones", "email": "elly@leptoquark.net", "date": "2011-12-21T04:41:22Z"}, "message": "cargo: allow 'ref' package key for git packages.\n\nThis lets you specify e.g. a tag or a branch name to be checked out for that\npackage.\n\nSigned-off-by: Elly Jones <elly@leptoquark.net>", "tree": {"sha": "5fc882ec5eef7c3abfa21e6b3d927694abe19073", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5fc882ec5eef7c3abfa21e6b3d927694abe19073"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bbc534bcccfc1904104a1fa275a6a873a7675cd1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bbc534bcccfc1904104a1fa275a6a873a7675cd1", "html_url": "https://github.com/rust-lang/rust/commit/bbc534bcccfc1904104a1fa275a6a873a7675cd1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bbc534bcccfc1904104a1fa275a6a873a7675cd1/comments", "author": null, "committer": null, "parents": [{"sha": "200439406d828c58d5092ad5ebac9cc67adb3399", "url": "https://api.github.com/repos/rust-lang/rust/commits/200439406d828c58d5092ad5ebac9cc67adb3399", "html_url": "https://github.com/rust-lang/rust/commit/200439406d828c58d5092ad5ebac9cc67adb3399"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "99109f5d48968710bfe5c9a6a8063eeef5875db8", "filename": "src/cargo/cargo.rs", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/bbc534bcccfc1904104a1fa275a6a873a7675cd1/src%2Fcargo%2Fcargo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bbc534bcccfc1904104a1fa275a6a873a7675cd1/src%2Fcargo%2Fcargo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcargo%2Fcargo.rs?ref=bbc534bcccfc1904104a1fa275a6a873a7675cd1", "patch": "@@ -31,6 +31,7 @@ type package = {\n     uuid: str,\n     url: str,\n     method: str,\n+    ref: option::t<str>,\n     tags: [str]\n };\n \n@@ -242,6 +243,11 @@ fn load_one_source_package(&src: source, p: map::hashmap<str, json::json>) {\n         }\n     };\n \n+    let ref = alt p.find(\"ref\") {\n+        some(json::string(_n)) { some(_n) }\n+        _ { none }\n+    };\n+\n     let tags = [];\n     alt p.find(\"tags\") {\n         some(json::list(js)) {\n@@ -260,6 +266,7 @@ fn load_one_source_package(&src: source, p: map::hashmap<str, json::json>) {\n         uuid: uuid,\n         url: url,\n         method: method,\n+        ref: ref,\n         tags: tags\n     });\n     log \"  Loaded package: \" + src.name + \"/\" + name;\n@@ -398,8 +405,14 @@ fn install_source(c: cargo, path: str) {\n     }\n }\n \n-fn install_git(c: cargo, wd: str, url: str) {\n+fn install_git(c: cargo, wd: str, url: str, ref: option::t<str>) {\n     run::run_program(\"git\", [\"clone\", url, wd]);\n+    if option::is_some::<str>(ref) {\n+        let r = option::get::<str>(ref);\n+        fs::change_dir(wd);\n+        run::run_program(\"git\", [\"checkout\", r]);\n+    }\n+\n     install_source(c, wd);\n }\n \n@@ -424,7 +437,7 @@ fn install_file(c: cargo, wd: str, path: str) {\n fn install_package(c: cargo, wd: str, pkg: package) {\n     info(\"Installing with \" + pkg.method + \" from \" + pkg.url + \"...\");\n     if pkg.method == \"git\" {\n-        install_git(c, wd, pkg.url);\n+        install_git(c, wd, pkg.url, pkg.ref);\n     } else if pkg.method == \"http\" {\n         install_curl(c, wd, pkg.url);\n     } else if pkg.method == \"file\" {"}]}