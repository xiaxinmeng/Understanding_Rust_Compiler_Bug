{"sha": "5d2a410ff78247c418e28b69f7cad02bdd2168d6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVkMmE0MTBmZjc4MjQ3YzQxOGUyOGI2OWY3Y2FkMDJiZGQyMTY4ZDY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-09-04T20:44:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-09-04T20:44:41Z"}, "message": "Auto merge of #88364 - pietroalbini:llvm-install-filecheck, r=Mark-Simulacrum\n\nMake sure FileCheck is copied in the LLVM output directory\n\nThe tool, which is needed by parts of our test suite, is built as part of LLVM but is *not* copied to the directory containing the output LLVM binaries. This adds a flag to ensure the binary is copied. This shouldn't add any extra built time, as the flag just installs extra binaries that were already compiled.\n\nThis is not strictly needed for the test suite to work (as it also checks `build/$target/llvm/build/bin` for the binary), but it allows deleting the `build/$TARGET/llvm/build` directory (which also contains the intermediary build artifacts) without affecting the test suite, saving disk space.", "tree": {"sha": "4b2a7fe137a514da8f643e03ffe40c4234ea9158", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b2a7fe137a514da8f643e03ffe40c4234ea9158"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5d2a410ff78247c418e28b69f7cad02bdd2168d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5d2a410ff78247c418e28b69f7cad02bdd2168d6", "html_url": "https://github.com/rust-lang/rust/commit/5d2a410ff78247c418e28b69f7cad02bdd2168d6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5d2a410ff78247c418e28b69f7cad02bdd2168d6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b89e01cd8e831f4e831dd6dd9596488509fe1802", "url": "https://api.github.com/repos/rust-lang/rust/commits/b89e01cd8e831f4e831dd6dd9596488509fe1802", "html_url": "https://github.com/rust-lang/rust/commit/b89e01cd8e831f4e831dd6dd9596488509fe1802"}, {"sha": "9df630707efbb1fbd92e14f06b7d23ec947f3602", "url": "https://api.github.com/repos/rust-lang/rust/commits/9df630707efbb1fbd92e14f06b7d23ec947f3602", "html_url": "https://github.com/rust-lang/rust/commit/9df630707efbb1fbd92e14f06b7d23ec947f3602"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "0e306cb7211b5e9a186ed0b4d3871572469ba9c2", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5d2a410ff78247c418e28b69f7cad02bdd2168d6/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d2a410ff78247c418e28b69f7cad02bdd2168d6/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=5d2a410ff78247c418e28b69f7cad02bdd2168d6", "patch": "@@ -189,6 +189,11 @@ impl Step for Llvm {\n             .define(\"LLVM_TARGET_ARCH\", target_native.split('-').next().unwrap())\n             .define(\"LLVM_DEFAULT_TARGET_TRIPLE\", target_native);\n \n+        // Parts of our test suite rely on the `FileCheck` tool, which is built by default in\n+        // `build/$TARGET/llvm/build/bin` is but *not* then installed to `build/$TARGET/llvm/bin`.\n+        // This flag makes sure `FileCheck` is copied in the final binaries directory.\n+        cfg.define(\"LLVM_INSTALL_UTILS\", \"ON\");\n+\n         if builder.config.llvm_profile_generate {\n             cfg.define(\"LLVM_BUILD_INSTRUMENTED\", \"IR\");\n             cfg.define(\"LLVM_BUILD_RUNTIME\", \"No\");"}]}