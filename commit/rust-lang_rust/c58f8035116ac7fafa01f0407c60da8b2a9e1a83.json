{"sha": "c58f8035116ac7fafa01f0407c60da8b2a9e1a83", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1OGY4MDM1MTE2YWM3ZmFmYTAxZjA0MDdjNjBkYThiMmE5ZTFhODM=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-08-12T15:52:01Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-08-12T15:52:01Z"}, "message": "Merge branch 'pr-138'\n\nConflicts:\n\tsrc/lib.rs", "tree": {"sha": "931aff59bb07430f0dab0444f0127a0f9b4c0729", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/931aff59bb07430f0dab0444f0127a0f9b4c0729"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c58f8035116ac7fafa01f0407c60da8b2a9e1a83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c58f8035116ac7fafa01f0407c60da8b2a9e1a83", "html_url": "https://github.com/rust-lang/rust/commit/c58f8035116ac7fafa01f0407c60da8b2a9e1a83", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c58f8035116ac7fafa01f0407c60da8b2a9e1a83/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0263a6f052aecc16f3e71300fefef440b19d4115", "url": "https://api.github.com/repos/rust-lang/rust/commits/0263a6f052aecc16f3e71300fefef440b19d4115", "html_url": "https://github.com/rust-lang/rust/commit/0263a6f052aecc16f3e71300fefef440b19d4115"}, {"sha": "e8fed074cfd8623dfe070f86f0cc3040ac33b9b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/e8fed074cfd8623dfe070f86f0cc3040ac33b9b4", "html_url": "https://github.com/rust-lang/rust/commit/e8fed074cfd8623dfe070f86f0cc3040ac33b9b4"}], "stats": {"total": 51, "additions": 49, "deletions": 2}, "files": [{"sha": "a7ed0320da89879475ee18f92f79f8975d9b3412", "filename": "src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c58f8035116ac7fafa01f0407c60da8b2a9e1a83/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c58f8035116ac7fafa01f0407c60da8b2a9e1a83/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=c58f8035116ac7fafa01f0407c60da8b2a9e1a83", "patch": "@@ -58,6 +58,7 @@ pub fn plugin_registrar(reg: &mut Registry) {\n     reg.register_lint_pass(box strings::StringAdd as LintPassObject);\n     reg.register_lint_pass(box returns::ReturnPass as LintPassObject);\n     reg.register_lint_pass(box methods::MethodsPass as LintPassObject);\n+    reg.register_lint_pass(box types::LetPass as LintPassObject);\n \n     reg.register_lint_group(\"clippy\", vec![types::BOX_VEC, types::LINKEDLIST,\n                                            misc::SINGLE_MATCH,\n@@ -84,5 +85,6 @@ pub fn plugin_registrar(reg: &mut Registry) {\n                                            methods::RESULT_UNWRAP_USED,\n                                            methods::STR_TO_STRING,\n                                            methods::STRING_TO_STRING,\n+                                           types::LET_UNIT_VALUE,\n                                            ]);\n }"}, {"sha": "4980046e01b6d0c31cd1358d381d4e26b1e4a48b", "filename": "src/types.rs", "status": "modified", "additions": 34, "deletions": 2, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/c58f8035116ac7fafa01f0407c60da8b2a9e1a83/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c58f8035116ac7fafa01f0407c60da8b2a9e1a83/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=c58f8035116ac7fafa01f0407c60da8b2a9e1a83", "patch": "@@ -1,10 +1,11 @@\n use syntax::ptr::P;\n use syntax::ast;\n use syntax::ast::*;\n+use rustc::middle::ty;\n use rustc::lint::{Context, LintPass, LintArray, Lint, Level};\n-use syntax::codemap::Span;\n+use syntax::codemap::{ExpnInfo, Span};\n \n-use utils::{span_lint, span_help_and_lint};\n+use utils::{in_macro, snippet, span_lint, span_help_and_lint};\n \n /// Handles all the linting of funky types\n #[allow(missing_copy_implementations)]\n@@ -75,3 +76,34 @@ impl LintPass for TypePass {\n         }\n     }\n }\n+\n+#[allow(missing_copy_implementations)]\n+pub struct LetPass;\n+\n+declare_lint!(pub LET_UNIT_VALUE, Warn,\n+              \"Warn on let-binding a value of unit type\");\n+\n+\n+fn check_let_unit(cx: &Context, decl: &Decl, info: Option<&ExpnInfo>) {\n+    if in_macro(cx, info) { return; }\n+    if let DeclLocal(ref local) = decl.node {\n+        let bindtype = &cx.tcx.pat_ty(&*local.pat).sty;\n+        if *bindtype == ty::TyTuple(vec![]) {\n+            span_lint(cx, LET_UNIT_VALUE, decl.span, &format!(\n+                \"this let-binding has unit value. Consider omitting `let {} =`.\",\n+                snippet(cx, local.pat.span, \"..\")));\n+        }\n+    }\n+}\n+\n+impl LintPass for LetPass {\n+    fn get_lints(&self) -> LintArray {\n+        lint_array!(LET_UNIT_VALUE)\n+    }\n+\n+    fn check_decl(&mut self, cx: &Context, decl: &Decl) {\n+        cx.sess().codemap().with_expn_info(\n+            decl.span.expn_id,\n+            |info| check_let_unit(cx, decl, info));\n+    }\n+}"}, {"sha": "e8620f862a2f72481ac09f95baded9bae734244f", "filename": "tests/compile-fail/let_unit.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c58f8035116ac7fafa01f0407c60da8b2a9e1a83/tests%2Fcompile-fail%2Flet_unit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c58f8035116ac7fafa01f0407c60da8b2a9e1a83/tests%2Fcompile-fail%2Flet_unit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Flet_unit.rs?ref=c58f8035116ac7fafa01f0407c60da8b2a9e1a83", "patch": "@@ -0,0 +1,13 @@\n+#![feature(plugin)]\n+#![plugin(clippy)]\n+\n+#![deny(let_unit_value)]\n+\n+fn main() {\n+    let _x = println!(\"x\");  //~ERROR this let-binding has unit value\n+    let _y = 1;   // this is fine\n+    let _z = ((), 1);  // this as well\n+    if true {\n+        let _a = ();  //~ERROR\n+    }\n+}"}]}