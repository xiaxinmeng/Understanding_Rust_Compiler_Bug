{"sha": "533a5263279d177127607f1883b9a85824d5ef52", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzM2E1MjYzMjc5ZDE3NzEyNzYwN2YxODgzYjlhODU4MjRkNWVmNTI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-03-26T20:36:52Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-03-26T20:36:52Z"}, "message": "auto merge of #13152 : huonw/rust/wtf-are-things-in-spans, r=alexcrichton\n\nAdd some docs to ExpnInfo. Add a single overlooked `new_span` call to the folder (I'm pretty sure nothing reads this span, though, so it's probably pointless).", "tree": {"sha": "989c6a0211cbf2f3aa64194df383e6663d98c683", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/989c6a0211cbf2f3aa64194df383e6663d98c683"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/533a5263279d177127607f1883b9a85824d5ef52", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/533a5263279d177127607f1883b9a85824d5ef52", "html_url": "https://github.com/rust-lang/rust/commit/533a5263279d177127607f1883b9a85824d5ef52", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/533a5263279d177127607f1883b9a85824d5ef52/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c71cdf64bf39cb4d2bbc14c279eeda60e46d140", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c71cdf64bf39cb4d2bbc14c279eeda60e46d140", "html_url": "https://github.com/rust-lang/rust/commit/2c71cdf64bf39cb4d2bbc14c279eeda60e46d140"}, {"sha": "6419848e66e1a8dd73204711d4e589e4b7f341ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/6419848e66e1a8dd73204711d4e589e4b7f341ef", "html_url": "https://github.com/rust-lang/rust/commit/6419848e66e1a8dd73204711d4e589e4b7f341ef"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "4a9e53c63e7bf6ed7404e13269320deb371e37d9", "filename": "src/libsyntax/codemap.rs", "status": "modified", "additions": 26, "deletions": 3, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/533a5263279d177127607f1883b9a85824d5ef52/src%2Flibsyntax%2Fcodemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/533a5263279d177127607f1883b9a85824d5ef52/src%2Flibsyntax%2Fcodemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fcodemap.rs?ref=533a5263279d177127607f1883b9a85824d5ef52", "patch": "@@ -88,6 +88,8 @@ to the original source.\n pub struct Span {\n     lo: BytePos,\n     hi: BytePos,\n+    /// Information about where the macro came from, if this piece of\n+    /// code was created by a macro expansion.\n     expn_info: Option<@ExpnInfo>\n }\n \n@@ -162,26 +164,47 @@ pub struct LocWithOpt {\n pub struct FileMapAndLine {fm: Rc<FileMap>, line: uint}\n pub struct FileMapAndBytePos {fm: Rc<FileMap>, pos: BytePos}\n \n+/// The syntax with which a macro was invoked.\n #[deriving(Clone, Hash, Show)]\n pub enum MacroFormat {\n-    // e.g. #[deriving(...)] <item>\n+    /// e.g. #[deriving(...)] <item>\n     MacroAttribute,\n-    // e.g. `format!()`\n+    /// e.g. `format!()`\n     MacroBang\n }\n \n #[deriving(Clone, Hash, Show)]\n pub struct NameAndSpan {\n+    /// The name of the macro that was invoked to create the thing\n+    /// with this Span.\n     name: ~str,\n-    // the format with which the macro was invoked.\n+    /// The format with which the macro was invoked.\n     format: MacroFormat,\n+    /// The span of the macro definition itself. The macro may not\n+    /// have a sensible definition span (e.g. something defined\n+    /// completely inside libsyntax) in which case this is None.\n     span: Option<Span>\n }\n \n /// Extra information for tracking macro expansion of spans\n #[deriving(Hash, Show)]\n pub struct ExpnInfo {\n+    /// The location of the actual macro invocation, e.g. `let x =\n+    /// foo!();`\n+    ///\n+    /// This may recursively refer to other macro invocations, e.g. if\n+    /// `foo!()` invoked `bar!()` internally, and there was an\n+    /// expression inside `bar!`; the call_site of the expression in\n+    /// the expansion would point to the `bar!` invocation; that\n+    /// call_site span would have its own ExpnInfo, with the call_site\n+    /// pointing to the `foo!` invocation.\n     call_site: Span,\n+    /// Information about the macro and its definition.\n+    ///\n+    /// The `callee` of the inner expression in the `call_site`\n+    /// example would point to the `macro_rules! bar { ... }` and that\n+    /// of the `bar!()` invocation would point to the `macro_rules!\n+    /// foo { ... }`.\n     callee: NameAndSpan\n }\n "}, {"sha": "291502ff229b6e0d565e797bde395276330bb806", "filename": "src/libsyntax/fold.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/533a5263279d177127607f1883b9a85824d5ef52/src%2Flibsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/533a5263279d177127607f1883b9a85824d5ef52/src%2Flibsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffold.rs?ref=533a5263279d177127607f1883b9a85824d5ef52", "patch": "@@ -134,7 +134,7 @@ pub trait Folder {\n         node.move_iter().map(|node| {\n             @Spanned {\n                 node: node,\n-                span: d.span,\n+                span: self.new_span(d.span),\n             }\n         }).collect()\n     }"}]}