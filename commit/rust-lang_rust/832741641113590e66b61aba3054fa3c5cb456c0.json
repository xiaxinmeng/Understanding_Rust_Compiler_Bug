{"sha": "832741641113590e66b61aba3054fa3c5cb456c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzMjc0MTY0MTExMzU5MGU2NmI2MWFiYTMwNTRmYTNjNWNiNDU2YzA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-19T05:39:03Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-19T17:16:38Z"}, "message": "Teach the pretty-printer to disambiguate 'if ret { }' et. al", "tree": {"sha": "d47a79f12b61cab252db968dbbf7ca0a44ba84cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d47a79f12b61cab252db968dbbf7ca0a44ba84cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/832741641113590e66b61aba3054fa3c5cb456c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/832741641113590e66b61aba3054fa3c5cb456c0", "html_url": "https://github.com/rust-lang/rust/commit/832741641113590e66b61aba3054fa3c5cb456c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/832741641113590e66b61aba3054fa3c5cb456c0/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "664b0ad3fcead4fe4d22c05065a82a338770c429", "url": "https://api.github.com/repos/rust-lang/rust/commits/664b0ad3fcead4fe4d22c05065a82a338770c429", "html_url": "https://github.com/rust-lang/rust/commit/664b0ad3fcead4fe4d22c05065a82a338770c429"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "e9c1dee1f5441421cd7cdad143013fa634104583", "filename": "src/comp/syntax/print/pprust.rs", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/832741641113590e66b61aba3054fa3c5cb456c0/src%2Fcomp%2Fsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/832741641113590e66b61aba3054fa3c5cb456c0/src%2Fcomp%2Fsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fprint%2Fpprust.rs?ref=832741641113590e66b61aba3054fa3c5cb456c0", "patch": "@@ -703,11 +703,23 @@ fn print_possibly_embedded_block(s: &ps, blk: &ast::blk, embedded: embed_type,\n     }\n }\n \n+// ret and fail, without arguments cannot appear is the discriminant of if,\n+// alt, do, & while unambiguously without being parenthesized\n+fn print_maybe_parens_discrim(s: &ps, e: &@ast::expr) {\n+    let disambig = alt e.node {\n+      ast::expr_ret(option::none.) { true }\n+      _ { false }\n+    };\n+    if disambig { popen(s) }\n+    print_expr(s, e);\n+    if disambig { pclose(s) }\n+}\n+\n fn print_if(s: &ps, test: &@ast::expr, blk: &ast::blk,\n             elseopt: &option::t<@ast::expr>, chk: bool) {\n     head(s, \"if\");\n     if chk { word_nbsp(s, \"check\"); }\n-    print_expr(s, test);\n+    print_maybe_parens_discrim(s, test);\n     space(s.s);\n     print_block(s, blk);\n     fn do_else(s: &ps, els: option::t<@ast::expr>) {\n@@ -869,7 +881,7 @@ fn print_expr(s: &ps, expr: &@ast::expr) {\n       }\n       ast::expr_while(test, blk) {\n         head(s, \"while\");\n-        print_expr(s, test);\n+        print_maybe_parens_discrim(s, test);\n         space(s.s);\n         print_block(s, blk);\n       }\n@@ -897,7 +909,7 @@ fn print_expr(s: &ps, expr: &@ast::expr) {\n         cbox(s, alt_indent_unit);\n         ibox(s, 4u);\n         word_nbsp(s, \"alt\");\n-        print_expr(s, expr);\n+        print_maybe_parens_discrim(s, expr);\n         space(s.s);\n         bopen(s);\n         for arm: ast::arm in arms {"}, {"sha": "3dc897683fc0962a03d35809736b63564d0a7afe", "filename": "src/test/run-pass/if-ret.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/832741641113590e66b61aba3054fa3c5cb456c0/src%2Ftest%2Frun-pass%2Fif-ret.rs", "raw_url": "https://github.com/rust-lang/rust/raw/832741641113590e66b61aba3054fa3c5cb456c0/src%2Ftest%2Frun-pass%2Fif-ret.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fif-ret.rs?ref=832741641113590e66b61aba3054fa3c5cb456c0", "patch": "@@ -1,4 +1,3 @@\n-// xfail-pretty\n fn foo() { if (ret) { } }\n \n fn main() { foo(); }\n\\ No newline at end of file"}]}