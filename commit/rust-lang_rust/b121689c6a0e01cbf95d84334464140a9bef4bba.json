{"sha": "b121689c6a0e01cbf95d84334464140a9bef4bba", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxMjE2ODljNmEwZTAxY2JmOTVkODQzMzQ0NjQxNDBhOWJlZjRiYmE=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-07-29T03:30:37Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-07-29T20:44:28Z"}, "message": "Flag docker invocations as --privileged on CI\n\nWhen upgrading to LLVM 5.0 it was found that the leak sanitizer tests were\nfailing with fatal errors, but they were passing locally when run. Turns out it\nlooks like they may be using new ptrace-like syscalls so the docker container\nnow needs `--privileged` when executing to complete the test.", "tree": {"sha": "eaa44334ebd732df9b312ff95910fadd348bd26a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eaa44334ebd732df9b312ff95910fadd348bd26a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b121689c6a0e01cbf95d84334464140a9bef4bba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b121689c6a0e01cbf95d84334464140a9bef4bba", "html_url": "https://github.com/rust-lang/rust/commit/b121689c6a0e01cbf95d84334464140a9bef4bba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b121689c6a0e01cbf95d84334464140a9bef4bba/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "126321e2e505ea07887134ffe63afc759a8b7e9f", "url": "https://api.github.com/repos/rust-lang/rust/commits/126321e2e505ea07887134ffe63afc759a8b7e9f", "html_url": "https://github.com/rust-lang/rust/commit/126321e2e505ea07887134ffe63afc759a8b7e9f"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "d3f339bc15f75c0c8ba7f70a621a7d21a49e3e84", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b121689c6a0e01cbf95d84334464140a9bef4bba/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b121689c6a0e01cbf95d84334464140a9bef4bba/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=b121689c6a0e01cbf95d84334464140a9bef4bba", "patch": "@@ -67,6 +67,13 @@ else\n     args=\"$args --env SCCACHE_DIR=/sccache --volume $HOME/.cache/sccache:/sccache\"\n fi\n \n+# Run containers as privileged as it should give them access to some more\n+# syscalls such as ptrace and whatnot. In the upgrade to LLVM 5.0 it was\n+# discovered that the leak sanitizer apparently needs these syscalls nowadays so\n+# we'll need `--privileged` for at least the `x86_64-gnu` builder, so this just\n+# goes ahead and sets it for all builders.\n+args=\"$args --privileged\"\n+\n exec docker \\\n   run \\\n   --volume \"$root_dir:/checkout:ro\" \\"}]}