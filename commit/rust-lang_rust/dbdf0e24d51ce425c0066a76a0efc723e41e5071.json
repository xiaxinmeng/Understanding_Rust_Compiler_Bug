{"sha": "dbdf0e24d51ce425c0066a76a0efc723e41e5071", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiZGYwZTI0ZDUxY2U0MjVjMDA2NmE3NmEwZWZjNzIzZTQxZTUwNzE=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-09-28T15:59:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-28T15:59:28Z"}, "message": "Merge #1931\n\n1931: Support the new deprecated tag r=matklad a=arsdragonfly\n\nWhich is rendered as a strike-through line. Fixes #1671 .\r\n![\u6df1\u5ea6\u622a\u56fe_\u9009\u62e9\u533a\u57df_20190927162008](https://user-images.githubusercontent.com/4067473/65799714-ccb4c180-e142-11e9-8e45-ab18964605f3.png)\r\n\n\nCo-authored-by: arsdragonfly <arsdragonfly@gmail.com>", "tree": {"sha": "2b91ba59edc252a7961f044caad94b192d49ce78", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b91ba59edc252a7961f044caad94b192d49ce78"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dbdf0e24d51ce425c0066a76a0efc723e41e5071", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdj4NgCRBK7hj4Ov3rIwAAdHIIAAhIGcigJYUPyBkqtsLvxSOH\n3UMEnIGmv38TXP2G81g3A5guRy4RNE/YZKSmv9SXk6a94xlEeZfYtFaDlvnzVPCp\nvnp/LWQgObDpgp8e/bt4E07vv0+JKBYgdk4LtpUF4M5qGDsb1MbyAfrholPVScwg\nvvmgnNvEFSt3dJpYA/QdyHHnXYkcquTlELBvOvHUp5BGymSCu9Bsmnae6BB2fLKB\nCPDPGi+G/9KobGPO+x9/SeeNUsPtLl17Sc5FFyz0cI+TZ/upcXiS+AUQzAtJfRrj\nrLOg3v8xCRzoXs7y29vF7mZXR2WfoXVFosFakrSVA1PHtdY8UG6fqn682Nbvpr4=\n=HJwp\n-----END PGP SIGNATURE-----\n", "payload": "tree 2b91ba59edc252a7961f044caad94b192d49ce78\nparent 12f617e661c288cfc51727012da8114f77f7e55b\nparent 17d1405a8b4eddedaf3665fc41ff4fa17a1409a7\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1569686368 +0000\ncommitter GitHub <noreply@github.com> 1569686368 +0000\n\nMerge #1931\n\n1931: Support the new deprecated tag r=matklad a=arsdragonfly\n\nWhich is rendered as a strike-through line. Fixes #1671 .\r\n![\u6df1\u5ea6\u622a\u56fe_\u9009\u62e9\u533a\u57df_20190927162008](https://user-images.githubusercontent.com/4067473/65799714-ccb4c180-e142-11e9-8e45-ab18964605f3.png)\r\n\n\nCo-authored-by: arsdragonfly <arsdragonfly@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dbdf0e24d51ce425c0066a76a0efc723e41e5071", "html_url": "https://github.com/rust-lang/rust/commit/dbdf0e24d51ce425c0066a76a0efc723e41e5071", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dbdf0e24d51ce425c0066a76a0efc723e41e5071/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "12f617e661c288cfc51727012da8114f77f7e55b", "url": "https://api.github.com/repos/rust-lang/rust/commits/12f617e661c288cfc51727012da8114f77f7e55b", "html_url": "https://github.com/rust-lang/rust/commit/12f617e661c288cfc51727012da8114f77f7e55b"}, {"sha": "17d1405a8b4eddedaf3665fc41ff4fa17a1409a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/17d1405a8b4eddedaf3665fc41ff4fa17a1409a7", "html_url": "https://github.com/rust-lang/rust/commit/17d1405a8b4eddedaf3665fc41ff4fa17a1409a7"}], "stats": {"total": 26, "additions": 21, "deletions": 5}, "files": [{"sha": "327d15046f52ad532d6c73208f0b1b716b8cc00f", "filename": "editors/code/src/test/utils/diagnotics/rust.test.ts", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/dbdf0e24d51ce425c0066a76a0efc723e41e5071/editors%2Fcode%2Fsrc%2Ftest%2Futils%2Fdiagnotics%2Frust.test.ts", "raw_url": "https://github.com/rust-lang/rust/raw/dbdf0e24d51ce425c0066a76a0efc723e41e5071/editors%2Fcode%2Fsrc%2Ftest%2Futils%2Fdiagnotics%2Frust.test.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Ftest%2Futils%2Fdiagnotics%2Frust.test.ts?ref=dbdf0e24d51ce425c0066a76a0efc723e41e5071", "patch": "@@ -50,7 +50,7 @@ describe('mapRustDiagnosticToVsCode', () => {\n             ].join('\\n')\n         );\n         assert.strictEqual(diagnostic.code, 'E0053');\n-        assert.strictEqual(diagnostic.tags, undefined);\n+        assert.deepStrictEqual(diagnostic.tags, []);\n \n         // No related information\n         assert.deepStrictEqual(diagnostic.relatedInformation, []);\n@@ -115,7 +115,7 @@ describe('mapRustDiagnosticToVsCode', () => {\n         );\n         assert.strictEqual(diagnostic.code, 'E0061');\n         assert.strictEqual(diagnostic.source, 'rustc');\n-        assert.strictEqual(diagnostic.tags, undefined);\n+        assert.deepStrictEqual(diagnostic.tags, []);\n \n         // One related information for the original definition\n         const relatedInformation = diagnostic.relatedInformation;\n@@ -149,7 +149,7 @@ describe('mapRustDiagnosticToVsCode', () => {\n             ].join('\\n')\n         );\n         assert.strictEqual(diagnostic.code, 'trivially_copy_pass_by_ref');\n-        assert.strictEqual(diagnostic.tags, undefined);\n+        assert.deepStrictEqual(diagnostic.tags, []);\n \n         // One related information for the lint definition\n         const relatedInformation = diagnostic.relatedInformation;\n@@ -189,7 +189,7 @@ describe('mapRustDiagnosticToVsCode', () => {\n         );\n         assert.strictEqual(diagnostic.code, 'E0308');\n         assert.strictEqual(diagnostic.source, 'rustc');\n-        assert.strictEqual(diagnostic.tags, undefined);\n+        assert.deepStrictEqual(diagnostic.tags, []);\n \n         // No related information\n         assert.deepStrictEqual(diagnostic.relatedInformation, []);"}, {"sha": "0550d03724799575213231055b32bbeadb02a170", "filename": "editors/code/src/utils/diagnostics/rust.ts", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/dbdf0e24d51ce425c0066a76a0efc723e41e5071/editors%2Fcode%2Fsrc%2Futils%2Fdiagnostics%2Frust.ts", "raw_url": "https://github.com/rust-lang/rust/raw/dbdf0e24d51ce425c0066a76a0efc723e41e5071/editors%2Fcode%2Fsrc%2Futils%2Fdiagnostics%2Frust.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Futils%2Fdiagnostics%2Frust.ts?ref=dbdf0e24d51ce425c0066a76a0efc723e41e5071", "patch": "@@ -111,6 +111,17 @@ function isUnusedOrUnnecessary(rd: RustDiagnostic): boolean {\n     ].includes(rd.code.code);\n }\n \n+/**\n+ * Determines if diagnostic is related to deprecated code\n+ */\n+function isDeprecated(rd: RustDiagnostic): boolean {\n+    if (!rd.code) {\n+        return false;\n+    }\n+\n+    return ['deprecated'].includes(rd.code.code);\n+}\n+\n /**\n  * Converts a Rust child diagnostic to a VsCode related information\n  *\n@@ -200,6 +211,7 @@ export function mapRustDiagnosticToVsCode(\n     vd.source = source;\n     vd.code = code;\n     vd.relatedInformation = [];\n+    vd.tags = [];\n \n     for (const secondarySpan of secondarySpans) {\n         const related = mapSecondarySpanToRelated(secondarySpan);\n@@ -234,7 +246,11 @@ export function mapRustDiagnosticToVsCode(\n     }\n \n     if (isUnusedOrUnnecessary(rd)) {\n-        vd.tags = [vscode.DiagnosticTag.Unnecessary];\n+        vd.tags.push(vscode.DiagnosticTag.Unnecessary);\n+    }\n+\n+    if (isDeprecated(rd)) {\n+        vd.tags.push(vscode.DiagnosticTag.Deprecated);\n     }\n \n     return {"}]}