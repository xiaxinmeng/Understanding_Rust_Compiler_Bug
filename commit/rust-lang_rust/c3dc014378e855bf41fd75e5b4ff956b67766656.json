{"sha": "c3dc014378e855bf41fd75e5b4ff956b67766656", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzZGMwMTQzNzhlODU1YmY0MWZkNzVlNWI0ZmY5NTZiNjc3NjY2NTY=", "commit": {"author": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2018-04-15T11:47:45Z"}, "committer": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2018-04-15T12:41:28Z"}, "message": "Check generated save-analysis, instead of `bug!()`ing\n\nInjected crates don't have extern info. Let's skip them.", "tree": {"sha": "762151275f4e41ba11d25dc445494d561d58f4b7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/762151275f4e41ba11d25dc445494d561d58f4b7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3dc014378e855bf41fd75e5b4ff956b67766656", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3dc014378e855bf41fd75e5b4ff956b67766656", "html_url": "https://github.com/rust-lang/rust/commit/c3dc014378e855bf41fd75e5b4ff956b67766656", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3dc014378e855bf41fd75e5b4ff956b67766656/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c7e83f746297578c3f31a7b1440e30fdfd67c67", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c7e83f746297578c3f31a7b1440e30fdfd67c67", "html_url": "https://github.com/rust-lang/rust/commit/2c7e83f746297578c3f31a7b1440e30fdfd67c67"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "f494e982f7f20cb531b04cc83b58a331aca1874a", "filename": "src/librustc_save_analysis/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c3dc014378e855bf41fd75e5b4ff956b67766656/src%2Flibrustc_save_analysis%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3dc014378e855bf41fd75e5b4ff956b67766656/src%2Flibrustc_save_analysis%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Flib.rs?ref=c3dc014378e855bf41fd75e5b4ff956b67766656", "patch": "@@ -115,7 +115,8 @@ impl<'l, 'tcx: 'l> SaveContext<'l, 'tcx> {\n             let span = match *self.tcx.extern_crate(n.as_def_id()) {\n                 Some(ExternCrate { span, .. }) => span,\n                 None => {\n-                    bug!(\"no data for crate {}\", n);\n+                    debug!(\"Skipping crate {}, no data\", n);\n+                    continue;\n                 }\n             };\n             let lo_loc = self.span_utils.sess.codemap().lookup_char_pos(span.lo());"}, {"sha": "a132668ec7c8a43a4e85426fe98f5976e492013e", "filename": "src/test/run-make-fulldeps/save-analysis-rfc2126/Makefile", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c3dc014378e855bf41fd75e5b4ff956b67766656/src%2Ftest%2Frun-make-fulldeps%2Fsave-analysis-rfc2126%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/c3dc014378e855bf41fd75e5b4ff956b67766656/src%2Ftest%2Frun-make-fulldeps%2Fsave-analysis-rfc2126%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fsave-analysis-rfc2126%2FMakefile?ref=c3dc014378e855bf41fd75e5b4ff956b67766656", "patch": "@@ -2,7 +2,9 @@\n \n all: extern_absolute_paths.rs extern_in_paths.rs krate2\n \t$(RUSTC) extern_absolute_paths.rs -Zsave-analysis\n+\tcat $(TMPDIR)/save-analysis/extern_absolute_paths.json | \"$(PYTHON)\" validate_json.py\n \t$(RUSTC) extern_in_paths.rs -Zsave-analysis\n+\tcat $(TMPDIR)/save-analysis/extern_in_paths.json | \"$(PYTHON)\" validate_json.py\n \n krate2: krate2.rs\n \t$(RUSTC) $<"}, {"sha": "caab8d0d62697039e9d355e41683d3f8e5a1a847", "filename": "src/test/run-make-fulldeps/save-analysis-rfc2126/validate_json.py", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/c3dc014378e855bf41fd75e5b4ff956b67766656/src%2Ftest%2Frun-make-fulldeps%2Fsave-analysis-rfc2126%2Fvalidate_json.py", "raw_url": "https://github.com/rust-lang/rust/raw/c3dc014378e855bf41fd75e5b4ff956b67766656/src%2Ftest%2Frun-make-fulldeps%2Fsave-analysis-rfc2126%2Fvalidate_json.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fsave-analysis-rfc2126%2Fvalidate_json.py?ref=c3dc014378e855bf41fd75e5b4ff956b67766656", "patch": "@@ -0,0 +1,17 @@\n+#!/usr/bin/env python\n+\n+# Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+import sys\n+import json\n+\n+crates = json.loads(sys.stdin.readline().strip())[\"prelude\"][\"external_crates\"]\n+assert any(map(lambda c: c[\"id\"][\"name\"] == \"krate2\", crates))"}]}