{"sha": "4b7a92838c98929a9f4c7a64583b5ea49ebb3a35", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRiN2E5MjgzOGM5ODkyOWE5ZjRjN2E2NDU4M2I1ZWE0OWViYjNhMzU=", "commit": {"author": {"name": "mibac138", "email": "5672750+mibac138@users.noreply.github.com", "date": "2020-05-05T23:50:55Z"}, "committer": {"name": "mibac138", "email": "5672750+mibac138@users.noreply.github.com", "date": "2020-05-05T23:50:55Z"}, "message": "Fix unused_parens nested binary op false positive", "tree": {"sha": "e04560af605c0caed95cd231ca10a3aa2dfd5164", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e04560af605c0caed95cd231ca10a3aa2dfd5164"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35", "html_url": "https://github.com/rust-lang/rust/commit/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35/comments", "author": {"login": "mibac138", "id": 5672750, "node_id": "MDQ6VXNlcjU2NzI3NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5672750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mibac138", "html_url": "https://github.com/mibac138", "followers_url": "https://api.github.com/users/mibac138/followers", "following_url": "https://api.github.com/users/mibac138/following{/other_user}", "gists_url": "https://api.github.com/users/mibac138/gists{/gist_id}", "starred_url": "https://api.github.com/users/mibac138/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mibac138/subscriptions", "organizations_url": "https://api.github.com/users/mibac138/orgs", "repos_url": "https://api.github.com/users/mibac138/repos", "events_url": "https://api.github.com/users/mibac138/events{/privacy}", "received_events_url": "https://api.github.com/users/mibac138/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mibac138", "id": 5672750, "node_id": "MDQ6VXNlcjU2NzI3NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5672750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mibac138", "html_url": "https://github.com/mibac138", "followers_url": "https://api.github.com/users/mibac138/followers", "following_url": "https://api.github.com/users/mibac138/following{/other_user}", "gists_url": "https://api.github.com/users/mibac138/gists{/gist_id}", "starred_url": "https://api.github.com/users/mibac138/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mibac138/subscriptions", "organizations_url": "https://api.github.com/users/mibac138/orgs", "repos_url": "https://api.github.com/users/mibac138/repos", "events_url": "https://api.github.com/users/mibac138/events{/privacy}", "received_events_url": "https://api.github.com/users/mibac138/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "717a7a8486a448d7c746db213d1d987593088692", "url": "https://api.github.com/repos/rust-lang/rust/commits/717a7a8486a448d7c746db213d1d987593088692", "html_url": "https://github.com/rust-lang/rust/commit/717a7a8486a448d7c746db213d1d987593088692"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "c24079a6e4be234c9ec5156c8181d9dcd5785236", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=4b7a92838c98929a9f4c7a64583b5ea49ebb3a35", "patch": "@@ -381,12 +381,20 @@ trait UnusedDelimLint {\n \n     fn is_expr_delims_necessary(inner: &ast::Expr, followed_by_block: bool) -> bool {\n         // Prevent false-positives in cases like `fn x() -> u8 { ({ 0 } + 1) }`\n-        let lhs_needs_parens = match &inner.kind {\n-            ExprKind::Binary(_, lhs, _rhs) => {\n-                !rustc_ast::util::classify::expr_requires_semi_to_be_stmt(&*lhs)\n+        let lhs_needs_parens = {\n+            let mut innermost = inner;\n+            loop {\n+                if let ExprKind::Binary(_, lhs, _rhs) = &innermost.kind {\n+                    innermost = lhs;\n+                    if !rustc_ast::util::classify::expr_requires_semi_to_be_stmt(innermost) {\n+                        break true;\n+                    }\n+                } else {\n+                    break false;\n+                }\n             }\n-            _ => false,\n         };\n+\n         lhs_needs_parens\n             || (followed_by_block\n                 && match inner.kind {"}, {"sha": "24d77e36d94f54e61af78713e1b83d92af53d445", "filename": "src/test/ui/lint/issue-71290-unused-paren-binop.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35/src%2Ftest%2Fui%2Flint%2Fissue-71290-unused-paren-binop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4b7a92838c98929a9f4c7a64583b5ea49ebb3a35/src%2Ftest%2Fui%2Flint%2Fissue-71290-unused-paren-binop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-71290-unused-paren-binop.rs?ref=4b7a92838c98929a9f4c7a64583b5ea49ebb3a35", "patch": "@@ -15,4 +15,9 @@ pub fn foo(a: bool, b: bool) -> u8 {\n     (if a { 1 } else { 0 } + if b { 1 } else { 0 })\n }\n \n+pub fn bar() -> u8 {\n+    // Make sure nested expressions are handled correctly as well\n+    ({ 0 } + 1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9)\n+}\n+\n fn main() {}"}]}