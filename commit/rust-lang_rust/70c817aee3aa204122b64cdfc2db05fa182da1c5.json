{"sha": "70c817aee3aa204122b64cdfc2db05fa182da1c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcwYzgxN2FlZTNhYTIwNDEyMmI2NGNkZmMyZGIwNWZhMTgyZGExYzU=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-07-24T23:10:42Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-07-24T23:10:42Z"}, "message": "Allow lexer to recover from some homoglyphs", "tree": {"sha": "60a0178103feb7ad6c09aa86eb115dfb8eeabc2e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/60a0178103feb7ad6c09aa86eb115dfb8eeabc2e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/70c817aee3aa204122b64cdfc2db05fa182da1c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/70c817aee3aa204122b64cdfc2db05fa182da1c5", "html_url": "https://github.com/rust-lang/rust/commit/70c817aee3aa204122b64cdfc2db05fa182da1c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/70c817aee3aa204122b64cdfc2db05fa182da1c5/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27a6a304e2baaabca88059753f020377f2476978", "url": "https://api.github.com/repos/rust-lang/rust/commits/27a6a304e2baaabca88059753f020377f2476978", "html_url": "https://github.com/rust-lang/rust/commit/27a6a304e2baaabca88059753f020377f2476978"}], "stats": {"total": 108, "additions": 74, "deletions": 34}, "files": [{"sha": "412ed8f04b3432f8eb83f1d0ae7a129e35d96da7", "filename": "src/libsyntax/parse/lexer/mod.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer%2Fmod.rs?ref=70c817aee3aa204122b64cdfc2db05fa182da1c5", "patch": "@@ -389,7 +389,10 @@ impl<'a> StringReader<'a> {\n                                                           self.pos,\n                                                           \"unknown start of token\",\n                                                           c);\n-                unicode_chars::check_for_substitution(self, start, c, &mut err);\n+                if let Some(t) = unicode_chars::check_for_substitution(self, start, c, &mut err) {\n+                    err.emit();\n+                    return Ok(t);\n+                }\n                 return Err(err)\n             }\n         };"}, {"sha": "bfa1606a0d2010ce503064623187a453a671ea57", "filename": "src/libsyntax/parse/lexer/unicode_chars.rs", "status": "modified", "additions": 33, "deletions": 32, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Flibsyntax%2Fparse%2Flexer%2Funicode_chars.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Flibsyntax%2Fparse%2Flexer%2Funicode_chars.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer%2Funicode_chars.rs?ref=70c817aee3aa204122b64cdfc2db05fa182da1c5", "patch": "@@ -4,6 +4,7 @@\n use super::StringReader;\n use errors::{Applicability, DiagnosticBuilder};\n use syntax_pos::{BytePos, Pos, Span, NO_EXPANSION};\n+use crate::parse::token;\n \n #[rustfmt::skip] // for line breaks\n const UNICODE_ARRAY: &[(char, &str, char)] = &[\n@@ -297,53 +298,53 @@ const UNICODE_ARRAY: &[(char, &str, char)] = &[\n     ('\uff1e', \"Fullwidth Greater-Than Sign\", '>'),\n ];\n \n-const ASCII_ARRAY: &[(char, &str)] = &[\n-    (' ', \"Space\"),\n-    ('_', \"Underscore\"),\n-    ('-', \"Minus/Hyphen\"),\n-    (',', \"Comma\"),\n-    (';', \"Semicolon\"),\n-    (':', \"Colon\"),\n-    ('!', \"Exclamation Mark\"),\n-    ('?', \"Question Mark\"),\n-    ('.', \"Period\"),\n-    ('\\'', \"Single Quote\"),\n-    ('\"', \"Quotation Mark\"),\n-    ('(', \"Left Parenthesis\"),\n-    (')', \"Right Parenthesis\"),\n-    ('[', \"Left Square Bracket\"),\n-    (']', \"Right Square Bracket\"),\n-    ('{', \"Left Curly Brace\"),\n-    ('}', \"Right Curly Brace\"),\n-    ('*', \"Asterisk\"),\n-    ('/', \"Slash\"),\n-    ('\\\\', \"Backslash\"),\n-    ('&', \"Ampersand\"),\n-    ('+', \"Plus Sign\"),\n-    ('<', \"Less-Than Sign\"),\n-    ('=', \"Equals Sign\"),\n-    ('>', \"Greater-Than Sign\"),\n+const ASCII_ARRAY: &[(char, &str, Option<token::TokenKind>)] = &[\n+    (' ', \"Space\", Some(token::Whitespace)),\n+    ('_', \"Underscore\", None),\n+    ('-', \"Minus/Hyphen\", Some(token::BinOp(token::Minus))),\n+    (',', \"Comma\", Some(token::Comma)),\n+    (';', \"Semicolon\", Some(token::Semi)),\n+    (':', \"Colon\", Some(token::Colon)),\n+    ('!', \"Exclamation Mark\", Some(token::Not)),\n+    ('?', \"Question Mark\", Some(token::Question)),\n+    ('.', \"Period\", Some(token::Dot)),\n+    ('\\'', \"Single Quote\", None),  // Literals are already lexed by this point, so we can't recover\n+    ('\"', \"Quotation Mark\", None), // gracefully just by spitting the correct token out.\n+    ('(', \"Left Parenthesis\", Some(token::OpenDelim(token::Paren))),\n+    (')', \"Right Parenthesis\", Some(token::CloseDelim(token::Paren))),\n+    ('[', \"Left Square Bracket\", Some(token::OpenDelim(token::Bracket))),\n+    (']', \"Right Square Bracket\", Some(token::CloseDelim(token::Bracket))),\n+    ('{', \"Left Curly Brace\", Some(token::OpenDelim(token::Brace))),\n+    ('}', \"Right Curly Brace\", Some(token::CloseDelim(token::Brace))),\n+    ('*', \"Asterisk\", Some(token::BinOp(token::Star))),\n+    ('/', \"Slash\", Some(token::BinOp(token::Slash))),\n+    ('\\\\', \"Backslash\", None),\n+    ('&', \"Ampersand\", Some(token::BinOp(token::And))),\n+    ('+', \"Plus Sign\", Some(token::BinOp(token::Plus))),\n+    ('<', \"Less-Than Sign\", Some(token::Lt)),\n+    ('=', \"Equals Sign\", Some(token::Eq)),\n+    ('>', \"Greater-Than Sign\", Some(token::Gt)),\n ];\n \n crate fn check_for_substitution<'a>(\n     reader: &StringReader<'a>,\n     pos: BytePos,\n     ch: char,\n     err: &mut DiagnosticBuilder<'a>,\n-) -> bool {\n+) -> Option<token::TokenKind> {\n     let (u_name, ascii_char) = match UNICODE_ARRAY.iter().find(|&&(c, _, _)| c == ch) {\n         Some(&(_u_char, u_name, ascii_char)) => (u_name, ascii_char),\n-        None => return false,\n+        None => return None,\n     };\n \n     let span = Span::new(pos, pos + Pos::from_usize(ch.len_utf8()), NO_EXPANSION);\n \n-    let ascii_name = match ASCII_ARRAY.iter().find(|&&(c, _)| c == ascii_char) {\n-        Some((_ascii_char, ascii_name)) => ascii_name,\n+    let (ascii_name, token) = match ASCII_ARRAY.iter().find(|&&(c, _, _)| c == ascii_char) {\n+        Some((_ascii_char, ascii_name, token)) => (ascii_name, token),\n         None => {\n             let msg = format!(\"substitution character not found for '{}'\", ch);\n             reader.sess.span_diagnostic.span_bug_no_panic(span, &msg);\n-            return false;\n+            return None;\n         }\n     };\n \n@@ -371,7 +372,7 @@ crate fn check_for_substitution<'a>(\n         );\n         err.span_suggestion(span, &msg, ascii_char.to_string(), Applicability::MaybeIncorrect);\n     }\n-    true\n+    token.clone()\n }\n \n /// Extract string if found at current position with given delimiters"}, {"sha": "66d562d2eb51985020bf9721a3551eafff28ca58", "filename": "src/test/ui/did_you_mean/issue-49746-unicode-confusable-in-float-literal-expt.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.rs?ref=70c817aee3aa204122b64cdfc2db05fa182da1c5", "patch": "@@ -1,5 +1,6 @@\n const UNIVERSAL_GRAVITATIONAL_CONSTANT: f64 = 6.674e\u221211; // m\u00b3\u22c5kg\u207b\u00b9\u22c5s\u207b\u00b2\n //~^ ERROR expected at least one digit in exponent\n //~| ERROR unknown start of token: \\u{2212}\n+//~| ERROR cannot subtract `{integer}` from `{float}`\n \n fn main() {}"}, {"sha": "9ee86adec52d9b27f92426fb6e238e526ffb0497", "filename": "src/test/ui/did_you_mean/issue-49746-unicode-confusable-in-float-literal-expt.stderr", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-49746-unicode-confusable-in-float-literal-expt.stderr?ref=70c817aee3aa204122b64cdfc2db05fa182da1c5", "patch": "@@ -14,5 +14,14 @@ help: Unicode character '\u2212' (Minus Sign) looks like '-' (Minus/Hyphen), but it\n LL | const UNIVERSAL_GRAVITATIONAL_CONSTANT: f64 = 6.674e-11; // m\u00b3\u22c5kg\u207b\u00b9\u22c5s\u207b\u00b2\n    |                                                     ^\n \n-error: aborting due to 2 previous errors\n+error[E0277]: cannot subtract `{integer}` from `{float}`\n+  --> $DIR/issue-49746-unicode-confusable-in-float-literal-expt.rs:1:53\n+   |\n+LL | const UNIVERSAL_GRAVITATIONAL_CONSTANT: f64 = 6.674e\u221211; // m\u00b3\u22c5kg\u207b\u00b9\u22c5s\u207b\u00b2\n+   |                                                     ^ no implementation for `{float} - {integer}`\n+   |\n+   = help: the trait `std::ops::Sub<{integer}>` is not implemented for `{float}`\n+\n+error: aborting due to 3 previous errors\n \n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "99ce0d1a630df73ba67259e60aa862f0d3f9585d", "filename": "src/test/ui/parser/recover-from-homoglyph.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fparser%2Frecover-from-homoglyph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fparser%2Frecover-from-homoglyph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frecover-from-homoglyph.rs?ref=70c817aee3aa204122b64cdfc2db05fa182da1c5", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    println!(\"\")\u037e //~ ERROR unknown start of token: \\u{37e}\n+    let x: usize = (); //~ ERROR mismatched types\n+}"}, {"sha": "424d492b7ba649523efc607377934862ef0e7b04", "filename": "src/test/ui/parser/recover-from-homoglyph.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fparser%2Frecover-from-homoglyph.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/70c817aee3aa204122b64cdfc2db05fa182da1c5/src%2Ftest%2Fui%2Fparser%2Frecover-from-homoglyph.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frecover-from-homoglyph.stderr?ref=70c817aee3aa204122b64cdfc2db05fa182da1c5", "patch": "@@ -0,0 +1,22 @@\n+error: unknown start of token: \\u{37e}\n+  --> $DIR/recover-from-homoglyph.rs:2:17\n+   |\n+LL |     println!(\"\")\u037e\n+   |                 ^\n+help: Unicode character '\u037e' (Greek Question Mark) looks like ';' (Semicolon), but it is not\n+   |\n+LL |     println!(\"\");\n+   |                 ^\n+\n+error[E0308]: mismatched types\n+  --> $DIR/recover-from-homoglyph.rs:3:20\n+   |\n+LL |     let x: usize = ();\n+   |                    ^^ expected usize, found ()\n+   |\n+   = note: expected type `usize`\n+              found type `()`\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0308`."}]}