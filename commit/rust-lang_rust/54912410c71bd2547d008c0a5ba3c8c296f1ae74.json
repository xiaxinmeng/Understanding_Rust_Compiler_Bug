{"sha": "54912410c71bd2547d008c0a5ba3c8c296f1ae74", "node_id": "C_kwDOAAsO6NoAKDU0OTEyNDEwYzcxYmQyNTQ3ZDAwOGMwYTViYTNjOGMyOTZmMWFlNzQ", "commit": {"author": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-04-01T23:51:44Z"}, "committer": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-05-08T16:24:58Z"}, "message": "`Wildcard_imports` ignore `test.rs` files", "tree": {"sha": "3347b27fc9fe885711105a61338db44febd15cc2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3347b27fc9fe885711105a61338db44febd15cc2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54912410c71bd2547d008c0a5ba3c8c296f1ae74", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEM3aofraJSaf7CtgpTTgXC1ovwzQFAmRZIloACgkQTTgXC1ov\nwzR54Q/7BwCNhtuY8XLN4JTVV2TD1XWQk8Tn/akmrbcIWT0tPjLXk8VEts89Fw/J\n+NDFxqsnN434N6OeiWX620vGgK8CDoHuajNuhBj1u/ouz2CQm6Qzb8VGvZ3SWEhP\njybKqALfBdhMjPmwNdScBDdz9edf2CLmO8TiE6jHg5njrqkUxihhgFhIQShoDe+E\nkdMrCti4EqoIv+rsvwdq9HGtgdrbcHfXNo1LPGYQjyxqLmlk33cdQqa8XGQcun7g\nMVJZXgBsTvk7bfJirXRyissCCdkosNj3zr11aUmcz5DyNBf9S4KlFCne0WD7UXK6\nLaLK87Ad6/EISIHVhf0r5tBMVa0ptGj5Gs68tzq13HIAXOnUZka5P2h3fgQETtqE\nIyVl2Cnf0L6DM7O5asyLQzccBDCpRpGWVBavM6wxuP8bDNqVFPpMEIWyFvYLlKmC\njELtZLowzJPgT6jWSJc6ttKcVxchP7ek/LDfyDbiXTF089JZwudZ5BQYsQdp77aj\nRHIjD/aUz8EqF8NBig+FjgHSDg55CxpxEoWtAgb87s8s9lQhGm3ptoS6pd/iYCBc\ngHkqcZJnR3EiRHLCl2HcDArjBLC9dv46d3l+RwO1NhAPk1Z/GbBI5bHkisQwLaAF\nTrk2DT1xWeww+35gjNT0mdxqQEygsSs1b+Enp0mJ/pmxXkY7s3w=\n=aNgj\n-----END PGP SIGNATURE-----", "payload": "tree 3347b27fc9fe885711105a61338db44febd15cc2\nparent e66488a66917d2741ff7a862fb2cdbb38ab4015e\nauthor blyxyas <blyxyas@gmail.com> 1680393104 +0200\ncommitter blyxyas <blyxyas@gmail.com> 1683563098 +0200\n\n`Wildcard_imports` ignore `test.rs` files\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54912410c71bd2547d008c0a5ba3c8c296f1ae74", "html_url": "https://github.com/rust-lang/rust/commit/54912410c71bd2547d008c0a5ba3c8c296f1ae74", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54912410c71bd2547d008c0a5ba3c8c296f1ae74/comments", "author": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e66488a66917d2741ff7a862fb2cdbb38ab4015e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e66488a66917d2741ff7a862fb2cdbb38ab4015e", "html_url": "https://github.com/rust-lang/rust/commit/e66488a66917d2741ff7a862fb2cdbb38ab4015e"}], "stats": {"total": 102, "additions": 101, "deletions": 1}, "files": [{"sha": "f062cafdd4fac271de98eef1112393e877291e08", "filename": "clippy_lints/src/wildcard_imports.rs", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/54912410c71bd2547d008c0a5ba3c8c296f1ae74/clippy_lints%2Fsrc%2Fwildcard_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54912410c71bd2547d008c0a5ba3c8c296f1ae74/clippy_lints%2Fsrc%2Fwildcard_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fwildcard_imports.rs?ref=54912410c71bd2547d008c0a5ba3c8c296f1ae74", "patch": "@@ -7,7 +7,8 @@ use rustc_hir::{\n     def::{DefKind, Res},\n     Item, ItemKind, PathSegment, UseKind,\n };\n-use rustc_lint::{LateContext, LateLintPass};\n+use rustc_hir::{HirId, Mod};\n+use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_middle::ty;\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n use rustc_span::symbol::kw;\n@@ -102,21 +103,40 @@ declare_clippy_lint! {\n pub struct WildcardImports {\n     warn_on_all: bool,\n     test_modules_deep: u32,\n+    ignore: bool,\n }\n \n impl WildcardImports {\n     pub fn new(warn_on_all: bool) -> Self {\n         Self {\n             warn_on_all,\n             test_modules_deep: 0,\n+            ignore: false,\n         }\n     }\n }\n \n impl_lint_pass!(WildcardImports => [ENUM_GLOB_USE, WILDCARD_IMPORTS]);\n \n impl LateLintPass<'_> for WildcardImports {\n+    fn check_mod(&mut self, cx: &LateContext<'_>, module: &Mod<'_>, _: HirId) {\n+        let filename = cx\n+            .sess()\n+            .source_map()\n+            .span_to_filename(module.spans.inner_span)\n+            .display(rustc_span::FileNameDisplayPreference::Local)\n+            .to_string();\n+\n+        if filename.ends_with(\"test.rs\") || filename.ends_with(\"tests.rs\") {\n+            self.ignore = true;\n+        }\n+    }\n+\n     fn check_item(&mut self, cx: &LateContext<'_>, item: &Item<'_>) {\n+        if self.ignore {\n+            return;\n+        }\n+\n         if is_test_module_or_function(cx.tcx, item) {\n             self.test_modules_deep = self.test_modules_deep.saturating_add(1);\n         }"}, {"sha": "726808e598f4ed340af7101c289ab704b3cd274c", "filename": "tests/ui/wildcard_imports/another_file.fixed", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Fanother_file.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Fanother_file.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Fanother_file.fixed?ref=54912410c71bd2547d008c0a5ba3c8c296f1ae74", "patch": "@@ -0,0 +1,18 @@\n+// run-rustfix\n+#![warn(clippy::wildcard_imports)]\n+#![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n+\n+// Test for #10580, the lint should **not** ignore it.\n+\n+fn foofoo() {}\n+\n+mod outer {\n+    mod inner {\n+        use super::super::foofoo;\n+        fn barbar() {\n+            let _ = foofoo();\n+        }\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "057332ef706018f192fdc20fca634c6d1d3b5c30", "filename": "tests/ui/wildcard_imports/another_file.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Fanother_file.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Fanother_file.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Fanother_file.rs?ref=54912410c71bd2547d008c0a5ba3c8c296f1ae74", "patch": "@@ -0,0 +1,18 @@\n+// run-rustfix\n+#![warn(clippy::wildcard_imports)]\n+#![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n+\n+// Test for #10580, the lint should **not** ignore it.\n+\n+fn foofoo() {}\n+\n+mod outer {\n+    mod inner {\n+        use super::super::*;\n+        fn barbar() {\n+            let _ = foofoo();\n+        }\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "56923eff58b25a41ac5bf1798698bc8ad2f2954e", "filename": "tests/ui/wildcard_imports/another_file.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Fanother_file.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Fanother_file.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Fanother_file.stderr?ref=54912410c71bd2547d008c0a5ba3c8c296f1ae74", "patch": "@@ -0,0 +1,10 @@\n+error: usage of wildcard import\n+  --> $DIR/another_file.rs:11:13\n+   |\n+LL |         use super::super::*;\n+   |             ^^^^^^^^^^^^^^^ help: try: `super::super::foofoo`\n+   |\n+   = note: `-D clippy::wildcard-imports` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}, {"sha": "9029e5ba503a467c2de750f4ace65f9181512b9f", "filename": "tests/ui/wildcard_imports/test.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Ftest.rs?ref=54912410c71bd2547d008c0a5ba3c8c296f1ae74", "patch": "@@ -0,0 +1,17 @@\n+#![warn(clippy::wildcard_imports)]\n+#![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n+\n+// Test for #10580, the lint **should** not ignore it.\n+\n+fn foofoo() {}\n+\n+mod outer {\n+    mod inner {\n+        use super::super::*;\n+        fn barbar() {\n+            let _ = foofoo();\n+        }\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "b7483853388ea2b1b30ed4343e2d6006476ab129", "filename": "tests/ui/wildcard_imports/tests.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54912410c71bd2547d008c0a5ba3c8c296f1ae74/tests%2Fui%2Fwildcard_imports%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Ftests.rs?ref=54912410c71bd2547d008c0a5ba3c8c296f1ae74", "patch": "@@ -0,0 +1,17 @@\n+#![warn(clippy::wildcard_imports)]\n+#![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n+\n+// Test for #10580, the lint **should** ignore it.\n+\n+fn foofoo() {}\n+\n+mod outer {\n+    mod inner {\n+        use super::super::*;\n+        fn barbar() {\n+            let _ = foofoo();\n+        }\n+    }\n+}\n+\n+fn main() {}"}]}