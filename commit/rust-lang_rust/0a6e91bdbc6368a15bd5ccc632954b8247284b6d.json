{"sha": "0a6e91bdbc6368a15bd5ccc632954b8247284b6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBhNmU5MWJkYmM2MzY4YTE1YmQ1Y2NjNjMyOTU0YjgyNDcyODRiNmQ=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-04-29T22:13:54Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-04-29T22:19:12Z"}, "message": "Add a few more tests for proc macro feature gating", "tree": {"sha": "c5a1eff1e61240f3961ad6605836a5fd40bbda46", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c5a1eff1e61240f3961ad6605836a5fd40bbda46"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a6e91bdbc6368a15bd5ccc632954b8247284b6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a6e91bdbc6368a15bd5ccc632954b8247284b6d", "html_url": "https://github.com/rust-lang/rust/commit/0a6e91bdbc6368a15bd5ccc632954b8247284b6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a6e91bdbc6368a15bd5ccc632954b8247284b6d/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79252ff4e25d82f9fe856cb66f127b79cdace163", "url": "https://api.github.com/repos/rust-lang/rust/commits/79252ff4e25d82f9fe856cb66f127b79cdace163", "html_url": "https://github.com/rust-lang/rust/commit/79252ff4e25d82f9fe856cb66f127b79cdace163"}], "stats": {"total": 55, "additions": 42, "deletions": 13}, "files": [{"sha": "fff433b90ce69683905d541734f8cef980b61c8c", "filename": "src/test/compile-fail-fulldeps/proc-macro/proc-macro-gates.rs", "status": "modified", "additions": 42, "deletions": 13, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/0a6e91bdbc6368a15bd5ccc632954b8247284b6d/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fproc-macro-gates.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a6e91bdbc6368a15bd5ccc632954b8247284b6d/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fproc-macro-gates.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Fproc-macro-gates.rs?ref=0a6e91bdbc6368a15bd5ccc632954b8247284b6d", "patch": "@@ -24,9 +24,17 @@ use foo::*;\n #[foo::a] //~ ERROR: paths of length greater than one\n fn _test() {}\n \n+fn _test_inner() {\n+    #![a] // OK\n+}\n+\n #[a] //~ ERROR: custom attributes cannot be applied to modules\n mod _test2 {}\n \n+mod _test2_inner {\n+    #![a] //~ ERROR: custom attributes cannot be applied to modules\n+}\n+\n #[a = y] //~ ERROR: must only be followed by a delimiter token\n fn _test3() {}\n \n@@ -36,19 +44,40 @@ fn _test4() {}\n #[a () = ] //~ ERROR: must only be followed by a delimiter token\n fn _test5() {}\n \n-fn main() {\n+fn attrs() {\n+    // Statement, item\n+    #[a] // OK\n+    struct S;\n+\n+    // Statement, macro\n+    #[a] //~ ERROR: custom attributes cannot be applied to statements\n+    println!();\n+\n+    // Statement, semi\n+    #[a] //~ ERROR: custom attributes cannot be applied to statements\n+    S;\n+\n+    // Statement, local\n     #[a] //~ ERROR: custom attributes cannot be applied to statements\n     let _x = 2;\n-    let _x = #[a] 2;\n-    //~^ ERROR: custom attributes cannot be applied to expressions\n-\n-    let _x: m!(u32) = 3;\n-    //~^ ERROR: procedural macros cannot be expanded to types\n-    if let m!(Some(_x)) = Some(3) {\n-    //~^ ERROR: procedural macros cannot be expanded to patterns\n-    }\n-    let _x = m!(3);\n-    //~^ ERROR: procedural macros cannot be expanded to expressions\n-    m!(let _x = 3;);\n-    //~^ ERROR: procedural macros cannot be expanded to statements\n+\n+    // Expr\n+    let _x = #[a] 2; //~ ERROR: custom attributes cannot be applied to expressions\n+\n+    // Opt expr\n+    let _x = [#[a] 2]; //~ ERROR: custom attributes cannot be applied to expressions\n+\n+    // Expr macro\n+    let _x = #[a] println!(); //~ ERROR: custom attributes cannot be applied to expressions\n+}\n+\n+fn main() {\n+    let _x: m!(u32) = 3; //~ ERROR: procedural macros cannot be expanded to types\n+    if let m!(Some(_x)) = Some(3) {} //~ ERROR: procedural macros cannot be expanded to patterns\n+\n+    m!(struct S;); //~ ERROR: procedural macros cannot be expanded to statements\n+    m!(let _x = 3;); //~ ERROR: procedural macros cannot be expanded to statements\n+\n+    let _x = m!(3); //~ ERROR: procedural macros cannot be expanded to expressions\n+    let _x = [m!(3)]; //~ ERROR: procedural macros cannot be expanded to expressions\n }"}]}