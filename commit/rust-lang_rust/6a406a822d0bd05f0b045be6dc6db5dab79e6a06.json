{"sha": "6a406a822d0bd05f0b045be6dc6db5dab79e6a06", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhNDA2YTgyMmQwYmQwNWYwYjA0NWJlNmRjNmRiNWRhYjc5ZTZhMDY=", "commit": {"author": {"name": "Ruben Schmidmeister", "email": "ruben.schmidmeister@icloud.com", "date": "2019-05-14T18:38:28Z"}, "committer": {"name": "Ruben Schmidmeister", "email": "ruben.schmidmeister@icloud.com", "date": "2019-05-14T18:38:28Z"}, "message": "Return iterator instead of collecting early", "tree": {"sha": "097289ce03df4f6e6b3111ff3c24b9c8e48d2c4a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/097289ce03df4f6e6b3111ff3c24b9c8e48d2c4a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a406a822d0bd05f0b045be6dc6db5dab79e6a06", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEU0FXzFYkrmfOhhqxKTh7Wnqvhj8FAlzbCzkACgkQKTh7Wnqv\nhj8nWAgApwvku0sNKXhYXQ0YJQ/U907i2WJK47ZBJsY0OpzZJx/vHDVLjsnX7ESS\nhiHrcb1Dlx24LZXfO199dQ3sPIXPz0av86WONb5aSl6DBmRySz6nSyk60a3hiDPs\nyvuWgFI8sdHl2Or8FMytWLwP4bMgn3lN+QKP6B1zQPEK642sFmIwoVoT2DSMz4l8\n2TmmQd1sjYq6tqlXu33K7fUpnOAwONaE+og+OV/30ZOz7xZojA3QqYC6KIaYHwez\nOoGIv2gk+RI0GNBCb1lwbKyhrKc/cJgEk7iTCAVwPhnwTI3JAK0MKWPQsJRZckiH\nHbbZFcui5VNBwehMVePMb6gf6U1fZQ==\n=8rX6\n-----END PGP SIGNATURE-----", "payload": "tree 097289ce03df4f6e6b3111ff3c24b9c8e48d2c4a\nparent b875fe94859bbe37465219c0456583dbc0bed206\nauthor Ruben Schmidmeister <ruben.schmidmeister@icloud.com> 1557859108 +0200\ncommitter Ruben Schmidmeister <ruben.schmidmeister@icloud.com> 1557859108 +0200\n\nReturn iterator instead of collecting early\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a406a822d0bd05f0b045be6dc6db5dab79e6a06", "html_url": "https://github.com/rust-lang/rust/commit/6a406a822d0bd05f0b045be6dc6db5dab79e6a06", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a406a822d0bd05f0b045be6dc6db5dab79e6a06/comments", "author": {"login": "bash", "id": 4602612, "node_id": "MDQ6VXNlcjQ2MDI2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4602612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bash", "html_url": "https://github.com/bash", "followers_url": "https://api.github.com/users/bash/followers", "following_url": "https://api.github.com/users/bash/following{/other_user}", "gists_url": "https://api.github.com/users/bash/gists{/gist_id}", "starred_url": "https://api.github.com/users/bash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bash/subscriptions", "organizations_url": "https://api.github.com/users/bash/orgs", "repos_url": "https://api.github.com/users/bash/repos", "events_url": "https://api.github.com/users/bash/events{/privacy}", "received_events_url": "https://api.github.com/users/bash/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bash", "id": 4602612, "node_id": "MDQ6VXNlcjQ2MDI2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4602612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bash", "html_url": "https://github.com/bash", "followers_url": "https://api.github.com/users/bash/followers", "following_url": "https://api.github.com/users/bash/following{/other_user}", "gists_url": "https://api.github.com/users/bash/gists{/gist_id}", "starred_url": "https://api.github.com/users/bash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bash/subscriptions", "organizations_url": "https://api.github.com/users/bash/orgs", "repos_url": "https://api.github.com/users/bash/repos", "events_url": "https://api.github.com/users/bash/events{/privacy}", "received_events_url": "https://api.github.com/users/bash/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b875fe94859bbe37465219c0456583dbc0bed206", "url": "https://api.github.com/repos/rust-lang/rust/commits/b875fe94859bbe37465219c0456583dbc0bed206", "html_url": "https://github.com/rust-lang/rust/commit/b875fe94859bbe37465219c0456583dbc0bed206"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "e40b16314fd28b54ded8a479a1144205de03ab93", "filename": "src/attr.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6a406a822d0bd05f0b045be6dc6db5dab79e6a06/src%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a406a822d0bd05f0b045be6dc6db5dab79e6a06/src%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fattr.rs?ref=6a406a822d0bd05f0b045be6dc6db5dab79e6a06", "patch": "@@ -53,12 +53,11 @@ fn is_derive(attr: &ast::Attribute) -> bool {\n }\n \n /// Returns the arguments of `#[derive(...)]`.\n-fn get_derive_spans(attr: &ast::Attribute) -> Option<Vec<Span>> {\n+fn get_derive_spans<'a>(attr: &'a ast::Attribute) -> Option<impl Iterator<Item = Span> + 'a> {\n     attr.meta_item_list().map(|meta_item_list| {\n         meta_item_list\n-            .iter()\n+            .into_iter()\n             .map(|nested_meta_item| nested_meta_item.span)\n-            .collect()\n     })\n }\n \n@@ -411,10 +410,11 @@ impl<'a> Rewrite for [ast::Attribute] {\n             // Handle derives if we will merge them.\n             if context.config.merge_derives() && is_derive(&attrs[0]) {\n                 let derives = take_while_with_pred(context, attrs, is_derive);\n-                let mut derive_spans = vec![];\n-                for derive in derives {\n-                    derive_spans.append(&mut get_derive_spans(derive)?);\n-                }\n+                let derive_spans: Vec<_> = derives\n+                    .iter()\n+                    .filter_map(get_derive_spans)\n+                    .flatten()\n+                    .collect();\n                 let derive_str =\n                     format_derive(&derive_spans, attr_prefix(&attrs[0]), shape, context)?;\n                 result.push_str(&derive_str);"}]}