{"sha": "1149cf04de68f45a596c5a9479a525a2efb88214", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExNDljZjA0ZGU2OGY0NWE1OTZjNWE5NDc5YTUyNWEyZWZiODgyMTQ=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-06-23T10:08:16Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-07-03T07:34:28Z"}, "message": "ci: provide feedback when running an image on the wrong host arch", "tree": {"sha": "da4b7a962159b5051372f6128e2da91c86ec0241", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da4b7a962159b5051372f6128e2da91c86ec0241"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1149cf04de68f45a596c5a9479a525a2efb88214", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl7+34QACgkQPgar6Auq\n8ZxQXw/8D627U7VrXIh1+Wk9N36EJpA1v+DEa3cvVbAV0gro+MtRlmkicD/5f1G3\nhV/+IKTUdiBFsBEovn8LccL2g1dl9+qyPU64Bw8UlaqmfHGDEwYcyE+CTlBChNOe\n2rT1MA3/fQDi/nMaxqcpOSMhtfqcVe4y5M3IIyZJMPqZUL5Plfx0XlzJhE/T2mNC\n7I6D6D1gD1CG5rE8iz9xEPsSPSv9g+8iLeqAmJKBeuWL80s95/FGDBLb6WRtU0nh\nbRQVtx9LcwOgVSBkNlwvXcR0he14qv5S4W79WQmKJpMrctcjjNVHgFC3+cjW5i9k\nBWqwZu18QpfGBASh6TYHtDwlAz697r6XkthSxGsg/8W+sqV729lQcpy5Oj1/Xvrn\nIR0XsODX8xMRH84ibP+m8pSJ6r7gj2VUTBMHPZktIW/ztIysTHOqwsWcU4Y6Y2OU\nMqiBtkZ/wVgPWMaUn7JXe870DrD4ac8U6Ku+PwmgT9uefhNh2+5PeeDdlwj/w1mw\nGoC5VORLoXW9U0VwoASSTtLxWr7MY6yDzoEeNOzMrNwZXV79nSkiF+0wQWkgrq0z\n2bJiSrBz4m+zV95MliVv3A+LVGhlQHlAAH/nrvsNopLTw265HAj+c1tc8hSnw2fT\nSqfnb917U6U9JRjhkNZyqPSnJg5RT0UUryvGJ+PDerIs5AAhBBE=\n=TFvl\n-----END PGP SIGNATURE-----", "payload": "tree da4b7a962159b5051372f6128e2da91c86ec0241\nparent 5c876f336a8682d2d78827e169045e9a592803f7\nauthor Pietro Albini <pietro@pietroalbini.org> 1592906896 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1593761668 +0200\n\nci: provide feedback when running an image on the wrong host arch\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1149cf04de68f45a596c5a9479a525a2efb88214", "html_url": "https://github.com/rust-lang/rust/commit/1149cf04de68f45a596c5a9479a525a2efb88214", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1149cf04de68f45a596c5a9479a525a2efb88214/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c876f336a8682d2d78827e169045e9a592803f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c876f336a8682d2d78827e169045e9a592803f7", "html_url": "https://github.com/rust-lang/rust/commit/5c876f336a8682d2d78827e169045e9a592803f7"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "44504f6a938b551c1a7de4e59e8c8bf3348591bb", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/1149cf04de68f45a596c5a9479a525a2efb88214/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1149cf04de68f45a596c5a9479a525a2efb88214/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=1149cf04de68f45a596c5a9479a525a2efb88214", "patch": "@@ -123,6 +123,28 @@ elif [ -f \"$docker_dir/disabled/$image/Dockerfile\" ]; then\n       -\n else\n     echo Invalid image: $image\n+\n+    # Check whether the image exists for other architectures\n+    for arch_dir in \"${script_dir}\"/host-*; do\n+        # Avoid checking non-directories and the current host architecture directory\n+        if ! [[ -d \"${arch_dir}\" ]]; then\n+            continue\n+        fi\n+        if [[ \"${arch_dir}\" = \"${docker_dir}\" ]]; then\n+            continue\n+        fi\n+\n+        arch_name=\"$(basename \"${arch_dir}\" | sed 's/^host-//')\"\n+        if [[ -f \"${arch_dir}/${image}/Dockerfile\" ]]; then\n+            echo \"Note: the image exists for the ${arch_name} host architecture\"\n+        elif [[ -f \"${arch_dir}/disabled/${image}/Dockerfile\" ]]; then\n+            echo \"Note: the disabled image exists for the ${arch_name} host architecture\"\n+        else\n+            continue\n+        fi\n+        echo \"Note: the current host architecture is $(uname -m)\"\n+    done\n+\n     exit 1\n fi\n "}]}