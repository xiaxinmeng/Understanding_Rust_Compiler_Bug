{"sha": "63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYzYTFlZWVhMjM0MTA1ZmQ5YzFlZDMwYWMyYjZlMGQ5YmY0MWExZTk=", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-01-18T17:55:23Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-01-18T19:38:14Z"}, "message": "Reset LateContext enclosing body in nested items\n\nPrevents LateContext::maybe_typeck_results() from returning data in a\nnested item without a body. Consequently, LateContext::qpath_res is less\nlikely to ICE when called in a nested item. Would have prevented\nrust-lang/rust-clippy#4545, presumably.", "tree": {"sha": "619b7b888f7f821b34de187309c818f135996a03", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/619b7b888f7f821b34de187309c818f135996a03"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9", "html_url": "https://github.com/rust-lang/rust/commit/63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e91c4ecc09312d8b63d250a432b0f3ef83f1df7", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e91c4ecc09312d8b63d250a432b0f3ef83f1df7", "html_url": "https://github.com/rust-lang/rust/commit/5e91c4ecc09312d8b63d250a432b0f3ef83f1df7"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "3821a393efb8b851c959a35f94135b4cf04421fa", "filename": "compiler/rustc_lint/src/late.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9/compiler%2Frustc_lint%2Fsrc%2Flate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9/compiler%2Frustc_lint%2Fsrc%2Flate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flate.rs?ref=63a1eeea234105fd9c1ed30ac2b6e0d9bf41a1e9", "patch": "@@ -140,13 +140,17 @@ impl<'tcx, T: LateLintPass<'tcx>> hir_visit::Visitor<'tcx> for LateContextAndPas\n     fn visit_item(&mut self, it: &'tcx hir::Item<'tcx>) {\n         let generics = self.context.generics.take();\n         self.context.generics = it.kind.generics();\n+        let old_cached_typeck_results = self.context.cached_typeck_results.take();\n+        let old_enclosing_body = self.context.enclosing_body.take();\n         self.with_lint_attrs(it.hir_id, &it.attrs, |cx| {\n             cx.with_param_env(it.hir_id, |cx| {\n                 lint_callback!(cx, check_item, it);\n                 hir_visit::walk_item(cx, it);\n                 lint_callback!(cx, check_item_post, it);\n             });\n         });\n+        self.context.enclosing_body = old_enclosing_body;\n+        self.context.cached_typeck_results.set(old_cached_typeck_results);\n         self.context.generics = generics;\n     }\n "}]}