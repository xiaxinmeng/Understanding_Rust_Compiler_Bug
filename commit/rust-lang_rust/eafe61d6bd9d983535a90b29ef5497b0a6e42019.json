{"sha": "eafe61d6bd9d983535a90b29ef5497b0a6e42019", "node_id": "C_kwDOAAsO6NoAKGVhZmU2MWQ2YmQ5ZDk4MzUzNWE5MGIyOWVmNTQ5N2IwYTZlNDIwMTk", "commit": {"author": {"name": "Nicholas Bishop", "email": "nbishop@nbishop.net", "date": "2022-11-20T00:03:10Z"}, "committer": {"name": "Nicholas Bishop", "email": "nbishop@nbishop.net", "date": "2022-11-20T00:03:10Z"}, "message": "dist-various-2: Use clang for the UEFI targets\n\nThis fixes an issue where the C and asm sources built by\ncompiler_builtins were being compiled as ELF objects instead of PE\nobjects. This wasn't noticed before because it doesn't cause\ncompiler_builtins or rustc to fail to build. You only see a failure when\na program is built that references one of the symbols in an ELF object.\n\nCompiling with clang fixes this because the `cc` crate converts the UEFI\ntargets into Windows targets that clang understands, causing it to\nproduce PE objects.\n\nNote that this requires compiler_builtins >= 0.1.84.\n\nFixes https://github.com/rust-lang/rust/issues/104326", "tree": {"sha": "e53f3a66bc88581d3071dfafed498a07ebf7cf89", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e53f3a66bc88581d3071dfafed498a07ebf7cf89"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eafe61d6bd9d983535a90b29ef5497b0a6e42019", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eafe61d6bd9d983535a90b29ef5497b0a6e42019", "html_url": "https://github.com/rust-lang/rust/commit/eafe61d6bd9d983535a90b29ef5497b0a6e42019", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eafe61d6bd9d983535a90b29ef5497b0a6e42019/comments", "author": {"login": "nicholasbishop", "id": 1023208, "node_id": "MDQ6VXNlcjEwMjMyMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1023208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicholasbishop", "html_url": "https://github.com/nicholasbishop", "followers_url": "https://api.github.com/users/nicholasbishop/followers", "following_url": "https://api.github.com/users/nicholasbishop/following{/other_user}", "gists_url": "https://api.github.com/users/nicholasbishop/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicholasbishop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicholasbishop/subscriptions", "organizations_url": "https://api.github.com/users/nicholasbishop/orgs", "repos_url": "https://api.github.com/users/nicholasbishop/repos", "events_url": "https://api.github.com/users/nicholasbishop/events{/privacy}", "received_events_url": "https://api.github.com/users/nicholasbishop/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nicholasbishop", "id": 1023208, "node_id": "MDQ6VXNlcjEwMjMyMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1023208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicholasbishop", "html_url": "https://github.com/nicholasbishop", "followers_url": "https://api.github.com/users/nicholasbishop/followers", "following_url": "https://api.github.com/users/nicholasbishop/following{/other_user}", "gists_url": "https://api.github.com/users/nicholasbishop/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicholasbishop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicholasbishop/subscriptions", "organizations_url": "https://api.github.com/users/nicholasbishop/orgs", "repos_url": "https://api.github.com/users/nicholasbishop/repos", "events_url": "https://api.github.com/users/nicholasbishop/events{/privacy}", "received_events_url": "https://api.github.com/users/nicholasbishop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdb6907893da1d025eba2d8cd396db4e84bca98c", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdb6907893da1d025eba2d8cd396db4e84bca98c", "html_url": "https://github.com/rust-lang/rust/commit/cdb6907893da1d025eba2d8cd396db4e84bca98c"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "93ef7dfcbf54906d2335e329f5e924e6db1fb699", "filename": "src/ci/docker/host-x86_64/dist-various-2/Dockerfile", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/eafe61d6bd9d983535a90b29ef5497b0a6e42019/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/eafe61d6bd9d983535a90b29ef5497b0a6e42019/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile?ref=eafe61d6bd9d983535a90b29ef5497b0a6e42019", "patch": "@@ -61,6 +61,12 @@ ENV \\\n     AR_i686_unknown_freebsd=i686-unknown-freebsd12-ar \\\n     CC_i686_unknown_freebsd=i686-unknown-freebsd12-clang \\\n     CXX_i686_unknown_freebsd=i686-unknown-freebsd12-clang++ \\\n+    CC_aarch64_unknown_uefi=clang-11 \\\n+    CXX_aarch64_unknown_uefi=clang++-11 \\\n+    CC_i686_unknown_uefi=clang-11 \\\n+    CXX_i686_unknown_uefi=clang++-11 \\\n+    CC_x86_64_unknown_uefi=clang-11 \\\n+    CXX_x86_64_unknown_uefi=clang++-11 \\\n     CC=gcc-8 \\\n     CXX=g++-8\n "}]}