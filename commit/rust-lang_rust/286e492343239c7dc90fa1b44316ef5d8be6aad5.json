{"sha": "286e492343239c7dc90fa1b44316ef5d8be6aad5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4NmU0OTIzNDMyMzljN2RjOTBmYTFiNDQzMTZlZjVkOGJlNmFhZDU=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-12-17T02:43:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-17T02:43:55Z"}, "message": "Rollup merge of #79051 - LeSeulArtichaut:if-let-guard, r=matthewjasper\n\nImplement if-let match guards\n\nImplements rust-lang/rfcs#2294 (tracking issue: #51114).\n\nI probably should do a few more things before this can be merged:\n- [x] Add tests (added basic tests, more advanced tests could be done in the future?)\n- [x] Add lint for exhaustive if-let guard (comparable to normal if-let statements)\n- [x] Fix clippy\n\nHowever since this is a nightly feature maybe it's fine to land this and do those steps in follow-up PRs.\n\nThanks a lot `@matthewjasper` :heart: for helping me with lowering to MIR! Would you be interested in reviewing this?\nr? `@ghost` for now", "tree": {"sha": "508d26106aa85d13cbc00a375ce80517641c34b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/508d26106aa85d13cbc00a375ce80517641c34b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/286e492343239c7dc90fa1b44316ef5d8be6aad5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/286e492343239c7dc90fa1b44316ef5d8be6aad5", "html_url": "https://github.com/rust-lang/rust/commit/286e492343239c7dc90fa1b44316ef5d8be6aad5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/286e492343239c7dc90fa1b44316ef5d8be6aad5/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39aca5ff9f5317fa1a66eb71772219575e05ba0f", "url": "https://api.github.com/repos/rust-lang/rust/commits/39aca5ff9f5317fa1a66eb71772219575e05ba0f", "html_url": "https://github.com/rust-lang/rust/commit/39aca5ff9f5317fa1a66eb71772219575e05ba0f"}, {"sha": "93c6135c153cdb67a7c39c671d85a76576a081b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/93c6135c153cdb67a7c39c671d85a76576a081b6", "html_url": "https://github.com/rust-lang/rust/commit/93c6135c153cdb67a7c39c671d85a76576a081b6"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "f839659267825b8c1f686f4f0621a3ce9a3d7e2c", "filename": "clippy_lints/src/shadow.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fshadow.rs?ref=286e492343239c7dc90fa1b44316ef5d8be6aad5", "patch": "@@ -342,6 +342,10 @@ fn check_expr<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, bindings: &mut\n                 if let Some(ref guard) = arm.guard {\n                     match guard {\n                         Guard::If(if_expr) => check_expr(cx, if_expr, bindings),\n+                        Guard::IfLet(guard_pat, guard_expr) => {\n+                            check_pat(cx, guard_pat, Some(*guard_expr), guard_pat.span, bindings);\n+                            check_expr(cx, guard_expr, bindings);\n+                        },\n                     }\n                 }\n                 check_expr(cx, &arm.body, bindings);"}, {"sha": "4249dbb4e65190d65b8674e3f59bf1d8829c9a36", "filename": "clippy_lints/src/utils/author.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Futils%2Fauthor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Futils%2Fauthor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fauthor.rs?ref=286e492343239c7dc90fa1b44316ef5d8be6aad5", "patch": "@@ -372,6 +372,18 @@ impl<'tcx> Visitor<'tcx> for PrintVisitor {\n                                 self.current = if_expr_pat;\n                                 self.visit_expr(if_expr);\n                             },\n+                            hir::Guard::IfLet(ref if_let_pat, ref if_let_expr) => {\n+                                let if_let_pat_pat = self.next(\"pat\");\n+                                let if_let_expr_pat = self.next(\"expr\");\n+                                println!(\n+                                    \"    if let Guard::IfLet(ref {}, ref {}) = {};\",\n+                                    if_let_pat_pat, if_let_expr_pat, guard_pat\n+                                );\n+                                self.current = if_let_expr_pat;\n+                                self.visit_expr(if_let_expr);\n+                                self.current = if_let_pat_pat;\n+                                self.visit_pat(if_let_pat);\n+                            },\n                         }\n                     }\n                     self.current = format!(\"{}[{}].pat\", arms_pat, i);\n@@ -730,6 +742,7 @@ fn desugaring_name(des: hir::MatchSource) -> String {\n             \"MatchSource::IfLetDesugar {{ contains_else_clause: {} }}\",\n             contains_else_clause\n         ),\n+        hir::MatchSource::IfLetGuardDesugar => \"MatchSource::IfLetGuardDesugar\".to_string(),\n         hir::MatchSource::IfDesugar { contains_else_clause } => format!(\n             \"MatchSource::IfDesugar {{ contains_else_clause: {} }}\",\n             contains_else_clause"}, {"sha": "a8fbb2ffaf0b40558babcbe096c291ff78966b11", "filename": "clippy_lints/src/utils/hir_utils.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs?ref=286e492343239c7dc90fa1b44316ef5d8be6aad5", "patch": "@@ -169,6 +169,8 @@ impl<'a, 'tcx> SpanlessEq<'a, 'tcx> {\n     fn eq_guard(&mut self, left: &Guard<'_>, right: &Guard<'_>) -> bool {\n         match (left, right) {\n             (Guard::If(l), Guard::If(r)) => self.eq_expr(l, r),\n+            (Guard::IfLet(lp, le), Guard::IfLet(rp, re)) => self.eq_pat(lp, rp) && self.eq_expr(le, re),\n+            _ => false,\n         }\n     }\n \n@@ -669,7 +671,7 @@ impl<'a, 'tcx> SpanlessHash<'a, 'tcx> {\n \n     pub fn hash_guard(&mut self, g: &Guard<'_>) {\n         match g {\n-            Guard::If(ref expr) => {\n+            Guard::If(ref expr) | Guard::IfLet(_, ref expr) => {\n                 self.hash_expr(expr);\n             },\n         }"}, {"sha": "5d946e4bd495d9abbb6e1fcdf439c3b4187dba07", "filename": "clippy_lints/src/utils/inspector.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/286e492343239c7dc90fa1b44316ef5d8be6aad5/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finspector.rs?ref=286e492343239c7dc90fa1b44316ef5d8be6aad5", "patch": "@@ -560,5 +560,10 @@ fn print_guard(cx: &LateContext<'_>, guard: &hir::Guard<'_>, indent: usize) {\n             println!(\"{}If\", ind);\n             print_expr(cx, expr, indent + 1);\n         },\n+        hir::Guard::IfLet(pat, expr) => {\n+            println!(\"{}IfLet\", ind);\n+            print_pat(cx, pat, indent + 1);\n+            print_expr(cx, expr, indent + 1);\n+        },\n     }\n }"}]}