{"sha": "a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2M2Y4YzFjYWM3N2E3YjY5ZTFhYTNmMjVjYjM3ZjViODI5OWQxZmM=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2020-09-16T19:24:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-09-16T19:24:06Z"}, "message": "Rollup merge of #76719 - hameerabbasi:min-const-generics-ty, r=lcnr\n\nChange error message for ty param in const\n\nThis PR introduces the following changes:\n\n* Change error message for type param in a const expression when using\n`min_const_generics`\n* Change `ParamInNonTrivialAnonConst` to contain an extra `bool` used for\ndistinguishing whether the passed-in symbol is a type or a value.\n\nFixes #76701", "tree": {"sha": "f5881dd41de65149e52f027441949651d1db2572", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f5881dd41de65149e52f027441949651d1db2572"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfYmZXCRBK7hj4Ov3rIwAAdHIIAHBlaaeELxQsS0R//fBvTedZ\nfkxMfwAXNq/xYcG86nxKhk4nVf20TGy1wTAN5TJ162aNuM3pEg/am6Pzk7GdGeRp\nvFXQpQl1WoBR+3UNntkPGuwu9D/g/oHX7QHpN0Os6x+Zc0dI9T4MTLSkw7XxZa+H\nRaGpp2KsQZB1v/BfJqraftVdnSbL2HhpjJl4kFA1CSMB2g+lgh6kJsDgwmm7Clat\nZip7lD0fmGTYKUsiIqG09ptS9olBtZAbv2OTpJfO3chIVRyxKmOW+Jn3+qP8hl8/\njqWVE4e3CUp5BU2nGJGBfp72AVTcPRz+ZD6GaUMoJ7aAAjnBeBSyvwgwC0BtfeA=\n=9Ptw\n-----END PGP SIGNATURE-----\n", "payload": "tree f5881dd41de65149e52f027441949651d1db2572\nparent ece688bae9cbbd82fc6c8010b263f66aaab92f57\nparent 5f0b77539011a5a5297beda420d70f6ab22b2e7e\nauthor Tyler Mandry <tmandry@gmail.com> 1600284246 -0700\ncommitter GitHub <noreply@github.com> 1600284246 -0700\n\nRollup merge of #76719 - hameerabbasi:min-const-generics-ty, r=lcnr\n\nChange error message for ty param in const\n\nThis PR introduces the following changes:\n\n* Change error message for type param in a const expression when using\n`min_const_generics`\n* Change `ParamInNonTrivialAnonConst` to contain an extra `bool` used for\ndistinguishing whether the passed-in symbol is a type or a value.\n\nFixes #76701\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "html_url": "https://github.com/rust-lang/rust/commit/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ece688bae9cbbd82fc6c8010b263f66aaab92f57", "url": "https://api.github.com/repos/rust-lang/rust/commits/ece688bae9cbbd82fc6c8010b263f66aaab92f57", "html_url": "https://github.com/rust-lang/rust/commit/ece688bae9cbbd82fc6c8010b263f66aaab92f57"}, {"sha": "5f0b77539011a5a5297beda420d70f6ab22b2e7e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f0b77539011a5a5297beda420d70f6ab22b2e7e", "html_url": "https://github.com/rust-lang/rust/commit/5f0b77539011a5a5297beda420d70f6ab22b2e7e"}], "stats": {"total": 94, "additions": 80, "deletions": 14}, "files": [{"sha": "612bc3e74911c44d788189c4398b2cf2b50936c9", "filename": "compiler/rustc_resolve/src/diagnostics.rs", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -466,7 +466,7 @@ impl<'a> Resolver<'a> {\n                 );\n                 err\n             }\n-            ResolutionError::ParamInNonTrivialAnonConst(name) => {\n+            ResolutionError::ParamInNonTrivialAnonConst { name, is_type } => {\n                 let mut err = self.session.struct_span_err(\n                     span,\n                     \"generic parameters must not be used inside of non trivial constant values\",\n@@ -478,9 +478,17 @@ impl<'a> Resolver<'a> {\n                         name\n                     ),\n                 );\n-                err.help(\n-                    &format!(\"it is currently only allowed to use either `{0}` or `{{ {0} }}` as generic constants\", name)\n-                );\n+\n+                if is_type {\n+                    err.note(\"type parameters are currently not permitted in anonymous constants\");\n+                } else {\n+                    err.help(\n+                        &format!(\"it is currently only allowed to use either `{0}` or `{{ {0} }}` as generic constants\",\n+                                 name\n+                        )\n+                    );\n+                }\n+\n                 err\n             }\n             ResolutionError::SelfInTyParamDefault => {"}, {"sha": "85ddc5f55d110b389f288f839c35e2eb50417831", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -221,7 +221,7 @@ enum ResolutionError<'a> {\n     /// generic parameters must not be used inside of non trivial constant values.\n     ///\n     /// This error is only emitted when using `min_const_generics`.\n-    ParamInNonTrivialAnonConst(Symbol),\n+    ParamInNonTrivialAnonConst { name: Symbol, is_type: bool },\n     /// Error E0735: type parameters with a default cannot use `Self`\n     SelfInTyParamDefault,\n     /// Error E0767: use of unreachable label\n@@ -2638,9 +2638,10 @@ impl<'a> Resolver<'a> {\n                                     if record_used {\n                                         self.report_error(\n                                             span,\n-                                            ResolutionError::ParamInNonTrivialAnonConst(\n-                                                rib_ident.name,\n-                                            ),\n+                                            ResolutionError::ParamInNonTrivialAnonConst {\n+                                                name: rib_ident.name,\n+                                                is_type: true,\n+                                            },\n                                         );\n                                     }\n                                     return Res::Err;\n@@ -2718,7 +2719,10 @@ impl<'a> Resolver<'a> {\n                                 if record_used {\n                                     self.report_error(\n                                         span,\n-                                        ResolutionError::ParamInNonTrivialAnonConst(rib_ident.name),\n+                                        ResolutionError::ParamInNonTrivialAnonConst {\n+                                            name: rib_ident.name,\n+                                            is_type: false,\n+                                        },\n                                     );\n                                 }\n                                 return Res::Err;"}, {"sha": "07822f86f524b621e6c60f28ef5de0d35a88486e", "filename": "src/test/ui/const-generics/issues/issue-64494.min.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-64494.min.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-64494.min.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-64494.min.stderr?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -4,15 +4,15 @@ error: generic parameters must not be used inside of non trivial constant values\n LL | impl<T: Foo> MyTrait for T where Is<{T::VAL == 5}>: True {}\n    |                                      ^^^^^^ non-trivial anonymous constants must not depend on the parameter `T`\n    |\n-   = help: it is currently only allowed to use either `T` or `{ T }` as generic constants\n+   = note: type parameters are currently not permitted in anonymous constants\n \n error: generic parameters must not be used inside of non trivial constant values\n   --> $DIR/issue-64494.rs:19:38\n    |\n LL | impl<T: Foo> MyTrait for T where Is<{T::VAL == 6}>: True {}\n    |                                      ^^^^^^ non-trivial anonymous constants must not depend on the parameter `T`\n    |\n-   = help: it is currently only allowed to use either `T` or `{ T }` as generic constants\n+   = note: type parameters are currently not permitted in anonymous constants\n \n error[E0119]: conflicting implementations of trait `MyTrait`:\n   --> $DIR/issue-64494.rs:19:1"}, {"sha": "68f1733decb93e03d1a455db3cae59714d522a8c", "filename": "src/test/ui/const-generics/issues/issue-67739.min.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-67739.min.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-67739.min.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-67739.min.stderr?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -4,7 +4,7 @@ error: generic parameters must not be used inside of non trivial constant values\n LL |         [0u8; mem::size_of::<Self::Associated>()];\n    |                              ^^^^^^^^^^^^^^^^ non-trivial anonymous constants must not depend on the parameter `Self`\n    |\n-   = help: it is currently only allowed to use either `Self` or `{ Self }` as generic constants\n+   = note: type parameters are currently not permitted in anonymous constants\n \n error: aborting due to previous error\n "}, {"sha": "089937e66ca06bea2e3ff116bfebb0917b01f843", "filename": "src/test/ui/const-generics/issues/issue-76701-ty-param-in-const.full.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.full.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.full.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.full.stderr?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -0,0 +1,18 @@\n+error: constant expression depends on a generic parameter\n+  --> $DIR/issue-76701-ty-param-in-const.rs:6:21\n+   |\n+LL | fn ty_param<T>() -> [u8; std::mem::size_of::<T>()] {\n+   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this may fail depending on what value the parameter takes\n+\n+error: constant expression depends on a generic parameter\n+  --> $DIR/issue-76701-ty-param-in-const.rs:12:37\n+   |\n+LL | fn const_param<const N: usize>() -> [u8; N + 1] {\n+   |                                     ^^^^^^^^^^^\n+   |\n+   = note: this may fail depending on what value the parameter takes\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "a39495e0b2db016bcf689b6683814ad17b0aec2c", "filename": "src/test/ui/const-generics/issues/issue-76701-ty-param-in-const.min.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.min.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.min.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.min.stderr?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -0,0 +1,18 @@\n+error: generic parameters must not be used inside of non trivial constant values\n+  --> $DIR/issue-76701-ty-param-in-const.rs:6:46\n+   |\n+LL | fn ty_param<T>() -> [u8; std::mem::size_of::<T>()] {\n+   |                                              ^ non-trivial anonymous constants must not depend on the parameter `T`\n+   |\n+   = note: type parameters are currently not permitted in anonymous constants\n+\n+error: generic parameters must not be used inside of non trivial constant values\n+  --> $DIR/issue-76701-ty-param-in-const.rs:12:42\n+   |\n+LL | fn const_param<const N: usize>() -> [u8; N + 1] {\n+   |                                          ^ non-trivial anonymous constants must not depend on the parameter `N`\n+   |\n+   = help: it is currently only allowed to use either `N` or `{ N }` as generic constants\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "9252b592360d32888db7a4a40e01a267aa89e3d6", "filename": "src/test/ui/const-generics/issues/issue-76701-ty-param-in-const.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-76701-ty-param-in-const.rs?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -0,0 +1,18 @@\n+// revisions: full min\n+#![cfg_attr(full, feature(const_generics))]\n+#![cfg_attr(full, allow(incomplete_features))]\n+#![cfg_attr(min, feature(min_const_generics))]\n+\n+fn ty_param<T>() -> [u8; std::mem::size_of::<T>()] {\n+    //[full]~^ ERROR constant expression depends on a generic parameter\n+    //[min]~^^ ERROR generic parameters must not be used inside of non trivial constant values\n+    todo!()\n+}\n+\n+fn const_param<const N: usize>() -> [u8; N + 1] {\n+    //[full]~^ ERROR constant expression depends on a generic parameter\n+    //[min]~^^ ERROR generic parameters must not be used inside of non trivial constant values\n+    todo!()\n+}\n+\n+fn main() {}"}, {"sha": "edb77a87430611c09c59161cba91d0a556f12f36", "filename": "src/test/ui/const-generics/min_const_generics/self-ty-in-const-1.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fmin_const_generics%2Fself-ty-in-const-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fmin_const_generics%2Fself-ty-in-const-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fmin_const_generics%2Fself-ty-in-const-1.stderr?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -4,7 +4,7 @@ error: generic parameters must not be used inside of non trivial constant values\n LL |     fn t1() -> [u8; std::mem::size_of::<Self>()];\n    |                                         ^^^^ non-trivial anonymous constants must not depend on the parameter `Self`\n    |\n-   = help: it is currently only allowed to use either `Self` or `{ Self }` as generic constants\n+   = note: type parameters are currently not permitted in anonymous constants\n \n error: generic `Self` types are currently not permitted in anonymous constants\n   --> $DIR/self-ty-in-const-1.rs:14:41"}, {"sha": "e545ae8571f67d7ee7780bd20ddea1a02629f093", "filename": "src/test/ui/const-generics/params-in-ct-in-ty-param-lazy-norm.min.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fparams-in-ct-in-ty-param-lazy-norm.min.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc/src%2Ftest%2Fui%2Fconst-generics%2Fparams-in-ct-in-ty-param-lazy-norm.min.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fparams-in-ct-in-ty-param-lazy-norm.min.stderr?ref=a63f8c1cac77a7b69e1aa3f25cb37f5b8299d1fc", "patch": "@@ -12,7 +12,7 @@ error: generic parameters must not be used inside of non trivial constant values\n LL | struct Foo<T, U = [u8; std::mem::size_of::<T>()]>(T, U);\n    |                                            ^ non-trivial anonymous constants must not depend on the parameter `T`\n    |\n-   = help: it is currently only allowed to use either `T` or `{ T }` as generic constants\n+   = note: type parameters are currently not permitted in anonymous constants\n \n error: constant values inside of type parameter defaults must not depend on generic parameters\n   --> $DIR/params-in-ct-in-ty-param-lazy-norm.rs:12:21"}]}