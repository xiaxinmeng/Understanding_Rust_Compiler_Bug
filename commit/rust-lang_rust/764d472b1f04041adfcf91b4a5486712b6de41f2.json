{"sha": "764d472b1f04041adfcf91b4a5486712b6de41f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2NGQ0NzJiMWYwNDA0MWFkZmNmOTFiNGE1NDg2NzEyYjZkZTQxZjI=", "commit": {"author": {"name": "Lukas Kalbertodt", "email": "lukas.kalbertodt@gmail.com", "date": "2018-08-07T20:38:14Z"}, "committer": {"name": "Lukas Kalbertodt", "email": "lukas.kalbertodt@gmail.com", "date": "2018-08-07T21:08:34Z"}, "message": "Make `IndexMut` note apply to more cases\n\nPreviously it was only emitted for assigments, which was an\nunnecessary restriction. Now it doesn't care where the mutability\ncomes from.\n\nThis commit also adds `` quotes around the printed type.", "tree": {"sha": "f9f580188b9d9586c1958033c987663c2c9d2c4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f9f580188b9d9586c1958033c987663c2c9d2c4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/764d472b1f04041adfcf91b4a5486712b6de41f2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEENwctvZ5TgcKYXim8PLr0FT+BhicFAltqCmYACgkQPLr0FT+B\nhie1Zw/+O7+8Hih7YXfI5ARzv5a06AXruuAJhqK3zlDWOpaGd6MuayCIzU1KS6Vo\ne/Z+muEAuAX7AtvBbw/5oZXxtDbd1mD6/qJ8VFuhuHKs8P/WyMtPLtXWRWk1rHI6\nF6DEG0UDLh+6VOmhotKyxVF9rUjn5ldsj6JeH9gfF3vgDETFvjkCuYYzRxYceg28\nvRunscXmtRXNjJipfovH4aioxYXvUWbgrU2KIvAB/XAlGEGXzdYaCIKfrIiwAcji\nS/HMdVVyK5zfDMRG9geYWfCCksqBmHQA/a4EIqg+2cUX4iC7cxjCVixHiUakq8Zn\nE26c+V+0ADwdH/sF4Ow4rrGw0rrC3zt6cTuWoN100F5uTmN16waEf50TLUoCrl3U\nCTd6vlXuLpaRVJAGK2vRuZvm2ZRI7oPibS2sefNKmjJ6DqyzyjyTKy9l+R8GAQcz\n3NV/uEWaUi27RPvaaLsup564JX0XjZiceuIyS2y6gn2wz8ZdKll19/OYDFlSBFMJ\nPvyya5dy7SUk3pU4G7Wk3HDWr1iPALa0+jMF/sLBhJEh1Mcyapr6ZkEDQ37gHwub\nsr5zI7MiQXY1+63tZo7gXhhhC2xuUpCNepUoQTuyjU7PKWgyhgncr0cEQXKKzz8I\njaDaJkQXMUeB/30+nb7XjLYSr/Dibp56sTyMpJqi0Tg+2zk1/4w=\n=KHA2\n-----END PGP SIGNATURE-----", "payload": "tree f9f580188b9d9586c1958033c987663c2c9d2c4f\nparent 9d59c6b76e96005201d3b66dae946cc01dc5e565\nauthor Lukas Kalbertodt <lukas.kalbertodt@gmail.com> 1533674294 +0200\ncommitter Lukas Kalbertodt <lukas.kalbertodt@gmail.com> 1533676114 +0200\n\nMake `IndexMut` note apply to more cases\n\nPreviously it was only emitted for assigments, which was an\nunnecessary restriction. Now it doesn't care where the mutability\ncomes from.\n\nThis commit also adds `` quotes around the printed type.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/764d472b1f04041adfcf91b4a5486712b6de41f2", "html_url": "https://github.com/rust-lang/rust/commit/764d472b1f04041adfcf91b4a5486712b6de41f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/764d472b1f04041adfcf91b4a5486712b6de41f2/comments", "author": {"login": "LukasKalbertodt", "id": 7419664, "node_id": "MDQ6VXNlcjc0MTk2NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7419664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukasKalbertodt", "html_url": "https://github.com/LukasKalbertodt", "followers_url": "https://api.github.com/users/LukasKalbertodt/followers", "following_url": "https://api.github.com/users/LukasKalbertodt/following{/other_user}", "gists_url": "https://api.github.com/users/LukasKalbertodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukasKalbertodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukasKalbertodt/subscriptions", "organizations_url": "https://api.github.com/users/LukasKalbertodt/orgs", "repos_url": "https://api.github.com/users/LukasKalbertodt/repos", "events_url": "https://api.github.com/users/LukasKalbertodt/events{/privacy}", "received_events_url": "https://api.github.com/users/LukasKalbertodt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "LukasKalbertodt", "id": 7419664, "node_id": "MDQ6VXNlcjc0MTk2NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7419664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukasKalbertodt", "html_url": "https://github.com/LukasKalbertodt", "followers_url": "https://api.github.com/users/LukasKalbertodt/followers", "following_url": "https://api.github.com/users/LukasKalbertodt/following{/other_user}", "gists_url": "https://api.github.com/users/LukasKalbertodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukasKalbertodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukasKalbertodt/subscriptions", "organizations_url": "https://api.github.com/users/LukasKalbertodt/orgs", "repos_url": "https://api.github.com/users/LukasKalbertodt/repos", "events_url": "https://api.github.com/users/LukasKalbertodt/events{/privacy}", "received_events_url": "https://api.github.com/users/LukasKalbertodt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d59c6b76e96005201d3b66dae946cc01dc5e565", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d59c6b76e96005201d3b66dae946cc01dc5e565", "html_url": "https://github.com/rust-lang/rust/commit/9d59c6b76e96005201d3b66dae946cc01dc5e565"}], "stats": {"total": 44, "additions": 22, "deletions": 22}, "files": [{"sha": "2e16e316a18bd819de7d085cf39d2a6742b5821e", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/764d472b1f04041adfcf91b4a5486712b6de41f2/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/764d472b1f04041adfcf91b4a5486712b6de41f2/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=764d472b1f04041adfcf91b4a5486712b6de41f2", "patch": "@@ -882,28 +882,6 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                             }\n                         }\n \n-                        // We add a special note about `IndexMut`, if the source of this error\n-                        // is the fact that `Index` is implemented, but `IndexMut` is not. Needing\n-                        // to implement two traits for \"one operator\" is not very intuitive for\n-                        // many programmers.\n-                        if err.cmt.note == mc::NoteIndex {\n-                            let node_id = self.tcx.hir.hir_to_node_id(err.cmt.hir_id);\n-                            let node =  self.tcx.hir.get(node_id);\n-\n-                            // This pattern probably always matches.\n-                            if let hir_map::NodeExpr(\n-                                hir::Expr { node: hir::ExprKind::Index(lhs, _), ..}\n-                            ) = node {\n-                                let ty = self.tables.expr_ty(lhs);\n-\n-                                db.help(&format!(\n-                                    \"trait `IndexMut` is required to modify indexed content, but \\\n-                                     it is not implemented for {}\",\n-                                    ty\n-                                ));\n-                            }\n-                        }\n-\n                         db\n                     }\n                     BorrowViolation(euv::ClosureCapture(_)) => {\n@@ -924,6 +902,28 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                     }\n                 };\n \n+                // We add a special note about `IndexMut`, if the source of this error\n+                // is the fact that `Index` is implemented, but `IndexMut` is not. Needing\n+                // to implement two traits for \"one operator\" is not very intuitive for\n+                // many programmers.\n+                if err.cmt.note == mc::NoteIndex {\n+                    let node_id = self.tcx.hir.hir_to_node_id(err.cmt.hir_id);\n+                    let node =  self.tcx.hir.get(node_id);\n+\n+                    // This pattern probably always matches.\n+                    if let hir_map::NodeExpr(\n+                        hir::Expr { node: hir::ExprKind::Index(lhs, _), ..}\n+                    ) = node {\n+                        let ty = self.tables.expr_ty(lhs);\n+\n+                        db.help(&format!(\n+                            \"trait `IndexMut` is required to modify indexed content, but \\\n+                             it is not implemented for `{}`\",\n+                            ty\n+                        ));\n+                    }\n+                }\n+\n                 self.note_and_explain_mutbl_error(&mut db, &err, &error_span);\n                 self.note_immutability_blame(\n                     &mut db,"}]}