{"sha": "43b9268592187e9d757e68ae0cf10ee3da68e424", "node_id": "C_kwDOAAsO6NoAKDQzYjkyNjg1OTIxODdlOWQ3NTdlNjhhZTBjZjEwZWUzZGE2OGU0MjQ", "commit": {"author": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2022-01-12T23:05:47Z"}, "committer": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2022-01-17T19:45:28Z"}, "message": "Rustdoc style cleanups\n\n - Make \"since\" version numbers grey again (regressed in #92602).\n - Remove unneeded selectors for when crate filter dropdown is a\n   sibling of search-input.\n - Crate filter dropdown doesn't need to be 100% width on mobile.\n - Only build crate filter dropdown when there is more than one crate.\n - Remove unused addCrateDropdown.", "tree": {"sha": "faf663f62fd6cfbcb4e2fb5b47f6dc262456ce82", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/faf663f62fd6cfbcb4e2fb5b47f6dc262456ce82"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/43b9268592187e9d757e68ae0cf10ee3da68e424", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/43b9268592187e9d757e68ae0cf10ee3da68e424", "html_url": "https://github.com/rust-lang/rust/commit/43b9268592187e9d757e68ae0cf10ee3da68e424", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/43b9268592187e9d757e68ae0cf10ee3da68e424/comments", "author": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ee5d8d37baaf5b5a81a98396952839c73ae41c68", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee5d8d37baaf5b5a81a98396952839c73ae41c68", "html_url": "https://github.com/rust-lang/rust/commit/ee5d8d37baaf5b5a81a98396952839c73ae41c68"}], "stats": {"total": 67, "additions": 21, "deletions": 46}, "files": [{"sha": "14b5c851b21a9ed340ae31400c1d6ec175982d58", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=43b9268592187e9d757e68ae0cf10ee3da68e424", "patch": "@@ -934,11 +934,6 @@ h2.small-section-header > .anchor {\n \twidth: 100%;\n }\n \n-#crate-search + .search-input {\n-\tborder-radius: 0 1px 1px 0;\n-\twidth: calc(100% - 32px);\n-}\n-\n .search-input:focus {\n \tborder-radius: 2px;\n \tborder: 0;\n@@ -2070,16 +2065,10 @@ details.rustdoc-toggle[open] > summary.hideme::after {\n \t}\n \n \t#crate-search {\n-\t\twidth: 100%;\n \t\tborder-radius: 4px;\n \t\tborder: 0;\n \t}\n \n-\t#crate-search + .search-input {\n-\t\twidth: calc(100% + 71px);\n-\t\tmargin-left: -36px;\n-\t}\n-\n \t#theme-picker, #settings-menu {\n \t\tpadding: 5px;\n \t\twidth: 31px;"}, {"sha": "885fe7c09a9732dbda3f3872c54e722101a45b75", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=43b9268592187e9d757e68ae0cf10ee3da68e424", "patch": "@@ -299,7 +299,8 @@ details.undocumented > summary::before {\n \tborder-color: #5c6773;\n }\n \n-.since {\n+.rightside,\n+.out-of-band {\n \tcolor: grey;\n }\n "}, {"sha": "71af77978328f0a99ab0d3c6b737776e6c499390", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=43b9268592187e9d757e68ae0cf10ee3da68e424", "patch": "@@ -256,7 +256,8 @@ details.undocumented > summary::before {\n \tbackground: rgba(0,0,0,0);\n }\n \n-.since {\n+.rightside,\n+.out-of-band {\n \tcolor: grey;\n }\n "}, {"sha": "e462fd16237f2b2d6388a94dbe0d28220dd2b8a2", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=43b9268592187e9d757e68ae0cf10ee3da68e424", "patch": "@@ -243,6 +243,11 @@ details.undocumented > summary::before {\n \tborder-color: #bfbfbf;\n }\n \n+.rightside,\n+.out-of-band {\n+\tcolor: grey;\n+}\n+\n .result-name .primitive > i, .result-name .keyword > i {\n \tcolor: black;\n }"}, {"sha": "f944398272677e797ce2b254e55122ccdee059fe", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 0, "deletions": 27, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=43b9268592187e9d757e68ae0cf10ee3da68e424", "patch": "@@ -283,9 +283,6 @@ function hideThemeButtonState() {\n                 loadSearch();\n             }\n \n-            // `crates{version}.js` should always be loaded before this script, so we can use it\n-            // safely.\n-            searchState.addCrateDropdown(window.ALL_CRATES);\n             var params = searchState.getQueryStringParams();\n             if (params.search !== undefined) {\n                 var search = searchState.outputElement();\n@@ -295,30 +292,6 @@ function hideThemeButtonState() {\n                 loadSearch();\n             }\n         },\n-        addCrateDropdown: function(crates) {\n-            var elem = document.getElementById(\"crate-search\");\n-\n-            if (!elem) {\n-                return;\n-            }\n-            var savedCrate = getSettingValue(\"saved-filter-crate\");\n-            for (var i = 0, len = crates.length; i < len; ++i) {\n-                var option = document.createElement(\"option\");\n-                option.value = crates[i];\n-                option.innerText = crates[i];\n-                elem.appendChild(option);\n-                // Set the crate filter from saved storage, if the current page has the saved crate\n-                // filter.\n-                //\n-                // If not, ignore the crate filter -- we want to support filtering for crates on\n-                // sites like doc.rust-lang.org where the crates may differ from page to page while\n-                // on the\n-                // same domain.\n-                if (crates[i] === savedCrate) {\n-                    elem.value = savedCrate;\n-                }\n-            }\n-        },\n     };\n \n     function getPageId() {"}, {"sha": "104464b3881147a476802deb439b6bcf6ac5e274", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/43b9268592187e9d757e68ae0cf10ee3da68e424/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=43b9268592187e9d757e68ae0cf10ee3da68e424", "patch": "@@ -1126,15 +1126,18 @@ window.initSearch = function(rawSearchIndex) {\n             }\n         }\n \n-        let crates = `<select id=\"crate-search\"><option value=\"All crates\">All crates</option>`;\n-        for (let c of window.ALL_CRATES) {\n-            crates += `<option value=\"${c}\" ${c == filterCrates && \"selected\"}>${c}</option>`;\n+        let crates = \"\";\n+        if (window.ALL_CRATES.length > 1) {\n+            crates = ` in <select id=\"crate-search\"><option value=\"All crates\">All crates</option>`;\n+            for (let c of window.ALL_CRATES) {\n+                crates += `<option value=\"${c}\" ${c == filterCrates && \"selected\"}>${c}</option>`;\n+            }\n+            crates += `</select>`;\n         }\n-        crates += `</select>`;\n         var output = `<div id=\"search-settings\">\n             <h1 class=\"search-results-title\">Results for ${escape(query.query)} ` +\n             (query.type ? \" (type: \" + escape(query.type) + \")\" : \"\") + \"</h1>\" +\n-            ` in ${crates} ` +\n+            crates +\n             `</div><div id=\"titles\">` +\n             makeTabHeader(0, \"In Names\", ret_others[1]) +\n             makeTabHeader(1, \"In Parameters\", ret_in_args[1]) +\n@@ -1148,7 +1151,10 @@ window.initSearch = function(rawSearchIndex) {\n         resultsElem.appendChild(ret_returned[0]);\n \n         search.innerHTML = output;\n-        document.getElementById(\"crate-search\").addEventListener(\"input\", updateCrate);\n+        let crateSearch = document.getElementById(\"crate-search\");\n+        if (crateSearch) {\n+            crateSearch.addEventListener(\"input\", updateCrate);\n+        }\n         search.appendChild(resultsElem);\n         // Reset focused elements.\n         searchState.focusedByTab = [null, null, null];"}]}