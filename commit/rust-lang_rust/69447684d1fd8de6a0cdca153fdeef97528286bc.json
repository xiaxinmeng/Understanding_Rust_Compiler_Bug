{"sha": "69447684d1fd8de6a0cdca153fdeef97528286bc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5NDQ3Njg0ZDFmZDhkZTZhMGNkY2ExNTNmZGVlZjk3NTI4Mjg2YmM=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-10-12T08:14:26Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-10-12T17:58:44Z"}, "message": "Rollup merge of #45121 - johnthagen:pep8-bootstrap, r=alexcrichton\n\nFix PEP8 style issues in bootstrap code\n\nThis fixes PEP8 style issues (other than line-length) in the bootstrap Python code.\n\nThe most important fix is in the `set` function where the code was indented with 6 spaces instead of 4.", "tree": {"sha": "84f16b98d1406ff8a3854355dd5ca4139b0d7a89", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84f16b98d1406ff8a3854355dd5ca4139b0d7a89"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69447684d1fd8de6a0cdca153fdeef97528286bc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlnfrVQACgkQ/vbIBR0O\nATwwdg//f8CFPpwnbmyt7cED4OEaX08+FSB17Wp1KFYfXZkPyXD7TmBzyVr9ycr+\nDsBrkN21MHSYAWVIRmOVKKsB9UVYHzn8BnSlD2UJIbK6FEs+8lD20Df0v3ftusgI\naJL6eT2+9DolLHnVCT+y3E5ODSN3a0o80LtNGtY6hhlRt2AUzyU9AHGu/6LRAAQG\nr+8S8mjKJ642pBHJq/MyBv2pOBnm8ftnRIeC0Rk7MdfNAIkWSc/6bgVeHxc8r55v\n11T4T02L/Vja/6kiL4OUp5SGLao3XbQr/0UHJ3od/Fw2v1rhW7QhkmE5BG+Qb7qc\nkMK7ez4xTdpCNtciRGMg7QGmwToVWPmk82kDHjRYfIT9Lmnmyj70tW8M5rJpkli9\n9zuXJJ7TwG4YjUtNKnH9FV3/5AM5SLyhmCBjyQS9xBBTishuirxhVLV8f1pN+rYx\n9y56EViph7A2ZphiGew1rZvJ4gkesk6QgBqYp2YVQS5r5F1ushQPBVLjmOtSQ/bN\nwy7OBsvWNE2QEqt7UoJiGluVbitJs1F5ShD7iJdyzXWwzOonXE++ztKAc4v95LIv\nYlEUBF92ZQXSREKaZJSV9T6TbEWfKSDeKRi9MX+ygTL2qUy70xV2x7UdGhTt3tZD\nJaUdiAAm+jNeuxFurqZHWoBke3gQWA76gn0IscVv1W1ODRJ39S8=\n=8cRO\n-----END PGP SIGNATURE-----", "payload": "tree 84f16b98d1406ff8a3854355dd5ca4139b0d7a89\nparent ff53dc7166e628bd6853a3c9b01d056ec61b1959\nparent 3cb52949666fee2005402e71b879742f5baecf25\nauthor kennytm <kennytm@gmail.com> 1507796066 +0800\ncommitter kennytm <kennytm@gmail.com> 1507831124 +0800\n\nRollup merge of #45121 - johnthagen:pep8-bootstrap, r=alexcrichton\n\nFix PEP8 style issues in bootstrap code\n\nThis fixes PEP8 style issues (other than line-length) in the bootstrap Python code.\n\nThe most important fix is in the `set` function where the code was indented with 6 spaces instead of 4.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69447684d1fd8de6a0cdca153fdeef97528286bc", "html_url": "https://github.com/rust-lang/rust/commit/69447684d1fd8de6a0cdca153fdeef97528286bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69447684d1fd8de6a0cdca153fdeef97528286bc/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff53dc7166e628bd6853a3c9b01d056ec61b1959", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff53dc7166e628bd6853a3c9b01d056ec61b1959", "html_url": "https://github.com/rust-lang/rust/commit/ff53dc7166e628bd6853a3c9b01d056ec61b1959"}, {"sha": "3cb52949666fee2005402e71b879742f5baecf25", "url": "https://api.github.com/repos/rust-lang/rust/commits/3cb52949666fee2005402e71b879742f5baecf25", "html_url": "https://github.com/rust-lang/rust/commit/3cb52949666fee2005402e71b879742f5baecf25"}], "stats": {"total": 49, "additions": 32, "deletions": 17}, "files": [{"sha": "64f76aa2ef43f645b29d7d402fae63fb06b9507e", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/69447684d1fd8de6a0cdca153fdeef97528286bc/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/69447684d1fd8de6a0cdca153fdeef97528286bc/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=69447684d1fd8de6a0cdca153fdeef97528286bc", "patch": "@@ -302,6 +302,7 @@ def default_build_triple():\n \n     return \"{}-{}\".format(cputype, ostype)\n \n+\n class RustBuild(object):\n     \"\"\"Provide all the methods required to build Rust\"\"\"\n     def __init__(self):"}, {"sha": "73ce82287e7ab5f4078a4e0124a7a071c8d3bdd9", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 31, "deletions": 17, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/69447684d1fd8de6a0cdca153fdeef97528286bc/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/69447684d1fd8de6a0cdca153fdeef97528286bc/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=69447684d1fd8de6a0cdca153fdeef97528286bc", "patch": "@@ -19,21 +19,26 @@\n sys.path.append(os.path.join(rust_dir, \"src\", \"bootstrap\"))\n import bootstrap\n \n+\n class Option:\n     def __init__(self, name, rustbuild, desc, value):\n         self.name = name\n         self.rustbuild = rustbuild\n         self.desc = desc\n         self.value = value\n \n+\n options = []\n \n+\n def o(*args):\n     options.append(Option(*args, value=False))\n \n+\n def v(*args):\n     options.append(Option(*args, value=True))\n \n+\n o(\"debug\", \"rust.debug\", \"debug mode; disables optimization unless `--enable-optimize` given\")\n o(\"docs\", \"build.docs\", \"build standard library documentation\")\n o(\"compiler-docs\", \"build.compiler-docs\", \"build compiler documentation\")\n@@ -136,13 +141,16 @@ def v(*args):\n \n v(\"set\", None, \"set arbitrary key/value pairs in TOML configuration\")\n \n+\n def p(msg):\n     print(\"configure: \" + msg)\n \n+\n def err(msg):\n     print(\"configure: error: \" + msg)\n     sys.exit(1)\n \n+\n if '--help' in sys.argv or '-h' in sys.argv:\n     print('Usage: ./configure [options]')\n     print('')\n@@ -208,7 +216,7 @@ def err(msg):\n                 continue\n \n         found = True\n-        if not option.name in known_args:\n+        if option.name not in known_args:\n             known_args[option.name] = []\n         known_args[option.name].append((option, value))\n         break\n@@ -227,27 +235,30 @@ def err(msg):\n # TOML we're going to write out\n config = {}\n \n+\n def build():\n     if 'build' in known_args:\n         return known_args['build'][0][1]\n     return bootstrap.default_build_triple()\n \n+\n def set(key, value):\n-      s = \"{:20} := {}\".format(key, value)\n-      if len(s) < 70:\n-          p(s)\n-      else:\n-          p(s[:70] + \" ...\")\n-\n-      arr = config\n-      parts = key.split('.')\n-      for i, part in enumerate(parts):\n-          if i == len(parts) - 1:\n-              arr[part] = value\n-          else:\n-              if not part in arr:\n-                  arr[part] = {}\n-              arr = arr[part]\n+    s = \"{:20} := {}\".format(key, value)\n+    if len(s) < 70:\n+        p(s)\n+    else:\n+        p(s[:70] + \" ...\")\n+\n+    arr = config\n+    parts = key.split('.')\n+    for i, part in enumerate(parts):\n+        if i == len(parts) - 1:\n+            arr[part] = value\n+        else:\n+            if part not in arr:\n+                arr[part] = {}\n+            arr = arr[part]\n+\n \n for key in known_args:\n     # The `set` option is special and can be passed a bunch of times\n@@ -345,6 +356,7 @@ def set(key, value):\n     targets[target] = sections['target'][:]\n     targets[target][0] = targets[target][0].replace(\"x86_64-unknown-linux-gnu\", target)\n \n+\n # Here we walk through the constructed configuration we have from the parsed\n # command line arguments. We then apply each piece of configuration by\n # basically just doing a `sed` to change the various configuration line to what\n@@ -362,6 +374,7 @@ def to_toml(value):\n     else:\n         raise RuntimeError('no toml')\n \n+\n def configure_section(lines, config):\n     for key in config:\n         value = config[key]\n@@ -375,9 +388,10 @@ def configure_section(lines, config):\n         if not found:\n             raise RuntimeError(\"failed to find config line for {}\".format(key))\n \n+\n for section_key in config:\n     section_config = config[section_key]\n-    if not section_key in sections:\n+    if section_key not in sections:\n         raise RuntimeError(\"config key {} not in sections\".format(section_key))\n \n     if section_key == 'target':"}]}