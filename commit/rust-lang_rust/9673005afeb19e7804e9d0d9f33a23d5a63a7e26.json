{"sha": "9673005afeb19e7804e9d0d9f33a23d5a63a7e26", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2NzMwMDVhZmViMTllNzgwNGU5ZDBkOWYzM2EyM2Q1YTYzYTdlMjY=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2013-02-01T00:59:47Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2013-02-01T00:59:47Z"}, "message": "Merge pull request #4703 from sanxiyn/remove-tps\n\nRemove `tps` from `trans_enum_def` and `trans_struct_def`", "tree": {"sha": "3247eb55ad952aa3db39b720de1fac1febfa6092", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3247eb55ad952aa3db39b720de1fac1febfa6092"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9673005afeb19e7804e9d0d9f33a23d5a63a7e26", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9673005afeb19e7804e9d0d9f33a23d5a63a7e26", "html_url": "https://github.com/rust-lang/rust/commit/9673005afeb19e7804e9d0d9f33a23d5a63a7e26", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9673005afeb19e7804e9d0d9f33a23d5a63a7e26/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea02a9a6a98d7c5d56265e78fa6e49ca2bbdc7ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea02a9a6a98d7c5d56265e78fa6e49ca2bbdc7ed", "html_url": "https://github.com/rust-lang/rust/commit/ea02a9a6a98d7c5d56265e78fa6e49ca2bbdc7ed"}, {"sha": "0d1058a62e728f0dfed04fe93cc38dcf6be38f0b", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d1058a62e728f0dfed04fe93cc38dcf6be38f0b", "html_url": "https://github.com/rust-lang/rust/commit/0d1058a62e728f0dfed04fe93cc38dcf6be38f0b"}], "stats": {"total": 47, "additions": 22, "deletions": 25}, "files": [{"sha": "75c3a3f1c6cea17183d3f642a69db2ae4049fd04", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 22, "deletions": 25, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/9673005afeb19e7804e9d0d9f33a23d5a63a7e26/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9673005afeb19e7804e9d0d9f33a23d5a63a7e26/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=9673005afeb19e7804e9d0d9f33a23d5a63a7e26", "patch": "@@ -1986,7 +1986,7 @@ pub fn trans_struct_dtor(ccx: @crate_ctxt,\n }\n \n pub fn trans_enum_def(ccx: @crate_ctxt, enum_definition: ast::enum_def,\n-                      id: ast::node_id, tps: ~[ast::ty_param], degen: bool,\n+                      id: ast::node_id, degen: bool,\n                       path: @ast_map::path, vi: @~[ty::VariantInfo],\n                       i: &mut uint) {\n     for vec::each(enum_definition.variants) |variant| {\n@@ -2003,14 +2003,13 @@ pub fn trans_enum_def(ccx: @crate_ctxt, enum_definition: ast::enum_def,\n                 // Nothing to do.\n             }\n             ast::struct_variant_kind(struct_def) => {\n-                trans_struct_def(ccx, struct_def, /*bad*/copy tps, path,\n+                trans_struct_def(ccx, struct_def, path,\n                                  variant.node.id);\n             }\n             ast::enum_variant_kind(ref enum_definition) => {\n                 trans_enum_def(ccx,\n                                *enum_definition,\n                                id,\n-                               /*bad*/copy tps,\n                                degen,\n                                path,\n                                vi,\n@@ -2062,11 +2061,11 @@ pub fn trans_item(ccx: @crate_ctxt, item: ast::item) {\n         trans_mod(ccx, m);\n       }\n       ast::item_enum(ref enum_definition, ref tps) => {\n-        if tps.len() == 0u {\n+        if tps.is_empty() {\n             let degen = (*enum_definition).variants.len() == 1u;\n             let vi = ty::enum_variants(ccx.tcx, local_def(item.id));\n             let mut i = 0;\n-            trans_enum_def(ccx, (*enum_definition), item.id, /*bad*/copy *tps,\n+            trans_enum_def(ccx, (*enum_definition), item.id,\n                            degen, path, vi, &mut i);\n         }\n       }\n@@ -2080,35 +2079,33 @@ pub fn trans_item(ccx: @crate_ctxt, item: ast::item) {\n         foreign::trans_foreign_mod(ccx, foreign_mod, abi);\n       }\n       ast::item_struct(struct_def, tps) => {\n-        trans_struct_def(ccx, struct_def, tps, path, item.id);\n+        if tps.is_empty() {\n+            trans_struct_def(ccx, struct_def, path, item.id);\n+        }\n       }\n       _ => {/* fall through */ }\n     }\n }\n \n pub fn trans_struct_def(ccx: @crate_ctxt, struct_def: @ast::struct_def,\n-                        tps: ~[ast::ty_param], path: @ast_map::path,\n+                        path: @ast_map::path,\n                         id: ast::node_id) {\n-    // If there are type parameters, the destructor and constructor will be\n-    // monomorphized, so we don't translate them here.\n-    if tps.len() == 0u {\n-        // Translate the destructor.\n-        do option::iter(&struct_def.dtor) |dtor| {\n-            trans_struct_dtor(ccx, /*bad*/copy *path, dtor.node.body,\n-                             dtor.node.id, None, None, local_def(id));\n-        };\n+    // Translate the destructor.\n+    do option::iter(&struct_def.dtor) |dtor| {\n+        trans_struct_dtor(ccx, /*bad*/copy *path, dtor.node.body,\n+                         dtor.node.id, None, None, local_def(id));\n+    };\n \n-        // If this is a tuple-like struct, translate the constructor.\n-        match struct_def.ctor_id {\n-            // We only need to translate a constructor if there are fields;\n-            // otherwise this is a unit-like struct.\n-            Some(ctor_id) if struct_def.fields.len() > 0 => {\n-                let llfndecl = get_item_val(ccx, ctor_id);\n-                trans_tuple_struct(ccx, /*bad*/copy struct_def.fields,\n-                                   ctor_id, None, llfndecl);\n-            }\n-            Some(_) | None => {}\n+    // If this is a tuple-like struct, translate the constructor.\n+    match struct_def.ctor_id {\n+        // We only need to translate a constructor if there are fields;\n+        // otherwise this is a unit-like struct.\n+        Some(ctor_id) if struct_def.fields.len() > 0 => {\n+            let llfndecl = get_item_val(ccx, ctor_id);\n+            trans_tuple_struct(ccx, /*bad*/copy struct_def.fields,\n+                               ctor_id, None, llfndecl);\n         }\n+        Some(_) | None => {}\n     }\n }\n "}]}