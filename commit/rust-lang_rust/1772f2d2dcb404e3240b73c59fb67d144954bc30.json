{"sha": "1772f2d2dcb404e3240b73c59fb67d144954bc30", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3NzJmMmQyZGNiNDA0ZTMyNDBiNzNjNTlmYjY3ZDE0NDk1NGJjMzA=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-10-12T00:27:17Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-10-12T00:27:17Z"}, "message": "Show summary lines on cross-crate re-exports\n\nThis removes the unnecessary `DocFragmentKind::Divider` in favor of just\nusing the logic I actually want in `collapse_docs`.", "tree": {"sha": "c44f59edf486326c90206bc6649ab7e58e1051a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c44f59edf486326c90206bc6649ab7e58e1051a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1772f2d2dcb404e3240b73c59fb67d144954bc30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1772f2d2dcb404e3240b73c59fb67d144954bc30", "html_url": "https://github.com/rust-lang/rust/commit/1772f2d2dcb404e3240b73c59fb67d144954bc30", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1772f2d2dcb404e3240b73c59fb67d144954bc30/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c38f001db5e16f1e0db47c5aed80394e9df5430a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c38f001db5e16f1e0db47c5aed80394e9df5430a", "html_url": "https://github.com/rust-lang/rust/commit/c38f001db5e16f1e0db47c5aed80394e9df5430a"}], "stats": {"total": 53, "additions": 28, "deletions": 25}, "files": [{"sha": "9a3e9440fa5d4b219ee51872ff83b6ad9b14b2f1", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 1, "deletions": 22, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=1772f2d2dcb404e3240b73c59fb67d144954bc30", "patch": "@@ -393,24 +393,6 @@ pub enum DocFragmentKind {\n     /// A doc fragment created from a `#[doc(include=\"filename\")]` attribute. Contains both the\n     /// given filename and the file contents.\n     Include { filename: String },\n-    /// A doc fragment used to distinguish between documentation in different modules.\n-    ///\n-    /// In particular, this prevents `collapse_docs` from turning all documentation comments\n-    /// into a single giant attributes even when the item is re-exported with documentation on the re-export.\n-    Divider,\n-}\n-\n-impl DocFragment {\n-    /// Creates a dummy doc-fragment which divides earlier and later fragments.\n-    fn divider() -> Self {\n-        DocFragment {\n-            line: 0,\n-            span: DUMMY_SP,\n-            parent_module: None,\n-            doc: String::new(),\n-            kind: DocFragmentKind::Divider,\n-        }\n-    }\n }\n \n impl<'a> FromIterator<&'a DocFragment> for String {\n@@ -610,10 +592,7 @@ impl Attributes {\n         // Additional documentation should be shown before the original documentation\n         let other_attrs = additional_attrs\n             .into_iter()\n-            .map(|(attrs, id)| {\n-                doc_strings.borrow_mut().push(DocFragment::divider());\n-                attrs.iter().map(move |attr| (attr, Some(id)))\n-            })\n+            .map(|(attrs, id)| attrs.iter().map(move |attr| (attr, Some(id))))\n             .flatten()\n             .chain(attrs.iter().map(|attr| (attr, None)))\n             .filter_map(clean_attr)"}, {"sha": "c2f7f97a673ce3aeaa4cfb24235e0a0cd88b01e0", "filename": "src/librustdoc/passes/collapse_docs.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Flibrustdoc%2Fpasses%2Fcollapse_docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Flibrustdoc%2Fpasses%2Fcollapse_docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollapse_docs.rs?ref=1772f2d2dcb404e3240b73c59fb67d144954bc30", "patch": "@@ -36,7 +36,10 @@ fn collapse(doc_strings: &mut Vec<DocFragment>) {\n             let curr_kind = &curr_frag.kind;\n             let new_kind = &frag.kind;\n \n-            if matches!(*curr_kind, DocFragmentKind::Include { .. }) || curr_kind != new_kind {\n+            if matches!(*curr_kind, DocFragmentKind::Include { .. })\n+                || curr_kind != new_kind\n+                || curr_frag.parent_module != frag.parent_module\n+            {\n                 if *curr_kind == DocFragmentKind::SugaredDoc\n                     || *curr_kind == DocFragmentKind::RawDoc\n                 {"}, {"sha": "fc51995a94eccc7724f30c13a1a98f3c92269093", "filename": "src/test/rustdoc/auxiliary/intra-link-reexport-additional-docs.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Fauxiliary%2Fintra-link-reexport-additional-docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Fauxiliary%2Fintra-link-reexport-additional-docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fauxiliary%2Fintra-link-reexport-additional-docs.rs?ref=1772f2d2dcb404e3240b73c59fb67d144954bc30", "patch": "@@ -0,0 +1,6 @@\n+#![crate_name = \"inner\"]\n+\n+/// Links to [f()]\n+pub struct Inner;\n+\n+pub fn f() {}"}, {"sha": "672ccb1cf0e8889b3f8515b8c89eb2caf2683cce", "filename": "src/test/rustdoc/auxiliary/reexport-check.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Fauxiliary%2Freexport-check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Fauxiliary%2Freexport-check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fauxiliary%2Freexport-check.rs?ref=1772f2d2dcb404e3240b73c59fb67d144954bc30", "patch": "@@ -0,0 +1,2 @@\n+/// Docs in original\n+pub struct S;"}, {"sha": "96f3580f3055e8e2405fbfb5627c4c59ecb42f65", "filename": "src/test/rustdoc/intra-link-reexport-additional-docs.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Fintra-link-reexport-additional-docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Fintra-link-reexport-additional-docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fintra-link-reexport-additional-docs.rs?ref=1772f2d2dcb404e3240b73c59fb67d144954bc30", "patch": "@@ -1,6 +1,9 @@\n+// aux-build:intra-link-reexport-additional-docs.rs\n+// build-aux-docs\n #![crate_name = \"foo\"]\n+extern crate inner;\n \n-// @has foo/struct.JoinPathsError.html '//a[@href=\"../foo/fn.with_code.html\"]' 'crate::with_code'\n+// @has foo/struct.Inner.html '//a[@href=\"../foo/fn.with_code.html\"]' 'crate::with_code'\n /// [crate::with_code]\n // @has - '//a[@href=\"../foo/fn.with_code.html\"]' 'different text'\n /// [different text][with_code]\n@@ -11,7 +14,9 @@\n #[doc = \"has an attr in the way\"]\n ///\n /// [reference link]: me_three\n-pub use std::env::JoinPathsError;\n+// Should still resolve links from the original module in that scope\n+// @has - '//a[@href=\"../inner/fn.f.html\"]' 'f()'\n+pub use inner::Inner;\n \n pub fn with_code() {}\n pub fn me_too() {}"}, {"sha": "066b0cfe5e80e2f35be81c060e963122f951fc68", "filename": "src/test/rustdoc/reexport-check.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Freexport-check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1772f2d2dcb404e3240b73c59fb67d144954bc30/src%2Ftest%2Frustdoc%2Freexport-check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Freexport-check.rs?ref=1772f2d2dcb404e3240b73c59fb67d144954bc30", "patch": "@@ -1,9 +1,17 @@\n+// aux-build:reexport-check.rs\n #![crate_name = \"foo\"]\n \n+extern crate reexport_check;\n+\n // @!has 'foo/index.html' '//code' 'pub use self::i32;'\n // @has 'foo/index.html' '//tr[@class=\"module-item\"]' 'i32'\n // @has 'foo/i32/index.html'\n pub use std::i32;\n // @!has 'foo/index.html' '//code' 'pub use self::string::String;'\n // @has 'foo/index.html' '//tr[@class=\"module-item\"]' 'String'\n pub use std::string::String;\n+\n+// @has 'foo/index.html' '//td[@class=\"docblock-short\"]' 'Docs in original'\n+// this is a no-op, but shows what happens if there's an attribute that isn't a doc-comment\n+#[doc(inline)]\n+pub use reexport_check::S;"}]}