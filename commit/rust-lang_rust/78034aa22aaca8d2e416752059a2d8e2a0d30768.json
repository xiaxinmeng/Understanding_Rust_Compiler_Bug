{"sha": "78034aa22aaca8d2e416752059a2d8e2a0d30768", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4MDM0YWEyMmFhY2E4ZDJlNDE2NzUyMDU5YTJkOGUyYTBkMzA3Njg=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-13T23:28:00Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-14T19:24:09Z"}, "message": "rustc: Add trans_crust_fn. Don't do anything special yet", "tree": {"sha": "2c824be892970b6531e1b6ce105e57a39c0f78e3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2c824be892970b6531e1b6ce105e57a39c0f78e3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78034aa22aaca8d2e416752059a2d8e2a0d30768", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78034aa22aaca8d2e416752059a2d8e2a0d30768", "html_url": "https://github.com/rust-lang/rust/commit/78034aa22aaca8d2e416752059a2d8e2a0d30768", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78034aa22aaca8d2e416752059a2d8e2a0d30768/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d7c8cacfde6c2dc08bb526a244cabf83af94eaa8", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7c8cacfde6c2dc08bb526a244cabf83af94eaa8", "html_url": "https://github.com/rust-lang/rust/commit/d7c8cacfde6c2dc08bb526a244cabf83af94eaa8"}], "stats": {"total": 21, "additions": 15, "deletions": 6}, "files": [{"sha": "a1656d50e8e69d6d814518aaa830d9f7f17572df", "filename": "src/comp/middle/trans/base.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/78034aa22aaca8d2e416752059a2d8e2a0d30768/src%2Fcomp%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78034aa22aaca8d2e416752059a2d8e2a0d30768/src%2Fcomp%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans%2Fbase.rs?ref=78034aa22aaca8d2e416752059a2d8e2a0d30768", "patch": "@@ -4465,15 +4465,19 @@ fn trans_item(ccx: @crate_ctxt, item: ast::item) {\n     };\n     alt item.node {\n       ast::item_fn(decl, tps, body) {\n-        alt ccx.item_ids.find(item.id) {\n-          some(llfndecl) {\n-            trans_fn(ccx, *path + [path_name(item.ident)], decl, body,\n-                     llfndecl, no_self, tps, none, item.id);\n-          }\n+        let llfndecl = alt ccx.item_ids.find(item.id) {\n+          some(llfndecl) { llfndecl }\n           _ {\n             ccx.sess.span_fatal(item.span,\n                                 \"unbound function item in trans_item\");\n           }\n+        };\n+        if decl.purity != ast::crust_fn  {\n+            trans_fn(ccx, *path + [path_name(item.ident)], decl, body,\n+                     llfndecl, no_self, tps, none, item.id);\n+        } else {\n+            native::trans_crust_fn(ccx, *path + [path_name(item.ident)],\n+                                   decl, body, llfndecl, item.id);\n         }\n       }\n       ast::item_impl(tps, _, _, ms) {"}, {"sha": "93f753455bfb4a06451997c868c6f2466c913512", "filename": "src/comp/middle/trans/native.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/78034aa22aaca8d2e416752059a2d8e2a0d30768/src%2Fcomp%2Fmiddle%2Ftrans%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78034aa22aaca8d2e416752059a2d8e2a0d30768/src%2Fcomp%2Fmiddle%2Ftrans%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans%2Fnative.rs?ref=78034aa22aaca8d2e416752059a2d8e2a0d30768", "patch": "@@ -7,7 +7,7 @@ import common::*;\n import build::*;\n import base::*;\n \n-export link_name, trans_native_mod;\n+export link_name, trans_native_mod, trans_crust_fn;\n \n fn link_name(i: @ast::native_item) -> str {\n     alt attr::get_meta_item_value_str_by_name(i.attrs, \"link_name\") {\n@@ -189,3 +189,8 @@ fn trans_native_mod(ccx: @crate_ctxt,\n       }\n     }\n }\n+\n+fn trans_crust_fn(ccx: @crate_ctxt, path: ast_map::path, decl: ast::fn_decl,\n+                  body: ast::blk, llfndecl: ValueRef, id: ast::node_id) {\n+    trans_fn(ccx, path, decl, body, llfndecl, no_self, [], none, id)\n+}\n\\ No newline at end of file"}]}