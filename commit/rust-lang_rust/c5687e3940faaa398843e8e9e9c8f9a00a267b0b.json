{"sha": "c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1Njg3ZTM5NDBmYWFhMzk4ODQzZThlOWU5YzhmOWEwMGEyNjdiMGI=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-08-09T08:07:59Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-08-09T08:09:44Z"}, "message": "enable flt2dec tests in Miri", "tree": {"sha": "08bd64ee25ca54db32eca4dbebe9ea94c9fb07a0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/08bd64ee25ca54db32eca4dbebe9ea94c9fb07a0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "html_url": "https://github.com/rust-lang/rust/commit/c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5aa3d9a7b5d3a46a7f158e8881146331a6bc9243", "url": "https://api.github.com/repos/rust-lang/rust/commits/5aa3d9a7b5d3a46a7f158e8881146331a6bc9243", "html_url": "https://github.com/rust-lang/rust/commit/5aa3d9a7b5d3a46a7f158e8881146331a6bc9243"}], "stats": {"total": 48, "additions": 41, "deletions": 7}, "files": [{"sha": "50fe61b5e22673f6310bbf15048c1b0e57b6b34e", "filename": "src/libcore/tests/num/flt2dec/estimator.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Festimator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Festimator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Festimator.rs?ref=c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "patch": "@@ -42,7 +42,12 @@ fn test_estimate_scaling_factor() {\n     assert_almost_eq!(estimate_scaling_factor(1, -1074), -323);\n     assert_almost_eq!(estimate_scaling_factor(0x1fffffffffffff, 971), 309);\n \n-    for i in -1074..972 {\n+    #[cfg(not(miri))] // Miri is too slow\n+    let iter = -1074..972;\n+    #[cfg(miri)]\n+    let iter = (-1074..972).step_by(11);\n+\n+    for i in iter {\n         let expected = super::ldexp_f64(1.0, i).log10().ceil();\n         assert_almost_eq!(estimate_scaling_factor(1, i as i16), expected as i16);\n     }"}, {"sha": "c41d35efced6c908d9b3d8fc2057c948f06638e9", "filename": "src/libcore/tests/num/flt2dec/mod.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fmod.rs?ref=c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "patch": "@@ -1,5 +1,3 @@\n-#![cfg(not(miri))] // Miri does not implement ldexp, which most tests here need\n-\n use std::prelude::v1::*;\n use std::{str, i16, f32, f64, fmt};\n \n@@ -257,6 +255,7 @@ pub fn f32_shortest_sanity_test<F>(mut f: F) where F: FnMut(&Decoded, &mut [u8])\n     check_shortest!(f(minf32) => b\"1\", -44);\n }\n \n+#[cfg(not(miri))] // Miri is too slow\n pub fn f32_exact_sanity_test<F>(mut f: F)\n         where F: FnMut(&Decoded, &mut [u8], i16) -> (usize, i16) {\n     let minf32 = ldexp_f32(1.0, -149);\n@@ -362,6 +361,7 @@ pub fn f64_shortest_sanity_test<F>(mut f: F) where F: FnMut(&Decoded, &mut [u8])\n     check_shortest!(f(minf64) => b\"5\", -323);\n }\n \n+#[cfg(not(miri))] // Miri is too slow\n pub fn f64_exact_sanity_test<F>(mut f: F)\n         where F: FnMut(&Decoded, &mut [u8], i16) -> (usize, i16) {\n     let minf64 = ldexp_f64(1.0, -1074);\n@@ -553,6 +553,10 @@ pub fn to_shortest_str_test<F>(mut f_: F)\n     assert_eq!(to_string(f, minf64, Minus, 324, false), format!(\"0.{:0>323}5\", \"\"));\n     assert_eq!(to_string(f, minf64, Minus, 325, false), format!(\"0.{:0>323}50\", \"\"));\n \n+    if cfg!(miri) { // Miri is too slow\n+        return;\n+    }\n+\n     // very large output\n     assert_eq!(to_string(f, 1.1, Minus, 80000, false), format!(\"1.1{:0>79999}\", \"\"));\n }\n@@ -807,6 +811,10 @@ pub fn to_exact_exp_str_test<F>(mut f_: F)\n                \"1.401298464324817070923729583289916131280261941876515771757068283\\\n                  8897910826858606014866381883621215820312500000000000000000000000e-45\");\n \n+    if cfg!(miri) { // Miri is too slow\n+        return;\n+    }\n+\n     assert_eq!(to_string(f, f64::MAX, Minus,   1, false), \"2e308\");\n     assert_eq!(to_string(f, f64::MAX, Minus,   2, false), \"1.8e308\");\n     assert_eq!(to_string(f, f64::MAX, Minus,   4, false), \"1.798e308\");\n@@ -1040,6 +1048,10 @@ pub fn to_exact_fixed_str_test<F>(mut f_: F)\n     assert_eq!(to_string(f, f32::MAX, Minus, 2, false),\n                \"340282346638528859811704183484516925440.00\");\n \n+    if cfg!(miri) { // Miri is too slow\n+        return;\n+    }\n+\n     let minf32 = ldexp_f32(1.0, -149);\n     assert_eq!(to_string(f, minf32, Minus,   0, false), \"0\");\n     assert_eq!(to_string(f, minf32, Minus,   1, false), \"0.0\");"}, {"sha": "3db5b4c84fc3b14b4905aa3e41d9e85e46e9114f", "filename": "src/libcore/tests/num/flt2dec/random.rs", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Frandom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Frandom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Frandom.rs?ref=c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "patch": "@@ -109,8 +109,13 @@ pub fn f32_exhaustive_equivalence_test<F, G>(f: F, g: G, k: usize)\n #[test]\n fn shortest_random_equivalence_test() {\n     use core::num::flt2dec::strategy::dragon::format_shortest as fallback;\n-    f64_random_equivalence_test(format_shortest_opt, fallback, MAX_SIG_DIGITS, 10_000);\n-    f32_random_equivalence_test(format_shortest_opt, fallback, MAX_SIG_DIGITS, 10_000);\n+    #[cfg(not(miri))] // Miri is too slow\n+    const N: usize = 10_000;\n+    #[cfg(miri)]\n+    const N: usize = 20;\n+\n+    f64_random_equivalence_test(format_shortest_opt, fallback, MAX_SIG_DIGITS, N);\n+    f32_random_equivalence_test(format_shortest_opt, fallback, MAX_SIG_DIGITS, N);\n }\n \n #[test] #[ignore] // it is too expensive\n@@ -138,17 +143,27 @@ fn shortest_f64_hard_random_equivalence_test() {\n #[test]\n fn exact_f32_random_equivalence_test() {\n     use core::num::flt2dec::strategy::dragon::format_exact as fallback;\n+    #[cfg(not(miri))] // Miri is too slow\n+    const N: usize = 1_000;\n+    #[cfg(miri)]\n+    const N: usize = 10;\n+\n     for k in 1..21 {\n         f32_random_equivalence_test(|d, buf| format_exact_opt(d, buf, i16::MIN),\n-                                             |d, buf| fallback(d, buf, i16::MIN), k, 1_000);\n+                                             |d, buf| fallback(d, buf, i16::MIN), k, N);\n     }\n }\n \n #[test]\n fn exact_f64_random_equivalence_test() {\n     use core::num::flt2dec::strategy::dragon::format_exact as fallback;\n+    #[cfg(not(miri))] // Miri is too slow\n+    const N: usize = 1_000;\n+    #[cfg(miri)]\n+    const N: usize = 5;\n+\n     for k in 1..21 {\n         f64_random_equivalence_test(|d, buf| format_exact_opt(d, buf, i16::MIN),\n-                                             |d, buf| fallback(d, buf, i16::MIN), k, 1_000);\n+                                             |d, buf| fallback(d, buf, i16::MIN), k, N);\n     }\n }"}, {"sha": "dc4d78bfae1096fac4de4641dda8e01c1576112f", "filename": "src/libcore/tests/num/flt2dec/strategy/dragon.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fstrategy%2Fdragon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fstrategy%2Fdragon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fstrategy%2Fdragon.rs?ref=c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "patch": "@@ -23,6 +23,7 @@ fn shortest_sanity_test() {\n }\n \n #[test]\n+#[cfg(not(miri))] // Miri is too slow\n fn exact_sanity_test() {\n     // This test ends up running what I can only assume is some corner-ish case\n     // of the `exp2` library function, defined in whatever C runtime we're"}, {"sha": "f8bdddfe2e4103e346ad6d5df9f75c044007d87d", "filename": "src/libcore/tests/num/flt2dec/strategy/grisu.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fstrategy%2Fgrisu.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5687e3940faaa398843e8e9e9c8f9a00a267b0b/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fstrategy%2Fgrisu.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fnum%2Fflt2dec%2Fstrategy%2Fgrisu.rs?ref=c5687e3940faaa398843e8e9e9c8f9a00a267b0b", "patch": "@@ -36,6 +36,7 @@ fn shortest_sanity_test() {\n }\n \n #[test]\n+#[cfg(not(miri))] // Miri is too slow\n fn exact_sanity_test() {\n     // See comments in dragon.rs's exact_sanity_test for why this test is\n     // ignored on MSVC"}]}