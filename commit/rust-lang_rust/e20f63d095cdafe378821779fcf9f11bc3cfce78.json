{"sha": "e20f63d095cdafe378821779fcf9f11bc3cfce78", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUyMGY2M2QwOTVjZGFmZTM3ODgyMTc3OWZjZjlmMTFiYzNjZmNlNzg=", "commit": {"author": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-07-06T20:42:06Z"}, "committer": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-07-06T22:25:06Z"}, "message": "Bank protocol example from blog post", "tree": {"sha": "0d8835095b40970a0b9a8e22eb158aa82014c227", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d8835095b40970a0b9a8e22eb158aa82014c227"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e20f63d095cdafe378821779fcf9f11bc3cfce78", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e20f63d095cdafe378821779fcf9f11bc3cfce78", "html_url": "https://github.com/rust-lang/rust/commit/e20f63d095cdafe378821779fcf9f11bc3cfce78", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e20f63d095cdafe378821779fcf9f11bc3cfce78/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b925648ac71cfd28298ad994428cafc19f49692b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b925648ac71cfd28298ad994428cafc19f49692b", "html_url": "https://github.com/rust-lang/rust/commit/b925648ac71cfd28298ad994428cafc19f49692b"}], "stats": {"total": 70, "additions": 70, "deletions": 0}, "files": [{"sha": "e6a4a011b30d250e9b2342d3d67a870c583027ff", "filename": "src/test/run-pass/pipe-bank-proto.rs", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/e20f63d095cdafe378821779fcf9f11bc3cfce78/src%2Ftest%2Frun-pass%2Fpipe-bank-proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e20f63d095cdafe378821779fcf9f11bc3cfce78/src%2Ftest%2Frun-pass%2Fpipe-bank-proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fpipe-bank-proto.rs?ref=e20f63d095cdafe378821779fcf9f11bc3cfce78", "patch": "@@ -0,0 +1,70 @@\n+// xfail-pretty\n+\n+// An example of the bank protocol from eholk's blog post.\n+//\n+// http://theincredibleholk.wordpress.com/2012/07/06/rusty-pipes/\n+\n+import pipes::recv;\n+\n+type username = str;\n+type password = str;\n+type money = float;\n+type amount = float;\n+\n+proto! bank {\n+    login:send {\n+        login(username, password) -> login_response\n+    }\n+\n+    login_response:recv {\n+        ok -> connected,\n+        invalid -> login\n+    }\n+\n+    connected:send {\n+        deposit(money) -> connected,\n+        withdrawal(amount) -> withdrawal_response\n+    }\n+\n+    withdrawal_response:recv {\n+        money(money) -> connected,\n+        insufficient_funds -> connected\n+    }\n+}\n+\n+fn macros() {\n+    #macro[\n+        [#move[x],\n+         unsafe { let y <- *ptr::addr_of(x); y }]\n+    ];\n+}\n+\n+fn bank_client(+bank: bank::client::login) {\n+    import bank::*;\n+\n+    let bank = client::login(bank, \"theincredibleholk\", \"1234\");\n+    let bank = alt recv(bank) {\n+      some(ok(connected)) {\n+        #move(connected)\n+      }\n+      some(invalid(_)) { fail \"login unsuccessful\" }\n+      none { fail \"bank closed the connection\" }\n+    };\n+\n+    let bank = client::deposit(bank, 100.00);\n+    let bank = client::withdrawal(bank, 50.00);\n+    alt recv(bank) {\n+      some(money(m, _)) {\n+        io::println(\"Yay! I got money!\");\n+      }\n+      some(insufficient_funds(_)) {\n+        fail \"someone stole my money\"\n+      }\n+      none {\n+        fail \"bank closed the connection\"\n+      }\n+    }\n+}\n+\n+fn main() {\n+}\n\\ No newline at end of file"}]}