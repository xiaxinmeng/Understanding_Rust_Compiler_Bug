{"sha": "831b8fc1b5e78673a2dd855556c03b756819e5b3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzMWI4ZmMxYjVlNzg2NzNhMmRkODU1NTU2YzAzYjc1NjgxOWU1YjM=", "commit": {"author": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-04-05T15:29:14Z"}, "committer": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-04-14T15:26:07Z"}, "message": "Ignore `#[test]` fns in `cyclomatic_complexity`", "tree": {"sha": "4166638b74993fd2a722b00f9ad118cf61874703", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4166638b74993fd2a722b00f9ad118cf61874703"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/831b8fc1b5e78673a2dd855556c03b756819e5b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/831b8fc1b5e78673a2dd855556c03b756819e5b3", "html_url": "https://github.com/rust-lang/rust/commit/831b8fc1b5e78673a2dd855556c03b756819e5b3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/831b8fc1b5e78673a2dd855556c03b756819e5b3/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c23b684ea586bdab67ad244289578dbfdcb33514", "url": "https://api.github.com/repos/rust-lang/rust/commits/c23b684ea586bdab67ad244289578dbfdcb33514", "html_url": "https://github.com/rust-lang/rust/commit/c23b684ea586bdab67ad244289578dbfdcb33514"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "043504f5a2843de89dbf4d1c9ed02a44e61f47fc", "filename": "src/cyclomatic_complexity.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/831b8fc1b5e78673a2dd855556c03b756819e5b3/src%2Fcyclomatic_complexity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/831b8fc1b5e78673a2dd855556c03b756819e5b3/src%2Fcyclomatic_complexity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcyclomatic_complexity.rs?ref=831b8fc1b5e78673a2dd855556c03b756819e5b3", "patch": "@@ -1,12 +1,12 @@\n //! calculate cyclomatic complexity and warn about overly complex functions\n \n-use rustc::lint::*;\n use rustc::cfg::CFG;\n+use rustc::lint::*;\n use rustc::ty;\n use rustc::hir::*;\n use rustc::hir::intravisit::{Visitor, walk_expr};\n use syntax::ast::Attribute;\n-use syntax::attr::*;\n+use syntax::attr;\n use syntax::codemap::Span;\n \n use utils::{in_macro, LimitStack, span_help_and_lint};\n@@ -44,6 +44,7 @@ impl CyclomaticComplexity {\n         if in_macro(cx, span) {\n             return;\n         }\n+\n         let cfg = CFG::new(cx.tcx, block);\n         let n = cfg.graph.len_nodes() as u64;\n         let e = cfg.graph.len_edges() as u64;\n@@ -84,7 +85,9 @@ impl CyclomaticComplexity {\n impl LateLintPass for CyclomaticComplexity {\n     fn check_item(&mut self, cx: &LateContext, item: &Item) {\n         if let ItemFn(_, _, _, _, _, ref block) = item.node {\n-            self.check(cx, block, item.span);\n+            if !attr::contains_name(&item.attrs, \"test\") {\n+                self.check(cx, block, item.span);\n+            }\n         }\n     }\n "}, {"sha": "4b24f16eda77696ed9b9b376732d14b1a82e92ef", "filename": "tests/compile-fail/cyclomatic_complexity.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/831b8fc1b5e78673a2dd855556c03b756819e5b3/tests%2Fcompile-fail%2Fcyclomatic_complexity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/831b8fc1b5e78673a2dd855556c03b756819e5b3/tests%2Fcompile-fail%2Fcyclomatic_complexity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fcyclomatic_complexity.rs?ref=831b8fc1b5e78673a2dd855556c03b756819e5b3", "patch": "@@ -171,6 +171,17 @@ fn bar() { //~ ERROR: the function has a cyclomatic complexity of 2\n     }\n }\n \n+#[test]\n+#[cyclomatic_complexity = \"0\"]\n+/// Tests are usually complex but simple at the same time. `cyclomatic_complexity` used to give\n+/// lots of false-positives in tests.\n+fn dont_warn_on_tests() {\n+    match 99 {\n+        0 => println!(\"hi\"),\n+        _ => println!(\"bye\"),\n+    }\n+}\n+\n #[cyclomatic_complexity = \"0\"]\n fn barr() { //~ ERROR: the function has a cyclomatic complexity of 2\n     match 99 {"}]}