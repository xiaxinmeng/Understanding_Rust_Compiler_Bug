{"sha": "51fd3bf6a823a406cccfbf48de4190cde42f6618", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxZmQzYmY2YTgyM2E0MDZjY2NmYmY0OGRlNDE5MGNkZTQyZjY2MTg=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-08-24T21:00:15Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-08-27T17:52:21Z"}, "message": "rustc: Suggest removing `extern crate` in 2018\n\nThis commit updates the `unused_extern_crates` lint to make automatic\nsuggestions about removing `extern crate` annotations in the 2018 edition. This\nended up being a little easier than originally though due to what's likely been\nfixed issues in the resolver!\n\nCloses #52829", "tree": {"sha": "e9087f61d77f2bc2a99748c5c69438c44ea4ffdc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9087f61d77f2bc2a99748c5c69438c44ea4ffdc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51fd3bf6a823a406cccfbf48de4190cde42f6618", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51fd3bf6a823a406cccfbf48de4190cde42f6618", "html_url": "https://github.com/rust-lang/rust/commit/51fd3bf6a823a406cccfbf48de4190cde42f6618", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51fd3bf6a823a406cccfbf48de4190cde42f6618/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b638d8c75f4e38c75c5caa52b10b18a350431687", "url": "https://api.github.com/repos/rust-lang/rust/commits/b638d8c75f4e38c75c5caa52b10b18a350431687", "html_url": "https://github.com/rust-lang/rust/commit/b638d8c75f4e38c75c5caa52b10b18a350431687"}], "stats": {"total": 129, "additions": 128, "deletions": 1}, "files": [{"sha": "d7aec1d62cdd64410027629009ef4c1595850677", "filename": "src/librustc_typeck/check_unused.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Flibrustc_typeck%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Flibrustc_typeck%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck_unused.rs?ref=51fd3bf6a823a406cccfbf48de4190cde42f6618", "patch": "@@ -176,7 +176,12 @@ fn unused_crates_lint<'tcx>(tcx: TyCtxt<'_, 'tcx, 'tcx>) {\n         };\n         let replacement = visibility_qualified(&item.vis, &base_replacement);\n         tcx.struct_span_lint_node(lint, id, extern_crate.span, msg)\n-            .span_suggestion_short(extern_crate.span, &help, replacement)\n+            .span_suggestion_short_with_applicability(\n+                extern_crate.span,\n+                &help,\n+                replacement,\n+                Applicability::MachineApplicable,\n+            )\n             .emit();\n     }\n }"}, {"sha": "9daaca1fb8f953299db699f881a52c819264ed20", "filename": "src/test/ui/rust-2018/auxiliary/remove-extern-crate.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fauxiliary%2Fremove-extern-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fauxiliary%2Fremove-extern-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fauxiliary%2Fremove-extern-crate.rs?ref=51fd3bf6a823a406cccfbf48de4190cde42f6618", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[macro_export]\n+macro_rules! foo {\n+    () => ()\n+}\n+\n+#[macro_export]\n+macro_rules! bar {\n+    () => ()\n+}"}, {"sha": "995be4290b887cae86e11acdea047b44b76caa50", "filename": "src/test/ui/rust-2018/remove-extern-crate.fixed", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed?ref=51fd3bf6a823a406cccfbf48de4190cde42f6618", "patch": "@@ -0,0 +1,39 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// run-rustfix\n+// edition:2018\n+// compile-pass\n+// aux-build:remove-extern-crate.rs\n+\n+#![warn(rust_2018_idioms)]\n+\n+\n+use core as another_name;\n+use remove_extern_crate;\n+#[macro_use]\n+extern crate remove_extern_crate as something_else;\n+\n+fn main() {\n+    another_name::mem::drop(3);\n+    another::foo();\n+    remove_extern_crate::foo!();\n+    bar!();\n+}\n+\n+mod another {\n+    use core;\n+    use remove_extern_crate;\n+\n+    pub fn foo() {\n+        core::mem::drop(4);\n+        remove_extern_crate::foo!();\n+    }\n+}"}, {"sha": "3ab97a7428704d2304de0b72cad8154ceafd83e4", "filename": "src/test/ui/rust-2018/remove-extern-crate.rs", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs?ref=51fd3bf6a823a406cccfbf48de4190cde42f6618", "patch": "@@ -0,0 +1,39 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// run-rustfix\n+// edition:2018\n+// compile-pass\n+// aux-build:remove-extern-crate.rs\n+\n+#![warn(rust_2018_idioms)]\n+\n+extern crate core;\n+extern crate core as another_name;\n+use remove_extern_crate;\n+#[macro_use]\n+extern crate remove_extern_crate as something_else;\n+\n+fn main() {\n+    another_name::mem::drop(3);\n+    another::foo();\n+    remove_extern_crate::foo!();\n+    bar!();\n+}\n+\n+mod another {\n+    extern crate core;\n+    use remove_extern_crate;\n+\n+    pub fn foo() {\n+        core::mem::drop(4);\n+        remove_extern_crate::foo!();\n+    }\n+}"}, {"sha": "752a7b180de138b6c31d7107ee165a5806649a72", "filename": "src/test/ui/rust-2018/remove-extern-crate.stderr", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/51fd3bf6a823a406cccfbf48de4190cde42f6618/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr?ref=51fd3bf6a823a406cccfbf48de4190cde42f6618", "patch": "@@ -0,0 +1,25 @@\n+warning: unused extern crate\n+  --> $DIR/remove-extern-crate.rs:18:1\n+   |\n+LL | extern crate core;\n+   | ^^^^^^^^^^^^^^^^^^ help: remove it\n+   |\n+note: lint level defined here\n+  --> $DIR/remove-extern-crate.rs:16:9\n+   |\n+LL | #![warn(rust_2018_idioms)]\n+   |         ^^^^^^^^^^^^^^^^\n+   = note: #[warn(unused_extern_crates)] implied by #[warn(rust_2018_idioms)]\n+\n+warning: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/remove-extern-crate.rs:19:1\n+   |\n+LL | extern crate core as another_name;\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+\n+warning: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/remove-extern-crate.rs:32:5\n+   |\n+LL |     extern crate core;\n+   |     ^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+"}]}