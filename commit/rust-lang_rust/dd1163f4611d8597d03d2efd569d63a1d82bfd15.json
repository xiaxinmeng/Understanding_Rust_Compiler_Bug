{"sha": "dd1163f4611d8597d03d2efd569d63a1d82bfd15", "node_id": "C_kwDOAAsO6NoAKGRkMTE2M2Y0NjExZDg1OTdkMDNkMmVmZDU2OWQ2M2ExZDgyYmZkMTU", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-11-16T13:30:53Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-11-25T16:10:10Z"}, "message": "Fix macro statement handling", "tree": {"sha": "5948ad097edba561085f7414568faa1f4b38bf5e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5948ad097edba561085f7414568faa1f4b38bf5e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd1163f4611d8597d03d2efd569d63a1d82bfd15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd1163f4611d8597d03d2efd569d63a1d82bfd15", "html_url": "https://github.com/rust-lang/rust/commit/dd1163f4611d8597d03d2efd569d63a1d82bfd15", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd1163f4611d8597d03d2efd569d63a1d82bfd15/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23744cd4ba57d2fc5c57459002282fe2d896193b", "url": "https://api.github.com/repos/rust-lang/rust/commits/23744cd4ba57d2fc5c57459002282fe2d896193b", "html_url": "https://github.com/rust-lang/rust/commit/23744cd4ba57d2fc5c57459002282fe2d896193b"}], "stats": {"total": 36, "additions": 16, "deletions": 20}, "files": [{"sha": "57f835d45b123eb58131976a3300ca910700f79c", "filename": "clippy_lints/src/semicolon_block.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/dd1163f4611d8597d03d2efd569d63a1d82bfd15/clippy_lints%2Fsrc%2Fsemicolon_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd1163f4611d8597d03d2efd569d63a1d82bfd15/clippy_lints%2Fsrc%2Fsemicolon_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fsemicolon_block.rs?ref=dd1163f4611d8597d03d2efd569d63a1d82bfd15", "patch": "@@ -1,7 +1,7 @@\n use clippy_utils::diagnostics::{multispan_sugg_with_applicability, span_lint_and_then};\n use rustc_errors::Applicability;\n use rustc_hir::{Block, Expr, ExprKind, Stmt, StmtKind};\n-use rustc_lint::{LateContext, LateLintPass};\n+use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::Span;\n \n@@ -96,7 +96,8 @@ impl LateLintPass<'_> for SemicolonBlock {\n }\n \n fn semicolon_inside_block(cx: &LateContext<'_>, block: &Block<'_>, tail: &Expr<'_>, semi_span: Span) {\n-    let insert_span = tail.span.with_lo(tail.span.hi());\n+    let tail_span_end = tail.span.source_callsite().hi();\n+    let insert_span = Span::with_root_ctxt(tail_span_end, tail_span_end);\n     let remove_span = semi_span.with_lo(block.span.hi());\n \n     span_lint_and_then(\n@@ -117,6 +118,8 @@ fn semicolon_inside_block(cx: &LateContext<'_>, block: &Block<'_>, tail: &Expr<'\n \n fn semicolon_outside_block(cx: &LateContext<'_>, block: &Block<'_>, tail_stmt_expr: &Expr<'_>, semi_span: Span) {\n     let insert_span = block.span.with_lo(block.span.hi());\n+    // account for macro calls\n+    let semi_span = cx.sess().source_map().stmt_span(semi_span, block.span);\n     let remove_span = semi_span.with_lo(tail_stmt_expr.span.source_callsite().hi());\n \n     span_lint_and_then("}, {"sha": "4cd112dd5e12cdaa3b1019e78bfea7f78c993c8a", "filename": "tests/ui/semicolon_inside_block.fixed", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_inside_block.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_inside_block.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsemicolon_inside_block.fixed?ref=dd1163f4611d8597d03d2efd569d63a1d82bfd15", "patch": "@@ -10,7 +10,7 @@\n \n macro_rules! m {\n     (()) => {\n-        ();\n+        ()\n     };\n     (0) => {{\n         0\n@@ -58,7 +58,7 @@ fn main() {\n         unit_fn_block();\n     };\n \n-    { m!(()) }\n+    { m!(()); }\n     { m!(()); }\n     { m!(()); };\n     m!(0);"}, {"sha": "48d3690e2bdee5bf1e2face8a3e255ae111bf5bd", "filename": "tests/ui/semicolon_inside_block.stderr", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_inside_block.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_inside_block.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsemicolon_inside_block.stderr?ref=dd1163f4611d8597d03d2efd569d63a1d82bfd15", "patch": "@@ -46,11 +46,8 @@ LL |     { m!(()) };\n    |\n help: put the `;` here\n    |\n-LL ~         ();\n-LL |     };\n- ...\n-LL | \n-LL ~     { m!(()) }\n+LL -     { m!(()) };\n+LL +     { m!(()); }\n    |\n \n error: aborting due to 4 previous errors"}, {"sha": "5bc18faaad8ec47da3273653d6ab18cb59c07db3", "filename": "tests/ui/semicolon_outside_block.fixed", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_outside_block.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_outside_block.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsemicolon_outside_block.fixed?ref=dd1163f4611d8597d03d2efd569d63a1d82bfd15", "patch": "@@ -21,9 +21,6 @@ macro_rules! m {\n     (2) => {{\n         2;\n     }};\n-    (stmt) => {\n-        stmt;\n-    };\n }\n \n fn unit_fn_block() {\n@@ -42,8 +39,8 @@ fn main() {\n     { unit_fn_block() };\n     unsafe { unit_fn_block() };\n \n-    { unit_fn_block(); }\n-    unsafe { unit_fn_block(); }\n+    { unit_fn_block() };\n+    unsafe { unit_fn_block() };\n \n     { unit_fn_block(); };\n     unsafe { unit_fn_block(); };\n@@ -54,20 +51,19 @@ fn main() {\n     };\n     {\n         unit_fn_block();\n-        unit_fn_block();\n-    }\n+        unit_fn_block()\n+    };\n     {\n         unit_fn_block();\n         unit_fn_block();\n     };\n \n     { m!(()) };\n-    { m!(()); }\n+    { m!(()) };\n     { m!(()); };\n     m!(0);\n     m!(1);\n     m!(2);\n-    { m!(stmt) };\n \n     for _ in [()] {\n         unit_fn_block();"}, {"sha": "dcc102e60994a6fea104d330e799328b33e0ecd6", "filename": "tests/ui/semicolon_outside_block.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_outside_block.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dd1163f4611d8597d03d2efd569d63a1d82bfd15/tests%2Fui%2Fsemicolon_outside_block.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsemicolon_outside_block.stderr?ref=dd1163f4611d8597d03d2efd569d63a1d82bfd15", "patch": "@@ -46,8 +46,8 @@ LL |     { m!(()); }\n    |\n help: put the `;` here\n    |\n-LL -         ()\n-LL +         (); };\n+LL -     { m!(()); }\n+LL +     { m!(()) };\n    |\n \n error: aborting due to 4 previous errors"}]}