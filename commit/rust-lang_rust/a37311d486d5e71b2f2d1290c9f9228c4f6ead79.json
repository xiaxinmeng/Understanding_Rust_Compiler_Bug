{"sha": "a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzNzMxMWQ0ODZkNWU3MWIyZjJkMTI5MGM5ZjkyMjhjNGY2ZWFkNzk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-03-31T22:58:57Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-03-31T22:58:57Z"}, "message": "rollup merge of #23907: alexcrichton/impl-exit\n\nThis commit is an implementation of [RFC #1011][rfc] which adds an `exit`\nfunction to the standard library for immediately terminating the current process\nwith a specified exit code.\n\n[rfc]: https://github.com/rust-lang/rfcs/pull/1011\n\nCloses #23914", "tree": {"sha": "21beece7faab89e01f8c58cf92f78ab0002fe4d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/21beece7faab89e01f8c58cf92f78ab0002fe4d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "html_url": "https://github.com/rust-lang/rust/commit/a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0cac5b615811afeb634a73b86dcf0f1f51fe9aa8", "url": "https://api.github.com/repos/rust-lang/rust/commits/0cac5b615811afeb634a73b86dcf0f1f51fe9aa8", "html_url": "https://github.com/rust-lang/rust/commit/0cac5b615811afeb634a73b86dcf0f1f51fe9aa8"}, {"sha": "71982aa65725a2e630b3abdbb5f48e1abf1acf91", "url": "https://api.github.com/repos/rust-lang/rust/commits/71982aa65725a2e630b3abdbb5f48e1abf1acf91", "html_url": "https://github.com/rust-lang/rust/commit/71982aa65725a2e630b3abdbb5f48e1abf1acf91"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "630238555140afad8bb6f4d7a8d14e3d7bb458ff", "filename": "src/libstd/process.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprocess.rs?ref=a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "patch": "@@ -522,6 +522,22 @@ impl Child {\n     }\n }\n \n+/// Terminates the current process with the specified exit code.\n+///\n+/// This function will never return and will immediately terminate the current\n+/// process. The exit code is passed through to the underlying OS and will be\n+/// available for consumption by another process.\n+///\n+/// Note that because this function never returns, and that it terminates the\n+/// process, no destructors on the current stack or any other thread's stack\n+/// will be run. If a clean shutdown is needed it is recommended to only call\n+/// this function at a known point where there are no more destructors left\n+/// to run.\n+#[stable(feature = \"rust1\", since = \"1.0.0\")]\n+pub fn exit(code: i32) -> ! {\n+    ::sys::os::exit(code)\n+}\n+\n #[cfg(test)]\n mod tests {\n     use prelude::v1::*;"}, {"sha": "7b13e951b9b3315203bdf294a51bb1172828d084", "filename": "src/libstd/sys/unix/os.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fsys%2Funix%2Fos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fsys%2Funix%2Fos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fos.rs?ref=a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "patch": "@@ -506,3 +506,7 @@ pub fn home_dir() -> Option<PathBuf> {\n         }\n     }\n }\n+\n+pub fn exit(code: i32) -> ! {\n+    unsafe { libc::exit(code as c_int) }\n+}"}, {"sha": "b930e35c0641f23b6ac034112b8b9ebb8c5d4ce6", "filename": "src/libstd/sys/windows/c.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs?ref=a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "patch": "@@ -433,6 +433,7 @@ extern \"system\" {\n                             TokenHandle: *mut libc::HANDLE) -> libc::BOOL;\n     pub fn GetCurrentProcess() -> libc::HANDLE;\n     pub fn GetStdHandle(which: libc::DWORD) -> libc::HANDLE;\n+    pub fn ExitProcess(uExitCode: libc::UINT) -> !;\n }\n \n #[link(name = \"userenv\")]"}, {"sha": "f98c39cfad01f4b9c6612ff36b8b084b8938c4a0", "filename": "src/libstd/sys/windows/os.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fsys%2Fwindows%2Fos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Flibstd%2Fsys%2Fwindows%2Fos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fos.rs?ref=a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "patch": "@@ -380,3 +380,7 @@ pub fn home_dir() -> Option<PathBuf> {\n         }, super::os2path).ok()\n     })\n }\n+\n+pub fn exit(code: i32) -> ! {\n+    unsafe { libc::ExitProcess(code as libc::UINT) }\n+}"}, {"sha": "9ef66ff2d713c6890dfa54dbfb1fe256a72cf826", "filename": "src/test/run-pass/process-exit.rs", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Ftest%2Frun-pass%2Fprocess-exit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a37311d486d5e71b2f2d1290c9f9228c4f6ead79/src%2Ftest%2Frun-pass%2Fprocess-exit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fprocess-exit.rs?ref=a37311d486d5e71b2f2d1290c9f9228c4f6ead79", "patch": "@@ -0,0 +1,31 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::env;\n+use std::process::{self, Command, Stdio};\n+\n+fn main() {\n+    let args: Vec<String> = env::args().collect();\n+    if args.len() > 1 && args[1] == \"child\" {\n+        child();\n+    } else {\n+        parent();\n+    }\n+}\n+\n+fn parent() {\n+    let args: Vec<String> = env::args().collect();\n+    let status = Command::new(&args[0]).arg(\"child\").status().unwrap();\n+    assert_eq!(status.code(), Some(2));\n+}\n+\n+fn child() -> i32 {\n+    process::exit(2);\n+}"}]}