{"sha": "69c65d29615c391c958ebf75dd65258ec23e175c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5YzY1ZDI5NjE1YzM5MWM5NThlYmY3NWRkNjUyNThlYzIzZTE3NWM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-06-28T20:16:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-06-28T20:16:13Z"}, "message": "Auto merge of #42850 - estebank:unwanted-return-rotj, r=nikomatsakis\n\nDetect missing `;` on methods with return type `()`\n\n - Point out the origin of a type requirement when it is the return type\n   of a method\n - Point out possibly missing semicolon when the return type is `()` and\n   the implicit return makes sense as a statement\n - Suggest changing the return type of methods with default return type\n - Don't suggest changing the return type on `fn main()`\n - Don't suggest changing the return type on impl fn\n - Suggest removal of semicolon (instead of being help)", "tree": {"sha": "c4f6da0a7863832c4285a7772b671f10fb2beafe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c4f6da0a7863832c4285a7772b671f10fb2beafe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69c65d29615c391c958ebf75dd65258ec23e175c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69c65d29615c391c958ebf75dd65258ec23e175c", "html_url": "https://github.com/rust-lang/rust/commit/69c65d29615c391c958ebf75dd65258ec23e175c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69c65d29615c391c958ebf75dd65258ec23e175c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47faf1d51952ecd9d4c8a7325332fba34fbe00bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/47faf1d51952ecd9d4c8a7325332fba34fbe00bd", "html_url": "https://github.com/rust-lang/rust/commit/47faf1d51952ecd9d4c8a7325332fba34fbe00bd"}, {"sha": "7dad2958be59801881fb3db7544de423420dabd0", "url": "https://api.github.com/repos/rust-lang/rust/commits/7dad2958be59801881fb3db7544de423420dabd0", "html_url": "https://github.com/rust-lang/rust/commit/7dad2958be59801881fb3db7544de423420dabd0"}], "stats": {"total": 626, "additions": 549, "deletions": 77}, "files": [{"sha": "02a36a372d9ef3354aab83d9e93dcb9afa1039fc", "filename": "src/librustc/hir/map/mod.rs", "status": "modified", "additions": 61, "deletions": 5, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -594,8 +594,12 @@ impl<'hir> Map<'hir> {\n     /// last good node id we found. Note that reaching the crate root (id == 0),\n     /// is not an error, since items in the crate module have the crate root as\n     /// parent.\n-    fn walk_parent_nodes<F>(&self, start_id: NodeId, found: F) -> Result<NodeId, NodeId>\n-        where F: Fn(&Node<'hir>) -> bool\n+    fn walk_parent_nodes<F, F2>(&self,\n+                                start_id: NodeId,\n+                                found: F,\n+                                bail_early: F2)\n+        -> Result<NodeId, NodeId>\n+        where F: Fn(&Node<'hir>) -> bool, F2: Fn(&Node<'hir>) -> bool\n     {\n         let mut id = start_id;\n         loop {\n@@ -616,6 +620,8 @@ impl<'hir> Map<'hir> {\n                 Some(ref node) => {\n                     if found(node) {\n                         return Ok(parent_node);\n+                    } else if bail_early(node) {\n+                        return Err(parent_node);\n                     }\n                 }\n                 None => {\n@@ -626,6 +632,56 @@ impl<'hir> Map<'hir> {\n         }\n     }\n \n+    /// Retrieve the NodeId for `id`'s enclosing method, unless there's a\n+    /// `while` or `loop` before reacing it, as block tail returns are not\n+    /// available in them.\n+    ///\n+    /// ```\n+    /// fn foo(x: usize) -> bool {\n+    ///     if x == 1 {\n+    ///         true  // `get_return_block` gets passed the `id` corresponding\n+    ///     } else {  // to this, it will return `foo`'s `NodeId`.\n+    ///         false\n+    ///     }\n+    /// }\n+    /// ```\n+    ///\n+    /// ```\n+    /// fn foo(x: usize) -> bool {\n+    ///     loop {\n+    ///         true  // `get_return_block` gets passed the `id` corresponding\n+    ///     }         // to this, it will return `None`.\n+    ///     false\n+    /// }\n+    /// ```\n+    pub fn get_return_block(&self, id: NodeId) -> Option<NodeId> {\n+        let match_fn = |node: &Node| {\n+            match *node {\n+                NodeItem(_) |\n+                NodeForeignItem(_) |\n+                NodeTraitItem(_) |\n+                NodeImplItem(_) => true,\n+                _ => false,\n+            }\n+        };\n+        let match_non_returning_block = |node: &Node| {\n+            match *node {\n+                NodeExpr(ref expr) => {\n+                    match expr.node {\n+                        ExprWhile(..) | ExprLoop(..) => true,\n+                        _ => false,\n+                    }\n+                }\n+                _ => false,\n+            }\n+        };\n+\n+        match self.walk_parent_nodes(id, match_fn, match_non_returning_block) {\n+            Ok(id) => Some(id),\n+            Err(_) => None,\n+        }\n+    }\n+\n     /// Retrieve the NodeId for `id`'s parent item, or `id` itself if no\n     /// parent item is in this map. The \"parent item\" is the closest parent node\n     /// in the AST which is recorded by the map and is an item, either an item\n@@ -637,7 +693,7 @@ impl<'hir> Map<'hir> {\n             NodeTraitItem(_) |\n             NodeImplItem(_) => true,\n             _ => false,\n-        }) {\n+        }, |_| false) {\n             Ok(id) => id,\n             Err(id) => id,\n         }\n@@ -649,7 +705,7 @@ impl<'hir> Map<'hir> {\n         let id = match self.walk_parent_nodes(id, |node| match *node {\n             NodeItem(&Item { node: Item_::ItemMod(_), .. }) => true,\n             _ => false,\n-        }) {\n+        }, |_| false) {\n             Ok(id) => id,\n             Err(id) => id,\n         };\n@@ -668,7 +724,7 @@ impl<'hir> Map<'hir> {\n             NodeImplItem(_) |\n             NodeBlock(_) => true,\n             _ => false,\n-        }) {\n+        }, |_| false) {\n             Ok(id) => Some(id),\n             Err(_) => None,\n         }"}, {"sha": "2f260b0b9ee1fca233a32f6a4c52a6a1441d645e", "filename": "src/librustc/traits/error_reporting.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -1088,7 +1088,7 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n             ObligationCauseCode::VariableType(_) => {\n                 err.note(\"all local variables must have a statically known size\");\n             }\n-            ObligationCauseCode::ReturnType => {\n+            ObligationCauseCode::SizedReturnType => {\n                 err.note(\"the return type of a function must have a \\\n                           statically known size\");\n             }\n@@ -1133,6 +1133,8 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n                               but not on the corresponding trait method\",\n                              predicate));\n             }\n+            ObligationCauseCode::ReturnType(_) |\n+            ObligationCauseCode::BlockTailExpression(_) => (),\n         }\n     }\n "}, {"sha": "a98be90e3a0f11876b08199025ed00382c823d82", "filename": "src/librustc/traits/mod.rs", "status": "modified", "additions": 32, "deletions": 21, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fmod.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -118,65 +118,76 @@ pub enum ObligationCauseCode<'tcx> {\n     /// Obligation incurred due to an object cast.\n     ObjectCastObligation(/* Object type */ Ty<'tcx>),\n \n-    /// Various cases where expressions must be sized/copy/etc:\n-    AssignmentLhsSized,        // L = X implies that L is Sized\n-    StructInitializerSized,    // S { ... } must be Sized\n-    VariableType(ast::NodeId), // Type of each variable must be Sized\n-    ReturnType,                // Return type must be Sized\n-    RepeatVec,                 // [T,..n] --> T must be Copy\n-\n-    // Types of fields (other than the last) in a struct must be sized.\n+    // Various cases where expressions must be sized/copy/etc:\n+    /// L = X implies that L is Sized\n+    AssignmentLhsSized,\n+    /// S { ... } must be Sized\n+    StructInitializerSized,\n+    /// Type of each variable must be Sized\n+    VariableType(ast::NodeId),\n+    /// Return type must be Sized\n+    SizedReturnType,\n+    /// [T,..n] --> T must be Copy\n+    RepeatVec,\n+\n+    /// Types of fields (other than the last) in a struct must be sized.\n     FieldSized,\n \n-    // Constant expressions must be sized.\n+    /// Constant expressions must be sized.\n     ConstSized,\n \n-    // static items must have `Sync` type\n+    /// static items must have `Sync` type\n     SharedStatic,\n \n     BuiltinDerivedObligation(DerivedObligationCause<'tcx>),\n \n     ImplDerivedObligation(DerivedObligationCause<'tcx>),\n \n-    // error derived when matching traits/impls; see ObligationCause for more details\n+    /// error derived when matching traits/impls; see ObligationCause for more details\n     CompareImplMethodObligation {\n         item_name: ast::Name,\n         impl_item_def_id: DefId,\n         trait_item_def_id: DefId,\n         lint_id: Option<ast::NodeId>,\n     },\n \n-    // Checking that this expression can be assigned where it needs to be\n+    /// Checking that this expression can be assigned where it needs to be\n     // FIXME(eddyb) #11161 is the original Expr required?\n     ExprAssignable,\n \n-    // Computing common supertype in the arms of a match expression\n+    /// Computing common supertype in the arms of a match expression\n     MatchExpressionArm { arm_span: Span,\n                          source: hir::MatchSource },\n \n-    // Computing common supertype in an if expression\n+    /// Computing common supertype in an if expression\n     IfExpression,\n \n-    // Computing common supertype of an if expression with no else counter-part\n+    /// Computing common supertype of an if expression with no else counter-part\n     IfExpressionWithNoElse,\n \n-    // `where a == b`\n+    /// `where a == b`\n     EquatePredicate,\n \n-    // `main` has wrong type\n+    /// `main` has wrong type\n     MainFunctionType,\n \n-    // `start` has wrong type\n+    /// `start` has wrong type\n     StartFunctionType,\n \n-    // intrinsic has wrong type\n+    /// intrinsic has wrong type\n     IntrinsicType,\n \n-    // method receiver\n+    /// method receiver\n     MethodReceiver,\n \n-    // `return` with no expression\n+    /// `return` with no expression\n     ReturnNoExpression,\n+\n+    /// `return` with an expression\n+    ReturnType(ast::NodeId),\n+\n+    /// Block implicit return\n+    BlockTailExpression(ast::NodeId),\n }\n \n #[derive(Clone, Debug, PartialEq, Eq)]"}, {"sha": "0d6df78c2ac5b88a0b4dd62a74b5768226a157b7", "filename": "src/librustc/traits/structural_impls.rs", "status": "modified", "additions": 17, "deletions": 27, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Ftraits%2Fstructural_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Ftraits%2Fstructural_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fstructural_impls.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -191,7 +191,8 @@ impl<'a, 'tcx> Lift<'tcx> for traits::ObligationCauseCode<'a> {\n             super::AssignmentLhsSized => Some(super::AssignmentLhsSized),\n             super::StructInitializerSized => Some(super::StructInitializerSized),\n             super::VariableType(id) => Some(super::VariableType(id)),\n-            super::ReturnType => Some(super::ReturnType),\n+            super::ReturnType(id) => Some(super::ReturnType(id)),\n+            super::SizedReturnType => Some(super::SizedReturnType),\n             super::RepeatVec => Some(super::RepeatVec),\n             super::FieldSized => Some(super::FieldSized),\n             super::ConstSized => Some(super::ConstSized),\n@@ -213,34 +214,19 @@ impl<'a, 'tcx> Lift<'tcx> for traits::ObligationCauseCode<'a> {\n                     lint_id: lint_id,\n                 })\n             }\n-            super::ExprAssignable => {\n-                Some(super::ExprAssignable)\n-            }\n+            super::ExprAssignable => Some(super::ExprAssignable),\n             super::MatchExpressionArm { arm_span, source } => {\n                 Some(super::MatchExpressionArm { arm_span: arm_span,\n                                                  source: source })\n             }\n-            super::IfExpression => {\n-                Some(super::IfExpression)\n-            }\n-            super::IfExpressionWithNoElse => {\n-                Some(super::IfExpressionWithNoElse)\n-            }\n-            super::EquatePredicate => {\n-                Some(super::EquatePredicate)\n-            }\n-            super::MainFunctionType => {\n-                Some(super::MainFunctionType)\n-            }\n-            super::StartFunctionType => {\n-                Some(super::StartFunctionType)\n-            }\n-            super::IntrinsicType => {\n-                Some(super::IntrinsicType)\n-            }\n-            super::MethodReceiver => {\n-                Some(super::MethodReceiver)\n-            }\n+            super::IfExpression => Some(super::IfExpression),\n+            super::IfExpressionWithNoElse => Some(super::IfExpressionWithNoElse),\n+            super::EquatePredicate => Some(super::EquatePredicate),\n+            super::MainFunctionType => Some(super::MainFunctionType),\n+            super::StartFunctionType => Some(super::StartFunctionType),\n+            super::IntrinsicType => Some(super::IntrinsicType),\n+            super::MethodReceiver => Some(super::MethodReceiver),\n+            super::BlockTailExpression(id) => Some(super::BlockTailExpression(id)),\n         }\n     }\n }\n@@ -492,12 +478,14 @@ impl<'tcx> TypeFoldable<'tcx> for traits::ObligationCauseCode<'tcx> {\n             super::AssignmentLhsSized |\n             super::StructInitializerSized |\n             super::VariableType(_) |\n-            super::ReturnType |\n+            super::ReturnType(_) |\n+            super::SizedReturnType |\n             super::ReturnNoExpression |\n             super::RepeatVec |\n             super::FieldSized |\n             super::ConstSized |\n             super::SharedStatic |\n+            super::BlockTailExpression(_) |\n             super::CompareImplMethodObligation { .. } => self.clone(),\n \n             super::ProjectionWf(proj) => super::ProjectionWf(proj.fold_with(folder)),\n@@ -537,12 +525,14 @@ impl<'tcx> TypeFoldable<'tcx> for traits::ObligationCauseCode<'tcx> {\n             super::AssignmentLhsSized |\n             super::StructInitializerSized |\n             super::VariableType(_) |\n-            super::ReturnType |\n+            super::ReturnType(_) |\n+            super::SizedReturnType |\n             super::ReturnNoExpression |\n             super::RepeatVec |\n             super::FieldSized |\n             super::ConstSized |\n             super::SharedStatic |\n+            super::BlockTailExpression(_) |\n             super::CompareImplMethodObligation { .. } => false,\n \n             super::ProjectionWf(proj) => proj.visit_with(visitor),"}, {"sha": "548ee7bcbe503eb743630f388d4ec970fd177046", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -481,6 +481,18 @@ impl<'tcx> TyS<'tcx> {\n             _ => false,\n         }\n     }\n+\n+    pub fn is_suggestable(&self) -> bool {\n+        match self.sty {\n+            TypeVariants::TyAnon(..) |\n+            TypeVariants::TyFnDef(..) |\n+            TypeVariants::TyFnPtr(..) |\n+            TypeVariants::TyDynamic(..) |\n+            TypeVariants::TyClosure(..) |\n+            TypeVariants::TyProjection(..) => false,\n+            _ => true,\n+        }\n+    }\n }\n \n impl<'a, 'gcx, 'tcx> HashStable<StableHashingContext<'a, 'gcx, 'tcx>> for ty::TyS<'tcx> {"}, {"sha": "4b71aa6b85f1c91c24f8dd0ea3a19fed0da9bf70", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -47,7 +47,12 @@ impl Emitter for EmitterWriter {\n                // don't display multiline suggestions as labels\n                sugg.substitution_parts[0].substitutions[0].find('\\n').is_none() {\n                 let substitution = &sugg.substitution_parts[0].substitutions[0];\n-                let msg = format!(\"help: {} `{}`\", sugg.msg, substitution);\n+                let msg = if substitution.len() == 0 {\n+                    // This substitution is only removal, don't show it\n+                    format!(\"help: {}\", sugg.msg)\n+                } else {\n+                    format!(\"help: {} `{}`\", sugg.msg, substitution)\n+                };\n                 primary_span.push_span_label(sugg.substitution_spans().next().unwrap(), msg);\n             } else {\n                 // if there are multiple suggestions, print them all in full"}, {"sha": "81aa59e956abf40cb8fca6dc9612caae4fb9ec95", "filename": "src/librustc_typeck/check/coercion.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -1168,6 +1168,18 @@ impl<'gcx, 'tcx, 'exprs, E> CoerceMany<'gcx, 'tcx, 'exprs, E>\n                             \"`return;` in a function whose return type is not `()`\");\n                         db.span_label(cause.span, \"return type is not ()\");\n                     }\n+                    ObligationCauseCode::BlockTailExpression(blk_id) => {\n+                        db = fcx.report_mismatched_types(cause, expected, found, err);\n+\n+                        let expr = expression.unwrap_or_else(|| {\n+                            span_bug!(cause.span,\n+                                      \"supposed to be part of a block tail expression, but the \\\n+                                       expression is empty\");\n+                        });\n+                        fcx.suggest_mismatched_types_on_tail(&mut db, expr,\n+                                                             expected, found,\n+                                                             cause.span, blk_id);\n+                    }\n                     _ => {\n                         db = fcx.report_mismatched_types(cause, expected, found, err);\n                     }"}, {"sha": "f54ad54187267fd6d96ee6f48a22c9de61ad573a", "filename": "src/librustc_typeck/check/demand.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -73,15 +73,21 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         }\n     }\n \n+    pub fn demand_coerce(&self, expr: &hir::Expr, checked_ty: Ty<'tcx>, expected: Ty<'tcx>) {\n+        if let Some(mut err) = self.demand_coerce_diag(expr, checked_ty, expected) {\n+            err.emit();\n+        }\n+    }\n+\n     // Checks that the type of `expr` can be coerced to `expected`.\n     //\n     // NB: This code relies on `self.diverges` to be accurate.  In\n     // particular, assignments to `!` will be permitted if the\n     // diverges flag is currently \"always\".\n-    pub fn demand_coerce(&self,\n-                         expr: &hir::Expr,\n-                         checked_ty: Ty<'tcx>,\n-                         expected: Ty<'tcx>) {\n+    pub fn demand_coerce_diag(&self,\n+                              expr: &hir::Expr,\n+                              checked_ty: Ty<'tcx>,\n+                              expected: Ty<'tcx>) -> Option<DiagnosticBuilder<'tcx>> {\n         let expected = self.resolve_type_vars_with_obligations(expected);\n \n         if let Err(e) = self.try_coerce(expr, checked_ty, self.diverges.get(), expected) {\n@@ -105,8 +111,9 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                                       self.get_best_match(&suggestions).join(\"\\n\")));\n                 }\n             }\n-            err.emit();\n+            return Some(err);\n         }\n+        None\n     }\n \n     fn format_method_suggestion(&self, method: &AssociatedItem) -> String {"}, {"sha": "dd488f0c4fe93e4aec58ad387ad4cf27e00bbc40", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 134, "deletions": 6, "changes": 140, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -124,6 +124,7 @@ use syntax_pos::{self, BytePos, Span};\n \n use rustc::hir::intravisit::{self, Visitor, NestedVisitorMap};\n use rustc::hir::itemlikevisit::ItemLikeVisitor;\n+use rustc::hir::map::Node;\n use rustc::hir::{self, PatKind};\n use rustc::middle::lang_items;\n use rustc_back::slice;\n@@ -977,7 +978,7 @@ fn check_fn<'a, 'gcx, 'tcx>(inherited: &'a Inherited<'a, 'gcx, 'tcx>,\n     *fcx.ps.borrow_mut() = UnsafetyState::function(fn_sig.unsafety, fn_id);\n \n     let ret_ty = fn_sig.output();\n-    fcx.require_type_is_sized(ret_ty, decl.output.span(), traits::ReturnType);\n+    fcx.require_type_is_sized(ret_ty, decl.output.span(), traits::SizedReturnType);\n     let ret_ty = fcx.instantiate_anon_types(&ret_ty);\n     fcx.ret_coercion = Some(RefCell::new(CoerceMany::new(ret_ty)));\n     fn_sig = fcx.tcx.mk_fn_sig(\n@@ -1900,7 +1901,7 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n \n                     // Require that the predicate holds for the concrete type.\n                     let cause = traits::ObligationCause::new(span, self.body_id,\n-                                                             traits::ReturnType);\n+                                                             traits::SizedReturnType);\n                     self.register_predicate(traits::Obligation::new(cause,\n                                                                     self.param_env,\n                                                                     predicate));\n@@ -2839,10 +2840,11 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                                              \"check_return_expr called outside fn body\"));\n \n         let ret_ty = ret_coercion.borrow().expected_ty();\n-        let return_expr_ty = self.check_expr_with_hint(return_expr, ret_ty);\n+        let return_expr_ty = self.check_expr_with_hint(return_expr, ret_ty.clone());\n         ret_coercion.borrow_mut()\n                     .coerce(self,\n-                            &self.misc(return_expr.span),\n+                            &self.cause(return_expr.span,\n+                                        ObligationCauseCode::ReturnType(return_expr.id)),\n                             return_expr,\n                             return_expr_ty,\n                             self.diverges.get());\n@@ -4161,8 +4163,10 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             let mut coerce = ctxt.coerce.as_mut().unwrap();\n             if let Some(tail_expr_ty) = tail_expr_ty {\n                 let tail_expr = tail_expr.unwrap();\n+                let cause = self.cause(tail_expr.span,\n+                                       ObligationCauseCode::BlockTailExpression(blk.id));\n                 coerce.coerce(self,\n-                              &self.misc(tail_expr.span),\n+                              &cause,\n                               tail_expr,\n                               tail_expr_ty,\n                               self.diverges.get());\n@@ -4201,6 +4205,130 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         ty\n     }\n \n+    /// Given a `NodeId`, return the `FnDecl` of the method it is enclosed by and whether it is\n+    /// `fn main` if it is a method, `None` otherwise.\n+    pub fn get_fn_decl(&self, blk_id: ast::NodeId) -> Option<(hir::FnDecl, bool)> {\n+        // Get enclosing Fn, if it is a function or a trait method, unless there's a `loop` or\n+        // `while` before reaching it, as block tail returns are not available in them.\n+        if let Some(fn_id) = self.tcx.hir.get_return_block(blk_id) {\n+            let parent = self.tcx.hir.get(fn_id);\n+\n+            if let Node::NodeItem(&hir::Item {\n+                name, node: hir::ItemFn(ref decl, ..), ..\n+            }) = parent {\n+                decl.clone().and_then(|decl| {\n+                    // This is less than ideal, it will not present the return type span on any\n+                    // method called `main`, regardless of whether it is actually the entry point.\n+                    Some((decl, name == Symbol::intern(\"main\")))\n+                })\n+            } else if let Node::NodeTraitItem(&hir::TraitItem {\n+                node: hir::TraitItemKind::Method(hir::MethodSig {\n+                    ref decl, ..\n+                }, ..), ..\n+            }) = parent {\n+                decl.clone().and_then(|decl| {\n+                    Some((decl, false))\n+                })\n+            } else {\n+                None\n+            }\n+        } else {\n+            None\n+        }\n+    }\n+\n+    /// On implicit return expressions with mismatched types, provide the following suggestions:\n+    ///\n+    ///  - Point out the method's return type as the reason for the expected type\n+    ///  - Possible missing semicolon\n+    ///  - Possible missing return type if the return type is the default, and not `fn main()`\n+    pub fn suggest_mismatched_types_on_tail(&self,\n+                                            err: &mut DiagnosticBuilder<'tcx>,\n+                                            expression: &'gcx hir::Expr,\n+                                            expected: Ty<'tcx>,\n+                                            found: Ty<'tcx>,\n+                                            cause_span: Span,\n+                                            blk_id: ast::NodeId) {\n+        self.suggest_missing_semicolon(err, expression, expected, cause_span);\n+\n+        if let Some((fn_decl, is_main)) = self.get_fn_decl(blk_id) {\n+            // `fn main()` must return `()`, do not suggest changing return type\n+            if !is_main {\n+                self.suggest_missing_return_type(err, &fn_decl, found);\n+            }\n+        }\n+    }\n+\n+    /// A common error is to forget to add a semicolon at the end of a block:\n+    ///\n+    /// ```\n+    /// fn foo() {\n+    ///     bar_that_returns_u32()\n+    /// }\n+    /// ```\n+    ///\n+    /// This routine checks if the return expression in a block would make sense on its own as a\n+    /// statement and the return type has been left as defaultor has been specified as `()`. If so,\n+    /// it suggests adding a semicolon.\n+    fn suggest_missing_semicolon(&self,\n+                                     err: &mut DiagnosticBuilder<'tcx>,\n+                                     expression: &'gcx hir::Expr,\n+                                     expected: Ty<'tcx>,\n+                                     cause_span: Span) {\n+        if expected.is_nil() {\n+            // `BlockTailExpression` only relevant if the tail expr would be\n+            // useful on its own.\n+            match expression.node {\n+                hir::ExprCall(..) |\n+                hir::ExprMethodCall(..) |\n+                hir::ExprIf(..) |\n+                hir::ExprWhile(..) |\n+                hir::ExprLoop(..) |\n+                hir::ExprMatch(..) |\n+                hir::ExprBlock(..) => {\n+                    let sp = cause_span.next_point();\n+                    err.span_suggestion(sp,\n+                                        \"did you mean to add a semicolon here?\",\n+                                        \";\".to_string());\n+                }\n+                _ => (),\n+            }\n+        }\n+    }\n+\n+\n+    /// A possible error is to forget to add a return type that is needed:\n+    ///\n+    /// ```\n+    /// fn foo() {\n+    ///     bar_that_returns_u32()\n+    /// }\n+    /// ```\n+    ///\n+    /// This routine checks if the return type is left as default, the method is not part of an\n+    /// `impl` block and that it isn't the `main` method. If so, it suggests setting the return\n+    /// type.\n+    fn suggest_missing_return_type(&self,\n+                                   err: &mut DiagnosticBuilder<'tcx>,\n+                                   fn_decl: &hir::FnDecl,\n+                                   ty: Ty<'tcx>) {\n+\n+        // Only recommend changing the return type for methods that\n+        // haven't set a return type at all (and aren't `fn main()` or an impl).\n+        if let &hir::FnDecl {\n+            output: hir::FunctionRetTy::DefaultReturn(span), ..\n+        } = fn_decl {\n+            if ty.is_suggestable() {\n+                err.span_suggestion(span,\n+                                    \"possibly return type missing here?\",\n+                                    format!(\"-> {} \", ty));\n+            } else {\n+                err.span_label(span, \"possibly return type missing here?\");\n+            }\n+        }\n+    }\n+\n+\n     /// A common error is to add an extra semicolon:\n     ///\n     /// ```\n@@ -4236,7 +4364,7 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             hi: original_span.hi,\n             ctxt: original_span.ctxt,\n         };\n-        err.span_help(span_semi, \"consider removing this semicolon:\");\n+        err.span_suggestion(span_semi, \"consider removing this semicolon\", \"\".to_string());\n     }\n \n     // Instantiates the given path, which must refer to an item with the given"}, {"sha": "2a6c71dbe39232abb0412ef6ff1e0f633cb31585", "filename": "src/test/ui/block-result/block-must-not-have-result-do.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-do.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-do.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-do.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/block-must-not-have-result-do.rs"}, {"sha": "a770ebeab35a7acc863dac283e06dec7fda01f42", "filename": "src/test/ui/block-result/block-must-not-have-result-do.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-do.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-do.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-do.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,11 @@\n+error[E0308]: mismatched types\n+  --> $DIR/block-must-not-have-result-do.rs:13:9\n+   |\n+13 |         true //~  ERROR mismatched types\n+   |         ^^^^ expected (), found bool\n+   |\n+   = note: expected type `()`\n+              found type `bool`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "8728685fc8b026e4f8cf4f4559278eb96c119e5c", "filename": "src/test/ui/block-result/block-must-not-have-result-res.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-res.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-res.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-res.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/block-must-not-have-result-res.rs"}, {"sha": "b1146864566e33ec54fa13681c0c8e2a24c11929", "filename": "src/test/ui/block-result/block-must-not-have-result-res.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-res.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-res.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-res.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,11 @@\n+error[E0308]: mismatched types\n+  --> $DIR/block-must-not-have-result-res.rs:15:9\n+   |\n+15 |         true //~  ERROR mismatched types\n+   |         ^^^^ expected (), found bool\n+   |\n+   = note: expected type `()`\n+              found type `bool`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "a0fb470e1e4d0f1887a13e7b9967184102455dc2", "filename": "src/test/ui/block-result/block-must-not-have-result-while.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-while.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-while.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-while.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/block-must-not-have-result-while.rs"}, {"sha": "31ec7cdd3c5abc39a10d9b8b5cc2f2c10518149a", "filename": "src/test/ui/block-result/block-must-not-have-result-while.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-while.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-while.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fblock-must-not-have-result-while.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,11 @@\n+error[E0308]: mismatched types\n+  --> $DIR/block-must-not-have-result-while.rs:13:9\n+   |\n+13 |         true //~  ERROR mismatched types\n+   |         ^^^^ expected (), found bool\n+   |\n+   = note: expected type `()`\n+              found type `bool`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "530a0e415622815150b4d26221f1bbf95ea9561c", "filename": "src/test/ui/block-result/consider-removing-last-semi.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fconsider-removing-last-semi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fconsider-removing-last-semi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fconsider-removing-last-semi.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/consider-removing-last-semi.rs"}, {"sha": "282583d32a665dcaa0568e9276a3e7d9c41dedf8", "filename": "src/test/ui/block-result/consider-removing-last-semi.stderr", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fconsider-removing-last-semi.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fconsider-removing-last-semi.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fconsider-removing-last-semi.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,30 @@\n+error[E0308]: mismatched types\n+  --> $DIR/consider-removing-last-semi.rs:11:18\n+   |\n+11 |   fn f() -> String {  //~ ERROR mismatched types\n+   |  __________________^\n+12 | |     0u8;\n+13 | |     \"bla\".to_string();  //~ HELP consider removing this semicolon\n+   | |                      - help: consider removing this semicolon\n+14 | | }\n+   | |_^ expected struct `std::string::String`, found ()\n+   |\n+   = note: expected type `std::string::String`\n+              found type `()`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/consider-removing-last-semi.rs:16:18\n+   |\n+16 |   fn g() -> String {  //~ ERROR mismatched types\n+   |  __________________^\n+17 | |     \"this won't work\".to_string();\n+18 | |     \"removeme\".to_string(); //~ HELP consider removing this semicolon\n+   | |                           - help: consider removing this semicolon\n+19 | | }\n+   | |_^ expected struct `std::string::String`, found ()\n+   |\n+   = note: expected type `std::string::String`\n+              found type `()`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "192f78e41cb43cdf23d71c231f4661fc63ac3870", "filename": "src/test/ui/block-result/issue-11714.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-11714.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-11714.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-11714.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/issue-11714.rs"}, {"sha": "ed61ec6ca291f5062e7ff7fe4673be389ab45ee3", "filename": "src/test/ui/block-result/issue-11714.stderr", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-11714.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-11714.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-11714.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,17 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-11714.rs:11:18\n+   |\n+11 |   fn blah() -> i32 { //~ ERROR mismatched types\n+   |  __________________^\n+12 | |     1\n+13 | |\n+14 | |     ; //~ HELP consider removing this semicolon:\n+   | |     - help: consider removing this semicolon\n+15 | | }\n+   | |_^ expected i32, found ()\n+   |\n+   = note: expected type `i32`\n+              found type `()`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "9406199afc231904e58df233178c4f6c544673eb", "filename": "src/test/ui/block-result/issue-13428.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13428.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13428.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-13428.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/issue-13428.rs"}, {"sha": "5e8d92f64e29344d7389d6f932d5a89c5dd64d50", "filename": "src/test/ui/block-result/issue-13428.stderr", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13428.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13428.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-13428.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,33 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-13428.rs:13:20\n+   |\n+13 |   fn foo() -> String {  //~ ERROR mismatched types\n+   |  ____________________^\n+14 | |     format!(\"Hello {}\",\n+15 | |             \"world\")\n+16 | |     // Put the trailing semicolon on its own line to test that the\n+17 | |     // note message gets the offending semicolon exactly\n+18 | |     ;   //~ HELP consider removing this semicolon\n+   | |     - help: consider removing this semicolon\n+19 | | }\n+   | |_^ expected struct `std::string::String`, found ()\n+   |\n+   = note: expected type `std::string::String`\n+              found type `()`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/issue-13428.rs:21:20\n+   |\n+21 |   fn bar() -> String {  //~ ERROR mismatched types\n+   |  ____________________^\n+22 | |     \"foobar\".to_string()\n+23 | |     ;   //~ HELP consider removing this semicolon\n+   | |     - help: consider removing this semicolon\n+24 | | }\n+   | |_^ expected struct `std::string::String`, found ()\n+   |\n+   = note: expected type `std::string::String`\n+              found type `()`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "e4ed87c3cb0cd5baac0a663c3af4a76006e38c9f", "filename": "src/test/ui/block-result/issue-13624.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/issue-13624.rs"}, {"sha": "72ff859d7e93a0f71bbbafcb25e79b5e804038bb", "filename": "src/test/ui/block-result/issue-13624.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,20 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-13624.rs:17:5\n+   |\n+17 |     Enum::EnumStructVariant { x: 1, y: 2, z: 3 }\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected (), found enum `a::Enum`\n+   |\n+   = note: expected type `()`\n+              found type `a::Enum`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/issue-13624.rs:32:9\n+   |\n+32 |         a::Enum::EnumStructVariant { x, y, z } => {\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected (), found enum `a::Enum`\n+   |\n+   = note: expected type `()`\n+              found type `a::Enum`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "9df63583998692931f52c1496887aa130881e382", "filename": "src/test/ui/block-result/issue-20862.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-20862.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-20862.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-20862.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/issue-20862.rs"}, {"sha": "e4367f170ce1856dbb33c6660800e6aeb2b23171", "filename": "src/test/ui/block-result/issue-20862.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-20862.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-20862.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-20862.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,19 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-20862.rs:12:5\n+   |\n+11 | fn foo(x: i32) {\n+   |                - possibly return type missing here?\n+12 |     |y| x + y\n+   |     ^^^^^^^^^ expected (), found closure\n+   |\n+   = note: expected type `()`\n+              found type `[closure@$DIR/issue-20862.rs:12:5: 12:14 x:_]`\n+\n+error[E0618]: expected function, found `()`\n+  --> $DIR/issue-20862.rs:17:13\n+   |\n+17 |     let x = foo(5)(2);\n+   |             ^^^^^^^^^\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "81f66e3e2cfeeb855648c2ae8b1d4af4a89a2674", "filename": "src/test/ui/block-result/issue-22645.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-22645.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-22645.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-22645.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/issue-22645.rs"}, {"sha": "3921a301c922393d5d7af0fb2230d7398970983b", "filename": "src/test/ui/block-result/issue-22645.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-22645.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-22645.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-22645.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,21 @@\n+error[E0277]: the trait bound `{integer}: Scalar` is not satisfied\n+  --> $DIR/issue-22645.rs:25:5\n+   |\n+25 |   b + 3 //~ ERROR E0277\n+   |     ^ the trait `Scalar` is not implemented for `{integer}`\n+   |\n+   = help: the following implementations were found:\n+             <f64 as Scalar>\n+   = note: required because of the requirements on the impl of `std::ops::Add<{integer}>` for `Bob`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/issue-22645.rs:25:3\n+   |\n+25 |   b + 3 //~ ERROR E0277\n+   |   ^^^^^ expected (), found struct `Bob`\n+   |\n+   = note: expected type `()`\n+              found type `Bob`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "7928c04b9df87b5f3130ea6158933a6a010ada15", "filename": "src/test/ui/block-result/issue-3563.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-3563.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-3563.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-3563.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/issue-3563.rs"}, {"sha": "c6ab4cbb2a7c5e0d22175085a222af9123c0366c", "filename": "src/test/ui/block-result/issue-3563.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-3563.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-3563.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-3563.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,19 @@\n+error[E0599]: no method named `b` found for type `&Self` in the current scope\n+  --> $DIR/issue-3563.rs:13:17\n+   |\n+13 |         || self.b()\n+   |                 ^\n+\n+error[E0308]: mismatched types\n+  --> $DIR/issue-3563.rs:13:9\n+   |\n+12 |     fn a(&self) {\n+   |                 - possibly return type missing here?\n+13 |         || self.b()\n+   |         ^^^^^^^^^^^ expected (), found closure\n+   |\n+   = note: expected type `()`\n+              found type `[closure@$DIR/issue-3563.rs:13:9: 13:20 self:_]`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "1cbb7588e17df5e5fdddb3d8f0ff54f5e2608bbf", "filename": "src/test/ui/block-result/issue-5500.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-5500.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-5500.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-5500.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/issue-5500.rs"}, {"sha": "bffe2a82ca8d756961d54f284a0efbc2beff9928", "filename": "src/test/ui/block-result/issue-5500.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-5500.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Fissue-5500.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-5500.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,11 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-5500.rs:12:5\n+   |\n+12 |     &panic!()\n+   |     ^^^^^^^^^ expected (), found reference\n+   |\n+   = note: expected type `()`\n+              found type `&_`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "291b7a16f141b8215b34efadbc4a9d6adda44474", "filename": "src/test/ui/block-result/unexpected-return-on-unit.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Funexpected-return-on-unit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Funexpected-return-on-unit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Funexpected-return-on-unit.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that we do some basic error correcton in the tokeniser (and don't spew\n+// too many bogus errors).\n+\n+fn foo() -> usize {\n+    3\n+}\n+\n+fn bar() {\n+    foo()\n+}\n+\n+fn main() {\n+    bar()\n+}"}, {"sha": "18d0cc4814056f94d93958568a4c2a8c28056a1a", "filename": "src/test/ui/block-result/unexpected-return-on-unit.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Funexpected-return-on-unit.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fblock-result%2Funexpected-return-on-unit.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Funexpected-return-on-unit.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,15 @@\n+error[E0308]: mismatched types\n+  --> $DIR/unexpected-return-on-unit.rs:19:5\n+   |\n+19 |     foo()\n+   |     ^^^^^ expected (), found usize\n+   |\n+   = note: expected type `()`\n+              found type `usize`\n+help: did you mean to add a semicolon here?\n+   |     foo();\n+help: possibly return type missing here?\n+   | fn bar() -> usize {\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "49e8b9febc2bb6a4e44bc093bffe9e705d2a7b28", "filename": "src/test/ui/coercion-missing-tail-expected-type.stderr", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fcoercion-missing-tail-expected-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fcoercion-missing-tail-expected-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion-missing-tail-expected-type.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -4,33 +4,25 @@ error[E0308]: mismatched types\n 13 |   fn plus_one(x: i32) -> i32 {\n    |  ____________________________^\n 14 | |     x + 1;\n+   | |          - help: consider removing this semicolon\n 15 | | }\n    | |_^ expected i32, found ()\n    |\n    = note: expected type `i32`\n               found type `()`\n-help: consider removing this semicolon:\n-  --> $DIR/coercion-missing-tail-expected-type.rs:14:10\n-   |\n-14 |     x + 1;\n-   |          ^\n \n error[E0308]: mismatched types\n   --> $DIR/coercion-missing-tail-expected-type.rs:17:29\n    |\n 17 |   fn foo() -> Result<u8, u64> {\n    |  _____________________________^\n 18 | |     Ok(1);\n+   | |          - help: consider removing this semicolon\n 19 | | }\n    | |_^ expected enum `std::result::Result`, found ()\n    |\n    = note: expected type `std::result::Result<u8, u64>`\n               found type `()`\n-help: consider removing this semicolon:\n-  --> $DIR/coercion-missing-tail-expected-type.rs:18:10\n-   |\n-18 |     Ok(1);\n-   |          ^\n \n error: aborting due to previous error(s)\n "}, {"sha": "8c61fc602e09e7432845ce35afe008b3771af1d6", "filename": "src/test/ui/mismatched_types/for-loop-has-unit-body.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fmismatched_types%2Ffor-loop-has-unit-body.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fmismatched_types%2Ffor-loop-has-unit-body.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Ffor-loop-has-unit-body.rs?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "previous_filename": "src/test/compile-fail/for-loop-has-unit-body.rs"}, {"sha": "6787fe91bf30847efb0b341f3c18d04db2151a44", "filename": "src/test/ui/mismatched_types/for-loop-has-unit-body.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fmismatched_types%2Ffor-loop-has-unit-body.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fmismatched_types%2Ffor-loop-has-unit-body.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Ffor-loop-has-unit-body.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -0,0 +1,11 @@\n+error[E0308]: mismatched types\n+  --> $DIR/for-loop-has-unit-body.rs:13:9\n+   |\n+13 |         x //~ ERROR mismatched types\n+   |         ^ expected (), found integral variable\n+   |\n+   = note: expected type `()`\n+              found type `{integer}`\n+\n+error: aborting due to previous error(s)\n+"}, {"sha": "083c1f953330c0dd4baab3a4dcc4e62dcfb0bd71", "filename": "src/test/ui/mismatched_types/issue-19109.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-19109.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-19109.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-19109.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-19109.rs:14:5\n    |\n+13 | fn function(t: &mut Trait) {\n+   |                            - help: possibly return type missing here? `-> *mut Trait `\n 14 |     t as *mut Trait\n    |     ^^^^^^^^^^^^^^^ expected (), found *-ptr\n    |"}, {"sha": "53e9cb2177892eec1f54842fee6091ad2c747b56", "filename": "src/test/ui/resolve/token-error-correct-3.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c65d29615c391c958ebf75dd65258ec23e175c/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr?ref=69c65d29615c391c958ebf75dd65258ec23e175c", "patch": "@@ -35,7 +35,9 @@ error[E0308]: mismatched types\n   --> $DIR/token-error-correct-3.rs:25:13\n    |\n 25 |             fs::create_dir_all(path.as_ref()).map(|()| true) //~ ERROR: mismatched types\n-   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected (), found enum `std::result::Result`\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^- help: did you mean to add a semicolon here? `;`\n+   |             |\n+   |             expected (), found enum `std::result::Result`\n    |\n    = note: expected type `()`\n               found type `std::result::Result<bool, std::io::Error>`"}]}