{"sha": "8a4fecb554353a89f854726c02058e764863e64a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhhNGZlY2I1NTQzNTNhODlmODU0NzI2YzAyMDU4ZTc2NDg2M2U2NGE=", "commit": {"author": {"name": "Temirkhan Myrzamadi", "email": "hirrolot@gmail.com", "date": "2020-08-05T21:30:02Z"}, "committer": {"name": "Temirkhan Myrzamadi", "email": "hirrolot@gmail.com", "date": "2020-08-05T21:30:02Z"}, "message": "Fix some Clippy warnings in librustc_serialize", "tree": {"sha": "36251abe3cd2d1dc2710814101c8386130ec940e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36251abe3cd2d1dc2710814101c8386130ec940e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8a4fecb554353a89f854726c02058e764863e64a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8a4fecb554353a89f854726c02058e764863e64a", "html_url": "https://github.com/rust-lang/rust/commit/8a4fecb554353a89f854726c02058e764863e64a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8a4fecb554353a89f854726c02058e764863e64a/comments", "author": {"login": "Hirrolot", "id": 40539574, "node_id": "MDQ6VXNlcjQwNTM5NTc0", "avatar_url": "https://avatars.githubusercontent.com/u/40539574?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hirrolot", "html_url": "https://github.com/Hirrolot", "followers_url": "https://api.github.com/users/Hirrolot/followers", "following_url": "https://api.github.com/users/Hirrolot/following{/other_user}", "gists_url": "https://api.github.com/users/Hirrolot/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hirrolot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hirrolot/subscriptions", "organizations_url": "https://api.github.com/users/Hirrolot/orgs", "repos_url": "https://api.github.com/users/Hirrolot/repos", "events_url": "https://api.github.com/users/Hirrolot/events{/privacy}", "received_events_url": "https://api.github.com/users/Hirrolot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Hirrolot", "id": 40539574, "node_id": "MDQ6VXNlcjQwNTM5NTc0", "avatar_url": "https://avatars.githubusercontent.com/u/40539574?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hirrolot", "html_url": "https://github.com/Hirrolot", "followers_url": "https://api.github.com/users/Hirrolot/followers", "following_url": "https://api.github.com/users/Hirrolot/following{/other_user}", "gists_url": "https://api.github.com/users/Hirrolot/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hirrolot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hirrolot/subscriptions", "organizations_url": "https://api.github.com/users/Hirrolot/orgs", "repos_url": "https://api.github.com/users/Hirrolot/repos", "events_url": "https://api.github.com/users/Hirrolot/events{/privacy}", "received_events_url": "https://api.github.com/users/Hirrolot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db870ea71b6dcc7a91b999420b88f41d3cdd13e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/db870ea71b6dcc7a91b999420b88f41d3cdd13e1", "html_url": "https://github.com/rust-lang/rust/commit/db870ea71b6dcc7a91b999420b88f41d3cdd13e1"}], "stats": {"total": 116, "additions": 42, "deletions": 74}, "files": [{"sha": "49b8094abd0eb5d64f7c491d1c292c0498a23cb1", "filename": "src/librustc_serialize/collection_impls.rs", "status": "modified", "additions": 6, "deletions": 18, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/8a4fecb554353a89f854726c02058e764863e64a/src%2Flibrustc_serialize%2Fcollection_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a4fecb554353a89f854726c02058e764863e64a/src%2Flibrustc_serialize%2Fcollection_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_serialize%2Fcollection_impls.rs?ref=8a4fecb554353a89f854726c02058e764863e64a", "patch": "@@ -86,11 +86,9 @@ where\n {\n     fn encode<S: Encoder>(&self, e: &mut S) -> Result<(), S::Error> {\n         e.emit_map(self.len(), |e| {\n-            let mut i = 0;\n-            for (key, val) in self {\n+            for (i, (key, val)) in self.iter().enumerate() {\n                 e.emit_map_elt_key(i, |e| key.encode(e))?;\n                 e.emit_map_elt_val(i, |e| val.encode(e))?;\n-                i += 1;\n             }\n             Ok(())\n         })\n@@ -121,10 +119,8 @@ where\n {\n     fn encode<S: Encoder>(&self, s: &mut S) -> Result<(), S::Error> {\n         s.emit_seq(self.len(), |s| {\n-            let mut i = 0;\n-            for e in self {\n+            for (i, e) in self.iter().enumerate() {\n                 s.emit_seq_elt(i, |s| e.encode(s))?;\n-                i += 1;\n             }\n             Ok(())\n         })\n@@ -154,11 +150,9 @@ where\n {\n     fn encode<E: Encoder>(&self, e: &mut E) -> Result<(), E::Error> {\n         e.emit_map(self.len(), |e| {\n-            let mut i = 0;\n-            for (key, val) in self {\n+            for (i, (key, val)) in self.iter().enumerate() {\n                 e.emit_map_elt_key(i, |e| key.encode(e))?;\n                 e.emit_map_elt_val(i, |e| val.encode(e))?;\n-                i += 1;\n             }\n             Ok(())\n         })\n@@ -192,10 +186,8 @@ where\n {\n     fn encode<E: Encoder>(&self, s: &mut E) -> Result<(), E::Error> {\n         s.emit_seq(self.len(), |s| {\n-            let mut i = 0;\n-            for e in self {\n+            for (i, e) in self.iter().enumerate() {\n                 s.emit_seq_elt(i, |s| e.encode(s))?;\n-                i += 1;\n             }\n             Ok(())\n         })\n@@ -227,11 +219,9 @@ where\n {\n     fn encode<E: Encoder>(&self, e: &mut E) -> Result<(), E::Error> {\n         e.emit_map(self.len(), |e| {\n-            let mut i = 0;\n-            for (key, val) in self {\n+            for (i, (key, val)) in self.iter().enumerate() {\n                 e.emit_map_elt_key(i, |e| key.encode(e))?;\n                 e.emit_map_elt_val(i, |e| val.encode(e))?;\n-                i += 1;\n             }\n             Ok(())\n         })\n@@ -265,10 +255,8 @@ where\n {\n     fn encode<E: Encoder>(&self, s: &mut E) -> Result<(), E::Error> {\n         s.emit_seq(self.len(), |s| {\n-            let mut i = 0;\n-            for e in self {\n+            for (i, e) in self.iter().enumerate() {\n                 s.emit_seq_elt(i, |s| e.encode(s))?;\n-                i += 1;\n             }\n             Ok(())\n         })"}, {"sha": "ab7f6975325bc0ccb403e5fd99483d2829bae210", "filename": "src/librustc_serialize/json.rs", "status": "modified", "additions": 34, "deletions": 54, "changes": 88, "blob_url": "https://github.com/rust-lang/rust/blob/8a4fecb554353a89f854726c02058e764863e64a/src%2Flibrustc_serialize%2Fjson.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a4fecb554353a89f854726c02058e764863e64a/src%2Flibrustc_serialize%2Fjson.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_serialize%2Fjson.rs?ref=8a4fecb554353a89f854726c02058e764863e64a", "patch": "@@ -78,19 +78,17 @@\n //!     data_vector: Vec<u8>,\n //! }\n //!\n-//! fn main() {\n-//!     let object = TestStruct {\n-//!         data_int: 1,\n-//!         data_str: \"homura\".to_string(),\n-//!         data_vector: vec![2,3,4,5],\n-//!     };\n+//! let object = TestStruct {\n+//!     data_int: 1,\n+//!     data_str: \"homura\".to_string(),\n+//!     data_vector: vec![2,3,4,5],\n+//! };\n //!\n-//!     // Serialize using `json::encode`\n-//!     let encoded = json::encode(&object).unwrap();\n+//! // Serialize using `json::encode`\n+//! let encoded = json::encode(&object).unwrap();\n //!\n-//!     // Deserialize using `json::decode`\n-//!     let decoded: TestStruct = json::decode(&encoded[..]).unwrap();\n-//! }\n+//! // Deserialize using `json::decode`\n+//! let decoded: TestStruct = json::decode(&encoded[..]).unwrap();\n //! ```\n //!\n //! ## Using the `ToJson` trait\n@@ -125,16 +123,14 @@\n //!     val: Json,\n //! }\n //!\n-//! fn main() {\n-//!     let num = ComplexNum { a: 0.0001, b: 12.539 };\n-//!     let data: String = json::encode(&ComplexNumRecord{\n-//!         uid: 1,\n-//!         dsc: \"test\".to_string(),\n-//!         val: num.to_json(),\n-//!     }).unwrap();\n-//!     println!(\"data: {}\", data);\n-//!     // data: {\"uid\":1,\"dsc\":\"test\",\"val\":\"0.0001+12.539i\"};\n-//! }\n+//! let num = ComplexNum { a: 0.0001, b: 12.539 };\n+//! let data: String = json::encode(&ComplexNumRecord{\n+//!     uid: 1,\n+//!     dsc: \"test\".to_string(),\n+//!     val: num.to_json(),\n+//! }).unwrap();\n+//! println!(\"data: {}\", data);\n+//! // data: {\"uid\":1,\"dsc\":\"test\",\"val\":\"0.0001+12.539i\"};\n //! ```\n //!\n //! ### Verbose example of `ToJson` usage\n@@ -164,19 +160,17 @@\n //!     }\n //! }\n //!\n-//! fn main() {\n-//!     // Serialize using `ToJson`\n-//!     let input_data = TestStruct {\n-//!         data_int: 1,\n-//!         data_str: \"madoka\".to_string(),\n-//!         data_vector: vec![2,3,4,5],\n-//!     };\n-//!     let json_obj: Json = input_data.to_json();\n-//!     let json_str: String = json_obj.to_string();\n+//! // Serialize using `ToJson`\n+//! let input_data = TestStruct {\n+//!     data_int: 1,\n+//!     data_str: \"madoka\".to_string(),\n+//!     data_vector: vec![2,3,4,5],\n+//! };\n+//! let json_obj: Json = input_data.to_json();\n+//! let json_str: String = json_obj.to_string();\n //!\n-//!     // Deserialize like before\n-//!     let decoded: TestStruct = json::decode(&json_str).unwrap();\n-//! }\n+//! // Deserialize like before\n+//! let decoded: TestStruct = json::decode(&json_str).unwrap();\n //! ```\n \n use self::DecoderError::*;\n@@ -1269,34 +1263,22 @@ impl Json {\n \n     /// Returns `true` if the Json value is a `Number`.\n     pub fn is_number(&self) -> bool {\n-        match *self {\n-            Json::I64(_) | Json::U64(_) | Json::F64(_) => true,\n-            _ => false,\n-        }\n+        matches!(*self, Json::I64(_) | Json::U64(_) | Json::F64(_))\n     }\n \n     /// Returns `true` if the Json value is a `i64`.\n     pub fn is_i64(&self) -> bool {\n-        match *self {\n-            Json::I64(_) => true,\n-            _ => false,\n-        }\n+        matches!(*self, Json::I64(_))\n     }\n \n     /// Returns `true` if the Json value is a `u64`.\n     pub fn is_u64(&self) -> bool {\n-        match *self {\n-            Json::U64(_) => true,\n-            _ => false,\n-        }\n+        matches!(*self, Json::U64(_))\n     }\n \n     /// Returns `true` if the Json value is a `f64`.\n     pub fn is_f64(&self) -> bool {\n-        match *self {\n-            Json::F64(_) => true,\n-            _ => false,\n-        }\n+        matches!(*self, Json::F64(_))\n     }\n \n     /// If the Json value is a number, returns or cast it to a `i64`;\n@@ -1416,6 +1398,7 @@ enum ParserState {\n /// structure of the JSON stream.\n ///\n /// An example is `foo.bar[3].x`.\n+#[derive(Default)]\n pub struct Stack {\n     stack: Vec<InternalStackElement>,\n     str_buffer: Vec<u8>,\n@@ -1442,7 +1425,7 @@ enum InternalStackElement {\n \n impl Stack {\n     pub fn new() -> Stack {\n-        Stack { stack: Vec::new(), str_buffer: Vec::new() }\n+        Self::default()\n     }\n \n     /// Returns The number of elements in the Stack.\n@@ -1547,10 +1530,7 @@ impl Stack {\n \n     // Used by Parser to test whether the top-most element is an index.\n     fn last_is_index(&self) -> bool {\n-        match self.stack.last() {\n-            Some(InternalIndex(_)) => true,\n-            _ => false,\n-        }\n+        matches!(self.stack.last(), Some(InternalIndex(_)))\n     }\n \n     // Used by Parser to increment the index of the top-most element."}, {"sha": "fa4423e261d1c98ccaf8e2494969cce8a300038e", "filename": "src/librustc_serialize/opaque.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8a4fecb554353a89f854726c02058e764863e64a/src%2Flibrustc_serialize%2Fopaque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a4fecb554353a89f854726c02058e764863e64a/src%2Flibrustc_serialize%2Fopaque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_serialize%2Fopaque.rs?ref=8a4fecb554353a89f854726c02058e764863e64a", "patch": "@@ -118,13 +118,13 @@ impl serialize::Encoder for Encoder {\n \n     #[inline]\n     fn emit_f64(&mut self, v: f64) -> EncodeResult {\n-        let as_u64: u64 = unsafe { ::std::mem::transmute(v) };\n+        let as_u64: u64 = v.to_bits();\n         self.emit_u64(as_u64)\n     }\n \n     #[inline]\n     fn emit_f32(&mut self, v: f32) -> EncodeResult {\n-        let as_u32: u32 = unsafe { ::std::mem::transmute(v) };\n+        let as_u32: u32 = v.to_bits();\n         self.emit_u32(as_u32)\n     }\n "}]}