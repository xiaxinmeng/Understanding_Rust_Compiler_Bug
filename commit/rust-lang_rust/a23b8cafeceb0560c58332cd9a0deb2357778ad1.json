{"sha": "a23b8cafeceb0560c58332cd9a0deb2357778ad1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyM2I4Y2FmZWNlYjA1NjBjNTgzMzJjZDlhMGRlYjIzNTc3NzhhZDE=", "commit": {"author": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-09-18T08:12:29Z"}, "committer": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-09-20T17:08:06Z"}, "message": "rustc: don't hash the --extern crate name, but the original one, in DefPath.", "tree": {"sha": "c0b844e72f088f7e7ac71bce583fffdfd58a00ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0b844e72f088f7e7ac71bce583fffdfd58a00ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a23b8cafeceb0560c58332cd9a0deb2357778ad1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a23b8cafeceb0560c58332cd9a0deb2357778ad1", "html_url": "https://github.com/rust-lang/rust/commit/a23b8cafeceb0560c58332cd9a0deb2357778ad1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a23b8cafeceb0560c58332cd9a0deb2357778ad1/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "221d1a97e505d00fc1664c5b2d9041f8b78aa933", "url": "https://api.github.com/repos/rust-lang/rust/commits/221d1a97e505d00fc1664c5b2d9041f8b78aa933", "html_url": "https://github.com/rust-lang/rust/commit/221d1a97e505d00fc1664c5b2d9041f8b78aa933"}], "stats": {"total": 22, "additions": 11, "deletions": 11}, "files": [{"sha": "f404f60cc9cefa766afeb4ec3f814f6ed68bddef", "filename": "src/librustc/hir/map/definitions.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a23b8cafeceb0560c58332cd9a0deb2357778ad1/src%2Flibrustc%2Fhir%2Fmap%2Fdefinitions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a23b8cafeceb0560c58332cd9a0deb2357778ad1/src%2Flibrustc%2Fhir%2Fmap%2Fdefinitions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fdefinitions.rs?ref=a23b8cafeceb0560c58332cd9a0deb2357778ad1", "patch": "@@ -115,11 +115,7 @@ impl DefPath {\n     pub fn to_string(&self, tcx: TyCtxt) -> String {\n         let mut s = String::with_capacity(self.data.len() * 16);\n \n-        if self.krate == LOCAL_CRATE {\n-            s.push_str(&tcx.crate_name(self.krate));\n-        } else {\n-            s.push_str(&tcx.sess.cstore.original_crate_name(self.krate));\n-        }\n+        s.push_str(&tcx.original_crate_name(self.krate));\n         s.push_str(\"/\");\n         s.push_str(&tcx.crate_disambiguator(self.krate));\n \n@@ -141,7 +137,7 @@ impl DefPath {\n     }\n \n     pub fn deterministic_hash_to<H: Hasher>(&self, tcx: TyCtxt, state: &mut H) {\n-        tcx.crate_name(self.krate).hash(state);\n+        tcx.original_crate_name(self.krate).hash(state);\n         tcx.crate_disambiguator(self.krate).hash(state);\n         self.data.hash(state);\n     }"}, {"sha": "d5e5f4402bb854d8d38884c94a928be0f92df168", "filename": "src/librustc/ty/context.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a23b8cafeceb0560c58332cd9a0deb2357778ad1/src%2Flibrustc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a23b8cafeceb0560c58332cd9a0deb2357778ad1/src%2Flibrustc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcontext.rs?ref=a23b8cafeceb0560c58332cd9a0deb2357778ad1", "patch": "@@ -513,6 +513,14 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n         }\n     }\n \n+    pub fn original_crate_name(self, cnum: CrateNum) -> token::InternedString {\n+        if cnum == LOCAL_CRATE {\n+            self.crate_name.clone()\n+        } else {\n+            self.sess.cstore.original_crate_name(cnum)\n+        }\n+    }\n+\n     pub fn crate_disambiguator(self, cnum: CrateNum) -> token::InternedString {\n         if cnum == LOCAL_CRATE {\n             self.sess.local_crate_disambiguator()"}, {"sha": "fdf5185eb69e2f205e3aa3d0aabe5daaa5d7e422", "filename": "src/librustc/ty/item_path.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a23b8cafeceb0560c58332cd9a0deb2357778ad1/src%2Flibrustc%2Fty%2Fitem_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a23b8cafeceb0560c58332cd9a0deb2357778ad1/src%2Flibrustc%2Fty%2Fitem_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fitem_path.rs?ref=a23b8cafeceb0560c58332cd9a0deb2357778ad1", "patch": "@@ -101,11 +101,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n             RootMode::Absolute => {\n                 // In absolute mode, just write the crate name\n                 // unconditionally.\n-                if cnum == LOCAL_CRATE {\n-                    buffer.push(&self.crate_name(cnum));\n-                } else {\n-                    buffer.push(&self.sess.cstore.original_crate_name(cnum));\n-                }\n+                buffer.push(&self.original_crate_name(cnum));\n             }\n         }\n     }"}]}