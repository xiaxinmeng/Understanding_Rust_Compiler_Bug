{"sha": "e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUwYjFiM2JiYzFjNzk2ZTNhMzVhNzIzZTg3NWVjODJjOGFkMzcxYzA=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-07T12:57:09Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-25T14:03:11Z"}, "message": "ci: extract disabling git crlf handling into a script", "tree": {"sha": "1a64c62eab2eb8a7564dfd07d45009c5502677f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1a64c62eab2eb8a7564dfd07d45009c5502677f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl2zAJ8ACgkQPgar6Auq\n8Zy6jg/9E9Sml04tEj04Dm7SlT8s/kX+tyCc7Scl4MgJX322oCe1Kr8WvZntVn6J\n+r1Yqdy+kmiBhpXUIWw+X3lZ6EN593QEKe+VTm0UEPXQCz7ywQmAjqAzluh23PHe\nORo3ny2eemTg7hiXYMXdROAm3j+GpEkj0XZC57SoR5raQTrmPGiWaOYeiFYU41ak\nYJbG61mcZJwvPBeZ3N3Du6tDBwNuMHWZHWJssM8oGAchUiIARNMOwFhXhpWnZLmC\nf58V1zUMlLFZaWy0kL6m5634ivRz8qHL5+LWJP0sBkunG60+7SkRvMU67nSmZuSg\nc9sUSnDxponwSYdAFO0ZXgMwusGTUT2rxEqaEDhpqvbW9XKzzNSA/loyjAodn3n0\n2Pu7lni2/fu0DcGWxb+emPOG2Gt4o6EJK7xrK4Lfh4ayyvBvcxr3rejuaEnY0AbB\nOJPfWcGKJpBfoyv/0IgelxWcan3eAunVYDkI4m77OZH/8lmjiwsPRGmVMdgQVNvd\nIle0TpvOAmL+rtft2mkZP+ewsIatIpkQLTA8q9Dlmx2SFl0gg/9PEU1k0svitpFI\nu8foguVvW7RkuLB09kVluSiYB/d0GpHANVcDE7pBd69eR2Y4+XDaz+xHTorfAXNr\nVk2k/CF2C4mCJMugW9cqx9sXnjRzr5/I4jZwA8UR9DpDeubeUkw=\n=+25n\n-----END PGP SIGNATURE-----", "payload": "tree 1a64c62eab2eb8a7564dfd07d45009c5502677f6\nparent 6dd074a8f6bbf126492e15ea2eadaed54ac3d887\nauthor Pietro Albini <pietro@pietroalbini.org> 1570453029 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1572012191 +0200\n\nci: extract disabling git crlf handling into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0", "html_url": "https://github.com/rust-lang/rust/commit/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6dd074a8f6bbf126492e15ea2eadaed54ac3d887", "url": "https://api.github.com/repos/rust-lang/rust/commits/6dd074a8f6bbf126492e15ea2eadaed54ac3d887", "html_url": "https://github.com/rust-lang/rust/commit/6dd074a8f6bbf126492e15ea2eadaed54ac3d887"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "3c99ede9adeb5e3ff4f6aea3022f80e57bf73501", "filename": "src/ci/azure-pipelines/steps/install-windows-build-deps.yml", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0/src%2Fci%2Fazure-pipelines%2Fsteps%2Finstall-windows-build-deps.yml", "raw_url": "https://github.com/rust-lang/rust/raw/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0/src%2Fci%2Fazure-pipelines%2Fsteps%2Finstall-windows-build-deps.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Finstall-windows-build-deps.yml?ref=e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0", "patch": "@@ -1,7 +1,4 @@\n steps:\n-- bash: git config --replace-all --global core.autocrlf false\n-  displayName: \"Disable git automatic line ending conversion (on C:/)\"\n-\n # Download and install MSYS2, needed primarily for the test suite (run-make) but\n # also used by the MinGW toolchain for assembling things.\n #"}, {"sha": "df8e8e59d7260888d3612600c09d1abc8d6fd3b8", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0", "patch": "@@ -87,6 +87,10 @@ steps:\n   displayName: Ensure the build happens on C:\\ instead of D:\\\n   condition: and(succeeded(), not(variables.SKIP_JOB))\n \n+- bash: src/ci/scripts/disable-git-crlf-conversion.sh\n+  displayName: \"Disable git automatic line ending conversion (on C:/)\"\n+  condition: and(succeeded(), not(variables.SKIP_JOB))\n+\n - template: install-windows-build-deps.yml\n \n # Looks like docker containers have IPv6 disabled by default, so let's turn it\n@@ -104,8 +108,9 @@ steps:\n # re-enables autocrlf. We've not tracked down the exact cause -- and there may\n # be multiple -- but this should ensure submodules are checked out with the\n # appropriate line endings.\n-- bash: git config --replace-all --global core.autocrlf false\n-  displayName: \"Disable git automatic line ending conversion\"\n+- bash: src/ci/scripts/disable-git-crlf-conversion.sh\n+  displayName: Disable git automatic line ending conversion\n+  condition: and(succeeded(), not(variables.SKIP_JOB))\n \n # Check out all our submodules, but more quickly than using git by using one of\n # our custom scripts"}, {"sha": "836145fbb8e602e5c8868929d451a8fb2a35d37f", "filename": "src/ci/scripts/disable-git-crlf-conversion.sh", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0/src%2Fci%2Fscripts%2Fdisable-git-crlf-conversion.sh", "raw_url": "https://github.com/rust-lang/rust/raw/e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0/src%2Fci%2Fscripts%2Fdisable-git-crlf-conversion.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fdisable-git-crlf-conversion.sh?ref=e0b1b3bbc1c796e3a35a723e875ec82c8ad371c0", "patch": "@@ -0,0 +1,13 @@\n+#!/bin/bash\n+# Disable automatic line ending conversion, which is enabled by default on\n+# Azure's Windows image. Having the conversion enabled caused regressions both\n+# in our test suite (it broke miri tests) and in the ecosystem, since we\n+# started shipping install scripts with CRLF endings instead of the old LF.\n+#\n+# Note that we do this a couple times during the build as the PATH and current\n+# user/directory change, e.g. when mingw is enabled.\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+git config --replace-all --global core.autocrlf false"}]}