{"sha": "d34915f691ca78596f57fcb73bbc9de08675d65a", "node_id": "C_kwDOAAsO6NoAKGQzNDkxNWY2OTFjYTc4NTk2ZjU3ZmNiNzNiYmM5ZGUwODY3NWQ2NWE", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-05-10T15:09:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-10T15:09:35Z"}, "message": "Rollup merge of #96879 - notriddle:notriddle/search-ranking, r=GuillaumeGomez\n\nrustdoc: search result ranking fix\n\n# Before\n\n![image](https://user-images.githubusercontent.com/1593513/167477286-91049761-67f9-4a73-8fb7-09dbb19ca76c.png)\n\n# After\n\n![image](https://user-images.githubusercontent.com/1593513/167477345-6733bc0f-4bb2-4625-9f7f-094031e36414.png)", "tree": {"sha": "427f33b804831917de064889cf9cbe7477b04a4b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/427f33b804831917de064889cf9cbe7477b04a4b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d34915f691ca78596f57fcb73bbc9de08675d65a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJieoAvCRBK7hj4Ov3rIwAAfIcIABsKiBikRZGpnsRqjpRfM/sA\npLoRlX9UxhXAwaZXV/3aGyjtJS2WXoE3sCZ5MsUUm8szGhiM/gzwQhv+p+Dmn4sv\nsDyKDV3TfPUze8ukgtGfu5L4IeUupci1m4RS8+7i9KzmlSMlvmP/seiBt4+LrQEV\nEzA1icLI/07iH0gp7RrwNmzkfu6gybBtJN1WVoEixtHc5jtAY0YAl7hMLOr+F+72\nIabYxjon++Kp7cUe3w6M/VNMy/tL/42ozKqZ8nWv2UrMHGHmcR10xQhd2zgv8rFU\nvebfRGLQXRFYu+xlRtHUYMjEjJQ4wg65LQCvFtRG2uDz5RSqGdWnB8EdlaKypiI=\n=Y+rN\n-----END PGP SIGNATURE-----\n", "payload": "tree 427f33b804831917de064889cf9cbe7477b04a4b\nparent 7274447c36949bb63bef0a78bc23f8842d8c7320\nparent a9a90d450d11a06dff8bc49a89352e733e904fcf\nauthor Yuki Okushi <jtitor@2k36.org> 1652195375 +0900\ncommitter GitHub <noreply@github.com> 1652195375 +0900\n\nRollup merge of #96879 - notriddle:notriddle/search-ranking, r=GuillaumeGomez\n\nrustdoc: search result ranking fix\n\n# Before\n\n![image](https://user-images.githubusercontent.com/1593513/167477286-91049761-67f9-4a73-8fb7-09dbb19ca76c.png)\n\n# After\n\n![image](https://user-images.githubusercontent.com/1593513/167477345-6733bc0f-4bb2-4625-9f7f-094031e36414.png)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d34915f691ca78596f57fcb73bbc9de08675d65a", "html_url": "https://github.com/rust-lang/rust/commit/d34915f691ca78596f57fcb73bbc9de08675d65a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d34915f691ca78596f57fcb73bbc9de08675d65a/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7274447c36949bb63bef0a78bc23f8842d8c7320", "url": "https://api.github.com/repos/rust-lang/rust/commits/7274447c36949bb63bef0a78bc23f8842d8c7320", "html_url": "https://github.com/rust-lang/rust/commit/7274447c36949bb63bef0a78bc23f8842d8c7320"}, {"sha": "a9a90d450d11a06dff8bc49a89352e733e904fcf", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9a90d450d11a06dff8bc49a89352e733e904fcf", "html_url": "https://github.com/rust-lang/rust/commit/a9a90d450d11a06dff8bc49a89352e733e904fcf"}], "stats": {"total": 37, "additions": 36, "deletions": 1}, "files": [{"sha": "7754d626e209ef179ef6ced58973c4af34eb1538", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=d34915f691ca78596f57fcb73bbc9de08675d65a", "patch": "@@ -1323,7 +1323,6 @@ window.initSearch = rawSearchIndex => {\n                 }\n             }\n             lev = levenshtein(searchWord, elem.pathLast);\n-            lev += lev_add;\n             if (lev > 0 && elem.pathLast.length > 2 && searchWord.indexOf(elem.pathLast) > -1)\n             {\n                 if (elem.pathLast.length < 6) {\n@@ -1332,6 +1331,7 @@ window.initSearch = rawSearchIndex => {\n                     lev = 0;\n                 }\n             }\n+            lev += lev_add;\n             if (lev > MAX_LEV_DISTANCE) {\n                 return;\n             } else if (index !== -1 && elem.fullPath.length < 2) {"}, {"sha": "7dcdd402312483fad08d960e98b9a6ee2ac301ea", "filename": "src/test/rustdoc-js-std/path-ordering.js", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Ftest%2Frustdoc-js-std%2Fpath-ordering.js", "raw_url": "https://github.com/rust-lang/rust/raw/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Ftest%2Frustdoc-js-std%2Fpath-ordering.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-js-std%2Fpath-ordering.js?ref=d34915f691ca78596f57fcb73bbc9de08675d65a", "patch": "@@ -0,0 +1,12 @@\n+const QUERY = 'hashset::insert';\n+\n+const EXPECTED = {\n+    'others': [\n+        // ensure hashset::insert comes first\n+        { 'path': 'std::collections::hash_set::HashSet', 'name': 'insert' },\n+        { 'path': 'std::collections::hash_set::HashSet', 'name': 'get_or_insert' },\n+        { 'path': 'std::collections::hash_set::HashSet', 'name': 'get_or_insert_with' },\n+        { 'path': 'std::collections::hash_set::HashSet', 'name': 'get_or_insert_owned' },\n+        { 'path': 'std::collections::hash_map::HashMap', 'name': 'insert' },\n+    ],\n+};"}, {"sha": "4aee569b0f481c4ee6791cb5ac800bad4991182f", "filename": "src/test/rustdoc-js/path-ordering.js", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Ftest%2Frustdoc-js%2Fpath-ordering.js", "raw_url": "https://github.com/rust-lang/rust/raw/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Ftest%2Frustdoc-js%2Fpath-ordering.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-js%2Fpath-ordering.js?ref=d34915f691ca78596f57fcb73bbc9de08675d65a", "patch": "@@ -0,0 +1,14 @@\n+// exact-check\n+\n+const QUERY = 'b::ccccccc';\n+\n+const EXPECTED = {\n+    'others': [\n+        // `ccccccc` is an exact match for all three of these.\n+        // However `b` is a closer match for `bb` than for any\n+        // of the others, so it ought to go first.\n+        { 'path': 'path_ordering::bb', 'name': 'Ccccccc' },\n+        { 'path': 'path_ordering::aa', 'name': 'Ccccccc' },\n+        { 'path': 'path_ordering::dd', 'name': 'Ccccccc' },\n+    ],\n+};"}, {"sha": "7843cf7f9dc489a0830fec7decb6288f7ea637c6", "filename": "src/test/rustdoc-js/path-ordering.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Ftest%2Frustdoc-js%2Fpath-ordering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d34915f691ca78596f57fcb73bbc9de08675d65a/src%2Ftest%2Frustdoc-js%2Fpath-ordering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-js%2Fpath-ordering.rs?ref=d34915f691ca78596f57fcb73bbc9de08675d65a", "patch": "@@ -0,0 +1,9 @@\n+pub mod dd {\n+    pub struct Ccccccc;\n+}\n+pub mod aa {\n+    pub struct Ccccccc;\n+}\n+pub mod bb {\n+    pub struct Ccccccc;\n+}"}]}