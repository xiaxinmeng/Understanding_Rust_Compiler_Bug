{"sha": "03ca33406e983e7748deab09c7677c7f4cdaeeb7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzY2EzMzQwNmU5ODNlNzc0OGRlYWIwOWM3Njc3YzdmNGNkYWVlYjc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-04T12:53:43Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-04T12:53:43Z"}, "message": "Modernize tests", "tree": {"sha": "01bd57ef9cffcc910d9729ebc59b7205fd2c3c8b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/01bd57ef9cffcc910d9729ebc59b7205fd2c3c8b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/03ca33406e983e7748deab09c7677c7f4cdaeeb7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/03ca33406e983e7748deab09c7677c7f4cdaeeb7", "html_url": "https://github.com/rust-lang/rust/commit/03ca33406e983e7748deab09c7677c7f4cdaeeb7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/03ca33406e983e7748deab09c7677c7f4cdaeeb7/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f754e0518e7f2860891079a117a3e4bc6f4a8fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f754e0518e7f2860891079a117a3e4bc6f4a8fd", "html_url": "https://github.com/rust-lang/rust/commit/9f754e0518e7f2860891079a117a3e4bc6f4a8fd"}], "stats": {"total": 124, "additions": 60, "deletions": 64}, "files": [{"sha": "9fb5c050e0f0559a4f1bc5ff3f44dbd81bb6f831", "filename": "crates/ra_ide/src/completion/complete_fn_param.rs", "status": "modified", "additions": 60, "deletions": 64, "changes": 124, "blob_url": "https://github.com/rust-lang/rust/blob/03ca33406e983e7748deab09c7677c7f4cdaeeb7/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03ca33406e983e7748deab09c7677c7f4cdaeeb7/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs?ref=03ca33406e983e7748deab09c7677c7f4cdaeeb7", "patch": "@@ -54,85 +54,81 @@ pub(super) fn complete_fn_param(acc: &mut Completions, ctx: &CompletionContext)\n \n #[cfg(test)]\n mod tests {\n-    use crate::completion::{test_utils::do_completion, CompletionItem, CompletionKind};\n-    use insta::assert_debug_snapshot;\n+    use expect::{expect, Expect};\n \n-    fn do_magic_completion(code: &str) -> Vec<CompletionItem> {\n-        do_completion(code, CompletionKind::Magic)\n+    use crate::completion::{test_utils::do_completion, CompletionKind};\n+\n+    fn check(ra_fixture: &str, expect: Expect) {\n+        let actual = do_completion(ra_fixture, CompletionKind::Magic);\n+        expect.assert_debug_eq(&actual);\n     }\n \n     #[test]\n     fn test_param_completion_last_param() {\n-        assert_debug_snapshot!(\n-        do_magic_completion(\n-                r\"\n-                fn foo(file_id: FileId) {}\n-                fn bar(file_id: FileId) {}\n-                fn baz(file<|>) {}\n-                \",\n-        ),\n-            @r###\"\n-        [\n-            CompletionItem {\n-                label: \"file_id: FileId\",\n-                source_range: 61..65,\n-                delete: 61..65,\n-                insert: \"file_id: FileId\",\n-                lookup: \"file_id\",\n-            },\n-        ]\n-        \"###\n+        check(\n+            r#\"\n+fn foo(file_id: FileId) {}\n+fn bar(file_id: FileId) {}\n+fn baz(file<|>) {}\n+\"#,\n+            expect![[r#\"\n+                [\n+                    CompletionItem {\n+                        label: \"file_id: FileId\",\n+                        source_range: 61..65,\n+                        delete: 61..65,\n+                        insert: \"file_id: FileId\",\n+                        lookup: \"file_id\",\n+                    },\n+                ]\n+            \"#]],\n         );\n     }\n \n     #[test]\n     fn test_param_completion_nth_param() {\n-        assert_debug_snapshot!(\n-        do_magic_completion(\n-                r\"\n-                fn foo(file_id: FileId) {}\n-                fn bar(file_id: FileId) {}\n-                fn baz(file<|>, x: i32) {}\n-                \",\n-        ),\n-            @r###\"\n-        [\n-            CompletionItem {\n-                label: \"file_id: FileId\",\n-                source_range: 61..65,\n-                delete: 61..65,\n-                insert: \"file_id: FileId\",\n-                lookup: \"file_id\",\n-            },\n-        ]\n-        \"###\n+        check(\n+            r#\"\n+fn foo(file_id: FileId) {}\n+fn bar(file_id: FileId) {}\n+fn baz(file<|>, x: i32) {}\n+\"#,\n+            expect![[r#\"\n+                [\n+                    CompletionItem {\n+                        label: \"file_id: FileId\",\n+                        source_range: 61..65,\n+                        delete: 61..65,\n+                        insert: \"file_id: FileId\",\n+                        lookup: \"file_id\",\n+                    },\n+                ]\n+            \"#]],\n         );\n     }\n \n     #[test]\n     fn test_param_completion_trait_param() {\n-        assert_debug_snapshot!(\n-        do_magic_completion(\n-                r\"\n-                pub(crate) trait SourceRoot {\n-                    pub fn contains(&self, file_id: FileId) -> bool;\n-                    pub fn module_map(&self) -> &ModuleMap;\n-                    pub fn lines(&self, file_id: FileId) -> &LineIndex;\n-                    pub fn syntax(&self, file<|>)\n-                }\n-                \",\n-        ),\n-            @r###\"\n-        [\n-            CompletionItem {\n-                label: \"file_id: FileId\",\n-                source_range: 208..212,\n-                delete: 208..212,\n-                insert: \"file_id: FileId\",\n-                lookup: \"file_id\",\n-            },\n-        ]\n-        \"###\n+        check(\n+            r#\"\n+pub(crate) trait SourceRoot {\n+    pub fn contains(&self, file_id: FileId) -> bool;\n+    pub fn module_map(&self) -> &ModuleMap;\n+    pub fn lines(&self, file_id: FileId) -> &LineIndex;\n+    pub fn syntax(&self, file<|>)\n+}\n+\"#,\n+            expect![[r#\"\n+                [\n+                    CompletionItem {\n+                        label: \"file_id: FileId\",\n+                        source_range: 208..212,\n+                        delete: 208..212,\n+                        insert: \"file_id: FileId\",\n+                        lookup: \"file_id\",\n+                    },\n+                ]\n+            \"#]],\n         );\n     }\n }"}]}