{"sha": "a09b7ebfd3372460b9b8013f76f049e6d4869456", "node_id": "C_kwDOAAsO6NoAKGEwOWI3ZWJmZDMzNzI0NjBiOWI4MDEzZjc2ZjA0OWU2ZDQ4Njk0NTY", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-07-29T16:10:43Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-07-29T16:10:43Z"}, "message": "Use DefKind instead of FnKind for recursion lint.", "tree": {"sha": "81e363403fa3f41300c8319859b53f3578d8fdb7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/81e363403fa3f41300c8319859b53f3578d8fdb7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a09b7ebfd3372460b9b8013f76f049e6d4869456", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a09b7ebfd3372460b9b8013f76f049e6d4869456", "html_url": "https://github.com/rust-lang/rust/commit/a09b7ebfd3372460b9b8013f76f049e6d4869456", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a09b7ebfd3372460b9b8013f76f049e6d4869456/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6733bc30667b18c0c2deef39c8318b7b39ed6536", "url": "https://api.github.com/repos/rust-lang/rust/commits/6733bc30667b18c0c2deef39c8318b7b39ed6536", "html_url": "https://github.com/rust-lang/rust/commit/6733bc30667b18c0c2deef39c8318b7b39ed6536"}], "stats": {"total": 9, "additions": 2, "deletions": 7}, "files": [{"sha": "bc6241b38100db4c1bc9d61881da6b7d1b43a814", "filename": "compiler/rustc_mir_build/src/lints.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a09b7ebfd3372460b9b8013f76f049e6d4869456/compiler%2Frustc_mir_build%2Fsrc%2Flints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a09b7ebfd3372460b9b8013f76f049e6d4869456/compiler%2Frustc_mir_build%2Fsrc%2Flints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Flints.rs?ref=a09b7ebfd3372460b9b8013f76f049e6d4869456", "patch": "@@ -1,7 +1,7 @@\n use rustc_data_structures::graph::iterate::{\n     NodeStatus, TriColorDepthFirstSearch, TriColorVisitor,\n };\n-use rustc_hir::intravisit::FnKind;\n+use rustc_hir::def::DefKind;\n use rustc_middle::mir::{BasicBlock, BasicBlocks, Body, Operand, TerminatorKind};\n use rustc_middle::ty::subst::{GenericArg, InternalSubsts};\n use rustc_middle::ty::{self, AssocItem, AssocItemContainer, Instance, TyCtxt};\n@@ -12,12 +12,7 @@ use std::ops::ControlFlow;\n pub(crate) fn check<'tcx>(tcx: TyCtxt<'tcx>, body: &Body<'tcx>) {\n     let def_id = body.source.def_id().expect_local();\n \n-    if let Some(fn_kind) = tcx.hir().get_by_def_id(def_id).fn_kind() {\n-        if let FnKind::Closure = fn_kind {\n-            // closures can't recur, so they don't matter.\n-            return;\n-        }\n-\n+    if let DefKind::Fn | DefKind::AssocFn = tcx.def_kind(def_id) {\n         // If this is trait/impl method, extract the trait's substs.\n         let trait_substs = match tcx.opt_associated_item(def_id.to_def_id()) {\n             Some(AssocItem {"}]}