{"sha": "9d888eadc53d42621a4e43ff3ea481f45d99c1a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkODg4ZWFkYzUzZDQyNjIxYTRlNDNmZjNlYTQ4MWY0NWQ5OWMxYTU=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-12-11T16:17:32Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-12-17T07:53:02Z"}, "message": "Rename await into cycle_error for the single threaded case and add some comments", "tree": {"sha": "ac8919209ec5afa3b29f3cf9b0a7880fb76b309e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac8919209ec5afa3b29f3cf9b0a7880fb76b309e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d888eadc53d42621a4e43ff3ea481f45d99c1a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d888eadc53d42621a4e43ff3ea481f45d99c1a5", "html_url": "https://github.com/rust-lang/rust/commit/9d888eadc53d42621a4e43ff3ea481f45d99c1a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d888eadc53d42621a4e43ff3ea481f45d99c1a5/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e53ecff6ccc57e339a39a2241676f91224df062", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e53ecff6ccc57e339a39a2241676f91224df062", "html_url": "https://github.com/rust-lang/rust/commit/8e53ecff6ccc57e339a39a2241676f91224df062"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "6e513d68f60f52fe9a372062aaa8314a497d75da", "filename": "src/librustc/ty/query/job.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9d888eadc53d42621a4e43ff3ea481f45d99c1a5/src%2Flibrustc%2Fty%2Fquery%2Fjob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d888eadc53d42621a4e43ff3ea481f45d99c1a5/src%2Flibrustc%2Fty%2Fquery%2Fjob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fjob.rs?ref=9d888eadc53d42621a4e43ff3ea481f45d99c1a5", "patch": "@@ -91,7 +91,7 @@ impl<'tcx> QueryJob<'tcx> {\n     #[cfg(not(parallel_queries))]\n     #[inline(never)]\n     #[cold]\n-    pub(super) fn await<'lcx, 'a, D: QueryDescription<'tcx>>(\n+    pub(super) fn cycle_error<'lcx, 'a, D: QueryDescription<'tcx>>(\n         &self,\n         tcx: TyCtxt<'_, 'tcx, 'lcx>,\n         span: Span,"}, {"sha": "0929628ac819b922e5143d18ac6131314e3398bb", "filename": "src/librustc/ty/query/plumbing.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9d888eadc53d42621a4e43ff3ea481f45d99c1a5/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d888eadc53d42621a4e43ff3ea481f45d99c1a5/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs?ref=9d888eadc53d42621a4e43ff3ea481f45d99c1a5", "patch": "@@ -153,9 +153,13 @@ impl<'a, 'tcx, Q: QueryDescription<'tcx>> JobOwner<'a, 'tcx, Q> {\n             };\n             mem::drop(lock);\n \n+            // If we are single-threaded we know that we have cycle error,\n+            // so we just turn the errror\n             #[cfg(not(parallel_queries))]\n-            return job.await(tcx, span);\n+            return job.cycle_error(tcx, span);\n \n+            // With parallel queries we might just have to wait on some other\n+            // thread\n             #[cfg(parallel_queries)]\n             {\n                 if let Err(cycle) = job.await(tcx, span) {"}]}