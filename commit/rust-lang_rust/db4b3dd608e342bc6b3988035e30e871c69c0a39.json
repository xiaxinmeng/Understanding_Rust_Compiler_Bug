{"sha": "db4b3dd608e342bc6b3988035e30e871c69c0a39", "node_id": "C_kwDOAAsO6NoAKGRiNGIzZGQ2MDhlMzQyYmM2YjM5ODgwMzVlMzBlODcxYzY5YzBhMzk", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-03-03T19:06:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-03T19:06:28Z"}, "message": "Rollup merge of #108667 - compiler-errors:issue-108664, r=estebank\n\nFix another ICE in `point_at_expr_source_of_inferred_type`\n\nTypes coming from method probes must only be investigated *structurally*, since they often contain escaping infer variables from generalization and autoderef. We already have a hack in this PR that erases variables from types, so just use that.\n\nFixes #108664\n\nThe note attached to this error is pretty bad:\n\n```\nhere the type of `primes` is inferred to be `[_]`\n```\n\nBut that's unrelated to the PR.\n\n---\n\nSide-note: This is a pretty easy to trigger beta regression, so I've nominated it. Alternatively, I'm slightly inclined to remove this code altogether until it can be reformulated to be more accurate and less ICEy.", "tree": {"sha": "4ed044aae9ff8ef2f66d3765b782d14ce5586828", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ed044aae9ff8ef2f66d3765b782d14ce5586828"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db4b3dd608e342bc6b3988035e30e871c69c0a39", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkAkU0CRBK7hj4Ov3rIwAAlHcIAB2VPxEvzSbDZdcrye2PTeVA\n3rpPzqouHJl1JzwpmQDp9B8l33iNnl/uvSy3/W4sKdR9gazDjn9UbUGC3G16k/QV\nN7AtOhZokd/lzPceLKylQ+VPA6IWdQ3tSFOYP7BjM6uiUVTR7BKxfM+iPT397Nuk\ntKH6o1MJLbdmm+XT+eWnYPaFrlx74g+nOKfyZn7fd0iZv5UwhLdnT62KX+8cY49W\nWgKvKW+78wK8T61e23GbDjandKrfIvfxzVFfQtYX5f5+p0wGzz/ALxNqes8ZL+lw\nmtAyniUnAwbtcIPGKKOIwtVA4HITCAL8odj6RjzK3xxX9hy+8AL2KqpSP8xhQD4=\n=uhaM\n-----END PGP SIGNATURE-----\n", "payload": "tree 4ed044aae9ff8ef2f66d3765b782d14ce5586828\nparent 1fab0fc4a2ce8fd4b98cddb7af59e190f5a198f4\nparent 4b01a1a07a4cd1a1dee16ffae384905989f1a60a\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1677870388 +0100\ncommitter GitHub <noreply@github.com> 1677870388 +0100\n\nRollup merge of #108667 - compiler-errors:issue-108664, r=estebank\n\nFix another ICE in `point_at_expr_source_of_inferred_type`\n\nTypes coming from method probes must only be investigated *structurally*, since they often contain escaping infer variables from generalization and autoderef. We already have a hack in this PR that erases variables from types, so just use that.\n\nFixes #108664\n\nThe note attached to this error is pretty bad:\n\n```\nhere the type of `primes` is inferred to be `[_]`\n```\n\nBut that's unrelated to the PR.\n\n---\n\nSide-note: This is a pretty easy to trigger beta regression, so I've nominated it. Alternatively, I'm slightly inclined to remove this code altogether until it can be reformulated to be more accurate and less ICEy.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db4b3dd608e342bc6b3988035e30e871c69c0a39", "html_url": "https://github.com/rust-lang/rust/commit/db4b3dd608e342bc6b3988035e30e871c69c0a39", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db4b3dd608e342bc6b3988035e30e871c69c0a39/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fab0fc4a2ce8fd4b98cddb7af59e190f5a198f4", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fab0fc4a2ce8fd4b98cddb7af59e190f5a198f4", "html_url": "https://github.com/rust-lang/rust/commit/1fab0fc4a2ce8fd4b98cddb7af59e190f5a198f4"}, {"sha": "4b01a1a07a4cd1a1dee16ffae384905989f1a60a", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b01a1a07a4cd1a1dee16ffae384905989f1a60a", "html_url": "https://github.com/rust-lang/rust/commit/4b01a1a07a4cd1a1dee16ffae384905989f1a60a"}], "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "7ba57b3b7a266d51761aa538e0d897ad5a67bea9", "filename": "compiler/rustc_hir_typeck/src/demand.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db4b3dd608e342bc6b3988035e30e871c69c0a39/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db4b3dd608e342bc6b3988035e30e871c69c0a39/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs?ref=db4b3dd608e342bc6b3988035e30e871c69c0a39", "patch": "@@ -315,7 +315,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                     probe::ProbeScope::TraitsInScope,\n                     None,\n                 ) {\n-                    Ok(pick) => pick.self_ty,\n+                    Ok(pick) => eraser.fold_ty(pick.self_ty),\n                     Err(_) => rcvr_ty,\n                 };\n                 // Remove one layer of references to account for `&mut self` and"}, {"sha": "4433047b75ad2d0c9dd76c46c639b217d9735896", "filename": "tests/ui/typeck/bad-type-in-vec-contains.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/db4b3dd608e342bc6b3988035e30e871c69c0a39/tests%2Fui%2Ftypeck%2Fbad-type-in-vec-contains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db4b3dd608e342bc6b3988035e30e871c69c0a39/tests%2Fui%2Ftypeck%2Fbad-type-in-vec-contains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftypeck%2Fbad-type-in-vec-contains.rs?ref=db4b3dd608e342bc6b3988035e30e871c69c0a39", "patch": "@@ -0,0 +1,7 @@\n+// The error message here still is pretty confusing.\n+\n+fn main() {\n+    let primes = Vec::new();\n+    primes.contains(3);\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "0e03388d2d58cd93cb5dcaf5e61ac30df6e66253", "filename": "tests/ui/typeck/bad-type-in-vec-contains.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/db4b3dd608e342bc6b3988035e30e871c69c0a39/tests%2Fui%2Ftypeck%2Fbad-type-in-vec-contains.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/db4b3dd608e342bc6b3988035e30e871c69c0a39/tests%2Fui%2Ftypeck%2Fbad-type-in-vec-contains.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftypeck%2Fbad-type-in-vec-contains.stderr?ref=db4b3dd608e342bc6b3988035e30e871c69c0a39", "patch": "@@ -0,0 +1,19 @@\n+error[E0308]: mismatched types\n+  --> $DIR/bad-type-in-vec-contains.rs:5:21\n+   |\n+LL |     primes.contains(3);\n+   |            -------- ^\n+   |            |        |\n+   |            |        expected `&_`, found integer\n+   |            |        help: consider borrowing here: `&3`\n+   |            arguments to this method are incorrect\n+   |            here the type of `primes` is inferred to be `[_]`\n+   |\n+   = note: expected reference `&_`\n+                   found type `{integer}`\n+note: method defined here\n+  --> $SRC_DIR/core/src/slice/mod.rs:LL:COL\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}