{"sha": "06ffdeb7816ae62175febdfa18534290bf5ad573", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA2ZmZkZWI3ODE2YWU2MjE3NWZlYmRmYTE4NTM0MjkwYmY1YWQ1NzM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-07-13T08:06:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-07-13T08:06:11Z"}, "message": "Auto merge of #43129 - Ophirr33:master, r=alexcrichton\n\nUpdated docker images to share scripts\n\nAttempts to resolve #42201. I managed to pull out five scripts (android-base-apt-get, ubuntu16-apt-get, make3, rustbuild-setup, and crosstool-ng). Let me know if there's more I can do or if I should change some names.\nr? @malbarbo", "tree": {"sha": "09a50a2c77a0c846c5b833b29a222174eb94797c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09a50a2c77a0c846c5b833b29a222174eb94797c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/06ffdeb7816ae62175febdfa18534290bf5ad573", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/06ffdeb7816ae62175febdfa18534290bf5ad573", "html_url": "https://github.com/rust-lang/rust/commit/06ffdeb7816ae62175febdfa18534290bf5ad573", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/06ffdeb7816ae62175febdfa18534290bf5ad573/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cfd4c811881ac159b8604c47b8b0b63fe7d909bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfd4c811881ac159b8604c47b8b0b63fe7d909bd", "html_url": "https://github.com/rust-lang/rust/commit/cfd4c811881ac159b8604c47b8b0b63fe7d909bd"}, {"sha": "250346128b0083c8137171af503bda194c6124dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/250346128b0083c8137171af503bda194c6124dd", "html_url": "https://github.com/rust-lang/rust/commit/250346128b0083c8137171af503bda194c6124dd"}], "stats": {"total": 1077, "additions": 366, "deletions": 711}, "files": [{"sha": "6cdaf6acfef64f5bc5fab4f98efbdec60040ab17", "filename": "src/ci/docker/arm-android/Dockerfile", "status": "modified", "additions": 3, "deletions": 22, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,31 +1,15 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && \\\n-    apt-get install -y --no-install-recommends \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  g++ \\\n-  git \\\n-  libssl-dev \\\n-  make \\\n-  pkg-config \\\n-  python2.7 \\\n-  sudo \\\n-  unzip \\\n-  xz-utils\n-\n-# dumb-init\n+COPY scripts/android-base-apt-get.sh /scripts/\n+RUN sh /scripts/android-base-apt-get.sh\n+\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n-# ndk\n COPY scripts/android-ndk.sh /scripts/\n RUN . /scripts/android-ndk.sh && \\\n     download_and_make_toolchain android-ndk-r13b-linux-x86_64.zip arm 9\n \n-# sdk\n RUN dpkg --add-architecture i386 && \\\n     apt-get update && \\\n     apt-get install -y --no-install-recommends \\\n@@ -39,7 +23,6 @@ COPY scripts/android-sdk.sh /scripts/\n RUN . /scripts/android-sdk.sh && \\\n     download_and_create_avd tools_r25.2.5-linux.zip armeabi-v7a 18\n \n-# env\n ENV PATH=$PATH:/android/sdk/tools\n ENV PATH=$PATH:/android/sdk/platform-tools\n \n@@ -51,10 +34,8 @@ ENV RUST_CONFIGURE_ARGS \\\n \n ENV SCRIPT python2.7 ../x.py test --target $TARGETS\n \n-# sccache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n COPY scripts/android-start-emulator.sh /scripts/\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\", \"/scripts/android-start-emulator.sh\"]"}, {"sha": "d289a93c35295d3795b22f3a74e89f4238663448", "filename": "src/ci/docker/armhf-gnu/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Farmhf-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Farmhf-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farmhf-gnu%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -73,13 +73,12 @@ RUN arm-linux-gnueabihf-gcc addentropy.c -o rootfs/addentropy -static\n # TODO: What is this?!\n RUN curl -O http://ftp.nl.debian.org/debian/dists/jessie/main/installer-armhf/current/images/device-tree/vexpress-v2p-ca15-tc1.dtb\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS \\"}, {"sha": "1c39e8523daaae237e43ccca90ad57697cadb4d0", "filename": "src/ci/docker/asmjs/Dockerfile", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fasmjs%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fasmjs%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fasmjs%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,15 +13,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-# dumb-init\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n-# emscripten\n COPY scripts/emscripten.sh /scripts/\n RUN bash /scripts/emscripten.sh\n \n-# env\n ENV PATH=$PATH:/emsdk-portable\n ENV PATH=$PATH:/emsdk-portable/clang/e1.37.13_64bit/\n ENV PATH=$PATH:/emsdk-portable/emscripten/1.37.13/\n@@ -36,9 +33,7 @@ ENV RUST_CONFIGURE_ARGS --target=$TARGETS\n \n ENV SCRIPT python2.7 ../x.py test --target $TARGETS\n \n-# cache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "70dfbb53da24eb479b067ab20b9c362dbae2d3f4", "filename": "src/ci/docker/cross/Dockerfile", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fcross%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -21,7 +21,6 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   libssl-dev \\\n   pkg-config\n \n-# dumb-init\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n@@ -68,5 +67,4 @@ ENV SCRIPT python2.7 ../x.py dist --target $TARGETS\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "1c9e036f093da3c75b9573fd0c34dee703e17ac1", "filename": "src/ci/docker/disabled/dist-aarch64-android/Dockerfile", "status": "modified", "additions": 3, "deletions": 21, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-aarch64-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-aarch64-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-aarch64-android%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,31 +1,15 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && \\\n-    apt-get install -y --no-install-recommends \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  g++ \\\n-  git \\\n-  libssl-dev \\\n-  make \\\n-  pkg-config \\\n-  python2.7 \\\n-  sudo \\\n-  unzip \\\n-  xz-utils\n-\n-# dumb-init\n+COPY scripts/android-base-apt-get.sh /scripts/\n+RUN sh /scripts/android-base-apt-get.sh\n+\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n-# ndk\n COPY scripts/android-ndk.sh /scripts/\n RUN . /scripts/android-ndk.sh && \\\n     download_and_make_toolchain android-ndk-r13b-linux-x86_64.zip arm64 21\n \n-# env\n ENV PATH=$PATH:/android/ndk/arm64-21/bin\n \n ENV DEP_Z_ROOT=/android/ndk/arm64-21/sysroot/usr/\n@@ -42,9 +26,7 @@ ENV RUST_CONFIGURE_ARGS \\\n \n ENV SCRIPT python2.7 ../x.py dist --target $HOSTS --host $HOSTS\n \n-# sccache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "326e00548b1ce2bc85baa809c389cb7f8148d9b4", "filename": "src/ci/docker/disabled/dist-armv7-android/Dockerfile", "status": "modified", "additions": 2, "deletions": 20, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-armv7-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-armv7-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-armv7-android%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,26 +1,11 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && \\\n-    apt-get install -y --no-install-recommends \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  g++ \\\n-  git \\\n-  libssl-dev \\\n-  make \\\n-  pkg-config \\\n-  python2.7 \\\n-  sudo \\\n-  unzip \\\n-  xz-utils\n+COPY scripts/android-base-apt-get.sh /scripts/\n+RUN sh /scripts/android-base-apt-get.sh\n \n-# dumb-init\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n-# ndk\n COPY scripts/android-ndk.sh /scripts/\n RUN . /scripts/android-ndk.sh && \\\n     download_ndk android-ndk-r13b-linux-x86_64.zip && \\\n@@ -31,7 +16,6 @@ RUN . /scripts/android-ndk.sh && \\\n RUN chmod 777 /android/ndk && \\\n     ln -s /android/ndk/arm-21 /android/ndk/arm\n \n-# env\n ENV PATH=$PATH:/android/ndk/arm-9/bin\n \n ENV DEP_Z_ROOT=/android/ndk/arm-9/sysroot/usr/\n@@ -60,9 +44,7 @@ ENV SCRIPT \\\n     ln -s /android/ndk/arm-9 /android/ndk/arm && \\\n     python2.7 ../x.py dist --host $HOSTS --target $HOSTS)\n \n-# sccache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "d01648e2b9d7f8589712c085bc3f1b7fd396731e", "filename": "src/ci/docker/disabled/dist-i686-android/Dockerfile", "status": "modified", "additions": 2, "deletions": 20, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-i686-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-i686-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-i686-android%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,26 +1,11 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && \\\n-    apt-get install -y --no-install-recommends \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  g++ \\\n-  git \\\n-  libssl-dev \\\n-  make \\\n-  pkg-config \\\n-  python2.7 \\\n-  sudo \\\n-  unzip \\\n-  xz-utils\n+COPY scripts/android-base-apt-get.sh /scripts/\n+RUN sh /scripts/android-base-apt-get.sh\n \n-# dumb-init\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n-# ndk\n COPY scripts/android-ndk.sh /scripts/\n RUN . /scripts/android-ndk.sh && \\\n     download_ndk android-ndk-r13b-linux-x86_64.zip && \\\n@@ -31,7 +16,6 @@ RUN . /scripts/android-ndk.sh && \\\n RUN chmod 777 /android/ndk && \\\n     ln -s /android/ndk/x86-21 /android/ndk/x86\n \n-# env\n ENV PATH=$PATH:/android/ndk/x86-9/bin\n \n ENV DEP_Z_ROOT=/android/ndk/x86-9/sysroot/usr/\n@@ -60,9 +44,7 @@ ENV SCRIPT \\\n     ln -s /android/ndk/x86-9 /android/ndk/x86 && \\\n     python2.7 ../x.py dist --host $HOSTS --target $HOSTS)\n \n-# sccache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "2622b4b3fac3bd768fc59946f0bbf65ccd43b9be", "filename": "src/ci/docker/disabled/dist-x86_64-android/Dockerfile", "status": "modified", "additions": 3, "deletions": 21, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-x86_64-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fdist-x86_64-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-x86_64-android%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,31 +1,15 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && \\\n-    apt-get install -y --no-install-recommends \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  g++ \\\n-  git \\\n-  libssl-dev \\\n-  make \\\n-  pkg-config \\\n-  python2.7 \\\n-  sudo \\\n-  unzip \\\n-  xz-utils\n-\n-# dumb-init\n+COPY scripts/android-base-apt-get.sh /scripts/\n+RUN sh /scripts/android-base-apt-get.sh\n+\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n-# ndk\n COPY scripts/android-ndk.sh /scripts/\n RUN . /scripts/android-ndk.sh && \\\n     download_and_make_toolchain android-ndk-r13b-linux-x86_64.zip x86_64 21\n \n-# env\n ENV PATH=$PATH:/android/ndk/x86_64-21/bin\n \n ENV DEP_Z_ROOT=/android/ndk/x86_64-21/sysroot/usr/\n@@ -42,9 +26,7 @@ ENV RUST_CONFIGURE_ARGS \\\n \n ENV SCRIPT python2.7 ../x.py dist --target $HOSTS --host $HOSTS\n \n-# sccache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "66d7c48022263f902fd2a5807b3d242af69c16e7", "filename": "src/ci/docker/disabled/wasm32/Dockerfile", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fwasm32%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdisabled%2Fwasm32%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fwasm32%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -15,20 +15,16 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   jq \\\n   bzip2\n \n-# dumb-init\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n-# emscripten\n COPY scripts/emscripten-wasm.sh /scripts/\n RUN bash /scripts/emscripten-wasm.sh\n COPY disabled/wasm32/node.sh /usr/local/bin/node\n \n-# cache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# env\n ENV PATH=$PATH:/emsdk-portable\n ENV PATH=$PATH:/emsdk-portable/clang/e1.37.13_64bit/\n ENV PATH=$PATH:/emsdk-portable/emscripten/1.37.13/\n@@ -42,5 +38,4 @@ ENV RUST_CONFIGURE_ARGS --target=$TARGETS --experimental-targets=WebAssembly\n \n ENV SCRIPT python2.7 ../x.py test --target $TARGETS\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "cc3b6b8c692a6903b65bee8a0747fd47a84c2844", "filename": "src/ci/docker/dist-aarch64-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-aarch64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-aarch64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-aarch64-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n-  pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -61,9 +26,8 @@ RUN ./build-toolchains.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/aarch64-unknown-linux-gnueabi/bin\n "}, {"sha": "f3beddfae0a162f0336ae09cea2dc443e6bcf9ac", "filename": "src/ci/docker/dist-android/Dockerfile", "status": "modified", "additions": 3, "deletions": 19, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-android%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,22 +1,8 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && \\\n-    apt-get install -y --no-install-recommends \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  g++ \\\n-  git \\\n-  libssl-dev \\\n-  make \\\n-  pkg-config \\\n-  python2.7 \\\n-  sudo \\\n-  unzip \\\n-  xz-utils\n-\n-# dumb-init\n+COPY scripts/android-base-apt-get.sh /scripts/\n+RUN sh /scripts/android-base-apt-get.sh\n+\n COPY scripts/dumb-init.sh /scripts/\n RUN sh /scripts/dumb-init.sh\n \n@@ -48,9 +34,7 @@ ENV RUST_CONFIGURE_ARGS \\\n \n ENV SCRIPT python2.7 ../x.py dist --target $TARGETS\n \n-# cache\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-# init\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]"}, {"sha": "590d6eb98b38232158bc79adef6e0241f36c444a", "filename": "src/ci/docker/dist-arm-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n-  pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -61,9 +26,8 @@ RUN ./build-toolchains.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/arm-unknown-linux-gnueabi/bin\n "}, {"sha": "b3dedc4b7f0fec3d0b55c2ad456e39c35a49a381", "filename": "src/ci/docker/dist-armhf-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-armhf-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-armhf-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-armhf-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n-  pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -61,9 +26,8 @@ RUN ./build-toolchains.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/arm-unknown-linux-gnueabihf/bin\n "}, {"sha": "82536b68bbe0650891bb225a7e4df0617f0c0b9d", "filename": "src/ci/docker/dist-armv7-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-armv7-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-armv7-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-armv7-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n-  pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -61,9 +26,8 @@ RUN ./build-toolchains.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/armv7-unknown-linux-gnueabihf/bin\n "}, {"sha": "24ad12a49007c335ab3397288c7b3bb62f29807c", "filename": "src/ci/docker/dist-fuchsia/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-fuchsia%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-fuchsia%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-fuchsia%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -24,14 +24,13 @@ WORKDIR /tmp\n COPY dist-fuchsia/shared.sh dist-fuchsia/build-toolchain.sh dist-fuchsia/compiler-rt-dso-handle.patch /tmp/\n RUN /tmp/build-toolchain.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV \\\n     AR_x86_64_unknown_fuchsia=x86_64-unknown-fuchsia-ar \\"}, {"sha": "036dce2a7352641a68aaf3dea0abefb74aa6f1cb", "filename": "src/ci/docker/dist-i586-gnu-i686-musl/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-i586-gnu-i686-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-i586-gnu-i686-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-i586-gnu-i686-musl%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -20,14 +20,13 @@ WORKDIR /build/\n COPY dist-i586-gnu-i686-musl/musl-libunwind-patch.patch dist-i586-gnu-i686-musl/build-musl.sh /build/\n RUN sh /build/build-musl.sh && rm -rf /build\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV RUST_CONFIGURE_ARGS \\\n       --target=i686-unknown-linux-musl,i586-unknown-linux-gnu \\"}, {"sha": "c40881332a108b421cd733c86f35842f63fa1c99", "filename": "src/ci/docker/dist-i686-freebsd/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-i686-freebsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-i686-freebsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-i686-freebsd%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -19,14 +19,13 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY dist-i686-freebsd/build-toolchain.sh /tmp/\n RUN /tmp/build-toolchain.sh i686\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV \\\n     AR_i686_unknown_freebsd=i686-unknown-freebsd10-ar \\"}, {"sha": "beb53783bac4021de5ed90535b4b88e3691236c8", "filename": "src/ci/docker/dist-i686-linux/Dockerfile", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-i686-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-i686-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-i686-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -81,9 +81,8 @@ RUN curl -Lo /rustroot/dumb-init \\\n       chmod +x /rustroot/dumb-init\n ENTRYPOINT [\"/rustroot/dumb-init\", \"--\"]\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV HOSTS=i686-unknown-linux-gnu\n "}, {"sha": "81997e0508ac5a47cf55bc2534b9860710be5939", "filename": "src/ci/docker/dist-mips-linux/Dockerfile", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -16,13 +16,13 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   libssl-dev \\\n   pkg-config\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV HOSTS=mips-unknown-linux-gnu"}, {"sha": "646cb4d256ac058d50dae4572b7ec803bb85f802", "filename": "src/ci/docker/dist-mips64-linux/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -16,13 +16,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   libssl-dev \\\n   pkg-config\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV HOSTS=mips64-unknown-linux-gnuabi64"}, {"sha": "1abb04fd8b286e553bf02fd72f9ac3d5f1c623f6", "filename": "src/ci/docker/dist-mips64el-linux/Dockerfile", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mips64el-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mips64el-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mips64el-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -16,13 +16,13 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   libssl-dev \\\n   pkg-config\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV HOSTS=mips64el-unknown-linux-gnuabi64"}, {"sha": "a78e39e7d7129d914eaf1f10cd933160f5208c2e", "filename": "src/ci/docker/dist-mipsel-linux/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mipsel-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-mipsel-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mipsel-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -16,13 +16,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   libssl-dev \\\n   pkg-config\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV HOSTS=mipsel-unknown-linux-gnu"}, {"sha": "ed9f883cc83f70c46b986dd3867bfe0b40324fb0", "filename": "src/ci/docker/dist-powerpc-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n-  pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -62,9 +27,8 @@ RUN ./build-powerpc-toolchain.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/powerpc-unknown-linux-gnu/bin\n "}, {"sha": "523211498fb4341855cd34519b13ecc555d40d74", "filename": "src/ci/docker/dist-powerpc64-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n- pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -62,9 +27,8 @@ RUN ./build-powerpc64-toolchain.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/powerpc64-unknown-linux-gnu/bin\n "}, {"sha": "06b262c515a24546f4f13a4531f11c10fd587b27", "filename": "src/ci/docker/dist-powerpc64le-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-powerpc64le-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-powerpc64le-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-powerpc64le-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n- pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -62,9 +27,8 @@ RUN apt-get install -y --no-install-recommends rpm2cpio cpio\n COPY dist-powerpc64le-linux/shared.sh dist-powerpc64le-linux/build-powerpc64le-toolchain.sh /tmp/\n RUN ./build-powerpc64le-toolchain.sh\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV \\\n     AR_powerpc64le_unknown_linux_gnu=powerpc64le-linux-gnu-ar \\"}, {"sha": "84769af12b5a608245510be8139e317063bbd376", "filename": "src/ci/docker/dist-s390x-linux/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-s390x-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-s390x-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-s390x-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n-  pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -62,9 +27,8 @@ RUN ./build-s390x-toolchain.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/s390x-ibm-linux-gnu/bin\n "}, {"sha": "b62b46701a76401fa03bb2d9cab7724e1b9fdea2", "filename": "src/ci/docker/dist-x86_64-freebsd/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-freebsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-freebsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-freebsd%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -19,14 +19,13 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY dist-x86_64-freebsd/build-toolchain.sh /tmp/\n RUN /tmp/build-toolchain.sh x86_64\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV \\\n     AR_x86_64_unknown_freebsd=x86_64-unknown-freebsd10-ar \\"}, {"sha": "d0ab47ad3dcd839f19fa0c73658bf7740ada5789", "filename": "src/ci/docker/dist-x86_64-linux/Dockerfile", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -81,9 +81,8 @@ RUN curl -Lo /rustroot/dumb-init \\\n       chmod +x /rustroot/dumb-init\n ENTRYPOINT [\"/rustroot/dumb-init\", \"--\"]\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV HOSTS=x86_64-unknown-linux-gnu\n "}, {"sha": "eebc283e96642fa1108962582afded3bc23fc40e", "filename": "src/ci/docker/dist-x86_64-musl/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-musl%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -20,14 +20,13 @@ WORKDIR /build/\n COPY dist-x86_64-musl/build-musl.sh /build/\n RUN sh /build/build-musl.sh && rm -rf /build\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV RUST_CONFIGURE_ARGS \\\n       --target=x86_64-unknown-linux-musl \\"}, {"sha": "0c1405002666b3518bf889fce72c069418f420c8", "filename": "src/ci/docker/dist-x86_64-netbsd/Dockerfile", "status": "modified", "additions": 14, "deletions": 50, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-netbsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fdist-x86_64-netbsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-netbsd%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -1,58 +1,23 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n-  automake \\\n-  bison \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  flex \\\n-  g++ \\\n-  gawk \\\n-  gdb \\\n-  git \\\n-  gperf \\\n-  help2man \\\n-  libncurses-dev \\\n-  libtool-bin \\\n-  make \\\n-  patch \\\n-  python2.7 \\\n-  sudo \\\n-  texinfo \\\n-  wget \\\n-  xz-utils \\\n-  libssl-dev \\\n-  pkg-config\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n-# Ubuntu 16.04 (this contianer) ships with make 4, but something in the\n+# Ubuntu 16.04 (this container) ships with make 4, but something in the\n # toolchains we build below chokes on that, so go back to make 3\n-RUN curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf - && \\\n-      cd make-3.81 && \\\n-      ./configure --prefix=/usr && \\\n-      make && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf make-3.81\n+COPY scripts/make3.sh /scripts/\n+RUN sh /scripts/make3.sh\n \n-RUN curl http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2 | \\\n-      tar xjf - && \\\n-      cd crosstool-ng && \\\n-      ./configure --prefix=/usr/local && \\\n-      make -j$(nproc) && \\\n-      make install && \\\n-      cd .. && \\\n-      rm -rf crosstool-ng\n+COPY scripts/crosstool-ng.sh /scripts/\n+RUN sh /scripts/crosstool-ng.sh\n \n-RUN groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n-RUN mkdir /x-tools && chown rustbuild:rustbuild /x-tools\n+COPY scripts/rustbuild-setup.sh /scripts/\n+RUN sh /scripts/rustbuild-setup.sh\n USER rustbuild\n WORKDIR /tmp\n \n@@ -61,9 +26,8 @@ RUN ./build-netbsd-toolchain.sh\n \n USER root\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n ENV PATH=$PATH:/x-tools/x86_64-unknown-netbsd/bin\n "}, {"sha": "56ff9922ae347869828b69696d443265d557bfa9", "filename": "src/ci/docker/i686-gnu-nopt/Dockerfile", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fi686-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fi686-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fi686-gnu-nopt%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,13 +13,13 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu --disable-optimize-tests"}, {"sha": "1c1333cd7c84f0895a452554211abe6dd4a9c0d7", "filename": "src/ci/docker/i686-gnu/Dockerfile", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,13 +13,13 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n+\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu"}, {"sha": "7ae3bf39a38325a61a4181adea3fb2788721074f", "filename": "src/ci/docker/scripts/android-base-apt-get.sh", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fandroid-base-apt-get.sh", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fandroid-base-apt-get.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fandroid-base-apt-get.sh?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -0,0 +1,27 @@\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -ex\n+\n+apt-get update\n+apt-get install -y --no-install-recommends \\\n+  ca-certificates \\\n+  cmake \\\n+  curl \\\n+  file \\\n+  g++ \\\n+  git \\\n+  libssl-dev \\\n+  make \\\n+  pkg-config \\\n+  python2.7 \\\n+  sudo \\\n+  unzip \\\n+  xz-utils"}, {"sha": "f6c9cc960c56de16da75212834ddc13b5a3bb108", "filename": "src/ci/docker/scripts/cross-apt-packages.sh", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fcross-apt-packages.sh", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fcross-apt-packages.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fcross-apt-packages.sh?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -0,0 +1,36 @@\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+apt-get update && apt-get install -y --no-install-recommends \\\n+  automake \\\n+  bison \\\n+  bzip2 \\\n+  ca-certificates \\\n+  cmake \\\n+  curl \\\n+  file \\\n+  flex \\\n+  g++ \\\n+  gawk \\\n+  gdb \\\n+  git \\\n+  gperf \\\n+  help2man \\\n+  libncurses-dev \\\n+  libssl-dev \\\n+  libtool-bin \\\n+  make \\\n+  patch \\\n+  pkg-config \\\n+  python2.7 \\\n+  sudo \\\n+  texinfo \\\n+  wget \\\n+  xz-utils"}, {"sha": "8b2747cf213098bcdbe70b17a9fde95405487aff", "filename": "src/ci/docker/scripts/crosstool-ng.sh", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fcrosstool-ng.sh", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fcrosstool-ng.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fcrosstool-ng.sh?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -0,0 +1,20 @@\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -ex\n+\n+url=\"http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.22.0.tar.bz2\"\n+curl $url | tar xjf -\n+cd crosstool-ng\n+./configure --prefix=/usr/local\n+make -j$(nproc)\n+make install\n+cd ..\n+rm -rf crosstool-ng"}, {"sha": "8a7845cb8f384bd82aeddb5d53723e45c6bf65fd", "filename": "src/ci/docker/scripts/make3.sh", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fmake3.sh", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Fmake3.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fmake3.sh?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -0,0 +1,19 @@\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -ex\n+\n+curl https://ftp.gnu.org/gnu/make/make-3.81.tar.gz | tar xzf -\n+cd make-3.81\n+./configure --prefix=/usr\n+make\n+make install\n+cd ..\n+rm -rf make-3.81"}, {"sha": "96efccfdff386f4ae62f03bbbb421a93c2c62a36", "filename": "src/ci/docker/scripts/rustbuild-setup.sh", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Frustbuild-setup.sh", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fscripts%2Frustbuild-setup.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Frustbuild-setup.sh?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -0,0 +1,14 @@\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -ex\n+\n+groupadd -r rustbuild && useradd -m -r -g rustbuild rustbuild\n+mkdir /x-tools && chown rustbuild:rustbuild /x-tools"}, {"sha": "a449526efcce22294b8001cff27ec8f6db8df4f5", "filename": "src/ci/docker/x86_64-gnu-aux/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-aux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-aux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-aux%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -14,13 +14,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   xz-utils \\\n   pkg-config\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu"}, {"sha": "8111118ad3d91058fe755e004428713d2a246a46", "filename": "src/ci/docker/x86_64-gnu-debug/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-debug%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-debug%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-debug%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,13 +13,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS \\"}, {"sha": "c3fe8ea51cb3fe93fcfafc93e08b1b4b354d9975", "filename": "src/ci/docker/x86_64-gnu-distcheck/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -15,13 +15,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   libssl-dev \\\n   pkg-config\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu"}, {"sha": "377e08695577935ebe3e5dfac2ff0110c691f680", "filename": "src/ci/docker/x86_64-gnu-full-bootstrap/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-full-bootstrap%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-full-bootstrap%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-full-bootstrap%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,13 +13,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS \\"}, {"sha": "a21a99e965e8338eac8a7ab22313b2c6e5be393b", "filename": "src/ci/docker/x86_64-gnu-incremental/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-incremental%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-incremental%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-incremental%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,13 +13,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu"}, {"sha": "1a9f1d2d737b884914876f282d3ca0c97f24aa2e", "filename": "src/ci/docker/x86_64-gnu-llvm-3.7/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.7%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.7%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.7%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -16,13 +16,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   zlib1g-dev \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS \\"}, {"sha": "e008b21f66fe244b74576f4b6bee68594a4f4b30", "filename": "src/ci/docker/x86_64-gnu-nopt/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,13 +13,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --disable-optimize-tests"}, {"sha": "3a6760b476225b8dd968a5f3ddebfc94724b1483", "filename": "src/ci/docker/x86_64-gnu/Dockerfile", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/06ffdeb7816ae62175febdfa18534290bf5ad573/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile?ref=06ffdeb7816ae62175febdfa18534290bf5ad573", "patch": "@@ -13,13 +13,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils\n \n-RUN curl -o /usr/local/bin/sccache \\\n-      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl && \\\n-      chmod +x /usr/local/bin/sccache\n+COPY scripts/dumb-init.sh /scripts/\n+RUN sh /scripts/dumb-init.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n \n-RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n-    dpkg -i dumb-init_*.deb && \\\n-    rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --enable-sanitizers --enable-profiler"}]}