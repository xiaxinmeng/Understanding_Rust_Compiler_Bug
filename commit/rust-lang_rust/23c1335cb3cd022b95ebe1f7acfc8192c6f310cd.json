{"sha": "23c1335cb3cd022b95ebe1f7acfc8192c6f310cd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzYzEzMzVjYjNjZDAyMmI5NWViZTFmN2FjZmM4MTkyYzZmMzEwY2Q=", "commit": {"author": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-05-25T16:00:16Z"}, "committer": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-05-25T16:00:16Z"}, "message": "Dead code.", "tree": {"sha": "963348b4afb6735ead2ccbd65cb6a3484500337d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/963348b4afb6735ead2ccbd65cb6a3484500337d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd", "html_url": "https://github.com/rust-lang/rust/commit/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd/comments", "author": null, "committer": null, "parents": [{"sha": "579b317ae8e4155c480b0d9426e54f4b98410997", "url": "https://api.github.com/repos/rust-lang/rust/commits/579b317ae8e4155c480b0d9426e54f4b98410997", "html_url": "https://github.com/rust-lang/rust/commit/579b317ae8e4155c480b0d9426e54f4b98410997"}], "stats": {"total": 59, "additions": 2, "deletions": 57}, "files": [{"sha": "e7b187ef22552a15ea478d0807c69613ef6a2ac6", "filename": "src/rt/rust_crate_cache.cpp", "status": "modified", "additions": 1, "deletions": 44, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd/src%2Frt%2Frust_crate_cache.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd/src%2Frt%2Frust_crate_cache.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_crate_cache.cpp?ref=23c1335cb3cd022b95ebe1f7acfc8192c6f310cd", "patch": "@@ -1,36 +1,6 @@\n \n #include \"rust_internal.h\"\n \n-rust_crate_cache::lib::lib(rust_dom *dom, char const *name)\n-    : handle(0),\n-      dom(dom)\n-{\n-#if defined(__WIN32__)\n-    handle = (uintptr_t)LoadLibrary(_T(name));\n-#else\n-    handle = (uintptr_t)dlopen(name, RTLD_GLOBAL|RTLD_LAZY);\n-#endif\n-    DLOG(dom, cache, \"loaded library '%s' as 0x%\"  PRIxPTR,\n-             name, handle);\n-}\n-\n-rust_crate_cache::lib::~lib() {\n-    DLOG(dom, cache, \"~rust_crate_cache::lib(0x%\" PRIxPTR \")\",\n-             handle);\n-    if (handle) {\n-#if defined(__WIN32__)\n-        FreeLibrary((HMODULE)handle);\n-#else\n-        dlclose((void*)handle);\n-#endif\n-    }\n-}\n-\n-uintptr_t\n-rust_crate_cache::lib::get_handle() {\n-    return handle;\n-}\n-\n static inline void\n adjust_disp(uintptr_t &disp, const void *oldp, const void *newp)\n {\n@@ -79,29 +49,17 @@ rust_crate_cache::get_type_desc(size_t size,\n \n rust_crate_cache::rust_crate_cache(rust_dom *dom,\n                                    rust_crate const *crate)\n-    : libs((lib**) dom->calloc(sizeof(lib*) * crate->n_libs)),\n-      type_descs(NULL),\n+    : type_descs(NULL),\n       crate(crate),\n       dom(dom),\n       idx(0)\n {\n-    I(dom, libs);\n }\n \n void\n rust_crate_cache::flush() {\n     DLOG(dom, cache, \"rust_crate_cache::flush()\");\n \n-    for (size_t i = 0; i < crate->n_libs; ++i) {\n-        lib *l = libs[i];\n-        if (l) {\n-            DLOG(dom, cache, \"rust_crate_cache::flush() deref lib %\"\n-                     PRIdPTR \" (rc=%\" PRIdPTR \")\", i, l->ref_count);\n-            l->deref();\n-        }\n-        libs[i] = NULL;\n-    }\n-\n     while (type_descs) {\n         type_desc *d = type_descs;\n         HASH_DEL(type_descs, d);\n@@ -113,7 +71,6 @@ rust_crate_cache::flush() {\n rust_crate_cache::~rust_crate_cache()\n {\n     flush();\n-    dom->free(libs);\n }\n \n //"}, {"sha": "30fc4637bede98d0a0dad06a44781d26e2d6e6be", "filename": "src/rt/rust_internal.h", "status": "modified", "additions": 1, "deletions": 13, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd/src%2Frt%2Frust_internal.h", "raw_url": "https://github.com/rust-lang/rust/raw/23c1335cb3cd022b95ebe1f7acfc8192c6f310cd/src%2Frt%2Frust_internal.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_internal.h?ref=23c1335cb3cd022b95ebe1f7acfc8192c6f310cd", "patch": "@@ -241,7 +241,7 @@ class rust_crate {\n \n     size_t pad6;\n     size_t pad7;\n-    size_t n_libs;\n+    size_t pad8;\n \n     // Crates are immutable, constructed by the compiler.\n \n@@ -286,25 +286,13 @@ rust_crate_cache : public dom_owned<rust_crate_cache>,\n                    public rc_base<rust_crate_cache>\n {\n public:\n-    class lib :\n-        public rc_base<lib>, public dom_owned<lib>\n-    {\n-        uintptr_t handle;\n-    public:\n-        rust_dom *dom;\n-        lib(rust_dom *dom, char const *name);\n-        uintptr_t get_handle();\n-        ~lib();\n-    };\n-\n     type_desc *get_type_desc(size_t size,\n                              size_t align,\n                              size_t n_descs,\n                              type_desc const **descs);\n \n private:\n \n-    lib **libs;\n     type_desc *type_descs;\n \n public:"}]}