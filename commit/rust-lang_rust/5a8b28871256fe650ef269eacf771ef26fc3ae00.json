{"sha": "5a8b28871256fe650ef269eacf771ef26fc3ae00", "node_id": "C_kwDOAAsO6NoAKDVhOGIyODg3MTI1NmZlNjUwZWYyNjllYWNmNzcxZWYyNmZjM2FlMDA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-14T21:07:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-14T21:07:04Z"}, "message": "Auto merge of #108056 - matthiaskrgr:rollup-oa6bxvh, r=matthiaskrgr\n\nRollup of 9 pull requests\n\nSuccessful merges:\n\n - #107573 (Update the minimum external LLVM to 14)\n - #107626 (Fix `x fix` on the standard library itself)\n - #107673 (update ICU4X to 1.1.0)\n - #107733 (Store metrics from `metrics.json` to CI PGO timer)\n - #108007 (Use `is_str` instead of string kind comparison)\n - #108033 (add an unstable `#[rustc_coinductive]` attribute)\n - #108039 (Refactor refcounted structural_impls via functors)\n - #108040 (Use derive attributes for uninteresting traversals)\n - #108044 (interpret: rename Pointer::from_addr \u2192 from_addr_invalid)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "1db22d6f6c3c42c467e950a180cc55850b33247f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1db22d6f6c3c42c467e950a180cc55850b33247f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5a8b28871256fe650ef269eacf771ef26fc3ae00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5a8b28871256fe650ef269eacf771ef26fc3ae00", "html_url": "https://github.com/rust-lang/rust/commit/5a8b28871256fe650ef269eacf771ef26fc3ae00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5a8b28871256fe650ef269eacf771ef26fc3ae00/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3a739a115f897379f844926ba8f8cfd880641de", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3a739a115f897379f844926ba8f8cfd880641de", "html_url": "https://github.com/rust-lang/rust/commit/e3a739a115f897379f844926ba8f8cfd880641de"}, {"sha": "b8c36429e4022f6e4e15949b264c85b126007023", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8c36429e4022f6e4e15949b264c85b126007023", "html_url": "https://github.com/rust-lang/rust/commit/b8c36429e4022f6e4e15949b264c85b126007023"}], "stats": {"total": 21, "additions": 10, "deletions": 11}, "files": [{"sha": "a22285058d48e73e1b20f0bafcb41ef55872294e", "filename": "clippy_lints/src/methods/expect_fun_call.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs?ref=5a8b28871256fe650ef269eacf771ef26fc3ae00", "patch": "@@ -33,7 +33,7 @@ pub(super) fn check<'tcx>(\n                     if (method_name.ident.name == sym::as_str || method_name.ident.name == sym::as_ref) && {\n                         let arg_type = cx.typeck_results().expr_ty(receiver);\n                         let base_type = arg_type.peel_refs();\n-                        *base_type.kind() == ty::Str || is_type_lang_item(cx, base_type, hir::LangItem::String)\n+                        base_type.is_str() || is_type_lang_item(cx, base_type, hir::LangItem::String)\n                     } {\n                         receiver\n                     } else {\n@@ -54,7 +54,7 @@ pub(super) fn check<'tcx>(\n             return false;\n         }\n         if let ty::Ref(_, ty, ..) = arg_ty.kind() {\n-            if *ty.kind() == ty::Str && can_be_static_str(cx, arg) {\n+            if ty.is_str() && can_be_static_str(cx, arg) {\n                 return false;\n             }\n         };"}, {"sha": "afdb8ce94ac43a1196929eaf41ed0dbaa90a572d", "filename": "clippy_lints/src/methods/search_is_some.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fsearch_is_some.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fsearch_is_some.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fsearch_is_some.rs?ref=5a8b28871256fe650ef269eacf771ef26fc3ae00", "patch": "@@ -8,7 +8,6 @@ use rustc_errors::Applicability;\n use rustc_hir as hir;\n use rustc_hir::PatKind;\n use rustc_lint::LateContext;\n-use rustc_middle::ty;\n use rustc_span::source_map::Span;\n use rustc_span::symbol::sym;\n \n@@ -108,7 +107,7 @@ pub(super) fn check<'tcx>(\n             if is_type_lang_item(cx, self_ty, hir::LangItem::String) {\n                 true\n             } else {\n-                *self_ty.kind() == ty::Str\n+                self_ty.is_str()\n             }\n         };\n         if_chain! {"}, {"sha": "4d704ec39ebb15941fcab6fe6981490ba7b98e1c", "filename": "clippy_lints/src/methods/single_char_pattern.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fsingle_char_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fsingle_char_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fsingle_char_pattern.rs?ref=5a8b28871256fe650ef269eacf771ef26fc3ae00", "patch": "@@ -47,7 +47,7 @@ pub(super) fn check(\n     for &(method, pos) in &PATTERN_METHODS {\n         if_chain! {\n             if let ty::Ref(_, ty, _) = cx.typeck_results().expr_ty_adjusted(receiver).kind();\n-            if *ty.kind() == ty::Str;\n+            if ty.is_str();\n             if method_name.as_str() == method && args.len() > pos;\n             let arg = &args[pos];\n             let mut applicability = Applicability::MachineApplicable;"}, {"sha": "2c20c6d752d700686b016e3c54dc81df7655a7fc", "filename": "clippy_lints/src/methods/string_extend_chars.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fstring_extend_chars.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fmethods%2Fstring_extend_chars.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fstring_extend_chars.rs?ref=5a8b28871256fe650ef269eacf771ef26fc3ae00", "patch": "@@ -5,7 +5,6 @@ use clippy_utils::ty::is_type_lang_item;\n use rustc_errors::Applicability;\n use rustc_hir as hir;\n use rustc_lint::LateContext;\n-use rustc_middle::ty;\n \n use super::STRING_EXTEND_CHARS;\n \n@@ -17,7 +16,7 @@ pub(super) fn check(cx: &LateContext<'_>, expr: &hir::Expr<'_>, recv: &hir::Expr\n     if let Some(arglists) = method_chain_args(arg, &[\"chars\"]) {\n         let target = &arglists[0].0;\n         let self_ty = cx.typeck_results().expr_ty(target).peel_refs();\n-        let ref_str = if *self_ty.kind() == ty::Str {\n+        let ref_str = if self_ty.is_str() {\n             if matches!(target.kind, hir::ExprKind::Index(..)) {\n                 \"&\"\n             } else {"}, {"sha": "b2f4b310915a6fa5b40549c86363fd97b966e84e", "filename": "clippy_lints/src/strings.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fstrings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Fstrings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fstrings.rs?ref=5a8b28871256fe650ef269eacf771ef26fc3ae00", "patch": "@@ -190,7 +190,7 @@ impl<'tcx> LateLintPass<'tcx> for StringAdd {\n             },\n             ExprKind::Index(target, _idx) => {\n                 let e_ty = cx.typeck_results().expr_ty(target).peel_refs();\n-                if matches!(e_ty.kind(), ty::Str) || is_type_lang_item(cx, e_ty, LangItem::String) {\n+                if e_ty.is_str() || is_type_lang_item(cx, e_ty, LangItem::String) {\n                     span_lint(\n                         cx,\n                         STRING_SLICE,\n@@ -407,7 +407,7 @@ impl<'tcx> LateLintPass<'tcx> for StrToString {\n             if path.ident.name == sym::to_string;\n             let ty = cx.typeck_results().expr_ty(self_arg);\n             if let ty::Ref(_, ty, ..) = ty.kind();\n-            if *ty.kind() == ty::Str;\n+            if ty.is_str();\n             then {\n                 span_lint_and_help(\n                     cx,"}, {"sha": "426c7253806e394ca362cfb49d40375955afa897", "filename": "clippy_lints/src/transmute/transmute_ref_to_ref.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Ftransmute%2Ftransmute_ref_to_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_lints%2Fsrc%2Ftransmute%2Ftransmute_ref_to_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftransmute%2Ftransmute_ref_to_ref.rs?ref=5a8b28871256fe650ef269eacf771ef26fc3ae00", "patch": "@@ -22,7 +22,8 @@ pub(super) fn check<'tcx>(\n \n     if let (ty::Ref(_, ty_from, from_mutbl), ty::Ref(_, ty_to, to_mutbl)) = (&from_ty.kind(), &to_ty.kind()) {\n         if_chain! {\n-            if let (&ty::Slice(slice_ty), &ty::Str) = (&ty_from.kind(), &ty_to.kind());\n+            if let ty::Slice(slice_ty) = *ty_from.kind();\n+            if ty_to.is_str();\n             if let ty::Uint(ty::UintTy::U8) = slice_ty.kind();\n             if from_mutbl == to_mutbl;\n             then {"}, {"sha": "d6af7a948a5c5cf774c1f12a3c6b67244bca97f8", "filename": "clippy_utils/src/ty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_utils%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a8b28871256fe650ef269eacf771ef26fc3ae00/clippy_utils%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fty.rs?ref=5a8b28871256fe650ef269eacf771ef26fc3ae00", "patch": "@@ -346,7 +346,7 @@ pub fn is_non_aggregate_primitive_type(ty: Ty<'_>) -> bool {\n pub fn is_recursively_primitive_type(ty: Ty<'_>) -> bool {\n     match *ty.kind() {\n         ty::Bool | ty::Char | ty::Int(_) | ty::Uint(_) | ty::Float(_) | ty::Str => true,\n-        ty::Ref(_, inner, _) if *inner.kind() == ty::Str => true,\n+        ty::Ref(_, inner, _) if inner.is_str() => true,\n         ty::Array(inner_type, _) | ty::Slice(inner_type) => is_recursively_primitive_type(inner_type),\n         ty::Tuple(inner_types) => inner_types.iter().all(is_recursively_primitive_type),\n         _ => false,"}]}