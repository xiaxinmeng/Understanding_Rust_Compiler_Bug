{"sha": "6e680e36a70e94f307928fee1c99b29a28eeba6e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlNjgwZTM2YTcwZTk0ZjMwNzkyOGZlZTFjOTliMjlhMjhlZWJhNmU=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-02-08T20:06:08Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-02-08T21:10:20Z"}, "message": "deprecate old style box shape strings", "tree": {"sha": "82057d01062660489355439b434168ef3ddc04a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82057d01062660489355439b434168ef3ddc04a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6e680e36a70e94f307928fee1c99b29a28eeba6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6e680e36a70e94f307928fee1c99b29a28eeba6e", "html_url": "https://github.com/rust-lang/rust/commit/6e680e36a70e94f307928fee1c99b29a28eeba6e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6e680e36a70e94f307928fee1c99b29a28eeba6e/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6dde7766ee9c2a397ef05da5c87c064f9f06118", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6dde7766ee9c2a397ef05da5c87c064f9f06118", "html_url": "https://github.com/rust-lang/rust/commit/a6dde7766ee9c2a397ef05da5c87c064f9f06118"}], "stats": {"total": 23, "additions": 14, "deletions": 9}, "files": [{"sha": "587c5c29ca3af7a364add34916001f460465e553", "filename": "src/comp/middle/shape.rs", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6e680e36a70e94f307928fee1c99b29a28eeba6e/src%2Fcomp%2Fmiddle%2Fshape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e680e36a70e94f307928fee1c99b29a28eeba6e/src%2Fcomp%2Fmiddle%2Fshape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fshape.rs?ref=6e680e36a70e94f307928fee1c99b29a28eeba6e", "patch": "@@ -48,10 +48,10 @@ const shape_i32: u8 = 6u8;\n const shape_i64: u8 = 7u8;\n const shape_f32: u8 = 8u8;\n const shape_f64: u8 = 9u8;\n-// (10 is currently unused, was evec)\n+const shape_box: u8 = 10u8;\n const shape_vec: u8 = 11u8;\n const shape_enum: u8 = 12u8;\n-const shape_box: u8 = 13u8;\n+const shape_box_old: u8 = 13u8; // deprecated, remove after snapshot\n const shape_struct: u8 = 17u8;\n const shape_box_fn: u8 = 18u8;\n const shape_UNUSED: u8 = 19u8;\n@@ -377,13 +377,8 @@ fn shape_of(ccx: @crate_ctxt, t: ty::t, ty_param_map: [uint]) -> [u8] {\n           }\n         }\n       }\n-      ty::ty_box(mt) {\n+      ty::ty_box(_) | ty::ty_opaque_box {\n         s += [shape_box];\n-        add_substr(s, shape_of(ccx, mt.ty, ty_param_map));\n-      }\n-      ty::ty_opaque_box {\n-        s += [shape_box];\n-        add_substr(s, [shape_u8]);\n       }\n       ty::ty_uniq(mt) {\n         s += [shape_uniq];"}, {"sha": "99c40164f4936f9f10226bc64f25ba426c35982b", "filename": "src/rt/rust_shape.h", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6e680e36a70e94f307928fee1c99b29a28eeba6e/src%2Frt%2Frust_shape.h", "raw_url": "https://github.com/rust-lang/rust/raw/6e680e36a70e94f307928fee1c99b29a28eeba6e/src%2Frt%2Frust_shape.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_shape.h?ref=6e680e36a70e94f307928fee1c99b29a28eeba6e", "patch": "@@ -41,9 +41,10 @@ const uint8_t SHAPE_I32 = 6u;\n const uint8_t SHAPE_I64 = 7u;\n const uint8_t SHAPE_F32 = 8u;\n const uint8_t SHAPE_F64 = 9u;\n+const uint8_t SHAPE_BOX = 10u;\n const uint8_t SHAPE_VEC = 11u;\n const uint8_t SHAPE_TAG = 12u;\n-const uint8_t SHAPE_BOX = 13u;\n+const uint8_t SHAPE_BOX_OLD = 13u; // remove after snapshot\n const uint8_t SHAPE_STRUCT = 17u;\n const uint8_t SHAPE_BOX_FN = 18u;\n const uint8_t SHAPE_OBJ = 19u;\n@@ -257,6 +258,7 @@ class ctxt {\n     void walk_vec0();\n     void walk_tag0();\n     void walk_box0();\n+    void walk_box_old0();\n     void walk_uniq0();\n     void walk_struct0();\n     void walk_res0();\n@@ -374,6 +376,7 @@ ctxt<T>::walk() {\n     case SHAPE_VEC:      walk_vec0();             break;\n     case SHAPE_TAG:      walk_tag0();             break;\n     case SHAPE_BOX:      walk_box0();             break;\n+    case SHAPE_BOX_OLD:  walk_box_old0();         break;\n     case SHAPE_STRUCT:   walk_struct0();          break;\n     case SHAPE_RES:      walk_res0();             break;\n     case SHAPE_VAR:      walk_var0();             break;\n@@ -482,6 +485,13 @@ ctxt<T>::walk_tag0() {\n template<typename T>\n void\n ctxt<T>::walk_box0() {\n+    static_cast<T *>(this)->walk_box1();\n+}\n+\n+template<typename T>\n+void\n+ctxt<T>::walk_box_old0() {\n+    // remove after snapshot\n     uint16_t sp_size = get_u16_bump(sp);\n     const uint8_t *end_sp = sp + sp_size;\n "}]}