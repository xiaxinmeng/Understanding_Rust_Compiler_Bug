{"sha": "18a21e13b49320bc20836d5d20da82375fac2bbd", "node_id": "C_kwDOAAsO6NoAKDE4YTIxZTEzYjQ5MzIwYmMyMDgzNmQ1ZDIwZGE4MjM3NWZhYzJiYmQ", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-06T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-06T09:14:57Z"}, "message": "Remove duplicated temporaries creating during box derefs elaboration\n\nTemporaries created with `MirPatch::new_temp` will be declared after\npatch application. Remove manually created duplicate declarations.\n\nRemoving duplicates exposes another issue. Visitor elaborates\nterminator twice and attempts to access new, but not yet available,\nlocal declarations. Remove duplicated call to `visit_terminator`.", "tree": {"sha": "109d28b3f434ed1bc59be1d9024d29a661fca2c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/109d28b3f434ed1bc59be1d9024d29a661fca2c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/18a21e13b49320bc20836d5d20da82375fac2bbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/18a21e13b49320bc20836d5d20da82375fac2bbd", "html_url": "https://github.com/rust-lang/rust/commit/18a21e13b49320bc20836d5d20da82375fac2bbd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/18a21e13b49320bc20836d5d20da82375fac2bbd/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "55f46419afd2e49acfc6be176ad4aeadaa5686d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/55f46419afd2e49acfc6be176ad4aeadaa5686d7", "html_url": "https://github.com/rust-lang/rust/commit/55f46419afd2e49acfc6be176ad4aeadaa5686d7"}], "stats": {"total": 8, "additions": 0, "deletions": 8}, "files": [{"sha": "f79d2afc0c6be04021ca83b96256bdff416bcc03", "filename": "compiler/rustc_mir_transform/src/elaborate_box_derefs.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/18a21e13b49320bc20836d5d20da82375fac2bbd/compiler%2Frustc_mir_transform%2Fsrc%2Felaborate_box_derefs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18a21e13b49320bc20836d5d20da82375fac2bbd/compiler%2Frustc_mir_transform%2Fsrc%2Felaborate_box_derefs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Felaborate_box_derefs.rs?ref=18a21e13b49320bc20836d5d20da82375fac2bbd", "patch": "@@ -70,7 +70,6 @@ impl<'tcx, 'a> MutVisitor<'tcx> for ElaborateBoxDerefVisitor<'tcx, 'a> {\n                 build_ptr_tys(tcx, base_ty.boxed_ty(), self.unique_did, self.nonnull_did);\n \n             let ptr_local = self.patch.new_temp(ptr_ty, source_info.span);\n-            self.local_decls.push(LocalDecl::new(ptr_ty, source_info.span));\n \n             self.patch.add_statement(location, StatementKind::StorageLive(ptr_local));\n \n@@ -125,13 +124,6 @@ impl<'tcx> MirPass<'tcx> for ElaborateBoxDerefs {\n                     index += 1;\n                 }\n \n-                if let Some(terminator) = terminator\n-                && !matches!(terminator.kind, TerminatorKind::Yield{..})\n-                {\n-                    let location = Location { block, statement_index: index };\n-                    visitor.visit_terminator(terminator, location);\n-                }\n-\n                 let location = Location { block, statement_index: index };\n                 match terminator {\n                     // yielding into a box is handled when lowering generators"}]}