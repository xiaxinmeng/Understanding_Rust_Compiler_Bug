{"sha": "3a6f3cf275061c03c8169ce50779efbda0faa845", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhNmYzY2YyNzUwNjFjMDNjODE2OWNlNTA3NzllZmJkYTBmYWE4NDU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-03T00:28:59Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-03T00:28:59Z"}, "message": "Move compiletest to src/ and cleanup build rules", "tree": {"sha": "04496acc42c514c463c01f34684a575703145134", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04496acc42c514c463c01f34684a575703145134"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a6f3cf275061c03c8169ce50779efbda0faa845", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a6f3cf275061c03c8169ce50779efbda0faa845", "html_url": "https://github.com/rust-lang/rust/commit/3a6f3cf275061c03c8169ce50779efbda0faa845", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a6f3cf275061c03c8169ce50779efbda0faa845/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "edb56507eee87e44625813a94a06b8e28dfb617e", "url": "https://api.github.com/repos/rust-lang/rust/commits/edb56507eee87e44625813a94a06b8e28dfb617e", "html_url": "https://github.com/rust-lang/rust/commit/edb56507eee87e44625813a94a06b8e28dfb617e"}], "stats": {"total": 108, "additions": 60, "deletions": 48}, "files": [{"sha": "52bc981176f84987679aef39f5016563e51ff95c", "filename": "Makefile.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "patch": "@@ -321,7 +321,7 @@ include $(CFG_SRC_DIR)/mk/stage0.mk\n include $(CFG_SRC_DIR)/mk/rt.mk\n include $(CFG_SRC_DIR)/mk/rustllvm.mk\n include $(CFG_SRC_DIR)/mk/autodep.mk\n-include $(CFG_SRC_DIR)/mk/fuzzer.mk\n+include $(CFG_SRC_DIR)/mk/tools.mk\n include $(CFG_SRC_DIR)/mk/docs.mk\n \n "}, {"sha": "ced5d6ce6fe68465984b57edbbdcfe04882c3345", "filename": "mk/fuzzer.mk", "status": "removed", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/edb56507eee87e44625813a94a06b8e28dfb617e/mk%2Ffuzzer.mk", "raw_url": "https://github.com/rust-lang/rust/raw/edb56507eee87e44625813a94a06b8e28dfb617e/mk%2Ffuzzer.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ffuzzer.mk?ref=edb56507eee87e44625813a94a06b8e28dfb617e", "patch": "@@ -1,28 +0,0 @@\n-FUZZER_CRATE := $(S)src/fuzzer/fuzzer.rc\n-FUZZER_INPUTS := $(wildcard $(addprefix $(S)src/fuzzer/, *.rs))\n-\n-define FUZZ_STAGE_N\n-\n-# We only really care about fuzzing on the host arch\n-$$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/fuzzer$$(X): \\\n-\t$$(FUZZER_CRATE) $$(FUZZER_INPUTS) \\\n-\t$$(TARGET_SREQ$(1)$(CFG_HOST_TRIPLE)) \\\n-\t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_STDLIB) \\\n-\t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_LIBRUSTC)\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) -o $$@ $$<\n-\n-# Promote the stageN target to stageN+1 host\n-# FIXME: Shouldn't need to depend on host/librustc.so once\n-# rpath is working\n-$$(HOST_BIN$(2))/fuzzer$$(X): \\\n-\t$$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/fuzzer$$(X) \\\n-\t$$(HOST_LIB$(2))/$$(CFG_LIBRUSTC)\n-\t@$$(call E, cp: $$@)\n-\t$$(Q)cp $$< $$@\n-\n-endef\n-\n-$(eval $(call FUZZ_STAGE_N,0,1))\n-$(eval $(call FUZZ_STAGE_N,1,2))\n-$(eval $(call FUZZ_STAGE_N,2,3))"}, {"sha": "112aa7b70fc133629dfb9e859560fe0401378291", "filename": "mk/tests.mk", "status": "modified", "additions": 9, "deletions": 19, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "patch": "@@ -56,10 +56,6 @@ ifdef VERBOSE\n   CTEST_TESTARGS += --verbose\n endif\n \n-# The test runner that runs the cfail/rfail/rpass and bench tests\n-COMPILETEST_CRATE := $(S)src/test/compiletest/compiletest.rc\n-COMPILETEST_INPUTS := $(wildcard $(S)src/test/compiletest/*rs)\n-\n # The standard library test crate\n STDTEST_CRATE := $(S)src/test/stdtest/stdtest.rc\n STDTEST_INPUTS := $(wildcard $(S)src/test/stdtest/*rs)\n@@ -241,61 +237,55 @@ PRETTY_PRETTY_ARGS$(2) := $$(CTEST_COMMON_ARGS$(2)) \\\n                           --build-base test/pretty/ \\\n                           --mode pretty \\\n \n-test/compiletest.stage$(2)$$(X): $$(COMPILETEST_CRATE) \\\n-                                 $$(COMPILETEST_INPUTS) \\\n-                                 $$(SREQ$(2)$$(CFG_HOST_TRIPLE))\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(2)) -o $$@ $$<\n-\n-test/compile-fail.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/compile-fail.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                                    $$(CFAIL_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(CFAIL_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/run-fail.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/run-fail.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                                $$(RFAIL_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(RFAIL_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/run-pass.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/run-pass.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                                $$(RPASS_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(RPASS_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/bench.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/bench.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                             $$(BENCH_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(BENCH_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/perf.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/perf.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                             $$(BENCH_TESTS)\n \t@$$(call E, perf: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(PERF_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/pretty-rpass.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/pretty-rpass.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                                      $$(RPASS_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(PRETTY_RPASS_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/pretty-rfail.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/pretty-rfail.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                                      $$(RFAIL_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(PRETTY_RFAIL_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/pretty-bench.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/pretty-bench.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                                      $$(BENCH_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(PRETTY_BENCH_ARGS$(2))\n \t$$(Q)touch $$@\n \n-test/pretty-pretty.stage$(2).out.tmp: test/compiletest.stage$(2)$$(X) \\\n+test/pretty-pretty.stage$(2).out.tmp: $$(HOST_BIN$(2))/compiletest$$(X) \\\n                                      $$(PRETTY_TESTS)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(2),$$<) $$(PRETTY_PRETTY_ARGS$(2))"}, {"sha": "8805cd40be159165653931891e3119fb71c1d2d8", "filename": "mk/tools.mk", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/mk%2Ftools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/mk%2Ftools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftools.mk?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "patch": "@@ -0,0 +1,50 @@\n+# Rules for non-core tools built with the compiler, both for target\n+# and host architectures\n+\n+FUZZER_CRATE := $(S)src/fuzzer/fuzzer.rc\n+FUZZER_INPUTS := $(wildcard $(addprefix $(S)src/fuzzer/, *.rs))\n+\n+# The test runner that runs the cfail/rfail/rpass and bench tests\n+COMPILETEST_CRATE := $(S)src/compiletest/compiletest.rc\n+COMPILETEST_INPUTS := $(wildcard $(S)src/compiletest/*rs)\n+\n+# FIXME: These are only built for the host arch. Eventually we'll\n+# have tools that need to built for other targets.\n+define TOOLS_STAGE_N\n+\n+$$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/fuzzer$$(X): \\\n+\t$$(FUZZER_CRATE) $$(FUZZER_INPUTS) \\\n+\t$$(TARGET_SREQ$(1)$(CFG_HOST_TRIPLE)) \\\n+\t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_STDLIB) \\\n+\t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_LIBRUSTC)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)) -o $$@ $$<\n+\n+# Promote the stageN target to stageN+1 host\n+# FIXME: Shouldn't need to depend on host/librustc.so once\n+# rpath is working\n+$$(HOST_BIN$(2))/fuzzer$$(X): \\\n+\t$$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/fuzzer$$(X) \\\n+\t$$(HOST_LIB$(2))/$$(CFG_LIBRUSTC) \\\n+\t$$(HOST_SREQ$(2))\n+\t@$$(call E, cp: $$@)\n+\t$$(Q)cp $$< $$@\n+\n+$$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/compiletest$$(X): \\\n+\t$$(COMPILETEST_CRATE) $$(COMPILETEST_INPUTS) \\\n+\t$$(TARGET_SREQ$(1)$(CFG_HOST_TRIPLE)) \\\n+\t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_STDLIB)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)) -o $$@ $$<\n+\n+$$(HOST_BIN$(2))/compiletest$$(X): \\\n+\t$$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/compiletest$$(X) \\\n+\t$$(HOST_SREQ$(2))\n+\t@$$(call E, cp: $$@)\n+\t$$(Q)cp $$< $$@\n+\n+endef\n+\n+$(eval $(call TOOLS_STAGE_N,0,1))\n+$(eval $(call TOOLS_STAGE_N,1,2))\n+$(eval $(call TOOLS_STAGE_N,2,3))"}, {"sha": "ab0415fd7c12662afdde88131fa969781a290ef9", "filename": "src/compiletest/common.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fcommon.rs?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "previous_filename": "src/test/compiletest/common.rs"}, {"sha": "2f9ffe50f81e3d217729030c254e4c70baf2c763", "filename": "src/compiletest/compiletest.rc", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fcompiletest.rc", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fcompiletest.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fcompiletest.rc?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "previous_filename": "src/test/compiletest/compiletest.rc"}, {"sha": "b75bb10bab393453bc57234bf03f695b237decdd", "filename": "src/compiletest/compiletest.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fcompiletest.rs?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "previous_filename": "src/test/compiletest/compiletest.rs"}, {"sha": "890818d457441683329c09d8fed42ed485590f9d", "filename": "src/compiletest/header.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fheader.rs?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "previous_filename": "src/test/compiletest/header.rs"}, {"sha": "6a40aaccaf4857bbb74ec270050ef6623acaf6c4", "filename": "src/compiletest/procsrv.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fprocsrv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fprocsrv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fprocsrv.rs?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "previous_filename": "src/test/compiletest/procsrv.rs"}, {"sha": "de188f3927e3f14ff7e349ec20b666e8c01cb349", "filename": "src/compiletest/runtest.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "previous_filename": "src/test/compiletest/runtest.rs"}, {"sha": "aa6c7d5abdb1d680e6f5f521b4fdfe67c0a4473a", "filename": "src/compiletest/util.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6f3cf275061c03c8169ce50779efbda0faa845/src%2Fcompiletest%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Futil.rs?ref=3a6f3cf275061c03c8169ce50779efbda0faa845", "previous_filename": "src/test/compiletest/util.rs"}]}