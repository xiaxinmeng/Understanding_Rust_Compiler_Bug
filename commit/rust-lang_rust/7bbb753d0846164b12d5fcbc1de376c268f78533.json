{"sha": "7bbb753d0846164b12d5fcbc1de376c268f78533", "node_id": "C_kwDOAAsO6NoAKDdiYmI3NTNkMDg0NjE2NGIxMmQ1ZmNiYzFkZTM3NmMyNjhmNzg1MzM", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-07-17T23:40:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-17T23:40:01Z"}, "message": "Rollup merge of #99373 - GuillaumeGomez:source-code-sidebar-tree-auto-expand, r=notriddle\n\nFix source code sidebar tree auto-expand\n\nHere is the bug:\n\n![Screenshot from 2022-07-17 13-32-00](https://user-images.githubusercontent.com/3050060/179397712-bfb1c279-0ed2-4cb5-aef5-05741921bcc3.png)\n\nIt was happening because as soon as we found the file (from the URL), every item following it was then opened, even if it wasn't supposed to.\n\nThe GUI test ensures that it doesn't happen by adding two nested levels and ensuring only this path is \"open\".\n\nr? ``@notriddle``", "tree": {"sha": "2079caddb0b126f627155743406ae05538f5f6bc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2079caddb0b126f627155743406ae05538f5f6bc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7bbb753d0846164b12d5fcbc1de376c268f78533", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi1J3RCRBK7hj4Ov3rIwAAoOMIAHbeAMP7eNvv/cefr8iGPQwp\nkUm/NtvM/gsp7kZSuaPXlaL1keR7s1ApRRZtb3CQ9L2hvayEthMbIzPiIxD9pIcw\npDlTkP5tbVQhkbM6veO0hLP+zybvt4Vs6t+kb8G6U6m+b/08IAoLbwbD04JdDA9k\nq+x6Iumv0qAUm8zXXhUeKFsDGjdc2xmKE6j+irGywsaIrUGZOPOM6h1eFwqKTCws\nTncczpjMGbDvnm5yCieQbBdEjHpFGtIOJEE8iP3mkGo1Az5dffcBP4lYjXoLr8Vt\nhzTZ0H08g8HCGREwmVvVbXAemKsgxwnPGkvlF11CkN5oyo4fty8NkYu8i0IQ3p8=\n=+Lj6\n-----END PGP SIGNATURE-----\n", "payload": "tree 2079caddb0b126f627155743406ae05538f5f6bc\nparent f3a458f735ada485b9a184f884f3bebfc936f89f\nparent 98bceb0d24a74ed9ff328b4879ada01fb0ba7581\nauthor Yuki Okushi <jtitor@2k36.org> 1658101201 +0900\ncommitter GitHub <noreply@github.com> 1658101201 +0900\n\nRollup merge of #99373 - GuillaumeGomez:source-code-sidebar-tree-auto-expand, r=notriddle\n\nFix source code sidebar tree auto-expand\n\nHere is the bug:\n\n![Screenshot from 2022-07-17 13-32-00](https://user-images.githubusercontent.com/3050060/179397712-bfb1c279-0ed2-4cb5-aef5-05741921bcc3.png)\n\nIt was happening because as soon as we found the file (from the URL), every item following it was then opened, even if it wasn't supposed to.\n\nThe GUI test ensures that it doesn't happen by adding two nested levels and ensuring only this path is \"open\".\n\nr? ``@notriddle``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7bbb753d0846164b12d5fcbc1de376c268f78533", "html_url": "https://github.com/rust-lang/rust/commit/7bbb753d0846164b12d5fcbc1de376c268f78533", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7bbb753d0846164b12d5fcbc1de376c268f78533/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3a458f735ada485b9a184f884f3bebfc936f89f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3a458f735ada485b9a184f884f3bebfc936f89f", "html_url": "https://github.com/rust-lang/rust/commit/f3a458f735ada485b9a184f884f3bebfc936f89f"}, {"sha": "98bceb0d24a74ed9ff328b4879ada01fb0ba7581", "url": "https://api.github.com/repos/rust-lang/rust/commits/98bceb0d24a74ed9ff328b4879ada01fb0ba7581", "html_url": "https://github.com/rust-lang/rust/commit/98bceb0d24a74ed9ff328b4879ada01fb0ba7581"}], "stats": {"total": 32, "additions": 26, "deletions": 6}, "files": [{"sha": "a6a0b09ef31fef7c6ed1edd0204d0e93573fd89d", "filename": "src/librustdoc/html/static/js/source-script.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js?ref=7bbb753d0846164b12d5fcbc1de376c268f78533", "patch": "@@ -33,7 +33,7 @@ function createDirEntry(elem, parent, fullPath, hasFoundFile) {\n     folders.className = \"folders\";\n     if (elem.dirs) {\n         for (const dir of elem.dirs) {\n-            if (createDirEntry(dir, folders, fullPath, hasFoundFile)) {\n+            if (createDirEntry(dir, folders, fullPath, false)) {\n                 dirEntry.open = true;\n                 hasFoundFile = true;\n             }"}, {"sha": "e882080c7dabae47e8e9ab61539aceabeff3a31b", "filename": "src/test/rustdoc-gui/sidebar-source-code.goml", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml", "raw_url": "https://github.com/rust-lang/rust/raw/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml?ref=7bbb753d0846164b12d5fcbc1de376c268f78533", "patch": "@@ -16,15 +16,27 @@ click: (10, 10)\n wait-for: \"html:not(.expanded)\"\n assert: \"nav.sidebar\"\n \n+// Checking that only the path to the current file is \"open\".\n+goto: file://|DOC_PATH|/src/lib2/another_folder/sub_mod/mod.rs.html\n+// First we expand the sidebar again.\n+click: (10, 10)\n+// We wait for the sidebar to be expanded.\n+wait-for-css: (\".source-sidebar-expanded nav.sidebar\", {\"width\": \"300px\"})\n+assert: \"//*[@class='dir-entry' and @open]/*[text()='lib2']\"\n+assert: \"//*[@class='dir-entry' and @open]/*[text()='another_folder']\"\n+assert: \"//*[@class='dir-entry' and @open]/*[text()='sub_mod']\"\n+// Only \"another_folder\" should be \"open\" in \"lib2\".\n+assert: \"//*[@class='dir-entry' and not(@open)]/*[text()='another_mod']\"\n+// All other trees should be collapsed.\n+assert-count: (\"//*[@id='source-sidebar']/details[not(text()='lib2') and not(@open)]\", 5)\n+\n // We now switch to mobile mode.\n size: (600, 600)\n-// We check that the sidebar has the expected width (0).\n-assert-css: (\"nav.sidebar\", {\"width\": \"0px\"})\n-// We expand the sidebar.\n-click: \"#sidebar-toggle\"\n-assert-css: (\".source-sidebar-expanded nav.sidebar\", {\"width\": \"600px\"})\n+wait-for-css: (\".source-sidebar-expanded nav.sidebar\", {\"width\": \"600px\"})\n // We collapse the sidebar.\n click: (10, 10)\n+// We check that the sidebar has the expected width (0).\n+assert-css: (\"nav.sidebar\", {\"width\": \"0px\"})\n // We ensure that the class has been removed.\n assert-false: \".source-sidebar-expanded\"\n assert: \"nav.sidebar\""}, {"sha": "ec9a20859243d6bbfa863adeb5afe1e86922464b", "filename": "src/test/rustdoc-gui/src/lib2/another_folder/mod.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_folder%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_folder%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_folder%2Fmod.rs?ref=7bbb753d0846164b12d5fcbc1de376c268f78533", "patch": "@@ -0,0 +1,3 @@\n+pub fn another_fn() {}\n+\n+pub mod sub_mod;"}, {"sha": "f16722cf35b7b32adea1dd8cf15064d3da79acb8", "filename": "src/test/rustdoc-gui/src/lib2/another_folder/sub_mod/mod.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_folder%2Fsub_mod%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_folder%2Fsub_mod%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_folder%2Fsub_mod%2Fmod.rs?ref=7bbb753d0846164b12d5fcbc1de376c268f78533", "patch": "@@ -0,0 +1 @@\n+pub fn subsubsub() {}"}, {"sha": "9a4f007a2f0ca734405c408cab9a36fb91f4a4ef", "filename": "src/test/rustdoc-gui/src/lib2/another_mod/mod.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_mod%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_mod%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Fanother_mod%2Fmod.rs?ref=7bbb753d0846164b12d5fcbc1de376c268f78533", "patch": "@@ -0,0 +1 @@\n+pub fn tadam() {}"}, {"sha": "4546449e102916eb08242cc9040bfaf94f012b36", "filename": "src/test/rustdoc-gui/src/lib2/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7bbb753d0846164b12d5fcbc1de376c268f78533/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs?ref=7bbb753d0846164b12d5fcbc1de376c268f78533", "patch": "@@ -2,6 +2,9 @@\n \n #![feature(doc_cfg)]\n \n+pub mod another_folder;\n+pub mod another_mod;\n+\n pub mod module {\n     pub mod sub_module {\n         pub mod sub_sub_module {"}]}