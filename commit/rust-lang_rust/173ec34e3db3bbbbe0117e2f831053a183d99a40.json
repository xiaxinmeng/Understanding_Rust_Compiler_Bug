{"sha": "173ec34e3db3bbbbe0117e2f831053a183d99a40", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3M2VjMzRlM2RiM2JiYmJlMDExN2UyZjgzMTA1M2ExODNkOTlhNDA=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-01-18T13:48:50Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-01-21T18:33:29Z"}, "message": "Add a feature flag to switch between oldbe and newbe", "tree": {"sha": "cdce0c47cb05c2900a7537bbb4d1e75c5945ce93", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cdce0c47cb05c2900a7537bbb4d1e75c5945ce93"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/173ec34e3db3bbbbe0117e2f831053a183d99a40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/173ec34e3db3bbbbe0117e2f831053a183d99a40", "html_url": "https://github.com/rust-lang/rust/commit/173ec34e3db3bbbbe0117e2f831053a183d99a40", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/173ec34e3db3bbbbe0117e2f831053a183d99a40/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a19ef67f146df8da634cbab1e5ff5f3c2f3176d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/a19ef67f146df8da634cbab1e5ff5f3c2f3176d1", "html_url": "https://github.com/rust-lang/rust/commit/a19ef67f146df8da634cbab1e5ff5f3c2f3176d1"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "eb9d4e09ebc6630898851ed3c8ce450098b444b2", "filename": "Cargo.toml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/173ec34e3db3bbbbe0117e2f831053a183d99a40/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/173ec34e3db3bbbbe0117e2f831053a183d99a40/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=173ec34e3db3bbbbe0117e2f831053a183d99a40", "patch": "@@ -9,7 +9,7 @@ crate-type = [\"dylib\"]\n \n [dependencies]\n # These have to be in sync with each other\n-cranelift-codegen = { git = \"https://github.com/bytecodealliance/wasmtime/\", branch = \"main\", features = [\"unwind\"] }\n+cranelift-codegen = { git = \"https://github.com/bytecodealliance/wasmtime/\", branch = \"main\", features = [\"unwind\", \"x86\", \"x64\"] }\n cranelift-frontend = { git = \"https://github.com/bytecodealliance/wasmtime/\", branch = \"main\" }\n cranelift-module = { git = \"https://github.com/bytecodealliance/wasmtime/\", branch = \"main\" }\n cranelift-jit = { git = \"https://github.com/bytecodealliance/wasmtime/\", branch = \"main\", optional = true }\n@@ -37,6 +37,7 @@ libloading = { version = \"0.6.0\", optional = true }\n default = [\"jit\", \"inline_asm\"]\n jit = [\"cranelift-jit\", \"libloading\"]\n inline_asm = []\n+newbe = []\n \n [profile.dev]\n # By compiling dependencies with optimizations, performing tests gets much faster."}, {"sha": "a00c01a179cce9097cf27e4743406cf764ed5cec", "filename": "build.sh", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/173ec34e3db3bbbbe0117e2f831053a183d99a40/build.sh", "raw_url": "https://github.com/rust-lang/rust/raw/173ec34e3db3bbbbe0117e2f831053a183d99a40/build.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.sh?ref=173ec34e3db3bbbbe0117e2f831053a183d99a40", "patch": "@@ -5,6 +5,7 @@ set -e\n export CHANNEL=\"release\"\n build_sysroot=1\n target_dir='build'\n+newbe=''\n while [[ $# != 0 ]]; do\n     case $1 in\n         \"--debug\")\n@@ -17,9 +18,12 @@ while [[ $# != 0 ]]; do\n             target_dir=$2\n             shift\n             ;;\n+        \"--newbe\")\n+            newbe='--features newbe'\n+            ;;\n         *)\n             echo \"Unknown flag '$1'\"\n-            echo \"Usage: ./build.sh [--debug] [--without-sysroot] [--target-dir DIR]\"\n+            echo \"Usage: ./build.sh [--debug] [--without-sysroot] [--target-dir DIR] [--newbe]\"\n             ;;\n     esac\n     shift\n@@ -39,9 +43,9 @@ else\n    exit 1\n fi\n if [[ \"$CHANNEL\" == \"release\" ]]; then\n-    cargo build --release\n+    cargo build $newbe --release\n else\n-    cargo build\n+    cargo build $newbe\n fi\n \n rm -rf \"$target_dir\""}, {"sha": "2152d2ebdef53780165ffc022d4f1a2576223aaf", "filename": "src/lib.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/173ec34e3db3bbbbe0117e2f831053a183d99a40/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/173ec34e3db3bbbbe0117e2f831053a183d99a40/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=173ec34e3db3bbbbe0117e2f831053a183d99a40", "patch": "@@ -339,7 +339,12 @@ fn build_isa(sess: &Session) -> Box<dyn isa::TargetIsa + 'static> {\n \n     let flags = settings::Flags::new(flags_builder);\n \n-    let mut isa_builder = cranelift_codegen::isa::lookup(target_triple).unwrap();\n+    let variant = if cfg!(feature = \"newbe\") {\n+        cranelift_codegen::isa::BackendVariant::MachInst\n+    } else {\n+        cranelift_codegen::isa::BackendVariant::Legacy\n+    };\n+    let mut isa_builder = cranelift_codegen::isa::lookup_variant(target_triple, variant).unwrap();\n     // Don't use \"haswell\", as it implies `has_lzcnt`.macOS CI is still at Ivy Bridge EP, so `lzcnt`\n     // is interpreted as `bsr`.\n     isa_builder.enable(\"nehalem\").unwrap();"}]}