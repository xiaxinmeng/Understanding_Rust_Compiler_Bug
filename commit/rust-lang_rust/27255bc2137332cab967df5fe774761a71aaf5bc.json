{"sha": "27255bc2137332cab967df5fe774761a71aaf5bc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3MjU1YmMyMTM3MzMyY2FiOTY3ZGY1ZmU3NzQ3NjFhNzFhYWY1YmM=", "commit": {"author": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2016-08-19T15:37:21Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-19T15:37:21Z"}, "message": "Merge pull request #1174 from oli-obk/bugfix\n\ndon't lint `unused_attribute` if snippet is shorter than 1 character", "tree": {"sha": "54ec19b0a6f98a29ec0c86490213fdf0c1d4e885", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54ec19b0a6f98a29ec0c86490213fdf0c1d4e885"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/27255bc2137332cab967df5fe774761a71aaf5bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/27255bc2137332cab967df5fe774761a71aaf5bc", "html_url": "https://github.com/rust-lang/rust/commit/27255bc2137332cab967df5fe774761a71aaf5bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/27255bc2137332cab967df5fe774761a71aaf5bc/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "663d8497aa4ea9bb094606a0f7bec9736143fbae", "url": "https://api.github.com/repos/rust-lang/rust/commits/663d8497aa4ea9bb094606a0f7bec9736143fbae", "html_url": "https://github.com/rust-lang/rust/commit/663d8497aa4ea9bb094606a0f7bec9736143fbae"}, {"sha": "6dd003ac3913c19871d61c19d7a7ddbc30765ae6", "url": "https://api.github.com/repos/rust-lang/rust/commits/6dd003ac3913c19871d61c19d7a7ddbc30765ae6", "html_url": "https://github.com/rust-lang/rust/commit/6dd003ac3913c19871d61c19d7a7ddbc30765ae6"}], "stats": {"total": 32, "additions": 24, "deletions": 8}, "files": [{"sha": "086716c1f46466db593c2fdc6fffeab2d4f22e58", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 20, "deletions": 8, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/27255bc2137332cab967df5fe774761a71aaf5bc/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27255bc2137332cab967df5fe774761a71aaf5bc/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=27255bc2137332cab967df5fe774761a71aaf5bc", "patch": "@@ -106,17 +106,29 @@ impl LateLintPass for AttrPass {\n             ItemExternCrate(_) |\n             ItemUse(_) => {\n                 for attr in &item.attrs {\n-                    if let MetaItemKind::List(ref name, _) = attr.node.value.node {\n+                    if let MetaItemKind::List(ref name, ref lint_list) = attr.node.value.node {\n                         match &**name {\n                             \"allow\" | \"warn\" | \"deny\" | \"forbid\" => {\n-                                span_lint_and_then(cx, USELESS_ATTRIBUTE, attr.span,\n-                                                   \"useless lint attribute\",\n-                                                   |db| {\n-                                    if let Some(mut sugg) = snippet_opt(cx, attr.span) {\n-                                        sugg.insert(1, '!');\n-                                        db.span_suggestion(attr.span, \"if you just forgot a `!`, use\", sugg);\n+                                // whitelist `unused_imports`\n+                                for lint in lint_list {\n+                                    if let MetaItemKind::Word(ref word) = lint.node {\n+                                        if word == \"unused_imports\" {\n+                                            if let ItemUse(_) = item.node {\n+                                                return;\n+                                            }\n+                                        }\n                                     }\n-                                });\n+                                }\n+                                if let Some(mut sugg) = snippet_opt(cx, attr.span) {\n+                                    if sugg.len() > 1 {\n+                                        span_lint_and_then(cx, USELESS_ATTRIBUTE, attr.span,\n+                                                           \"useless lint attribute\",\n+                                                           |db| {\n+                                            sugg.insert(1, '!');\n+                                            db.span_suggestion(attr.span, \"if you just forgot a `!`, use\", sugg);\n+                                        });\n+                                    }\n+                                }\n                             },\n                             _ => {},\n                         }"}, {"sha": "1826f3a20e9b1366a1385c3db27d1d36faa02cee", "filename": "tests/compile-fail/useless_attribute.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/27255bc2137332cab967df5fe774761a71aaf5bc/tests%2Fcompile-fail%2Fuseless_attribute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27255bc2137332cab967df5fe774761a71aaf5bc/tests%2Fcompile-fail%2Fuseless_attribute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fuseless_attribute.rs?ref=27255bc2137332cab967df5fe774761a71aaf5bc", "patch": "@@ -7,4 +7,8 @@\n //~| SUGGESTION #![allow(dead_code)]\n extern crate clippy_lints;\n \n+// don't lint on unused_import for `use` items\n+#[allow(unused_imports)]\n+use std::collections;\n+\n fn main() {}"}]}