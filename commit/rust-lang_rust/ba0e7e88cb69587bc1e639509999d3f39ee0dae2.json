{"sha": "ba0e7e88cb69587bc1e639509999d3f39ee0dae2", "node_id": "C_kwDOAAsO6NoAKGJhMGU3ZTg4Y2I2OTU4N2JjMWU2Mzk1MDk5OTlkM2YzOWVlMGRhZTI", "commit": {"author": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-04-05T18:38:44Z"}, "committer": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-05-08T16:24:59Z"}, "message": "Now the lint ignores any crates with `--cfg test`", "tree": {"sha": "9557aa16b0742ade29199b0ccc7d846617a1014c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9557aa16b0742ade29199b0ccc7d846617a1014c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba0e7e88cb69587bc1e639509999d3f39ee0dae2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEM3aofraJSaf7CtgpTTgXC1ovwzQFAmRZIlsACgkQTTgXC1ov\nwzT3/BAAhECw9Tb3h3FiQYs3q0Rg+LwVwD6l6xzpDXYvZdE2gFIJdxJ6GlR3TQv/\nl1/rALJi9lAapa4jph7i0EQbjC7yROCqQ8obcOM/jr6a63LBzmlIVM5gdxgb0rDN\n/0YTE71KyD9JnLmgBviFWXtiSk4hTDh9PEG0FC7J3L3G6pq7r1l8zbsP02KwSeEv\nAOAMQguQVZnicNIFQzkfY6EJSddsBASnz2ft5bqTKmETfCu4v//wLsxJ0gbfG5df\nfwGJa3efmpjr0D2GWJ7yHkBfZrbNMjgztgYw+O7O7KCp73EsUwLXKtIPW575gstU\nd8YKkQO6uXk3tqw8aufov0ricFQmjmBxb324PZNjcpAUw2kzdwqCOE6KUvHYgQf8\nr/OMjicAyRZFHqT9G218VLwXlNimCE8KpOfqcMr88T35fgsl9p4tUMgsc1RYzkxh\nMdY7IaUNaDy1++Pvh4pGx9oin8RVHC8u+Rsv41K9t4Ozj23Xws7IG+U1RmcxjF9E\nvjuNuSX7KFjjUQ55cm9Nb6tHOihRk/LTatFYXTHcAbODj020HrXn1QAQH0ADcFEs\nzy1juXPygIi48wx7qhhLwW2CE6M2/DsDjkctTUBUII2dfsV2R8PRdUSDfEXurTN1\ntovrqaAylYqZH81RF2u3TGXTcVke3YS4nrDr7MjPOEX/pg7FNdI=\n=BWMK\n-----END PGP SIGNATURE-----", "payload": "tree 9557aa16b0742ade29199b0ccc7d846617a1014c\nparent 5acc2993e74506780e0a20331f58e78e125aad92\nauthor blyxyas <blyxyas@gmail.com> 1680719924 +0200\ncommitter blyxyas <blyxyas@gmail.com> 1683563099 +0200\n\nNow the lint ignores any crates with `--cfg test`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba0e7e88cb69587bc1e639509999d3f39ee0dae2", "html_url": "https://github.com/rust-lang/rust/commit/ba0e7e88cb69587bc1e639509999d3f39ee0dae2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba0e7e88cb69587bc1e639509999d3f39ee0dae2/comments", "author": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5acc2993e74506780e0a20331f58e78e125aad92", "url": "https://api.github.com/repos/rust-lang/rust/commits/5acc2993e74506780e0a20331f58e78e125aad92", "html_url": "https://github.com/rust-lang/rust/commit/5acc2993e74506780e0a20331f58e78e125aad92"}], "stats": {"total": 81, "additions": 7, "deletions": 74}, "files": [{"sha": "0cae6e00a95b9db713d082bea0c527e66d5bd107", "filename": "clippy_lints/src/wildcard_imports.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ba0e7e88cb69587bc1e639509999d3f39ee0dae2/clippy_lints%2Fsrc%2Fwildcard_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba0e7e88cb69587bc1e639509999d3f39ee0dae2/clippy_lints%2Fsrc%2Fwildcard_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fwildcard_imports.rs?ref=ba0e7e88cb69587bc1e639509999d3f39ee0dae2", "patch": "@@ -7,7 +7,6 @@ use rustc_hir::{\n     def::{DefKind, Res},\n     Item, ItemKind, PathSegment, UseKind,\n };\n-use rustc_hir::{HirId, Mod};\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_middle::ty;\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n@@ -119,15 +118,10 @@ impl WildcardImports {\n impl_lint_pass!(WildcardImports => [ENUM_GLOB_USE, WILDCARD_IMPORTS]);\n \n impl LateLintPass<'_> for WildcardImports {\n-    fn check_mod(&mut self, cx: &LateContext<'_>, module: &Mod<'_>, _: HirId) {\n-        let filename = cx\n-            .sess()\n-            .source_map()\n-            .span_to_filename(module.spans.inner_span)\n-            .display(rustc_span::FileNameDisplayPreference::Local)\n-            .to_string();\n-\n-        self.ignore = filename.ends_with(\"test.rs\") || filename.ends_with(\"tests.rs\");\n+    fn check_crate(&mut self, cx: &LateContext<'_>) {\n+        if cx.sess().opts.test {\n+            self.ignore = true;\n+        }\n     }\n \n     fn check_item(&mut self, cx: &LateContext<'_>, item: &Item<'_>) {"}, {"sha": "726808e598f4ed340af7101c289ab704b3cd274c", "filename": "tests/ui/wildcard_imports/another_file.fixed", "status": "removed", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Fanother_file.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Fanother_file.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Fanother_file.fixed?ref=5acc2993e74506780e0a20331f58e78e125aad92", "patch": "@@ -1,18 +0,0 @@\n-// run-rustfix\n-#![warn(clippy::wildcard_imports)]\n-#![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n-\n-// Test for #10580, the lint should **not** ignore it.\n-\n-fn foofoo() {}\n-\n-mod outer {\n-    mod inner {\n-        use super::super::foofoo;\n-        fn barbar() {\n-            let _ = foofoo();\n-        }\n-    }\n-}\n-\n-fn main() {}"}, {"sha": "56923eff58b25a41ac5bf1798698bc8ad2f2954e", "filename": "tests/ui/wildcard_imports/another_file.stderr", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Fanother_file.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Fanother_file.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Fanother_file.stderr?ref=5acc2993e74506780e0a20331f58e78e125aad92", "patch": "@@ -1,10 +0,0 @@\n-error: usage of wildcard import\n-  --> $DIR/another_file.rs:11:13\n-   |\n-LL |         use super::super::*;\n-   |             ^^^^^^^^^^^^^^^ help: try: `super::super::foofoo`\n-   |\n-   = note: `-D clippy::wildcard-imports` implied by `-D warnings`\n-\n-error: aborting due to previous error\n-"}, {"sha": "9029e5ba503a467c2de750f4ace65f9181512b9f", "filename": "tests/ui/wildcard_imports/test.rs", "status": "removed", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Ftest.rs?ref=5acc2993e74506780e0a20331f58e78e125aad92", "patch": "@@ -1,17 +0,0 @@\n-#![warn(clippy::wildcard_imports)]\n-#![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n-\n-// Test for #10580, the lint **should** not ignore it.\n-\n-fn foofoo() {}\n-\n-mod outer {\n-    mod inner {\n-        use super::super::*;\n-        fn barbar() {\n-            let _ = foofoo();\n-        }\n-    }\n-}\n-\n-fn main() {}"}, {"sha": "b7483853388ea2b1b30ed4343e2d6006476ab129", "filename": "tests/ui/wildcard_imports/tests.rs", "status": "removed", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5acc2993e74506780e0a20331f58e78e125aad92/tests%2Fui%2Fwildcard_imports%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports%2Ftests.rs?ref=5acc2993e74506780e0a20331f58e78e125aad92", "patch": "@@ -1,17 +0,0 @@\n-#![warn(clippy::wildcard_imports)]\n-#![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n-\n-// Test for #10580, the lint **should** ignore it.\n-\n-fn foofoo() {}\n-\n-mod outer {\n-    mod inner {\n-        use super::super::*;\n-        fn barbar() {\n-            let _ = foofoo();\n-        }\n-    }\n-}\n-\n-fn main() {}"}, {"sha": "a5e4e92b32c0a40d175d9f58c3f40e8545165e4c", "filename": "tests/ui/wildcard_imports_cfgtest.rs", "status": "renamed", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ba0e7e88cb69587bc1e639509999d3f39ee0dae2/tests%2Fui%2Fwildcard_imports_cfgtest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba0e7e88cb69587bc1e639509999d3f39ee0dae2/tests%2Fui%2Fwildcard_imports_cfgtest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwildcard_imports_cfgtest.rs?ref=ba0e7e88cb69587bc1e639509999d3f39ee0dae2", "patch": "@@ -1,8 +1,9 @@\n-// run-rustfix\n+// compile-flags: --test\n+\n #![warn(clippy::wildcard_imports)]\n #![allow(unused, clippy::unnecessary_wraps, clippy::let_unit_value)]\n \n-// Test for #10580, the lint should **not** ignore it.\n+// Test for #10580, the lint should ignore it because of the crate's cfg test flag.\n \n fn foofoo() {}\n ", "previous_filename": "tests/ui/wildcard_imports/another_file.rs"}]}