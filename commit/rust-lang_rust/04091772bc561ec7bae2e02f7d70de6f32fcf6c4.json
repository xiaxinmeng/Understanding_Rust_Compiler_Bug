{"sha": "04091772bc561ec7bae2e02f7d70de6f32fcf6c4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0MDkxNzcyYmM1NjFlYzdiYWUyZTAyZjdkNzBkZTZmMzJmY2Y2YzQ=", "commit": {"author": {"name": "Kitsu", "email": "mail@kitsu.me", "date": "2020-10-16T14:19:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-16T14:19:22Z"}, "message": "Use architecture pointer size for AddConstructor (#1094)\n\n* Use architecture pointer size for AddConstructor\r\n\r\n* Update src/backend.rs\r\n\r\nCo-authored-by: bjorn3 <bjorn3@users.noreply.github.com>", "tree": {"sha": "7cb172f7e7a1d6cb70af5add1713a3d38c2f5e8c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7cb172f7e7a1d6cb70af5add1713a3d38c2f5e8c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04091772bc561ec7bae2e02f7d70de6f32fcf6c4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfiavrCRBK7hj4Ov3rIwAAdHIIAFKHpojtgdiRVoZwKT1iF8sC\nWD5kf96AswPvL0eMItMNh58swcLH2URVWHjRxAdiuA/7ufMKsAmPoprQvGkrb+jj\nWxLMEppCTFRy6rptanMphnVu68juk/9n8lOcs07Jn3BSar+8YhR2rs4U93SRWtBA\nihxmhjYFz9P+FgKIHodfyn3RIVLAq0PmkDgyLgw6C8eG+t1RvfTY0yLQb62B6DY0\nTE9pl1FY5IbQB+n6Cmu/QDDavoGqj6atE7x3K3V8NW6j+vhLk4xPMDDl8H8T8VY1\nS+d1an80HA0BkG5RnOlmIw5ipSBxtKRspWl2tmAvKo2YBSEN1ODQJflqqneyfYY=\n=dUzE\n-----END PGP SIGNATURE-----\n", "payload": "tree 7cb172f7e7a1d6cb70af5add1713a3d38c2f5e8c\nparent 0416f122aae296e7fa78cff64b5df683be1dfc2f\nauthor Kitsu <mail@kitsu.me> 1602857962 +0300\ncommitter GitHub <noreply@github.com> 1602857962 +0200\n\nUse architecture pointer size for AddConstructor (#1094)\n\n* Use architecture pointer size for AddConstructor\r\n\r\n* Update src/backend.rs\r\n\r\nCo-authored-by: bjorn3 <bjorn3@users.noreply.github.com>"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04091772bc561ec7bae2e02f7d70de6f32fcf6c4", "html_url": "https://github.com/rust-lang/rust/commit/04091772bc561ec7bae2e02f7d70de6f32fcf6c4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04091772bc561ec7bae2e02f7d70de6f32fcf6c4/comments", "author": {"login": "l4l", "id": 5658339, "node_id": "MDQ6VXNlcjU2NTgzMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/5658339?v=4", "gravatar_id": "", "url": "https://api.github.com/users/l4l", "html_url": "https://github.com/l4l", "followers_url": "https://api.github.com/users/l4l/followers", "following_url": "https://api.github.com/users/l4l/following{/other_user}", "gists_url": "https://api.github.com/users/l4l/gists{/gist_id}", "starred_url": "https://api.github.com/users/l4l/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/l4l/subscriptions", "organizations_url": "https://api.github.com/users/l4l/orgs", "repos_url": "https://api.github.com/users/l4l/repos", "events_url": "https://api.github.com/users/l4l/events{/privacy}", "received_events_url": "https://api.github.com/users/l4l/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0416f122aae296e7fa78cff64b5df683be1dfc2f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0416f122aae296e7fa78cff64b5df683be1dfc2f", "html_url": "https://github.com/rust-lang/rust/commit/0416f122aae296e7fa78cff64b5df683be1dfc2f"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "8b900fd0dd0c8b58b245e21aa579cf9b32f49e14", "filename": "src/backend.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/04091772bc561ec7bae2e02f7d70de6f32fcf6c4/src%2Fbackend.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04091772bc561ec7bae2e02f7d70de6f32fcf6c4/src%2Fbackend.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbackend.rs?ref=04091772bc561ec7bae2e02f7d70de6f32fcf6c4", "patch": "@@ -132,10 +132,16 @@ impl AddConstructor for ObjectProduct {\n         let init_array_section =\n             self.object\n                 .add_section(segment.to_vec(), b\".init_array\".to_vec(), SectionKind::Data);\n+        let address_size = self\n+            .object\n+            .architecture()\n+            .address_size()\n+            .expect(\"address_size must be known\")\n+            .bytes();\n         self.object.append_section_data(\n             init_array_section,\n             &std::iter::repeat(0)\n-                .take(8 /*FIXME pointer size*/)\n+                .take(address_size.into())\n                 .collect::<Vec<u8>>(),\n             8,\n         );\n@@ -144,7 +150,7 @@ impl AddConstructor for ObjectProduct {\n                 init_array_section,\n                 object::write::Relocation {\n                     offset: 0,\n-                    size: 64, // FIXME pointer size\n+                    size: address_size * 8,\n                     kind: RelocationKind::Absolute,\n                     encoding: RelocationEncoding::Generic,\n                     symbol,"}]}