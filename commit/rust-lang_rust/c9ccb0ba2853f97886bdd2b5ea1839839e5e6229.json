{"sha": "c9ccb0ba2853f97886bdd2b5ea1839839e5e6229", "node_id": "C_kwDOAAsO6NoAKGM5Y2NiMGJhMjg1M2Y5Nzg4NmJkZDJiNWVhMTgzOTgzOWU1ZTYyMjk", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-17T21:33:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-17T21:33:18Z"}, "message": "Rollup merge of #104433 - TaKO8Ki:fix-104392, r=estebank\n\nFix `emit_unused_delims_expr` ICE\n\nFixes #104392", "tree": {"sha": "d4dbdd01989b27bef18fefd426ba110abce04190", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4dbdd01989b27bef18fefd426ba110abce04190"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjdqieCRBK7hj4Ov3rIwAAELAIADUwfuBBf+3GTBPd68aIDQRv\ni2bjvvFtW77fDilRixo1+wBbdbirHer64lbKVcmJRFdNY7Ly1CCXKG8tOCy0FUqt\nl6TV0lH2jzKrwlxawBnP1SZrWYs2jTjVHoX+tjHPFsHpQYDhv/905RzkA+e4zgF/\nv7ONCi9i8m4M29xgxSgjGinSNkK7l++w3hmKeVjbidnV5gdZa+huUNX54CNRhMPQ\nP3phr0CKc1tcA8dF7kbhs3CjFWCtSVHChtKW8vK5c8FMka7gdCCaUvP8cAfAiN7W\nmhMHTrRPCQAlRFTe/4AYckJLcgoU7LXyXDZ5ZJqgaNNmqDVqJnQhW7vP31seFn8=\n=zH9T\n-----END PGP SIGNATURE-----\n", "payload": "tree d4dbdd01989b27bef18fefd426ba110abce04190\nparent 43dca249a218305591e6eb896dd63c419871b018\nparent 1cf4132a1610de4319a382aa447f9fe3da52a19c\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1668720798 +0100\ncommitter GitHub <noreply@github.com> 1668720798 +0100\n\nRollup merge of #104433 - TaKO8Ki:fix-104392, r=estebank\n\nFix `emit_unused_delims_expr` ICE\n\nFixes #104392\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229", "html_url": "https://github.com/rust-lang/rust/commit/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43dca249a218305591e6eb896dd63c419871b018", "url": "https://api.github.com/repos/rust-lang/rust/commits/43dca249a218305591e6eb896dd63c419871b018", "html_url": "https://github.com/rust-lang/rust/commit/43dca249a218305591e6eb896dd63c419871b018"}, {"sha": "1cf4132a1610de4319a382aa447f9fe3da52a19c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1cf4132a1610de4319a382aa447f9fe3da52a19c", "html_url": "https://github.com/rust-lang/rust/commit/1cf4132a1610de4319a382aa447f9fe3da52a19c"}], "stats": {"total": 54, "additions": 45, "deletions": 9}, "files": [{"sha": "9ae34013ecb8ae17ef44687e653d75ee220f0c4a", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=c9ccb0ba2853f97886bdd2b5ea1839839e5e6229", "patch": "@@ -533,16 +533,14 @@ trait UnusedDelimLint {\n         right_pos: Option<BytePos>,\n     ) {\n         let spans = match value.kind {\n-            ast::ExprKind::Block(ref block, None) if block.stmts.len() > 0 => {\n-                let start = block.stmts[0].span;\n-                let end = block.stmts[block.stmts.len() - 1].span;\n-                if let Some(start) = start.find_ancestor_inside(value.span)\n-                    && let Some(end) = end.find_ancestor_inside(value.span)\n+            ast::ExprKind::Block(ref block, None) if block.stmts.len() == 1 => {\n+                if let StmtKind::Expr(expr) = &block.stmts[0].kind\n+                    && let ExprKind::Err = expr.kind\n                 {\n-                    Some((\n-                        value.span.with_hi(start.lo()),\n-                        value.span.with_lo(end.hi()),\n-                    ))\n+                    return\n+                }\n+                if let Some(span) = block.stmts[0].span.find_ancestor_inside(value.span) {\n+                    Some((value.span.with_hi(span.lo()), value.span.with_lo(span.hi())))\n                 } else {\n                     None\n                 }"}, {"sha": "d5608edb46f0493fb58c8036a43676308086553a", "filename": "src/test/ui/lint/issue-104392.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229/src%2Ftest%2Fui%2Flint%2Fissue-104392.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229/src%2Ftest%2Fui%2Flint%2Fissue-104392.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-104392.rs?ref=c9ccb0ba2853f97886bdd2b5ea1839839e5e6229", "patch": "@@ -0,0 +1,11 @@\n+fn main() {\n+    { unsafe 92 } //~ ERROR expected `{`, found `92`\n+}\n+\n+fn foo() {\n+    { mod 92 } //~ ERROR expected identifier, found `92`\n+}\n+\n+fn bar() {\n+    { trait 92 } //~ ERROR expected identifier, found `92`\n+}"}, {"sha": "8e466439ae6432b45a7bb65de14c96558c8766b7", "filename": "src/test/ui/lint/issue-104392.stderr", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229/src%2Ftest%2Fui%2Flint%2Fissue-104392.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c9ccb0ba2853f97886bdd2b5ea1839839e5e6229/src%2Ftest%2Fui%2Flint%2Fissue-104392.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-104392.stderr?ref=c9ccb0ba2853f97886bdd2b5ea1839839e5e6229", "patch": "@@ -0,0 +1,27 @@\n+error: expected `{`, found `92`\n+  --> $DIR/issue-104392.rs:2:14\n+   |\n+LL |     { unsafe 92 }\n+   |       ------ ^^ expected `{`\n+   |       |\n+   |       while parsing this `unsafe` expression\n+   |\n+help: try placing this code inside a block\n+   |\n+LL |     { unsafe { 92 } }\n+   |              +    +\n+\n+error: expected identifier, found `92`\n+  --> $DIR/issue-104392.rs:6:11\n+   |\n+LL |     { mod 92 }\n+   |           ^^ expected identifier\n+\n+error: expected identifier, found `92`\n+  --> $DIR/issue-104392.rs:10:13\n+   |\n+LL |     { trait 92 }\n+   |             ^^ expected identifier\n+\n+error: aborting due to 3 previous errors\n+"}]}