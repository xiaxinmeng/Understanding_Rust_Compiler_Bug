{"sha": "cc2906cb26304301709557a88ac4a3334b88616b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjMjkwNmNiMjYzMDQzMDE3MDk1NTdhODhhYzRhMzMzNGI4ODYxNmI=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2018-04-13T23:52:54Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2018-04-13T23:52:54Z"}, "message": "rustbuild: allow building tools with debuginfo\n\nDebugging information for the extended tools is currently disabled for\nconcerns about the size.  This patch adds `--enable-debuginfo-tools` to\nlet one opt into having that debuginfo.\n\nThis is useful for debugging the tools in distro packages.  We always\nstrip debuginfo into separate packages anyway, so the extra size is not\na concern in regular use.", "tree": {"sha": "dbf063997d29feaec4b3d635b3f2ca686ea881cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dbf063997d29feaec4b3d635b3f2ca686ea881cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc2906cb26304301709557a88ac4a3334b88616b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc2906cb26304301709557a88ac4a3334b88616b", "html_url": "https://github.com/rust-lang/rust/commit/cc2906cb26304301709557a88ac4a3334b88616b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc2906cb26304301709557a88ac4a3334b88616b/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7291829268ced93054aa74072b074799e0e563e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/7291829268ced93054aa74072b074799e0e563e3", "html_url": "https://github.com/rust-lang/rust/commit/7291829268ced93054aa74072b074799e0e563e3"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "73d4188d695498e68e10388ce24b0e57bab27b11", "filename": "CONTRIBUTING.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cc2906cb26304301709557a88ac4a3334b88616b/CONTRIBUTING.md", "raw_url": "https://github.com/rust-lang/rust/raw/cc2906cb26304301709557a88ac4a3334b88616b/CONTRIBUTING.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CONTRIBUTING.md?ref=cc2906cb26304301709557a88ac4a3334b88616b", "patch": "@@ -121,6 +121,7 @@ configuration used in the build process. Some options to note:\n #### `[rust]`:\n - `debuginfo = true` - Build a compiler with debuginfo. Makes building rustc slower, but then you can use a debugger to debug `rustc`.\n - `debuginfo-lines = true` - An alternative to `debuginfo = true` that doesn't let you use a debugger, but doesn't make building rustc slower and still gives you line numbers in backtraces.\n+- `debuginfo-tools = true` - Build the extended tools with debuginfo.\n - `debug-assertions = true` - Makes the log output of `debug!` work.\n - `optimize = false` - Disable optimizations to speed up compilation of stage1 rust, but makes the stage1 compiler x100 slower.\n "}, {"sha": "bd18a604a9c865636e0bd843b5cd1218a758c382", "filename": "config.toml.example", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cc2906cb26304301709557a88ac4a3334b88616b/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/cc2906cb26304301709557a88ac4a3334b88616b/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=cc2906cb26304301709557a88ac4a3334b88616b", "patch": "@@ -262,6 +262,10 @@\n # standard library.\n #debuginfo-only-std = false\n \n+# Enable debuginfo for the extended tools: cargo, rls, rustfmt\n+# Adding debuginfo increases their sizes by a factor of 3-4.\n+#debuginfo-tools = false\n+\n # Whether or not jemalloc is built and enabled\n #use-jemalloc = true\n "}, {"sha": "ae19c66d60708fd5020f7651880a916ab6959b85", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/cc2906cb26304301709557a88ac4a3334b88616b/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc2906cb26304301709557a88ac4a3334b88616b/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=cc2906cb26304301709557a88ac4a3334b88616b", "patch": "@@ -622,10 +622,14 @@ impl<'a> Builder<'a> {\n             cargo.env(\"RUSTDOC_LIBDIR\", self.rustc_libdir(self.compiler(2, self.build.build)));\n         }\n \n-        if mode != Mode::Tool {\n-            // Tools don't get debuginfo right now, e.g. cargo and rls don't\n-            // get compiled with debuginfo.\n-            // Adding debuginfo increases their sizes by a factor of 3-4.\n+        if mode == Mode::Tool {\n+            // Tools like cargo and rls don't get debuginfo by default right now, but this can be\n+            // enabled in the config.  Adding debuginfo increases their sizes by a factor of 3-4.\n+            if self.config.rust_debuginfo_tools {\n+                cargo.env(\"RUSTC_DEBUGINFO\", self.config.rust_debuginfo.to_string());\n+                cargo.env(\"RUSTC_DEBUGINFO_LINES\", self.config.rust_debuginfo_lines.to_string());\n+            }\n+        } else {\n             cargo.env(\"RUSTC_DEBUGINFO\", self.config.rust_debuginfo.to_string());\n             cargo.env(\"RUSTC_DEBUGINFO_LINES\", self.config.rust_debuginfo_lines.to_string());\n             cargo.env(\"RUSTC_FORCE_UNSTABLE\", \"1\");"}, {"sha": "95d138b9fab2ac7febfc04ec0b798019d4f5fecc", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cc2906cb26304301709557a88ac4a3334b88616b/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc2906cb26304301709557a88ac4a3334b88616b/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=cc2906cb26304301709557a88ac4a3334b88616b", "patch": "@@ -94,6 +94,7 @@ pub struct Config {\n     pub rust_debuginfo: bool,\n     pub rust_debuginfo_lines: bool,\n     pub rust_debuginfo_only_std: bool,\n+    pub rust_debuginfo_tools: bool,\n     pub rust_rpath: bool,\n     pub rustc_parallel_queries: bool,\n     pub rustc_default_linker: Option<String>,\n@@ -282,6 +283,7 @@ struct Rust {\n     debuginfo: Option<bool>,\n     debuginfo_lines: Option<bool>,\n     debuginfo_only_std: Option<bool>,\n+    debuginfo_tools: Option<bool>,\n     experimental_parallel_queries: Option<bool>,\n     debug_jemalloc: Option<bool>,\n     use_jemalloc: Option<bool>,\n@@ -462,6 +464,7 @@ impl Config {\n         let mut llvm_assertions = None;\n         let mut debuginfo_lines = None;\n         let mut debuginfo_only_std = None;\n+        let mut debuginfo_tools = None;\n         let mut debug = None;\n         let mut debug_jemalloc = None;\n         let mut debuginfo = None;\n@@ -499,6 +502,7 @@ impl Config {\n             debuginfo = rust.debuginfo;\n             debuginfo_lines = rust.debuginfo_lines;\n             debuginfo_only_std = rust.debuginfo_only_std;\n+            debuginfo_tools = rust.debuginfo_tools;\n             optimize = rust.optimize;\n             ignore_git = rust.ignore_git;\n             debug_jemalloc = rust.debug_jemalloc;\n@@ -582,6 +586,7 @@ impl Config {\n         };\n         config.rust_debuginfo_lines = debuginfo_lines.unwrap_or(default);\n         config.rust_debuginfo_only_std = debuginfo_only_std.unwrap_or(default);\n+        config.rust_debuginfo_tools = debuginfo_tools.unwrap_or(default);\n \n         let default = debug == Some(true);\n         config.debug_jemalloc = debug_jemalloc.unwrap_or(default);"}, {"sha": "a0123da6d8ff9ba077663f4f10334a03c271baef", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cc2906cb26304301709557a88ac4a3334b88616b/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/cc2906cb26304301709557a88ac4a3334b88616b/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=cc2906cb26304301709557a88ac4a3334b88616b", "patch": "@@ -79,6 +79,7 @@ def v(*args):\n o(\"debuginfo\", \"rust.debuginfo\", \"build with debugger metadata\")\n o(\"debuginfo-lines\", \"rust.debuginfo-lines\", \"build with line number debugger metadata\")\n o(\"debuginfo-only-std\", \"rust.debuginfo-only-std\", \"build only libstd with debugging information\")\n+o(\"debuginfo-tools\", \"rust.debuginfo-tools\", \"build extended tools with debugging information\")\n o(\"debug-jemalloc\", \"rust.debug-jemalloc\", \"build jemalloc with --enable-debug --enable-fill\")\n v(\"save-toolstates\", \"rust.save-toolstates\", \"save build and test status of external tools into this file\")\n "}]}