{"sha": "1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjNzhhZjdkZTI0ZDlmZjFmMTE1MzFjNWI1YWEyZjJhZTQ0YzRkOGM=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-11-04T12:14:36Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-11-04T12:28:50Z"}, "message": "clean highlightSourceLines code", "tree": {"sha": "46af4ba53c4283e3ab06bc2ce62bde72543b7dd9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46af4ba53c4283e3ab06bc2ce62bde72543b7dd9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c", "html_url": "https://github.com/rust-lang/rust/commit/1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cba93685377bc74a2fde1eb8e7a086039b038e94", "url": "https://api.github.com/repos/rust-lang/rust/commits/cba93685377bc74a2fde1eb8e7a086039b038e94", "html_url": "https://github.com/rust-lang/rust/commit/cba93685377bc74a2fde1eb8e7a086039b038e94"}], "stats": {"total": 96, "additions": 54, "deletions": 42}, "files": [{"sha": "53e16978ff12b0fde3fcc2b331fca01fb1ae42fd", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 54, "deletions": 42, "changes": 96, "blob_url": "https://github.com/rust-lang/rust/blob/1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=1c78af7de24d9ff1f11531c5b5aa2f2ae44c4d8c", "patch": "@@ -163,59 +163,71 @@ function getSearchElement() {\n \n     var main = document.getElementById(\"main\");\n \n-    function highlightSourceLines(ev) {\n-        // If we're in mobile mode, we should add the sidebar in any case.\n+    function onHashChange(ev) {\n+        // If we're in mobile mode, we should hide the sidebar in any case.\n         hideSidebar();\n-        var elem;\n-        var search = getSearchElement();\n-        var i, from, to, match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n+        var match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n         if (match) {\n-            from = parseInt(match[1], 10);\n-            to = from;\n-            if (typeof match[2] !== \"undefined\") {\n-                to = parseInt(match[2], 10);\n-            }\n-            if (to < from) {\n-                var tmp = to;\n-                to = from;\n-                from = tmp;\n-            }\n-            elem = document.getElementById(from);\n-            if (!elem) {\n-                return;\n-            }\n-            if (ev === null) {\n-                var x = document.getElementById(from);\n-                if (x) {\n-                    x.scrollIntoView();\n-                }\n-            }\n-            onEachLazy(document.getElementsByClassName(\"line-numbers\"), function(e) {\n-                onEachLazy(e.getElementsByTagName(\"span\"), function(i_e) {\n-                    removeClass(i_e, \"line-highlighted\");\n-                });\n-            });\n-            for (i = from; i <= to; ++i) {\n-                elem = document.getElementById(i);\n-                if (!elem) {\n-                    break;\n-                }\n-                addClass(elem, \"line-highlighted\");\n-            }\n-        } else if (ev !== null && search && !hasClass(search, \"hidden\") && ev.newURL) {\n+            return highlightSourceLines(match, ev);\n+        }\n+        var search = getSearchElement();\n+        if (ev !== null && search && !hasClass(search, \"hidden\") && ev.newURL) {\n             addClass(search, \"hidden\");\n             removeClass(main, \"hidden\");\n             var hash = ev.newURL.slice(ev.newURL.indexOf(\"#\") + 1);\n             if (browserSupportsHistoryApi()) {\n                 history.replaceState(hash, \"\", \"?search=#\" + hash);\n             }\n-            elem = document.getElementById(hash);\n+            var elem = document.getElementById(hash);\n             if (elem) {\n                 elem.scrollIntoView();\n             }\n         }\n     }\n \n+    function highlightSourceLines(match, ev) {\n+        if (typeof match === \"undefined\") {\n+            // If we're in mobile mode, we should hide the sidebar in any case.\n+            hideSidebar();\n+            match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n+        }\n+        if (!match) {\n+            return;\n+        }\n+        var from = parseInt(match[1], 10);\n+        var to = from;\n+        if (typeof match[2] !== \"undefined\") {\n+            to = parseInt(match[2], 10);\n+        }\n+        if (to < from) {\n+            var tmp = to;\n+            to = from;\n+            from = tmp;\n+        }\n+        var elem = document.getElementById(from);\n+        if (!elem) {\n+            return;\n+        }\n+        if (!ev) {\n+            var x = document.getElementById(from);\n+            if (x) {\n+                x.scrollIntoView();\n+            }\n+        }\n+        onEachLazy(document.getElementsByClassName(\"line-numbers\"), function(e) {\n+            onEachLazy(e.getElementsByTagName(\"span\"), function(i_e) {\n+                removeClass(i_e, \"line-highlighted\");\n+            });\n+        });\n+        for (var i = from; i <= to; ++i) {\n+            elem = document.getElementById(i);\n+            if (!elem) {\n+                break;\n+            }\n+            addClass(elem, \"line-highlighted\");\n+        }\n+    }\n+\n     function expandSection(id) {\n         var elem = document.getElementById(id);\n         if (elem && isHidden(elem)) {\n@@ -234,8 +246,8 @@ function getSearchElement() {\n         }\n     }\n \n-    highlightSourceLines(null);\n-    window.onhashchange = highlightSourceLines;\n+    highlightSourceLines();\n+    window.onhashchange = onHashChange;\n \n     // Gets the human-readable string for the virtual-key code of the\n     // given KeyboardEvent, ev.\n@@ -358,7 +370,7 @@ function getSearchElement() {\n             var set_fragment = function(name) {\n                 if (browserSupportsHistoryApi()) {\n                     history.replaceState(null, null, \"#\" + name);\n-                    highlightSourceLines(null);\n+                    highlightSourceLines();\n                 } else {\n                     location.replace(\"#\" + name);\n                 }"}]}