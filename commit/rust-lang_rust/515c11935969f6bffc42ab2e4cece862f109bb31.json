{"sha": "515c11935969f6bffc42ab2e4cece862f109bb31", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxNWMxMTkzNTk2OWY2YmZmYzQyYWIyZTRjZWNlODYyZjEwOWJiMzE=", "commit": {"author": {"name": "Christian Poveda", "email": "git@christianpoveda.xyz", "date": "2019-12-25T16:39:57Z"}, "committer": {"name": "Christian Poveda", "email": "git@christianpoveda.xyz", "date": "2019-12-25T18:10:50Z"}, "message": "Add padding on 64-bits only", "tree": {"sha": "db70b18a8ff8cd780f3ae842a34028c2399811da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db70b18a8ff8cd780f3ae842a34028c2399811da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/515c11935969f6bffc42ab2e4cece862f109bb31", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niI4EABYIADYWIQRsB8A/3NrzTlMMjT0nUl7150IKUAUCXgOmKxgcZ2l0QGNocmlz\ndGlhbnBvdmVkYS54eXoACgkQJ1Je9edCClAOXgD9FEqbbOq09X/8W4GA2Ssa6AGv\nXMBSnTddX30YDA2ALBIA/1RZO0x623Ajh+yIHLoih/B+tD15o1aLPV8lmXHIDGUI\n=Upa9\n-----END PGP SIGNATURE-----", "payload": "tree db70b18a8ff8cd780f3ae842a34028c2399811da\nparent 6d88a4704a030b2c963abf38be481c1805b407d0\nauthor Christian Poveda <git@christianpoveda.xyz> 1577291997 -0500\ncommitter Christian Poveda <git@christianpoveda.xyz> 1577297450 -0500\n\nAdd padding on 64-bits only\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/515c11935969f6bffc42ab2e4cece862f109bb31", "html_url": "https://github.com/rust-lang/rust/commit/515c11935969f6bffc42ab2e4cece862f109bb31", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/515c11935969f6bffc42ab2e4cece862f109bb31/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d88a4704a030b2c963abf38be481c1805b407d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d88a4704a030b2c963abf38be481c1805b407d0", "html_url": "https://github.com/rust-lang/rust/commit/6d88a4704a030b2c963abf38be481c1805b407d0"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "adc60a52e6d173731b8993cd78744822d6e3a056", "filename": "src/shims/fs.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/515c11935969f6bffc42ab2e4cece862f109bb31/src%2Fshims%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/515c11935969f6bffc42ab2e4cece862f109bb31/src%2Fshims%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Ffs.rs?ref=515c11935969f6bffc42ab2e4cece862f109bb31", "patch": "@@ -295,6 +295,7 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n             \"S_IFLNK\"\n         };\n \n+        // FIXME: use Scalar::to_u16\n         let mode = this.eval_libc(mode_name)?.to_bits(Size::from_bits(16))? as u16;\n \n         let size = metadata.len();\n@@ -316,15 +317,22 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n         let blksize_t_layout = this.libc_ty_layout(\"blksize_t\")?;\n         let uint32_t_layout = this.libc_ty_layout(\"uint32_t\")?;\n \n+        // We need to add 32 bits of padding after `st_rdev` if we are in a 64-bit platform. To do\n+        // this, we store `st_rdev` as a `c_long` instead of a `dev_t`.\n+        let st_rdev_layout = if this.tcx.sess.target.ptr_width == 64 {\n+            long_layout\n+        } else {\n+            dev_t_layout\n+        };\n+\n         let imms = [\n             immty_from_uint_checked(0u128, dev_t_layout)?, // st_dev\n             immty_from_uint_checked(mode, mode_t_layout)?, // st_mode\n             immty_from_uint_checked(0u128, nlink_t_layout)?, // st_nlink\n             immty_from_uint_checked(0u128, ino_t_layout)?, // st_ino\n             immty_from_uint_checked(0u128, uid_t_layout)?, // st_uid\n             immty_from_uint_checked(0u128, gid_t_layout)?, // st_gid\n-            immty_from_uint_checked(0u128, dev_t_layout)?, // st_rdev\n-            immty_from_uint_checked(0u128, dev_t_layout)?, // padding\n+            immty_from_uint_checked(0u128, st_rdev_layout)?, // st_rdev\n             immty_from_uint_checked(access_sec, time_t_layout)?, // st_atime\n             immty_from_uint_checked(access_nsec, long_layout)?, // st_atime_nsec\n             immty_from_uint_checked(modified_sec, time_t_layout)?, // st_mtime"}]}