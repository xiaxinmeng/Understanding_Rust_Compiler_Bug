{"sha": "2f862cd6fe6c10343f6dec4c414419db88fac32e", "node_id": "C_kwDOAAsO6NoAKDJmODYyY2Q2ZmU2YzEwMzQzZjZkZWM0YzQxNDQxOWRiODhmYWMzMmU", "commit": {"author": {"name": "vsrs", "email": "vit@conrlab.com", "date": "2021-10-29T15:22:48Z"}, "committer": {"name": "vsrs", "email": "vit@conrlab.com", "date": "2021-10-29T15:23:47Z"}, "message": "Fix Plaintext textDocument/hover", "tree": {"sha": "97103b12225cf3daba0f7d8524a8a6b3bc2d4be2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/97103b12225cf3daba0f7d8524a8a6b3bc2d4be2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f862cd6fe6c10343f6dec4c414419db88fac32e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f862cd6fe6c10343f6dec4c414419db88fac32e", "html_url": "https://github.com/rust-lang/rust/commit/2f862cd6fe6c10343f6dec4c414419db88fac32e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f862cd6fe6c10343f6dec4c414419db88fac32e/comments", "author": {"login": "vsrs", "id": 62505555, "node_id": "MDQ6VXNlcjYyNTA1NTU1", "avatar_url": "https://avatars.githubusercontent.com/u/62505555?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vsrs", "html_url": "https://github.com/vsrs", "followers_url": "https://api.github.com/users/vsrs/followers", "following_url": "https://api.github.com/users/vsrs/following{/other_user}", "gists_url": "https://api.github.com/users/vsrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/vsrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vsrs/subscriptions", "organizations_url": "https://api.github.com/users/vsrs/orgs", "repos_url": "https://api.github.com/users/vsrs/repos", "events_url": "https://api.github.com/users/vsrs/events{/privacy}", "received_events_url": "https://api.github.com/users/vsrs/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vsrs", "id": 62505555, "node_id": "MDQ6VXNlcjYyNTA1NTU1", "avatar_url": "https://avatars.githubusercontent.com/u/62505555?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vsrs", "html_url": "https://github.com/vsrs", "followers_url": "https://api.github.com/users/vsrs/followers", "following_url": "https://api.github.com/users/vsrs/following{/other_user}", "gists_url": "https://api.github.com/users/vsrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/vsrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vsrs/subscriptions", "organizations_url": "https://api.github.com/users/vsrs/orgs", "repos_url": "https://api.github.com/users/vsrs/repos", "events_url": "https://api.github.com/users/vsrs/events{/privacy}", "received_events_url": "https://api.github.com/users/vsrs/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "057558b756c201076056bd44bba95eaef17224c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/057558b756c201076056bd44bba95eaef17224c2", "html_url": "https://github.com/rust-lang/rust/commit/057558b756c201076056bd44bba95eaef17224c2"}], "stats": {"total": 19, "additions": 16, "deletions": 3}, "files": [{"sha": "f108b694c0185398d21bbf97b237240b6f636b64", "filename": "crates/rust-analyzer/src/cli/lsif.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2f862cd6fe6c10343f6dec4c414419db88fac32e/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f862cd6fe6c10343f6dec4c414419db88fac32e/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs?ref=2f862cd6fe6c10343f6dec4c414419db88fac32e", "patch": "@@ -136,6 +136,7 @@ impl LsifManager<'_> {\n                 result: lsp_types::Hover {\n                     contents: lsp_types::HoverContents::Markup(to_proto::markup_content(\n                         hover.markup,\n+                        ide::HoverDocFormat::Markdown,\n                     )),\n                     range: None,\n                 },"}, {"sha": "0ddddeca6759acb0adfddc595b4caefff22774bb", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2f862cd6fe6c10343f6dec4c414419db88fac32e/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f862cd6fe6c10343f6dec4c414419db88fac32e/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=2f862cd6fe6c10343f6dec4c414419db88fac32e", "patch": "@@ -920,9 +920,14 @@ pub(crate) fn handle_hover(\n \n     let line_index = snap.file_line_index(file_range.file_id)?;\n     let range = to_proto::range(&line_index, info.range);\n+    let markup_kind =\n+        snap.config.hover().documentation.map_or(ide::HoverDocFormat::Markdown, |kind| kind);\n     let hover = lsp_ext::Hover {\n         hover: lsp_types::Hover {\n-            contents: HoverContents::Markup(to_proto::markup_content(info.info.markup)),\n+            contents: HoverContents::Markup(to_proto::markup_content(\n+                info.info.markup,\n+                markup_kind,\n+            )),\n             range: Some(range),\n         },\n         actions: if snap.config.hover_actions().none() {"}, {"sha": "8e77df9598286581687ce63bb1f01b32f877f51b", "filename": "crates/rust-analyzer/src/to_proto.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2f862cd6fe6c10343f6dec4c414419db88fac32e/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f862cd6fe6c10343f6dec4c414419db88fac32e/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs?ref=2f862cd6fe6c10343f6dec4c414419db88fac32e", "patch": "@@ -1202,9 +1202,16 @@ pub(crate) fn reference_title(count: usize) -> String {\n     }\n }\n \n-pub(crate) fn markup_content(markup: Markup) -> lsp_types::MarkupContent {\n+pub(crate) fn markup_content(\n+    markup: Markup,\n+    kind: ide::HoverDocFormat,\n+) -> lsp_types::MarkupContent {\n+    let kind = match kind {\n+        ide::HoverDocFormat::Markdown => lsp_types::MarkupKind::Markdown,\n+        ide::HoverDocFormat::PlainText => lsp_types::MarkupKind::PlainText,\n+    };\n     let value = crate::markdown::format_docs(markup.as_str());\n-    lsp_types::MarkupContent { kind: lsp_types::MarkupKind::Markdown, value }\n+    lsp_types::MarkupContent { kind, value }\n }\n \n pub(crate) fn rename_error(err: RenameError) -> crate::LspError {"}]}