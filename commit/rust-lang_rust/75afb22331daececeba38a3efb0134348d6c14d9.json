{"sha": "75afb22331daececeba38a3efb0134348d6c14d9", "node_id": "C_kwDOAAsO6NoAKDc1YWZiMjIzMzFkYWVjZWNlYmEzOGEzZWZiMDEzNDM0OGQ2YzE0ZDk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-16T22:21:41Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-16T22:21:41Z"}, "message": "Check `dyn*` return type correctly", "tree": {"sha": "864463a325a814451214aaf4d33568b040df69f8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/864463a325a814451214aaf4d33568b040df69f8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75afb22331daececeba38a3efb0134348d6c14d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75afb22331daececeba38a3efb0134348d6c14d9", "html_url": "https://github.com/rust-lang/rust/commit/75afb22331daececeba38a3efb0134348d6c14d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75afb22331daececeba38a3efb0134348d6c14d9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63c748ee23ab7b6706655146f5b7c7f579811803", "url": "https://api.github.com/repos/rust-lang/rust/commits/63c748ee23ab7b6706655146f5b7c7f579811803", "html_url": "https://github.com/rust-lang/rust/commit/63c748ee23ab7b6706655146f5b7c7f579811803"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "296cf00a687c7549caa243708f6bf4c313442ae7", "filename": "compiler/rustc_hir_typeck/src/check.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/75afb22331daececeba38a3efb0134348d6c14d9/compiler%2Frustc_hir_typeck%2Fsrc%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75afb22331daececeba38a3efb0134348d6c14d9/compiler%2Frustc_hir_typeck%2Fsrc%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fcheck.rs?ref=75afb22331daececeba38a3efb0134348d6c14d9", "patch": "@@ -100,7 +100,7 @@ pub(super) fn check_fn<'a, 'tcx>(\n \n     inherited.typeck_results.borrow_mut().liberated_fn_sigs_mut().insert(fn_id, fn_sig);\n \n-    if let ty::Dynamic(..) = declared_ret_ty.kind() {\n+    if let ty::Dynamic(_, _, ty::Dyn) = declared_ret_ty.kind() {\n         // FIXME: We need to verify that the return type is `Sized` after the return expression has\n         // been evaluated so that we have types available for all the nodes being returned, but that\n         // requires the coerced evaluated type to be stored. Moving `check_return_expr` before this"}, {"sha": "fa3d8d7d5064cc2a893fb2554ecbff4fb7e97a1d", "filename": "src/test/ui/dyn-star/return.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/75afb22331daececeba38a3efb0134348d6c14d9/src%2Ftest%2Fui%2Fdyn-star%2Freturn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75afb22331daececeba38a3efb0134348d6c14d9/src%2Ftest%2Fui%2Fdyn-star%2Freturn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Freturn.rs?ref=75afb22331daececeba38a3efb0134348d6c14d9", "patch": "@@ -0,0 +1,10 @@\n+// check-pass\n+\n+#![feature(dyn_star)]\n+//~^ WARN the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+\n+fn _foo() -> dyn* Unpin {\n+    4usize\n+}\n+\n+fn main() {}"}, {"sha": "e000351a68f541d7057fbb4bc49708ef5722b0e2", "filename": "src/test/ui/dyn-star/return.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/75afb22331daececeba38a3efb0134348d6c14d9/src%2Ftest%2Fui%2Fdyn-star%2Freturn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/75afb22331daececeba38a3efb0134348d6c14d9/src%2Ftest%2Fui%2Fdyn-star%2Freturn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Freturn.stderr?ref=75afb22331daececeba38a3efb0134348d6c14d9", "patch": "@@ -0,0 +1,11 @@\n+warning: the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+  --> $DIR/return.rs:3:12\n+   |\n+LL | #![feature(dyn_star)]\n+   |            ^^^^^^^^\n+   |\n+   = note: see issue #91611 <https://github.com/rust-lang/rust/issues/91611> for more information\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+warning: 1 warning emitted\n+"}]}