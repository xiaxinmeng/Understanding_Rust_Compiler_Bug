{"sha": "e346920907d1dec22d2dcc19b0dc483b9a94810b", "node_id": "C_kwDOAAsO6NoAKGUzNDY5MjA5MDdkMWRlYzIyZDJkY2MxOWIwZGM0ODNiOWE5NDgxMGI", "commit": {"author": {"name": "Lo\u00efc BRANSTETT", "email": "lolo.branstett@numericable.fr", "date": "2022-03-09T10:18:28Z"}, "committer": {"name": "Lo\u00efc BRANSTETT", "email": "lolo.branstett@numericable.fr", "date": "2022-03-09T12:45:50Z"}, "message": "Also take in account mdbook redirect in linkchecker", "tree": {"sha": "6cafc0327b24b44b53e8d68d57f5e96159c90049", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6cafc0327b24b44b53e8d68d57f5e96159c90049"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e346920907d1dec22d2dcc19b0dc483b9a94810b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e346920907d1dec22d2dcc19b0dc483b9a94810b", "html_url": "https://github.com/rust-lang/rust/commit/e346920907d1dec22d2dcc19b0dc483b9a94810b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e346920907d1dec22d2dcc19b0dc483b9a94810b/comments", "author": {"login": "Urgau", "id": 3616612, "node_id": "MDQ6VXNlcjM2MTY2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3616612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Urgau", "html_url": "https://github.com/Urgau", "followers_url": "https://api.github.com/users/Urgau/followers", "following_url": "https://api.github.com/users/Urgau/following{/other_user}", "gists_url": "https://api.github.com/users/Urgau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Urgau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Urgau/subscriptions", "organizations_url": "https://api.github.com/users/Urgau/orgs", "repos_url": "https://api.github.com/users/Urgau/repos", "events_url": "https://api.github.com/users/Urgau/events{/privacy}", "received_events_url": "https://api.github.com/users/Urgau/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Urgau", "id": 3616612, "node_id": "MDQ6VXNlcjM2MTY2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3616612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Urgau", "html_url": "https://github.com/Urgau", "followers_url": "https://api.github.com/users/Urgau/followers", "following_url": "https://api.github.com/users/Urgau/following{/other_user}", "gists_url": "https://api.github.com/users/Urgau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Urgau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Urgau/subscriptions", "organizations_url": "https://api.github.com/users/Urgau/orgs", "repos_url": "https://api.github.com/users/Urgau/repos", "events_url": "https://api.github.com/users/Urgau/events{/privacy}", "received_events_url": "https://api.github.com/users/Urgau/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e067e80ebb60022d6446335b0721feed73483b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e067e80ebb60022d6446335b0721feed73483b9", "html_url": "https://github.com/rust-lang/rust/commit/4e067e80ebb60022d6446335b0721feed73483b9"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "c9b1649200d9cb2a8c7a21fd2983f5027f172cf8", "filename": "src/tools/linkchecker/main.rs", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e346920907d1dec22d2dcc19b0dc483b9a94810b/src%2Ftools%2Flinkchecker%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e346920907d1dec22d2dcc19b0dc483b9a94810b/src%2Ftools%2Flinkchecker%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Flinkchecker%2Fmain.rs?ref=e346920907d1dec22d2dcc19b0dc483b9a94810b", "patch": "@@ -489,16 +489,22 @@ fn is_exception(file: &Path, link: &str) -> bool {\n /// If the given HTML file contents is an HTML redirect, this returns the\n /// destination path given in the redirect.\n fn maybe_redirect(source: &str) -> Option<String> {\n-    const REDIRECT: &str = \"<p>Redirecting to <a href=\";\n+    const REDIRECT_RUSTDOC: (usize, &str) = (7, \"<p>Redirecting to <a href=\");\n+    const REDIRECT_MDBOOK: (usize, &str) = (8 - 7, \"<p>Redirecting to... <a href=\");\n \n     let mut lines = source.lines();\n-    let redirect_line = lines.nth(7)?;\n \n-    redirect_line.find(REDIRECT).map(|i| {\n-        let rest = &redirect_line[(i + REDIRECT.len() + 1)..];\n-        let pos_quote = rest.find('\"').unwrap();\n-        rest[..pos_quote].to_owned()\n-    })\n+    let mut find_redirect = |(line_rel, redirect_pattern): (usize, &str)| {\n+        let redirect_line = lines.nth(line_rel)?;\n+\n+        redirect_line.find(redirect_pattern).map(|i| {\n+            let rest = &redirect_line[(i + redirect_pattern.len() + 1)..];\n+            let pos_quote = rest.find('\"').unwrap();\n+            rest[..pos_quote].to_owned()\n+        })\n+    };\n+\n+    find_redirect(REDIRECT_RUSTDOC).or_else(|| find_redirect(REDIRECT_MDBOOK))\n }\n \n fn with_attrs_in_source<F: FnMut(&str, usize, &str)>(source: &str, attr: &str, mut f: F) {"}]}