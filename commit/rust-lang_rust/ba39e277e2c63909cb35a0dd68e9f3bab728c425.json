{"sha": "ba39e277e2c63909cb35a0dd68e9f3bab728c425", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJhMzllMjc3ZTJjNjM5MDljYjM1YTBkZDY4ZTlmM2JhYjcyOGM0MjU=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-03-21T02:06:04Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-03-21T02:08:17Z"}, "message": "stdlib: Implement arenas", "tree": {"sha": "abe2cb172c0aded0d946c218dae066682223504d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abe2cb172c0aded0d946c218dae066682223504d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba39e277e2c63909cb35a0dd68e9f3bab728c425", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba39e277e2c63909cb35a0dd68e9f3bab728c425", "html_url": "https://github.com/rust-lang/rust/commit/ba39e277e2c63909cb35a0dd68e9f3bab728c425", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba39e277e2c63909cb35a0dd68e9f3bab728c425/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "575692c3bcb20897cf07fcd21769c8a7dbdd948e", "url": "https://api.github.com/repos/rust-lang/rust/commits/575692c3bcb20897cf07fcd21769c8a7dbdd948e", "html_url": "https://github.com/rust-lang/rust/commit/575692c3bcb20897cf07fcd21769c8a7dbdd948e"}], "stats": {"total": 45, "additions": 42, "deletions": 3}, "files": [{"sha": "eb293d4f2d9c6916c298dd9b1e8e07c96b79299b", "filename": "src/libstd/arena.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/ba39e277e2c63909cb35a0dd68e9f3bab728c425/src%2Flibstd%2Farena.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba39e277e2c63909cb35a0dd68e9f3bab728c425/src%2Flibstd%2Farena.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Farena.rs?ref=ba39e277e2c63909cb35a0dd68e9f3bab728c425", "patch": "@@ -0,0 +1,38 @@\n+// Dynamic arenas.\n+\n+export arena, arena_with_size;\n+\n+import list;\n+\n+type chunk = {data: [u8], mut fill: uint};\n+type arena = {mut chunks: list::list<@chunk>};\n+\n+fn chunk(size: uint) -> @chunk {\n+    @{ data: vec::from_elem(size, 0u8), mut fill: 0u }\n+}\n+\n+fn arena_with_size(initial_size: uint) -> arena {\n+    ret {mut chunks: list::cons(chunk(initial_size), @list::nil)};\n+}\n+\n+fn arena() -> arena {\n+    arena_with_size(32u)\n+}\n+\n+impl arena for arena {\n+    unsafe fn alloc<T>(n_bytes: uint) -> &self.T {\n+        let mut head = list::head(self.chunks);\n+        if head.fill + n_bytes > vec::len(head.data) {\n+            // Allocate a new chunk.\n+            let new_min_chunk_size = uint::max(n_bytes, vec::len(head.data));\n+            head = chunk(uint::next_power_of_two(new_min_chunk_size));\n+            self.chunks = list::cons(head, @self.chunks);\n+        }\n+\n+        let start = vec::unsafe::to_ptr(head.data);\n+        let p = ptr::offset(start, head.fill);\n+        head.fill += n_bytes;\n+        ret unsafe::reinterpret_cast(p);\n+    }\n+}\n+"}, {"sha": "6526736167776552ad1c08f39c177e10d1f73344", "filename": "src/libstd/std.rc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ba39e277e2c63909cb35a0dd68e9f3bab728c425/src%2Flibstd%2Fstd.rc", "raw_url": "https://github.com/rust-lang/rust/raw/ba39e277e2c63909cb35a0dd68e9f3bab728c425/src%2Flibstd%2Fstd.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fstd.rc?ref=ba39e277e2c63909cb35a0dd68e9f3bab728c425", "patch": "@@ -11,7 +11,7 @@\n export net, uv;\n export c_vec, four, tri, util;\n export bitv, deque, fun_treemap, list, map, smallintmap, sort, treemap, ufind;\n-export rope;\n+export rope, arena;\n export ebml, dbg, getopts, json, rand, sha1, term, time, prettyprint;\n export test, tempfile, serialization;\n \n@@ -56,6 +56,7 @@ mod tempfile;\n mod term;\n mod time;\n mod prettyprint;\n+mod arena;\n \n #[cfg(unicode)]\n mod unicode;"}, {"sha": "5cedc9d50c0d0d43b1bde892bc30650eed6627ca", "filename": "src/rustc/metadata/encoder.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ba39e277e2c63909cb35a0dd68e9f3bab728c425/src%2Frustc%2Fmetadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba39e277e2c63909cb35a0dd68e9f3bab728c425/src%2Frustc%2Fmetadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmetadata%2Fencoder.rs?ref=ba39e277e2c63909cb35a0dd68e9f3bab728c425", "patch": "@@ -672,9 +672,9 @@ fn encode_info_for_items(ecx: @encode_ctxt, ebml_w: ebml::writer,\n                                       *pt, none, tps, ctor.node.dec)\n                   }\n                   _ {}\n+                }\n+              }\n             }\n-           }\n-          }\n         },\n         visit_native_item: {|ni, cx, v|\n             visit::visit_native_item(ni, cx, v);"}]}