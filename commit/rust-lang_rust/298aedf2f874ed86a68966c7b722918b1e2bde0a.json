{"sha": "298aedf2f874ed86a68966c7b722918b1e2bde0a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5OGFlZGYyZjg3NGVkODZhNjg5NjZjN2I3MjI5MThiMWUyYmRlMGE=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-12-09T16:25:45Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-12-28T19:54:29Z"}, "message": "Fix suggestion for unnecessary_ref lint", "tree": {"sha": "0a3a63db7f3f1d37b8c67f7eb5260030b4de4fbc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0a3a63db7f3f1d37b8c67f7eb5260030b4de4fbc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/298aedf2f874ed86a68966c7b722918b1e2bde0a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlwmf3YACgkQtvoGpuDi\nZlsdng//YyuBVwSy8VVriUMskTluC2YEObx0sI8CwOOCqKHklOuqRi0TtnzLDhWd\nyUCDubgOCctjcm0/fLJRdsQoBB9xOO/P6FtUyjYO9KD7RBNfdEj8ZT1kfY0u7f/H\nD9UYYinojpGux/JVHEsQUJk4OEG+AV2IlpyV9WaGiTVqXsRlXVMrz4NfzEd3CXeN\ntpfBMKORR+qpii0wrlXrDv4djKRrq0ZxQ7kBQEjjqyUiJuooOekA45X7AYxvN8ZW\nyxoCX0CIZz9NIIZ1VUlBVH98yvNBWsWmfvkyzKwcPEBZvO5SKURdVY2qeYbmjMLM\nptUVkVcGeq5ppkIjUjPedepMUytJUwlnT8hoZM5i0mdHWkVv7VjLuNMIY/tDCh54\nLDsvqiuXnl6YEYHzQi0wLsTmprknDqatvsRY2SDEAU3qdcSkLCxEqYWQGyBoPNaN\nvKRzzPg+PTEAQbl9/4gJ1Nx5sP3vQN0SPrFfheduQa3zsreYF+agN0aowy2eQ5CA\nvHvtYiLUuY8nJadgQ9l24BxxdOCzmuZHIk+1v+tgStXWHBMqWtUTY6PS6AjtSLHU\nu78ZsVHVuMT/dkmFPCHRuq3NEIunBPlaANCHwEt7t752+sEZuZVwyToojjJ14Hsj\n3c0HTKvgV3hD7rSibDGiWTMWWB8jBwyqn0nj6iN1Xa1Mhkg0Vms=\n=2wz+\n-----END PGP SIGNATURE-----", "payload": "tree 0a3a63db7f3f1d37b8c67f7eb5260030b4de4fbc\nparent 3f978afe8d2260e29dbc593fa294ccaa39b0df32\nauthor Philipp Hansch <dev@phansch.net> 1544372745 +0100\ncommitter Philipp Hansch <dev@phansch.net> 1546026869 +0100\n\nFix suggestion for unnecessary_ref lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/298aedf2f874ed86a68966c7b722918b1e2bde0a", "html_url": "https://github.com/rust-lang/rust/commit/298aedf2f874ed86a68966c7b722918b1e2bde0a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/298aedf2f874ed86a68966c7b722918b1e2bde0a/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f978afe8d2260e29dbc593fa294ccaa39b0df32", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f978afe8d2260e29dbc593fa294ccaa39b0df32", "html_url": "https://github.com/rust-lang/rust/commit/3f978afe8d2260e29dbc593fa294ccaa39b0df32"}], "stats": {"total": 19, "additions": 8, "deletions": 11}, "files": [{"sha": "d76fa0c38b99a43ea5dbd19cd995036fb29432a0", "filename": "clippy_lints/src/reference.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/298aedf2f874ed86a68966c7b722918b1e2bde0a/clippy_lints%2Fsrc%2Freference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/298aedf2f874ed86a68966c7b722918b1e2bde0a/clippy_lints%2Fsrc%2Freference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Freference.rs?ref=298aedf2f874ed86a68966c7b722918b1e2bde0a", "patch": "@@ -98,7 +98,7 @@ impl LintPass for DerefPass {\n impl EarlyLintPass for DerefPass {\n     fn check_expr(&mut self, cx: &EarlyContext<'_>, e: &Expr) {\n         if_chain! {\n-            if let ExprKind::Field(ref object, ref field_name) = e.node;\n+            if let ExprKind::Field(ref object, _) = e.node;\n             if let ExprKind::Paren(ref parened) = object.node;\n             if let ExprKind::AddrOf(_, ref inner) = parened.node;\n             then {\n@@ -109,11 +109,7 @@ impl EarlyLintPass for DerefPass {\n                     object.span,\n                     \"Creating a reference that is immediately dereferenced.\",\n                     \"try this\",\n-                    format!(\n-                        \"{}.{}\",\n-                        snippet_with_applicability(cx, inner.span, \"_\", &mut applicability),\n-                        snippet_with_applicability(cx, field_name.span, \"_\", &mut applicability)\n-                    ),\n+                    snippet_with_applicability(cx, inner.span, \"_\", &mut applicability).to_string(),\n                     applicability,\n                 );\n             }"}, {"sha": "3617641a116c4a0e34303f143a0dee721ec4d7a5", "filename": "tests/ui/unnecessary_ref.fixed", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/298aedf2f874ed86a68966c7b722918b1e2bde0a/tests%2Fui%2Funnecessary_ref.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/298aedf2f874ed86a68966c7b722918b1e2bde0a/tests%2Fui%2Funnecessary_ref.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_ref.fixed?ref=298aedf2f874ed86a68966c7b722918b1e2bde0a", "patch": "@@ -9,8 +9,8 @@\n \n // run-rustfix\n \n-\n #![feature(stmt_expr_attributes)]\n+#![allow(unused_variables)]\n \n struct Outer {\n     inner: u32,\n@@ -19,5 +19,5 @@ struct Outer {\n #[deny(clippy::ref_in_deref)]\n fn main() {\n     let outer = Outer { inner: 0 };\n-    let inner = outer.inner.inner;\n+    let inner = outer.inner;\n }"}, {"sha": "48101c87a54ed80232a0482c547d901f3d567742", "filename": "tests/ui/unnecessary_ref.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/298aedf2f874ed86a68966c7b722918b1e2bde0a/tests%2Fui%2Funnecessary_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/298aedf2f874ed86a68966c7b722918b1e2bde0a/tests%2Fui%2Funnecessary_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_ref.rs?ref=298aedf2f874ed86a68966c7b722918b1e2bde0a", "patch": "@@ -10,6 +10,7 @@\n // run-rustfix\n \n #![feature(stmt_expr_attributes)]\n+#![allow(unused_variables)]\n \n struct Outer {\n     inner: u32,"}, {"sha": "863a6389e7fc99b702d7eb6fee8ead3c9a6eaaa1", "filename": "tests/ui/unnecessary_ref.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/298aedf2f874ed86a68966c7b722918b1e2bde0a/tests%2Fui%2Funnecessary_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/298aedf2f874ed86a68966c7b722918b1e2bde0a/tests%2Fui%2Funnecessary_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_ref.stderr?ref=298aedf2f874ed86a68966c7b722918b1e2bde0a", "patch": "@@ -1,11 +1,11 @@\n error: Creating a reference that is immediately dereferenced.\n-  --> $DIR/unnecessary_ref.rs:21:17\n+  --> $DIR/unnecessary_ref.rs:22:17\n    |\n LL |     let inner = (&outer).inner;\n-   |                 ^^^^^^^^ help: try this: `outer.inner`\n+   |                 ^^^^^^^^ help: try this: `outer`\n    |\n note: lint level defined here\n-  --> $DIR/unnecessary_ref.rs:18:8\n+  --> $DIR/unnecessary_ref.rs:19:8\n    |\n LL | #[deny(clippy::ref_in_deref)]\n    |        ^^^^^^^^^^^^^^^^^^^^"}]}