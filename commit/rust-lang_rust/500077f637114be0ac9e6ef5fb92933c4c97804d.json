{"sha": "500077f637114be0ac9e6ef5fb92933c4c97804d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwMDA3N2Y2MzcxMTRiZTBhYzllNmVmNWZiOTI5MzNjNGM5NzgwNGQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-09-09T08:01:23Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-09-09T08:01:23Z"}, "message": "Remove hacks around issues in local_data\n\nThese compiler bugs have since been fixed (one less layer of indirection)", "tree": {"sha": "5a924afa06957cf02554b76bc4a5be512dac2b58", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a924afa06957cf02554b76bc4a5be512dac2b58"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/500077f637114be0ac9e6ef5fb92933c4c97804d", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/500077f637114be0ac9e6ef5fb92933c4c97804d", "html_url": "https://github.com/rust-lang/rust/commit/500077f637114be0ac9e6ef5fb92933c4c97804d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/500077f637114be0ac9e6ef5fb92933c4c97804d/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5591dce52eb35730e89070c7e104e1f1bf0a8ab3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5591dce52eb35730e89070c7e104e1f1bf0a8ab3", "html_url": "https://github.com/rust-lang/rust/commit/5591dce52eb35730e89070c7e104e1f1bf0a8ab3"}], "stats": {"total": 16, "additions": 7, "deletions": 9}, "files": [{"sha": "a13c75635dc412b00d8ccdbdaf2d07a0dc39dc8d", "filename": "src/libstd/local_data.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/500077f637114be0ac9e6ef5fb92933c4c97804d/src%2Flibstd%2Flocal_data.rs", "raw_url": "https://github.com/rust-lang/rust/raw/500077f637114be0ac9e6ef5fb92933c4c97804d/src%2Flibstd%2Flocal_data.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flocal_data.rs?ref=500077f637114be0ac9e6ef5fb92933c4c97804d", "patch": "@@ -155,13 +155,13 @@ pub fn pop<T: 'static>(key: Key<T>) -> Option<T> {\n \n                 // Move `data` into transmute to get out the memory that it\n                 // owns, we must free it manually later.\n-                let (_vtable, box): (uint, ~~T) = unsafe {\n+                let (_vtable, box): (uint, ~T) = unsafe {\n                     cast::transmute(data)\n                 };\n \n                 // Now that we own `box`, we can just move out of it as we would\n                 // with any other data.\n-                return Some(**box);\n+                return Some(*box);\n             }\n             _ => {}\n         }\n@@ -244,13 +244,13 @@ fn get_with<T: 'static, U>(key: Key<T>,\n                                   want.describe(), cur.describe());\n                         }\n                     }\n-                    // data was created with `~~T as ~LocalData`, so we extract\n-                    // pointer part of the trait, (as ~~T), and then use\n+                    // data was created with `~T as ~LocalData`, so we extract\n+                    // pointer part of the trait, (as ~T), and then use\n                     // compiler coercions to achieve a '&' pointer.\n                     unsafe {\n-                        match *cast::transmute::<&TLSValue, &(uint, ~~T)>(data){\n+                        match *cast::transmute::<&TLSValue, &(uint, ~T)>(data){\n                             (_vtable, ref box) => {\n-                                let value: &T = **box;\n+                                let value: &T = *box;\n                                 ret = f(Some(value));\n                             }\n                         }\n@@ -294,9 +294,7 @@ pub fn set<T: 'static>(key: Key<T>, data: T) {\n     // everything to a trait (LocalData) which is then stored inside the map.\n     // Upon destruction of the map, all the objects will be destroyed and the\n     // traits have enough information about them to destroy themselves.\n-    //\n-    // FIXME(#7673): This should be \"~data as ~LocalData\" (only one sigil)\n-    let data = ~~data as ~LocalData:;\n+    let data = ~data as ~LocalData:;\n \n     fn insertion_position(map: &mut Map,\n                           key: *libc::c_void) -> Option<uint> {"}]}