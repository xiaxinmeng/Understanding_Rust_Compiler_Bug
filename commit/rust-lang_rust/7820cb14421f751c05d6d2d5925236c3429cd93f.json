{"sha": "7820cb14421f751c05d6d2d5925236c3429cd93f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4MjBjYjE0NDIxZjc1MWMwNWQ2ZDJkNTkyNTIzNmMzNDI5Y2Q5M2Y=", "commit": {"author": {"name": "rail", "email": "12975677+rail-rain@users.noreply.github.com", "date": "2020-10-02T10:21:24Z"}, "committer": {"name": "rail", "email": "12975677+rail-rain@users.noreply.github.com", "date": "2020-10-02T10:21:24Z"}, "message": "Add tests for\n\n* `dst.len()` as the end of the range with loop counters\n* the increment of the loop counter at the top of the loop", "tree": {"sha": "133f4dc429c50ad27bde56b6309777bed9914e66", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/133f4dc429c50ad27bde56b6309777bed9914e66"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7820cb14421f751c05d6d2d5925236c3429cd93f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7820cb14421f751c05d6d2d5925236c3429cd93f", "html_url": "https://github.com/rust-lang/rust/commit/7820cb14421f751c05d6d2d5925236c3429cd93f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7820cb14421f751c05d6d2d5925236c3429cd93f/comments", "author": {"login": "rail-rain", "id": 12975677, "node_id": "MDQ6VXNlcjEyOTc1Njc3", "avatar_url": "https://avatars.githubusercontent.com/u/12975677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rail-rain", "html_url": "https://github.com/rail-rain", "followers_url": "https://api.github.com/users/rail-rain/followers", "following_url": "https://api.github.com/users/rail-rain/following{/other_user}", "gists_url": "https://api.github.com/users/rail-rain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rail-rain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rail-rain/subscriptions", "organizations_url": "https://api.github.com/users/rail-rain/orgs", "repos_url": "https://api.github.com/users/rail-rain/repos", "events_url": "https://api.github.com/users/rail-rain/events{/privacy}", "received_events_url": "https://api.github.com/users/rail-rain/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rail-rain", "id": 12975677, "node_id": "MDQ6VXNlcjEyOTc1Njc3", "avatar_url": "https://avatars.githubusercontent.com/u/12975677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rail-rain", "html_url": "https://github.com/rail-rain", "followers_url": "https://api.github.com/users/rail-rain/followers", "following_url": "https://api.github.com/users/rail-rain/following{/other_user}", "gists_url": "https://api.github.com/users/rail-rain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rail-rain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rail-rain/subscriptions", "organizations_url": "https://api.github.com/users/rail-rain/orgs", "repos_url": "https://api.github.com/users/rail-rain/repos", "events_url": "https://api.github.com/users/rail-rain/events{/privacy}", "received_events_url": "https://api.github.com/users/rail-rain/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a0e45b8dbfa9c8494371983b128b933082a9c13", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a0e45b8dbfa9c8494371983b128b933082a9c13", "html_url": "https://github.com/rust-lang/rust/commit/2a0e45b8dbfa9c8494371983b128b933082a9c13"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "ba388a05a2859e7a05dab97158ce872be225266c", "filename": "tests/ui/manual_memcpy/with_loop_counters.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/7820cb14421f751c05d6d2d5925236c3429cd93f/tests%2Fui%2Fmanual_memcpy%2Fwith_loop_counters.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7820cb14421f751c05d6d2d5925236c3429cd93f/tests%2Fui%2Fmanual_memcpy%2Fwith_loop_counters.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_memcpy%2Fwith_loop_counters.rs?ref=7820cb14421f751c05d6d2d5925236c3429cd93f", "patch": "@@ -37,6 +37,12 @@ pub fn manual_copy_with_counters(src: &[i32], dst: &mut [i32], dst2: &mut [i32])\n         count += 1;\n     }\n \n+    let mut count = 2;\n+    for i in 0..dst.len() {\n+        dst[i] = src[count];\n+        count += 1;\n+    }\n+\n     let mut count = 5;\n     for i in 3..10 {\n         dst[i] = src[count];\n@@ -66,6 +72,17 @@ pub fn manual_copy_with_counters(src: &[i32], dst: &mut [i32], dst2: &mut [i32])\n         dst[i] = src[count];\n         count += 1\n     }\n+\n+    // make sure ones where the increment is not at the end of the loop.\n+    // As a possible enhancement, one could adjust the offset in the suggestion according to\n+    // the position. For example, if the increment is at the top of the loop;\n+    // treating the loop counter as if it were initialized 1 greater than the original value.\n+    let mut count = 0;\n+    #[allow(clippy::needless_range_loop)]\n+    for i in 0..src.len() {\n+        count += 1;\n+        dst[i] = src[count];\n+    }\n }\n \n fn main() {}"}, {"sha": "2547b19f5d1d43978225d22eb15b03b917776f78", "filename": "tests/ui/manual_memcpy/with_loop_counters.stderr", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/7820cb14421f751c05d6d2d5925236c3429cd93f/tests%2Fui%2Fmanual_memcpy%2Fwith_loop_counters.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7820cb14421f751c05d6d2d5925236c3429cd93f/tests%2Fui%2Fmanual_memcpy%2Fwith_loop_counters.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmanual_memcpy%2Fwith_loop_counters.stderr?ref=7820cb14421f751c05d6d2d5925236c3429cd93f", "patch": "@@ -57,14 +57,23 @@ LL | |     }\n error: it looks like you're manually copying between slices\n   --> $DIR/with_loop_counters.rs:41:5\n    |\n+LL | /     for i in 0..dst.len() {\n+LL | |         dst[i] = src[count];\n+LL | |         count += 1;\n+LL | |     }\n+   | |_____^ help: try replacing the loop by: `dst.clone_from_slice(&src[2..(dst.len() + 2)]);`\n+\n+error: it looks like you're manually copying between slices\n+  --> $DIR/with_loop_counters.rs:47:5\n+   |\n LL | /     for i in 3..10 {\n LL | |         dst[i] = src[count];\n LL | |         count += 1;\n LL | |     }\n    | |_____^ help: try replacing the loop by: `dst[3..10].clone_from_slice(&src[5..(10 + 5 - 3)]);`\n \n error: it looks like you're manually copying between slices\n-  --> $DIR/with_loop_counters.rs:48:5\n+  --> $DIR/with_loop_counters.rs:54:5\n    |\n LL | /     for i in 0..src.len() {\n LL | |         dst[count] = src[i];\n@@ -81,7 +90,7 @@ LL |     dst2[30..(src.len() + 30)].clone_from_slice(&src[..]);\n    |\n \n error: it looks like you're manually copying between slices\n-  --> $DIR/with_loop_counters.rs:58:5\n+  --> $DIR/with_loop_counters.rs:64:5\n    |\n LL | /     for i in 0..1 << 1 {\n LL | |         dst[count] = src[i + 2];\n@@ -90,13 +99,13 @@ LL | |     }\n    | |_____^ help: try replacing the loop by: `dst[(0 << 1)..((1 << 1) + (0 << 1))].clone_from_slice(&src[2..((1 << 1) + 2)]);`\n \n error: it looks like you're manually copying between slices\n-  --> $DIR/with_loop_counters.rs:65:5\n+  --> $DIR/with_loop_counters.rs:71:5\n    |\n LL | /     for i in 3..src.len() {\n LL | |         dst[i] = src[count];\n LL | |         count += 1\n LL | |     }\n    | |_____^ help: try replacing the loop by: `dst[3..src.len()].clone_from_slice(&src[..(src.len() - 3)]);`\n \n-error: aborting due to 10 previous errors\n+error: aborting due to 11 previous errors\n "}]}