{"sha": "480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4MGNjYzNkYmVjNDQ0MGJlYTBhYTFmNDdkMmFkMjFlYmNkZDU3OGU=", "commit": {"author": {"name": "JarredAllen", "email": "jarredallen73@gmail.com", "date": "2020-08-12T01:01:10Z"}, "committer": {"name": "JarredAllen", "email": "jarredallen73@gmail.com", "date": "2020-08-12T17:35:08Z"}, "message": "Change Rc<Box<T>> recommendation to be Rc<T> instead of Box<T>", "tree": {"sha": "ab87257b6715525300b06aac3491016421b70265", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab87257b6715525300b06aac3491016421b70265"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e", "html_url": "https://github.com/rust-lang/rust/commit/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e/comments", "author": {"login": "JarredAllen", "id": 19656507, "node_id": "MDQ6VXNlcjE5NjU2NTA3", "avatar_url": "https://avatars.githubusercontent.com/u/19656507?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JarredAllen", "html_url": "https://github.com/JarredAllen", "followers_url": "https://api.github.com/users/JarredAllen/followers", "following_url": "https://api.github.com/users/JarredAllen/following{/other_user}", "gists_url": "https://api.github.com/users/JarredAllen/gists{/gist_id}", "starred_url": "https://api.github.com/users/JarredAllen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JarredAllen/subscriptions", "organizations_url": "https://api.github.com/users/JarredAllen/orgs", "repos_url": "https://api.github.com/users/JarredAllen/repos", "events_url": "https://api.github.com/users/JarredAllen/events{/privacy}", "received_events_url": "https://api.github.com/users/JarredAllen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JarredAllen", "id": 19656507, "node_id": "MDQ6VXNlcjE5NjU2NTA3", "avatar_url": "https://avatars.githubusercontent.com/u/19656507?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JarredAllen", "html_url": "https://github.com/JarredAllen", "followers_url": "https://api.github.com/users/JarredAllen/followers", "following_url": "https://api.github.com/users/JarredAllen/following{/other_user}", "gists_url": "https://api.github.com/users/JarredAllen/gists{/gist_id}", "starred_url": "https://api.github.com/users/JarredAllen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JarredAllen/subscriptions", "organizations_url": "https://api.github.com/users/JarredAllen/orgs", "repos_url": "https://api.github.com/users/JarredAllen/repos", "events_url": "https://api.github.com/users/JarredAllen/events{/privacy}", "received_events_url": "https://api.github.com/users/JarredAllen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "439bae62a48fee04b0655548d42e7076b6a5042f", "url": "https://api.github.com/repos/rust-lang/rust/commits/439bae62a48fee04b0655548d42e7076b6a5042f", "html_url": "https://github.com/rust-lang/rust/commit/439bae62a48fee04b0655548d42e7076b6a5042f"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "78cebc30472b7c28657b62d0c2837b6a1f74b1c8", "filename": "clippy_lints/src/types.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e/clippy_lints%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e/clippy_lints%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftypes.rs?ref=480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e", "patch": "@@ -353,14 +353,25 @@ impl Types {\n                             );\n                             return; // don't recurse into the type\n                         }\n-                        if let Some(span) = match_type_parameter(cx, qpath, &paths::BOX) {\n+                        if match_type_parameter(cx, qpath, &paths::BOX).is_some() {\n+                            let box_ty = match &last_path_segment(qpath).args.unwrap().args[0] {\n+                                GenericArg::Type(ty) => match &ty.kind {\n+                                    TyKind::Path(qpath) => qpath,\n+                                    _ => panic!(\"Box that isn't a type\"),\n+                                },\n+                                _ => panic!(\"Rc without type argument\"),\n+                            };\n+                            let inner_span = match &last_path_segment(&box_ty).args.unwrap().args[0] {\n+                                GenericArg::Type(ty) => ty.span,\n+                                _ => panic!(\"Box without type argument\"),\n+                            };\n                             span_lint_and_sugg(\n                                 cx,\n                                 REDUNDANT_ALLOCATION,\n                                 hir_ty.span,\n                                 \"usage of `Rc<Box<T>>`\",\n                                 \"try\",\n-                                snippet(cx, span, \"..\").to_string(),\n+                                format!(\"Rc<{}>\", snippet(cx, inner_span, \"..\")),\n                                 Applicability::MachineApplicable,\n                             );\n                             return; // don't recurse into the type"}, {"sha": "6514fd6d1ac76bbe7ebbbd37453af5002e3c3308", "filename": "tests/ui/redundant_allocation.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e/tests%2Fui%2Fredundant_allocation.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e/tests%2Fui%2Fredundant_allocation.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_allocation.fixed?ref=480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e", "patch": "@@ -33,7 +33,7 @@ pub fn test5(a: Rc<bool>) {}\n \n // Rc<Box<T>>\n \n-pub fn test6(a: Box<bool>) {}\n+pub fn test6(a: Rc<bool>) {}\n \n // Box<&T>\n "}, {"sha": "92e4f67f5db6e40e6f2f0f9bd8ed422b3ec32c0c", "filename": "tests/ui/redundant_allocation.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e/tests%2Fui%2Fredundant_allocation.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e/tests%2Fui%2Fredundant_allocation.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_allocation.stderr?ref=480ccc3dbec4440bea0aa1f47d2ad21ebcdd578e", "patch": "@@ -28,7 +28,7 @@ error: usage of `Rc<Box<T>>`\n   --> $DIR/redundant_allocation.rs:36:17\n    |\n LL | pub fn test6(a: Rc<Box<bool>>) {}\n-   |                 ^^^^^^^^^^^^^ help: try: `Box<bool>`\n+   |                 ^^^^^^^^^^^^^ help: try: `Rc<bool>`\n \n error: usage of `Box<&T>`\n   --> $DIR/redundant_allocation.rs:40:22"}]}