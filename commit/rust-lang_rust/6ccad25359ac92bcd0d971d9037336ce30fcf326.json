{"sha": "6ccad25359ac92bcd0d971d9037336ce30fcf326", "node_id": "C_kwDOAAsO6NoAKDZjY2FkMjUzNTlhYzkyYmNkMGQ5NzFkOTAzNzMzNmNlMzBmY2YzMjY", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-08-27T04:14:21Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-27T04:14:21Z"}, "message": "Rollup merge of #101018 - notriddle:notriddle/item-right-docblock-short, r=GuillaumeGomez\n\nrustdoc: omit start/end tags for empty item description blocks\n\nRelated to #100952\n\nThis is definitely not a complete solution, but it does shrink keysyms/index.html on smithay from 620K to 516K.", "tree": {"sha": "6c5ab15e41ee43ddcf7720f501b8687fd60d1e59", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6c5ab15e41ee43ddcf7720f501b8687fd60d1e59"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ccad25359ac92bcd0d971d9037336ce30fcf326", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjCZodCRBK7hj4Ov3rIwAAoOgIAD78g2PqK4MvHmZ1Mi/gd9Ra\nw4C872ry13a/owD5I43ZF0rXni5Xh33H3GKKtyIUrEaBlct+RxlhOKK+kjsONGKx\ng0SAPDrYlUbJP4FueSTJoy61aG85GgGTmt7uNWzRVtUz96SDK+Y3wSJVVRZKR+xb\nZB544dPIam6uf7e7UxrLnRl0SqSfoRBcuaYfQBjLmiBeXS76k51DhrP7wvUU7ebJ\n0XtoJPygREwNXI10ExYptdkmdztvGXCub27JCqI5AcZy5J+0bl/FclGtQ7E/zyA/\nZjTvCaTby4qq5khZdOry93hjjn92caOC/Cl0rkq4p+5lnkh55NEEkm1AN9k7SpY=\n=WgIJ\n-----END PGP SIGNATURE-----\n", "payload": "tree 6c5ab15e41ee43ddcf7720f501b8687fd60d1e59\nparent f4d4a40a7c9f967d972e5fab65d026c4e5d175ee\nparent e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6\nauthor Yuki Okushi <jtitor@2k36.org> 1661573661 +0900\ncommitter GitHub <noreply@github.com> 1661573661 +0900\n\nRollup merge of #101018 - notriddle:notriddle/item-right-docblock-short, r=GuillaumeGomez\n\nrustdoc: omit start/end tags for empty item description blocks\n\nRelated to #100952\n\nThis is definitely not a complete solution, but it does shrink keysyms/index.html on smithay from 620K to 516K.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ccad25359ac92bcd0d971d9037336ce30fcf326", "html_url": "https://github.com/rust-lang/rust/commit/6ccad25359ac92bcd0d971d9037336ce30fcf326", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ccad25359ac92bcd0d971d9037336ce30fcf326/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f4d4a40a7c9f967d972e5fab65d026c4e5d175ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4d4a40a7c9f967d972e5fab65d026c4e5d175ee", "html_url": "https://github.com/rust-lang/rust/commit/f4d4a40a7c9f967d972e5fab65d026c4e5d175ee"}, {"sha": "e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6", "html_url": "https://github.com/rust-lang/rust/commit/e7b7f8855f97cb66b2b4008888c7ba0e8f2c2db6"}], "stats": {"total": 24, "additions": 16, "deletions": 8}, "files": [{"sha": "4fc54eb87d6bcf6f2d8cb1621062f596701a9f20", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/6ccad25359ac92bcd0d971d9037336ce30fcf326/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ccad25359ac92bcd0d971d9037336ce30fcf326/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=6ccad25359ac92bcd0d971d9037336ce30fcf326", "patch": "@@ -371,16 +371,21 @@ fn item_module(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Item, items:\n                     }\n                     clean::ImportKind::Glob => String::new(),\n                 };\n+                let stab_tags = stab_tags.unwrap_or_default();\n+                let (stab_tags_before, stab_tags_after) = if stab_tags.is_empty() {\n+                    (\"\", \"\")\n+                } else {\n+                    (\"<div class=\\\"item-right docblock-short\\\">\", \"</div>\")\n+                };\n                 write!(\n                     w,\n                     \"<div class=\\\"item-left {stab}{add}import-item\\\"{id}>\\\n                          <code>{vis}{imp}</code>\\\n                      </div>\\\n-                     <div class=\\\"item-right docblock-short\\\">{stab_tags}</div>\",\n+                     {stab_tags_before}{stab_tags}{stab_tags_after}\",\n                     stab = stab.unwrap_or_default(),\n                     vis = myitem.visibility.print_with_space(myitem.item_id, cx),\n                     imp = import.print(cx),\n-                    stab_tags = stab_tags.unwrap_or_default(),\n                 );\n                 w.write_str(ITEM_TABLE_ROW_CLOSE);\n             }\n@@ -412,6 +417,12 @@ fn item_module(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Item, items:\n \n                 let doc_value = myitem.doc_value().unwrap_or_default();\n                 w.write_str(ITEM_TABLE_ROW_OPEN);\n+                let docs = MarkdownSummaryLine(&doc_value, &myitem.links(cx)).into_string();\n+                let (docs_before, docs_after) = if docs.is_empty() {\n+                    (\"\", \"\")\n+                } else {\n+                    (\"<div class=\\\"item-right docblock-short\\\">\", \"</div>\")\n+                };\n                 write!(\n                     w,\n                     \"<div class=\\\"item-left {stab}{add}module-item\\\">\\\n@@ -420,11 +431,10 @@ fn item_module(w: &mut Buffer, cx: &mut Context<'_>, item: &clean::Item, items:\n                         {unsafety_flag}\\\n                         {stab_tags}\\\n                      </div>\\\n-                     <div class=\\\"item-right docblock-short\\\">{docs}</div>\",\n+                     {docs_before}{docs}{docs_after}\",\n                     name = myitem.name.unwrap(),\n                     visibility_emoji = visibility_emoji,\n                     stab_tags = extra_info_tags(myitem, item, cx.tcx()),\n-                    docs = MarkdownSummaryLine(&doc_value, &myitem.links(cx)).into_string(),\n                     class = myitem.type_(),\n                     add = add,\n                     stab = stab.unwrap_or_default(),"}, {"sha": "4bff32b3d5db137b2a86c9a4340275ac5418c334", "filename": "src/test/rustdoc-gui/item-summary-table.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6ccad25359ac92bcd0d971d9037336ce30fcf326/src%2Ftest%2Frustdoc-gui%2Fitem-summary-table.goml", "raw_url": "https://github.com/rust-lang/rust/raw/6ccad25359ac92bcd0d971d9037336ce30fcf326/src%2Ftest%2Frustdoc-gui%2Fitem-summary-table.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fitem-summary-table.goml?ref=6ccad25359ac92bcd0d971d9037336ce30fcf326", "patch": "@@ -3,4 +3,4 @@ goto: file://|DOC_PATH|/lib2/summary_table/index.html\n // We check that we picked the right item first.\n assert-text: (\".item-table .item-left\", \"Foo\")\n // Then we check that its summary is empty.\n-assert-text: (\".item-table .item-right\", \"\")\n+assert-false: \".item-table .item-right\""}, {"sha": "3c5fa7b36adbf9465b8117d8e398250a3dd98b7b", "filename": "src/test/rustdoc/short-docblock-codeblock.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6ccad25359ac92bcd0d971d9037336ce30fcf326/src%2Ftest%2Frustdoc%2Fshort-docblock-codeblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ccad25359ac92bcd0d971d9037336ce30fcf326/src%2Ftest%2Frustdoc%2Fshort-docblock-codeblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fshort-docblock-codeblock.rs?ref=6ccad25359ac92bcd0d971d9037336ce30fcf326", "patch": "@@ -1,8 +1,6 @@\n #![crate_name = \"foo\"]\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]' \"\"\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]' \"Some text.\"\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]' \"let x = 12;\"\n+// @count foo/index.html '//*[@class=\"item-right docblock-short\"]' 0\n \n /// ```\n /// let x = 12;"}]}