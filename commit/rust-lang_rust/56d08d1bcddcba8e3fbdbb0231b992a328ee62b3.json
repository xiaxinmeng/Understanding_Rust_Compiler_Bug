{"sha": "56d08d1bcddcba8e3fbdbb0231b992a328ee62b3", "node_id": "C_kwDOAAsO6NoAKDU2ZDA4ZDFiY2RkY2JhOGUzZmJkYmIwMjMxYjk5MmEzMjhlZTYyYjM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-04-20T12:36:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-20T12:36:55Z"}, "message": "Rollup merge of #110584 - ferrocene:comptest-sysroot-arg, r=oli-obk\n\nAllow overwriting the sysroot compile flag in compile tests\n\nThis was added in https://github.com/rust-lang/rust/pull/110478/files#diff-03a0567fa80ca04ed5a55f9ac5c711b4f84659be2d0ac4a984196d581c04f76b, unconditionally passing the `sysroot` flag to the compile test invocations. In our ferrocene fork we have a few tests that test the `sysroot` flag specifically which fail due to the flag being passed multiple times now.\n\nWe believe upstreaming this small change could be beneficial should the rust-lang/rust also want to test certain sysroot setups in the future.", "tree": {"sha": "fe3753d65109ef0b021cdcfcf060175f423a9d9d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe3753d65109ef0b021cdcfcf060175f423a9d9d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56d08d1bcddcba8e3fbdbb0231b992a328ee62b3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkQTHnCRBK7hj4Ov3rIwAAYIMIADzQg61lSrlhrgcbHkdQly5b\nobh5tw7P/NOv6FhemGu3+FjgBXi/I8MkTqMEILMRbg+gC/rUrMd1+MS0FwrKksKf\nCdC1a66Z5sRX8wTevX2ByVtzG6FzPBy1h1DwKqxYny7GDzn3RZ3h7/9vXjbl0IRL\nuL+pM7hdNrP/uSghT8Y3r/QPXOEBGqkBby8R4Tp+OwlrtT8z4VXzA5WXsPDA/ogC\nZgtChRkwVWZVduljT8FItwjTTKuX1aAYp9XsPC+jD/hXrlFUR7Q9ykYC56kpDKkw\n+HpcBDkVgBPgY8p9Vic2ZVOFYgeVk4mbc6SD2BM6seSlaKCUoK6cSb3yuYG05K0=\n=ahwr\n-----END PGP SIGNATURE-----\n", "payload": "tree fe3753d65109ef0b021cdcfcf060175f423a9d9d\nparent e2ad167c12b351336cca18b62a626e1fdbcb81ad\nparent e434b5b9ece208a42bdc960f053fd5f39a67054f\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1681994215 +0200\ncommitter GitHub <noreply@github.com> 1681994215 +0200\n\nRollup merge of #110584 - ferrocene:comptest-sysroot-arg, r=oli-obk\n\nAllow overwriting the sysroot compile flag in compile tests\n\nThis was added in https://github.com/rust-lang/rust/pull/110478/files#diff-03a0567fa80ca04ed5a55f9ac5c711b4f84659be2d0ac4a984196d581c04f76b, unconditionally passing the `sysroot` flag to the compile test invocations. In our ferrocene fork we have a few tests that test the `sysroot` flag specifically which fail due to the flag being passed multiple times now.\n\nWe believe upstreaming this small change could be beneficial should the rust-lang/rust also want to test certain sysroot setups in the future.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56d08d1bcddcba8e3fbdbb0231b992a328ee62b3", "html_url": "https://github.com/rust-lang/rust/commit/56d08d1bcddcba8e3fbdbb0231b992a328ee62b3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56d08d1bcddcba8e3fbdbb0231b992a328ee62b3/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2ad167c12b351336cca18b62a626e1fdbcb81ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2ad167c12b351336cca18b62a626e1fdbcb81ad", "html_url": "https://github.com/rust-lang/rust/commit/e2ad167c12b351336cca18b62a626e1fdbcb81ad"}, {"sha": "e434b5b9ece208a42bdc960f053fd5f39a67054f", "url": "https://api.github.com/repos/rust-lang/rust/commits/e434b5b9ece208a42bdc960f053fd5f39a67054f", "html_url": "https://github.com/rust-lang/rust/commit/e434b5b9ece208a42bdc960f053fd5f39a67054f"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "0c17ae798086d9f14d9b5b4ade79e5248c229f08", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/56d08d1bcddcba8e3fbdbb0231b992a328ee62b3/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56d08d1bcddcba8e3fbdbb0231b992a328ee62b3/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=56d08d1bcddcba8e3fbdbb0231b992a328ee62b3", "patch": "@@ -1900,8 +1900,11 @@ impl<'test> TestCx<'test> {\n         // Use a single thread for efficiency and a deterministic error message order\n         rustc.arg(\"-Zthreads=1\");\n \n-        // In stage 0, make sure we use `stage0-sysroot` instead of the bootstrap sysroot.\n-        rustc.arg(\"--sysroot\").arg(&self.config.sysroot_base);\n+        // Optionally prevent default --sysroot if specified in test compile-flags.\n+        if !self.props.compile_flags.iter().any(|flag| flag.starts_with(\"--sysroot\")) {\n+            // In stage 0, make sure we use `stage0-sysroot` instead of the bootstrap sysroot.\n+            rustc.arg(\"--sysroot\").arg(&self.config.sysroot_base);\n+        }\n \n         // Optionally prevent default --target if specified in test compile-flags.\n         let custom_target = self.props.compile_flags.iter().any(|x| x.starts_with(\"--target\"));"}]}