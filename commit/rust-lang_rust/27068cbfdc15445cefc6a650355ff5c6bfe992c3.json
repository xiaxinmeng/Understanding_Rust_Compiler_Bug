{"sha": "27068cbfdc15445cefc6a650355ff5c6bfe992c3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3MDY4Y2JmZGMxNTQ0NWNlZmM2YTY1MDM1NWZmNWM2YmZlOTkyYzM=", "commit": {"author": {"name": "Simon Vandel Sillesen", "email": "simon.vandel@gmail.com", "date": "2020-09-19T23:18:05Z"}, "committer": {"name": "Simon Vandel Sillesen", "email": "simon.vandel@gmail.com", "date": "2020-09-20T12:45:47Z"}, "message": "add cleanup of cfg", "tree": {"sha": "2638c41af3884ddad160c7ab722c8326f43dea35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2638c41af3884ddad160c7ab722c8326f43dea35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/27068cbfdc15445cefc6a650355ff5c6bfe992c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/27068cbfdc15445cefc6a650355ff5c6bfe992c3", "html_url": "https://github.com/rust-lang/rust/commit/27068cbfdc15445cefc6a650355ff5c6bfe992c3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/27068cbfdc15445cefc6a650355ff5c6bfe992c3/comments", "author": {"login": "simonvandel", "id": 2770647, "node_id": "MDQ6VXNlcjI3NzA2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2770647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonvandel", "html_url": "https://github.com/simonvandel", "followers_url": "https://api.github.com/users/simonvandel/followers", "following_url": "https://api.github.com/users/simonvandel/following{/other_user}", "gists_url": "https://api.github.com/users/simonvandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonvandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonvandel/subscriptions", "organizations_url": "https://api.github.com/users/simonvandel/orgs", "repos_url": "https://api.github.com/users/simonvandel/repos", "events_url": "https://api.github.com/users/simonvandel/events{/privacy}", "received_events_url": "https://api.github.com/users/simonvandel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "simonvandel", "id": 2770647, "node_id": "MDQ6VXNlcjI3NzA2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2770647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonvandel", "html_url": "https://github.com/simonvandel", "followers_url": "https://api.github.com/users/simonvandel/followers", "following_url": "https://api.github.com/users/simonvandel/following{/other_user}", "gists_url": "https://api.github.com/users/simonvandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonvandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonvandel/subscriptions", "organizations_url": "https://api.github.com/users/simonvandel/orgs", "repos_url": "https://api.github.com/users/simonvandel/repos", "events_url": "https://api.github.com/users/simonvandel/events{/privacy}", "received_events_url": "https://api.github.com/users/simonvandel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "118aae2af1a8dfa9500b26f2542825291c9ae1f8", "url": "https://api.github.com/repos/rust-lang/rust/commits/118aae2af1a8dfa9500b26f2542825291c9ae1f8", "html_url": "https://github.com/rust-lang/rust/commit/118aae2af1a8dfa9500b26f2542825291c9ae1f8"}], "stats": {"total": 217, "additions": 113, "deletions": 104}, "files": [{"sha": "bb77dd38f22fb622a02cf6993117e535543ca3ec", "filename": "compiler/rustc_mir/src/transform/early_otherwise_branch.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/27068cbfdc15445cefc6a650355ff5c6bfe992c3/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fearly_otherwise_branch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27068cbfdc15445cefc6a650355ff5c6bfe992c3/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fearly_otherwise_branch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fearly_otherwise_branch.rs?ref=27068cbfdc15445cefc6a650355ff5c6bfe992c3", "patch": "@@ -6,6 +6,8 @@ use rustc_middle::mir::*;\n use rustc_middle::ty::{Ty, TyCtxt};\n use std::{borrow::Cow, fmt::Debug};\n \n+use super::simplify::simplify_cfg;\n+\n /// This pass optimizes something like\n /// ```text\n /// let x: Option<()>;\n@@ -44,6 +46,8 @@ impl<'tcx> MirPass<'tcx> for EarlyOtherwiseBranch {\n             })\n             .collect();\n \n+        let should_cleanup = !opts_to_apply.is_empty();\n+\n         for opt_to_apply in opts_to_apply {\n             trace!(\"SUCCESS: found optimization possibility to apply: {:?}\", &opt_to_apply);\n \n@@ -147,6 +151,12 @@ impl<'tcx> MirPass<'tcx> for EarlyOtherwiseBranch {\n \n             patch.apply(body);\n         }\n+\n+        // Since this optimization adds new basic blocks and invalidates others,\n+        // clean up the cfg to make it nicer for other passes\n+        if should_cleanup {\n+            simplify_cfg(body);\n+        }\n     }\n }\n "}, {"sha": "386726bfddc74676c302be2c9adcb203702664ac", "filename": "src/test/mir-opt/early_otherwise_branch.opt1.EarlyOtherwiseBranch.diff", "status": "modified", "additions": 14, "deletions": 15, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch.opt1.EarlyOtherwiseBranch.diff", "raw_url": "https://github.com/rust-lang/rust/raw/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch.opt1.EarlyOtherwiseBranch.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch.opt1.EarlyOtherwiseBranch.diff?ref=27068cbfdc15445cefc6a650355ff5c6bfe992c3", "patch": "@@ -36,43 +36,42 @@\n +         StorageLive(_11);                // scope 0 at $DIR/early_otherwise_branch.rs:5:10: 5:17\n +         _11 = Ne(_10, _7);               // scope 0 at $DIR/early_otherwise_branch.rs:5:10: 5:17\n +         StorageDead(_10);                // scope 0 at $DIR/early_otherwise_branch.rs:5:10: 5:17\n-+         switchInt(move _11) -> [false: bb6, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:5:10: 5:17\n++         switchInt(move _11) -> [false: bb4, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:5:10: 5:17\n       }\n   \n       bb1: {\n +         StorageDead(_11);                // scope 0 at $DIR/early_otherwise_branch.rs:6:14: 6:15\n           _0 = const 1_u32;                // scope 0 at $DIR/early_otherwise_branch.rs:6:14: 6:15\n-          goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch.rs:4:5: 7:6\n+-         goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch.rs:4:5: 7:6\n++         goto -> bb3;                     // scope 0 at $DIR/early_otherwise_branch.rs:4:5: 7:6\n       }\n   \n       bb2: {\n-          _6 = discriminant((_3.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch.rs:5:19: 5:26\n-          switchInt(move _6) -> [1_isize: bb3, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:5:19: 5:26\n-      }\n-  \n-      bb3: {\n+-         _6 = discriminant((_3.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch.rs:5:19: 5:26\n+-         switchInt(move _6) -> [1_isize: bb3, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:5:19: 5:26\n+-     }\n+- \n+-     bb3: {\n           StorageLive(_8);                 // scope 0 at $DIR/early_otherwise_branch.rs:5:15: 5:16\n           _8 = (((_3.0: std::option::Option<u32>) as Some).0: u32); // scope 0 at $DIR/early_otherwise_branch.rs:5:15: 5:16\n           StorageLive(_9);                 // scope 0 at $DIR/early_otherwise_branch.rs:5:24: 5:25\n           _9 = (((_3.1: std::option::Option<u32>) as Some).0: u32); // scope 0 at $DIR/early_otherwise_branch.rs:5:24: 5:25\n           _0 = const 0_u32;                // scope 1 at $DIR/early_otherwise_branch.rs:5:31: 5:32\n           StorageDead(_9);                 // scope 0 at $DIR/early_otherwise_branch.rs:5:31: 5:32\n           StorageDead(_8);                 // scope 0 at $DIR/early_otherwise_branch.rs:5:31: 5:32\n-          goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch.rs:4:5: 7:6\n+-         goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch.rs:4:5: 7:6\n++         goto -> bb3;                     // scope 0 at $DIR/early_otherwise_branch.rs:4:5: 7:6\n       }\n   \n-      bb4: {\n+-     bb4: {\n++     bb3: {\n           StorageDead(_3);                 // scope 0 at $DIR/early_otherwise_branch.rs:8:1: 8:2\n           return;                          // scope 0 at $DIR/early_otherwise_branch.rs:8:2: 8:2\n +     }\n + \n-+     bb5 (cleanup): {\n-+         resume;                          // scope 0 at $DIR/early_otherwise_branch.rs:3:1: 8:2\n-+     }\n-+ \n-+     bb6: {\n++     bb4: {\n +         StorageDead(_11);                // scope 0 at $DIR/early_otherwise_branch.rs:5:19: 5:26\n-+         switchInt(_7) -> [1_isize: bb3, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:5:19: 5:26\n++         switchInt(_7) -> [1_isize: bb2, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:5:19: 5:26\n       }\n   }\n   "}, {"sha": "bc5934dec84e41961e0e4ed888b6a28e888175e8", "filename": "src/test/mir-opt/early_otherwise_branch.opt2.EarlyOtherwiseBranch.diff", "status": "modified", "additions": 25, "deletions": 23, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch.opt2.EarlyOtherwiseBranch.diff", "raw_url": "https://github.com/rust-lang/rust/raw/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch.opt2.EarlyOtherwiseBranch.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch.opt2.EarlyOtherwiseBranch.diff?ref=27068cbfdc15445cefc6a650355ff5c6bfe992c3", "patch": "@@ -37,53 +37,55 @@\n +         StorageLive(_12);                // scope 0 at $DIR/early_otherwise_branch.rs:13:10: 13:17\n +         _12 = Ne(_11, _8);               // scope 0 at $DIR/early_otherwise_branch.rs:13:10: 13:17\n +         StorageDead(_11);                // scope 0 at $DIR/early_otherwise_branch.rs:13:10: 13:17\n-+         switchInt(move _12) -> [false: bb8, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch.rs:13:10: 13:17\n++         switchInt(move _12) -> [false: bb5, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:13:10: 13:17\n       }\n   \n       bb1: {\n-          _6 = discriminant((_3.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch.rs:14:16: 14:20\n-          switchInt(move _6) -> [0_isize: bb5, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch.rs:14:16: 14:20\n-      }\n-  \n-      bb2: {\n+-         _6 = discriminant((_3.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch.rs:14:16: 14:20\n+-         switchInt(move _6) -> [0_isize: bb5, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch.rs:14:16: 14:20\n+-     }\n+- \n+-     bb2: {\n +         StorageDead(_12);                // scope 0 at $DIR/early_otherwise_branch.rs:15:14: 15:15\n           _0 = const 1_u32;                // scope 0 at $DIR/early_otherwise_branch.rs:15:14: 15:15\n-          goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n-      }\n-  \n-      bb3: {\n-          _7 = discriminant((_3.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch.rs:13:19: 13:26\n-          switchInt(move _7) -> [1_isize: bb4, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch.rs:13:19: 13:26\n+-         goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n++         goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n       }\n   \n-      bb4: {\n+-     bb3: {\n+-         _7 = discriminant((_3.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch.rs:13:19: 13:26\n+-         switchInt(move _7) -> [1_isize: bb4, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch.rs:13:19: 13:26\n+-     }\n+- \n+-     bb4: {\n++     bb2: {\n           StorageLive(_9);                 // scope 0 at $DIR/early_otherwise_branch.rs:13:15: 13:16\n           _9 = (((_3.0: std::option::Option<u32>) as Some).0: u32); // scope 0 at $DIR/early_otherwise_branch.rs:13:15: 13:16\n           StorageLive(_10);                // scope 0 at $DIR/early_otherwise_branch.rs:13:24: 13:25\n           _10 = (((_3.1: std::option::Option<u32>) as Some).0: u32); // scope 0 at $DIR/early_otherwise_branch.rs:13:24: 13:25\n           _0 = const 0_u32;                // scope 1 at $DIR/early_otherwise_branch.rs:13:31: 13:32\n           StorageDead(_10);                // scope 0 at $DIR/early_otherwise_branch.rs:13:31: 13:32\n           StorageDead(_9);                 // scope 0 at $DIR/early_otherwise_branch.rs:13:31: 13:32\n-          goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n+-         goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n++         goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n       }\n   \n-      bb5: {\n+-     bb5: {\n++     bb3: {\n           _0 = const 0_u32;                // scope 0 at $DIR/early_otherwise_branch.rs:14:25: 14:26\n-          goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n+-         goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n++         goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch.rs:12:5: 16:6\n       }\n   \n-      bb6: {\n+-     bb6: {\n++     bb4: {\n           StorageDead(_3);                 // scope 0 at $DIR/early_otherwise_branch.rs:17:1: 17:2\n           return;                          // scope 0 at $DIR/early_otherwise_branch.rs:17:2: 17:2\n +     }\n + \n-+     bb7 (cleanup): {\n-+         resume;                          // scope 0 at $DIR/early_otherwise_branch.rs:11:1: 17:2\n-+     }\n-+ \n-+     bb8: {\n++     bb5: {\n +         StorageDead(_12);                // scope 0 at $DIR/early_otherwise_branch.rs:14:16: 14:20\n-+         switchInt(_8) -> [0_isize: bb5, 1_isize: bb4, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch.rs:14:16: 14:20\n++         switchInt(_8) -> [0_isize: bb3, 1_isize: bb2, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch.rs:14:16: 14:20\n       }\n   }\n   "}, {"sha": "b0357f1aecd61f7cf5f42f582a3403fbb81de9f2", "filename": "src/test/mir-opt/early_otherwise_branch_3_element_tuple.opt1.EarlyOtherwiseBranch.diff", "status": "modified", "additions": 17, "deletions": 27, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch_3_element_tuple.opt1.EarlyOtherwiseBranch.diff", "raw_url": "https://github.com/rust-lang/rust/raw/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch_3_element_tuple.opt1.EarlyOtherwiseBranch.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch_3_element_tuple.opt1.EarlyOtherwiseBranch.diff?ref=27068cbfdc15445cefc6a650355ff5c6bfe992c3", "patch": "@@ -47,33 +47,30 @@\n +         StorageLive(_15);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:10: 6:17\n +         _15 = Ne(_14, _10);              // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:10: 6:17\n +         StorageDead(_14);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:10: 6:17\n-+         switchInt(move _15) -> [false: bb7, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:10: 6:17\n++         switchInt(move _15) -> [false: bb5, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:10: 6:17\n       }\n   \n       bb1: {\n +         StorageDead(_17);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:7:14: 7:15\n +         StorageDead(_15);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:7:14: 7:15\n           _0 = const 1_u32;                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:7:14: 7:15\n-          goto -> bb5;                     // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:5:5: 8:6\n+-         goto -> bb5;                     // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:5:5: 8:6\n++         goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:5:5: 8:6\n       }\n   \n       bb2: {\n-          _9 = discriminant((_4.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n+-         _9 = discriminant((_4.1: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n -         switchInt(move _9) -> [1_isize: bb3, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+         StorageLive(_16);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+         _16 = discriminant((_4.2: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+         StorageLive(_17);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+         _17 = Ne(_16, _9);               // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+         StorageDead(_16);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+         switchInt(move _17) -> [false: bb8, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-      }\n-  \n-      bb3: {\n+-     }\n+- \n+-     bb3: {\n           _8 = discriminant((_4.2: std::option::Option<u32>)); // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:28: 6:35\n-          switchInt(move _8) -> [1_isize: bb4, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:28: 6:35\n+-         switchInt(move _8) -> [1_isize: bb4, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:28: 6:35\n++         switchInt(move _8) -> [1_isize: bb3, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:28: 6:35\n       }\n   \n-      bb4: {\n+-     bb4: {\n++     bb3: {\n           StorageLive(_11);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:15: 6:16\n           _11 = (((_4.0: std::option::Option<u32>) as Some).0: u32); // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:15: 6:16\n           StorageLive(_12);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:24: 6:25\n@@ -84,26 +81,19 @@\n           StorageDead(_13);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:40: 6:41\n           StorageDead(_12);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:40: 6:41\n           StorageDead(_11);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:40: 6:41\n-          goto -> bb5;                     // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:5:5: 8:6\n+-         goto -> bb5;                     // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:5:5: 8:6\n++         goto -> bb4;                     // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:5:5: 8:6\n       }\n   \n-      bb5: {\n+-     bb5: {\n++     bb4: {\n           StorageDead(_4);                 // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:9:1: 9:2\n           return;                          // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:9:2: 9:2\n +     }\n + \n-+     bb6 (cleanup): {\n-+         resume;                          // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:4:1: 9:2\n-+     }\n-+ \n-+     bb7: {\n++     bb5: {\n +         StorageDead(_15);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+         switchInt(_10) -> [1_isize: bb3, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n-+     }\n-+ \n-+     bb8: {\n-+         StorageDead(_17);                // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:28: 6:35\n-+         switchInt(_9) -> [1_isize: bb4, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:28: 6:35\n++         switchInt(_10) -> [1_isize: bb2, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_3_element_tuple.rs:6:19: 6:26\n       }\n   }\n   "}, {"sha": "57f9b1dd3ca98db563aac7f3753ac0838459992f", "filename": "src/test/mir-opt/early_otherwise_branch_68867.try_sum.EarlyOtherwiseBranch.diff", "status": "modified", "additions": 47, "deletions": 39, "changes": 86, "blob_url": "https://github.com/rust-lang/rust/blob/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch_68867.try_sum.EarlyOtherwiseBranch.diff", "raw_url": "https://github.com/rust-lang/rust/raw/27068cbfdc15445cefc6a650355ff5c6bfe992c3/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch_68867.try_sum.EarlyOtherwiseBranch.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fearly_otherwise_branch_68867.try_sum.EarlyOtherwiseBranch.diff?ref=27068cbfdc15445cefc6a650355ff5c6bfe992c3", "patch": "@@ -73,41 +73,43 @@\n +         StorageLive(_35);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:11: 20:18\n +         _35 = Ne(_34, _11);              // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:11: 20:18\n +         StorageDead(_34);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:11: 20:18\n-+         switchInt(move _35) -> [false: bb13, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:11: 20:18\n++         switchInt(move _35) -> [false: bb8, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:11: 20:18\n       }\n   \n       bb1: {\n-          _7 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:21: 20:30\n-          switchInt(move _7) -> [0_isize: bb6, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:21: 20:30\n-      }\n-  \n-      bb2: {\n+-         _7 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:21: 20:30\n+-         switchInt(move _7) -> [0_isize: bb6, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:21: 20:30\n+-     }\n+- \n+-     bb2: {\n +         StorageDead(_35);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:25: 24:27\n           StorageLive(_33);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:25: 24:27\n           ((_0 as Err).0: ()) = const ();  // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:21: 24:28\n           discriminant(_0) = 1;            // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:21: 24:28\n           StorageDead(_33);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:27: 24:28\n           StorageDead(_3);                 // scope 0 at $DIR/early_otherwise_branch_68867.rs:25:6: 25:7\n           StorageDead(_4);                 // scope 0 at $DIR/early_otherwise_branch_68867.rs:26:1: 26:2\n-          goto -> bb10;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:14: 24:28\n-      }\n-  \n-      bb3: {\n-          _8 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:21: 21:30\n-          switchInt(move _8) -> [1_isize: bb7, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:21: 21:30\n-      }\n-  \n-      bb4: {\n-          _9 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:23: 22:34\n-          switchInt(move _9) -> [2_isize: bb8, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:23: 22:34\n-      }\n-  \n-      bb5: {\n-          _10 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:23: 23:34\n-          switchInt(move _10) -> [3_isize: bb9, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:23: 23:34\n+-         goto -> bb10;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:14: 24:28\n++         goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch_68867.rs:24:14: 24:28\n       }\n   \n-      bb6: {\n+-     bb3: {\n+-         _8 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:21: 21:30\n+-         switchInt(move _8) -> [1_isize: bb7, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:21: 21:30\n+-     }\n+- \n+-     bb4: {\n+-         _9 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:23: 22:34\n+-         switchInt(move _9) -> [2_isize: bb8, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:23: 22:34\n+-     }\n+- \n+-     bb5: {\n+-         _10 = discriminant((*(_4.1: &ViewportPercentageLength))); // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:23: 23:34\n+-         switchInt(move _10) -> [3_isize: bb9, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:23: 23:34\n+-     }\n+- \n+-     bb6: {\n++     bb2: {\n           StorageLive(_12);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:14: 20:17\n           _12 = (((*(_4.0: &ViewportPercentageLength)) as Vw).0: f32); // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:14: 20:17\n           StorageLive(_13);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:24: 20:29\n@@ -125,10 +127,12 @@\n           StorageDead(_14);                // scope 1 at $DIR/early_otherwise_branch_68867.rs:20:49: 20:50\n           StorageDead(_13);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:49: 20:50\n           StorageDead(_12);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:49: 20:50\n-          goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n+-         goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n++         goto -> bb7;                     // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n       }\n   \n-      bb7: {\n+-     bb7: {\n++     bb3: {\n           StorageLive(_17);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:14: 21:17\n           _17 = (((*(_4.0: &ViewportPercentageLength)) as Vh).0: f32); // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:14: 21:17\n           StorageLive(_18);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:24: 21:29\n@@ -146,10 +150,12 @@\n           StorageDead(_19);                // scope 2 at $DIR/early_otherwise_branch_68867.rs:21:49: 21:50\n           StorageDead(_18);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:49: 21:50\n           StorageDead(_17);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:21:49: 21:50\n-          goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n+-         goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n++         goto -> bb7;                     // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n       }\n   \n-      bb8: {\n+-     bb8: {\n++     bb4: {\n           StorageLive(_22);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:16: 22:19\n           _22 = (((*(_4.0: &ViewportPercentageLength)) as Vmin).0: f32); // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:16: 22:19\n           StorageLive(_23);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:28: 22:33\n@@ -167,10 +173,12 @@\n           StorageDead(_24);                // scope 3 at $DIR/early_otherwise_branch_68867.rs:22:55: 22:56\n           StorageDead(_23);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:55: 22:56\n           StorageDead(_22);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:22:55: 22:56\n-          goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n+-         goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n++         goto -> bb7;                     // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n       }\n   \n-      bb9: {\n+-     bb9: {\n++     bb5: {\n           StorageLive(_27);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:16: 23:19\n           _27 = (((*(_4.0: &ViewportPercentageLength)) as Vmax).0: f32); // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:16: 23:19\n           StorageLive(_28);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:28: 23:33\n@@ -188,28 +196,28 @@\n           StorageDead(_29);                // scope 4 at $DIR/early_otherwise_branch_68867.rs:23:55: 23:56\n           StorageDead(_28);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:55: 23:56\n           StorageDead(_27);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:23:55: 23:56\n-          goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n+-         goto -> bb11;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n++         goto -> bb7;                     // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:8: 25:6\n       }\n   \n-      bb10: {\n+-     bb10: {\n++     bb6: {\n           return;                          // scope 0 at $DIR/early_otherwise_branch_68867.rs:26:2: 26:2\n       }\n   \n-      bb11: {\n+-     bb11: {\n++     bb7: {\n           ((_0 as Ok).0: ViewportPercentageLength) = move _3; // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:5: 25:7\n           discriminant(_0) = 0;            // scope 0 at $DIR/early_otherwise_branch_68867.rs:19:5: 25:7\n           StorageDead(_3);                 // scope 0 at $DIR/early_otherwise_branch_68867.rs:25:6: 25:7\n           StorageDead(_4);                 // scope 0 at $DIR/early_otherwise_branch_68867.rs:26:1: 26:2\n-          goto -> bb10;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:26:2: 26:2\n-+     }\n-+ \n-+     bb12 (cleanup): {\n-+         resume;                          // scope 0 at $DIR/early_otherwise_branch_68867.rs:15:1: 26:2\n+-         goto -> bb10;                    // scope 0 at $DIR/early_otherwise_branch_68867.rs:26:2: 26:2\n++         goto -> bb6;                     // scope 0 at $DIR/early_otherwise_branch_68867.rs:26:2: 26:2\n +     }\n + \n-+     bb13: {\n++     bb8: {\n +         StorageDead(_35);                // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:21: 20:30\n-+         switchInt(_11) -> [0_isize: bb6, 1_isize: bb7, 2_isize: bb8, 3_isize: bb9, otherwise: bb2]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:21: 20:30\n++         switchInt(_11) -> [0_isize: bb2, 1_isize: bb3, 2_isize: bb4, 3_isize: bb5, otherwise: bb1]; // scope 0 at $DIR/early_otherwise_branch_68867.rs:20:21: 20:30\n       }\n   }\n   "}]}