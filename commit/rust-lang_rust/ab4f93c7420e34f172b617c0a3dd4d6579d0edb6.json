{"sha": "ab4f93c7420e34f172b617c0a3dd4d6579d0edb6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFiNGY5M2M3NDIwZTM0ZjE3MmI2MTdjMGEzZGQ0ZDY1NzlkMGVkYjY=", "commit": {"author": {"name": "Irina Popa", "email": "irinagpopa@gmail.com", "date": "2018-07-17T13:08:25Z"}, "committer": {"name": "Irina Popa", "email": "irinagpopa@gmail.com", "date": "2018-07-30T17:10:45Z"}, "message": "rustc_codegen_llvm: use safe references for ModuleBuffer.", "tree": {"sha": "96c019cc619c725b3dcd2857c9dbbf82c04de878", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/96c019cc619c725b3dcd2857c9dbbf82c04de878"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6", "html_url": "https://github.com/rust-lang/rust/commit/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6/comments", "author": {"login": "irinagpopa", "id": 32459019, "node_id": "MDQ6VXNlcjMyNDU5MDE5", "avatar_url": "https://avatars.githubusercontent.com/u/32459019?v=4", "gravatar_id": "", "url": "https://api.github.com/users/irinagpopa", "html_url": "https://github.com/irinagpopa", "followers_url": "https://api.github.com/users/irinagpopa/followers", "following_url": "https://api.github.com/users/irinagpopa/following{/other_user}", "gists_url": "https://api.github.com/users/irinagpopa/gists{/gist_id}", "starred_url": "https://api.github.com/users/irinagpopa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/irinagpopa/subscriptions", "organizations_url": "https://api.github.com/users/irinagpopa/orgs", "repos_url": "https://api.github.com/users/irinagpopa/repos", "events_url": "https://api.github.com/users/irinagpopa/events{/privacy}", "received_events_url": "https://api.github.com/users/irinagpopa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "irinagpopa", "id": 32459019, "node_id": "MDQ6VXNlcjMyNDU5MDE5", "avatar_url": "https://avatars.githubusercontent.com/u/32459019?v=4", "gravatar_id": "", "url": "https://api.github.com/users/irinagpopa", "html_url": "https://github.com/irinagpopa", "followers_url": "https://api.github.com/users/irinagpopa/followers", "following_url": "https://api.github.com/users/irinagpopa/following{/other_user}", "gists_url": "https://api.github.com/users/irinagpopa/gists{/gist_id}", "starred_url": "https://api.github.com/users/irinagpopa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/irinagpopa/subscriptions", "organizations_url": "https://api.github.com/users/irinagpopa/orgs", "repos_url": "https://api.github.com/users/irinagpopa/repos", "events_url": "https://api.github.com/users/irinagpopa/events{/privacy}", "received_events_url": "https://api.github.com/users/irinagpopa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b643e5144e1109bca5e16f85919d66bc53e88325", "url": "https://api.github.com/repos/rust-lang/rust/commits/b643e5144e1109bca5e16f85919d66bc53e88325", "html_url": "https://github.com/rust-lang/rust/commit/b643e5144e1109bca5e16f85919d66bc53e88325"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "27a8b5c1d0778689e1187c4e51522fe570ebe98d", "filename": "src/librustc_codegen_llvm/back/lto.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs?ref=ab4f93c7420e34f172b617c0a3dd4d6579d0edb6", "patch": "@@ -527,7 +527,7 @@ impl SerializedModule {\n     }\n }\n \n-pub struct ModuleBuffer(*mut llvm::ModuleBuffer);\n+pub struct ModuleBuffer(&'static mut llvm::ModuleBuffer);\n \n unsafe impl Send for ModuleBuffer {}\n unsafe impl Sync for ModuleBuffer {}\n@@ -550,7 +550,7 @@ impl ModuleBuffer {\n \n impl Drop for ModuleBuffer {\n     fn drop(&mut self) {\n-        unsafe { llvm::LLVMRustModuleBufferFree(self.0); }\n+        unsafe { llvm::LLVMRustModuleBufferFree(&mut *(self.0 as *mut _)); }\n     }\n }\n "}, {"sha": "6f849e65b2eb9263fb9e3b3a4feeb48b333efe87", "filename": "src/librustc_codegen_llvm/llvm/ffi.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab4f93c7420e34f172b617c0a3dd4d6579d0edb6/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs?ref=ab4f93c7420e34f172b617c0a3dd4d6579d0edb6", "patch": "@@ -1563,10 +1563,10 @@ extern \"C\" {\n     pub fn LLVMRustSetComdat(M: &'a Module, V: &'a Value, Name: *const c_char);\n     pub fn LLVMRustUnsetComdat(V: &Value);\n     pub fn LLVMRustSetModulePIELevel(M: &Module);\n-    pub fn LLVMRustModuleBufferCreate(M: &Module) -> *mut ModuleBuffer;\n-    pub fn LLVMRustModuleBufferPtr(p: *const ModuleBuffer) -> *const u8;\n-    pub fn LLVMRustModuleBufferLen(p: *const ModuleBuffer) -> usize;\n-    pub fn LLVMRustModuleBufferFree(p: *mut ModuleBuffer);\n+    pub fn LLVMRustModuleBufferCreate(M: &Module) -> &'static mut ModuleBuffer;\n+    pub fn LLVMRustModuleBufferPtr(p: &ModuleBuffer) -> *const u8;\n+    pub fn LLVMRustModuleBufferLen(p: &ModuleBuffer) -> usize;\n+    pub fn LLVMRustModuleBufferFree(p: &'static mut ModuleBuffer);\n     pub fn LLVMRustModuleCost(M: &Module) -> u64;\n \n     pub fn LLVMRustThinLTOAvailable() -> bool;"}]}