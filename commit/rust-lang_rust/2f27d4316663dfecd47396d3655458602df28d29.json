{"sha": "2f27d4316663dfecd47396d3655458602df28d29", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmMjdkNDMxNjY2M2RmZWNkNDczOTZkMzY1NTQ1ODYwMmRmMjhkMjk=", "commit": {"author": {"name": "Jed Davis", "email": "jld@panix.com", "date": "2013-03-14T06:28:12Z"}, "committer": {"name": "Jed Davis", "email": "jld@panix.com", "date": "2013-07-02T16:27:11Z"}, "message": "GC static_size_of_enum, which was unused", "tree": {"sha": "ee5ff9dcdd304d181a691826195af16d91e80b43", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ee5ff9dcdd304d181a691826195af16d91e80b43"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f27d4316663dfecd47396d3655458602df28d29", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f27d4316663dfecd47396d3655458602df28d29", "html_url": "https://github.com/rust-lang/rust/commit/2f27d4316663dfecd47396d3655458602df28d29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f27d4316663dfecd47396d3655458602df28d29/comments", "author": {"login": "jld", "id": 254973, "node_id": "MDQ6VXNlcjI1NDk3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/254973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jld", "html_url": "https://github.com/jld", "followers_url": "https://api.github.com/users/jld/followers", "following_url": "https://api.github.com/users/jld/following{/other_user}", "gists_url": "https://api.github.com/users/jld/gists{/gist_id}", "starred_url": "https://api.github.com/users/jld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jld/subscriptions", "organizations_url": "https://api.github.com/users/jld/orgs", "repos_url": "https://api.github.com/users/jld/repos", "events_url": "https://api.github.com/users/jld/events{/privacy}", "received_events_url": "https://api.github.com/users/jld/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jld", "id": 254973, "node_id": "MDQ6VXNlcjI1NDk3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/254973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jld", "html_url": "https://github.com/jld", "followers_url": "https://api.github.com/users/jld/followers", "following_url": "https://api.github.com/users/jld/following{/other_user}", "gists_url": "https://api.github.com/users/jld/gists{/gist_id}", "starred_url": "https://api.github.com/users/jld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jld/subscriptions", "organizations_url": "https://api.github.com/users/jld/orgs", "repos_url": "https://api.github.com/users/jld/repos", "events_url": "https://api.github.com/users/jld/events{/privacy}", "received_events_url": "https://api.github.com/users/jld/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "451c94343f2c49cfcc790816fd8587bfdc7ecfb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/451c94343f2c49cfcc790816fd8587bfdc7ecfb8", "html_url": "https://github.com/rust-lang/rust/commit/451c94343f2c49cfcc790816fd8587bfdc7ecfb8"}], "stats": {"total": 45, "additions": 1, "deletions": 44}, "files": [{"sha": "2cd313ff4315447ad062e83515297f2bce70f8d3", "filename": "src/librustc/middle/trans/machine.rs", "status": "modified", "additions": 0, "deletions": 42, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/2f27d4316663dfecd47396d3655458602df28d29/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmachine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f27d4316663dfecd47396d3655458602df28d29/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmachine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmachine.rs?ref=2f27d4316663dfecd47396d3655458602df28d29", "patch": "@@ -14,9 +14,6 @@ use lib::llvm::{ValueRef};\n use lib::llvm::False;\n use lib::llvm::llvm;\n use middle::trans::common::*;\n-use middle::trans::type_of;\n-use middle::ty;\n-use util::ppaux::ty_to_str;\n \n use middle::trans::type_::Type;\n \n@@ -116,42 +113,3 @@ pub fn llalign_of(cx: &CrateContext, ty: Type) -> ValueRef {\n             llvm::LLVMAlignOf(ty.to_ref()), cx.int_type.to_ref(), False);\n     }\n }\n-\n-// Computes the size of the data part of an enum.\n-pub fn static_size_of_enum(cx: &mut CrateContext, t: ty::t) -> uint {\n-    if cx.enum_sizes.contains_key(&t) {\n-        return cx.enum_sizes.get_copy(&t);\n-    }\n-\n-    debug!(\"static_size_of_enum %s\", ty_to_str(cx.tcx, t));\n-\n-    match ty::get(t).sty {\n-        ty::ty_enum(tid, ref substs) => {\n-            // Compute max(variant sizes).\n-            let mut max_size = 0;\n-            let variants = ty::enum_variants(cx.tcx, tid);\n-            for variants.iter().advance |variant| {\n-                if variant.args.len() == 0 {\n-                    loop;\n-                }\n-\n-                let lltypes = variant.args.map(|&variant_arg| {\n-                    let substituted = ty::subst(cx.tcx, substs, variant_arg);\n-                    type_of::sizing_type_of(cx, substituted)\n-                });\n-\n-                debug!(\"static_size_of_enum: variant %s type %s\",\n-                       cx.tcx.sess.str_of(variant.name),\n-                       cx.tn.type_to_str(Type::struct_(lltypes, false)));\n-\n-                let this_size = llsize_of_real(cx, Type::struct_(lltypes, false));\n-                if max_size < this_size {\n-                    max_size = this_size;\n-                }\n-            }\n-            cx.enum_sizes.insert(t, max_size);\n-            return max_size;\n-        }\n-        _ => cx.sess.bug(\"static_size_of_enum called on non-enum\")\n-    }\n-}"}, {"sha": "47ce0b7c22801291bd040646c5223a095eb7fc5a", "filename": "src/librustc/middle/trans/type_of.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2f27d4316663dfecd47396d3655458602df28d29/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f27d4316663dfecd47396d3655458602df28d29/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_of.rs?ref=2f27d4316663dfecd47396d3655458602df28d29", "patch": "@@ -104,8 +104,7 @@ pub fn type_of_non_gc_box(cx: &mut CrateContext, t: ty::t) -> Type {\n //\n // (2) It won't make any recursive calls to determine the structure of the\n //     type behind pointers. This can help prevent infinite loops for\n-//     recursive types. For example, `static_size_of_enum()` relies on this\n-//     behavior.\n+//     recursive types. For example, enum types rely on this behavior.\n \n pub fn sizing_type_of(cx: &mut CrateContext, t: ty::t) -> Type {\n     match cx.llsizingtypes.find_copy(&t) {"}]}