{"sha": "3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlNGM3Nzg2ZTlhMjUyMzkzMDgyOTBlYTZiODJiYzZmZmJhNjZiY2M=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-15T00:29:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-15T00:29:46Z"}, "message": "Rollup merge of #64471 - Mark-Simulacrum:warn-depr-attr, r=Centril\n\nWarn on no_start, crate_id attribute use\n\nThese attributes are now deprecated; they don't have any use anymore.\n\n`no_start` stopped being applicable in 3ee916e50bd86768cb2a9141f9b2c52d2601b412 as part of #18967. Ideally we would've removed it pre-1.0, but since that didn't happen let's at least mark it deprecated.\n\n`crate_id` was renamed to `crate_name` in 50ee1ec1b4f107122d8037ac7b0b312afa6eb0ac as part of #15319. Ideally we would've followed that up with a removal of crate_id itself as well, but that didn't happen; this PR finally marks it as deprecated at least.\n\nFixes https://github.com/rust-lang/rust/issues/43142 and resolves https://github.com/rust-lang/rust/issues/43144.", "tree": {"sha": "b0fde921597d3975324eaa2e90448b0c163ae029", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0fde921597d3975324eaa2e90448b0c163ae029"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdfYX6CRBK7hj4Ov3rIwAAdHIIABW/b28OIjHMADlb3k7g09bI\nnMJUJB9nsbGPvwIeNKudoQUYTeRh7vu+5zIYrJOkCqg112LbC2uAcnzymJGB7ViH\n+NyPsRqCT9AUXfgCWA7SJYYygOEJIH6XMMhvzBbXdGv5DXUz/vZACBj9j3hTacVl\nAO/Z6E2oNV9a9KcdIFZoQA/uqi0k133svmwSUBzCtHVy5zfgyV6sfl7VnxTCmIVN\naWtL1oZKIPZVG0RRHVoHV7SYmU4gC/cDkZlwG37w3u8qXDBuISWAtTq4XDF74OCg\nm3/y4RLdDjiq6N7+x6DXFPTKgdBT/WatvbTrjX3N48bIJptEufqj8yxvY2rABMg=\n=GNzW\n-----END PGP SIGNATURE-----\n", "payload": "tree b0fde921597d3975324eaa2e90448b0c163ae029\nparent 17798939f2fed1112b8db57232990150013d6b83\nparent a0e48b6d256368574aa130c55851ec18746d98a3\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1568507386 +0200\ncommitter GitHub <noreply@github.com> 1568507386 +0200\n\nRollup merge of #64471 - Mark-Simulacrum:warn-depr-attr, r=Centril\n\nWarn on no_start, crate_id attribute use\n\nThese attributes are now deprecated; they don't have any use anymore.\n\n`no_start` stopped being applicable in 3ee916e50bd86768cb2a9141f9b2c52d2601b412 as part of #18967. Ideally we would've removed it pre-1.0, but since that didn't happen let's at least mark it deprecated.\n\n`crate_id` was renamed to `crate_name` in 50ee1ec1b4f107122d8037ac7b0b312afa6eb0ac as part of #15319. Ideally we would've followed that up with a removal of crate_id itself as well, but that didn't happen; this PR finally marks it as deprecated at least.\n\nFixes https://github.com/rust-lang/rust/issues/43142 and resolves https://github.com/rust-lang/rust/issues/43144.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "html_url": "https://github.com/rust-lang/rust/commit/3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "17798939f2fed1112b8db57232990150013d6b83", "url": "https://api.github.com/repos/rust-lang/rust/commits/17798939f2fed1112b8db57232990150013d6b83", "html_url": "https://github.com/rust-lang/rust/commit/17798939f2fed1112b8db57232990150013d6b83"}, {"sha": "a0e48b6d256368574aa130c55851ec18746d98a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/a0e48b6d256368574aa130c55851ec18746d98a3", "html_url": "https://github.com/rust-lang/rust/commit/a0e48b6d256368574aa130c55851ec18746d98a3"}], "stats": {"total": 52, "additions": 37, "deletions": 15}, "files": [{"sha": "cf19a9eb147a8c1560bfa9d860a9d3cb58f6990f", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 21, "deletions": 8, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "patch": "@@ -669,6 +669,22 @@ impl DeprecatedAttr {\n     }\n }\n \n+fn lint_deprecated_attr(\n+    cx: &EarlyContext<'_>,\n+    attr: &ast::Attribute,\n+    msg: &str,\n+    suggestion: Option<&str>,\n+) {\n+    cx.struct_span_lint(DEPRECATED, attr.span, &msg)\n+        .span_suggestion_short(\n+            attr.span,\n+            suggestion.unwrap_or(\"remove this attribute\"),\n+            String::new(),\n+            Applicability::MachineApplicable\n+        )\n+        .emit();\n+}\n+\n impl EarlyLintPass for DeprecatedAttr {\n     fn check_attribute(&mut self, cx: &EarlyContext<'_>, attr: &ast::Attribute) {\n         for &&(n, _, _, ref g) in &self.depr_attrs {\n@@ -679,18 +695,15 @@ impl EarlyLintPass for DeprecatedAttr {\n                                              _) = g {\n                     let msg = format!(\"use of deprecated attribute `{}`: {}. See {}\",\n                                       name, reason, link);\n-                    let mut err = cx.struct_span_lint(DEPRECATED, attr.span, &msg);\n-                    err.span_suggestion_short(\n-                        attr.span,\n-                        suggestion.unwrap_or(\"remove this attribute\"),\n-                        String::new(),\n-                        Applicability::MachineApplicable\n-                    );\n-                    err.emit();\n+                    lint_deprecated_attr(cx, attr, &msg, suggestion);\n                 }\n                 return;\n             }\n         }\n+        if attr.check_name(sym::no_start) || attr.check_name(sym::crate_id) {\n+            let msg = format!(\"use of deprecated attribute `{}`: no longer used.\", attr.path);\n+            lint_deprecated_attr(cx, attr, &msg, None);\n+        }\n     }\n }\n "}, {"sha": "79cd0f5fbc358d62626cf332b6629fccf67daeb9", "filename": "src/test/ui/attributes/item-attributes.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Fattributes%2Fitem-attributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Fattributes%2Fitem-attributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fitem-attributes.rs?ref=3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "patch": "@@ -11,8 +11,6 @@\n #![rustc_dummy]\n #![rustc_dummy(attr5)]\n \n-#![crate_id=\"foobar#0.1\"]\n-\n // These are attributes of the following mod\n #[rustc_dummy = \"val\"]\n #[rustc_dummy = \"val\"]"}, {"sha": "68ff95e420895159f2daf9c957b74041e2e0bc63", "filename": "src/test/ui/feature-gate/issue-43106-gating-of-builtin-attrs.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.rs?ref=3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "patch": "@@ -84,12 +84,12 @@\n #![crate_name = \"0900\"]\n #![crate_type = \"bin\"] // cannot pass \"0800\" here\n \n-// For #![crate_id], see issue #43142. (I cannot bear to enshrine current behavior in a test)\n+#![crate_id = \"10\"] //~ WARN use of deprecated attribute\n \n // FIXME(#44232) we should warn that this isn't used.\n #![feature(rust1)]\n \n-// For #![no_start], see issue #43144. (I cannot bear to enshrine current behavior in a test)\n+#![no_start] //~ WARN use of deprecated attribute\n \n // (cannot easily gating state of crate-level #[no_main]; but non crate-level is below at \"0400\")\n #![no_builtins]"}, {"sha": "b2a6018b5354d145970352633e826e321034fab8", "filename": "src/test/ui/feature-gate/issue-43106-gating-of-builtin-attrs.stderr", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.stderr?ref=3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "patch": "@@ -186,6 +186,20 @@ LL |     mod inner { #![macro_escape] }\n    |\n    = help: consider an outer attribute, `#[macro_use]` mod ...\n \n+warning: use of deprecated attribute `crate_id`: no longer used.\n+  --> $DIR/issue-43106-gating-of-builtin-attrs.rs:87:1\n+   |\n+LL | #![crate_id = \"10\"]\n+   | ^^^^^^^^^^^^^^^^^^^ help: remove this attribute\n+   |\n+   = note: `#[warn(deprecated)]` on by default\n+\n+warning: use of deprecated attribute `no_start`: no longer used.\n+  --> $DIR/issue-43106-gating-of-builtin-attrs.rs:92:1\n+   |\n+LL | #![no_start]\n+   | ^^^^^^^^^^^^ help: remove this attribute\n+\n warning: the feature `rust1` has been stable since 1.0.0 and no longer requires an attribute to enable\n   --> $DIR/issue-43106-gating-of-builtin-attrs.rs:90:12\n    |"}, {"sha": "77278ecda6ecb1d20ed85df56c21e991733d85d6", "filename": "src/test/ui/issues/issue-1251.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Fissues%2Fissue-1251.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Fissues%2Fissue-1251.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-1251.rs?ref=3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "patch": "@@ -6,8 +6,6 @@\n \n #![feature(rustc_private)]\n \n-#![crate_id=\"rust_get_test_int\"]\n-\n mod rustrt {\n     extern crate libc;\n "}, {"sha": "6f1e1f97708efd41a9c68f09f1a87a7727c7a435", "filename": "src/test/ui/issues/issue-6919.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Fissues%2Fissue-6919.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e4c7786e9a25239308290ea6b82bc6ffba66bcc/src%2Ftest%2Fui%2Fissues%2Fissue-6919.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-6919.rs?ref=3e4c7786e9a25239308290ea6b82bc6ffba66bcc", "patch": "@@ -4,7 +4,6 @@\n \n // pretty-expanded FIXME #23616\n \n-#![crate_id=\"issue-6919\"]\n extern crate issue6919_3;\n \n pub fn main() {"}]}