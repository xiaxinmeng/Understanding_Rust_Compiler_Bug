{"sha": "63e63218a123bbda1ed47cbe5e8bac62b7e48e97", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYzZTYzMjE4YTEyM2JiZGExZWQ0N2NiZTVlOGJhYzYyYjdlNDhlOTc=", "commit": {"author": {"name": "Michael Sproul", "email": "micsproul@gmail.com", "date": "2015-04-30T07:32:20Z"}, "committer": {"name": "Michael Sproul", "email": "micsproul@gmail.com", "date": "2015-04-30T10:24:30Z"}, "message": "Add long diagnostics for enum repr errors.", "tree": {"sha": "edf966010605114bfa793ca126d91f12d9b601cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/edf966010605114bfa793ca126d91f12d9b601cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/63e63218a123bbda1ed47cbe5e8bac62b7e48e97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/63e63218a123bbda1ed47cbe5e8bac62b7e48e97", "html_url": "https://github.com/rust-lang/rust/commit/63e63218a123bbda1ed47cbe5e8bac62b7e48e97", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/63e63218a123bbda1ed47cbe5e8bac62b7e48e97/comments", "author": {"login": "michaelsproul", "id": 4452260, "node_id": "MDQ6VXNlcjQ0NTIyNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelsproul", "html_url": "https://github.com/michaelsproul", "followers_url": "https://api.github.com/users/michaelsproul/followers", "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}", "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions", "organizations_url": "https://api.github.com/users/michaelsproul/orgs", "repos_url": "https://api.github.com/users/michaelsproul/repos", "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelsproul/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelsproul", "id": 4452260, "node_id": "MDQ6VXNlcjQ0NTIyNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelsproul", "html_url": "https://github.com/michaelsproul", "followers_url": "https://api.github.com/users/michaelsproul/followers", "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}", "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions", "organizations_url": "https://api.github.com/users/michaelsproul/orgs", "repos_url": "https://api.github.com/users/michaelsproul/repos", "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelsproul/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0bd14f7b15b978f8bf32bb368f63faa0f26c02e", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0bd14f7b15b978f8bf32bb368f63faa0f26c02e", "html_url": "https://github.com/rust-lang/rust/commit/f0bd14f7b15b978f8bf32bb368f63faa0f26c02e"}], "stats": {"total": 114, "additions": 107, "deletions": 7}, "files": [{"sha": "7e4f97ca698c5b565c23ed9b8ebc4459ac9c820b", "filename": "src/librustc/diagnostics.rs", "status": "modified", "additions": 25, "deletions": 2, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/63e63218a123bbda1ed47cbe5e8bac62b7e48e97/src%2Flibrustc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63e63218a123bbda1ed47cbe5e8bac62b7e48e97/src%2Flibrustc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdiagnostics.rs?ref=63e63218a123bbda1ed47cbe5e8bac62b7e48e97", "patch": "@@ -221,6 +221,31 @@ This error indicates that an attempt was made to divide by zero (or take the\n remainder of a zero divisor) in a static or constant expression.\n \"##,\n \n+E0079: r##\"\n+Enum variants which contain no data can be given a custom integer\n+representation. This error indicates that the value provided is not an\n+integer literal and is therefore invalid.\n+\"##,\n+\n+E0080: r##\"\n+This error indicates that the compiler was unable to sensibly evaluate an\n+integer expression provided as an enum discriminant. Attempting to divide by 0\n+or causing integer overflow are two ways to induce this error. For example:\n+\n+```\n+enum Enum {\n+    X = (1 << 500),\n+    Y = (1 / 0)\n+}\n+```\n+\n+Ensure that the expressions given can be evaluated as the desired integer type.\n+See the FFI section of the Reference for more information about using a custom\n+integer type:\n+\n+http://doc.rust-lang.org/reference.html#ffi-attributes\n+\"##,\n+\n E0133: r##\"\n Using unsafe functionality, such as dereferencing raw pointers and calling\n functions via FFI or marked as unsafe, is potentially dangerous and disallowed\n@@ -502,8 +527,6 @@ register_diagnostics! {\n     E0017,\n     E0019,\n     E0022,\n-    E0079, // enum variant: expected signed integer constant\n-    E0080, // enum variant: constant evaluation error\n     E0109,\n     E0110,\n     E0134,"}, {"sha": "5f9e282bc53fe51b8a32ac9838774e6975dae2f7", "filename": "src/librustc/middle/ty.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/63e63218a123bbda1ed47cbe5e8bac62b7e48e97/src%2Flibrustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63e63218a123bbda1ed47cbe5e8bac62b7e48e97/src%2Flibrustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty.rs?ref=63e63218a123bbda1ed47cbe5e8bac62b7e48e97", "patch": "@@ -5732,8 +5732,10 @@ fn compute_enum_variants<'tcx>(cx: &ctxt<'tcx>,\n                     Ok(const_eval::const_int(val)) => current_disr_val = val as Disr,\n                     Ok(const_eval::const_uint(val)) => current_disr_val = val as Disr,\n                     Ok(_) => {\n+                        let sign_desc = if repr_type.is_signed() { \"signed\" } else { \"unsigned\" };\n                         span_err!(cx.sess, e.span, E0079,\n-                                  \"expected signed integer constant\");\n+                                  \"expected {} integer constant\",\n+                                  sign_desc);\n                         current_disr_val = attempt_fresh_value();\n                     }\n                     Err(ref err) => {"}, {"sha": "154d824e67846e83c214157542c7dc0772f414c6", "filename": "src/librustc_typeck/diagnostics.rs", "status": "modified", "additions": 79, "deletions": 4, "changes": 83, "blob_url": "https://github.com/rust-lang/rust/blob/63e63218a123bbda1ed47cbe5e8bac62b7e48e97/src%2Flibrustc_typeck%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63e63218a123bbda1ed47cbe5e8bac62b7e48e97/src%2Flibrustc_typeck%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fdiagnostics.rs?ref=63e63218a123bbda1ed47cbe5e8bac62b7e48e97", "patch": "@@ -10,6 +10,85 @@\n \n #![allow(non_snake_case)]\n \n+register_long_diagnostics! {\n+\n+E0081: r##\"\n+Enum discriminants are used to differentiate enum variants stored in memory.\n+This error indicates that the same value was used for two or more variants,\n+making them impossible to tell apart.\n+\n+```\n+// Good.\n+enum Enum {\n+    P,\n+    X = 3,\n+    Y = 5\n+}\n+\n+// Bad.\n+enum Enum {\n+    P = 3,\n+    X = 3,\n+    Y = 5\n+}\n+```\n+\n+Note that variants without a manually specified discriminant are numbered from\n+top to bottom starting from 0, so clashes can occur with seemingly unrelated\n+variants.\n+\n+```\n+enum Bad {\n+    X,\n+    Y = 0\n+}\n+```\n+\n+Here `X` will have already been assigned the discriminant 0 by the time `Y` is\n+encountered, so a conflict occurs.\n+\"##,\n+\n+E0082: r##\"\n+The default type for enum discriminants is `isize`, but it can be adjusted by\n+adding the `repr` attribute to the enum declaration. This error indicates that\n+an integer literal given as a discriminant is not a member of the discriminant\n+type. For example:\n+\n+```\n+#[repr(u8)]\n+enum Thing {\n+    A = 1024,\n+    B = 5\n+}\n+```\n+\n+Here, 1024 lies outside the valid range for `u8`, so the discriminant for `A` is\n+invalid. You may want to change representation types to fix this, or else change\n+invalid discriminant values so that they fit within the existing type.\n+\n+Note also that without a representation manually defined, the compiler will\n+optimize by using the smallest integer type possible.\n+\"##,\n+\n+E0083: r##\"\n+At present, it's not possible to define a custom representation for an enum with\n+a single variant. As a workaround you can add a `Dummy` variant.\n+\n+See: https://github.com/rust-lang/rust/issues/10292\n+\"##,\n+\n+E0084: r##\"\n+It is impossible to define an integer type to be used to represent zero-variant\n+enum values because there are no zero-variant enum values. There is no way to\n+construct an instance of the following type using only safe code:\n+\n+```\n+enum Empty {}\n+```\n+\"##\n+\n+}\n+\n register_diagnostics! {\n     E0023,\n     E0024,\n@@ -51,10 +130,6 @@ register_diagnostics! {\n     E0075,\n     E0076,\n     E0077,\n-    E0081,\n-    E0082,\n-    E0083,\n-    E0084,\n     E0085,\n     E0086,\n     E0087,"}]}