{"sha": "0f73133be6a6915e2d5836ce9986eaffc1b2954d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmNzMxMzNiZTZhNjkxNWUyZDU4MzZjZTk5ODZlYWZmYzFiMjk1NGQ=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-02-04T01:58:28Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-02-04T02:00:14Z"}, "message": "Suggest `split_at_mut` on multiple mutable index access", "tree": {"sha": "1e3d7407c8fed2ab2606758d19d6208527c3b49c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e3d7407c8fed2ab2606758d19d6208527c3b49c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f73133be6a6915e2d5836ce9986eaffc1b2954d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f73133be6a6915e2d5836ce9986eaffc1b2954d", "html_url": "https://github.com/rust-lang/rust/commit/0f73133be6a6915e2d5836ce9986eaffc1b2954d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f73133be6a6915e2d5836ce9986eaffc1b2954d/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "994e5e74653ae4bfe51094ce487a8b63f30ad3a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/994e5e74653ae4bfe51094ce487a8b63f30ad3a4", "html_url": "https://github.com/rust-lang/rust/commit/994e5e74653ae4bfe51094ce487a8b63f30ad3a4"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "67254cd0c48420ee75dc18e9223a97605427a432", "filename": "src/librustc_mir/borrow_check/diagnostics/conflict_errors.rs", "status": "modified", "additions": 25, "deletions": 2, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/0f73133be6a6915e2d5836ce9986eaffc1b2954d/src%2Flibrustc_mir%2Fborrow_check%2Fdiagnostics%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f73133be6a6915e2d5836ce9986eaffc1b2954d/src%2Flibrustc_mir%2Fborrow_check%2Fdiagnostics%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fdiagnostics%2Fconflict_errors.rs?ref=0f73133be6a6915e2d5836ce9986eaffc1b2954d", "patch": "@@ -395,14 +395,20 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n \n             (BorrowKind::Mut { .. }, BorrowKind::Mut { .. }) => {\n                 first_borrow_desc = \"first \";\n-                self.cannot_mutably_borrow_multiply(\n+                let mut err = self.cannot_mutably_borrow_multiply(\n                     span,\n                     &desc_place,\n                     &msg_place,\n                     issued_span,\n                     &msg_borrow,\n                     None,\n-                )\n+                );\n+                self.suggest_split_at_mut_if_applicable(\n+                    &mut err,\n+                    &place,\n+                    &issued_borrow.borrowed_place,\n+                );\n+                err\n             }\n \n             (BorrowKind::Unique, BorrowKind::Unique) => {\n@@ -547,6 +553,23 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n         err\n     }\n \n+    fn suggest_split_at_mut_if_applicable(\n+        &self,\n+        err: &mut DiagnosticBuilder<'_>,\n+        place: &Place<'tcx>,\n+        borrowed_place: &Place<'tcx>,\n+    ) {\n+        match (&place.projection[..], &borrowed_place.projection[..]) {\n+            ([ProjectionElem::Index(_)], [ProjectionElem::Index(_)]) => {\n+                err.help(\n+                    \"consider using `.split_at_mut(position)` or similar method to obtain \\\n+                     two mutable non-overlapping sub-slices\",\n+                );\n+            }\n+            _ => {}\n+        }\n+    }\n+\n     /// Returns the description of the root place for a conflicting borrow and the full\n     /// descriptions of the places that caused the conflict.\n     ///"}, {"sha": "d294c20b8240eacdc5511728120c9c153f2c0a5a", "filename": "src/test/ui/suggestions/suggest-split-at-mut.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0f73133be6a6915e2d5836ce9986eaffc1b2954d/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-split-at-mut.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f73133be6a6915e2d5836ce9986eaffc1b2954d/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-split-at-mut.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-split-at-mut.rs?ref=0f73133be6a6915e2d5836ce9986eaffc1b2954d", "patch": "@@ -0,0 +1,8 @@\n+fn main() {\n+    let mut foo = [1, 2, 3, 4];\n+    let a = &mut foo[2];\n+    let b = &mut foo[3]; //~ ERROR cannot borrow `foo[_]` as mutable more than once at a time\n+    *a = 5;\n+    *b = 6;\n+    println!(\"{:?} {:?}\", a, b);\n+}"}, {"sha": "330f012b2a9be2dabc367f980fa0b6f0b9e11191", "filename": "src/test/ui/suggestions/suggest-split-at-mut.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/0f73133be6a6915e2d5836ce9986eaffc1b2954d/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-split-at-mut.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0f73133be6a6915e2d5836ce9986eaffc1b2954d/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-split-at-mut.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-split-at-mut.stderr?ref=0f73133be6a6915e2d5836ce9986eaffc1b2954d", "patch": "@@ -0,0 +1,15 @@\n+error[E0499]: cannot borrow `foo[_]` as mutable more than once at a time\n+  --> $DIR/suggest-split-at-mut.rs:4:13\n+   |\n+LL |     let a = &mut foo[2];\n+   |             ----------- first mutable borrow occurs here\n+LL |     let b = &mut foo[3];\n+   |             ^^^^^^^^^^^ second mutable borrow occurs here\n+LL |     *a = 5;\n+   |     ------ first borrow later used here\n+   |\n+   = help: consider using `.split_at_mut(position)` or similar method to obtain two mutable non-overlapping sub-slices\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0499`."}]}