{"sha": "6fe2c24be0ec916abeb4875e424d82531706e812", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmZTJjMjRiZTBlYzkxNmFiZWI0ODc1ZTQyNGQ4MjUzMTcwNmU4MTI=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2017-04-27T23:59:17Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-04-27T23:59:17Z"}, "message": "Rollup merge of #41572 - frewsxcv:bump-mdbook, r=steveklabnik\n\nBump mdbook dep to pick up new 'create missing' toggle feature.\n\nThis will avoid obscure Travis CI error messages:\n\n* https://github.com/rust-lang/rust/pull/40290#issuecomment-294137045\n\nOriginal mdbook issue:\n\n* https://github.com/azerupi/mdBook/issues/253\n\nmdbook PR:\n\n* https://github.com/azerupi/mdBook/pull/254", "tree": {"sha": "315b8c196726e7ec729bd38d578e7e2b2cd6df97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/315b8c196726e7ec729bd38d578e7e2b2cd6df97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6fe2c24be0ec916abeb4875e424d82531706e812", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6fe2c24be0ec916abeb4875e424d82531706e812", "html_url": "https://github.com/rust-lang/rust/commit/6fe2c24be0ec916abeb4875e424d82531706e812", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6fe2c24be0ec916abeb4875e424d82531706e812/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f469c4a611c7984fece1aa38845c6cb0e580a933", "url": "https://api.github.com/repos/rust-lang/rust/commits/f469c4a611c7984fece1aa38845c6cb0e580a933", "html_url": "https://github.com/rust-lang/rust/commit/f469c4a611c7984fece1aa38845c6cb0e580a933"}, {"sha": "a517a961868dbd069ed7804a54e5bd7cb1d3f1e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/a517a961868dbd069ed7804a54e5bd7cb1d3f1e6", "html_url": "https://github.com/rust-lang/rust/commit/a517a961868dbd069ed7804a54e5bd7cb1d3f1e6"}], "stats": {"total": 27, "additions": 19, "deletions": 8}, "files": [{"sha": "659feef80a4b9a276d7554a01b92089733c82063", "filename": "src/Cargo.lock", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6fe2c24be0ec916abeb4875e424d82531706e812/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/6fe2c24be0ec916abeb4875e424d82531706e812/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=6fe2c24be0ec916abeb4875e424d82531706e812", "patch": "@@ -269,7 +269,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"mdbook\"\n-version = \"0.0.19\"\n+version = \"0.0.21\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"clap 2.22.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -425,7 +425,7 @@ name = \"rustbook\"\n version = \"0.1.0\"\n dependencies = [\n  \"clap 2.22.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"mdbook 0.0.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"mdbook 0.0.21 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1001,7 +1001,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum lazy_static 0.2.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4732c563b9a21a406565c4747daa7b46742f082911ae4753f390dc9ec7ee1a97\"\n \"checksum libc 0.2.21 (registry+https://github.com/rust-lang/crates.io-index)\" = \"88ee81885f9f04bff991e306fea7c1c60a5f0f9e409e99f6b40e3311a3363135\"\n \"checksum log 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5141eca02775a762cc6cd564d8d2c50f67c0ea3a372cbf1c51592b3e029e10ad\"\n-\"checksum mdbook 0.0.19 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2598843aeda0c5bb2e8e4d714564f1c3fc40f7844157e34563bf96ae3866b56e\"\n+\"checksum mdbook 0.0.21 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f1e2e9d848514dcfad4195788d0d42ae5153a477c191d75d5b84fab10f222fbd\"\n \"checksum memchr 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1dbccc0e46f1ea47b9f17e6d67c5a96bd27030519c519c9c91327e31275a47b4\"\n \"checksum num-traits 0.1.37 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e1cbfa3781f3fe73dc05321bed52a06d2d491eaa764c52335cf4399f046ece99\"\n \"checksum num_cpus 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ca313f1862c7ec3e0dfe8ace9fa91b1d9cb5c84ace3d00f5ec4216238e93c167\""}, {"sha": "2d5d163d4030533a56a0b848c93c8f510da87bfe", "filename": "src/tools/rustbook/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6fe2c24be0ec916abeb4875e424d82531706e812/src%2Ftools%2Frustbook%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/6fe2c24be0ec916abeb4875e424d82531706e812/src%2Ftools%2Frustbook%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustbook%2FCargo.toml?ref=6fe2c24be0ec916abeb4875e424d82531706e812", "patch": "@@ -8,5 +8,5 @@ license = \"MIT/Apache-2.0\"\n clap = \"2.19.3\"\n \n [dependencies.mdbook]\n-version = \"0.0.19\"\n+version = \"0.0.21\"\n default-features = false"}, {"sha": "33326de9c1cc3f630ac7c8672d76e1b18a816e2f", "filename": "src/tools/rustbook/src/main.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/6fe2c24be0ec916abeb4875e424d82531706e812/src%2Ftools%2Frustbook%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6fe2c24be0ec916abeb4875e424d82531706e812/src%2Ftools%2Frustbook%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustbook%2Fsrc%2Fmain.rs?ref=6fe2c24be0ec916abeb4875e424d82531706e812", "patch": "@@ -53,8 +53,7 @@ fn main() {\n \n // Build command implementation\n fn build(args: &ArgMatches) -> Result<(), Box<Error>> {\n-    let book_dir = get_book_dir(args);\n-    let book = MDBook::new(&book_dir).read_config();\n+    let book = build_mdbook_struct(args);\n \n     let mut book = match args.value_of(\"dest-dir\") {\n         Some(dest_dir) => book.set_dest(Path::new(dest_dir)),\n@@ -67,14 +66,26 @@ fn build(args: &ArgMatches) -> Result<(), Box<Error>> {\n }\n \n fn test(args: &ArgMatches) -> Result<(), Box<Error>> {\n-    let book_dir = get_book_dir(args);\n-    let mut book = MDBook::new(&book_dir).read_config();\n+    let mut book = build_mdbook_struct(args);\n \n     try!(book.test());\n \n     Ok(())\n }\n \n+fn build_mdbook_struct(args: &ArgMatches) -> mdbook::MDBook {\n+    let book_dir = get_book_dir(args);\n+    let mut book = MDBook::new(&book_dir).read_config();\n+\n+    // By default mdbook will attempt to create non-existent files referenced\n+    // from SUMMARY.md files. This is problematic on CI where we mount the\n+    // source directory as readonly. To avoid any issues, we'll disabled\n+    // mdbook's implicit file creation feature.\n+    book.create_missing = false;\n+\n+    book\n+}\n+\n fn get_book_dir(args: &ArgMatches) -> PathBuf {\n     if let Some(dir) = args.value_of(\"dir\") {\n         // Check if path is relative from current dir, or absolute..."}]}