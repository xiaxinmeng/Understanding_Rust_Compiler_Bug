{"sha": "657196830fd7fdc03eab87b8afa21601faf07975", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1NzE5NjgzMGZkN2ZkYzAzZWFiODdiOGFmYTIxNjAxZmFmMDc5NzU=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2017-08-10T16:17:42Z"}, "committer": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2017-08-13T00:15:43Z"}, "message": "Correct code to not run host-only tests.", "tree": {"sha": "183c45842b9a67864a2aede2ebe3ae39d14487eb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/183c45842b9a67864a2aede2ebe3ae39d14487eb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/657196830fd7fdc03eab87b8afa21601faf07975", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/657196830fd7fdc03eab87b8afa21601faf07975", "html_url": "https://github.com/rust-lang/rust/commit/657196830fd7fdc03eab87b8afa21601faf07975", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/657196830fd7fdc03eab87b8afa21601faf07975/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cec68167fd3787500194f261e2fcbb14381cd317", "url": "https://api.github.com/repos/rust-lang/rust/commits/cec68167fd3787500194f261e2fcbb14381cd317", "html_url": "https://github.com/rust-lang/rust/commit/cec68167fd3787500194f261e2fcbb14381cd317"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "db2c6dfeb9f74df1f6142da0d51f5e7bfc75638f", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/657196830fd7fdc03eab87b8afa21601faf07975/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/657196830fd7fdc03eab87b8afa21601faf07975/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=657196830fd7fdc03eab87b8afa21601faf07975", "patch": "@@ -127,9 +127,7 @@ impl StepDescription {\n \n         // Determine the targets participating in this rule.\n         let targets = if self.only_hosts {\n-            // If --target was specified but --host wasn't specified, don't run\n-            // any host-only tests.\n-            if build.config.hosts.is_empty() && !build.config.targets.is_empty() {\n+            if build.config.run_host_only {\n                 &[]\n             } else if self.only_build {\n                 build.build_triple()"}, {"sha": "aa688fc66e267831e71a7a3824720cdc8aa6ea8f", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/657196830fd7fdc03eab87b8afa21601faf07975/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/657196830fd7fdc03eab87b8afa21601faf07975/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=657196830fd7fdc03eab87b8afa21601faf07975", "patch": "@@ -56,6 +56,8 @@ pub struct Config {\n     pub profiler: bool,\n     pub ignore_git: bool,\n \n+    pub run_host_only: bool,\n+\n     pub on_fail: Option<String>,\n     pub stage: Option<u32>,\n     pub keep_stage: Option<u32>,\n@@ -305,6 +307,9 @@ impl Config {\n         config.incremental = flags.incremental;\n         config.keep_stage = flags.keep_stage;\n \n+        // If --target was specified but --host wasn't specified, don't run any host-only tests.\n+        config.run_host_only = flags.host.is_empty() && !flags.target.is_empty();\n+\n         let toml = file.map(|file| {\n             let mut f = t!(File::open(&file));\n             let mut contents = String::new();\n@@ -351,6 +356,7 @@ impl Config {\n             config.targets\n         };\n \n+\n         config.nodejs = build.nodejs.map(PathBuf::from);\n         config.gdb = build.gdb.map(PathBuf::from);\n         config.python = build.python.map(PathBuf::from);"}]}