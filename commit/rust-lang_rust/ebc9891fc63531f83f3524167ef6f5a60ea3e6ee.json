{"sha": "ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViYzk4OTFmYzYzNTMxZjgzZjM1MjQxNjdlZjZmNWE2MGVhM2U2ZWU=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2017-09-30T15:10:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-09-30T15:10:09Z"}, "message": "Merge pull request #1838 from rust-lang-nursery/fix-doc\n\nDon't lint autolinks in `doc_markdown`", "tree": {"sha": "4f9f7ab3aff9fec461329ed04c0c3d68530705e7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f9f7ab3aff9fec461329ed04c0c3d68530705e7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "html_url": "https://github.com/rust-lang/rust/commit/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1cf4672b49cf626e5ff4892e72fed48cf66caf2e", "url": "https://api.github.com/repos/rust-lang/rust/commits/1cf4672b49cf626e5ff4892e72fed48cf66caf2e", "html_url": "https://github.com/rust-lang/rust/commit/1cf4672b49cf626e5ff4892e72fed48cf66caf2e"}, {"sha": "aca6c1e06576b41f75da5b5faa682cdd3f17531e", "url": "https://api.github.com/repos/rust-lang/rust/commits/aca6c1e06576b41f75da5b5faa682cdd3f17531e", "html_url": "https://github.com/rust-lang/rust/commit/aca6c1e06576b41f75da5b5faa682cdd3f17531e"}], "stats": {"total": 99, "additions": 97, "deletions": 2}, "files": [{"sha": "1eed9fa4e9548334c4b5fa1e69f91239a94bba50", "filename": "Cargo.lock", "status": "modified", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "patch": "@@ -13,6 +13,7 @@ dependencies = [\n  \"serde_derive 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"toml 0.4.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicode-normalization 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"url 1.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -147,6 +148,16 @@ name = \"getopts\"\n version = \"0.2.15\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"idna\"\n+version = \"0.1.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"matches 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"unicode-bidi 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"unicode-normalization 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"itertools\"\n version = \"0.6.2\"\n@@ -228,6 +239,11 @@ dependencies = [\n  \"winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"percent-encoding\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"pulldown-cmark\"\n version = \"0.0.15\"\n@@ -367,6 +383,14 @@ dependencies = [\n  \"serde 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"unicode-bidi\"\n+version = \"0.3.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"matches 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"unicode-normalization\"\n version = \"0.1.5\"\n@@ -385,6 +409,16 @@ dependencies = [\n  \"void 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"url\"\n+version = \"1.5.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"idna 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"matches 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"percent-encoding 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"utf8-ranges\"\n version = \"1.0.0\"\n@@ -421,6 +455,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum either 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"18785c1ba806c258137c937e44ada9ee7e69a37e3c72077542cd2f069d78562a\"\n \"checksum error-chain 0.8.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6930e04918388a9a2e41d518c25cf679ccafe26733fb4127dbf21993f2575d46\"\n \"checksum getopts 0.2.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"65922871abd2f101a2eb0eaebadc66668e54a87ad9c3dd82520b5f86ede5eff9\"\n+\"checksum idna 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"014b298351066f1512874135335d62a789ffe78a9974f94b43ed5621951eaf7d\"\n \"checksum itertools 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"22c285d60139cf413244894189ca52debcfd70b57966feed060da76802e415a0\"\n \"checksum itoa 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8324a32baf01e2ae060e9de58ed0bc2320c9a2833491ee36cd3b4c414de4db8c\"\n \"checksum kernel32-sys 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7507624b29483431c0ba2d82aece8ca6cdba9382bff4ddd0f7490560c056098d\"\n@@ -433,6 +468,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum nix 0.8.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"47e49f6982987135c5e9620ab317623e723bd06738fd85377e8d55f57c8b6487\"\n \"checksum num-traits 0.1.40 (registry+https://github.com/rust-lang/crates.io-index)\" = \"99843c856d68d8b4313b03a17e33c4bb42ae8f6610ea81b28abe076ac721b9b0\"\n \"checksum os_pipe 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"998bfbb3042e715190fe2a41abfa047d7e8cb81374d2977d7f100eacd8619cb1\"\n+\"checksum percent-encoding 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"de154f638187706bde41d9b4738748933d64e6b37bdbffc0b47a97d16a6ae356\"\n \"checksum pulldown-cmark 0.0.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"378e941dbd392c101f2cb88097fa4d7167bc421d4b88de3ff7dbee503bc3233b\"\n \"checksum quine-mc_cluskey 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"07589615d719a60c8dd8a4622e7946465dfef20d1a428f969e3443e7386d5f45\"\n \"checksum quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7a6e920b65c65f10b2ae65c831a81a073a89edd28c7cce89475bff467ab4167a\"\n@@ -451,9 +487,11 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum synom 0.11.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a393066ed9010ebaed60b9eafa373d4b1baac186dd7e008555b0f702b51945b6\"\n \"checksum thread_local 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1697c4b57aeeb7a536b647165a2825faddffb1d3bad386d507709bd51a90bb14\"\n \"checksum toml 0.4.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a7540f4ffc193e0d3c94121edb19b055670d369f77d5804db11ae053a45b6e7e\"\n+\"checksum unicode-bidi 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"49f2bd0c6468a8230e1db229cff8029217cf623c767ea5d60bfbd42729ea54d5\"\n \"checksum unicode-normalization 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"51ccda9ef9efa3f7ef5d91e8f9b83bbe6955f9bf86aec89d5cce2c874625920f\"\n \"checksum unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8c1f860d7d29cf02cb2f3f359fd35991af3d30bac52c57d265a3c461074cb4dc\"\n \"checksum unreachable 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"382810877fe448991dfc7f0dd6e3ae5d58088fd0ea5e35189655f84e6814fa56\"\n+\"checksum url 1.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eeb819346883532a271eb626deb43c4a1bb4c4dd47c519bd78137c3e72a4fe27\"\n \"checksum utf8-ranges 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"662fab6525a98beff2921d7f61a39e7d59e0b425ebc7d0d9e66d316e55124122\"\n \"checksum void 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6a02e4885ed3bc0f2de90ea6dd45ebcbb66dacffe03547fadbb0eeae2770887d\"\n \"checksum winapi 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"167dc9d6949a9b857f3451275e911c3f44255842c1f7a76f33c55103a909087a\""}, {"sha": "9c78514285d4e21e694a2a68425b29d0e49b0bcd", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "patch": "@@ -28,6 +28,7 @@ serde_derive = \"1.0\"\n toml = \"0.4\"\n unicode-normalization = \"0.1\"\n pulldown-cmark = \"0.0.15\"\n+url = \"1.5.0\"\n \n [features]\n debugging = []"}, {"sha": "3162dbc422bdbb8179a8717f0e745a23981fd718", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "patch": "@@ -5,6 +5,7 @@ use syntax::ast;\n use syntax::codemap::{BytePos, Span};\n use syntax_pos::Pos;\n use utils::span_lint;\n+use url::Url;\n \n /// **What it does:** Checks for the presence of `_`, `::` or camel-case words\n /// outside ticks in documentation.\n@@ -195,16 +196,26 @@ fn check_doc<'a, Events: Iterator<Item = (usize, pulldown_cmark::Event<'a>)>>(\n     use pulldown_cmark::Tag::*;\n \n     let mut in_code = false;\n+    let mut in_link = None;\n \n     for (offset, event) in docs {\n         match event {\n             Start(CodeBlock(_)) | Start(Code) => in_code = true,\n             End(CodeBlock(_)) | End(Code) => in_code = false,\n-            Start(_tag) | End(_tag) => (),         // We don't care about other tags\n+            Start(Link(link, _)) => in_link = Some(link),\n+            End(Link(_, _)) => in_link = None,\n+            Start(_tag) | End(_tag) => (), // We don't care about other tags\n             Html(_html) | InlineHtml(_html) => (), // HTML is weird, just ignore it\n             SoftBreak => (),\n             HardBreak => (),\n             FootnoteReference(text) | Text(text) => {\n+                if Some(&text) == in_link.as_ref() {\n+                    // Probably a link of the form `<http://example.com>`\n+                    // Which are represented as a link to \"http://example.com\" with\n+                    // text \"http://example.com\" by pulldown-cmark\n+                    continue;\n+                }\n+\n                 if !in_code {\n                     let index = match spans.binary_search_by(|c| c.0.cmp(&offset)) {\n                         Ok(o) => o,\n@@ -270,6 +281,18 @@ fn check_word(cx: &EarlyContext, word: &str, span: Span) {\n         s != \"_\" && !s.contains(\"\\\\_\") && s.contains('_')\n     }\n \n+    if let Ok(url) = Url::parse(word) {\n+        // try to get around the fact that `foo::bar` parses as a valid URL\n+        if !url.cannot_be_a_base() {\n+            span_lint(cx,\n+                      DOC_MARKDOWN,\n+                      span,\n+                      \"you should put bare URLs between `<`/`>` or make a proper Markdown link\");\n+\n+            return;\n+        }\n+    }\n+\n     if has_underscore(word) || word.contains(\"::\") || is_camel_case(word) {\n         span_lint(\n             cx,"}, {"sha": "38d7847f42b8b5a9ecc991a66502707cc0e46202", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "patch": "@@ -51,6 +51,7 @@ extern crate lazy_static;\n \n extern crate itertools;\n extern crate pulldown_cmark;\n+extern crate url;\n \n macro_rules! declare_restriction_lint {\n     { pub $name:tt, $description:tt } => {"}, {"sha": "70009d76f5d9e62d4fc92bd427d2557c8447b25e", "filename": "tests/ui/doc.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/tests%2Fui%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/tests%2Fui%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc.rs?ref=ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "patch": "@@ -159,3 +159,11 @@ fn issue_1469() {}\n  *This would also be an error under a strict common mark interpretation\n  */\n fn issue_1920() {}\n+\n+/// Ok: <http://www.unicode.org/reports/tr9/#Reordering_Resolved_Levels>\n+///\n+/// Not ok: http://www.unicode.org\n+/// Not ok: https://www.unicode.org\n+/// Not ok: http://www.unicode.org/\n+/// Not ok: http://www.unicode.org/reports/tr9/#Reordering_Resolved_Levels\n+fn issue_1832() {}"}, {"sha": "f38678e89aac234b8488534a00cc05f3ff97ea52", "filename": "tests/ui/doc.stderr", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/tests%2Fui%2Fdoc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ebc9891fc63531f83f3524167ef6f5a60ea3e6ee/tests%2Fui%2Fdoc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc.stderr?ref=ebc9891fc63531f83f3524167ef6f5a60ea3e6ee", "patch": "@@ -156,5 +156,29 @@ error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the doc\n 138 | /// be_sure_we_got_to_the_end_of_it\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 26 previous errors\n+error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n+   --> $DIR/doc.rs:165:13\n+    |\n+165 | /// Not ok: http://www.unicode.org\n+    |             ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n+   --> $DIR/doc.rs:166:13\n+    |\n+166 | /// Not ok: https://www.unicode.org\n+    |             ^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n+   --> $DIR/doc.rs:167:13\n+    |\n+167 | /// Not ok: http://www.unicode.org/\n+    |             ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n+   --> $DIR/doc.rs:168:13\n+    |\n+168 | /// Not ok: http://www.unicode.org/reports/tr9/#Reordering_Resolved_Levels\n+    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 30 previous errors\n "}]}