{"sha": "b122064a33884a5dab1e5f4710b38ed233d2b4d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxMjIwNjRhMzM4ODRhNWRhYjFlNWY0NzEwYjM4ZWQyMzNkMmI0ZDU=", "commit": {"author": {"name": "Dirk Gadsden", "email": "dirk@esherido.com", "date": "2016-02-10T06:48:47Z"}, "committer": {"name": "Dirk Gadsden", "email": "dirk@esherido.com", "date": "2016-02-15T00:44:39Z"}, "message": "Stricter matching of `--cfg` options on rustc\n\nIncludes compile-fail test to check that it fails on incomplete\n`--cfg` matches.\n\nFixes #31497.", "tree": {"sha": "ff6bdddc9111a2d64532a5d3f38e669ca1ec2a5f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ff6bdddc9111a2d64532a5d3f38e669ca1ec2a5f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b122064a33884a5dab1e5f4710b38ed233d2b4d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b122064a33884a5dab1e5f4710b38ed233d2b4d5", "html_url": "https://github.com/rust-lang/rust/commit/b122064a33884a5dab1e5f4710b38ed233d2b4d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b122064a33884a5dab1e5f4710b38ed233d2b4d5/comments", "author": {"login": "dirk", "id": 7081, "node_id": "MDQ6VXNlcjcwODE=", "avatar_url": "https://avatars.githubusercontent.com/u/7081?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dirk", "html_url": "https://github.com/dirk", "followers_url": "https://api.github.com/users/dirk/followers", "following_url": "https://api.github.com/users/dirk/following{/other_user}", "gists_url": "https://api.github.com/users/dirk/gists{/gist_id}", "starred_url": "https://api.github.com/users/dirk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dirk/subscriptions", "organizations_url": "https://api.github.com/users/dirk/orgs", "repos_url": "https://api.github.com/users/dirk/repos", "events_url": "https://api.github.com/users/dirk/events{/privacy}", "received_events_url": "https://api.github.com/users/dirk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dirk", "id": 7081, "node_id": "MDQ6VXNlcjcwODE=", "avatar_url": "https://avatars.githubusercontent.com/u/7081?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dirk", "html_url": "https://github.com/dirk", "followers_url": "https://api.github.com/users/dirk/followers", "following_url": "https://api.github.com/users/dirk/following{/other_user}", "gists_url": "https://api.github.com/users/dirk/gists{/gist_id}", "starred_url": "https://api.github.com/users/dirk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dirk/subscriptions", "organizations_url": "https://api.github.com/users/dirk/orgs", "repos_url": "https://api.github.com/users/dirk/repos", "events_url": "https://api.github.com/users/dirk/events{/privacy}", "received_events_url": "https://api.github.com/users/dirk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a888333ea6acad7e289fa3f0f9e6c1058aa2a011", "url": "https://api.github.com/repos/rust-lang/rust/commits/a888333ea6acad7e289fa3f0f9e6c1058aa2a011", "html_url": "https://github.com/rust-lang/rust/commit/a888333ea6acad7e289fa3f0f9e6c1058aa2a011"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "28422989ea159cba838d096805df5237b04d4ec5", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b122064a33884a5dab1e5f4710b38ed233d2b4d5/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b122064a33884a5dab1e5f4710b38ed233d2b4d5/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=b122064a33884a5dab1e5f4710b38ed233d2b4d5", "patch": "@@ -28,6 +28,7 @@ use syntax::attr;\n use syntax::attr::AttrMetaMethods;\n use syntax::errors::{ColorConfig, Handler};\n use syntax::parse;\n+use syntax::parse::lexer::Reader;\n use syntax::parse::token::InternedString;\n use syntax::feature_gate::UnstableFeatures;\n \n@@ -906,10 +907,19 @@ pub fn rustc_optgroups() -> Vec<RustcOptGroup> {\n // Convert strings provided as --cfg [cfgspec] into a crate_cfg\n pub fn parse_cfgspecs(cfgspecs: Vec<String> ) -> ast::CrateConfig {\n     cfgspecs.into_iter().map(|s| {\n-        parse::parse_meta_from_source_str(\"cfgspec\".to_string(),\n-                                          s.to_string(),\n-                                          Vec::new(),\n-                                          &parse::ParseSess::new())\n+        let sess = parse::ParseSess::new();\n+        let mut parser = parse::new_parser_from_source_str(&sess,\n+                                                           Vec::new(),\n+                                                           \"cfgspec\".to_string(),\n+                                                           s.to_string());\n+        let meta_item = panictry!(parser.parse_meta_item());\n+\n+        if !parser.reader.is_eof() {\n+            early_error(ErrorOutputType::default(), &format!(\"invalid --cfg argument: {}\",\n+                                                             s))\n+        }\n+\n+        meta_item\n     }).collect::<ast::CrateConfig>()\n }\n "}, {"sha": "404630399c601e15450d7311422c58936218960a", "filename": "src/test/compile-fail/cfg-arg-invalid.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b122064a33884a5dab1e5f4710b38ed233d2b4d5/src%2Ftest%2Fcompile-fail%2Fcfg-arg-invalid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b122064a33884a5dab1e5f4710b38ed233d2b4d5/src%2Ftest%2Fcompile-fail%2Fcfg-arg-invalid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fcfg-arg-invalid.rs?ref=b122064a33884a5dab1e5f4710b38ed233d2b4d5", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: --cfg a{b}\n+// error-pattern: invalid --cfg argument: a{b}\n+fn main() {}"}]}