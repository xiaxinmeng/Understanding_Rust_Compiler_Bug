{"sha": "836cdf0a02f6dc308cf69020c3397e0247ac047f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzNmNkZjBhMDJmNmRjMzA4Y2Y2OTAyMGMzMzk3ZTAyNDdhYzA0N2Y=", "commit": {"author": {"name": "Alexis Beingessner", "email": "a.beingessner@gmail.com", "date": "2015-06-06T22:52:28Z"}, "committer": {"name": "Alexis Beingessner", "email": "a.beingessner@gmail.com", "date": "2015-06-11T17:49:28Z"}, "message": "WIP inherited deprecation fixes #26040", "tree": {"sha": "b6c3ca6835bc1250054b3804a314b3a15c25003d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b6c3ca6835bc1250054b3804a314b3a15c25003d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/836cdf0a02f6dc308cf69020c3397e0247ac047f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/836cdf0a02f6dc308cf69020c3397e0247ac047f", "html_url": "https://github.com/rust-lang/rust/commit/836cdf0a02f6dc308cf69020c3397e0247ac047f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/836cdf0a02f6dc308cf69020c3397e0247ac047f/comments", "author": {"login": "Gankra", "id": 1136864, "node_id": "MDQ6VXNlcjExMzY4NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gankra", "html_url": "https://github.com/Gankra", "followers_url": "https://api.github.com/users/Gankra/followers", "following_url": "https://api.github.com/users/Gankra/following{/other_user}", "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions", "organizations_url": "https://api.github.com/users/Gankra/orgs", "repos_url": "https://api.github.com/users/Gankra/repos", "events_url": "https://api.github.com/users/Gankra/events{/privacy}", "received_events_url": "https://api.github.com/users/Gankra/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Gankra", "id": 1136864, "node_id": "MDQ6VXNlcjExMzY4NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gankra", "html_url": "https://github.com/Gankra", "followers_url": "https://api.github.com/users/Gankra/followers", "following_url": "https://api.github.com/users/Gankra/following{/other_user}", "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions", "organizations_url": "https://api.github.com/users/Gankra/orgs", "repos_url": "https://api.github.com/users/Gankra/repos", "events_url": "https://api.github.com/users/Gankra/events{/privacy}", "received_events_url": "https://api.github.com/users/Gankra/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c85f30736913cf42549d8e0fd40049b346b4cec4", "url": "https://api.github.com/repos/rust-lang/rust/commits/c85f30736913cf42549d8e0fd40049b346b4cec4", "html_url": "https://github.com/rust-lang/rust/commit/c85f30736913cf42549d8e0fd40049b346b4cec4"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "5d092167d5ada08695087b3060e4ad6d6c1463c3", "filename": "src/librustc/middle/stability.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/836cdf0a02f6dc308cf69020c3397e0247ac047f/src%2Flibrustc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/836cdf0a02f6dc308cf69020c3397e0247ac047f/src%2Flibrustc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fstability.rs?ref=836cdf0a02f6dc308cf69020c3397e0247ac047f", "patch": "@@ -60,8 +60,18 @@ impl<'a, 'tcx: 'a> Annotator<'a, 'tcx> {\n         if self.index.staged_api[&ast::LOCAL_CRATE] {\n             debug!(\"annotate(id = {:?}, attrs = {:?})\", id, attrs);\n             match attr::find_stability(self.tcx.sess.diagnostic(), attrs, item_sp) {\n-                Some(stab) => {\n+                Some(mut stab) => {\n                     debug!(\"annotate: found {:?}\", stab);\n+                    // if parent is deprecated and we're not, inherit this by merging\n+                    // deprecated_since and its reason.\n+                    if let Some(parent_stab) = self.parent {\n+                        if parent_stab.deprecated_since.is_some()\n+                        && stab.deprecated_since.is_none() {\n+                            stab.deprecated_since = parent_stab.deprecated_since.clone();\n+                            stab.reason = parent_stab.reason.clone();\n+                        }\n+                    }\n+\n                     let stab = self.tcx.intern_stability(stab);\n                     self.index.map.insert(local_def(id), Some(stab));\n "}]}