{"sha": "6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562", "node_id": "C_kwDOAAsO6NoAKDZiZGM1ZDZmNGMyZTlhODcwY2UxZjRjYjA4MzNmN2VkMzdmYmU1NjI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-09T11:51:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-09T11:51:32Z"}, "message": "Auto merge of #2348 - RalfJung:ui-test, r=RalfJung\n\nui_test: require colon after command\n\nTurns out we already use colons everywhere properly.\n\nAlso rename ui_test::comments to parser. I think that better describes its contents. :)", "tree": {"sha": "dd51b11d12a568ca6cba727d8481112c6e30388e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd51b11d12a568ca6cba727d8481112c6e30388e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562", "html_url": "https://github.com/rust-lang/rust/commit/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a6a812794f6c2ff46a5a6d1a2991ecc5903b10c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a6a812794f6c2ff46a5a6d1a2991ecc5903b10c", "html_url": "https://github.com/rust-lang/rust/commit/7a6a812794f6c2ff46a5a6d1a2991ecc5903b10c"}, {"sha": "2850db9f6b2172e11b5e7d9b4b685fd288797886", "url": "https://api.github.com/repos/rust-lang/rust/commits/2850db9f6b2172e11b5e7d9b4b685fd288797886", "html_url": "https://github.com/rust-lang/rust/commit/2850db9f6b2172e11b5e7d9b4b685fd288797886"}], "stats": {"total": 31, "additions": 22, "deletions": 9}, "files": [{"sha": "bebda768babee7ce1f2e06ce3e76ae6fe23ac7ef", "filename": "ui_test/src/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562/ui_test%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562/ui_test%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ui_test%2Fsrc%2Flib.rs?ref=6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562", "patch": "@@ -10,13 +10,13 @@ use std::sync::Mutex;\n pub use color_eyre;\n use color_eyre::eyre::Result;\n use colored::*;\n-use comments::ErrorMatch;\n+use parser::ErrorMatch;\n use regex::Regex;\n use rustc_stderr::{Level, Message};\n \n-use crate::comments::{Comments, Condition};\n+use crate::parser::{Comments, Condition};\n \n-mod comments;\n+mod parser;\n mod rustc_stderr;\n #[cfg(test)]\n mod tests;"}, {"sha": "72ccc0136201ce510b06a4a5c948e6c9bb6f99c9", "filename": "ui_test/src/parser.rs", "status": "renamed", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562/ui_test%2Fsrc%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562/ui_test%2Fsrc%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ui_test%2Fsrc%2Fparser.rs?ref=6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562", "patch": "@@ -117,12 +117,8 @@ impl Comments {\n                     let next = args\n                         .next()\n                         .expect(\"the `position` above guarantees that there is at least one char\");\n-                    // FIXME: this replicates the existing flexibility in our syntax. Consider requiring the colon.\n-                    let args = match next {\n-                        ':' | ' ' => args.as_str(),\n-                        _ => bail!(\"expected space or `:`, got `{next}`\"),\n-                    };\n-                    (command, args.trim())\n+                    ensure!(next == ':', \"test command must be followed by : (or end the line)\");\n+                    (command, args.as_str().trim())\n                 }\n             };\n \n@@ -188,16 +184,19 @@ impl Comments {\n                 self.error_pattern = Some((args.trim().to_string(), l));\n             }\n             \"stderr-per-bitwidth\" => {\n+                // args are ignored (can be used as comment)\n                 ensure!(!self.stderr_per_bitwidth, \"cannot specifiy stderr-per-bitwidth twice\");\n                 self.stderr_per_bitwidth = true;\n             }\n             command => {\n                 if let Some(s) = command.strip_prefix(\"ignore-\") {\n+                    // args are ignored (can be sue as comment)\n                     self.ignore.push(Condition::parse(s));\n                     return Ok(());\n                 }\n \n                 if let Some(s) = command.strip_prefix(\"only-\") {\n+                    // args are ignored (can be sue as comment)\n                     self.only.push(Condition::parse(s));\n                     return Ok(());\n                 }", "previous_filename": "ui_test/src/comments.rs"}, {"sha": "096cc8eab96574304204184d1b61d86b25044bf8", "filename": "ui_test/src/parser/tests.rs", "status": "renamed", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562/ui_test%2Fsrc%2Fparser%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562/ui_test%2Fsrc%2Fparser%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ui_test%2Fsrc%2Fparser%2Ftests.rs?ref=6bdc5d6f4c2e9a870ce1f4cb0833f7ed37fbe562", "patch": "@@ -53,3 +53,17 @@ use std::mem;\n         Err(_) => Ok(()),\n     }\n }\n+\n+#[test]\n+fn missing_colon_fail() -> Result<()> {\n+    init();\n+    let s = r\"\n+//@stderr-per-bitwidth hello\n+use std::mem;\n+\n+    \";\n+    match Comments::parse(Path::new(\"<dummy>\"), s) {\n+        Ok(_) => bail!(\"expected parsing to fail\"),\n+        Err(_) => Ok(()),\n+    }\n+}", "previous_filename": "ui_test/src/comments/tests.rs"}]}