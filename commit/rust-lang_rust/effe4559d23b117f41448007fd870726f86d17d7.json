{"sha": "effe4559d23b117f41448007fd870726f86d17d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmZmU0NTU5ZDIzYjExN2Y0MTQ0ODAwN2ZkODcwNzI2Zjg2ZDE3ZDc=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-10T01:52:06Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-10T02:13:14Z"}, "message": "rustdoc: Accept the first sentence as the brief description", "tree": {"sha": "289e54352a8c2ef145b9d5dc57abaed0a8e9d32b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/289e54352a8c2ef145b9d5dc57abaed0a8e9d32b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/effe4559d23b117f41448007fd870726f86d17d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/effe4559d23b117f41448007fd870726f86d17d7", "html_url": "https://github.com/rust-lang/rust/commit/effe4559d23b117f41448007fd870726f86d17d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/effe4559d23b117f41448007fd870726f86d17d7/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4fc5b822e218301eedf49ec249fdd1a0adf8ebd6", "url": "https://api.github.com/repos/rust-lang/rust/commits/4fc5b822e218301eedf49ec249fdd1a0adf8ebd6", "html_url": "https://github.com/rust-lang/rust/commit/4fc5b822e218301eedf49ec249fdd1a0adf8ebd6"}], "stats": {"total": 43, "additions": 35, "deletions": 8}, "files": [{"sha": "4ff63120efb47cbc8d46f25e9b195d85f49edaa3", "filename": "src/rustdoc/desc_to_brief_pass.rs", "status": "modified", "additions": 35, "deletions": 8, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/effe4559d23b117f41448007fd870726f86d17d7/src%2Frustdoc%2Fdesc_to_brief_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/effe4559d23b117f41448007fd870726f86d17d7/src%2Frustdoc%2Fdesc_to_brief_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fdesc_to_brief_pass.rs?ref=effe4559d23b117f41448007fd870726f86d17d7", "patch": "@@ -108,20 +108,32 @@ fn parse_desc(desc: str) -> option<str> {\n \n     const max_brief_len: uint = 120u;\n \n-    let paras = paragraphs(desc);\n-\n-    if check vec::is_not_empty(paras) {\n-        let maybe_brief = vec::head(paras);\n-        if str::len(maybe_brief) <= max_brief_len {\n-            some(maybe_brief)\n+    alt first_sentence(desc) {\n+      some(first_sentence) {\n+        if str::len(first_sentence) <= max_brief_len {\n+            some(first_sentence)\n         } else {\n             none\n         }\n+      }\n+      none { none }\n+    }\n+}\n+\n+fn first_sentence(s: str) -> option<str> {\n+    let paras = paragraphs(s);\n+    if vec::is_not_empty(paras) {\n+        let first = vec::head(sentences(vec::head(paras)));\n+        some(str::replace(first, \"\\n\", \" \"))\n     } else {\n         none\n     }\n }\n \n+fn sentences(s: str) -> [str] {\n+    str::split_char(s, '.')\n+}\n+\n fn paragraphs(s: str) -> [str] {\n     let lines = str::lines_any(s);\n     let whitespace_lines = 0;\n@@ -180,8 +192,8 @@ fn should_promote_short_descs() {\n #[test]\n fn should_not_promote_long_descs() {\n     let desc = some(\"Warkworth Castle is a ruined medieval building\n-in the town of the same name in the English county of Northumberland.\n-The town and castle occupy a loop of the River Coquet, less than a mile\n+in the town of the same name in the English county of Northumberland,\n+and the town and castle occupy a loop of the River Coquet, less than a mile\n from England's north-east coast. When the castle was founded is uncertain,\n but traditionally its construction has been ascribed to Prince Henry of\n Scotland in the mid 12th century, although it may have been built by\n@@ -190,3 +202,18 @@ counties.\");\n     let brief = extract(desc);\n     assert brief == none;\n }\n+\n+#[test]\n+fn should_promote_first_sentence() {\n+    let desc = some(\"Warkworth Castle is a ruined medieval building\n+in the town. of the same name in the English county of Northumberland,\n+and the town and castle occupy a loop of the River Coquet, less than a mile\n+from England's north-east coast. When the castle was founded is uncertain,\n+but traditionally its construction has been ascribed to Prince Henry of\n+Scotland in the mid 12th century, although it may have been built by\n+King Henry II of England when he took control of England'snorthern\n+counties.\");\n+    let brief = extract(desc);\n+    assert brief == some(\n+        \"Warkworth Castle is a ruined medieval building in the town\");\n+}\n\\ No newline at end of file"}]}