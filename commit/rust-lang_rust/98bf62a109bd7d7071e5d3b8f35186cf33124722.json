{"sha": "98bf62a109bd7d7071e5d3b8f35186cf33124722", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk4YmY2MmExMDliZDdkNzA3MWU1ZDNiOGYzNTE4NmNmMzMxMjQ3MjI=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-04-16T14:26:40Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-05-03T09:30:14Z"}, "message": "Add tests for -Z cross-lang-lto.", "tree": {"sha": "4aa9d608dfcb5e1653698d734773797f5d7f5a85", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4aa9d608dfcb5e1653698d734773797f5d7f5a85"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/98bf62a109bd7d7071e5d3b8f35186cf33124722", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/98bf62a109bd7d7071e5d3b8f35186cf33124722", "html_url": "https://github.com/rust-lang/rust/commit/98bf62a109bd7d7071e5d3b8f35186cf33124722", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/98bf62a109bd7d7071e5d3b8f35186cf33124722/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "443f99fca02365c8d4cbc734d290d4b0cc7c3ae6", "url": "https://api.github.com/repos/rust-lang/rust/commits/443f99fca02365c8d4cbc734d290d4b0cc7c3ae6", "html_url": "https://github.com/rust-lang/rust/commit/443f99fca02365c8d4cbc734d290d4b0cc7c3ae6"}], "stats": {"total": 76, "additions": 76, "deletions": 0}, "files": [{"sha": "e664394d1eaced330ba5a1d75cc575c34fe8c5f7", "filename": "src/test/run-make/cross-lang-lto/Makefile", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/98bf62a109bd7d7071e5d3b8f35186cf33124722/src%2Ftest%2Frun-make%2Fcross-lang-lto%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/98bf62a109bd7d7071e5d3b8f35186cf33124722/src%2Ftest%2Frun-make%2Fcross-lang-lto%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fcross-lang-lto%2FMakefile?ref=98bf62a109bd7d7071e5d3b8f35186cf33124722", "patch": "@@ -0,0 +1,49 @@\n+# This test makes sure that the expected .llvmbc sections for use by\n+# linker-based LTO are available in object files when compiling with\n+# -Z cross-lang-lto\n+\n+-include ../../run-make-fulldeps/tools.mk\n+\n+LLVMBC_SECTION_NAME=\\\\.llvmbc\n+\n+ifeq ($(UNAME),Darwin)\n+\tLLVMBC_SECTION_NAME=__LLVM,__bitcode\n+endif\n+\n+\n+OBJDUMP=$(HOST_RPATH_DIR)/../../llvm/bin/llvm-objdump\n+SECTION_HEADERS=$(OBJDUMP) -section-headers\n+\n+BUILD_LIB=$(RUSTC) lib.rs -Copt-level=2 -Z cross-lang-lto -Ccodegen-units=1\n+\n+BUILD_EXE=$(RUSTC) main.rs -Copt-level=2 -Z cross-lang-lto -Ccodegen-units=1 --emit=obj\n+\n+all: staticlib staticlib-fat-lto staticlib-thin-lto rlib exe cdylib rdylib\n+\n+staticlib: lib.rs\n+\t$(BUILD_LIB) --crate-type=staticlib\n+\t[ \"$$($(SECTION_HEADERS) $(TMPDIR)/liblib.a | grep -c $(LLVMBC_SECTION_NAME))\" -ne \"0\" ]\n+\n+staticlib-fat-lto: lib.rs\n+\t$(BUILD_LIB) --crate-type=staticlib -o $(TMPDIR)/liblib-fat-lto.a -Clto=fat\n+\t[ \"$$($(SECTION_HEADERS) $(TMPDIR)/liblib-fat-lto.a | grep -c $(LLVMBC_SECTION_NAME))\" -ne \"0\" ]\n+\n+staticlib-thin-lto: lib.rs\n+\t$(BUILD_LIB) --crate-type=staticlib -o $(TMPDIR)/liblib-thin-lto.a -Clto=thin\n+\t[ \"$$($(SECTION_HEADERS) $(TMPDIR)/liblib-thin-lto.a | grep -c $(LLVMBC_SECTION_NAME))\" -ne \"0\" ]\n+\n+rlib: lib.rs\n+\t$(BUILD_LIB) --crate-type=rlib\n+\t[ \"$$($(SECTION_HEADERS) $(TMPDIR)/liblib.rlib | grep -c $(LLVMBC_SECTION_NAME))\" -ne \"0\" ]\n+\n+cdylib: lib.rs\n+\t$(BUILD_LIB) --crate-type=cdylib --emit=obj -o $(TMPDIR)/cdylib.o\n+\t[ \"$$($(SECTION_HEADERS) $(TMPDIR)/cdylib.o | grep -c $(LLVMBC_SECTION_NAME))\" -ne \"0\" ]\n+\n+rdylib: lib.rs\n+\t$(BUILD_LIB) --crate-type=dylib --emit=obj -o $(TMPDIR)/rdylib.o\n+\t[ \"$$($(SECTION_HEADERS) $(TMPDIR)/rdylib.o | grep -c $(LLVMBC_SECTION_NAME))\" -ne \"0\" ]\n+\n+exe: lib.rs\n+\t$(BUILD_EXE) -o $(TMPDIR)/exe.o\n+\t[ \"$$($(SECTION_HEADERS) $(TMPDIR)/exe.o | grep -c $(LLVMBC_SECTION_NAME))\" -ne \"0\" ]"}, {"sha": "b2a5b946160f03edb827750e416e9f5576e2dffd", "filename": "src/test/run-make/cross-lang-lto/lib.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/98bf62a109bd7d7071e5d3b8f35186cf33124722/src%2Ftest%2Frun-make%2Fcross-lang-lto%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98bf62a109bd7d7071e5d3b8f35186cf33124722/src%2Ftest%2Frun-make%2Fcross-lang-lto%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fcross-lang-lto%2Flib.rs?ref=98bf62a109bd7d7071e5d3b8f35186cf33124722", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[no_mangle]\n+pub extern \"C\" fn foo() {\n+    println!(\"abc\");\n+}"}, {"sha": "ccd34c9e4dbedc109152a91bc9bd0349c1b8a107", "filename": "src/test/run-make/cross-lang-lto/main.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/98bf62a109bd7d7071e5d3b8f35186cf33124722/src%2Ftest%2Frun-make%2Fcross-lang-lto%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98bf62a109bd7d7071e5d3b8f35186cf33124722/src%2Ftest%2Frun-make%2Fcross-lang-lto%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fcross-lang-lto%2Fmain.rs?ref=98bf62a109bd7d7071e5d3b8f35186cf33124722", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    println!(\"Hello World\");\n+}"}]}