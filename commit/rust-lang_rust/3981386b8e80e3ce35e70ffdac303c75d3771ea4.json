{"sha": "3981386b8e80e3ce35e70ffdac303c75d3771ea4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5ODEzODZiOGU4MGUzY2UzNWU3MGZmZGFjMzAzYzc1ZDM3NzFlYTQ=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-20T02:12:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-20T02:12:35Z"}, "message": "Rollup merge of #74514 - Mark-Simulacrum:nightly-rustc-docs, r=ollie27\n\nDo not clobber RUSTDOCFLAGS\n\nWe were setting these in both Builder::cargo and here, which ended up only setting the first of the two.\n\nFixes #74511", "tree": {"sha": "6ed876364a0b4e6dcf45f785dfe5779aa8405ea9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ed876364a0b4e6dcf45f785dfe5779aa8405ea9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3981386b8e80e3ce35e70ffdac303c75d3771ea4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfFP2TCRBK7hj4Ov3rIwAAdHIIAHnZ3DKzgMnF/RB5IE+F2jsw\nRkxOvoduX/HlP7GJlA6a2czqYI+R7aFeBfOqNIg/cqlosSqU73r4uUXxpcf2xflr\npm9B510eEEtj6da43uo6olkIb6vlFXotDgLzQ8qnrQshyRl7Q7NVXHDn2P/+oum9\nXE4joaHjYs4Dw1E2qceRyRbkJbscz+WOAyRypw0H6GtGQP1XvQXqKFNoryDNyH5N\n266wSCMQ8Nrbb60bnwQFBS2tw1n7KACkQ5CtGUBxUUr1bYCku9eAjmrxXdZL2QXw\nhTCpfqOtSBTNbE//CYc4VgaNQGBUCM9A8le01j/EDFVIaHRxwyYvcfsT66mssdA=\n=CJdC\n-----END PGP SIGNATURE-----\n", "payload": "tree 6ed876364a0b4e6dcf45f785dfe5779aa8405ea9\nparent 03a47279d36162499f1140ce4a9aec2cd2bfe48f\nparent be43319b174589f61ce5d8a7b00c0567eb8cff35\nauthor Manish Goregaokar <manishsmail@gmail.com> 1595211155 -0700\ncommitter GitHub <noreply@github.com> 1595211155 -0700\n\nRollup merge of #74514 - Mark-Simulacrum:nightly-rustc-docs, r=ollie27\n\nDo not clobber RUSTDOCFLAGS\n\nWe were setting these in both Builder::cargo and here, which ended up only setting the first of the two.\n\nFixes #74511\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3981386b8e80e3ce35e70ffdac303c75d3771ea4", "html_url": "https://github.com/rust-lang/rust/commit/3981386b8e80e3ce35e70ffdac303c75d3771ea4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3981386b8e80e3ce35e70ffdac303c75d3771ea4/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03a47279d36162499f1140ce4a9aec2cd2bfe48f", "url": "https://api.github.com/repos/rust-lang/rust/commits/03a47279d36162499f1140ce4a9aec2cd2bfe48f", "html_url": "https://github.com/rust-lang/rust/commit/03a47279d36162499f1140ce4a9aec2cd2bfe48f"}, {"sha": "be43319b174589f61ce5d8a7b00c0567eb8cff35", "url": "https://api.github.com/repos/rust-lang/rust/commits/be43319b174589f61ce5d8a7b00c0567eb8cff35", "html_url": "https://github.com/rust-lang/rust/commit/be43319b174589f61ce5d8a7b00c0567eb8cff35"}], "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "737176c48f878ef5cb59a81a173cfb8ca6c5102e", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3981386b8e80e3ce35e70ffdac303c75d3771ea4/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3981386b8e80e3ce35e70ffdac303c75d3771ea4/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=3981386b8e80e3ce35e70ffdac303c75d3771ea4", "patch": "@@ -1444,6 +1444,10 @@ pub struct Cargo {\n }\n \n impl Cargo {\n+    pub fn rustdocflag(&mut self, arg: &str) -> &mut Cargo {\n+        self.rustdocflags.arg(arg);\n+        self\n+    }\n     pub fn rustflag(&mut self, arg: &str) -> &mut Cargo {\n         self.rustflags.arg(arg);\n         self\n@@ -1466,6 +1470,9 @@ impl Cargo {\n     }\n \n     pub fn env(&mut self, key: impl AsRef<OsStr>, value: impl AsRef<OsStr>) -> &mut Cargo {\n+        // These are managed through rustflag/rustdocflag interfaces.\n+        assert_ne!(key.as_ref(), \"RUSTFLAGS\");\n+        assert_ne!(key.as_ref(), \"RUSTDOCFLAGS\");\n         self.command.env(key.as_ref(), value.as_ref());\n         self\n     }"}, {"sha": "f8a549afc88fb81da408d64ca8c9f7519fee8bf8", "filename": "src/bootstrap/doc.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3981386b8e80e3ce35e70ffdac303c75d3771ea4/src%2Fbootstrap%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3981386b8e80e3ce35e70ffdac303c75d3771ea4/src%2Fbootstrap%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdoc.rs?ref=3981386b8e80e3ce35e70ffdac303c75d3771ea4", "patch": "@@ -527,11 +527,9 @@ impl Step for Rustc {\n \n         // Build cargo command.\n         let mut cargo = builder.cargo(compiler, Mode::Rustc, SourceType::InTree, target, \"doc\");\n-        cargo.env(\n-            \"RUSTDOCFLAGS\",\n-            \"--document-private-items \\\n-            --enable-index-page -Zunstable-options\",\n-        );\n+        cargo.rustdocflag(\"--document-private-items\");\n+        cargo.rustdocflag(\"--enable-index-page\");\n+        cargo.rustdocflag(\"-Zunstable-options\");\n         compile::rustc_cargo(builder, &mut cargo, target);\n \n         // Only include compiler crates, no dependencies of those, such as `libc`.\n@@ -624,7 +622,7 @@ impl Step for Rustdoc {\n         cargo.arg(\"--no-deps\");\n         cargo.arg(\"-p\").arg(\"rustdoc\");\n \n-        cargo.env(\"RUSTDOCFLAGS\", \"--document-private-items\");\n+        cargo.rustdocflag(\"--document-private-items\");\n         builder.run(&mut cargo.into());\n     }\n }"}]}