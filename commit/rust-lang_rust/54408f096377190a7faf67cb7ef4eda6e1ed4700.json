{"sha": "54408f096377190a7faf67cb7ef4eda6e1ed4700", "node_id": "C_kwDOAAsO6NoAKDU0NDA4ZjA5NjM3NzE5MGE3ZmFmNjdjYjdlZjRlZGE2ZTFlZDQ3MDA", "commit": {"author": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2022-03-06T07:51:10Z"}, "committer": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2022-03-10T09:19:02Z"}, "message": "short-circuit the easy cases in `is_copy_modulo_regions`\n\nThis change is somewhat extensive, since it affects MIR -- since this is called to determine Copy vs Move -- so any test that's `no_core` needs to actually have the normal `impl`s it uses.", "tree": {"sha": "7677ca8c72b99562057f8b1f18b8e83d1c48667e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7677ca8c72b99562057f8b1f18b8e83d1c48667e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54408f096377190a7faf67cb7ef4eda6e1ed4700", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54408f096377190a7faf67cb7ef4eda6e1ed4700", "html_url": "https://github.com/rust-lang/rust/commit/54408f096377190a7faf67cb7ef4eda6e1ed4700", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54408f096377190a7faf67cb7ef4eda6e1ed4700/comments", "author": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5a54d8777f00141954527a118715b1a36981b73", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5a54d8777f00141954527a118715b1a36981b73", "html_url": "https://github.com/rust-lang/rust/commit/b5a54d8777f00141954527a118715b1a36981b73"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "eb16d305d0a8085c17caab0668a982a65a2e586b", "filename": "compiler/rustc_middle/src/ty/util.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -704,7 +704,7 @@ impl<'tcx> Ty<'tcx> {\n         tcx_at: TyCtxtAt<'tcx>,\n         param_env: ty::ParamEnv<'tcx>,\n     ) -> bool {\n-        tcx_at.is_copy_raw(param_env.and(self))\n+        self.is_trivially_pure_clone_copy() || tcx_at.is_copy_raw(param_env.and(self))\n     }\n \n     /// Checks whether values of this type `T` have a size known at"}, {"sha": "6a898b2974a65f40fb3eba2dc11cc205c457a5fe", "filename": "src/test/assembly/sparc-struct-abi.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fassembly%2Fsparc-struct-abi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fassembly%2Fsparc-struct-abi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fassembly%2Fsparc-struct-abi.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -13,6 +13,7 @@\n pub trait Sized {}\n #[lang = \"copy\"]\n pub trait Copy {}\n+impl Copy for f32 {}\n \n #[repr(C)]\n pub struct Franta {"}, {"sha": "18d896e86b215e8bc1e8df05489d0209c6ef8c29", "filename": "src/test/assembly/target-feature-multiple.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fassembly%2Ftarget-feature-multiple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fassembly%2Ftarget-feature-multiple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fassembly%2Ftarget-feature-multiple.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -23,6 +23,7 @@\n trait Sized {}\n #[lang = \"copy\"]\n trait Copy {}\n+impl Copy for u32 {}\n \n // Use of these requires target features to be enabled\n extern \"unadjusted\" {"}, {"sha": "dfc312279083d6fe576440b4e6fa7bb796651ec0", "filename": "src/test/codegen/abi-sysv64.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Fabi-sysv64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Fabi-sysv64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fabi-sysv64.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -13,6 +13,7 @@\n trait Sized {}\n #[lang = \"copy\"]\n trait Copy {}\n+impl Copy for i64 {}\n \n // CHECK: define x86_64_sysvcc i64 @has_sysv64_abi\n #[no_mangle]"}, {"sha": "d612f603e4fea0d27e64b0e4f17b914f565a195d", "filename": "src/test/codegen/abi-x86-interrupt.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Fabi-x86-interrupt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Fabi-x86-interrupt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fabi-x86-interrupt.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -13,6 +13,7 @@\n trait Sized {}\n #[lang = \"copy\"]\n trait Copy {}\n+impl Copy for i64 {}\n \n // CHECK: define x86_intrcc i64 @has_x86_interrupt_abi\n #[no_mangle]"}, {"sha": "f7c02d47939fed4314f87dde85ba35526761d7da", "filename": "src/test/codegen/frame-pointer.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Fframe-pointer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Fframe-pointer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fframe-pointer.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -17,7 +17,7 @@\n trait Sized { }\n #[lang=\"copy\"]\n trait Copy { }\n-\n+impl Copy for u32 {}\n \n \n // CHECK: define i32 @peach{{.*}}[[PEACH_ATTRS:\\#[0-9]+]] {"}, {"sha": "7f0f678062a64b3295343054993a21f47ebe0a2a", "filename": "src/test/codegen/riscv-abi/riscv64-lp64-lp64f-lp64d-abi.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Friscv-abi%2Friscv64-lp64-lp64f-lp64d-abi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fcodegen%2Friscv-abi%2Friscv64-lp64-lp64f-lp64d-abi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Friscv-abi%2Friscv64-lp64-lp64f-lp64d-abi.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -10,6 +10,14 @@\n trait Sized {}\n #[lang = \"copy\"]\n trait Copy {}\n+impl Copy for bool {}\n+impl Copy for i8 {}\n+impl Copy for u8 {}\n+impl Copy for i32 {}\n+impl Copy for i64 {}\n+impl Copy for u64 {}\n+impl Copy for f32 {}\n+impl Copy for f64 {}\n \n // CHECK: define void @f_void()\n #[no_mangle]"}, {"sha": "bbc039bdf5c7bec56625d64c98ba26038f0d1c54", "filename": "src/test/ui/cmse-nonsecure/cmse-nonsecure-call/params-on-registers.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-call%2Fparams-on-registers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-call%2Fparams-on-registers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-call%2Fparams-on-registers.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -7,6 +7,7 @@\n pub trait Sized { }\n #[lang=\"copy\"]\n pub trait Copy { }\n+impl Copy for u32 {}\n \n extern \"rust-intrinsic\" {\n     pub fn transmute<T, U>(e: T) -> U;"}, {"sha": "b8112b20a54c6429832283028feb298334f2c64b", "filename": "src/test/ui/cmse-nonsecure/cmse-nonsecure-call/params-on-stack.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-call%2Fparams-on-stack.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-call%2Fparams-on-stack.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-call%2Fparams-on-stack.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -7,6 +7,7 @@\n pub trait Sized { }\n #[lang=\"copy\"]\n pub trait Copy { }\n+impl Copy for u32 {}\n \n extern \"rust-intrinsic\" {\n     pub fn transmute<T, U>(e: T) -> U;"}, {"sha": "5591a8a5864b5bb8e2d15e1e5799d18c07d7eecb", "filename": "src/test/ui/cmse-nonsecure/cmse-nonsecure-entry/params-on-registers.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-entry%2Fparams-on-registers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-entry%2Fparams-on-registers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-entry%2Fparams-on-registers.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -7,6 +7,7 @@\n trait Sized { }\n #[lang=\"copy\"]\n trait Copy { }\n+impl Copy for u32 {}\n \n #[no_mangle]\n #[cmse_nonsecure_entry]"}, {"sha": "39b41dac41f773aa86de0243068e64e8189f4205", "filename": "src/test/ui/cmse-nonsecure/cmse-nonsecure-entry/params-on-stack.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-entry%2Fparams-on-stack.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54408f096377190a7faf67cb7ef4eda6e1ed4700/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-entry%2Fparams-on-stack.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcmse-nonsecure%2Fcmse-nonsecure-entry%2Fparams-on-stack.rs?ref=54408f096377190a7faf67cb7ef4eda6e1ed4700", "patch": "@@ -7,6 +7,7 @@\n trait Sized { }\n #[lang=\"copy\"]\n trait Copy { }\n+impl Copy for u32 {}\n \n #[no_mangle]\n #[cmse_nonsecure_entry]"}]}