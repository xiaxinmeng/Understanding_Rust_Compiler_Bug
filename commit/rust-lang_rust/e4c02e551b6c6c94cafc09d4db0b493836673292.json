{"sha": "e4c02e551b6c6c94cafc09d4db0b493836673292", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0YzAyZTU1MWI2YzZjOTRjYWZjMDlkNGRiMGI0OTM4MzY2NzMyOTI=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2017-12-21T13:12:36Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2017-12-21T13:12:36Z"}, "message": "Adjust the rules for underscores", "tree": {"sha": "8cdd826cfea98aaf960895da703dbeba31673758", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8cdd826cfea98aaf960895da703dbeba31673758"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e4c02e551b6c6c94cafc09d4db0b493836673292", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e4c02e551b6c6c94cafc09d4db0b493836673292", "html_url": "https://github.com/rust-lang/rust/commit/e4c02e551b6c6c94cafc09d4db0b493836673292", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e4c02e551b6c6c94cafc09d4db0b493836673292/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "url": "https://api.github.com/repos/rust-lang/rust/commits/2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "html_url": "https://github.com/rust-lang/rust/commit/2535804aa0bf2f0b7f230793ece8a5b39b980ec7"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "123dbe807fb09e70d09c2d64e1daeced6b329b2f", "filename": "src/librustc_lint/bad_style.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e4c02e551b6c6c94cafc09d4db0b493836673292/src%2Flibrustc_lint%2Fbad_style.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e4c02e551b6c6c94cafc09d4db0b493836673292/src%2Flibrustc_lint%2Fbad_style.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbad_style.rs?ref=e4c02e551b6c6c94cafc09d4db0b493836673292", "patch": "@@ -24,7 +24,8 @@ use rustc::hir::intravisit::FnKind;\n use regex::Regex;\n \n lazy_static! {\n-    static ref ALPHABETIC_UNDERSCORE: Regex = Regex::new(\"([[:alpha:]])_([[:alpha:]])\").unwrap();\n+    static ref ALPHABETIC_UNDERSCORE: Regex =\n+        Regex::new(\"([[:alpha:]])_+|_+([[:alpha:]])\").unwrap();\n }\n \n #[derive(PartialEq)]\n@@ -69,11 +70,12 @@ impl NonCamelCaseTypes {\n             // start with a non-lowercase letter rather than non-uppercase\n             // ones (some scripts don't have a concept of upper/lowercase)\n             !name.is_empty() && !name.chars().next().unwrap().is_lowercase() &&\n-                !ALPHABETIC_UNDERSCORE.is_match(name)\n+                !name.contains(\"__\") && !ALPHABETIC_UNDERSCORE.is_match(name)\n         }\n \n         fn to_camel_case(s: &str) -> String {\n-            let s = s.split('_')\n+            let s = s.trim_matches('_')\n+                     .split('_')\n                         .map(|word| {\n                             word.chars().enumerate().map(|(i, c)| if i == 0 {\n                                 c.to_uppercase().collect::<String>()\n@@ -83,6 +85,7 @@ impl NonCamelCaseTypes {\n                             .collect::<Vec<_>>()\n                             .concat()\n                         })\n+                        .filter(|x| !x.is_empty())\n                         .collect::<Vec<_>>()\n                         .join(\"_\");\n             ALPHABETIC_UNDERSCORE.replace_all(s.as_str(), \"$1$2\").to_string()"}]}