{"sha": "f0ff2d32c89c2bdec65f55c8a82eb92bd562d231", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwZmYyZDMyYzg5YzJiZGVjNjVmNTVjOGE4MmViOTJiZDU2MmQyMzE=", "commit": {"author": {"name": "Chris Stankus", "email": "cdstankus@gmail.com", "date": "2016-08-17T01:47:45Z"}, "committer": {"name": "Chris Stankus", "email": "cdstankus@gmail.com", "date": "2016-08-17T01:49:09Z"}, "message": "E0403 update error format", "tree": {"sha": "f1fc9231b3355977c1d531eea538a642e443ff48", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1fc9231b3355977c1d531eea538a642e443ff48"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231", "html_url": "https://github.com/rust-lang/rust/commit/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231/comments", "author": {"login": "circuitfox", "id": 6395282, "node_id": "MDQ6VXNlcjYzOTUyODI=", "avatar_url": "https://avatars.githubusercontent.com/u/6395282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/circuitfox", "html_url": "https://github.com/circuitfox", "followers_url": "https://api.github.com/users/circuitfox/followers", "following_url": "https://api.github.com/users/circuitfox/following{/other_user}", "gists_url": "https://api.github.com/users/circuitfox/gists{/gist_id}", "starred_url": "https://api.github.com/users/circuitfox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/circuitfox/subscriptions", "organizations_url": "https://api.github.com/users/circuitfox/orgs", "repos_url": "https://api.github.com/users/circuitfox/repos", "events_url": "https://api.github.com/users/circuitfox/events{/privacy}", "received_events_url": "https://api.github.com/users/circuitfox/received_events", "type": "User", "site_admin": false}, "committer": {"login": "circuitfox", "id": 6395282, "node_id": "MDQ6VXNlcjYzOTUyODI=", "avatar_url": "https://avatars.githubusercontent.com/u/6395282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/circuitfox", "html_url": "https://github.com/circuitfox", "followers_url": "https://api.github.com/users/circuitfox/followers", "following_url": "https://api.github.com/users/circuitfox/following{/other_user}", "gists_url": "https://api.github.com/users/circuitfox/gists{/gist_id}", "starred_url": "https://api.github.com/users/circuitfox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/circuitfox/subscriptions", "organizations_url": "https://api.github.com/users/circuitfox/orgs", "repos_url": "https://api.github.com/users/circuitfox/repos", "events_url": "https://api.github.com/users/circuitfox/events{/privacy}", "received_events_url": "https://api.github.com/users/circuitfox/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "514d4cef24a3a463d7423bd75d17335547c6a99c", "url": "https://api.github.com/repos/rust-lang/rust/commits/514d4cef24a3a463d7423bd75d17335547c6a99c", "html_url": "https://github.com/rust-lang/rust/commit/514d4cef24a3a463d7423bd75d17335547c6a99c"}], "stats": {"total": 32, "additions": 20, "deletions": 12}, "files": [{"sha": "8242bf97b11e0e81d5f718969d18c6c42f893406", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 18, "deletions": 12, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=f0ff2d32c89c2bdec65f55c8a82eb92bd562d231", "patch": "@@ -103,7 +103,7 @@ enum ResolutionError<'a> {\n     /// error E0402: cannot use an outer type parameter in this context\n     OuterTypeParameterContext,\n     /// error E0403: the name is already used for a type parameter in this type parameter list\n-    NameAlreadyUsedInTypeParameterList(Name),\n+    NameAlreadyUsedInTypeParameterList(Name, &'a Span),\n     /// error E0404: is not a trait\n     IsNotATrait(&'a str),\n     /// error E0405: use of undeclared trait name\n@@ -210,13 +210,17 @@ fn resolve_struct_error<'b, 'a: 'b, 'c>(resolver: &'b Resolver<'a>,\n                              E0402,\n                              \"cannot use an outer type parameter in this context\")\n         }\n-        ResolutionError::NameAlreadyUsedInTypeParameterList(name) => {\n-            struct_span_err!(resolver.session,\n-                             span,\n-                             E0403,\n-                             \"the name `{}` is already used for a type parameter in this type \\\n-                              parameter list\",\n-                             name)\n+        ResolutionError::NameAlreadyUsedInTypeParameterList(name, first_use_span) => {\n+             let mut err = struct_span_err!(resolver.session,\n+                                            span,\n+                                            E0403,\n+                                            \"the name `{}` is already used for a type parameter \\\n+                                            in this type parameter list\",\n+                                            name);\n+             err.span_label(span, &format!(\"already used\"));\n+             err.span_label(first_use_span.clone(), &format!(\"first use of `{}`\", name));\n+             err\n+\n         }\n         ResolutionError::IsNotATrait(name) => {\n             let mut err = struct_span_err!(resolver.session,\n@@ -1731,17 +1735,19 @@ impl<'a> Resolver<'a> {\n         match type_parameters {\n             HasTypeParameters(generics, space, rib_kind) => {\n                 let mut function_type_rib = Rib::new(rib_kind);\n-                let mut seen_bindings = HashSet::new();\n+                let mut seen_bindings = HashMap::new();\n                 for (index, type_parameter) in generics.ty_params.iter().enumerate() {\n                     let name = type_parameter.ident.name;\n                     debug!(\"with_type_parameter_rib: {}\", type_parameter.id);\n \n-                    if seen_bindings.contains(&name) {\n+                    if seen_bindings.contains_key(&name) {\n+                        let span = seen_bindings.get(&name).unwrap();\n                         resolve_error(self,\n                                       type_parameter.span,\n-                                      ResolutionError::NameAlreadyUsedInTypeParameterList(name));\n+                                      ResolutionError::NameAlreadyUsedInTypeParameterList(name,\n+                                                                                          span));\n                     }\n-                    seen_bindings.insert(name);\n+                    seen_bindings.entry(name).or_insert(type_parameter.span);\n \n                     // plain insert (no renaming)\n                     let def_id = self.definitions.local_def_id(type_parameter.id);"}, {"sha": "cd8532fc4c305bebf8cb399d9747010fb3f4d651", "filename": "src/test/compile-fail/E0403.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231/src%2Ftest%2Fcompile-fail%2FE0403.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0ff2d32c89c2bdec65f55c8a82eb92bd562d231/src%2Ftest%2Fcompile-fail%2FE0403.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0403.rs?ref=f0ff2d32c89c2bdec65f55c8a82eb92bd562d231", "patch": "@@ -9,6 +9,8 @@\n // except according to those terms.\n \n fn foo<T, T>(s: T, u: T) {} //~ ERROR E0403\n+                            //~| NOTE already used\n+                            //~| NOTE first use of `T`\n \n fn main() {\n }"}]}