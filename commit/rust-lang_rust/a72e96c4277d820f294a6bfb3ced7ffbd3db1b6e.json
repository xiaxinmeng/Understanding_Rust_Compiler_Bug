{"sha": "a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e", "node_id": "C_kwDOAAsO6NoAKGE3MmU5NmM0Mjc3ZDgyMGYyOTRhNmJmYjNjZWQ3ZmZiZDNkYjFiNmU", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-08-03T09:35:32Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-08-03T09:39:05Z"}, "message": "remove Clean trait implementation for ty::Region", "tree": {"sha": "4fa8530ff7afe58f50fe704c3c568fdf6af7b1df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4fa8530ff7afe58f50fe704c3c568fdf6af7b1df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e", "html_url": "https://github.com/rust-lang/rust/commit/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e141246cbbce2a6001f3181d3d0f661bbfd9c7ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/e141246cbbce2a6001f3181d3d0f661bbfd9c7ea", "html_url": "https://github.com/rust-lang/rust/commit/e141246cbbce2a6001f3181d3d0f661bbfd9c7ea"}], "stats": {"total": 67, "additions": 34, "deletions": 33}, "files": [{"sha": "9e83021a5fbe43464c51c289d96c9747c2219b1c", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 30, "deletions": 29, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e", "patch": "@@ -242,30 +242,28 @@ pub(crate) fn clean_middle_const<'tcx>(\n     }\n }\n \n-impl<'tcx> Clean<'tcx, Option<Lifetime>> for ty::Region<'tcx> {\n-    fn clean(&self, _cx: &mut DocContext<'_>) -> Option<Lifetime> {\n-        match **self {\n-            ty::ReStatic => Some(Lifetime::statik()),\n-            ty::ReLateBound(_, ty::BoundRegion { kind: ty::BrNamed(_, name), .. }) => {\n-                if name != kw::UnderscoreLifetime { Some(Lifetime(name)) } else { None }\n-            }\n-            ty::ReEarlyBound(ref data) => {\n-                if data.name != kw::UnderscoreLifetime {\n-                    Some(Lifetime(data.name))\n-                } else {\n-                    None\n-                }\n-            }\n-            ty::ReLateBound(..)\n-            | ty::ReFree(..)\n-            | ty::ReVar(..)\n-            | ty::RePlaceholder(..)\n-            | ty::ReEmpty(_)\n-            | ty::ReErased => {\n-                debug!(\"cannot clean region {:?}\", self);\n+pub(crate) fn clean_middle_region<'tcx>(region: ty::Region<'tcx>) -> Option<Lifetime> {\n+    match *region {\n+        ty::ReStatic => Some(Lifetime::statik()),\n+        ty::ReLateBound(_, ty::BoundRegion { kind: ty::BrNamed(_, name), .. }) => {\n+            if name != kw::UnderscoreLifetime { Some(Lifetime(name)) } else { None }\n+        }\n+        ty::ReEarlyBound(ref data) => {\n+            if data.name != kw::UnderscoreLifetime {\n+                Some(Lifetime(data.name))\n+            } else {\n                 None\n             }\n         }\n+        ty::ReLateBound(..)\n+        | ty::ReFree(..)\n+        | ty::ReVar(..)\n+        | ty::RePlaceholder(..)\n+        | ty::ReEmpty(_)\n+        | ty::ReErased => {\n+            debug!(\"cannot clean region {:?}\", region);\n+            None\n+        }\n     }\n }\n \n@@ -316,7 +314,7 @@ impl<'tcx> Clean<'tcx, Option<WherePredicate>> for ty::Predicate<'tcx> {\n             ty::PredicateKind::Trait(pred) => {\n                 clean_poly_trait_predicate(bound_predicate.rebind(pred), cx)\n             }\n-            ty::PredicateKind::RegionOutlives(pred) => clean_region_outlives_predicate(pred, cx),\n+            ty::PredicateKind::RegionOutlives(pred) => clean_region_outlives_predicate(pred),\n             ty::PredicateKind::TypeOutlives(pred) => clean_type_outlives_predicate(pred, cx),\n             ty::PredicateKind::Projection(pred) => Some(clean_projection_predicate(pred, cx)),\n             ty::PredicateKind::ConstEvaluatable(..) => None,\n@@ -353,7 +351,6 @@ fn clean_poly_trait_predicate<'tcx>(\n \n fn clean_region_outlives_predicate<'tcx>(\n     pred: ty::OutlivesPredicate<ty::Region<'tcx>, ty::Region<'tcx>>,\n-    cx: &mut DocContext<'tcx>,\n ) -> Option<WherePredicate> {\n     let ty::OutlivesPredicate(a, b) = pred;\n \n@@ -362,8 +359,10 @@ fn clean_region_outlives_predicate<'tcx>(\n     }\n \n     Some(WherePredicate::RegionPredicate {\n-        lifetime: a.clean(cx).expect(\"failed to clean lifetime\"),\n-        bounds: vec![GenericBound::Outlives(b.clean(cx).expect(\"failed to clean bounds\"))],\n+        lifetime: clean_middle_region(a).expect(\"failed to clean lifetime\"),\n+        bounds: vec![GenericBound::Outlives(\n+            clean_middle_region(b).expect(\"failed to clean bounds\"),\n+        )],\n     })\n }\n \n@@ -379,7 +378,9 @@ fn clean_type_outlives_predicate<'tcx>(\n \n     Some(WherePredicate::BoundPredicate {\n         ty: clean_middle_ty(ty, cx, None),\n-        bounds: vec![GenericBound::Outlives(lt.clean(cx).expect(\"failed to clean lifetimes\"))],\n+        bounds: vec![GenericBound::Outlives(\n+            clean_middle_region(lt).expect(\"failed to clean lifetimes\"),\n+        )],\n         bound_params: Vec::new(),\n     })\n }\n@@ -1592,7 +1593,7 @@ pub(crate) fn clean_middle_ty<'tcx>(\n         }\n         ty::RawPtr(mt) => RawPointer(mt.mutbl, Box::new(clean_middle_ty(mt.ty, cx, None))),\n         ty::Ref(r, ty, mutbl) => BorrowedRef {\n-            lifetime: r.clean(cx),\n+            lifetime: clean_middle_region(r),\n             mutability: mutbl,\n             type_: Box::new(clean_middle_ty(ty, cx, None)),\n         },\n@@ -1639,7 +1640,7 @@ pub(crate) fn clean_middle_ty<'tcx>(\n \n             inline::record_extern_fqn(cx, did, ItemType::Trait);\n \n-            let lifetime = reg.clean(cx);\n+            let lifetime = clean_middle_region(*reg);\n             let mut bounds = vec![];\n \n             for did in dids {\n@@ -1705,7 +1706,7 @@ pub(crate) fn clean_middle_ty<'tcx>(\n                     let trait_ref = match bound_predicate.skip_binder() {\n                         ty::PredicateKind::Trait(tr) => bound_predicate.rebind(tr.trait_ref),\n                         ty::PredicateKind::TypeOutlives(ty::OutlivesPredicate(_ty, reg)) => {\n-                            if let Some(r) = reg.clean(cx) {\n+                            if let Some(r) = clean_middle_region(reg) {\n                                 regions.push(GenericBound::Outlives(r));\n                             }\n                             return None;"}, {"sha": "43e71e90a6f5bde9418371a70038e74afd5b18c7", "filename": "src/librustdoc/clean/utils.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e/src%2Flibrustdoc%2Fclean%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e/src%2Flibrustdoc%2Fclean%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Futils.rs?ref=a72e96c4277d820f294a6bfb3ced7ffbd3db1b6e", "patch": "@@ -2,9 +2,9 @@ use crate::clean::auto_trait::AutoTraitFinder;\n use crate::clean::blanket_impl::BlanketImplFinder;\n use crate::clean::render_macro_matchers::render_macro_matcher;\n use crate::clean::{\n-    clean_middle_const, clean_middle_ty, inline, Clean, Crate, ExternalCrate, Generic, GenericArg,\n-    GenericArgs, ImportSource, Item, ItemKind, Lifetime, Path, PathSegment, Primitive,\n-    PrimitiveType, Type, TypeBinding, Visibility,\n+    clean_middle_const, clean_middle_region, clean_middle_ty, inline, Clean, Crate, ExternalCrate,\n+    Generic, GenericArg, GenericArgs, ImportSource, Item, ItemKind, Lifetime, Path, PathSegment,\n+    Primitive, PrimitiveType, Type, TypeBinding, Visibility,\n };\n use crate::core::DocContext;\n use crate::formats::item_type::ItemType;\n@@ -86,7 +86,7 @@ pub(crate) fn substs_to_args<'tcx>(\n         Vec::with_capacity(substs.len().saturating_sub(if skip_first { 1 } else { 0 }));\n     ret_val.extend(substs.iter().filter_map(|kind| match kind.unpack() {\n         GenericArgKind::Lifetime(lt) => {\n-            Some(GenericArg::Lifetime(lt.clean(cx).unwrap_or(Lifetime::elided())))\n+            Some(GenericArg::Lifetime(clean_middle_region(lt).unwrap_or(Lifetime::elided())))\n         }\n         GenericArgKind::Type(_) if skip_first => {\n             skip_first = false;"}]}