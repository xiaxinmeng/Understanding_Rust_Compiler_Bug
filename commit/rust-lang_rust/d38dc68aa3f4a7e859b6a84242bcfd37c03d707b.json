{"sha": "d38dc68aa3f4a7e859b6a84242bcfd37c03d707b", "node_id": "C_kwDOAAsO6NoAKGQzOGRjNjhhYTNmNGE3ZTg1OWI2YTg0MjQyYmNmZDM3YzAzZDcwN2I", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-10-19T04:19:45Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-10-19T04:20:48Z"}, "message": "Use already checked RHS ty for LHS deref suggestions", "tree": {"sha": "c25c78c4715d82bbc16c2bc75239fdd514503f94", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c25c78c4715d82bbc16c2bc75239fdd514503f94"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b", "html_url": "https://github.com/rust-lang/rust/commit/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a24a020e6d926dffe6b472fc647978f92269504e", "url": "https://api.github.com/repos/rust-lang/rust/commits/a24a020e6d926dffe6b472fc647978f92269504e", "html_url": "https://github.com/rust-lang/rust/commit/a24a020e6d926dffe6b472fc647978f92269504e"}], "stats": {"total": 224, "additions": 219, "deletions": 5}, "files": [{"sha": "ccdfd3a056b8349e6dadf245b868cb90518347d1", "filename": "compiler/rustc_hir_analysis/src/check/expr.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fexpr.rs?ref=d38dc68aa3f4a7e859b6a84242bcfd37c03d707b", "patch": "@@ -1130,11 +1130,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             }\n         };\n \n-        self.check_lhs_assignable(lhs, \"E0070\", span, |err| {\n-            let rhs_ty = self.check_expr(&rhs);\n-            suggest_deref_binop(err, rhs_ty);\n-        });\n-\n         // This is (basically) inlined `check_expr_coercable_to_type`, but we want\n         // to suggest an additional fixup here in `suggest_deref_binop`.\n         let rhs_ty = self.check_expr_with_hint(&rhs, lhs_ty);\n@@ -1145,6 +1140,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             diag.emit();\n         }\n \n+        self.check_lhs_assignable(lhs, \"E0070\", span, |err| {\n+            if let Some(rhs_ty) = self.typeck_results.borrow().expr_ty_opt(rhs) {\n+                suggest_deref_binop(err, rhs_ty);\n+            }\n+        });\n+\n         self.require_type_is_sized(lhs_ty, lhs.span, traits::AssignmentLhsSized);\n \n         if lhs_ty.references_error() || rhs_ty.references_error() {"}, {"sha": "80dfd683524ce627c11c2c219055ad256a94da29", "filename": "src/test/ui/typeck/slow-lhs-suggestion.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b/src%2Ftest%2Fui%2Ftypeck%2Fslow-lhs-suggestion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b/src%2Ftest%2Fui%2Ftypeck%2Fslow-lhs-suggestion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fslow-lhs-suggestion.rs?ref=d38dc68aa3f4a7e859b6a84242bcfd37c03d707b", "patch": "@@ -0,0 +1,26 @@\n+fn main() {\n+    1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+    //~^ ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+    //~| ERROR invalid left-hand side of assignment\n+}"}, {"sha": "c5bf795eeee6acf939f2836b8ea649281372e777", "filename": "src/test/ui/typeck/slow-lhs-suggestion.stderr", "status": "added", "additions": 187, "deletions": 0, "changes": 187, "blob_url": "https://github.com/rust-lang/rust/blob/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b/src%2Ftest%2Fui%2Ftypeck%2Fslow-lhs-suggestion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d38dc68aa3f4a7e859b6a84242bcfd37c03d707b/src%2Ftest%2Fui%2Ftypeck%2Fslow-lhs-suggestion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fslow-lhs-suggestion.stderr?ref=d38dc68aa3f4a7e859b6a84242bcfd37c03d707b", "patch": "@@ -0,0 +1,187 @@\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:95\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                                             - ^\n+   |                                                                                             |\n+   |                                                                                             cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:91\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                                         - ^\n+   |                                                                                         |\n+   |                                                                                         cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:87\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                                     - ^\n+   |                                                                                     |\n+   |                                                                                     cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:83\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                                 - ^\n+   |                                                                                 |\n+   |                                                                                 cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:79\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                             - ^\n+   |                                                                             |\n+   |                                                                             cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:75\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                         - ^\n+   |                                                                         |\n+   |                                                                         cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:71\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                     - ^\n+   |                                                                     |\n+   |                                                                     cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:67\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                                 - ^\n+   |                                                                 |\n+   |                                                                 cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:63\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                             - ^\n+   |                                                             |\n+   |                                                             cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:59\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                         - ^\n+   |                                                         |\n+   |                                                         cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:55\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                     - ^\n+   |                                                     |\n+   |                                                     cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:51\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                                 - ^\n+   |                                                 |\n+   |                                                 cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:47\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                             - ^\n+   |                                             |\n+   |                                             cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:43\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                         - ^\n+   |                                         |\n+   |                                         cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:39\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                     - ^\n+   |                                     |\n+   |                                     cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:35\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                                 - ^\n+   |                                 |\n+   |                                 cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:31\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                             - ^\n+   |                             |\n+   |                             cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:27\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                         - ^\n+   |                         |\n+   |                         cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:23\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                     - ^\n+   |                     |\n+   |                     cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:19\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |                 - ^\n+   |                 |\n+   |                 cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:15\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |             - ^\n+   |             |\n+   |             cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:11\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |         - ^\n+   |         |\n+   |         cannot assign to this expression\n+\n+error[E0070]: invalid left-hand side of assignment\n+  --> $DIR/slow-lhs-suggestion.rs:2:7\n+   |\n+LL |     1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1 = 1;\n+   |     - ^\n+   |     |\n+   |     cannot assign to this expression\n+\n+error: aborting due to 23 previous errors\n+\n+For more information about this error, try `rustc --explain E0070`."}]}