{"sha": "a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyYzlkMTBkYTU4MWNhYzllYjQ1ZDJjMDYxMjRiYzRlYmE5YjI4MGE=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-11-15T14:18:12Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-11-15T14:18:12Z"}, "message": "Merge #3419\n\n3419: Linter to check that all common metadata is included r=flip1995 a=ysimonson\n\nAddresses https://github.com/rust-lang-nursery/rust-clippy/issues/1793\r\n\r\nThis is not ready to be merged yet. First the associated changes to `cargo_metadata` need to be merged: https://github.com/oli-obk/cargo_metadata/pull/55\n\nCo-authored-by: Yusuf Simonson <simonson@gmail.com>", "tree": {"sha": "bf7f62b052cb72f8a1c334f4c7f19c9b4cfce571", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf7f62b052cb72f8a1c334f4c7f19c9b4cfce571"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "html_url": "https://github.com/rust-lang/rust/commit/a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "7e0ddef4e7e1c1d891998c676ad7eda7cf0d9ea8", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e0ddef4e7e1c1d891998c676ad7eda7cf0d9ea8", "html_url": "https://github.com/rust-lang/rust/commit/7e0ddef4e7e1c1d891998c676ad7eda7cf0d9ea8"}, {"sha": "866caabb7a1308ee263992414def2074b00db514", "url": "https://api.github.com/repos/rust-lang/rust/commits/866caabb7a1308ee263992414def2074b00db514", "html_url": "https://github.com/rust-lang/rust/commit/866caabb7a1308ee263992414def2074b00db514"}], "stats": {"total": 125, "additions": 122, "deletions": 3}, "files": [{"sha": "3237f76b4aee8de06164c0a6c164cbf82d5bcf50", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "patch": "@@ -628,6 +628,7 @@ All notable changes to this project will be documented in this file.\n [`box_vec`]: https://rust-lang-nursery.github.io/rust-clippy/master/index.html#box_vec\n [`boxed_local`]: https://rust-lang-nursery.github.io/rust-clippy/master/index.html#boxed_local\n [`builtin_type_shadow`]: https://rust-lang-nursery.github.io/rust-clippy/master/index.html#builtin_type_shadow\n+[`cargo_common_metadata`]: https://rust-lang-nursery.github.io/rust-clippy/master/index.html#cargo_common_metadata\n [`cast_lossless`]: https://rust-lang-nursery.github.io/rust-clippy/master/index.html#cast_lossless\n [`cast_possible_truncation`]: https://rust-lang-nursery.github.io/rust-clippy/master/index.html#cast_possible_truncation\n [`cast_possible_wrap`]: https://rust-lang-nursery.github.io/rust-clippy/master/index.html#cast_possible_wrap"}, {"sha": "0a1f3dabb933d1d8a7eab9006dc9782cdc7264fd", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "patch": "@@ -47,7 +47,7 @@ rustc_tools_util = { version = \"0.1.0\", path = \"rustc_tools_util\"}\n \n [dev-dependencies]\n clippy_dev = { version = \"0.0.1\", path = \"clippy_dev\" }\n-cargo_metadata = \"0.6\"\n+cargo_metadata = \"0.6.2\"\n compiletest_rs = \"0.3.16\"\n lazy_static = \"1.0\"\n serde_derive = \"1.0\""}, {"sha": "47db3a358e3f417f5f5824c6a4469823fa219b87", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "patch": "@@ -9,7 +9,7 @@ We are currently in the process of discussing Clippy 1.0 via the RFC process in\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are 287 lints included in this crate!](https://rust-lang-nursery.github.io/rust-clippy/master/index.html)\n+[There are 288 lints included in this crate!](https://rust-lang-nursery.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "fa1b22784bdef868680394400541360bb7427b40", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "patch": "@@ -17,7 +17,7 @@ keywords = [\"clippy\", \"lint\", \"plugin\"]\n edition = \"2018\"\n \n [dependencies]\n-cargo_metadata = \"0.6\"\n+cargo_metadata = \"0.6.2\"\n itertools = \"0.7\"\n lazy_static = \"1.0.2\"\n matches = \"0.1.7\""}, {"sha": "1a053de27d132d3d2225c5fa62553dad639bc06c", "filename": "clippy_lints/src/cargo_common_metadata.rs", "status": "added", "additions": 115, "deletions": 0, "changes": 115, "blob_url": "https://github.com/rust-lang/rust/blob/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs?ref=a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "patch": "@@ -0,0 +1,115 @@\n+// Copyright 2014-2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+//! lint on missing cargo common metadata\n+\n+use crate::rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n+use crate::rustc::{declare_tool_lint, lint_array};\n+use crate::syntax::{ast::*, source_map::DUMMY_SP};\n+use crate::utils::span_lint;\n+\n+use cargo_metadata;\n+\n+/// **What it does:** Checks to see if all common metadata is defined in\n+/// `Cargo.toml`. See: https://rust-lang-nursery.github.io/api-guidelines/documentation.html#cargotoml-includes-all-common-metadata-c-metadata\n+///\n+/// **Why is this bad?** It will be more difficult for users to discover the\n+/// purpose of the crate, and key information related to it.\n+///\n+/// **Known problems:** None.\n+///\n+/// **Example:**\n+/// ```toml\n+/// # This `Cargo.toml` is missing an authors field:\n+/// [package]\n+/// name = \"clippy\"\n+/// version = \"0.0.212\"\n+/// description = \"A bunch of helpful lints to avoid common pitfalls in Rust\"\n+/// repository = \"https://github.com/rust-lang-nursery/rust-clippy\"\n+/// readme = \"README.md\"\n+/// license = \"MIT/Apache-2.0\"\n+/// keywords = [\"clippy\", \"lint\", \"plugin\"]\n+/// categories = [\"development-tools\", \"development-tools::cargo-plugins\"]\n+/// ```\n+declare_clippy_lint! {\n+    pub CARGO_COMMON_METADATA,\n+    cargo,\n+    \"common metadata is defined in `Cargo.toml`\"\n+}\n+\n+fn warning(cx: &EarlyContext<'_>, message: &str) {\n+    span_lint(cx, CARGO_COMMON_METADATA, DUMMY_SP, message);\n+}\n+\n+fn missing_warning(cx: &EarlyContext<'_>, package: &cargo_metadata::Package, field: &str) {\n+    let message = format!(\"package `{}` is missing `{}` metadata\", package.name, field);\n+    warning(cx, &message);\n+}\n+\n+fn is_empty_str(value: &Option<String>) -> bool {\n+    match value {\n+        None => true,\n+        Some(value) if value.is_empty() => true,\n+        _ => false\n+    }\n+}\n+\n+fn is_empty_vec(value: &[String]) -> bool {\n+    // This works because empty iterators return true\n+    value.iter().all(|v| v.is_empty())\n+}\n+\n+pub struct Pass;\n+\n+impl LintPass for Pass {\n+    fn get_lints(&self) -> LintArray {\n+        lint_array!(CARGO_COMMON_METADATA)\n+    }\n+}\n+\n+impl EarlyLintPass for Pass {\n+    fn check_crate(&mut self, cx: &EarlyContext<'_>, _: &Crate) {\n+        let metadata = if let Ok(metadata) = cargo_metadata::metadata_deps(None, true) {\n+            metadata\n+        } else {\n+            warning(cx, \"could not read cargo metadata\");\n+            return;\n+        };\n+\n+        for package in metadata.packages {\n+            if is_empty_vec(&package.authors) {\n+                missing_warning(cx, &package, \"package.authors\");\n+            }\n+\n+            if is_empty_str(&package.description) {\n+                missing_warning(cx, &package, \"package.description\");\n+            }\n+\n+            if is_empty_str(&package.license) {\n+                missing_warning(cx, &package, \"package.license\");\n+            }\n+\n+            if is_empty_str(&package.repository) {\n+                missing_warning(cx, &package, \"package.repository\");\n+            }\n+\n+            if is_empty_str(&package.readme) {\n+                missing_warning(cx, &package, \"package.readme\");\n+            }\n+\n+            if is_empty_vec(&package.keywords) {\n+                missing_warning(cx, &package, \"package.keywords\");\n+            }\n+\n+            if is_empty_vec(&package.categories) {\n+                missing_warning(cx, &package, \"package.categories\");\n+            }\n+        }\n+    }\n+}"}, {"sha": "6ebe9df6a1ef5ac0bffb752fb346fc4461326817", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a2c9d10da581cac9eb45d2c06124bc4eba9b280a/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=a2c9d10da581cac9eb45d2c06124bc4eba9b280a", "patch": "@@ -96,6 +96,7 @@ pub mod blacklisted_name;\n pub mod block_in_if_condition;\n pub mod booleans;\n pub mod bytecount;\n+pub mod cargo_common_metadata;\n pub mod collapsible_if;\n pub mod const_static_lifetime;\n pub mod copies;\n@@ -444,6 +445,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n     reg.register_late_lint_pass(box double_comparison::Pass);\n     reg.register_late_lint_pass(box question_mark::Pass);\n     reg.register_late_lint_pass(box suspicious_trait_impl::SuspiciousImpl);\n+    reg.register_early_lint_pass(box cargo_common_metadata::Pass);\n     reg.register_early_lint_pass(box multiple_crate_versions::Pass);\n     reg.register_early_lint_pass(box wildcard_dependencies::Pass);\n     reg.register_late_lint_pass(box map_unit_fn::Pass);\n@@ -985,6 +987,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n     ]);\n \n     reg.register_lint_group(\"clippy::cargo\", Some(\"clippy_cargo\"), vec![\n+        cargo_common_metadata::CARGO_COMMON_METADATA,\n         multiple_crate_versions::MULTIPLE_CRATE_VERSIONS,\n         wildcard_dependencies::WILDCARD_DEPENDENCIES,\n     ]);"}]}