{"sha": "400e955d8bbff8c3abc3c43c74fc255a70cf885e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwMGU5NTVkOGJiZmY4YzNhYmMzYzQzYzc0ZmMyNTVhNzBjZjg4NWU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-11T21:35:10Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-11T21:35:10Z"}, "message": "Auto merge of #26199 - swgillespie:issue-26092, r=alexcrichton\n\n`driver::build_output_filenames` calls `file_stem` on a PathBuf obtained from the output file compiler flag. It's possible to pass the empty string to this compiler flag. When file_stem is called on an empty Path, it returns None, which is unwrapped and the compiler panics.\r\n\r\nThis change modifies the `unwrap` to an `unwrap_or` so that the empty string is passed through the compilation pipeline until it reaches `trans::back::write_output_file`, which will emit an appropriate error.\r\n\r\nInstead of panicking, the error that is emitted now is:\r\n\r\n```\r\n$ rustc -o \"\" thing.rs\r\nerror: could not write output to : No such file or directory\r\n```\r\n\r\nThe `:` is a little strange, but it /is/ reporting the filename (the empty string) correctly, I suppose. Both gcc and clang hand the output file to ld, which emits a similar error message when faced with the empty string as an output file:\r\n\r\n```\r\n$ clang -o \"\" thing.c\r\nld: can't open output file for writing: , errno=2 for architecture x86_64\r\n```\r\n\r\nThis PR also adds a test for this, in `run-make`. This fixes issue #26092.", "tree": {"sha": "1affb488a823427b4a7fac66dc0fc0dcc528c451", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1affb488a823427b4a7fac66dc0fc0dcc528c451"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/400e955d8bbff8c3abc3c43c74fc255a70cf885e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/400e955d8bbff8c3abc3c43c74fc255a70cf885e", "html_url": "https://github.com/rust-lang/rust/commit/400e955d8bbff8c3abc3c43c74fc255a70cf885e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/400e955d8bbff8c3abc3c43c74fc255a70cf885e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5b3a99f84f2b4dbf9495dccd7112c74f4357acc", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5b3a99f84f2b4dbf9495dccd7112c74f4357acc", "html_url": "https://github.com/rust-lang/rust/commit/b5b3a99f84f2b4dbf9495dccd7112c74f4357acc"}, {"sha": "91effb374c98927823b3032f7433e7b73a229f95", "url": "https://api.github.com/repos/rust-lang/rust/commits/91effb374c98927823b3032f7433e7b73a229f95", "html_url": "https://github.com/rust-lang/rust/commit/91effb374c98927823b3032f7433e7b73a229f95"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "eaac1eb6f2cb0ef83924d7774e1b859f319dcedd", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/400e955d8bbff8c3abc3c43c74fc255a70cf885e/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/400e955d8bbff8c3abc3c43c74fc255a70cf885e/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=400e955d8bbff8c3abc3c43c74fc255a70cf885e", "patch": "@@ -33,7 +33,7 @@ use super::Compilation;\n use serialize::json;\n \n use std::env;\n-use std::ffi::OsString;\n+use std::ffi::{OsString, OsStr};\n use std::fs;\n use std::io::{self, Write};\n use std::path::{Path, PathBuf};\n@@ -966,7 +966,7 @@ pub fn build_output_filenames(input: &Input,\n \n             OutputFilenames {\n                 out_directory: out_file.parent().unwrap_or(cur_dir).to_path_buf(),\n-                out_filestem: out_file.file_stem().unwrap()\n+                out_filestem: out_file.file_stem().unwrap_or(OsStr::new(\"\"))\n                                       .to_str().unwrap().to_string(),\n                 single_output_file: ofile,\n                 extra: sess.opts.cg.extra_filename.clone(),"}, {"sha": "1e66e3a53804f81c67727d051fac03b0838b766a", "filename": "src/test/run-make/issue-26092/Makefile", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/400e955d8bbff8c3abc3c43c74fc255a70cf885e/src%2Ftest%2Frun-make%2Fissue-26092%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/400e955d8bbff8c3abc3c43c74fc255a70cf885e/src%2Ftest%2Frun-make%2Fissue-26092%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fissue-26092%2FMakefile?ref=400e955d8bbff8c3abc3c43c74fc255a70cf885e", "patch": "@@ -0,0 +1,5 @@\n+-include ../tools.mk\n+\n+all:\n+\t\t$(RUSTC) -o \"\" blank.rs 2>&1 | \\\n+\t\t\tgrep 'No such file or directory'"}, {"sha": "8ae3d072362ed6b5db81a00be3becce691926a7f", "filename": "src/test/run-make/issue-26092/blank.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/400e955d8bbff8c3abc3c43c74fc255a70cf885e/src%2Ftest%2Frun-make%2Fissue-26092%2Fblank.rs", "raw_url": "https://github.com/rust-lang/rust/raw/400e955d8bbff8c3abc3c43c74fc255a70cf885e/src%2Ftest%2Frun-make%2Fissue-26092%2Fblank.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fissue-26092%2Fblank.rs?ref=400e955d8bbff8c3abc3c43c74fc255a70cf885e", "patch": "@@ -0,0 +1,11 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {}"}]}