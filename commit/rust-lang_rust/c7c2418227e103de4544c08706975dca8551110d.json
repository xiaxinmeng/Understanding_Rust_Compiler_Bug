{"sha": "c7c2418227e103de4544c08706975dca8551110d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3YzI0MTgyMjdlMTAzZGU0NTQ0YzA4NzA2OTc1ZGNhODU1MTExMGQ=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-02T18:27:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-02T18:27:03Z"}, "message": "Rollup merge of #76811 - GuillaumeGomez:doc-alias-name-restriction, r=oli-obk,ollie27\n\nDoc alias name restriction\n\nFixes #76705.", "tree": {"sha": "fdfc2f4475655d5c718fc393e6a5733dd3c70296", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fdfc2f4475655d5c718fc393e6a5733dd3c70296"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7c2418227e103de4544c08706975dca8551110d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfd3D3CRBK7hj4Ov3rIwAAdHIIAJ/jAufpuc0jdLtX8TpDnVz6\nMKUS1NWlXuL9hzUPxv9lHQT0891C2PqSLNKq11nNW2t/KFs3n7O7Owb76vNnwA98\n60E9Cu38QfJ3t7ZSgLiRXF4QP313cGLSdSWiT7nNg1J3bU+Q9PW3RlKr1C3hplbq\nmGTe/lFa15aL7AV2tK/3mKJcvHrqCvKDHxnwRmQtPXZuqYax1FpEncwE455k/Y9d\n/tlywBfmbzazKy7+l7IZwAoNyt88TM7WQsnM0zE5g9JT7xfF8AdNrPELZfz8AU9l\n0lTHoWmxaq/hOzaZTyd3wYr6L93clEB49M/I43CJh+EBTXymwBEAkBQqYlBOvjU=\n=40wg\n-----END PGP SIGNATURE-----\n", "payload": "tree fdfc2f4475655d5c718fc393e6a5733dd3c70296\nparent c8eb2059dae70b99576352ded93592e6462daafc\nparent 4427b2d52c42d3eb7a7aecddcbbeff59ce613ab1\nauthor Jonas Schievink <jonasschievink@gmail.com> 1601663223 +0200\ncommitter GitHub <noreply@github.com> 1601663223 +0200\n\nRollup merge of #76811 - GuillaumeGomez:doc-alias-name-restriction, r=oli-obk,ollie27\n\nDoc alias name restriction\n\nFixes #76705.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7c2418227e103de4544c08706975dca8551110d", "html_url": "https://github.com/rust-lang/rust/commit/c7c2418227e103de4544c08706975dca8551110d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7c2418227e103de4544c08706975dca8551110d/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8eb2059dae70b99576352ded93592e6462daafc", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8eb2059dae70b99576352ded93592e6462daafc", "html_url": "https://github.com/rust-lang/rust/commit/c8eb2059dae70b99576352ded93592e6462daafc"}, {"sha": "4427b2d52c42d3eb7a7aecddcbbeff59ce613ab1", "url": "https://api.github.com/repos/rust-lang/rust/commits/4427b2d52c42d3eb7a7aecddcbbeff59ce613ab1", "html_url": "https://github.com/rust-lang/rust/commit/4427b2d52c42d3eb7a7aecddcbbeff59ce613ab1"}], "stats": {"total": 118, "additions": 108, "deletions": 10}, "files": [{"sha": "b52216c45ce95a2cbff447b33b50691db12a3f47", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/c7c2418227e103de4544c08706975dca8551110d/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7c2418227e103de4544c08706975dca8551110d/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=c7c2418227e103de4544c08706975dca8551110d", "patch": "@@ -260,23 +260,42 @@ impl CheckAttrVisitor<'tcx> {\n         }\n     }\n \n+    fn doc_alias_str_error(&self, meta: &NestedMetaItem) {\n+        self.tcx\n+            .sess\n+            .struct_span_err(\n+                meta.span(),\n+                \"doc alias attribute expects a string: #[doc(alias = \\\"0\\\")]\",\n+            )\n+            .emit();\n+    }\n+\n     fn check_doc_alias(&self, attr: &Attribute, hir_id: HirId, target: Target) -> bool {\n         if let Some(mi) = attr.meta() {\n             if let Some(list) = mi.meta_item_list() {\n                 for meta in list {\n                     if meta.has_name(sym::alias) {\n-                        if !meta.is_value_str()\n-                            || meta\n-                                .value_str()\n-                                .map(|s| s.to_string())\n-                                .unwrap_or_else(String::new)\n-                                .is_empty()\n+                        if !meta.is_value_str() {\n+                            self.doc_alias_str_error(meta);\n+                            return false;\n+                        }\n+                        let doc_alias =\n+                            meta.value_str().map(|s| s.to_string()).unwrap_or_else(String::new);\n+                        if doc_alias.is_empty() {\n+                            self.doc_alias_str_error(meta);\n+                            return false;\n+                        }\n+                        if let Some(c) =\n+                            doc_alias.chars().find(|&c| c == '\"' || c == '\\'' || c.is_whitespace())\n                         {\n                             self.tcx\n                                 .sess\n                                 .struct_span_err(\n                                     meta.span(),\n-                                    \"doc alias attribute expects a string: #[doc(alias = \\\"0\\\")]\",\n+                                    &format!(\n+                                        \"{:?} character isn't allowed in `#[doc(alias = \\\"...\\\")]`\",\n+                                        c,\n+                                    ),\n                                 )\n                                 .emit();\n                             return false;\n@@ -312,6 +331,7 @@ impl CheckAttrVisitor<'tcx> {\n                                     &format!(\"`#[doc(alias = \\\"...\\\")]` isn't allowed on {}\", err),\n                                 )\n                                 .emit();\n+                            return false;\n                         }\n                     }\n                 }"}, {"sha": "8c7926f116b711102fb689ef34054a12cc77e256", "filename": "src/doc/rustdoc/src/advanced-features.md", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c7c2418227e103de4544c08706975dca8551110d/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md", "raw_url": "https://github.com/rust-lang/rust/raw/c7c2418227e103de4544c08706975dca8551110d/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md?ref=c7c2418227e103de4544c08706975dca8551110d", "patch": "@@ -46,3 +46,5 @@ pub struct BigX;\n \n Then, when looking for it through the `rustdoc` search, if you enter \"x\" or\n \"big\", search will show the `BigX` struct first.\n+\n+There are some limitations on the doc alias names though: you can't use `\"` or whitespace."}, {"sha": "8fbfb04bac3e4f40daa410c481246f0e294c4fb3", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c7c2418227e103de4544c08706975dca8551110d/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7c2418227e103de4544c08706975dca8551110d/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=c7c2418227e103de4544c08706975dca8551110d", "patch": "@@ -695,7 +695,7 @@ impl Attributes {\n         self.other_attrs\n             .lists(sym::doc)\n             .filter(|a| a.has_name(sym::alias))\n-            .filter_map(|a| a.value_str().map(|s| s.to_string().replace(\"\\\"\", \"\")))\n+            .filter_map(|a| a.value_str().map(|s| s.to_string()))\n             .filter(|v| !v.is_empty())\n             .collect::<FxHashSet<_>>()\n     }"}, {"sha": "c8bec39fad61399448f8dc06a18803d7f88735d8", "filename": "src/test/rustdoc-ui/check-doc-alias-attr.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.rs?ref=c7c2418227e103de4544c08706975dca8551110d", "patch": "@@ -7,4 +7,10 @@ pub struct Bar;\n #[doc(alias)] //~ ERROR\n #[doc(alias = 0)] //~ ERROR\n #[doc(alias(\"bar\"))] //~ ERROR\n+#[doc(alias = \"\\\"\")] //~ ERROR\n+#[doc(alias = \"\\n\")] //~ ERROR\n+#[doc(alias = \"\n+\")] //~^ ERROR\n+#[doc(alias = \" \")] //~ ERROR\n+#[doc(alias = \"\\t\")] //~ ERROR\n pub struct Foo;"}, {"sha": "be7d7b3dbea93528d6e03d3f8d6e4ea4c1888f0a", "filename": "src/test/rustdoc-ui/check-doc-alias-attr.stderr", "status": "modified", "additions": 33, "deletions": 1, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-doc-alias-attr.stderr?ref=c7c2418227e103de4544c08706975dca8551110d", "patch": "@@ -16,5 +16,37 @@ error: doc alias attribute expects a string: #[doc(alias = \"0\")]\n LL | #[doc(alias(\"bar\"))]\n    |       ^^^^^^^^^^^^\n \n-error: aborting due to 3 previous errors\n+error: '\\\"' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:10:7\n+   |\n+LL | #[doc(alias = \"\\\"\")]\n+   |       ^^^^^^^^^^^^\n+\n+error: '\\n' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:11:7\n+   |\n+LL | #[doc(alias = \"\\n\")]\n+   |       ^^^^^^^^^^^^\n+\n+error: '\\n' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:12:7\n+   |\n+LL |   #[doc(alias = \"\n+   |  _______^\n+LL | | \")]\n+   | |_^\n+\n+error: ' ' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:14:7\n+   |\n+LL | #[doc(alias = \" \")]\n+   |       ^^^^^^^^^^^\n+\n+error: '\\t' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:15:7\n+   |\n+LL | #[doc(alias = \"\\t\")]\n+   |       ^^^^^^^^^^^^\n+\n+error: aborting due to 8 previous errors\n "}, {"sha": "c8bec39fad61399448f8dc06a18803d7f88735d8", "filename": "src/test/ui/check-doc-alias-attr.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Fui%2Fcheck-doc-alias-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Fui%2Fcheck-doc-alias-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-doc-alias-attr.rs?ref=c7c2418227e103de4544c08706975dca8551110d", "patch": "@@ -7,4 +7,10 @@ pub struct Bar;\n #[doc(alias)] //~ ERROR\n #[doc(alias = 0)] //~ ERROR\n #[doc(alias(\"bar\"))] //~ ERROR\n+#[doc(alias = \"\\\"\")] //~ ERROR\n+#[doc(alias = \"\\n\")] //~ ERROR\n+#[doc(alias = \"\n+\")] //~^ ERROR\n+#[doc(alias = \" \")] //~ ERROR\n+#[doc(alias = \"\\t\")] //~ ERROR\n pub struct Foo;"}, {"sha": "be7d7b3dbea93528d6e03d3f8d6e4ea4c1888f0a", "filename": "src/test/ui/check-doc-alias-attr.stderr", "status": "modified", "additions": 33, "deletions": 1, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Fui%2Fcheck-doc-alias-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c7c2418227e103de4544c08706975dca8551110d/src%2Ftest%2Fui%2Fcheck-doc-alias-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-doc-alias-attr.stderr?ref=c7c2418227e103de4544c08706975dca8551110d", "patch": "@@ -16,5 +16,37 @@ error: doc alias attribute expects a string: #[doc(alias = \"0\")]\n LL | #[doc(alias(\"bar\"))]\n    |       ^^^^^^^^^^^^\n \n-error: aborting due to 3 previous errors\n+error: '\\\"' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:10:7\n+   |\n+LL | #[doc(alias = \"\\\"\")]\n+   |       ^^^^^^^^^^^^\n+\n+error: '\\n' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:11:7\n+   |\n+LL | #[doc(alias = \"\\n\")]\n+   |       ^^^^^^^^^^^^\n+\n+error: '\\n' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:12:7\n+   |\n+LL |   #[doc(alias = \"\n+   |  _______^\n+LL | | \")]\n+   | |_^\n+\n+error: ' ' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:14:7\n+   |\n+LL | #[doc(alias = \" \")]\n+   |       ^^^^^^^^^^^\n+\n+error: '\\t' character isn't allowed in `#[doc(alias = \"...\")]`\n+  --> $DIR/check-doc-alias-attr.rs:15:7\n+   |\n+LL | #[doc(alias = \"\\t\")]\n+   |       ^^^^^^^^^^^^\n+\n+error: aborting due to 8 previous errors\n "}]}