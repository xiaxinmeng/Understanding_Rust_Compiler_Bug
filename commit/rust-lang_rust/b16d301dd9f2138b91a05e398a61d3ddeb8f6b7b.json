{"sha": "b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b", "node_id": "C_kwDOAAsO6NoAKGIxNmQzMDFkZDlmMjEzOGI5MWEwNWUzOThhNjFkM2RkZWI4ZjZiN2I", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-09-01T10:30:11Z"}, "committer": {"name": "Christian Poveda", "email": "git@pvdrz.com", "date": "2022-09-13T20:16:41Z"}, "message": "test fast sleeping", "tree": {"sha": "a14a15b5da2c233342228b987b455a1430e8e0d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a14a15b5da2c233342228b987b455a1430e8e0d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYIAB0WIQRsB8A/3NrzTlMMjT0nUl7150IKUAUCYyDlKQAKCRAnUl7150IK\nUMK/AQC9Z9m7H3KDXOw4u07Gds5iwxzQckPy9E5den56d0R9LAEAxzHSjWSt32iw\nPsN8RrW9psR3JMtEYu+bHrfLPqgwogU=\n=2B0s\n-----END PGP SIGNATURE-----", "payload": "tree a14a15b5da2c233342228b987b455a1430e8e0d1\nparent 613a436cfc7243d3b37d95b83fcf7aa9639f84da\nauthor Ralf Jung <post@ralfj.de> 1662028211 +0200\ncommitter Christian Poveda <git@pvdrz.com> 1663100201 -0500\n\ntest fast sleeping\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b", "html_url": "https://github.com/rust-lang/rust/commit/b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "613a436cfc7243d3b37d95b83fcf7aa9639f84da", "url": "https://api.github.com/repos/rust-lang/rust/commits/613a436cfc7243d3b37d95b83fcf7aa9639f84da", "html_url": "https://github.com/rust-lang/rust/commit/613a436cfc7243d3b37d95b83fcf7aa9639f84da"}], "stats": {"total": 25, "additions": 13, "deletions": 12}, "files": [{"sha": "7e6c74d71cb8c21eadf8891bae699a6cd3073794", "filename": "tests/pass/shims/time-with-isolation.rs", "status": "modified", "additions": 13, "deletions": 12, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b/tests%2Fpass%2Fshims%2Ftime-with-isolation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b/tests%2Fpass%2Fshims%2Ftime-with-isolation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fpass%2Fshims%2Ftime-with-isolation.rs?ref=b16d301dd9f2138b91a05e398a61d3ddeb8f6b7b", "patch": "@@ -1,21 +1,15 @@\n use std::time::{Duration, Instant};\n \n-fn duration_sanity(diff: Duration) {\n-    // The virtual clock is deterministic and I got 29us on a 64-bit Linux machine. However, this\n-    // changes according to the platform so we use an interval to be safe. This should be updated\n-    // if `NANOSECONDS_PER_BASIC_BLOCK` changes.\n-    assert!(diff.as_micros() > 10);\n-    assert!(diff.as_micros() < 40);\n-}\n-\n fn test_sleep() {\n+    // We sleep a *long* time here -- but the clock is virtual so the test should still pass quickly.\n     let before = Instant::now();\n-    std::thread::sleep(Duration::from_millis(100));\n+    std::thread::sleep(Duration::from_secs(3600));\n     let after = Instant::now();\n-    assert!((after - before).as_millis() >= 100);\n+    assert!((after - before).as_secs() >= 3600);\n }\n \n-fn main() {\n+/// Ensure that time passes even if we don't sleep (but just wor).\n+fn test_time_passes() {\n     // Check `Instant`.\n     let now1 = Instant::now();\n     // Do some work to make time pass.\n@@ -28,7 +22,14 @@ fn main() {\n     let diff = now2.duration_since(now1);\n     assert_eq!(now1 + diff, now2);\n     assert_eq!(now2 - diff, now1);\n-    duration_sanity(diff);\n+    // The virtual clock is deterministic and I got 29us on a 64-bit Linux machine. However, this\n+    // changes according to the platform so we use an interval to be safe. This should be updated\n+    // if `NANOSECONDS_PER_BASIC_BLOCK` changes.\n+    assert!(diff.as_micros() > 10);\n+    assert!(diff.as_micros() < 40);\n+}\n \n+fn main() {\n+    test_time_passes();\n     test_sleep();\n }"}]}