{"sha": "1767f9f9bfd63676cee998ea086968ab5f047866", "node_id": "C_kwDOAAsO6NoAKDE3NjdmOWY5YmZkNjM2NzZjZWU5OThlYTA4Njk2OGFiNWYwNDc4NjY", "commit": {"author": {"name": "Sarthak Singh", "email": "ss269@uw.edu", "date": "2022-11-21T14:45:07Z"}, "committer": {"name": "Sarthak Singh", "email": "ss269@uw.edu", "date": "2022-11-24T13:35:17Z"}, "message": "Unsupported query error now specifies if its unsupported for local or external crate", "tree": {"sha": "255bd091cdbb77ad2337bc5f681b3f932f8cc22b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/255bd091cdbb77ad2337bc5f681b3f932f8cc22b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1767f9f9bfd63676cee998ea086968ab5f047866", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1767f9f9bfd63676cee998ea086968ab5f047866", "html_url": "https://github.com/rust-lang/rust/commit/1767f9f9bfd63676cee998ea086968ab5f047866", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1767f9f9bfd63676cee998ea086968ab5f047866/comments", "author": {"login": "SarthakSingh31", "id": 35749450, "node_id": "MDQ6VXNlcjM1NzQ5NDUw", "avatar_url": "https://avatars.githubusercontent.com/u/35749450?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SarthakSingh31", "html_url": "https://github.com/SarthakSingh31", "followers_url": "https://api.github.com/users/SarthakSingh31/followers", "following_url": "https://api.github.com/users/SarthakSingh31/following{/other_user}", "gists_url": "https://api.github.com/users/SarthakSingh31/gists{/gist_id}", "starred_url": "https://api.github.com/users/SarthakSingh31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SarthakSingh31/subscriptions", "organizations_url": "https://api.github.com/users/SarthakSingh31/orgs", "repos_url": "https://api.github.com/users/SarthakSingh31/repos", "events_url": "https://api.github.com/users/SarthakSingh31/events{/privacy}", "received_events_url": "https://api.github.com/users/SarthakSingh31/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SarthakSingh31", "id": 35749450, "node_id": "MDQ6VXNlcjM1NzQ5NDUw", "avatar_url": "https://avatars.githubusercontent.com/u/35749450?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SarthakSingh31", "html_url": "https://github.com/SarthakSingh31", "followers_url": "https://api.github.com/users/SarthakSingh31/followers", "following_url": "https://api.github.com/users/SarthakSingh31/following{/other_user}", "gists_url": "https://api.github.com/users/SarthakSingh31/gists{/gist_id}", "starred_url": "https://api.github.com/users/SarthakSingh31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SarthakSingh31/subscriptions", "organizations_url": "https://api.github.com/users/SarthakSingh31/orgs", "repos_url": "https://api.github.com/users/SarthakSingh31/repos", "events_url": "https://api.github.com/users/SarthakSingh31/events{/privacy}", "received_events_url": "https://api.github.com/users/SarthakSingh31/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1dda298ad39a64e019a3511139c5b13ac0a18e54", "url": "https://api.github.com/repos/rust-lang/rust/commits/1dda298ad39a64e019a3511139c5b13ac0a18e54", "html_url": "https://github.com/rust-lang/rust/commit/1dda298ad39a64e019a3511139c5b13ac0a18e54"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "afbc9eb0512beb11b387d53908ad0076bb54c49b", "filename": "compiler/rustc_middle/src/ty/query.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1767f9f9bfd63676cee998ea086968ab5f047866/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1767f9f9bfd63676cee998ea086968ab5f047866/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs?ref=1767f9f9bfd63676cee998ea086968ab5f047866", "patch": "@@ -276,13 +276,16 @@ macro_rules! define_callbacks {\n \n         impl Default for Providers {\n             fn default() -> Self {\n+                use crate::query::Key;\n+\n                 Providers {\n                     $($name: |_, key| bug!(\n-                        \"`tcx.{}({:?})` is not supported for external or local crate;\\n\n-                        hint: Queries can be either made to the local crate, or the external crate. This error means you tried to use it for one that's not supported (likely the local crate).\\n\n+                        \"`tcx.{}({:?})` is not supported for {} crate;\\n\n+                        hint: Queries can be either made to the local crate, or the external crate. This error means you tried to use it for one that's not supported.\\n\n                         If that's not the case, {} was likely never assigned to a provider function.\\n\",\n                         stringify!($name),\n                         key,\n+                        if key.query_crate_is_local() { \"local\" } else { \"external\" },\n                         stringify!($name),\n                     ),)*\n                 }"}, {"sha": "d426a2b6b78a0655220e6785f4b390a87f0d4b05", "filename": "compiler/rustc_query_impl/src/lib.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1767f9f9bfd63676cee998ea086968ab5f047866/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1767f9f9bfd63676cee998ea086968ab5f047866/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs?ref=1767f9f9bfd63676cee998ea086968ab5f047866", "patch": "@@ -20,6 +20,7 @@ extern crate rustc_middle;\n use rustc_data_structures::sync::AtomicU64;\n use rustc_middle::arena::Arena;\n use rustc_middle::dep_graph::{self, DepKindStruct};\n+use rustc_middle::query::Key;\n use rustc_middle::ty::query::{query_keys, query_storage, query_stored, query_values};\n use rustc_middle::ty::query::{ExternProviders, Providers, QueryEngine};\n use rustc_middle::ty::TyCtxt;\n@@ -32,8 +33,6 @@ use rustc_query_system::query::*;\n #[cfg(parallel_compiler)]\n pub use rustc_query_system::query::{deadlock, QueryContext};\n \n-use rustc_middle::query::Key;\n-\n pub use rustc_query_system::query::QueryConfig;\n pub(crate) use rustc_query_system::query::QueryVTable;\n "}]}