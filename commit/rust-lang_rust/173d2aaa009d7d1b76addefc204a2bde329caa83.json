{"sha": "173d2aaa009d7d1b76addefc204a2bde329caa83", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3M2QyYWFhMDA5ZDdkMWI3NmFkZGVmYzIwNGEyYmRlMzI5Y2FhODM=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-03-05T15:54:37Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-03-05T20:31:30Z"}, "message": "Add an unstable option to print all unversioned files\n\nThis allows sharing those files between different doc invocations\nwithout having to know their names ahead of time.", "tree": {"sha": "621661d8b266f7103fd7b5a176977aa264d27e79", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/621661d8b266f7103fd7b5a176977aa264d27e79"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/173d2aaa009d7d1b76addefc204a2bde329caa83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/173d2aaa009d7d1b76addefc204a2bde329caa83", "html_url": "https://github.com/rust-lang/rust/commit/173d2aaa009d7d1b76addefc204a2bde329caa83", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/173d2aaa009d7d1b76addefc204a2bde329caa83/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69a879f3d199580dde491bb679df319867a44e56", "url": "https://api.github.com/repos/rust-lang/rust/commits/69a879f3d199580dde491bb679df319867a44e56", "html_url": "https://github.com/rust-lang/rust/commit/69a879f3d199580dde491bb679df319867a44e56"}], "stats": {"total": 69, "additions": 51, "deletions": 18}, "files": [{"sha": "c8c83ec5ab511da49dc4604ad6cc0eff6fe3efed", "filename": "src/librustdoc/config.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fconfig.rs?ref=173d2aaa009d7d1b76addefc204a2bde329caa83", "patch": "@@ -315,6 +315,13 @@ impl Options {\n             return Err(0);\n         }\n \n+        if matches.opt_strs(\"print\").iter().any(|opt| opt == \"unversioned-files\") {\n+            for file in crate::html::render::FILES_UNVERSIONED.keys() {\n+                println!(\"{}\", file);\n+            }\n+            return Err(0);\n+        }\n+\n         let color = config::parse_color(&matches);\n         let (json_rendered, _artifacts) = config::parse_json(&matches);\n         let error_format = config::parse_error_format(&matches, color, json_rendered);"}, {"sha": "9b9ec2581cfc2c1531aa25293b7f98d09d8197e2", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=173d2aaa009d7d1b76addefc204a2bde329caa83", "patch": "@@ -33,6 +33,7 @@ mod print_item;\n mod write_shared;\n \n crate use context::*;\n+crate use write_shared::FILES_UNVERSIONED;\n \n use std::cell::{Cell, RefCell};\n use std::collections::VecDeque;"}, {"sha": "02ad01aa29a02e2d8c74ef0f94678c303fe67fda", "filename": "src/librustdoc/html/render/write_shared.rs", "status": "modified", "additions": 21, "deletions": 18, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "raw_url": "https://github.com/rust-lang/rust/raw/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs?ref=173d2aaa009d7d1b76addefc204a2bde329caa83", "patch": "@@ -3,8 +3,8 @@ use std::fmt::Write;\n use std::fs::{self, File};\n use std::io::prelude::*;\n use std::io::{self, BufReader};\n-use std::path::{Component, Path, PathBuf};\n use std::lazy::SyncLazy as Lazy;\n+use std::path::{Component, Path, PathBuf};\n \n use itertools::Itertools;\n use rustc_data_structures::flock;\n@@ -19,6 +19,26 @@ use crate::error::Error;\n use crate::formats::FormatRenderer;\n use crate::html::{layout, static_files};\n \n+crate static FILES_UNVERSIONED: Lazy<FxHashMap<&str, &[u8]>> = Lazy::new(|| {\n+    map! {\n+        \"FiraSans-Regular.woff2\" => static_files::fira_sans::REGULAR2,\n+        \"FiraSans-Medium.woff2\" => static_files::fira_sans::MEDIUM2,\n+        \"FiraSans-Regular.woff\" => static_files::fira_sans::REGULAR,\n+        \"FiraSans-Medium.woff\" => static_files::fira_sans::MEDIUM,\n+        \"FiraSans-LICENSE.txt\" => static_files::fira_sans::LICENSE,\n+        \"SourceSerifPro-Regular.ttf.woff\" => static_files::source_serif_pro::REGULAR,\n+        \"SourceSerifPro-Bold.ttf.woff\" => static_files::source_serif_pro::BOLD,\n+        \"SourceSerifPro-It.ttf.woff\" => static_files::source_serif_pro::ITALIC,\n+        \"SourceSerifPro-LICENSE.md\" => static_files::source_serif_pro::LICENSE,\n+        \"SourceCodePro-Regular.woff\" => static_files::source_code_pro::REGULAR,\n+        \"SourceCodePro-Semibold.woff\" => static_files::source_code_pro::SEMIBOLD,\n+        \"SourceCodePro-LICENSE.txt\" => static_files::source_code_pro::LICENSE,\n+        \"LICENSE-MIT.txt\" => static_files::LICENSE_MIT,\n+        \"LICENSE-APACHE.txt\" => static_files::LICENSE_APACHE,\n+        \"COPYRIGHT.txt\" => static_files::COPYRIGHT,\n+    }\n+});\n+\n pub(super) fn write_shared(\n     cx: &Context<'_>,\n     krate: &Crate,\n@@ -213,23 +233,6 @@ themePicker.onblur = handleThemeButtonsBlur;\n         static_files::NORMALIZE_CSS,\n         options.enable_minification,\n     )?;\n-    static FILES_UNVERSIONED: Lazy<FxHashMap<&str, &[u8]>> = Lazy::new(|| map! {\n-        \"FiraSans-Regular.woff2\" => static_files::fira_sans::REGULAR2,\n-        \"FiraSans-Medium.woff2\" => static_files::fira_sans::MEDIUM2,\n-        \"FiraSans-Regular.woff\" => static_files::fira_sans::REGULAR,\n-        \"FiraSans-Medium.woff\" => static_files::fira_sans::MEDIUM,\n-        \"FiraSans-LICENSE.txt\" => static_files::fira_sans::LICENSE,\n-        \"SourceSerifPro-Regular.ttf.woff\" => static_files::source_serif_pro::REGULAR,\n-        \"SourceSerifPro-Bold.ttf.woff\" => static_files::source_serif_pro::BOLD,\n-        \"SourceSerifPro-It.ttf.woff\" => static_files::source_serif_pro::ITALIC,\n-        \"SourceSerifPro-LICENSE.md\" => static_files::source_serif_pro::LICENSE,\n-        \"SourceCodePro-Regular.woff\" => static_files::source_code_pro::REGULAR,\n-        \"SourceCodePro-Semibold.woff\" => static_files::source_code_pro::SEMIBOLD,\n-        \"SourceCodePro-LICENSE.txt\" => static_files::source_code_pro::LICENSE,\n-        \"LICENSE-MIT.txt\" => static_files::LICENSE_MIT,\n-        \"LICENSE-APACHE.txt\" => static_files::LICENSE_APACHE,\n-        \"COPYRIGHT.txt\" => static_files::COPYRIGHT,\n-    });\n     for (file, contents) in &*FILES_UNVERSIONED {\n         write(cx.dst.join(file), contents)?;\n     }"}, {"sha": "9e8432454429fcfd6c93420e5d5e39b9e3369a97", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=173d2aaa009d7d1b76addefc204a2bde329caa83", "patch": "@@ -524,6 +524,9 @@ fn opts() -> Vec<RustcOptGroup> {\n                 \"Generate JSON file at the top level instead of generating HTML redirection files\",\n             )\n         }),\n+        unstable(\"print\", |o| {\n+            o.optmulti(\"\", \"print\", \"Rustdoc information to print on stdout\", \"[unversioned-files]\")\n+        }),\n     ]\n }\n "}, {"sha": "e368f61cddfc3f5bc7e74e2f6484b55388a6b5b4", "filename": "src/test/run-make-fulldeps/print-unversioned-files/Makefile", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Ftest%2Frun-make-fulldeps%2Fprint-unversioned-files%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Ftest%2Frun-make-fulldeps%2Fprint-unversioned-files%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fprint-unversioned-files%2FMakefile?ref=173d2aaa009d7d1b76addefc204a2bde329caa83", "patch": "@@ -0,0 +1,4 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTDOC) -Z unstable-options --print unversioned-files | sort | diff - unversioned-files.txt"}, {"sha": "c5a9bf24381602004ff898faf449f89614bf053f", "filename": "src/test/run-make-fulldeps/print-unversioned-files/unversioned-files.txt", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Ftest%2Frun-make-fulldeps%2Fprint-unversioned-files%2Funversioned-files.txt", "raw_url": "https://github.com/rust-lang/rust/raw/173d2aaa009d7d1b76addefc204a2bde329caa83/src%2Ftest%2Frun-make-fulldeps%2Fprint-unversioned-files%2Funversioned-files.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fprint-unversioned-files%2Funversioned-files.txt?ref=173d2aaa009d7d1b76addefc204a2bde329caa83", "patch": "@@ -0,0 +1,15 @@\n+COPYRIGHT.txt\n+FiraSans-LICENSE.txt\n+FiraSans-Medium.woff\n+FiraSans-Medium.woff2\n+FiraSans-Regular.woff\n+FiraSans-Regular.woff2\n+LICENSE-APACHE.txt\n+LICENSE-MIT.txt\n+SourceCodePro-LICENSE.txt\n+SourceCodePro-Regular.woff\n+SourceCodePro-Semibold.woff\n+SourceSerifPro-Bold.ttf.woff\n+SourceSerifPro-It.ttf.woff\n+SourceSerifPro-LICENSE.md\n+SourceSerifPro-Regular.ttf.woff"}]}