{"sha": "ab5309e9e8467508766aee176dc121672d606524", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFiNTMwOWU5ZTg0Njc1MDg3NjZhZWUxNzZkYzEyMTY3MmQ2MDY1MjQ=", "commit": {"author": {"name": "Ximin Luo", "email": "infinity0@pwned.gg", "date": "2016-07-04T14:37:46Z"}, "committer": {"name": "Ximin Luo", "email": "infinity0@pwned.gg", "date": "2016-07-04T14:37:46Z"}, "message": "Avoid redundant downloads when bootstrapping\n\nIf the local file is available, then verify it against the hash we just\ndownloaded, and if it matches then we don't need to download it again.", "tree": {"sha": "b1f3e43472d88ffb7e397548551ed0a180863a91", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1f3e43472d88ffb7e397548551ed0a180863a91"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ab5309e9e8467508766aee176dc121672d606524", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ab5309e9e8467508766aee176dc121672d606524", "html_url": "https://github.com/rust-lang/rust/commit/ab5309e9e8467508766aee176dc121672d606524", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ab5309e9e8467508766aee176dc121672d606524/comments", "author": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "committer": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d508de6cf7c7bb9b5057ee63432dbbc899209101", "url": "https://api.github.com/repos/rust-lang/rust/commits/d508de6cf7c7bb9b5057ee63432dbbc899209101", "html_url": "https://github.com/rust-lang/rust/commit/d508de6cf7c7bb9b5057ee63432dbbc899209101"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "49f00bf46f13c692b730c8f6c36afdba417aa88c", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ab5309e9e8467508766aee176dc121672d606524/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/ab5309e9e8467508766aee176dc121672d606524/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=ab5309e9e8467508766aee176dc121672d606524", "patch": "@@ -31,6 +31,14 @@ def get(url, path, verbose=False):\n \n     try:\n         download(sha_path, sha_url, verbose)\n+        if os.path.exists(path):\n+            try:\n+                verify(path, sha_path, verbose)\n+                print(\"using already-download file \" + path)\n+                return\n+            except Exception as e:\n+                print(\"failed verification for already-download file \" + path)\n+                os.unlink(path)\n         download(temp_path, url, verbose)\n         verify(temp_path, sha_path, verbose)\n         print(\"moving {} to {}\".format(temp_path, path))"}, {"sha": "127251cc802c9ccec20dc19c01901cbad412f43e", "filename": "src/etc/get-stage0.py", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ab5309e9e8467508766aee176dc121672d606524/src%2Fetc%2Fget-stage0.py", "raw_url": "https://github.com/rust-lang/rust/raw/ab5309e9e8467508766aee176dc121672d606524/src%2Fetc%2Fget-stage0.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fget-stage0.py?ref=ab5309e9e8467508766aee176dc121672d606524", "patch": "@@ -31,8 +31,6 @@ def main(triple):\n     filename = 'rustc-{}-{}.tar.gz'.format(channel, triple)\n     url = 'https://static.rust-lang.org/dist/{}/{}'.format(date, filename)\n     dst = dl_dir + '/' + filename\n-    if os.path.exists(dst):\n-        os.unlink(dst)\n     bootstrap.get(url, dst)\n \n     stage0_dst = triple + '/stage0'"}]}