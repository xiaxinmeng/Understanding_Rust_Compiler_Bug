{"sha": "832c7af0ea93ec0d0dd121cf0988d82621582475", "node_id": "C_kwDOAAsO6NoAKDgzMmM3YWYwZWE5M2VjMGQwZGQxMjFjZjA5ODhkODI2MjE1ODI0NzU", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-09-07T12:14:27Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-09-07T13:00:15Z"}, "message": "Don't break windows/rand for miri", "tree": {"sha": "c7282c571f7ec32b25abcce6785afa4dce078c15", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7282c571f7ec32b25abcce6785afa4dce078c15"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/832c7af0ea93ec0d0dd121cf0988d82621582475", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmMYleAACgkQcTRy8vRW\nJ97vDQ//cumabjfDNf3d5xFvHspov49n2aCJ5SvzcxsoQJ4BDDgk9dAKXoVNxMZo\nxrFGsqika7Nh3EbrfgzWdmqrpsnRRo3SBIsUzNMIEVRBouv1g2g6eW/o4yf6FyDe\nSa4h4vPagH6oyfiuSamojlZYzRgCdSZMNqFAGNmibJiGpS5i7RBVVO8BeFDcpAII\nSKGPvjZppe75gEqde4O1f5r5Eo/fFWyQtqOmfh3mL7T8X1OJvmauBGiZAnnZBzsx\nrkVaqIjMusg5PO29hCZnPBAe4fM9kjREe5I4qNcYeVYrEs20OQESybmyjHOJ48KD\n4baigTg/nLQQ2uIIWOOQ3t4CiFXIGQwxpLpRPaGV7X2bhhRv7ecIPR2ou9uYQyJf\nKyxM80PNHkm8aXz4MEsCssN9Zjwqu2e01QqlO7IFvkK7hOoWlEJHgfRFIdWmyWdO\n+91FGNq2JAUjrrY9m6d1jL81moyI2ACrE2PTp3aUG83cJ5d6GDX15a9rhDb0K5M3\nGp6U4UXYkdGmBt1bLn55a5nKv13R6AFe4yqCtnId4N4W2E87ZxdPTqkoq9USaLT7\nFjwKkc8dJmK+K1duGOQKc05COck7s7gAUEzoihALjjmzXskGruchB11914kAoUC7\nKXX+zt6YQ2oWJ7HS1/dzlH8XxRxitMJucx9XcZiEPTdobFDCs4E=\n=hE6o\n-----END PGP SIGNATURE-----", "payload": "tree c7282c571f7ec32b25abcce6785afa4dce078c15\nparent b2e4f9dcb32aafcfa1bd2ab6b291ca84b7db0121\nauthor Chris Denton <christophersdenton@gmail.com> 1662552867 +0100\ncommitter Chris Denton <christophersdenton@gmail.com> 1662555615 +0100\n\nDon't break windows/rand for miri\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/832c7af0ea93ec0d0dd121cf0988d82621582475", "html_url": "https://github.com/rust-lang/rust/commit/832c7af0ea93ec0d0dd121cf0988d82621582475", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/832c7af0ea93ec0d0dd121cf0988d82621582475/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2e4f9dcb32aafcfa1bd2ab6b291ca84b7db0121", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2e4f9dcb32aafcfa1bd2ab6b291ca84b7db0121", "html_url": "https://github.com/rust-lang/rust/commit/b2e4f9dcb32aafcfa1bd2ab6b291ca84b7db0121"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "d6cd8f80271620c1d619193d90a1bdfe4e75b097", "filename": "library/std/src/sys/windows/rand.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/832c7af0ea93ec0d0dd121cf0988d82621582475/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Frand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/832c7af0ea93ec0d0dd121cf0988d82621582475/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Frand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Frand.rs?ref=832c7af0ea93ec0d0dd121cf0988d82621582475", "patch": "@@ -38,6 +38,18 @@ pub fn hashmap_random_keys() -> (u64, u64) {\n \n struct Rng(c::BCRYPT_ALG_HANDLE);\n impl Rng {\n+    #[cfg(miri)]\n+    fn open() -> Result<Self, c::NTSTATUS> {\n+        const BCRYPT_RNG_ALG_HANDLE: c::BCRYPT_ALG_HANDLE = ptr::invalid_mut(0x81);\n+        let _ = (\n+            c::BCryptOpenAlgorithmProvider,\n+            c::BCryptCloseAlgorithmProvider,\n+            c::BCRYPT_RNG_ALGORITHM,\n+            c::STATUS_NOT_SUPPORTED,\n+        );\n+        Ok(Self(BCRYPT_RNG_ALG_HANDLE))\n+    }\n+    #[cfg(not(miri))]\n     // Open a handle to the RNG algorithm.\n     fn open() -> Result<Self, c::NTSTATUS> {\n         use crate::sync::atomic::AtomicPtr;"}]}