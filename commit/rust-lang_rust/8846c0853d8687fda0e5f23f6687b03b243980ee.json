{"sha": "8846c0853d8687fda0e5f23f6687b03b243980ee", "node_id": "C_kwDOAAsO6NoAKDg4NDZjMDg1M2Q4Njg3ZmRhMGU1ZjIzZjY2ODdiMDNiMjQzOTgwZWU", "commit": {"author": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2022-09-27T16:21:24Z"}, "committer": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2022-09-27T16:21:24Z"}, "message": "rustdoc: use CSS containment to speed up render\n\nhttps://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Containment\n\nThis affected layout a little and required adjustments to the CSS to\nkeep spacing the same. In particular, the margins of adjacent items\nusually overlap with each other. However, when an item has contain:\nlayout, any margins of child nodes push out the size of the item itself.\nThis was making spacing between items a little too big. To solve that, I\nremoved margins in some places: in particular for certain classes that\noften occur at the end of a `details.rustdoc-toggle` block, I removed\ntheir bottom margin. Generally, the margins provided by the next item\ndown are sufficient.\n\nAlso remove an unnecessary margin-top on .code-header.", "tree": {"sha": "7fb3859bd65934465a58f09f3231639b98e24492", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7fb3859bd65934465a58f09f3231639b98e24492"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8846c0853d8687fda0e5f23f6687b03b243980ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8846c0853d8687fda0e5f23f6687b03b243980ee", "html_url": "https://github.com/rust-lang/rust/commit/8846c0853d8687fda0e5f23f6687b03b243980ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8846c0853d8687fda0e5f23f6687b03b243980ee/comments", "author": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "57ee5cf5a93923dae9c98bffb11545fc3a31368d", "url": "https://api.github.com/repos/rust-lang/rust/commits/57ee5cf5a93923dae9c98bffb11545fc3a31368d", "html_url": "https://github.com/rust-lang/rust/commit/57ee5cf5a93923dae9c98bffb11545fc3a31368d"}], "stats": {"total": 48, "additions": 32, "deletions": 16}, "files": [{"sha": "a3712a73b5195f99c65d7f0e2c72b004d45473f3", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 29, "deletions": 13, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/8846c0853d8687fda0e5f23f6687b03b243980ee/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/8846c0853d8687fda0e5f23f6687b03b243980ee/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=8846c0853d8687fda0e5f23f6687b03b243980ee", "patch": "@@ -132,7 +132,7 @@ h1, h2, h3, h4, h5, h6 {\n \tfont-weight: 500;\n }\n h1, h2, h3, h4 {\n-\tmargin: 20px 0 15px 0;\n+\tmargin: 25px 0 15px 0;\n \tpadding-bottom: 6px;\n }\n .docblock h3, .docblock h4, h5, h6 {\n@@ -176,8 +176,6 @@ h4.code-header {\n \tborder-bottom-style: none;\n \tmargin: 0;\n \tpadding: 0;\n-\tmargin-top: 0.6rem;\n-\tmargin-bottom: 0.4rem;\n }\n .impl,\n .impl-items .method,\n@@ -292,6 +290,11 @@ p {\n \t   https://www.w3.org/WAI/WCAG21/Understanding/visual-presentation.html */\n \tmargin: 0 0 .75em 0;\n }\n+/* For the last child of a div, the margin will be taken care of\n+\tby the margin-top of the next item. */\n+p:last-child {\n+\tmargin: 0;\n+}\n \n summary {\n \toutline: none;\n@@ -565,9 +568,16 @@ h2.location a {\n \n .rustdoc .example-wrap {\n \tdisplay: flex;\n-\tmargin-bottom: 10px;\n \tposition: relative;\n }\n+.rustdoc .example-wrap {\n+\tmargin-bottom: 10px;\n+}\n+/* For the last child of a div, the margin will be taken care of\n+\tby the margin-top of the next item. */\n+.rustdoc .example-wrap:last-child {\n+\tmargin-bottom: 0px;\n+}\n \n pre.example-line-numbers {\n \toverflow: initial;\n@@ -726,10 +736,6 @@ pre, .rustdoc.source .example-wrap {\n \tmargin-left: 24px;\n }\n \n-.content .impl-items .docblock, .content .impl-items .item-info {\n-\tmargin-bottom: .6em;\n-}\n-\n #main-content > .item-info {\n \tmargin-top: 0;\n \tmargin-left: 0;\n@@ -1532,6 +1538,16 @@ details.dir-entry a {\n \tdisplay: block;\n }\n \n+/* We use CSS containment on the details elements because most sizeable elements\n+\tof the page are contained in one of these. This also makes re-rendering\n+\tfaster on document changes (like closing and opening toggles).\n+\tUnfortunately we can't yet specify contain: content or contain: strict\n+\tbecause the [-]/[+] toggles extend past the boundaries of the <details>\n+\thttps://developer.mozilla.org/en-US/docs/Web/CSS/contain */\n+details.rustdoc-toggle {\n+\tcontain: layout;\n+}\n+\n /* The hideme class is used on summary tags that contain a span with\n \tplaceholder text shown only when the toggle is closed. For instance,\n \t\"Expand description\" or \"Show methods\". */\n@@ -2012,17 +2028,17 @@ in storage.js plus the media query with (min-width: 701px)\n \tmargin-bottom: 0.75em;\n }\n \n-.method-toggle[open] {\n+.method-toggle[open]:not(:last-child) {\n \tmargin-bottom: 2em;\n }\n \n-.implementors-toggle[open]  {\n+.implementors-toggle[open]:not(:last-child) {\n \tmargin-bottom: 2em;\n }\n \n-#trait-implementations-list .method-toggle,\n-#synthetic-implementations-list .method-toggle,\n-#blanket-implementations-list .method-toggle {\n+#trait-implementations-list .method-toggle:not(:last-child),\n+#synthetic-implementations-list .method-toggle:not(:last-child),\n+#blanket-implementations-list .method-toggle:not(:last-child) {\n \tmargin-bottom: 1em;\n }\n "}, {"sha": "3259c02fa49206050572813d17109e13b3a81afc", "filename": "src/test/rustdoc-gui/sidebar-mobile-scroll.goml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8846c0853d8687fda0e5f23f6687b03b243980ee/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile-scroll.goml", "raw_url": "https://github.com/rust-lang/rust/raw/8846c0853d8687fda0e5f23f6687b03b243980ee/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile-scroll.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile-scroll.goml?ref=8846c0853d8687fda0e5f23f6687b03b243980ee", "patch": "@@ -6,7 +6,7 @@ assert-css: (\".sidebar\", {\"display\": \"block\", \"left\": \"-1000px\"})\n \n // Scroll down.\n scroll-to: \"//h2[@id='blanket-implementations']\"\n-assert-window-property: {\"pageYOffset\": \"643\"}\n+assert-window-property: {\"pageYOffset\": \"645\"}\n \n // Open the sidebar menu.\n click: \".sidebar-menu-toggle\"\n@@ -21,11 +21,11 @@ assert-window-property: {\"pageYOffset\": \"0\"}\n // Close the sidebar menu. Make sure the scroll position gets restored.\n click: \".sidebar-menu-toggle\"\n wait-for-css: (\".sidebar\", {\"left\": \"-1000px\"})\n-assert-window-property: {\"pageYOffset\": \"643\"}\n+assert-window-property: {\"pageYOffset\": \"645\"}\n \n // Now test that scrollability returns when the browser window is just resized.\n click: \".sidebar-menu-toggle\"\n wait-for-css: (\".sidebar\", {\"left\": \"0px\"})\n assert-window-property: {\"pageYOffset\": \"0\"}\n size: (900, 600)\n-assert-window-property: {\"pageYOffset\": \"643\"}\n+assert-window-property: {\"pageYOffset\": \"645\"}"}]}