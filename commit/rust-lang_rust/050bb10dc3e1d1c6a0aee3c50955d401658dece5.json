{"sha": "050bb10dc3e1d1c6a0aee3c50955d401658dece5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1MGJiMTBkYzNlMWQxYzZhMGFlZTNjNTA5NTVkNDAxNjU4ZGVjZTU=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2018-12-15T09:17:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-12-15T09:17:37Z"}, "message": "Rollup merge of #56758 - Manishearth:emoji-status-toolstate, r=kennytm\n\nAdd short emoji status to toolstate updates\n\nI get a lot of these emails and it's good to know which ones I should be paying closer attention to -- i.e. the ones where clippy breaks. This adds a short emoji status report to the first line of the commit message, which shows up in notifications directly\n\nI haven't been able to test it, and the actual emoji are just suggestions.\n\nr? @kennytm\n\ncc @rust-lang/infra @rust-lang/devtools", "tree": {"sha": "ac9bb260ba81feec2841279758cec1832a5c1c52", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac9bb260ba81feec2841279758cec1832a5c1c52"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/050bb10dc3e1d1c6a0aee3c50955d401658dece5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcFMaxCRBK7hj4Ov3rIwAAdHIIAA5qvBZ8aUWNAnOdBOPGzhYe\nfMeUSWzPpVGlp+6NxCkAs9eN/J6rHpY18xTz/ZiWtzdK5ktmto70GuzGvieI4WlU\n2g5xpuUZKDG+o7x2pi29xvWym+IjSMTT/iEM7EVeu+LLaLI66FopuyfJmtLoJLEB\nvzzqZ7yRKFmnbIJuGifBf29aCTBw9TZnJnDXXc5UNRiioPbUh9GBHsOHZZda62Vs\n6aNuAkiq6N0wOF23my/St12K19wBty3BHbTXuE+P5Dsy71ucD81FVE9O49qj73/K\nx201xx2VaEp7ltZhSix+ImoQ3ZfId58lHrHNdEmVLe/t7o+cxZBTyTf3ZMQV2ug=\n=IRv2\n-----END PGP SIGNATURE-----\n", "payload": "tree ac9bb260ba81feec2841279758cec1832a5c1c52\nparent c530e31245ba10b2587bc908a65bd6e7910bc50f\nparent ae893bb9aba27a8dd09cf7ee5fff5cc69c8d2acf\nauthor Pietro Albini <pietro@pietroalbini.org> 1544865457 +0100\ncommitter GitHub <noreply@github.com> 1544865457 +0100\n\nRollup merge of #56758 - Manishearth:emoji-status-toolstate, r=kennytm\n\nAdd short emoji status to toolstate updates\n\nI get a lot of these emails and it's good to know which ones I should be paying closer attention to -- i.e. the ones where clippy breaks. This adds a short emoji status report to the first line of the commit message, which shows up in notifications directly\n\nI haven't been able to test it, and the actual emoji are just suggestions.\n\nr? @kennytm\n\ncc @rust-lang/infra @rust-lang/devtools\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/050bb10dc3e1d1c6a0aee3c50955d401658dece5", "html_url": "https://github.com/rust-lang/rust/commit/050bb10dc3e1d1c6a0aee3c50955d401658dece5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/050bb10dc3e1d1c6a0aee3c50955d401658dece5/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c530e31245ba10b2587bc908a65bd6e7910bc50f", "url": "https://api.github.com/repos/rust-lang/rust/commits/c530e31245ba10b2587bc908a65bd6e7910bc50f", "html_url": "https://github.com/rust-lang/rust/commit/c530e31245ba10b2587bc908a65bd6e7910bc50f"}, {"sha": "ae893bb9aba27a8dd09cf7ee5fff5cc69c8d2acf", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae893bb9aba27a8dd09cf7ee5fff5cc69c8d2acf", "html_url": "https://github.com/rust-lang/rust/commit/ae893bb9aba27a8dd09cf7ee5fff5cc69c8d2acf"}], "stats": {"total": 32, "additions": 25, "deletions": 7}, "files": [{"sha": "a65d263d2e3a3e3a7f5507a7fcd8e13c43234e14", "filename": "src/tools/publish_toolstate.py", "status": "modified", "additions": 25, "deletions": 7, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/050bb10dc3e1d1c6a0aee3c50955d401658dece5/src%2Ftools%2Fpublish_toolstate.py", "raw_url": "https://github.com/rust-lang/rust/raw/050bb10dc3e1d1c6a0aee3c50955d401658dece5/src%2Ftools%2Fpublish_toolstate.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fpublish_toolstate.py?ref=050bb10dc3e1d1c6a0aee3c50955d401658dece5", "patch": "@@ -34,6 +34,16 @@\n     'rust-by-example': '@steveklabnik @marioidival @projektir',\n }\n \n+EMOJI = {\n+    'miri': '\ud83d\udef0\ufe0f',\n+    'clippy-driver': '\ud83d\udcce',\n+    'rls': '\ud83d\udcbb',\n+    'rustfmt': '\ud83d\udcdd',\n+    'book': '\ud83d\udcd6',\n+    'nomicon': '\ud83d\udc7f',\n+    'reference': '\ud83d\udcda',\n+    'rust-by-example': '\ud83d\udc69\u200d\ud83c\udfeb',\n+}\n \n def read_current_status(current_commit, path):\n     '''Reads build status of `current_commit` from content of `history/*.tsv`\n@@ -63,13 +73,12 @@ def update_latest(\n         }\n \n         slug = 'rust-lang/rust'\n-        message = textwrap.dedent('''\\\n-            \ud83d\udce3 Toolstate changed by {}!\n-\n+        long_message = textwrap.dedent('''\\\n             Tested on commit {}@{}.\n             Direct link to PR: <{}>\n \n-        ''').format(relevant_pr_number, slug, current_commit, relevant_pr_url)\n+        ''').format(slug, current_commit, relevant_pr_url)\n+        emoji_status = []\n         anything_changed = False\n         for status in latest:\n             tool = status['tool']\n@@ -81,12 +90,18 @@ def update_latest(\n                 status[os] = new\n                 if new > old:\n                     changed = True\n-                    message += '\ud83c\udf89 {} on {}: {} \u2192 {} (cc {}, @rust-lang/infra).\\n' \\\n-                        .format(tool, os, old, new, MAINTAINERS.get(tool))\n+                    long_message += '\ud83c\udf89 {} on {}: {} \u2192 {}.\\n' \\\n+                        .format(tool, os, old, new)\n+                    emoji = \"{}\ud83c\udf89\".format(EMOJI.get(tool))\n+                    if msg not in emoji_status:\n+                        emoji_status += [msg]\n                 elif new < old:\n                     changed = True\n-                    message += '\ud83d\udc94 {} on {}: {} \u2192 {} (cc {}, @rust-lang/infra).\\n' \\\n+                    long_message += '\ud83d\udc94 {} on {}: {} \u2192 {} (cc {}, @rust-lang/infra).\\n' \\\n                         .format(tool, os, old, new, MAINTAINERS.get(tool))\n+                    emoji = \"{}\ud83d\udc94\".format(EMOJI.get(tool))\n+                    if msg not in emoji_status:\n+                        emoji_status += [msg]\n \n             if changed:\n                 status['commit'] = current_commit\n@@ -96,6 +111,9 @@ def update_latest(\n         if not anything_changed:\n             return ''\n \n+        short_message = \"\ud83d\udce3 Toolstate changed by {}! ({})\"\n+            .format(relevant_pr_number, '/'.join(emoji_status))\n+        message = short_message + \"\\n\\n\" + long_message\n         f.seek(0)\n         f.truncate(0)\n         json.dump(latest, f, indent=4, separators=(',', ': '))"}]}