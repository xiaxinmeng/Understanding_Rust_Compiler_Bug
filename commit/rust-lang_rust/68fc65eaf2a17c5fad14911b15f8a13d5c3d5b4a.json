{"sha": "68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4ZmM2NWVhZjJhMTdjNWZhZDE0OTExYjE1ZjhhMTNkNWMzZDViNGE=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-no-reply-9879165716479413131@oli-obk.de", "date": "2017-09-10T09:48:56Z"}, "committer": {"name": "Oliver Schneider", "email": "git-no-reply-9879165716479413131@oli-obk.de", "date": "2017-09-17T19:41:45Z"}, "message": "Prevent distribution if miri is enabled", "tree": {"sha": "a8dcdd8a6e2610cd982b678a57bbea8d61816cc4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a8dcdd8a6e2610cd982b678a57bbea8d61816cc4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJgBAABCABKFiEEvpMjxK4/cnPNfesJHVy0/Fl8MAQFAlm+z/ksHGdpdC1uby1y\nZXBseS05ODc5MTY1NzE2NDc5NDEzMTMxQG9saS1vYmsuZGUACgkQHVy0/Fl8MATz\nMBAAm5gggG4Tmyv9a7lHet3sPnqKODY5A+Sm3zeW2VxzHmv8NfB9Q6u784H6As0H\nRwXMAwA6AFWOwV8+KVqY4C2oGtDBNy8j1yC7M4bZcjN2kwnW3JKBRyl8J6NEO/7y\naMuLl0JYu0oGjXESJdJx98TP4/cMUJAPNuMe8pHTjUgTmga98wUoqIdvV0YBujJg\nNa/Tp8Q15m1WitAtblvX9S8YJyBIidX4DfLZwmmPIPO7pb5/OR1JJXHK4LlRnoU8\nALGkuBJyeDqJhhyMWzDCkl3IF8vSHyjPpb2BmtNLb43c9OqG3fbC9z+pXojX30nx\nyLQ5ok18W3gRsqxwKEkEnhVkCd0Y8K9IqU5UKMRa2kAUzVdmPIa1b1F5fM7gcHc5\nNRT3tiU0T1G+F/YcdKFtaVfKjK+rk0E/du2PR4CV1Tzf5ov4xFymkjat11RSXeo6\nZNniqP9HoGtzFPTTNNdBEXobeexBNog+qqPQn834/NUtZCOrnKR3NIoarxDr5Jq8\nfJUM9ssylvPEhciGQWv3hTlfno0SxF7IIpLgFsX4mQr2qOb+an9wSIi9qUv+pDWx\ngGWEc560hPzddhYniayKLJYKnO2fJsjJzqKkPN1DKOeq+Iqhda/CpfbRYdNnRqvH\nekxAFY27uDpZKt6Zmsc8+E+b5sd2L1QWPpHTl/j5B+6+MPE=\n=0lze\n-----END PGP SIGNATURE-----", "payload": "tree a8dcdd8a6e2610cd982b678a57bbea8d61816cc4\nparent 13921dafbff6dcff629164fda7ab454615301877\nauthor Oliver Schneider <git-no-reply-9879165716479413131@oli-obk.de> 1505036936 +0200\ncommitter Oliver Schneider <git-no-reply-9879165716479413131@oli-obk.de> 1505677305 +0200\n\nPrevent distribution if miri is enabled\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a", "html_url": "https://github.com/rust-lang/rust/commit/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13921dafbff6dcff629164fda7ab454615301877", "url": "https://api.github.com/repos/rust-lang/rust/commits/13921dafbff6dcff629164fda7ab454615301877", "html_url": "https://github.com/rust-lang/rust/commit/13921dafbff6dcff629164fda7ab454615301877"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "1af96f1bf0b8f3ebaa3b1c6215ee7c3a35d5103d", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a", "patch": "@@ -260,7 +260,7 @@ impl<'a> Builder<'a> {\n                 doc::Reference, doc::Rustdoc, doc::CargoBook),\n             Kind::Dist => describe!(dist::Docs, dist::Mingw, dist::Rustc, dist::DebuggerScripts,\n                 dist::Std, dist::Analysis, dist::Src, dist::PlainSourceTarball, dist::Cargo,\n-                dist::Rls, dist::Extended, dist::HashSign),\n+                dist::Rls, dist::Extended, dist::HashSign, dist::DontDistWithMiriEnabled),\n             Kind::Install => describe!(install::Docs, install::Std, install::Cargo, install::Rls,\n                 install::Analysis, install::Src, install::Rustc),\n         }"}, {"sha": "5188604b0a69a463f1203dafd2e5b885bac81448", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=68fc65eaf2a17c5fad14911b15f8a13d5c3d5b4a", "patch": "@@ -1111,6 +1111,31 @@ impl Step for Rls {\n     }\n }\n \n+\n+#[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]\n+pub struct DontDistWithMiriEnabled;\n+\n+impl Step for DontDistWithMiriEnabled {\n+    type Output = PathBuf;\n+    const DEFAULT: bool = true;\n+\n+    fn should_run(run: ShouldRun) -> ShouldRun {\n+        let build_miri = run.builder.build.config.test_miri;\n+        run.default_condition(build_miri)\n+    }\n+\n+    fn make_run(run: RunConfig) {\n+        run.builder.ensure(DontDistWithMiriEnabled);\n+    }\n+\n+    fn run(self, _: &Builder) -> PathBuf {\n+        panic!(\"Do not distribute with miri enabled.\\n\\\n+                The distributed libraries would include all MIR (increasing binary size).\n+                The distributed MIR would include validation statements.\");\n+    }\n+}\n+\n+\n #[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]\n pub struct Extended {\n     stage: u32,"}]}