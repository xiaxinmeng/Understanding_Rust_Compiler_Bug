{"sha": "73e8ce1e1f2461995031421b555d48da7f5ea086", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczZThjZTFlMWYyNDYxOTk1MDMxNDIxYjU1NWQ0OGRhN2Y1ZWEwODY=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-09-15T02:58:40Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-09-15T02:59:07Z"}, "message": "rustc: Back out box annihilator", "tree": {"sha": "f925b4ea93d3706bcd2d75358d375b68e72411f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f925b4ea93d3706bcd2d75358d375b68e72411f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73e8ce1e1f2461995031421b555d48da7f5ea086", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73e8ce1e1f2461995031421b555d48da7f5ea086", "html_url": "https://github.com/rust-lang/rust/commit/73e8ce1e1f2461995031421b555d48da7f5ea086", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73e8ce1e1f2461995031421b555d48da7f5ea086/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa2ab2659f6c7aca79ddaaac5370da8aea6a18d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa2ab2659f6c7aca79ddaaac5370da8aea6a18d6", "html_url": "https://github.com/rust-lang/rust/commit/aa2ab2659f6c7aca79ddaaac5370da8aea6a18d6"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "78c999f5076be9a59b5626c9051b118772c0dba5", "filename": "src/libcore/task.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/73e8ce1e1f2461995031421b555d48da7f5ea086/src%2Flibcore%2Ftask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73e8ce1e1f2461995031421b555d48da7f5ea086/src%2Flibcore%2Ftask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftask.rs?ref=73e8ce1e1f2461995031421b555d48da7f5ea086", "patch": "@@ -1355,10 +1355,16 @@ fn spawn_raw(+opts: TaskOpts, +f: fn~()) {\n                 let group = @TCB(child, move child_arc, move ancestors,\n                                  is_main, move notifier);\n                 unsafe { local_set(child, taskgroup_key!(), group); }\n+\n                 // Run the child's body.\n                 f();\n+\n                 // TLS cleanup code will exit the taskgroup.\n             }\n+\n+            // Run the box annihilator.\n+            // XXX: Crashy.\n+            // unsafe { cleanup::annihilate(); }\n         };\n \n         // Set up membership in taskgroup and descendantship in all ancestor"}, {"sha": "ef791cd5020b9383bf9f60e297bdcaeac5553483", "filename": "src/rustc/middle/trans/base.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/73e8ce1e1f2461995031421b555d48da7f5ea086/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73e8ce1e1f2461995031421b555d48da7f5ea086/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=73e8ce1e1f2461995031421b555d48da7f5ea086", "patch": "@@ -1994,9 +1994,10 @@ fn create_main_wrapper(ccx: @crate_ctxt, sp: span, main_llfn: ValueRef,\n         Call(bcx, main_llfn, args);\n \n         // Call the box annihilator.\n-        let did = bcx.tcx().lang_items.annihilate_fn.get();\n-        let bcx = callee::trans_rtcall_or_lang_call(bcx, did, ~[],\n-                                                    expr::Ignore);\n+        // XXX: Crashes.\n+        //let did = bcx.tcx().lang_items.annihilate_fn.get();\n+        //let bcx = callee::trans_rtcall_or_lang_call(bcx, did, ~[],\n+        //                                            expr::Ignore);\n \n         build_return(bcx);\n         finish_fn(fcx, lltop);"}]}