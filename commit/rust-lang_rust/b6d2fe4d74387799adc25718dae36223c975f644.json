{"sha": "b6d2fe4d74387799adc25718dae36223c975f644", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2ZDJmZTRkNzQzODc3OTlhZGMyNTcxOGRhZTM2MjIzYzk3NWY2NDQ=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-05-20T00:26:42Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-05-20T03:32:09Z"}, "message": "rustc: Translate else if blocks the same as other blocks. Closes #388", "tree": {"sha": "c120b4203d96c3c6f163bbe0ab28666e2961fe66", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c120b4203d96c3c6f163bbe0ab28666e2961fe66"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6d2fe4d74387799adc25718dae36223c975f644", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6d2fe4d74387799adc25718dae36223c975f644", "html_url": "https://github.com/rust-lang/rust/commit/b6d2fe4d74387799adc25718dae36223c975f644", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6d2fe4d74387799adc25718dae36223c975f644/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "879a952a372f917031857b56c5cc485f5d34b811", "url": "https://api.github.com/repos/rust-lang/rust/commits/879a952a372f917031857b56c5cc485f5d34b811", "html_url": "https://github.com/rust-lang/rust/commit/879a952a372f917031857b56c5cc485f5d34b811"}], "stats": {"total": 27, "additions": 16, "deletions": 11}, "files": [{"sha": "23c74e063361532db0b56e94c7bf865e02ab65a4", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/b6d2fe4d74387799adc25718dae36223c975f644/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6d2fe4d74387799adc25718dae36223c975f644/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=b6d2fe4d74387799adc25718dae36223c975f644", "patch": "@@ -3670,15 +3670,18 @@ fn trans_if(&@block_ctxt cx, &@ast::expr cond,\n     alt (els) {\n         case (some[@ast::expr](?elexpr)) {\n             alt (elexpr.node) {\n-                case (ast::expr_if(?cond, ?thn, ?els, _)) {\n-                    else_res = trans_if(else_cx, cond, thn, els);\n-                    // The if expression may need to use the else context to\n-                    // drop the refcount of its result so we need to run the\n-                    // cleanups\n-                    auto bcx = else_res.bcx;\n-                    bcx = trans_block_cleanups(bcx,\n-                                               find_scope_cx(bcx));\n-                    else_res = res(bcx, else_res.val);\n+                case (ast::expr_if(_, _, _, ?ann)) {\n+                    // Synthesize a block here to act as the else block\n+                    // containing an if expression. Needed in order for the\n+                    // else scope to behave like a normal block scope. A tad\n+                    // ugly.\n+                    let ast::block_ elseif_blk_\n+                        = rec(stmts = [],\n+                              expr = some[@ast::expr](elexpr),\n+                              a = ann);\n+                    auto elseif_blk = rec(node = elseif_blk_,\n+                                          span = elexpr.span);\n+                    else_res = trans_block(else_cx, elseif_blk);\n                 }\n                 case (ast::expr_block(?blk, _)) {\n                     // Calling trans_block directly instead of trans_expr"}, {"sha": "b8e9e079ff7cc0f03aed2c461ff375dd8c89d522", "filename": "src/test/run-pass/expr-block-ref.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b6d2fe4d74387799adc25718dae36223c975f644/src%2Ftest%2Frun-pass%2Fexpr-block-ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6d2fe4d74387799adc25718dae36223c975f644/src%2Ftest%2Frun-pass%2Fexpr-block-ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fexpr-block-ref.rs?ref=b6d2fe4d74387799adc25718dae36223c975f644", "patch": "@@ -1,5 +1,7 @@\n // xfail-stage0\n \n+// Regression test for issue #388\n+\n fn main() {\n   auto x = {{[10]}};\n }"}, {"sha": "ef78960e3d0fafc624074f8dd2d09595c8fa8ef8", "filename": "src/test/run-pass/expr-elseif-ref2.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b6d2fe4d74387799adc25718dae36223c975f644/src%2Ftest%2Frun-pass%2Fexpr-elseif-ref2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6d2fe4d74387799adc25718dae36223c975f644/src%2Ftest%2Frun-pass%2Fexpr-elseif-ref2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fexpr-elseif-ref2.rs?ref=b6d2fe4d74387799adc25718dae36223c975f644", "patch": "@@ -1,6 +1,6 @@\n // xfail-stage0\n-// xfail-stage1\n-// xfail-stage2\n+\n+// Regression test for issue #388\n \n fn main() {\n   auto x = if (false) {"}]}