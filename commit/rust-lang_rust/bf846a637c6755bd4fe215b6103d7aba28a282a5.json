{"sha": "bf846a637c6755bd4fe215b6103d7aba28a282a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJmODQ2YTYzN2M2NzU1YmQ0ZmUyMTViNjEwM2Q3YWJhMjhhMjgyYTU=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-12-18T20:49:38Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-12-19T10:05:21Z"}, "message": "test-cargo-miri: be more clear that and why the test failed", "tree": {"sha": "10c2276168e601b94eff1647c0ea80c6465c2525", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/10c2276168e601b94eff1647c0ea80c6465c2525"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bf846a637c6755bd4fe215b6103d7aba28a282a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bf846a637c6755bd4fe215b6103d7aba28a282a5", "html_url": "https://github.com/rust-lang/rust/commit/bf846a637c6755bd4fe215b6103d7aba28a282a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bf846a637c6755bd4fe215b6103d7aba28a282a5/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61c0df793060e60e5bd106dec82fd0951decd63b", "url": "https://api.github.com/repos/rust-lang/rust/commits/61c0df793060e60e5bd106dec82fd0951decd63b", "html_url": "https://github.com/rust-lang/rust/commit/61c0df793060e60e5bd106dec82fd0951decd63b"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "7f7f2660c06224c9e9162ca48bde8cecd2b070c8", "filename": "test-cargo-miri/run-test.py", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/bf846a637c6755bd4fe215b6103d7aba28a282a5/test-cargo-miri%2Frun-test.py", "raw_url": "https://github.com/rust-lang/rust/raw/bf846a637c6755bd4fe215b6103d7aba28a282a5/test-cargo-miri%2Frun-test.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Frun-test.py?ref=bf846a637c6755bd4fe215b6103d7aba28a282a5", "patch": "@@ -7,6 +7,10 @@\n \n import sys, subprocess\n \n+def fail(msg):\n+    print(\"TEST FAIL: {}\".format(msg))\n+    sys.exit(1)\n+\n def test(name, cmd, stdout_ref, stderr_ref):\n     print(\"==> Testing `{}` <==\".format(name))\n     ## Call `cargo miri`, capture all output\n@@ -25,13 +29,11 @@ def test(name, cmd, stdout_ref, stderr_ref):\n     print(stderr, end=\"\")\n     # Test for failures\n     if p.returncode != 0:\n-        sys.exit(1)\n+        fail(\"Non-zero exit status\")\n     if stdout != open(stdout_ref).read():\n-        print(\"stdout does not match reference\")\n-        sys.exit(1)\n+        fail(\"stdout does not match reference\")\n     if stderr != open(stderr_ref).read():\n-        print(\"stderr does not match reference\")\n-        sys.exit(1)\n+        fail(\"stderr does not match reference\")\n \n def test_cargo_miri_run():\n     test(\"cargo miri run\", [\"cargo\", \"miri\", \"run\", \"-q\"], \"stdout.ref\", \"stderr.ref\")"}]}