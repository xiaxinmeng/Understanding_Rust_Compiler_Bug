{"sha": "c1635d7e61533550d6c58d4f92a01d1e6acd28e6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMxNjM1ZDdlNjE1MzM1NTBkNmM1OGQ0ZjkyYTAxZDFlNmFjZDI4ZTY=", "commit": {"author": {"name": "Jorge Aparicio", "email": "japaricious@gmail.com", "date": "2017-04-06T02:02:52Z"}, "committer": {"name": "Jorge Aparicio", "email": "japaricious@gmail.com", "date": "2017-04-06T02:02:52Z"}, "message": "cast the #[used] static to *i8\n\nto match the type signature of the llvm.used variable", "tree": {"sha": "38116588200328e6fb562371e0a9b3866fb3b035", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/38116588200328e6fb562371e0a9b3866fb3b035"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c1635d7e61533550d6c58d4f92a01d1e6acd28e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c1635d7e61533550d6c58d4f92a01d1e6acd28e6", "html_url": "https://github.com/rust-lang/rust/commit/c1635d7e61533550d6c58d4f92a01d1e6acd28e6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c1635d7e61533550d6c58d4f92a01d1e6acd28e6/comments", "author": null, "committer": null, "parents": [{"sha": "c759eea7a60941f28e7e7a370ba95eeae06ea013", "url": "https://api.github.com/repos/rust-lang/rust/commits/c759eea7a60941f28e7e7a370ba95eeae06ea013", "html_url": "https://github.com/rust-lang/rust/commit/c759eea7a60941f28e7e7a370ba95eeae06ea013"}], "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "378e1d7fc63f05b829b7a85181e77cfe859532ce", "filename": "src/librustc_trans/base.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c1635d7e61533550d6c58d4f92a01d1e6acd28e6/src%2Flibrustc_trans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c1635d7e61533550d6c58d4f92a01d1e6acd28e6/src%2Flibrustc_trans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fbase.rs?ref=c1635d7e61533550d6c58d4f92a01d1e6acd28e6", "patch": "@@ -1189,8 +1189,6 @@ pub fn trans_crate<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n \n             // Create llvm.used variable\n             if !ccx.used_statics().borrow().is_empty() {\n-                debug!(\"llvm.used\");\n-\n                 let name = CString::new(\"llvm.used\").unwrap();\n                 let section = CString::new(\"llvm.metadata\").unwrap();\n                 let array = C_array(Type::i8(&ccx).ptr_to(), &*ccx.used_statics().borrow());"}, {"sha": "ae8c2433fed7560394bfecd99f95481934ac1d67", "filename": "src/librustc_trans/consts.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c1635d7e61533550d6c58d4f92a01d1e6acd28e6/src%2Flibrustc_trans%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c1635d7e61533550d6c58d4f92a01d1e6acd28e6/src%2Flibrustc_trans%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fconsts.rs?ref=c1635d7e61533550d6c58d4f92a01d1e6acd28e6", "patch": "@@ -277,7 +277,8 @@ pub fn trans_static<'a, 'tcx>(ccx: &CrateContext<'a, 'tcx>,\n         base::set_link_section(ccx, g, attrs);\n \n         if attr::contains_name(attrs, \"used\") {\n-            ccx.used_statics().borrow_mut().push(g);\n+            let cast = llvm::LLVMConstPointerCast(g, Type::i8p(ccx).to_ref());\n+            ccx.used_statics().borrow_mut().push(cast);\n         }\n \n         Ok(g)"}]}