{"sha": "5dab3c5cf5383b1866b374d74305196b72a0b593", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVkYWIzYzVjZjUzODNiMTg2NmIzNzRkNzQzMDUxOTZiNzJhMGI1OTM=", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-09-11T01:16:58Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-09-11T01:28:44Z"}, "message": "feat(rustc_typeck): suggest removing bad parens in `(recv.method)()`\n\nFixes #88803", "tree": {"sha": "7c66664b87355a1e0b55f536fcbb5c2b866222d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7c66664b87355a1e0b55f536fcbb5c2b866222d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5dab3c5cf5383b1866b374d74305196b72a0b593", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5dab3c5cf5383b1866b374d74305196b72a0b593", "html_url": "https://github.com/rust-lang/rust/commit/5dab3c5cf5383b1866b374d74305196b72a0b593", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5dab3c5cf5383b1866b374d74305196b72a0b593/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b69fe57261086e70aea9d5b58819a1794bf7c121", "url": "https://api.github.com/repos/rust-lang/rust/commits/b69fe57261086e70aea9d5b58819a1794bf7c121", "html_url": "https://github.com/rust-lang/rust/commit/b69fe57261086e70aea9d5b58819a1794bf7c121"}], "stats": {"total": 37, "additions": 36, "deletions": 1}, "files": [{"sha": "851365934401829fa41a8fb9eccf4fab34d4ac7c", "filename": "compiler/rustc_typeck/src/check/expr.rs", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/5dab3c5cf5383b1866b374d74305196b72a0b593/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5dab3c5cf5383b1866b374d74305196b72a0b593/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs?ref=5dab3c5cf5383b1866b374d74305196b72a0b593", "patch": "@@ -1842,7 +1842,23 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             expr_t\n         );\n         err.span_label(field.span, \"method, not a field\");\n-        if !self.expr_in_place(expr.hir_id) {\n+        let expr_is_call = if let hir::Node::Expr(parent_expr) =\n+            self.tcx.hir().get(self.tcx.hir().get_parent_node(expr.hir_id))\n+        {\n+            matches!(parent_expr.kind, ExprKind::Call(..))\n+        } else {\n+            false\n+        };\n+        let expr_snippet =\n+            self.tcx.sess.source_map().span_to_snippet(expr.span).unwrap_or(String::new());\n+        if expr_is_call && expr_snippet.starts_with(\"(\") && expr_snippet.ends_with(\")\") {\n+            err.span_suggestion_short(\n+                expr.span,\n+                \"remove wrapping parentheses to call the method\",\n+                expr_snippet[1..expr_snippet.len() - 1].to_owned(),\n+                Applicability::MachineApplicable,\n+            );\n+        } else if !self.expr_in_place(expr.hir_id) {\n             self.suggest_method_call(\n                 &mut err,\n                 \"use parentheses to call the method\","}, {"sha": "fba233eec9b00b41014194ae946653c2a45ccfa0", "filename": "src/test/ui/typeck/issue-88803-call-expr-method.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5dab3c5cf5383b1866b374d74305196b72a0b593/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5dab3c5cf5383b1866b374d74305196b72a0b593/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.rs?ref=5dab3c5cf5383b1866b374d74305196b72a0b593", "patch": "@@ -0,0 +1,7 @@\n+fn main() {\n+    let a = Some(42);\n+    println!(\n+        \"The value is {}.\",\n+        (a.unwrap)() //~ERROR [E0615]\n+    );\n+}"}, {"sha": "9383848db941f33f79533df85fdbda42475f0012", "filename": "src/test/ui/typeck/issue-88803-call-expr-method.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5dab3c5cf5383b1866b374d74305196b72a0b593/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5dab3c5cf5383b1866b374d74305196b72a0b593/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-88803-call-expr-method.stderr?ref=5dab3c5cf5383b1866b374d74305196b72a0b593", "patch": "@@ -0,0 +1,12 @@\n+error[E0615]: attempted to take value of method `unwrap` on type `Option<{integer}>`\n+  --> $DIR/issue-88803-call-expr-method.rs:5:12\n+   |\n+LL |         (a.unwrap)()\n+   |         ---^^^^^^-\n+   |         |  |\n+   |         |  method, not a field\n+   |         help: remove wrapping parentheses to call the method\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0615`."}]}