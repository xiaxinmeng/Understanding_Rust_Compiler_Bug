{"sha": "5163912e564e754fdab395af66b5589cc3df2f1b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxNjM5MTJlNTY0ZTc1NGZkYWIzOTVhZjY2YjU1ODljYzNkZjJmMWI=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-11-18T03:09:08Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-11-18T03:09:08Z"}, "message": "Allow using `download-ci-llvm` from directories other than the root\n\nPreviously, bootstrap.py would attempt to find the LLVM commit from\n`src/llvm-project`. However, it assumed it was always being run from the\ntop-level directory, which isn't always the case.\n\nBefore:\n\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds//rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n\ncurl: (22) The requested URL returned error: 404\nfailed to run: curl -# -y 30 -Y 10 --connect-timeout 30 --retry 3 -Sf -o /tmp/tmppyh4w8 https://ci-artifacts.rust-lang.org/rustc-builds//rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\nBuild completed unsuccessfully in 0:00:02\n```\n\nAfter:\n\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/430feb24a46993e5073c1bb1b39da190d83fa2bf/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n ###################################################################################################################################################################### 100.0%\nextracting /home/joshua/rustc/src/bootstrap/build/cache/llvm-430feb24a46993e5073c1bb1b39da190d83fa2bf-False/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz\n```", "tree": {"sha": "a6d4ad0ee8bf8c693f79790d8161daf3a401958a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6d4ad0ee8bf8c693f79790d8161daf3a401958a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5163912e564e754fdab395af66b5589cc3df2f1b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5163912e564e754fdab395af66b5589cc3df2f1b", "html_url": "https://github.com/rust-lang/rust/commit/5163912e564e754fdab395af66b5589cc3df2f1b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5163912e564e754fdab395af66b5589cc3df2f1b/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c919f490bbcd2b29b74016101f7ec71aaa24bdbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/c919f490bbcd2b29b74016101f7ec71aaa24bdbb", "html_url": "https://github.com/rust-lang/rust/commit/c919f490bbcd2b29b74016101f7ec71aaa24bdbb"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "4eb828a5be2dbdac98241549becbef119f312ee1", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5163912e564e754fdab395af66b5589cc3df2f1b/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/5163912e564e754fdab395af66b5589cc3df2f1b/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=5163912e564e754fdab395af66b5589cc3df2f1b", "patch": "@@ -447,12 +447,15 @@ def download_stage0(self):\n             #\n             # This works even in a repository that has not yet initialized\n             # submodules.\n+            top_level = subprocess.check_output([\n+                \"git\", \"rev-parse\", \"--show-toplevel\",\n+            ]).decode(sys.getdefaultencoding()).strip()\n             llvm_sha = subprocess.check_output([\n                 \"git\", \"log\", \"--author=bors\", \"--format=%H\", \"-n1\",\n                 \"-m\", \"--first-parent\",\n                 \"--\",\n-                \"src/llvm-project\",\n-                \"src/bootstrap/download-ci-llvm-stamp\",\n+                \"{}/src/llvm-project\".format(top_level),\n+                \"{}/src/bootstrap/download-ci-llvm-stamp\".format(top_level),\n             ]).decode(sys.getdefaultencoding()).strip()\n             llvm_assertions = self.get_toml('assertions', 'llvm') == 'true'\n             if self.program_out_of_date(self.llvm_stamp(), llvm_sha + str(llvm_assertions)):"}]}