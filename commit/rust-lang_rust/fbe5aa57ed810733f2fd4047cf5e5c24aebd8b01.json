{"sha": "fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiZTVhYTU3ZWQ4MTA3MzNmMmZkNDA0N2NmNWU1YzI0YWViZDhiMDE=", "commit": {"author": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2018-12-08T11:09:44Z"}, "committer": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2018-12-08T15:01:09Z"}, "message": "Override Cycle::try_fold\n\n name                            old ns/iter  new ns/iter  diff ns/iter   diff %  speedup\n iter::bench_cycle_take_ref_sum  927,152      927,194                42    0.00%   x 1.00\n iter::bench_cycle_take_sum      938,129      603,492          -334,637  -35.67%   x 1.55", "tree": {"sha": "4e73ad57e1fa2caade9ed56636661739150e3ede", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4e73ad57e1fa2caade9ed56636661739150e3ede"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01", "html_url": "https://github.com/rust-lang/rust/commit/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "15a2607863fded7570cacfc7825702dde5a4234c", "url": "https://api.github.com/repos/rust-lang/rust/commits/15a2607863fded7570cacfc7825702dde5a4234c", "html_url": "https://github.com/rust-lang/rust/commit/15a2607863fded7570cacfc7825702dde5a4234c"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "b0aca658343702fb67cf6da3dc65494fa8654621", "filename": "src/libcore/benches/iter.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01/src%2Flibcore%2Fbenches%2Fiter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01/src%2Flibcore%2Fbenches%2Fiter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fbenches%2Fiter.rs?ref=fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01", "patch": "@@ -282,6 +282,12 @@ bench_sums! {\n     (0i64..1000000).chain(1000000..).take_while(|&x| x < 1111111)\n }\n \n+bench_sums! {\n+    bench_cycle_take_sum,\n+    bench_cycle_take_ref_sum,\n+    (0i64..10000).cycle().take(1000000)\n+}\n+\n // Checks whether Skip<Zip<A,B>> is as fast as Zip<Skip<A>, Skip<B>>, from\n // https://users.rust-lang.org/t/performance-difference-between-iterator-zip-and-skip-order/15743\n #[bench]"}, {"sha": "83d35324bc2507cc1f45ea2ac095cc4f2bb126b3", "filename": "src/libcore/iter/mod.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01/src%2Flibcore%2Fiter%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01/src%2Flibcore%2Fiter%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fiter%2Fmod.rs?ref=fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01", "patch": "@@ -649,6 +649,19 @@ impl<I> Iterator for Cycle<I> where I: Clone + Iterator {\n             _ => (usize::MAX, None)\n         }\n     }\n+\n+    #[inline]\n+    fn try_fold<Acc, F, R>(&mut self, init: Acc, mut f: F) -> R where\n+        Self: Sized, F: FnMut(Acc, Self::Item) -> R, R: Try<Ok=Acc>\n+    {\n+        let mut accum = init;\n+        while let Some(x) = self.iter.next() {\n+            accum = f(accum, x)?;\n+            accum = self.iter.try_fold(accum, &mut f)?;\n+            self.iter = self.orig.clone();\n+        }\n+        Try::from_ok(accum)\n+    }\n }\n \n #[stable(feature = \"fused\", since = \"1.26.0\")]"}, {"sha": "4efa01363146b314aa6ac50964a95605f73ae68e", "filename": "src/libcore/tests/iter.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01/src%2Flibcore%2Ftests%2Fiter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01/src%2Flibcore%2Ftests%2Fiter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fiter.rs?ref=fbe5aa57ed810733f2fd4047cf5e5c24aebd8b01", "patch": "@@ -1001,6 +1001,8 @@ fn test_cycle() {\n     let mut it = (0..).step_by(1).take(0).cycle();\n     assert_eq!(it.size_hint(), (0, Some(0)));\n     assert_eq!(it.next(), None);\n+\n+    assert_eq!(empty::<i32>().cycle().fold(0, |acc, x| acc + x), 0);\n }\n \n #[test]"}]}