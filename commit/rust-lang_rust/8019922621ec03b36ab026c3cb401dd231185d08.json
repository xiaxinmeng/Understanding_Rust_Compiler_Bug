{"sha": "8019922621ec03b36ab026c3cb401dd231185d08", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwMTk5MjI2MjFlYzAzYjM2YWIwMjZjM2NiNDAxZGQyMzExODVkMDg=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-04-06T18:03:42Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-04-07T22:45:45Z"}, "message": "Fix cargotest", "tree": {"sha": "48c1f9327036d0c3dd464b832addaab3dbb8e42c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48c1f9327036d0c3dd464b832addaab3dbb8e42c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8019922621ec03b36ab026c3cb401dd231185d08", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8019922621ec03b36ab026c3cb401dd231185d08", "html_url": "https://github.com/rust-lang/rust/commit/8019922621ec03b36ab026c3cb401dd231185d08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8019922621ec03b36ab026c3cb401dd231185d08/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "943ec3bdfc9ba28e94b6d00a2b53fb2cd8b21655", "url": "https://api.github.com/repos/rust-lang/rust/commits/943ec3bdfc9ba28e94b6d00a2b53fb2cd8b21655", "html_url": "https://github.com/rust-lang/rust/commit/943ec3bdfc9ba28e94b6d00a2b53fb2cd8b21655"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "a2445ae498a77451b960c3458706e08fcfd3c385", "filename": "src/bootstrap/build/check.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8019922621ec03b36ab026c3cb401dd231185d08/src%2Fbootstrap%2Fbuild%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8019922621ec03b36ab026c3cb401dd231185d08/src%2Fbootstrap%2Fbuild%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fcheck.rs?ref=8019922621ec03b36ab026c3cb401dd231185d08", "patch": "@@ -18,9 +18,18 @@ pub fn linkcheck(build: &Build, stage: u32, host: &str) {\n }\n \n pub fn cargotest(build: &Build, stage: u32, host: &str) {\n+\n     let ref compiler = Compiler::new(stage, host);\n+\n+    // Configure PATH to find the right rustc. NB. we have to use PATH\n+    // and not RUSTC because the Cargo test suite has tests that will\n+    // fail if rustc is not spelled `rustc`.\n+    let path = build.sysroot(compiler).join(\"bin\");\n+    let old_path = ::std::env::var(\"PATH\").expect(\"\");\n+    let sep = if cfg!(windows) { \";\" } else {\":\" };\n+    let ref newpath = format!(\"{}{}{}\", path.display(), sep, old_path);\n+\n     build.run(build.tool_cmd(compiler, \"cargotest\")\n-              .env(\"RUSTC\", build.compiler_path(compiler))\n-              .env(\"RUSTDOC\", build.rustdoc(compiler))\n+              .env(\"PATH\", newpath)\n               .arg(&build.cargo));\n }"}, {"sha": "ace0398cb24b90c58d7d769fff1213da8067133c", "filename": "src/bootstrap/build/step.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8019922621ec03b36ab026c3cb401dd231185d08/src%2Fbootstrap%2Fbuild%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8019922621ec03b36ab026c3cb401dd231185d08/src%2Fbootstrap%2Fbuild%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fstep.rs?ref=8019922621ec03b36ab026c3cb401dd231185d08", "patch": "@@ -319,7 +319,7 @@ impl<'a> Step<'a> {\n                 vec![self.librustc(self.compiler(stage))]\n             }\n             Source::ToolCargoTest { stage } => {\n-                vec![self.libstd(self.compiler(stage))]\n+                vec![self.librustc(self.compiler(stage))]\n             }\n \n             Source::DistDocs { stage } => vec![self.doc(stage)],"}, {"sha": "87a0103867595fd192418febe6297f8d752a6473", "filename": "src/tools/cargotest/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8019922621ec03b36ab026c3cb401dd231185d08/src%2Ftools%2Fcargotest%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8019922621ec03b36ab026c3cb401dd231185d08/src%2Ftools%2Fcargotest%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcargotest%2Fmain.rs?ref=8019922621ec03b36ab026c3cb401dd231185d08", "patch": "@@ -19,7 +19,7 @@ use std::io::Write;\n \n const TEST_REPOS: &'static [(&'static str, &'static str, Option<&'static str>)] = &[\n     (\"https://github.com/rust-lang/cargo\",\n-     \"ff02b156f094fb83e70acd965c83c9286411914e\",\n+     \"fae9c539388f1b7c70c31fd0a21b5dd9cd071177\",\n      None),\n     (\"https://github.com/iron/iron\",\n      \"16c858ec2901e2992fe5e529780f59fa8ed12903\","}]}