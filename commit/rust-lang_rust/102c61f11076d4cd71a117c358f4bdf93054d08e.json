{"sha": "102c61f11076d4cd71a117c358f4bdf93054d08e", "node_id": "C_kwDOAAsO6NoAKDEwMmM2MWYxMTA3NmQ0Y2Q3MWExMTdjMzU4ZjRiZGY5MzA1NGQwOGU", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-08-22T04:28:40Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-08-22T04:32:18Z"}, "message": "Simplify create_substs_for_associated_item", "tree": {"sha": "8d4b11b5d1b5275c90d747f0851a325371a4ea41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8d4b11b5d1b5275c90d747f0851a325371a4ea41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/102c61f11076d4cd71a117c358f4bdf93054d08e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/102c61f11076d4cd71a117c358f4bdf93054d08e", "html_url": "https://github.com/rust-lang/rust/commit/102c61f11076d4cd71a117c358f4bdf93054d08e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/102c61f11076d4cd71a117c358f4bdf93054d08e/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6e83da1a2d2332c6a68f83200067d3a7897b73e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e83da1a2d2332c6a68f83200067d3a7897b73e8", "html_url": "https://github.com/rust-lang/rust/commit/6e83da1a2d2332c6a68f83200067d3a7897b73e8"}], "stats": {"total": 65, "additions": 33, "deletions": 32}, "files": [{"sha": "7cedec8987a5713b1b8bf79c2f1055c3bc574d6f", "filename": "compiler/rustc_typeck/src/astconv/mod.rs", "status": "modified", "additions": 10, "deletions": 19, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/102c61f11076d4cd71a117c358f4bdf93054d08e/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/102c61f11076d4cd71a117c358f4bdf93054d08e/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs?ref=102c61f11076d4cd71a117c358f4bdf93054d08e", "patch": "@@ -591,7 +591,6 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n \n     pub(crate) fn create_substs_for_associated_item(\n         &self,\n-        tcx: TyCtxt<'tcx>,\n         span: Span,\n         item_def_id: DefId,\n         item_segment: &hir::PathSegment<'_>,\n@@ -601,22 +600,16 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n             \"create_substs_for_associated_item(span: {:?}, item_def_id: {:?}, item_segment: {:?}\",\n             span, item_def_id, item_segment\n         );\n-        if tcx.generics_of(item_def_id).params.is_empty() {\n-            self.prohibit_generics(slice::from_ref(item_segment).iter(), |_| {});\n-\n-            parent_substs\n-        } else {\n-            self.create_substs_for_ast_path(\n-                span,\n-                item_def_id,\n-                parent_substs,\n-                item_segment,\n-                item_segment.args(),\n-                item_segment.infer_args,\n-                None,\n-            )\n-            .0\n-        }\n+        self.create_substs_for_ast_path(\n+            span,\n+            item_def_id,\n+            parent_substs,\n+            item_segment,\n+            item_segment.args(),\n+            item_segment.infer_args,\n+            None,\n+        )\n+        .0\n     }\n \n     /// Instantiates the path for the given trait reference, assuming that it's\n@@ -1129,7 +1122,6 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n             };\n \n             let substs_trait_ref_and_assoc_item = self.create_substs_for_associated_item(\n-                tcx,\n                 path_span,\n                 assoc_item.def_id,\n                 &item_segment,\n@@ -2105,7 +2097,6 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n             self.ast_path_to_mono_trait_ref(span, trait_def_id, self_ty, trait_segment, false);\n \n         let item_substs = self.create_substs_for_associated_item(\n-            tcx,\n             span,\n             item_def_id,\n             item_segment,"}, {"sha": "62a61075231aadd645e29dea51e729c9277e956c", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/mod.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/102c61f11076d4cd71a117c358f4bdf93054d08e/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/102c61f11076d4cd71a117c358f4bdf93054d08e/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fmod.rs?ref=102c61f11076d4cd71a117c358f4bdf93054d08e", "patch": "@@ -279,7 +279,6 @@ impl<'a, 'tcx> AstConv<'tcx> for FnCtxt<'a, 'tcx> {\n \n         let item_substs = <dyn AstConv<'tcx>>::create_substs_for_associated_item(\n             self,\n-            self.tcx,\n             span,\n             item_def_id,\n             item_segment,"}, {"sha": "1048f8b1475ee2dd04a3a474142dd9f2da3a9d8a", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/102c61f11076d4cd71a117c358f4bdf93054d08e/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/102c61f11076d4cd71a117c358f4bdf93054d08e/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=102c61f11076d4cd71a117c358f4bdf93054d08e", "patch": "@@ -430,7 +430,6 @@ impl<'tcx> AstConv<'tcx> for ItemCtxt<'tcx> {\n         if let Some(trait_ref) = poly_trait_ref.no_bound_vars() {\n             let item_substs = <dyn AstConv<'tcx>>::create_substs_for_associated_item(\n                 self,\n-                self.tcx,\n                 span,\n                 item_def_id,\n                 item_segment,"}, {"sha": "2dd7174a9bed8e93e6cd72ec52b592fdd62f944e", "filename": "src/test/ui/structs/struct-path-associated-type.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/102c61f11076d4cd71a117c358f4bdf93054d08e/src%2Ftest%2Fui%2Fstructs%2Fstruct-path-associated-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/102c61f11076d4cd71a117c358f4bdf93054d08e/src%2Ftest%2Fui%2Fstructs%2Fstruct-path-associated-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstructs%2Fstruct-path-associated-type.rs?ref=102c61f11076d4cd71a117c358f4bdf93054d08e", "patch": "@@ -13,7 +13,7 @@ fn f<T: Tr>() {\n     //~^ ERROR expected struct, variant or union type, found associated type\n     let z = T::A::<u8> {};\n     //~^ ERROR expected struct, variant or union type, found associated type\n-    //~| ERROR type arguments are not allowed on this type\n+    //~| ERROR this associated type takes 0 generic arguments but 1 generic argument was supplied\n     match S {\n         T::A {} => {}\n         //~^ ERROR expected struct, variant or union type, found associated type\n@@ -22,7 +22,7 @@ fn f<T: Tr>() {\n \n fn g<T: Tr<A = S>>() {\n     let s = T::A {}; // OK\n-    let z = T::A::<u8> {}; //~ ERROR type arguments are not allowed on this type\n+    let z = T::A::<u8> {}; //~ ERROR this associated type takes 0 generic arguments but 1 generic argument was supplied\n     match S {\n         T::A {} => {} // OK\n     }"}, {"sha": "abb445214f362f2d9515cc92195c0ed49870e472", "filename": "src/test/ui/structs/struct-path-associated-type.stderr", "status": "modified", "additions": 21, "deletions": 9, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/102c61f11076d4cd71a117c358f4bdf93054d08e/src%2Ftest%2Fui%2Fstructs%2Fstruct-path-associated-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/102c61f11076d4cd71a117c358f4bdf93054d08e/src%2Ftest%2Fui%2Fstructs%2Fstruct-path-associated-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstructs%2Fstruct-path-associated-type.stderr?ref=102c61f11076d4cd71a117c358f4bdf93054d08e", "patch": "@@ -4,13 +4,19 @@ error[E0071]: expected struct, variant or union type, found associated type\n LL |     let s = T::A {};\n    |             ^^^^ not a struct\n \n-error[E0109]: type arguments are not allowed on this type\n-  --> $DIR/struct-path-associated-type.rs:14:20\n+error[E0107]: this associated type takes 0 generic arguments but 1 generic argument was supplied\n+  --> $DIR/struct-path-associated-type.rs:14:16\n    |\n LL |     let z = T::A::<u8> {};\n-   |                -   ^^ type argument not allowed\n+   |                ^------ help: remove these generics\n    |                |\n-   |                not allowed on this type\n+   |                expected 0 generic arguments\n+   |\n+note: associated type defined here, with 0 generic parameters\n+  --> $DIR/struct-path-associated-type.rs:4:10\n+   |\n+LL |     type A;\n+   |          ^\n \n error[E0071]: expected struct, variant or union type, found associated type\n   --> $DIR/struct-path-associated-type.rs:14:13\n@@ -24,13 +30,19 @@ error[E0071]: expected struct, variant or union type, found associated type\n LL |         T::A {} => {}\n    |         ^^^^ not a struct\n \n-error[E0109]: type arguments are not allowed on this type\n-  --> $DIR/struct-path-associated-type.rs:25:20\n+error[E0107]: this associated type takes 0 generic arguments but 1 generic argument was supplied\n+  --> $DIR/struct-path-associated-type.rs:25:16\n    |\n LL |     let z = T::A::<u8> {};\n-   |                -   ^^ type argument not allowed\n+   |                ^------ help: remove these generics\n    |                |\n-   |                not allowed on this type\n+   |                expected 0 generic arguments\n+   |\n+note: associated type defined here, with 0 generic parameters\n+  --> $DIR/struct-path-associated-type.rs:4:10\n+   |\n+LL |     type A;\n+   |          ^\n \n error[E0223]: ambiguous associated type\n   --> $DIR/struct-path-associated-type.rs:32:13\n@@ -52,5 +64,5 @@ LL |         S::A {} => {}\n \n error: aborting due to 8 previous errors\n \n-Some errors have detailed explanations: E0071, E0109, E0223.\n+Some errors have detailed explanations: E0071, E0107, E0223.\n For more information about an error, try `rustc --explain E0071`."}]}