{"sha": "92861c79276cee63e53ed4c63111cd37560c458c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyODYxYzc5Mjc2Y2VlNjNlNTNlZDRjNjMxMTFjZDM3NTYwYzQ1OGM=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-03-05T20:44:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-05T20:44:37Z"}, "message": "Rollup merge of #80845 - GuillaumeGomez:item-kind-transition, r=jyn514\n\nMake ItemKind::ExternCrate looks like hir::ItemKind::ExternCrate to make transition over hir::ItemKind simpler\n\nIt was surprisingly difficult to make this change, mostly because of two issues:\n\n* We now store the `ExternCrate` name in the parent struct (`clean::Item`), which forced me to modify the json conversion code a bit more than expected.\n* The second problem was that, since we now have a `Some(name)`, it was trying to render it, ending up in a panic because we ended up in a `unreachable` statement. The solution was simply to add `!item.is_extern_crate()` in `formats::renderer` before calling `cx.item(item, &cache)?;`.\n\nI'll continue to replace all the `clean::ItemKind` variants one by one until it looks exactly like `hir::ItemKind`. Then we'll simply discard the rustdoc type. Once this done, we'll be able to discard `clean::Item` too to use `hir::Item`.\n\nr? ``@jyn514``", "tree": {"sha": "6ff6c7c2b59c66572b44986909a15d6ccf800784", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ff6c7c2b59c66572b44986909a15d6ccf800784"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92861c79276cee63e53ed4c63111cd37560c458c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgQpg2CRBK7hj4Ov3rIwAAdHIIAJGZDLXM+Ts6zD+Uu5Itp5y+\nzhPrCPApyXtZs1m0NtXVACXAiYdEveaT1OrmSToD8Y0uN69dCGvt1G549pxDqNXZ\nu3H42ZK2Sft5/eX1WTVeg9D+mtTCP2gsNZUvX1W39D4k3DCBmWWQ6PiPzXCBGlG6\nj5kLPXg60ri8OZcq28nLwEBAJPqCZ8m+euUxH2lps2g/S1J1ERQTvNzCxQsUQVAD\nmA+jbAhmXJ89KrW+2vZu+kpisySutJazf89WjLVBxUUizexOhcbYYFosYuoXJC6v\nxRUIiB3vf14gsBlViZcBKjOViTXonoRBKEcQeafKOFCVdXibmxgupBKG2e05JJw=\n=f3AM\n-----END PGP SIGNATURE-----\n", "payload": "tree 6ff6c7c2b59c66572b44986909a15d6ccf800784\nparent 8fd946c63a6c3aae9788bd459d278cb2efa77099\nparent 286a3570454b08fbf7fae890f19500190f55e0dc\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1614977077 +0100\ncommitter GitHub <noreply@github.com> 1614977077 +0100\n\nRollup merge of #80845 - GuillaumeGomez:item-kind-transition, r=jyn514\n\nMake ItemKind::ExternCrate looks like hir::ItemKind::ExternCrate to make transition over hir::ItemKind simpler\n\nIt was surprisingly difficult to make this change, mostly because of two issues:\n\n* We now store the `ExternCrate` name in the parent struct (`clean::Item`), which forced me to modify the json conversion code a bit more than expected.\n* The second problem was that, since we now have a `Some(name)`, it was trying to render it, ending up in a panic because we ended up in a `unreachable` statement. The solution was simply to add `!item.is_extern_crate()` in `formats::renderer` before calling `cx.item(item, &cache)?;`.\n\nI'll continue to replace all the `clean::ItemKind` variants one by one until it looks exactly like `hir::ItemKind`. Then we'll simply discard the rustdoc type. Once this done, we'll be able to discard `clean::Item` too to use `hir::Item`.\n\nr? ``@jyn514``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92861c79276cee63e53ed4c63111cd37560c458c", "html_url": "https://github.com/rust-lang/rust/commit/92861c79276cee63e53ed4c63111cd37560c458c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92861c79276cee63e53ed4c63111cd37560c458c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8fd946c63a6c3aae9788bd459d278cb2efa77099", "url": "https://api.github.com/repos/rust-lang/rust/commits/8fd946c63a6c3aae9788bd459d278cb2efa77099", "html_url": "https://github.com/rust-lang/rust/commit/8fd946c63a6c3aae9788bd459d278cb2efa77099"}, {"sha": "286a3570454b08fbf7fae890f19500190f55e0dc", "url": "https://api.github.com/repos/rust-lang/rust/commits/286a3570454b08fbf7fae890f19500190f55e0dc", "html_url": "https://github.com/rust-lang/rust/commit/286a3570454b08fbf7fae890f19500190f55e0dc"}], "stats": {"total": 100, "additions": 55, "deletions": 45}, "files": [{"sha": "29eb67f023f0bde23f03e45c60c31dac4f005297", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -2129,12 +2129,12 @@ fn clean_extern_crate(\n     }\n     // FIXME: using `from_def_id_and_kind` breaks `rustdoc/masked` for some reason\n     vec![Item {\n-        name: None,\n+        name: Some(name),\n         attrs: box krate.attrs.clean(cx),\n         source: krate.span.clean(cx),\n         def_id: crate_def_id,\n         visibility: krate.vis.clean(cx),\n-        kind: box ExternCrateItem(name, orig_name),\n+        kind: box ExternCrateItem { src: orig_name },\n     }]\n }\n "}, {"sha": "e560843383ec552a6cf959b2463bc98c9b5dc5c1", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -323,7 +323,10 @@ impl Item {\n \n #[derive(Clone, Debug)]\n crate enum ItemKind {\n-    ExternCrateItem(Symbol, Option<Symbol>),\n+    ExternCrateItem {\n+        /// The crate's name, *not* the name it's imported as.\n+        src: Option<Symbol>,\n+    },\n     ImportItem(Import),\n     StructItem(Struct),\n     UnionItem(Union),\n@@ -376,7 +379,7 @@ impl ItemKind {\n             TraitItem(t) => t.items.iter(),\n             ImplItem(i) => i.items.iter(),\n             ModuleItem(m) => m.items.iter(),\n-            ExternCrateItem(_, _)\n+            ExternCrateItem { .. }\n             | ImportItem(_)\n             | FunctionItem(_)\n             | TypedefItem(_, _)"}, {"sha": "460d4b907c09a7f6f0a16ca5e1e52406d6736ab6", "filename": "src/librustdoc/formats/item_type.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fformats%2Fitem_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fformats%2Fitem_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fformats%2Fitem_type.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -67,7 +67,7 @@ impl<'a> From<&'a clean::Item> for ItemType {\n \n         match *kind {\n             clean::ModuleItem(..) => ItemType::Module,\n-            clean::ExternCrateItem(..) => ItemType::ExternCrate,\n+            clean::ExternCrateItem { .. } => ItemType::ExternCrate,\n             clean::ImportItem(..) => ItemType::Import,\n             clean::StructItem(..) => ItemType::Struct,\n             clean::UnionItem(..) => ItemType::Union,"}, {"sha": "0487da1e7d020c9d4f109f47c2315435cc7e1955", "filename": "src/librustdoc/formats/renderer.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fformats%2Frenderer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fformats%2Frenderer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fformats%2Frenderer.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -91,7 +91,9 @@ crate fn run_format<'tcx, T: FormatRenderer<'tcx>>(\n             }\n \n             cx.mod_item_out(&name)?;\n-        } else if item.name.is_some() {\n+        // FIXME: checking `item.name.is_some()` is very implicit and leads to lots of special\n+        // cases. Use an explicit match instead.\n+        } else if item.name.is_some() && !item.is_extern_crate() {\n             prof.generic_activity_with_arg(\"render_item\", &*item.name.unwrap_or(unknown).as_str())\n                 .run(|| cx.item(item))?;\n         }"}, {"sha": "6cdd3838023e62d52280c1b42335123e4d6a85a5", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -240,7 +240,7 @@ fn item_module(w: &mut Buffer, cx: &Context<'_>, item: &clean::Item, items: &[cl\n         }\n \n         match *myitem.kind {\n-            clean::ExternCrateItem(ref name, ref src) => {\n+            clean::ExternCrateItem { ref src } => {\n                 use crate::html::format::anchor;\n \n                 match *src {\n@@ -249,13 +249,13 @@ fn item_module(w: &mut Buffer, cx: &Context<'_>, item: &clean::Item, items: &[cl\n                         \"<tr><td><code>{}extern crate {} as {};\",\n                         myitem.visibility.print_with_space(cx.tcx(), myitem.def_id, cx.cache()),\n                         anchor(myitem.def_id, &*src.as_str(), cx.cache()),\n-                        name\n+                        myitem.name.as_ref().unwrap(),\n                     ),\n                     None => write!(\n                         w,\n                         \"<tr><td><code>{}extern crate {};\",\n                         myitem.visibility.print_with_space(cx.tcx(), myitem.def_id, cx.cache()),\n-                        anchor(myitem.def_id, &*name.as_str(), cx.cache())\n+                        anchor(myitem.def_id, &*myitem.name.as_ref().unwrap().as_str(), cx.cache()),\n                     ),\n                 }\n                 w.write_str(\"</code></td></tr>\");"}, {"sha": "47e4f3f0aa32082aecdac0e675a3fa1d4df6bbd4", "filename": "src/librustdoc/json/conversions.rs", "status": "modified", "additions": 34, "deletions": 31, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fjson%2Fconversions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fjson%2Fconversions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fjson%2Fconversions.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -10,6 +10,7 @@ use rustc_ast::ast;\n use rustc_hir::def::CtorKind;\n use rustc_middle::ty::TyCtxt;\n use rustc_span::def_id::{DefId, CRATE_DEF_INDEX};\n+use rustc_span::symbol::Symbol;\n use rustc_span::Pos;\n \n use rustdoc_json_types::*;\n@@ -25,32 +26,33 @@ impl JsonRenderer<'_> {\n         let item_type = ItemType::from(&item);\n         let deprecation = item.deprecation(self.tcx);\n         let clean::Item { source, name, attrs, kind, visibility, def_id } = item;\n-        match *kind {\n-            clean::StrippedItem(_) => None,\n-            kind => Some(Item {\n-                id: from_def_id(def_id),\n-                crate_id: def_id.krate.as_u32(),\n-                name: name.map(|sym| sym.to_string()),\n-                source: self.convert_span(source),\n-                visibility: self.convert_visibility(visibility),\n-                docs: attrs.collapsed_doc_value(),\n-                links: attrs\n-                    .links\n-                    .into_iter()\n-                    .filter_map(|clean::ItemLink { link, did, .. }| {\n-                        did.map(|did| (link, from_def_id(did)))\n-                    })\n-                    .collect(),\n-                attrs: attrs\n-                    .other_attrs\n-                    .iter()\n-                    .map(rustc_ast_pretty::pprust::attribute_to_string)\n-                    .collect(),\n-                deprecation: deprecation.map(from_deprecation),\n-                kind: item_type.into(),\n-                inner: from_clean_item_kind(kind, self.tcx),\n-            }),\n-        }\n+        let inner = match *kind {\n+            clean::StrippedItem(_) => return None,\n+            x => from_clean_item_kind(x, self.tcx, &name),\n+        };\n+        Some(Item {\n+            id: from_def_id(def_id),\n+            crate_id: def_id.krate.as_u32(),\n+            name: name.map(|sym| sym.to_string()),\n+            source: self.convert_span(source),\n+            visibility: self.convert_visibility(visibility),\n+            docs: attrs.collapsed_doc_value(),\n+            links: attrs\n+                .links\n+                .into_iter()\n+                .filter_map(|clean::ItemLink { link, did, .. }| {\n+                    did.map(|did| (link, from_def_id(did)))\n+                })\n+                .collect(),\n+            attrs: attrs\n+                .other_attrs\n+                .iter()\n+                .map(rustc_ast_pretty::pprust::attribute_to_string)\n+                .collect(),\n+            deprecation: deprecation.map(from_deprecation),\n+            kind: item_type.into(),\n+            inner,\n+        })\n     }\n \n     fn convert_span(&self, span: clean::Span) -> Option<Span> {\n@@ -149,13 +151,10 @@ crate fn from_def_id(did: DefId) -> Id {\n     Id(format!(\"{}:{}\", did.krate.as_u32(), u32::from(did.index)))\n }\n \n-fn from_clean_item_kind(item: clean::ItemKind, tcx: TyCtxt<'_>) -> ItemEnum {\n+fn from_clean_item_kind(item: clean::ItemKind, tcx: TyCtxt<'_>, name: &Option<Symbol>) -> ItemEnum {\n     use clean::ItemKind::*;\n     match item {\n         ModuleItem(m) => ItemEnum::ModuleItem(m.into()),\n-        ExternCrateItem(c, a) => {\n-            ItemEnum::ExternCrateItem { name: c.to_string(), rename: a.map(|x| x.to_string()) }\n-        }\n         ImportItem(i) => ItemEnum::ImportItem(i.into()),\n         StructItem(s) => ItemEnum::StructItem(s.into()),\n         UnionItem(u) => ItemEnum::UnionItem(u.into()),\n@@ -182,10 +181,14 @@ fn from_clean_item_kind(item: clean::ItemKind, tcx: TyCtxt<'_>) -> ItemEnum {\n             bounds: g.into_iter().map(Into::into).collect(),\n             default: t.map(Into::into),\n         },\n-        StrippedItem(inner) => from_clean_item_kind(*inner, tcx),\n+        StrippedItem(inner) => from_clean_item_kind(*inner, tcx, name),\n         PrimitiveItem(_) | KeywordItem(_) => {\n             panic!(\"{:?} is not supported for JSON output\", item)\n         }\n+        ExternCrateItem { ref src } => ItemEnum::ExternCrateItem {\n+            name: name.as_ref().unwrap().to_string(),\n+            rename: src.map(|x| x.to_string()),\n+        },\n     }\n }\n "}, {"sha": "863610baed4846655304b55e3d1a7d55302a9413", "filename": "src/librustdoc/json/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fjson%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fjson%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fjson%2Fmod.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -183,7 +183,7 @@ impl<'tcx> FormatRenderer<'tcx> for JsonRenderer<'tcx> {\n                 match &*item.kind {\n                     // These don't have names so they don't get added to the output by default\n                     ImportItem(_) => self.item(item.clone()).unwrap(),\n-                    ExternCrateItem(_, _) => self.item(item.clone()).unwrap(),\n+                    ExternCrateItem { .. } => self.item(item.clone()).unwrap(),\n                     ImplItem(i) => i.items.iter().for_each(|i| self.item(i.clone()).unwrap()),\n                     _ => {}\n                 }"}, {"sha": "0e975128628acbadfa686b6c21dcabadb79c1b71", "filename": "src/librustdoc/passes/calculate_doc_coverage.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -193,7 +193,7 @@ impl<'a, 'b> fold::DocFolder for CoverageCalculator<'a, 'b> {\n                 // don't count items in stripped modules\n                 return Some(i);\n             }\n-            clean::ImportItem(..) | clean::ExternCrateItem(..) => {\n+            clean::ImportItem(..) | clean::ExternCrateItem { .. } => {\n                 // docs on `use` and `extern crate` statements are not displayed, so they're not\n                 // worth counting\n                 return Some(i);"}, {"sha": "2fa9179515de1d6efb8e3c5ea1da3492947b8f3d", "filename": "src/librustdoc/passes/doc_test_lints.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -63,7 +63,7 @@ crate fn should_have_doc_example(cx: &DocContext<'_>, item: &clean::Item) -> boo\n                 | clean::TypedefItem(_, _)\n                 | clean::StaticItem(_)\n                 | clean::ConstantItem(_)\n-                | clean::ExternCrateItem(_, _)\n+                | clean::ExternCrateItem { .. }\n                 | clean::ImportItem(_)\n                 | clean::PrimitiveItem(_)\n                 | clean::KeywordItem(_)"}, {"sha": "44d54563f27a2715dc446d287d11a03e4ff70186", "filename": "src/librustdoc/passes/stripper.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fpasses%2Fstripper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92861c79276cee63e53ed4c63111cd37560c458c/src%2Flibrustdoc%2Fpasses%2Fstripper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fstripper.rs?ref=92861c79276cee63e53ed4c63111cd37560c458c", "patch": "@@ -66,7 +66,7 @@ impl<'a> DocFolder for Stripper<'a> {\n             }\n \n             // handled in the `strip-priv-imports` pass\n-            clean::ExternCrateItem(..) | clean::ImportItem(..) => {}\n+            clean::ExternCrateItem { .. } | clean::ImportItem(..) => {}\n \n             clean::ImplItem(..) => {}\n \n@@ -161,7 +161,9 @@ crate struct ImportStripper;\n impl DocFolder for ImportStripper {\n     fn fold_item(&mut self, i: Item) -> Option<Item> {\n         match *i.kind {\n-            clean::ExternCrateItem(..) | clean::ImportItem(..) if !i.visibility.is_public() => None,\n+            clean::ExternCrateItem { .. } | clean::ImportItem(..) if !i.visibility.is_public() => {\n+                None\n+            }\n             _ => Some(self.fold_item_recur(i)),\n         }\n     }"}]}