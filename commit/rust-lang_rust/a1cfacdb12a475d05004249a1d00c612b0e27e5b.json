{"sha": "a1cfacdb12a475d05004249a1d00c612b0e27e5b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExY2ZhY2RiMTJhNDc1ZDA1MDA0MjQ5YTFkMDBjNjEyYjBlMjdlNWI=", "commit": {"author": {"name": "Jorge Aparicio", "email": "jorge@japaric.io", "date": "2017-10-09T18:56:16Z"}, "committer": {"name": "Jorge Aparicio", "email": "jorge@japaric.io", "date": "2017-10-09T19:10:20Z"}, "message": "output --dump-default-config to stdout if no path is given\n\ncloses #1988", "tree": {"sha": "6155b3ef73726ab50bbdb5c29ac91b2f2b7803c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6155b3ef73726ab50bbdb5c29ac91b2f2b7803c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a1cfacdb12a475d05004249a1d00c612b0e27e5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a1cfacdb12a475d05004249a1d00c612b0e27e5b", "html_url": "https://github.com/rust-lang/rust/commit/a1cfacdb12a475d05004249a1d00c612b0e27e5b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a1cfacdb12a475d05004249a1d00c612b0e27e5b/comments", "author": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "committer": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c9ee313a25dce69891bef9d7f6702ced0bb0259", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c9ee313a25dce69891bef9d7f6702ced0bb0259", "html_url": "https://github.com/rust-lang/rust/commit/6c9ee313a25dce69891bef9d7f6702ced0bb0259"}], "stats": {"total": 37, "additions": 28, "deletions": 9}, "files": [{"sha": "d1c04de832389313a232f731599d6f91aeb1cb24", "filename": "src/bin/rustfmt.rs", "status": "modified", "additions": 28, "deletions": 9, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/a1cfacdb12a475d05004249a1d00c612b0e27e5b/src%2Fbin%2Frustfmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1cfacdb12a475d05004249a1d00c612b0e27e5b/src%2Fbin%2Frustfmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Frustfmt.rs?ref=a1cfacdb12a475d05004249a1d00c612b0e27e5b", "patch": "@@ -21,7 +21,7 @@ use std::io::{self, Read, Write};\n use std::path::{Path, PathBuf};\n use std::str::FromStr;\n \n-use getopts::{Matches, Options};\n+use getopts::{HasArg, Matches, Occur, Options};\n \n use rustfmt::{run, Input, Summary};\n use rustfmt::file_lines::FileLines;\n@@ -44,8 +44,8 @@ enum Operation {\n     Version,\n     /// Print detailed configuration help.\n     ConfigHelp,\n-    /// Output default config to a file\n-    ConfigOutputDefault { path: String },\n+    /// Output default config to a file, or stdout if None\n+    ConfigOutputDefault { path: Option<String> },\n     /// No file specified, read from stdin\n     Stdin {\n         input: String,\n@@ -125,11 +125,14 @@ fn make_opts() -> Options {\n         \"config-help\",\n         \"show details of rustfmt configuration options\",\n     );\n-    opts.optopt(\n+    opts.opt(\n         \"\",\n         \"dump-default-config\",\n-        \"Dumps the default configuration to a file and exits.\",\n+        \"Dumps the default configuration to a file and exits. PATH defaults to rustfmt.toml if \\\n+         omitted.\",\n         \"PATH\",\n+        HasArg::Maybe,\n+        Occur::Optional,\n     );\n     opts.optopt(\n         \"\",\n@@ -172,9 +175,13 @@ fn execute(opts: &Options) -> FmtResult<Summary> {\n             Ok(Summary::default())\n         }\n         Operation::ConfigOutputDefault { path } => {\n-            let mut file = File::create(path)?;\n             let toml = Config::default().all_options().to_toml()?;\n-            file.write_all(toml.as_bytes())?;\n+            if let Some(path) = path {\n+                let mut file = File::create(path)?;\n+                file.write_all(toml.as_bytes())?;\n+            } else {\n+                io::stdout().write_all(toml.as_bytes())?;\n+            }\n             Ok(Summary::default())\n         }\n         Operation::Stdin { input, config_path } => {\n@@ -327,8 +334,20 @@ fn determine_operation(matches: &Matches) -> FmtResult<Operation> {\n         return Ok(Operation::ConfigHelp);\n     }\n \n-    if let Some(path) = matches.opt_str(\"dump-default-config\") {\n-        return Ok(Operation::ConfigOutputDefault { path });\n+    if matches.opt_present(\"dump-default-config\") {\n+        // NOTE for some reason when configured with HasArg::Maybe + Occur::Optional opt_default\n+        // doesn't recognize `--foo bar` as a long flag with an argument but as a long flag with no\n+        // argument *plus* a free argument. Thus we check for that case in this branch -- this is\n+        // required for backward compatibility.\n+        if let Some(path) = matches.free.get(0) {\n+            return Ok(Operation::ConfigOutputDefault {\n+                path: Some(path.clone()),\n+            });\n+        } else {\n+            return Ok(Operation::ConfigOutputDefault {\n+                path: matches.opt_str(\"dump-default-config\"),\n+            });\n+        }\n     }\n \n     if matches.opt_present(\"version\") {"}]}