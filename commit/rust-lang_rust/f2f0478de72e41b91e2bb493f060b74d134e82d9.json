{"sha": "f2f0478de72e41b91e2bb493f060b74d134e82d9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyZjA0NzhkZTcyZTQxYjkxZTJiYjQ5M2YwNjBiNzRkMTM0ZTgyZDk=", "commit": {"author": {"name": "marmeladema", "email": "xademax@gmail.com", "date": "2020-04-17T14:53:37Z"}, "committer": {"name": "marmeladema", "email": "xademax@gmail.com", "date": "2020-04-27T20:50:17Z"}, "message": "Use `LocalDefId` in `mir_built` query", "tree": {"sha": "d704e510de2c4ab7dd97416b759be62c451cec56", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d704e510de2c4ab7dd97416b759be62c451cec56"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2f0478de72e41b91e2bb493f060b74d134e82d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2f0478de72e41b91e2bb493f060b74d134e82d9", "html_url": "https://github.com/rust-lang/rust/commit/f2f0478de72e41b91e2bb493f060b74d134e82d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2f0478de72e41b91e2bb493f060b74d134e82d9/comments", "author": {"login": "marmeladema", "id": 1629419, "node_id": "MDQ6VXNlcjE2Mjk0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1629419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marmeladema", "html_url": "https://github.com/marmeladema", "followers_url": "https://api.github.com/users/marmeladema/followers", "following_url": "https://api.github.com/users/marmeladema/following{/other_user}", "gists_url": "https://api.github.com/users/marmeladema/gists{/gist_id}", "starred_url": "https://api.github.com/users/marmeladema/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marmeladema/subscriptions", "organizations_url": "https://api.github.com/users/marmeladema/orgs", "repos_url": "https://api.github.com/users/marmeladema/repos", "events_url": "https://api.github.com/users/marmeladema/events{/privacy}", "received_events_url": "https://api.github.com/users/marmeladema/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marmeladema", "id": 1629419, "node_id": "MDQ6VXNlcjE2Mjk0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1629419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marmeladema", "html_url": "https://github.com/marmeladema", "followers_url": "https://api.github.com/users/marmeladema/followers", "following_url": "https://api.github.com/users/marmeladema/following{/other_user}", "gists_url": "https://api.github.com/users/marmeladema/gists{/gist_id}", "starred_url": "https://api.github.com/users/marmeladema/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marmeladema/subscriptions", "organizations_url": "https://api.github.com/users/marmeladema/orgs", "repos_url": "https://api.github.com/users/marmeladema/repos", "events_url": "https://api.github.com/users/marmeladema/events{/privacy}", "received_events_url": "https://api.github.com/users/marmeladema/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "abd31ad6e8d709fa09b02eea77310c8cc19aa1ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/abd31ad6e8d709fa09b02eea77310c8cc19aa1ed", "html_url": "https://github.com/rust-lang/rust/commit/abd31ad6e8d709fa09b02eea77310c8cc19aa1ed"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "d94ba63017c33e3cfdb8663dfb33b209640e3ebb", "filename": "src/librustc_middle/query/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2f0478de72e41b91e2bb493f060b74d134e82d9/src%2Flibrustc_middle%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2f0478de72e41b91e2bb493f060b74d134e82d9/src%2Flibrustc_middle%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fquery%2Fmod.rs?ref=f2f0478de72e41b91e2bb493f060b74d134e82d9", "patch": "@@ -170,7 +170,7 @@ rustc_queries! {\n \n         /// Fetch the MIR for a given `DefId` right after it's built - this includes\n         /// unreachable code.\n-        query mir_built(_: DefId) -> &'tcx Steal<mir::Body<'tcx>> {\n+        query mir_built(_: LocalDefId) -> &'tcx Steal<mir::Body<'tcx>> {\n             desc { \"building MIR for\" }\n         }\n "}, {"sha": "eced410d332777cd48c791db2bfc4e631ff814e6", "filename": "src/librustc_mir/transform/mod.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f2f0478de72e41b91e2bb493f060b74d134e82d9/src%2Flibrustc_mir%2Ftransform%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2f0478de72e41b91e2bb493f060b74d134e82d9/src%2Flibrustc_mir%2Ftransform%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fmod.rs?ref=f2f0478de72e41b91e2bb493f060b74d134e82d9", "patch": "@@ -211,17 +211,21 @@ fn mir_const_qualif(tcx: TyCtxt<'_>, def_id: DefId) -> ConstQualifs {\n }\n \n fn mir_const(tcx: TyCtxt<'_>, def_id: DefId) -> &Steal<Body<'_>> {\n+    let def_id = def_id.expect_local();\n+\n     // Unsafety check uses the raw mir, so make sure it is run\n-    let _ = tcx.unsafety_check_result(def_id.expect_local());\n+    let _ = tcx.unsafety_check_result(def_id);\n \n     let mut body = tcx.mir_built(def_id).steal();\n \n-    util::dump_mir(tcx, None, \"mir_map\", &0, MirSource::item(def_id), &body, |_, _| Ok(()));\n+    util::dump_mir(tcx, None, \"mir_map\", &0, MirSource::item(def_id.to_def_id()), &body, |_, _| {\n+        Ok(())\n+    });\n \n     run_passes(\n         tcx,\n         &mut body,\n-        InstanceDef::Item(def_id),\n+        InstanceDef::Item(def_id.to_def_id()),\n         None,\n         MirPhase::Const,\n         &[&["}, {"sha": "a37c927b35ae4dd8e92d4d9be315b5e12c858117", "filename": "src/librustc_mir_build/build/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f2f0478de72e41b91e2bb493f060b74d134e82d9/src%2Flibrustc_mir_build%2Fbuild%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2f0478de72e41b91e2bb493f060b74d134e82d9/src%2Flibrustc_mir_build%2Fbuild%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir_build%2Fbuild%2Fmod.rs?ref=f2f0478de72e41b91e2bb493f060b74d134e82d9", "patch": "@@ -21,8 +21,8 @@ use rustc_target::spec::PanicStrategy;\n \n use super::lints;\n \n-crate fn mir_built(tcx: TyCtxt<'_>, def_id: DefId) -> &ty::steal::Steal<Body<'_>> {\n-    tcx.alloc_steal_mir(mir_build(tcx, def_id.expect_local()))\n+crate fn mir_built(tcx: TyCtxt<'_>, def_id: LocalDefId) -> &ty::steal::Steal<Body<'_>> {\n+    tcx.alloc_steal_mir(mir_build(tcx, def_id))\n }\n \n /// Construct the MIR for a given `DefId`."}]}