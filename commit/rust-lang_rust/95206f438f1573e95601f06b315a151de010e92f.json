{"sha": "95206f438f1573e95601f06b315a151de010e92f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1MjA2ZjQzOGYxNTczZTk1NjAxZjA2YjMxNWExNTFkZTAxMGU5MmY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-06-03T07:13:38Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-06-03T07:13:38Z"}, "message": "Auto merge of #34016 - sanxiyn:travis-docker, r=brson\n\nUse Docker for Travis\n\nThe primary motivtion is to use system LLVM from ubuntu.com, instead of llvm.org.\n\nTravis provides two environments: Ubuntu 12.04 LTS aka precise by default, and Ubuntu 14.04 LTS aka trusty if you specify dist: trusty. According to travis-ci/travis-ci#5821, Ubuntu 16.04 LTS aka xenial is unlikely to be available this year, and Travis recommends to use Docker.\n\nLLVM 3.7 binary for 12.04 and 14.04 is not available from ubuntu.com, that's why we used llvm.org. But LLVM 3.7 binary for 16.04 is available from ubuntu.com, and we can use Docker to run on 16.04.\n\nFix #34009.", "tree": {"sha": "0603575412c4fc29c9e54b6aa65f833246f71389", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0603575412c4fc29c9e54b6aa65f833246f71389"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/95206f438f1573e95601f06b315a151de010e92f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/95206f438f1573e95601f06b315a151de010e92f", "html_url": "https://github.com/rust-lang/rust/commit/95206f438f1573e95601f06b315a151de010e92f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/95206f438f1573e95601f06b315a151de010e92f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0646e8ae6ee2d6697b828a6512357c135f834633", "url": "https://api.github.com/repos/rust-lang/rust/commits/0646e8ae6ee2d6697b828a6512357c135f834633", "html_url": "https://github.com/rust-lang/rust/commit/0646e8ae6ee2d6697b828a6512357c135f834633"}, {"sha": "b1651fb4d2c0349ccca108b8d24210d688507936", "url": "https://api.github.com/repos/rust-lang/rust/commits/b1651fb4d2c0349ccca108b8d24210d688507936", "html_url": "https://github.com/rust-lang/rust/commit/b1651fb4d2c0349ccca108b8d24210d688507936"}], "stats": {"total": 42, "additions": 34, "deletions": 8}, "files": [{"sha": "87197a37f1d4919a4d239cc3423fa57d61f35799", "filename": ".travis.yml", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/95206f438f1573e95601f06b315a151de010e92f/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/95206f438f1573e95601f06b315a151de010e92f/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=95206f438f1573e95601f06b315a151de010e92f", "patch": "@@ -1,22 +1,23 @@\n language: generic\n sudo: required\n-dist: trusty\n+services:\n+  - docker\n \n # LLVM takes awhile to check out and otherwise we'll manage the submodules in\n # our configure script, so disable auto submodule management.\n git:\n   submodules: false\n \n before_install:\n-  - echo 0 | sudo tee /proc/sys/net/ipv6/conf/lo/disable_ipv6\n-  - echo 'deb http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.7 main' | sudo tee -a /etc/apt/sources.list\n-  - echo 'deb-src http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.7 main' | sudo tee -a /etc/apt/sources.list\n-  - sudo apt-get update\n-  - sudo apt-get --force-yes install curl make g++ python2.7 git zlib1g-dev libedit-dev llvm-3.7-tools\n+  - docker build -t rust -f src/etc/Dockerfile src/etc\n \n script:\n-  - ./configure --llvm-root=/usr/lib/llvm-3.7\n-  - make tidy && make check-notidy -j4\n+  - docker run -v `pwd`:/build rust\n+    sh -c \"\n+      ./configure --llvm-root=/usr/lib/llvm-3.7 &&\n+      make tidy &&\n+      make check-notidy -j4\n+    \"\n \n # Real testing happens on http://buildbot.rust-lang.org/\n #"}, {"sha": "58fa1474444a1a785bc8b83a434683c3aed095af", "filename": "src/etc/Dockerfile", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/95206f438f1573e95601f06b315a151de010e92f/src%2Fetc%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/95206f438f1573e95601f06b315a151de010e92f/src%2Fetc%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2FDockerfile?ref=95206f438f1573e95601f06b315a151de010e92f", "patch": "@@ -0,0 +1,25 @@\n+FROM ubuntu:xenial\n+\n+# curl\n+#   Download stage0, see src/bootstrap/bootstrap.py\n+# g++\n+#   Compile LLVM binding in src/rustllvm\n+# git\n+#   Get commit hash and commit date in version string\n+# make\n+#   Run build scripts in mk\n+# libedit-dev zlib1g-dev\n+#   LLVM dependencies as packaged in Ubuntu\n+#   (They are optional, but Ubuntu package enables them)\n+# llvm-3.7-dev (installed by llvm-3.7-tools)\n+#   LLVM\n+# llvm-3.7-tools\n+#   FileCheck is used to run tests in src/test/codegen\n+\n+RUN apt-get update && apt-get -y install \\\n+    curl g++ git make \\\n+    libedit-dev zlib1g-dev \\\n+    llvm-3.7-tools\n+\n+RUN mkdir /build\n+WORKDIR /build"}]}