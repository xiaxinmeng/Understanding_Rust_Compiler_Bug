{"sha": "862cd65dcadf34b5ab59063be151ab801fc7bfe1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2MmNkNjVkY2FkZjM0YjVhYjU5MDYzYmUxNTFhYjgwMWZjN2JmZTE=", "commit": {"author": {"name": "Steven Fackler", "email": "sfackler@gmail.com", "date": "2014-06-08T07:21:15Z"}, "committer": {"name": "Steven Fackler", "email": "sfackler@gmail.com", "date": "2014-06-08T07:21:15Z"}, "message": "Add back hint for crate level attributes", "tree": {"sha": "d21421206166a936e4dedc788a87ab57aa6ba764", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d21421206166a936e4dedc788a87ab57aa6ba764"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/862cd65dcadf34b5ab59063be151ab801fc7bfe1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/862cd65dcadf34b5ab59063be151ab801fc7bfe1", "html_url": "https://github.com/rust-lang/rust/commit/862cd65dcadf34b5ab59063be151ab801fc7bfe1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/862cd65dcadf34b5ab59063be151ab801fc7bfe1/comments", "author": {"login": "sfackler", "id": 1455697, "node_id": "MDQ6VXNlcjE0NTU2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfackler", "html_url": "https://github.com/sfackler", "followers_url": "https://api.github.com/users/sfackler/followers", "following_url": "https://api.github.com/users/sfackler/following{/other_user}", "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions", "organizations_url": "https://api.github.com/users/sfackler/orgs", "repos_url": "https://api.github.com/users/sfackler/repos", "events_url": "https://api.github.com/users/sfackler/events{/privacy}", "received_events_url": "https://api.github.com/users/sfackler/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sfackler", "id": 1455697, "node_id": "MDQ6VXNlcjE0NTU2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfackler", "html_url": "https://github.com/sfackler", "followers_url": "https://api.github.com/users/sfackler/followers", "following_url": "https://api.github.com/users/sfackler/following{/other_user}", "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions", "organizations_url": "https://api.github.com/users/sfackler/orgs", "repos_url": "https://api.github.com/users/sfackler/repos", "events_url": "https://api.github.com/users/sfackler/events{/privacy}", "received_events_url": "https://api.github.com/users/sfackler/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42a18bd985e103484abbe801082b0593f1a43019", "url": "https://api.github.com/repos/rust-lang/rust/commits/42a18bd985e103484abbe801082b0593f1a43019", "html_url": "https://github.com/rust-lang/rust/commit/42a18bd985e103484abbe801082b0593f1a43019"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "9500f4d7ceebace551f0e5e87b3900ed2d8f48e0", "filename": "src/librustc/middle/lint.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/862cd65dcadf34b5ab59063be151ab801fc7bfe1/src%2Flibrustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/862cd65dcadf34b5ab59063be151ab801fc7bfe1/src%2Flibrustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flint.rs?ref=862cd65dcadf34b5ab59063be151ab801fc7bfe1", "patch": "@@ -1124,6 +1124,20 @@ fn check_unused_attribute(cx: &Context, attr: &ast::Attribute) {\n         \"unstable\",\n     ];\n \n+    static CRATE_ATTRS: &'static [&'static str] = &'static [\n+        \"crate_type\",\n+        \"feature\",\n+        \"no_start\",\n+        \"no_main\",\n+        \"no_std\",\n+        \"crate_id\",\n+        \"desc\",\n+        \"comment\",\n+        \"license\",\n+        \"copyright\",\n+        \"no_builtins\",\n+    ];\n+\n     for &name in ATTRIBUTE_WHITELIST.iter() {\n         if attr.check_name(name) {\n             break;\n@@ -1132,6 +1146,15 @@ fn check_unused_attribute(cx: &Context, attr: &ast::Attribute) {\n \n     if !attr::is_used(attr) {\n         cx.span_lint(UnusedAttribute, attr.span, \"unused attribute\");\n+        if CRATE_ATTRS.contains(&attr.name().get()) {\n+            let msg = match attr.node.style {\n+                ast::AttrOuter => \"crate-level attribute should be an inner \\\n+                                  attribute: add an exclamation mark: #![foo]\",\n+                ast::AttrInner => \"crate-level attribute should be in the \\\n+                                   root module\",\n+            };\n+            cx.span_lint(UnusedAttribute, attr.span, msg);\n+        }\n     }\n }\n "}, {"sha": "dea712e976b35b8c5bfc48f093a141a63bc08823", "filename": "src/test/compile-fail/lint-misplaced-attr.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/862cd65dcadf34b5ab59063be151ab801fc7bfe1/src%2Ftest%2Fcompile-fail%2Flint-misplaced-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/862cd65dcadf34b5ab59063be151ab801fc7bfe1/src%2Ftest%2Fcompile-fail%2Flint-misplaced-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-misplaced-attr.rs?ref=862cd65dcadf34b5ab59063be151ab801fc7bfe1", "patch": "@@ -15,6 +15,8 @@\n \n mod a {\n     #![crate_type = \"bin\"] //~ ERROR unused attribute\n+                           //~^ ERROR should be in the root module\n }\n \n #[crate_type = \"bin\"] fn main() {} //~ ERROR unused attribute\n+                                   //~^ ERROR should be an inner"}]}