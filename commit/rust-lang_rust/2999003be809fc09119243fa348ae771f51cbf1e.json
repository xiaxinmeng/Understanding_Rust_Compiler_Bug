{"sha": "2999003be809fc09119243fa348ae771f51cbf1e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5OTkwMDNiZTgwOWZjMDkxMTkyNDNmYTM0OGFlNzcxZjUxY2JmMWU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-12T11:45:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-12T11:45:23Z"}, "message": "Auto merge of #26965 - bluss:cstring-debug, r=alexcrichton\n\nUse escaped byte string representation for CString Debug\r\n\r\nFaithfully represent the contents of the CString and CStr in their Debug\r\nimpl, by treating them as byte strings with our default escaping to\r\nascii representation.\r\n\r\nAdd impl Debug for CStr.\r\n\r\nFixes #26964.", "tree": {"sha": "8b00ec691bf160550182b4e03e681025689916d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b00ec691bf160550182b4e03e681025689916d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2999003be809fc09119243fa348ae771f51cbf1e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2999003be809fc09119243fa348ae771f51cbf1e", "html_url": "https://github.com/rust-lang/rust/commit/2999003be809fc09119243fa348ae771f51cbf1e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2999003be809fc09119243fa348ae771f51cbf1e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aff208033b5cf0ce8d4e7710ba868d2221c30839", "url": "https://api.github.com/repos/rust-lang/rust/commits/aff208033b5cf0ce8d4e7710ba868d2221c30839", "html_url": "https://github.com/rust-lang/rust/commit/aff208033b5cf0ce8d4e7710ba868d2221c30839"}, {"sha": "92c8a9439b82f56aabb2f42e485e8683e663aaff", "url": "https://api.github.com/repos/rust-lang/rust/commits/92c8a9439b82f56aabb2f42e485e8683e663aaff", "html_url": "https://github.com/rust-lang/rust/commit/92c8a9439b82f56aabb2f42e485e8683e663aaff"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "c9fe6e7e0b123d8e35267eb25347f09f9805c927", "filename": "src/libstd/ffi/c_str.rs", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/2999003be809fc09119243fa348ae771f51cbf1e/src%2Flibstd%2Fffi%2Fc_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2999003be809fc09119243fa348ae771f51cbf1e/src%2Flibstd%2Fffi%2Fc_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fffi%2Fc_str.rs?ref=2999003be809fc09119243fa348ae771f51cbf1e", "patch": "@@ -8,13 +8,14 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+use ascii;\n use borrow::{Cow, ToOwned, Borrow};\n use boxed::Box;\n use clone::Clone;\n use convert::{Into, From};\n use cmp::{PartialEq, Eq, PartialOrd, Ord, Ordering};\n use error::Error;\n-use fmt;\n+use fmt::{self, Write};\n use io;\n use iter::Iterator;\n use libc;\n@@ -268,7 +269,18 @@ impl Deref for CString {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl fmt::Debug for CString {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n-        fmt::Debug::fmt(&String::from_utf8_lossy(self.as_bytes()), f)\n+        fmt::Debug::fmt(&**self, f)\n+    }\n+}\n+\n+#[stable(feature = \"cstr_debug\", since = \"1.3.0\")]\n+impl fmt::Debug for CStr {\n+    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n+        try!(write!(f, \"\\\"\"));\n+        for byte in self.to_bytes().iter().flat_map(|&b| ascii::escape_default(b)) {\n+            try!(f.write_char(byte as char));\n+        }\n+        write!(f, \"\\\"\")\n     }\n }\n \n@@ -501,8 +513,8 @@ mod tests {\n \n     #[test]\n     fn formatted() {\n-        let s = CString::new(&b\"12\"[..]).unwrap();\n-        assert_eq!(format!(\"{:?}\", s), \"\\\"12\\\"\");\n+        let s = CString::new(&b\"abc\\x01\\x02\\n\\xE2\\x80\\xA6\\xFF\"[..]).unwrap();\n+        assert_eq!(format!(\"{:?}\", s), r#\"\"abc\\x01\\x02\\n\\xe2\\x80\\xa6\\xff\"\"#);\n     }\n \n     #[test]"}]}