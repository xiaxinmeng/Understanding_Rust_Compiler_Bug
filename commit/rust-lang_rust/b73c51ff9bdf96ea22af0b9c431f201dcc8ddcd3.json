{"sha": "b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3M2M1MWZmOWJkZjk2ZWEyMmFmMGI5YzQzMWYyMDFkY2M4ZGRjZDM=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-07T13:42:10Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-08T08:20:15Z"}, "message": "wrap TreePtr", "tree": {"sha": "6708f69cb7de64fe0d5a48f2bb2220f4743eede2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6708f69cb7de64fe0d5a48f2bb2220f4743eede2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3", "html_url": "https://github.com/rust-lang/rust/commit/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5618c8ade1885ca17a56d9303a7559b332ae3e9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5618c8ade1885ca17a56d9303a7559b332ae3e9e", "html_url": "https://github.com/rust-lang/rust/commit/5618c8ade1885ca17a56d9303a7559b332ae3e9e"}], "stats": {"total": 70, "additions": 54, "deletions": 16}, "files": [{"sha": "6de46a5f354f4b53a984e6a99b6d67fa405d27de", "filename": "Cargo.lock", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3", "patch": "@@ -221,7 +221,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -284,7 +284,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"synstructure 0.10.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -501,7 +501,7 @@ dependencies = [\n  \"num-traits 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"proc-macro2 0.4.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -585,7 +585,7 @@ dependencies = [\n  \"pest_meta 2.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"proc-macro2 0.4.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -970,7 +970,7 @@ dependencies = [\n [[package]]\n name = \"rowan\"\n version = \"0.2.0\"\n-source = \"git+https://github.com/rust-analyzer/rowan.git?branch=new-impl#688693ceec26b7be82918832c427b4bcb230fe24\"\n+source = \"git+https://github.com/rust-analyzer/rowan.git?branch=new-impl#6b50db0f68a989c512e3bbebfbc8ede70ca7f221\"\n dependencies = [\n  \"parking_lot 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"smol_str 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1075,7 +1075,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1140,7 +1140,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"syn\"\n-version = \"0.15.23\"\n+version = \"0.15.24\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1155,7 +1155,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.23 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -1593,7 +1593,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum stable_deref_trait 1.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dba1a27d3efae4351c8051072d619e3ade2820635c3958d826bfea39d59b54c8\"\n \"checksum strsim 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bb4f380125926a99e52bc279241539c018323fab05ad6368b56f93d9369ff550\"\n \"checksum superslice 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b50b13d42370e0f5fc62eafdd5c2d20065eaf5458dab215ff3e20e63eea96b30\"\n-\"checksum syn 0.15.23 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9545a6a093a3f0bd59adb472700acc08cad3776f860f16a897dfce8c88721cbc\"\n+\"checksum syn 0.15.24 (registry+https://github.com/rust-lang/crates.io-index)\" = \"734ecc29cd36e8123850d9bf21dfd62ef8300aaa8f879aabaa899721808be37c\"\n \"checksum synstructure 0.10.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"73687139bf99285483c96ac0add482c3776528beac1d97d444f6e91f203a2015\"\n \"checksum tempfile 3.0.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7e91405c14320e5c79b3d148e1c86f40749a36e490642202a31689cb1a3452b2\"\n \"checksum tera 0.11.20 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4b505279e19d8f7d24b1a9dc58327c9c36174b1a2c7ebdeac70792d017cb64f3\""}, {"sha": "38e680a9c1438ba4a29531676179cae3b10af2da", "filename": "crates/ra_syntax/src/yellow.rs", "status": "modified", "additions": 45, "deletions": 7, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3/crates%2Fra_syntax%2Fsrc%2Fyellow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3/crates%2Fra_syntax%2Fsrc%2Fyellow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fyellow.rs?ref=b73c51ff9bdf96ea22af0b9c431f201dcc8ddcd3", "patch": "@@ -18,19 +18,56 @@ impl Types for RaTypes {\n     type RootData = Vec<SyntaxError>;\n }\n \n-pub type GreenNode = ::rowan::GreenNode<RaTypes>;\n-pub type TreePtr<T> = ::rowan::TreePtr<RaTypes, T>;\n+pub type GreenNode = rowan::GreenNode<RaTypes>;\n+\n+#[derive(Clone, PartialEq, Eq, Hash)]\n+pub struct TreePtr<T: TransparentNewType<Repr = rowan::SyntaxNode<RaTypes>>>(\n+    pub(crate) rowan::TreePtr<RaTypes, T>,\n+);\n+\n+impl<T> TreePtr<T>\n+where\n+    T: TransparentNewType<Repr = rowan::SyntaxNode<RaTypes>>,\n+{\n+    pub(crate) fn cast<U>(this: TreePtr<T>) -> TreePtr<U>\n+    where\n+        U: TransparentNewType<Repr = rowan::SyntaxNode<RaTypes>>,\n+    {\n+        TreePtr(rowan::TreePtr::cast(this.0))\n+    }\n+}\n+\n+impl<T> std::ops::Deref for TreePtr<T>\n+where\n+    T: TransparentNewType<Repr = rowan::SyntaxNode<RaTypes>>,\n+{\n+    type Target = T;\n+    fn deref(&self) -> &T {\n+        self.0.deref()\n+    }\n+}\n+\n+impl<T> fmt::Debug for TreePtr<T>\n+where\n+    T: TransparentNewType<Repr = rowan::SyntaxNode<RaTypes>>,\n+    T: fmt::Debug,\n+{\n+    fn fmt(&self, fmt: &mut fmt::Formatter) -> fmt::Result {\n+        fmt::Debug::fmt(&self.0, fmt)\n+    }\n+}\n \n #[derive(PartialEq, Eq, Hash)]\n #[repr(transparent)]\n-pub struct SyntaxNode(pub(crate) ::rowan::SyntaxNode<RaTypes>);\n+pub struct SyntaxNode(pub(crate) rowan::SyntaxNode<RaTypes>);\n unsafe impl TransparentNewType for SyntaxNode {\n-    type Repr = ::rowan::SyntaxNode<RaTypes>;\n+    type Repr = rowan::SyntaxNode<RaTypes>;\n }\n \n impl SyntaxNode {\n     pub(crate) fn new(green: GreenNode, errors: Vec<SyntaxError>) -> TreePtr<SyntaxNode> {\n-        TreePtr::cast(::rowan::SyntaxNode::new(green, errors))\n+        let ptr = TreePtr(rowan::SyntaxNode::new(green, errors));\n+        TreePtr::cast(ptr)\n     }\n }\n \n@@ -75,7 +112,8 @@ impl SyntaxNode {\n         self.0.replace_self(replacement)\n     }\n     pub fn to_owned(&self) -> TreePtr<SyntaxNode> {\n-        TreePtr::cast(self.0.to_owned())\n+        let ptr = TreePtr(self.0.to_owned());\n+        TreePtr::cast(ptr)\n     }\n     pub fn kind(&self) -> SyntaxKind {\n         self.0.kind()\n@@ -120,7 +158,7 @@ impl fmt::Debug for SyntaxNode {\n }\n \n #[derive(Debug)]\n-pub struct SyntaxNodeChildren<'a>(::rowan::SyntaxNodeChildren<'a, RaTypes>);\n+pub struct SyntaxNodeChildren<'a>(rowan::SyntaxNodeChildren<'a, RaTypes>);\n \n impl<'a> Iterator for SyntaxNodeChildren<'a> {\n     type Item = &'a SyntaxNode;"}]}