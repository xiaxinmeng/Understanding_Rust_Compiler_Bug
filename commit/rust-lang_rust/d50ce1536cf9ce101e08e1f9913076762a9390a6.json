{"sha": "d50ce1536cf9ce101e08e1f9913076762a9390a6", "node_id": "C_kwDOAAsO6NoAKGQ1MGNlMTUzNmNmOWNlMTAxZTA4ZTFmOTkxMzA3Njc2MmE5MzkwYTY", "commit": {"author": {"name": "Joshua Nelson", "email": "github@jyn.dev", "date": "2023-04-09T18:05:30Z"}, "committer": {"name": "jyn", "email": "github@jyn.dev", "date": "2023-04-29T07:59:41Z"}, "message": "download-rustc: Give a better error message if artifacts can't be downloaded\n\nBefore:\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/bf5cad8e775fb326465e5c1b98693e5d259da156/rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz\ncurl: (22) The requested URL returned error: 404\n```\n\nAfter:\n```\ndownloading https://ci-artifacts.rust-lang.org/rustc-builds/bf5cad8e775fb326465e5c1b98693e5d259da156/rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz\ncurl: (22) The requested URL returned error: 404\n\nerror: failed to download pre-built rustc from CI\n\nnote: old builds get deleted after a certain time\nhelp: if trying to compile an old commit of rustc, disable `download-rustc` in config.toml:\n\n[rust]\ndownload-rustc = false\n```", "tree": {"sha": "a3c86256dedfb34a4f04a3a566818c6911255254", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a3c86256dedfb34a4f04a3a566818c6911255254"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d50ce1536cf9ce101e08e1f9913076762a9390a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d50ce1536cf9ce101e08e1f9913076762a9390a6", "html_url": "https://github.com/rust-lang/rust/commit/d50ce1536cf9ce101e08e1f9913076762a9390a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d50ce1536cf9ce101e08e1f9913076762a9390a6/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "572c0d553f2bd1b934b08fe240310112369a5c76", "url": "https://api.github.com/repos/rust-lang/rust/commits/572c0d553f2bd1b934b08fe240310112369a5c76", "html_url": "https://github.com/rust-lang/rust/commit/572c0d553f2bd1b934b08fe240310112369a5c76"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "6405fe3da027496706fd57fc0cf24f5f2795e213", "filename": "src/bootstrap/download.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d50ce1536cf9ce101e08e1f9913076762a9390a6/src%2Fbootstrap%2Fdownload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d50ce1536cf9ce101e08e1f9913076762a9390a6/src%2Fbootstrap%2Fdownload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdownload.rs?ref=d50ce1536cf9ce101e08e1f9913076762a9390a6", "patch": "@@ -541,7 +541,18 @@ impl Config {\n             None\n         };\n \n-        self.download_file(&format!(\"{base_url}/{url}\"), &tarball, \"\");\n+        let mut help_on_error = \"\";\n+        if destination == \"ci-rustc\" {\n+            help_on_error = \"error: failed to download pre-built rustc from CI\n+\n+note: old builds get deleted after a certain time\n+help: if trying to compile an old commit of rustc, disable `download-rustc` in config.toml:\n+\n+[rust]\n+download-rustc = false\n+\";\n+        }\n+        self.download_file(&format!(\"{base_url}/{url}\"), &tarball, help_on_error);\n         if let Some(sha256) = checksum {\n             if !self.verify(&tarball, sha256) {\n                 panic!(\"failed to verify {}\", tarball.display());"}]}