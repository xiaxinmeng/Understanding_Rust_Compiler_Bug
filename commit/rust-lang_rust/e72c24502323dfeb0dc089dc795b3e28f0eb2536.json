{"sha": "e72c24502323dfeb0dc089dc795b3e28f0eb2536", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3MmMyNDUwMjMyM2RmZWIwZGMwODlkYzc5NWIzZTI4ZjBlYjI1MzY=", "commit": {"author": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2015-12-27T14:09:14Z"}, "committer": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2015-12-27T14:09:14Z"}, "message": "Merge pull request #729 from marcusklaas/funky-self\n\nMake fn argument formatting more resilient for complex self types", "tree": {"sha": "fa4799e1943eccc76fe95438e7fde15d24a61ea5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa4799e1943eccc76fe95438e7fde15d24a61ea5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e72c24502323dfeb0dc089dc795b3e28f0eb2536", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e72c24502323dfeb0dc089dc795b3e28f0eb2536", "html_url": "https://github.com/rust-lang/rust/commit/e72c24502323dfeb0dc089dc795b3e28f0eb2536", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e72c24502323dfeb0dc089dc795b3e28f0eb2536/comments", "author": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71508b310bfcaf425babe822bb886e6dabb7d026", "url": "https://api.github.com/repos/rust-lang/rust/commits/71508b310bfcaf425babe822bb886e6dabb7d026", "html_url": "https://github.com/rust-lang/rust/commit/71508b310bfcaf425babe822bb886e6dabb7d026"}, {"sha": "291aa1b22800020ae2ee7fdd5e094c170589b8b8", "url": "https://api.github.com/repos/rust-lang/rust/commits/291aa1b22800020ae2ee7fdd5e094c170589b8b8", "html_url": "https://github.com/rust-lang/rust/commit/291aa1b22800020ae2ee7fdd5e094c170589b8b8"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "ed59d41fd4a0a5a6d9d06d44531dbf1280e07b74", "filename": "src/items.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e72c24502323dfeb0dc089dc795b3e28f0eb2536/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e72c24502323dfeb0dc089dc795b3e28f0eb2536/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=e72c24502323dfeb0dc089dc795b3e28f0eb2536", "patch": "@@ -12,7 +12,8 @@\n \n use Indent;\n use utils::{format_mutability, format_visibility, contains_skip, span_after, end_typaram,\n-            wrap_str, last_line_width, semicolon_for_expr, format_unsafety, trim_newlines};\n+            wrap_str, last_line_width, semicolon_for_expr, format_unsafety, trim_newlines,\n+            span_after_last};\n use lists::{write_list, itemize_list, ListItem, ListFormatting, SeparatorTactic,\n             DefinitiveListTactic, definitive_tactic, format_item_list};\n use expr::{is_empty_block, is_simple_block_stmt, rewrite_assign_rhs};\n@@ -1260,7 +1261,8 @@ fn rewrite_args(context: &RewriteContext,\n     // it is explicit.\n     if args.len() >= min_args || variadic {\n         let comment_span_start = if min_args == 2 {\n-            span_after(span, \",\", context.codemap)\n+            let reduced_span = mk_sp(span.lo, args[1].ty.span.lo);\n+            span_after_last(reduced_span, \",\", context.codemap)\n         } else {\n             span.lo\n         };"}, {"sha": "a13ca2479649923e1018d31c73a9c08d1ff0d2ce", "filename": "src/utils.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e72c24502323dfeb0dc089dc795b3e28f0eb2536/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e72c24502323dfeb0dc089dc795b3e28f0eb2536/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=e72c24502323dfeb0dc089dc795b3e28f0eb2536", "patch": "@@ -38,6 +38,18 @@ pub fn span_after(original: Span, needle: &str, codemap: &CodeMap) -> BytePos {\n     original.lo + BytePos(offset as u32)\n }\n \n+#[inline]\n+pub fn span_after_last(original: Span, needle: &str, codemap: &CodeMap) -> BytePos {\n+    let snippet = codemap.span_to_snippet(original).unwrap();\n+    let mut offset = 0;\n+\n+    while let Some(additional_offset) = snippet[offset..].find_uncommented(needle) {\n+        offset += additional_offset + needle.len();\n+    }\n+\n+    original.lo + BytePos(offset as u32)\n+}\n+\n #[inline]\n pub fn format_visibility(vis: Visibility) -> &'static str {\n     match vis {"}, {"sha": "c3c3ab8ad3ab42c2a61dfae43756595fff96c25b", "filename": "tests/source/impls.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e72c24502323dfeb0dc089dc795b3e28f0eb2536/tests%2Fsource%2Fimpls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e72c24502323dfeb0dc089dc795b3e28f0eb2536/tests%2Fsource%2Fimpls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fimpls.rs?ref=e72c24502323dfeb0dc089dc795b3e28f0eb2536", "patch": "@@ -60,3 +60,7 @@ impl Blah {\n }\n \n impl X { fn do_parse(  mut  self : X ) {} }\n+\n+impl Y5000 {\n+    fn bar(self: X< 'a ,  'b >, y: Y) {}\n+}"}, {"sha": "b6c1193a77d9bcaeba97d956cfd2fd2093ba6022", "filename": "tests/target/impls.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e72c24502323dfeb0dc089dc795b3e28f0eb2536/tests%2Ftarget%2Fimpls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e72c24502323dfeb0dc089dc795b3e28f0eb2536/tests%2Ftarget%2Fimpls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fimpls.rs?ref=e72c24502323dfeb0dc089dc795b3e28f0eb2536", "patch": "@@ -76,3 +76,7 @@ impl Blah {\n impl X {\n     fn do_parse(mut self: X) {}\n }\n+\n+impl Y5000 {\n+    fn bar(self: X<'a, 'b>, y: Y) {}\n+}"}]}