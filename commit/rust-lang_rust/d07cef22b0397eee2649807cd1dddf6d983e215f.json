{"sha": "d07cef22b0397eee2649807cd1dddf6d983e215f", "node_id": "C_kwDOAAsO6NoAKGQwN2NlZjIyYjAzOTdlZWUyNjQ5ODA3Y2QxZGRkZjZkOTgzZTIxNWY", "commit": {"author": {"name": "Ibraheem Ahmed", "email": "ibrah1440@gmail.com", "date": "2021-12-08T02:10:39Z"}, "committer": {"name": "Ibraheem Ahmed", "email": "ibrah1440@gmail.com", "date": "2021-12-08T02:20:58Z"}, "message": "add tests for `core::future::join`", "tree": {"sha": "03a25bc7947b3461543e0151d248bf409f593473", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/03a25bc7947b3461543e0151d248bf409f593473"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d07cef22b0397eee2649807cd1dddf6d983e215f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d07cef22b0397eee2649807cd1dddf6d983e215f", "html_url": "https://github.com/rust-lang/rust/commit/d07cef22b0397eee2649807cd1dddf6d983e215f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d07cef22b0397eee2649807cd1dddf6d983e215f/comments", "author": {"login": "ibraheemdev", "id": 34988408, "node_id": "MDQ6VXNlcjM0OTg4NDA4", "avatar_url": "https://avatars.githubusercontent.com/u/34988408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibraheemdev", "html_url": "https://github.com/ibraheemdev", "followers_url": "https://api.github.com/users/ibraheemdev/followers", "following_url": "https://api.github.com/users/ibraheemdev/following{/other_user}", "gists_url": "https://api.github.com/users/ibraheemdev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibraheemdev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibraheemdev/subscriptions", "organizations_url": "https://api.github.com/users/ibraheemdev/orgs", "repos_url": "https://api.github.com/users/ibraheemdev/repos", "events_url": "https://api.github.com/users/ibraheemdev/events{/privacy}", "received_events_url": "https://api.github.com/users/ibraheemdev/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibraheemdev", "id": 34988408, "node_id": "MDQ6VXNlcjM0OTg4NDA4", "avatar_url": "https://avatars.githubusercontent.com/u/34988408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibraheemdev", "html_url": "https://github.com/ibraheemdev", "followers_url": "https://api.github.com/users/ibraheemdev/followers", "following_url": "https://api.github.com/users/ibraheemdev/following{/other_user}", "gists_url": "https://api.github.com/users/ibraheemdev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibraheemdev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibraheemdev/subscriptions", "organizations_url": "https://api.github.com/users/ibraheemdev/orgs", "repos_url": "https://api.github.com/users/ibraheemdev/repos", "events_url": "https://api.github.com/users/ibraheemdev/events{/privacy}", "received_events_url": "https://api.github.com/users/ibraheemdev/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08dca1933b68456486e9d2f18aa3409cce49c37c", "url": "https://api.github.com/repos/rust-lang/rust/commits/08dca1933b68456486e9d2f18aa3409cce49c37c", "html_url": "https://github.com/rust-lang/rust/commit/08dca1933b68456486e9d2f18aa3409cce49c37c"}], "stats": {"total": 79, "additions": 79, "deletions": 0}, "files": [{"sha": "f47dcc70434cf38be7025c1de7fd940c12ae2201", "filename": "library/core/tests/future.rs", "status": "added", "additions": 76, "deletions": 0, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/d07cef22b0397eee2649807cd1dddf6d983e215f/library%2Fcore%2Ftests%2Ffuture.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d07cef22b0397eee2649807cd1dddf6d983e215f/library%2Fcore%2Ftests%2Ffuture.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Ffuture.rs?ref=d07cef22b0397eee2649807cd1dddf6d983e215f", "patch": "@@ -0,0 +1,76 @@\n+use std::future::{join, Future};\n+use std::pin::Pin;\n+use std::sync::Arc;\n+use std::task::{Context, Poll, Wake};\n+use std::thread;\n+\n+struct PollN {\n+    val: usize,\n+    polled: usize,\n+    num: usize,\n+}\n+\n+impl Future for PollN {\n+    type Output = usize;\n+\n+    fn poll(mut self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {\n+        self.polled += 1;\n+\n+        if self.polled == self.num {\n+            return Poll::Ready(self.val);\n+        }\n+\n+        cx.waker().wake_by_ref();\n+        Poll::Pending\n+    }\n+}\n+\n+fn poll_n(val: usize, num: usize) -> PollN {\n+    PollN { val, num, polled: 0 }\n+}\n+\n+#[test]\n+fn test_join() {\n+    block_on(async move {\n+        let x = join!(async { 0 });\n+        assert_eq!(x, 0);\n+\n+        let x = join!(async { 0 }, async { 1 });\n+        assert_eq!(x, (0, 1));\n+\n+        let x = join!(async { 0 }, async { 1 }, async { 2 });\n+        assert_eq!(x, (0, 1, 2));\n+\n+        let x = join!(\n+            poll_n(0, 1),\n+            poll_n(1, 5),\n+            poll_n(2, 2),\n+            poll_n(3, 1),\n+            poll_n(4, 2),\n+            poll_n(5, 3),\n+            poll_n(6, 4),\n+            poll_n(7, 1)\n+        );\n+        assert_eq!(x, (0, 1, 2, 3, 4, 5, 6, 7));\n+    });\n+}\n+\n+fn block_on(fut: impl Future) {\n+    struct Waker;\n+    impl Wake for Waker {\n+        fn wake(self: Arc<Self>) {\n+            thread::current().unpark()\n+        }\n+    }\n+\n+    let waker = Arc::new(Waker).into();\n+    let mut cx = Context::from_waker(&waker);\n+    let mut fut = Box::pin(fut);\n+\n+    loop {\n+        match fut.as_mut().poll(&mut cx) {\n+            Poll::Ready(_) => break,\n+            Poll::Pending => thread::park(),\n+        }\n+    }\n+}"}, {"sha": "73a3a1fc3e0af8df8b5fe6803515e43582972014", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d07cef22b0397eee2649807cd1dddf6d983e215f/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d07cef22b0397eee2649807cd1dddf6d983e215f/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=d07cef22b0397eee2649807cd1dddf6d983e215f", "patch": "@@ -29,6 +29,8 @@\n #![feature(flt2dec)]\n #![feature(fmt_internals)]\n #![feature(float_minimum_maximum)]\n+#![feature(future_join)]\n+#![feature(future_poll_fn)]\n #![feature(array_from_fn)]\n #![feature(hashmap_internals)]\n #![feature(try_find)]\n@@ -94,6 +96,7 @@ mod clone;\n mod cmp;\n mod const_ptr;\n mod fmt;\n+mod future;\n mod hash;\n mod intrinsics;\n mod iter;"}]}