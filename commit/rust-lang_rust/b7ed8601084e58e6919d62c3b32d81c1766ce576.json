{"sha": "b7ed8601084e58e6919d62c3b32d81c1766ce576", "node_id": "C_kwDOAAsO6NoAKGI3ZWQ4NjAxMDg0ZTU4ZTY5MTlkNjJjM2IzMmQ4MWMxNzY2Y2U1NzY", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-06-07T07:13:50Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-06-08T02:14:03Z"}, "message": "recover `import` instead of `use` in item", "tree": {"sha": "316a93f4a594af0bff3c46edfc40263b800cf231", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/316a93f4a594af0bff3c46edfc40263b800cf231"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7ed8601084e58e6919d62c3b32d81c1766ce576", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7ed8601084e58e6919d62c3b32d81c1766ce576", "html_url": "https://github.com/rust-lang/rust/commit/b7ed8601084e58e6919d62c3b32d81c1766ce576", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7ed8601084e58e6919d62c3b32d81c1766ce576/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f7e997c8bc3cacd2ab4eb75e63cb5fa9279c7b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f7e997c8bc3cacd2ab4eb75e63cb5fa9279c7b0", "html_url": "https://github.com/rust-lang/rust/commit/9f7e997c8bc3cacd2ab4eb75e63cb5fa9279c7b0"}], "stats": {"total": 113, "additions": 93, "deletions": 20}, "files": [{"sha": "48c3c467becc8648702d64b7229a0328aed9c33c", "filename": "compiler/rustc_parse/src/parser/item.rs", "status": "modified", "additions": 49, "deletions": 20, "changes": 69, "blob_url": "https://github.com/rust-lang/rust/blob/b7ed8601084e58e6919d62c3b32d81c1766ce576/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7ed8601084e58e6919d62c3b32d81c1766ce576/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs?ref=b7ed8601084e58e6919d62c3b32d81c1766ce576", "patch": "@@ -204,25 +204,7 @@ impl<'a> Parser<'a> {\n         let mut def = || mem::replace(def, Defaultness::Final);\n \n         let info = if self.eat_keyword(kw::Use) {\n-            // USE ITEM\n-            let tree = self.parse_use_tree()?;\n-\n-            // If wildcard or glob-like brace syntax doesn't have `;`,\n-            // the user may not know `*` or `{}` should be the last.\n-            if let Err(mut e) = self.expect_semi() {\n-                match tree.kind {\n-                    UseTreeKind::Glob => {\n-                        e.note(\"the wildcard token must be last on the path\");\n-                    }\n-                    UseTreeKind::Nested(..) => {\n-                        e.note(\"glob-like brace syntax must be last on the path\");\n-                    }\n-                    _ => (),\n-                }\n-                return Err(e);\n-            }\n-\n-            (Ident::empty(), ItemKind::Use(tree))\n+            self.parse_use_item()?\n         } else if self.check_fn_front_matter(def_final) {\n             // FUNCTION ITEM\n             let (ident, sig, generics, body) = self.parse_fn(attrs, fn_parse_mode, lo, vis)?;\n@@ -288,7 +270,12 @@ impl<'a> Parser<'a> {\n         } else if let IsMacroRulesItem::Yes { has_bang } = self.is_macro_rules_item() {\n             // MACRO_RULES ITEM\n             self.parse_item_macro_rules(vis, has_bang)?\n-        } else if vis.kind.is_pub() && self.isnt_macro_invocation() {\n+        } else if self.isnt_macro_invocation()\n+            && (self.token.is_ident_named(Symbol::intern(\"import\"))\n+                || self.token.is_ident_named(Symbol::intern(\"using\")))\n+        {\n+            return self.recover_import_as_use();\n+        } else if self.isnt_macro_invocation() && vis.kind.is_pub() {\n             self.recover_missing_kw_before_item()?;\n             return Ok(None);\n         } else if macros_allowed && self.check_path() {\n@@ -300,6 +287,48 @@ impl<'a> Parser<'a> {\n         Ok(Some(info))\n     }\n \n+    fn recover_import_as_use(&mut self) -> PResult<'a, Option<(Ident, ItemKind)>> {\n+        let span = self.token.span;\n+        let token_name = super::token_descr(&self.token);\n+        let snapshot = self.create_snapshot_for_diagnostic();\n+        self.bump();\n+        match self.parse_use_item() {\n+            Ok(u) => {\n+                self.struct_span_err(span, format!(\"expected item, found {token_name}\"))\n+                    .span_suggestion_short(\n+                        span,\n+                        \"items are imported using the `use` keyword\",\n+                        \"use\".to_owned(),\n+                        Applicability::MachineApplicable,\n+                    )\n+                    .emit();\n+                Ok(Some(u))\n+            }\n+            Err(e) => {\n+                e.cancel();\n+                self.restore_snapshot(snapshot);\n+                Ok(None)\n+            }\n+        }\n+    }\n+\n+    fn parse_use_item(&mut self) -> PResult<'a, (Ident, ItemKind)> {\n+        let tree = self.parse_use_tree()?;\n+        if let Err(mut e) = self.expect_semi() {\n+            match tree.kind {\n+                UseTreeKind::Glob => {\n+                    e.note(\"the wildcard token must be last on the path\");\n+                }\n+                UseTreeKind::Nested(..) => {\n+                    e.note(\"glob-like brace syntax must be last on the path\");\n+                }\n+                _ => (),\n+            }\n+            return Err(e);\n+        }\n+        Ok((Ident::empty(), ItemKind::Use(tree)))\n+    }\n+\n     /// When parsing a statement, would the start of a path be an item?\n     pub(super) fn is_path_start_item(&mut self) -> bool {\n         self.is_kw_followed_by_ident(kw::Union) // no: `union::b`, yes: `union U { .. }`"}, {"sha": "87d453e1565c5249a967abf95c59e1c1cac5b5e3", "filename": "src/test/ui/did_you_mean/use_instead_of_import.fixed", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b7ed8601084e58e6919d62c3b32d81c1766ce576/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/b7ed8601084e58e6919d62c3b32d81c1766ce576/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.fixed?ref=b7ed8601084e58e6919d62c3b32d81c1766ce576", "patch": "@@ -0,0 +1,15 @@\n+// run-rustfix\n+\n+use std::{\n+    //~^ ERROR expected item, found `import`\n+    io::Write,\n+    rc::Rc,\n+};\n+\n+pub use std::io;\n+//~^ ERROR expected item, found `using`\n+\n+fn main() {\n+    let x = Rc::new(1);\n+    let _ = write!(io::stdout(), \"{:?}\", x);\n+}"}, {"sha": "59e83732328d9fc73baf33ce32a3178c5578bd0e", "filename": "src/test/ui/did_you_mean/use_instead_of_import.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b7ed8601084e58e6919d62c3b32d81c1766ce576/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7ed8601084e58e6919d62c3b32d81c1766ce576/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.rs?ref=b7ed8601084e58e6919d62c3b32d81c1766ce576", "patch": "@@ -0,0 +1,15 @@\n+// run-rustfix\n+\n+import std::{\n+    //~^ ERROR expected item, found `import`\n+    io::Write,\n+    rc::Rc,\n+};\n+\n+pub using std::io;\n+//~^ ERROR expected item, found `using`\n+\n+fn main() {\n+    let x = Rc::new(1);\n+    let _ = write!(io::stdout(), \"{:?}\", x);\n+}"}, {"sha": "b22954af80f0600704d7a5a50b378ac50689f9ee", "filename": "src/test/ui/did_you_mean/use_instead_of_import.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b7ed8601084e58e6919d62c3b32d81c1766ce576/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7ed8601084e58e6919d62c3b32d81c1766ce576/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fuse_instead_of_import.stderr?ref=b7ed8601084e58e6919d62c3b32d81c1766ce576", "patch": "@@ -0,0 +1,14 @@\n+error: expected item, found `import`\n+  --> $DIR/use_instead_of_import.rs:3:1\n+   |\n+LL | import std::{\n+   | ^^^^^^ help: items are imported using the `use` keyword\n+\n+error: expected item, found `using`\n+  --> $DIR/use_instead_of_import.rs:9:5\n+   |\n+LL | pub using std::io;\n+   |     ^^^^^ help: items are imported using the `use` keyword\n+\n+error: aborting due to 2 previous errors\n+"}]}