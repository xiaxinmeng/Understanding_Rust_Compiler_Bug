{"sha": "0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "node_id": "C_kwDOAAsO6NoAKDBlZTZiNzBiMzQ3YzdmODFmMzJjMGFlYjc1NmUxYjMzYTAyNDU5ZDg", "commit": {"author": {"name": "zhoufan", "email": "1247714429@qq.com", "date": "2021-10-02T01:57:44Z"}, "committer": {"name": "zhoufan", "email": "1247714429@qq.com", "date": "2021-10-02T01:57:44Z"}, "message": "Parse outer attributes on StructPatternEtCetera", "tree": {"sha": "7a1f4c38e9f00db9dc400843a79f483d4c1e0194", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a1f4c38e9f00db9dc400843a79f483d4c1e0194"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "html_url": "https://github.com/rust-lang/rust/commit/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/comments", "author": {"login": "xffxff", "id": 30254428, "node_id": "MDQ6VXNlcjMwMjU0NDI4", "avatar_url": "https://avatars.githubusercontent.com/u/30254428?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xffxff", "html_url": "https://github.com/xffxff", "followers_url": "https://api.github.com/users/xffxff/followers", "following_url": "https://api.github.com/users/xffxff/following{/other_user}", "gists_url": "https://api.github.com/users/xffxff/gists{/gist_id}", "starred_url": "https://api.github.com/users/xffxff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xffxff/subscriptions", "organizations_url": "https://api.github.com/users/xffxff/orgs", "repos_url": "https://api.github.com/users/xffxff/repos", "events_url": "https://api.github.com/users/xffxff/events{/privacy}", "received_events_url": "https://api.github.com/users/xffxff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xffxff", "id": 30254428, "node_id": "MDQ6VXNlcjMwMjU0NDI4", "avatar_url": "https://avatars.githubusercontent.com/u/30254428?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xffxff", "html_url": "https://github.com/xffxff", "followers_url": "https://api.github.com/users/xffxff/followers", "following_url": "https://api.github.com/users/xffxff/following{/other_user}", "gists_url": "https://api.github.com/users/xffxff/gists{/gist_id}", "starred_url": "https://api.github.com/users/xffxff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xffxff/subscriptions", "organizations_url": "https://api.github.com/users/xffxff/orgs", "repos_url": "https://api.github.com/users/xffxff/repos", "events_url": "https://api.github.com/users/xffxff/events{/privacy}", "received_events_url": "https://api.github.com/users/xffxff/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "237ea0d34dced3444486931f68e87cd07f52b6a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/237ea0d34dced3444486931f68e87cd07f52b6a8", "html_url": "https://github.com/rust-lang/rust/commit/237ea0d34dced3444486931f68e87cd07f52b6a8"}], "stats": {"total": 135, "additions": 103, "deletions": 32}, "files": [{"sha": "bafaa7266113c0536eb35633c6bfd9ae9c62d104", "filename": "crates/hir_def/src/body/lower.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fhir_def%2Fsrc%2Fbody%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fhir_def%2Fsrc%2Fbody%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fbody%2Flower.rs?ref=0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "patch": "@@ -821,7 +821,7 @@ impl ExprCollector<'_> {\n                 let ellipsis = p\n                     .record_pat_field_list()\n                     .expect(\"every struct should have a field list\")\n-                    .dotdot_token()\n+                    .rest_pat()\n                     .is_some();\n \n                 Pat::Record { path, args, ellipsis }"}, {"sha": "7ba81d0cb15c7eceb03cf4e52a50d01bfd6935f9", "filename": "crates/parser/src/grammar/patterns.rs", "status": "modified", "additions": 46, "deletions": 21, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fparser%2Fsrc%2Fgrammar%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fparser%2Fsrc%2Fgrammar%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fpatterns.rs?ref=0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "patch": "@@ -200,12 +200,43 @@ fn tuple_pat_fields(p: &mut Parser) {\n     p.expect(T![')']);\n }\n \n+// test record_pat_field\n+// fn foo() {\n+//     let S { 0: 1 } = ();\n+//     let S { x: 1 } = ();\n+//     let S { #[cfg(any())] x: 1 } = ();\n+// }\n+fn record_pat_field(p: &mut Parser) {\n+    match p.current() {\n+        IDENT | INT_NUMBER if p.nth(1) == T![:] => {\n+            name_ref_or_index(p);\n+            p.bump(T![:]);\n+            pattern(p);\n+        }\n+        T![.] => {\n+            if p.at(T![..]) {\n+                p.bump(T![..]);\n+            } else {\n+                ident_pat(p, false);\n+            }\n+        }\n+        T![box] => {\n+            // FIXME: not all box patterns should be allowed\n+            box_pat(p);\n+        }\n+        _ => {\n+            ident_pat(p, false);\n+        }\n+    }\n+}\n+\n // test record_pat_field_list\n // fn foo() {\n //     let S {} = ();\n //     let S { f, ref mut g } = ();\n //     let S { h: _, ..} = ();\n //     let S { h: _, } = ();\n+//     let S { #[cfg(any())] .. } = ();\n // }\n fn record_pat_field_list(p: &mut Parser) {\n     assert!(p.at(T!['{']));\n@@ -214,32 +245,26 @@ fn record_pat_field_list(p: &mut Parser) {\n     while !p.at(EOF) && !p.at(T!['}']) {\n         match p.current() {\n             // A trailing `..` is *not* treated as a REST_PAT.\n-            T![.] if p.at(T![..]) => p.bump(T![..]),\n+            T![.] if p.at(T![..]) => {\n+                rest_pat(p);\n+            }\n             T!['{'] => error_block(p, \"expected ident\"),\n+            T![#] => {\n+                let m = p.start();\n+                attributes::outer_attrs(p);\n+                if p.at(T![..]) {\n+                    p.bump(T![..]);\n+                    m.complete(p, REST_PAT);\n+                } else {\n+                    record_pat_field(p);\n+                    m.complete(p, RECORD_PAT_FIELD);\n+                }\n+            }\n \n             _ => {\n                 let m = p.start();\n                 attributes::outer_attrs(p);\n-                match p.current() {\n-                    // test record_pat_field\n-                    // fn foo() {\n-                    //     let S { 0: 1 } = ();\n-                    //     let S { x: 1 } = ();\n-                    //     let S { #[cfg(any())] x: 1 } = ();\n-                    // }\n-                    IDENT | INT_NUMBER if p.nth(1) == T![:] => {\n-                        name_ref_or_index(p);\n-                        p.bump(T![:]);\n-                        pattern(p);\n-                    }\n-                    T![box] => {\n-                        // FIXME: not all box patterns should be allowed\n-                        box_pat(p);\n-                    }\n-                    _ => {\n-                        ident_pat(p, false);\n-                    }\n-                }\n+                record_pat_field(p);\n                 m.complete(p, RECORD_PAT_FIELD);\n             }\n         }"}, {"sha": "9d4aad2d2b8dbce65e8a408dda6203830196741d", "filename": "crates/syntax/src/ast/generated/nodes.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs?ref=0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "patch": "@@ -1175,6 +1175,7 @@ impl BoxPat {\n pub struct RestPat {\n     pub(crate) syntax: SyntaxNode,\n }\n+impl ast::HasAttrs for RestPat {}\n impl RestPat {\n     pub fn dotdot_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![..]) }\n }\n@@ -1289,7 +1290,7 @@ pub struct RecordPatFieldList {\n impl RecordPatFieldList {\n     pub fn l_curly_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T!['{']) }\n     pub fn fields(&self) -> AstChildren<RecordPatField> { support::children(&self.syntax) }\n-    pub fn dotdot_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![..]) }\n+    pub fn rest_pat(&self) -> Option<RestPat> { support::child(&self.syntax) }\n     pub fn r_curly_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T!['}']) }\n }\n #[derive(Debug, Clone, PartialEq, Eq, Hash)]\n@@ -3687,6 +3688,7 @@ impl AstNode for AnyHasAttrs {\n             | MATCH_ARM_LIST\n             | MATCH_ARM\n             | IDENT_PAT\n+            | REST_PAT\n             | RECORD_PAT_FIELD => true,\n             _ => false,\n         }"}, {"sha": "c20e41ffae7badfaef3d96afb808f41949230b56", "filename": "crates/syntax/test_data/parser/inline/ok/0008_path_part.rast", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0008_path_part.rast", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0008_path_part.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0008_path_part.rast?ref=0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "patch": "@@ -62,7 +62,8 @@ SOURCE_FILE@0..103\n             RECORD_PAT_FIELD_LIST@66..72\n               L_CURLY@66..67 \"{\"\n               WHITESPACE@67..68 \" \"\n-              DOT2@68..70 \"..\"\n+              REST_PAT@68..70\n+                DOT2@68..70 \"..\"\n               WHITESPACE@70..71 \" \"\n               R_CURLY@71..72 \"}\"\n           WHITESPACE@72..73 \" \""}, {"sha": "761438d2ec6c8e4b8975ea4a4095f9155193fc62", "filename": "crates/syntax/test_data/parser/inline/ok/0102_record_pat_field_list.rast", "status": "modified", "additions": 50, "deletions": 8, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0102_record_pat_field_list.rast", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0102_record_pat_field_list.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0102_record_pat_field_list.rast?ref=0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "patch": "@@ -1,5 +1,5 @@\n-SOURCE_FILE@0..119\n-  FN@0..118\n+SOURCE_FILE@0..156\n+  FN@0..155\n     FN_KW@0..2 \"fn\"\n     WHITESPACE@2..3 \" \"\n     NAME@3..6\n@@ -8,8 +8,8 @@ SOURCE_FILE@0..119\n       L_PAREN@6..7 \"(\"\n       R_PAREN@7..8 \")\"\n     WHITESPACE@8..9 \" \"\n-    BLOCK_EXPR@9..118\n-      STMT_LIST@9..118\n+    BLOCK_EXPR@9..155\n+      STMT_LIST@9..155\n         L_CURLY@9..10 \"{\"\n         WHITESPACE@10..15 \"\\n    \"\n         LET_STMT@15..29\n@@ -89,7 +89,8 @@ SOURCE_FILE@0..119\n                   UNDERSCORE@78..79 \"_\"\n               COMMA@79..80 \",\"\n               WHITESPACE@80..81 \" \"\n-              DOT2@81..83 \"..\"\n+              REST_PAT@81..83\n+                DOT2@81..83 \"..\"\n               R_CURLY@83..84 \"}\"\n           WHITESPACE@84..85 \" \"\n           EQ@85..86 \"=\"\n@@ -128,6 +129,47 @@ SOURCE_FILE@0..119\n             L_PAREN@113..114 \"(\"\n             R_PAREN@114..115 \")\"\n           SEMICOLON@115..116 \";\"\n-        WHITESPACE@116..117 \"\\n\"\n-        R_CURLY@117..118 \"}\"\n-  WHITESPACE@118..119 \"\\n\"\n+        WHITESPACE@116..121 \"\\n    \"\n+        LET_STMT@121..153\n+          LET_KW@121..124 \"let\"\n+          WHITESPACE@124..125 \" \"\n+          RECORD_PAT@125..147\n+            PATH@125..126\n+              PATH_SEGMENT@125..126\n+                NAME_REF@125..126\n+                  IDENT@125..126 \"S\"\n+            WHITESPACE@126..127 \" \"\n+            RECORD_PAT_FIELD_LIST@127..147\n+              L_CURLY@127..128 \"{\"\n+              WHITESPACE@128..129 \" \"\n+              REST_PAT@129..145\n+                ATTR@129..142\n+                  POUND@129..130 \"#\"\n+                  L_BRACK@130..131 \"[\"\n+                  META@131..141\n+                    PATH@131..134\n+                      PATH_SEGMENT@131..134\n+                        NAME_REF@131..134\n+                          IDENT@131..134 \"cfg\"\n+                    TOKEN_TREE@134..141\n+                      L_PAREN@134..135 \"(\"\n+                      IDENT@135..138 \"any\"\n+                      TOKEN_TREE@138..140\n+                        L_PAREN@138..139 \"(\"\n+                        R_PAREN@139..140 \")\"\n+                      R_PAREN@140..141 \")\"\n+                  R_BRACK@141..142 \"]\"\n+                WHITESPACE@142..143 \" \"\n+                DOT2@143..145 \"..\"\n+              WHITESPACE@145..146 \" \"\n+              R_CURLY@146..147 \"}\"\n+          WHITESPACE@147..148 \" \"\n+          EQ@148..149 \"=\"\n+          WHITESPACE@149..150 \" \"\n+          TUPLE_EXPR@150..152\n+            L_PAREN@150..151 \"(\"\n+            R_PAREN@151..152 \")\"\n+          SEMICOLON@152..153 \";\"\n+        WHITESPACE@153..154 \"\\n\"\n+        R_CURLY@154..155 \"}\"\n+  WHITESPACE@155..156 \"\\n\""}, {"sha": "0bfaae7c4d02622d2911d2b575bd3d10b4ab528a", "filename": "crates/syntax/test_data/parser/inline/ok/0102_record_pat_field_list.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0102_record_pat_field_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6b70b347c7f81f32c0aeb756e1b33a02459d8/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0102_record_pat_field_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0102_record_pat_field_list.rs?ref=0ee6b70b347c7f81f32c0aeb756e1b33a02459d8", "patch": "@@ -3,4 +3,5 @@ fn foo() {\n     let S { f, ref mut g } = ();\n     let S { h: _, ..} = ();\n     let S { h: _, } = ();\n+    let S { #[cfg(any())] .. } = ();\n }"}]}