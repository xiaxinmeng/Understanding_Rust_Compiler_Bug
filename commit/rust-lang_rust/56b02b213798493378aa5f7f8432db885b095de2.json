{"sha": "56b02b213798493378aa5f7f8432db885b095de2", "node_id": "C_kwDOAAsO6NoAKDU2YjAyYjIxMzc5ODQ5MzM3OGFhNWY3Zjg0MzJkYjg4NWIwOTVkZTI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-17T10:32:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-17T10:32:53Z"}, "message": "Rollup merge of #100532 - RalfJung:unwind-miri, r=Mark-Simulacrum\n\nunwind: don't build dependency when building for Miri\n\nThis is basically re-submitting https://github.com/rust-lang/rust/pull/94813.\n\nIn that PR there was a suggestion to instead have bootstrap set a `RUST_CHECK` env var and use that rather than doing something Miri-specific. However, such an env var would mean that when switching between `./x.py check` and `./x.py build`, the build script gets re-run each time, which doesn't seem good. So I think for now checking for Miri probably causes fewer problems.\n\nr? ````@Mark-Simulacrum````", "tree": {"sha": "71ea80606ab5c12ef77788651fe3314e9054a4c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71ea80606ab5c12ef77788651fe3314e9054a4c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56b02b213798493378aa5f7f8432db885b095de2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi/MPVCRBK7hj4Ov3rIwAAUYkIAJQNgEIqN+Y8nB5Vj2KMvyMl\nLIyBHxM48ul/KI354uqw8Y4wIipHYmIOeiKJM4LyeM4BnuaRvtp76JHB7aaIsb7F\nOWyOh9aFeXg3RlEugpKtUfqdS0SSYk1zsdykXR8R90rjmZ1V3zkuHwhSBL0yITlN\nefnmd6Dh6nxuEwIfHqrRUb/AJEkV/nK4aWO3itIlcnOWg1A2b378oeMRVTl9LVqp\nozrB9/y2sGulupp3RkjtwwwDYs6jyp52UIptRqs23CCc1YFnO98AbKw6TVwnLR/r\nep5nc+UKC5hDjtM3s4iwgy7obtk0ZOM9SUi6qtK/eosVl6ny4Pq4bLari3xMhFI=\n=dI+z\n-----END PGP SIGNATURE-----\n", "payload": "tree 71ea80606ab5c12ef77788651fe3314e9054a4c6\nparent 1e93994b4d20a9827874a69972026107e0d41bb1\nparent 63113c8b0cb97482e0ba65cf8429fe2ee7d1ca51\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1660732373 +0200\ncommitter GitHub <noreply@github.com> 1660732373 +0200\n\nRollup merge of #100532 - RalfJung:unwind-miri, r=Mark-Simulacrum\n\nunwind: don't build dependency when building for Miri\n\nThis is basically re-submitting https://github.com/rust-lang/rust/pull/94813.\n\nIn that PR there was a suggestion to instead have bootstrap set a `RUST_CHECK` env var and use that rather than doing something Miri-specific. However, such an env var would mean that when switching between `./x.py check` and `./x.py build`, the build script gets re-run each time, which doesn't seem good. So I think for now checking for Miri probably causes fewer problems.\n\nr? ````@Mark-Simulacrum````\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56b02b213798493378aa5f7f8432db885b095de2", "html_url": "https://github.com/rust-lang/rust/commit/56b02b213798493378aa5f7f8432db885b095de2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56b02b213798493378aa5f7f8432db885b095de2/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e93994b4d20a9827874a69972026107e0d41bb1", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e93994b4d20a9827874a69972026107e0d41bb1", "html_url": "https://github.com/rust-lang/rust/commit/1e93994b4d20a9827874a69972026107e0d41bb1"}, {"sha": "63113c8b0cb97482e0ba65cf8429fe2ee7d1ca51", "url": "https://api.github.com/repos/rust-lang/rust/commits/63113c8b0cb97482e0ba65cf8429fe2ee7d1ca51", "html_url": "https://github.com/rust-lang/rust/commit/63113c8b0cb97482e0ba65cf8429fe2ee7d1ca51"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "31af390253b6f108c64d26c057295a482b992b84", "filename": "library/unwind/build.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/56b02b213798493378aa5f7f8432db885b095de2/library%2Funwind%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56b02b213798493378aa5f7f8432db885b095de2/library%2Funwind%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Funwind%2Fbuild.rs?ref=56b02b213798493378aa5f7f8432db885b095de2", "patch": "@@ -2,8 +2,14 @@ use std::env;\n \n fn main() {\n     println!(\"cargo:rerun-if-changed=build.rs\");\n-    let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n+    println!(\"cargo:rerun-if-env-changed=CARGO_CFG_MIRI\");\n+\n+    if env::var_os(\"CARGO_CFG_MIRI\").is_some() {\n+        // Miri doesn't need the linker flags or a libunwind build.\n+        return;\n+    }\n \n+    let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n     if target.contains(\"android\") {\n         let build = cc::Build::new();\n "}]}