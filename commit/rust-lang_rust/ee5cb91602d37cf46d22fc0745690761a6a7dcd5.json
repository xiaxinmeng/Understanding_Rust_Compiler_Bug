{"sha": "ee5cb91602d37cf46d22fc0745690761a6a7dcd5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlNWNiOTE2MDJkMzdjZjQ2ZDIyZmMwNzQ1NjkwNzYxYTZhN2RjZDU=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-02-24T23:52:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-02-24T23:52:27Z"}, "message": "Merge pull request #2489 from topecongiro/issue-2487\n\nPreserve trailing comma on macro in item position", "tree": {"sha": "376199f47ffacefaa2a09ab993d7bdcdf6cc68dc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/376199f47ffacefaa2a09ab993d7bdcdf6cc68dc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee5cb91602d37cf46d22fc0745690761a6a7dcd5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJakfq7CRBK7hj4Ov3rIwAAdHIIAIVuuenrl2F1eQCiRwOCz73+\nCe3zptNfe07bWuV7/sRdrB3+wtNpo3xqZoA+T5mtFh8THUoKEy9caWr5Dnv9Lt6D\n8Z2dM9lo1q298q8KBCgXELz2kJEjdufsVjC+ptjbbcf+eVMNRKJZTcs4KMQtNf6A\nkLAtUwG++SALBxpoDIYlnuK5PsvADShkXIsTJqIYBAaAP7uXvS1/M8RHrXA8kMEX\nSH9M5HUuMfUU7x8faHzk45HfeVWmBOOjrhcKvzio0c45soiMit0BBTxxb1M0jpII\nV6gl6+E75Dss/8D6uiPTSJkPqaVSQoaT8xcBW98AM5UoCX2lZCDfpSp2cktgS3M=\n=/Fyo\n-----END PGP SIGNATURE-----\n", "payload": "tree 376199f47ffacefaa2a09ab993d7bdcdf6cc68dc\nparent 2eb57b389746d9117329e09518b94cd00680af6d\nparent 3b79dd9b37662402b4715801e0a128dc74300b30\nauthor Nick Cameron <nrc@ncameron.org> 1519516347 +1300\ncommitter GitHub <noreply@github.com> 1519516347 +1300\n\nMerge pull request #2489 from topecongiro/issue-2487\n\nPreserve trailing comma on macro in item position "}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee5cb91602d37cf46d22fc0745690761a6a7dcd5", "html_url": "https://github.com/rust-lang/rust/commit/ee5cb91602d37cf46d22fc0745690761a6a7dcd5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee5cb91602d37cf46d22fc0745690761a6a7dcd5/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2eb57b389746d9117329e09518b94cd00680af6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/2eb57b389746d9117329e09518b94cd00680af6d", "html_url": "https://github.com/rust-lang/rust/commit/2eb57b389746d9117329e09518b94cd00680af6d"}, {"sha": "3b79dd9b37662402b4715801e0a128dc74300b30", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b79dd9b37662402b4715801e0a128dc74300b30", "html_url": "https://github.com/rust-lang/rust/commit/3b79dd9b37662402b4715801e0a128dc74300b30"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "e7238a314fc22deae6ead58bbecf06aa9229f461", "filename": "rustfmt-core/src/macros.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ee5cb91602d37cf46d22fc0745690761a6a7dcd5/rustfmt-core%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee5cb91602d37cf46d22fc0745690761a6a7dcd5/rustfmt-core%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rustfmt-core%2Fsrc%2Fmacros.rs?ref=ee5cb91602d37cf46d22fc0745690761a6a7dcd5", "patch": "@@ -286,8 +286,12 @@ pub fn rewrite_macro(\n                 );\n                 let arg_vec = &arg_vec.iter().map(|e| &*e).collect::<Vec<_>>()[..];\n                 let rewrite = rewrite_array(arg_vec, sp, context, mac_shape, trailing_comma)?;\n+                let comma = match position {\n+                    MacroPosition::Item => \";\",\n+                    _ => \"\",\n+                };\n \n-                Some(format!(\"{}{}\", macro_name, rewrite))\n+                Some(format!(\"{}{}{}\", macro_name, rewrite, comma))\n             }\n         }\n         MacroStyle::Braces => {"}, {"sha": "11e6d52c6c8e8ba0641d0305f25ff3e7807bcf8d", "filename": "rustfmt-core/tests/source/macros.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ee5cb91602d37cf46d22fc0745690761a6a7dcd5/rustfmt-core%2Ftests%2Fsource%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee5cb91602d37cf46d22fc0745690761a6a7dcd5/rustfmt-core%2Ftests%2Fsource%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rustfmt-core%2Ftests%2Fsource%2Fmacros.rs?ref=ee5cb91602d37cf46d22fc0745690761a6a7dcd5", "patch": "@@ -336,3 +336,7 @@ macro foo() {\n macro lex_err($kind: ident $(, $body: expr)*) {\n     Err(QlError::LexError(LexError::$kind($($body,)*)))\n }\n+\n+// Preserve trailing comma on item-level macro with `()` or `[]`.\n+methods![ get, post, delete, ];\n+methods!( get, post, delete, );"}, {"sha": "8db2fbb60ee99ebbd74d77b3322dd738b13b6619", "filename": "rustfmt-core/tests/target/macros.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ee5cb91602d37cf46d22fc0745690761a6a7dcd5/rustfmt-core%2Ftests%2Ftarget%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee5cb91602d37cf46d22fc0745690761a6a7dcd5/rustfmt-core%2Ftests%2Ftarget%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rustfmt-core%2Ftests%2Ftarget%2Fmacros.rs?ref=ee5cb91602d37cf46d22fc0745690761a6a7dcd5", "patch": "@@ -911,3 +911,7 @@ macro foo() {\n macro lex_err($kind: ident $(, $body: expr)*) {\n     Err(QlError::LexError(LexError::$kind($($body,)*)))\n }\n+\n+// Preserve trailing comma on item-level macro with `()` or `[]`.\n+methods![get, post, delete,];\n+methods!(get, post, delete,);"}]}