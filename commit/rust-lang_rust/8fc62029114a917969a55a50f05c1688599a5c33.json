{"sha": "8fc62029114a917969a55a50f05c1688599a5c33", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmYzYyMDI5MTE0YTkxNzk2OWE1NWE1MGYwNWMxNjg4NTk5YTVjMzM=", "commit": {"author": {"name": "Juan Aguilar Santillana", "email": "mhpoin@gmail.com", "date": "2020-05-16T02:57:40Z"}, "committer": {"name": "Juan Aguilar Santillana", "email": "mhpoin@gmail.com", "date": "2020-05-16T02:57:40Z"}, "message": "Fix make sure out primary file comes first", "tree": {"sha": "6b25a29e4c04c39104d8e870c463f575b922d1c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6b25a29e4c04c39104d8e870c463f575b922d1c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8fc62029114a917969a55a50f05c1688599a5c33", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8fc62029114a917969a55a50f05c1688599a5c33", "html_url": "https://github.com/rust-lang/rust/commit/8fc62029114a917969a55a50f05c1688599a5c33", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8fc62029114a917969a55a50f05c1688599a5c33/comments", "author": {"login": "botika", "id": 2625545, "node_id": "MDQ6VXNlcjI2MjU1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2625545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/botika", "html_url": "https://github.com/botika", "followers_url": "https://api.github.com/users/botika/followers", "following_url": "https://api.github.com/users/botika/following{/other_user}", "gists_url": "https://api.github.com/users/botika/gists{/gist_id}", "starred_url": "https://api.github.com/users/botika/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/botika/subscriptions", "organizations_url": "https://api.github.com/users/botika/orgs", "repos_url": "https://api.github.com/users/botika/repos", "events_url": "https://api.github.com/users/botika/events{/privacy}", "received_events_url": "https://api.github.com/users/botika/received_events", "type": "User", "site_admin": false}, "committer": {"login": "botika", "id": 2625545, "node_id": "MDQ6VXNlcjI2MjU1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2625545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/botika", "html_url": "https://github.com/botika", "followers_url": "https://api.github.com/users/botika/followers", "following_url": "https://api.github.com/users/botika/following{/other_user}", "gists_url": "https://api.github.com/users/botika/gists{/gist_id}", "starred_url": "https://api.github.com/users/botika/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/botika/subscriptions", "organizations_url": "https://api.github.com/users/botika/orgs", "repos_url": "https://api.github.com/users/botika/repos", "events_url": "https://api.github.com/users/botika/events{/privacy}", "received_events_url": "https://api.github.com/users/botika/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f16060f386c3ceee257b2c38ce5072b2d0943b6a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f16060f386c3ceee257b2c38ce5072b2d0943b6a", "html_url": "https://github.com/rust-lang/rust/commit/f16060f386c3ceee257b2c38ce5072b2d0943b6a"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "5b47364e714e910dbf6792c98af13e119944a74b", "filename": "src/librustc_errors/annotate_snippet_emitter_writer.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/8fc62029114a917969a55a50f05c1688599a5c33/src%2Flibrustc_errors%2Fannotate_snippet_emitter_writer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fc62029114a917969a55a50f05c1688599a5c33/src%2Flibrustc_errors%2Fannotate_snippet_emitter_writer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Fannotate_snippet_emitter_writer.rs?ref=8fc62029114a917969a55a50f05c1688599a5c33", "patch": "@@ -104,14 +104,25 @@ impl AnnotateSnippetEmitterWriter {\n         if let Some(source_map) = &self.source_map {\n             // Make sure our primary file comes first\n             let primary_lo = if let Some(ref primary_span) = msp.primary_span().as_ref() {\n-                source_map.lookup_char_pos(primary_span.lo())\n+                if primary_span.is_dummy() {\n+                    // FIXME(#59346): Not sure when this is the case and what\n+                    // should be done if it happens\n+                    return;\n+                } else {\n+                    source_map.lookup_char_pos(primary_span.lo())\n+                }\n             } else {\n                 // FIXME(#59346): Not sure when this is the case and what\n                 // should be done if it happens\n                 return;\n             };\n-            let annotated_files =\n+            let mut annotated_files =\n                 FileWithAnnotatedLines::collect_annotations(msp, &self.source_map);\n+            if let Ok(pos) =\n+                annotated_files.binary_search_by(|x| x.file.name.cmp(&primary_lo.file.name))\n+            {\n+                annotated_files.swap(0, pos);\n+            }\n             // owned: line source, line index, annotations\n             type Owned = (String, usize, Vec<crate::snippet::Annotation>);\n             let origin = primary_lo.file.name.to_string();"}]}