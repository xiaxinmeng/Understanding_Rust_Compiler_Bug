{"sha": "0e0756cf0d1b55f3de4815088276a584e2c31f14", "node_id": "C_kwDOAAsO6NoAKDBlMDc1NmNmMGQxYjU1ZjNkZTQ4MTUwODgyNzZhNTg0ZTJjMzFmMTQ", "commit": {"author": {"name": "beetrees", "email": "b@beetr.ee", "date": "2022-09-04T09:22:36Z"}, "committer": {"name": "beetrees", "email": "b@beetr.ee", "date": "2022-09-04T09:22:36Z"}, "message": "Don't duplicate file descriptors into stdio fds", "tree": {"sha": "201d9606326639c668cb7069c1ac620b70310b5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/201d9606326639c668cb7069c1ac620b70310b5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e0756cf0d1b55f3de4815088276a584e2c31f14", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQT9oej+Slbzs/bk2IuHkb11QZHr1gUCYxRuXAAKCRCHkb11QZHr\n1qsqAQDKqqUdtGwulqWElFHDAusQaDck+sA8uaL7pjA9q/+pPQD6AunPTT7FCQNP\nJlt5DQ3PAYiSVz6lADCuM3K4NlTGeA4=\n=KFzn\n-----END PGP SIGNATURE-----", "payload": "tree 201d9606326639c668cb7069c1ac620b70310b5a\nparent c2d140bd36e7fcdc894b7c342fd81a63fdd66373\nauthor beetrees <b@beetr.ee> 1662283356 +0100\ncommitter beetrees <b@beetr.ee> 1662283356 +0100\n\nDon't duplicate file descriptors into stdio fds\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e0756cf0d1b55f3de4815088276a584e2c31f14", "html_url": "https://github.com/rust-lang/rust/commit/0e0756cf0d1b55f3de4815088276a584e2c31f14", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e0756cf0d1b55f3de4815088276a584e2c31f14/comments", "author": {"login": "beetrees", "id": 107947675, "node_id": "U_kgDOBm8mmw", "avatar_url": "https://avatars.githubusercontent.com/u/107947675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beetrees", "html_url": "https://github.com/beetrees", "followers_url": "https://api.github.com/users/beetrees/followers", "following_url": "https://api.github.com/users/beetrees/following{/other_user}", "gists_url": "https://api.github.com/users/beetrees/gists{/gist_id}", "starred_url": "https://api.github.com/users/beetrees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beetrees/subscriptions", "organizations_url": "https://api.github.com/users/beetrees/orgs", "repos_url": "https://api.github.com/users/beetrees/repos", "events_url": "https://api.github.com/users/beetrees/events{/privacy}", "received_events_url": "https://api.github.com/users/beetrees/received_events", "type": "User", "site_admin": false}, "committer": {"login": "beetrees", "id": 107947675, "node_id": "U_kgDOBm8mmw", "avatar_url": "https://avatars.githubusercontent.com/u/107947675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beetrees", "html_url": "https://github.com/beetrees", "followers_url": "https://api.github.com/users/beetrees/followers", "following_url": "https://api.github.com/users/beetrees/following{/other_user}", "gists_url": "https://api.github.com/users/beetrees/gists{/gist_id}", "starred_url": "https://api.github.com/users/beetrees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beetrees/subscriptions", "organizations_url": "https://api.github.com/users/beetrees/orgs", "repos_url": "https://api.github.com/users/beetrees/repos", "events_url": "https://api.github.com/users/beetrees/events{/privacy}", "received_events_url": "https://api.github.com/users/beetrees/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2d140bd36e7fcdc894b7c342fd81a63fdd66373", "url": "https://api.github.com/repos/rust-lang/rust/commits/c2d140bd36e7fcdc894b7c342fd81a63fdd66373", "html_url": "https://github.com/rust-lang/rust/commit/c2d140bd36e7fcdc894b7c342fd81a63fdd66373"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "71e33fb9ed86442b0797a3ce52ebf8c794007615", "filename": "library/std/src/os/fd/owned.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0e0756cf0d1b55f3de4815088276a584e2c31f14/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fowned.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e0756cf0d1b55f3de4815088276a584e2c31f14/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fowned.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fowned.rs?ref=0e0756cf0d1b55f3de4815088276a584e2c31f14", "patch": "@@ -104,7 +104,8 @@ impl BorrowedFd<'_> {\n         #[cfg(target_os = \"espidf\")]\n         let cmd = libc::F_DUPFD;\n \n-        let fd = cvt(unsafe { libc::fcntl(self.as_raw_fd(), cmd, 0) })?;\n+        // Avoid using file descriptors below 3 as they are used for stdio\n+        let fd = cvt(unsafe { libc::fcntl(self.as_raw_fd(), cmd, 3) })?;\n         Ok(unsafe { OwnedFd::from_raw_fd(fd) })\n     }\n "}]}