{"sha": "2b8886fb5d757fe71265a6d89e5f6a6786a04ec5", "node_id": "C_kwDOAAsO6NoAKDJiODg4NmZiNWQ3NTdmZTcxMjY1YTZkODllNWY2YTY3ODZhMDRlYzU", "commit": {"author": {"name": "Andrew Pollack", "email": "andrewpkq@gmail.com", "date": "2022-09-02T19:21:14Z"}, "committer": {"name": "Andrew Pollack", "email": "andrewpollack@google.com", "date": "2022-09-16T19:22:54Z"}, "message": "Adding Fuchsia zxdb debugging walkthrough to docs", "tree": {"sha": "cbde400c1ac1055419f2b1f9e7c7358c75e25255", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cbde400c1ac1055419f2b1f9e7c7358c75e25255"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5", "html_url": "https://github.com/rust-lang/rust/commit/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5/comments", "author": {"login": "andrewpollack", "id": 24868505, "node_id": "MDQ6VXNlcjI0ODY4NTA1", "avatar_url": "https://avatars.githubusercontent.com/u/24868505?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewpollack", "html_url": "https://github.com/andrewpollack", "followers_url": "https://api.github.com/users/andrewpollack/followers", "following_url": "https://api.github.com/users/andrewpollack/following{/other_user}", "gists_url": "https://api.github.com/users/andrewpollack/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewpollack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewpollack/subscriptions", "organizations_url": "https://api.github.com/users/andrewpollack/orgs", "repos_url": "https://api.github.com/users/andrewpollack/repos", "events_url": "https://api.github.com/users/andrewpollack/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewpollack/received_events", "type": "User", "site_admin": false}, "committer": {"login": "andrewpollack", "id": 24868505, "node_id": "MDQ6VXNlcjI0ODY4NTA1", "avatar_url": "https://avatars.githubusercontent.com/u/24868505?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewpollack", "html_url": "https://github.com/andrewpollack", "followers_url": "https://api.github.com/users/andrewpollack/followers", "following_url": "https://api.github.com/users/andrewpollack/following{/other_user}", "gists_url": "https://api.github.com/users/andrewpollack/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewpollack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewpollack/subscriptions", "organizations_url": "https://api.github.com/users/andrewpollack/orgs", "repos_url": "https://api.github.com/users/andrewpollack/repos", "events_url": "https://api.github.com/users/andrewpollack/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewpollack/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "78a891d364a7358ed9eb9c93099ba2f3e6817ca6", "url": "https://api.github.com/repos/rust-lang/rust/commits/78a891d364a7358ed9eb9c93099ba2f3e6817ca6", "html_url": "https://github.com/rust-lang/rust/commit/78a891d364a7358ed9eb9c93099ba2f3e6817ca6"}], "stats": {"total": 137, "additions": 135, "deletions": 2}, "files": [{"sha": "470f065a655ca52bb4bb4c08855ae0752dfb5adb", "filename": "src/doc/rustc/src/platform-support/fuchsia.md", "status": "modified", "additions": 135, "deletions": 2, "changes": 137, "blob_url": "https://github.com/rust-lang/rust/blob/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Ffuchsia.md", "raw_url": "https://github.com/rust-lang/rust/raw/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Ffuchsia.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Ffuchsia.md?ref=2b8886fb5d757fe71265a6d89e5f6a6786a04ec5", "patch": "@@ -42,6 +42,11 @@ authoritative if this occurs. Instead of pinging individual members, use\n 1. [Testing](#testing)\n     1. [Running unit tests](#running-unit-tests)\n     1. [Running the compiler test suite](#running-the-compiler-test-suite)\n+1. [Debugging](#debugging)\n+    1. [`zxdb`](#zxdb)\n+    1. [Attaching `zxdb`](#attaching-zxdb)\n+    1. [Using `zxdb`](#using-zxdb)\n+    1. [Displaying source code in `zxdb`](#displaying-source-code-in-zxdb)\n \n ## Requirements\n \n@@ -136,7 +141,7 @@ These options configure the following:\n \n * `-Lnative=${SDK_PATH}/arch/${ARCH}/lib`: Link against Fuchsia libraries from\n   the SDK\n-* `-Lnative=${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia kernel\n+* `-Lnative=${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia sysroot\n   libraries from the SDK\n \n In total, our new project will look like:\n@@ -253,7 +258,7 @@ the following options:\n   platform of your choice\n * `-Lnative ${SDK_PATH}/arch/${ARCH}/lib`: Link against Fuchsia libraries from\n   the SDK\n-* `-Lnative ${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia kernel\n+* `-Lnative ${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia sysroot\n   libraries from the SDK\n \n Putting it all together:\n@@ -638,6 +643,130 @@ available on the [Fuchsia devsite].\n Running the Rust test suite on Fuchsia is [not currently supported], but work is\n underway to enable it.\n \n+## Debugging\n+\n+### `zxdb`\n+\n+Debugging components running on a Fuchsia emulator can be done using the\n+console-mode debugger: [zxdb]. We will demonstrate attaching necessary symbol\n+paths to debug our `hello-fuchsia` component.\n+\n+### Attaching `zxdb`\n+\n+In a separate terminal, issue the following command from our `hello_fuchsia`\n+directory to launch `zxdb`:\n+\n+**In separate terminal**\n+```sh\n+${SDK_PATH}/tools/${ARCH}/ffx debug connect -- \\\n+    --symbol-path target/x86_64-fuchsia/debug\n+```\n+\n+* `--symbol-path` gets required symbol paths, which are\n+necessary for stepping through your program.\n+\n+The \"[displaying source code in `zxdb`](#displaying-source-code-in-zxdb)\" section describes how you can\n+display Rust and/or Fuchsia source code in your debugging session.\n+\n+### Using `zxdb`\n+\n+Once launched, you will be presented with the window:\n+\n+```sh\n+Connecting (use \"disconnect\" to cancel)...\n+Connected successfully.\n+\ud83d\udc49 To get started, try \"status\" or \"help\".\n+[zxdb]\n+```\n+\n+To attach to our program, we can run:\n+\n+```sh\n+[zxdb] attach hello_fuchsia\n+```\n+\n+**Expected output**\n+```sh\n+Waiting for process matching \"hello_fuchsia\".\n+Type \"filter\" to see the current filters.\n+```\n+\n+Next, we can create a breakpoint at main using \"b main\":\n+\n+```sh\n+[zxdb] b main\n+```\n+\n+**Expected output**\n+```sh\n+Created Breakpoint 1 @ main\n+```\n+\n+Finally, we can re-run the \"hello_fuchsia\" component from our original\n+terminal:\n+\n+```sh\n+${SDK_PATH}/tools/${ARCH}/ffx component run \\\n+    --recreate \\\n+    fuchsia-pkg://hello-fuchsia/hello_fuchsia_manifest#meta/hello_fuchsia.cm\n+```\n+\n+Once our component is running, our `zxdb` window will stop execution\n+in our main as desired:\n+\n+**Expected output**\n+```txt\n+Breakpoint 1 now matching 1 addrs for main\n+\ud83d\uded1 on bp 1 hello_fuchsia::main() \u2022 main.rs:2\n+   1 fn main() {\n+ \u25b6 2     println!(\"Hello Fuchsia!\");\n+   3 }\n+   4\n+[zxdb]\n+```\n+\n+`zxdb` has similar commands to other debuggers like [gdb].\n+To list the available commands, run \"help\" in the\n+`zxdb` window or visit [the zxdb documentation].\n+\n+```sh\n+[zxdb] help\n+```\n+\n+**Expected output**\n+```sh\n+Help!\n+\n+  Type \"help <command>\" for command-specific help.\n+\n+Other help topics (see \"help <topic>\")\n+...\n+```\n+\n+### Displaying source code in `zxdb`\n+\n+By default, the debugger will not be able to display\n+source code while debugging. For our user code, we displayed\n+source code by pointing our debugger to our debug binary via\n+the `--symbol-path` arg. To display library source code in\n+the debugger, you must provide paths to the source using\n+`--build-dir`. For example, to display the Rust and Fuchsia\n+source code:\n+\n+```sh\n+${SDK_PATH}/tools/${ARCH}/ffx debug connect -- \\\n+    --symbol-path target/x86_64-fuchsia/debug \\\n+    --build-dir ${RUST_SRC_PATH}/rust \\\n+    --build-dir ${FUCHSIA_SRC_PATH}/fuchsia/out/default\n+```\n+\n+ * `--build-dir` links against source code paths, which\n+ are not strictly necessary for debugging, but is a nice-to-have\n+ for displaying source code in `zxdb`.\n+\n+ Linking to a Fuchsia checkout can help with debugging Fuchsia libraries,\n+ such as [fdio].\n+\n [Fuchsia team]: https://team-api.infra.rust-lang.org/v1/teams/fuchsia.json\n [Fuchsia]: https://fuchsia.dev/\n [source tree]: https://fuchsia.dev/fuchsia-src/get-started/learn/build\n@@ -648,3 +777,7 @@ underway to enable it.\n [reference for the file format]: https://fuchsia.dev/reference/cml\n [Fuchsia devsite]: https://fuchsia.dev/reference/cml\n [not currently supported]: https://fxbug.dev/105393\n+[zxdb]: https://fuchsia.dev/fuchsia-src/development/debugger\n+[gdb]: https://www.sourceware.org/gdb/\n+[the zxdb documentation]: https://fuchsia.dev/fuchsia-src/development/debugger\n+[fdio]: https://cs.opensource.google/fuchsia/fuchsia/+/main:sdk/lib/fdio/"}]}