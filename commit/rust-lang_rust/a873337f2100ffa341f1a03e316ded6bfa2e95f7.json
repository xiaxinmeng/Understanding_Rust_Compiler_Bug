{"sha": "a873337f2100ffa341f1a03e316ded6bfa2e95f7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE4NzMzMzdmMjEwMGZmYTM0MWYxYTAzZTMxNmRlZDZiZmEyZTk1Zjc=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-01-06T01:08:15Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-01-13T03:36:28Z"}, "message": "Point at the match discriminant when arm pattern has a type mismatch", "tree": {"sha": "4d958c48ff6af0249c6956681cfbb4aefaef3691", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4d958c48ff6af0249c6956681cfbb4aefaef3691"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a873337f2100ffa341f1a03e316ded6bfa2e95f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a873337f2100ffa341f1a03e316ded6bfa2e95f7", "html_url": "https://github.com/rust-lang/rust/commit/a873337f2100ffa341f1a03e316ded6bfa2e95f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a873337f2100ffa341f1a03e316ded6bfa2e95f7/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2d381d39d282c0586d50ea7d7a431ffd5ddb3fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/c2d381d39d282c0586d50ea7d7a431ffd5ddb3fb", "html_url": "https://github.com/rust-lang/rust/commit/c2d381d39d282c0586d50ea7d7a431ffd5ddb3fb"}], "stats": {"total": 260, "additions": 183, "deletions": 77}, "files": [{"sha": "0063e488b0da17950c62dc3a3894101e2d3c2cc0", "filename": "src/librustc/infer/error_reporting/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -487,6 +487,9 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n \n     fn note_error_origin(&self, err: &mut DiagnosticBuilder<'tcx>, cause: &ObligationCause<'tcx>) {\n         match cause.code {\n+            ObligationCauseCode::MatchExpressionArmPattern { span, ty } => {\n+                err.span_label(span, format!(\"this match expression evaluates to `{}`\", ty));\n+            }\n             ObligationCauseCode::MatchExpressionArm { arm_span, source } => match source {\n                 hir::MatchSource::IfLetDesugar { .. } => {\n                     let msg = \"`if let` arm with an incompatible type\";"}, {"sha": "7d9e80fd60f5c345020a1e72739539d3703f62a4", "filename": "src/librustc/traits/error_reporting.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1444,15 +1444,15 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n         match *cause_code {\n             ObligationCauseCode::ExprAssignable |\n             ObligationCauseCode::MatchExpressionArm { .. } |\n+            ObligationCauseCode::MatchExpressionArmPattern { .. } |\n             ObligationCauseCode::IfExpression |\n             ObligationCauseCode::IfExpressionWithNoElse |\n             ObligationCauseCode::MainFunctionType |\n             ObligationCauseCode::StartFunctionType |\n             ObligationCauseCode::IntrinsicType |\n             ObligationCauseCode::MethodReceiver |\n             ObligationCauseCode::ReturnNoExpression |\n-            ObligationCauseCode::MiscObligation => {\n-            }\n+            ObligationCauseCode::MiscObligation => {}\n             ObligationCauseCode::SliceOrArrayElem => {\n                 err.note(\"slice and array elements must have `Sized` type\");\n             }"}, {"sha": "14c25b77a1b8213f855f2dfde4dc3129c2a7e3c2", "filename": "src/librustc/traits/mod.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fmod.rs?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -220,8 +220,13 @@ pub enum ObligationCauseCode<'tcx> {\n     ExprAssignable,\n \n     /// Computing common supertype in the arms of a match expression\n-    MatchExpressionArm { arm_span: Span,\n-                         source: hir::MatchSource },\n+    MatchExpressionArm {\n+        arm_span: Span,\n+        source: hir::MatchSource,\n+    },\n+\n+    /// Computing common supertype in the pattern guard for the arms of a match expression\n+    MatchExpressionArmPattern { span: Span, ty: Ty<'tcx> },\n \n     /// Computing common supertype in an if expression\n     IfExpression,"}, {"sha": "277e2ed0e87d26980ba2f021a23a891847c7a3c5", "filename": "src/librustc/traits/structural_impls.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Ftraits%2Fstructural_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc%2Ftraits%2Fstructural_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fstructural_impls.rs?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -517,6 +517,9 @@ impl<'a, 'tcx> Lift<'tcx> for traits::ObligationCauseCode<'a> {\n                 arm_span,\n                 source: source,\n             }),\n+            super::MatchExpressionArmPattern { span, ty } => {\n+                tcx.lift(&ty).map(|ty| super::MatchExpressionArmPattern { span, ty })\n+            }\n             super::IfExpression => Some(super::IfExpression),\n             super::IfExpressionWithNoElse => Some(super::IfExpressionWithNoElse),\n             super::MainFunctionType => Some(super::MainFunctionType),"}, {"sha": "48bd882da22b3813df896b63d8ce396f0c7e4327", "filename": "src/librustc_typeck/check/_match.rs", "status": "modified", "additions": 82, "deletions": 65, "changes": 147, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2F_match.rs?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -29,12 +29,11 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         pat: &'gcx hir::Pat,\n         mut expected: Ty<'tcx>,\n         mut def_bm: ty::BindingMode,\n-        is_arg: bool)\n-    {\n+        match_discrim_span: Option<Span>,\n+    ) {\n         let tcx = self.tcx;\n \n-        debug!(\"check_pat_walk(pat={:?},expected={:?},def_bm={:?},is_arg={})\",\n-            pat, expected, def_bm, is_arg);\n+        debug!(\"check_pat_walk(pat={:?},expected={:?},def_bm={:?})\", pat, expected, def_bm);\n \n         let is_non_ref_pat = match pat.node {\n             PatKind::Struct(..) |\n@@ -210,8 +209,8 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                 let common_type = self.resolve_type_vars_if_possible(&lhs_ty);\n \n                 // subtyping doesn't matter here, as the value is some kind of scalar\n-                self.demand_eqtype(pat.span, expected, lhs_ty);\n-                self.demand_eqtype(pat.span, expected, rhs_ty);\n+                self.demand_eqtype_pat(pat.span, expected, lhs_ty, match_discrim_span);\n+                self.demand_eqtype_pat(pat.span, expected, rhs_ty, match_discrim_span);\n                 common_type\n             }\n             PatKind::Binding(ba, var_id, _, ref sub) => {\n@@ -240,37 +239,45 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                         // `x` is assigned a value of type `&M T`, hence `&M T <: typeof(x)` is\n                         // required. However, we use equality, which is stronger. See (*) for\n                         // an explanation.\n-                        self.demand_eqtype(pat.span, region_ty, local_ty);\n+                        self.demand_eqtype_pat(pat.span, region_ty, local_ty, match_discrim_span);\n                     }\n                     // otherwise the type of x is the expected type T\n                     ty::BindByValue(_) => {\n                         // As above, `T <: typeof(x)` is required but we\n                         // use equality, see (*) below.\n-                        self.demand_eqtype(pat.span, expected, local_ty);\n+                        self.demand_eqtype_pat(pat.span, expected, local_ty, match_discrim_span);\n                     }\n                 }\n \n                 // if there are multiple arms, make sure they all agree on\n                 // what the type of the binding `x` ought to be\n                 if var_id != pat.id {\n                     let vt = self.local_ty(pat.span, var_id).decl_ty;\n-                    self.demand_eqtype(pat.span, vt, local_ty);\n+                    self.demand_eqtype_pat(pat.span, vt, local_ty, match_discrim_span);\n                 }\n \n                 if let Some(ref p) = *sub {\n-                    self.check_pat_walk(&p, expected, def_bm, true);\n+                    self.check_pat_walk(&p, expected, def_bm, match_discrim_span);\n                 }\n \n                 local_ty\n             }\n             PatKind::TupleStruct(ref qpath, ref subpats, ddpos) => {\n-                self.check_pat_tuple_struct(pat, qpath, &subpats, ddpos, expected, def_bm)\n+                self.check_pat_tuple_struct(\n+                    pat,\n+                    qpath,\n+                    &subpats,\n+                    ddpos,\n+                    expected,\n+                    def_bm,\n+                    match_discrim_span,\n+                )\n             }\n             PatKind::Path(ref qpath) => {\n                 self.check_pat_path(pat, qpath, expected)\n             }\n             PatKind::Struct(ref qpath, ref fields, etc) => {\n-                self.check_pat_struct(pat, qpath, fields, etc, expected, def_bm)\n+                self.check_pat_struct(pat, qpath, fields, etc, expected, def_bm, match_discrim_span)\n             }\n             PatKind::Tuple(ref elements, ddpos) => {\n                 let mut expected_len = elements.len();\n@@ -295,12 +302,12 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                     // further errors being emitted when using the bindings. #50333\n                     let element_tys_iter = (0..max_len).map(|_| tcx.types.err);\n                     for (_, elem) in elements.iter().enumerate_and_adjust(max_len, ddpos) {\n-                        self.check_pat_walk(elem, &tcx.types.err, def_bm, true);\n+                        self.check_pat_walk(elem, &tcx.types.err, def_bm, match_discrim_span);\n                     }\n                     tcx.mk_tup(element_tys_iter)\n                 } else {\n                     for (i, elem) in elements.iter().enumerate_and_adjust(max_len, ddpos) {\n-                        self.check_pat_walk(elem, &element_tys[i], def_bm, true);\n+                        self.check_pat_walk(elem, &element_tys[i], def_bm, match_discrim_span);\n                     }\n                     pat_ty\n                 }\n@@ -313,11 +320,11 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                     // Here, `demand::subtype` is good enough, but I don't\n                     // think any errors can be introduced by using\n                     // `demand::eqtype`.\n-                    self.demand_eqtype(pat.span, expected, uniq_ty);\n-                    self.check_pat_walk(&inner, inner_ty, def_bm, true);\n+                    self.demand_eqtype_pat(pat.span, expected, uniq_ty, match_discrim_span);\n+                    self.check_pat_walk(&inner, inner_ty, def_bm, match_discrim_span);\n                     uniq_ty\n                 } else {\n-                    self.check_pat_walk(&inner, tcx.types.err, def_bm, true);\n+                    self.check_pat_walk(&inner, tcx.types.err, def_bm, match_discrim_span);\n                     tcx.types.err\n                 }\n             }\n@@ -349,15 +356,13 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                             // Look for a case like `fn foo(&foo: u32)` and suggest\n                             // `fn foo(foo: &u32)`\n                             if let Some(mut err) = err {\n-                                if is_arg {\n-                                    if let PatKind::Binding(..) = inner.node {\n-                                        if let Ok(snippet) = tcx.sess.source_map()\n-                                                                     .span_to_snippet(pat.span)\n-                                        {\n-                                            err.help(&format!(\"did you mean `{}: &{}`?\",\n-                                                              &snippet[1..],\n-                                                              expected));\n-                                        }\n+                                if let PatKind::Binding(..) = inner.node {\n+                                    if let Ok(snippet) = tcx.sess.source_map()\n+                                                                    .span_to_snippet(pat.span)\n+                                    {\n+                                        err.help(&format!(\"did you mean `{}: &{}`?\",\n+                                                            &snippet[1..],\n+                                                            expected));\n                                     }\n                                 }\n                                 err.emit();\n@@ -366,10 +371,10 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                         }\n                     };\n \n-                    self.check_pat_walk(&inner, inner_ty, def_bm, true);\n+                    self.check_pat_walk(&inner, inner_ty, def_bm, match_discrim_span);\n                     rptr_ty\n                 } else {\n-                    self.check_pat_walk(&inner, tcx.types.err, def_bm, true);\n+                    self.check_pat_walk(&inner, tcx.types.err, def_bm, match_discrim_span);\n                     tcx.types.err\n                 }\n             }\n@@ -427,13 +432,13 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                 };\n \n                 for elt in before {\n-                    self.check_pat_walk(&elt, inner_ty, def_bm, true);\n+                    self.check_pat_walk(&elt, inner_ty, def_bm, match_discrim_span);\n                 }\n                 if let Some(ref slice) = *slice {\n-                    self.check_pat_walk(&slice, slice_ty, def_bm, true);\n+                    self.check_pat_walk(&slice, slice_ty, def_bm, match_discrim_span);\n                 }\n                 for elt in after {\n-                    self.check_pat_walk(&elt, inner_ty, def_bm, true);\n+                    self.check_pat_walk(&elt, inner_ty, def_bm, match_discrim_span);\n                 }\n                 expected_ty\n             }\n@@ -524,12 +529,14 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n         true\n     }\n \n-    pub fn check_match(&self,\n-                       expr: &'gcx hir::Expr,\n-                       discrim: &'gcx hir::Expr,\n-                       arms: &'gcx [hir::Arm],\n-                       expected: Expectation<'tcx>,\n-                       match_src: hir::MatchSource) -> Ty<'tcx> {\n+    pub fn check_match(\n+        &self,\n+        expr: &'gcx hir::Expr,\n+        discrim: &'gcx hir::Expr,\n+        arms: &'gcx [hir::Arm],\n+        expected: Expectation<'tcx>,\n+        match_src: hir::MatchSource,\n+    ) -> Ty<'tcx> {\n         let tcx = self.tcx;\n \n         // Not entirely obvious: if matches may create ref bindings, we want to\n@@ -624,8 +631,12 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n             let mut all_pats_diverge = Diverges::WarnedAlways;\n             for p in &arm.pats {\n                 self.diverges.set(Diverges::Maybe);\n-                self.check_pat_walk(&p, discrim_ty,\n-                    ty::BindingMode::BindByValue(hir::Mutability::MutImmutable), true);\n+                self.check_pat_walk(\n+                    &p,\n+                    discrim_ty,\n+                    ty::BindingMode::BindByValue(hir::Mutability::MutImmutable),\n+                    Some(discrim.span),\n+                );\n                 all_pats_diverge &= self.diverges.get();\n             }\n \n@@ -703,26 +714,29 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n         coercion.complete(self)\n     }\n \n-    fn check_pat_struct(&self,\n-                        pat: &'gcx hir::Pat,\n-                        qpath: &hir::QPath,\n-                        fields: &'gcx [Spanned<hir::FieldPat>],\n-                        etc: bool,\n-                        expected: Ty<'tcx>,\n-                        def_bm: ty::BindingMode) -> Ty<'tcx>\n+    fn check_pat_struct(\n+        &self,\n+        pat: &'gcx hir::Pat,\n+        qpath: &hir::QPath,\n+        fields: &'gcx [Spanned<hir::FieldPat>],\n+        etc: bool,\n+        expected: Ty<'tcx>,\n+        def_bm: ty::BindingMode,\n+        match_discrim_span: Option<Span>,\n+    ) -> Ty<'tcx>\n     {\n         // Resolve the path and check the definition for errors.\n         let (variant, pat_ty) = if let Some(variant_ty) = self.check_struct_path(qpath, pat.id) {\n             variant_ty\n         } else {\n             for field in fields {\n-                self.check_pat_walk(&field.node.pat, self.tcx.types.err, def_bm, true);\n+                self.check_pat_walk(&field.node.pat, self.tcx.types.err, def_bm, match_discrim_span);\n             }\n             return self.tcx.types.err;\n         };\n \n         // Type-check the path.\n-        self.demand_eqtype(pat.span, expected, pat_ty);\n+        self.demand_eqtype_pat(pat.span, expected, pat_ty, match_discrim_span);\n \n         // Type-check subpatterns.\n         if self.check_struct_pat_fields(pat_ty, pat.id, pat.span, variant, fields, etc, def_bm) {\n@@ -732,11 +746,12 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n         }\n     }\n \n-    fn check_pat_path(&self,\n-                      pat: &hir::Pat,\n-                      qpath: &hir::QPath,\n-                      expected: Ty<'tcx>) -> Ty<'tcx>\n-    {\n+    fn check_pat_path(\n+        &self,\n+        pat: &hir::Pat,\n+        qpath: &hir::QPath,\n+        expected: Ty<'tcx>,\n+    ) -> Ty<'tcx> {\n         let tcx = self.tcx;\n \n         // Resolve the path and check the definition for errors.\n@@ -767,18 +782,20 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n         pat_ty\n     }\n \n-    fn check_pat_tuple_struct(&self,\n-                              pat: &hir::Pat,\n-                              qpath: &hir::QPath,\n-                              subpats: &'gcx [P<hir::Pat>],\n-                              ddpos: Option<usize>,\n-                              expected: Ty<'tcx>,\n-                              def_bm: ty::BindingMode) -> Ty<'tcx>\n-    {\n+    fn check_pat_tuple_struct(\n+        &self,\n+        pat: &hir::Pat,\n+        qpath: &hir::QPath,\n+        subpats: &'gcx [P<hir::Pat>],\n+        ddpos: Option<usize>,\n+        expected: Ty<'tcx>,\n+        def_bm: ty::BindingMode,\n+        match_arm_pat_span: Option<Span>,\n+    ) -> Ty<'tcx> {\n         let tcx = self.tcx;\n         let on_error = || {\n             for pat in subpats {\n-                self.check_pat_walk(&pat, tcx.types.err, def_bm, true);\n+                self.check_pat_walk(&pat, tcx.types.err, def_bm, match_arm_pat_span);\n             }\n         };\n         let report_unexpected_def = |def: Def| {\n@@ -826,7 +843,7 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n         let pat_ty = pat_ty.fn_sig(tcx).output();\n         let pat_ty = pat_ty.no_bound_vars().expect(\"expected fn type\");\n \n-        self.demand_eqtype(pat.span, expected, pat_ty);\n+        self.demand_eqtype_pat(pat.span, expected, pat_ty, match_arm_pat_span);\n \n         // Type-check subpatterns.\n         if subpats.len() == variant.fields.len() ||\n@@ -837,7 +854,7 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n             };\n             for (i, subpat) in subpats.iter().enumerate_and_adjust(variant.fields.len(), ddpos) {\n                 let field_ty = self.field_ty(subpat.span, &variant.fields[i], substs);\n-                self.check_pat_walk(&subpat, field_ty, def_bm, true);\n+                self.check_pat_walk(&subpat, field_ty, def_bm, match_arm_pat_span);\n \n                 self.tcx.check_stability(variant.fields[i].did, Some(pat.id), subpat.span);\n             }\n@@ -917,7 +934,7 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n                 }\n             };\n \n-            self.check_pat_walk(&field.pat, field_ty, def_bm, true);\n+            self.check_pat_walk(&field.pat, field_ty, def_bm, None);\n         }\n         let mut unmentioned_fields = variant.fields\n                 .iter()"}, {"sha": "c0cedd77440d9898e47352a5fb717cc918a51512", "filename": "src/librustc_typeck/check/demand.rs", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,6 @@\n use check::FnCtxt;\n use rustc::infer::InferOk;\n-use rustc::traits::ObligationCause;\n+use rustc::traits::{ObligationCause, ObligationCauseCode};\n \n use syntax::ast;\n use syntax::util::parser::PREC_POSTFIX;\n@@ -66,6 +66,25 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         }\n     }\n \n+    pub fn demand_eqtype_pat(\n+        &self,\n+        cause_span: Span,\n+        expected: Ty<'tcx>,\n+        actual: Ty<'tcx>,\n+        match_expr_span: Option<Span>,\n+    ) {\n+        let cause = if let Some(span) = match_expr_span {\n+            self.cause(\n+                cause_span,\n+                ObligationCauseCode::MatchExpressionArmPattern { span, ty: expected },\n+            )\n+        } else {\n+            self.misc(cause_span)\n+        };\n+        self.demand_eqtype_with_origin(&cause, expected, actual).map(|mut err| err.emit());\n+    }\n+\n+\n     pub fn demand_coerce(&self,\n                          expr: &hir::Expr,\n                          checked_ty: Ty<'tcx>,"}, {"sha": "438deecbe77d3416abd9b9e1e85b797119939679", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1084,8 +1084,12 @@ fn check_fn<'a, 'gcx, 'tcx>(inherited: &'a Inherited<'a, 'gcx, 'tcx>,\n     // Add formal parameters.\n     for (arg_ty, arg) in fn_sig.inputs().iter().zip(&body.arguments) {\n         // Check the pattern.\n-        fcx.check_pat_walk(&arg.pat, arg_ty,\n-            ty::BindingMode::BindByValue(hir::Mutability::MutImmutable), true);\n+        fcx.check_pat_walk(\n+            &arg.pat,\n+            arg_ty,\n+            ty::BindingMode::BindByValue(hir::Mutability::MutImmutable),\n+            None,\n+        );\n \n         // Check that argument is Sized.\n         // The check for a non-trivial pattern is a hack to avoid duplicate warnings\n@@ -4723,9 +4727,12 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             }\n         }\n \n-        self.check_pat_walk(&local.pat, t,\n-                            ty::BindingMode::BindByValue(hir::Mutability::MutImmutable),\n-                            true);\n+        self.check_pat_walk(\n+            &local.pat,\n+            t,\n+            ty::BindingMode::BindByValue(hir::Mutability::MutImmutable),\n+            None,\n+        );\n         let pat_ty = self.node_ty(local.pat.hir_id);\n         if pat_ty.references_error() {\n             self.write_ty(local.hir_id, pat_ty);"}, {"sha": "545d4916cf7a53754fd2580bf289a06d340a33b2", "filename": "src/test/ui/block-result/issue-13624.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fblock-result%2Fissue-13624.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -12,6 +12,8 @@ LL |     Enum::EnumStructVariant { x: 1, y: 2, z: 3 }\n error[E0308]: mismatched types\n   --> $DIR/issue-13624.rs:22:9\n    |\n+LL |       match enum_struct_variant {\n+   |             ------------------- this match expression evaluates to `()`\n LL |         a::Enum::EnumStructVariant { x, y, z } => {\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected (), found enum `a::Enum`\n    |"}, {"sha": "7971f1d9eda447417e850ce4d683e33c1c43826a", "filename": "src/test/ui/error-codes/E0308-4.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Ferror-codes%2FE0308-4.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Ferror-codes%2FE0308-4.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0308-4.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/E0308-4.rs:4:9\n    |\n+LL |     match x {\n+   |           - this match expression evaluates to `u8`\n LL |         0u8..=3i8 => (), //~ ERROR E0308\n    |         ^^^^^^^^^ expected u8, found i8\n "}, {"sha": "4459b64aa8f06eb65e9404deb345b897483c7ce2", "filename": "src/test/ui/issues/issue-11844.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-11844.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-11844.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-11844.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-11844.rs:6:9\n    |\n+LL |     match a {\n+   |           - this match expression evaluates to `std::option::Option<std::boxed::Box<{integer}>>`\n LL |         Ok(a) => //~ ERROR: mismatched types\n    |         ^^^^^ expected enum `std::option::Option`, found enum `std::result::Result`\n    |"}, {"sha": "b299b3fb3e832cac52b08e0acbde299571b304bf", "filename": "src/test/ui/issues/issue-12552.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-12552.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-12552.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-12552.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-12552.rs:6:5\n    |\n+LL |   match t {\n+   |         - this match expression evaluates to `std::result::Result<_, {integer}>`\n LL |     Some(k) => match k { //~ ERROR mismatched types\n    |     ^^^^^^^ expected enum `std::result::Result`, found enum `std::option::Option`\n    |"}, {"sha": "8ba5114d143b099fe8f0a326920a29514989ae5b", "filename": "src/test/ui/issues/issue-13466.stderr", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-13466.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-13466.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-13466.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-13466.rs:8:9\n    |\n+LL |     let _x: usize = match Some(1) {\n+   |                           ------- this match expression evaluates to `std::option::Option<{integer}>`\n LL |         Ok(u) => u,\n    |         ^^^^^ expected enum `std::option::Option`, found enum `std::result::Result`\n    |\n@@ -10,6 +12,9 @@ LL |         Ok(u) => u,\n error[E0308]: mismatched types\n   --> $DIR/issue-13466.rs:14:9\n    |\n+LL |     let _x: usize = match Some(1) {\n+   |                           ------- this match expression evaluates to `std::option::Option<{integer}>`\n+...\n LL |         Err(e) => panic!(e)\n    |         ^^^^^^ expected enum `std::option::Option`, found enum `std::result::Result`\n    |"}, {"sha": "b88bfea7e85b564b12de31ded0def02f91f09070", "filename": "src/test/ui/issues/issue-15896.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-15896.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-15896.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-15896.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,9 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-15896.rs:11:11\n    |\n+LL |     let u = match e {\n+   |                   - this match expression evaluates to `main::R`\n+LL |         E::B(\n LL |           Tau{t: x},\n    |           ^^^^^^^^^ expected enum `main::R`, found struct `main::Tau`\n    |"}, {"sha": "ea5f89d18ddb2648cc8d8ebdd2846c259e5930f7", "filename": "src/test/ui/issues/issue-16401.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-16401.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-16401.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-16401.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-16401.rs:8:9\n    |\n+LL |     match () {\n+   |           -- this match expression evaluates to `()`\n LL |         Slice { data: data, len: len } => (),\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected (), found struct `Slice`\n    |"}, {"sha": "82b6462d3b4b06422a03182a69c013dc02c0b342", "filename": "src/test/ui/issues/issue-3680.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-3680.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-3680.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-3680.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-3680.rs:3:9\n    |\n+LL |     match None {\n+   |           ---- this match expression evaluates to `std::option::Option<_>`\n LL |         Err(_) => ()\n    |         ^^^^^^ expected enum `std::option::Option`, found enum `std::result::Result`\n    |"}, {"sha": "d3072143c1555b6d2c67c321e44b285e00e6497d", "filename": "src/test/ui/issues/issue-5100.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-5100.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-5100.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-5100.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -28,6 +28,8 @@ LL |         (true, false, false) => ()\n error[E0308]: mismatched types\n   --> $DIR/issue-5100.rs:33:9\n    |\n+LL |     match (true, false) {\n+   |           ------------- this match expression evaluates to `(bool, bool)`\n LL |         box (true, false) => ()\n    |         ^^^^^^^^^^^^^^^^^ expected tuple, found struct `std::boxed::Box`\n    |"}, {"sha": "bdd70ebac94b83d8c19bad01054d7d507a14d8e1", "filename": "src/test/ui/issues/issue-5358-1.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-5358-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-5358-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-5358-1.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-5358-1.rs:6:9\n    |\n+LL |     match S(Either::Left(5)) {\n+   |           ------------------ this match expression evaluates to `S`\n LL |         Either::Right(_) => {}\n    |         ^^^^^^^^^^^^^^^^ expected struct `S`, found enum `Either`\n    |"}, {"sha": "61564f9004eb57681aa7a5932cfee17b825d2067", "filename": "src/test/ui/issues/issue-7092.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-7092.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fissues%2Fissue-7092.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-7092.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/issue-7092.rs:6:9\n    |\n+LL |     match x {\n+   |           - this match expression evaluates to `Whatever`\n LL |         Some(field) =>\n    |         ^^^^^^^^^^^ expected enum `Whatever`, found enum `std::option::Option`\n    |"}, {"sha": "db7afc36bd7b09d051e6faedc5eff0dae7959f91", "filename": "src/test/ui/match/match-range-fail.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmatch%2Fmatch-range-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmatch%2Fmatch-range-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fmatch-range-fail.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -19,6 +19,8 @@ LL |         10 ..= \"what\" => ()\n error[E0308]: mismatched types\n   --> $DIR/match-range-fail.rs:17:9\n    |\n+LL |     match 5 {\n+   |           - this match expression evaluates to `{integer}`\n LL |         'c' ..= 100 => { }\n    |         ^^^^^^^^^^^ expected integer, found char\n    |"}, {"sha": "8e9d09288b1dbee85a3ab743d7fe5ebeff4f24e2", "filename": "src/test/ui/match/match-struct.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmatch%2Fmatch-struct.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmatch%2Fmatch-struct.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fmatch-struct.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/match-struct.rs:6:9\n    |\n+LL |     match (S { a: 1 }) {\n+   |           ------------ this match expression evaluates to `S`\n LL |         E::C(_) => (),\n    |         ^^^^^^^ expected struct `S`, found enum `E`\n    |"}, {"sha": "f5e7051a9e8207652cb1ecdd95b86025bab28243", "filename": "src/test/ui/match/match-tag-unary.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmatch%2Fmatch-tag-unary.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmatch%2Fmatch-tag-unary.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fmatch-tag-unary.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -2,7 +2,9 @@ error[E0308]: mismatched types\n   --> $DIR/match-tag-unary.rs:4:43\n    |\n LL | fn main() { let x: A = A::A(0); match x { B::B(y) => { } } } //~ ERROR mismatched types\n-   |                                           ^^^^^^^ expected enum `A`, found enum `B`\n+   |                                       -   ^^^^^^^ expected enum `A`, found enum `B`\n+   |                                       |\n+   |                                       this match expression evaluates to `A`\n    |\n    = note: expected type `A`\n               found type `B`"}, {"sha": "4df2984a6dcc6ad02ec6e8c0280e4eb86e0b3149", "filename": "src/test/ui/mismatched_types/E0409.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmismatched_types%2FE0409.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fmismatched_types%2FE0409.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2FE0409.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -9,6 +9,8 @@ LL |         (0, ref y) | (y, 0) => {} //~ ERROR E0409\n error[E0308]: mismatched types\n   --> $DIR/E0409.rs:5:23\n    |\n+LL |     match x {\n+   |           - this match expression evaluates to `_`\n LL |         (0, ref y) | (y, 0) => {} //~ ERROR E0409\n    |                       ^ expected &{integer}, found integer\n    |"}, {"sha": "49f68c7f0682a9e03f77e892a67bffd51fe0997d", "filename": "src/test/ui/or-pattern-mismatch.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2For-pattern-mismatch.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2For-pattern-mismatch.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2For-pattern-mismatch.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -2,7 +2,9 @@ error[E0308]: mismatched types\n   --> $DIR/or-pattern-mismatch.rs:3:68\n    |\n LL | fn main() { match Blah::A(1, 1, 2) { Blah::A(_, x, y) | Blah::B(x, y) => { } } }\n-   |                                                                    ^ expected usize, found isize\n+   |                   ----------------                                 ^ expected usize, found isize\n+   |                   |\n+   |                   this match expression evaluates to `_`\n    |\n    = note: expected type `usize`\n               found type `isize`"}, {"sha": "318067cbb50bfc6baaf5a144ccbd8aa74f7d14f7", "filename": "src/test/ui/pattern/pattern-error-continue.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fpattern%2Fpattern-error-continue.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fpattern%2Fpattern-error-continue.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fpattern-error-continue.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -21,6 +21,8 @@ LL |         A::B(_, _, _) => (), //~ ERROR this pattern has 3 fields, but\n error[E0308]: mismatched types\n   --> $DIR/pattern-error-continue.rs:22:9\n    |\n+LL |     match 'c' {\n+   |           --- this match expression evaluates to `char`\n LL |         S { .. } => (),\n    |         ^^^^^^^^ expected char, found struct `S`\n    |"}, {"sha": "cb9058a30da437da01095e767664c7c676d62740", "filename": "src/test/ui/pattern/pattern-tyvar.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fpattern%2Fpattern-tyvar.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fpattern%2Fpattern-tyvar.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fpattern-tyvar.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -1,6 +1,8 @@\n error[E0308]: mismatched types\n   --> $DIR/pattern-tyvar.rs:5:18\n    |\n+LL |     match t {\n+   |           - this match expression evaluates to `std::option::Option<std::vec::Vec<isize>>`\n LL |       Bar::T1(_, Some::<isize>(x)) => { //~ ERROR mismatched types\n    |                  ^^^^^^^^^^^^^^^^ expected struct `std::vec::Vec`, found isize\n    |"}, {"sha": "69b151c733bf314c156c9ff9f018933cd63db9c3", "filename": "src/test/ui/resolve/resolve-inconsistent-binding-mode.stderr", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fresolve%2Fresolve-inconsistent-binding-mode.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fresolve%2Fresolve-inconsistent-binding-mode.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fresolve-inconsistent-binding-mode.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -23,6 +23,8 @@ LL |       Opts::A(ref mut i) | Opts::B(ref i) => {}\n error[E0308]: mismatched types\n   --> $DIR/resolve-inconsistent-binding-mode.rs:7:32\n    |\n+LL |     match x {\n+   |           - this match expression evaluates to `_`\n LL |       Opts::A(ref i) | Opts::B(i) => {}\n    |                                ^ expected &isize, found isize\n    |\n@@ -32,6 +34,8 @@ LL |       Opts::A(ref i) | Opts::B(i) => {}\n error[E0308]: mismatched types\n   --> $DIR/resolve-inconsistent-binding-mode.rs:16:32\n    |\n+LL |     match x {\n+   |           - this match expression evaluates to `_`\n LL |       Opts::A(ref i) | Opts::B(i) => {}\n    |                                ^ expected &isize, found isize\n    |\n@@ -41,6 +45,8 @@ LL |       Opts::A(ref i) | Opts::B(i) => {}\n error[E0308]: mismatched types\n   --> $DIR/resolve-inconsistent-binding-mode.rs:25:36\n    |\n+LL |     match x {\n+   |           - this match expression evaluates to `_`\n LL |       Opts::A(ref mut i) | Opts::B(ref i) => {}\n    |                                    ^^^^^ types differ in mutability\n    |"}, {"sha": "564e3551065dfc8ecdb7f40f48005c7bc04e8fc2", "filename": "src/test/ui/structs/structure-constructor-type-mismatch.stderr", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fstructs%2Fstructure-constructor-type-mismatch.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a873337f2100ffa341f1a03e316ded6bfa2e95f7/src%2Ftest%2Fui%2Fstructs%2Fstructure-constructor-type-mismatch.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstructs%2Fstructure-constructor-type-mismatch.stderr?ref=a873337f2100ffa341f1a03e316ded6bfa2e95f7", "patch": "@@ -109,6 +109,8 @@ LL |         PointF::<u32> { .. } => {} //~ ERROR wrong number of type arguments\n error[E0308]: mismatched types\n   --> $DIR/structure-constructor-type-mismatch.rs:54:9\n    |\n+LL |     match (Point { x: 1, y: 2 }) {\n+   |           ---------------------- this match expression evaluates to `Point<{integer}>`\n LL |         PointF::<u32> { .. } => {} //~ ERROR wrong number of type arguments\n    |         ^^^^^^^^^^^^^^^^^^^^ expected integer, found f32\n    |\n@@ -118,6 +120,8 @@ LL |         PointF::<u32> { .. } => {} //~ ERROR wrong number of type arguments\n error[E0308]: mismatched types\n   --> $DIR/structure-constructor-type-mismatch.rs:59:9\n    |\n+LL |     match (Point { x: 1, y: 2 }) {\n+   |           ---------------------- this match expression evaluates to `Point<{integer}>`\n LL |         PointF { .. } => {} //~ ERROR mismatched types\n    |         ^^^^^^^^^^^^^ expected integer, found f32\n    |\n@@ -127,6 +131,8 @@ LL |         PointF { .. } => {} //~ ERROR mismatched types\n error[E0308]: mismatched types\n   --> $DIR/structure-constructor-type-mismatch.rs:67:9\n    |\n+LL |     match (Pair { x: 1, y: 2 }) {\n+   |           --------------------- this match expression evaluates to `Pair<{integer}, {integer}>`\n LL |         PairF::<u32> { .. } => {} //~ ERROR mismatched types\n    |         ^^^^^^^^^^^^^^^^^^^ expected integer, found f32\n    |"}]}