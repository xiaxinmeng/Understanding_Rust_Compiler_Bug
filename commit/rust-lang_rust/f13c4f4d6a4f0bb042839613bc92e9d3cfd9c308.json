{"sha": "f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "node_id": "C_kwDOAAsO6NoAKGYxM2M0ZjRkNmE0ZjBiYjA0MjgzOTYxM2JjOTJlOWQzY2ZkOWMzMDg", "commit": {"author": {"name": "Lukas Markeffsky", "email": "@", "date": "2022-10-07T18:57:34Z"}, "committer": {"name": "Lukas Markeffsky", "email": "@", "date": "2022-11-19T15:36:08Z"}, "message": "constify `exact_div` intrinsic", "tree": {"sha": "cbf35188b951b35e95f32f4843f7e17f4c3c1c3b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cbf35188b951b35e95f32f4843f7e17f4c3c1c3b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "html_url": "https://github.com/rust-lang/rust/commit/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/comments", "author": null, "committer": null, "parents": [{"sha": "5e6de2369c82ed0b36e6b651b041bad5cb5e1ef8", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e6de2369c82ed0b36e6b651b041bad5cb5e1ef8", "html_url": "https://github.com/rust-lang/rust/commit/5e6de2369c82ed0b36e6b651b041bad5cb5e1ef8"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "7940efcd2b11f1517a22631f0d5a4d77616ece7d", "filename": "compiler/rustc_const_eval/src/interpret/intrinsics.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs?ref=f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "patch": "@@ -243,6 +243,11 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                 let discr_val = self.read_discriminant(&place.into())?.0;\n                 self.write_scalar(discr_val, dest)?;\n             }\n+            sym::exact_div => {\n+                let l = self.read_immediate(&args[0])?;\n+                let r = self.read_immediate(&args[1])?;\n+                self.exact_div(&l, &r, dest)?;\n+            }\n             sym::unchecked_shl\n             | sym::unchecked_shr\n             | sym::unchecked_add"}, {"sha": "7ed7d767f2fb5b42955ac6c80cccaba8e9003885", "filename": "library/core/src/intrinsics.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/library%2Fcore%2Fsrc%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/library%2Fcore%2Fsrc%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fintrinsics.rs?ref=f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "patch": "@@ -1851,6 +1851,7 @@ extern \"rust-intrinsic\" {\n     /// `x % y != 0` or `y == 0` or `x == T::MIN && y == -1`\n     ///\n     /// This intrinsic does not have a stable counterpart.\n+    #[rustc_const_unstable(feature = \"const_exact_div\", issue = \"none\")]\n     pub fn exact_div<T: Copy>(x: T, y: T) -> T;\n \n     /// Performs an unchecked division, resulting in undefined behavior"}, {"sha": "33b969c249a2f540236cd3b8cc8bc8b1efe09f5a", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "patch": "@@ -109,6 +109,7 @@\n #![feature(const_cmp)]\n #![feature(const_discriminant)]\n #![feature(const_eval_select)]\n+#![feature(const_exact_div)]\n #![feature(const_float_bits_conv)]\n #![feature(const_float_classify)]\n #![feature(const_fmt_arguments_new)]"}, {"sha": "5ea82adb9c69c762d48e492010958647c85dae10", "filename": "src/tools/miri/src/shims/intrinsics/mod.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/src%2Ftools%2Fmiri%2Fsrc%2Fshims%2Fintrinsics%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308/src%2Ftools%2Fmiri%2Fsrc%2Fshims%2Fintrinsics%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fsrc%2Fshims%2Fintrinsics%2Fmod.rs?ref=f13c4f4d6a4f0bb042839613bc92e9d3cfd9c308", "patch": "@@ -368,11 +368,6 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriInterpCxExt<'mir, 'tcx> {\n             }\n \n             // Other\n-            \"exact_div\" => {\n-                let [num, denom] = check_arg_count(args)?;\n-                this.exact_div(&this.read_immediate(num)?, &this.read_immediate(denom)?, dest)?;\n-            }\n-\n             \"breakpoint\" => {\n                 let [] = check_arg_count(args)?;\n                 // normally this would raise a SIGTRAP, which aborts if no debugger is connected"}]}