{"sha": "2f287d6a3e200197919e5372ac74abb66ce038ad", "node_id": "C_kwDOAAsO6NoAKDJmMjg3ZDZhM2UyMDAxOTc5MTllNTM3MmFjNzRhYmI2NmNlMDM4YWQ", "commit": {"author": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-04-28T02:47:58Z"}, "committer": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-04-28T02:47:58Z"}, "message": "Make it possible to write doctests for bootstrap\n\nThis probably isn't super useful in practice, but it was easy to fix\nand avoids confusing errors about mismatched versions between beta and the default toolchain.", "tree": {"sha": "c77bf5162c8c73ca04abaf5a13bba9432d21c946", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c77bf5162c8c73ca04abaf5a13bba9432d21c946"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f287d6a3e200197919e5372ac74abb66ce038ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f287d6a3e200197919e5372ac74abb66ce038ad", "html_url": "https://github.com/rust-lang/rust/commit/2f287d6a3e200197919e5372ac74abb66ce038ad", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f287d6a3e200197919e5372ac74abb66ce038ad/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18f314e7027fe7084aaab8620c624a0d7bd29e70", "url": "https://api.github.com/repos/rust-lang/rust/commits/18f314e7027fe7084aaab8620c624a0d7bd29e70", "html_url": "https://github.com/rust-lang/rust/commit/18f314e7027fe7084aaab8620c624a0d7bd29e70"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "af84a8007219ba90950bd732f12d0c6cc1fe9fc7", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2f287d6a3e200197919e5372ac74abb66ce038ad/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f287d6a3e200197919e5372ac74abb66ce038ad/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=2f287d6a3e200197919e5372ac74abb66ce038ad", "patch": "@@ -2362,6 +2362,7 @@ impl Step for Bootstrap {\n             .env(\"RUSTFLAGS\", \"-Cdebuginfo=2\")\n             .env(\"CARGO_TARGET_DIR\", builder.out.join(\"bootstrap\"))\n             .env(\"RUSTC_BOOTSTRAP\", \"1\")\n+            .env(\"RUSTDOC\", builder.rustdoc(builder.compiler(0, builder.build.build)))\n             .env(\"RUSTC\", &builder.initial_rustc);\n         if let Some(flags) = option_env!(\"RUSTFLAGS\") {\n             // Use the same rustc flags for testing as for \"normal\" compilation,\n@@ -2372,6 +2373,16 @@ impl Step for Bootstrap {\n         if !builder.fail_fast {\n             cmd.arg(\"--no-fail-fast\");\n         }\n+        match builder.doc_tests {\n+            DocTests::Only => {\n+                cmd.arg(\"--doc\");\n+            }\n+            DocTests::No => {\n+                cmd.args(&[\"--lib\", \"--bins\", \"--examples\", \"--tests\", \"--benches\"]);\n+            }\n+            DocTests::Yes => {}\n+        }\n+\n         cmd.arg(\"--\").args(&builder.config.cmd.test_args());\n         // rustbuild tests are racy on directory creation so just run them one at a time.\n         // Since there's not many this shouldn't be a problem."}]}