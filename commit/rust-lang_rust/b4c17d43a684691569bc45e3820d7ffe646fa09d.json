{"sha": "b4c17d43a684691569bc45e3820d7ffe646fa09d", "node_id": "C_kwDOAAsO6NoAKGI0YzE3ZDQzYTY4NDY5MTU2OWJjNDVlMzgyMGQ3ZmZlNjQ2ZmEwOWQ", "commit": {"author": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2022-05-22T15:37:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-22T15:37:42Z"}, "message": "Rollup merge of #97277 - jyn514:no-unstable-for-bootstrap, r=Mark-Simulacrum\n\nAvoid accidentally enabling unstable features in compilers (take 2)\n\nThis allows rustbuild to control whether crates can use nightly features or not.\nIt also prevents rustbuild from using nightly features itself.\n\nThis is #92261, but I fixed the CI error.", "tree": {"sha": "bc62f2ec8743799b095328ad9df2a6c1b225e733", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc62f2ec8743799b095328ad9df2a6c1b225e733"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b4c17d43a684691569bc45e3820d7ffe646fa09d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiiljHCRBK7hj4Ov3rIwAAz00IAHQ4gVtlTj+Cll1SxKucDPOJ\nv6AfF8oG4eSg+GxFSZT1g2Q3lW0mN4VIWOUQkMeFfc174YKVFZsND9dqi7pt6grd\nsO2PD9//2nsWEjTZ35kIBr60l0MbzvBx1B3YIv7ecgdfPelKY6nz8+IS1p7iBs1B\nvV6Uf4PRv3YmTAHGkAFTmSw3tEoqlqPTi3vYfaIDlYuiGVibGL8dLiCRLds0XZFI\nmY0nYE/StZqcA/wxvNtwlcpmRjsMla51u6souNbTGO+wmJS9/m/33RPuhS1h2sF+\nTh7c0Gw6sxqVwG6u5RCQDYyt1ataSi8twChYrS6zkp+FI2XC4kCIk0FrSOTJK6g=\n=9Bs4\n-----END PGP SIGNATURE-----\n", "payload": "tree bc62f2ec8743799b095328ad9df2a6c1b225e733\nparent c370e303ae416a64afba663417bd9f999a229a95\nparent 751ad4a0e9fc43a9e810cce69d4cef581323e79a\nauthor Jack Huey <31162821+jackh726@users.noreply.github.com> 1653233862 -0400\ncommitter GitHub <noreply@github.com> 1653233862 -0400\n\nRollup merge of #97277 - jyn514:no-unstable-for-bootstrap, r=Mark-Simulacrum\n\nAvoid accidentally enabling unstable features in compilers (take 2)\n\nThis allows rustbuild to control whether crates can use nightly features or not.\nIt also prevents rustbuild from using nightly features itself.\n\nThis is #92261, but I fixed the CI error.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b4c17d43a684691569bc45e3820d7ffe646fa09d", "html_url": "https://github.com/rust-lang/rust/commit/b4c17d43a684691569bc45e3820d7ffe646fa09d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b4c17d43a684691569bc45e3820d7ffe646fa09d/comments", "author": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c370e303ae416a64afba663417bd9f999a229a95", "url": "https://api.github.com/repos/rust-lang/rust/commits/c370e303ae416a64afba663417bd9f999a229a95", "html_url": "https://github.com/rust-lang/rust/commit/c370e303ae416a64afba663417bd9f999a229a95"}, {"sha": "751ad4a0e9fc43a9e810cce69d4cef581323e79a", "url": "https://api.github.com/repos/rust-lang/rust/commits/751ad4a0e9fc43a9e810cce69d4cef581323e79a", "html_url": "https://github.com/rust-lang/rust/commit/751ad4a0e9fc43a9e810cce69d4cef581323e79a"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "6d46ea26e6a0b3e046632c8a2fe22b81a08b6752", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b4c17d43a684691569bc45e3820d7ffe646fa09d/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/b4c17d43a684691569bc45e3820d7ffe646fa09d/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=b4c17d43a684691569bc45e3820d7ffe646fa09d", "patch": "@@ -1192,7 +1192,6 @@ def bootstrap(help_triggered):\n     env = os.environ.copy()\n     env[\"BOOTSTRAP_PARENT_ID\"] = str(os.getpid())\n     env[\"BOOTSTRAP_PYTHON\"] = sys.executable\n-    env[\"RUSTC_BOOTSTRAP\"] = '1'\n     if build.rustc_commit is not None:\n         env[\"BOOTSTRAP_DOWNLOAD_RUSTC\"] = '1'\n     run(args, env=env, verbose=build.verbose, is_bootstrap=True)"}, {"sha": "761bd66b5057bb931ee1b0ac9d131a8da2855cb8", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b4c17d43a684691569bc45e3820d7ffe646fa09d/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b4c17d43a684691569bc45e3820d7ffe646fa09d/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=b4c17d43a684691569bc45e3820d7ffe646fa09d", "patch": "@@ -1226,6 +1226,14 @@ impl<'a> Builder<'a> {\n         // this), as well as #63012 which is the tracking issue for this\n         // feature on the rustc side.\n         cargo.arg(\"-Zbinary-dep-depinfo\");\n+        match mode {\n+            Mode::ToolBootstrap => {\n+                // Restrict the allowed features to those passed by rustbuild, so we don't depend on nightly accidentally.\n+                // HACK: because anyhow does feature detection in build.rs, we need to allow the backtrace feature too.\n+                rustflags.arg(\"-Zallow-features=binary-dep-depinfo,backtrace\");\n+            }\n+            Mode::Std | Mode::Rustc | Mode::ToolStd | Mode::Codegen | Mode::ToolRustc => {}\n+        }\n \n         cargo.arg(\"-j\").arg(self.jobs().to_string());\n         // Remove make-related flags to ensure Cargo can correctly set things up"}, {"sha": "be6655ddb61d0883bbe5396f99b89a5b424d8d30", "filename": "src/bootstrap/doc.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b4c17d43a684691569bc45e3820d7ffe646fa09d/src%2Fbootstrap%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b4c17d43a684691569bc45e3820d7ffe646fa09d/src%2Fbootstrap%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdoc.rs?ref=b4c17d43a684691569bc45e3820d7ffe646fa09d", "patch": "@@ -881,6 +881,10 @@ impl Step for RustcBook {\n         if self.validate {\n             cmd.arg(\"--validate\");\n         }\n+        if !builder.unstable_features() {\n+            // We need to validate nightly features, even on the stable channel.\n+            cmd.env(\"RUSTC_BOOTSTRAP\", \"1\");\n+        }\n         // If the lib directories are in an unusual location (changed in\n         // config.toml), then this needs to explicitly update the dylib search\n         // path."}]}