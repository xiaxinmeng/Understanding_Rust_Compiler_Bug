{"sha": "1bec8b606540813cc068c5b564aa2dbd3d212823", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiZWM4YjYwNjU0MDgxM2NjMDY4YzViNTY0YWEyZGJkM2QyMTI4MjM=", "commit": {"author": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2021-03-13T09:16:38Z"}, "committer": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2021-03-17T15:51:16Z"}, "message": "use derefs_to_slice in methods/utils.rs", "tree": {"sha": "0b7a1ce792ddd1e6e3052443d8a890c8b44fce13", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b7a1ce792ddd1e6e3052443d8a890c8b44fce13"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1bec8b606540813cc068c5b564aa2dbd3d212823", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1bec8b606540813cc068c5b564aa2dbd3d212823", "html_url": "https://github.com/rust-lang/rust/commit/1bec8b606540813cc068c5b564aa2dbd3d212823", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1bec8b606540813cc068c5b564aa2dbd3d212823/comments", "author": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e578a536c703cd799b74f261e345121bd889be45", "url": "https://api.github.com/repos/rust-lang/rust/commits/e578a536c703cd799b74f261e345121bd889be45", "html_url": "https://github.com/rust-lang/rust/commit/e578a536c703cd799b74f261e345121bd889be45"}], "stats": {"total": 52, "additions": 6, "deletions": 46}, "files": [{"sha": "b3a9743c61475d6ddba26d563bfae6dbbcffa291", "filename": "clippy_lints/src/methods/get_unwrap.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fget_unwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fget_unwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fget_unwrap.rs?ref=1bec8b606540813cc068c5b564aa2dbd3d212823", "patch": "@@ -1,4 +1,4 @@\n-use crate::methods::derefs_to_slice;\n+use super::utils::derefs_to_slice;\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::source::snippet_with_applicability;\n use clippy_utils::ty::{is_type_diagnostic_item, match_type};"}, {"sha": "848f47e39f6b48e1ae8e4eda297506f21f98aa96", "filename": "clippy_lints/src/methods/iter_cloned_collect.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_cloned_collect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_cloned_collect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fiter_cloned_collect.rs?ref=1bec8b606540813cc068c5b564aa2dbd3d212823", "patch": "@@ -1,4 +1,4 @@\n-use crate::methods::derefs_to_slice;\n+use crate::methods::utils::derefs_to_slice;\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::ty::is_type_diagnostic_item;\n use if_chain::if_chain;"}, {"sha": "e394a8fe8195e6da741e818843ac79ae3653de09", "filename": "clippy_lints/src/methods/iter_count.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_count.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_count.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fiter_count.rs?ref=1bec8b606540813cc068c5b564aa2dbd3d212823", "patch": "@@ -1,4 +1,4 @@\n-use crate::methods::derefs_to_slice;\n+use super::utils::derefs_to_slice;\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::paths;\n use clippy_utils::source::snippet_with_applicability;"}, {"sha": "869b2cdd1a664b1588c6abc063d0ea01d9509d6f", "filename": "clippy_lints/src/methods/iter_next_slice.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_next_slice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_next_slice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fiter_next_slice.rs?ref=1bec8b606540813cc068c5b564aa2dbd3d212823", "patch": "@@ -1,4 +1,4 @@\n-use crate::methods::derefs_to_slice;\n+use crate::methods::utils::derefs_to_slice;\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::source::snippet_with_applicability;\n use clippy_utils::ty::is_type_diagnostic_item;"}, {"sha": "2e7220025f818a465052540f54470650cfa72a2f", "filename": "clippy_lints/src/methods/iter_nth.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_nth.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fiter_nth.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fiter_nth.rs?ref=1bec8b606540813cc068c5b564aa2dbd3d212823", "patch": "@@ -1,7 +1,7 @@\n-use crate::methods::derefs_to_slice;\n use crate::methods::iter_nth_zero;\n use clippy_utils::diagnostics::span_lint_and_help;\n use clippy_utils::ty::is_type_diagnostic_item;\n+use crate::methods::utils::derefs_to_slice;\n use rustc_hir as hir;\n use rustc_lint::LateContext;\n use rustc_span::symbol::sym;"}, {"sha": "e16ab4bc20bb041ac2ea1a3fc4d61a5a0e0d39ec", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 1, "deletions": 41, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bec8b606540813cc068c5b564aa2dbd3d212823/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=1bec8b606540813cc068c5b564aa2dbd3d212823", "patch": "@@ -53,6 +53,7 @@ mod unnecessary_fold;\n mod unnecessary_lazy_eval;\n mod unwrap_used;\n mod useless_asref;\n+mod utils;\n mod wrong_self_convention;\n mod zst_offset;\n \n@@ -1976,47 +1977,6 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n \n     extract_msrv_attr!(LateContext);\n }\n-\n-fn derefs_to_slice<'tcx>(\n-    cx: &LateContext<'tcx>,\n-    expr: &'tcx hir::Expr<'tcx>,\n-    ty: Ty<'tcx>,\n-) -> Option<&'tcx hir::Expr<'tcx>> {\n-    fn may_slice<'a>(cx: &LateContext<'a>, ty: Ty<'a>) -> bool {\n-        match ty.kind() {\n-            ty::Slice(_) => true,\n-            ty::Adt(def, _) if def.is_box() => may_slice(cx, ty.boxed_ty()),\n-            ty::Adt(..) => is_type_diagnostic_item(cx, ty, sym::vec_type),\n-            ty::Array(_, size) => size\n-                .try_eval_usize(cx.tcx, cx.param_env)\n-                .map_or(false, |size| size < 32),\n-            ty::Ref(_, inner, _) => may_slice(cx, inner),\n-            _ => false,\n-        }\n-    }\n-\n-    if let hir::ExprKind::MethodCall(ref path, _, ref args, _) = expr.kind {\n-        if path.ident.name == sym::iter && may_slice(cx, cx.typeck_results().expr_ty(&args[0])) {\n-            Some(&args[0])\n-        } else {\n-            None\n-        }\n-    } else {\n-        match ty.kind() {\n-            ty::Slice(_) => Some(expr),\n-            ty::Adt(def, _) if def.is_box() && may_slice(cx, ty.boxed_ty()) => Some(expr),\n-            ty::Ref(_, inner, _) => {\n-                if may_slice(cx, inner) {\n-                    Some(expr)\n-                } else {\n-                    None\n-                }\n-            },\n-            _ => None,\n-        }\n-    }\n-}\n-\n /// Used for `lint_binary_expr_with_method_call`.\n #[derive(Copy, Clone)]\n struct BinaryExprInfo<'a> {"}]}