{"sha": "54978a571c78856df200f842683069efcbe10074", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0OTc4YTU3MWM3ODg1NmRmMjAwZjg0MjY4MzA2OWVmY2JlMTAwNzQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-21T11:47:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-21T11:47:06Z"}, "message": "Auto merge of #3680 - g-bartoszek:needless-bool-else-if-brackets, r=oli-obk\n\nneedless bool lint suggestion is wrapped in brackets if it is an \"els\u2026\n\n\u2026e\" clause of an \"if-else\" statement", "tree": {"sha": "7b549f71e279b2aee2c9756a17bb56046949538d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7b549f71e279b2aee2c9756a17bb56046949538d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54978a571c78856df200f842683069efcbe10074", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54978a571c78856df200f842683069efcbe10074", "html_url": "https://github.com/rust-lang/rust/commit/54978a571c78856df200f842683069efcbe10074", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54978a571c78856df200f842683069efcbe10074/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1838bfe5a9ff951ffd716e4632156113d95d14a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/1838bfe5a9ff951ffd716e4632156113d95d14a4", "html_url": "https://github.com/rust-lang/rust/commit/1838bfe5a9ff951ffd716e4632156113d95d14a4"}, {"sha": "34785a12f46c0bd57ed98f9702d2030940756e78", "url": "https://api.github.com/repos/rust-lang/rust/commits/34785a12f46c0bd57ed98f9702d2030940756e78", "html_url": "https://github.com/rust-lang/rust/commit/34785a12f46c0bd57ed98f9702d2030940756e78"}], "stats": {"total": 45, "additions": 43, "deletions": 2}, "files": [{"sha": "a898a740cd814dac3313604b7fd4ca489d9b6c5b", "filename": "clippy_lints/src/needless_bool.rs", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/54978a571c78856df200f842683069efcbe10074/clippy_lints%2Fsrc%2Fneedless_bool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54978a571c78856df200f842683069efcbe10074/clippy_lints%2Fsrc%2Fneedless_bool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_bool.rs?ref=54978a571c78856df200f842683069efcbe10074", "patch": "@@ -72,12 +72,16 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessBool {\n                 let snip = Sugg::hir_with_applicability(cx, pred, \"<predicate>\", &mut applicability);\n                 let snip = if not { !snip } else { snip };\n \n-                let hint = if ret {\n+                let mut hint = if ret {\n                     format!(\"return {}\", snip)\n                 } else {\n                     snip.to_string()\n                 };\n \n+                if parent_node_is_if_expr(&e, &cx) {\n+                    hint = format!(\"{{ {} }}\", hint);\n+                }\n+\n                 span_lint_and_sugg(\n                     cx,\n                     NEEDLESS_BOOL,\n@@ -119,6 +123,19 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessBool {\n     }\n }\n \n+fn parent_node_is_if_expr<'a, 'b>(expr: &Expr, cx: &LateContext<'a, 'b>) -> bool {\n+    let parent_id = cx.tcx.hir().get_parent_node(expr.id);\n+    let parent_node = cx.tcx.hir().get(parent_id);\n+\n+    if let rustc::hir::Node::Expr(e) = parent_node {\n+        if let ExprKind::If(_, _, _) = e.node {\n+            return true;\n+        }\n+    }\n+\n+    false\n+}\n+\n #[derive(Copy, Clone)]\n pub struct BoolComparison;\n "}, {"sha": "75705525790191c551f88cb7591b992aaa26a3e5", "filename": "tests/ui/needless_bool.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/54978a571c78856df200f842683069efcbe10074/tests%2Fui%2Fneedless_bool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54978a571c78856df200f842683069efcbe10074/tests%2Fui%2Fneedless_bool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_bool.rs?ref=54978a571c78856df200f842683069efcbe10074", "patch": "@@ -141,3 +141,16 @@ fn needless_bool3(x: bool) {\n     if x == true {};\n     if x == false {};\n }\n+\n+fn needless_bool_in_the_suggestion_wraps_the_predicate_of_if_else_statement_in_brackets() {\n+    let b = false;\n+    let returns_bool = || false;\n+\n+    let x = if b {\n+        true\n+    } else if returns_bool() {\n+        false\n+    } else {\n+        true\n+    };\n+}"}, {"sha": "46734ea07a50ac24208b57432a3ed0bfbdb4f686", "filename": "tests/ui/needless_bool.stderr", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/54978a571c78856df200f842683069efcbe10074/tests%2Fui%2Fneedless_bool.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/54978a571c78856df200f842683069efcbe10074/tests%2Fui%2Fneedless_bool.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_bool.stderr?ref=54978a571c78856df200f842683069efcbe10074", "patch": "@@ -136,5 +136,16 @@ error: equality checks against false can be replaced by a negation\n LL |     if x == false {};\n    |        ^^^^^^^^^^ help: try simplifying it as shown: `!x`\n \n-error: aborting due to 15 previous errors\n+error: this if-then-else expression returns a bool literal\n+  --> $DIR/needless_bool.rs:151:12\n+   |\n+LL |       } else if returns_bool() {\n+   |  ____________^\n+LL | |         false\n+LL | |     } else {\n+LL | |         true\n+LL | |     };\n+   | |_____^ help: you can reduce it to: `{ !returns_bool() }`\n+\n+error: aborting due to 16 previous errors\n "}]}