{"sha": "38c34098b10a6311b63db96c3542664843232148", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM4YzM0MDk4YjEwYTYzMTFiNjNkYjk2YzM1NDI2NjQ4NDMyMzIxNDg=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-29T16:05:23Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-29T16:05:23Z"}, "message": "Rollup merge of #78462 - danielframpton:fixnullisa, r=nagisa\n\nUse unwrapDIPtr because the Scope may be null.\n\nI ran into an assertion when using debug information on Windows with LLVM assertions enabled.\n\nIt seems like we are using unwrap here (which in turn calls isa and requires the pointer to be non-null) but we expect the value to be null because that is what we are passing from rustc.\n\nThis change uses unwrapDIPtr which explicitly allows nullptr.\n\nThe FFI prototype for this method on the rust side has the `LLVMMetadataRef` parameter as `Scope: Option<&'a DIScope>`, and we always pass `None` when `msvc_like_names` is true.", "tree": {"sha": "5cbf8da08babe40ae873bedca9d62130bf432d3a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5cbf8da08babe40ae873bedca9d62130bf432d3a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/38c34098b10a6311b63db96c3542664843232148", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfmuhECRBK7hj4Ov3rIwAAdHIIAH823tfvd/sq2mxO3DeA6TZK\nBTx0XXDxygFQmeTFDlegei/xZFezGYa4MB/PaUVXiSzEDJ2Xqvni+ShF/81GU0Wj\nia1W73/ryu5oojfP2BsZDvnxiGj2WyqUHiQJPUGHfXkTajNHXG1FFgUiFLRXdTel\nA4Gaezjot72t+i6ofUPEo9DZetTcBaJslNeHXKTlGQs7BBKvIqHDFghVp9w9ypC/\nZBJJjK9O8QNa2F0YweQOlJxRxuS2XU1/BcHyKZLYKPftn4ZzQWywjkUlPsQsBBUP\nrRZ0W8w4hn+98R/Jzjf1rBtffYNUVigDQ7M+aRFXiZIPlWA1VneQA4b4valZfWk=\n=Sji4\n-----END PGP SIGNATURE-----\n", "payload": "tree 5cbf8da08babe40ae873bedca9d62130bf432d3a\nparent 31cfe63fb908dfe3f9dac43ae6a6a11e1d0cc8c3\nparent a3bff691344ed94ca5ebab8a043141a0e56931d2\nauthor Jonas Schievink <jonasschievink@gmail.com> 1603987523 +0100\ncommitter GitHub <noreply@github.com> 1603987523 +0100\n\nRollup merge of #78462 - danielframpton:fixnullisa, r=nagisa\n\nUse unwrapDIPtr because the Scope may be null.\n\nI ran into an assertion when using debug information on Windows with LLVM assertions enabled.\n\nIt seems like we are using unwrap here (which in turn calls isa and requires the pointer to be non-null) but we expect the value to be null because that is what we are passing from rustc.\n\nThis change uses unwrapDIPtr which explicitly allows nullptr.\n\nThe FFI prototype for this method on the rust side has the `LLVMMetadataRef` parameter as `Scope: Option<&'a DIScope>`, and we always pass `None` when `msvc_like_names` is true.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/38c34098b10a6311b63db96c3542664843232148", "html_url": "https://github.com/rust-lang/rust/commit/38c34098b10a6311b63db96c3542664843232148", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/38c34098b10a6311b63db96c3542664843232148/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31cfe63fb908dfe3f9dac43ae6a6a11e1d0cc8c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/31cfe63fb908dfe3f9dac43ae6a6a11e1d0cc8c3", "html_url": "https://github.com/rust-lang/rust/commit/31cfe63fb908dfe3f9dac43ae6a6a11e1d0cc8c3"}, {"sha": "a3bff691344ed94ca5ebab8a043141a0e56931d2", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3bff691344ed94ca5ebab8a043141a0e56931d2", "html_url": "https://github.com/rust-lang/rust/commit/a3bff691344ed94ca5ebab8a043141a0e56931d2"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "869aaa569ca407f4fc53c4a4ed29c2c9d0788330", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/38c34098b10a6311b63db96c3542664843232148/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/38c34098b10a6311b63db96c3542664843232148/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=38c34098b10a6311b63db96c3542664843232148", "patch": "@@ -766,7 +766,7 @@ extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreateTypedef(\n     LLVMMetadataRef File, unsigned LineNo, LLVMMetadataRef Scope) {\n   return wrap(Builder->createTypedef(\n     unwrap<DIType>(Type), StringRef(Name, NameLen), unwrap<DIFile>(File),\n-    LineNo, unwrap<DIScope>(Scope)));\n+    LineNo, unwrapDIPtr<DIScope>(Scope)));\n }\n \n extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreatePointerType("}]}