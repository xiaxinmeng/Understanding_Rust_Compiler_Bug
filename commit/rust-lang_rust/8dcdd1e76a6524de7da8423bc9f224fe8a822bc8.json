{"sha": "8dcdd1e76a6524de7da8423bc9f224fe8a822bc8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkY2RkMWU3NmE2NTI0ZGU3ZGE4NDIzYmM5ZjIyNGZlOGE4MjJiYzg=", "commit": {"author": {"name": "Jorge Aparicio", "email": "japaricious@gmail.com", "date": "2014-12-06T16:56:55Z"}, "committer": {"name": "Jorge Aparicio", "email": "japaricious@gmail.com", "date": "2014-12-07T21:46:46Z"}, "message": "syntax: use UFCS in the expansion of `#[deriving(Ord)]`\n\ncc #18755", "tree": {"sha": "2e8b7411c94c5c1ddc1080d1506bee942d56da6d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e8b7411c94c5c1ddc1080d1506bee942d56da6d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8", "html_url": "https://github.com/rust-lang/rust/commit/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8/comments", "author": null, "committer": null, "parents": [{"sha": "558f8d8e3ea6b7da3d6d338740637149a7e45840", "url": "https://api.github.com/repos/rust-lang/rust/commits/558f8d8e3ea6b7da3d6d338740637149a7e45840", "html_url": "https://github.com/rust-lang/rust/commit/558f8d8e3ea6b7da3d6d338740637149a7e45840"}], "stats": {"total": 35, "additions": 28, "deletions": 7}, "files": [{"sha": "6900773f44d4bec09aeba6251d00e03c145b4b13", "filename": "src/libsyntax/ext/deriving/cmp/totalord.rs", "status": "modified", "additions": 25, "deletions": 4, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8/src%2Flibsyntax%2Fext%2Fderiving%2Fcmp%2Ftotalord.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8/src%2Flibsyntax%2Fext%2Fderiving%2Fcmp%2Ftotalord.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fderiving%2Fcmp%2Ftotalord.rs?ref=8dcdd1e76a6524de7da8423bc9f224fe8a822bc8", "patch": "@@ -66,12 +66,19 @@ pub fn cs_cmp(cx: &mut ExtCtxt, span: Span,\n                                           cx.ident_of(\"cmp\"),\n                                           cx.ident_of(\"Equal\")));\n \n+    let cmp_path = vec![\n+        cx.ident_of(\"std\"),\n+        cx.ident_of(\"cmp\"),\n+        cx.ident_of(\"Ord\"),\n+        cx.ident_of(\"cmp\"),\n+    ];\n+\n     /*\n     Builds:\n \n-    let __test = self_field1.cmp(&other_field2);\n+    let __test = ::std::cmp::Ord::cmp(&self_field1, &other_field1);\n     if other == ::std::cmp::Ordering::Equal {\n-        let __test = self_field2.cmp(&other_field2);\n+        let __test = ::std::cmp::Ord::cmp(&self_field2, &other_field2);\n         if __test == ::std::cmp::Ordering::Equal {\n             ...\n         } else {\n@@ -83,18 +90,32 @@ pub fn cs_cmp(cx: &mut ExtCtxt, span: Span,\n \n     FIXME #6449: These `if`s could/should be `match`es.\n     */\n-    cs_same_method_fold(\n+    cs_fold(\n         // foldr nests the if-elses correctly, leaving the first field\n         // as the outermost one, and the last as the innermost.\n         false,\n-        |cx, span, old, new| {\n+        |cx, span, old, self_f, other_fs| {\n             // let __test = new;\n             // if __test == ::std::cmp::Ordering::Equal {\n             //    old\n             // } else {\n             //    __test\n             // }\n \n+            let new = {\n+                let other_f = match other_fs {\n+                    [ref o_f] => o_f,\n+                    _ => cx.span_bug(span, \"not exactly 2 arguments in `deriving(PartialOrd)`\"),\n+                };\n+\n+                let args = vec![\n+                    cx.expr_addr_of(span, self_f),\n+                    cx.expr_addr_of(span, other_f.clone()),\n+                ];\n+\n+                cx.expr_call_global(span, cmp_path.clone(), args)\n+            };\n+\n             let assign = cx.stmt_let(span, false, test_id, new);\n \n             let cond = cx.expr_binary(span, ast::BiEq,"}, {"sha": "35bd68d803a2e3d43edef6382ef20b35f6cf324e", "filename": "src/test/run-pass/issue-18738.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8/src%2Ftest%2Frun-pass%2Fissue-18738.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8dcdd1e76a6524de7da8423bc9f224fe8a822bc8/src%2Ftest%2Frun-pass%2Fissue-18738.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-18738.rs?ref=8dcdd1e76a6524de7da8423bc9f224fe8a822bc8", "patch": "@@ -8,18 +8,18 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#[deriving(PartialEq, PartialOrd)]\n+#[deriving(Eq, PartialEq, PartialOrd, Ord)]\n enum Test<'a> {\n     Int(&'a int),\n     Slice(&'a [u8]),\n }\n \n-#[deriving(PartialEq, PartialOrd)]\n+#[deriving(Eq, PartialEq, PartialOrd, Ord)]\n struct Version {\n     vendor_info: &'static str\n }\n \n-#[deriving(PartialEq, PartialOrd)]\n+#[deriving(Eq, PartialEq, PartialOrd, Ord)]\n struct Foo(&'static str);\n \n fn main() {}"}]}