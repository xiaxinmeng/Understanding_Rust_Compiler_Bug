{"sha": "77c283465c567d72868714c4ee4f2328e0800346", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3YzI4MzQ2NWM1NjdkNzI4Njg3MTRjNGVlNGYyMzI4ZTA4MDAzNDY=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-11-01T13:41:36Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-11-05T08:17:48Z"}, "message": "Also test for undef in enum discriminant\n\nThe error message is sub-par, but fixing that requries moving ScalarMaybeUndef\nto librustc which would conflict badly with another PR that is in flight.", "tree": {"sha": "1ee97b11d240cf25023d93270924a2378d2a26be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ee97b11d240cf25023d93270924a2378d2a26be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77c283465c567d72868714c4ee4f2328e0800346", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77c283465c567d72868714c4ee4f2328e0800346", "html_url": "https://github.com/rust-lang/rust/commit/77c283465c567d72868714c4ee4f2328e0800346", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77c283465c567d72868714c4ee4f2328e0800346/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fa01e04fbb5aad536c4d5e89581af00adbd6e0cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/fa01e04fbb5aad536c4d5e89581af00adbd6e0cf", "html_url": "https://github.com/rust-lang/rust/commit/fa01e04fbb5aad536c4d5e89581af00adbd6e0cf"}], "stats": {"total": 19, "additions": 16, "deletions": 3}, "files": [{"sha": "309627581d0512cd5a881ceb013b7f03cdb7d306", "filename": "src/test/ui/consts/const-eval/ub-enum.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/77c283465c567d72868714c4ee4f2328e0800346/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77c283465c567d72868714c4ee4f2328e0800346/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.rs?ref=77c283465c567d72868714c4ee4f2328e0800346", "patch": "@@ -33,10 +33,15 @@ enum Enum2 {\n union TransmuteEnum2 {\n     a: usize,\n     b: Enum2,\n+    c: (),\n }\n const BAD_ENUM2 : Enum2 = unsafe { TransmuteEnum2 { a: 0 }.b };\n //~^ ERROR is undefined behavior\n \n+// Undef enum discriminant. In an arry to avoid `Scalar` layout.\n+const BAD_ENUM3 : [Enum2; 2] = [unsafe { TransmuteEnum2 { c: () }.b }; 2];\n+//~^ ERROR is undefined behavior\n+\n // Invalid enum field content (mostly to test printing of apths for enum tuple\n // variants and tuples).\n union TransmuteChar {"}, {"sha": "57c41711536d9485749b501a0f5cf85d87258306", "filename": "src/test/ui/consts/const-eval/ub-enum.stderr", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/77c283465c567d72868714c4ee4f2328e0800346/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/77c283465c567d72868714c4ee4f2328e0800346/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.stderr?ref=77c283465c567d72868714c4ee4f2328e0800346", "patch": "@@ -7,21 +7,29 @@ LL | const BAD_ENUM: Enum = unsafe { TransmuteEnum { a: &1 }.b };\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\n \n error[E0080]: it is undefined behavior to use this value\n-  --> $DIR/ub-enum.rs:37:1\n+  --> $DIR/ub-enum.rs:38:1\n    |\n LL | const BAD_ENUM2 : Enum2 = unsafe { TransmuteEnum2 { a: 0 }.b };\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered 0, but expected a valid enum discriminant\n    |\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\n \n error[E0080]: it is undefined behavior to use this value\n-  --> $DIR/ub-enum.rs:47:1\n+  --> $DIR/ub-enum.rs:42:1\n+   |\n+LL | const BAD_ENUM3 : [Enum2; 2] = [unsafe { TransmuteEnum2 { c: () }.b }; 2];\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ attempted to read undefined bytes\n+   |\n+   = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\n+\n+error[E0080]: it is undefined behavior to use this value\n+  --> $DIR/ub-enum.rs:52:1\n    |\n LL | const BAD_ENUM_CHAR : Option<(char, char)> = Some(('x', unsafe { TransmuteChar { a: !0 }.b }));\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered 4294967295 at .Some.0.1, but expected something in the range 0..=1114111\n    |\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\n \n-error: aborting due to 3 previous errors\n+error: aborting due to 4 previous errors\n \n For more information about this error, try `rustc --explain E0080`."}]}