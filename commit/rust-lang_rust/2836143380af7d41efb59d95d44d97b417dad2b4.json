{"sha": "2836143380af7d41efb59d95d44d97b417dad2b4", "node_id": "C_kwDOAAsO6NoAKDI4MzYxNDMzODBhZjdkNDFlZmI1OWQ5NWQ0NGQ5N2I0MTdkYWQyYjQ", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-04-12T06:46:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-12T06:46:58Z"}, "message": "Rollup merge of #95909 - vacuus:theme-build-rule, r=GuillaumeGomez\n\nrustdoc: Reduce allocations in a `theme` function\n\n`str::replace` allocates a new `String`...\n\nThis could probably be made more efficient, but I think it'd have to be clunky imperative code to achieve that.", "tree": {"sha": "32143bcc4ee6a7f5a1c88c7404f323c179c3d68b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/32143bcc4ee6a7f5a1c88c7404f323c179c3d68b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2836143380af7d41efb59d95d44d97b417dad2b4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiVSBjCRBK7hj4Ov3rIwAApxwIACQlXWq6wuAOaU6s9PqWY7Va\nPu+Wl6nj4QoqNwXR6Rw6wSY3QaRo43zLtzCDrVC6YSE22FdnMNKNycv/RRO3njgI\nlgha9qfDUWOmmt+txcZmKZbZvnmVXr9zfRauJOdFqtuXIK5VysngyOVBXWLiVb4l\nHduP/qiRhaNQlhfEDemAiJgHN8s5gDwFcO2vtakjsjxdQ4VlH93QCJA/LH0KHz21\nIN+r27O88Dom/p5VbvpD+BAUQHwkv1Go+UDSdqcDrFaaZY27YKbhkTQGSjFeg2qI\ncShk3QHlIelR7BBsKbfvWJhCl5UANeu63P5toXhwZRxbJ6GdULRSTXL+bvsEjh0=\n=+ITK\n-----END PGP SIGNATURE-----\n", "payload": "tree 32143bcc4ee6a7f5a1c88c7404f323c179c3d68b\nparent 3ff5cb20b6e8b5c4b4a8fe5dbd07d5d66ffbcd43\nparent 7feb7383d23868c1ace7288b33e6029a9562c5e7\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1649746018 +0200\ncommitter GitHub <noreply@github.com> 1649746018 +0200\n\nRollup merge of #95909 - vacuus:theme-build-rule, r=GuillaumeGomez\n\nrustdoc: Reduce allocations in a `theme` function\n\n`str::replace` allocates a new `String`...\n\nThis could probably be made more efficient, but I think it'd have to be clunky imperative code to achieve that.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2836143380af7d41efb59d95d44d97b417dad2b4", "html_url": "https://github.com/rust-lang/rust/commit/2836143380af7d41efb59d95d44d97b417dad2b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2836143380af7d41efb59d95d44d97b417dad2b4/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ff5cb20b6e8b5c4b4a8fe5dbd07d5d66ffbcd43", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ff5cb20b6e8b5c4b4a8fe5dbd07d5d66ffbcd43", "html_url": "https://github.com/rust-lang/rust/commit/3ff5cb20b6e8b5c4b4a8fe5dbd07d5d66ffbcd43"}, {"sha": "7feb7383d23868c1ace7288b33e6029a9562c5e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/7feb7383d23868c1ace7288b33e6029a9562c5e7", "html_url": "https://github.com/rust-lang/rust/commit/7feb7383d23868c1ace7288b33e6029a9562c5e7"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "7c19865b6d78bd1162c5eff44cf9498ad6432c78", "filename": "src/librustdoc/theme.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/2836143380af7d41efb59d95d44d97b417dad2b4/src%2Flibrustdoc%2Ftheme.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2836143380af7d41efb59d95d44d97b417dad2b4/src%2Flibrustdoc%2Ftheme.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftheme.rs?ref=2836143380af7d41efb59d95d44d97b417dad2b4", "patch": "@@ -173,15 +173,17 @@ fn build_rule(v: &[u8], positions: &[usize]) -> String {\n             .map(|x| ::std::str::from_utf8(&v[x[0]..x[1]]).unwrap_or(\"\"))\n             .collect::<String>()\n             .trim()\n-            .replace('\\n', \" \")\n-            .replace('/', \"\")\n-            .replace('\\t', \" \")\n-            .replace('{', \"\")\n-            .replace('}', \"\")\n+            .chars()\n+            .filter_map(|c| match c {\n+                '\\n' | '\\t' => Some(' '),\n+                '/' | '{' | '}' => None,\n+                c => Some(c),\n+            })\n+            .collect::<String>()\n             .split(' ')\n             .filter(|s| !s.is_empty())\n-            .collect::<Vec<&str>>()\n-            .join(\" \"),\n+            .intersperse(\" \")\n+            .collect::<String>(),\n     )\n     .unwrap_or_else(|_| String::new())\n }"}]}