{"sha": "5fc25d30e25fa5c05c34812eab311c42b464bb17", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmYzI1ZDMwZTI1ZmE1YzA1YzM0ODEyZWFiMzExYzQyYjQ2NGJiMTc=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-11-01T19:16:38Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-11-03T08:09:34Z"}, "message": "RIIR update lints: Generate modules section", "tree": {"sha": "d10afbb78d533002fefe885a31868c5eada38fb1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d10afbb78d533002fefe885a31868c5eada38fb1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5fc25d30e25fa5c05c34812eab311c42b464bb17", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlvdV78ACgkQtvoGpuDi\nZlvofxAAuw1nP+iEIInVWOLky2mRFOiKymkUNz/ogq31WnticK80qjsuZkGEtSpV\nSwPIkajfoM4GbTW69i+BO9ip4Z0/x/CNoacAegCaMaXqCuOWwXHg75cpjkXgMqjd\nXyUzDBmJZrVAhqHxqPEQfO3YiGlD0+Copyn+NBYTn276v0NJsBOxPM+vB89HbTbh\nfUFByeErR1/DUvyoIcWkYp7BOYrgeVaAtrNydUv/u0lCmdiJ2/QtaViVUplmcICc\ni9uAcxRw5JYAaXhX9I8gV1mI1b7jgZHc2otxhC4hD7PWDMTkR42eRERvglax1KWz\nX/sN13xpZrqELjybT1272XLiIzpe7lp8ren+n/3JS7zU5JVb9aWSitNrCX9wSz2w\nI2raL/23rO3T5FQHc3qK5GA7+Ooo9kwtw7hxJTqN61Ha7WtPPBH8HystHVcHxjWL\njDEudRFc8XpbN53R7z7q9RwVjr919+OaO44Lhu1qv3UDELv3uOAjTWYbYb2++ajK\nH5ytDe70OBlz0tSz/nLyi6wT9tIlUnvpJUn2qG/Rk3hBiSRglZoZhgvUW2JQCeTH\ngd02GukMenGIs42E39jZnsjGLyjZcdAR8rYlbBZlpkkYVjbBJ8gieWh9GZ/21ezA\nDE9D3oXw9WvBya5y5w35ydq5OWorIwwxzafAt/+vJ7mCOn7N5VA=\n=/a38\n-----END PGP SIGNATURE-----", "payload": "tree d10afbb78d533002fefe885a31868c5eada38fb1\nparent 0ad5b9b9e08e84f80a4baccd11209553f1e64b2a\nauthor Philipp Hansch <dev@phansch.net> 1541099798 +0100\ncommitter Philipp Hansch <dev@phansch.net> 1541232574 +0100\n\nRIIR update lints: Generate modules section\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5fc25d30e25fa5c05c34812eab311c42b464bb17", "html_url": "https://github.com/rust-lang/rust/commit/5fc25d30e25fa5c05c34812eab311c42b464bb17", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5fc25d30e25fa5c05c34812eab311c42b464bb17/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0ad5b9b9e08e84f80a4baccd11209553f1e64b2a", "url": "https://api.github.com/repos/rust-lang/rust/commits/0ad5b9b9e08e84f80a4baccd11209553f1e64b2a", "html_url": "https://github.com/rust-lang/rust/commit/0ad5b9b9e08e84f80a4baccd11209553f1e64b2a"}], "stats": {"total": 46, "additions": 44, "deletions": 2}, "files": [{"sha": "53b9d5e18ecc9c9e5a27a9cb6519c9495a70b0ca", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 36, "deletions": 2, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/5fc25d30e25fa5c05c34812eab311c42b464bb17/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5fc25d30e25fa5c05c34812eab311c42b464bb17/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=5fc25d30e25fa5c05c34812eab311c42b464bb17", "patch": "@@ -72,6 +72,19 @@ impl Lint {\n     }\n }\n \n+/// Generates the `pub mod module_name` list in `clippy_lints/src/lib.rs`.\n+pub fn gen_modules_list(lints: Vec<Lint>) -> Vec<String> {\n+    lints.into_iter()\n+        .filter_map(|l| {\n+            if l.is_internal() || l.deprecation.is_some() { None } else { Some(l.module) }\n+        })\n+        .unique()\n+        .map(|module| {\n+            format!(\"pub mod {};\", module)\n+        })\n+        .sorted()\n+}\n+\n /// Generates the list of lint links at the bottom of the README\n pub fn gen_changelog_lint_list(lints: Vec<Lint>) -> Vec<String> {\n     let mut lint_list_sorted: Vec<Lint> = lints;\n@@ -113,7 +126,13 @@ fn gather_from_file(dir_entry: &walkdir::DirEntry) -> impl Iterator<Item=Lint> {\n     let mut file = fs::File::open(dir_entry.path()).unwrap();\n     let mut content = String::new();\n     file.read_to_string(&mut content).unwrap();\n-    parse_contents(&content, dir_entry.path().file_stem().unwrap().to_str().unwrap())\n+    let mut filename = dir_entry.path().file_stem().unwrap().to_str().unwrap();\n+    // If the lints are stored in mod.rs, we get the module name from\n+    // the containing directory:\n+    if filename == \"mod\" {\n+        filename = dir_entry.path().parent().unwrap().file_stem().unwrap().to_str().unwrap()\n+    }\n+    parse_contents(&content, filename)\n }\n \n fn parse_contents(content: &str, filename: &str) -> impl Iterator<Item=Lint> {\n@@ -215,7 +234,7 @@ pub fn replace_region_in_text<F>(text: &str, start: &str, end: &str, replace_sta\n         // This happens if the provided regex in `clippy_dev/src/main.rs` is not found in the\n         // given text or file. Most likely this is an error on the programmer's side and the Regex\n         // is incorrect.\n-        println!(\"regex {:?} not found. You may have to update it.\", start);\n+        eprintln!(\"error: regex `{:?}` not found. You may have to update it.\", start);\n     }\n     new_lines.join(\"\\n\")\n }\n@@ -356,3 +375,18 @@ fn test_gen_deprecated() {\n     ];\n     assert_eq!(expected, gen_deprecated(&lints));\n }\n+\n+#[test]\n+fn test_gen_modules_list() {\n+    let lints = vec![\n+        Lint::new(\"should_assert_eq\", \"group1\", \"abc\", None, \"module_name\"),\n+        Lint::new(\"should_assert_eq2\", \"group2\", \"abc\", Some(\"abc\"), \"deprecated\"),\n+        Lint::new(\"incorrect_internal\", \"internal_style\", \"abc\", None, \"another_module\"),\n+        Lint::new(\"incorrect_internal\", \"internal_style\", \"abc\", None, \"module_name\"),\n+    ];\n+    let expected = vec![\n+        \"pub mod another_module;\\n\".to_string(),\n+        \"pub mod module_name;\\n\".to_string(),\n+    ];\n+    assert_eq!(expected, gen_modules_list(lints));\n+}"}, {"sha": "4832b428e9cfe6774520d6ac2d7ef34668915c9e", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5fc25d30e25fa5c05c34812eab311c42b464bb17/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5fc25d30e25fa5c05c34812eab311c42b464bb17/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=5fc25d30e25fa5c05c34812eab311c42b464bb17", "patch": "@@ -90,4 +90,12 @@ fn update_lints() {\n         false,\n         || { gen_deprecated(&lint_list) }\n     );\n+\n+    replace_region_in_file(\n+        \"../clippy_lints/src/lib.rs\",\n+        \"begin lints modules\",\n+        \"end lints modules\",\n+        false,\n+        || { gen_modules_list(lint_list.clone()) }\n+    );\n }"}]}