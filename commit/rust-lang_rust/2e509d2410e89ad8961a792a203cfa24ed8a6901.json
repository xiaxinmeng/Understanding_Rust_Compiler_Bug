{"sha": "2e509d2410e89ad8961a792a203cfa24ed8a6901", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlNTA5ZDI0MTBlODlhZDg5NjFhNzkyYTIwM2NmYTI0ZWQ4YTY5MDE=", "commit": {"author": {"name": "Marco A L Barbosa", "email": "malbarbo@gmail.com", "date": "2017-05-05T20:19:18Z"}, "committer": {"name": "Marco A L Barbosa", "email": "malbarbo@gmail.com", "date": "2017-05-09T23:02:11Z"}, "message": "Add disabled android host builders", "tree": {"sha": "bcac835e1e52dc72a4d37754ef45e48e78b51a1d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bcac835e1e52dc72a4d37754ef45e48e78b51a1d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e509d2410e89ad8961a792a203cfa24ed8a6901", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e509d2410e89ad8961a792a203cfa24ed8a6901", "html_url": "https://github.com/rust-lang/rust/commit/2e509d2410e89ad8961a792a203cfa24ed8a6901", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e509d2410e89ad8961a792a203cfa24ed8a6901/comments", "author": {"login": "malbarbo", "id": 1678126, "node_id": "MDQ6VXNlcjE2NzgxMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1678126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/malbarbo", "html_url": "https://github.com/malbarbo", "followers_url": "https://api.github.com/users/malbarbo/followers", "following_url": "https://api.github.com/users/malbarbo/following{/other_user}", "gists_url": "https://api.github.com/users/malbarbo/gists{/gist_id}", "starred_url": "https://api.github.com/users/malbarbo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/malbarbo/subscriptions", "organizations_url": "https://api.github.com/users/malbarbo/orgs", "repos_url": "https://api.github.com/users/malbarbo/repos", "events_url": "https://api.github.com/users/malbarbo/events{/privacy}", "received_events_url": "https://api.github.com/users/malbarbo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "malbarbo", "id": 1678126, "node_id": "MDQ6VXNlcjE2NzgxMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1678126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/malbarbo", "html_url": "https://github.com/malbarbo", "followers_url": "https://api.github.com/users/malbarbo/followers", "following_url": "https://api.github.com/users/malbarbo/following{/other_user}", "gists_url": "https://api.github.com/users/malbarbo/gists{/gist_id}", "starred_url": "https://api.github.com/users/malbarbo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/malbarbo/subscriptions", "organizations_url": "https://api.github.com/users/malbarbo/orgs", "repos_url": "https://api.github.com/users/malbarbo/repos", "events_url": "https://api.github.com/users/malbarbo/events{/privacy}", "received_events_url": "https://api.github.com/users/malbarbo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "222971f7d2a098b4b8b57520452ab475bc5ea45f", "url": "https://api.github.com/repos/rust-lang/rust/commits/222971f7d2a098b4b8b57520452ab475bc5ea45f", "html_url": "https://github.com/rust-lang/rust/commit/222971f7d2a098b4b8b57520452ab475bc5ea45f"}], "stats": {"total": 289, "additions": 284, "deletions": 5}, "files": [{"sha": "4849f843007296f1d8a6f747224cefa61f0536b3", "filename": "src/ci/docker/android-ndk.sh", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fandroid-ndk.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fandroid-ndk.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fandroid-ndk.sh?ref=2e509d2410e89ad8961a792a203cfa24ed8a6901", "patch": "@@ -0,0 +1,35 @@\n+#!/bin/sh\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -ex\n+\n+URL=https://dl.google.com/android/repository\n+\n+download_ndk() {\n+    mkdir -p /android/ndk\n+    cd /android/ndk\n+    curl -O $URL/$1\n+    unzip -q $1\n+    rm $1\n+    mv android-ndk-* ndk\n+}\n+\n+make_standalone_toolchain() {\n+    # See https://developer.android.com/ndk/guides/standalone_toolchain.htm\n+    python2.7 /android/ndk/ndk/build/tools/make_standalone_toolchain.py \\\n+        --install-dir /android/ndk/$1-$2 \\\n+        --arch $1 \\\n+        --api $2\n+}\n+\n+remove_ndk() {\n+    rm -rf /android/ndk/ndk\n+}"}, {"sha": "34e112a1f4f419b9d89966d22d692c069bde4299", "filename": "src/ci/docker/disabled/dist-aarch64-android/Dockerfile", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-aarch64-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-aarch64-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-aarch64-android%2FDockerfile?ref=2e509d2410e89ad8961a792a203cfa24ed8a6901", "patch": "@@ -0,0 +1,49 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && \\\n+    apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  unzip \\\n+  sudo \\\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+\n+RUN curl -o /usr/local/bin/sccache \\\n+      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-04-29-sccache-x86_64-unknown-linux-musl && \\\n+      chmod +x /usr/local/bin/sccache\n+\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+COPY android-ndk.sh /\n+RUN . /android-ndk.sh && \\\n+    download_ndk android-ndk-r13b-linux-x86_64.zip && \\\n+    make_standalone_toolchain arm64 21 && \\\n+    remove_ndk\n+\n+ENV PATH=$PATH:/android/ndk/arm64-21/bin\n+\n+ENV DEP_Z_ROOT=/android/ndk/arm64-21/sysroot/usr/\n+\n+ENV HOSTS=aarch64-linux-android\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=$HOSTS \\\n+      --target=$HOSTS \\\n+      --aarch64-linux-android-ndk=/android/ndk/arm64-21 \\\n+      --disable-rpath \\\n+      --enable-extended \\\n+      --enable-cargo-openssl-static\n+\n+ENV SCRIPT python2.7 ../x.py dist --target $HOSTS --host $HOSTS"}, {"sha": "34468969b88ebff3e47d78c8805395b7683ca0d5", "filename": "src/ci/docker/disabled/dist-armv7-android/Dockerfile", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-armv7-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-armv7-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-armv7-android%2FDockerfile?ref=2e509d2410e89ad8961a792a203cfa24ed8a6901", "patch": "@@ -0,0 +1,65 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && \\\n+    apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  unzip \\\n+  sudo \\\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+\n+RUN curl -o /usr/local/bin/sccache \\\n+      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-04-29-sccache-x86_64-unknown-linux-musl && \\\n+      chmod +x /usr/local/bin/sccache\n+\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+COPY android-ndk.sh /\n+RUN . /android-ndk.sh && \\\n+    download_ndk android-ndk-r13b-linux-x86_64.zip && \\\n+    make_standalone_toolchain arm 9 && \\\n+    make_standalone_toolchain arm 21 && \\\n+    remove_ndk\n+\n+ENV PATH=$PATH:/android/ndk/arm-9/bin\n+\n+ENV DEP_Z_ROOT=/android/ndk/arm-9/sysroot/usr/\n+\n+ENV HOSTS=armv7-linux-androideabi\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=$HOSTS \\\n+      --target=$HOSTS \\\n+      --armv7-linux-androideabi-ndk=/android/ndk/arm \\\n+      --disable-rpath \\\n+      --enable-extended \\\n+      --enable-cargo-openssl-static\n+\n+# We support api level 9, but api level 21 is required to build llvm. To\n+# overcome this problem we use a ndk with api level 21 to build llvm and then\n+# switch to a ndk with api level 9 to complete the build. When the linker is\n+# invoked there are missing symbols (like sigsetempty, not available with api\n+# level 9), the default linker behavior is to generate an error, to allow the\n+# build to finish we use --warn-unresolved-symbols. Note that the missing\n+# symbols does not affect std, only the compiler (llvm) and cargo (openssl).\n+RUN chmod 777 /android/ndk && \\\n+    ln -s /android/ndk/arm-21 /android/ndk/arm\n+\n+ENV SCRIPT \\\n+  python2.7 ../x.py build src/llvm --host $HOSTS --target $HOSTS && \\\n+  (export RUSTFLAGS=\"\\\"-C link-arg=-Wl,--warn-unresolved-symbols\\\"\"; \\\n+    rm /android/ndk/arm && \\\n+    ln -s /android/ndk/arm-9 /android/ndk/arm && \\\n+    python2.7 ../x.py dist --host $HOSTS --target $HOSTS)"}, {"sha": "cb9c76b22818c2f786c6d2da6901a671f0495210", "filename": "src/ci/docker/disabled/dist-i686-android/Dockerfile", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-i686-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-i686-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-i686-android%2FDockerfile?ref=2e509d2410e89ad8961a792a203cfa24ed8a6901", "patch": "@@ -0,0 +1,65 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && \\\n+    apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  unzip \\\n+  sudo \\\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+\n+RUN curl -o /usr/local/bin/sccache \\\n+      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-04-29-sccache-x86_64-unknown-linux-musl && \\\n+      chmod +x /usr/local/bin/sccache\n+\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+COPY android-ndk.sh /\n+RUN . /android-ndk.sh && \\\n+    download_ndk android-ndk-r13b-linux-x86_64.zip && \\\n+    make_standalone_toolchain x86 9 && \\\n+    make_standalone_toolchain x86 21 && \\\n+    remove_ndk\n+\n+ENV PATH=$PATH:/android/ndk/x86-9/bin\n+\n+ENV DEP_Z_ROOT=/android/ndk/x86-9/sysroot/usr/\n+\n+ENV HOSTS=i686-linux-android\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=$HOSTS \\\n+      --target=$HOSTS \\\n+      --i686-linux-android-ndk=/android/ndk/x86 \\\n+      --disable-rpath \\\n+      --enable-extended \\\n+      --enable-cargo-openssl-static\n+\n+# We support api level 9, but api level 21 is required to build llvm. To\n+# overcome this problem we use a ndk with api level 21 to build llvm and then\n+# switch to a ndk with api level 9 to complete the build. When the linker is\n+# invoked there are missing symbols (like sigsetempty, not available with api\n+# level 9), the default linker behavior is to generate an error, to allow the\n+# build to finish we use --warn-unresolved-symbols. Note that the missing\n+# symbols does not affect std, only the compiler (llvm) and cargo (openssl).\n+RUN chmod 777 /android/ndk && \\\n+    ln -s /android/ndk/x86-21 /android/ndk/x86\n+\n+ENV SCRIPT \\\n+  python2.7 ../x.py build src/llvm --host $HOSTS --target $HOSTS && \\\n+  (export RUSTFLAGS=\"\\\"-C link-arg=-Wl,--warn-unresolved-symbols\\\"\"; \\\n+    rm /android/ndk/x86 && \\\n+    ln -s /android/ndk/x86-9 /android/ndk/x86 && \\\n+    python2.7 ../x.py dist --host $HOSTS --target $HOSTS)"}, {"sha": "11a80abf8f9fca8e6b3f32e311ab9541f6c22687", "filename": "src/ci/docker/disabled/dist-x86_64-android/Dockerfile", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-x86_64-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Fdisabled%2Fdist-x86_64-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdisabled%2Fdist-x86_64-android%2FDockerfile?ref=2e509d2410e89ad8961a792a203cfa24ed8a6901", "patch": "@@ -0,0 +1,49 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && \\\n+    apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  unzip \\\n+  sudo \\\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+\n+RUN curl -o /usr/local/bin/sccache \\\n+      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-04-29-sccache-x86_64-unknown-linux-musl && \\\n+      chmod +x /usr/local/bin/sccache\n+\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n+\n+COPY android-ndk.sh /\n+RUN . /android-ndk.sh && \\\n+    download_ndk android-ndk-r13b-linux-x86_64.zip && \\\n+    make_standalone_toolchain x86_64 21 && \\\n+    remove_ndk\n+\n+ENV PATH=$PATH:/android/ndk/x86_64-21/bin\n+\n+ENV DEP_Z_ROOT=/android/ndk/x86_64-21/sysroot/usr/\n+\n+ENV HOSTS=x86_64-linux-android\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=$HOSTS \\\n+      --target=$HOSTS \\\n+      --x86_64-linux-android-ndk=/android/ndk/x86_64-21 \\\n+      --disable-rpath \\\n+      --enable-extended \\\n+      --enable-cargo-openssl-static\n+\n+ENV SCRIPT python2.7 ../x.py dist --target $HOSTS --host $HOSTS"}, {"sha": "6abbf0530afa69c6ebb333823f8b3d562495bb9f", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 21, "deletions": 5, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2e509d2410e89ad8961a792a203cfa24ed8a6901/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=2e509d2410e89ad8961a792a203cfa24ed8a6901", "patch": "@@ -21,11 +21,27 @@ root_dir=\"`dirname $src_dir`\"\n \n source \"$ci_dir/shared.sh\"\n \n-retry docker \\\n-  build \\\n-  --rm \\\n-  -t rust-ci \\\n-  \"`dirname \"$script\"`/$image\"\n+if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n+    retry docker \\\n+      build \\\n+      --rm \\\n+      -t rust-ci \\\n+      \"$docker_dir/$image\"\n+elif [ -f \"$docker_dir/disabled/$image/Dockerfile\" ]; then\n+    if [ -n \"$TRAVIS_OS_NAME\" ]; then\n+        echo Cannot run disabled images on travis!\n+        exit 1\n+    fi\n+    retry docker \\\n+      build \\\n+      --rm \\\n+      -t rust-ci \\\n+      -f \"$docker_dir/disabled/$image/Dockerfile\" \\\n+      \"$docker_dir\"\n+else\n+    echo Invalid image: $image\n+    exit 1\n+fi\n \n objdir=$root_dir/obj\n "}]}