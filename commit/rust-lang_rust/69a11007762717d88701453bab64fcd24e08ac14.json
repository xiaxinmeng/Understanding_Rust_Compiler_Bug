{"sha": "69a11007762717d88701453bab64fcd24e08ac14", "node_id": "C_kwDOAAsO6NoAKDY5YTExMDA3NzYyNzE3ZDg4NzAxNDUzYmFiNjRmY2QyNGUwOGFjMTQ", "commit": {"author": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2023-02-27T20:04:27Z"}, "committer": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2023-02-28T14:49:54Z"}, "message": "Run dogfood on all packages before failing", "tree": {"sha": "e13ccc41e3e107fc531ccc2e24d765f63b8d3393", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e13ccc41e3e107fc531ccc2e24d765f63b8d3393"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69a11007762717d88701453bab64fcd24e08ac14", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69a11007762717d88701453bab64fcd24e08ac14", "html_url": "https://github.com/rust-lang/rust/commit/69a11007762717d88701453bab64fcd24e08ac14", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69a11007762717d88701453bab64fcd24e08ac14/comments", "author": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b65632b6ef737979d42f83664271d6baa8c0270", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b65632b6ef737979d42f83664271d6baa8c0270", "html_url": "https://github.com/rust-lang/rust/commit/8b65632b6ef737979d42f83664271d6baa8c0270"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "9643c2c970704a35dd343193a01807755dc9a8ae", "filename": "tests/dogfood.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/69a11007762717d88701453bab64fcd24e08ac14/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69a11007762717d88701453bab64fcd24e08ac14/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=69a11007762717d88701453bab64fcd24e08ac14", "patch": "@@ -7,6 +7,7 @@\n #![cfg_attr(feature = \"deny-warnings\", deny(warnings))]\n #![warn(rust_2018_idioms, unused_lifetimes)]\n \n+use itertools::Itertools;\n use std::path::PathBuf;\n use std::process::Command;\n use test_utils::IS_RUSTC_TEST_SUITE;\n@@ -19,17 +20,27 @@ fn dogfood_clippy() {\n         return;\n     }\n \n+    let mut failed_packages = Vec::new();\n+\n     // \"\" is the root package\n-    for package in &[\n+    for package in [\n         \"\",\n         \"clippy_dev\",\n         \"clippy_lints\",\n         \"clippy_utils\",\n         \"lintcheck\",\n         \"rustc_tools_util\",\n     ] {\n-        run_clippy_for_package(package, &[\"-D\", \"clippy::all\", \"-D\", \"clippy::pedantic\"]);\n+        if !run_clippy_for_package(package, &[\"-D\", \"clippy::all\", \"-D\", \"clippy::pedantic\"]) {\n+            failed_packages.push(if package.is_empty() { \"root\" } else { package });\n+        }\n     }\n+\n+    assert!(\n+        !failed_packages.is_empty(),\n+        \"Dogfood failed for packages `{}`\",\n+        failed_packages.iter().format(\", \"),\n+    )\n }\n \n #[test]\n@@ -71,7 +82,7 @@ fn run_metadata_collection_lint() {\n     run_clippy_for_package(\"clippy_lints\", &[\"-A\", \"unfulfilled_lint_expectations\"]);\n }\n \n-fn run_clippy_for_package(project: &str, args: &[&str]) {\n+fn run_clippy_for_package(project: &str, args: &[&str]) -> bool {\n     let root_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n \n     let mut command = Command::new(&*test_utils::CARGO_CLIPPY_PATH);\n@@ -107,5 +118,5 @@ fn run_clippy_for_package(project: &str, args: &[&str]) {\n     println!(\"stdout: {}\", String::from_utf8_lossy(&output.stdout));\n     println!(\"stderr: {}\", String::from_utf8_lossy(&output.stderr));\n \n-    assert!(output.status.success());\n+    output.status.success()\n }"}]}