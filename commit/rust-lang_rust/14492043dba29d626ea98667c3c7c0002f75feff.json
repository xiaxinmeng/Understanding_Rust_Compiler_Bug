{"sha": "14492043dba29d626ea98667c3c7c0002f75feff", "node_id": "C_kwDOAAsO6NoAKDE0NDkyMDQzZGJhMjlkNjI2ZWE5ODY2N2MzYzdjMDAwMmY3NWZlZmY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-09T19:36:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-09T19:36:05Z"}, "message": "Auto merge of #13749 - WaffleLapkin:remove_some_redudant_adjustment_hints, r=Veykril\n\nfix: Don't show duplicated adjustment hints for blocks, ifs and matches\n\nBefore:\n![2022-12-09_21-10](https://user-images.githubusercontent.com/38225716/206761100-5511d91b-2543-4166-aa2c-abdb8bad3613.png)\nAfter:\n![2022-12-09_21-22](https://user-images.githubusercontent.com/38225716/206761113-c58dbb5a-8616-4287-a3b4-69c13703294d.png)\n\n----\n\nI want to improve adjustment hints, this is the first step :)", "tree": {"sha": "88f652aca5998f82d71275c9591c080a00e02a06", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88f652aca5998f82d71275c9591c080a00e02a06"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/14492043dba29d626ea98667c3c7c0002f75feff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/14492043dba29d626ea98667c3c7c0002f75feff", "html_url": "https://github.com/rust-lang/rust/commit/14492043dba29d626ea98667c3c7c0002f75feff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/14492043dba29d626ea98667c3c7c0002f75feff/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a0296c2b3928a7aa07eae0a9e62f477b1c26a4d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/a0296c2b3928a7aa07eae0a9e62f477b1c26a4d8", "html_url": "https://github.com/rust-lang/rust/commit/a0296c2b3928a7aa07eae0a9e62f477b1c26a4d8"}, {"sha": "7c9a85bc43810bfd8b1b9657f24b5292098a49fa", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c9a85bc43810bfd8b1b9657f24b5292098a49fa", "html_url": "https://github.com/rust-lang/rust/commit/7c9a85bc43810bfd8b1b9657f24b5292098a49fa"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "08ce7be181110a9ee2c8227462dcbb17f58a738c", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 35, "deletions": 2, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/14492043dba29d626ea98667c3c7c0002f75feff/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14492043dba29d626ea98667c3c7c0002f75feff/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=14492043dba29d626ea98667c3c7c0002f75feff", "patch": "@@ -638,8 +638,12 @@ fn adjustment_hints(\n         return None;\n     }\n \n-    if let ast::Expr::ParenExpr(_) = expr {\n-        // These inherit from the inner expression which would result in duplicate hints\n+    // These inherit from the inner expression which would result in duplicate hints\n+    if let ast::Expr::ParenExpr(_)\n+    | ast::Expr::IfExpr(_)\n+    | ast::Expr::BlockExpr(_)\n+    | ast::Expr::MatchExpr(_) = expr\n+    {\n         return None;\n     }\n \n@@ -3083,6 +3087,33 @@ fn main() {\n    //^^^^^^^^^^^&\n    //^^^^^^^^^^^*\n     (&mut Struct).by_ref_mut();\n+\n+    // Check that block-like expressions don't duplicate hints\n+    let _: &mut [u32] = (&mut []);\n+                       //^^^^^^^<unsize>\n+                       //^^^^^^^&mut $\n+                       //^^^^^^^*\n+    let _: &mut [u32] = { &mut [] };\n+                        //^^^^^^^<unsize>\n+                        //^^^^^^^&mut $\n+                        //^^^^^^^*\n+    let _: &mut [u32] = unsafe { &mut [] };\n+                               //^^^^^^^<unsize>\n+                               //^^^^^^^&mut $\n+                               //^^^^^^^*\n+    let _: &mut [u32] = if true {\n+        &mut []\n+      //^^^^^^^<unsize>\n+      //^^^^^^^&mut $\n+      //^^^^^^^*\n+    } else {\n+        loop {}\n+      //^^^^^^^<never-to-any>\n+    };\n+    let _: &mut [u32] = match () { () => &mut [] }\n+                                       //^^^^^^^<unsize>\n+                                       //^^^^^^^&mut $\n+                                       //^^^^^^^*\n }\n \n #[derive(Copy, Clone)]\n@@ -3092,6 +3123,8 @@ impl Struct {\n     fn by_ref(&self) {}\n     fn by_ref_mut(&mut self) {}\n }\n+trait Trait {}\n+impl Trait for Struct {}\n \"#,\n         )\n     }"}]}