{"sha": "1a1f948deb2a08d678973cd958fdf82a149973a4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhMWY5NDhkZWIyYTA4ZDY3ODk3M2NkOTU4ZmRmODJhMTQ5OTczYTQ=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-03-07T16:27:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-07T16:27:29Z"}, "message": "Rollup merge of #69708 - estebank:tiny, r=petrochenkov\n\nOn mismatched delimiters, only point at empty blocks that are in the same line\n\nWe point at empty blocks when we have mismatched braces to detect cases where editors auto insert `}` after writing `{`. Gate this to only the case where the entire span is in the same line so we never point at explicitly empty blocks.", "tree": {"sha": "e7341d471466a2a84604cd5663fda00571831797", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e7341d471466a2a84604cd5663fda00571831797"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a1f948deb2a08d678973cd958fdf82a149973a4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeY8txCRBK7hj4Ov3rIwAAdHIIAIcPHhAqzIr2ByywXmy90kLM\nxS3tdZ0Ll7mUAASGk0NhOYSZQifNyz0eqcXnKXhjPiK4lTF5uV2T++AXVQ0R4KuL\ntM82hePJHeFQC5Xr3xixm+GdYw9ZiNtex7flzf+xK0CAQ0SYRTZYlv60nTq1QoaF\nFa70dUgTA29+7p4KqFqxC4aMMrPmwRb5oEsfUzaaH2dINtHEIQwtfK7VP99cL67i\nackMM9NDZWpt2NHsR7svmJ2jyVctZCQ0RM8jzxZ5r57p441Bz+UhwjCmFIXAtXOQ\nA39UMd8ilrYDbFD/SnIILup0zdluPM/BCgiki9Lc+CVJxCnOUc59qAezw94x57c=\n=zdd4\n-----END PGP SIGNATURE-----\n", "payload": "tree e7341d471466a2a84604cd5663fda00571831797\nparent 289c3a5f6e8813886d148b7c194c137b6ae29551\nparent 81f435dd37c5ec828b621d37ec15bf41a33ff89a\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1583598449 +0100\ncommitter GitHub <noreply@github.com> 1583598449 +0100\n\nRollup merge of #69708 - estebank:tiny, r=petrochenkov\n\nOn mismatched delimiters, only point at empty blocks that are in the same line\n\nWe point at empty blocks when we have mismatched braces to detect cases where editors auto insert `}` after writing `{`. Gate this to only the case where the entire span is in the same line so we never point at explicitly empty blocks.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a1f948deb2a08d678973cd958fdf82a149973a4", "html_url": "https://github.com/rust-lang/rust/commit/1a1f948deb2a08d678973cd958fdf82a149973a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a1f948deb2a08d678973cd958fdf82a149973a4/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "289c3a5f6e8813886d148b7c194c137b6ae29551", "url": "https://api.github.com/repos/rust-lang/rust/commits/289c3a5f6e8813886d148b7c194c137b6ae29551", "html_url": "https://github.com/rust-lang/rust/commit/289c3a5f6e8813886d148b7c194c137b6ae29551"}, {"sha": "81f435dd37c5ec828b621d37ec15bf41a33ff89a", "url": "https://api.github.com/repos/rust-lang/rust/commits/81f435dd37c5ec828b621d37ec15bf41a33ff89a", "html_url": "https://github.com/rust-lang/rust/commit/81f435dd37c5ec828b621d37ec15bf41a33ff89a"}], "stats": {"total": 17, "additions": 8, "deletions": 9}, "files": [{"sha": "b65b894172844ccbdccb8f1ad221079138365472", "filename": "src/librustc_parse/lexer/tokentrees.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1a1f948deb2a08d678973cd958fdf82a149973a4/src%2Flibrustc_parse%2Flexer%2Ftokentrees.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a1f948deb2a08d678973cd958fdf82a149973a4/src%2Flibrustc_parse%2Flexer%2Ftokentrees.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Flexer%2Ftokentrees.rs?ref=1a1f948deb2a08d678973cd958fdf82a149973a4", "patch": "@@ -40,6 +40,7 @@ struct TokenTreesReader<'a> {\n     /// Used only for error recovery when arriving to EOF with mismatched braces.\n     matching_delim_spans: Vec<(token::DelimToken, Span, Span)>,\n     last_unclosed_found_span: Option<Span>,\n+    /// Collect empty block spans that might have been auto-inserted by editors.\n     last_delim_empty_block_spans: FxHashMap<token::DelimToken, Span>,\n }\n \n@@ -138,7 +139,11 @@ impl<'a> TokenTreesReader<'a> {\n \n                         if tts.is_empty() {\n                             let empty_block_span = open_brace_span.to(close_brace_span);\n-                            self.last_delim_empty_block_spans.insert(delim, empty_block_span);\n+                            if !sm.is_multiline(empty_block_span) {\n+                                // Only track if the block is in the form of `{}`, otherwise it is\n+                                // likely that it was written on purpose.\n+                                self.last_delim_empty_block_spans.insert(delim, empty_block_span);\n+                            }\n                         }\n \n                         if self.open_braces.is_empty() {"}, {"sha": "f1be5dc5ba7fad55b4e5c2a814e65c02ad984cb8", "filename": "src/test/ui/parser/mismatched-delim-brace-empty-block.stderr", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1a1f948deb2a08d678973cd958fdf82a149973a4/src%2Ftest%2Fui%2Fparser%2Fmismatched-delim-brace-empty-block.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1a1f948deb2a08d678973cd958fdf82a149973a4/src%2Ftest%2Fui%2Fparser%2Fmismatched-delim-brace-empty-block.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fmismatched-delim-brace-empty-block.stderr?ref=1a1f948deb2a08d678973cd958fdf82a149973a4", "patch": "@@ -1,14 +1,8 @@\n error: unexpected closing delimiter: `}`\n   --> $DIR/mismatched-delim-brace-empty-block.rs:5:1\n    |\n-LL |   fn main() {\n-   |  ___________-\n-LL | |\n-LL | | }\n-   | |_- this block is empty, you might have not meant to close it\n-LL |       let _ = ();\n-LL |   }\n-   |   ^ unexpected closing delimiter\n+LL | }\n+   | ^ unexpected closing delimiter\n \n error: aborting due to previous error\n "}]}