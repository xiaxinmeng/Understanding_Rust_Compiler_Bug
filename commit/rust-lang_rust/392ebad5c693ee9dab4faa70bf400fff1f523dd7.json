{"sha": "392ebad5c693ee9dab4faa70bf400fff1f523dd7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5MmViYWQ1YzY5M2VlOWRhYjRmYWE3MGJmNDAwZmZmMWY1MjNkZDc=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-11-08T04:42:19Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-11-08T04:42:19Z"}, "message": "Rollup merge of #66123 - GuillaumeGomez:no-more-hidden-elements, r=Dylan-DPC\n\nNo more hidden elements\n\nFixes #66046.\n\nFollow-up of #66082.\n\nr? @kinnison", "tree": {"sha": "b49809055d0d2e58ff7be1c881d073e85c7a5153", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b49809055d0d2e58ff7be1c881d073e85c7a5153"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/392ebad5c693ee9dab4faa70bf400fff1f523dd7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdxPIrCRBK7hj4Ov3rIwAAdHIIAGQJxlC7xChvc/J8QZYyi/Wa\nsWUg3LtdRFfmyjA2vrllDBVgkup7y2tX4hGjjRWKCnV3uBRYU9woxZMZP30nP3yM\ncgmzq3T7cceBqzBbVfFkVj5ty+VpZyYl+fuzjiLj+pRlCi/c6RYhrk7oMheM/uWC\nJ19CjLpm445olnsZnfQG+fo9VJzt9kSQrnMaPnr5XrXhOHhqP0eQxVptroICYNet\nb09AUyJokL6ktbM0K7YicDPJ3Ok+0xQnntWCGWJOPLUyy6XXSdcdOYyd7OPiezrl\nmsQcEkgPpN7SbWr/PiVOuViQNg36ZZBWWCw3IfQUweunG0HvVzQv4zJH/MgbeKc=\n=FkrV\n-----END PGP SIGNATURE-----\n", "payload": "tree b49809055d0d2e58ff7be1c881d073e85c7a5153\nparent 996d94a9db8ec6f8c6feb4d11a0c53a1436457ff\nparent d4527b7e00de1e6ed5b22a3fdb99a4515f2ba482\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1573188139 +0900\ncommitter GitHub <noreply@github.com> 1573188139 +0900\n\nRollup merge of #66123 - GuillaumeGomez:no-more-hidden-elements, r=Dylan-DPC\n\nNo more hidden elements\n\nFixes #66046.\n\nFollow-up of #66082.\n\nr? @kinnison\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/392ebad5c693ee9dab4faa70bf400fff1f523dd7", "html_url": "https://github.com/rust-lang/rust/commit/392ebad5c693ee9dab4faa70bf400fff1f523dd7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/392ebad5c693ee9dab4faa70bf400fff1f523dd7/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "996d94a9db8ec6f8c6feb4d11a0c53a1436457ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/996d94a9db8ec6f8c6feb4d11a0c53a1436457ff", "html_url": "https://github.com/rust-lang/rust/commit/996d94a9db8ec6f8c6feb4d11a0c53a1436457ff"}, {"sha": "d4527b7e00de1e6ed5b22a3fdb99a4515f2ba482", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4527b7e00de1e6ed5b22a3fdb99a4515f2ba482", "html_url": "https://github.com/rust-lang/rust/commit/d4527b7e00de1e6ed5b22a3fdb99a4515f2ba482"}], "stats": {"total": 66, "additions": 51, "deletions": 15}, "files": [{"sha": "04c0a0f005b8216ed05e648b12038fd06b030e2f", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 51, "deletions": 11, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/392ebad5c693ee9dab4faa70bf400fff1f523dd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/392ebad5c693ee9dab4faa70bf400fff1f523dd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=392ebad5c693ee9dab4faa70bf400fff1f523dd7", "patch": "@@ -3,7 +3,7 @@\n \n // Local js definitions:\n /* global addClass, getCurrentValue, hasClass */\n-/* global isHidden, onEach, removeClass, updateLocalStorage */\n+/* global onEach, removeClass, updateLocalStorage */\n \n if (!String.prototype.startsWith) {\n     String.prototype.startsWith = function(searchString, position) {\n@@ -161,17 +161,18 @@ function getSearchElement() {\n         return window.history && typeof window.history.pushState === \"function\";\n     }\n \n+    function isHidden(elem) {\n+        return elem.offsetHeight === 0;\n+    }\n+\n     var main = document.getElementById(\"main\");\n+    var savedHash = \"\";\n \n-    function onHashChange(ev) {\n-        // If we're in mobile mode, we should hide the sidebar in any case.\n-        hideSidebar();\n-        var match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n-        if (match) {\n-            return highlightSourceLines(match, ev);\n-        }\n+    function handleHashes(ev) {\n         var search = getSearchElement();\n         if (ev !== null && search && !hasClass(search, \"hidden\") && ev.newURL) {\n+            // This block occurs when clicking on an element in the navbar while\n+            // in a search.\n             addClass(search, \"hidden\");\n             removeClass(main, \"hidden\");\n             var hash = ev.newURL.slice(ev.newURL.indexOf(\"#\") + 1);\n@@ -183,6 +184,35 @@ function getSearchElement() {\n                 elem.scrollIntoView();\n             }\n         }\n+        // This part is used in case an element is not visible.\n+        if (savedHash !== window.location.hash) {\n+            savedHash = window.location.hash;\n+            if (savedHash.length === 0) {\n+                return;\n+            }\n+            var elem = document.getElementById(savedHash.slice(1)); // we remove the '#'\n+            if (!elem || !isHidden(elem)) {\n+                return;\n+            }\n+            var parent = elem.parentNode;\n+            if (parent && hasClass(parent, \"impl-items\")) {\n+                // In case this is a trait implementation item, we first need to toggle\n+                // the \"Show hidden undocumented items\".\n+                onEachLazy(parent.getElementsByClassName(\"collapsed\"), function(e) {\n+                    if (e.parentNode === parent) {\n+                        // Only click on the toggle we're looking for.\n+                        e.click();\n+                        return true;\n+                    }\n+                });\n+                if (isHidden(elem)) {\n+                    // The whole parent is collapsed. We need to click on its toggle as well!\n+                    if (hasClass(parent.lastElementChild, \"collapse-toggle\")) {\n+                        parent.lastElementChild.click();\n+                    }\n+                }\n+            }\n+        }\n     }\n \n     function highlightSourceLines(match, ev) {\n@@ -228,6 +258,16 @@ function getSearchElement() {\n         }\n     }\n \n+    function onHashChange(ev) {\n+        // If we're in mobile mode, we should hide the sidebar in any case.\n+        hideSidebar();\n+        var match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n+        if (match) {\n+            return highlightSourceLines(match, ev);\n+        }\n+        handleHashes(ev);\n+    }\n+\n     function expandSection(id) {\n         var elem = document.getElementById(id);\n         if (elem && isHidden(elem)) {\n@@ -246,9 +286,6 @@ function getSearchElement() {\n         }\n     }\n \n-    highlightSourceLines();\n-    window.onhashchange = onHashChange;\n-\n     // Gets the human-readable string for the virtual-key code of the\n     // given KeyboardEvent, ev.\n     //\n@@ -2639,6 +2676,9 @@ function getSearchElement() {\n         insertAfter(popup, getSearchElement());\n     }\n \n+    onHashChange();\n+    window.onhashchange = onHashChange;\n+\n     buildHelperPopup();\n }());\n "}, {"sha": "d142d99ac704d94f55ac409de757b1451be8f7ef", "filename": "src/librustdoc/html/static/storage.js", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/392ebad5c693ee9dab4faa70bf400fff1f523dd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "raw_url": "https://github.com/rust-lang/rust/raw/392ebad5c693ee9dab4faa70bf400fff1f523dd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js?ref=392ebad5c693ee9dab4faa70bf400fff1f523dd7", "patch": "@@ -24,10 +24,6 @@ function removeClass(elem, className) {\n     elem.classList.remove(className);\n }\n \n-function isHidden(elem) {\n-    return elem.offsetParent === null;\n-}\n-\n function onEach(arr, func, reversed) {\n     if (arr && arr.length > 0 && func) {\n         var length = arr.length;"}]}