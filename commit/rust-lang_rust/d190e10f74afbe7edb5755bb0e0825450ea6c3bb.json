{"sha": "d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxOTBlMTBmNzRhZmJlN2VkYjU3NTViYjBlMDgyNTQ1MGVhNmMzYmI=", "commit": {"author": {"name": "mibac138", "email": "5672750+mibac138@users.noreply.github.com", "date": "2020-05-03T16:56:52Z"}, "committer": {"name": "mibac138", "email": "5672750+mibac138@users.noreply.github.com", "date": "2020-05-19T18:40:47Z"}, "message": "Add error recovery for `use foo::self`", "tree": {"sha": "9b385884079dd5da02dcace11b49662c32690744", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9b385884079dd5da02dcace11b49662c32690744"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "html_url": "https://github.com/rust-lang/rust/commit/d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/comments", "author": {"login": "mibac138", "id": 5672750, "node_id": "MDQ6VXNlcjU2NzI3NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5672750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mibac138", "html_url": "https://github.com/mibac138", "followers_url": "https://api.github.com/users/mibac138/followers", "following_url": "https://api.github.com/users/mibac138/following{/other_user}", "gists_url": "https://api.github.com/users/mibac138/gists{/gist_id}", "starred_url": "https://api.github.com/users/mibac138/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mibac138/subscriptions", "organizations_url": "https://api.github.com/users/mibac138/orgs", "repos_url": "https://api.github.com/users/mibac138/repos", "events_url": "https://api.github.com/users/mibac138/events{/privacy}", "received_events_url": "https://api.github.com/users/mibac138/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mibac138", "id": 5672750, "node_id": "MDQ6VXNlcjU2NzI3NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5672750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mibac138", "html_url": "https://github.com/mibac138", "followers_url": "https://api.github.com/users/mibac138/followers", "following_url": "https://api.github.com/users/mibac138/following{/other_user}", "gists_url": "https://api.github.com/users/mibac138/gists{/gist_id}", "starred_url": "https://api.github.com/users/mibac138/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mibac138/subscriptions", "organizations_url": "https://api.github.com/users/mibac138/orgs", "repos_url": "https://api.github.com/users/mibac138/repos", "events_url": "https://api.github.com/users/mibac138/events{/privacy}", "received_events_url": "https://api.github.com/users/mibac138/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84a44218ad9dd0e278d934a72975dbad4f88c235", "url": "https://api.github.com/repos/rust-lang/rust/commits/84a44218ad9dd0e278d934a72975dbad4f88c235", "html_url": "https://github.com/rust-lang/rust/commit/84a44218ad9dd0e278d934a72975dbad4f88c235"}], "stats": {"total": 93, "additions": 89, "deletions": 4}, "files": [{"sha": "988ec3d4374e0f375765d8bbc05e2741c09f3a1d", "filename": "src/librustc_resolve/build_reduced_graph.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -426,7 +426,7 @@ impl<'a, 'b> BuildReducedGraphVisitor<'a, 'b> {\n                             return;\n                         }\n \n-                        // Replace `use foo::self;` with `use foo;`\n+                        // Replace `use foo::{ self };` with `use foo;`\n                         source = module_path.pop().unwrap();\n                         if rename.is_none() {\n                             ident = source.ident;\n@@ -454,6 +454,14 @@ impl<'a, 'b> BuildReducedGraphVisitor<'a, 'b> {\n                                 span_with_rename,\n                             },\n                         );\n+\n+                        // Error recovery: replace `use foo::self;` with `use foo;`\n+                        if let Some(parent) = module_path.pop() {\n+                            source = parent;\n+                            if rename.is_none() {\n+                                ident = source.ident;\n+                            }\n+                        }\n                     }\n \n                     // Disallow `use $crate;`"}, {"sha": "2dc4331ced775f2490e679b2f866938863511b1c", "filename": "src/test/ui/issues/issue-45829/import-self.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fissues%2Fissue-45829%2Fimport-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fissues%2Fissue-45829%2Fimport-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-45829%2Fimport-self.rs?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -9,7 +9,7 @@ use foo::{self};\n use foo as self;\n //~^ ERROR expected identifier\n \n-use foo::self;\n+use foo::self; //~ ERROR is defined multiple times\n //~^ ERROR `self` imports are only allowed within a { } list\n \n use foo::A;"}, {"sha": "2ae2713b00496f34cfce2a1f2e689cc52bfa542e", "filename": "src/test/ui/issues/issue-45829/import-self.stderr", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fissues%2Fissue-45829%2Fimport-self.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fissues%2Fissue-45829%2Fimport-self.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-45829%2Fimport-self.stderr?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -34,6 +34,21 @@ help: you can use `as` to change the binding name of the import\n LL | use foo::{self as other_foo};\n    |           ^^^^^^^^^^^^^^^^^\n \n+error[E0255]: the name `foo` is defined multiple times\n+  --> $DIR/import-self.rs:12:5\n+   |\n+LL | mod foo {\n+   | ------- previous definition of the module `foo` here\n+...\n+LL | use foo::self;\n+   |     ^^^^^^^^^ `foo` reimported here\n+   |\n+   = note: `foo` must be defined only once in the type namespace of this module\n+help: you can use `as` to change the binding name of the import\n+   |\n+LL | use foo as other_foo;\n+   |     ^^^^^^^^^^^^^^^^\n+\n error[E0252]: the name `A` is defined multiple times\n   --> $DIR/import-self.rs:16:11\n    |\n@@ -48,7 +63,7 @@ help: you can use `as` to change the binding name of the import\n LL | use foo::{self as OtherA};\n    |           ^^^^^^^^^^^^^^\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 5 previous errors\n \n Some errors have detailed explanations: E0252, E0255, E0429.\n For more information about an error, try `rustc --explain E0252`."}, {"sha": "e01c2cbf732a6e37c6ee4ac2c4eafb7b2fa2434c", "filename": "src/test/ui/use/use-mod/use-mod-4.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-4.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-4.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-4.stderr?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -32,7 +32,7 @@ error[E0432]: unresolved import `foo`\n   --> $DIR/use-mod-4.rs:1:5\n    |\n LL | use foo::self;\n-   |     ^^^ maybe a missing crate `foo`?\n+   |     ^^^^^^^^^ no `foo` in the root\n \n error: aborting due to 3 previous errors\n "}, {"sha": "df5b423ec57e6ad195bb6c621f7d58447a64e8fc", "filename": "src/test/ui/use/use-mod/use-mod-5.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-5.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-5.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-5.rs?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -0,0 +1,13 @@\n+mod foo {\n+    pub mod bar {\n+        pub fn drop() {}\n+    }\n+}\n+\n+use foo::bar::self;\n+//~^ ERROR `self` imports are only allowed within a { } list\n+\n+fn main() {\n+    // Because of error recovery this shouldn't error\n+    bar::drop();\n+}"}, {"sha": "859547fbc4d266e57249200418f31d65608e7b75", "filename": "src/test/ui/use/use-mod/use-mod-5.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-5.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-5.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-5.stderr?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -0,0 +1,18 @@\n+error[E0429]: `self` imports are only allowed within a { } list\n+  --> $DIR/use-mod-5.rs:7:13\n+   |\n+LL | use foo::bar::self;\n+   |             ^^^^^^\n+   |\n+help: Remove `::self`..\n+   |\n+LL | use foo::bar;\n+   |            --\n+help: ..or add braces around `self`\n+   |\n+LL | use foo::bar::{self};\n+   |               ^    ^\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0429`."}, {"sha": "1f8777daca491d5c8b4b86e6d589308771d633b5", "filename": "src/test/ui/use/use-mod/use-mod-6.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-6.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-6.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-6.rs?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -0,0 +1,13 @@\n+mod foo {\n+    pub mod bar {\n+        pub fn drop() {}\n+    }\n+}\n+\n+use foo::bar::self as abc;\n+//~^ ERROR `self` imports are only allowed within a { } list\n+\n+fn main() {\n+    // Because of error recovery this shouldn't error\n+    abc::drop();\n+}"}, {"sha": "0042325229a2a874363a8ee17238c98aef0dcff5", "filename": "src/test/ui/use/use-mod/use-mod-6.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-6.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d190e10f74afbe7edb5755bb0e0825450ea6c3bb/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-6.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse%2Fuse-mod%2Fuse-mod-6.stderr?ref=d190e10f74afbe7edb5755bb0e0825450ea6c3bb", "patch": "@@ -0,0 +1,18 @@\n+error[E0429]: `self` imports are only allowed within a { } list\n+  --> $DIR/use-mod-6.rs:7:13\n+   |\n+LL | use foo::bar::self as abc;\n+   |             ^^^^^^\n+   |\n+help: Remove `::self`..\n+   |\n+LL | use foo::bar as abc;\n+   |            --\n+help: ..or add braces around `self`\n+   |\n+LL | use foo::bar::{self as abc};\n+   |               ^           ^\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0429`."}]}