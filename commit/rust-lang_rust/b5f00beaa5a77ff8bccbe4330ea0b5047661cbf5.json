{"sha": "b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1ZjAwYmVhYTVhNzdmZjhiY2NiZTQzMzBlYTBiNTA0NzY2MWNiZjU=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-12-08T11:19:53Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-12-21T18:20:41Z"}, "message": "parse_generic_bounds: account for negative lifetime bounds", "tree": {"sha": "25c6f4b6e62c7db4c1084bd784ba977c4fb687fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25c6f4b6e62c7db4c1084bd784ba977c4fb687fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "html_url": "https://github.com/rust-lang/rust/commit/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4625ba4872e17a98ea11940fff0e50b3b880b815", "url": "https://api.github.com/repos/rust-lang/rust/commits/4625ba4872e17a98ea11940fff0e50b3b880b815", "html_url": "https://github.com/rust-lang/rust/commit/4625ba4872e17a98ea11940fff0e50b3b880b815"}], "stats": {"total": 131, "additions": 83, "deletions": 48}, "files": [{"sha": "db9a0ada525b1e25bd6b1ee25d2185c809511358", "filename": "src/librustc_parse/parser/ty.rs", "status": "modified", "additions": 16, "deletions": 19, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Flibrustc_parse%2Fparser%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Flibrustc_parse%2Fparser%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Fparser%2Fty.rs?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -375,9 +375,9 @@ impl<'a> Parser<'a> {\n             let last_span = *negative_bounds.last().unwrap();\n             let mut err = self.struct_span_err(\n                 negative_bounds,\n-                \"negative trait bounds are not supported\",\n+                \"negative bounds are not supported\",\n             );\n-            err.span_label(last_span, \"negative trait bounds are not supported\");\n+            err.span_label(last_span, \"negative bounds are not supported\");\n             if let Some(bound_list) = colon_span {\n                 let bound_list = bound_list.to(self.prev_span);\n                 let mut new_bound_list = String::new();\n@@ -392,7 +392,7 @@ impl<'a> Parser<'a> {\n                 }\n                 err.span_suggestion_hidden(\n                     bound_list,\n-                    &format!(\"remove the trait bound{}\", pluralize!(negative_bounds_len)),\n+                    &format!(\"remove the bound{}\", pluralize!(negative_bounds_len)),\n                     new_bound_list,\n                     Applicability::MachineApplicable,\n                 );\n@@ -418,25 +418,23 @@ impl<'a> Parser<'a> {\n     /// ```\n     /// BOUND = TY_BOUND | LT_BOUND\n     /// ```\n-    fn parse_generic_bound(\n-        &mut self,\n-    ) -> PResult<'a, Result<GenericBound, Span>> {\n+    fn parse_generic_bound(&mut self) -> PResult<'a, Result<GenericBound, Span>> {\n         let anchor_lo = self.prev_span;\n         let lo = self.token.span;\n         let has_parens = self.eat(&token::OpenDelim(token::Paren));\n         let inner_lo = self.token.span;\n         let is_negative = self.eat(&token::Not);\n         let question = self.eat(&token::Question).then_some(self.prev_span);\n-        if self.token.is_lifetime() {\n-            Ok(Ok(self.parse_generic_lt_bound(lo, inner_lo, has_parens, question)?))\n+        let bound = if self.token.is_lifetime() {\n+            self.parse_generic_lt_bound(lo, inner_lo, has_parens, question)?\n         } else {\n-            let (poly_span, bound) = self.parse_generic_ty_bound(lo, has_parens, question)?;\n-            if is_negative {\n-                Ok(Err(anchor_lo.to(poly_span)))\n-            } else {\n-                Ok(Ok(bound))\n-            }\n-        }\n+            self.parse_generic_ty_bound(lo, has_parens, question)?\n+        };\n+        Ok(if is_negative {\n+            Err(anchor_lo.to(self.prev_span))\n+        } else {\n+            Ok(bound)\n+        })\n     }\n \n     /// Parses a lifetime (\"outlives\") bound, e.g. `'a`, according to:\n@@ -497,16 +495,15 @@ impl<'a> Parser<'a> {\n         lo: Span,\n         has_parens: bool,\n         question: Option<Span>,\n-    ) -> PResult<'a, (Span, GenericBound)> {\n+    ) -> PResult<'a, GenericBound> {\n         let lifetime_defs = self.parse_late_bound_lifetime_defs()?;\n         let path = self.parse_path(PathStyle::Type)?;\n         if has_parens {\n             self.expect(&token::CloseDelim(token::Paren))?;\n         }\n-        let poly_span = lo.to(self.prev_span);\n-        let poly_trait = PolyTraitRef::new(lifetime_defs, path, poly_span);\n+        let poly_trait = PolyTraitRef::new(lifetime_defs, path, lo.to(self.prev_span));\n         let modifier = question.map_or(TraitBoundModifier::None, |_| TraitBoundModifier::Maybe);\n-        Ok((poly_span, GenericBound::Trait(poly_trait, modifier)))\n+        Ok(GenericBound::Trait(poly_trait, modifier))\n     }\n \n     pub(super) fn parse_late_bound_lifetime_defs(&mut self) -> PResult<'a, Vec<GenericParam>> {"}, {"sha": "4350d7e5b403bcabc727c7c816bfae23f248eada", "filename": "src/test/ui/issues/issue-58857.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fissues%2Fissue-58857.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fissues%2Fissue-58857.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-58857.rs?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -2,6 +2,6 @@ struct Conj<A> {a : A}\n trait Valid {}\n \n impl<A: !Valid> Conj<A>{}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n \n fn main() {}"}, {"sha": "9bc80cc270b0f47b1a608dd32b35082d4455e15c", "filename": "src/test/ui/issues/issue-58857.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fissues%2Fissue-58857.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fissues%2Fissue-58857.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-58857.stderr?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -1,10 +1,10 @@\n-error: negative trait bounds are not supported\n+error: negative bounds are not supported\n   --> $DIR/issue-58857.rs:4:7\n    |\n LL | impl<A: !Valid> Conj<A>{}\n-   |       ^^^^^^^^ negative trait bounds are not supported\n+   |       ^^^^^^^^ negative bounds are not supported\n    |\n-   = help: remove the trait bound\n+   = help: remove the bound\n \n error: aborting due to previous error\n "}, {"sha": "ed885ae14356633e0043e1fd0fa7ed1ff9c5e622", "filename": "src/test/ui/parser/issue-33418.fixed", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-33418.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-33418.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-33418.fixed?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -1,15 +1,15 @@\n // run-rustfix\n \n trait Tr {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr2: SuperA {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr3: SuperB {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr4: SuperB + SuperD {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr5 {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n \n trait SuperA {}\n trait SuperB {}"}, {"sha": "9934284abfbbeb11d9dd3b8b4e395d8e9ed6bbb4", "filename": "src/test/ui/parser/issue-33418.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-33418.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-33418.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-33418.rs?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -1,17 +1,17 @@\n // run-rustfix\n \n trait Tr: !SuperA {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr2: SuperA + !SuperB {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr3: !SuperA + SuperB {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr4: !SuperA + SuperB\n     + !SuperC + SuperD {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n trait Tr5: !SuperA\n     + !SuperB {}\n-//~^ ERROR negative trait bounds are not supported\n+//~^ ERROR negative bounds are not supported\n \n trait SuperA {}\n trait SuperB {}"}, {"sha": "7f361dbe2718fc409dd92019ef90b51db9054148", "filename": "src/test/ui/parser/issue-33418.stderr", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-33418.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-33418.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-33418.stderr?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -1,46 +1,46 @@\n-error: negative trait bounds are not supported\n+error: negative bounds are not supported\n   --> $DIR/issue-33418.rs:3:9\n    |\n LL | trait Tr: !SuperA {}\n-   |         ^^^^^^^^^ negative trait bounds are not supported\n+   |         ^^^^^^^^^ negative bounds are not supported\n    |\n-   = help: remove the trait bound\n+   = help: remove the bound\n \n-error: negative trait bounds are not supported\n+error: negative bounds are not supported\n   --> $DIR/issue-33418.rs:5:19\n    |\n LL | trait Tr2: SuperA + !SuperB {}\n-   |                   ^^^^^^^^^ negative trait bounds are not supported\n+   |                   ^^^^^^^^^ negative bounds are not supported\n    |\n-   = help: remove the trait bound\n+   = help: remove the bound\n \n-error: negative trait bounds are not supported\n+error: negative bounds are not supported\n   --> $DIR/issue-33418.rs:7:10\n    |\n LL | trait Tr3: !SuperA + SuperB {}\n-   |          ^^^^^^^^^ negative trait bounds are not supported\n+   |          ^^^^^^^^^ negative bounds are not supported\n    |\n-   = help: remove the trait bound\n+   = help: remove the bound\n \n-error: negative trait bounds are not supported\n+error: negative bounds are not supported\n   --> $DIR/issue-33418.rs:9:10\n    |\n LL | trait Tr4: !SuperA + SuperB\n    |          ^^^^^^^^^\n LL |     + !SuperC + SuperD {}\n-   |     ^^^^^^^^^ negative trait bounds are not supported\n+   |     ^^^^^^^^^ negative bounds are not supported\n    |\n-   = help: remove the trait bounds\n+   = help: remove the bounds\n \n-error: negative trait bounds are not supported\n+error: negative bounds are not supported\n   --> $DIR/issue-33418.rs:12:10\n    |\n LL | trait Tr5: !SuperA\n    |          ^^^^^^^^^\n LL |     + !SuperB {}\n-   |     ^^^^^^^^^ negative trait bounds are not supported\n+   |     ^^^^^^^^^ negative bounds are not supported\n    |\n-   = help: remove the trait bounds\n+   = help: remove the bounds\n \n error: aborting due to 5 previous errors\n "}, {"sha": "5a109ba7c6894f25600642ddefe2eef5117d39ef", "filename": "src/test/ui/parser/issue-67146-negative-outlives-bound-syntactic-fail.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-67146-negative-outlives-bound-syntactic-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-67146-negative-outlives-bound-syntactic-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-67146-negative-outlives-bound-syntactic-fail.rs?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -0,0 +1,12 @@\n+// In this regression test for #67146, we check that the\n+// negative outlives bound `!'a` is rejected by the parser.\n+// This regression was first introduced in PR #57364.\n+\n+fn main() {}\n+\n+fn f1<T: !'static>() {}\n+//~^ ERROR negative bounds are not supported\n+fn f2<'a, T: Ord + !'a>() {}\n+//~^ ERROR negative bounds are not supported\n+fn f3<'a, T: !'a + Ord>() {}\n+//~^ ERROR negative bounds are not supported"}, {"sha": "74437c1a0081a858b3b2ca9ce6a56e981ecbdc88", "filename": "src/test/ui/parser/issue-67146-negative-outlives-bound-syntactic-fail.stderr", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-67146-negative-outlives-bound-syntactic-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5/src%2Ftest%2Fui%2Fparser%2Fissue-67146-negative-outlives-bound-syntactic-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-67146-negative-outlives-bound-syntactic-fail.stderr?ref=b5f00beaa5a77ff8bccbe4330ea0b5047661cbf5", "patch": "@@ -0,0 +1,26 @@\n+error: negative bounds are not supported\n+  --> $DIR/issue-67146-negative-outlives-bound-syntactic-fail.rs:7:8\n+   |\n+LL | fn f1<T: !'static>() {}\n+   |        ^^^^^^^^^^ negative bounds are not supported\n+   |\n+   = help: remove the bound\n+\n+error: negative bounds are not supported\n+  --> $DIR/issue-67146-negative-outlives-bound-syntactic-fail.rs:9:18\n+   |\n+LL | fn f2<'a, T: Ord + !'a>() {}\n+   |                  ^^^^^ negative bounds are not supported\n+   |\n+   = help: remove the bound\n+\n+error: negative bounds are not supported\n+  --> $DIR/issue-67146-negative-outlives-bound-syntactic-fail.rs:11:12\n+   |\n+LL | fn f3<'a, T: !'a + Ord>() {}\n+   |            ^^^^^ negative bounds are not supported\n+   |\n+   = help: remove the bound\n+\n+error: aborting due to 3 previous errors\n+"}]}