{"sha": "73fd3497d4cc65c733cc1848bea363c00cb87878", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczZmQzNDk3ZDRjYzY1YzczM2NjMTg0OGJlYTM2M2MwMGNiODc4Nzg=", "commit": {"author": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2019-05-24T06:55:33Z"}, "committer": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2019-05-24T07:11:04Z"}, "message": "Deprecate `FnBox`. `Box<dyn FnOnce()>` can be called directly, since 1.35\n\nFCP completion: https://github.com/rust-lang/rust/issues/28796#issuecomment-439731515", "tree": {"sha": "1e1e4977b26569d2cbdcb8e4711927e879ee36db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e1e4977b26569d2cbdcb8e4711927e879ee36db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73fd3497d4cc65c733cc1848bea363c00cb87878", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73fd3497d4cc65c733cc1848bea363c00cb87878", "html_url": "https://github.com/rust-lang/rust/commit/73fd3497d4cc65c733cc1848bea363c00cb87878", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73fd3497d4cc65c733cc1848bea363c00cb87878/comments", "author": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8fc09be39fd265bcd20b66043a2142c25bfc22e", "url": "https://api.github.com/repos/rust-lang/rust/commits/a8fc09be39fd265bcd20b66043a2142c25bfc22e", "html_url": "https://github.com/rust-lang/rust/commit/a8fc09be39fd265bcd20b66043a2142c25bfc22e"}], "stats": {"total": 83, "additions": 52, "deletions": 31}, "files": [{"sha": "bf8f5b8b91a1eccf60d13d2c6d40e31d2eb904dc", "filename": "src/liballoc/boxed.rs", "status": "modified", "additions": 33, "deletions": 9, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Fliballoc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Fliballoc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fboxed.rs?ref=73fd3497d4cc65c733cc1848bea363c00cb87878", "patch": "@@ -759,13 +759,14 @@ impl<A, F: Fn<A> + ?Sized> Fn<A> for Box<F> {\n     }\n }\n \n+/// `FnBox` is deprecated and will be removed.\n+/// `Box<dyn FnOnce()>` can be called directly, since Rust 1.35.0.\n+///\n /// `FnBox` is a version of the `FnOnce` intended for use with boxed\n-/// closure objects. The idea is that where one would normally store a\n-/// `Box<dyn FnOnce()>` in a data structure, you should use\n+/// closure objects. The idea was that where one would normally store a\n+/// `Box<dyn FnOnce()>` in a data structure, you whould use\n /// `Box<dyn FnBox()>`. The two traits behave essentially the same, except\n-/// that a `FnBox` closure can only be called if it is boxed. (Note\n-/// that `FnBox` may be deprecated in the future if `Box<dyn FnOnce()>`\n-/// closures become directly usable.)\n+/// that a `FnBox` closure can only be called if it is boxed.\n ///\n /// # Examples\n ///\n@@ -777,6 +778,7 @@ impl<A, F: Fn<A> + ?Sized> Fn<A> for Box<F> {\n ///\n /// ```\n /// #![feature(fnbox)]\n+/// #![allow(deprecated)]\n ///\n /// use std::boxed::FnBox;\n /// use std::collections::HashMap;\n@@ -796,16 +798,38 @@ impl<A, F: Fn<A> + ?Sized> Fn<A> for Box<F> {\n ///     }\n /// }\n /// ```\n+///\n+/// In Rust 1.35.0 or later, use `FnOnce`, `FnMut`, or `Fn` instead:\n+///\n+/// ```\n+/// use std::collections::HashMap;\n+///\n+/// fn make_map() -> HashMap<i32, Box<dyn FnOnce() -> i32>> {\n+///     let mut map: HashMap<i32, Box<dyn FnOnce() -> i32>> = HashMap::new();\n+///     map.insert(1, Box::new(|| 22));\n+///     map.insert(2, Box::new(|| 44));\n+///     map\n+/// }\n+///\n+/// fn main() {\n+///     let mut map = make_map();\n+///     for i in &[1, 2] {\n+///         let f = map.remove(&i).unwrap();\n+///         assert_eq!(f(), i * 22);\n+///     }\n+/// }\n+/// ```\n #[rustc_paren_sugar]\n-#[unstable(feature = \"fnbox\",\n-           reason = \"will be deprecated if and when `Box<FnOnce>` becomes usable\", issue = \"28796\")]\n+#[unstable(feature = \"fnbox\", issue = \"28796\")]\n+#[rustc_deprecated(reason = \"use `FnOnce`, `FnMut`, or `Fn` instead\", since = \"1.37.0\")]\n pub trait FnBox<A>: FnOnce<A> {\n     /// Performs the call operation.\n     fn call_box(self: Box<Self>, args: A) -> Self::Output;\n }\n \n-#[unstable(feature = \"fnbox\",\n-           reason = \"will be deprecated if and when `Box<FnOnce>` becomes usable\", issue = \"28796\")]\n+#[unstable(feature = \"fnbox\", issue = \"28796\")]\n+#[rustc_deprecated(reason = \"use `FnOnce`, `FnMut`, or `Fn` instead\", since = \"1.37.0\")]\n+#[allow(deprecated, deprecated_in_future)]\n impl<A, F> FnBox<A> for F\n     where F: FnOnce<A>\n {"}, {"sha": "74a4dd5d8515b3825743b6b1f1f971a58cae4093", "filename": "src/test/run-pass/unsized-locals/fnbox-compat.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Ftest%2Frun-pass%2Funsized-locals%2Ffnbox-compat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Ftest%2Frun-pass%2Funsized-locals%2Ffnbox-compat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Funsized-locals%2Ffnbox-compat.rs?ref=73fd3497d4cc65c733cc1848bea363c00cb87878", "patch": "@@ -1,4 +1,5 @@\n #![feature(fnbox)]\n+#![allow(deprecated, deprecated_in_future)]\n \n use std::boxed::FnBox;\n "}, {"sha": "c242b6c2c20a28047a87918c1ebe2385284ec52c", "filename": "src/test/ui/confuse-field-and-method/issue-2392.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Ftest%2Fui%2Fconfuse-field-and-method%2Fissue-2392.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Ftest%2Fui%2Fconfuse-field-and-method%2Fissue-2392.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconfuse-field-and-method%2Fissue-2392.rs?ref=73fd3497d4cc65c733cc1848bea363c00cb87878", "patch": "@@ -1,7 +1,3 @@\n-#![feature(core, fnbox)]\n-\n-use std::boxed::FnBox;\n-\n struct FuncContainer {\n     f1: fn(data: u8),\n     f2: extern \"C\" fn(data: u8),\n@@ -18,7 +14,7 @@ struct Obj<F> where F: FnOnce() -> u32 {\n }\n \n struct BoxedObj {\n-    boxed_closure: Box<FnBox() -> u32>,\n+    boxed_closure: Box<FnOnce() -> u32>,\n }\n \n struct Wrapper<F> where F: FnMut() -> u32 {\n@@ -29,8 +25,8 @@ fn func() -> u32 {\n     0\n }\n \n-fn check_expression() -> Obj<Box<FnBox() -> u32>> {\n-    Obj { closure: Box::new(|| 42_u32) as Box<FnBox() -> u32>, not_closure: 42 }\n+fn check_expression() -> Obj<Box<FnOnce() -> u32>> {\n+    Obj { closure: Box::new(|| 42_u32) as Box<FnOnce() -> u32>, not_closure: 42 }\n }\n \n fn main() {\n@@ -48,7 +44,7 @@ fn main() {\n     let boxed_fn = BoxedObj { boxed_closure: Box::new(func) };\n     boxed_fn.boxed_closure();//~ ERROR no method named `boxed_closure` found\n \n-    let boxed_closure = BoxedObj { boxed_closure: Box::new(|| 42_u32) as Box<FnBox() -> u32> };\n+    let boxed_closure = BoxedObj { boxed_closure: Box::new(|| 42_u32) as Box<FnOnce() -> u32> };\n     boxed_closure.boxed_closure();//~ ERROR no method named `boxed_closure` found\n \n     // test expression writing in the notes"}, {"sha": "351cfef1b53ea0517de30663cd7a9b88ad62926e", "filename": "src/test/ui/confuse-field-and-method/issue-2392.stderr", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Ftest%2Fui%2Fconfuse-field-and-method%2Fissue-2392.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/73fd3497d4cc65c733cc1848bea363c00cb87878/src%2Ftest%2Fui%2Fconfuse-field-and-method%2Fissue-2392.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconfuse-field-and-method%2Fissue-2392.stderr?ref=73fd3497d4cc65c733cc1848bea363c00cb87878", "patch": "@@ -1,5 +1,5 @@\n-error[E0599]: no method named `closure` found for type `Obj<[closure@$DIR/issue-2392.rs:39:36: 39:41]>` in the current scope\n-  --> $DIR/issue-2392.rs:40:15\n+error[E0599]: no method named `closure` found for type `Obj<[closure@$DIR/issue-2392.rs:35:36: 35:41]>` in the current scope\n+  --> $DIR/issue-2392.rs:36:15\n    |\n LL | struct Obj<F> where F: FnOnce() -> u32 {\n    | -------------------------------------- method `closure` not found for this\n@@ -11,8 +11,8 @@ help: to call the function stored in `closure`, surround the field access with p\n LL |     (o_closure.closure)();\n    |     ^                 ^\n \n-error[E0599]: no method named `not_closure` found for type `Obj<[closure@$DIR/issue-2392.rs:39:36: 39:41]>` in the current scope\n-  --> $DIR/issue-2392.rs:42:15\n+error[E0599]: no method named `not_closure` found for type `Obj<[closure@$DIR/issue-2392.rs:35:36: 35:41]>` in the current scope\n+  --> $DIR/issue-2392.rs:38:15\n    |\n LL | struct Obj<F> where F: FnOnce() -> u32 {\n    | -------------------------------------- method `not_closure` not found for this\n@@ -23,7 +23,7 @@ LL |     o_closure.not_closure();\n    |               field, not a method\n \n error[E0599]: no method named `closure` found for type `Obj<fn() -> u32 {func}>` in the current scope\n-  --> $DIR/issue-2392.rs:46:12\n+  --> $DIR/issue-2392.rs:42:12\n    |\n LL | struct Obj<F> where F: FnOnce() -> u32 {\n    | -------------------------------------- method `closure` not found for this\n@@ -36,7 +36,7 @@ LL |     (o_func.closure)();\n    |     ^              ^\n \n error[E0599]: no method named `boxed_closure` found for type `BoxedObj` in the current scope\n-  --> $DIR/issue-2392.rs:49:14\n+  --> $DIR/issue-2392.rs:45:14\n    |\n LL | struct BoxedObj {\n    | --------------- method `boxed_closure` not found for this\n@@ -49,7 +49,7 @@ LL |     (boxed_fn.boxed_closure)();\n    |     ^                      ^\n \n error[E0599]: no method named `boxed_closure` found for type `BoxedObj` in the current scope\n-  --> $DIR/issue-2392.rs:52:19\n+  --> $DIR/issue-2392.rs:48:19\n    |\n LL | struct BoxedObj {\n    | --------------- method `boxed_closure` not found for this\n@@ -62,7 +62,7 @@ LL |     (boxed_closure.boxed_closure)();\n    |     ^                           ^\n \n error[E0599]: no method named `closure` found for type `Obj<fn() -> u32 {func}>` in the current scope\n-  --> $DIR/issue-2392.rs:57:12\n+  --> $DIR/issue-2392.rs:53:12\n    |\n LL | struct Obj<F> where F: FnOnce() -> u32 {\n    | -------------------------------------- method `closure` not found for this\n@@ -75,7 +75,7 @@ LL |     (w.wrap.closure)();\n    |     ^              ^\n \n error[E0599]: no method named `not_closure` found for type `Obj<fn() -> u32 {func}>` in the current scope\n-  --> $DIR/issue-2392.rs:59:12\n+  --> $DIR/issue-2392.rs:55:12\n    |\n LL | struct Obj<F> where F: FnOnce() -> u32 {\n    | -------------------------------------- method `not_closure` not found for this\n@@ -85,8 +85,8 @@ LL |     w.wrap.not_closure();\n    |            |\n    |            field, not a method\n \n-error[E0599]: no method named `closure` found for type `Obj<std::boxed::Box<(dyn std::boxed::FnBox<(), Output = u32> + 'static)>>` in the current scope\n-  --> $DIR/issue-2392.rs:62:24\n+error[E0599]: no method named `closure` found for type `Obj<std::boxed::Box<(dyn std::ops::FnOnce() -> u32 + 'static)>>` in the current scope\n+  --> $DIR/issue-2392.rs:58:24\n    |\n LL | struct Obj<F> where F: FnOnce() -> u32 {\n    | -------------------------------------- method `closure` not found for this\n@@ -99,7 +99,7 @@ LL |     (check_expression().closure)();\n    |     ^                          ^\n \n error[E0599]: no method named `f1` found for type `FuncContainer` in the current scope\n-  --> $DIR/issue-2392.rs:68:31\n+  --> $DIR/issue-2392.rs:64:31\n    |\n LL | struct FuncContainer {\n    | -------------------- method `f1` not found for this\n@@ -112,7 +112,7 @@ LL |             ((*self.container).f1)(1);\n    |             ^                    ^\n \n error[E0599]: no method named `f2` found for type `FuncContainer` in the current scope\n-  --> $DIR/issue-2392.rs:69:31\n+  --> $DIR/issue-2392.rs:65:31\n    |\n LL | struct FuncContainer {\n    | -------------------- method `f2` not found for this\n@@ -125,7 +125,7 @@ LL |             ((*self.container).f2)(1);\n    |             ^                    ^\n \n error[E0599]: no method named `f3` found for type `FuncContainer` in the current scope\n-  --> $DIR/issue-2392.rs:70:31\n+  --> $DIR/issue-2392.rs:66:31\n    |\n LL | struct FuncContainer {\n    | -------------------- method `f3` not found for this"}]}