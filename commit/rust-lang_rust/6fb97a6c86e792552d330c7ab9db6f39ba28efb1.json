{"sha": "6fb97a6c86e792552d330c7ab9db6f39ba28efb1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmYjk3YTZjODZlNzkyNTUyZDMzMGM3YWI5ZGI2ZjM5YmEyOGVmYjE=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-08-02T14:51:54Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-08-02T15:32:24Z"}, "message": "test that align_of handles alignment properly for the mid part", "tree": {"sha": "ad838923aca82e197b1334616e5c221b03aeaee5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ad838923aca82e197b1334616e5c221b03aeaee5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6fb97a6c86e792552d330c7ab9db6f39ba28efb1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6fb97a6c86e792552d330c7ab9db6f39ba28efb1", "html_url": "https://github.com/rust-lang/rust/commit/6fb97a6c86e792552d330c7ab9db6f39ba28efb1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6fb97a6c86e792552d330c7ab9db6f39ba28efb1/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b24d2bb351efeea9c0109d8a662b1038fe8f539", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b24d2bb351efeea9c0109d8a662b1038fe8f539", "html_url": "https://github.com/rust-lang/rust/commit/7b24d2bb351efeea9c0109d8a662b1038fe8f539"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "f9de78c6cdfea07914c065ae85181028a56c82c2", "filename": "src/libcore/slice/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6fb97a6c86e792552d330c7ab9db6f39ba28efb1/src%2Flibcore%2Fslice%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6fb97a6c86e792552d330c7ab9db6f39ba28efb1/src%2Flibcore%2Fslice%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fslice%2Fmod.rs?ref=6fb97a6c86e792552d330c7ab9db6f39ba28efb1", "patch": "@@ -1785,6 +1785,7 @@ impl<T> [T] {\n             return (self, &[], &[]);\n         } else {\n             let (left, rest) = self.split_at(offset);\n+            // now `rest` is definitely aligned, so `from_raw_parts_mut` below is okay\n             let (us_len, ts_len) = rest.align_to_offsets::<U>();\n             return (left,\n                     from_raw_parts(rest.as_ptr() as *const U, us_len),\n@@ -1837,6 +1838,7 @@ impl<T> [T] {\n             return (self, &mut [], &mut []);\n         } else {\n             let (left, rest) = self.split_at_mut(offset);\n+            // now `rest` is definitely aligned, so `from_raw_parts_mut` below is okay\n             let (us_len, ts_len) = rest.align_to_offsets::<U>();\n             let mut_ptr = rest.as_mut_ptr();\n             return (left,"}, {"sha": "b087ec81f59c67004ef049027eb2aafad792368a", "filename": "src/libcore/tests/slice.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6fb97a6c86e792552d330c7ab9db6f39ba28efb1/src%2Flibcore%2Ftests%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6fb97a6c86e792552d330c7ab9db6f39ba28efb1/src%2Flibcore%2Ftests%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fslice.rs?ref=6fb97a6c86e792552d330c7ab9db6f39ba28efb1", "patch": "@@ -986,3 +986,17 @@ fn test_align_to_non_trivial() {\n     assert_eq!(aligned.len(), 4);\n     assert_eq!(prefix.len() + suffix.len(), 2);\n }\n+\n+#[test]\n+fn test_align_to_empty_mid() {\n+    use core::mem;\n+\n+    // Make sure that we do not create empty unaligned slices for the mid part, even when the\n+    // overall slice is too short to contain an aligned address.\n+    let bytes = [1, 2, 3, 4, 5, 6, 7];\n+    type Chunk = u32;\n+    for offset in 0..4 {\n+        let (_, mid, _) = unsafe { bytes[offset..offset+1].align_to::<Chunk>() };\n+        assert_eq!(mid.as_ptr() as usize % mem::align_of::<Chunk>(), 0);\n+    }\n+}"}]}