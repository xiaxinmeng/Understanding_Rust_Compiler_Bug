{"sha": "ce63d55bc7d1a1cd65d175e22787ea964bba0e2a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlNjNkNTViYzdkMWExY2Q2NWQxNzVlMjI3ODdlYTk2NGJiYTBlMmE=", "commit": {"author": {"name": "Smitty", "email": "me@smitop.com", "date": "2021-06-22T21:46:34Z"}, "committer": {"name": "Smitty", "email": "me@smitop.com", "date": "2021-06-30T22:07:40Z"}, "message": "Add suggestions for \"undefined reference\" link errors", "tree": {"sha": "e7ab15456dd98fc300a622271dbe3aa623ec7022", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e7ab15456dd98fc300a622271dbe3aa623ec7022"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce63d55bc7d1a1cd65d175e22787ea964bba0e2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce63d55bc7d1a1cd65d175e22787ea964bba0e2a", "html_url": "https://github.com/rust-lang/rust/commit/ce63d55bc7d1a1cd65d175e22787ea964bba0e2a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce63d55bc7d1a1cd65d175e22787ea964bba0e2a/comments", "author": {"login": "syvb", "id": 10530973, "node_id": "MDQ6VXNlcjEwNTMwOTcz", "avatar_url": "https://avatars.githubusercontent.com/u/10530973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/syvb", "html_url": "https://github.com/syvb", "followers_url": "https://api.github.com/users/syvb/followers", "following_url": "https://api.github.com/users/syvb/following{/other_user}", "gists_url": "https://api.github.com/users/syvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/syvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/syvb/subscriptions", "organizations_url": "https://api.github.com/users/syvb/orgs", "repos_url": "https://api.github.com/users/syvb/repos", "events_url": "https://api.github.com/users/syvb/events{/privacy}", "received_events_url": "https://api.github.com/users/syvb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "syvb", "id": 10530973, "node_id": "MDQ6VXNlcjEwNTMwOTcz", "avatar_url": "https://avatars.githubusercontent.com/u/10530973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/syvb", "html_url": "https://github.com/syvb", "followers_url": "https://api.github.com/users/syvb/followers", "following_url": "https://api.github.com/users/syvb/following{/other_user}", "gists_url": "https://api.github.com/users/syvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/syvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/syvb/subscriptions", "organizations_url": "https://api.github.com/users/syvb/orgs", "repos_url": "https://api.github.com/users/syvb/repos", "events_url": "https://api.github.com/users/syvb/events{/privacy}", "received_events_url": "https://api.github.com/users/syvb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a5b97adb4da4b0f913d19765e91d4322ef6542e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a5b97adb4da4b0f913d19765e91d4322ef6542e", "html_url": "https://github.com/rust-lang/rust/commit/6a5b97adb4da4b0f913d19765e91d4322ef6542e"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "d47624da79a73f934e68d4cdf6f55cdbbd26c0fb", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ce63d55bc7d1a1cd65d175e22787ea964bba0e2a/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce63d55bc7d1a1cd65d175e22787ea964bba0e2a/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=ce63d55bc7d1a1cd65d175e22787ea964bba0e2a", "patch": "@@ -912,14 +912,23 @@ fn link_natively<'a, B: ArchiveBuilder<'a>>(\n             if !prog.status.success() {\n                 let mut output = prog.stderr.clone();\n                 output.extend_from_slice(&prog.stdout);\n-                sess.struct_err(&format!(\n+                let escaped_output = escape_stdout_stderr_string(&output);\n+                let mut err = sess.struct_err(&format!(\n                     \"linking with `{}` failed: {}\",\n                     linker_path.display(),\n                     prog.status\n-                ))\n-                .note(&format!(\"{:?}\", &cmd))\n-                .note(&escape_stdout_stderr_string(&output))\n-                .emit();\n+                ));\n+                err.note(&format!(\"{:?}\", &cmd)).note(&escaped_output);\n+                if escaped_output.contains(\"undefined reference to\") {\n+                    err.help(\n+                        \"some `extern` functions couldn't be found; some native libraries may \\\n+                         need to be installed or have their path specified\",\n+                    );\n+                    err.note(\"use the `-l` flag to specify native libraries to link\");\n+                    err.note(\"use the `cargo:rustc-link-lib` directive to specify the native \\\n+                              libraries to link with Cargo (see https://doc.rust-lang.org/cargo/reference/build-scripts.html#cargorustc-link-libkindname)\");\n+                }\n+                err.emit();\n \n                 // If MSVC's `link.exe` was expected but the return code\n                 // is not a Microsoft LNK error then suggest a way to fix or"}]}