{"sha": "ef896faa0153d0d96b6d6eafe7dd53b178525a25", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmODk2ZmFhMDE1M2QwZDk2YjZkNmVhZmU3ZGQ1M2IxNzg1MjVhMjU=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-07-16T11:44:58Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-07-16T11:44:58Z"}, "message": "Fix deploy script for beta deployment\n\nSince the beta/ directory already exists, we can't copy the complete master dir", "tree": {"sha": "ab11e1d21e1cd8f3d23d3a972941f1bfac03d665", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab11e1d21e1cd8f3d23d3a972941f1bfac03d665"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef896faa0153d0d96b6d6eafe7dd53b178525a25", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqv54U47RUUXZfOLnLO/Nsn7QvnkFAl8QPboACgkQLO/Nsn7Q\nvnk7Rw//dzEnT0yqKun0rwPXE+2aTLyHti9E3I42EvJasSZa2MUrGnKbo28AqbUt\n5gH1zYYbLmpurTnPvYbIDSlCQC7rffhuTZ4lCJ5TU3ayEVBMURysZ11mZlVUWdCz\nC/JOUgBxbxvA2ziUk0UJbaSZeP4fjTBgu3EEItkUXcS7LSBXJpYkOIPVixnEThCe\n4Z6mZYQY8X2u/MAM4I+Br0bh9vlkkA+WVHVw6Mpzl2wW9nkAVtjHojDi3q3904a6\noa4BMQaJTbKRo1DjSXnl5ykzUK/U91l0vLUu8tohE7GbYheh8t0mtkmc0+c6kjbT\nLstfK6lVY7kBXYRUKCSFpj9FO01Jd2gr0Km1jdNcgcCzS7ZJlR5yvmOmFdZqlwoa\n1CjvK6R2Xu3mcU+aByT4AR/AXo8hH/yyTZmtOQsmFxFdGSPpEEyuYPCb5t/l4mWD\nVVr37iwIeELw68l5xHH+nZbd11H6BrRMQXl9kuThlTAF5RouNDK3CHr8RoAoQsub\nZX3+CpkaZXDn+hp0zFCoZu+CNrj7+nC/787iRxZZa2daOjxYpTEGERi682Dw6VJc\nqrMYAC8tNKOcPXk3oWrQm7vpfI6VeS0nvOJ/lHNozrtfRycI80+8R9HXVZc/NwTx\n0Lr8f8YwhZfWyxqCfXZbFi5brPPlbnA/rVd7ZVJ6yg4xS0QVIKE=\n=ad6O\n-----END PGP SIGNATURE-----", "payload": "tree ab11e1d21e1cd8f3d23d3a972941f1bfac03d665\nparent bb67423577de689256483881ee9a8a0df34f7cd7\nauthor flip1995 <hello@philkrones.com> 1594899898 +0200\ncommitter flip1995 <hello@philkrones.com> 1594899898 +0200\n\nFix deploy script for beta deployment\n\nSince the beta/ directory already exists, we can't copy the complete master dir\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef896faa0153d0d96b6d6eafe7dd53b178525a25", "html_url": "https://github.com/rust-lang/rust/commit/ef896faa0153d0d96b6d6eafe7dd53b178525a25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef896faa0153d0d96b6d6eafe7dd53b178525a25/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb67423577de689256483881ee9a8a0df34f7cd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb67423577de689256483881ee9a8a0df34f7cd7", "html_url": "https://github.com/rust-lang/rust/commit/bb67423577de689256483881ee9a8a0df34f7cd7"}], "stats": {"total": 19, "additions": 13, "deletions": 6}, "files": [{"sha": "e0a95fb9f363bb0b8e28fec3ced4bdf97b5572fc", "filename": ".github/deploy.sh", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ef896faa0153d0d96b6d6eafe7dd53b178525a25/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ef896faa0153d0d96b6d6eafe7dd53b178525a25/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=ef896faa0153d0d96b6d6eafe7dd53b178525a25", "patch": "@@ -19,7 +19,7 @@ fi\n \n if [[ $BETA = \"true\" ]]; then\n   echo \"Update documentation for the beta release\"\n-  cp -r out/master out/beta\n+  cp -r out/master/* out/beta\n fi\n \n # Generate version index that is shown as root index page\n@@ -33,12 +33,11 @@ cd out\n git config user.name \"GHA CI\"\n git config user.email \"gha@ci.invalid\"\n \n-if git diff --exit-code --quiet; then\n-  echo \"No changes to the output on this push; exiting.\"\n-  exit 0\n-fi\n-\n if [[ -n $TAG_NAME ]]; then\n+  if git diff --exit-code --quiet -- $TAG_NAME/; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+  fi\n   # Add the new dir\n   git add \"$TAG_NAME\"\n   # Update the symlink\n@@ -47,9 +46,17 @@ if [[ -n $TAG_NAME ]]; then\n   git add versions.json\n   git commit -m \"Add documentation for ${TAG_NAME} release: ${SHA}\"\n elif [[ $BETA = \"true\" ]]; then\n+  if git diff --exit-code --quiet -- beta/; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+  fi\n   git add beta\n   git commit -m \"Automatic deploy to GitHub Pages (beta): ${SHA}\"\n else\n+  if git diff --exit-code --quiet; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+  fi\n   git add .\n   git commit -m \"Automatic deploy to GitHub Pages: ${SHA}\"\n fi"}]}