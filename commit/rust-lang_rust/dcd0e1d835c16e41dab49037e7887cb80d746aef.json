{"sha": "dcd0e1d835c16e41dab49037e7887cb80d746aef", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRjZDBlMWQ4MzVjMTZlNDFkYWI0OTAzN2U3ODg3Y2I4MGQ3NDZhZWY=", "commit": {"author": {"name": "Ryan Levick", "email": "rylev@users.noreply.github.com", "date": "2021-09-06T10:38:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-09-06T10:38:53Z"}, "message": "Rollup merge of #88602 - BoxyUwU:tests-uwu-nya, r=lcnr\n\nAdd tests for some const generics issues\n\ncloses #82956\ncloses #84659\ncloses #86530\ncloses #86535\n\nthere is also a random test in here about array repeat expressions that I already had on this branch but it seems to fit the theme of this PR so kept it...\n\nr? `@lcnr`", "tree": {"sha": "c65ca654a8e50e7c63e9fd8b605d4a38e5528ee8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c65ca654a8e50e7c63e9fd8b605d4a38e5528ee8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dcd0e1d835c16e41dab49037e7887cb80d746aef", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhNe+9CRBK7hj4Ov3rIwAALgwIAICCQzUR7IAUHDbtBVj05ivx\nq6DTe8XCUCCiFVw789lPxA+30u5dq7dHH1JI+1h75XiiVfgEpM3Vj4QPlntQGsHi\njmMY+YLnCSG0OcdlwtCNvmy0fOMTU/EI8TTGRmKo7J3RYljvbituqWicxHIL50fp\nHmMyAK+bbLPqjp8FuVbbBBNHZl7Ef3nnDhbD8noKIVBDttxLCnMAr/aHhBkuqT21\ng77V1xQv5+j+LJI3R0GOIQo3qjCv/zVWar7JYaxxAiuD+RK4ieAOFqd0jTCnZ0eB\nlbWur3uHdxyCf6/QjXqX/4yGKcCz7kooNNZRSRkdGOUoF5lFp/EW9d0Tv+xnBAM=\n=57b+\n-----END PGP SIGNATURE-----\n", "payload": "tree c65ca654a8e50e7c63e9fd8b605d4a38e5528ee8\nparent b2d9bcda7ec267dbabfaef67f7af344ef71e002c\nparent 89c6d4f9886b068f50b286eedbd503ff285f4b38\nauthor Ryan Levick <rylev@users.noreply.github.com> 1630924733 +0200\ncommitter GitHub <noreply@github.com> 1630924733 +0200\n\nRollup merge of #88602 - BoxyUwU:tests-uwu-nya, r=lcnr\n\nAdd tests for some const generics issues\n\ncloses #82956\ncloses #84659\ncloses #86530\ncloses #86535\n\nthere is also a random test in here about array repeat expressions that I already had on this branch but it seems to fit the theme of this PR so kept it...\n\nr? `@lcnr`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dcd0e1d835c16e41dab49037e7887cb80d746aef", "html_url": "https://github.com/rust-lang/rust/commit/dcd0e1d835c16e41dab49037e7887cb80d746aef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dcd0e1d835c16e41dab49037e7887cb80d746aef/comments", "author": {"login": "rylev", "id": 1327285, "node_id": "MDQ6VXNlcjEzMjcyODU=", "avatar_url": "https://avatars.githubusercontent.com/u/1327285?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rylev", "html_url": "https://github.com/rylev", "followers_url": "https://api.github.com/users/rylev/followers", "following_url": "https://api.github.com/users/rylev/following{/other_user}", "gists_url": "https://api.github.com/users/rylev/gists{/gist_id}", "starred_url": "https://api.github.com/users/rylev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rylev/subscriptions", "organizations_url": "https://api.github.com/users/rylev/orgs", "repos_url": "https://api.github.com/users/rylev/repos", "events_url": "https://api.github.com/users/rylev/events{/privacy}", "received_events_url": "https://api.github.com/users/rylev/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2d9bcda7ec267dbabfaef67f7af344ef71e002c", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2d9bcda7ec267dbabfaef67f7af344ef71e002c", "html_url": "https://github.com/rust-lang/rust/commit/b2d9bcda7ec267dbabfaef67f7af344ef71e002c"}, {"sha": "89c6d4f9886b068f50b286eedbd503ff285f4b38", "url": "https://api.github.com/repos/rust-lang/rust/commits/89c6d4f9886b068f50b286eedbd503ff285f4b38", "html_url": "https://github.com/rust-lang/rust/commit/89c6d4f9886b068f50b286eedbd503ff285f4b38"}], "stats": {"total": 203, "additions": 203, "deletions": 0}, "files": [{"sha": "a3a0d8d06e87cb5de00620a2dd22d490769b1ba5", "filename": "src/test/ui/const-generics/issues/issue-82956.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-82956.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-82956.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-82956.rs?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,33 @@\n+#![feature(generic_const_exprs, array_map)]\n+#![allow(incomplete_features)]\n+\n+pub struct ConstCheck<const CHECK: bool>;\n+\n+pub trait True {}\n+impl True for ConstCheck<true> {}\n+\n+pub trait OrdesDec {\n+    type Newlen;\n+    type Output;\n+\n+    fn pop(self) -> (Self::Newlen, Self::Output);\n+}\n+\n+impl<T, const N: usize> OrdesDec for [T; N]\n+where\n+    ConstCheck<{N > 1}>: True,\n+    [T; N - 1]: Sized,\n+{\n+    type Newlen = [T; N - 1];\n+    type Output = T;\n+\n+    fn pop(self) -> (Self::Newlen, Self::Output) {\n+        let mut iter = IntoIter::new(self);\n+        //~^ ERROR: failed to resolve: use of undeclared type `IntoIter`\n+        let end = iter.next_back().unwrap();\n+        let new = [(); N - 1].map(move |()| iter.next().unwrap());\n+        (new, end)\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "c8b999da9810437f0c033db1a8f536a7bffb60ee", "filename": "src/test/ui/const-generics/issues/issue-82956.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-82956.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-82956.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-82956.stderr?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,21 @@\n+error[E0433]: failed to resolve: use of undeclared type `IntoIter`\n+  --> $DIR/issue-82956.rs:25:24\n+   |\n+LL |         let mut iter = IntoIter::new(self);\n+   |                        ^^^^^^^^ not found in this scope\n+   |\n+help: consider importing one of these items\n+   |\n+LL | use std::array::IntoIter;\n+   |\n+LL | use std::collections::binary_heap::IntoIter;\n+   |\n+LL | use std::collections::btree_map::IntoIter;\n+   |\n+LL | use std::collections::btree_set::IntoIter;\n+   |\n+     and 8 other candidates\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0433`."}, {"sha": "440ca740af2b05dee11fab5be35e4770bba37d3c", "filename": "src/test/ui/const-generics/issues/issue-84659.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-84659.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-84659.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-84659.rs?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,12 @@\n+#![allow(incomplete_features)]\n+#![feature(generic_const_exprs)]\n+\n+trait Bar<const N: usize> {}\n+\n+trait Foo<'a> {\n+    const N: usize;\n+    type Baz: Bar<{ Self::N }>;\n+    //~^ ERROR: unconstrained generic constant\n+}\n+\n+fn main() {}"}, {"sha": "2dfc48a34e4b19d4a06e9bb9f63e94fafdf988b8", "filename": "src/test/ui/const-generics/issues/issue-84659.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-84659.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-84659.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-84659.stderr?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,10 @@\n+error: unconstrained generic constant\n+  --> $DIR/issue-84659.rs:8:15\n+   |\n+LL |     type Baz: Bar<{ Self::N }>;\n+   |               ^^^^^^^^^^^^^^^^\n+   |\n+   = help: try adding a `where` bound using this expression: `where [(); { Self::N }]:`\n+\n+error: aborting due to previous error\n+"}, {"sha": "b024decd4e11c47febab19e1329e0d033d41e05a", "filename": "src/test/ui/const-generics/issues/issue-86530.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86530.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86530.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86530.rs?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,20 @@\n+#![feature(generic_const_exprs)]\n+#![allow(incomplete_features)]\n+\n+pub trait X {\n+    const Y: usize;\n+}\n+\n+fn z<T>(t: T)\n+where\n+    T: X,\n+    [(); T::Y]: ,\n+{\n+}\n+\n+fn unit_literals() {\n+    z(\" \");\n+    //~^ ERROR: the trait bound `&str: X` is not satisfied\n+}\n+\n+fn main() {}"}, {"sha": "7cdfc9dfcdf5a2404ff2b095e37a9f1ed8acb9e1", "filename": "src/test/ui/const-generics/issues/issue-86530.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86530.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86530.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86530.stderr?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,18 @@\n+error[E0277]: the trait bound `&str: X` is not satisfied\n+  --> $DIR/issue-86530.rs:16:7\n+   |\n+LL |     z(\" \");\n+   |       ^^^ the trait `X` is not implemented for `&str`\n+   |\n+note: required by a bound in `z`\n+  --> $DIR/issue-86530.rs:10:8\n+   |\n+LL | fn z<T>(t: T)\n+   |    - required by a bound in this\n+LL | where\n+LL |     T: X,\n+   |        ^ required by this bound in `z`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "0b535fd66498d697bc7389ebd6d3dd236d1b159f", "filename": "src/test/ui/const-generics/issues/issue-86535-2.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86535-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86535-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86535-2.rs?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,19 @@\n+// run-pass\n+#![feature(adt_const_params, generic_const_exprs)]\n+#![allow(incomplete_features)]\n+\n+pub trait Foo {\n+    const ASSOC_C: usize;\n+    fn foo() where [(); Self::ASSOC_C]:;\n+}\n+\n+struct Bar<const N: &'static ()>;\n+impl<const N: &'static ()> Foo for Bar<N> {\n+    const ASSOC_C: usize = 3;\n+\n+    fn foo() where [u8; Self::ASSOC_C]: {\n+        let _: [u8; Self::ASSOC_C] = loop {};\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "5289c4e99dd6fb062cc122eb282cebd7175803d4", "filename": "src/test/ui/const-generics/issues/issue-86535.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86535.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86535.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-86535.rs?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,20 @@\n+// run-pass\n+#![feature(adt_const_params, generic_const_exprs)]\n+#![allow(incomplete_features, unused_variables)]\n+\n+struct F<const S: &'static str>;\n+impl<const S: &'static str> X for F<{ S }> {\n+    const W: usize = 3;\n+\n+    fn d(r: &[u8; Self::W]) -> F<{ S }> {\n+        let x: [u8; Self::W] = [0; Self::W];\n+        F\n+    }\n+}\n+\n+pub trait X {\n+    const W: usize;\n+    fn d(r: &[u8; Self::W]) -> Self;\n+}\n+\n+fn main() {}"}, {"sha": "b147c246bdac8546c963e37d116253884607b445", "filename": "src/test/ui/const-generics/sneaky-array-repeat-expr.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fsneaky-array-repeat-expr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fsneaky-array-repeat-expr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fsneaky-array-repeat-expr.rs?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,32 @@\n+trait Trait<const N: usize> {\n+    const Assoc: usize;\n+}\n+\n+impl<const N: usize> Trait<N> for () {\n+    const Assoc: usize = 1;\n+}\n+\n+\n+pub const fn foo<const N: usize>() where (): Trait<N> {\n+    let bar = [(); <()>::Assoc];\n+    //~^ error: constant expression depends on a generic parameter\n+}\n+\n+trait Trait2<const N: usize> {\n+    const Assoc2: usize;\n+}\n+\n+impl<const N: usize> Trait2<N> for () {\n+    const Assoc2: usize = N - 1;\n+}\n+\n+\n+pub const fn foo2<const N: usize>() where (): Trait2<N> {\n+    let bar2 = [(); <()>::Assoc2];\n+    //~^ error: constant expression depends on a generic parameter\n+}\n+\n+fn main() {\n+    foo::<0>();\n+    foo2::<0>();\n+}"}, {"sha": "5c77375d39934a1d532f6f2b7dd979c29039db83", "filename": "src/test/ui/const-generics/sneaky-array-repeat-expr.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fsneaky-array-repeat-expr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dcd0e1d835c16e41dab49037e7887cb80d746aef/src%2Ftest%2Fui%2Fconst-generics%2Fsneaky-array-repeat-expr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fsneaky-array-repeat-expr.stderr?ref=dcd0e1d835c16e41dab49037e7887cb80d746aef", "patch": "@@ -0,0 +1,18 @@\n+error: constant expression depends on a generic parameter\n+  --> $DIR/sneaky-array-repeat-expr.rs:11:20\n+   |\n+LL |     let bar = [(); <()>::Assoc];\n+   |                    ^^^^^^^^^^^\n+   |\n+   = note: this may fail depending on what value the parameter takes\n+\n+error: constant expression depends on a generic parameter\n+  --> $DIR/sneaky-array-repeat-expr.rs:25:21\n+   |\n+LL |     let bar2 = [(); <()>::Assoc2];\n+   |                     ^^^^^^^^^^^^\n+   |\n+   = note: this may fail depending on what value the parameter takes\n+\n+error: aborting due to 2 previous errors\n+"}]}