{"sha": "073010d425d7b6ff5e79fd41f209e4915daa6066", "node_id": "C_kwDOAAsO6NoAKDA3MzAxMGQ0MjVkN2I2ZmY1ZTc5ZmQ0MWYyMDllNDkxNWRhYTYwNjY", "commit": {"author": {"name": "Noah Lev", "email": "camelidcamel@gmail.com", "date": "2022-02-17T22:58:46Z"}, "committer": {"name": "Noah Lev", "email": "camelidcamel@gmail.com", "date": "2022-03-24T05:31:57Z"}, "message": "Improve handling of `tmp` variable name conflicts", "tree": {"sha": "2f4ed899247b67791a8b39e160b04721ed1a07ed", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f4ed899247b67791a8b39e160b04721ed1a07ed"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/073010d425d7b6ff5e79fd41f209e4915daa6066", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/073010d425d7b6ff5e79fd41f209e4915daa6066", "html_url": "https://github.com/rust-lang/rust/commit/073010d425d7b6ff5e79fd41f209e4915daa6066", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/073010d425d7b6ff5e79fd41f209e4915daa6066/comments", "author": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "62b8ea67b79de77fca36ca82de4b934307b6de30", "url": "https://api.github.com/repos/rust-lang/rust/commits/62b8ea67b79de77fca36ca82de4b934307b6de30", "html_url": "https://github.com/rust-lang/rust/commit/62b8ea67b79de77fca36ca82de4b934307b6de30"}], "stats": {"total": 93, "additions": 86, "deletions": 7}, "files": [{"sha": "dcb150f18aa4251f34ab280a89f1388d60a8d6c6", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/073010d425d7b6ff5e79fd41f209e4915daa6066/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/073010d425d7b6ff5e79fd41f209e4915daa6066/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=073010d425d7b6ff5e79fd41f209e4915daa6066", "patch": "@@ -1325,13 +1325,17 @@ impl<'a> Parser<'a> {\n         kind: IncDecRecovery,\n         (pre_span, post_span): (Span, Span),\n     ) {\n+        let mut msg = format!(\"use `{}= 1` instead\", kind.op.chr());\n+        if base_src.trim() == \"tmp\" {\n+            msg.push_str(\" (rename `tmp` so it doesn't conflict with your variable)\");\n+        }\n         err.multipart_suggestion(\n-            &format!(\"use `{}= 1` instead\", kind.op.chr()),\n+            &msg,\n             vec![\n                 (pre_span, \"{ let tmp = \".to_string()),\n                 (post_span, format!(\"; {} {}= 1; tmp }}\", base_src, kind.op.chr())),\n             ],\n-            Applicability::MachineApplicable,\n+            Applicability::HasPlaceholders,\n         );\n     }\n "}, {"sha": "909c8f8c371ea1630919c3fd5866e471239d8f07", "filename": "src/test/ui/parser/increment-autofix.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.rs?ref=073010d425d7b6ff5e79fd41f209e4915daa6066", "patch": "@@ -14,6 +14,20 @@ fn post_while() {\n     }\n }\n \n+fn post_regular_tmp() {\n+    let mut tmp = 0;\n+    tmp++; //~ ERROR Rust has no postfix increment operator\n+    println!(\"{}\", tmp);\n+}\n+\n+fn post_while_tmp() {\n+    let mut tmp = 0;\n+    while tmp++ < 5 {\n+        //~^ ERROR Rust has no postfix increment operator\n+        println!(\"{}\", tmp);\n+    }\n+}\n+\n fn pre_regular() {\n     let mut i = 0;\n     ++i; //~ ERROR Rust has no prefix increment operator\n@@ -31,6 +45,8 @@ fn pre_while() {\n fn main() {\n     post_regular();\n     post_while();\n+    post_regular_tmp();\n+    post_while_tmp();\n     pre_regular();\n     pre_while();\n }"}, {"sha": "8c934c9efde35046d12af73562bf20a66b7df078", "filename": "src/test/ui/parser/increment-autofix.stderr", "status": "modified", "additions": 35, "deletions": 3, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.stderr?ref=073010d425d7b6ff5e79fd41f209e4915daa6066", "patch": "@@ -30,8 +30,40 @@ LL -     while i++ < 5 {\n LL +     while i += 1 < 5 {\n    | \n \n+error: Rust has no postfix increment operator\n+  --> $DIR/increment-autofix.rs:19:8\n+   |\n+LL |     tmp++;\n+   |        ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead (rename `tmp` so it doesn't conflict with your variable)\n+   |\n+LL |     { let tmp = tmp; tmp += 1; tmp };\n+   |     +++++++++++    ~~~~~~~~~~~~~~~~~\n+help: or, if you don't need to use it as an expression, change it to this\n+   |\n+LL -     tmp++;\n+LL +     tmp += 1;\n+   | \n+\n+error: Rust has no postfix increment operator\n+  --> $DIR/increment-autofix.rs:25:14\n+   |\n+LL |     while tmp++ < 5 {\n+   |              ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead (rename `tmp` so it doesn't conflict with your variable)\n+   |\n+LL |     while { let tmp = tmp; tmp += 1; tmp } < 5 {\n+   |           +++++++++++    ~~~~~~~~~~~~~~~~~\n+help: or, if you don't need to use it as an expression, change it to this\n+   |\n+LL -     while tmp++ < 5 {\n+LL +     while tmp += 1 < 5 {\n+   | \n+\n error: Rust has no prefix increment operator\n-  --> $DIR/increment-autofix.rs:19:5\n+  --> $DIR/increment-autofix.rs:33:5\n    |\n LL |     ++i;\n    |     ^^ not a valid prefix operator\n@@ -43,7 +75,7 @@ LL +     i += 1;\n    | \n \n error: Rust has no prefix increment operator\n-  --> $DIR/increment-autofix.rs:25:11\n+  --> $DIR/increment-autofix.rs:39:11\n    |\n LL |     while ++i < 5 {\n    |           ^^ not a valid prefix operator\n@@ -53,5 +85,5 @@ help: use `+= 1` instead\n LL |     while { i += 1; i } < 5 {\n    |           ~   +++++++++\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 6 previous errors\n "}, {"sha": "3db8a4c3326f3c5b972aecc72715c36ff2b92609", "filename": "src/test/ui/parser/increment-notfixed.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.rs?ref=073010d425d7b6ff5e79fd41f209e4915daa6066", "patch": "@@ -13,6 +13,16 @@ fn post_field() {\n     println!(\"{}\", foo.bar.qux);\n }\n \n+fn post_field_tmp() {\n+    struct S {\n+        tmp: i32\n+    }\n+    let s = S { tmp: 0 };\n+    s.tmp++;\n+    //~^ ERROR Rust has no postfix increment operator\n+    println!(\"{}\", s.tmp);\n+}\n+\n fn pre_field() {\n     let foo = Foo { bar: Bar { qux: 0 } };\n     ++foo.bar.qux;\n@@ -22,5 +32,6 @@ fn pre_field() {\n \n fn main() {\n     post_field();\n+    post_field_tmp();\n     pre_field();\n }"}, {"sha": "c4c83b5113b4df9ae9b72a376cd259f85c97b533", "filename": "src/test/ui/parser/increment-notfixed.stderr", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/073010d425d7b6ff5e79fd41f209e4915daa6066/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.stderr?ref=073010d425d7b6ff5e79fd41f209e4915daa6066", "patch": "@@ -14,8 +14,24 @@ LL -     foo.bar.qux++;\n LL +     foo.bar.qux += 1;\n    | \n \n+error: Rust has no postfix increment operator\n+  --> $DIR/increment-notfixed.rs:21:10\n+   |\n+LL |     s.tmp++;\n+   |          ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead\n+   |\n+LL |     { let tmp = s.tmp; s.tmp += 1; tmp };\n+   |     +++++++++++      ~~~~~~~~~~~~~~~~~~~\n+help: or, if you don't need to use it as an expression, change it to this\n+   |\n+LL -     s.tmp++;\n+LL +     s.tmp += 1;\n+   | \n+\n error: Rust has no prefix increment operator\n-  --> $DIR/increment-notfixed.rs:18:5\n+  --> $DIR/increment-notfixed.rs:28:5\n    |\n LL |     ++foo.bar.qux;\n    |     ^^ not a valid prefix operator\n@@ -26,5 +42,5 @@ LL -     ++foo.bar.qux;\n LL +     foo.bar.qux += 1;\n    | \n \n-error: aborting due to 2 previous errors\n+error: aborting due to 3 previous errors\n "}]}