{"sha": "e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMDQ5MGQ1YjJlMDNlOGUzMjRjMzM2ZGMyZGFmM2M1ZmMxY2JmNTk=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-05-29T15:37:38Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-06-04T11:20:05Z"}, "message": "Move crate_name field from OngoingCodegen to CrateInfo", "tree": {"sha": "8bc29bbed22f3d4b56136b73fb09dddab8222243", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8bc29bbed22f3d4b56136b73fb09dddab8222243"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "html_url": "https://github.com/rust-lang/rust/commit/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96247017fad9b216259cfa64a7762a816854dcd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/96247017fad9b216259cfa64a7762a816854dcd7", "html_url": "https://github.com/rust-lang/rust/commit/96247017fad9b216259cfa64a7762a816854dcd7"}], "stats": {"total": 15, "additions": 6, "deletions": 9}, "files": [{"sha": "6676d88602c45d9e34991e80ce25e6cf158077e5", "filename": "compiler/rustc_codegen_cranelift/src/driver/aot.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fdriver%2Faot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fdriver%2Faot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fdriver%2Faot.rs?ref=e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "patch": "@@ -292,7 +292,6 @@ pub(crate) fn run_aot(\n \n     Box::new((\n         CodegenResults {\n-            crate_name: tcx.crate_name(LOCAL_CRATE),\n             modules,\n             allocator_module,\n             metadata_module,"}, {"sha": "904efed5bd98c6e45800273a60a59da92529968a", "filename": "compiler/rustc_codegen_cranelift/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_cranelift%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_cranelift%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Flib.rs?ref=e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "patch": "@@ -218,7 +218,7 @@ impl CodegenBackend for CraneliftCodegenBackend {\n             sess,\n             &codegen_results,\n             outputs,\n-            &codegen_results.crate_name.as_str(),\n+            &codegen_results.crate_info.local_crate_name.as_str(),\n         );\n \n         Ok(())"}, {"sha": "776cb2ee99bcbf727f6ce65d5fa6124454eed4f6", "filename": "compiler/rustc_codegen_llvm/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_llvm%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_llvm%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Flib.rs?ref=e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "patch": "@@ -297,7 +297,7 @@ impl CodegenBackend for LlvmCodegenBackend {\n             sess,\n             &codegen_results,\n             outputs,\n-            &codegen_results.crate_name.as_str(),\n+            &codegen_results.crate_info.local_crate_name.as_str(),\n         );\n \n         Ok(())"}, {"sha": "ff4e64095714086cd4a76222786f164a2587b895", "filename": "compiler/rustc_codegen_ssa/src/back/write.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs?ref=e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "patch": "@@ -31,7 +31,7 @@ use rustc_session::config::{self, CrateType, Lto, OutputFilenames, OutputType};\n use rustc_session::config::{Passes, SwitchWithOptPath};\n use rustc_session::Session;\n use rustc_span::source_map::SourceMap;\n-use rustc_span::symbol::{sym, Symbol};\n+use rustc_span::symbol::sym;\n use rustc_span::{BytePos, FileName, InnerSpan, Pos, Span};\n use rustc_target::spec::{MergeFunctions, PanicStrategy, SanitizerSet};\n \n@@ -426,7 +426,6 @@ pub fn start_async_codegen<B: ExtraBackendMethods>(\n     let (coordinator_send, coordinator_receive) = channel();\n     let sess = tcx.sess;\n \n-    let crate_name = tcx.crate_name(LOCAL_CRATE);\n     let crate_attrs = tcx.hir().attrs(rustc_hir::CRATE_HIR_ID);\n     let no_builtins = tcx.sess.contains_name(crate_attrs, sym::no_builtins);\n     let is_compiler_builtins = tcx.sess.contains_name(crate_attrs, sym::compiler_builtins);\n@@ -461,7 +460,6 @@ pub fn start_async_codegen<B: ExtraBackendMethods>(\n \n     OngoingCodegen {\n         backend,\n-        crate_name,\n         metadata,\n         linker_info,\n         crate_info,\n@@ -1800,7 +1798,6 @@ impl SharedEmitterMain {\n \n pub struct OngoingCodegen<B: ExtraBackendMethods> {\n     pub backend: B,\n-    pub crate_name: Symbol,\n     pub metadata: EncodedMetadata,\n     pub linker_info: LinkerInfo,\n     pub crate_info: CrateInfo,\n@@ -1844,7 +1841,6 @@ impl<B: ExtraBackendMethods> OngoingCodegen<B> {\n \n         (\n             CodegenResults {\n-                crate_name: self.crate_name,\n                 metadata: self.metadata,\n                 linker_info: self.linker_info,\n                 crate_info: self.crate_info,"}, {"sha": "38ab39febe066c4c0db3adfb8f4286d1ff0289e7", "filename": "compiler/rustc_codegen_ssa/src/base.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_ssa%2Fsrc%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_ssa%2Fsrc%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fbase.rs?ref=e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "patch": "@@ -756,6 +756,7 @@ impl<B: ExtraBackendMethods> Drop for AbortCodegenOnDrop<B> {\n \n impl CrateInfo {\n     pub fn new(tcx: TyCtxt<'_>) -> CrateInfo {\n+        let local_crate_name = tcx.crate_name(LOCAL_CRATE);\n         let crate_attrs = tcx.hir().attrs(rustc_hir::CRATE_HIR_ID);\n         let subsystem = tcx.sess.first_attr_value_str_by_name(crate_attrs, sym::windows_subsystem);\n         let windows_subsystem = subsystem.map(|subsystem| {\n@@ -770,6 +771,7 @@ impl CrateInfo {\n         });\n \n         let mut info = CrateInfo {\n+            local_crate_name,\n             panic_runtime: None,\n             compiler_builtins: None,\n             profiler_runtime: None,"}, {"sha": "e757051e22b620b923184cd5d77ba71b09cd2183", "filename": "compiler/rustc_codegen_ssa/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_ssa%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59/compiler%2Frustc_codegen_ssa%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Flib.rs?ref=e30490d5b2e03e8e324c336dc2daf3c5fc1cbf59", "patch": "@@ -128,6 +128,7 @@ impl From<&cstore::NativeLib> for NativeLib {\n /// and the corresponding properties without referencing information outside of a `CrateInfo`.\n #[derive(Debug, Encodable, Decodable)]\n pub struct CrateInfo {\n+    pub local_crate_name: Symbol,\n     pub panic_runtime: Option<CrateNum>,\n     pub compiler_builtins: Option<CrateNum>,\n     pub profiler_runtime: Option<CrateNum>,\n@@ -146,7 +147,6 @@ pub struct CrateInfo {\n \n #[derive(Encodable, Decodable)]\n pub struct CodegenResults {\n-    pub crate_name: Symbol,\n     pub modules: Vec<CompiledModule>,\n     pub allocator_module: Option<CompiledModule>,\n     pub metadata_module: Option<CompiledModule>,"}]}