{"sha": "74e731fcb07de3527c84e9a30821034784aa40cd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc0ZTczMWZjYjA3ZGUzNTI3Yzg0ZTlhMzA4MjEwMzQ3ODRhYTQwY2Q=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-05-10T16:35:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-05-10T16:35:37Z"}, "message": "Rollup merge of #50598 - whitfin:unnecessary-mut-borrow, r=michaelwoerister\n\nRemove unnecessary mutable borrow and resizing in DepGraph::serialize\n\nI might be mistaken, but I noticed this whilst in this file for something else. It appears that this mutable borrow is unnecessary and since it's locking it should be removed. The resizing looks redundant since nothing additional is added to the fingerprints in this function, so that can also be removed.", "tree": {"sha": "b15aab98ebef5cea16693396616efcd9ff043319", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b15aab98ebef5cea16693396616efcd9ff043319"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/74e731fcb07de3527c84e9a30821034784aa40cd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJa9HTZCRBK7hj4Ov3rIwAAdHIIAEEqA0JUE4aMZxLcbkEI21bL\nSWe9rWOWWtlqWvTO8boJ1C/9KPK2OlmYfCTT0svjua3L1MeLA1pRkraTx/8MDpky\nlBFpCSOuFkhqOq896uhDbnXqrt46NFK4vn4cjUM9L7qj2H5S+lXX3nNs0WYQKNmy\nR20T3VgkM5RpDihq0ceOAliR6Ke0lhCqL6X1bjuCnDhJDCCX2IiYxotN1pkTFWPd\n0qtloe6ILBEUywRG83ej6dhCCNFvrkm4+wn3sNNcUNk5Yw8ygO+ZdTbvmT9qAlUY\no8GtF8lMxnlpZ7dqKXdPvoiF6ClXpIfz+D7AdcpSuXz9Dt+HQsUep+CEiD1rA34=\n=CfLV\n-----END PGP SIGNATURE-----\n", "payload": "tree b15aab98ebef5cea16693396616efcd9ff043319\nparent 8b5f6921047edfdfb450a4997811ef10f4025a58\nparent ae3feff0281b2f08f6dbb75dc2e50e338a711e5f\nauthor Alex Crichton <alex@alexcrichton.com> 1525970137 -0500\ncommitter GitHub <noreply@github.com> 1525970137 -0500\n\nRollup merge of #50598 - whitfin:unnecessary-mut-borrow, r=michaelwoerister\n\nRemove unnecessary mutable borrow and resizing in DepGraph::serialize\n\nI might be mistaken, but I noticed this whilst in this file for something else. It appears that this mutable borrow is unnecessary and since it's locking it should be removed. The resizing looks redundant since nothing additional is added to the fingerprints in this function, so that can also be removed.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/74e731fcb07de3527c84e9a30821034784aa40cd", "html_url": "https://github.com/rust-lang/rust/commit/74e731fcb07de3527c84e9a30821034784aa40cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/74e731fcb07de3527c84e9a30821034784aa40cd/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b5f6921047edfdfb450a4997811ef10f4025a58", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b5f6921047edfdfb450a4997811ef10f4025a58", "html_url": "https://github.com/rust-lang/rust/commit/8b5f6921047edfdfb450a4997811ef10f4025a58"}, {"sha": "ae3feff0281b2f08f6dbb75dc2e50e338a711e5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae3feff0281b2f08f6dbb75dc2e50e338a711e5f", "html_url": "https://github.com/rust-lang/rust/commit/ae3feff0281b2f08f6dbb75dc2e50e338a711e5f"}], "stats": {"total": 8, "additions": 1, "deletions": 7}, "files": [{"sha": "03aff6410055815a27c1d63bd1b43a8e92b6fe2e", "filename": "src/librustc/dep_graph/graph.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/74e731fcb07de3527c84e9a30821034784aa40cd/src%2Flibrustc%2Fdep_graph%2Fgraph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74e731fcb07de3527c84e9a30821034784aa40cd/src%2Flibrustc%2Fdep_graph%2Fgraph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fgraph.rs?ref=74e731fcb07de3527c84e9a30821034784aa40cd", "patch": "@@ -523,15 +523,9 @@ impl DepGraph {\n     }\n \n     pub fn serialize(&self) -> SerializedDepGraph {\n-        let mut fingerprints = self.fingerprints.borrow_mut();\n         let current_dep_graph = self.data.as_ref().unwrap().current.borrow();\n \n-        // Make sure we don't run out of bounds below.\n-        if current_dep_graph.nodes.len() > fingerprints.len() {\n-            fingerprints.resize(current_dep_graph.nodes.len(), Fingerprint::ZERO);\n-        }\n-\n-        let fingerprints = fingerprints.clone().convert_index_type();\n+        let fingerprints = self.fingerprints.borrow().clone().convert_index_type();\n         let nodes = current_dep_graph.nodes.clone().convert_index_type();\n \n         let total_edge_count: usize = current_dep_graph.edges.iter()"}]}