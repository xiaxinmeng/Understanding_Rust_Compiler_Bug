{"sha": "f41ecef6d52200743b3672346a59fc1e2068e9e8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0MWVjZWY2ZDUyMjAwNzQzYjM2NzIzNDZhNTlmYzFlMjA2OGU5ZTg=", "commit": {"author": {"name": "Ulrik Sverdrup", "email": "bluss@users.noreply.github.com", "date": "2017-04-30T19:07:39Z"}, "committer": {"name": "Ulrik Sverdrup", "email": "bluss@users.noreply.github.com", "date": "2017-04-30T19:20:20Z"}, "message": "std_unicode: impl Clone for .split_whitespace()\n\nUse custom closure structs for the predicates so that the iterator's\nclone can simply be derived. This should also reduce virtual call\noverhead by not using function pointers.", "tree": {"sha": "855808fb4a32b43b4d207f3112c7c91af4cf6aa2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/855808fb4a32b43b4d207f3112c7c91af4cf6aa2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f41ecef6d52200743b3672346a59fc1e2068e9e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f41ecef6d52200743b3672346a59fc1e2068e9e8", "html_url": "https://github.com/rust-lang/rust/commit/f41ecef6d52200743b3672346a59fc1e2068e9e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f41ecef6d52200743b3672346a59fc1e2068e9e8/comments", "author": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "06fb4d25642a3f223db1441972dd5962085cfba1", "url": "https://api.github.com/repos/rust-lang/rust/commits/06fb4d25642a3f223db1441972dd5962085cfba1", "html_url": "https://github.com/rust-lang/rust/commit/06fb4d25642a3f223db1441972dd5962085cfba1"}], "stats": {"total": 52, "additions": 40, "deletions": 12}, "files": [{"sha": "d63878a7a7c2442916ca6563937ea414e3180450", "filename": "src/libstd_unicode/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f41ecef6d52200743b3672346a59fc1e2068e9e8/src%2Flibstd_unicode%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f41ecef6d52200743b3672346a59fc1e2068e9e8/src%2Flibstd_unicode%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd_unicode%2Flib.rs?ref=f41ecef6d52200743b3672346a59fc1e2068e9e8", "patch": "@@ -36,9 +36,11 @@\n #![feature(core_char_ext)]\n #![feature(decode_utf8)]\n #![feature(fused)]\n+#![feature(fn_traits)]\n #![feature(lang_items)]\n #![feature(staged_api)]\n #![feature(try_from)]\n+#![feature(unboxed_closures)]\n \n mod tables;\n mod u_str;"}, {"sha": "e138e71c9c12b453c129188d9f38d2124fe8803f", "filename": "src/libstd_unicode/u_str.rs", "status": "modified", "additions": 38, "deletions": 12, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/f41ecef6d52200743b3672346a59fc1e2068e9e8/src%2Flibstd_unicode%2Fu_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f41ecef6d52200743b3672346a59fc1e2068e9e8/src%2Flibstd_unicode%2Fu_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd_unicode%2Fu_str.rs?ref=f41ecef6d52200743b3672346a59fc1e2068e9e8", "patch": "@@ -26,8 +26,9 @@ use core::str::Split;\n /// [`split_whitespace`]: ../../std/primitive.str.html#method.split_whitespace\n /// [`str`]: ../../std/primitive.str.html\n #[stable(feature = \"split_whitespace\", since = \"1.1.0\")]\n+#[derive(Clone)]\n pub struct SplitWhitespace<'a> {\n-    inner: Filter<Split<'a, fn(char) -> bool>, fn(&&str) -> bool>,\n+    inner: Filter<Split<'a, IsWhitespace>, IsNotEmpty>,\n }\n \n /// Methods for Unicode string slices\n@@ -44,17 +45,7 @@ pub trait UnicodeStr {\n impl UnicodeStr for str {\n     #[inline]\n     fn split_whitespace(&self) -> SplitWhitespace {\n-        fn is_not_empty(s: &&str) -> bool {\n-            !s.is_empty()\n-        }\n-        let is_not_empty: fn(&&str) -> bool = is_not_empty; // coerce to fn pointer\n-\n-        fn is_whitespace(c: char) -> bool {\n-            c.is_whitespace()\n-        }\n-        let is_whitespace: fn(char) -> bool = is_whitespace; // coerce to fn pointer\n-\n-        SplitWhitespace { inner: self.split(is_whitespace).filter(is_not_empty) }\n+        SplitWhitespace { inner: self.split(IsWhitespace).filter(IsNotEmpty) }\n     }\n \n     #[inline]\n@@ -139,6 +130,41 @@ impl<I> Iterator for Utf16Encoder<I>\n impl<I> FusedIterator for Utf16Encoder<I>\n     where I: FusedIterator<Item = char> {}\n \n+#[derive(Clone)]\n+struct IsWhitespace;\n+\n+impl FnOnce<(char, )> for IsWhitespace {\n+    type Output = bool;\n+\n+    extern \"rust-call\" fn call_once(mut self, arg: (char, )) -> bool {\n+        self.call_mut(arg)\n+    }\n+}\n+\n+impl FnMut<(char, )> for IsWhitespace {\n+    extern \"rust-call\" fn call_mut(&mut self, arg: (char, )) -> bool {\n+        arg.0.is_whitespace()\n+    }\n+}\n+\n+#[derive(Clone)]\n+struct IsNotEmpty;\n+\n+impl<'a, 'b> FnOnce<(&'a &'b str, )> for IsNotEmpty {\n+    type Output = bool;\n+\n+    extern \"rust-call\" fn call_once(mut self, arg: (&&str, )) -> bool {\n+        self.call_mut(arg)\n+    }\n+}\n+\n+impl<'a, 'b> FnMut<(&'a &'b str, )> for IsNotEmpty {\n+    extern \"rust-call\" fn call_mut(&mut self, arg: (&&str, )) -> bool {\n+        !arg.0.is_empty()\n+    }\n+}\n+\n+\n #[stable(feature = \"split_whitespace\", since = \"1.1.0\")]\n impl<'a> Iterator for SplitWhitespace<'a> {\n     type Item = &'a str;"}]}