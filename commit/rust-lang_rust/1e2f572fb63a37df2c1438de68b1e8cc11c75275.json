{"sha": "1e2f572fb63a37df2c1438de68b1e8cc11c75275", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlMmY1NzJmYjYzYTM3ZGYyYzE0MzhkZTY4YjFlOGNjMTFjNzUyNzU=", "commit": {"author": {"name": "Luca Bruno", "email": "lucab@debian.org", "date": "2014-03-02T16:29:54Z"}, "committer": {"name": "Luca Bruno", "email": "lucab@debian.org", "date": "2014-03-02T16:29:54Z"}, "message": "librustc: add LLVM LDFLAGS to deps\n\nThis commit let librustc automatically pickup LDFLAGS dependencies\ninherited from LLVM, which may otherwise result in undefined\nreferences to external symbols under certain linking environment.\n\nA symptom of this issue is eg. a failure when trying to link against\nlibrustc (due to unresolved ffi_*i symbols), while using a system-wide\nLLVM.\n\nSigned-off-by: Luca Bruno <lucab@debian.org>", "tree": {"sha": "a45279f3c4d75640eb28d99e726388c535e5da6f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a45279f3c4d75640eb28d99e726388c535e5da6f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e2f572fb63a37df2c1438de68b1e8cc11c75275", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e2f572fb63a37df2c1438de68b1e8cc11c75275", "html_url": "https://github.com/rust-lang/rust/commit/1e2f572fb63a37df2c1438de68b1e8cc11c75275", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e2f572fb63a37df2c1438de68b1e8cc11c75275/comments", "author": {"login": "lucab", "id": 98086, "node_id": "MDQ6VXNlcjk4MDg2", "avatar_url": "https://avatars.githubusercontent.com/u/98086?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lucab", "html_url": "https://github.com/lucab", "followers_url": "https://api.github.com/users/lucab/followers", "following_url": "https://api.github.com/users/lucab/following{/other_user}", "gists_url": "https://api.github.com/users/lucab/gists{/gist_id}", "starred_url": "https://api.github.com/users/lucab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lucab/subscriptions", "organizations_url": "https://api.github.com/users/lucab/orgs", "repos_url": "https://api.github.com/users/lucab/repos", "events_url": "https://api.github.com/users/lucab/events{/privacy}", "received_events_url": "https://api.github.com/users/lucab/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lucab", "id": 98086, "node_id": "MDQ6VXNlcjk4MDg2", "avatar_url": "https://avatars.githubusercontent.com/u/98086?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lucab", "html_url": "https://github.com/lucab", "followers_url": "https://api.github.com/users/lucab/followers", "following_url": "https://api.github.com/users/lucab/following{/other_user}", "gists_url": "https://api.github.com/users/lucab/gists{/gist_id}", "starred_url": "https://api.github.com/users/lucab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lucab/subscriptions", "organizations_url": "https://api.github.com/users/lucab/orgs", "repos_url": "https://api.github.com/users/lucab/repos", "events_url": "https://api.github.com/users/lucab/events{/privacy}", "received_events_url": "https://api.github.com/users/lucab/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "baf79083aedb8ae64efddbcf28b358841cfd1157", "url": "https://api.github.com/repos/rust-lang/rust/commits/baf79083aedb8ae64efddbcf28b358841cfd1157", "html_url": "https://github.com/rust-lang/rust/commit/baf79083aedb8ae64efddbcf28b358841cfd1157"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "189d0269cd88e31a9f0b021adc059ea5b9f37da2", "filename": "src/etc/mklldeps.py", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1e2f572fb63a37df2c1438de68b1e8cc11c75275/src%2Fetc%2Fmklldeps.py", "raw_url": "https://github.com/rust-lang/rust/raw/1e2f572fb63a37df2c1438de68b1e8cc11c75275/src%2Fetc%2Fmklldeps.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmklldeps.py?ref=1e2f572fb63a37df2c1438de68b1e8cc11c75275", "patch": "@@ -55,6 +55,7 @@\n \n     f.write(\"#[cfg(\" + ', '.join(cfg) + \")]\\n\")\n \n+    # LLVM libs\n     args = [llconfig, '--libs']\n     args.extend(components)\n     proc = subprocess.Popen(args, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n@@ -67,6 +68,21 @@\n     for lib in out.strip().split(' '):\n         lib = lib[2:] # chop of the leading '-l'\n         f.write(\"#[link(name = \\\"\" + lib + \"\\\", kind = \\\"static\\\")]\\n\")\n+\n+    # LLVM ldflags\n+    args = [llconfig, '--ldflags']\n+    proc = subprocess.Popen(args, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n+    out, err = proc.communicate()\n+\n+    if err:\n+        print(\"failed to run llconfig: args = `{}`\".format(args))\n+        sys.exit(1)\n+\n+    for lib in out.strip().split(' '):\n+        if lib[:2] == \"-l\":\n+            f.write(\"#[link(name = \\\"\" + lib[2:] + \"\\\")]\\n\")\n+\n+    #extra\n     f.write(\"#[link(name = \\\"stdc++\\\")]\\n\")\n     if os == 'win32':\n         f.write(\"#[link(name = \\\"imagehlp\\\")]\\n\")"}]}