{"sha": "77d2eaba1679832f4c00241645712460351eddb4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3ZDJlYWJhMTY3OTgzMmY0YzAwMjQxNjQ1NzEyNDYwMzUxZWRkYjQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-05-09T13:58:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-09T13:58:22Z"}, "message": "Merge #4389\n\n4389: Ascribe more correct types r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "4724422ed5f7242cd23987f30133dc211895154b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4724422ed5f7242cd23987f30133dc211895154b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77d2eaba1679832f4c00241645712460351eddb4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJetrb+CRBK7hj4Ov3rIwAAdHIIAHMeC/tLS6+CJtZ8muacKawF\nklJn9LlGRtnq+dMCbW7u//2Pv5sq4c3VOVuh4kpnwbN3qLd+jZPWXFD/Owrn9EfS\nDhRCS10wGagYcJufMx4cTfTwNyXXRxj++GrWWDF/BzOQXFASbV8xbjbTOtDDEOys\nlrW49xqNvTL2p5b8+xHaax9v118Htr898sKtcwxstSxHmznItmtechzOfsaXB/5r\n95zsK+VrLt9jcYT0gYC+RTSg6yzD2IqovkkDtbuw2sujhqCElgW17WJ2Q/2r2A7H\njnyFIhXnTlf+ifxGMh6lKKNoRcTWHOko+tOKQM1BfsoDMB5+nzZIs/ACqT+wIEI=\n=6I4F\n-----END PGP SIGNATURE-----\n", "payload": "tree 4724422ed5f7242cd23987f30133dc211895154b\nparent c5c07c2a0a1b4809c5aacef3c8e90034d00c3b03\nparent e201e7834d623f954e06925b9de0f14cd5ff90c1\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1589032702 +0000\ncommitter GitHub <noreply@github.com> 1589032702 +0000\n\nMerge #4389\n\n4389: Ascribe more correct types r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77d2eaba1679832f4c00241645712460351eddb4", "html_url": "https://github.com/rust-lang/rust/commit/77d2eaba1679832f4c00241645712460351eddb4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77d2eaba1679832f4c00241645712460351eddb4/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5c07c2a0a1b4809c5aacef3c8e90034d00c3b03", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5c07c2a0a1b4809c5aacef3c8e90034d00c3b03", "html_url": "https://github.com/rust-lang/rust/commit/c5c07c2a0a1b4809c5aacef3c8e90034d00c3b03"}, {"sha": "e201e7834d623f954e06925b9de0f14cd5ff90c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/e201e7834d623f954e06925b9de0f14cd5ff90c1", "html_url": "https://github.com/rust-lang/rust/commit/e201e7834d623f954e06925b9de0f14cd5ff90c1"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "146cc75df2ad1a0c0e860e9c84205509c058f610", "filename": "crates/ra_assists/src/handlers/add_explicit_type.rs", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/77d2eaba1679832f4c00241645712460351eddb4/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fadd_explicit_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77d2eaba1679832f4c00241645712460351eddb4/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fadd_explicit_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fadd_explicit_type.rs?ref=77d2eaba1679832f4c00241645712460351eddb4", "patch": "@@ -23,6 +23,7 @@ use crate::{AssistContext, AssistId, Assists};\n // ```\n pub(crate) fn add_explicit_type(acc: &mut Assists, ctx: &AssistContext) -> Option<()> {\n     let stmt = ctx.find_node_at_offset::<LetStmt>()?;\n+    let module = ctx.sema.scope(stmt.syntax()).module()?;\n     let expr = stmt.initializer()?;\n     let pat = stmt.pat()?;\n     // Must be a binding\n@@ -57,17 +58,17 @@ pub(crate) fn add_explicit_type(acc: &mut Assists, ctx: &AssistContext) -> Optio\n         return None;\n     }\n \n-    let db = ctx.db;\n-    let new_type_string = ty.display_truncated(db, None).to_string();\n+    let inferred_type = ty.display_source_code(ctx.db, module.into()).ok()?;\n     acc.add(\n         AssistId(\"add_explicit_type\"),\n-        format!(\"Insert explicit type '{}'\", new_type_string),\n+        format!(\"Insert explicit type '{}'\", inferred_type),\n         pat_range,\n-        |edit| {\n-            if let Some(ascribed_ty) = ascribed_ty {\n-                edit.replace(ascribed_ty.syntax().text_range(), new_type_string);\n-            } else {\n-                edit.insert(name_range.end(), format!(\": {}\", new_type_string));\n+        |builder| match ascribed_ty {\n+            Some(ascribed_ty) => {\n+                builder.replace(ascribed_ty.syntax().text_range(), inferred_type);\n+            }\n+            None => {\n+                builder.insert(name_range.end(), format!(\": {}\", inferred_type));\n             }\n         },\n     )\n@@ -208,7 +209,7 @@ struct Test<K, T = u8> {\n }\n \n fn main() {\n-    let test<|>: Test<i32> = Test { t: 23, k: 33 };\n+    let test<|>: Test<i32, u8> = Test { t: 23, k: 33 };\n }\"#,\n         );\n     }"}]}