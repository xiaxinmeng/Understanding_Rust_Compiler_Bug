{"sha": "64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0ZjdlMTFmYzMxZDlmYmE2YmNlNWFiMzFmYzBkNTk2OTE2NTBmM2M=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-03-01T22:50:50Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-04-02T19:24:50Z"}, "message": "Update sccache to its master branch\n\nIdeally I'd like to soon enable sccache for rustbuild itself and some of the\nstage0 tools, but for that to work we'll need some better Rust support than the\npretty old version we were previously using!", "tree": {"sha": "b4b370f6f7b8f8b2b5110be1d8be52ac5e8ba1a3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4b370f6f7b8f8b2b5110be1d8be52ac5e8ba1a3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "html_url": "https://github.com/rust-lang/rust/commit/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "097efa9a998d4f3a4aee3af126e8f8a9eba1ae07", "url": "https://api.github.com/repos/rust-lang/rust/commits/097efa9a998d4f3a4aee3af126e8f8a9eba1ae07", "html_url": "https://github.com/rust-lang/rust/commit/097efa9a998d4f3a4aee3af126e8f8a9eba1ae07"}], "stats": {"total": 35, "additions": 12, "deletions": 23}, "files": [{"sha": "f465ba422817448bcaa8d98efc24c95b5c575a12", "filename": ".travis.yml", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "patch": "@@ -30,7 +30,6 @@ matrix:\n         SRC=.\n         DEPLOY_ALT=1\n         RUSTC_RETRY_LINKER_ON_SEGFAULT=1\n-        SCCACHE_ERROR_LOG=/tmp/sccache.log\n         MACOSX_DEPLOYMENT_TARGET=10.7\n         NO_LLVM_ASSERTIONS=1\n         NO_DEBUG_ASSERTIONS=1\n@@ -50,7 +49,6 @@ matrix:\n         RUST_CONFIGURE_ARGS=\"--build=x86_64-apple-darwin --enable-sanitizers --enable-profiler\"\n         SRC=.\n         RUSTC_RETRY_LINKER_ON_SEGFAULT=1\n-        SCCACHE_ERROR_LOG=/tmp/sccache.log\n         MACOSX_DEPLOYMENT_TARGET=10.8\n         MACOSX_STD_DEPLOYMENT_TARGET=10.7\n         NO_LLVM_ASSERTIONS=1\n@@ -64,7 +62,6 @@ matrix:\n         RUST_CONFIGURE_ARGS=--build=i686-apple-darwin\n         SRC=.\n         RUSTC_RETRY_LINKER_ON_SEGFAULT=1\n-        SCCACHE_ERROR_LOG=/tmp/sccache.log\n         MACOSX_DEPLOYMENT_TARGET=10.8\n         MACOSX_STD_DEPLOYMENT_TARGET=10.7\n         NO_LLVM_ASSERTIONS=1\n@@ -85,7 +82,6 @@ matrix:\n         SRC=.\n         DEPLOY=1\n         RUSTC_RETRY_LINKER_ON_SEGFAULT=1\n-        SCCACHE_ERROR_LOG=/tmp/sccache.log\n         MACOSX_DEPLOYMENT_TARGET=10.7\n         NO_LLVM_ASSERTIONS=1\n         NO_DEBUG_ASSERTIONS=1\n@@ -99,7 +95,6 @@ matrix:\n         SRC=.\n         DEPLOY=1\n         RUSTC_RETRY_LINKER_ON_SEGFAULT=1\n-        SCCACHE_ERROR_LOG=/tmp/sccache.log\n         MACOSX_DEPLOYMENT_TARGET=10.7\n         NO_LLVM_ASSERTIONS=1\n         NO_DEBUG_ASSERTIONS=1\n@@ -227,7 +222,7 @@ install:\n             travis_retry brew update &&\n             travis_retry brew install xz;\n           fi &&\n-          travis_retry curl -fo /usr/local/bin/sccache https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2017-05-12-sccache-x86_64-apple-darwin &&\n+          travis_retry curl -fo /usr/local/bin/sccache https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-02-sccache-x86_64-apple-darwin &&\n             chmod +x /usr/local/bin/sccache &&\n           travis_retry curl -fo /usr/local/bin/stamp https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2017-03-17-stamp-x86_64-apple-darwin &&\n             chmod +x /usr/local/bin/stamp\n@@ -268,12 +263,6 @@ after_failure:\n       df -h;\n       du . | sort -nr | head -n100\n \n-  # One of these is the linux sccache log, one is the OSX sccache log. Instead\n-  # of worrying about what system we are just cat both. One of these commands\n-  # will fail but that's ok, they'll both get executed.\n-  - cat obj/tmp/sccache.log\n-  - cat /tmp/sccache.log\n-\n   # Random attempt at debugging currently. Just poking around in here to see if\n   # anything shows up.\n   - ls -lat $HOME/Library/Logs/DiagnosticReports/"}, {"sha": "09c6fca5d02afc8f3f46bf8b4ea46eb5c9f2a958", "filename": "appveyor.yml", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "patch": "@@ -152,8 +152,8 @@ install:\n   - set PATH=C:\\Python27;%PATH%\n \n   # Download and install sccache\n-  - appveyor-retry appveyor DownloadFile https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2017-05-12-sccache-x86_64-pc-windows-msvc\n-  - mv 2017-05-12-sccache-x86_64-pc-windows-msvc sccache.exe\n+  - appveyor-retry appveyor DownloadFile https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-02-sccache-x86_64-pc-windows-msvc\n+  - mv 2018-04-02-sccache-x86_64-pc-windows-msvc sccache.exe\n   - set PATH=%PATH%;%CD%\n \n   # Download and install ninja\n@@ -176,19 +176,13 @@ install:\n   - set PATH=%PATH%;%CD%\\handle\n   - handle.exe -accepteula -help\n \n-  # Attempt to debug sccache failures\n-  - set SCCACHE_ERROR_LOG=%CD%/sccache.log\n-\n test_script:\n   - if not exist C:\\cache\\rustsrc\\NUL mkdir C:\\cache\\rustsrc\n   - sh src/ci/init_repo.sh . /c/cache/rustsrc\n   - set SRC=.\n   - set NO_CCACHE=1\n   - sh src/ci/run.sh\n \n-on_failure:\n-  - cat %CD%\\sccache.log || exit 0\n-\n branches:\n   only:\n     - auto"}, {"sha": "1b6ee44d87afca025e01d26d8df660ac063061ca", "filename": "src/ci/docker/dist-various-1/Dockerfile", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/src%2Fci%2Fdocker%2Fdist-various-1%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/src%2Fci%2Fdocker%2Fdist-various-1%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-various-1%2FDockerfile?ref=64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "patch": "@@ -66,6 +66,14 @@ RUN env \\\n     bash musl.sh mipsel && \\\n     rm -rf /build/*\n \n+# FIXME(mozilla/sccache#235) this shouldn't be necessary but is currently\n+# necessary to disambiguate the mips compiler with the mipsel compiler. We want\n+# to give these two wrapper scripts (currently identical ones) different hashes\n+# to ensure that sccache understands that they're different compilers.\n+RUN \\\n+  echo \"# a\" >> /usr/local/mips-linux-musl/bin/mips-openwrt-linux-musl-wrapper.sh && \\\n+  echo \"# b\" >> /usr/local/mipsel-linux-musl/bin/mipsel-openwrt-linux-musl-wrapper.sh\n+\n ENV TARGETS=asmjs-unknown-emscripten\n ENV TARGETS=$TARGETS,wasm32-unknown-emscripten\n ENV TARGETS=$TARGETS,x86_64-rumprun-netbsd"}, {"sha": "ea2387b67dbccf9379b5c017e383ef6f61b9c296", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "patch": "@@ -104,8 +104,6 @@ if [ \"$SCCACHE_BUCKET\" != \"\" ]; then\n     args=\"$args --env SCCACHE_REGION\"\n     args=\"$args --env AWS_ACCESS_KEY_ID\"\n     args=\"$args --env AWS_SECRET_ACCESS_KEY\"\n-    args=\"$args --env SCCACHE_ERROR_LOG=/tmp/sccache/sccache.log\"\n-    args=\"$args --volume $objdir/tmp:/tmp/sccache\"\n else\n     mkdir -p $HOME/.cache/sccache\n     args=\"$args --env SCCACHE_DIR=/sccache --volume $HOME/.cache/sccache:/sccache\""}, {"sha": "da52d08318115eb80a7cc39bb3ffde8e8439dad3", "filename": "src/ci/docker/scripts/sccache.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/src%2Fci%2Fdocker%2Fscripts%2Fsccache.sh", "raw_url": "https://github.com/rust-lang/rust/raw/64f7e11fc31d9fba6bce5ab31fc0d59691650f3c/src%2Fci%2Fdocker%2Fscripts%2Fsccache.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fsccache.sh?ref=64f7e11fc31d9fba6bce5ab31fc0d59691650f3c", "patch": "@@ -13,6 +13,6 @@\n set -ex\n \n curl -fo /usr/local/bin/sccache \\\n-  https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2017-05-12-sccache-x86_64-unknown-linux-musl\n+  https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-02-sccache-x86_64-unknown-linux-musl\n \n chmod +x /usr/local/bin/sccache"}]}