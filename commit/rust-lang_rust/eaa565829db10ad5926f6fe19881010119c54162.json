{"sha": "eaa565829db10ad5926f6fe19881010119c54162", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhYTU2NTgyOWRiMTBhZDU5MjZmNmZlMTk4ODEwMTAxMTljNTQxNjI=", "commit": {"author": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-08-28T04:43:11Z"}, "committer": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-08-28T04:43:11Z"}, "message": "rustc: Use \"main\" entry point on Windows\n\nFixes #8510.", "tree": {"sha": "184d1ee986a4cb43b0e09963e539b2c0341d9dce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/184d1ee986a4cb43b0e09963e539b2c0341d9dce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eaa565829db10ad5926f6fe19881010119c54162", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eaa565829db10ad5926f6fe19881010119c54162", "html_url": "https://github.com/rust-lang/rust/commit/eaa565829db10ad5926f6fe19881010119c54162", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eaa565829db10ad5926f6fe19881010119c54162/comments", "author": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "35f975b83881106e0fde729b8c1361c9cf6d2778", "url": "https://api.github.com/repos/rust-lang/rust/commits/35f975b83881106e0fde729b8c1361c9cf6d2778", "html_url": "https://github.com/rust-lang/rust/commit/35f975b83881106e0fde729b8c1361c9cf6d2778"}], "stats": {"total": 16, "additions": 4, "deletions": 12}, "files": [{"sha": "e8186477877f423e019be698ce7719047c721add", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/eaa565829db10ad5926f6fe19881010119c54162/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eaa565829db10ad5926f6fe19881010119c54162/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=eaa565829db10ad5926f6fe19881010119c54162", "patch": "@@ -2366,20 +2366,12 @@ pub fn create_entry_wrapper(ccx: @mut CrateContext,\n                                &ccx.int_type);\n \n         // FIXME #4404 android JNI hacks\n-        let llfn = if *ccx.sess.building_library {\n-            decl_cdecl_fn(ccx.llmod, \"amain\", llfty)\n+        let main_name = if *ccx.sess.building_library {\n+            \"amain\"\n         } else {\n-            let main_name = match ccx.sess.targ_cfg.os {\n-                session::os_win32 => {\n-                    match ccx.sess.targ_cfg.arch {\n-                        X86 => ~\"WinMain@16\",\n-                        _ => ~\"WinMain\",\n-                    }\n-                },\n-                _ => ~\"main\",\n-            };\n-            decl_cdecl_fn(ccx.llmod, main_name, llfty)\n+            \"main\"\n         };\n+        let llfn = decl_cdecl_fn(ccx.llmod, main_name, llfty);\n         let llbb = do \"top\".with_c_str |buf| {\n             unsafe {\n                 llvm::LLVMAppendBasicBlockInContext(ccx.llcx, llfn, buf)"}]}