{"sha": "9d70c1949e4c26cc558525b242714efb3e8eb212", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkNzBjMTk0OWU0YzI2Y2M1NTg1MjViMjQyNzE0ZWZiM2U4ZWIyMTI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-12-15T22:46:51Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-12-17T02:18:43Z"}, "message": "rt: Fix alignment of the call to upcall_del_stack in __morestack", "tree": {"sha": "398552f30e4d88e0a409ebe010d19bd742d513c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/398552f30e4d88e0a409ebe010d19bd742d513c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d70c1949e4c26cc558525b242714efb3e8eb212", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d70c1949e4c26cc558525b242714efb3e8eb212", "html_url": "https://github.com/rust-lang/rust/commit/9d70c1949e4c26cc558525b242714efb3e8eb212", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d70c1949e4c26cc558525b242714efb3e8eb212/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23df4de86d8740545891a745f3c2f6c90cf1d1fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/23df4de86d8740545891a745f3c2f6c90cf1d1fd", "html_url": "https://github.com/rust-lang/rust/commit/23df4de86d8740545891a745f3c2f6c90cf1d1fd"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "7481ce3afd0461d7a1a4e2b13e1a6d80569b218d", "filename": "src/rt/arch/i386/morestack.S", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9d70c1949e4c26cc558525b242714efb3e8eb212/src%2Frt%2Farch%2Fi386%2Fmorestack.S", "raw_url": "https://github.com/rust-lang/rust/raw/9d70c1949e4c26cc558525b242714efb3e8eb212/src%2Frt%2Farch%2Fi386%2Fmorestack.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fi386%2Fmorestack.S?ref=9d70c1949e4c26cc558525b242714efb3e8eb212", "patch": "@@ -64,6 +64,9 @@ MORESTACK:\n \t// NB: This can be called with the fastcc convention so we\n \t// have to preserve any argument registers we want to use\n \n+\t// NB: __morestack is called misaligned by 4 bytes, i.e.\n+\t// subl $4, %esp would get us to a normal alignment\n+\n \t// FIXME (1226): main is compiled with the split-stack prologue,\n \t// causing it to call __morestack, so we have to jump back out\n \tsubl $28,%esp\n@@ -120,7 +123,9 @@ MORESTACK:\n \t// Switch back to the rust stack\n \tmovl %ebp, %esp\n \n-\tsubl $8, %esp // Alignment\n+\t// Remember that __morestack is called misaligned so %ebp\n+\t// is not aligned to a 16-byte boundary, these 4 bytes realign.\n+\tsubl $4, %esp\n \n \t// Now that we're on the return path we want to avoid\n \t// stomping on %eax. FIXME: Need to save and restore\n@@ -137,7 +142,7 @@ MORESTACK:\n \tpushl $0\n \tcall UPCALL_CALL_C\n \n-\taddl $16,%esp\n+\taddl $12,%esp\n \n \tpopl %ebp\n #if defined(__linux__) || defined(__APPLE__)"}]}