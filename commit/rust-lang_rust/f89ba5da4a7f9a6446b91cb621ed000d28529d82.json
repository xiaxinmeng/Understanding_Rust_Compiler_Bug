{"sha": "f89ba5da4a7f9a6446b91cb621ed000d28529d82", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4OWJhNWRhNGE3ZjlhNjQ0NmI5MWNiNjIxZWQwMDBkMjg1MjlkODI=", "commit": {"author": {"name": "Matt Brubeck", "email": "mbrubeck@limpet.net", "date": "2016-10-18T17:56:12Z"}, "committer": {"name": "Matt Brubeck", "email": "mbrubeck@limpet.net", "date": "2016-10-18T17:56:12Z"}, "message": "Fix some mistakes in HRTB docs\n\nThe example code for higher-ranked trait bounds on closures had an\nunnecessary `mut` which was confusing, and the text referred to an\nmutable reference which does not exist in the code (and isn't needed).\nRemoved the `mut`s and fixed the text to better describe the actual\nerror for the failing example.", "tree": {"sha": "aea72659bdc3a7c3f5e3218a32504b399c11c682", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aea72659bdc3a7c3f5e3218a32504b399c11c682"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f89ba5da4a7f9a6446b91cb621ed000d28529d82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f89ba5da4a7f9a6446b91cb621ed000d28529d82", "html_url": "https://github.com/rust-lang/rust/commit/f89ba5da4a7f9a6446b91cb621ed000d28529d82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f89ba5da4a7f9a6446b91cb621ed000d28529d82/comments", "author": {"login": "mbrubeck", "id": 5920, "node_id": "MDQ6VXNlcjU5MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/5920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbrubeck", "html_url": "https://github.com/mbrubeck", "followers_url": "https://api.github.com/users/mbrubeck/followers", "following_url": "https://api.github.com/users/mbrubeck/following{/other_user}", "gists_url": "https://api.github.com/users/mbrubeck/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbrubeck/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbrubeck/subscriptions", "organizations_url": "https://api.github.com/users/mbrubeck/orgs", "repos_url": "https://api.github.com/users/mbrubeck/repos", "events_url": "https://api.github.com/users/mbrubeck/events{/privacy}", "received_events_url": "https://api.github.com/users/mbrubeck/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mbrubeck", "id": 5920, "node_id": "MDQ6VXNlcjU5MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/5920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbrubeck", "html_url": "https://github.com/mbrubeck", "followers_url": "https://api.github.com/users/mbrubeck/followers", "following_url": "https://api.github.com/users/mbrubeck/following{/other_user}", "gists_url": "https://api.github.com/users/mbrubeck/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbrubeck/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbrubeck/subscriptions", "organizations_url": "https://api.github.com/users/mbrubeck/orgs", "repos_url": "https://api.github.com/users/mbrubeck/repos", "events_url": "https://api.github.com/users/mbrubeck/events{/privacy}", "received_events_url": "https://api.github.com/users/mbrubeck/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c2552b712386dd01a9d620aff960b98cddb4098", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c2552b712386dd01a9d620aff960b98cddb4098", "html_url": "https://github.com/rust-lang/rust/commit/2c2552b712386dd01a9d620aff960b98cddb4098"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "60b99c08825eec4037275ec16f739d7700d0c6ac", "filename": "src/doc/book/closures.md", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f89ba5da4a7f9a6446b91cb621ed000d28529d82/src%2Fdoc%2Fbook%2Fclosures.md", "raw_url": "https://github.com/rust-lang/rust/raw/f89ba5da4a7f9a6446b91cb621ed000d28529d82/src%2Fdoc%2Fbook%2Fclosures.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fbook%2Fclosures.md?ref=f89ba5da4a7f9a6446b91cb621ed000d28529d82", "patch": "@@ -327,7 +327,7 @@ that takes a reference like so:\n fn call_with_ref<F>(some_closure:F) -> i32\n     where F: Fn(&i32) -> i32 {\n \n-    let mut value = 0;\n+    let value = 0;\n     some_closure(&value)\n }\n ```\n@@ -340,14 +340,15 @@ fn call_with_ref<'a, F>(some_closure:F) -> i32\n     where F: Fn(&'a i32) -> i32 {\n ```\n \n-However this presents a problem in our case. When you specify the explicit\n-lifetime on a function it binds that lifetime to the *entire* scope of the function\n-instead of just the invocation scope of our closure. This means that the borrow checker\n-will see a mutable reference in the same lifetime as our immutable reference and fail\n-to compile.\n+However, this presents a problem in our case. When a function has an explicit\n+lifetime parameter, that lifetime must be at least as long as the *entire*\n+call to that function.  The borrow checker will complain that `value` doesn't\n+live long enough, because it is only in scope after its declaration inside the\n+function body.\n \n-In order to say that we only need the lifetime to be valid for the invocation scope\n-of the closure we can use Higher-Ranked Trait Bounds with the `for<...>` syntax:\n+What we need is a closure that can borrow its argument only for its own\n+invocation scope, not for the outer function's scope.  In order to say that,\n+we can use Higher-Ranked Trait Bounds with the `for<...>` syntax:\n \n ```ignore\n fn call_with_ref<F>(some_closure:F) -> i32\n@@ -362,7 +363,7 @@ expect.\n fn call_with_ref<F>(some_closure:F) -> i32\n     where F: for<'a> Fn(&'a i32) -> i32 {\n \n-    let mut value = 0;\n+    let value = 0;\n     some_closure(&value)\n }\n ```"}]}