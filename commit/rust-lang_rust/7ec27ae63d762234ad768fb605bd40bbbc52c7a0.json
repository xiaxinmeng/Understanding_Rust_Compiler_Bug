{"sha": "7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlYzI3YWU2M2Q3NjIyMzRhZDc2OGZiNjA1YmQ0MGJiYmM1MmM3YTA=", "commit": {"author": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2017-04-02T02:33:45Z"}, "committer": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2017-04-13T00:21:15Z"}, "message": "Add ToOwned::clone_into (unstable as toowned_clone_into)\n\nto_owned generalizes clone; this generalizes clone_from.  Use to_owned to\ngive it a default impl.  Customize the impl for [T], str, and T:Clone.\n\nUse it in Cow::clone_from to reuse resources when cloning Owned into Owned.", "tree": {"sha": "932053cae56ba36ac896ffdfdf6a38e01b83f5b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/932053cae56ba36ac896ffdfdf6a38e01b83f5b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "html_url": "https://github.com/rust-lang/rust/commit/7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/comments", "author": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44855a4cef3e83c76c386fdcf034447a8ee128e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/44855a4cef3e83c76c386fdcf034447a8ee128e4", "html_url": "https://github.com/rust-lang/rust/commit/44855a4cef3e83c76c386fdcf034447a8ee128e4"}], "stats": {"total": 86, "additions": 76, "deletions": 10}, "files": [{"sha": "2e9810c438d0eb4508b69b0757d70a6a44d08c04", "filename": "src/doc/unstable-book/src/SUMMARY.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Fdoc%2Funstable-book%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Fdoc%2Funstable-book%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2FSUMMARY.md?ref=7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "patch": "@@ -193,6 +193,7 @@\n - [thread_local](thread-local.md)\n - [thread_local_internals](thread-local-internals.md)\n - [thread_local_state](thread-local-state.md)\n+- [toowned_clone_into](toowned-clone-into.md)\n - [trace_macros](trace-macros.md)\n - [trusted_len](trusted-len.md)\n - [try_from](try-from.md)"}, {"sha": "eccc7e0e4dda0146a2c9720cd61dc2a25e2948aa", "filename": "src/doc/unstable-book/src/toowned-clone-into.md", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Fdoc%2Funstable-book%2Fsrc%2Ftoowned-clone-into.md", "raw_url": "https://github.com/rust-lang/rust/raw/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Fdoc%2Funstable-book%2Fsrc%2Ftoowned-clone-into.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Ftoowned-clone-into.md?ref=7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "patch": "@@ -0,0 +1,7 @@\n+# `toowned_clone_into`\n+\n+The tracking issue for this feature is: [#41263]\n+\n+[#41263]: https://github.com/rust-lang/rust/issues/41263\n+\n+------------------------"}, {"sha": "0de52b6696fcf02febb16085c5eb2860edbb52c1", "filename": "src/libcollections/borrow.rs", "status": "modified", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fborrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fborrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fborrow.rs?ref=7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "patch": "@@ -60,6 +60,29 @@ pub trait ToOwned {\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn to_owned(&self) -> Self::Owned;\n+\n+    /// Uses borrowed data to replace owned data, usually by cloning.\n+    ///\n+    /// This is borrow-generalized version of `Clone::clone_from`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// Basic usage:\n+    ///\n+    /// ```\n+    /// # #![feature(toowned_clone_into)]\n+    /// let mut s: String = String::new();\n+    /// \"hello\".clone_into(&mut s);\n+    ///\n+    /// let mut v: Vec<i32> = Vec::new();\n+    /// [1, 2][..].clone_into(&mut v);\n+    /// ```\n+    #[unstable(feature = \"toowned_clone_into\",\n+               reason = \"recently added\",\n+               issue = \"41263\")]\n+    fn clone_into(&self, target: &mut Self::Owned) {\n+        *target = self.to_owned();\n+    }\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n@@ -70,6 +93,10 @@ impl<T> ToOwned for T\n     fn to_owned(&self) -> T {\n         self.clone()\n     }\n+\n+    fn clone_into(&self, target: &mut T) {\n+        target.clone_from(self);\n+    }\n }\n \n /// A clone-on-write smart pointer.\n@@ -141,6 +168,17 @@ impl<'a, B: ?Sized> Clone for Cow<'a, B>\n             }\n         }\n     }\n+\n+    fn clone_from(&mut self, source: &Cow<'a, B>) {\n+        if let Owned(ref mut dest) = *self {\n+            if let Owned(ref o) = *source {\n+                o.borrow().clone_into(dest);\n+                return;\n+            }\n+        }\n+\n+        *self = source.clone();\n+    }\n }\n \n impl<'a, B: ?Sized> Cow<'a, B>"}, {"sha": "f7e0f0395e7ffe18bec5f84fff51ad54179f906b", "filename": "src/libcollections/slice.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fslice.rs?ref=7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "patch": "@@ -1527,6 +1527,19 @@ impl<T: Clone> ToOwned for [T] {\n     fn to_owned(&self) -> Vec<T> {\n         panic!(\"not available with cfg(test)\")\n     }\n+\n+    fn clone_into(&self, target: &mut Vec<T>) {\n+        // drop anything in target that will not be overwritten\n+        target.truncate(self.len());\n+        let len = target.len();\n+\n+        // reuse the contained values' allocations/resources.\n+        target.clone_from_slice(&self[..len]);\n+\n+        // target.len <= self.len due to the truncate above, so the\n+        // slice here is always in-bounds.\n+        target.extend_from_slice(&self[len..]);\n+    }\n }\n \n ////////////////////////////////////////////////////////////////////////////////"}, {"sha": "8d4b3a247e294150576f90fc1f963d8feabadb45", "filename": "src/libcollections/str.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fstr.rs?ref=7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "patch": "@@ -199,6 +199,12 @@ impl ToOwned for str {\n     fn to_owned(&self) -> String {\n         unsafe { String::from_utf8_unchecked(self.as_bytes().to_owned()) }\n     }\n+\n+    fn clone_into(&self, target: &mut String) {\n+        let mut b = mem::replace(target, String::new()).into_bytes();\n+        self.as_bytes().clone_into(&mut b);\n+        *target = unsafe { String::from_utf8_unchecked(b) }\n+    }\n }\n \n /// Methods for string slices."}, {"sha": "aa87ee84b3e9769ea36625c20afc7ec77a3698f6", "filename": "src/libcollections/tests/cow_str.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Ftests%2Fcow_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Ftests%2Fcow_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Ftests%2Fcow_str.rs?ref=7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "patch": "@@ -139,3 +139,13 @@ fn check_cow_add_assign_str() {\n     assert_eq!(\"Hi, World!\", owned);\n     assert_eq!(\"Hello, World!\", borrowed);\n }\n+\n+#[test]\n+fn check_cow_clone_from() {\n+    let mut c1: Cow<str> = Cow::Owned(String::with_capacity(25));\n+    let s: String = \"hi\".to_string();\n+    assert!(s.capacity() < 25);\n+    let c2: Cow<str> = Cow::Owned(s);\n+    c1.clone_from(&c2);\n+    assert!(c1.into_owned().capacity() >= 25);\n+}\n\\ No newline at end of file"}, {"sha": "3d11b4f80fb635c35a85f1c0b374eaf4cbb30a75", "filename": "src/libcollections/vec.rs", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ec27ae63d762234ad768fb605bd40bbbc52c7a0/src%2Flibcollections%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec.rs?ref=7ec27ae63d762234ad768fb605bd40bbbc52c7a0", "patch": "@@ -1396,16 +1396,7 @@ impl<T: Clone> Clone for Vec<T> {\n     }\n \n     fn clone_from(&mut self, other: &Vec<T>) {\n-        // drop anything in self that will not be overwritten\n-        self.truncate(other.len());\n-        let len = self.len();\n-\n-        // reuse the contained values' allocations/resources.\n-        self.clone_from_slice(&other[..len]);\n-\n-        // self.len <= other.len due to the truncate above, so the\n-        // slice here is always in-bounds.\n-        self.extend_from_slice(&other[len..]);\n+        other.as_slice().clone_into(self);\n     }\n }\n "}]}